const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-D0RBhhE1.js","assets/ui-C6WdqKj_.js","assets/vendor-CuLCWM7P.js","assets/supabase-DLPZu9zH.js","assets/web-DUCE8e5O.js","assets/web-DEZdiZQm.js","assets/web-BSaYvwmp.js","assets/web-D7SQYno4.js","assets/nativeCamera-Dnz8974A.js"])))=>i.map(i=>d[i]);
var fR=e=>{throw TypeError(e)};var LN=(e,t,n)=>t.has(e)||fR("Cannot "+n);var ie=(e,t,n)=>(LN(e,t,"read from private field"),n?n.call(e):t.get(e)),Mt=(e,t,n)=>t.has(e)?fR("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),mt=(e,t,n,r)=>(LN(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),un=(e,t,n)=>(LN(e,t,"access private method"),n);var Zb=(e,t,n,r)=>({set _(a){mt(e,t,a,n)},get _(){return ie(e,t,r)}});import{j as o,V as zP,R as BP,A as WP,C as VP,T as UP,D as HP,P as PK,b as GP,c as OK,d as LK,e as zK,f as JC,S as qP,g as KP,h as BK,i as YP,I as XP,k as ZP,l as QP,m as JP,L as e3,n as t3,o as WK,p as VK,q as n3,O as R0,r as e_,u as sr,W as UK,s as qo,t as D0,v as yn,w as M0,x as $0,y as t_,z as n_,B as HK,E as F0,F as An,G as Al,H as ou,J as Bo,K as Sl,M as r_,N as r3,Q as P0,U as a3,X as s3,Y as i3,Z as o3,$ as l3,a0 as u3,a1 as c3,a2 as rf,a3 as a_,a4 as d3,a5 as h3,a6 as GK,a7 as p3,a8 as qK,a9 as KK,aa as m3,ab as f3,ac as g3,ad as YK}from"./ui-C6WdqKj_.js";import{a as O0,r as k,R as ge,v as XK,u as Rl,N as NS,b as ZK,c as za,L as Va,O as zN,d as Ov,e as x3,f as QK,B as JK,g as eY,h as sa}from"./vendor-CuLCWM7P.js";import{c as tY}from"./supabase-DLPZu9zH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var y3,gR=O0;y3=gR.createRoot,gR.hydrateRoot;const nY=1,rY=1e6;let BN=0;function aY(){return BN=(BN+1)%Number.MAX_SAFE_INTEGER,BN.toString()}const WN=new Map,xR=e=>{if(WN.has(e))return;const t=setTimeout(()=>{WN.delete(e),Ix({type:"REMOVE_TOAST",toastId:e})},rY);WN.set(e,t)},sY=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,nY)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(n=>n.id===t.toast.id?{...n,...t.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?xR(n):e.toasts.forEach(r=>{xR(r.id)}),{...e,toasts:e.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(n=>n.id!==t.toastId)}}},Lv=[];let zv={toasts:[]};function Ix(e){zv=sY(zv,e),Lv.forEach(t=>{t(zv)})}function oe({...e}){const t=aY(),n=a=>Ix({type:"UPDATE_TOAST",toast:{...a,id:t}}),r=()=>Ix({type:"DISMISS_TOAST",toastId:t});return Ix({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:a=>{a||r()}}}),{id:t,dismiss:r,update:n}}function iY(){const[e,t]=k.useState(zv);return k.useEffect(()=>(Lv.push(t),()=>{const n=Lv.indexOf(t);n>-1&&Lv.splice(n,1)}),[e]),{...e,toast:oe,dismiss:n=>Ix({type:"DISMISS_TOAST",toastId:n})}}function b3(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=b3(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function v3(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=b3(e))&&(r&&(r+=" "),r+=t);return r}const yR=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,bR=v3,L0=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return bR(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:a,defaultVariants:s}=t,i=Object.keys(a).map(d=>{const c=n==null?void 0:n[d],h=s==null?void 0:s[d];if(c===null)return null;const p=yR(c)||yR(h);return a[d][p]}),l=n&&Object.entries(n).reduce((d,c)=>{let[h,p]=c;return p===void 0||(d[h]=p),d},{}),u=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((d,c)=>{let{class:h,className:p,...m}=c;return Object.entries(m).every(f=>{let[g,x]=f;return Array.isArray(x)?x.includes({...s,...l}[g]):{...s,...l}[g]===x})?[...d,h,p]:d},[]);return bR(e,i,u,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oY=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),w3=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var lY={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uY=k.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:s,iconNode:i,...l},u)=>k.createElement("svg",{ref:u,...lY,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:w3("lucide",a),...l},[...i.map(([d,c])=>k.createElement(d,c)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=(e,t)=>{const n=k.forwardRef(({className:r,...a},s)=>k.createElement(uY,{ref:s,iconNode:t,className:w3(`lucide-${oY(e)}`,r),...a}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const td=Qe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fi=Qe("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cY=Qe("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=Qe("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dY=Qe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hY=Qe("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kS=Qe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ru=Qe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const em=Qe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s_=Qe("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=Qe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ux=Qe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N3=Qe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hx=Qe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pY=Qe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mY=Qe("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fY=Qe("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=Qe("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k3=Qe("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gY=Qe("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xY=Qe("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ki=Qe("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S3=Qe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ja=Qe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SS=Qe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=Qe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=Qe("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yY=Qe("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bY=Qe("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const km=Qe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vR=Qe("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C3=Qe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _3=Qe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I3=Qe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vY=Qe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=Qe("Fingerprint",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wY=Qe("Focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=Qe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NY=Qe("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VN=Qe("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qb=Qe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CS=Qe("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kY=Qe("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T3=Qe("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SY=Qe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _S=Qe("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CY=Qe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_=Qe("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Qe("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=Qe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E3=Qe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xi=Qe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sm=Qe("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wR=Qe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j3=Qe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IS=Qe("Nfc",[["path",{d:"M6 8.32a7.43 7.43 0 0 1 0 7.36",key:"9iaqei"}],["path",{d:"M9.46 6.21a11.76 11.76 0 0 1 0 11.58",key:"1yha7l"}],["path",{d:"M12.91 4.1a15.91 15.91 0 0 1 .01 15.8",key:"4iu2gk"}],["path",{d:"M16.37 2a20.16 20.16 0 0 1 0 20",key:"sap9u2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bv=Qe("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A3=Qe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R3=Qe("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UN=Qe("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ay=Qe("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ry=Qe("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qs=Qe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Y=Qe("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B0=Qe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IY=Qe("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=Qe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pw=Qe("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D3=Qe("ScanFace",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_=Qe("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=Qe("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=Qe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M3=Qe("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $3=Qe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F3=Qe("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TY=Qe("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const af=Qe("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EY=Qe("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=Qe("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=Qe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HN=Qe("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P3=Qe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jY=Qe("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Do=Qe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O3=Qe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const To=Qe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AY=Qe("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=Qe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kR=Qe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RY=Qe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TS=Qe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=Qe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=Qe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=Qe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L3=Qe("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),l_="-",DY=e=>{const t=$Y(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:i=>{const l=i.split(l_);return l[0]===""&&l.length!==1&&l.shift(),z3(l,t)||MY(i)},getConflictingClassGroupIds:(i,l)=>{const u=n[i]||[];return l&&r[i]?[...u,...r[i]]:u}}},z3=(e,t)=>{var i;if(e.length===0)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),a=r?z3(e.slice(1),r):void 0;if(a)return a;if(t.validators.length===0)return;const s=e.join(l_);return(i=t.validators.find(({validator:l})=>l(s)))==null?void 0:i.classGroupId},SR=/^\[(.+)\]$/,MY=e=>{if(SR.test(e)){const t=SR.exec(e)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},$Y=e=>{const{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return PY(Object.entries(e.classGroups),n).forEach(([s,i])=>{ES(i,r,s,t)}),r},ES=(e,t,n,r)=>{e.forEach(a=>{if(typeof a=="string"){const s=a===""?t:CR(t,a);s.classGroupId=n;return}if(typeof a=="function"){if(FY(a)){ES(a(r),t,n,r);return}t.validators.push({validator:a,classGroupId:n});return}Object.entries(a).forEach(([s,i])=>{ES(i,CR(t,s),n,r)})})},CR=(e,t)=>{let n=e;return t.split(l_).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},FY=e=>e.isThemeGetter,PY=(e,t)=>t?e.map(([n,r])=>{const a=r.map(s=>typeof s=="string"?t+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([i,l])=>[t+i,l])):s);return[n,a]}):e,OY=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const a=(s,i)=>{n.set(s,i),t++,t>e&&(t=0,r=n,n=new Map)};return{get(s){let i=n.get(s);if(i!==void 0)return i;if((i=r.get(s))!==void 0)return a(s,i),i},set(s,i){n.has(s)?n.set(s,i):a(s,i)}}},B3="!",LY=e=>{const{separator:t,experimentalParseClassName:n}=e,r=t.length===1,a=t[0],s=t.length,i=l=>{const u=[];let d=0,c=0,h;for(let x=0;x<l.length;x++){let y=l[x];if(d===0){if(y===a&&(r||l.slice(x,x+s)===t)){u.push(l.slice(c,x)),c=x+s;continue}if(y==="/"){h=x;continue}}y==="["?d++:y==="]"&&d--}const p=u.length===0?l:l.substring(c),m=p.startsWith(B3),f=m?p.substring(1):p,g=h&&h>c?h-c:void 0;return{modifiers:u,hasImportantModifier:m,baseClassName:f,maybePostfixModifierPosition:g}};return n?l=>n({className:l,parseClassName:i}):i},zY=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(r=>{r[0]==="["?(t.push(...n.sort(),r),n=[]):n.push(r)}),t.push(...n.sort()),t},BY=e=>({cache:OY(e.cacheSize),parseClassName:LY(e),...DY(e)}),WY=/\s+/,VY=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a}=t,s=[],i=e.trim().split(WY);let l="";for(let u=i.length-1;u>=0;u-=1){const d=i[u],{modifiers:c,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:m}=n(d);let f=!!m,g=r(f?p.substring(0,m):p);if(!g){if(!f){l=d+(l.length>0?" "+l:l);continue}if(g=r(p),!g){l=d+(l.length>0?" "+l:l);continue}f=!1}const x=zY(c).join(":"),y=h?x+B3:x,b=y+g;if(s.includes(b))continue;s.push(b);const v=a(g,f);for(let w=0;w<v.length;++w){const N=v[w];s.push(y+N)}l=d+(l.length>0?" "+l:l)}return l};function UY(){let e=0,t,n,r="";for(;e<arguments.length;)(t=arguments[e++])&&(n=W3(t))&&(r&&(r+=" "),r+=n);return r}const W3=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=W3(e[r]))&&(n&&(n+=" "),n+=t);return n};function HY(e,...t){let n,r,a,s=i;function i(u){const d=t.reduce((c,h)=>h(c),e());return n=BY(d),r=n.cache.get,a=n.cache.set,s=l,l(u)}function l(u){const d=r(u);if(d)return d;const c=VY(u,n);return a(u,c),c}return function(){return s(UY.apply(null,arguments))}}const yr=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},V3=/^\[(?:([a-z-]+):)?(.+)\]$/i,GY=/^\d+\/\d+$/,qY=new Set(["px","full","screen"]),KY=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,YY=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,XY=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,ZY=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,QY=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,il=e=>tm(e)||qY.has(e)||GY.test(e),ql=e=>sf(e,"length",iX),tm=e=>!!e&&!Number.isNaN(Number(e)),GN=e=>sf(e,"number",tm),Wg=e=>!!e&&Number.isInteger(Number(e)),JY=e=>e.endsWith("%")&&tm(e.slice(0,-1)),rn=e=>V3.test(e),Kl=e=>KY.test(e),eX=new Set(["length","size","percentage"]),tX=e=>sf(e,eX,U3),nX=e=>sf(e,"position",U3),rX=new Set(["image","url"]),aX=e=>sf(e,rX,lX),sX=e=>sf(e,"",oX),Vg=()=>!0,sf=(e,t,n)=>{const r=V3.exec(e);return r?r[1]?typeof t=="string"?r[1]===t:t.has(r[1]):n(r[2]):!1},iX=e=>YY.test(e)&&!XY.test(e),U3=()=>!1,oX=e=>ZY.test(e),lX=e=>QY.test(e),uX=()=>{const e=yr("colors"),t=yr("spacing"),n=yr("blur"),r=yr("brightness"),a=yr("borderColor"),s=yr("borderRadius"),i=yr("borderSpacing"),l=yr("borderWidth"),u=yr("contrast"),d=yr("grayscale"),c=yr("hueRotate"),h=yr("invert"),p=yr("gap"),m=yr("gradientColorStops"),f=yr("gradientColorStopPositions"),g=yr("inset"),x=yr("margin"),y=yr("opacity"),b=yr("padding"),v=yr("saturate"),w=yr("scale"),N=yr("sepia"),S=yr("skew"),C=yr("space"),_=yr("translate"),T=()=>["auto","contain","none"],E=()=>["auto","hidden","clip","visible","scroll"],j=()=>["auto",rn,t],I=()=>[rn,t],D=()=>["",il,ql],F=()=>["auto",tm,rn],P=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],V=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],O=()=>["start","end","center","between","around","evenly","stretch"],L=()=>["","0",rn],q=()=>["auto","avoid","all","avoid-page","page","left","right","column"],U=()=>[tm,rn];return{cacheSize:500,separator:":",theme:{colors:[Vg],spacing:[il,ql],blur:["none","",Kl,rn],brightness:U(),borderColor:[e],borderRadius:["none","","full",Kl,rn],borderSpacing:I(),borderWidth:D(),contrast:U(),grayscale:L(),hueRotate:U(),invert:L(),gap:I(),gradientColorStops:[e],gradientColorStopPositions:[JY,ql],inset:j(),margin:j(),opacity:U(),padding:I(),saturate:U(),scale:U(),sepia:L(),skew:U(),space:I(),translate:I()},classGroups:{aspect:[{aspect:["auto","square","video",rn]}],container:["container"],columns:[{columns:[Kl]}],"break-after":[{"break-after":q()}],"break-before":[{"break-before":q()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...P(),rn]}],overflow:[{overflow:E()}],"overflow-x":[{"overflow-x":E()}],"overflow-y":[{"overflow-y":E()}],overscroll:[{overscroll:T()}],"overscroll-x":[{"overscroll-x":T()}],"overscroll-y":[{"overscroll-y":T()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Wg,rn]}],basis:[{basis:j()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",rn]}],grow:[{grow:L()}],shrink:[{shrink:L()}],order:[{order:["first","last","none",Wg,rn]}],"grid-cols":[{"grid-cols":[Vg]}],"col-start-end":[{col:["auto",{span:["full",Wg,rn]},rn]}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":[Vg]}],"row-start-end":[{row:["auto",{span:[Wg,rn]},rn]}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",rn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",rn]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...O()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...O(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...O(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[C]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[C]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",rn,t]}],"min-w":[{"min-w":[rn,t,"min","max","fit"]}],"max-w":[{"max-w":[rn,t,"none","full","min","max","fit","prose",{screen:[Kl]},Kl]}],h:[{h:[rn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[rn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[rn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[rn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Kl,ql]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",GN]}],"font-family":[{font:[Vg]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",rn]}],"line-clamp":[{"line-clamp":["none",tm,GN]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",il,rn]}],"list-image":[{"list-image":["none",rn]}],"list-style-type":[{list:["none","disc","decimal",rn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...V(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",il,ql]}],"underline-offset":[{"underline-offset":["auto",il,rn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",rn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",rn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...P(),nX]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",tX]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},aX]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[f]}],"gradient-via-pos":[{via:[f]}],"gradient-to-pos":[{to:[f]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...V(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:V()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...V()]}],"outline-offset":[{"outline-offset":[il,rn]}],"outline-w":[{outline:[il,ql]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:D()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[il,ql]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Kl,sX]}],"shadow-color":[{shadow:[Vg]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",Kl,rn]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[h]}],saturate:[{saturate:[v]}],sepia:[{sepia:[N]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[N]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",rn]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",rn]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",rn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[Wg,rn]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",rn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",rn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",rn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[il,ql,GN]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},cX=HY(uX);function Ie(...e){return cX(v3(e))}function dX(e){if(!e)return"";const t=new Date(e),n=String(t.getDate()).padStart(2,"0"),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],s=t.getFullYear(),i=t.getHours(),l=String(t.getMinutes()).padStart(2,"0"),u=i>=12?"PM":"AM",d=i%12||12;return`${n} ${a} ${s}, ${String(d).padStart(2,"0")}:${l} ${u}`}const Jb=dX;function hX(e){if(!e)return"";const t=new Date(e),n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${a}T${s}:${i}`}const _R=hX,pX=PK,H3=k.forwardRef(({className:e,...t},n)=>o.jsx(zP,{ref:n,className:Ie("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));H3.displayName=zP.displayName;const mX=L0("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),G3=k.forwardRef(({className:e,variant:t,...n},r)=>o.jsx(BP,{ref:r,className:Ie(mX({variant:t}),e),...n}));G3.displayName=BP.displayName;const fX=k.forwardRef(({className:e,...t},n)=>o.jsx(WP,{ref:n,className:Ie("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));fX.displayName=WP.displayName;const q3=k.forwardRef(({className:e,...t},n)=>o.jsx(VP,{ref:n,className:Ie("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:o.jsx(Mo,{className:"h-4 w-4"})}));q3.displayName=VP.displayName;const K3=k.forwardRef(({className:e,...t},n)=>o.jsx(UP,{ref:n,className:Ie("text-sm font-semibold",e),...t}));K3.displayName=UP.displayName;const Y3=k.forwardRef(({className:e,...t},n)=>o.jsx(HP,{ref:n,className:Ie("text-sm opacity-90",e),...t}));Y3.displayName=HP.displayName;function gX(){const{toasts:e}=iY();return o.jsxs(pX,{children:[e.map(function({id:t,title:n,description:r,action:a,...s}){return o.jsxs(G3,{...s,children:[o.jsxs("div",{className:"grid gap-1",children:[n&&o.jsx(K3,{children:n}),r&&o.jsx(Y3,{children:r})]}),a,o.jsx(q3,{})]},t)}),o.jsx(H3,{})]})}var IR=["light","dark"],xX="(prefers-color-scheme: dark)",yX=k.createContext(void 0),bX={setTheme:e=>{},themes:[]},vX=()=>{var e;return(e=k.useContext(yX))!=null?e:bX};k.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:r,enableColorScheme:a,defaultTheme:s,value:i,attrs:l,nonce:u})=>{let d=s==="system",c=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(f=>`'${f}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,h=a?IR.includes(s)&&s?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${s}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",p=(f,g=!1,x=!0)=>{let y=i?i[f]:f,b=g?f+"|| ''":`'${y}'`,v="";return a&&x&&!g&&IR.includes(f)&&(v+=`d.style.colorScheme = '${f}';`),n==="class"?g||y?v+=`c.add(${b})`:v+="null":y&&(v+=`d[s](n,${b})`),v},m=e?`!function(){${c}${p(e)}}()`:r?`!function(){try{${c}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${d})){var t='${xX}',m=window.matchMedia(t);if(m.media!==t||m.matches){${p("dark")}}else{${p("light")}}}else if(e){${i?`var x=${JSON.stringify(i)};`:""}${p(i?"x[e]":"e",!0)}}${d?"":"else{"+p(s,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${c}var e=localStorage.getItem('${t}');if(e){${i?`var x=${JSON.stringify(i)};`:""}${p(i?"x[e]":"e",!0)}}else{${p(s,!1,!1)};}${h}}catch(t){}}();`;return k.createElement("script",{nonce:u,dangerouslySetInnerHTML:{__html:m}})});var wX=e=>{switch(e){case"success":return SX;case"info":return _X;case"warning":return CX;case"error":return IX;default:return null}},NX=Array(12).fill(0),kX=({visible:e,className:t})=>ge.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},ge.createElement("div",{className:"sonner-spinner"},NX.map((n,r)=>ge.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),SX=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),CX=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),_X=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),IX=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ge.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),TX=ge.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ge.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ge.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),EX=()=>{let[e,t]=ge.useState(document.hidden);return ge.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},jS=1,jX=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let n=this.subscribers.indexOf(t);this.subscribers.splice(n,1)}),this.publish=t=>{this.subscribers.forEach(n=>n(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var n;let{message:r,...a}=t,s=typeof(t==null?void 0:t.id)=="number"||((n=t.id)==null?void 0:n.length)>0?t.id:jS++,i=this.toasts.find(u=>u.id===s),l=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),i?this.toasts=this.toasts.map(u=>u.id===s?(this.publish({...u,...t,id:s,title:r}),{...u,...t,id:s,dismissible:l,title:r}):u):this.addToast({title:r,...a,dismissible:l,id:s}),s},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:t,dismiss:!0})),t),this.message=(t,n)=>this.create({...n,message:t}),this.error=(t,n)=>this.create({...n,message:t,type:"error"}),this.success=(t,n)=>this.create({...n,type:"success",message:t}),this.info=(t,n)=>this.create({...n,type:"info",message:t}),this.warning=(t,n)=>this.create({...n,type:"warning",message:t}),this.loading=(t,n)=>this.create({...n,type:"loading",message:t}),this.promise=(t,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:t,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let a=t instanceof Promise?t:t(),s=r!==void 0,i,l=a.then(async d=>{if(i=["resolve",d],ge.isValidElement(d))s=!1,this.create({id:r,type:"default",message:d});else if(RX(d)&&!d.ok){s=!1;let c=typeof n.error=="function"?await n.error(`HTTP error! status: ${d.status}`):n.error,h=typeof n.description=="function"?await n.description(`HTTP error! status: ${d.status}`):n.description;this.create({id:r,type:"error",message:c,description:h})}else if(n.success!==void 0){s=!1;let c=typeof n.success=="function"?await n.success(d):n.success,h=typeof n.description=="function"?await n.description(d):n.description;this.create({id:r,type:"success",message:c,description:h})}}).catch(async d=>{if(i=["reject",d],n.error!==void 0){s=!1;let c=typeof n.error=="function"?await n.error(d):n.error,h=typeof n.description=="function"?await n.description(d):n.description;this.create({id:r,type:"error",message:c,description:h})}}).finally(()=>{var d;s&&(this.dismiss(r),r=void 0),(d=n.finally)==null||d.call(n)}),u=()=>new Promise((d,c)=>l.then(()=>i[0]==="reject"?c(i[1]):d(i[1])).catch(c));return typeof r!="string"&&typeof r!="number"?{unwrap:u}:Object.assign(r,{unwrap:u})},this.custom=(t,n)=>{let r=(n==null?void 0:n.id)||jS++;return this.create({jsx:t(r),id:r,...n}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},_s=new jX,AX=(e,t)=>{let n=(t==null?void 0:t.id)||jS++;return _s.addToast({title:e,...t,id:n}),n},RX=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",DX=AX,MX=()=>_s.toasts,$X=()=>_s.getActiveToasts(),yt=Object.assign(DX,{success:_s.success,info:_s.info,warning:_s.warning,error:_s.error,custom:_s.custom,message:_s.message,promise:_s.promise,dismiss:_s.dismiss,loading:_s.loading},{getHistory:MX,getToasts:$X});function FX(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}FX(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function ev(e){return e.label!==void 0}var PX=3,OX="32px",LX="16px",TR=4e3,zX=356,BX=14,WX=20,VX=200;function Pi(...e){return e.filter(Boolean).join(" ")}function UX(e){let[t,n]=e.split("-"),r=[];return t&&r.push(t),n&&r.push(n),r}var HX=e=>{var t,n,r,a,s,i,l,u,d,c,h;let{invert:p,toast:m,unstyled:f,interacting:g,setHeights:x,visibleToasts:y,heights:b,index:v,toasts:w,expanded:N,removeToast:S,defaultRichColors:C,closeButton:_,style:T,cancelButtonStyle:E,actionButtonStyle:j,className:I="",descriptionClassName:D="",duration:F,position:P,gap:V,loadingIcon:$,expandByDefault:O,classNames:L,icons:q,closeButtonAriaLabel:U="Close toast",pauseWhenPageIsHidden:ee}=e,[M,G]=ge.useState(null),[J,ve]=ge.useState(null),[Q,se]=ge.useState(!1),[_e,Le]=ge.useState(!1),[Se,ye]=ge.useState(!1),[Fe,Te]=ge.useState(!1),[Oe,He]=ge.useState(!1),[Ee,Re]=ge.useState(0),[Ke,at]=ge.useState(0),Y=ge.useRef(m.duration||F||TR),ae=ge.useRef(null),we=ge.useRef(null),Ce=v===0,Ne=v+1<=y,he=m.type,Ae=m.dismissible!==!1,gt=m.className||"",ht=m.descriptionClassName||"",Dt=ge.useMemo(()=>b.findIndex(ot=>ot.toastId===m.id)||0,[b,m.id]),$t=ge.useMemo(()=>{var ot;return(ot=m.closeButton)!=null?ot:_},[m.closeButton,_]),qe=ge.useMemo(()=>m.duration||F||TR,[m.duration,F]),it=ge.useRef(0),Ct=ge.useRef(0),pt=ge.useRef(0),Ut=ge.useRef(null),[Ln,bt]=P.split("-"),Ot=ge.useMemo(()=>b.reduce((ot,pe,Me)=>Me>=Dt?ot:ot+pe.height,0),[b,Dt]),Et=EX(),Lt=m.invert||p,At=he==="loading";Ct.current=ge.useMemo(()=>Dt*V+Ot,[Dt,Ot]),ge.useEffect(()=>{Y.current=qe},[qe]),ge.useEffect(()=>{se(!0)},[]),ge.useEffect(()=>{let ot=we.current;if(ot){let pe=ot.getBoundingClientRect().height;return at(pe),x(Me=>[{toastId:m.id,height:pe,position:m.position},...Me]),()=>x(Me=>Me.filter(Je=>Je.toastId!==m.id))}},[x,m.id]),ge.useLayoutEffect(()=>{if(!Q)return;let ot=we.current,pe=ot.style.height;ot.style.height="auto";let Me=ot.getBoundingClientRect().height;ot.style.height=pe,at(Me),x(Je=>Je.find(ze=>ze.toastId===m.id)?Je.map(ze=>ze.toastId===m.id?{...ze,height:Me}:ze):[{toastId:m.id,height:Me,position:m.position},...Je])},[Q,m.title,m.description,x,m.id]);let zt=ge.useCallback(()=>{Le(!0),Re(Ct.current),x(ot=>ot.filter(pe=>pe.toastId!==m.id)),setTimeout(()=>{S(m)},VX)},[m,S,x,Ct]);ge.useEffect(()=>{if(m.promise&&he==="loading"||m.duration===1/0||m.type==="loading")return;let ot;return N||g||ee&&Et?(()=>{if(pt.current<it.current){let pe=new Date().getTime()-it.current;Y.current=Y.current-pe}pt.current=new Date().getTime()})():Y.current!==1/0&&(it.current=new Date().getTime(),ot=setTimeout(()=>{var pe;(pe=m.onAutoClose)==null||pe.call(m,m),zt()},Y.current)),()=>clearTimeout(ot)},[N,g,m,he,ee,Et,zt]),ge.useEffect(()=>{m.delete&&zt()},[zt,m.delete]);function Sn(){var ot,pe,Me;return q!=null&&q.loading?ge.createElement("div",{className:Pi(L==null?void 0:L.loader,(ot=m==null?void 0:m.classNames)==null?void 0:ot.loader,"sonner-loader"),"data-visible":he==="loading"},q.loading):$?ge.createElement("div",{className:Pi(L==null?void 0:L.loader,(pe=m==null?void 0:m.classNames)==null?void 0:pe.loader,"sonner-loader"),"data-visible":he==="loading"},$):ge.createElement(kX,{className:Pi(L==null?void 0:L.loader,(Me=m==null?void 0:m.classNames)==null?void 0:Me.loader),visible:he==="loading"})}return ge.createElement("li",{tabIndex:0,ref:we,className:Pi(I,gt,L==null?void 0:L.toast,(t=m==null?void 0:m.classNames)==null?void 0:t.toast,L==null?void 0:L.default,L==null?void 0:L[he],(n=m==null?void 0:m.classNames)==null?void 0:n[he]),"data-sonner-toast":"","data-rich-colors":(r=m.richColors)!=null?r:C,"data-styled":!(m.jsx||m.unstyled||f),"data-mounted":Q,"data-promise":!!m.promise,"data-swiped":Oe,"data-removed":_e,"data-visible":Ne,"data-y-position":Ln,"data-x-position":bt,"data-index":v,"data-front":Ce,"data-swiping":Se,"data-dismissible":Ae,"data-type":he,"data-invert":Lt,"data-swipe-out":Fe,"data-swipe-direction":J,"data-expanded":!!(N||O&&Q),style:{"--index":v,"--toasts-before":v,"--z-index":w.length-v,"--offset":`${_e?Ee:Ct.current}px`,"--initial-height":O?"auto":`${Ke}px`,...T,...m.style},onDragEnd:()=>{ye(!1),G(null),Ut.current=null},onPointerDown:ot=>{At||!Ae||(ae.current=new Date,Re(Ct.current),ot.target.setPointerCapture(ot.pointerId),ot.target.tagName!=="BUTTON"&&(ye(!0),Ut.current={x:ot.clientX,y:ot.clientY}))},onPointerUp:()=>{var ot,pe,Me,Je;if(Fe||!Ae)return;Ut.current=null;let ze=Number(((ot=we.current)==null?void 0:ot.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ft=Number(((pe=we.current)==null?void 0:pe.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Ht=new Date().getTime()-((Me=ae.current)==null?void 0:Me.getTime()),ct=M==="x"?ze:Ft,vt=Math.abs(ct)/Ht;if(Math.abs(ct)>=WX||vt>.11){Re(Ct.current),(Je=m.onDismiss)==null||Je.call(m,m),ve(M==="x"?ze>0?"right":"left":Ft>0?"down":"up"),zt(),Te(!0),He(!1);return}ye(!1),G(null)},onPointerMove:ot=>{var pe,Me,Je,ze;if(!Ut.current||!Ae||((pe=window.getSelection())==null?void 0:pe.toString().length)>0)return;let Ft=ot.clientY-Ut.current.y,Ht=ot.clientX-Ut.current.x,ct=(Me=e.swipeDirections)!=null?Me:UX(P);!M&&(Math.abs(Ht)>1||Math.abs(Ft)>1)&&G(Math.abs(Ht)>Math.abs(Ft)?"x":"y");let vt={x:0,y:0};M==="y"?(ct.includes("top")||ct.includes("bottom"))&&(ct.includes("top")&&Ft<0||ct.includes("bottom")&&Ft>0)&&(vt.y=Ft):M==="x"&&(ct.includes("left")||ct.includes("right"))&&(ct.includes("left")&&Ht<0||ct.includes("right")&&Ht>0)&&(vt.x=Ht),(Math.abs(vt.x)>0||Math.abs(vt.y)>0)&&He(!0),(Je=we.current)==null||Je.style.setProperty("--swipe-amount-x",`${vt.x}px`),(ze=we.current)==null||ze.style.setProperty("--swipe-amount-y",`${vt.y}px`)}},$t&&!m.jsx?ge.createElement("button",{"aria-label":U,"data-disabled":At,"data-close-button":!0,onClick:At||!Ae?()=>{}:()=>{var ot;zt(),(ot=m.onDismiss)==null||ot.call(m,m)},className:Pi(L==null?void 0:L.closeButton,(a=m==null?void 0:m.classNames)==null?void 0:a.closeButton)},(s=q==null?void 0:q.close)!=null?s:TX):null,m.jsx||k.isValidElement(m.title)?m.jsx?m.jsx:typeof m.title=="function"?m.title():m.title:ge.createElement(ge.Fragment,null,he||m.icon||m.promise?ge.createElement("div",{"data-icon":"",className:Pi(L==null?void 0:L.icon,(i=m==null?void 0:m.classNames)==null?void 0:i.icon)},m.promise||m.type==="loading"&&!m.icon?m.icon||Sn():null,m.type!=="loading"?m.icon||(q==null?void 0:q[he])||wX(he):null):null,ge.createElement("div",{"data-content":"",className:Pi(L==null?void 0:L.content,(l=m==null?void 0:m.classNames)==null?void 0:l.content)},ge.createElement("div",{"data-title":"",className:Pi(L==null?void 0:L.title,(u=m==null?void 0:m.classNames)==null?void 0:u.title)},typeof m.title=="function"?m.title():m.title),m.description?ge.createElement("div",{"data-description":"",className:Pi(D,ht,L==null?void 0:L.description,(d=m==null?void 0:m.classNames)==null?void 0:d.description)},typeof m.description=="function"?m.description():m.description):null),k.isValidElement(m.cancel)?m.cancel:m.cancel&&ev(m.cancel)?ge.createElement("button",{"data-button":!0,"data-cancel":!0,style:m.cancelButtonStyle||E,onClick:ot=>{var pe,Me;ev(m.cancel)&&Ae&&((Me=(pe=m.cancel).onClick)==null||Me.call(pe,ot),zt())},className:Pi(L==null?void 0:L.cancelButton,(c=m==null?void 0:m.classNames)==null?void 0:c.cancelButton)},m.cancel.label):null,k.isValidElement(m.action)?m.action:m.action&&ev(m.action)?ge.createElement("button",{"data-button":!0,"data-action":!0,style:m.actionButtonStyle||j,onClick:ot=>{var pe,Me;ev(m.action)&&((Me=(pe=m.action).onClick)==null||Me.call(pe,ot),!ot.defaultPrevented&&zt())},className:Pi(L==null?void 0:L.actionButton,(h=m==null?void 0:m.classNames)==null?void 0:h.actionButton)},m.action.label):null))};function ER(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function GX(e,t){let n={};return[e,t].forEach((r,a)=>{let s=a===1,i=s?"--mobile-offset":"--offset",l=s?LX:OX;function u(d){["top","right","bottom","left"].forEach(c=>{n[`${i}-${c}`]=typeof d=="number"?`${d}px`:d})}typeof r=="number"||typeof r=="string"?u(r):typeof r=="object"?["top","right","bottom","left"].forEach(d=>{r[d]===void 0?n[`${i}-${d}`]=l:n[`${i}-${d}`]=typeof r[d]=="number"?`${r[d]}px`:r[d]}):u(l)}),n}var qX=k.forwardRef(function(e,t){let{invert:n,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:s,closeButton:i,className:l,offset:u,mobileOffset:d,theme:c="light",richColors:h,duration:p,style:m,visibleToasts:f=PX,toastOptions:g,dir:x=ER(),gap:y=BX,loadingIcon:b,icons:v,containerAriaLabel:w="Notifications",pauseWhenPageIsHidden:N}=e,[S,C]=ge.useState([]),_=ge.useMemo(()=>Array.from(new Set([r].concat(S.filter(ee=>ee.position).map(ee=>ee.position)))),[S,r]),[T,E]=ge.useState([]),[j,I]=ge.useState(!1),[D,F]=ge.useState(!1),[P,V]=ge.useState(c!=="system"?c:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),$=ge.useRef(null),O=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),L=ge.useRef(null),q=ge.useRef(!1),U=ge.useCallback(ee=>{C(M=>{var G;return(G=M.find(J=>J.id===ee.id))!=null&&G.delete||_s.dismiss(ee.id),M.filter(({id:J})=>J!==ee.id)})},[]);return ge.useEffect(()=>_s.subscribe(ee=>{if(ee.dismiss){C(M=>M.map(G=>G.id===ee.id?{...G,delete:!0}:G));return}setTimeout(()=>{XK.flushSync(()=>{C(M=>{let G=M.findIndex(J=>J.id===ee.id);return G!==-1?[...M.slice(0,G),{...M[G],...ee},...M.slice(G+1)]:[ee,...M]})})})}),[]),ge.useEffect(()=>{if(c!=="system"){V(c);return}if(c==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?V("dark"):V("light")),typeof window>"u")return;let ee=window.matchMedia("(prefers-color-scheme: dark)");try{ee.addEventListener("change",({matches:M})=>{V(M?"dark":"light")})}catch{ee.addListener(({matches:G})=>{try{V(G?"dark":"light")}catch(J){console.error(J)}})}},[c]),ge.useEffect(()=>{S.length<=1&&I(!1)},[S]),ge.useEffect(()=>{let ee=M=>{var G,J;a.every(ve=>M[ve]||M.code===ve)&&(I(!0),(G=$.current)==null||G.focus()),M.code==="Escape"&&(document.activeElement===$.current||(J=$.current)!=null&&J.contains(document.activeElement))&&I(!1)};return document.addEventListener("keydown",ee),()=>document.removeEventListener("keydown",ee)},[a]),ge.useEffect(()=>{if($.current)return()=>{L.current&&(L.current.focus({preventScroll:!0}),L.current=null,q.current=!1)}},[$.current]),ge.createElement("section",{ref:t,"aria-label":`${w} ${O}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},_.map((ee,M)=>{var G;let[J,ve]=ee.split("-");return S.length?ge.createElement("ol",{key:ee,dir:x==="auto"?ER():x,tabIndex:-1,ref:$,className:l,"data-sonner-toaster":!0,"data-theme":P,"data-y-position":J,"data-lifted":j&&S.length>1&&!s,"data-x-position":ve,style:{"--front-toast-height":`${((G=T[0])==null?void 0:G.height)||0}px`,"--width":`${zX}px`,"--gap":`${y}px`,...m,...GX(u,d)},onBlur:Q=>{q.current&&!Q.currentTarget.contains(Q.relatedTarget)&&(q.current=!1,L.current&&(L.current.focus({preventScroll:!0}),L.current=null))},onFocus:Q=>{Q.target instanceof HTMLElement&&Q.target.dataset.dismissible==="false"||q.current||(q.current=!0,L.current=Q.relatedTarget)},onMouseEnter:()=>I(!0),onMouseMove:()=>I(!0),onMouseLeave:()=>{D||I(!1)},onDragEnd:()=>I(!1),onPointerDown:Q=>{Q.target instanceof HTMLElement&&Q.target.dataset.dismissible==="false"||F(!0)},onPointerUp:()=>F(!1)},S.filter(Q=>!Q.position&&M===0||Q.position===ee).map((Q,se)=>{var _e,Le;return ge.createElement(HX,{key:Q.id,icons:v,index:se,toast:Q,defaultRichColors:h,duration:(_e=g==null?void 0:g.duration)!=null?_e:p,className:g==null?void 0:g.className,descriptionClassName:g==null?void 0:g.descriptionClassName,invert:n,visibleToasts:f,closeButton:(Le=g==null?void 0:g.closeButton)!=null?Le:i,interacting:D,position:ee,style:g==null?void 0:g.style,unstyled:g==null?void 0:g.unstyled,classNames:g==null?void 0:g.classNames,cancelButtonStyle:g==null?void 0:g.cancelButtonStyle,actionButtonStyle:g==null?void 0:g.actionButtonStyle,removeToast:U,toasts:S.filter(Se=>Se.position==Q.position),heights:T.filter(Se=>Se.position==Q.position),setHeights:E,expandByDefault:s,gap:y,loadingIcon:b,expanded:j,pauseWhenPageIsHidden:N,swipeDirections:e.swipeDirections})})):null}))});const KX=({...e})=>{const{theme:t="system"}=vX();return o.jsx(qX,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},X3=OK,tv=LK,nv=zK,hx=k.forwardRef(({className:e,sideOffset:t=4,...n},r)=>o.jsx(GP,{ref:r,sideOffset:t,className:Ie("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));hx.displayName=GP.displayName;var of=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},YX={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},cu,QC,EP,XX=(EP=class{constructor(){Mt(this,cu,YX);Mt(this,QC,!1)}setTimeoutProvider(e){mt(this,cu,e)}setTimeout(e,t){return ie(this,cu).setTimeout(e,t)}clearTimeout(e){ie(this,cu).clearTimeout(e)}setInterval(e,t){return ie(this,cu).setInterval(e,t)}clearInterval(e){ie(this,cu).clearInterval(e)}},cu=new WeakMap,QC=new WeakMap,EP),Lc=new XX;function ZX(e){setTimeout(e,0)}var hd=typeof window>"u"||"Deno"in globalThis;function is(){}function QX(e,t){return typeof e=="function"?e(t):e}function AS(e){return typeof e=="number"&&e>=0&&e!==1/0}function Z3(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Cu(e,t){return typeof e=="function"?e(t):e}function mi(e,t){return typeof e=="function"?e(t):e}function jR(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:s,queryKey:i,stale:l}=e;if(i){if(r){if(t.queryHash!==u_(i,t.options))return!1}else if(!Gx(t.queryKey,i))return!1}if(n!=="all"){const u=t.isActive();if(n==="active"&&!u||n==="inactive"&&u)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||a&&a!==t.state.fetchStatus||s&&!s(t))}function AR(e,t){const{exact:n,status:r,predicate:a,mutationKey:s}=e;if(s){if(!t.options.mutationKey)return!1;if(n){if(pd(t.options.mutationKey)!==pd(s))return!1}else if(!Gx(t.options.mutationKey,s))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function u_(e,t){return((t==null?void 0:t.queryKeyHashFn)||pd)(e)}function pd(e){return JSON.stringify(e,(t,n)=>RS(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function Gx(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Gx(e[n],t[n])):!1}var JX=Object.prototype.hasOwnProperty;function Q3(e,t){if(e===t)return e;const n=RR(e)&&RR(t);if(!n&&!(RS(e)&&RS(t)))return t;const a=(n?e:Object.keys(e)).length,s=n?t:Object.keys(t),i=s.length,l=n?new Array(i):{};let u=0;for(let d=0;d<i;d++){const c=n?d:s[d],h=e[c],p=t[c];if(h===p){l[c]=h,(n?d<a:JX.call(e,c))&&u++;continue}if(h===null||p===null||typeof h!="object"||typeof p!="object"){l[c]=p;continue}const m=Q3(h,p);l[c]=m,m===h&&u++}return a===i&&u===a?e:l}function mw(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function RR(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function RS(e){if(!DR(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!DR(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function DR(e){return Object.prototype.toString.call(e)==="[object Object]"}function eZ(e){return new Promise(t=>{Lc.setTimeout(t,e)})}function DS(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?Q3(e,t):t}function tZ(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function nZ(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var c_=Symbol();function J3(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===c_?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function d_(e,t){return typeof e=="function"?e(...t):!!e}function rZ(e,t,n){let r=!1,a;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(a??(a=t()),r||(r=!0,a.aborted?n():a.addEventListener("abort",n,{once:!0})),a)}),e}var Gc,du,dm,jP,aZ=(jP=class extends of{constructor(){super();Mt(this,Gc);Mt(this,du);Mt(this,dm);mt(this,dm,t=>{if(!hd&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){ie(this,du)||this.setEventListener(ie(this,dm))}onUnsubscribe(){var t;this.hasListeners()||((t=ie(this,du))==null||t.call(this),mt(this,du,void 0))}setEventListener(t){var n;mt(this,dm,t),(n=ie(this,du))==null||n.call(this),mt(this,du,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){ie(this,Gc)!==t&&(mt(this,Gc,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof ie(this,Gc)=="boolean"?ie(this,Gc):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Gc=new WeakMap,du=new WeakMap,dm=new WeakMap,jP),h_=new aZ;function MS(){let e,t;const n=new Promise((a,s)=>{e=a,t=s});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),e(a)},n.reject=a=>{r({status:"rejected",reason:a}),t(a)},n}var sZ=ZX;function iZ(){let e=[],t=0,n=l=>{l()},r=l=>{l()},a=sZ;const s=l=>{t?e.push(l):a(()=>{n(l)})},i=()=>{const l=e;e=[],l.length&&a(()=>{r(()=>{l.forEach(u=>{n(u)})})})};return{batch:l=>{let u;t++;try{u=l()}finally{t--,t||i()}return u},batchCalls:l=>(...u)=>{s(()=>{l(...u)})},schedule:s,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{a=l}}}var da=iZ(),hm,hu,pm,AP,oZ=(AP=class extends of{constructor(){super();Mt(this,hm,!0);Mt(this,hu);Mt(this,pm);mt(this,pm,t=>{if(!hd&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){ie(this,hu)||this.setEventListener(ie(this,pm))}onUnsubscribe(){var t;this.hasListeners()||((t=ie(this,hu))==null||t.call(this),mt(this,hu,void 0))}setEventListener(t){var n;mt(this,pm,t),(n=ie(this,hu))==null||n.call(this),mt(this,hu,t(this.setOnline.bind(this)))}setOnline(t){ie(this,hm)!==t&&(mt(this,hm,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return ie(this,hm)}},hm=new WeakMap,hu=new WeakMap,pm=new WeakMap,AP),fw=new oZ;function lZ(e){return Math.min(1e3*2**e,3e4)}function eO(e){return(e??"online")==="online"?fw.isOnline():!0}var $S=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function tO(e){let t=!1,n=0,r;const a=MS(),s=()=>a.status!=="pending",i=g=>{var x;if(!s()){const y=new $S(g);p(y),(x=e.onCancel)==null||x.call(e,y)}},l=()=>{t=!0},u=()=>{t=!1},d=()=>h_.isFocused()&&(e.networkMode==="always"||fw.isOnline())&&e.canRun(),c=()=>eO(e.networkMode)&&e.canRun(),h=g=>{s()||(r==null||r(),a.resolve(g))},p=g=>{s()||(r==null||r(),a.reject(g))},m=()=>new Promise(g=>{var x;r=y=>{(s()||d())&&g(y)},(x=e.onPause)==null||x.call(e)}).then(()=>{var g;r=void 0,s()||(g=e.onContinue)==null||g.call(e)}),f=()=>{if(s())return;let g;const x=n===0?e.initialPromise:void 0;try{g=x??e.fn()}catch(y){g=Promise.reject(y)}Promise.resolve(g).then(h).catch(y=>{var S;if(s())return;const b=e.retry??(hd?0:3),v=e.retryDelay??lZ,w=typeof v=="function"?v(n,y):v,N=b===!0||typeof b=="number"&&n<b||typeof b=="function"&&b(n,y);if(t||!N){p(y);return}n++,(S=e.onFail)==null||S.call(e,n,y),eZ(w).then(()=>d()?void 0:m()).then(()=>{t?p(y):f()})})};return{promise:a,status:()=>a.status,cancel:i,continue:()=>(r==null||r(),a),cancelRetry:l,continueRetry:u,canStart:c,start:()=>(c()?f():m().then(f),a)}}var qc,RP,nO=(RP=class{constructor(){Mt(this,qc)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),AS(this.gcTime)&&mt(this,qc,Lc.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(hd?1/0:5*60*1e3))}clearGcTimeout(){ie(this,qc)&&(Lc.clearTimeout(ie(this,qc)),mt(this,qc,void 0))}},qc=new WeakMap,RP),Kc,mm,di,Yc,Ca,_y,Xc,Hi,ul,DP,uZ=(DP=class extends nO{constructor(t){super();Mt(this,Hi);Mt(this,Kc);Mt(this,mm);Mt(this,di);Mt(this,Yc);Mt(this,Ca);Mt(this,_y);Mt(this,Xc);mt(this,Xc,!1),mt(this,_y,t.defaultOptions),this.setOptions(t.options),this.observers=[],mt(this,Yc,t.client),mt(this,di,ie(this,Yc).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,mt(this,Kc,$R(this.options)),this.state=t.state??ie(this,Kc),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=ie(this,Ca))==null?void 0:t.promise}setOptions(t){if(this.options={...ie(this,_y),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=$R(this.options);n.data!==void 0&&(this.setState(MR(n.data,n.dataUpdatedAt)),mt(this,Kc,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ie(this,di).remove(this)}setData(t,n){const r=DS(this.state.data,t,this.options);return un(this,Hi,ul).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){un(this,Hi,ul).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,a;const n=(r=ie(this,Ca))==null?void 0:r.promise;return(a=ie(this,Ca))==null||a.cancel(t),n?n.then(is).catch(is):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ie(this,Kc))}isActive(){return this.observers.some(t=>mi(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===c_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Cu(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Z3(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=ie(this,Ca))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=ie(this,Ca))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),ie(this,di).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(ie(this,Ca)&&(ie(this,Xc)?ie(this,Ca).cancel({revert:!0}):ie(this,Ca).cancelRetry()),this.scheduleGc()),ie(this,di).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||un(this,Hi,ul).call(this,{type:"invalidate"})}async fetch(t,n){var u,d,c,h,p,m,f,g,x,y,b,v;if(this.state.fetchStatus!=="idle"&&((u=ie(this,Ca))==null?void 0:u.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(ie(this,Ca))return ie(this,Ca).continueRetry(),ie(this,Ca).promise}if(t&&this.setOptions(t),!this.options.queryFn){const w=this.observers.find(N=>N.options.queryFn);w&&this.setOptions(w.options)}const r=new AbortController,a=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(mt(this,Xc,!0),r.signal)})},s=()=>{const w=J3(this.options,n),S=(()=>{const C={client:ie(this,Yc),queryKey:this.queryKey,meta:this.meta};return a(C),C})();return mt(this,Xc,!1),this.options.persister?this.options.persister(w,S,this):w(S)},l=(()=>{const w={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:ie(this,Yc),state:this.state,fetchFn:s};return a(w),w})();(d=this.options.behavior)==null||d.onFetch(l,this),mt(this,mm,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((c=l.fetchOptions)==null?void 0:c.meta))&&un(this,Hi,ul).call(this,{type:"fetch",meta:(h=l.fetchOptions)==null?void 0:h.meta}),mt(this,Ca,tO({initialPromise:n==null?void 0:n.initialPromise,fn:l.fetchFn,onCancel:w=>{w instanceof $S&&w.revert&&this.setState({...ie(this,mm),fetchStatus:"idle"}),r.abort()},onFail:(w,N)=>{un(this,Hi,ul).call(this,{type:"failed",failureCount:w,error:N})},onPause:()=>{un(this,Hi,ul).call(this,{type:"pause"})},onContinue:()=>{un(this,Hi,ul).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const w=await ie(this,Ca).start();if(w===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(w),(m=(p=ie(this,di).config).onSuccess)==null||m.call(p,w,this),(g=(f=ie(this,di).config).onSettled)==null||g.call(f,w,this.state.error,this),w}catch(w){if(w instanceof $S){if(w.silent)return ie(this,Ca).promise;if(w.revert){if(this.state.data===void 0)throw w;return this.state.data}}throw un(this,Hi,ul).call(this,{type:"error",error:w}),(y=(x=ie(this,di).config).onError)==null||y.call(x,w,this),(v=(b=ie(this,di).config).onSettled)==null||v.call(b,this.state.data,w,this),w}finally{this.scheduleGc()}}},Kc=new WeakMap,mm=new WeakMap,di=new WeakMap,Yc=new WeakMap,Ca=new WeakMap,_y=new WeakMap,Xc=new WeakMap,Hi=new WeakSet,ul=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...rO(r.data,this.options),fetchMeta:t.meta??null};case"success":const a={...r,...MR(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return mt(this,mm,t.manual?a:void 0),a;case"error":const s=t.error;return{...r,error:s,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),da.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),ie(this,di).notify({query:this,type:"updated",action:t})})},DP);function rO(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:eO(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function MR(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function $R(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var ks,_n,Iy,rs,Zc,fm,pl,pu,Ty,gm,xm,Qc,Jc,mu,ym,Yn,px,FS,PS,OS,LS,zS,BS,WS,aO,MP,cZ=(MP=class extends of{constructor(t,n){super();Mt(this,Yn);Mt(this,ks);Mt(this,_n);Mt(this,Iy);Mt(this,rs);Mt(this,Zc);Mt(this,fm);Mt(this,pl);Mt(this,pu);Mt(this,Ty);Mt(this,gm);Mt(this,xm);Mt(this,Qc);Mt(this,Jc);Mt(this,mu);Mt(this,ym,new Set);this.options=n,mt(this,ks,t),mt(this,pu,null),mt(this,pl,MS()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(ie(this,_n).addObserver(this),FR(ie(this,_n),this.options)?un(this,Yn,px).call(this):this.updateResult(),un(this,Yn,LS).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return VS(ie(this,_n),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return VS(ie(this,_n),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,un(this,Yn,zS).call(this),un(this,Yn,BS).call(this),ie(this,_n).removeObserver(this)}setOptions(t){const n=this.options,r=ie(this,_n);if(this.options=ie(this,ks).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof mi(this.options.enabled,ie(this,_n))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");un(this,Yn,WS).call(this),ie(this,_n).setOptions(this.options),n._defaulted&&!mw(this.options,n)&&ie(this,ks).getQueryCache().notify({type:"observerOptionsUpdated",query:ie(this,_n),observer:this});const a=this.hasListeners();a&&PR(ie(this,_n),r,this.options,n)&&un(this,Yn,px).call(this),this.updateResult(),a&&(ie(this,_n)!==r||mi(this.options.enabled,ie(this,_n))!==mi(n.enabled,ie(this,_n))||Cu(this.options.staleTime,ie(this,_n))!==Cu(n.staleTime,ie(this,_n)))&&un(this,Yn,FS).call(this);const s=un(this,Yn,PS).call(this);a&&(ie(this,_n)!==r||mi(this.options.enabled,ie(this,_n))!==mi(n.enabled,ie(this,_n))||s!==ie(this,mu))&&un(this,Yn,OS).call(this,s)}getOptimisticResult(t){const n=ie(this,ks).getQueryCache().build(ie(this,ks),t),r=this.createResult(n,t);return hZ(this,r)&&(mt(this,rs,r),mt(this,fm,this.options),mt(this,Zc,ie(this,_n).state)),r}getCurrentResult(){return ie(this,rs)}trackResult(t,n){return new Proxy(t,{get:(r,a)=>(this.trackProp(a),n==null||n(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&ie(this,pl).status==="pending"&&ie(this,pl).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,a))})}trackProp(t){ie(this,ym).add(t)}getCurrentQuery(){return ie(this,_n)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=ie(this,ks).defaultQueryOptions(t),r=ie(this,ks).getQueryCache().build(ie(this,ks),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(t){return un(this,Yn,px).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),ie(this,rs)))}createResult(t,n){var T;const r=ie(this,_n),a=this.options,s=ie(this,rs),i=ie(this,Zc),l=ie(this,fm),d=t!==r?t.state:ie(this,Iy),{state:c}=t;let h={...c},p=!1,m;if(n._optimisticResults){const E=this.hasListeners(),j=!E&&FR(t,n),I=E&&PR(t,r,n,a);(j||I)&&(h={...h,...rO(c.data,t.options)}),n._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:f,errorUpdatedAt:g,status:x}=h;m=h.data;let y=!1;if(n.placeholderData!==void 0&&m===void 0&&x==="pending"){let E;s!=null&&s.isPlaceholderData&&n.placeholderData===(l==null?void 0:l.placeholderData)?(E=s.data,y=!0):E=typeof n.placeholderData=="function"?n.placeholderData((T=ie(this,xm))==null?void 0:T.state.data,ie(this,xm)):n.placeholderData,E!==void 0&&(x="success",m=DS(s==null?void 0:s.data,E,n),p=!0)}if(n.select&&m!==void 0&&!y)if(s&&m===(i==null?void 0:i.data)&&n.select===ie(this,Ty))m=ie(this,gm);else try{mt(this,Ty,n.select),m=n.select(m),m=DS(s==null?void 0:s.data,m,n),mt(this,gm,m),mt(this,pu,null)}catch(E){mt(this,pu,E)}ie(this,pu)&&(f=ie(this,pu),m=ie(this,gm),g=Date.now(),x="error");const b=h.fetchStatus==="fetching",v=x==="pending",w=x==="error",N=v&&b,S=m!==void 0,_={status:x,fetchStatus:h.fetchStatus,isPending:v,isSuccess:x==="success",isError:w,isInitialLoading:N,isLoading:N,data:m,dataUpdatedAt:h.dataUpdatedAt,error:f,errorUpdatedAt:g,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>d.dataUpdateCount||h.errorUpdateCount>d.errorUpdateCount,isFetching:b,isRefetching:b&&!v,isLoadingError:w&&!S,isPaused:h.fetchStatus==="paused",isPlaceholderData:p,isRefetchError:w&&S,isStale:p_(t,n),refetch:this.refetch,promise:ie(this,pl),isEnabled:mi(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const E=D=>{_.status==="error"?D.reject(_.error):_.data!==void 0&&D.resolve(_.data)},j=()=>{const D=mt(this,pl,_.promise=MS());E(D)},I=ie(this,pl);switch(I.status){case"pending":t.queryHash===r.queryHash&&E(I);break;case"fulfilled":(_.status==="error"||_.data!==I.value)&&j();break;case"rejected":(_.status!=="error"||_.error!==I.reason)&&j();break}}return _}updateResult(){const t=ie(this,rs),n=this.createResult(ie(this,_n),this.options);if(mt(this,Zc,ie(this,_n).state),mt(this,fm,this.options),ie(this,Zc).data!==void 0&&mt(this,xm,ie(this,_n)),mw(n,t))return;mt(this,rs,n);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,s=typeof a=="function"?a():a;if(s==="all"||!s&&!ie(this,ym).size)return!0;const i=new Set(s??ie(this,ym));return this.options.throwOnError&&i.add("error"),Object.keys(ie(this,rs)).some(l=>{const u=l;return ie(this,rs)[u]!==t[u]&&i.has(u)})};un(this,Yn,aO).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&un(this,Yn,LS).call(this)}},ks=new WeakMap,_n=new WeakMap,Iy=new WeakMap,rs=new WeakMap,Zc=new WeakMap,fm=new WeakMap,pl=new WeakMap,pu=new WeakMap,Ty=new WeakMap,gm=new WeakMap,xm=new WeakMap,Qc=new WeakMap,Jc=new WeakMap,mu=new WeakMap,ym=new WeakMap,Yn=new WeakSet,px=function(t){un(this,Yn,WS).call(this);let n=ie(this,_n).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(is)),n},FS=function(){un(this,Yn,zS).call(this);const t=Cu(this.options.staleTime,ie(this,_n));if(hd||ie(this,rs).isStale||!AS(t))return;const r=Z3(ie(this,rs).dataUpdatedAt,t)+1;mt(this,Qc,Lc.setTimeout(()=>{ie(this,rs).isStale||this.updateResult()},r))},PS=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(ie(this,_n)):this.options.refetchInterval)??!1},OS=function(t){un(this,Yn,BS).call(this),mt(this,mu,t),!(hd||mi(this.options.enabled,ie(this,_n))===!1||!AS(ie(this,mu))||ie(this,mu)===0)&&mt(this,Jc,Lc.setInterval(()=>{(this.options.refetchIntervalInBackground||h_.isFocused())&&un(this,Yn,px).call(this)},ie(this,mu)))},LS=function(){un(this,Yn,FS).call(this),un(this,Yn,OS).call(this,un(this,Yn,PS).call(this))},zS=function(){ie(this,Qc)&&(Lc.clearTimeout(ie(this,Qc)),mt(this,Qc,void 0))},BS=function(){ie(this,Jc)&&(Lc.clearInterval(ie(this,Jc)),mt(this,Jc,void 0))},WS=function(){const t=ie(this,ks).getQueryCache().build(ie(this,ks),this.options);if(t===ie(this,_n))return;const n=ie(this,_n);mt(this,_n,t),mt(this,Iy,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},aO=function(t){da.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(ie(this,rs))}),ie(this,ks).getQueryCache().notify({query:ie(this,_n),type:"observerResultsUpdated"})})},MP);function dZ(e,t){return mi(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function FR(e,t){return dZ(e,t)||e.state.data!==void 0&&VS(e,t,t.refetchOnMount)}function VS(e,t,n){if(mi(t.enabled,e)!==!1&&Cu(t.staleTime,e)!=="static"){const r=typeof n=="function"?n(e):n;return r==="always"||r!==!1&&p_(e,t)}return!1}function PR(e,t,n,r){return(e!==t||mi(r.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&p_(e,n)}function p_(e,t){return mi(t.enabled,e)!==!1&&e.isStaleByTime(Cu(t.staleTime,e))}function hZ(e,t){return!mw(e.getCurrentResult(),t)}function OR(e){return{onFetch:(t,n)=>{var c,h,p,m,f;const r=t.options,a=(p=(h=(c=t.fetchOptions)==null?void 0:c.meta)==null?void 0:h.fetchMore)==null?void 0:p.direction,s=((m=t.state.data)==null?void 0:m.pages)||[],i=((f=t.state.data)==null?void 0:f.pageParams)||[];let l={pages:[],pageParams:[]},u=0;const d=async()=>{let g=!1;const x=v=>{rZ(v,()=>t.signal,()=>g=!0)},y=J3(t.options,t.fetchOptions),b=async(v,w,N)=>{if(g)return Promise.reject();if(w==null&&v.pages.length)return Promise.resolve(v);const C=(()=>{const j={client:t.client,queryKey:t.queryKey,pageParam:w,direction:N?"backward":"forward",meta:t.options.meta};return x(j),j})(),_=await y(C),{maxPages:T}=t.options,E=N?nZ:tZ;return{pages:E(v.pages,_,T),pageParams:E(v.pageParams,w,T)}};if(a&&s.length){const v=a==="backward",w=v?pZ:LR,N={pages:s,pageParams:i},S=w(r,N);l=await b(N,S,v)}else{const v=e??s.length;do{const w=u===0?i[0]??r.initialPageParam:LR(r,l);if(u>0&&w==null)break;l=await b(l,w),u++}while(u<v)}return l};t.options.persister?t.fetchFn=()=>{var g,x;return(x=(g=t.options).persister)==null?void 0:x.call(g,d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=d}}}function LR(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function pZ(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var Ey,wo,as,ed,No,Ql,$P,mZ=($P=class extends nO{constructor(t){super();Mt(this,No);Mt(this,Ey);Mt(this,wo);Mt(this,as);Mt(this,ed);mt(this,Ey,t.client),this.mutationId=t.mutationId,mt(this,as,t.mutationCache),mt(this,wo,[]),this.state=t.state||sO(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){ie(this,wo).includes(t)||(ie(this,wo).push(t),this.clearGcTimeout(),ie(this,as).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){mt(this,wo,ie(this,wo).filter(n=>n!==t)),this.scheduleGc(),ie(this,as).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){ie(this,wo).length||(this.state.status==="pending"?this.scheduleGc():ie(this,as).remove(this))}continue(){var t;return((t=ie(this,ed))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var i,l,u,d,c,h,p,m,f,g,x,y,b,v,w,N,S,C,_,T;const n=()=>{un(this,No,Ql).call(this,{type:"continue"})},r={client:ie(this,Ey),meta:this.options.meta,mutationKey:this.options.mutationKey};mt(this,ed,tO({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(E,j)=>{un(this,No,Ql).call(this,{type:"failed",failureCount:E,error:j})},onPause:()=>{un(this,No,Ql).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ie(this,as).canRun(this)}));const a=this.state.status==="pending",s=!ie(this,ed).canStart();try{if(a)n();else{un(this,No,Ql).call(this,{type:"pending",variables:t,isPaused:s}),await((l=(i=ie(this,as).config).onMutate)==null?void 0:l.call(i,t,this,r));const j=await((d=(u=this.options).onMutate)==null?void 0:d.call(u,t,r));j!==this.state.context&&un(this,No,Ql).call(this,{type:"pending",context:j,variables:t,isPaused:s})}const E=await ie(this,ed).start();return await((h=(c=ie(this,as).config).onSuccess)==null?void 0:h.call(c,E,t,this.state.context,this,r)),await((m=(p=this.options).onSuccess)==null?void 0:m.call(p,E,t,this.state.context,r)),await((g=(f=ie(this,as).config).onSettled)==null?void 0:g.call(f,E,null,this.state.variables,this.state.context,this,r)),await((y=(x=this.options).onSettled)==null?void 0:y.call(x,E,null,t,this.state.context,r)),un(this,No,Ql).call(this,{type:"success",data:E}),E}catch(E){try{await((v=(b=ie(this,as).config).onError)==null?void 0:v.call(b,E,t,this.state.context,this,r))}catch(j){Promise.reject(j)}try{await((N=(w=this.options).onError)==null?void 0:N.call(w,E,t,this.state.context,r))}catch(j){Promise.reject(j)}try{await((C=(S=ie(this,as).config).onSettled)==null?void 0:C.call(S,void 0,E,this.state.variables,this.state.context,this,r))}catch(j){Promise.reject(j)}try{await((T=(_=this.options).onSettled)==null?void 0:T.call(_,void 0,E,t,this.state.context,r))}catch(j){Promise.reject(j)}throw un(this,No,Ql).call(this,{type:"error",error:E}),E}finally{ie(this,as).runNext(this)}}},Ey=new WeakMap,wo=new WeakMap,as=new WeakMap,ed=new WeakMap,No=new WeakSet,Ql=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),da.batch(()=>{ie(this,wo).forEach(r=>{r.onMutationUpdate(t)}),ie(this,as).notify({mutation:this,type:"updated",action:t})})},$P);function sO(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ml,Gi,jy,FP,fZ=(FP=class extends of{constructor(t={}){super();Mt(this,ml);Mt(this,Gi);Mt(this,jy);this.config=t,mt(this,ml,new Set),mt(this,Gi,new Map),mt(this,jy,0)}build(t,n,r){const a=new mZ({client:t,mutationCache:this,mutationId:++Zb(this,jy)._,options:t.defaultMutationOptions(n),state:r});return this.add(a),a}add(t){ie(this,ml).add(t);const n=rv(t);if(typeof n=="string"){const r=ie(this,Gi).get(n);r?r.push(t):ie(this,Gi).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(ie(this,ml).delete(t)){const n=rv(t);if(typeof n=="string"){const r=ie(this,Gi).get(n);if(r)if(r.length>1){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}else r[0]===t&&ie(this,Gi).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=rv(t);if(typeof n=="string"){const r=ie(this,Gi).get(n),a=r==null?void 0:r.find(s=>s.state.status==="pending");return!a||a===t}else return!0}runNext(t){var r;const n=rv(t);if(typeof n=="string"){const a=(r=ie(this,Gi).get(n))==null?void 0:r.find(s=>s!==t&&s.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){da.batch(()=>{ie(this,ml).forEach(t=>{this.notify({type:"removed",mutation:t})}),ie(this,ml).clear(),ie(this,Gi).clear()})}getAll(){return Array.from(ie(this,ml))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>AR(n,r))}findAll(t={}){return this.getAll().filter(n=>AR(t,n))}notify(t){da.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return da.batch(()=>Promise.all(t.map(n=>n.continue().catch(is))))}},ml=new WeakMap,Gi=new WeakMap,jy=new WeakMap,FP);function rv(e){var t;return(t=e.options.scope)==null?void 0:t.id}var fl,fu,Ss,gl,kl,Vv,US,PP,gZ=(PP=class extends of{constructor(n,r){super();Mt(this,kl);Mt(this,fl);Mt(this,fu);Mt(this,Ss);Mt(this,gl);mt(this,fl,n),this.setOptions(r),this.bindMethods(),un(this,kl,Vv).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var a;const r=this.options;this.options=ie(this,fl).defaultMutationOptions(n),mw(this.options,r)||ie(this,fl).getMutationCache().notify({type:"observerOptionsUpdated",mutation:ie(this,Ss),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&pd(r.mutationKey)!==pd(this.options.mutationKey)?this.reset():((a=ie(this,Ss))==null?void 0:a.state.status)==="pending"&&ie(this,Ss).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=ie(this,Ss))==null||n.removeObserver(this)}onMutationUpdate(n){un(this,kl,Vv).call(this),un(this,kl,US).call(this,n)}getCurrentResult(){return ie(this,fu)}reset(){var n;(n=ie(this,Ss))==null||n.removeObserver(this),mt(this,Ss,void 0),un(this,kl,Vv).call(this),un(this,kl,US).call(this)}mutate(n,r){var a;return mt(this,gl,r),(a=ie(this,Ss))==null||a.removeObserver(this),mt(this,Ss,ie(this,fl).getMutationCache().build(ie(this,fl),this.options)),ie(this,Ss).addObserver(this),ie(this,Ss).execute(n)}},fl=new WeakMap,fu=new WeakMap,Ss=new WeakMap,gl=new WeakMap,kl=new WeakSet,Vv=function(){var r;const n=((r=ie(this,Ss))==null?void 0:r.state)??sO();mt(this,fu,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},US=function(n){da.batch(()=>{var r,a,s,i,l,u,d,c;if(ie(this,gl)&&this.hasListeners()){const h=ie(this,fu).variables,p=ie(this,fu).context,m={client:ie(this,fl),meta:this.options.meta,mutationKey:this.options.mutationKey};if((n==null?void 0:n.type)==="success"){try{(a=(r=ie(this,gl)).onSuccess)==null||a.call(r,n.data,h,p,m)}catch(f){Promise.reject(f)}try{(i=(s=ie(this,gl)).onSettled)==null||i.call(s,n.data,null,h,p,m)}catch(f){Promise.reject(f)}}else if((n==null?void 0:n.type)==="error"){try{(u=(l=ie(this,gl)).onError)==null||u.call(l,n.error,h,p,m)}catch(f){Promise.reject(f)}try{(c=(d=ie(this,gl)).onSettled)==null||c.call(d,void 0,n.error,h,p,m)}catch(f){Promise.reject(f)}}}this.listeners.forEach(h=>{h(ie(this,fu))})})},PP),ko,OP,xZ=(OP=class extends of{constructor(t={}){super();Mt(this,ko);this.config=t,mt(this,ko,new Map)}build(t,n,r){const a=n.queryKey,s=n.queryHash??u_(a,n);let i=this.get(s);return i||(i=new uZ({client:t,queryKey:a,queryHash:s,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(a)}),this.add(i)),i}add(t){ie(this,ko).has(t.queryHash)||(ie(this,ko).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=ie(this,ko).get(t.queryHash);n&&(t.destroy(),n===t&&ie(this,ko).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){da.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return ie(this,ko).get(t)}getAll(){return[...ie(this,ko).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>jR(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>jR(t,r)):n}notify(t){da.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){da.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){da.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ko=new WeakMap,OP),$r,gu,xu,bm,vm,yu,wm,Nm,LP,yZ=(LP=class{constructor(e={}){Mt(this,$r);Mt(this,gu);Mt(this,xu);Mt(this,bm);Mt(this,vm);Mt(this,yu);Mt(this,wm);Mt(this,Nm);mt(this,$r,e.queryCache||new xZ),mt(this,gu,e.mutationCache||new fZ),mt(this,xu,e.defaultOptions||{}),mt(this,bm,new Map),mt(this,vm,new Map),mt(this,yu,0)}mount(){Zb(this,yu)._++,ie(this,yu)===1&&(mt(this,wm,h_.subscribe(async e=>{e&&(await this.resumePausedMutations(),ie(this,$r).onFocus())})),mt(this,Nm,fw.subscribe(async e=>{e&&(await this.resumePausedMutations(),ie(this,$r).onOnline())})))}unmount(){var e,t;Zb(this,yu)._--,ie(this,yu)===0&&((e=ie(this,wm))==null||e.call(this),mt(this,wm,void 0),(t=ie(this,Nm))==null||t.call(this),mt(this,Nm,void 0))}isFetching(e){return ie(this,$r).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return ie(this,gu).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=ie(this,$r).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=ie(this,$r).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Cu(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return ie(this,$r).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=ie(this,$r).get(r.queryHash),s=a==null?void 0:a.state.data,i=QX(t,s);if(i!==void 0)return ie(this,$r).build(this,r).setData(i,{...n,manual:!0})}setQueriesData(e,t,n){return da.batch(()=>ie(this,$r).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=ie(this,$r).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=ie(this,$r);da.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=ie(this,$r);return da.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=da.batch(()=>ie(this,$r).findAll(e).map(a=>a.cancel(n)));return Promise.all(r).then(is).catch(is)}invalidateQueries(e,t={}){return da.batch(()=>(ie(this,$r).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=da.batch(()=>ie(this,$r).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let s=a.fetch(void 0,n);return n.throwOnError||(s=s.catch(is)),a.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(is)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=ie(this,$r).build(this,t);return n.isStaleByTime(Cu(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(is).catch(is)}fetchInfiniteQuery(e){return e.behavior=OR(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(is).catch(is)}ensureInfiniteQueryData(e){return e.behavior=OR(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return fw.isOnline()?ie(this,gu).resumePausedMutations():Promise.resolve()}getQueryCache(){return ie(this,$r)}getMutationCache(){return ie(this,gu)}getDefaultOptions(){return ie(this,xu)}setDefaultOptions(e){mt(this,xu,e)}setQueryDefaults(e,t){ie(this,bm).set(pd(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...ie(this,bm).values()],n={};return t.forEach(r=>{Gx(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){ie(this,vm).set(pd(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...ie(this,vm).values()],n={};return t.forEach(r=>{Gx(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...ie(this,xu).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=u_(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===c_&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...ie(this,xu).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){ie(this,$r).clear(),ie(this,gu).clear()}},$r=new WeakMap,gu=new WeakMap,xu=new WeakMap,bm=new WeakMap,vm=new WeakMap,yu=new WeakMap,wm=new WeakMap,Nm=new WeakMap,LP),iO=k.createContext(void 0),Dy=e=>{const t=k.useContext(iO);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},bZ=({client:e,children:t})=>(k.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),o.jsx(iO.Provider,{value:e,children:t})),oO=k.createContext(!1),vZ=()=>k.useContext(oO);oO.Provider;function wZ(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var NZ=k.createContext(wZ()),kZ=()=>k.useContext(NZ),SZ=(e,t,n)=>{const r=n!=null&&n.state.error&&typeof e.throwOnError=="function"?d_(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))},CZ=e=>{k.useEffect(()=>{e.clearReset()},[e])},_Z=({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||d_(n,[e.error,r])),IZ=e=>{if(e.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},TZ=(e,t)=>e.isLoading&&e.isFetching&&!t,EZ=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,zR=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function jZ(e,t,n){var p,m,f,g;const r=vZ(),a=kZ(),s=Dy(),i=s.defaultQueryOptions(e);(m=(p=s.getDefaultOptions().queries)==null?void 0:p._experimental_beforeQuery)==null||m.call(p,i);const l=s.getQueryCache().get(i.queryHash);i._optimisticResults=r?"isRestoring":"optimistic",IZ(i),SZ(i,a,l),CZ(a);const u=!s.getQueryCache().get(i.queryHash),[d]=k.useState(()=>new t(s,i)),c=d.getOptimisticResult(i),h=!r&&e.subscribed!==!1;if(k.useSyncExternalStore(k.useCallback(x=>{const y=h?d.subscribe(da.batchCalls(x)):is;return d.updateResult(),y},[d,h]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),k.useEffect(()=>{d.setOptions(i)},[i,d]),EZ(i,c))throw zR(i,d,a);if(_Z({result:c,errorResetBoundary:a,throwOnError:i.throwOnError,query:l,suspense:i.suspense}))throw c.error;if((g=(f=s.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||g.call(f,i,c),i.experimental_prefetchInRender&&!hd&&TZ(c,r)){const x=u?zR(i,d,a):l==null?void 0:l.promise;x==null||x.catch(is).finally(()=>{d.updateResult()})}return i.notifyOnChangeProps?c:d.trackResult(c)}function qx(e,t){return jZ(e,cZ)}function nd(e,t){const n=Dy(),[r]=k.useState(()=>new gZ(n,e));k.useEffect(()=>{r.setOptions(e)},[r,e]);const a=k.useSyncExternalStore(k.useCallback(i=>r.subscribe(da.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),s=k.useCallback((i,l)=>{r.mutate(i,l).catch(is)},[r]);if(a.error&&d_(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:s,mutateAsync:a.mutate}}const lO=k.createContext(void 0);function AZ({children:e}){const[t,n]=k.useState(()=>typeof window<"u"&&localStorage.getItem("synka-theme")||"light");k.useEffect(()=>{const s=window.document.documentElement;s.classList.remove("light","dark"),s.classList.add(t),localStorage.setItem("synka-theme",t)},[t]);const r=()=>{n(s=>s==="light"?"dark":"light")},a=s=>{n(s)};return o.jsx(lO.Provider,{value:{theme:t,toggleTheme:r,setTheme:a},children:e})}function uO(){const e=k.useContext(lO);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}const RZ="https://qlrnewbkolxjdtfffuml.supabase.co",DZ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk",le=tY(RZ,DZ,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}});/*! Capacitor: https://capacitorjs.com/ - MIT License */var Cm;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Cm||(Cm={}));let qN=class extends Error{constructor(t,n,r){super(t),this.message=t,this.code=n,this.data=r}};const MZ=e=>{var t,n;return e!=null&&e.androidBridge?"android":!((n=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},$Z=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},r=n.Plugins=n.Plugins||{},a=()=>t!==null?t.name:MZ(e),s=()=>a()!=="web",i=h=>{const p=d.get(h);return!!(p!=null&&p.platforms.has(a())||l(h))},l=h=>{var p;return(p=n.PluginHeaders)===null||p===void 0?void 0:p.find(m=>m.name===h)},u=h=>e.console.error(h),d=new Map,c=(h,p={})=>{const m=d.get(h);if(m)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),m.proxy;const f=a(),g=l(h);let x;const y=async()=>(!x&&f in p?x=typeof p[f]=="function"?x=await p[f]():x=p[f]:t!==null&&!x&&"web"in p&&(x=typeof p.web=="function"?x=await p.web():x=p.web),x),b=(_,T)=>{var E,j;if(g){const I=g==null?void 0:g.methods.find(D=>T===D.name);if(I)return I.rtype==="promise"?D=>n.nativePromise(h,T.toString(),D):(D,F)=>n.nativeCallback(h,T.toString(),D,F);if(_)return(E=_[T])===null||E===void 0?void 0:E.bind(_)}else{if(_)return(j=_[T])===null||j===void 0?void 0:j.bind(_);throw new qN(`"${h}" plugin is not implemented on ${f}`,Cm.Unimplemented)}},v=_=>{let T;const E=(...j)=>{const I=y().then(D=>{const F=b(D,_);if(F){const P=F(...j);return T=P==null?void 0:P.remove,P}else throw new qN(`"${h}.${_}()" is not implemented on ${f}`,Cm.Unimplemented)});return _==="addListener"&&(I.remove=async()=>T()),I};return E.toString=()=>`${_.toString()}() { [capacitor code] }`,Object.defineProperty(E,"name",{value:_,writable:!1,configurable:!1}),E},w=v("addListener"),N=v("removeListener"),S=(_,T)=>{const E=w({eventName:_},T),j=async()=>{const D=await E;N({eventName:_,callbackId:D},T)},I=new Promise(D=>E.then(()=>D({remove:j})));return I.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await j()},I},C=new Proxy({},{get(_,T){switch(T){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return g?S:w;case"removeListener":return N;default:return v(T)}}});return r[h]=C,d.set(h,{name:h,proxy:C,platforms:new Set([...Object.keys(p),...g?[f]:[]])}),C};return n.convertFileSrc||(n.convertFileSrc=h=>h),n.getPlatform=a,n.handleError=u,n.isNativePlatform=s,n.isPluginAvailable=i,n.registerPlugin=c,n.Exception=qN,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},FZ=e=>e.Capacitor=$Z(e),Yt=FZ(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),lf=Yt.registerPlugin;let cO=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let r=!1;this.listeners[t]||(this.listeners[t]=[],r=!0),this.listeners[t].push(n);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),r&&this.sendRetainedArgumentsForEvent(t);const i=async()=>this.removeListener(t,n);return Promise.resolve({remove:i})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,r){const a=this.listeners[t];if(!a){if(r){let s=this.retainedEventArguments[t];s||(s=[]),s.push(n),this.retainedEventArguments[t]=s}return}a.forEach(s=>s(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(t="not implemented"){return new Yt.Exception(t,Cm.Unimplemented)}unavailable(t="not available"){return new Yt.Exception(t,Cm.Unavailable)}async removeListener(t,n){const r=this.listeners[t];if(!r)return;const a=r.indexOf(n);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(r=>{this.notifyListeners(t,r)}))}};const BR=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),WR=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class PZ extends cO{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(r=>{if(r.length<=0)return;let[a,s]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=WR(a).trim(),s=WR(s).trim(),n[a]=s}),n}async setCookie(t){try{const n=BR(t.key),r=BR(t.value),a=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),i=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${r||""}${a}; path=${s}; ${i};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}lf("CapacitorCookies",{web:()=>new PZ});const OZ=async e=>new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{const a=r.result;t(a.indexOf(",")>=0?a.split(",")[1]:a)},r.onerror=a=>n(a),r.readAsDataURL(e)}),LZ=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(a=>a.toLocaleLowerCase()).reduce((a,s,i)=>(a[s]=e[t[i]],a),{})},zZ=(e,t=!0)=>e?Object.entries(e).reduce((r,a)=>{const[s,i]=a;let l,u;return Array.isArray(i)?(u="",i.forEach(d=>{l=t?encodeURIComponent(d):d,u+=`${s}=${l}&`}),u.slice(0,-1)):(l=t?encodeURIComponent(i):i,u=`${s}=${l}`),`${r}&${u}`},"").substr(1):null,BZ=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),a=LZ(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[i,l]of Object.entries(e.data||{}))s.set(i,l);n.body=s.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const s=new FormData;if(e.data instanceof FormData)e.data.forEach((l,u)=>{s.append(u,l)});else for(const l of Object.keys(e.data))s.append(l,e.data[l]);n.body=s;const i=new Headers(n.headers);i.delete("content-type"),n.headers=i}else(a.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class WZ extends cO{async request(t){const n=BZ(t,t.webFetchExtra),r=zZ(t.params,t.shouldEncodeUrlParams),a=r?`${t.url}?${r}`:t.url,s=await fetch(a,n),i=s.headers.get("content-type")||"";let{responseType:l="text"}=s.ok?t:{};i.includes("application/json")&&(l="json");let u,d;switch(l){case"arraybuffer":case"blob":d=await s.blob(),u=await OZ(d);break;case"json":u=await s.json();break;case"document":case"text":default:u=await s.text()}const c={};return s.headers.forEach((h,p)=>{c[p]=h}),{data:u,headers:c,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}lf("CapacitorHttp",{web:()=>new WZ});const dO=k.createContext(void 0);function VZ({children:e}){const[t,n]=k.useState(null),[r,a]=k.useState(null),[s,i]=k.useState(!0),l=async v=>{var T,E,j;const w=((T=v.user_metadata)==null?void 0:T.name)||((E=v.user_metadata)==null?void 0:E.full_name)||"",N=((j=v.user_metadata)==null?void 0:j.phone)||"",S=v.email||"",{data:C}=await le.from("profiles").select("id, slug").eq("user_id",v.id).maybeSingle();if(!C){const D=`${S.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,"")||"user"}-${v.id.slice(0,6)}`;await le.from("profiles").insert({user_id:v.id,email:S,slug:D,full_name:w,phone:N})}const{data:_}=await le.from("cards").select("id, name, full_name, email, phone").eq("user_id",v.id).eq("is_default",!0).maybeSingle();if(!_)await le.from("cards").insert({user_id:v.id,name:"My Card",is_default:!0,layout:"dark-professional",full_name:w,email:S,phone:N,whatsapp:N});else{const I=(_.name??"").trim().toLowerCase()==="personal";(I||!_.full_name&&w||!_.email&&S||!_.phone&&N)&&await le.from("cards").update({name:I?"My Card":_.name||"My Card",full_name:_.full_name||w,email:_.email||S,phone:_.phone||N,whatsapp:_.phone||N||null}).eq("id",_.id)}await le.from("cards").select("id").eq("user_id",v.id).eq("is_default",!0).single()};k.useEffect(()=>{const v=async()=>{if(!Yt.isNativePlatform()){const S=sessionStorage.getItem("synka_session_temp"),C=localStorage.getItem("synka_remember_me");if(S==="true"&&C==="false")return await le.auth.signOut(),sessionStorage.removeItem("synka_session_temp"),i(!1),!0;sessionStorage.removeItem("synka_session_temp")}return!1},N=(async()=>{if(await v())return;const{data:{subscription:C}}=le.auth.onAuthStateChange((_,T)=>{a(T),n((T==null?void 0:T.user)??null),i(!1),T!=null&&T.user&&setTimeout(()=>l(T.user),0)});return le.auth.getSession().then(({data:{session:_}})=>{a(_),n((_==null?void 0:_.user)??null),i(!1),_!=null&&_.user&&setTimeout(()=>l(_.user),0)}),()=>C.unsubscribe()})();return()=>{N.then(S=>S==null?void 0:S())}},[]);const u=async v=>{const{error:w}=await le.auth.signInWithOtp({email:v.toLowerCase().trim(),options:{shouldCreateUser:!0}});return{error:w}},d=async(v,w)=>{const{error:N}=await le.auth.verifyOtp({email:v.toLowerCase().trim(),token:w,type:"email"});return{error:N}},c=async v=>{const{error:w}=await le.auth.signInWithOtp({email:v.toLowerCase().trim(),options:{shouldCreateUser:!1}});return{error:w}},h=async(v,w)=>{var N;try{const S=await le.functions.invoke("pin-auth",{body:{action:"SET_PIN",user_id:v,pin:w}});return S.error?{error:new Error(S.error.message||"Failed to set PIN")}:(N=S.data)!=null&&N.error?{error:new Error(S.data.error)}:{error:null}}catch(S){return{error:S}}},p=async(v,w)=>{var N,S,C,_,T;try{const E=await le.functions.invoke("pin-auth",{body:{action:"VERIFY_PIN",email:v,pin:w}});if(E.error){const j=E.error.context;if(j)try{const I=await j.json();return{error:new Error(I.error||"Failed to verify PIN"),locked:I.locked,needs_pin_setup:I.needs_pin_setup,attempts_left:I.attempts_left}}catch{}return{error:new Error(E.error.message||"Failed to verify PIN")}}return(N=E.data)!=null&&N.success?{error:null,user_id:E.data.user_id}:{error:new Error(((S=E.data)==null?void 0:S.error)||"Failed to verify PIN"),locked:(C=E.data)==null?void 0:C.locked,needs_pin_setup:(_=E.data)==null?void 0:_.needs_pin_setup,attempts_left:(T=E.data)==null?void 0:T.attempts_left}}catch(E){return{error:E}}},m=async v=>{var w;try{const N=await le.functions.invoke("pin-auth",{body:{action:"CHECK_PIN_EXISTS",email:v}});return N.error||(w=N.data)!=null&&w.error?{exists:!1,has_pin:!1}:{exists:N.data.exists,has_pin:N.data.has_pin,user_id:N.data.user_id,full_name:N.data.full_name||null}}catch{return{exists:!1,has_pin:!1}}},f=async(v,w)=>{var N,S;try{const C=await le.functions.invoke("pin-auth",{body:{action:"CREATE_SESSION",email:v,user_id:w}});if(console.log("CREATE_SESSION response:",C),C.error)return console.error("Edge function error:",C.error),{error:new Error(C.error.message||"Failed to create session")};if((N=C.data)!=null&&N.error)return console.error("Response data error:",C.data.error),{error:new Error(C.data.error)};if((S=C.data)!=null&&S.token_hash){console.log("Verifying token_hash...");const{data:_,error:T}=await le.auth.verifyOtp({token_hash:C.data.token_hash,type:"magiclink"});return console.log("verifyOtp result:",{data:_,error:T}),{error:T}}return{error:new Error("No session token received")}}catch(C){return console.error("loginWithPinOnly exception:",C),{error:C}}},g=()=>Yt.isNativePlatform()?"synka://auth/callback":"https://synka.in/my-card",x=async()=>{const v=g(),{error:w}=await le.auth.signInWithOAuth({provider:"google",options:{redirectTo:v}});return{error:w}},y=async()=>{const{error:v}=await le.auth.signInWithOAuth({provider:"linkedin_oidc",options:{redirectTo:`${window.location.origin}/my-card`}});return{error:v}},b=async()=>{await le.auth.signOut()};return o.jsx(dO.Provider,{value:{user:t,session:r,loading:s,sendOtp:u,verifyOtp:d,setPin:h,verifyPin:p,checkPinExists:m,loginWithPinOnly:f,signInWithGoogle:x,signInWithLinkedIn:y,signOut:b,createSessionWithOtp:c},children:e})}function ir(){const e=k.useContext(dO);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}const UZ=7*24*60*60*1e3,hO=()=>navigator.onLine;async function HZ(){if(!("serviceWorker"in navigator))return console.log("[SW] Service workers not supported"),null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[SW] Service worker registered"),e}catch(e){return console.error("[SW] Registration failed:",e),null}}function GZ(e,t){return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}function m_(e,t){try{localStorage.setItem(`offline_${e}`,JSON.stringify({data:t,timestamp:Date.now(),expiry:Date.now()+UZ}))}catch(n){console.warn("[Offline] Failed to persist data:",n),qZ()}}function f_(e){try{const t=localStorage.getItem(`offline_${e}`);if(!t)return null;const n=JSON.parse(t);return!hO()||Date.now()<=n.expiry?n.data:(localStorage.removeItem(`offline_${e}`),null)}catch{return null}}function qZ(){try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n!=null&&n.startsWith("offline_")){const r=localStorage.getItem(n);if(r)try{const a=JSON.parse(r);Date.now()>a.expiry&&e.push(n)}catch{e.push(n)}}}e.forEach(t=>localStorage.removeItem(t))}catch{}}async function KZ(){if(hO())try{const e=JSON.parse(localStorage.getItem("offline_sync_queue")||"[]");if(e.length===0)return;console.log(`[Offline] Processing ${e.length} queued changes`),localStorage.removeItem("offline_sync_queue"),window.dispatchEvent(new CustomEvent("synka:data-sync"))}catch(e){console.error("[Offline] Failed to process queue:",e)}}const pO=k.createContext(null),mO="synka_cards_cache",fO="cards",YZ=60*60*1e3,av=e=>{try{const t=localStorage.getItem(`${mO}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<YZ)return r}const n=f_(`${fO}_${e}`);if(n)return n}catch{}return{cards:[],activeCard:null}},sv=(e,t,n)=>{const r={cards:t,activeCard:n};try{localStorage.setItem(`${mO}_${e}`,JSON.stringify({data:r,timestamp:Date.now()})),m_(`${fO}_${e}`,r)}catch{}};function XZ({children:e}){const{user:t}=ir(),[n,r]=k.useState(()=>t?av(t.id).cards:[]),[a,s]=k.useState(()=>t?av(t.id).activeCard:null),[i,l]=k.useState(()=>t?av(t.id).cards.length===0:!1),u=k.useRef(!1),d=k.useRef(0),c=k.useRef(null),h=k.useCallback(()=>{d.current=0,c.current&&(clearTimeout(c.current),c.current=null)},[]),p=k.useCallback(async()=>{if(!t){h(),r([]),s(null),l(!1),u.current=!1;return}u.current||l(!0);const{data:b,error:v}=await le.from("cards").select("*").eq("user_id",t.id).order("created_at",{ascending:!0});if(v){console.error("Error fetching cards:",v),l(!1),u.current=!0,h();return}const w=b??[],N=w.find(T=>T.is_default)??null,S=t.email||"",C=N&&(N.email===S||N.full_name&&N.full_name.length>0),_=!u.current&&!C;if(r(w),s(_?null:N),!_&&N&&sv(t.id,w,N),_&&d.current<10){d.current+=1,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{p()},250);return}l(!1),u.current=!0,h()},[t,h]);k.useEffect(()=>{if(h(),!t){u.current=!1;return}const b=av(t.id);b.cards.length>0&&b.activeCard&&(r(b.cards),s(b.activeCard),l(!1)),p();const v=()=>{console.log("[Cards] Data sync triggered - refetching"),p()};return window.addEventListener("synka:data-sync",v),()=>{h(),window.removeEventListener("synka:data-sync",v)}},[t==null?void 0:t.id,p,h]);const m=async b=>{if(!t)return{error:"Not authenticated"};if(n.some(C=>C.name.toLowerCase().trim()===b.toLowerCase().trim()))return{error:"A card with this name already exists"};const{data:w,error:N}=await le.from("cards").insert({user_id:t.id,name:b.trim(),is_default:!1}).select().single();if(N)return{error:N.message};const S=w;return r(C=>[...C,S]),s(S),{data:S}},f=async(b,v)=>{if(!t)return{error:"Not authenticated"};const{data:w,error:N}=await le.from("cards").update(v).eq("id",b).eq("user_id",t.id).select().single();if(N)return{error:N.message};const S=w,C=n.map(_=>_.id===b?S:_);return r(C),(a==null?void 0:a.id)===b&&s(S),(a==null?void 0:a.id)===b?sv(t.id,C,S):sv(t.id,C,a),{data:S}},g=async b=>{if(!t)return{error:"Not authenticated"};if(n.length<=1)return{error:"Cannot delete the only card"};const v=n.find(S=>S.id===b),{error:w}=await le.from("cards").delete().eq("id",b).eq("user_id",t.id);if(w)return{error:w.message};const N=n.filter(S=>S.id!==b);return r(N),v!=null&&v.is_default&&N.length>0?(await x(N[0].id),s(N[0])):(a==null?void 0:a.id)===b&&s(N[0]||null),{success:!0}},x=async b=>{if(!t)return{error:"Not authenticated"};await le.from("cards").update({is_default:!1}).eq("user_id",t.id);const{data:v,error:w}=await le.from("cards").update({is_default:!0}).eq("id",b).eq("user_id",t.id).select().single();if(w||!v)return{error:w==null?void 0:w.message};const N=v,S=n.map(C=>({...C,is_default:C.id===b}));return r(S),s(N),sv(t.id,S,N),{data:N}},y=async b=>{const v=n.find(w=>w.id===b)??null;return v?(s(v),v):null};return o.jsx(pO.Provider,{value:{cards:n,activeCard:a,loading:i,createCard:m,updateCard:f,deleteCard:g,setDefaultCard:x,selectCard:y,refetch:p},children:e})}function uf(){const e=k.useContext(pO);if(!e)throw new Error("useCards must be used within a CardsProvider");return e}async function ZZ(e){const{data:t}=await le.from("profiles").select("user_id").eq("slug",e).maybeSingle();if(!t)return null;const{data:n}=await le.from("cards").select("*").eq("user_id",t.user_id).eq("is_default",!0).maybeSingle();return n}function oo(){const{user:e}=ir(),[t,n]=k.useState(!1),[r,a]=k.useState(!0),[s,i]=k.useState([]),[l,u]=k.useState([]),[d,c]=k.useState({totalUsers:0,freeUsers:0,orangeUsers:0,totalOrders:0,pvcOrders:0,metalOrders:0,totalRevenue:0});k.useEffect(()=>{(async()=>{if(!e){n(!1),a(!1);return}const{data:b,error:v}=await le.from("user_roles").select("role").eq("user_id",e.id).eq("role","admin").maybeSingle();n(!!b&&!v),a(!1)})()},[e]);const h=k.useCallback(async()=>{if(!t)return;const{data:y,error:b}=await le.from("profiles").select("id, user_id, full_name, email, phone, plan, created_at").order("created_at",{ascending:!1});if(b){console.error("Error fetching users:",b);return}const v=await Promise.all((y||[]).map(async w=>{var C,_;const[N,S]=await Promise.all([le.from("user_roles").select("role").eq("user_id",w.user_id).limit(1).maybeSingle(),w.full_name?Promise.resolve({data:null}):le.from("cards").select("full_name").eq("user_id",w.user_id).eq("is_default",!0).limit(1).maybeSingle()]);return{...w,full_name:w.full_name||((C=S.data)==null?void 0:C.full_name)||null,role:((_=N.data)==null?void 0:_.role)||"free"}}));i(v)},[t]),p=k.useCallback(async()=>{if(!t)return;const{data:y,error:b}=await le.from("orders").select("*").order("created_at",{ascending:!1});if(b){console.error("Error fetching orders:",b);return}const v=await Promise.all((y||[]).map(async w=>{const[N,S]=await Promise.all([le.from("profiles").select("full_name, email, phone").eq("user_id",w.user_id).maybeSingle(),le.from("cards").select("full_name, phone").eq("user_id",w.user_id).eq("is_default",!0).maybeSingle()]),C=N.data,_=S.data;return{...w,user_name:(C==null?void 0:C.full_name)||(_==null?void 0:_.full_name)||"Unknown",user_email:(C==null?void 0:C.email)||"Unknown",user_phone:(C==null?void 0:C.phone)||(_==null?void 0:_.phone)||null}}));u(v)},[t]),m=k.useCallback(async(y,b)=>{if(!t)return;let v=le.from("profiles").select("plan, created_at"),w=le.from("orders").select("product_type, amount, status, created_at");y&&(v=v.gte("created_at",y.toISOString()),w=w.gte("created_at",y.toISOString())),b&&(v=v.lte("created_at",b.toISOString()),w=w.lte("created_at",b.toISOString()));const[N,S]=await Promise.all([v,w]),C=N.data||[],T=(S.data||[]).filter(E=>E.status==="payment_success"||E.status==="placed"||E.status==="dispatched"||E.status==="delivered");c({totalUsers:C.length,freeUsers:C.filter(E=>E.plan==="Free").length,orangeUsers:C.filter(E=>E.plan==="Orange").length,totalOrders:T.length,pvcOrders:T.filter(E=>E.product_type==="pvc").length,metalOrders:T.filter(E=>E.product_type==="metal").length,totalRevenue:T.reduce((E,j)=>E+Number(j.amount),0)})},[t]),f=k.useCallback(async(y,b)=>{const{error:v}=await le.rpc("upgrade_user_plan",{_user_id:y,_new_plan:b});if(v)throw console.error("Error upgrading user:",v),v;await h()},[h]),g=k.useCallback(async y=>{const{error:b}=await le.from("profiles").update({plan:"Free",updated_at:new Date().toISOString()}).eq("user_id",y);if(b)throw console.error("Error downgrading user:",b),b;const{error:v}=await le.from("user_roles").update({role:"free"}).eq("user_id",y).eq("role","orange");v&&console.error("Error updating role:",v);const{error:w}=await le.from("plan_history").insert({user_id:y,old_plan:"Orange",new_plan:"Free",changed_by:e==null?void 0:e.id});w&&console.error("Error logging plan change:",w),await h()},[h,e==null?void 0:e.id]),x=k.useCallback(async(y,b)=>{const{error:v}=await le.from("orders").update({status:b}).eq("id",y);if(v)throw console.error("Error updating order:",v),v;await p()},[p]);return{isAdmin:t,loading:r,users:s,orders:l,stats:d,fetchUsers:h,fetchOrders:p,fetchStats:m,upgradeUserPlan:f,downgradeUserPlan:g,updateOrderStatus:x}}const VR=[{to:"/dashboard",icon:T3,label:"Dashboard"},{to:"/crm",icon:Cl,label:"CRM"},{to:"/my-card",icon:Js,label:"My Card"},{to:"/settings",icon:$3,label:"Settings"}];function QZ(){const e=Rl(),{user:t,loading:n}=ir(),{isAdmin:r}=oo(),a=e.pathname==="/",s=!n&&!!t,i=r?[...VR,{to:"/admin",icon:af,label:"Admin"}]:VR;return!s&&a||!s?null:o.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-xl border-t border-border/30 md:hidden pb-[env(safe-area-inset-bottom)]",children:o.jsx("div",{className:"flex items-center justify-around py-2 px-1 sm:px-2",children:i.map(l=>o.jsx(NS,{to:l.to,className:({isActive:u})=>Ie("flex flex-col items-center justify-center py-2 px-2 sm:px-3 rounded-xl transition-all duration-200 min-w-0 flex-1 max-w-[72px]",u?"text-primary":"text-muted-foreground/70 hover:text-foreground"),children:({isActive:u})=>o.jsxs(o.Fragment,{children:[o.jsx(l.icon,{className:Ie("h-5 w-5 mb-1 transition-transform duration-200 flex-shrink-0",u&&"scale-105")}),o.jsx("span",{className:"text-[10px] font-medium truncate",children:l.label})]})},l.to))})})}var JZ=Symbol.for("react.lazy"),gw=ZK[" use ".trim().toString()];function eQ(e){return typeof e=="object"&&e!==null&&"then"in e}function gO(e){return e!=null&&typeof e=="object"&&"$$typeof"in e&&e.$$typeof===JZ&&"_payload"in e&&eQ(e._payload)}function g_(e){const t=nQ(e),n=k.forwardRef((r,a)=>{let{children:s,...i}=r;gO(s)&&typeof gw=="function"&&(s=gw(s._payload));const l=k.Children.toArray(s),u=l.find(aQ);if(u){const d=u.props.children,c=l.map(h=>h===u?k.Children.count(d)>1?k.Children.only(null):k.isValidElement(d)?d.props.children:null:h);return o.jsx(t,{...i,ref:a,children:k.isValidElement(d)?k.cloneElement(d,void 0,c):null})}return o.jsx(t,{...i,ref:a,children:s})});return n.displayName=`${e}.Slot`,n}var tQ=g_("Slot");function nQ(e){const t=k.forwardRef((n,r)=>{let{children:a,...s}=n;if(gO(a)&&typeof gw=="function"&&(a=gw(a._payload)),k.isValidElement(a)){const i=iQ(a),l=sQ(s,a.props);return a.type!==k.Fragment&&(l.ref=r?JC(r,i):i),k.cloneElement(a,l)}return k.Children.count(a)>1?k.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var rQ=Symbol("radix.slottable");function aQ(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===rQ}function sQ(e,t){const n={...t};for(const r in t){const a=e[r],s=t[r];/^on[A-Z]/.test(r)?a&&s?n[r]=(...l)=>{const u=s(...l);return a(...l),u}:a&&(n[r]=a):r==="style"?n[r]={...a,...s}:r==="className"&&(n[r]=[a,s].filter(Boolean).join(" "))}return{...e,...n}}function iQ(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}const Kx=L0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-medium hover:-translate-y-0.5",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-soft",outline:"border border-border bg-card text-foreground hover:bg-secondary hover:text-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-soft",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"btn-gradient text-primary-foreground hover:-translate-y-0.5",glass:"glass hover:bg-card/80 hover:-translate-y-0.5 shadow-soft",premium:"bg-foreground text-background hover:bg-foreground/90 shadow-medium hover:shadow-large hover:-translate-y-0.5"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-lg px-3",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-2xl px-10 text-lg font-semibold",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),fe=k.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...a},s)=>{const i=r?tQ:"button";return o.jsx(i,{className:Ie(Kx({variant:t,size:n,className:e})),ref:s,...a})});fe.displayName="Button";function Tx(){const{theme:e,toggleTheme:t}=uO();return o.jsxs(fe,{variant:"ghost",size:"icon",onClick:t,className:"relative overflow-hidden rounded-full",children:[o.jsx(P3,{className:`h-5 w-5 transition-all duration-300 ${e==="dark"?"rotate-90 scale-0":"rotate-0 scale-100"}`}),o.jsx(j3,{className:`absolute h-5 w-5 transition-all duration-300 ${e==="dark"?"rotate-0 scale-100":"-rotate-90 scale-0"}`}),o.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}const xO="synka_profile_cache",yO="profile",oQ=60*60*1e3,KN=e=>{try{const t=localStorage.getItem(`${xO}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<oQ)return r}const n=f_(`${yO}_${e}`);if(n)return n}catch{}return null},YN=(e,t)=>{try{localStorage.setItem(`${xO}_${e}`,JSON.stringify({data:t,timestamp:Date.now()})),m_(`${yO}_${e}`,t)}catch{}};function Ko(){const{user:e}=ir(),[t,n]=k.useState(()=>e?KN(e.id):null),[r,a]=k.useState(()=>e?KN(e.id)===null:!1),[s,i]=k.useState(!1);k.useEffect(()=>{if(e){const c=KN(e.id);c?(n(c),a(!1),i(!0),u().finally(()=>i(!1))):(a(!0),u());const h=()=>{console.log("[Profile] Data sync triggered - refetching"),u()};return window.addEventListener("synka:data-sync",h),()=>window.removeEventListener("synka:data-sync",h)}else n(null),a(!1)},[e]);const l=c=>({...c,name:c.full_name||"",designation:c.designation||c.title||"",company:c.company||"",phone:c.phone||"",email:c.email||"",website:c.website||"",whatsapp:c.whatsapp||"",linkedin:c.linkedin||"",about:c.about||"",photo_url:c.photo_url||"",logo_url:c.logo_url||"",card_design:c.card_design||"minimal",public_slug:c.slug||""}),u=async()=>{var c,h,p,m,f;if(e){a(!0);try{const{data:g,error:x}=await le.from("profiles").select("*").eq("user_id",e.id).maybeSingle();if(x){console.error("Error fetching profile:",x),n(null),a(!1);return}if(g){const C=l(g);n(C),YN(e.id,C),a(!1);return}const b=`${((h=(c=e.email)==null?void 0:c.split("@")[0])==null?void 0:h.toLowerCase().replace(/[^a-z0-9]/g,""))||`user${Date.now()}`}${Math.floor(Math.random()*1e3)}`,v=((p=e.user_metadata)==null?void 0:p.name)||((m=e.user_metadata)==null?void 0:m.full_name)||"",w=((f=e.user_metadata)==null?void 0:f.phone)||"",{data:N,error:S}=await le.from("profiles").insert({user_id:e.id,email:e.email,full_name:v,phone:w,slug:b}).select().single();if(S){console.error("Error creating profile:",S);const{data:C}=await le.from("profiles").select("*").eq("user_id",e.id).maybeSingle();if(C){const _=l(C);n(_),YN(e.id,_)}else n(null)}else if(N){const C=l(N);n(C),YN(e.id,C)}}catch(g){console.error("Unexpected error in fetchProfile:",g),n(null)}finally{a(!1)}}};return{profile:t,loading:r,updateProfile:async c=>{if(!e)return{error:new Error("Not authenticated")};const h={};"name"in c&&(h.full_name=c.name),"full_name"in c&&(h.full_name=c.full_name),"designation"in c&&(h.designation=c.designation),"title"in c&&(h.title=c.title),"company"in c&&(h.company=c.company),"phone"in c&&(h.phone=c.phone),"email"in c&&(h.email=c.email),"website"in c&&(h.website=c.website),"whatsapp"in c&&(h.whatsapp=c.whatsapp),"linkedin"in c&&(h.linkedin=c.linkedin),"about"in c&&(h.about=c.about),"photo_url"in c&&(h.photo_url=c.photo_url),"logo_url"in c&&(h.logo_url=c.logo_url),"card_design"in c&&(h.card_design=c.card_design),"card_name"in c&&(h.card_name=c.card_name),"layout"in c&&(h.layout=c.layout),"slug"in c&&(h.slug=c.slug),"public_slug"in c&&(h.slug=c.public_slug);const{error:p}=await le.from("profiles").update(h).eq("user_id",e.id);return p||n(m=>m?{...m,...c,...h}:null),{error:p}},refetch:u}}async function lQ(e){const{data:t,error:n}=await le.from("profiles").select("*").eq("slug",e).maybeSingle();return n?(console.error("Error fetching profile by slug:",n),null):t?{...t,name:t.full_name||"",designation:t.designation||t.title||"",company:t.company||"",phone:t.phone||"",email:t.email||"",website:t.website||"",whatsapp:t.whatsapp||"",linkedin:t.linkedin||"",about:t.about||"",photo_url:t.photo_url||"",logo_url:t.logo_url||"",card_design:t.card_design||"minimal",public_slug:t.slug||""}:null}const Ge=k.forwardRef(({className:e,type:t,...n},r)=>o.jsx("input",{type:t,className:Ie("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...n}));Ge.displayName="Input";const xw=WK,yw=VK,uQ=k.forwardRef(({className:e,inset:t,children:n,...r},a)=>o.jsxs(qP,{ref:a,className:Ie("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...r,children:[n,o.jsx(Hx,{className:"ml-auto h-4 w-4"})]}));uQ.displayName=qP.displayName;const cQ=k.forwardRef(({className:e,...t},n)=>o.jsx(KP,{ref:n,className:Ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));cQ.displayName=KP.displayName;const Yx=k.forwardRef(({className:e,sideOffset:t=4,...n},r)=>o.jsx(BK,{children:o.jsx(YP,{ref:r,sideOffset:t,className:Ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));Yx.displayName=YP.displayName;const Lp=k.forwardRef(({className:e,inset:t,...n},r)=>o.jsx(XP,{ref:r,className:Ie("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...n}));Lp.displayName=XP.displayName;const dQ=k.forwardRef(({className:e,children:t,checked:n,...r},a)=>o.jsxs(ZP,{ref:a,className:Ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:n,...r,children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(QP,{children:o.jsx(an,{className:"h-4 w-4"})})}),t]}));dQ.displayName=ZP.displayName;const hQ=k.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(JP,{ref:r,className:Ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(QP,{children:o.jsx(S3,{className:"h-2 w-2 fill-current"})})}),t]}));hQ.displayName=JP.displayName;const Uv=k.forwardRef(({className:e,inset:t,...n},r)=>o.jsx(e3,{ref:r,className:Ie("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));Uv.displayName=e3.displayName;const Xx=k.forwardRef(({className:e,...t},n)=>o.jsx(t3,{ref:n,className:Ie("-mx-1 my-1 h-px bg-muted",e),...t}));Xx.displayName=t3.displayName;var pQ=Symbol("radix.slottable");function mQ(e){const t=({children:n})=>o.jsx(o.Fragment,{children:n});return t.displayName=`${e}.Slottable`,t.__radixId=pQ,t}var bO="AlertDialog",[fQ]=qo(bO,[n3]),Dl=n3(),vO=e=>{const{__scopeAlertDialog:t,...n}=e,r=Dl(t);return o.jsx(n_,{...r,...n,modal:!0})};vO.displayName=bO;var gQ="AlertDialogTrigger",xQ=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Dl(n);return o.jsx(HK,{...a,...r,ref:t})});xQ.displayName=gQ;var yQ="AlertDialogPortal",wO=e=>{const{__scopeAlertDialog:t,...n}=e,r=Dl(t);return o.jsx(e_,{...r,...n})};wO.displayName=yQ;var bQ="AlertDialogOverlay",NO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Dl(n);return o.jsx(R0,{...a,...r,ref:t})});NO.displayName=bQ;var nm="AlertDialogContent",[vQ,wQ]=fQ(nm),NQ=mQ("AlertDialogContent"),kO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,children:r,...a}=e,s=Dl(n),i=k.useRef(null),l=sr(t,i),u=k.useRef(null);return o.jsx(UK,{contentName:nm,titleName:SO,docsSlug:"alert-dialog",children:o.jsx(vQ,{scope:n,cancelRef:u,children:o.jsxs(D0,{role:"alertdialog",...s,...a,ref:l,onOpenAutoFocus:yn(a.onOpenAutoFocus,d=>{var c;d.preventDefault(),(c=u.current)==null||c.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[o.jsx(NQ,{children:r}),o.jsx(SQ,{contentRef:i})]})})})});kO.displayName=nm;var SO="AlertDialogTitle",CO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Dl(n);return o.jsx(M0,{...a,...r,ref:t})});CO.displayName=SO;var _O="AlertDialogDescription",IO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Dl(n);return o.jsx($0,{...a,...r,ref:t})});IO.displayName=_O;var kQ="AlertDialogAction",TO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Dl(n);return o.jsx(t_,{...a,...r,ref:t})});TO.displayName=kQ;var EO="AlertDialogCancel",jO=k.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,{cancelRef:a}=wQ(EO,n),s=Dl(n),i=sr(t,a);return o.jsx(t_,{...s,...r,ref:i})});jO.displayName=EO;var SQ=({contentRef:e})=>{const t=`\`${nm}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${nm}\` by passing a \`${_O}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${nm}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return k.useEffect(()=>{var r;document.getElementById((r=e.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},CQ=vO,_Q=wO,AO=NO,RO=kO,DO=TO,MO=jO,$O=CO,FO=IO;const _m=CQ,IQ=_Q,PO=k.forwardRef(({className:e,...t},n)=>o.jsx(AO,{className:Ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));PO.displayName=AO.displayName;const md=k.forwardRef(({className:e,...t},n)=>o.jsxs(IQ,{children:[o.jsx(PO,{}),o.jsx(RO,{ref:n,className:Ie("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));md.displayName=RO.displayName;const fd=({className:e,...t})=>o.jsx("div",{className:Ie("flex flex-col space-y-2 text-center sm:text-left",e),...t});fd.displayName="AlertDialogHeader";const gd=({className:e,...t})=>o.jsx("div",{className:Ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});gd.displayName="AlertDialogFooter";const xd=k.forwardRef(({className:e,...t},n)=>o.jsx($O,{ref:n,className:Ie("text-lg font-semibold",e),...t}));xd.displayName=$O.displayName;const yd=k.forwardRef(({className:e,...t},n)=>o.jsx(FO,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));yd.displayName=FO.displayName;const bd=k.forwardRef(({className:e,...t},n)=>o.jsx(DO,{ref:n,className:Ie(Kx(),e),...t}));bd.displayName=DO.displayName;const vd=k.forwardRef(({className:e,...t},n)=>o.jsx(MO,{ref:n,className:Ie(Kx({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));vd.displayName=MO.displayName;const TQ="modulepreload",EQ=function(e){return"/"+e},UR={},Qu=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(n.map(u=>{if(u=EQ(u),u in UR)return;UR[u]=!0;const d=u.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":TQ,d||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,m)=>{h.addEventListener("load",p),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})};var bw;(function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"})(bw||(bw={}));var vw;(function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"})(vw||(vw={}));const iv=lf("Haptics",{web:()=>Qu(()=>import("./web-D0RBhhE1.js"),__vite__mapDeps([0,1,2,3])).then(e=>new e.HapticsWeb)}),Ir={light:async()=>{Yt.isNativePlatform()?await iv.impact({style:bw.Light}):"vibrate"in navigator&&navigator.vibrate(8)},medium:async()=>{Yt.isNativePlatform()?await iv.impact({style:bw.Medium}):"vibrate"in navigator&&navigator.vibrate(12)},success:async()=>{Yt.isNativePlatform()?await iv.notification({type:vw.Success}):"vibrate"in navigator&&navigator.vibrate([20,20,20])},error:async()=>{Yt.isNativePlatform()?await iv.notification({type:vw.Error}):"vibrate"in navigator&&navigator.vibrate([60,30,60])}};function OO({cards:e,activeCard:t,onSelect:n,onSetDefault:r,onAdd:a,onDelete:s,onEditCard:i,onUpdateCardName:l,variant:u="desktop",isOrangePlan:d=!1}){var ee,M;const c=za(),[h,p]=k.useState(null),[m,f]=k.useState(""),[g,x]=k.useState(!1),[y,b]=k.useState(""),[v,w]=k.useState(null),[N,S]=k.useState(!1),C=k.useRef(null),_=k.useRef(null),T=k.useRef(0);k.useEffect(()=>{h&&C.current&&(C.current.focus(),C.current.select())},[h]),k.useEffect(()=>()=>{_.current&&clearTimeout(_.current)},[]);const E=G=>{f(G.name),p(G.id)},j=async G=>{const J=e.find(se=>se.id===G),ve=m.trim();if(!ve){p(null);return}if(J&&ve===J.name){p(null);return}if(e.some(se=>se.id!==G&&se.name.toLowerCase().trim()===ve.toLowerCase())){oe({title:"Error",description:"A card with this name already exists",variant:"destructive"}),p(null);return}l&&(await l(G,ve),Ir.light()),p(null)},I=(G,J)=>{G.key==="Enter"?j(J):G.key==="Escape"&&p(null)},D=()=>{S(!1),c("/settings/upgrade")},F=async(G,J)=>{J.stopPropagation();const ve=e.find(Q=>Q.id===G);ve!=null&&ve.is_default||(await r(G),S(!1),Ir.medium(),oe({title:"Default card updated",description:"QR & link now point to this card"}))},P=k.useCallback((G,J)=>{J.stopPropagation(),T.current+=1,T.current===1?_.current=setTimeout(()=>{T.current===1&&(n(G.id),S(!1),Ir.light()),T.current=0},250):T.current===2&&(_.current&&clearTimeout(_.current),T.current=0,E(G),Ir.light())},[n]),V=(G,J)=>{J.stopPropagation(),n(G),S(!1),i==null||i(G)},$=async()=>{if(!y.trim()){oe({title:"Error",description:"Please enter a card name",variant:"destructive"});return}const G=await a(y.trim());G.error?oe({title:"Error",description:G.error,variant:"destructive"}):(oe({title:"Card created",description:`"${y.trim()}" has been created`}),b(""),x(!1),Ir.medium())},O=async()=>{if(!v)return;const G=e.find(ve=>ve.id===v);if(e.length<=1){oe({title:"Cannot delete",description:"You must have at least one card",variant:"destructive"}),w(null);return}const J=await s(v);J.error?oe({title:"Error",description:J.error,variant:"destructive"}):(oe({title:"Card deleted",description:`"${G==null?void 0:G.name}" has been deleted`}),Ir.medium()),w(null)},L=d,q=G=>!(e.length<=1||G.is_default),U=({card:G})=>{const J=h===G.id,ve=G.is_default,Q=(t==null?void 0:t.id)===G.id,se=q(G);return o.jsxs("div",{className:Ie("flex items-center gap-2 px-2 py-2.5 rounded-lg cursor-pointer transition-all duration-200","hover:bg-muted/60",Q&&"bg-primary/5 ring-1 ring-primary/20"),children:[o.jsx("button",{onClick:_e=>F(G.id,_e),className:Ie("flex-shrink-0 p-1 rounded-full transition-all duration-200 active:scale-90",ve?"text-orange-500 cursor-default":"text-muted-foreground/30 hover:text-orange-400 hover:bg-orange-500/10"),disabled:ve,title:ve?"Default card":"Set as default",children:o.jsx(HN,{className:Ie("h-4 w-4 transition-all duration-300",ve&&"fill-orange-500 drop-shadow-sm")})}),o.jsx("div",{className:"flex-1 min-w-0",children:J?o.jsx(Ge,{ref:C,value:m,onChange:_e=>f(_e.target.value),onKeyDown:_e=>I(_e,G.id),onBlur:()=>j(G.id),className:"h-7 text-sm bg-background",onClick:_e=>_e.stopPropagation()}):o.jsxs("div",{onClick:_e=>P(G,_e),className:Ie("text-sm text-left truncate w-full py-0.5 px-1 -mx-1 rounded select-none","transition-colors duration-150","hover:text-foreground",Q?"text-foreground font-medium":"text-foreground/80"),title:"Tap to switch  Double-tap to rename",children:[o.jsx("span",{className:"truncate",children:G.name}),ve&&o.jsx("span",{className:"text-orange-500/70 text-xs ml-1.5 font-normal",children:"(Default)"})]})}),o.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[o.jsx("button",{onClick:_e=>V(G.id,_e),className:Ie("p-1.5 rounded-md transition-all duration-150 active:scale-90","text-muted-foreground/50 hover:text-foreground hover:bg-muted"),title:"Edit card details",children:o.jsx(Ay,{className:"h-3.5 w-3.5"})}),se&&o.jsx("button",{onClick:_e=>{_e.stopPropagation(),w(G.id)},className:Ie("p-1.5 rounded-md transition-all duration-150 active:scale-90","text-muted-foreground/50 hover:text-destructive hover:bg-destructive/10"),title:"Delete card",children:o.jsx(Do,{className:"h-3.5 w-3.5"})})]})]})};return u==="mobile"?o.jsxs(o.Fragment,{children:[o.jsxs(xw,{open:N,onOpenChange:S,children:[o.jsx(yw,{asChild:!0,children:o.jsxs("button",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-background border border-border/60 shadow-sm active:scale-95 transition-transform",children:[(t==null?void 0:t.is_default)&&o.jsx(HN,{className:"h-3 w-3 text-orange-500 fill-orange-500"}),o.jsx("span",{className:"truncate max-w-[100px]",children:(t==null?void 0:t.name)||"My Card"}),o.jsx(Ux,{className:"h-3 w-3 text-muted-foreground"})]})}),o.jsxs(Yx,{align:"start",className:"w-64 bg-background z-50 p-2 shadow-lg border",children:[o.jsx("div",{className:"space-y-0.5",children:e.map(G=>o.jsx(U,{card:G},G.id))}),o.jsx(Xx,{className:"my-2"}),L?o.jsxs("button",{onClick:()=>{S(!1),x(!0)},className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-muted transition-colors text-primary font-medium",children:[o.jsx(qs,{className:"h-4 w-4"}),"Create New Card"]}):o.jsxs("div",{children:[o.jsxs("button",{onClick:D,className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-orange-500/10 transition-colors text-orange-500 font-medium",children:[o.jsx(cw,{className:"h-4 w-4"}),"Upgrade to Orange"]}),o.jsx("p",{className:"px-2 pb-2 text-xs text-muted-foreground leading-snug",children:"Add multiple cards"})]})]})]}),o.jsx(_m,{open:!!v,onOpenChange:()=>w(null),children:o.jsxs(md,{children:[o.jsxs(fd,{children:[o.jsx(xd,{children:"Delete Card"}),o.jsxs(yd,{children:['Are you sure you want to delete "',(ee=e.find(G=>G.id===v))==null?void 0:ee.name,'"? This action cannot be undone.']})]}),o.jsxs(gd,{children:[o.jsx(vd,{children:"Cancel"}),o.jsx(bd,{onClick:O,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),g&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:o.jsxs("div",{className:"bg-background p-4 rounded-xl shadow-lg w-72 animate-scale-in",onClick:G=>G.stopPropagation(),children:[o.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Create New Card"}),o.jsx(Ge,{value:y,onChange:G=>b(G.target.value),placeholder:"Card name (e.g. Work, Personal)",className:"mb-3",autoFocus:!0,onKeyDown:G=>G.key==="Enter"&&$()}),o.jsxs("div",{className:"flex gap-2 justify-end",children:[o.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>x(!1),children:"Cancel"}),o.jsx(fe,{size:"sm",onClick:$,children:"Create"})]})]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs(xw,{open:N,onOpenChange:S,children:[o.jsx(yw,{asChild:!0,children:o.jsxs(fe,{variant:"ghost",className:"gap-2 hover:bg-muted/60",children:[(t==null?void 0:t.is_default)&&o.jsx(HN,{className:"h-4 w-4 text-orange-500 fill-orange-500"}),o.jsx("span",{children:(t==null?void 0:t.name)||"My Card"}),o.jsx(Ux,{className:"h-4 w-4 text-muted-foreground"})]})}),o.jsxs(Yx,{align:"end",className:"w-72 bg-background z-50 p-2 shadow-lg border",children:[o.jsx("div",{className:"space-y-0.5",children:e.map(G=>o.jsx(U,{card:G},G.id))}),o.jsx(Xx,{className:"my-2"}),L?o.jsxs("button",{onClick:()=>{S(!1),x(!0)},className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-muted transition-colors text-primary font-medium",children:[o.jsx(qs,{className:"h-4 w-4"}),"Create New Card"]}):o.jsxs("div",{children:[o.jsxs("button",{onClick:D,className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-orange-500/10 transition-colors text-orange-500 font-medium",children:[o.jsx(cw,{className:"h-4 w-4"}),"Upgrade to Orange"]}),o.jsx("p",{className:"px-2 pb-2 text-xs text-muted-foreground leading-snug",children:"Add multiple cards"})]})]})]}),o.jsx(_m,{open:!!v,onOpenChange:()=>w(null),children:o.jsxs(md,{children:[o.jsxs(fd,{children:[o.jsx(xd,{children:"Delete Card"}),o.jsxs(yd,{children:['Are you sure you want to delete "',(M=e.find(G=>G.id===v))==null?void 0:M.name,'"? This action cannot be undone.']})]}),o.jsxs(gd,{children:[o.jsx(vd,{children:"Cancel"}),o.jsx(bd,{onClick:O,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),g&&o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>x(!1),children:o.jsxs("div",{className:"bg-background p-6 rounded-xl shadow-lg w-80 animate-scale-in",onClick:G=>G.stopPropagation(),children:[o.jsx("h3",{className:"text-base font-semibold mb-4",children:"Create New Card"}),o.jsx(Ge,{value:y,onChange:G=>b(G.target.value),placeholder:"Card name (e.g. Work, Personal)",className:"mb-4",autoFocus:!0,onKeyDown:G=>G.key==="Enter"&&$()}),o.jsxs("div",{className:"flex gap-2 justify-end",children:[o.jsx(fe,{variant:"ghost",onClick:()=>x(!1),children:"Cancel"}),o.jsx(fe,{onClick:$,children:"Create"})]})]})})]})}const jQ={sm:{logo:"h-5",text:"text-lg",gap:"gap-2"},md:{logo:"h-5",text:"text-xl",gap:"gap-2"},lg:{logo:"h-6",text:"text-2xl",gap:"gap-2"}};function us({size:e="md",asLink:t=!0,className:n}){const{logo:r,text:a,gap:s}=jQ[e],i=o.jsxs("div",{className:Ie("flex items-center",s,n),children:[o.jsx("img",{src:"/logos/synka-logo.png",alt:"SYNKA",className:Ie(r,"w-auto object-contain"),loading:"eager",decoding:"async"}),o.jsx("span",{className:Ie("font-anta font-bold gradient-text",a),children:"SYNKA"})]});return t?o.jsx(Va,{to:"/",children:i}):i}const AQ=[{to:"/dashboard",icon:T3,label:"Dashboard"},{to:"/crm",icon:Cl,label:"CRM"},{to:"/my-card",icon:Js,label:"My Card"},{to:"/settings",icon:$3,label:"Settings"}];function RQ(){return o.jsx("span",{className:`
        inline-flex items-center
        px-3 py-1
        rounded-full
        text-xs font-semibold
        bg-orange-plan
        text-white
        tracking-wide
      `,children:"ORANGE"})}function DQ(){var N;const e=za(),t=Rl(),{user:n,loading:r,signOut:a}=ir(),{cards:s,activeCard:i,loading:l,createCard:u,deleteCard:d,setDefaultCard:c,selectCard:h,updateCard:p}=uf(),{isAdmin:m}=oo(),{profile:f}=Ko(),g=((N=f==null?void 0:f.plan)==null?void 0:N.toLowerCase())==="orange",x=!r&&!!n,y=t.pathname==="/"||t.pathname==="/index",b=t.pathname==="/my-card"||t.pathname==="/card",v=async(S,C)=>{await p(S,{name:C})},w=()=>{e("/my-card?edit=true")};return!x&&y?o.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:o.jsxs("div",{className:"w-full max-w-7xl mx-auto flex items-center justify-between h-14 md:h-16 px-3 sm:px-4 md:px-6",children:[o.jsx(us,{size:"sm",className:"md:hidden"}),o.jsx(us,{size:"md",className:"hidden md:flex"}),o.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[o.jsx(Tx,{}),o.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>e("/login"),children:"Login"}),o.jsx(fe,{variant:"gradient",size:"sm",onClick:()=>e("/signup"),children:"Sign up"})]})]})}):o.jsx("header",{className:"hidden md:block fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:o.jsxs("div",{className:"w-full max-w-7xl mx-auto px-3 md:px-4 lg:px-6 xl:px-10 flex items-center justify-between h-14 lg:h-16",children:[o.jsxs("div",{className:"flex items-center gap-3 lg:gap-6",children:[o.jsx(us,{size:"sm",className:"lg:hidden"}),o.jsx(us,{size:"md",className:"hidden lg:flex"}),x&&o.jsxs("nav",{className:"flex items-center gap-1 overflow-x-auto",children:[AQ.map(S=>o.jsxs(NS,{to:S.to,className:({isActive:C})=>Ie("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition",C?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[o.jsx(S.icon,{className:"h-4 w-4"}),o.jsx("span",{className:"hidden xl:inline",children:S.label})]},S.to)),m&&o.jsxs(NS,{to:"/admin",className:({isActive:S})=>Ie("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition",S?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[o.jsx(af,{className:"h-4 w-4"}),o.jsx("span",{className:"hidden xl:inline",children:"Admin"})]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[x&&g&&o.jsx(RQ,{}),x&&b&&!l&&i&&o.jsx(OO,{cards:s,activeCard:i,onSelect:h,onSetDefault:c,onAdd:u,onDelete:d,onEditCard:w,onUpdateCardName:v,variant:"desktop",isOrangePlan:g}),o.jsx(Tx,{}),x?o.jsx(fe,{variant:"ghost",size:"sm",onClick:a,children:"Sign out"}):o.jsxs(o.Fragment,{children:[o.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>e("/login"),children:"Login"}),o.jsx(fe,{variant:"gradient",size:"sm",onClick:()=>e("/signup"),children:"Sign up"})]})]})]})})}const MQ=L0("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function nt({className:e,variant:t,...n}){return o.jsx("div",{className:Ie(MQ({variant:t}),e),...n})}const LO=k.createContext({});function $Q(e){const t=k.useRef(null);return t.current===null&&(t.current=e()),t.current}const x_=typeof window<"u",FQ=x_?k.useLayoutEffect:k.useEffect,y_=k.createContext(null);function b_(e,t){e.indexOf(t)===-1&&e.push(t)}function v_(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const _l=(e,t,n)=>n>t?t:n<e?e:n;let w_=()=>{};const Il={},zO=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function BO(e){return typeof e=="object"&&e!==null}const WO=e=>/^0[^.\s]+$/u.test(e);function N_(e){let t;return()=>(t===void 0&&(t=e()),t)}const vi=e=>e,PQ=(e,t)=>n=>t(e(n)),My=(...e)=>e.reduce(PQ),Zx=(e,t,n)=>{const r=t-e;return r===0?1:(n-e)/r};class k_{constructor(){this.subscriptions=[]}add(t){return b_(this.subscriptions,t),()=>v_(this.subscriptions,t)}notify(t,n,r){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,r);else for(let s=0;s<a;s++){const i=this.subscriptions[s];i&&i(t,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const $o=e=>e*1e3,yi=e=>e/1e3;function VO(e,t){return t?e*(1e3/t):0}const UO=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,OQ=1e-7,LQ=12;function zQ(e,t,n,r,a){let s,i,l=0;do i=t+(n-t)/2,s=UO(i,r,a)-e,s>0?n=i:t=i;while(Math.abs(s)>OQ&&++l<LQ);return i}function $y(e,t,n,r){if(e===t&&n===r)return vi;const a=s=>zQ(s,0,1,e,n);return s=>s===0||s===1?s:UO(a(s),t,r)}const HO=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,GO=e=>t=>1-e(1-t),qO=$y(.33,1.53,.69,.99),S_=GO(qO),KO=HO(S_),YO=e=>(e*=2)<1?.5*S_(e):.5*(2-Math.pow(2,-10*(e-1))),C_=e=>1-Math.sin(Math.acos(e)),XO=GO(C_),ZO=HO(C_),BQ=$y(.42,0,1,1),WQ=$y(0,0,.58,1),QO=$y(.42,0,.58,1),VQ=e=>Array.isArray(e)&&typeof e[0]!="number",JO=e=>Array.isArray(e)&&typeof e[0]=="number",UQ={linear:vi,easeIn:BQ,easeInOut:QO,easeOut:WQ,circIn:C_,circInOut:ZO,circOut:XO,backIn:S_,backInOut:KO,backOut:qO,anticipate:YO},HQ=e=>typeof e=="string",HR=e=>{if(JO(e)){w_(e.length===4);const[t,n,r,a]=e;return $y(t,n,r,a)}else if(HQ(e))return UQ[e];return e},ov=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function GQ(e,t){let n=new Set,r=new Set,a=!1,s=!1;const i=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function u(c){i.has(c)&&(d.schedule(c),e()),c(l)}const d={schedule:(c,h=!1,p=!1)=>{const f=p&&a?n:r;return h&&i.add(c),f.has(c)||f.add(c),c},cancel:c=>{r.delete(c),i.delete(c)},process:c=>{if(l=c,a){s=!0;return}a=!0,[n,r]=[r,n],n.forEach(u),n.clear(),a=!1,s&&(s=!1,d.process(c))}};return d}const qQ=40;function e4(e,t){let n=!1,r=!0;const a={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,i=ov.reduce((v,w)=>(v[w]=GQ(s),v),{}),{setup:l,read:u,resolveKeyframes:d,preUpdate:c,update:h,preRender:p,render:m,postRender:f}=i,g=()=>{const v=Il.useManualTiming?a.timestamp:performance.now();n=!1,Il.useManualTiming||(a.delta=r?1e3/60:Math.max(Math.min(v-a.timestamp,qQ),1)),a.timestamp=v,a.isProcessing=!0,l.process(a),u.process(a),d.process(a),c.process(a),h.process(a),p.process(a),m.process(a),f.process(a),a.isProcessing=!1,n&&t&&(r=!1,e(g))},x=()=>{n=!0,r=!0,a.isProcessing||e(g)};return{schedule:ov.reduce((v,w)=>{const N=i[w];return v[w]=(S,C=!1,_=!1)=>(n||x(),N.schedule(S,C,_)),v},{}),cancel:v=>{for(let w=0;w<ov.length;w++)i[ov[w]].cancel(v)},state:a,steps:i}}const{schedule:kr,cancel:Du,state:Fa,steps:XN}=e4(typeof requestAnimationFrame<"u"?requestAnimationFrame:vi,!0);let Hv;function KQ(){Hv=void 0}const js={now:()=>(Hv===void 0&&js.set(Fa.isProcessing||Il.useManualTiming?Fa.timestamp:performance.now()),Hv),set:e=>{Hv=e,queueMicrotask(KQ)}},t4=e=>t=>typeof t=="string"&&t.startsWith(e),n4=t4("--"),YQ=t4("var(--"),__=e=>YQ(e)?XQ.test(e.split("/*")[0].trim()):!1,XQ=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,cf={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Qx={...cf,transform:e=>_l(0,1,e)},lv={...cf,default:1},Ex=e=>Math.round(e*1e5)/1e5,I_=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function ZQ(e){return e==null}const QQ=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,T_=(e,t)=>n=>!!(typeof n=="string"&&QQ.test(n)&&n.startsWith(e)||t&&!ZQ(n)&&Object.prototype.hasOwnProperty.call(n,t)),r4=(e,t,n)=>r=>{if(typeof r!="string")return r;const[a,s,i,l]=r.match(I_);return{[e]:parseFloat(a),[t]:parseFloat(s),[n]:parseFloat(i),alpha:l!==void 0?parseFloat(l):1}},JQ=e=>_l(0,255,e),ZN={...cf,transform:e=>Math.round(JQ(e))},zc={test:T_("rgb","red"),parse:r4("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+ZN.transform(e)+", "+ZN.transform(t)+", "+ZN.transform(n)+", "+Ex(Qx.transform(r))+")"};function eJ(e){let t="",n="",r="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,r+=r,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:a?parseInt(a,16)/255:1}}const HS={test:T_("#"),parse:eJ,transform:zc.transform},Fy=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Jl=Fy("deg"),Fo=Fy("%"),Wt=Fy("px"),tJ=Fy("vh"),nJ=Fy("vw"),GR={...Fo,parse:e=>Fo.parse(e)/100,transform:e=>Fo.transform(e*100)},Gp={test:T_("hsl","hue"),parse:r4("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:r=1})=>"hsla("+Math.round(e)+", "+Fo.transform(Ex(t))+", "+Fo.transform(Ex(n))+", "+Ex(Qx.transform(r))+")"},Yr={test:e=>zc.test(e)||HS.test(e)||Gp.test(e),parse:e=>zc.test(e)?zc.parse(e):Gp.test(e)?Gp.parse(e):HS.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?zc.transform(e):Gp.transform(e),getAnimatableNone:e=>{const t=Yr.parse(e);return t.alpha=0,Yr.transform(t)}},rJ=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function aJ(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(I_))==null?void 0:t.length)||0)+(((n=e.match(rJ))==null?void 0:n.length)||0)>0}const a4="number",s4="color",sJ="var",iJ="var(",qR="${}",oJ=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Jx(e){const t=e.toString(),n=[],r={color:[],number:[],var:[]},a=[];let s=0;const l=t.replace(oJ,u=>(Yr.test(u)?(r.color.push(s),a.push(s4),n.push(Yr.parse(u))):u.startsWith(iJ)?(r.var.push(s),a.push(sJ),n.push(u)):(r.number.push(s),a.push(a4),n.push(parseFloat(u))),++s,qR)).split(qR);return{values:n,split:l,indexes:r,types:a}}function i4(e){return Jx(e).values}function o4(e){const{split:t,types:n}=Jx(e),r=t.length;return a=>{let s="";for(let i=0;i<r;i++)if(s+=t[i],a[i]!==void 0){const l=n[i];l===a4?s+=Ex(a[i]):l===s4?s+=Yr.transform(a[i]):s+=a[i]}return s}}const lJ=e=>typeof e=="number"?0:Yr.test(e)?Yr.getAnimatableNone(e):e;function uJ(e){const t=i4(e);return o4(e)(t.map(lJ))}const Mu={test:aJ,parse:i4,createTransformer:o4,getAnimatableNone:uJ};function QN(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function cJ({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,t/=100,n/=100;let a=0,s=0,i=0;if(!t)a=s=i=n;else{const l=n<.5?n*(1+t):n+t-n*t,u=2*n-l;a=QN(u,l,e+1/3),s=QN(u,l,e),i=QN(u,l,e-1/3)}return{red:Math.round(a*255),green:Math.round(s*255),blue:Math.round(i*255),alpha:r}}function ww(e,t){return n=>n>0?t:e}const Tr=(e,t,n)=>e+(t-e)*n,JN=(e,t,n)=>{const r=e*e,a=n*(t*t-r)+r;return a<0?0:Math.sqrt(a)},dJ=[HS,zc,Gp],hJ=e=>dJ.find(t=>t.test(e));function KR(e){const t=hJ(e);if(!t)return!1;let n=t.parse(e);return t===Gp&&(n=cJ(n)),n}const YR=(e,t)=>{const n=KR(e),r=KR(t);if(!n||!r)return ww(e,t);const a={...n};return s=>(a.red=JN(n.red,r.red,s),a.green=JN(n.green,r.green,s),a.blue=JN(n.blue,r.blue,s),a.alpha=Tr(n.alpha,r.alpha,s),zc.transform(a))},GS=new Set(["none","hidden"]);function pJ(e,t){return GS.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function mJ(e,t){return n=>Tr(e,t,n)}function E_(e){return typeof e=="number"?mJ:typeof e=="string"?__(e)?ww:Yr.test(e)?YR:xJ:Array.isArray(e)?l4:typeof e=="object"?Yr.test(e)?YR:fJ:ww}function l4(e,t){const n=[...e],r=n.length,a=e.map((s,i)=>E_(s)(s,t[i]));return s=>{for(let i=0;i<r;i++)n[i]=a[i](s);return n}}function fJ(e,t){const n={...e,...t},r={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(r[a]=E_(e[a])(e[a],t[a]));return a=>{for(const s in r)n[s]=r[s](a);return n}}function gJ(e,t){const n=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const s=t.types[a],i=e.indexes[s][r[s]],l=e.values[i]??0;n[a]=l,r[s]++}return n}const xJ=(e,t)=>{const n=Mu.createTransformer(t),r=Jx(e),a=Jx(t);return r.indexes.var.length===a.indexes.var.length&&r.indexes.color.length===a.indexes.color.length&&r.indexes.number.length>=a.indexes.number.length?GS.has(e)&&!a.values.length||GS.has(t)&&!r.values.length?pJ(e,t):My(l4(gJ(r,a),a.values),n):ww(e,t)};function u4(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Tr(e,t,n):E_(e)(e,t)}const yJ=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>kr.update(t,n),stop:()=>Du(t),now:()=>Fa.isProcessing?Fa.timestamp:js.now()}},c4=(e,t,n=10)=>{let r="";const a=Math.max(Math.round(t/n),2);for(let s=0;s<a;s++)r+=Math.round(e(s/(a-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},Nw=2e4;function j_(e){let t=0;const n=50;let r=e.next(t);for(;!r.done&&t<Nw;)t+=n,r=e.next(t);return t>=Nw?1/0:t}function bJ(e,t=100,n){const r=n({...e,keyframes:[0,t]}),a=Math.min(j_(r),Nw);return{type:"keyframes",ease:s=>r.next(a*s).value/t,duration:yi(a)}}const vJ=5;function d4(e,t,n){const r=Math.max(t-vJ,0);return VO(n-e(r),t-r)}const Fr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},ek=.001;function wJ({duration:e=Fr.duration,bounce:t=Fr.bounce,velocity:n=Fr.velocity,mass:r=Fr.mass}){let a,s,i=1-t;i=_l(Fr.minDamping,Fr.maxDamping,i),e=_l(Fr.minDuration,Fr.maxDuration,yi(e)),i<1?(a=d=>{const c=d*i,h=c*e,p=c-n,m=qS(d,i),f=Math.exp(-h);return ek-p/m*f},s=d=>{const h=d*i*e,p=h*n+n,m=Math.pow(i,2)*Math.pow(d,2)*e,f=Math.exp(-h),g=qS(Math.pow(d,2),i);return(-a(d)+ek>0?-1:1)*((p-m)*f)/g}):(a=d=>{const c=Math.exp(-d*e),h=(d-n)*e+1;return-ek+c*h},s=d=>{const c=Math.exp(-d*e),h=(n-d)*(e*e);return c*h});const l=5/e,u=kJ(a,s,l);if(e=$o(e),isNaN(u))return{stiffness:Fr.stiffness,damping:Fr.damping,duration:e};{const d=Math.pow(u,2)*r;return{stiffness:d,damping:i*2*Math.sqrt(r*d),duration:e}}}const NJ=12;function kJ(e,t,n){let r=n;for(let a=1;a<NJ;a++)r=r-e(r)/t(r);return r}function qS(e,t){return e*Math.sqrt(1-t*t)}const SJ=["duration","bounce"],CJ=["stiffness","damping","mass"];function XR(e,t){return t.some(n=>e[n]!==void 0)}function _J(e){let t={velocity:Fr.velocity,stiffness:Fr.stiffness,damping:Fr.damping,mass:Fr.mass,isResolvedFromDuration:!1,...e};if(!XR(e,CJ)&&XR(e,SJ))if(e.visualDuration){const n=e.visualDuration,r=2*Math.PI/(n*1.2),a=r*r,s=2*_l(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Fr.mass,stiffness:a,damping:s}}else{const n=wJ(e);t={...t,...n,mass:Fr.mass},t.isResolvedFromDuration=!0}return t}function kw(e=Fr.visualDuration,t=Fr.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:a}=n;const s=n.keyframes[0],i=n.keyframes[n.keyframes.length-1],l={done:!1,value:s},{stiffness:u,damping:d,mass:c,duration:h,velocity:p,isResolvedFromDuration:m}=_J({...n,velocity:-yi(n.velocity||0)}),f=p||0,g=d/(2*Math.sqrt(u*c)),x=i-s,y=yi(Math.sqrt(u/c)),b=Math.abs(x)<5;r||(r=b?Fr.restSpeed.granular:Fr.restSpeed.default),a||(a=b?Fr.restDelta.granular:Fr.restDelta.default);let v;if(g<1){const N=qS(y,g);v=S=>{const C=Math.exp(-g*y*S);return i-C*((f+g*y*x)/N*Math.sin(N*S)+x*Math.cos(N*S))}}else if(g===1)v=N=>i-Math.exp(-y*N)*(x+(f+y*x)*N);else{const N=y*Math.sqrt(g*g-1);v=S=>{const C=Math.exp(-g*y*S),_=Math.min(N*S,300);return i-C*((f+g*y*x)*Math.sinh(_)+N*x*Math.cosh(_))/N}}const w={calculatedDuration:m&&h||null,next:N=>{const S=v(N);if(m)l.done=N>=h;else{let C=N===0?f:0;g<1&&(C=N===0?$o(f):d4(v,N,S));const _=Math.abs(C)<=r,T=Math.abs(i-S)<=a;l.done=_&&T}return l.value=l.done?i:S,l},toString:()=>{const N=Math.min(j_(w),Nw),S=c4(C=>w.next(N*C).value,N,30);return N+"ms "+S},toTransition:()=>{}};return w}kw.applyToOptions=e=>{const t=bJ(e,100,kw);return e.ease=t.ease,e.duration=$o(t.duration),e.type="keyframes",e};function KS({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:s=500,modifyTarget:i,min:l,max:u,restDelta:d=.5,restSpeed:c}){const h=e[0],p={done:!1,value:h},m=_=>l!==void 0&&_<l||u!==void 0&&_>u,f=_=>l===void 0?u:u===void 0||Math.abs(l-_)<Math.abs(u-_)?l:u;let g=n*t;const x=h+g,y=i===void 0?x:i(x);y!==x&&(g=y-h);const b=_=>-g*Math.exp(-_/r),v=_=>y+b(_),w=_=>{const T=b(_),E=v(_);p.done=Math.abs(T)<=d,p.value=p.done?y:E};let N,S;const C=_=>{m(p.value)&&(N=_,S=kw({keyframes:[p.value,f(p.value)],velocity:d4(v,_,p.value),damping:a,stiffness:s,restDelta:d,restSpeed:c}))};return C(0),{calculatedDuration:null,next:_=>{let T=!1;return!S&&N===void 0&&(T=!0,w(_),C(_)),N!==void 0&&_>=N?S.next(_-N):(!T&&w(_),p)}}}function IJ(e,t,n){const r=[],a=n||Il.mix||u4,s=e.length-1;for(let i=0;i<s;i++){let l=a(e[i],e[i+1]);if(t){const u=Array.isArray(t)?t[i]||vi:t;l=My(u,l)}r.push(l)}return r}function TJ(e,t,{clamp:n=!0,ease:r,mixer:a}={}){const s=e.length;if(w_(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const i=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=IJ(t,r,a),u=l.length,d=c=>{if(i&&c<e[0])return t[0];let h=0;if(u>1)for(;h<e.length-2&&!(c<e[h+1]);h++);const p=Zx(e[h],e[h+1],c);return l[h](p)};return n?c=>d(_l(e[0],e[s-1],c)):d}function EJ(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const a=Zx(0,t,r);e.push(Tr(n,1,a))}}function jJ(e){const t=[0];return EJ(t,e.length-1),t}function AJ(e,t){return e.map(n=>n*t)}function RJ(e,t){return e.map(()=>t||QO).splice(0,e.length-1)}function jx({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){const a=VQ(r)?r.map(HR):HR(r),s={done:!1,value:t[0]},i=AJ(n&&n.length===t.length?n:jJ(t),e),l=TJ(i,t,{ease:Array.isArray(a)?a:RJ(t,a)});return{calculatedDuration:e,next:u=>(s.value=l(u),s.done=u>=e,s)}}const DJ=e=>e!==null;function A_(e,{repeat:t,repeatType:n="loop"},r,a=1){const s=e.filter(DJ),l=a<0||t&&n!=="loop"&&t%2===1?0:s.length-1;return!l||r===void 0?s[l]:r}const MJ={decay:KS,inertia:KS,tween:jx,keyframes:jx,spring:kw};function h4(e){typeof e.type=="string"&&(e.type=MJ[e.type])}class R_{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const $J=e=>e/100;class D_ extends R_{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,a;const{motionValue:n}=this.options;n&&n.updatedAt!==js.now()&&this.tick(js.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(r=this.options).onStop)==null||a.call(r))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;h4(t);const{type:n=jx,repeat:r=0,repeatDelay:a=0,repeatType:s,velocity:i=0}=t;let{keyframes:l}=t;const u=n||jx;u!==jx&&typeof l[0]!="number"&&(this.mixKeyframes=My($J,u4(l[0],l[1])),l=[0,100]);const d=u({...t,keyframes:l});s==="mirror"&&(this.mirroredGenerator=u({...t,keyframes:[...l].reverse(),velocity:-i})),d.calculatedDuration===null&&(d.calculatedDuration=j_(d));const{calculatedDuration:c}=d;this.calculatedDuration=c,this.resolvedDuration=c+a,this.totalDuration=this.resolvedDuration*(r+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:r,totalDuration:a,mixKeyframes:s,mirroredGenerator:i,resolvedDuration:l,calculatedDuration:u}=this;if(this.startTime===null)return r.next(0);const{delay:d=0,keyframes:c,repeat:h,repeatType:p,repeatDelay:m,type:f,onUpdate:g,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const y=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?y<0:y>a;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let v=this.currentTime,w=r;if(h){const _=Math.min(this.currentTime,a)/l;let T=Math.floor(_),E=_%1;!E&&_>=1&&(E=1),E===1&&T--,T=Math.min(T,h+1),!!(T%2)&&(p==="reverse"?(E=1-E,m&&(E-=m/l)):p==="mirror"&&(w=i)),v=_l(0,1,E)*l}const N=b?{done:!1,value:c[0]}:w.next(v);s&&(N.value=s(N.value));let{done:S}=N;!b&&u!==null&&(S=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return C&&f!==KS&&(N.value=A_(c,this.options,x,this.speed)),g&&g(N.value),C&&this.finish(),N}then(t,n){return this.finished.then(t,n)}get duration(){return yi(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+yi(t)}get time(){return yi(this.currentTime)}set time(t){var n;t=$o(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(js.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=yi(this.currentTime))}play(){var a,s;if(this.isStopped)return;const{driver:t=yJ,startTime:n}=this.options;this.driver||(this.driver=t(i=>this.tick(i))),(s=(a=this.options).onPlay)==null||s.call(a);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(js.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function FJ(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Bc=e=>e*180/Math.PI,YS=e=>{const t=Bc(Math.atan2(e[1],e[0]));return XS(t)},PJ={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:YS,rotateZ:YS,skewX:e=>Bc(Math.atan(e[1])),skewY:e=>Bc(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},XS=e=>(e=e%360,e<0&&(e+=360),e),ZR=YS,QR=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),JR=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),OJ={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:QR,scaleY:JR,scale:e=>(QR(e)+JR(e))/2,rotateX:e=>XS(Bc(Math.atan2(e[6],e[5]))),rotateY:e=>XS(Bc(Math.atan2(-e[2],e[0]))),rotateZ:ZR,rotate:ZR,skewX:e=>Bc(Math.atan(e[4])),skewY:e=>Bc(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function ZS(e){return e.includes("scale")?1:0}function QS(e,t){if(!e||e==="none")return ZS(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,a;if(n)r=OJ,a=n;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=PJ,a=l}if(!a)return ZS(t);const s=r[t],i=a[1].split(",").map(zJ);return typeof s=="function"?s(i):i[s]}const LJ=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return QS(n,t)};function zJ(e){return parseFloat(e.trim())}const df=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],hf=new Set(df),eD=e=>e===cf||e===Wt,BJ=new Set(["x","y","z"]),WJ=df.filter(e=>!BJ.has(e));function VJ(e){const t=[];return WJ.forEach(n=>{const r=e.getValue(n);r!==void 0&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),t}const rd={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>QS(t,"x"),y:(e,{transform:t})=>QS(t,"y")};rd.translateX=rd.x;rd.translateY=rd.y;const ad=new Set;let JS=!1,e2=!1,t2=!1;function p4(){if(e2){const e=Array.from(ad).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),n=new Map;t.forEach(r=>{const a=VJ(r);a.length&&(n.set(r,a),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const a=n.get(r);a&&a.forEach(([s,i])=>{var l;(l=r.getValue(s))==null||l.set(i)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}e2=!1,JS=!1,ad.forEach(e=>e.complete(t2)),ad.clear()}function m4(){ad.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(e2=!0)})}function UJ(){t2=!0,m4(),p4(),t2=!1}class M_{constructor(t,n,r,a,s,i=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=r,this.motionValue=a,this.element=s,this.isAsync=i}scheduleResolve(){this.state="scheduled",this.isAsync?(ad.add(this),JS||(JS=!0,kr.read(m4),kr.resolveKeyframes(p4))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:r,motionValue:a}=this;if(t[0]===null){const s=a==null?void 0:a.get(),i=t[t.length-1];if(s!==void 0)t[0]=s;else if(r&&n){const l=r.readValue(n,i);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=i),a&&s===void 0&&a.set(t[0])}FJ(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),ad.delete(this)}cancel(){this.state==="scheduled"&&(ad.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const HJ=e=>e.startsWith("--");function GJ(e,t,n){HJ(t)?e.style.setProperty(t,n):e.style[t]=n}const qJ=N_(()=>window.ScrollTimeline!==void 0),KJ={};function YJ(e,t){const n=N_(e);return()=>KJ[t]??n()}const f4=YJ(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),mx=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,tD={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:mx([0,.65,.55,1]),circOut:mx([.55,0,1,.45]),backIn:mx([.31,.01,.66,-.59]),backOut:mx([.33,1.53,.69,.99])};function g4(e,t){if(e)return typeof e=="function"?f4()?c4(e,t):"ease-out":JO(e)?mx(e):Array.isArray(e)?e.map(n=>g4(n,t)||tD.easeOut):tD[e]}function XJ(e,t,n,{delay:r=0,duration:a=300,repeat:s=0,repeatType:i="loop",ease:l="easeOut",times:u}={},d=void 0){const c={[t]:n};u&&(c.offset=u);const h=g4(l,a);Array.isArray(h)&&(c.easing=h);const p={delay:r,duration:a,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:i==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),e.animate(c,p)}function x4(e){return typeof e=="function"&&"applyToOptions"in e}function ZJ({type:e,...t}){return x4(e)&&f4()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class QJ extends R_{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,!t)return;const{element:n,name:r,keyframes:a,pseudoElement:s,allowFlatten:i=!1,finalKeyframe:l,onComplete:u}=t;this.isPseudoElement=!!s,this.allowFlatten=i,this.options=t,w_(typeof t.type!="string");const d=ZJ(t);this.animation=XJ(n,r,a,d,s),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const c=A_(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(c):GJ(n,r,c),this.animation.cancel()}u==null||u(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,n;this.isPseudoElement||(n=(t=this.animation).commitStyles)==null||n.call(t)}get duration(){var n,r;const t=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return yi(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+yi(t)}get time(){return yi(Number(this.animation.currentTime)||0)}set time(t){this.finishedTime=null,this.animation.currentTime=$o(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(t){this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&qJ()?(this.animation.timeline=t,vi):n(this)}}const y4={anticipate:YO,backInOut:KO,circInOut:ZO};function JJ(e){return e in y4}function eee(e){typeof e.ease=="string"&&JJ(e.ease)&&(e.ease=y4[e.ease])}const nD=10;class tee extends QJ{constructor(t){eee(t),h4(t),super(t),t.startTime&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:r,onComplete:a,element:s,...i}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const l=new D_({...i,autoplay:!1}),u=$o(this.finishedTime??this.time);n.setWithVelocity(l.sample(u-nD).value,l.sample(u).value,nD),l.stop()}}const rD=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Mu.test(e)||e==="0")&&!e.startsWith("url("));function nee(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function ree(e,t,n,r){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],i=rD(a,t),l=rD(s,t);return!i||!l?!1:nee(e)||(n==="spring"||x4(n))&&r}function n2(e){e.duration=0,e.type="keyframes"}const aee=new Set(["opacity","clipPath","filter","transform"]),see=N_(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function iee(e){var c;const{motionValue:t,name:n,repeatDelay:r,repeatType:a,damping:s,type:i}=e;if(!(((c=t==null?void 0:t.owner)==null?void 0:c.current)instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:d}=t.owner.getProps();return see()&&n&&aee.has(n)&&(n!=="transform"||!d)&&!u&&!r&&a!=="mirror"&&s!==0&&i!=="inertia"}const oee=40;class lee extends R_{constructor({autoplay:t=!0,delay:n=0,type:r="keyframes",repeat:a=0,repeatDelay:s=0,repeatType:i="loop",keyframes:l,name:u,motionValue:d,element:c,...h}){var f;super(),this.stop=()=>{var g,x;this._animation&&(this._animation.stop(),(g=this.stopTimeline)==null||g.call(this)),(x=this.keyframeResolver)==null||x.cancel()},this.createdAt=js.now();const p={autoplay:t,delay:n,type:r,repeat:a,repeatDelay:s,repeatType:i,name:u,motionValue:d,element:c,...h},m=(c==null?void 0:c.KeyframeResolver)||M_;this.keyframeResolver=new m(l,(g,x,y)=>this.onKeyframesResolved(g,x,p,!y),u,d,c),(f=this.keyframeResolver)==null||f.scheduleResolve()}onKeyframesResolved(t,n,r,a){this.keyframeResolver=void 0;const{name:s,type:i,velocity:l,delay:u,isHandoff:d,onUpdate:c}=r;this.resolvedAt=js.now(),ree(t,s,i,l)||((Il.instantAnimations||!u)&&(c==null||c(A_(t,r,n))),t[0]=t[t.length-1],n2(r),r.repeat=0);const p={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>oee?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:t},m=!d&&iee(p)?new tee({...p,element:p.motionValue.owner.current}):new D_(p);m.finished.then(()=>this.notifyFinished()).catch(vi),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),UJ()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}const uee=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function cee(e){const t=uee.exec(e);if(!t)return[,];const[,n,r,a]=t;return[`--${n??r}`,a]}function b4(e,t,n=1){const[r,a]=cee(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const i=s.trim();return zO(i)?parseFloat(i):i}return __(a)?b4(a,t,n+1):a}function $_(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}const v4=new Set(["width","height","top","left","right","bottom",...df]),dee={test:e=>e==="auto",parse:e=>e},w4=e=>t=>t.test(e),N4=[cf,Wt,Fo,Jl,nJ,tJ,dee],aD=e=>N4.find(w4(e));function hee(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||WO(e):!0}const pee=new Set(["brightness","contrast","saturate","opacity"]);function mee(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=n.match(I_)||[];if(!r)return e;const a=n.replace(r,"");let s=pee.has(t)?1:0;return r!==n&&(s*=100),t+"("+s+a+")"}const fee=/\b([a-z-]*)\(.*?\)/gu,r2={...Mu,getAnimatableNone:e=>{const t=e.match(fee);return t?t.map(mee).join(" "):e}},sD={...cf,transform:Math.round},gee={rotate:Jl,rotateX:Jl,rotateY:Jl,rotateZ:Jl,scale:lv,scaleX:lv,scaleY:lv,scaleZ:lv,skew:Jl,skewX:Jl,skewY:Jl,distance:Wt,translateX:Wt,translateY:Wt,translateZ:Wt,x:Wt,y:Wt,z:Wt,perspective:Wt,transformPerspective:Wt,opacity:Qx,originX:GR,originY:GR,originZ:Wt},F_={borderWidth:Wt,borderTopWidth:Wt,borderRightWidth:Wt,borderBottomWidth:Wt,borderLeftWidth:Wt,borderRadius:Wt,radius:Wt,borderTopLeftRadius:Wt,borderTopRightRadius:Wt,borderBottomRightRadius:Wt,borderBottomLeftRadius:Wt,width:Wt,maxWidth:Wt,height:Wt,maxHeight:Wt,top:Wt,right:Wt,bottom:Wt,left:Wt,padding:Wt,paddingTop:Wt,paddingRight:Wt,paddingBottom:Wt,paddingLeft:Wt,margin:Wt,marginTop:Wt,marginRight:Wt,marginBottom:Wt,marginLeft:Wt,backgroundPositionX:Wt,backgroundPositionY:Wt,...gee,zIndex:sD,fillOpacity:Qx,strokeOpacity:Qx,numOctaves:sD},xee={...F_,color:Yr,backgroundColor:Yr,outlineColor:Yr,fill:Yr,stroke:Yr,borderColor:Yr,borderTopColor:Yr,borderRightColor:Yr,borderBottomColor:Yr,borderLeftColor:Yr,filter:r2,WebkitFilter:r2},k4=e=>xee[e];function S4(e,t){let n=k4(e);return n!==r2&&(n=Mu),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const yee=new Set(["auto","none","0"]);function bee(e,t,n){let r=0,a;for(;r<e.length&&!a;){const s=e[r];typeof s=="string"&&!yee.has(s)&&Jx(s).values.length&&(a=e[r]),r++}if(a&&n)for(const s of t)e[s]=S4(n,a)}class vee extends M_{constructor(t,n,r,a,s){super(t,n,r,a,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let d=t[u];if(typeof d=="string"&&(d=d.trim(),__(d))){const c=b4(d,n.current);c!==void 0&&(t[u]=c),u===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!v4.has(r)||t.length!==2)return;const[a,s]=t,i=aD(a),l=aD(s);if(i!==l)if(eD(i)&&eD(l))for(let u=0;u<t.length;u++){const d=t[u];typeof d=="string"&&(t[u]=parseFloat(d))}else rd[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,r=[];for(let a=0;a<t.length;a++)(t[a]===null||hee(t[a]))&&r.push(a);r.length&&bee(t,r,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=rd[r](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(r,a).jump(a,!1)}measureEndState(){var l;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const s=r.length-1,i=r[s];r[s]=rd[n](t.measureViewportBox(),window.getComputedStyle(t.current)),i!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=i),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([u,d])=>{t.getValue(u).set(d)}),this.resolveNoneKeyframes()}}function wee(e,t,n){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let r=document;const a=(n==null?void 0:n[e])??r.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e)}const C4=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function Nee(e){return BO(e)&&"offsetHeight"in e}const iD=30,kee=e=>!isNaN(parseFloat(e));class See{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var s;const a=js.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((s=this.events.change)==null||s.notify(this.current),this.dependents))for(const i of this.dependents)i.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=js.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=kee(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new k_);const r=this.events[t].add(n);return t==="change"?()=>{r(),kr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=js.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>iD)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,iD);return VO(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Im(e,t){return new See(e,t)}const{schedule:P_}=e4(queueMicrotask,!1),Wi={x:!1,y:!1};function _4(){return Wi.x||Wi.y}function Cee(e){return e==="x"||e==="y"?Wi[e]?null:(Wi[e]=!0,()=>{Wi[e]=!1}):Wi.x||Wi.y?null:(Wi.x=Wi.y=!0,()=>{Wi.x=Wi.y=!1})}function I4(e,t){const n=wee(e),r=new AbortController,a={passive:!0,...t,signal:r.signal};return[n,a,()=>r.abort()]}function oD(e){return!(e.pointerType==="touch"||_4())}function _ee(e,t,n={}){const[r,a,s]=I4(e,n),i=l=>{if(!oD(l))return;const{target:u}=l,d=t(u,l);if(typeof d!="function"||!u)return;const c=h=>{oD(h)&&(d(h),u.removeEventListener("pointerleave",c))};u.addEventListener("pointerleave",c,a)};return r.forEach(l=>{l.addEventListener("pointerenter",i,a)}),s}const T4=(e,t)=>t?e===t?!0:T4(e,t.parentElement):!1,O_=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Iee=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Tee(e){return Iee.has(e.tagName)||e.tabIndex!==-1}const Gv=new WeakSet;function lD(e){return t=>{t.key==="Enter"&&e(t)}}function tk(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Eee=(e,t)=>{const n=e.currentTarget;if(!n)return;const r=lD(()=>{if(Gv.has(n))return;tk(n,"down");const a=lD(()=>{tk(n,"up")}),s=()=>tk(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",s,t)});n.addEventListener("keydown",r,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),t)};function uD(e){return O_(e)&&!_4()}function jee(e,t,n={}){const[r,a,s]=I4(e,n),i=l=>{const u=l.currentTarget;if(!uD(l))return;Gv.add(u);const d=t(u,l),c=(m,f)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),Gv.has(u)&&Gv.delete(u),uD(m)&&typeof d=="function"&&d(m,{success:f})},h=m=>{c(m,u===window||u===document||n.useGlobalTarget||T4(u,m.target))},p=m=>{c(m,!1)};window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",p,a)};return r.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",i,a),Nee(l)&&(l.addEventListener("focus",d=>Eee(d,a)),!Tee(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),s}function E4(e){return BO(e)&&"ownerSVGElement"in e}function Aee(e){return E4(e)&&e.tagName==="svg"}const qa=e=>!!(e&&e.getVelocity),Ree=[...N4,Yr,Mu],Dee=e=>Ree.find(w4(e)),j4=k.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Mee(e=!0){const t=k.useContext(y_);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:a}=t,s=k.useId();k.useEffect(()=>{if(e)return a(s)},[e]);const i=k.useCallback(()=>e&&r&&r(s),[s,r,e]);return!n&&r?[!1,i]:[!0]}const A4=k.createContext({strict:!1}),cD={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Tm={};for(const e in cD)Tm[e]={isEnabled:t=>cD[e].some(n=>!!t[n])};function $ee(e){for(const t in e)Tm[t]={...Tm[t],...e[t]}}const Fee=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Sw(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Fee.has(e)}let R4=e=>!Sw(e);function Pee(e){typeof e=="function"&&(R4=t=>t.startsWith("on")?!Sw(t):e(t))}try{Pee(require("@emotion/is-prop-valid").default)}catch{}function Oee(e,t,n){const r={};for(const a in e)a==="values"&&typeof e.values=="object"||(R4(a)||n===!0&&Sw(a)||!t&&!Sw(a)||e.draggable&&a.startsWith("onDrag"))&&(r[a]=e[a]);return r}const W0=k.createContext({});function V0(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function ey(e){return typeof e=="string"||Array.isArray(e)}const L_=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],z_=["initial",...L_];function U0(e){return V0(e.animate)||z_.some(t=>ey(e[t]))}function D4(e){return!!(U0(e)||e.variants)}function Lee(e,t){if(U0(e)){const{initial:n,animate:r}=e;return{initial:n===!1||ey(n)?n:void 0,animate:ey(r)?r:void 0}}return e.inherit!==!1?t:{}}function zee(e){const{initial:t,animate:n}=Lee(e,k.useContext(W0));return k.useMemo(()=>({initial:t,animate:n}),[dD(t),dD(n)])}function dD(e){return Array.isArray(e)?e.join(" "):e}function hD(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Ug={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Wt.test(e))e=parseFloat(e);else return e;const n=hD(e,t.target.x),r=hD(e,t.target.y);return`${n}% ${r}%`}},Bee={correct:(e,{treeScale:t,projectionDelta:n})=>{const r=e,a=Mu.parse(e);if(a.length>5)return r;const s=Mu.createTransformer(e),i=typeof a[0]!="number"?1:0,l=n.x.scale*t.x,u=n.y.scale*t.y;a[0+i]/=l,a[1+i]/=u;const d=Tr(l,u,.5);return typeof a[2+i]=="number"&&(a[2+i]/=d),typeof a[3+i]=="number"&&(a[3+i]/=d),s(a)}},a2={borderRadius:{...Ug,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ug,borderTopRightRadius:Ug,borderBottomLeftRadius:Ug,borderBottomRightRadius:Ug,boxShadow:Bee};function M4(e,{layout:t,layoutId:n}){return hf.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!a2[e]||e==="opacity")}const Wee={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Vee=df.length;function Uee(e,t,n){let r="",a=!0;for(let s=0;s<Vee;s++){const i=df[s],l=e[i];if(l===void 0)continue;let u=!0;if(typeof l=="number"?u=l===(i.startsWith("scale")?1:0):u=parseFloat(l)===0,!u||n){const d=C4(l,F_[i]);if(!u){a=!1;const c=Wee[i]||i;r+=`${c}(${d}) `}n&&(t[i]=d)}}return r=r.trim(),n?r=n(t,a?"":r):a&&(r="none"),r}function B_(e,t,n){const{style:r,vars:a,transformOrigin:s}=e;let i=!1,l=!1;for(const u in t){const d=t[u];if(hf.has(u)){i=!0;continue}else if(n4(u)){a[u]=d;continue}else{const c=C4(d,F_[u]);u.startsWith("origin")?(l=!0,s[u]=c):r[u]=c}}if(t.transform||(i||n?r.transform=Uee(t,e.transform,n):r.transform&&(r.transform="none")),l){const{originX:u="50%",originY:d="50%",originZ:c=0}=s;r.transformOrigin=`${u} ${d} ${c}`}}const W_=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function $4(e,t,n){for(const r in t)!qa(t[r])&&!M4(r,n)&&(e[r]=t[r])}function Hee({transformTemplate:e},t){return k.useMemo(()=>{const n=W_();return B_(n,t,e),Object.assign({},n.vars,n.style)},[t])}function Gee(e,t){const n=e.style||{},r={};return $4(r,n,e),Object.assign(r,Hee(e,t)),r}function qee(e,t){const n={},r=Gee(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=r,n}const Kee={offset:"stroke-dashoffset",array:"stroke-dasharray"},Yee={offset:"strokeDashoffset",array:"strokeDasharray"};function Xee(e,t,n=1,r=0,a=!0){e.pathLength=1;const s=a?Kee:Yee;e[s.offset]=Wt.transform(-r);const i=Wt.transform(t),l=Wt.transform(n);e[s.array]=`${i} ${l}`}function F4(e,{attrX:t,attrY:n,attrScale:r,pathLength:a,pathSpacing:s=1,pathOffset:i=0,...l},u,d,c){if(B_(e,l,d),u){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:h,style:p}=e;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=(c==null?void 0:c.transformBox)??"fill-box",delete h.transformBox),t!==void 0&&(h.x=t),n!==void 0&&(h.y=n),r!==void 0&&(h.scale=r),a!==void 0&&Xee(h,a,s,i,!1)}const P4=()=>({...W_(),attrs:{}}),O4=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Zee(e,t,n,r){const a=k.useMemo(()=>{const s=P4();return F4(s,t,O4(r),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};$4(s,e.style,e),a.style={...s,...a.style}}return a}const Qee=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function V_(e){return typeof e!="string"||e.includes("-")?!1:!!(Qee.indexOf(e)>-1||/[A-Z]/u.test(e))}function Jee(e,t,n,{latestValues:r},a,s=!1){const l=(V_(e)?Zee:qee)(t,r,a,e),u=Oee(t,typeof e=="string",s),d=e!==k.Fragment?{...u,...l,ref:n}:{},{children:c}=t,h=k.useMemo(()=>qa(c)?c.get():c,[c]);return k.createElement(e,{...d,children:h})}function pD(e){const t=[{},{}];return e==null||e.values.forEach((n,r)=>{t[0][r]=n.get(),t[1][r]=n.getVelocity()}),t}function U_(e,t,n,r){if(typeof t=="function"){const[a,s]=pD(r);t=t(n!==void 0?n:e.custom,a,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,s]=pD(r);t=t(n!==void 0?n:e.custom,a,s)}return t}function qv(e){return qa(e)?e.get():e}function ete({scrapeMotionValuesFromProps:e,createRenderState:t},n,r,a){return{latestValues:tte(n,r,a,e),renderState:t()}}function tte(e,t,n,r){const a={},s=r(e,{});for(const p in s)a[p]=qv(s[p]);let{initial:i,animate:l}=e;const u=U0(e),d=D4(e);t&&d&&!u&&e.inherit!==!1&&(i===void 0&&(i=t.initial),l===void 0&&(l=t.animate));let c=n?n.initial===!1:!1;c=c||i===!1;const h=c?l:i;if(h&&typeof h!="boolean"&&!V0(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const f=U_(e,p[m]);if(f){const{transitionEnd:g,transition:x,...y}=f;for(const b in y){let v=y[b];if(Array.isArray(v)){const w=c?v.length-1:0;v=v[w]}v!==null&&(a[b]=v)}for(const b in g)a[b]=g[b]}}}return a}const L4=e=>(t,n)=>{const r=k.useContext(W0),a=k.useContext(y_),s=()=>ete(e,t,r,a);return n?s():$Q(s)};function H_(e,t,n){var s;const{style:r}=e,a={};for(const i in r)(qa(r[i])||t.style&&qa(t.style[i])||M4(i,e)||((s=n==null?void 0:n.getValue(i))==null?void 0:s.liveStyle)!==void 0)&&(a[i]=r[i]);return a}const nte=L4({scrapeMotionValuesFromProps:H_,createRenderState:W_});function z4(e,t,n){const r=H_(e,t,n);for(const a in e)if(qa(e[a])||qa(t[a])){const s=df.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;r[s]=e[a]}return r}const rte=L4({scrapeMotionValuesFromProps:z4,createRenderState:P4}),ate=Symbol.for("motionComponentSymbol");function qp(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function ste(e,t,n){return k.useCallback(r=>{r&&e.onMount&&e.onMount(r),t&&(r?t.mount(r):t.unmount()),n&&(typeof n=="function"?n(r):qp(n)&&(n.current=r))},[t])}const G_=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ite="framerAppearId",B4="data-"+G_(ite),W4=k.createContext({});function ote(e,t,n,r,a){var g,x;const{visualElement:s}=k.useContext(W0),i=k.useContext(A4),l=k.useContext(y_),u=k.useContext(j4).reducedMotion,d=k.useRef(null);r=r||i.renderer,!d.current&&r&&(d.current=r(e,{visualState:t,parent:s,props:n,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:u}));const c=d.current,h=k.useContext(W4);c&&!c.projection&&a&&(c.type==="html"||c.type==="svg")&&lte(d.current,n,a,h);const p=k.useRef(!1);k.useInsertionEffect(()=>{c&&p.current&&c.update(n,l)});const m=n[B4],f=k.useRef(!!m&&!((g=window.MotionHandoffIsComplete)!=null&&g.call(window,m))&&((x=window.MotionHasOptimisedAnimation)==null?void 0:x.call(window,m)));return FQ(()=>{c&&(p.current=!0,window.MotionIsMounted=!0,c.updateFeatures(),c.scheduleRenderMicrotask(),f.current&&c.animationState&&c.animationState.animateChanges())}),k.useEffect(()=>{c&&(!f.current&&c.animationState&&c.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{var y;(y=window.MotionHandoffMarkAsComplete)==null||y.call(window,m)}),f.current=!1),c.enteringChildren=void 0)}),c}function lte(e,t,n,r){const{layoutId:a,layout:s,drag:i,dragConstraints:l,layoutScroll:u,layoutRoot:d,layoutCrossfade:c}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:V4(e.parent)),e.projection.setOptions({layoutId:a,layout:s,alwaysMeasureLayout:!!i||l&&qp(l),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:c,layoutScroll:u,layoutRoot:d})}function V4(e){if(e)return e.options.allowProjection!==!1?e.projection:V4(e.parent)}function nk(e,{forwardMotionProps:t=!1}={},n,r){n&&$ee(n);const a=V_(e)?rte:nte;function s(l,u){let d;const c={...k.useContext(j4),...l,layoutId:ute(l)},{isStatic:h}=c,p=zee(l),m=a(l,h);if(!h&&x_){cte();const f=dte(c);d=f.MeasureLayout,p.visualElement=ote(e,m,c,r,f.ProjectionNode)}return o.jsxs(W0.Provider,{value:p,children:[d&&p.visualElement?o.jsx(d,{visualElement:p.visualElement,...c}):null,Jee(e,l,ste(m,p.visualElement,u),m,h,t)]})}s.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const i=k.forwardRef(s);return i[ate]=e,i}function ute({layoutId:e}){const t=k.useContext(LO).id;return t&&e!==void 0?t+"-"+e:e}function cte(e,t){k.useContext(A4).strict}function dte(e){const{drag:t,layout:n}=Tm;if(!t&&!n)return{};const r={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function hte(e,t){if(typeof Proxy>"u")return nk;const n=new Map,r=(s,i)=>nk(s,i,e,t),a=(s,i)=>r(s,i);return new Proxy(a,{get:(s,i)=>i==="create"?r:(n.has(i)||n.set(i,nk(i,void 0,e,t)),n.get(i))})}function U4({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function pte({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function mte(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function rk(e){return e===void 0||e===1}function s2({scale:e,scaleX:t,scaleY:n}){return!rk(e)||!rk(t)||!rk(n)}function Ic(e){return s2(e)||H4(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function H4(e){return mD(e.x)||mD(e.y)}function mD(e){return e&&e!=="0%"}function Cw(e,t,n){const r=e-n,a=t*r;return n+a}function fD(e,t,n,r,a){return a!==void 0&&(e=Cw(e,a,r)),Cw(e,n,r)+t}function i2(e,t=0,n=1,r,a){e.min=fD(e.min,t,n,r,a),e.max=fD(e.max,t,n,r,a)}function G4(e,{x:t,y:n}){i2(e.x,t.translate,t.scale,t.originPoint),i2(e.y,n.translate,n.scale,n.originPoint)}const gD=.999999999999,xD=1.0000000000001;function fte(e,t,n,r=!1){const a=n.length;if(!a)return;t.x=t.y=1;let s,i;for(let l=0;l<a;l++){s=n[l],i=s.projectionDelta;const{visualElement:u}=s.options;u&&u.props.style&&u.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Yp(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),i&&(t.x*=i.x.scale,t.y*=i.y.scale,G4(e,i)),r&&Ic(s.latestValues)&&Yp(e,s.latestValues))}t.x<xD&&t.x>gD&&(t.x=1),t.y<xD&&t.y>gD&&(t.y=1)}function Kp(e,t){e.min=e.min+t,e.max=e.max+t}function yD(e,t,n,r,a=.5){const s=Tr(e.min,e.max,a);i2(e,t,n,s,r)}function Yp(e,t){yD(e.x,t.x,t.scaleX,t.scale,t.originX),yD(e.y,t.y,t.scaleY,t.scale,t.originY)}function q4(e,t){return U4(mte(e.getBoundingClientRect(),t))}function gte(e,t,n){const r=q4(e,n),{scroll:a}=t;return a&&(Kp(r.x,a.offset.x),Kp(r.y,a.offset.y)),r}const bD=()=>({translate:0,scale:1,origin:0,originPoint:0}),Xp=()=>({x:bD(),y:bD()}),vD=()=>({min:0,max:0}),oa=()=>({x:vD(),y:vD()}),o2={current:null},K4={current:!1};function xte(){if(K4.current=!0,!!x_)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>o2.current=e.matches;e.addEventListener("change",t),t()}else o2.current=!1}const yte=new WeakMap;function bte(e,t,n){for(const r in t){const a=t[r],s=n[r];if(qa(a))e.addValue(r,a);else if(qa(s))e.addValue(r,Im(a,{owner:e}));else if(s!==a)if(e.hasValue(r)){const i=e.getValue(r);i.liveStyle===!0?i.jump(a):i.hasAnimated||i.set(a)}else{const i=e.getStaticValue(r);e.addValue(r,Im(i!==void 0?i:a,{owner:e}))}}for(const r in n)t[r]===void 0&&e.removeValue(r);return t}const wD=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class vte{scrapeMotionValuesFromProps(t,n,r){return{}}constructor({parent:t,props:n,presenceContext:r,reducedMotionConfig:a,blockInitialAnimation:s,visualState:i},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=M_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=js.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,kr.render(this.render,!1,!0))};const{latestValues:u,renderState:d}=i;this.latestValues=u,this.baseTarget={...u},this.initialValues=n.initial?{...u}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=l,this.blockInitialAnimation=!!s,this.isControllingVariants=U0(n),this.isVariantNode=D4(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:c,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const m=h[p];u[p]!==void 0&&qa(m)&&m.set(u[p])}}mount(t){var n;this.current=t,yte.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,a)=>this.bindToMotionValue(a,r)),K4.current||xte(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:o2.current,(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var t;this.projection&&this.projection.unmount(),Du(this.notifyUpdate),Du(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=hf.has(t);r&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",i=>{this.latestValues[t]=i,this.props.onUpdate&&kr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),s&&s(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Tm){const n=Tm[t];if(!n)continue;const{isEnabled:r,Feature:a}=n;if(!this.features[t]&&a&&r(this.props)&&(this.features[t]=new a(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):oa()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<wD.length;r++){const a=wD[r];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const s="on"+a,i=t[s];i&&(this.propEventSubscriptions[a]=this.on(a,i))}this.prevMotionValues=bte(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const r=this.values.get(t);n!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&n!==void 0&&(r=Im(n===null?void 0:n,{owner:this}),this.addValue(t,r)),r}readValue(t,n){let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(zO(r)||WO(r))?r=parseFloat(r):!Dee(r)&&Mu.test(n)&&(r=S4(t,n)),this.setBaseTarget(t,qa(r)?r.get():r)),qa(r)?r.get():r}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var s;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const i=U_(this.props,n,(s=this.presenceContext)==null?void 0:s.custom);i&&(r=i[t])}if(n&&r!==void 0)return r;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!qa(a)?a:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new k_),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){P_.render(this.render)}}class Y4 extends vte{constructor(){super(...arguments),this.KeyframeResolver=vee}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:r}){delete n[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;qa(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}function X4(e,{style:t,vars:n},r,a){const s=e.style;let i;for(i in t)s[i]=t[i];a==null||a.applyProjectionStyles(s,r);for(i in n)s.setProperty(i,n[i])}function wte(e){return window.getComputedStyle(e)}class Nte extends Y4{constructor(){super(...arguments),this.type="html",this.renderInstance=X4}readValueFromInstance(t,n){var r;if(hf.has(n))return(r=this.projection)!=null&&r.isProjecting?ZS(n):LJ(t,n);{const a=wte(t),s=(n4(n)?a.getPropertyValue(n):a[n])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:n}){return q4(t,n)}build(t,n,r){B_(t,n,r.transformTemplate)}scrapeMotionValuesFromProps(t,n,r){return H_(t,n,r)}}const Z4=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function kte(e,t,n,r){X4(e,t,void 0,r);for(const a in t.attrs)e.setAttribute(Z4.has(a)?a:G_(a),t.attrs[a])}class Ste extends Y4{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=oa}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(hf.has(n)){const r=k4(n);return r&&r.default||0}return n=Z4.has(n)?n:G_(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,r){return z4(t,n,r)}build(t,n,r){F4(t,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(t,n,r,a){kte(t,n,r,a)}mount(t){this.isSVGTag=O4(t.tagName),super.mount(t)}}const Cte=(e,t)=>V_(e)?new Ste(t):new Nte(t,{allowProjection:e!==k.Fragment});function rm(e,t,n){const r=e.getProps();return U_(r,t,n!==void 0?n:r.custom,e)}const l2=e=>Array.isArray(e);function _te(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,Im(n))}function Ite(e){return l2(e)?e[e.length-1]||0:e}function Tte(e,t){const n=rm(e,t);let{transitionEnd:r={},transition:a={},...s}=n||{};s={...s,...r};for(const i in s){const l=Ite(s[i]);_te(e,i,l)}}function Ete(e){return!!(qa(e)&&e.add)}function u2(e,t){const n=e.getValue("willChange");if(Ete(n))return n.add(t);if(!n&&Il.WillChange){const r=new Il.WillChange("auto");e.addValue("willChange",r),r.add(t)}}function Q4(e){return e.props[B4]}const jte=e=>e!==null;function Ate(e,{repeat:t,repeatType:n="loop"},r){const a=e.filter(jte),s=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[s]}const Rte={type:"spring",stiffness:500,damping:25,restSpeed:10},Dte=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),Mte={type:"keyframes",duration:.8},$te={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Fte=(e,{keyframes:t})=>t.length>2?Mte:hf.has(e)?e.startsWith("scale")?Dte(t[1]):Rte:$te;function Pte({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:a,repeat:s,repeatType:i,repeatDelay:l,from:u,elapsed:d,...c}){return!!Object.keys(c).length}const q_=(e,t,n,r={},a,s)=>i=>{const l=$_(r,e)||{},u=l.delay||r.delay||0;let{elapsed:d=0}=r;d=d-$o(u);const c={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:p=>{t.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{i(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:s?void 0:a};Pte(l)||Object.assign(c,Fte(e,c)),c.duration&&(c.duration=$o(c.duration)),c.repeatDelay&&(c.repeatDelay=$o(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let h=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(n2(c),c.delay===0&&(h=!0)),(Il.instantAnimations||Il.skipAnimations)&&(h=!0,n2(c),c.delay=0),c.allowFlatten=!l.type&&!l.ease,h&&!s&&t.get()!==void 0){const p=Ate(c.keyframes,l);if(p!==void 0){kr.update(()=>{c.onUpdate(p),c.onComplete()});return}}return l.isSync?new D_(c):new lee(c)};function Ote({protectedKeys:e,needsAnimating:t},n){const r=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,r}function J4(e,t,{delay:n=0,transitionOverride:r,type:a}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:i,...l}=t;r&&(s=r);const u=[],d=a&&e.animationState&&e.animationState.getState()[a];for(const c in l){const h=e.getValue(c,e.latestValues[c]??null),p=l[c];if(p===void 0||d&&Ote(d,c))continue;const m={delay:n,...$_(s||{},c)},f=h.get();if(f!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===f&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const y=Q4(e);if(y){const b=window.MotionHandoffAnimation(y,c,kr);b!==null&&(m.startTime=b,g=!0)}}u2(e,c),h.start(q_(c,h,p,e.shouldReduceMotion&&v4.has(c)?{type:!1}:m,e,g));const x=h.animation;x&&u.push(x)}return i&&Promise.all(u).then(()=>{kr.update(()=>{i&&Tte(e,i)})}),u}function eL(e,t,n,r=0,a=1){const s=Array.from(e).sort((d,c)=>d.sortNodePosition(c)).indexOf(t),i=e.size,l=(i-1)*r;return typeof n=="function"?n(s,i):a===1?s*r:l-s*r}function c2(e,t,n={}){var u;const r=rm(e,t,n.type==="exit"?(u=e.presenceContext)==null?void 0:u.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(a=n.transitionOverride);const s=r?()=>Promise.all(J4(e,r,n)):()=>Promise.resolve(),i=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:c=0,staggerChildren:h,staggerDirection:p}=a;return Lte(e,t,d,c,h,p,n)}:()=>Promise.resolve(),{when:l}=a;if(l){const[d,c]=l==="beforeChildren"?[s,i]:[i,s];return d().then(()=>c())}else return Promise.all([s(),i(n.delay)])}function Lte(e,t,n=0,r=0,a=0,s=1,i){const l=[];for(const u of e.variantChildren)u.notify("AnimationStart",t),l.push(c2(u,t,{...i,delay:n+(typeof r=="function"?0:r)+eL(e.variantChildren,u,r,a,s)}).then(()=>u.notify("AnimationComplete",t)));return Promise.all(l)}function zte(e,t,n={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const a=t.map(s=>c2(e,s,n));r=Promise.all(a)}else if(typeof t=="string")r=c2(e,t,n);else{const a=typeof t=="function"?rm(e,t,n.custom):t;r=Promise.all(J4(e,a,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}function tL(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}const Bte=z_.length;function nL(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?nL(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<Bte;n++){const r=z_[n],a=e.props[r];(ey(a)||a===!1)&&(t[r]=a)}return t}const Wte=[...L_].reverse(),Vte=L_.length;function Ute(e){return t=>Promise.all(t.map(({animation:n,options:r})=>zte(e,n,r)))}function Hte(e){let t=Ute(e),n=ND(),r=!0;const a=u=>(d,c)=>{var p;const h=rm(e,c,u==="exit"?(p=e.presenceContext)==null?void 0:p.custom:void 0);if(h){const{transition:m,transitionEnd:f,...g}=h;d={...d,...g,...f}}return d};function s(u){t=u(e)}function i(u){const{props:d}=e,c=nL(e.parent)||{},h=[],p=new Set;let m={},f=1/0;for(let x=0;x<Vte;x++){const y=Wte[x],b=n[y],v=d[y]!==void 0?d[y]:c[y],w=ey(v),N=y===u?b.isActive:null;N===!1&&(f=x);let S=v===c[y]&&v!==d[y]&&w;if(S&&r&&e.manuallyAnimateOnMount&&(S=!1),b.protectedKeys={...m},!b.isActive&&N===null||!v&&!b.prevProp||V0(v)||typeof v=="boolean")continue;const C=Gte(b.prevProp,v);let _=C||y===u&&b.isActive&&!S&&w||x>f&&w,T=!1;const E=Array.isArray(v)?v:[v];let j=E.reduce(a(y),{});N===!1&&(j={});const{prevResolvedValues:I={}}=b,D={...I,...j},F=$=>{_=!0,p.has($)&&(T=!0,p.delete($)),b.needsAnimating[$]=!0;const O=e.getValue($);O&&(O.liveStyle=!1)};for(const $ in D){const O=j[$],L=I[$];if(m.hasOwnProperty($))continue;let q=!1;l2(O)&&l2(L)?q=!tL(O,L):q=O!==L,q?O!=null?F($):p.add($):O!==void 0&&p.has($)?F($):b.protectedKeys[$]=!0}b.prevProp=v,b.prevResolvedValues=j,b.isActive&&(m={...m,...j}),r&&e.blockInitialAnimation&&(_=!1);const P=S&&C;_&&(!P||T)&&h.push(...E.map($=>{const O={type:y};if(typeof $=="string"&&r&&!P&&e.manuallyAnimateOnMount&&e.parent){const{parent:L}=e,q=rm(L,$);if(L.enteringChildren&&q){const{delayChildren:U}=q.transition||{};O.delay=eL(L.enteringChildren,e,U)}}return{animation:$,options:O}}))}if(p.size){const x={};if(typeof d.initial!="boolean"){const y=rm(e,Array.isArray(d.initial)?d.initial[0]:d.initial);y&&y.transition&&(x.transition=y.transition)}p.forEach(y=>{const b=e.getBaseTarget(y),v=e.getValue(y);v&&(v.liveStyle=!0),x[y]=b??null}),h.push({animation:x})}let g=!!h.length;return r&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(g=!1),r=!1,g?t(h):Promise.resolve()}function l(u,d){var h;if(n[u].isActive===d)return Promise.resolve();(h=e.variantChildren)==null||h.forEach(p=>{var m;return(m=p.animationState)==null?void 0:m.setActive(u,d)}),n[u].isActive=d;const c=i(u);for(const p in n)n[p].protectedKeys={};return c}return{animateChanges:i,setActive:l,setAnimateFunction:s,getState:()=>n,reset:()=>{n=ND()}}}function Gte(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!tL(t,e):!1}function Nc(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ND(){return{animate:Nc(!0),whileInView:Nc(),whileHover:Nc(),whileTap:Nc(),whileDrag:Nc(),whileFocus:Nc(),exit:Nc()}}class Ju{constructor(t){this.isMounted=!1,this.node=t}update(){}}class qte extends Ju{constructor(t){super(t),t.animationState||(t.animationState=Hte(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();V0(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let Kte=0;class Yte extends Ju{constructor(){super(...arguments),this.id=Kte++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Xte={animation:{Feature:qte},exit:{Feature:Yte}};function ty(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}function Py(e){return{point:{x:e.pageX,y:e.pageY}}}const Zte=e=>t=>O_(t)&&e(t,Py(t));function Ax(e,t,n,r){return ty(e,t,Zte(n),r)}const rL=1e-4,Qte=1-rL,Jte=1+rL,aL=.01,ene=0-aL,tne=0+aL;function cs(e){return e.max-e.min}function nne(e,t,n){return Math.abs(e-t)<=n}function kD(e,t,n,r=.5){e.origin=r,e.originPoint=Tr(t.min,t.max,e.origin),e.scale=cs(n)/cs(t),e.translate=Tr(n.min,n.max,e.origin)-e.originPoint,(e.scale>=Qte&&e.scale<=Jte||isNaN(e.scale))&&(e.scale=1),(e.translate>=ene&&e.translate<=tne||isNaN(e.translate))&&(e.translate=0)}function Rx(e,t,n,r){kD(e.x,t.x,n.x,r?r.originX:void 0),kD(e.y,t.y,n.y,r?r.originY:void 0)}function SD(e,t,n){e.min=n.min+t.min,e.max=e.min+cs(t)}function rne(e,t,n){SD(e.x,t.x,n.x),SD(e.y,t.y,n.y)}function CD(e,t,n){e.min=t.min-n.min,e.max=e.min+cs(t)}function _w(e,t,n){CD(e.x,t.x,n.x),CD(e.y,t.y,n.y)}function ci(e){return[e("x"),e("y")]}const sL=({current:e})=>e?e.ownerDocument.defaultView:null,_D=(e,t)=>Math.abs(e-t);function ane(e,t){const n=_D(e.x,t.x),r=_D(e.y,t.y);return Math.sqrt(n**2+r**2)}class iL{constructor(t,n,{transformPagePoint:r,contextWindow:a=window,dragSnapToOrigin:s=!1,distanceThreshold:i=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=sk(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,f=ane(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!f)return;const{point:g}=p,{timestamp:x}=Fa;this.history.push({...g,timestamp:x});const{onStart:y,onMove:b}=this.handlers;m||(y&&y(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=ak(m,this.transformPagePoint),kr.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:f,onSessionEnd:g,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=sk(p.type==="pointercancel"?this.lastMoveEventInfo:ak(m,this.transformPagePoint),this.history);this.startEvent&&f&&f(p,y),g&&g(p,y)},!O_(t))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=i,this.contextWindow=a||window;const l=Py(t),u=ak(l,this.transformPagePoint),{point:d}=u,{timestamp:c}=Fa;this.history=[{...d,timestamp:c}];const{onSessionStart:h}=n;h&&h(t,sk(u,this.history)),this.removeListeners=My(Ax(this.contextWindow,"pointermove",this.handlePointerMove),Ax(this.contextWindow,"pointerup",this.handlePointerUp),Ax(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Du(this.updatePoint)}}function ak(e,t){return t?{point:t(e.point)}:e}function ID(e,t){return{x:e.x-t.x,y:e.y-t.y}}function sk({point:e},t){return{point:e,delta:ID(e,oL(t)),offset:ID(e,sne(t)),velocity:ine(t,.1)}}function sne(e){return e[0]}function oL(e){return e[e.length-1]}function ine(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const a=oL(e);for(;n>=0&&(r=e[n],!(a.timestamp-r.timestamp>$o(t)));)n--;if(!r)return{x:0,y:0};const s=yi(a.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const i={x:(a.x-r.x)/s,y:(a.y-r.y)/s};return i.x===1/0&&(i.x=0),i.y===1/0&&(i.y=0),i}function one(e,{min:t,max:n},r){return t!==void 0&&e<t?e=r?Tr(t,e,r.min):Math.max(e,t):n!==void 0&&e>n&&(e=r?Tr(n,e,r.max):Math.min(e,n)),e}function TD(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function lne(e,{top:t,left:n,bottom:r,right:a}){return{x:TD(e.x,n,a),y:TD(e.y,t,r)}}function ED(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}function une(e,t){return{x:ED(e.x,t.x),y:ED(e.y,t.y)}}function cne(e,t){let n=.5;const r=cs(e),a=cs(t);return a>r?n=Zx(t.min,t.max-r,e.min):r>a&&(n=Zx(e.min,e.max-a,t.min)),_l(0,1,n)}function dne(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const d2=.35;function hne(e=d2){return e===!1?e=0:e===!0&&(e=d2),{x:jD(e,"left","right"),y:jD(e,"top","bottom")}}function jD(e,t,n){return{min:AD(e,t),max:AD(e,n)}}function AD(e,t){return typeof e=="number"?e:e[t]||0}const pne=new WeakMap;class mne{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=oa(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const s=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(Py(h).point)},i=(h,p)=>{const{drag:m,dragPropagation:f,onDragStart:g}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Cee(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ci(y=>{let b=this.getAxisMotionValue(y).get()||0;if(Fo.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const w=v.layout.layoutBox[y];w&&(b=cs(w)*(parseFloat(b)/100))}}this.originPoint[y]=b}),g&&kr.postRender(()=>g(h,p)),u2(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:g,onDrag:x}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:y}=p;if(f&&this.currentDirection===null){this.currentDirection=fne(y),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,y),this.updateAxis("y",p.point,y),this.visualElement.render(),x&&x(h,p)},u=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>ci(h=>{var p;return this.getAnimationState(h)==="paused"&&((p=this.getAxisMotionValue(h).animation)==null?void 0:p.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new iL(t,{onSessionStart:s,onStart:i,onMove:l,onSessionEnd:u,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,distanceThreshold:r,contextWindow:sL(this.visualElement)})}stop(t,n){const r=t||this.latestPointerEvent,a=n||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!a||!r)return;const{velocity:i}=a;this.startAnimation(i);const{onDragEnd:l}=this.getProps();l&&kr.postRender(()=>l(r,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,r){const{drag:a}=this.getProps();if(!r||!uv(t,a,this.currentDirection))return;const s=this.getAxisMotionValue(t);let i=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(i=one(i,this.constraints[t],this.elastic[t])),s.set(i)}resolveConstraints(){var s;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)==null?void 0:s.layout,a=this.constraints;t&&qp(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=lne(r.layoutBox,t):this.constraints=!1,this.elastic=hne(n),a!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ci(i=>{this.constraints!==!1&&this.getAxisMotionValue(i)&&(this.constraints[i]=dne(r.layoutBox[i],this.constraints[i]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!qp(t))return!1;const r=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const s=gte(r,a.root,this.visualElement.getTransformPagePoint());let i=une(a.layout.layoutBox,s);if(n){const l=n(pte(i));this.hasMutatedConstraints=!!l,l&&(i=U4(l))}return i}startAnimation(t){const{drag:n,dragMomentum:r,dragElastic:a,dragTransition:s,dragSnapToOrigin:i,onDragTransitionEnd:l}=this.getProps(),u=this.constraints||{},d=ci(c=>{if(!uv(c,n,this.currentDirection))return;let h=u&&u[c]||{};i&&(h={min:0,max:0});const p=a?200:1e6,m=a?40:1e7,f={type:"inertia",velocity:r?t[c]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(c,f)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const r=this.getAxisMotionValue(t);return u2(this.visualElement,t),r.start(q_(t,r,0,n,this.visualElement,!1))}stopAnimation(){ci(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){ci(t=>{var n;return(n=this.getAxisMotionValue(t).animation)==null?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)==null?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),a=r[n];return a||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){ci(n=>{const{drag:r}=this.getProps();if(!uv(n,r,this.currentDirection))return;const{projection:a}=this.visualElement,s=this.getAxisMotionValue(n);if(a&&a.layout){const{min:i,max:l}=a.layout.layoutBox[n];s.set(t[n]-Tr(i,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!qp(n)||!r||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};ci(i=>{const l=this.getAxisMotionValue(i);if(l&&this.constraints!==!1){const u=l.get();a[i]=cne({min:u,max:u},this.constraints[i])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),ci(i=>{if(!uv(i,t,null))return;const l=this.getAxisMotionValue(i),{min:u,max:d}=this.constraints[i];l.set(Tr(u,d,a[i]))})}addListeners(){if(!this.visualElement.current)return;pne.set(this.visualElement,this);const t=this.visualElement.current,n=Ax(t,"pointerdown",u=>{const{drag:d,dragListener:c=!0}=this.getProps();d&&c&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();qp(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,s=a.addEventListener("measure",r);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),kr.read(r);const i=ty(window,"resize",()=>this.scalePositionWithinConstraints()),l=a.addEventListener("didUpdate",({delta:u,hasLayoutChanged:d})=>{this.isDragging&&d&&(ci(c=>{const h=this.getAxisMotionValue(c);h&&(this.originPoint[c]+=u[c].translate,h.set(h.get()+u[c].translate))}),this.visualElement.render())});return()=>{i(),n(),s(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:a=!1,dragConstraints:s=!1,dragElastic:i=d2,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:r,dragPropagation:a,dragConstraints:s,dragElastic:i,dragMomentum:l}}}function uv(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function fne(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class gne extends Ju{constructor(t){super(t),this.removeGroupControls=vi,this.removeListeners=vi,this.controls=new mne(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||vi}unmount(){this.removeGroupControls(),this.removeListeners()}}const RD=e=>(t,n)=>{e&&kr.postRender(()=>e(t,n))};class xne extends Ju{constructor(){super(...arguments),this.removePointerDownListener=vi}onPointerDown(t){this.session=new iL(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:sL(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:r,onPanEnd:a}=this.node.getProps();return{onSessionStart:RD(t),onStart:RD(n),onMove:r,onEnd:(s,i)=>{delete this.session,a&&kr.postRender(()=>a(s,i))}}}mount(){this.removePointerDownListener=Ax(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Kv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let ik=!1;class yne extends k.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r,layoutId:a}=this.props,{projection:s}=t;s&&(n.group&&n.group.add(s),r&&r.register&&a&&r.register(s),ik&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),Kv.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:r,drag:a,isPresent:s}=this.props,{projection:i}=r;return i&&(i.isPresent=s,ik=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==s?i.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?i.promote():i.relegate()||kr.postRender(()=>{const l=i.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),P_.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:a}=t;ik=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),r&&r.deregister&&r.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function lL(e){const[t,n]=Mee(),r=k.useContext(LO);return o.jsx(yne,{...e,layoutGroup:r,switchLayoutGroup:k.useContext(W4),isPresent:t,safeToRemove:n})}function bne(e,t,n){const r=qa(e)?e:Im(e);return r.start(q_("",r,t,n)),r.animation}const vne=(e,t)=>e.depth-t.depth;class wne{constructor(){this.children=[],this.isDirty=!1}add(t){b_(this.children,t),this.isDirty=!0}remove(t){v_(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(vne),this.isDirty=!1,this.children.forEach(t)}}function Nne(e,t){const n=js.now(),r=({timestamp:a})=>{const s=a-n;s>=t&&(Du(r),e(s-t))};return kr.setup(r,!0),()=>Du(r)}const uL=["TopLeft","TopRight","BottomLeft","BottomRight"],kne=uL.length,DD=e=>typeof e=="string"?parseFloat(e):e,MD=e=>typeof e=="number"||Wt.test(e);function Sne(e,t,n,r,a,s){a?(e.opacity=Tr(0,n.opacity??1,Cne(r)),e.opacityExit=Tr(t.opacity??1,0,_ne(r))):s&&(e.opacity=Tr(t.opacity??1,n.opacity??1,r));for(let i=0;i<kne;i++){const l=`border${uL[i]}Radius`;let u=$D(t,l),d=$D(n,l);if(u===void 0&&d===void 0)continue;u||(u=0),d||(d=0),u===0||d===0||MD(u)===MD(d)?(e[l]=Math.max(Tr(DD(u),DD(d),r),0),(Fo.test(d)||Fo.test(u))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=Tr(t.rotate||0,n.rotate||0,r))}function $D(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Cne=cL(0,.5,XO),_ne=cL(.5,.95,vi);function cL(e,t,n){return r=>r<e?0:r>t?1:n(Zx(e,t,r))}function FD(e,t){e.min=t.min,e.max=t.max}function Oi(e,t){FD(e.x,t.x),FD(e.y,t.y)}function PD(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function OD(e,t,n,r,a){return e-=t,e=Cw(e,1/n,r),a!==void 0&&(e=Cw(e,1/a,r)),e}function Ine(e,t=0,n=1,r=.5,a,s=e,i=e){if(Fo.test(t)&&(t=parseFloat(t),t=Tr(i.min,i.max,t/100)-i.min),typeof t!="number")return;let l=Tr(s.min,s.max,r);e===s&&(l-=t),e.min=OD(e.min,t,n,l,a),e.max=OD(e.max,t,n,l,a)}function LD(e,t,[n,r,a],s,i){Ine(e,t[n],t[r],t[a],t.scale,s,i)}const Tne=["x","scaleX","originX"],Ene=["y","scaleY","originY"];function zD(e,t,n,r){LD(e.x,t,Tne,n?n.x:void 0,r?r.x:void 0),LD(e.y,t,Ene,n?n.y:void 0,r?r.y:void 0)}function BD(e){return e.translate===0&&e.scale===1}function dL(e){return BD(e.x)&&BD(e.y)}function WD(e,t){return e.min===t.min&&e.max===t.max}function jne(e,t){return WD(e.x,t.x)&&WD(e.y,t.y)}function VD(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function hL(e,t){return VD(e.x,t.x)&&VD(e.y,t.y)}function UD(e){return cs(e.x)/cs(e.y)}function HD(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class Ane{constructor(){this.members=[]}add(t){b_(this.members,t),t.scheduleRender()}remove(t){if(v_(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let r;for(let a=n;a>=0;a--){const s=this.members[a];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,n){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender(),t.resumeFrom=r,n&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:a}=t.options;a===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:r}=t;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Rne(e,t,n){let r="";const a=e.x.translate/t.x,s=e.y.translate/t.y,i=(n==null?void 0:n.z)||0;if((a||s||i)&&(r=`translate3d(${a}px, ${s}px, ${i}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:c,rotateX:h,rotateY:p,skewX:m,skewY:f}=n;d&&(r=`perspective(${d}px) ${r}`),c&&(r+=`rotate(${c}deg) `),h&&(r+=`rotateX(${h}deg) `),p&&(r+=`rotateY(${p}deg) `),m&&(r+=`skewX(${m}deg) `),f&&(r+=`skewY(${f}deg) `)}const l=e.x.scale*t.x,u=e.y.scale*t.y;return(l!==1||u!==1)&&(r+=`scale(${l}, ${u})`),r||"none"}const ok=["","X","Y","Z"],Dne=1e3;let Mne=0;function lk(e,t,n,r){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),r&&(r[e]=0))}function pL(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=Q4(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",kr,!(a||s))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&pL(r)}function mL({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:a}){return class{constructor(i={},l=t==null?void 0:t()){this.id=Mne++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Pne),this.nodes.forEach(Bne),this.nodes.forEach(Wne),this.nodes.forEach(One)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=i,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new wne)}addEventListener(i,l){return this.eventHandlers.has(i)||this.eventHandlers.set(i,new k_),this.eventHandlers.get(i).add(l)}notifyListeners(i,...l){const u=this.eventHandlers.get(i);u&&u.notify(...l)}hasListeners(i){return this.eventHandlers.has(i)}mount(i){if(this.instance)return;this.isSVG=E4(i)&&!Aee(i),this.instance=i;const{layoutId:l,layout:u,visualElement:d}=this.options;if(d&&!d.current&&d.mount(i),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(u||l)&&(this.isLayoutDirty=!0),e){let c,h=0;const p=()=>this.root.updateBlockedByResize=!1;kr.read(()=>{h=window.innerWidth}),e(i,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,c&&c(),c=Nne(p,250),Kv.hasAnimatedSinceResize&&(Kv.hasAnimatedSinceResize=!1,this.nodes.forEach(KD)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||u)&&this.addEventListener("didUpdate",({delta:c,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const f=this.options.transition||d.getDefaultTransition()||qne,{onLayoutAnimationStart:g,onLayoutAnimationComplete:x}=d.getProps(),y=!this.targetLayout||!hL(this.targetLayout,m),b=!h&&p;if(this.options.layoutRoot||this.resumeFrom||b||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...$_(f,"layout"),onPlay:g,onComplete:x};(d.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(c,b)}else h||KD(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const i=this.getStack();i&&i.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Du(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Vne),this.animationId++)}getTransformTemplate(){const{visualElement:i}=this.options;return i&&i.getProps().transformTemplate}willUpdate(i=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&pL(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const h=this.path[c];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:u}=this.options;if(l===void 0&&!u)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),i&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(GD);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(qD);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(zne),this.nodes.forEach($ne),this.nodes.forEach(Fne)):this.nodes.forEach(qD),this.clearAllSnapshots();const l=js.now();Fa.delta=_l(0,1e3/60,l-Fa.timestamp),Fa.timestamp=l,Fa.isProcessing=!0,XN.update.process(Fa),XN.preRender.process(Fa),XN.render.process(Fa),Fa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,P_.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Lne),this.sharedNodes.forEach(Une)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,kr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){kr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!cs(this.snapshot.measuredBox.x)&&!cs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const i=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=oa(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,i?i.layoutBox:void 0)}updateScroll(i="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===i&&(l=!1),l&&this.instance){const u=r(this.instance);this.scroll={animationId:this.root.animationId,phase:i,isRoot:u,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!a)return;const i=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!dL(this.projectionDelta),u=this.getTransformTemplate(),d=u?u(this.latestValues,""):void 0,c=d!==this.prevTransformTemplateValue;i&&this.instance&&(l||Ic(this.latestValues)||c)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(i=!0){const l=this.measurePageBox();let u=this.removeElementScroll(l);return i&&(u=this.removeTransform(u)),Kne(u),{animationId:this.root.animationId,measuredBox:l,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:i}=this.options;if(!i)return oa();const l=i.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(Yne))){const{scroll:c}=this.root;c&&(Kp(l.x,c.offset.x),Kp(l.y,c.offset.y))}return l}removeElementScroll(i){var u;const l=oa();if(Oi(l,i),(u=this.scroll)!=null&&u.wasRoot)return l;for(let d=0;d<this.path.length;d++){const c=this.path[d],{scroll:h,options:p}=c;c!==this.root&&h&&p.layoutScroll&&(h.wasRoot&&Oi(l,i),Kp(l.x,h.offset.x),Kp(l.y,h.offset.y))}return l}applyTransform(i,l=!1){const u=oa();Oi(u,i);for(let d=0;d<this.path.length;d++){const c=this.path[d];!l&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Yp(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),Ic(c.latestValues)&&Yp(u,c.latestValues)}return Ic(this.latestValues)&&Yp(u,this.latestValues),u}removeTransform(i){const l=oa();Oi(l,i);for(let u=0;u<this.path.length;u++){const d=this.path[u];if(!d.instance||!Ic(d.latestValues))continue;s2(d.latestValues)&&d.updateSnapshot();const c=oa(),h=d.measurePageBox();Oi(c,h),zD(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,c)}return Ic(this.latestValues)&&zD(l,this.latestValues),l}setTargetDelta(i){this.targetDelta=i,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(i){this.options={...this.options,...i,crossfade:i.crossfade!==void 0?i.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(i=!1){var m;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==l;if(!(i||u&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:c,layoutId:h}=this.options;if(!this.layout||!(c||h))return;this.resolvedRelativeTargetAt=Fa.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=oa(),this.targetWithTransforms=oa()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),rne(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Oi(this.target,this.layout.layoutBox),G4(this.target,this.targetDelta)):Oi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||s2(this.parent.latestValues)||H4(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(i,l,u){this.relativeParent=i,this.linkedParentVersion=i.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=oa(),this.relativeTargetOrigin=oa(),_w(this.relativeTargetOrigin,l,u),Oi(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var f;const i=this.getLead(),l=!!this.resumingFrom||this!==i;let u=!0;if((this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty)&&(u=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===Fa.timestamp&&(u=!1),u)return;const{layout:d,layoutId:c}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||c))return;Oi(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;fte(this.layoutCorrected,this.treeScale,this.path,l),i.layout&&!i.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(i.target=i.layout.layoutBox,i.targetWithTransforms=oa());const{target:m}=i;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(PD(this.prevProjectionDelta.x,this.projectionDelta.x),PD(this.prevProjectionDelta.y,this.projectionDelta.y)),Rx(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!HD(this.projectionDelta.x,this.prevProjectionDelta.x)||!HD(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(i=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),i){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Xp(),this.projectionDelta=Xp(),this.projectionDeltaWithTransform=Xp()}setAnimationOrigin(i,l=!1){const u=this.snapshot,d=u?u.latestValues:{},c={...this.latestValues},h=Xp();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=oa(),m=u?u.source:void 0,f=this.layout?this.layout.source:void 0,g=m!==f,x=this.getStack(),y=!x||x.members.length<=1,b=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(Gne));this.animationProgress=0;let v;this.mixTargetDelta=w=>{const N=w/1e3;YD(h.x,i.x,N),YD(h.y,i.y,N),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(_w(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Hne(this.relativeTarget,this.relativeTargetOrigin,p,N),v&&jne(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=oa()),Oi(v,this.relativeTarget)),g&&(this.animationValues=c,Sne(c,d,this.latestValues,N,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=N},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(i){var l,u,d;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(d=(u=this.resumingFrom)==null?void 0:u.currentAnimation)==null||d.stop(),this.pendingAnimation&&(Du(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=kr.update(()=>{Kv.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Im(0)),this.currentAnimation=bne(this.motionValue,[0,1e3],{...i,velocity:0,isSync:!0,onUpdate:c=>{this.mixTargetDelta(c),i.onUpdate&&i.onUpdate(c)},onStop:()=>{},onComplete:()=>{i.onComplete&&i.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const i=this.getStack();i&&i.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Dne),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const i=this.getLead();let{targetWithTransforms:l,target:u,layout:d,latestValues:c}=i;if(!(!l||!u||!d)){if(this!==i&&this.layout&&d&&fL(this.options.animationType,this.layout.layoutBox,d.layoutBox)){u=this.target||oa();const h=cs(this.layout.layoutBox.x);u.x.min=i.target.x.min,u.x.max=u.x.min+h;const p=cs(this.layout.layoutBox.y);u.y.min=i.target.y.min,u.y.max=u.y.min+p}Oi(l,u),Yp(l,c),Rx(this.projectionDeltaWithTransform,this.layoutCorrected,l,c)}}registerSharedNode(i,l){this.sharedNodes.has(i)||this.sharedNodes.set(i,new Ane),this.sharedNodes.get(i).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const i=this.getStack();return i?i.lead===this:!0}getLead(){var l;const{layoutId:i}=this.options;return i?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:i}=this.options;return i?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:i}=this.options;if(i)return this.root.sharedNodes.get(i)}promote({needsReset:i,transition:l,preserveFollowOpacity:u}={}){const d=this.getStack();d&&d.promote(this,u),i&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const i=this.getStack();return i?i.relegate(this):!1}resetSkewAndRotation(){const{visualElement:i}=this.options;if(!i)return;let l=!1;const{latestValues:u}=i;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(l=!0),!l)return;const d={};u.z&&lk("z",i,d,this.animationValues);for(let c=0;c<ok.length;c++)lk(`rotate${ok[c]}`,i,d,this.animationValues),lk(`skew${ok[c]}`,i,d,this.animationValues);i.render();for(const c in d)i.setStaticValue(c,d[c]),this.animationValues&&(this.animationValues[c]=d[c]);i.scheduleRender()}applyProjectionStyles(i,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){i.visibility="hidden";return}const u=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,i.visibility="",i.opacity="",i.pointerEvents=qv(l==null?void 0:l.pointerEvents)||"",i.transform=u?u(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(i.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,i.pointerEvents=qv(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!Ic(this.latestValues)&&(i.transform=u?u({},""):"none",this.hasProjected=!1);return}i.visibility="";const c=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=Rne(this.projectionDeltaWithTransform,this.treeScale,c);u&&(h=u(c,h)),i.transform=h;const{x:p,y:m}=this.projectionDelta;i.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?i.opacity=d===this?c.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:i.opacity=d===this?c.opacity!==void 0?c.opacity:"":c.opacityExit!==void 0?c.opacityExit:0;for(const f in a2){if(c[f]===void 0)continue;const{correct:g,applyTo:x,isCSSVariable:y}=a2[f],b=h==="none"?c[f]:g(c[f],d);if(x){const v=x.length;for(let w=0;w<v;w++)i[x[w]]=b}else y?this.options.visualElement.renderState.vars[f]=b:i[f]=b}this.options.layoutId&&(i.pointerEvents=d===this?qv(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(i=>{var l;return(l=i.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(GD),this.root.sharedNodes.clear()}}}function $ne(e){e.updateLayout()}function Fne(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:a}=e.layout,{animationType:s}=e.options,i=t.source!==e.layout.source;s==="size"?ci(h=>{const p=i?t.measuredBox[h]:t.layoutBox[h],m=cs(p);p.min=r[h].min,p.max=p.min+m}):fL(s,t.layoutBox,r)&&ci(h=>{const p=i?t.measuredBox[h]:t.layoutBox[h],m=cs(r[h]);p.max=p.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+m)});const l=Xp();Rx(l,r,t.layoutBox);const u=Xp();i?Rx(u,e.applyTransform(a,!0),t.measuredBox):Rx(u,r,t.layoutBox);const d=!dL(l);let c=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:m}=h;if(p&&m){const f=oa();_w(f,t.layoutBox,p.layoutBox);const g=oa();_w(g,r,m.layoutBox),hL(f,g)||(c=!0),h.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=f,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:u,layoutDelta:l,hasLayoutChanged:d,hasRelativeLayoutChanged:c})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Pne(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function One(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Lne(e){e.clearSnapshot()}function GD(e){e.clearMeasurements()}function qD(e){e.isLayoutDirty=!1}function zne(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function KD(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Bne(e){e.resolveTargetDelta()}function Wne(e){e.calcProjection()}function Vne(e){e.resetSkewAndRotation()}function Une(e){e.removeLeadSnapshot()}function YD(e,t,n){e.translate=Tr(t.translate,0,n),e.scale=Tr(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function XD(e,t,n,r){e.min=Tr(t.min,n.min,r),e.max=Tr(t.max,n.max,r)}function Hne(e,t,n,r){XD(e.x,t.x,n.x,r),XD(e.y,t.y,n.y,r)}function Gne(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const qne={duration:.45,ease:[.4,0,.1,1]},ZD=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),QD=ZD("applewebkit/")&&!ZD("chrome/")?Math.round:vi;function JD(e){e.min=QD(e.min),e.max=QD(e.max)}function Kne(e){JD(e.x),JD(e.y)}function fL(e,t,n){return e==="position"||e==="preserve-aspect"&&!nne(UD(t),UD(n),.2)}function Yne(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const Xne=mL({attachResizeListener:(e,t)=>ty(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),uk={current:void 0},gL=mL({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!uk.current){const e=new Xne({});e.mount(window),e.setOptions({layoutScroll:!0}),uk.current=e}return uk.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Zne={pan:{Feature:xne},drag:{Feature:gne,ProjectionNode:gL,MeasureLayout:lL}};function eM(e,t,n){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,s=r[a];s&&kr.postRender(()=>s(t,Py(t)))}class Qne extends Ju{mount(){const{current:t}=this.node;t&&(this.unmount=_ee(t,(n,r)=>(eM(this.node,r,"Start"),a=>eM(this.node,a,"End"))))}unmount(){}}class Jne extends Ju{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=My(ty(this.node.current,"focus",()=>this.onFocus()),ty(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function tM(e,t,n){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),s=r[a];s&&kr.postRender(()=>s(t,Py(t)))}class ere extends Ju{mount(){const{current:t}=this.node;t&&(this.unmount=jee(t,(n,r)=>(tM(this.node,r,"Start"),(a,{success:s})=>tM(this.node,a,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const h2=new WeakMap,ck=new WeakMap,tre=e=>{const t=h2.get(e.target);t&&t(e)},nre=e=>{e.forEach(tre)};function rre({root:e,...t}){const n=e||document;ck.has(n)||ck.set(n,{});const r=ck.get(n),a=JSON.stringify(t);return r[a]||(r[a]=new IntersectionObserver(nre,{root:e,...t})),r[a]}function are(e,t,n){const r=rre(t);return h2.set(e,n),r.observe(e),()=>{h2.delete(e),r.unobserve(e)}}const sre={some:0,all:1};class ire extends Ju{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:r,amount:a="some",once:s}=t,i={root:n?n.current:void 0,rootMargin:r,threshold:typeof a=="number"?a:sre[a]},l=u=>{const{isIntersecting:d}=u;if(this.isInView===d||(this.isInView=d,s&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:c,onViewportLeave:h}=this.node.getProps(),p=d?c:h;p&&p(u)};return are(this.node.current,i,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(ore(t,n))&&this.startObserver()}unmount(){}}function ore({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const lre={inView:{Feature:ire},tap:{Feature:ere},focus:{Feature:Jne},hover:{Feature:Qne}},ure={layout:{ProjectionNode:gL,MeasureLayout:lL}},cre={...Xte,...lre,...Zne,...ure},nM=hte(cre,Cte),rM=[{icon:Js,title:"NFC & QR Sharing",color:"from-blue-500 to-cyan-500"},{icon:o_,title:"Auto Lead Capture",color:"from-purple-500 to-pink-500"},{icon:Sm,title:"One-Click Follow-up",color:"from-green-500 to-emerald-500"},{icon:Ru,title:"Event Tagging",color:"from-orange-500 to-amber-500"},{icon:Cl,title:"Built-in CRM",color:"from-indigo-500 to-violet-500"},{icon:s_,title:"Analytics",color:"from-rose-500 to-red-500"},{icon:L3,title:"AI Templates",color:"from-yellow-500 to-orange-500"},{icon:af,title:"Secure",color:"from-teal-500 to-cyan-500"}];function dre(){return o.jsxs("div",{className:"relative overflow-hidden",children:[o.jsx("div",{className:"flex gap-3 overflow-hidden py-2 px-4",children:o.jsx("div",{className:"flex gap-3",style:{animation:"mobileScroll 20s linear infinite"},children:[...rM,...rM].map((e,t)=>o.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 px-3 py-2 rounded-full bg-card border border-border/50 shadow-sm",children:[o.jsx("div",{className:`w-7 h-7 rounded-lg bg-gradient-to-br ${e.color} flex items-center justify-center`,children:o.jsx(e.icon,{className:"h-3.5 w-3.5 text-white"})}),o.jsx("span",{className:"text-xs font-medium text-foreground whitespace-nowrap",children:e.title})]},t))})}),o.jsx("style",{children:`
        @keyframes mobileScroll {
          0% { transform: translateX(0); }
          100% { transform: translateX(-50%); }
        }
      `})]})}function p2(e,[t,n]){return Math.min(n,Math.max(t,e))}function hre(e,t){return k.useReducer((n,r)=>t[n][r]??n,e)}var K_="ScrollArea",[xL]=qo(K_),[pre,Ii]=xL(K_),yL=k.forwardRef((e,t)=>{const{__scopeScrollArea:n,type:r="hover",dir:a,scrollHideDelay:s=600,...i}=e,[l,u]=k.useState(null),[d,c]=k.useState(null),[h,p]=k.useState(null),[m,f]=k.useState(null),[g,x]=k.useState(null),[y,b]=k.useState(0),[v,w]=k.useState(0),[N,S]=k.useState(!1),[C,_]=k.useState(!1),T=sr(t,j=>u(j)),E=F0(a);return o.jsx(pre,{scope:n,type:r,dir:E,scrollHideDelay:s,scrollArea:l,viewport:d,onViewportChange:c,content:h,onContentChange:p,scrollbarX:m,onScrollbarXChange:f,scrollbarXEnabled:N,onScrollbarXEnabledChange:S,scrollbarY:g,onScrollbarYChange:x,scrollbarYEnabled:C,onScrollbarYEnabledChange:_,onCornerWidthChange:b,onCornerHeightChange:w,children:o.jsx(An.div,{dir:E,...i,ref:T,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});yL.displayName=K_;var bL="ScrollAreaViewport",vL=k.forwardRef((e,t)=>{const{__scopeScrollArea:n,children:r,nonce:a,...s}=e,i=Ii(bL,n),l=k.useRef(null),u=sr(t,l,i.onViewportChange);return o.jsxs(o.Fragment,{children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),o.jsx(An.div,{"data-radix-scroll-area-viewport":"",...s,ref:u,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:o.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});vL.displayName=bL;var Yo="ScrollAreaScrollbar",Y_=k.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ii(Yo,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:i}=a,l=e.orientation==="horizontal";return k.useEffect(()=>(l?s(!0):i(!0),()=>{l?s(!1):i(!1)}),[l,s,i]),a.type==="hover"?o.jsx(mre,{...r,ref:t,forceMount:n}):a.type==="scroll"?o.jsx(fre,{...r,ref:t,forceMount:n}):a.type==="auto"?o.jsx(wL,{...r,ref:t,forceMount:n}):a.type==="always"?o.jsx(X_,{...r,ref:t}):null});Y_.displayName=Yo;var mre=k.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ii(Yo,e.__scopeScrollArea),[s,i]=k.useState(!1);return k.useEffect(()=>{const l=a.scrollArea;let u=0;if(l){const d=()=>{window.clearTimeout(u),i(!0)},c=()=>{u=window.setTimeout(()=>i(!1),a.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",c),()=>{window.clearTimeout(u),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",c)}}},[a.scrollArea,a.scrollHideDelay]),o.jsx(Al,{present:n||s,children:o.jsx(wL,{"data-state":s?"visible":"hidden",...r,ref:t})})}),fre=k.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ii(Yo,e.__scopeScrollArea),s=e.orientation==="horizontal",i=G0(()=>u("SCROLL_END"),100),[l,u]=hre("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return k.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>u("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,a.scrollHideDelay,u]),k.useEffect(()=>{const d=a.viewport,c=s?"scrollLeft":"scrollTop";if(d){let h=d[c];const p=()=>{const m=d[c];h!==m&&(u("SCROLL"),i()),h=m};return d.addEventListener("scroll",p),()=>d.removeEventListener("scroll",p)}},[a.viewport,s,u,i]),o.jsx(Al,{present:n||l!=="hidden",children:o.jsx(X_,{"data-state":l==="hidden"?"hidden":"visible",...r,ref:t,onPointerEnter:yn(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:yn(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),wL=k.forwardRef((e,t)=>{const n=Ii(Yo,e.__scopeScrollArea),{forceMount:r,...a}=e,[s,i]=k.useState(!1),l=e.orientation==="horizontal",u=G0(()=>{if(n.viewport){const d=n.viewport.offsetWidth<n.viewport.scrollWidth,c=n.viewport.offsetHeight<n.viewport.scrollHeight;i(l?d:c)}},10);return Em(n.viewport,u),Em(n.content,u),o.jsx(Al,{present:r||s,children:o.jsx(X_,{"data-state":s?"visible":"hidden",...a,ref:t})})}),X_=k.forwardRef((e,t)=>{const{orientation:n="vertical",...r}=e,a=Ii(Yo,e.__scopeScrollArea),s=k.useRef(null),i=k.useRef(0),[l,u]=k.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=_L(l.viewport,l.content),c={...r,sizes:l,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:p=>s.current=p,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:p=>i.current=p};function h(p,m){return wre(p,i.current,l,m)}return n==="horizontal"?o.jsx(gre,{...c,ref:t,onThumbPositionChange:()=>{if(a.viewport&&s.current){const p=a.viewport.scrollLeft,m=aM(p,l,a.dir);s.current.style.transform=`translate3d(${m}px, 0, 0)`}},onWheelScroll:p=>{a.viewport&&(a.viewport.scrollLeft=p)},onDragScroll:p=>{a.viewport&&(a.viewport.scrollLeft=h(p,a.dir))}}):n==="vertical"?o.jsx(xre,{...c,ref:t,onThumbPositionChange:()=>{if(a.viewport&&s.current){const p=a.viewport.scrollTop,m=aM(p,l);s.current.style.transform=`translate3d(0, ${m}px, 0)`}},onWheelScroll:p=>{a.viewport&&(a.viewport.scrollTop=p)},onDragScroll:p=>{a.viewport&&(a.viewport.scrollTop=h(p))}}):null}),gre=k.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...a}=e,s=Ii(Yo,e.__scopeScrollArea),[i,l]=k.useState(),u=k.useRef(null),d=sr(t,u,s.onScrollbarXChange);return k.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),o.jsx(kL,{"data-orientation":"horizontal",...a,ref:d,sizes:n,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":H0(n)+"px",...e.style},onThumbPointerDown:c=>e.onThumbPointerDown(c.x),onDragScroll:c=>e.onDragScroll(c.x),onWheelScroll:(c,h)=>{if(s.viewport){const p=s.viewport.scrollLeft+c.deltaX;e.onWheelScroll(p),TL(p,h)&&c.preventDefault()}},onResize:()=>{u.current&&s.viewport&&i&&r({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:Tw(i.paddingLeft),paddingEnd:Tw(i.paddingRight)}})}})}),xre=k.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...a}=e,s=Ii(Yo,e.__scopeScrollArea),[i,l]=k.useState(),u=k.useRef(null),d=sr(t,u,s.onScrollbarYChange);return k.useEffect(()=>{u.current&&l(getComputedStyle(u.current))},[u]),o.jsx(kL,{"data-orientation":"vertical",...a,ref:d,sizes:n,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":H0(n)+"px",...e.style},onThumbPointerDown:c=>e.onThumbPointerDown(c.y),onDragScroll:c=>e.onDragScroll(c.y),onWheelScroll:(c,h)=>{if(s.viewport){const p=s.viewport.scrollTop+c.deltaY;e.onWheelScroll(p),TL(p,h)&&c.preventDefault()}},onResize:()=>{u.current&&s.viewport&&i&&r({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:Tw(i.paddingTop),paddingEnd:Tw(i.paddingBottom)}})}})}),[yre,NL]=xL(Yo),kL=k.forwardRef((e,t)=>{const{__scopeScrollArea:n,sizes:r,hasThumb:a,onThumbChange:s,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:c,onResize:h,...p}=e,m=Ii(Yo,n),[f,g]=k.useState(null),x=sr(t,T=>g(T)),y=k.useRef(null),b=k.useRef(""),v=m.viewport,w=r.content-r.viewport,N=ou(c),S=ou(u),C=G0(h,10);function _(T){if(y.current){const E=T.clientX-y.current.left,j=T.clientY-y.current.top;d({x:E,y:j})}}return k.useEffect(()=>{const T=E=>{const j=E.target;(f==null?void 0:f.contains(j))&&N(E,w)};return document.addEventListener("wheel",T,{passive:!1}),()=>document.removeEventListener("wheel",T,{passive:!1})},[v,f,w,N]),k.useEffect(S,[r,S]),Em(f,C),Em(m.content,C),o.jsx(yre,{scope:n,scrollbar:f,hasThumb:a,onThumbChange:ou(s),onThumbPointerUp:ou(i),onThumbPositionChange:S,onThumbPointerDown:ou(l),children:o.jsx(An.div,{...p,ref:x,style:{position:"absolute",...p.style},onPointerDown:yn(e.onPointerDown,T=>{T.button===0&&(T.target.setPointerCapture(T.pointerId),y.current=f.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",m.viewport&&(m.viewport.style.scrollBehavior="auto"),_(T))}),onPointerMove:yn(e.onPointerMove,_),onPointerUp:yn(e.onPointerUp,T=>{const E=T.target;E.hasPointerCapture(T.pointerId)&&E.releasePointerCapture(T.pointerId),document.body.style.webkitUserSelect=b.current,m.viewport&&(m.viewport.style.scrollBehavior=""),y.current=null})})})}),Iw="ScrollAreaThumb",SL=k.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=NL(Iw,e.__scopeScrollArea);return o.jsx(Al,{present:n||a.hasThumb,children:o.jsx(bre,{ref:t,...r})})}),bre=k.forwardRef((e,t)=>{const{__scopeScrollArea:n,style:r,...a}=e,s=Ii(Iw,n),i=NL(Iw,n),{onThumbPositionChange:l}=i,u=sr(t,h=>i.onThumbChange(h)),d=k.useRef(void 0),c=G0(()=>{d.current&&(d.current(),d.current=void 0)},100);return k.useEffect(()=>{const h=s.viewport;if(h){const p=()=>{if(c(),!d.current){const m=Nre(h,l);d.current=m,l()}};return l(),h.addEventListener("scroll",p),()=>h.removeEventListener("scroll",p)}},[s.viewport,c,l]),o.jsx(An.div,{"data-state":i.hasThumb?"visible":"hidden",...a,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:yn(e.onPointerDownCapture,h=>{const m=h.target.getBoundingClientRect(),f=h.clientX-m.left,g=h.clientY-m.top;i.onThumbPointerDown({x:f,y:g})}),onPointerUp:yn(e.onPointerUp,i.onThumbPointerUp)})});SL.displayName=Iw;var Z_="ScrollAreaCorner",CL=k.forwardRef((e,t)=>{const n=Ii(Z_,e.__scopeScrollArea),r=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&r?o.jsx(vre,{...e,ref:t}):null});CL.displayName=Z_;var vre=k.forwardRef((e,t)=>{const{__scopeScrollArea:n,...r}=e,a=Ii(Z_,n),[s,i]=k.useState(0),[l,u]=k.useState(0),d=!!(s&&l);return Em(a.scrollbarX,()=>{var h;const c=((h=a.scrollbarX)==null?void 0:h.offsetHeight)||0;a.onCornerHeightChange(c),u(c)}),Em(a.scrollbarY,()=>{var h;const c=((h=a.scrollbarY)==null?void 0:h.offsetWidth)||0;a.onCornerWidthChange(c),i(c)}),d?o.jsx(An.div,{...r,ref:t,style:{width:s,height:l,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Tw(e){return e?parseInt(e,10):0}function _L(e,t){const n=e/t;return isNaN(n)?0:n}function H0(e){const t=_L(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=(e.scrollbar.size-n)*t;return Math.max(r,18)}function wre(e,t,n,r="ltr"){const a=H0(n),s=a/2,i=t||s,l=a-i,u=n.scrollbar.paddingStart+i,d=n.scrollbar.size-n.scrollbar.paddingEnd-l,c=n.content-n.viewport,h=r==="ltr"?[0,c]:[c*-1,0];return IL([u,d],h)(e)}function aM(e,t,n="ltr"){const r=H0(t),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-a,i=t.content-t.viewport,l=s-r,u=n==="ltr"?[0,i]:[i*-1,0],d=p2(e,u);return IL([0,i],[0,l])(d)}function IL(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function TL(e,t){return e>0&&e<t}var Nre=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},r=0;return function a(){const s={left:e.scrollLeft,top:e.scrollTop},i=n.left!==s.left,l=n.top!==s.top;(i||l)&&t(),n=s,r=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(r)};function G0(e,t){const n=ou(e),r=k.useRef(0);return k.useEffect(()=>()=>window.clearTimeout(r.current),[]),k.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(n,t)},[n,t])}function Em(e,t){const n=ou(t);Bo(()=>{let r=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return a.observe(e),()=>{window.cancelAnimationFrame(r),a.unobserve(e)}}},[e,n])}var EL=yL,kre=vL,Sre=CL;const Q_=k.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(EL,{ref:r,className:Ie("relative overflow-hidden",e),...n,children:[o.jsx(kre,{className:"h-full w-full rounded-[inherit]",children:t}),o.jsx(jL,{}),o.jsx(Sre,{})]}));Q_.displayName=EL.displayName;const jL=k.forwardRef(({className:e,orientation:t="vertical",...n},r)=>o.jsx(Y_,{ref:r,orientation:t,className:Ie("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...n,children:o.jsx(SL,{className:"relative flex-1 rounded-full bg-border"})}));jL.displayName=Y_.displayName;var On;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const s={};for(const i of a)s[i]=i;return s},e.getValidEnumValues=a=>{const s=e.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),i={};for(const l of s)i[l]=a[l];return e.objectValues(i)},e.objectValues=a=>e.objectKeys(a).map(function(s){return a[s]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},e.find=(a,s)=>{for(const i of a)if(s(i))return i},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}e.joinValues=r,e.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(On||(On={}));var sM;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(sM||(sM={}));const Tt=On.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ru=e=>{switch(typeof e){case"undefined":return Tt.undefined;case"string":return Tt.string;case"number":return Number.isNaN(e)?Tt.nan:Tt.number;case"boolean":return Tt.boolean;case"function":return Tt.function;case"bigint":return Tt.bigint;case"symbol":return Tt.symbol;case"object":return Array.isArray(e)?Tt.array:e===null?Tt.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Tt.promise:typeof Map<"u"&&e instanceof Map?Tt.map:typeof Set<"u"&&e instanceof Set?Tt.set:typeof Date<"u"&&e instanceof Date?Tt.date:Tt.object;default:return Tt.unknown}},tt=On.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Tl extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(s){return s.message},r={_errors:[]},a=s=>{for(const i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let l=r,u=0;for(;u<i.path.length;){const d=i.path[u];u===i.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(n(i))):l[d]=l[d]||{_errors:[]},l=l[d],u++}}};return a(this),r}static assert(t){if(!(t instanceof Tl))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,On.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const s=a.path[0];n[s]=n[s]||[],n[s].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Tl.create=e=>new Tl(e);const m2=(e,t)=>{let n;switch(e.code){case tt.invalid_type:e.received===Tt.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case tt.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,On.jsonStringifyReplacer)}`;break;case tt.unrecognized_keys:n=`Unrecognized key(s) in object: ${On.joinValues(e.keys,", ")}`;break;case tt.invalid_union:n="Invalid input";break;case tt.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${On.joinValues(e.options)}`;break;case tt.invalid_enum_value:n=`Invalid enum value. Expected ${On.joinValues(e.options)}, received '${e.received}'`;break;case tt.invalid_arguments:n="Invalid function arguments";break;case tt.invalid_return_type:n="Invalid function return type";break;case tt.invalid_date:n="Invalid date";break;case tt.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:On.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case tt.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case tt.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case tt.custom:n="Invalid input";break;case tt.invalid_intersection_types:n="Intersection results could not be merged";break;case tt.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case tt.not_finite:n="Number must be finite";break;default:n=t.defaultError,On.assertNever(e)}return{message:n}};let Cre=m2;function _re(){return Cre}const Ire=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,s=[...n,...a.path||[]],i={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let l="";const u=r.filter(d=>!!d).slice().reverse();for(const d of u)l=d(i,{data:t,defaultError:l}).message;return{...a,path:s,message:l}};function xt(e,t){const n=_re(),r=Ire({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===m2?void 0:m2].filter(a=>!!a)});e.common.issues.push(r)}class ei{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return Xt;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const s=await a.key,i=await a.value;r.push({key:s,value:i})}return ei.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return Xt;s.status==="dirty"&&t.dirty(),i.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(r[s.value]=i.value)}return{status:t.value,value:r}}}const Xt=Object.freeze({status:"aborted"}),fx=e=>({status:"dirty",value:e}),Ti=e=>({status:"valid",value:e}),iM=e=>e.status==="aborted",oM=e=>e.status==="dirty",jm=e=>e.status==="valid",Ew=e=>typeof Promise<"u"&&e instanceof Promise;var Rt;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Rt||(Rt={}));class $u{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const lM=(e,t)=>{if(jm(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Tl(e.common.issues);return this._error=n,this._error}}};function bn(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(i,l)=>{const{message:u}=e;return i.code==="invalid_enum_value"?{message:u??l.defaultError}:typeof l.data>"u"?{message:u??r??l.defaultError}:i.code!=="invalid_type"?{message:l.defaultError}:{message:u??n??l.defaultError}},description:a}}class Dn{get description(){return this._def.description}_getType(t){return ru(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:ru(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ei,ctx:{common:t.parent.common,data:t.data,parsedType:ru(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(Ew(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ru(t)},a=this._parseSync({data:t,path:r.path,parent:r});return lM(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ru(t)};if(!this["~standard"].async)try{const s=this._parseSync({data:t,path:[],parent:n});return jm(s)?{value:s.value}:{issues:n.common.issues}}catch(s){(a=(r=s==null?void 0:s.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(s=>jm(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:ru(t)},a=this._parse({data:t,path:r.path,parent:r}),s=await(Ew(a)?a:Promise.resolve(a));return lM(r,s)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,s)=>{const i=t(a),l=()=>s.addIssue({code:tt.custom,...r(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(l(),!1)):i?!0:(l(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new Rm({schema:this,typeName:Qt.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return _u.create(this,this._def)}nullable(){return Dm.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Po.create(this)}promise(){return Dw.create(this,this._def)}or(t){return Aw.create([this,t],this._def)}and(t){return Rw.create(this,t,this._def)}transform(t){return new Rm({...bn(this._def),schema:this,typeName:Qt.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new x2({...bn(this._def),innerType:this,defaultValue:n,typeName:Qt.ZodDefault})}brand(){return new Xre({typeName:Qt.ZodBranded,type:this,...bn(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new y2({...bn(this._def),innerType:this,catchValue:n,typeName:Qt.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return J_.create(this,t)}readonly(){return b2.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Tre=/^c[^\s-]{8,}$/i,Ere=/^[0-9a-z]+$/,jre=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Are=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Rre=/^[a-z0-9_-]{21}$/i,Dre=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Mre=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,$re=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Fre="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let dk;const Pre=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ore=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Lre=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,zre=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Bre=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Wre=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,AL="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Vre=new RegExp(`^${AL}$`);function RL(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Ure(e){return new RegExp(`^${RL(e)}$`)}function Hre(e){let t=`${AL}T${RL(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Gre(e,t){return!!((t==="v4"||!t)&&Pre.test(e)||(t==="v6"||!t)&&Lre.test(e))}function qre(e,t){if(!Dre.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function Kre(e,t){return!!((t==="v4"||!t)&&Ore.test(e)||(t==="v6"||!t)&&zre.test(e))}class bu extends Dn{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Tt.string){const s=this._getOrReturnCtx(t);return xt(s,{code:tt.invalid_type,expected:Tt.string,received:s.parsedType}),Xt}const r=new ei;let a;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")t.data.length>s.value&&(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const i=t.data.length>s.value,l=t.data.length<s.value;(i||l)&&(a=this._getOrReturnCtx(t,a),i?xt(a,{code:tt.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):l&&xt(a,{code:tt.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")$re.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"email",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")dk||(dk=new RegExp(Fre,"u")),dk.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"emoji",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Are.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"uuid",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Rre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"nanoid",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")Tre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"cuid",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Ere.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"cuid2",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")jre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"ulid",code:tt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),xt(a,{validation:"url",code:tt.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"regex",code:tt.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Hre(s).test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?Vre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Ure(s).test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Mre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"duration",code:tt.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?Gre(t.data,s.version)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"ip",code:tt.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?qre(t.data,s.alg)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"jwt",code:tt.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?Kre(t.data,s.version)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"cidr",code:tt.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?Bre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"base64",code:tt.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?Wre.test(t.data)||(a=this._getOrReturnCtx(t,a),xt(a,{validation:"base64url",code:tt.invalid_string,message:s.message}),r.dirty()):On.assertNever(s);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:tt.invalid_string,...Rt.errToObj(r)})}_addCheck(t){return new bu({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Rt.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Rt.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Rt.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Rt.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Rt.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Rt.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Rt.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Rt.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Rt.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Rt.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Rt.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Rt.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Rt.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Rt.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Rt.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Rt.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...Rt.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...Rt.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...Rt.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...Rt.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...Rt.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...Rt.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...Rt.errToObj(n)})}nonempty(t){return this.min(1,Rt.errToObj(t))}trim(){return new bu({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bu({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bu({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}bu.create=e=>new bu({checks:[],typeName:Qt.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...bn(e)});function Yre(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,s=Number.parseInt(e.toFixed(a).replace(".","")),i=Number.parseInt(t.toFixed(a).replace(".",""));return s%i/10**a}class ny extends Dn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Tt.number){const s=this._getOrReturnCtx(t);return xt(s,{code:tt.invalid_type,expected:Tt.number,received:s.parsedType}),Xt}let r;const a=new ei;for(const s of this._def.checks)s.kind==="int"?On.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?Yre(t.data,s.value)!==0&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.not_finite,message:s.message}),a.dirty()):On.assertNever(s);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,Rt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Rt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Rt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Rt.toString(n))}setLimit(t,n,r,a){return new ny({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Rt.toString(a)}]})}_addCheck(t){return new ny({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Rt.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Rt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Rt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Rt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Rt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Rt.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:Rt.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Rt.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Rt.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&On.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}ny.create=e=>new ny({checks:[],typeName:Qt.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...bn(e)});class ry extends Dn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Tt.bigint)return this._getInvalidInput(t);let r;const a=new ei;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),xt(r,{code:tt.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):On.assertNever(s);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return xt(n,{code:tt.invalid_type,expected:Tt.bigint,received:n.parsedType}),Xt}gte(t,n){return this.setLimit("min",t,!0,Rt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Rt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Rt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Rt.toString(n))}setLimit(t,n,r,a){return new ry({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Rt.toString(a)}]})}_addCheck(t){return new ry({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Rt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Rt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Rt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Rt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Rt.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}ry.create=e=>new ry({checks:[],typeName:Qt.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...bn(e)});class uM extends Dn{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Tt.boolean){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.boolean,received:r.parsedType}),Xt}return Ti(t.data)}}uM.create=e=>new uM({typeName:Qt.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...bn(e)});class jw extends Dn{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Tt.date){const s=this._getOrReturnCtx(t);return xt(s,{code:tt.invalid_type,expected:Tt.date,received:s.parsedType}),Xt}if(Number.isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return xt(s,{code:tt.invalid_date}),Xt}const r=new ei;let a;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(a=this._getOrReturnCtx(t,a),xt(a,{code:tt.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):On.assertNever(s);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new jw({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:Rt.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:Rt.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}jw.create=e=>new jw({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Qt.ZodDate,...bn(e)});class cM extends Dn{_parse(t){if(this._getType(t)!==Tt.symbol){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.symbol,received:r.parsedType}),Xt}return Ti(t.data)}}cM.create=e=>new cM({typeName:Qt.ZodSymbol,...bn(e)});class dM extends Dn{_parse(t){if(this._getType(t)!==Tt.undefined){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.undefined,received:r.parsedType}),Xt}return Ti(t.data)}}dM.create=e=>new dM({typeName:Qt.ZodUndefined,...bn(e)});class hM extends Dn{_parse(t){if(this._getType(t)!==Tt.null){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.null,received:r.parsedType}),Xt}return Ti(t.data)}}hM.create=e=>new hM({typeName:Qt.ZodNull,...bn(e)});class pM extends Dn{constructor(){super(...arguments),this._any=!0}_parse(t){return Ti(t.data)}}pM.create=e=>new pM({typeName:Qt.ZodAny,...bn(e)});class mM extends Dn{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Ti(t.data)}}mM.create=e=>new mM({typeName:Qt.ZodUnknown,...bn(e)});class Fu extends Dn{_parse(t){const n=this._getOrReturnCtx(t);return xt(n,{code:tt.invalid_type,expected:Tt.never,received:n.parsedType}),Xt}}Fu.create=e=>new Fu({typeName:Qt.ZodNever,...bn(e)});class fM extends Dn{_parse(t){if(this._getType(t)!==Tt.undefined){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.void,received:r.parsedType}),Xt}return Ti(t.data)}}fM.create=e=>new fM({typeName:Qt.ZodVoid,...bn(e)});class Po extends Dn{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==Tt.array)return xt(n,{code:tt.invalid_type,expected:Tt.array,received:n.parsedType}),Xt;if(a.exactLength!==null){const i=n.data.length>a.exactLength.value,l=n.data.length<a.exactLength.value;(i||l)&&(xt(n,{code:i?tt.too_big:tt.too_small,minimum:l?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(xt(n,{code:tt.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(xt(n,{code:tt.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,l)=>a.type._parseAsync(new $u(n,i,n.path,l)))).then(i=>ei.mergeArray(r,i));const s=[...n.data].map((i,l)=>a.type._parseSync(new $u(n,i,n.path,l)));return ei.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new Po({...this._def,minLength:{value:t,message:Rt.toString(n)}})}max(t,n){return new Po({...this._def,maxLength:{value:t,message:Rt.toString(n)}})}length(t,n){return new Po({...this._def,exactLength:{value:t,message:Rt.toString(n)}})}nonempty(t){return this.min(1,t)}}Po.create=(e,t)=>new Po({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Qt.ZodArray,...bn(t)});function zp(e){if(e instanceof Xr){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=_u.create(zp(r))}return new Xr({...e._def,shape:()=>t})}else return e instanceof Po?new Po({...e._def,type:zp(e.element)}):e instanceof _u?_u.create(zp(e.unwrap())):e instanceof Dm?Dm.create(zp(e.unwrap())):e instanceof wd?wd.create(e.items.map(t=>zp(t))):e}class Xr extends Dn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=On.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==Tt.object){const d=this._getOrReturnCtx(t);return xt(d,{code:tt.invalid_type,expected:Tt.object,received:d.parsedType}),Xt}const{status:r,ctx:a}=this._processInputParams(t),{shape:s,keys:i}=this._getCached(),l=[];if(!(this._def.catchall instanceof Fu&&this._def.unknownKeys==="strip"))for(const d in a.data)i.includes(d)||l.push(d);const u=[];for(const d of i){const c=s[d],h=a.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new $u(a,h,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof Fu){const d=this._def.unknownKeys;if(d==="passthrough")for(const c of l)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(d==="strict")l.length>0&&(xt(a,{code:tt.unrecognized_keys,keys:l}),r.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const c of l){const h=a.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new $u(a,h,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const d=[];for(const c of u){const h=await c.key,p=await c.value;d.push({key:h,value:p,alwaysSet:c.alwaysSet})}return d}).then(d=>ei.mergeObjectSync(r,d)):ei.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(t){return Rt.errToObj,new Xr({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var s,i;const a=((i=(s=this._def).errorMap)==null?void 0:i.call(s,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:Rt.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new Xr({...this._def,unknownKeys:"strip"})}passthrough(){return new Xr({...this._def,unknownKeys:"passthrough"})}extend(t){return new Xr({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Xr({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Qt.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new Xr({...this._def,catchall:t})}pick(t){const n={};for(const r of On.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new Xr({...this._def,shape:()=>n})}omit(t){const n={};for(const r of On.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new Xr({...this._def,shape:()=>n})}deepPartial(){return zp(this)}partial(t){const n={};for(const r of On.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new Xr({...this._def,shape:()=>n})}required(t){const n={};for(const r of On.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof _u;)s=s._def.innerType;n[r]=s}return new Xr({...this._def,shape:()=>n})}keyof(){return DL(On.objectKeys(this.shape))}}Xr.create=(e,t)=>new Xr({shape:()=>e,unknownKeys:"strip",catchall:Fu.create(),typeName:Qt.ZodObject,...bn(t)});Xr.strictCreate=(e,t)=>new Xr({shape:()=>e,unknownKeys:"strict",catchall:Fu.create(),typeName:Qt.ZodObject,...bn(t)});Xr.lazycreate=(e,t)=>new Xr({shape:e,unknownKeys:"strip",catchall:Fu.create(),typeName:Qt.ZodObject,...bn(t)});class Aw extends Dn{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const i=s.map(l=>new Tl(l.ctx.common.issues));return xt(n,{code:tt.invalid_union,unionErrors:i}),Xt}if(n.common.async)return Promise.all(r.map(async s=>{const i={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(a);{let s;const i=[];for(const u of r){const d={...n,common:{...n.common,issues:[]},parent:null},c=u._parseSync({data:n.data,path:n.path,parent:d});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:d}),d.common.issues.length&&i.push(d.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const l=i.map(u=>new Tl(u));return xt(n,{code:tt.invalid_union,unionErrors:l}),Xt}}get options(){return this._def.options}}Aw.create=(e,t)=>new Aw({options:e,typeName:Qt.ZodUnion,...bn(t)});function f2(e,t){const n=ru(e),r=ru(t);if(e===t)return{valid:!0,data:e};if(n===Tt.object&&r===Tt.object){const a=On.objectKeys(t),s=On.objectKeys(e).filter(l=>a.indexOf(l)!==-1),i={...e,...t};for(const l of s){const u=f2(e[l],t[l]);if(!u.valid)return{valid:!1};i[l]=u.data}return{valid:!0,data:i}}else if(n===Tt.array&&r===Tt.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let s=0;s<e.length;s++){const i=e[s],l=t[s],u=f2(i,l);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return n===Tt.date&&r===Tt.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Rw extends Dn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(s,i)=>{if(iM(s)||iM(i))return Xt;const l=f2(s.value,i.value);return l.valid?((oM(s)||oM(i))&&n.dirty(),{status:n.value,value:l.data}):(xt(r,{code:tt.invalid_intersection_types}),Xt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Rw.create=(e,t,n)=>new Rw({left:e,right:t,typeName:Qt.ZodIntersection,...bn(n)});class wd extends Dn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.array)return xt(r,{code:tt.invalid_type,expected:Tt.array,received:r.parsedType}),Xt;if(r.data.length<this._def.items.length)return xt(r,{code:tt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Xt;!this._def.rest&&r.data.length>this._def.items.length&&(xt(r,{code:tt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((i,l)=>{const u=this._def.items[l]||this._def.rest;return u?u._parse(new $u(r,i,r.path,l)):null}).filter(i=>!!i);return r.common.async?Promise.all(s).then(i=>ei.mergeArray(n,i)):ei.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new wd({...this._def,rest:t})}}wd.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new wd({items:e,typeName:Qt.ZodTuple,rest:null,...bn(t)})};class gM extends Dn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.map)return xt(r,{code:tt.invalid_type,expected:Tt.map,received:r.parsedType}),Xt;const a=this._def.keyType,s=this._def.valueType,i=[...r.data.entries()].map(([l,u],d)=>({key:a._parse(new $u(r,l,r.path,[d,"key"])),value:s._parse(new $u(r,u,r.path,[d,"value"]))}));if(r.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const u of i){const d=await u.key,c=await u.value;if(d.status==="aborted"||c.status==="aborted")return Xt;(d.status==="dirty"||c.status==="dirty")&&n.dirty(),l.set(d.value,c.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const u of i){const d=u.key,c=u.value;if(d.status==="aborted"||c.status==="aborted")return Xt;(d.status==="dirty"||c.status==="dirty")&&n.dirty(),l.set(d.value,c.value)}return{status:n.value,value:l}}}}gM.create=(e,t,n)=>new gM({valueType:t,keyType:e,typeName:Qt.ZodMap,...bn(n)});class ay extends Dn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.set)return xt(r,{code:tt.invalid_type,expected:Tt.set,received:r.parsedType}),Xt;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(xt(r,{code:tt.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(xt(r,{code:tt.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const s=this._def.valueType;function i(u){const d=new Set;for(const c of u){if(c.status==="aborted")return Xt;c.status==="dirty"&&n.dirty(),d.add(c.value)}return{status:n.value,value:d}}const l=[...r.data.values()].map((u,d)=>s._parse(new $u(r,u,r.path,d)));return r.common.async?Promise.all(l).then(u=>i(u)):i(l)}min(t,n){return new ay({...this._def,minSize:{value:t,message:Rt.toString(n)}})}max(t,n){return new ay({...this._def,maxSize:{value:t,message:Rt.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}ay.create=(e,t)=>new ay({valueType:e,minSize:null,maxSize:null,typeName:Qt.ZodSet,...bn(t)});class xM extends Dn{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}xM.create=(e,t)=>new xM({getter:e,typeName:Qt.ZodLazy,...bn(t)});class g2 extends Dn{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return xt(n,{received:n.data,code:tt.invalid_literal,expected:this._def.value}),Xt}return{status:"valid",value:t.data}}get value(){return this._def.value}}g2.create=(e,t)=>new g2({value:e,typeName:Qt.ZodLiteral,...bn(t)});function DL(e,t){return new Am({values:e,typeName:Qt.ZodEnum,...bn(t)})}class Am extends Dn{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return xt(n,{expected:On.joinValues(r),received:n.parsedType,code:tt.invalid_type}),Xt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return xt(n,{received:n.data,code:tt.invalid_enum_value,options:r}),Xt}return Ti(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return Am.create(t,{...this._def,...n})}exclude(t,n=this._def){return Am.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}Am.create=DL;class yM extends Dn{_parse(t){const n=On.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==Tt.string&&r.parsedType!==Tt.number){const a=On.objectValues(n);return xt(r,{expected:On.joinValues(a),received:r.parsedType,code:tt.invalid_type}),Xt}if(this._cache||(this._cache=new Set(On.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=On.objectValues(n);return xt(r,{received:r.data,code:tt.invalid_enum_value,options:a}),Xt}return Ti(t.data)}get enum(){return this._def.values}}yM.create=(e,t)=>new yM({values:e,typeName:Qt.ZodNativeEnum,...bn(t)});class Dw extends Dn{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Tt.promise&&n.common.async===!1)return xt(n,{code:tt.invalid_type,expected:Tt.promise,received:n.parsedType}),Xt;const r=n.parsedType===Tt.promise?n.data:Promise.resolve(n.data);return Ti(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Dw.create=(e,t)=>new Dw({type:e,typeName:Qt.ZodPromise,...bn(t)});class Rm extends Dn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Qt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,s={addIssue:i=>{xt(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const i=a.transform(r.data,s);if(r.common.async)return Promise.resolve(i).then(async l=>{if(n.value==="aborted")return Xt;const u=await this._def.schema._parseAsync({data:l,path:r.path,parent:r});return u.status==="aborted"?Xt:u.status==="dirty"||n.value==="dirty"?fx(u.value):u});{if(n.value==="aborted")return Xt;const l=this._def.schema._parseSync({data:i,path:r.path,parent:r});return l.status==="aborted"?Xt:l.status==="dirty"||n.value==="dirty"?fx(l.value):l}}if(a.type==="refinement"){const i=l=>{const u=a.refinement(l,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?Xt:(l.status==="dirty"&&n.dirty(),i(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>l.status==="aborted"?Xt:(l.status==="dirty"&&n.dirty(),i(l.value).then(()=>({status:n.value,value:l.value}))))}if(a.type==="transform")if(r.common.async===!1){const i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!jm(i))return Xt;const l=a.transform(i.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>jm(i)?Promise.resolve(a.transform(i.value,s)).then(l=>({status:n.value,value:l})):Xt);On.assertNever(a)}}Rm.create=(e,t,n)=>new Rm({schema:e,typeName:Qt.ZodEffects,effect:t,...bn(n)});Rm.createWithPreprocess=(e,t,n)=>new Rm({schema:t,effect:{type:"preprocess",transform:e},typeName:Qt.ZodEffects,...bn(n)});class _u extends Dn{_parse(t){return this._getType(t)===Tt.undefined?Ti(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}_u.create=(e,t)=>new _u({innerType:e,typeName:Qt.ZodOptional,...bn(t)});class Dm extends Dn{_parse(t){return this._getType(t)===Tt.null?Ti(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Dm.create=(e,t)=>new Dm({innerType:e,typeName:Qt.ZodNullable,...bn(t)});class x2 extends Dn{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===Tt.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}x2.create=(e,t)=>new x2({innerType:e,typeName:Qt.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...bn(t)});class y2 extends Dn{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ew(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Tl(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Tl(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}y2.create=(e,t)=>new y2({innerType:e,typeName:Qt.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...bn(t)});class bM extends Dn{_parse(t){if(this._getType(t)!==Tt.nan){const r=this._getOrReturnCtx(t);return xt(r,{code:tt.invalid_type,expected:Tt.nan,received:r.parsedType}),Xt}return{status:"valid",value:t.data}}}bM.create=e=>new bM({typeName:Qt.ZodNaN,...bn(e)});class Xre extends Dn{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class J_ extends Dn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Xt:s.status==="dirty"?(n.dirty(),fx(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Xt:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new J_({in:t,out:n,typeName:Qt.ZodPipeline})}}class b2 extends Dn{_parse(t){const n=this._def.innerType._parse(t),r=a=>(jm(a)&&(a.value=Object.freeze(a.value)),a);return Ew(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}}b2.create=(e,t)=>new b2({innerType:e,typeName:Qt.ZodReadonly,...bn(t)});var Qt;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Qt||(Qt={}));const hk=bu.create;Fu.create;Po.create;const Zre=Xr.create;Aw.create;Rw.create;wd.create;const vM=g2.create;Am.create;Dw.create;_u.create;Dm.create;var Oy=e=>e.type==="checkbox",Wc=e=>e instanceof Date,Ts=e=>e==null;const ML=e=>typeof e=="object";var Jr=e=>!Ts(e)&&!Array.isArray(e)&&ML(e)&&!Wc(e),Qre=e=>Jr(e)&&e.target?Oy(e.target)?e.target.checked:e.target.value:e,Jre=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,eae=(e,t)=>e.has(Jre(t)),tae=e=>{const t=e.constructor&&e.constructor.prototype;return Jr(t)&&t.hasOwnProperty("isPrototypeOf")},eI=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Sa(e){if(e instanceof Date)return new Date(e);const t=typeof FileList<"u"&&e instanceof FileList;if(eI&&(e instanceof Blob||t))return e;const n=Array.isArray(e);if(!n&&!(Jr(e)&&tae(e)))return e;const r=n?[]:Object.create(Object.getPrototypeOf(e));for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=Sa(e[a]));return r}var q0=e=>/^\w*$/.test(e),Lr=e=>e===void 0,tI=e=>Array.isArray(e)?e.filter(Boolean):[],nI=e=>tI(e.replace(/["|']|\]/g,"").split(/\.|\[/)),_t=(e,t,n)=>{if(!t||!Jr(e))return n;const r=(q0(t)?[t]:nI(t)).reduce((a,s)=>Ts(a)?a:a[s],e);return Lr(r)||r===e?Lr(e[t])?n:e[t]:r},vo=e=>typeof e=="boolean",Ki=e=>typeof e=="function",cr=(e,t,n)=>{let r=-1;const a=q0(t)?[t]:nI(t),s=a.length,i=s-1;for(;++r<s;){const l=a[r];let u=n;if(r!==i){const d=e[l];u=Jr(d)||Array.isArray(d)?d:isNaN(+a[r+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;e[l]=u,e=e[l]}};const wM={BLUR:"blur",FOCUS_OUT:"focusout"},Yi={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ol={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},nae=ge.createContext(null);nae.displayName="HookFormContext";var rae=(e,t,n,r=!0)=>{const a={defaultValues:t._defaultValues};for(const s in e)Object.defineProperty(a,s,{get:()=>{const i=s;return t._proxyFormState[i]!==Yi.all&&(t._proxyFormState[i]=!r||Yi.all),e[i]}});return a};const aae=typeof window<"u"?ge.useLayoutEffect:ge.useEffect;var Gs=e=>typeof e=="string",sae=(e,t,n,r,a)=>Gs(e)?(r&&t.watch.add(e),_t(n,e,a)):Array.isArray(e)?e.map(s=>(r&&t.watch.add(s),_t(n,s))):(r&&(t.watchAll=!0),n),v2=e=>Ts(e)||!ML(e);function lu(e,t,n=new WeakSet){if(v2(e)||v2(t))return Object.is(e,t);if(Wc(e)&&Wc(t))return e.getTime()===t.getTime();const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;if(n.has(e)||n.has(t))return!0;n.add(e),n.add(t);for(const s of r){const i=e[s];if(!a.includes(s))return!1;if(s!=="ref"){const l=t[s];if(Wc(i)&&Wc(l)||Jr(i)&&Jr(l)||Array.isArray(i)&&Array.isArray(l)?!lu(i,l,n):!Object.is(i,l))return!1}}return!0}var $L=(e,t,n,r,a)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[r]:a||!0}}:{},Dx=e=>Array.isArray(e)?e:[e],NM=()=>{let e=[];return{get observers(){return e},next:a=>{for(const s of e)s.next&&s.next(a)},subscribe:a=>(e.push(a),{unsubscribe:()=>{e=e.filter(s=>s!==a)}}),unsubscribe:()=>{e=[]}}};function FL(e,t){const n={};for(const r in e)if(e.hasOwnProperty(r)){const a=e[r],s=t[r];if(a&&Jr(a)&&s){const i=FL(a,s);Jr(i)&&(n[r]=i)}else e[r]&&(n[r]=s)}return n}var ss=e=>Jr(e)&&!Object.keys(e).length,rI=e=>e.type==="file",Mw=e=>{if(!eI)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},PL=e=>e.type==="select-multiple",aI=e=>e.type==="radio",iae=e=>aI(e)||Oy(e),pk=e=>Mw(e)&&e.isConnected;function oae(e,t){const n=t.slice(0,-1).length;let r=0;for(;r<n;)e=Lr(e)?r++:e[t[r++]];return e}function lae(e){for(const t in e)if(e.hasOwnProperty(t)&&!Lr(e[t]))return!1;return!0}function Kr(e,t){const n=Array.isArray(t)?t:q0(t)?[t]:nI(t),r=n.length===1?e:oae(e,n),a=n.length-1,s=n[a];return r&&delete r[s],a!==0&&(Jr(r)&&ss(r)||Array.isArray(r)&&lae(r))&&Kr(e,n.slice(0,-1)),e}var uae=e=>{for(const t in e)if(Ki(e[t]))return!0;return!1};function OL(e){return Array.isArray(e)||Jr(e)&&!uae(e)}function w2(e,t={}){for(const n in e){const r=e[n];OL(r)?(t[n]=Array.isArray(r)?[]:{},w2(r,t[n])):Lr(r)||(t[n]=!0)}return t}function Bp(e,t,n){n||(n=w2(t));for(const r in e){const a=e[r];if(OL(a))Lr(t)||v2(n[r])?n[r]=w2(a,Array.isArray(a)?[]:{}):Bp(a,Ts(t)?{}:t[r],n[r]);else{const s=t[r];n[r]=!lu(a,s)}}return n}const kM={value:!1,isValid:!1},SM={value:!0,isValid:!0};var LL=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Lr(e[0].attributes.value)?Lr(e[0].value)||e[0].value===""?SM:{value:e[0].value,isValid:!0}:SM:kM}return kM},zL=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:r})=>Lr(e)?e:t?e===""?NaN:e&&+e:n&&Gs(e)?new Date(e):r?r(e):e;const CM={isValid:!1,value:null};var BL=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,CM):CM;function _M(e){const t=e.ref;return rI(t)?t.files:aI(t)?BL(e.refs).value:PL(t)?[...t.selectedOptions].map(({value:n})=>n):Oy(t)?LL(e.refs).value:zL(Lr(t.value)?e.ref.value:t.value,e)}var cae=(e,t,n,r)=>{const a={};for(const s of e){const i=_t(t,s);i&&cr(a,s,i._f)}return{criteriaMode:n,names:[...e],fields:a,shouldUseNativeValidation:r}},$w=e=>e instanceof RegExp,Hg=e=>Lr(e)?e:$w(e)?e.source:Jr(e)?$w(e.value)?e.value.source:e.value:e,IM=e=>({isOnSubmit:!e||e===Yi.onSubmit,isOnBlur:e===Yi.onBlur,isOnChange:e===Yi.onChange,isOnAll:e===Yi.all,isOnTouch:e===Yi.onTouched});const TM="AsyncFunction";var dae=e=>!!e&&!!e.validate&&!!(Ki(e.validate)&&e.validate.constructor.name===TM||Jr(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===TM)),hae=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),EM=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(r=>e.startsWith(r)&&/^\.\w+/.test(e.slice(r.length))));const Mx=(e,t,n,r)=>{for(const a of n||Object.keys(e)){const s=_t(e,a);if(s){const{_f:i,...l}=s;if(i){if(i.refs&&i.refs[0]&&t(i.refs[0],a)&&!r)return!0;if(i.ref&&t(i.ref,i.name)&&!r)return!0;if(Mx(l,t))break}else if(Jr(l)&&Mx(l,t))break}}};function jM(e,t,n){const r=_t(e,n);if(r||q0(n))return{error:r,name:n};const a=n.split(".");for(;a.length;){const s=a.join("."),i=_t(t,s),l=_t(e,s);if(i&&!Array.isArray(i)&&n!==s)return{name:n};if(l&&l.type)return{name:s,error:l};if(l&&l.root&&l.root.type)return{name:`${s}.root`,error:l.root};a.pop()}return{name:n}}var pae=(e,t,n,r)=>{n(e);const{name:a,...s}=e;return ss(s)||Object.keys(s).length>=Object.keys(t).length||Object.keys(s).find(i=>t[i]===(!r||Yi.all))},mae=(e,t,n)=>!e||!t||e===t||Dx(e).some(r=>r&&(n?r===t:r.startsWith(t)||t.startsWith(r))),fae=(e,t,n,r,a)=>a.isOnAll?!1:!n&&a.isOnTouch?!(t||e):(n?r.isOnBlur:a.isOnBlur)?!e:(n?r.isOnChange:a.isOnChange)?e:!0,gae=(e,t)=>!tI(_t(e,t)).length&&Kr(e,t),xae=(e,t,n)=>{const r=Dx(_t(e,n));return cr(r,"root",t[n]),cr(e,n,r),e};function AM(e,t,n="validate"){if(Gs(e)||Array.isArray(e)&&e.every(Gs)||vo(e)&&!e)return{type:n,message:Gs(e)?e:"",ref:t}}var Ap=e=>Jr(e)&&!$w(e)?e:{value:e,message:""},RM=async(e,t,n,r,a,s)=>{const{ref:i,refs:l,required:u,maxLength:d,minLength:c,min:h,max:p,pattern:m,validate:f,name:g,valueAsNumber:x,mount:y}=e._f,b=_t(n,g);if(!y||t.has(g))return{};const v=l?l[0]:i,w=I=>{a&&v.reportValidity&&(v.setCustomValidity(vo(I)?"":I||""),v.reportValidity())},N={},S=aI(i),C=Oy(i),_=S||C,T=(x||rI(i))&&Lr(i.value)&&Lr(b)||Mw(i)&&i.value===""||b===""||Array.isArray(b)&&!b.length,E=$L.bind(null,g,r,N),j=(I,D,F,P=ol.maxLength,V=ol.minLength)=>{const $=I?D:F;N[g]={type:I?P:V,message:$,ref:i,...E(I?P:V,$)}};if(s?!Array.isArray(b)||!b.length:u&&(!_&&(T||Ts(b))||vo(b)&&!b||C&&!LL(l).isValid||S&&!BL(l).isValid)){const{value:I,message:D}=Gs(u)?{value:!!u,message:u}:Ap(u);if(I&&(N[g]={type:ol.required,message:D,ref:v,...E(ol.required,D)},!r))return w(D),N}if(!T&&(!Ts(h)||!Ts(p))){let I,D;const F=Ap(p),P=Ap(h);if(!Ts(b)&&!isNaN(b)){const V=i.valueAsNumber||b&&+b;Ts(F.value)||(I=V>F.value),Ts(P.value)||(D=V<P.value)}else{const V=i.valueAsDate||new Date(b),$=q=>new Date(new Date().toDateString()+" "+q),O=i.type=="time",L=i.type=="week";Gs(F.value)&&b&&(I=O?$(b)>$(F.value):L?b>F.value:V>new Date(F.value)),Gs(P.value)&&b&&(D=O?$(b)<$(P.value):L?b<P.value:V<new Date(P.value))}if((I||D)&&(j(!!I,F.message,P.message,ol.max,ol.min),!r))return w(N[g].message),N}if((d||c)&&!T&&(Gs(b)||s&&Array.isArray(b))){const I=Ap(d),D=Ap(c),F=!Ts(I.value)&&b.length>+I.value,P=!Ts(D.value)&&b.length<+D.value;if((F||P)&&(j(F,I.message,D.message),!r))return w(N[g].message),N}if(m&&!T&&Gs(b)){const{value:I,message:D}=Ap(m);if($w(I)&&!b.match(I)&&(N[g]={type:ol.pattern,message:D,ref:i,...E(ol.pattern,D)},!r))return w(D),N}if(f){if(Ki(f)){const I=await f(b,n),D=AM(I,v);if(D&&(N[g]={...D,...E(ol.validate,D.message)},!r))return w(D.message),N}else if(Jr(f)){let I={};for(const D in f){if(!ss(I)&&!r)break;const F=AM(await f[D](b,n),v,D);F&&(I={...F,...E(D,F.message)},w(F.message),r&&(N[g]=I))}if(!ss(I)&&(N[g]={ref:v,...I},!r))return N}}return w(!0),N};const yae={mode:Yi.onSubmit,reValidateMode:Yi.onChange,shouldFocusError:!0};function bae(e={}){let t={...yae,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:Ki(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},r={},a=Jr(t.defaultValues)||Jr(t.values)?Sa(t.defaultValues||t.values)||{}:{},s=t.shouldUnregister?{}:Sa(a),i={action:!1,mount:!1,watch:!1,keepIsValid:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u,d=0;const c={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},h={...c};let p={...h};const m={array:NM(),state:NM()},f=t.criteriaMode===Yi.all,g=Y=>ae=>{clearTimeout(d),d=setTimeout(Y,ae)},x=async Y=>{if(!i.keepIsValid&&!t.disabled&&(h.isValid||p.isValid||Y)){let ae;t.resolver?(ae=ss((await _()).errors),y()):ae=await E(r,!0),ae!==n.isValid&&m.state.next({isValid:ae})}},y=(Y,ae)=>{!t.disabled&&(h.isValidating||h.validatingFields||p.isValidating||p.validatingFields)&&((Y||Array.from(l.mount)).forEach(we=>{we&&(ae?cr(n.validatingFields,we,ae):Kr(n.validatingFields,we))}),m.state.next({validatingFields:n.validatingFields,isValidating:!ss(n.validatingFields)}))},b=(Y,ae=[],we,Ce,Ne=!0,he=!0)=>{if(Ce&&we&&!t.disabled){if(i.action=!0,he&&Array.isArray(_t(r,Y))){const Ae=we(_t(r,Y),Ce.argA,Ce.argB);Ne&&cr(r,Y,Ae)}if(he&&Array.isArray(_t(n.errors,Y))){const Ae=we(_t(n.errors,Y),Ce.argA,Ce.argB);Ne&&cr(n.errors,Y,Ae),gae(n.errors,Y)}if((h.touchedFields||p.touchedFields)&&he&&Array.isArray(_t(n.touchedFields,Y))){const Ae=we(_t(n.touchedFields,Y),Ce.argA,Ce.argB);Ne&&cr(n.touchedFields,Y,Ae)}(h.dirtyFields||p.dirtyFields)&&(n.dirtyFields=Bp(a,s)),m.state.next({name:Y,isDirty:I(Y,ae),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else cr(s,Y,ae)},v=(Y,ae)=>{cr(n.errors,Y,ae),m.state.next({errors:n.errors})},w=Y=>{n.errors=Y,m.state.next({errors:n.errors,isValid:!1})},N=(Y,ae,we,Ce)=>{const Ne=_t(r,Y);if(Ne){const he=_t(s,Y,Lr(we)?_t(a,Y):we);Lr(he)||Ce&&Ce.defaultChecked||ae?cr(s,Y,ae?he:_M(Ne._f)):P(Y,he),i.mount&&!i.action&&x()}},S=(Y,ae,we,Ce,Ne)=>{let he=!1,Ae=!1;const gt={name:Y};if(!t.disabled){if(!we||Ce){(h.isDirty||p.isDirty)&&(Ae=n.isDirty,n.isDirty=gt.isDirty=I(),he=Ae!==gt.isDirty);const ht=lu(_t(a,Y),ae);Ae=!!_t(n.dirtyFields,Y),ht?Kr(n.dirtyFields,Y):cr(n.dirtyFields,Y,!0),gt.dirtyFields=n.dirtyFields,he=he||(h.dirtyFields||p.dirtyFields)&&Ae!==!ht}if(we){const ht=_t(n.touchedFields,Y);ht||(cr(n.touchedFields,Y,we),gt.touchedFields=n.touchedFields,he=he||(h.touchedFields||p.touchedFields)&&ht!==we)}he&&Ne&&m.state.next(gt)}return he?gt:{}},C=(Y,ae,we,Ce)=>{const Ne=_t(n.errors,Y),he=(h.isValid||p.isValid)&&vo(ae)&&n.isValid!==ae;if(t.delayError&&we?(u=g(()=>v(Y,we)),u(t.delayError)):(clearTimeout(d),u=null,we?cr(n.errors,Y,we):Kr(n.errors,Y)),(we?!lu(Ne,we):Ne)||!ss(Ce)||he){const Ae={...Ce,...he&&vo(ae)?{isValid:ae}:{},errors:n.errors,name:Y};n={...n,...Ae},m.state.next(Ae)}},_=async Y=>(y(Y,!0),await t.resolver(s,t.context,cae(Y||l.mount,r,t.criteriaMode,t.shouldUseNativeValidation))),T=async Y=>{const{errors:ae}=await _(Y);if(y(Y),Y)for(const we of Y){const Ce=_t(ae,we);Ce?cr(n.errors,we,Ce):Kr(n.errors,we)}else n.errors=ae;return ae},E=async(Y,ae,we={valid:!0})=>{for(const Ce in Y){const Ne=Y[Ce];if(Ne){const{_f:he,...Ae}=Ne;if(he){const gt=l.array.has(he.name),ht=Ne._f&&dae(Ne._f);ht&&h.validatingFields&&y([he.name],!0);const Dt=await RM(Ne,l.disabled,s,f,t.shouldUseNativeValidation&&!ae,gt);if(ht&&h.validatingFields&&y([he.name]),Dt[he.name]&&(we.valid=!1,ae))break;!ae&&(_t(Dt,he.name)?gt?xae(n.errors,Dt,he.name):cr(n.errors,he.name,Dt[he.name]):Kr(n.errors,he.name))}!ss(Ae)&&await E(Ae,ae,we)}}return we.valid},j=()=>{for(const Y of l.unMount){const ae=_t(r,Y);ae&&(ae._f.refs?ae._f.refs.every(we=>!pk(we)):!pk(ae._f.ref))&&se(Y)}l.unMount=new Set},I=(Y,ae)=>!t.disabled&&(Y&&ae&&cr(s,Y,ae),!lu(U(),a)),D=(Y,ae,we)=>sae(Y,l,{...i.mount?s:Lr(ae)?a:Gs(Y)?{[Y]:ae}:ae},we,ae),F=Y=>tI(_t(i.mount?s:a,Y,t.shouldUnregister?_t(a,Y,[]):[])),P=(Y,ae,we={})=>{const Ce=_t(r,Y);let Ne=ae;if(Ce){const he=Ce._f;he&&(!he.disabled&&cr(s,Y,zL(ae,he)),Ne=Mw(he.ref)&&Ts(ae)?"":ae,PL(he.ref)?[...he.ref.options].forEach(Ae=>Ae.selected=Ne.includes(Ae.value)):he.refs?Oy(he.ref)?he.refs.forEach(Ae=>{(!Ae.defaultChecked||!Ae.disabled)&&(Array.isArray(Ne)?Ae.checked=!!Ne.find(gt=>gt===Ae.value):Ae.checked=Ne===Ae.value||!!Ne)}):he.refs.forEach(Ae=>Ae.checked=Ae.value===Ne):rI(he.ref)?he.ref.value="":(he.ref.value=Ne,he.ref.type||m.state.next({name:Y,values:Sa(s)})))}(we.shouldDirty||we.shouldTouch)&&S(Y,Ne,we.shouldTouch,we.shouldDirty,!0),we.shouldValidate&&q(Y)},V=(Y,ae,we)=>{for(const Ce in ae){if(!ae.hasOwnProperty(Ce))return;const Ne=ae[Ce],he=Y+"."+Ce,Ae=_t(r,he);(l.array.has(Y)||Jr(Ne)||Ae&&!Ae._f)&&!Wc(Ne)?V(he,Ne,we):P(he,Ne,we)}},$=(Y,ae,we={})=>{const Ce=_t(r,Y),Ne=l.array.has(Y),he=Sa(ae);cr(s,Y,he),Ne?(m.array.next({name:Y,values:Sa(s)}),(h.isDirty||h.dirtyFields||p.isDirty||p.dirtyFields)&&we.shouldDirty&&m.state.next({name:Y,dirtyFields:Bp(a,s),isDirty:I(Y,he)})):Ce&&!Ce._f&&!Ts(he)?V(Y,he,we):P(Y,he,we),EM(Y,l)&&m.state.next({...n,name:Y}),m.state.next({name:i.mount?Y:void 0,values:Sa(s)})},O=async Y=>{i.mount=!0;const ae=Y.target;let we=ae.name,Ce=!0;const Ne=_t(r,we),he=ht=>{Ce=Number.isNaN(ht)||Wc(ht)&&isNaN(ht.getTime())||lu(ht,_t(s,we,ht))},Ae=IM(t.mode),gt=IM(t.reValidateMode);if(Ne){let ht,Dt;const $t=ae.type?_M(Ne._f):Qre(Y),qe=Y.type===wM.BLUR||Y.type===wM.FOCUS_OUT,it=!hae(Ne._f)&&!t.resolver&&!_t(n.errors,we)&&!Ne._f.deps||fae(qe,_t(n.touchedFields,we),n.isSubmitted,gt,Ae),Ct=EM(we,l,qe);cr(s,we,$t),qe?(!ae||!ae.readOnly)&&(Ne._f.onBlur&&Ne._f.onBlur(Y),u&&u(0)):Ne._f.onChange&&Ne._f.onChange(Y);const pt=S(we,$t,qe),Ut=!ss(pt)||Ct;if(!qe&&m.state.next({name:we,type:Y.type,values:Sa(s)}),it)return(h.isValid||p.isValid)&&(t.mode==="onBlur"?qe&&x():qe||x()),Ut&&m.state.next({name:we,...Ct?{}:pt});if(!qe&&Ct&&m.state.next({...n}),t.resolver){const{errors:Ln}=await _([we]);if(y([we]),he($t),Ce){const bt=jM(n.errors,r,we),Ot=jM(Ln,r,bt.name||we);ht=Ot.error,we=Ot.name,Dt=ss(Ln)}}else y([we],!0),ht=(await RM(Ne,l.disabled,s,f,t.shouldUseNativeValidation))[we],y([we]),he($t),Ce&&(ht?Dt=!1:(h.isValid||p.isValid)&&(Dt=await E(r,!0)));Ce&&(Ne._f.deps&&(!Array.isArray(Ne._f.deps)||Ne._f.deps.length>0)&&q(Ne._f.deps),C(we,Dt,ht,pt))}},L=(Y,ae)=>{if(_t(n.errors,ae)&&Y.focus)return Y.focus(),1},q=async(Y,ae={})=>{let we,Ce;const Ne=Dx(Y);if(t.resolver){const he=await T(Lr(Y)?Y:Ne);we=ss(he),Ce=Y?!Ne.some(Ae=>_t(he,Ae)):we}else Y?(Ce=(await Promise.all(Ne.map(async he=>{const Ae=_t(r,he);return await E(Ae&&Ae._f?{[he]:Ae}:Ae)}))).every(Boolean),!(!Ce&&!n.isValid)&&x()):Ce=we=await E(r);return m.state.next({...!Gs(Y)||(h.isValid||p.isValid)&&we!==n.isValid?{}:{name:Y},...t.resolver||!Y?{isValid:we}:{},errors:n.errors}),ae.shouldFocus&&!Ce&&Mx(r,L,Y?Ne:l.mount),Ce},U=(Y,ae)=>{let we={...i.mount?s:a};return ae&&(we=FL(ae.dirtyFields?n.dirtyFields:n.touchedFields,we)),Lr(Y)?we:Gs(Y)?_t(we,Y):Y.map(Ce=>_t(we,Ce))},ee=(Y,ae)=>({invalid:!!_t((ae||n).errors,Y),isDirty:!!_t((ae||n).dirtyFields,Y),error:_t((ae||n).errors,Y),isValidating:!!_t(n.validatingFields,Y),isTouched:!!_t((ae||n).touchedFields,Y)}),M=Y=>{Y&&Dx(Y).forEach(ae=>Kr(n.errors,ae)),m.state.next({errors:Y?n.errors:{}})},G=(Y,ae,we)=>{const Ce=(_t(r,Y,{_f:{}})._f||{}).ref,Ne=_t(n.errors,Y)||{},{ref:he,message:Ae,type:gt,...ht}=Ne;cr(n.errors,Y,{...ht,...ae,ref:Ce}),m.state.next({name:Y,errors:n.errors,isValid:!1}),we&&we.shouldFocus&&Ce&&Ce.focus&&Ce.focus()},J=(Y,ae)=>Ki(Y)?m.state.subscribe({next:we=>"values"in we&&Y(D(void 0,ae),we)}):D(Y,ae,!0),ve=Y=>m.state.subscribe({next:ae=>{mae(Y.name,ae.name,Y.exact)&&pae(ae,Y.formState||h,Re,Y.reRenderRoot)&&Y.callback({values:{...s},...n,...ae,defaultValues:a})}}).unsubscribe,Q=Y=>(i.mount=!0,p={...p,...Y.formState},ve({...Y,formState:{...c,...Y.formState}})),se=(Y,ae={})=>{for(const we of Y?Dx(Y):l.mount)l.mount.delete(we),l.array.delete(we),ae.keepValue||(Kr(r,we),Kr(s,we)),!ae.keepError&&Kr(n.errors,we),!ae.keepDirty&&Kr(n.dirtyFields,we),!ae.keepTouched&&Kr(n.touchedFields,we),!ae.keepIsValidating&&Kr(n.validatingFields,we),!t.shouldUnregister&&!ae.keepDefaultValue&&Kr(a,we);m.state.next({values:Sa(s)}),m.state.next({...n,...ae.keepDirty?{isDirty:I()}:{}}),!ae.keepIsValid&&x()},_e=({disabled:Y,name:ae})=>{(vo(Y)&&i.mount||Y||l.disabled.has(ae))&&(Y?l.disabled.add(ae):l.disabled.delete(ae))},Le=(Y,ae={})=>{let we=_t(r,Y);const Ce=vo(ae.disabled)||vo(t.disabled);return cr(r,Y,{...we||{},_f:{...we&&we._f?we._f:{ref:{name:Y}},name:Y,mount:!0,...ae}}),l.mount.add(Y),we?_e({disabled:vo(ae.disabled)?ae.disabled:t.disabled,name:Y}):N(Y,!0,ae.value),{...Ce?{disabled:ae.disabled||t.disabled}:{},...t.progressive?{required:!!ae.required,min:Hg(ae.min),max:Hg(ae.max),minLength:Hg(ae.minLength),maxLength:Hg(ae.maxLength),pattern:Hg(ae.pattern)}:{},name:Y,onChange:O,onBlur:O,ref:Ne=>{if(Ne){Le(Y,ae),we=_t(r,Y);const he=Lr(Ne.value)&&Ne.querySelectorAll&&Ne.querySelectorAll("input,select,textarea")[0]||Ne,Ae=iae(he),gt=we._f.refs||[];if(Ae?gt.find(ht=>ht===he):he===we._f.ref)return;cr(r,Y,{_f:{...we._f,...Ae?{refs:[...gt.filter(pk),he,...Array.isArray(_t(a,Y))?[{}]:[]],ref:{type:he.type,name:Y}}:{ref:he}}}),N(Y,!1,void 0,he)}else we=_t(r,Y,{}),we._f&&(we._f.mount=!1),(t.shouldUnregister||ae.shouldUnregister)&&!(eae(l.array,Y)&&i.action)&&l.unMount.add(Y)}}},Se=()=>t.shouldFocusError&&Mx(r,L,l.mount),ye=Y=>{vo(Y)&&(m.state.next({disabled:Y}),Mx(r,(ae,we)=>{const Ce=_t(r,we);Ce&&(ae.disabled=Ce._f.disabled||Y,Array.isArray(Ce._f.refs)&&Ce._f.refs.forEach(Ne=>{Ne.disabled=Ce._f.disabled||Y}))},0,!1))},Fe=(Y,ae)=>async we=>{let Ce;we&&(we.preventDefault&&we.preventDefault(),we.persist&&we.persist());let Ne=Sa(s);if(m.state.next({isSubmitting:!0}),t.resolver){const{errors:he,values:Ae}=await _();y(),n.errors=he,Ne=Sa(Ae)}else await E(r);if(l.disabled.size)for(const he of l.disabled)Kr(Ne,he);if(Kr(n.errors,"root"),ss(n.errors)){m.state.next({errors:{}});try{await Y(Ne,we)}catch(he){Ce=he}}else ae&&await ae({...n.errors},we),Se(),setTimeout(Se);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ss(n.errors)&&!Ce,submitCount:n.submitCount+1,errors:n.errors}),Ce)throw Ce},Te=(Y,ae={})=>{_t(r,Y)&&(Lr(ae.defaultValue)?$(Y,Sa(_t(a,Y))):($(Y,ae.defaultValue),cr(a,Y,Sa(ae.defaultValue))),ae.keepTouched||Kr(n.touchedFields,Y),ae.keepDirty||(Kr(n.dirtyFields,Y),n.isDirty=ae.defaultValue?I(Y,Sa(_t(a,Y))):I()),ae.keepError||(Kr(n.errors,Y),h.isValid&&x()),m.state.next({...n}))},Oe=(Y,ae={})=>{const we=Y?Sa(Y):a,Ce=Sa(we),Ne=ss(Y),he=Ne?a:Ce;if(ae.keepDefaultValues||(a=we),!ae.keepValues){if(ae.keepDirtyValues){const Ae=new Set([...l.mount,...Object.keys(Bp(a,s))]);for(const gt of Array.from(Ae))_t(n.dirtyFields,gt)?cr(he,gt,_t(s,gt)):$(gt,_t(he,gt))}else{if(eI&&Lr(Y))for(const Ae of l.mount){const gt=_t(r,Ae);if(gt&&gt._f){const ht=Array.isArray(gt._f.refs)?gt._f.refs[0]:gt._f.ref;if(Mw(ht)){const Dt=ht.closest("form");if(Dt){Dt.reset();break}}}}if(ae.keepFieldsRef)for(const Ae of l.mount)$(Ae,_t(he,Ae));else r={}}s=t.shouldUnregister?ae.keepDefaultValues?Sa(a):{}:Sa(he),m.array.next({values:{...he}}),m.state.next({values:{...he}})}l={mount:ae.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!h.isValid||!!ae.keepIsValid||!!ae.keepDirtyValues||!t.shouldUnregister&&!ss(he),i.watch=!!t.shouldUnregister,i.keepIsValid=!!ae.keepIsValid,i.action=!1,ae.keepErrors||(n.errors={}),m.state.next({submitCount:ae.keepSubmitCount?n.submitCount:0,isDirty:Ne?!1:ae.keepDirty?n.isDirty:!!(ae.keepDefaultValues&&!lu(Y,a)),isSubmitted:ae.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:Ne?{}:ae.keepDirtyValues?ae.keepDefaultValues&&s?Bp(a,s):n.dirtyFields:ae.keepDefaultValues&&Y?Bp(a,Y):ae.keepDirty?n.dirtyFields:{},touchedFields:ae.keepTouched?n.touchedFields:{},errors:ae.keepErrors?n.errors:{},isSubmitSuccessful:ae.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:a})},He=(Y,ae)=>Oe(Ki(Y)?Y(s):Y,{...t.resetOptions,...ae}),Ee=(Y,ae={})=>{const we=_t(r,Y),Ce=we&&we._f;if(Ce){const Ne=Ce.refs?Ce.refs[0]:Ce.ref;Ne.focus&&setTimeout(()=>{Ne.focus(),ae.shouldSelect&&Ki(Ne.select)&&Ne.select()})}},Re=Y=>{n={...n,...Y}},at={control:{register:Le,unregister:se,getFieldState:ee,handleSubmit:Fe,setError:G,_subscribe:ve,_runSchema:_,_updateIsValidating:y,_focusError:Se,_getWatch:D,_getDirty:I,_setValid:x,_setFieldArray:b,_setDisabledField:_e,_setErrors:w,_getFieldArray:F,_reset:Oe,_resetDefaultValues:()=>Ki(t.defaultValues)&&t.defaultValues().then(Y=>{He(Y,t.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:j,_disableForm:ye,_subjects:m,_proxyFormState:h,get _fields(){return r},get _formValues(){return s},get _state(){return i},set _state(Y){i=Y},get _defaultValues(){return a},get _names(){return l},set _names(Y){l=Y},get _formState(){return n},get _options(){return t},set _options(Y){t={...t,...Y}}},subscribe:Q,trigger:q,register:Le,handleSubmit:Fe,watch:J,setValue:$,getValues:U,reset:He,resetField:Te,clearErrors:M,unregister:se,setError:G,setFocus:Ee,getFieldState:ee};return{...at,formControl:at}}function vae(e={}){const t=ge.useRef(void 0),n=ge.useRef(void 0),[r,a]=ge.useState({isDirty:!1,isValidating:!1,isLoading:Ki(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:Ki(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:r},e.defaultValues&&!Ki(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:i,...l}=bae(e);t.current={...l,formState:r}}const s=t.current.control;return s._options=e,aae(()=>{const i=s._subscribe({formState:s._proxyFormState,callback:()=>a({...s._formState}),reRenderRoot:!0});return a(l=>({...l,isReady:!0})),s._formState.isReady=!0,i},[s]),ge.useEffect(()=>s._disableForm(e.disabled),[s,e.disabled]),ge.useEffect(()=>{e.mode&&(s._options.mode=e.mode),e.reValidateMode&&(s._options.reValidateMode=e.reValidateMode)},[s,e.mode,e.reValidateMode]),ge.useEffect(()=>{e.errors&&(s._setErrors(e.errors),s._focusError())},[s,e.errors]),ge.useEffect(()=>{e.shouldUnregister&&s._subjects.state.next({values:s._getWatch()})},[s,e.shouldUnregister]),ge.useEffect(()=>{if(s._proxyFormState.isDirty){const i=s._getDirty();i!==r.isDirty&&s._subjects.state.next({isDirty:i})}},[s,r.isDirty]),ge.useEffect(()=>{var i;e.values&&!lu(e.values,n.current)?(s._reset(e.values,{keepFieldsRef:!0,...s._options.resetOptions}),!((i=s._options.resetOptions)===null||i===void 0)&&i.keepIsValid||s._setValid(),n.current=e.values,a(l=>({...l}))):s._resetDefaultValues()},[s,e.values]),ge.useEffect(()=>{s._state.mount||(s._setValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),t.current.formState=rae(r,s),t.current}const DM=(e,t,n)=>{if(e&&"reportValidity"in e){const r=_t(n,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},WL=(e,t)=>{for(const n in t.fields){const r=t.fields[n];r&&r.ref&&"reportValidity"in r.ref?DM(r.ref,n,e):r.refs&&r.refs.forEach(a=>DM(a,n,e))}},wae=(e,t)=>{t.shouldUseNativeValidation&&WL(e,t);const n={};for(const r in e){const a=_t(t.fields,r),s=Object.assign(e[r]||{},{ref:a&&a.ref});if(Nae(t.names||Object.keys(e),r)){const i=Object.assign({},_t(n,r));cr(i,"root",s),cr(n,r,i)}else cr(n,r,s)}return n},Nae=(e,t)=>e.some(n=>n.startsWith(t+"."));var kae=function(e,t){for(var n={};e.length;){var r=e[0],a=r.code,s=r.message,i=r.path.join(".");if(!n[i])if("unionErrors"in r){var l=r.unionErrors[0].errors[0];n[i]={message:l.message,type:l.code}}else n[i]={message:s,type:a};if("unionErrors"in r&&r.unionErrors.forEach(function(c){return c.errors.forEach(function(h){return e.push(h)})}),t){var u=n[i].types,d=u&&u[r.code];n[i]=$L(i,t,n,a,d?[].concat(d,r.message):r.message)}e.shift()}return n},Sae=function(e,t,n){return n===void 0&&(n={}),function(r,a,s){try{return Promise.resolve(function(i,l){try{var u=Promise.resolve(e[n.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(d){return s.shouldUseNativeValidation&&WL({},s),{errors:{},values:n.raw?r:d}})}catch(d){return l(d)}return u&&u.then?u.then(void 0,l):u}(0,function(i){if(function(l){return Array.isArray(l==null?void 0:l.errors)}(i))return{values:{},errors:wae(kae(i.errors,!s.shouldUseNativeValidation&&s.criteriaMode==="all"),s)};throw i}))}catch(i){return Promise.reject(i)}}};const sI="synka_chat_session",iI="synka_chat_messages",oI="synka_chat_last_activity",lI="synka_chat_session_created",$x="synka_chat_goodbye_sent",Yv="synka_chat_show_form",VL="synka_bot_messages",Cae=6e4,MM=12e4,_ae=1e4,$M="https://qlrnewbkolxjdtfffuml.supabase.co/functions/v1/saira-chat",cv="https://qlrnewbkolxjdtfffuml.supabase.co/functions/v1/saira-session",Iae=Zre({name:hk().min(1,"Name is required"),email:hk().email("Invalid email").optional().or(vM("")),mobile:hk().optional().or(vM(""))}).refine(e=>e.email||e.mobile,{message:"Email or mobile is required",path:["email"]}),Tae=()=>localStorage.getItem($x)==="true",Eae=e=>e?e.split(" ")[0]:"",FM=()=>{try{const e=localStorage.getItem(VL);if(e)return JSON.parse(e)}catch{}return null},jae=e=>{try{localStorage.setItem(VL,JSON.stringify(e))}catch{}},PM=()=>{try{const e=localStorage.getItem(sI);if(e)return JSON.parse(e)}catch{}return null},Aae=()=>{try{const e=localStorage.getItem(iI);if(e)return JSON.parse(e).map(n=>({...n,timestamp:new Date(n.timestamp)}))}catch{}return[]},mk=e=>{try{localStorage.setItem(sI,JSON.stringify(e))}catch{}},dv=e=>{try{localStorage.setItem(iI,JSON.stringify(e))}catch{}},Rae=()=>{try{localStorage.setItem(oI,Date.now().toString())}catch{}},fk=()=>{try{const e=localStorage.getItem(oI);if(e)return parseInt(e,10)}catch{}return Date.now()},gk=()=>{try{return localStorage.getItem(lI)==="true"}catch{return!1}},Dae=()=>{try{localStorage.setItem(lI,"true")}catch{}},uI="synka_chat_session_ended",xk=()=>{try{localStorage.removeItem(sI),localStorage.removeItem(iI),localStorage.removeItem(oI),localStorage.removeItem(lI),localStorage.removeItem($x),localStorage.removeItem(uI),localStorage.removeItem(Yv)}catch{}},OM=()=>{try{localStorage.setItem(uI,"true")}catch{}},LM=()=>{try{return localStorage.getItem(uI)==="true"}catch{return!1}};function UL(){var we;const[e,t]=k.useState(!1),[n,r]=k.useState([]),[a,s]=k.useState(""),[i,l]=k.useState(!1),[u,d]=k.useState(!1),[c,h]=k.useState(()=>LM()),[p,m]=k.useState(!1),[f,g]=k.useState(!1),[x,y]=k.useState(!1),[b,v]=k.useState(!1),[w,N]=k.useState(()=>FM()!==null),S=k.useRef(FM()),[C,_]=k.useState(()=>{const Ce=PM();return Ce||{sessionId:crypto.randomUUID(),userInfo:{name:"",email:"",mobile:"",isExistingUser:!1},detailsCaptured:!1}});k.useEffect(()=>{(async()=>{try{const he=await(await fetch(cv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_messages"})})).json();he.success&&he.messages?(S.current=he.messages,jae(he.messages),N(!0)):console.error("Failed to load bot messages from backend")}catch(Ne){console.error("Failed to fetch bot messages:",Ne)}})()},[]);const{register:T,handleSubmit:E,formState:{errors:j},reset:I,setValue:D}=vae({resolver:Sae(Iae),defaultValues:{name:"",email:"",mobile:""}}),F=k.useRef(fk()),P=k.useRef(!1),V=k.useRef(null),$=k.useRef(null),O=k.useRef(!1),L=k.useRef(!1),q=k.useRef(gk()),U=k.useRef(null),ee=k.useRef(null),M=k.useRef(null),G=async(Ce,Ne)=>{if(q.current)return{isExistingUser:Ne.isExistingUser};try{const Ae=await(await fetch(cv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",sessionId:Ce.sessionId,userInfo:{name:Ne.name,email:Ne.email,mobile:Ne.mobile}})})).json();return Ae.success?(q.current=!0,Dae(),{isExistingUser:Ae.isExistingUser,existingUserName:Ae.existingUserName,greetingMessage:Ae.greetingMessage}):(console.error("Session create error:",Ae.error),{isExistingUser:!1})}catch(he){return console.error("Error creating session:",he),{isExistingUser:!1}}},J=async(Ce,Ne)=>{try{await fetch(cv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"end",sessionId:Ce,reason:Ne}),keepalive:!0})}catch(he){console.error("Error ending session:",he)}},ve=async(Ce,Ne,he)=>{if(q.current)try{await le.from("chat_messages").insert({session_id:Ce,role:Ne,content:he})}catch(Ae){console.error("Error saving message:",Ae)}},Q=k.useCallback(()=>{V.current&&(clearInterval(V.current),V.current=null)},[]),se=k.useCallback(()=>{$.current&&(clearInterval($.current),$.current=null)},[]),_e=k.useCallback(async()=>{if(!(O.current||!C.detailsCaptured||!q.current))try{const Ne=await(await fetch($M,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk"},body:JSON.stringify({action:"idle_check",sessionId:C.sessionId})})).json();if(Ne.send&&Ne.message){console.log(`Received delayed follow-up for intent: ${Ne.intent}`);const he={id:crypto.randomUUID(),role:"assistant",content:Ne.message,timestamp:new Date};r(Ae=>[...Ae,he]),await ve(C.sessionId,"assistant",Ne.message)}}catch(Ce){console.error("Idle check error:",Ce)}},[C.sessionId,C.detailsCaptured]),Le=k.useCallback(()=>{se(),$.current=setInterval(_e,_ae)},[_e,se]),Se=k.useCallback(async(Ce,Ne,he=!0)=>{if(!O.current){if(O.current=!0,Q(),se(),he&&!L.current&&!Tae()){L.current=!0,localStorage.setItem($x,"true");try{const ht=(await(await fetch(cv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"end",sessionId:Ne.sessionId,userInfo:Ne.userInfo,reason:Ce})})).json()).goodbyeMessage;if(ht||console.error("Backend did not return goodbye message"),ht){const Dt={id:crypto.randomUUID(),role:"assistant",content:ht,timestamp:new Date};r($t=>[...$t,Dt]),await ve(Ne.sessionId,"assistant",ht)}}catch(Ae){console.error("Error ending session:",Ae)}}else await J(Ne.sessionId,Ce);h(!0),OM()}},[Q,se]),ye=k.useCallback(()=>{var Ne;xk(),O.current=!1,L.current=!1,P.current=!1,q.current=!1,I();const Ce={sessionId:crypto.randomUUID(),userInfo:{name:"",email:"",mobile:"",isExistingUser:!1},detailsCaptured:!1};_(Ce),h(!1),g(!1),y(!1),v(!1),(Ne=S.current)!=null&&Ne.welcome?r([{id:crypto.randomUUID(),role:"assistant",content:S.current.welcome,timestamp:new Date}]):r([])},[I]),Fe=k.useCallback(()=>{var Ce;if(!((Ce=S.current)!=null&&Ce.form_intro)){console.error("Bot messages not loaded");return}g(!0),localStorage.setItem(Yv,"true"),r(Ne=>[...Ne,{id:crypto.randomUUID(),role:"assistant",content:S.current.form_intro,timestamp:new Date}])},[]),Te=k.useCallback(async Ce=>{var Ae;if(P.current||O.current||L.current)return;if(!((Ae=S.current)!=null&&Ae.warning)){console.error("Warning message not loaded from backend");return}P.current=!0;const Ne=S.current.warning,he={id:crypto.randomUUID(),role:"assistant",content:Ne,timestamp:new Date};r(gt=>[...gt,he]),await ve(Ce.sessionId,"assistant",Ne)},[]),Oe=k.useCallback(async()=>{if(O.current||!C.detailsCaptured||!x)return;const Ne=Date.now()-F.current,he={...C};if(Ne>=MM){await Se("No response after warning",he);return}Ne>=Cae&&!P.current&&Te(he)},[C,Se,Te,x]);k.useEffect(()=>{if(!C.detailsCaptured||O.current){Q(),se();return}const Ce=fk();if(Date.now()-Ce>=MM){const he={...C};(async()=>await Se("Session timeout while inactive",he))();return}return Q(),V.current=setInterval(Oe,5e3),Le(),()=>{Q(),se()}},[C,Oe,Se,Q,se,Le]),k.useEffect(()=>{const Ce=()=>{C.sessionId&&(mk(C),n.length>0&&dv(n))};return window.addEventListener("beforeunload",Ce),()=>window.removeEventListener("beforeunload",Ce)},[C,n]),k.useEffect(()=>{(async()=>{var Dt,$t;if(u)return;if(d(!0),LM()){xk(),O.current=!1,h(!1),g(!1),y(!1),v(!1),(Dt=S.current)!=null&&Dt.welcome&&r([{id:crypto.randomUUID(),role:"assistant",content:S.current.welcome,timestamp:new Date}]);return}const he=PM(),Ae=Aae(),gt=localStorage.getItem($x)==="true",ht=localStorage.getItem(Yv)==="true";if(L.current=gt,he&&(_(he),q.current=gk(),O.current=!1,he.detailsCaptured||(g(ht),he.userInfo&&(D("name",he.userInfo.name||""),D("email",he.userInfo.email||""),D("mobile",he.userInfo.mobile||"")))),Ae.length>0){r(Ae),Ae.some(it=>it.role==="user")&&(F.current=fk(),y(!0));return}if(he!=null&&he.sessionId&&gk()){const{data:qe}=await le.from("chat_messages").select("*").eq("session_id",he.sessionId).order("created_at",{ascending:!0});if(qe&&qe.length>0){const it=qe.map(pt=>({id:pt.id,role:pt.role,content:pt.content,timestamp:new Date(pt.created_at)}));r(it),dv(it),it.some(pt=>pt.role==="user")&&y(!0);return}}($t=S.current)!=null&&$t.welcome&&r([{id:crypto.randomUUID(),role:"assistant",content:S.current.welcome,timestamp:new Date}])})()},[u,D]),k.useEffect(()=>{e&&mk(C)},[e,C]),k.useEffect(()=>{ee.current&&ee.current.scrollIntoView({behavior:"smooth"}),n.length>0&&dv(n)},[n]),k.useEffect(()=>{e&&M.current&&C.detailsCaptured&&!c&&setTimeout(()=>{var Ce;return(Ce=M.current)==null?void 0:Ce.focus()},100)},[e,C.detailsCaptured,c]);const He=async(Ce,Ne,he,Ae)=>{var bt,Ot,Et,Lt;const gt=n.filter(At=>At.role!=="assistant"||!At.content.includes("I'm Saira")).concat({id:"",role:"user",content:Ce,timestamp:new Date}).map(At=>({role:At.role,content:At.content})),ht=await fetch($M,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk"},body:JSON.stringify({messages:gt,sessionId:he,awaitingClosureConfirmation:Ae,userInfo:{...Ne,firstName:Eae(Ne.name)}})});if(!ht.ok||!ht.body){const At=await ht.json().catch(()=>({}));throw new Error(At.error||"Failed to get response")}if((ht.headers.get("content-type")||"").includes("application/json")){const At=await ht.json();return{content:At.reply||"",sessionEnded:At.sessionEnded||!1}}const $t=ht.body.getReader(),qe=new TextDecoder;let it="",Ct="",pt;const Ut="streaming-"+crypto.randomUUID();for(U.current=Ut,r(At=>[...At,{id:Ut,role:"assistant",content:"",timestamp:new Date}]);;){const{done:At,value:zt}=await $t.read();if(At)break;Ct+=qe.decode(zt,{stream:!0});let Sn;for(;(Sn=Ct.indexOf(`
`))!==-1;){let ot=Ct.slice(0,Sn);if(Ct=Ct.slice(Sn+1),ot.endsWith("\r")&&(ot=ot.slice(0,-1)),ot.trim()===""||!ot.startsWith("data: "))continue;const pe=ot.slice(6).trim();if(pe==="[DONE]")break;try{const Me=JSON.parse(pe);if((bt=Me.synka_meta)!=null&&bt.followUp){pt=Me.synka_meta.followUp;continue}const Je=(Lt=(Et=(Ot=Me.choices)==null?void 0:Ot[0])==null?void 0:Et.delta)==null?void 0:Lt.content;Je&&(it+=Je,r(ze=>ze.map(Ft=>Ft.id===Ut?{...Ft,content:it}:Ft)))}catch{Ct=ot+`
`+Ct;break}}}const Ln=crypto.randomUUID();return r(At=>At.map(zt=>zt.id===Ut?{...zt,id:Ln}:zt)),U.current=null,{content:it,followUp:pt}},Ee=k.useCallback(async()=>{var ht;if(!a.trim()||i||!C.detailsCaptured)return;if(O.current){ye();return}const Ce=a.trim();s(""),l(!0);const Ne=b;v(!1);const he={...C},Ae=he.sessionId,gt={id:crypto.randomUUID(),role:"user",content:Ce,timestamp:new Date};r(Dt=>[...Dt,gt]),F.current=Date.now(),Rae(),P.current=!1,y(!0),await ve(Ae,"user",Ce);try{const Dt=await He(Ce,he.userInfo,Ae,Ne);if(Dt.sessionEnded){if(Dt.content){const $t={id:crypto.randomUUID(),role:"assistant",content:Dt.content,timestamp:new Date};r(qe=>[...qe,$t]),await ve(Ae,"assistant",Dt.content)}O.current=!0,L.current=!0,localStorage.setItem($x,"true"),h(!0),OM(),Q(),l(!1);return}if(Dt.followUp){v(!0);const $t={id:crypto.randomUUID(),role:"assistant",content:Dt.followUp,timestamp:new Date};r(qe=>[...qe,$t]),await ve(Ae,"assistant",Dt.followUp)}Dt.content&&await ve(Ae,"assistant",Dt.content)}catch(Dt){console.error("Chat error:",Dt);const $t=(ht=S.current)==null?void 0:ht.error;if($t){const qe={id:crypto.randomUUID(),role:"assistant",content:$t,timestamp:new Date};r(it=>[...it,qe]),await ve(Ae,"assistant",$t)}v(!1)}finally{l(!1)}},[a,i,n,C,ye,b,Q]),Re=async Ce=>{m(!0);const Ne={...C};try{const he={name:Ce.name,email:Ce.email||"",mobile:Ce.mobile||"",isExistingUser:!1},Ae=await G(Ne,he);he.isExistingUser=Ae.isExistingUser,Ae.existingUserName&&!he.name&&(he.name=Ae.existingUserName);const gt={...Ne,userInfo:he,detailsCaptured:!0};_(gt),mk(gt),g(!1),localStorage.removeItem(Yv),v(!1);const ht=Ae.greetingMessage;if(ht||console.error("Backend did not return greeting message"),ht){const Dt={id:crypto.randomUUID(),role:"assistant",content:ht,timestamp:new Date};r([Dt]),dv([Dt]),await ve(Ne.sessionId,"assistant",ht)}}catch(he){console.error("Error in form submission:",he)}finally{m(!1)}},Ke=Ce=>{Ce.key==="Enter"&&!Ce.shiftKey&&C.detailsCaptured&&(Ce.preventDefault(),Ee())},at=k.useCallback(()=>{t(!1),c&&setTimeout(()=>{xk(),ye()},300)},[c,ye]),Y=f&&!C.detailsCaptured&&!c,ae=!f&&!C.detailsCaptured&&!c&&w;return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:Ie("fixed bottom-6 right-6 z-50 flex flex-col items-center gap-2","transition-all duration-300 ease-out",e&&"scale-0 opacity-0 pointer-events-none"),children:[o.jsx("button",{onClick:()=>t(!e),className:Ie("w-14 h-14 rounded-full","bg-primary shadow-lg overflow-hidden","flex items-center justify-center","transition-all duration-300 ease-out","hover:scale-110 hover:shadow-xl"),"aria-label":"Open chat",children:o.jsx("img",{src:"/images/ai/ai-assistant-for-nfc-digital-business-cards.jpg",alt:"AI assistant for NFC digital business cards helping users share contact details",className:"w-full h-full object-cover"})}),o.jsx("div",{className:Ie("bg-background border border-border rounded-full px-3 py-1.5 shadow-lg","animate-[bounce_2s_ease-in-out_infinite]"),children:o.jsx("span",{className:"text-xs font-medium text-foreground whitespace-nowrap",children:"Hi  I'm here to help"})})]}),o.jsxs("div",{className:Ie("fixed bottom-6 right-6 z-50","w-[380px] max-w-[calc(100vw-48px)] h-[600px] max-h-[calc(100vh-100px)]","bg-background border border-border rounded-2xl shadow-2xl","flex flex-col overflow-hidden","transition-all duration-300 ease-out origin-bottom-right",e?"scale-100 opacity-100":"scale-0 opacity-0 pointer-events-none"),children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-primary/5",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden",children:o.jsx("img",{src:"/images/ai/ai-assistant-for-nfc-digital-business-cards.jpg",alt:"AI assistant for NFC digital business cards helping users share contact details",className:"w-full h-full object-cover"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-foreground",children:"Saira"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Synka AI Assistant"})]})]}),o.jsx("button",{onClick:at,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Close chat",children:o.jsx(Mo,{className:"w-5 h-5 text-muted-foreground"})})]}),o.jsx(Q_,{className:"flex-1 p-4",children:o.jsxs("div",{className:"space-y-4",children:[!w&&n.length===0&&o.jsx("div",{className:"flex justify-center py-8",children:o.jsx(Gt,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),n.map(Ce=>o.jsx("div",{className:Ie("flex",Ce.role==="user"?"justify-end":"justify-start"),children:o.jsx("div",{className:Ie("max-w-[85%] rounded-2xl px-4 py-2.5",Ce.role==="user"?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md"),children:o.jsx("p",{className:"text-sm whitespace-pre-wrap",children:Ce.content})})},Ce.id)),Y&&o.jsx("div",{className:"flex justify-start",children:o.jsx("div",{className:"max-w-[85%] bg-muted rounded-2xl rounded-bl-md p-4",children:o.jsxs("form",{onSubmit:E(Re),className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Name *"}),o.jsxs("div",{className:"relative",children:[o.jsx(bl,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx("input",{...T("name"),className:"w-full pl-10 pr-3 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Your name",disabled:p})]}),j.name&&o.jsx("p",{className:"text-xs text-red-500 mt-1",children:j.name.message})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Email"}),o.jsxs("div",{className:"relative",children:[o.jsx(xi,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx("input",{...T("email"),type:"email",className:"w-full pl-10 pr-3 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"your@email.com",disabled:p})]}),j.email&&o.jsx("p",{className:"text-xs text-red-500 mt-1",children:j.email.message})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Mobile"}),o.jsxs("div",{className:"relative",children:[o.jsx(Ry,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx("input",{...T("mobile"),type:"tel",className:"w-full pl-10 pr-3 py-2 text-sm bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Mobile number",disabled:p})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"* Email or Mobile required"})]}),o.jsx(fe,{type:"submit",disabled:p,className:"w-full rounded-full mt-2",children:p?o.jsx(Gt,{className:"w-4 h-4 animate-spin"}):"Start Chat"})]})})}),i&&!U.current&&((we=n[n.length-1])==null?void 0:we.role)==="user"&&o.jsx("div",{className:"flex justify-start",children:o.jsx("div",{className:"bg-muted rounded-2xl rounded-bl-md px-4 py-3",children:o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),o.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),o.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),o.jsx("div",{ref:ee})]})}),o.jsx("div",{className:"p-4 border-t border-border",children:c?o.jsxs(fe,{onClick:ye,className:"w-full rounded-full gap-2",children:[o.jsx(hw,{className:"w-4 h-4"}),"Start New Chat"]}):ae?o.jsx(fe,{onClick:Fe,className:"w-full rounded-full",children:"Start Chat"}):Y?o.jsx("div",{className:"text-center text-sm text-muted-foreground py-2",children:"Please complete the form above to start chatting"}):w?o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ge,{ref:M,value:a,onChange:Ce=>s(Ce.target.value),onKeyDown:Ke,placeholder:"Type your message...",disabled:i,className:"flex-1 rounded-full"}),o.jsx(fe,{onClick:Ee,disabled:!a.trim()||i,size:"icon",className:"rounded-full shrink-0",children:i?o.jsx(Gt,{className:"w-4 h-4 animate-spin"}):o.jsx(M3,{className:"w-4 h-4"})})]}):o.jsx("div",{className:"flex justify-center py-2",children:o.jsx(Gt,{className:"w-5 h-5 animate-spin text-muted-foreground"})})})]})]})}const Mae=["1-tap digital business card exchange (NFC + QR)","Automatic lead capture","Smart follow-ups & reminders","Real-time analytics"],$ae=["Built-in CRM for contacts & notes","Team & employee card tracking","Founder & manager dashboards","AI-designed digital cards & templates"];function Fae({onBiometricLogin:e,biometricInfo:t,isBiometricLoading:n}){const r=za(),a=k.useRef(null),[s,i]=k.useState(0);k.useEffect(()=>{const d=setInterval(()=>{i(c=>c===0?1:0)},3e3);return()=>clearInterval(d)},[]);const l=d=>{Ir.light(),r(d)},u=s===0?Mae:$ae;return o.jsxs("div",{ref:a,className:"relative min-h-dvh w-full flex flex-col bg-background overscroll-contain",children:[o.jsx("div",{className:"absolute inset-0 -z-10 bg-center bg-cover opacity-[0.06] blur-3xl scale-110",style:{backgroundImage:"url('/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg')"}}),o.jsx("div",{className:"absolute inset-0 -z-10 bg-gradient-to-b from-background via-background/90 to-background"}),o.jsxs("header",{className:"flex items-center justify-between px-4 py-3 pt-[calc(0.75rem+env(safe-area-inset-top))]",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("img",{src:"/logos/synka-logo.png",alt:"Synka",className:"w-8 h-8 object-contain"}),o.jsx("span",{className:"text-lg font-semibold tracking-tight gradient-text",children:"SYNKA"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(fe,{variant:"ghost",size:"sm",onClick:()=>l("/login"),className:"text-sm px-3",children:"Login"}),o.jsx(fe,{size:"sm",onClick:()=>l("/signup"),className:"text-sm px-4 rounded-full bg-primary text-primary-foreground",children:"Sign up"})]})]}),o.jsxs("main",{className:"px-4 text-center pt-4",children:[o.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium mb-4",children:"SYNKA  Simply Connected"}),o.jsxs("h1",{className:"text-[1.6rem] font-bold leading-tight tracking-tight",children:["Indias most powerful"," ",o.jsx("span",{className:"gradient-text",children:"digital business card"})]}),o.jsx("p",{className:"text-sm text-muted-foreground mt-3 max-w-[22rem] mx-auto",children:"Smart NFC & QR business cards that share instantly and capture leads. AI-designed cards with built-in CRM and real-time analytics."}),o.jsx("div",{className:"relative mt-6 min-h-[96px] overflow-hidden",children:o.jsx(nM.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.4},className:"grid grid-cols-1 gap-3 text-left max-w-sm mx-auto",children:u.map(d=>o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-primary mt-1 flex-shrink-0"}),o.jsx("span",{className:"text-sm text-muted-foreground",children:d})]},d))},s)}),o.jsxs(fe,{size:"lg",onClick:()=>l("/signup"),className:"w-full mt-6 py-5 text-base rounded-full bg-primary text-primary-foreground shadow-lg",children:["Create your free card",o.jsx(fi,{className:"h-5 w-5 ml-2"})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Free forever digital business card  Lifetime free NFC card on Orange plan"})]}),o.jsx(nM.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.45,delay:.25},className:"mt-3 pb-[calc(0.75rem+env(safe-area-inset-bottom))]",children:o.jsx(dre,{})}),o.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:o.jsx(UL,{})})]})}/*! Capacitor: https://capacitorjs.com/ - MIT License */const Pae=e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},r=(s,i)=>{n.platforms.set(s,i)},a=s=>{n.platforms.has(s)&&(n.currentPlatform=n.platforms.get(s))};return n.addPlatform=r,n.setPlatform=a,n},Oae=e=>e.CapacitorPlatforms=Pae(e),HL=Oae(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});HL.addPlatform;HL.setPlatform;var Mm;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Mm||(Mm={}));class yk extends Error{constructor(t,n){super(t),this.message=t,this.code=n}}const Lae=e=>{var t,n;return e!=null&&e.androidBridge?"android":!((n=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},zae=e=>{var t,n,r,a,s;const i=e.CapacitorCustomPlatform||null,l=e.Capacitor||{},u=l.Plugins=l.Plugins||{},d=e.CapacitorPlatforms,c=()=>i!==null?i.name:Lae(e),h=((t=d==null?void 0:d.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||c,p=()=>h()!=="web",m=((n=d==null?void 0:d.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||p,f=C=>{const _=w.get(C);return!!(_!=null&&_.platforms.has(h())||y(C))},g=((r=d==null?void 0:d.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||f,x=C=>{var _;return(_=l.PluginHeaders)===null||_===void 0?void 0:_.find(T=>T.name===C)},y=((a=d==null?void 0:d.currentPlatform)===null||a===void 0?void 0:a.getPluginHeader)||x,b=C=>e.console.error(C),v=(C,_,T)=>Promise.reject(`${T} does not have an implementation of "${_}".`),w=new Map,N=(C,_={})=>{const T=w.get(C);if(T)return console.warn(`Capacitor plugin "${C}" already registered. Cannot register plugins twice.`),T.proxy;const E=h(),j=y(C);let I;const D=async()=>(!I&&E in _?I=typeof _[E]=="function"?I=await _[E]():I=_[E]:i!==null&&!I&&"web"in _&&(I=typeof _.web=="function"?I=await _.web():I=_.web),I),F=(q,U)=>{var ee,M;if(j){const G=j==null?void 0:j.methods.find(J=>U===J.name);if(G)return G.rtype==="promise"?J=>l.nativePromise(C,U.toString(),J):(J,ve)=>l.nativeCallback(C,U.toString(),J,ve);if(q)return(ee=q[U])===null||ee===void 0?void 0:ee.bind(q)}else{if(q)return(M=q[U])===null||M===void 0?void 0:M.bind(q);throw new yk(`"${C}" plugin is not implemented on ${E}`,Mm.Unimplemented)}},P=q=>{let U;const ee=(...M)=>{const G=D().then(J=>{const ve=F(J,q);if(ve){const Q=ve(...M);return U=Q==null?void 0:Q.remove,Q}else throw new yk(`"${C}.${q}()" is not implemented on ${E}`,Mm.Unimplemented)});return q==="addListener"&&(G.remove=async()=>U()),G};return ee.toString=()=>`${q.toString()}() { [capacitor code] }`,Object.defineProperty(ee,"name",{value:q,writable:!1,configurable:!1}),ee},V=P("addListener"),$=P("removeListener"),O=(q,U)=>{const ee=V({eventName:q},U),M=async()=>{const J=await ee;$({eventName:q,callbackId:J},U)},G=new Promise(J=>ee.then(()=>J({remove:M})));return G.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await M()},G},L=new Proxy({},{get(q,U){switch(U){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return j?O:V;case"removeListener":return $;default:return P(U)}}});return u[C]=L,w.set(C,{name:C,proxy:L,platforms:new Set([...Object.keys(_),...j?[E]:[]])}),L},S=((s=d==null?void 0:d.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||N;return l.convertFileSrc||(l.convertFileSrc=C=>C),l.getPlatform=h,l.handleError=b,l.isNativePlatform=m,l.isPluginAvailable=g,l.pluginMethodNoop=v,l.registerPlugin=S,l.Exception=yk,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},Bae=e=>e.Capacitor=zae(e),Fw=Bae(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Wae=Fw.registerPlugin;Fw.Plugins;class TKe{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,n){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n);const a=this.windowListeners[t];a&&!a.registered&&this.addWindowListener(a);const s=async()=>this.removeListener(t,n),i=Promise.resolve({remove:s});return Object.defineProperty(i,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await s()}}),i}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n){const r=this.listeners[t];r&&r.forEach(a=>a(n))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(t="not implemented"){return new Fw.Exception(t,Mm.Unimplemented)}unavailable(t="not available"){return new Fw.Exception(t,Mm.Unavailable)}async removeListener(t,n){const r=this.listeners[t];if(!r)return;const a=r.indexOf(n);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}var au;(function(e){e[e.NONE=0]="NONE",e[e.TOUCH_ID=1]="TOUCH_ID",e[e.FACE_ID=2]="FACE_ID",e[e.FINGERPRINT=3]="FINGERPRINT",e[e.FACE_AUTHENTICATION=4]="FACE_AUTHENTICATION",e[e.IRIS_AUTHENTICATION=5]="IRIS_AUTHENTICATION",e[e.MULTIPLE=6]="MULTIPLE"})(au||(au={}));var zM;(function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BIOMETRICS_UNAVAILABLE=1]="BIOMETRICS_UNAVAILABLE",e[e.USER_LOCKOUT=2]="USER_LOCKOUT",e[e.BIOMETRICS_NOT_ENROLLED=3]="BIOMETRICS_NOT_ENROLLED",e[e.USER_TEMPORARY_LOCKOUT=4]="USER_TEMPORARY_LOCKOUT",e[e.AUTHENTICATION_FAILED=10]="AUTHENTICATION_FAILED",e[e.APP_CANCEL=11]="APP_CANCEL",e[e.INVALID_CONTEXT=12]="INVALID_CONTEXT",e[e.NOT_INTERACTIVE=13]="NOT_INTERACTIVE",e[e.PASSCODE_NOT_SET=14]="PASSCODE_NOT_SET",e[e.SYSTEM_CANCEL=15]="SYSTEM_CANCEL",e[e.USER_CANCEL=16]="USER_CANCEL",e[e.USER_FALLBACK=17]="USER_FALLBACK"})(zM||(zM={}));const $m=Wae("NativeBiometric",{web:()=>Qu(()=>import("./web-DUCE8e5O.js"),__vite__mapDeps([4,1,2,3])).then(e=>new e.NativeBiometricWeb)}),N2="com.synka.app",GL="synka_biometric_credentials_stored";function Vae(){try{return localStorage.getItem(GL)==="true"}catch{return!1}}function Pw(e){try{localStorage.setItem(GL,e?"true":"false")}catch{}}async function am(){if(!Yt.isNativePlatform())return{available:!1,biometryType:"none",hasCredentials:!1};try{const e=await $m.isAvailable();let t="none";switch(e.biometryType){case au.FINGERPRINT:case au.TOUCH_ID:t="fingerprint";break;case au.FACE_ID:case au.FACE_AUTHENTICATION:t="face";break;case au.IRIS_AUTHENTICATION:t="iris";break;case au.MULTIPLE:t="multiple";break;default:t="none"}const n=e.isAvailable?Vae():!1;return{available:e.isAvailable,biometryType:t,hasCredentials:n}}catch(e){return console.error("Biometric availability check failed:",e),{available:!1,biometryType:"none",hasCredentials:!1}}}async function Ow(e,t){if(!Yt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{try{await $m.deleteCredentials({server:N2})}catch{}return await $m.setCredentials({username:e,password:t,server:N2}),Pw(!0),{success:!0}}catch(n){return Pw(!1),console.error("Failed to store biometric credentials:",n),{success:!1,error:(n==null?void 0:n.message)||"Failed to store credentials"}}}function qL(e){const t=String((e==null?void 0:e.message)||e||"").toLowerCase(),n=String((e==null?void 0:e.code)||"").toLowerCase();return n.includes("cancel")||t.includes("cancel")||n.includes("user_cancel")||t.includes("user cancel")?{success:!1,error:"cancelled"}:n.includes("lock")||t.includes("lock")||n.includes("too many")||t.includes("too many")?{success:!1,error:"lockout"}:n.includes("fail")||t.includes("fail")||n.includes("not recognized")||t.includes("not recognized")?{success:!1,error:"authentication_failed"}:n.includes("not_available")||t.includes("not available")||n.includes("no biometric")?{success:!1,error:"not_available"}:{success:!1,error:"authentication_failed"}}async function KL(){if(!Yt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{await $m.verifyIdentity({reason:"Continue in Synka",title:"Access Synka",subtitle:"Use biometrics to continue",description:"Confirm your identity to access your account",useFallback:!0});const e=await $m.getCredentials({server:N2});return e!=null&&e.username&&(e!=null&&e.password)?{success:!0,email:e.username,userId:e.password}:(Pw(!1),{success:!1,error:"no_credentials"})}catch(e){console.error("Biometric authentication failed:",e);const t=qL(e);return(t.error==="authentication_failed"||t.error==="not_available")&&Pw(!1),{success:!1,error:t.error}}}async function Uae(){if(!Yt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{return await $m.verifyIdentity({reason:"Verify your identity",title:"Biometric Verification",subtitle:"Use biometrics to verify",description:"Confirm your identity",useFallback:!0}),{success:!0}}catch(e){return console.error("Biometric verification failed:",e),qL(e)}}function Lw(e){switch(e){case"fingerprint":return"Fingerprint";case"face":return"Face ID";case"iris":return"Iris";case"multiple":return"Biometric";default:return"Biometric"}}function YL({open:e,onOpenChange:t,onEnable:n,onSkip:r,biometricInfo:a}){const s=(a==null?void 0:a.biometryType)==="face",i=a?Lw(a.biometryType):"Biometric";return o.jsx(_m,{open:e,onOpenChange:t,children:o.jsxs(md,{className:"max-w-sm mx-4",children:[o.jsxs(fd,{className:"items-center text-center",children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-2",children:s?o.jsx(D3,{className:"w-8 h-8 text-primary"}):o.jsx(dw,{className:"w-8 h-8 text-primary"})}),o.jsx(xd,{className:"text-xl",children:"Enable biometric login?"}),o.jsxs(yd,{className:"text-center",children:["Log in faster using ",i.toLowerCase()==="biometric"?"fingerprint or Face ID":i,"."]})]}),o.jsxs(gd,{className:"flex-col gap-2 sm:flex-col",children:[o.jsx(bd,{onClick:n,className:"w-full py-5 text-base rounded-full",children:"Enable"}),o.jsx(vd,{onClick:r,className:"w-full py-5 text-base rounded-full border-0 bg-transparent hover:bg-muted",children:"Not now"})]})]})})}function Gn({className:e,...t}){return o.jsx("div",{className:Ie("animate-pulse rounded-md bg-muted",e),...t})}function Hae({variant:e="dashboard",className:t}){return e==="card"?o.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-6 animate-fade-in",t),children:[o.jsx(Gn,{className:"w-full aspect-[3/2] rounded-2xl"}),o.jsxs("div",{className:"space-y-2 px-2",children:[o.jsx(Gn,{className:"h-7 w-48"}),o.jsx(Gn,{className:"h-4 w-32"})]}),o.jsx("div",{className:"space-y-1",children:[1,2,3,4].map(n=>o.jsxs("div",{className:"flex items-center gap-4 px-4 py-3",children:[o.jsx(Gn,{className:"w-10 h-10 rounded-full"}),o.jsx(Gn,{className:"h-4 flex-1"})]},n))}),o.jsx(Gn,{className:"h-12 w-full rounded-xl"})]}):e==="crm"?o.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-4 animate-fade-in",t),children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(Gn,{className:"h-8 w-24"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Gn,{className:"h-10 w-10 rounded-full"}),o.jsx(Gn,{className:"h-10 w-10 rounded-full"})]})]}),o.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[1,2,3,4].map(n=>o.jsx(Gn,{className:"h-8 w-20 rounded-full shrink-0"},n))}),o.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(n=>o.jsx("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Gn,{className:"w-12 h-12 rounded-full"}),o.jsxs("div",{className:"flex-1 space-y-2",children:[o.jsx(Gn,{className:"h-4 w-32"}),o.jsx(Gn,{className:"h-3 w-24"})]}),o.jsx(Gn,{className:"h-8 w-8 rounded-lg"})]})},n))})]}):e==="settings"?o.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-4 animate-fade-in",t),children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(Gn,{className:"h-8 w-28"}),o.jsx(Gn,{className:"h-4 w-48"})]}),o.jsx("div",{className:"p-6 rounded-2xl bg-card border border-border/50",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(Gn,{className:"w-16 h-16 rounded-2xl"}),o.jsxs("div",{className:"flex-1 space-y-2",children:[o.jsx(Gn,{className:"h-5 w-32"}),o.jsx(Gn,{className:"h-4 w-24"})]})]})}),o.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(n=>o.jsxs("div",{className:"p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4",children:[o.jsx(Gn,{className:"w-10 h-10 rounded-xl"}),o.jsxs("div",{className:"flex-1 space-y-1",children:[o.jsx(Gn,{className:"h-4 w-24"}),o.jsx(Gn,{className:"h-3 w-32"})]})]},n))})]}):o.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-6 animate-fade-in",t),children:[o.jsx("div",{className:"grid grid-cols-2 gap-3",children:[1,2,3,4].map(n=>o.jsxs("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:[o.jsx(Gn,{className:"h-4 w-20 mb-2"}),o.jsx(Gn,{className:"h-8 w-16"})]},n))}),o.jsxs("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:[o.jsx(Gn,{className:"h-4 w-24 mb-4"}),o.jsx(Gn,{className:"h-40 w-full rounded-lg"})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(Gn,{className:"h-5 w-28"}),[1,2,3].map(n=>o.jsxs("div",{className:"p-3 rounded-lg bg-card border border-border/50 flex items-center gap-3",children:[o.jsx(Gn,{className:"w-10 h-10 rounded-lg"}),o.jsxs("div",{className:"flex-1 space-y-1",children:[o.jsx(Gn,{className:"h-4 w-32"}),o.jsx(Gn,{className:"h-3 w-24"})]})]},n))]})]})}const k2=lf("App",{web:()=>Qu(()=>import("./web-DEZdiZQm.js"),__vite__mapDeps([5,1,2,3])).then(e=>new e.AppWeb)}),XL="synka_app_lock_enabled",ZL="synka_biometric_enabled",QL="synka_cached_user_name",JL="synka_cached_user_email",Fx=()=>localStorage.getItem(XL)==="true",Gae=e=>{localStorage.setItem(XL,e?"true":"false"),e||qae()},Px=()=>localStorage.getItem(ZL)==="true",qae=e=>{localStorage.setItem(ZL,"false")},zw=()=>localStorage.getItem(QL),Zp=e=>{e&&localStorage.setItem(QL,e)},cI=()=>localStorage.getItem(JL),Dc=e=>{e&&localStorage.setItem(JL,e)},bk="synka_biometric_enabled",BM="synka_biometric_consent_asked";function Kae(){const e=za(),{user:t,loading:n,loginWithPinOnly:r}=ir(),[a,s]=k.useState(null),[i,l]=k.useState(!1),[u,d]=k.useState(!1),[c,h]=k.useState(!1),[p,m]=k.useState(null),f=k.useRef(!1),g=()=>localStorage.getItem(bk)==="true",x=()=>localStorage.getItem(BM)==="true",y=()=>{localStorage.setItem(BM,"true")},b=()=>{localStorage.setItem(bk,"true")},v=()=>{localStorage.setItem(bk,"false")};k.useEffect(()=>{Yt.isNativePlatform()&&am().then(s)},[]),k.useEffect(()=>{if(!Yt.isNativePlatform()||n||t||f.current||c)return;if(!Fx()){h(!0);return}(async()=>{f.current=!0,h(!0);const T=await am();s(T),T.available&&T.hasCredentials&&g()&&await w()})()},[n,t,c]);const w=k.useCallback(async()=>{if(Yt.isNativePlatform()){l(!0);try{const _=await KL();if(!_.success){if(l(!1),_.error==="cancelled")return;oe({title:"Biometric failed",description:"Please log in with your PIN.",variant:"destructive"});return}const{error:T}=await r(_.email,_.userId);if(T){l(!1),oe({title:"Login failed",description:"Please log in with your PIN.",variant:"destructive"}),e("/login");return}l(!1),oe({title:"Welcome back!",description:"Logged in with biometrics."}),e("/my-card")}catch(_){l(!1),console.error("Biometric auto-login error:",_)}}},[r,e]),N=k.useCallback(async(_,T)=>{if(!Yt.isNativePlatform())return;const E=await am();s(E),E.available&&!x()?(m({email:_,userId:T}),d(!0)):E.available&&g()&&await Ow(_,T)},[]),S=k.useCallback(async()=>{if(!p)return;y(),b();const{success:_}=await Ow(p.email,p.userId);_&&oe({title:"Biometric enabled!",description:"You can now log in faster next time."}),d(!1),m(null)},[p]),C=k.useCallback(()=>{y(),v(),d(!1),m(null)},[]);return{biometricInfo:a,isBiometricLoading:i,showConsentDialog:u,setShowConsentDialog:d,triggerBiometricLogin:w,handleLoginSuccess:N,handleConsentEnable:S,handleConsentSkip:C,isBiometricEnabled:g(),isNative:Yt.isNativePlatform()}}const Yae=e=>e.includes("/my-card")||e.includes("/card")?"card":e.includes("/crm")?"crm":e.includes("/settings")?"settings":"dashboard";function Xae(){var V;const e=Rl(),t=za(),{user:n,loading:r}=ir(),{profile:a}=Ko(),s=((V=a==null?void 0:a.plan)==null?void 0:V.toLowerCase())==="orange",i=Yt.isNativePlatform(),{biometricInfo:l,isBiometricLoading:u,showConsentDialog:d,setShowConsentDialog:c,triggerBiometricLogin:h,handleConsentEnable:p,handleConsentSkip:m}=Kae(),{cards:f,activeCard:g,loading:x,createCard:y,deleteCard:b,setDefaultCard:v,selectCard:w,updateCard:N}=uf(),S=k.useCallback(async($,O)=>{await N($,{name:O})},[N]),C=e.pathname==="/login"||e.pathname==="/signup",_=e.pathname==="/"||e.pathname==="/index",T=e.pathname==="/my-card"||e.pathname.startsWith("/card"),E=!r&&!!n,j=k.useCallback(async $=>{$&&(await w($),T||t("/my-card"))},[w,t,T]),I=k.useCallback(()=>{t("/my-card?edit=true")},[t]),D=k.useCallback(async $=>{const O=await y($);return O.data&&(await w(O.data.id),t("/my-card?edit=true")),O},[y,w,t]),P=["/dashboard","/crm","/my-card","/card","/settings"].some($=>e.pathname.startsWith($));return k.useEffect(()=>{!r&&!n&&P&&t("/login")},[r,n,P,t]),C?o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[o.jsx("div",{className:"fixed top-[max(1rem,env(safe-area-inset-top))] right-[max(1rem,env(safe-area-inset-right))] z-50",children:o.jsx(Tx,{})}),o.jsx(zN,{})]}):!E&&_&&i?o.jsxs(o.Fragment,{children:[o.jsx(Fae,{onBiometricLogin:h,biometricInfo:l,isBiometricLoading:u}),o.jsx(YL,{open:d,onOpenChange:c,onEnable:p,onSkip:m,biometricInfo:l})]}):!E&&_?o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[o.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:o.jsxs("div",{className:"px-4 sm:px-6 md:px-10 flex items-center justify-between h-14 md:h-16",children:[o.jsx(us,{size:"md"}),o.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[o.jsx(fe,{variant:"ghost",size:"sm",className:"px-2 sm:px-3 text-sm",onClick:()=>t("/login"),children:"Login"}),o.jsx(fe,{variant:"gradient",size:"sm",className:"px-3 sm:px-4 text-sm",onClick:()=>t("/signup"),children:"Sign up"}),o.jsx("div",{className:"ml-1 sm:ml-3",children:o.jsx(Tx,{})})]})]})}),o.jsx("main",{className:"pt-[calc(3.5rem+env(safe-area-inset-top))] md:pt-[calc(4rem+env(safe-area-inset-top))] w-full",children:o.jsx(zN,{})})]}):o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[o.jsx(DQ,{}),o.jsx("header",{className:"md:hidden fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:o.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 h-14",children:[o.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[o.jsx(us,{size:"sm"}),T&&!x&&g&&Array.isArray(f)&&o.jsx("div",{className:"ml-2 sm:ml-3 min-w-0 flex-1",children:o.jsx(OO,{cards:f,activeCard:g,onSelect:j,onSetDefault:v,onAdd:D,onDelete:b,onEditCard:I,onUpdateCardName:S,variant:"mobile",isOrangePlan:s})})]}),o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s&&o.jsx(nt,{className:"bg-orange-plan text-white font-semibold text-xs px-2 py-0.5 shadow-sm",children:"ORANGE"}),o.jsx(Tx,{})]})]})}),o.jsx("main",{className:"pt-14 md:pt-16 pb-[calc(5rem+env(safe-area-inset-bottom))] md:pb-8 w-full",children:o.jsx(k.Suspense,{fallback:o.jsx(Hae,{variant:Yae(e.pathname)}),children:o.jsx("div",{className:"animate-fade-in",children:o.jsx(zN,{})})})}),o.jsx(QZ,{})]})}const ez="https://synka.in";function Zae(){return ez}function tz(e){return`${ez}/u/${e}`}function Qae(){const e=za(),t=Rl(),n=k.useCallback(a=>{try{if(a.startsWith("synka://")){const d=a.replace("synka://","/");return d.startsWith("/")?d:`/${d}`}const s=new URL(a),i=s.hostname.toLowerCase();return["synka.in","www.synka.in","lovableproject.com","f179cf0b-9d7d-4683-9a9f-315f6ad3e5bb.lovableproject.com"].some(d=>i===d||i.endsWith(`.${d}`))?s.pathname+s.search:(console.log("[DeepLink] Invalid domain:",i),null)}catch(s){return console.error("[DeepLink] Failed to parse URL:",a,s),null}},[]),r=k.useCallback(a=>{console.log("[DeepLink] Received:",a);const s=n(a);if(!s)return;if(t.pathname+t.search===s){console.log("[DeepLink] Already on this URL");return}console.log("[DeepLink] Navigating to:",s),setTimeout(()=>{e(s,{replace:!0})},0)},[e,t.pathname,t.search,n]);k.useEffect(()=>{if(!Yt.isNativePlatform())return;console.log("[DeepLink] Setting up native deep link listeners");const s=(async()=>{try{const i=await k2.getLaunchUrl();i!=null&&i.url&&(console.log("[DeepLink] App launched with URL:",i.url),r(i.url));const l=await k2.addListener("appUrlOpen",u=>{console.log("[DeepLink] App URL opened:",u.url),r(u.url)});return()=>l.remove()}catch(i){console.error("[DeepLink] Failed to set up listeners:",i)}})();return()=>{s.then(i=>i==null?void 0:i())}},[r])}function Jae({children:e}){return Qae(),o.jsx(o.Fragment,{children:e})}function ese({path:e}){const[t,n]=k.useState(!1),[r,a]=k.useState(!1),[s,i]=k.useState(!1);if(k.useEffect(()=>{if(Yt.isNativePlatform()||window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0)return;const u=navigator.userAgent,d=/iPad|iPhone|iPod/.test(u)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,c=/Safari/.test(u)&&!/Chrome|CriOS|FxiOS|EdgiOS/.test(u);if(d&&c){a(!0);const h=localStorage.getItem("synka_pwa_installed")==="true";i(h)}},[]),!r||t)return null;const l=()=>{e&&localStorage.setItem("synka_deep_link_path",e),n(!0)};return o.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4 pb-[env(safe-area-inset-bottom)] bg-gradient-to-t from-background via-background to-transparent",children:o.jsxs("div",{className:"max-w-md mx-auto bg-card border border-border rounded-2xl shadow-2xl p-4 animate-in slide-in-from-bottom-4",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:o.jsx("img",{src:"/logos/synka-logo.png",alt:"Synka",className:"w-8 h-8 rounded-lg"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"font-semibold text-foreground text-sm",children:s?"Open in Synka App":"Install Synka App"}),o.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:s?"For the best experience, open this card from your home screen app.":"Add Synka to your home screen for instant access."}),!s&&o.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Tap ",o.jsx("span",{className:"inline-flex items-center",children:o.jsx(C3,{className:"w-3 h-3 mx-0.5"})}),' then "Add to Home Screen"']})]}),o.jsx("button",{onClick:()=>n(!0),className:"w-8 h-8 rounded-full hover:bg-muted flex items-center justify-center shrink-0",children:o.jsx(Mo,{className:"w-4 h-4 text-muted-foreground"})})]}),s&&o.jsx(fe,{variant:"gradient",size:"sm",className:"w-full mt-3",onClick:l,children:"Got it, I'll open from home screen"})]})})}function tse(){k.useEffect(()=>{if(!(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0))return;localStorage.setItem("synka_pwa_installed","true");const t=localStorage.getItem("synka_deep_link_path");t&&(localStorage.removeItem("synka_deep_link_path"),window.location.pathname!==t&&(window.location.href=t))},[])}const nse=3e4;function rse(){const[e,t]=k.useState(!1),[n,r]=k.useState(null),[a,s]=k.useState(!1),i=k.useRef(null),l=k.useRef(!1);k.useEffect(()=>{Yt.isNativePlatform()&&(am().then(r),s(Px()))},[]),k.useEffect(()=>{Yt.isNativePlatform()&&(l.current||(l.current=!0,Fx()&&t(!0)))},[]),k.useEffect(()=>{if(!Yt.isNativePlatform())return;const h=m=>{if(!Fx()){t(!1);return}if(!m.isActive){i.current=Date.now();return}if(i.current){const f=Date.now()-i.current;i.current=null,f>=nse&&(t(!0),s(Px()))}},p=k2.addListener("appStateChange",h);return()=>{p.then(m=>m.remove())}},[]);const u=k.useCallback(async()=>(t(!1),i.current=null,!0),[]),d=k.useCallback(()=>{t(!1),i.current=null},[]),c=k.useCallback(()=>{Fx()&&t(!0)},[]);return{isLocked:e,isAuthenticating:!1,biometricInfo:n,biometricEnabled:a,unlock:u,unlockWithPin:d,lockNow:c}}function ase(){const{user:e}=ir(),t=cI(),n=zw(),r=!!t||!!n;return e?o.jsx(Ov,{to:"/my-card",replace:!0}):r?o.jsx(Ov,{to:"/login",replace:!0}):o.jsx(Ov,{to:"/index",replace:!0})}const WM=[{icon:Js,title:"One-tap card exchange",description:"Instant sharing via NFC or QR. No apps needed.",color:"from-blue-500 to-cyan-500"},{icon:o_,title:"Every share becomes a lead",description:"Contacts captured automatically, even if they dont save.",color:"from-purple-500 to-pink-500"},{icon:Sm,title:"Follow-ups made effortless",description:"WhatsApp & email follow-ups in one tap.",color:"from-green-500 to-emerald-500"},{icon:Cl,title:"Built for teams & founders",description:"Track employee cards, leads & activity centrally.",color:"from-indigo-500 to-violet-500"},{icon:s_,title:"See what works",description:"Real-time views & engagement analytics.",color:"from-rose-500 to-red-500"},{icon:L3,title:"AI-powered design",description:"Cards & messages designed for your personality.",color:"from-yellow-500 to-orange-500"},{icon:af,title:"Secure by design",description:"Enterprise-grade security & encryption.",color:"from-teal-500 to-cyan-500"}];function sse(){const e=k.useRef(null),t=k.useRef(!1),n=k.useRef(0),r=k.useRef(0),a=k.useRef(0),s=k.useRef(0),i=k.useRef(),l=1.25,u=.95,d=()=>{if(!e.current||t.current){i.current=requestAnimationFrame(d);return}e.current.scrollLeft+=l,e.current.scrollLeft>=e.current.scrollWidth/2&&(e.current.scrollLeft=0),i.current=requestAnimationFrame(d)},c=()=>{e.current&&(a.current*=u,e.current.scrollLeft+=a.current,Math.abs(a.current)>.1&&requestAnimationFrame(c))};k.useEffect(()=>(i.current=requestAnimationFrame(d),()=>i.current&&cancelAnimationFrame(i.current)),[]);const h=f=>{t.current=!0,e.current.setPointerCapture(f.pointerId),n.current=f.clientX,s.current=f.clientX,r.current=e.current.scrollLeft,a.current=0},p=f=>{if(!t.current||!e.current)return;const g=f.clientX,x=n.current-g;e.current.scrollLeft=r.current+x,a.current=s.current-g,s.current=g},m=f=>{t.current=!1,e.current.releasePointerCapture(f.pointerId),c()};return o.jsx("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-b from-muted/30 to-background overflow-hidden w-full",children:o.jsxs("div",{className:"container px-4 sm:px-6",children:[o.jsxs("div",{className:"text-center mb-12",children:[o.jsxs("h2",{className:"text-3xl md:text-4xl font-semibold",children:["Everything you need to"," ",o.jsx("span",{className:"gradient-text",children:"network smarter"})]}),o.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto mt-4",children:"From sharing to follow-up, Synka handles the entire workflow automatically."})]}),o.jsxs("div",{className:"relative select-none",children:[o.jsx("div",{className:"hidden sm:block absolute left-0 top-0 bottom-0 w-32 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"}),o.jsx("div",{className:"hidden sm:block absolute right-0 top-0 bottom-0 w-32 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),o.jsx("div",{ref:e,className:"flex gap-6 overflow-hidden py-4 cursor-grab active:cursor-grabbing",onPointerDown:h,onPointerMove:p,onPointerUp:m,onPointerLeave:m,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"pan-y"},children:[...WM,...WM].map((f,g)=>o.jsxs("div",{className:"flex-shrink-0 w-64 p-6 rounded-2xl bg-card border border-border/50 shadow-premium card-hover",children:[o.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${f.color} flex items-center justify-center mb-4`,children:o.jsx(f.icon,{className:"h-6 w-6 text-white"})}),o.jsx("h3",{className:"font-semibold mb-1",children:f.title}),o.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]},g))})]})]})})}const ise=[{icon:Js,title:"Automatic lead capture",description:"When someone shares their details, Synka saves them directly to your CRM."},{icon:o_,title:"Scan or add contacts",description:"Scan physical cards or add contacts manually. Data is structured instantly."},{icon:Sm,title:"One-click follow-ups",description:"Send WhatsApp or email with prefilled names, company, and signature."},{icon:Ru,title:"Events & auto tagging",description:"Schedule events and group leads captured during that time automatically."},{icon:Cl,title:"Built-in CRM",description:"Contacts, notes, tags, and timelines  all in one place."},{icon:s_,title:"Analytics & reports",description:"Track views, saves, connections, and engagement over time."}];function ose(){return o.jsx("section",{className:"py-16 sm:py-24 px-4 w-full overflow-hidden",children:o.jsxs("div",{className:"container px-4 sm:px-6",children:[o.jsxs("div",{className:"text-center mb-14",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-semibold",children:"What happens after you share your card"}),o.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto mt-3",children:"Synka quietly handles everything in the background so you never miss an opportunity."})]}),o.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:ise.map(e=>o.jsxs("div",{className:"p-6 rounded-2xl bg-card border",children:[o.jsx(e.icon,{className:"h-6 w-6 text-primary mb-3"}),o.jsx("h3",{className:"font-semibold mb-1",children:e.title}),o.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]},e.title))}),o.jsx("p",{className:"text-xs text-muted-foreground text-center mt-10",children:"Secure by design. All data is encrypted and visible only to authorized users."})]})})}const lse=[{icon:IY,title:"Startup Founders",avatar:"SF",points:["Make memorable first impressions at events","Track every potential investor contact","AI-powered follow-up templates"]},{icon:O3,title:"Sales Professionals",avatar:"SP",points:["Never lose a lead with smart CRM","Instant contact sharing via NFC","Analytics on card engagement"]},{icon:_S,title:"Consultants & Coaches",avatar:"CC",points:["Professional brand presence","Easy client management","Custom email signatures"]},{icon:em,title:"Creators & Freelancers",avatar:"CF",points:["Showcase your portfolio links","Stand out with premium designs","Track who viewed your card"]}];function use(){return o.jsx("section",{className:"py-16 sm:py-20 px-4 gradient-subtle w-full overflow-hidden",children:o.jsxs("div",{className:"container px-4 sm:px-6",children:[o.jsxs("div",{className:"text-center mb-16",children:[o.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-foreground mb-4",children:["Built for ",o.jsx("span",{className:"gradient-text",children:"professionals"})]}),o.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Whether you're closing deals or building connections, Synka adapts to your workflow."})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:lse.map((e,t)=>o.jsx(cse,{...e,index:t},e.title))})]})})}function cse({icon:e,title:t,avatar:n,points:r,index:a}){return o.jsxs("div",{className:Ie("group p-6 rounded-2xl bg-card border border-border/50 card-hover opacity-0 animate-fade-up"),style:{animationDelay:`${a*150}ms`,animationFillMode:"forwards"},children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl gradient-bg flex items-center justify-center shadow-glow",children:o.jsx("span",{className:"text-lg font-bold text-primary-foreground",children:n})}),o.jsxs("div",{children:[o.jsx(e,{className:"h-4 w-4 text-primary mb-1"}),o.jsx("h3",{className:"font-semibold text-foreground",children:t})]})]}),o.jsx("ul",{className:"space-y-3",children:r.map((s,i)=>o.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0"}),s]},i))})]})}const gn=n_,dse=e_,nz=k.forwardRef(({className:e,...t},n)=>o.jsx(R0,{ref:n,className:Ie("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));nz.displayName=R0.displayName;const cn=k.forwardRef(({className:e,children:t,hideCloseButton:n=!1,...r},a)=>o.jsxs(dse,{children:[o.jsx(nz,{}),o.jsxs(D0,{ref:a,className:Ie("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,!n&&o.jsxs(t_,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[o.jsx(Mo,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));cn.displayName=D0.displayName;const dn=({className:e,...t})=>o.jsx("div",{className:Ie("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});dn.displayName="DialogHeader";const Fm=({className:e,...t})=>o.jsx("div",{className:Ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Fm.displayName="DialogFooter";const hn=k.forwardRef(({className:e,...t},n)=>o.jsx(M0,{ref:n,className:Ie("text-lg font-semibold leading-none tracking-tight",e),...t}));hn.displayName=M0.displayName;const sy=k.forwardRef(({className:e,...t},n)=>o.jsx($0,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));sy.displayName=$0.displayName;var hse=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],pse=hse.reduce((e,t)=>{const n=g_(`Primitive.${t}`),r=k.forwardRef((a,s)=>{const{asChild:i,...l}=a,u=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(u,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),mse="Label",rz=k.forwardRef((e,t)=>o.jsx(pse.label,{...e,ref:t,onMouseDown:n=>{var a;n.target.closest("button, input, select, textarea")||((a=e.onMouseDown)==null||a.call(e,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));rz.displayName=mse;var az=rz;const fse=L0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),We=k.forwardRef(({className:e,...t},n)=>o.jsx(az,{ref:n,className:Ie(fse(),e),...t}));We.displayName=az.displayName;var gse=Object.defineProperty,xse=Object.defineProperties,yse=Object.getOwnPropertyDescriptors,Bw=Object.getOwnPropertySymbols,sz=Object.prototype.hasOwnProperty,iz=Object.prototype.propertyIsEnumerable,VM=(e,t,n)=>t in e?gse(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bse=(e,t)=>{for(var n in t||(t={}))sz.call(t,n)&&VM(e,n,t[n]);if(Bw)for(var n of Bw(t))iz.call(t,n)&&VM(e,n,t[n]);return e},vse=(e,t)=>xse(e,yse(t)),wse=(e,t)=>{var n={};for(var r in e)sz.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Bw)for(var r of Bw(e))t.indexOf(r)<0&&iz.call(e,r)&&(n[r]=e[r]);return n};function Nse(e){let t=setTimeout(e,0),n=setTimeout(e,10),r=setTimeout(e,50);return[t,n,r]}function kse(e){let t=k.useRef();return k.useEffect(()=>{t.current=e}),t.current}var Sse=18,oz=40,Cse=`${oz}px`,_se=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function Ise({containerRef:e,inputRef:t,pushPasswordManagerStrategy:n,isFocused:r}){let[a,s]=k.useState(!1),[i,l]=k.useState(!1),[u,d]=k.useState(!1),c=k.useMemo(()=>n==="none"?!1:(n==="increase-width"||n==="experimental-no-flickering")&&a&&i,[a,i,n]),h=k.useCallback(()=>{let p=e.current,m=t.current;if(!p||!m||u||n==="none")return;let f=p,g=f.getBoundingClientRect().left+f.offsetWidth,x=f.getBoundingClientRect().top+f.offsetHeight/2,y=g-Sse,b=x;document.querySelectorAll(_se).length===0&&document.elementFromPoint(y,b)===p||(s(!0),d(!0))},[e,t,u,n]);return k.useEffect(()=>{let p=e.current;if(!p||n==="none")return;function m(){let g=window.innerWidth-p.getBoundingClientRect().right;l(g>=oz)}m();let f=setInterval(m,1e3);return()=>{clearInterval(f)}},[e,n]),k.useEffect(()=>{let p=r||document.activeElement===t.current;if(n==="none"||!p)return;let m=setTimeout(h,0),f=setTimeout(h,2e3),g=setTimeout(h,5e3),x=setTimeout(()=>{d(!0)},6e3);return()=>{clearTimeout(m),clearTimeout(f),clearTimeout(g),clearTimeout(x)}},[t,r,n,h]),{hasPWMBadge:a,willPushPWMBadge:c,PWM_BADGE_SPACE_WIDTH:Cse}}var lz=k.createContext({}),uz=k.forwardRef((e,t)=>{var n=e,{value:r,onChange:a,maxLength:s,textAlign:i="left",pattern:l,placeholder:u,inputMode:d="numeric",onComplete:c,pushPasswordManagerStrategy:h="increase-width",pasteTransformer:p,containerClassName:m,noScriptCSSFallback:f=Tse,render:g,children:x}=n,y=wse(n,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),b,v,w,N,S;let[C,_]=k.useState(typeof y.defaultValue=="string"?y.defaultValue:""),T=r??C,E=kse(T),j=k.useCallback(Te=>{a==null||a(Te),_(Te)},[a]),I=k.useMemo(()=>l?typeof l=="string"?new RegExp(l):l:null,[l]),D=k.useRef(null),F=k.useRef(null),P=k.useRef({value:T,onChange:j,isIOS:typeof window<"u"&&((v=(b=window==null?void 0:window.CSS)==null?void 0:b.supports)==null?void 0:v.call(b,"-webkit-touch-callout","none"))}),V=k.useRef({prev:[(w=D.current)==null?void 0:w.selectionStart,(N=D.current)==null?void 0:N.selectionEnd,(S=D.current)==null?void 0:S.selectionDirection]});k.useImperativeHandle(t,()=>D.current,[]),k.useEffect(()=>{let Te=D.current,Oe=F.current;if(!Te||!Oe)return;P.current.value!==Te.value&&P.current.onChange(Te.value),V.current.prev=[Te.selectionStart,Te.selectionEnd,Te.selectionDirection];function He(){if(document.activeElement!==Te){ee(null),G(null);return}let Ke=Te.selectionStart,at=Te.selectionEnd,Y=Te.selectionDirection,ae=Te.maxLength,we=Te.value,Ce=V.current.prev,Ne=-1,he=-1,Ae;if(we.length!==0&&Ke!==null&&at!==null){let $t=Ke===at,qe=Ke===we.length&&we.length<ae;if($t&&!qe){let it=Ke;if(it===0)Ne=0,he=1,Ae="forward";else if(it===ae)Ne=it-1,he=it,Ae="backward";else if(ae>1&&we.length>1){let Ct=0;if(Ce[0]!==null&&Ce[1]!==null){Ae=it<Ce[1]?"backward":"forward";let pt=Ce[0]===Ce[1]&&Ce[0]<ae;Ae==="backward"&&!pt&&(Ct=-1)}Ne=Ct+it,he=Ct+it+1}}Ne!==-1&&he!==-1&&Ne!==he&&D.current.setSelectionRange(Ne,he,Ae)}let gt=Ne!==-1?Ne:Ke,ht=he!==-1?he:at,Dt=Ae??Y;ee(gt),G(ht),V.current.prev=[gt,ht,Dt]}if(document.addEventListener("selectionchange",He,{capture:!0}),He(),document.activeElement===Te&&q(!0),!document.getElementById("input-otp-style")){let Ke=document.createElement("style");if(Ke.id="input-otp-style",document.head.appendChild(Ke),Ke.sheet){let at="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";Gg(Ke.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),Gg(Ke.sheet,`[data-input-otp]:autofill { ${at} }`),Gg(Ke.sheet,`[data-input-otp]:-webkit-autofill { ${at} }`),Gg(Ke.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),Gg(Ke.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Ee=()=>{Oe&&Oe.style.setProperty("--root-height",`${Te.clientHeight}px`)};Ee();let Re=new ResizeObserver(Ee);return Re.observe(Te),()=>{document.removeEventListener("selectionchange",He,{capture:!0}),Re.disconnect()}},[]);let[$,O]=k.useState(!1),[L,q]=k.useState(!1),[U,ee]=k.useState(null),[M,G]=k.useState(null);k.useEffect(()=>{Nse(()=>{var Te,Oe,He,Ee;(Te=D.current)==null||Te.dispatchEvent(new Event("input"));let Re=(Oe=D.current)==null?void 0:Oe.selectionStart,Ke=(He=D.current)==null?void 0:He.selectionEnd,at=(Ee=D.current)==null?void 0:Ee.selectionDirection;Re!==null&&Ke!==null&&(ee(Re),G(Ke),V.current.prev=[Re,Ke,at])})},[T,L]),k.useEffect(()=>{E!==void 0&&T!==E&&E.length<s&&T.length===s&&(c==null||c(T))},[s,c,E,T]);let J=Ise({containerRef:F,inputRef:D,pushPasswordManagerStrategy:h,isFocused:L}),ve=k.useCallback(Te=>{let Oe=Te.currentTarget.value.slice(0,s);if(Oe.length>0&&I&&!I.test(Oe)){Te.preventDefault();return}typeof E=="string"&&Oe.length<E.length&&document.dispatchEvent(new Event("selectionchange")),j(Oe)},[s,j,E,I]),Q=k.useCallback(()=>{var Te;if(D.current){let Oe=Math.min(D.current.value.length,s-1),He=D.current.value.length;(Te=D.current)==null||Te.setSelectionRange(Oe,He),ee(Oe),G(He)}q(!0)},[s]),se=k.useCallback(Te=>{var Oe,He;let Ee=D.current;if(!p&&(!P.current.isIOS||!Te.clipboardData||!Ee))return;let Re=Te.clipboardData.getData("text/plain"),Ke=p?p(Re):Re;Te.preventDefault();let at=(Oe=D.current)==null?void 0:Oe.selectionStart,Y=(He=D.current)==null?void 0:He.selectionEnd,ae=(at!==Y?T.slice(0,at)+Ke+T.slice(Y):T.slice(0,at)+Ke+T.slice(at)).slice(0,s);if(ae.length>0&&I&&!I.test(ae))return;Ee.value=ae,j(ae);let we=Math.min(ae.length,s-1),Ce=ae.length;Ee.setSelectionRange(we,Ce),ee(we),G(Ce)},[s,j,I,T]),_e=k.useMemo(()=>({position:"relative",cursor:y.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[y.disabled]),Le=k.useMemo(()=>({position:"absolute",inset:0,width:J.willPushPWMBadge?`calc(100% + ${J.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:J.willPushPWMBadge?`inset(0 ${J.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:i,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[J.PWM_BADGE_SPACE_WIDTH,J.willPushPWMBadge,i]),Se=k.useMemo(()=>k.createElement("input",vse(bse({autoComplete:y.autoComplete||"one-time-code"},y),{"data-input-otp":!0,"data-input-otp-placeholder-shown":T.length===0||void 0,"data-input-otp-mss":U,"data-input-otp-mse":M,inputMode:d,pattern:I==null?void 0:I.source,"aria-placeholder":u,style:Le,maxLength:s,value:T,ref:D,onPaste:Te=>{var Oe;se(Te),(Oe=y.onPaste)==null||Oe.call(y,Te)},onChange:ve,onMouseOver:Te=>{var Oe;O(!0),(Oe=y.onMouseOver)==null||Oe.call(y,Te)},onMouseLeave:Te=>{var Oe;O(!1),(Oe=y.onMouseLeave)==null||Oe.call(y,Te)},onFocus:Te=>{var Oe;Q(),(Oe=y.onFocus)==null||Oe.call(y,Te)},onBlur:Te=>{var Oe;q(!1),(Oe=y.onBlur)==null||Oe.call(y,Te)}})),[ve,Q,se,d,Le,s,M,U,y,I==null?void 0:I.source,T]),ye=k.useMemo(()=>({slots:Array.from({length:s}).map((Te,Oe)=>{var He;let Ee=L&&U!==null&&M!==null&&(U===M&&Oe===U||Oe>=U&&Oe<M),Re=T[Oe]!==void 0?T[Oe]:null,Ke=T[0]!==void 0?null:(He=u==null?void 0:u[Oe])!=null?He:null;return{char:Re,placeholderChar:Ke,isActive:Ee,hasFakeCaret:Ee&&Re===null}}),isFocused:L,isHovering:!y.disabled&&$}),[L,$,s,M,U,y.disabled,T]),Fe=k.useMemo(()=>g?g(ye):k.createElement(lz.Provider,{value:ye},x),[x,ye,g]);return k.createElement(k.Fragment,null,f!==null&&k.createElement("noscript",null,k.createElement("style",null,f)),k.createElement("div",{ref:F,"data-input-otp-container":!0,style:_e,className:m},Fe,k.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Se)))});uz.displayName="Input";function Gg(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var Tse=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const Xi=k.forwardRef(({className:e,containerClassName:t,...n},r)=>o.jsx(uz,{ref:r,containerClassName:Ie("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:Ie("disabled:cursor-not-allowed",e),...n}));Xi.displayName="InputOTP";const Zi=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{ref:n,className:Ie("flex items-center",e),...t}));Zi.displayName="InputOTPGroup";const Jt=k.forwardRef(({index:e,className:t,...n},r)=>{const a=k.useContext(lz),{char:s,hasFakeCaret:i,isActive:l}=a.slots[e];return o.jsxs("div",{ref:r,className:Ie("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",l&&"z-10 ring-2 ring-ring ring-offset-background",t),...n,children:[s,i&&o.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:o.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});Jt.displayName="InputOTPSlot";const Ese=k.forwardRef(({...e},t)=>o.jsx("div",{ref:t,role:"separator",...e,children:o.jsx(bY,{})}));Ese.displayName="InputOTPSeparator";const vk=[{id:1,image:"/images/card/metal-nfc-business-card-gold.jpeg",name:"Metal Gold"},{id:2,image:"/images/card/metal-nfc-business-card-silver.jpeg",name:"Metal Silver"},{id:3,image:"/images/card/metal-nfc-business-card-black.jpeg",name:"Metal Black"},{id:4,image:"/images/card/metal-nfc-business-card-rose-gold.jpg",name:"Metal Rose Gold"},{id:5,image:"/images/card/metal-nfc-card-gold.jpeg",name:"Metal Gold Premium"},{id:6,image:"/images/card/metal-nfc-card-silver.jpeg",name:"Metal Silver Premium"},{id:7,image:"/images/card/metal-nfc-card-black.jpeg",name:"Metal Black Premium"},{id:8,image:"/images/card/metal-nfc-card-rose-gold.jpeg",name:"Metal Rose Gold Premium"},{id:9,image:"/images/card/pvc-nfc-card-white-gloss.jpeg",name:"PVC White Gloss"},{id:10,image:"/images/card/pvc-nfc-card-black-gloss.jpeg",name:"PVC Black Gloss"},{id:11,image:"/images/card/pvc-nfc-card-black-matt.jpeg",name:"PVC Black Matte"},{id:12,image:"/images/card/metal-nfc-business-cards.jpeg",name:"Collection"}];function jse(){const e=za(),t=k.useRef(null),{sendOtp:n,verifyOtp:r,loginWithPinOnly:a}=ir(),[s,i]=k.useState(!1),[l,u]=k.useState("form"),[d,c]=k.useState(!1),[h,p]=k.useState({name:"",email:"",pin:"",address:"",city:"",state:"",pincode:"",phone:""}),[m,f]=k.useState(!1),[g,x]=k.useState(""),y=k.useRef(!1),b=k.useRef(0),v=k.useRef(0),w=k.useRef(0),N=k.useRef(0),S=k.useRef(),C=k.useRef(0),_=1,T=.94,E=1e3,j=()=>{if(!t.current||y.current){S.current=requestAnimationFrame(j);return}if(Date.now()<C.current){S.current=requestAnimationFrame(j);return}t.current.scrollLeft+=_,t.current.scrollLeft>=t.current.scrollWidth/2&&(t.current.scrollLeft=0),S.current=requestAnimationFrame(j)},I=()=>{C.current=Date.now()+E},D=()=>{t.current&&(w.current*=T,t.current.scrollLeft+=w.current,Math.abs(w.current)>.1&&requestAnimationFrame(D))};k.useEffect(()=>(S.current=requestAnimationFrame(j),()=>{S.current&&cancelAnimationFrame(S.current)}),[]);const F=U=>{y.current=!0,I(),t.current.setPointerCapture(U.pointerId),b.current=U.clientX,N.current=U.clientX,v.current=t.current.scrollLeft,w.current=0},P=U=>{if(!y.current||!t.current)return;const ee=U.clientX,M=b.current-ee;t.current.scrollLeft=v.current+M,w.current=N.current-ee,N.current=ee},V=U=>{y.current=!1,t.current.releasePointerCapture(U.pointerId),I(),D()},$=()=>{u("form"),p({name:"",email:"",pin:"",address:"",city:"",state:"",pincode:"",phone:""}),f(!1),x("")},O=()=>{i(!1),$(),e("/order-nfc-card")},L=async U=>{var ee,M,G;if(U.preventDefault(),!h.name||!h.email||!h.pin||h.pin.length!==4){oe({title:"Missing information",description:"Please fill in name, email, and 4-digit PIN.",variant:"destructive"});return}if(!h.address||!h.city||!h.state||!h.pincode||!h.phone){oe({title:"Missing address",description:"Please fill in complete shipping address.",variant:"destructive"});return}c(!0);try{const J=await le.functions.invoke("pin-auth",{body:{action:"CHECK_PIN_EXISTS",email:h.email}});if((ee=J.data)!=null&&ee.exists)if(f(!1),J.data.has_pin){const ve=await le.functions.invoke("pin-auth",{body:{action:"VERIFY_PIN",email:h.email,pin:h.pin}});(M=ve.data)!=null&&M.success?(await a(h.email,ve.data.user_id),oe({title:"Welcome back!",description:"Select your NFC card type."}),O()):oe({title:"Invalid PIN",description:((G=ve.data)==null?void 0:G.error)||"The PIN you entered is incorrect.",variant:"destructive"})}else{const{error:ve}=await n(h.email);ve?oe({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(u("otp_verify"),oe({title:"Verification needed",description:"We sent a code to your email to verify your account."}))}else{f(!0);const{error:ve}=await n(h.email);ve?oe({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(u("otp_verify"),oe({title:"Verification code sent",description:"Check your email for the verification code."}))}}catch(J){console.error("Error in form submit:",J),oe({title:"Error",description:"Something went wrong. Please try again.",variant:"destructive"})}finally{c(!1)}},q=async()=>{if(g.length===6){c(!0);try{const{error:U}=await r(h.email,g);if(U){oe({title:"Invalid code",description:"The verification code is incorrect or expired.",variant:"destructive"}),c(!1);return}const{data:{session:ee}}=await le.auth.getSession();ee!=null&&ee.user&&(await le.functions.invoke("pin-auth",{body:{action:"SET_PIN",user_id:ee.user.id,pin:h.pin}}),await le.from("profiles").update({full_name:h.name}).eq("user_id",ee.user.id)),oe({title:"Account verified!",description:"Now select your NFC card type."}),O()}catch(U){console.error("OTP verification error:",U),oe({title:"Error",description:"Verification failed. Please try again.",variant:"destructive"})}finally{c(!1)}}};return o.jsxs("section",{className:"py-16 sm:py-24 px-4 w-full overflow-hidden",children:[o.jsxs("div",{className:"container px-4 sm:px-6",children:[o.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-8 sm:mb-12",children:[o.jsx("div",{className:"flex justify-center mb-4 animate-fade-up",children:o.jsxs("div",{className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-medium text-orange-600 border border-orange-500/30 bg-orange-500/10 backdrop-blur-sm",children:[o.jsx("span",{className:"absolute inset-0 rounded-full bg-orange-500/20 blur-md opacity-30"}),o.jsxs("span",{className:"relative flex h-2 w-2",children:[o.jsx("span",{className:"absolute inline-flex h-full w-full rounded-full bg-orange-500 opacity-75 animate-ping"}),o.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-orange-600"})]}),o.jsx(Hs,{className:"h-3.5 w-3.5 relative animate-pulse"}),o.jsx("span",{className:"relative",children:"Introducing AI-Designed Cards"})]})}),o.jsxs("h2",{className:"text-[22px] sm:text-3xl md:text-4xl font-semibold leading-tight sm:leading-snug text-center px-4 max-w-[22rem] sm:max-w-none mx-auto",children:["Get your"," ",o.jsx("span",{className:"gradient-text block sm:inline",children:"AI-designed NFC business card"}),o.jsx("span",{className:"block mt-2 sm:mt-1 font-medium",children:"built to make every introduction unforgettable"})]}),o.jsxs("p",{className:"text-sm sm:text-lg text-muted-foreground leading-relaxed text-center px-6 max-w-md mx-auto mt-4",children:["AI designs a card that reflects who you are.",o.jsx("br",{className:"hidden sm:block"}),"You tap once  and people remember you forever."]})]}),o.jsxs("div",{className:"relative select-none",children:[o.jsx("div",{className:"hidden sm:block absolute left-0 top-0 bottom-0 w-32 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"}),o.jsx("div",{className:"hidden sm:block absolute right-0 top-0 bottom-0 w-32 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),o.jsx("div",{ref:t,className:"flex gap-4 sm:gap-6 overflow-x-hidden py-4 cursor-grab active:cursor-grabbing -mx-4 px-4 sm:mx-0 sm:px-0",onPointerDown:F,onPointerMove:P,onPointerUp:V,onPointerLeave:V,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"pan-y"},children:[...vk,...vk].map((U,ee)=>o.jsxs("div",{className:"flex-shrink-0 w-[200px] sm:w-[240px] md:w-[280px] opacity-0 animate-fade-up",style:{animationDelay:`${ee%vk.length*80}ms`,animationFillMode:"forwards"},children:[o.jsx("div",{className:"aspect-[1.6/1] rounded-2xl overflow-hidden shadow-premium card-hover",children:o.jsx("img",{src:U.image,alt:U.name,className:"w-full h-full object-cover",loading:"lazy"})}),o.jsx("p",{className:"text-center text-sm font-medium text-muted-foreground mt-3",children:U.name})]},`${U.id}-${ee}`))})]}),o.jsx("ul",{className:"mt-10 space-y-2 text-muted-foreground text-sm sm:text-base max-w-xl mx-auto",children:["Premium metal & PVC cards that stand out instantly","One-tap sharing via NFC & QR  no app needed","AI-designed to match your role, brand & personality","Update anytime  no reprints, no extra cost"].map((U,ee)=>o.jsx("li",{className:"flex justify-center",children:o.jsxs("span",{className:"text-left flex gap-2",children:[o.jsx("span",{children:""}),o.jsx("span",{children:U})]})},ee))}),o.jsx("div",{className:"flex justify-center mt-8",children:o.jsxs(fe,{size:"lg",onClick:()=>i(!0),children:["Get your NFC Card",o.jsx(fi,{className:"h-4 w-4 ml-2"})]})}),o.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground text-center mt-4 animate-fade-up",children:["Includes complimentary replacement.",o.jsx("br",{}),"Lifetime NFC card included with ",o.jsx("span",{className:"font-medium",children:"Orange (Pro) plan"}),"."]})]}),o.jsx(gn,{open:s,onOpenChange:U=>{U||$(),i(U)},children:o.jsxs(cn,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[o.jsxs(dn,{children:[o.jsxs(hn,{children:[l==="form"&&"Get Your NFC Card",l==="otp_verify"&&"Verify Your Email"]}),o.jsxs(sy,{children:[l==="form"&&"Fill in your details to order your premium NFC business card.",l==="otp_verify"&&"Enter the 6-digit code sent to your email."]})]}),l==="form"&&o.jsxs("form",{onSubmit:L,className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"name",children:"Full Name"}),o.jsx(Ge,{id:"name",placeholder:"John Doe",value:h.name,onChange:U=>p({...h,name:U.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"email",children:"Email"}),o.jsx(Ge,{id:"email",type:"email",placeholder:"john@example.com",value:h.email,onChange:U=>p({...h,email:U.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"pin",children:"4-Digit PIN"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"This PIN will be used for quick login"}),o.jsx(Xi,{maxLength:4,value:h.pin,onChange:U=>p({...h,pin:U}),children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"phone",children:"Phone Number"}),o.jsx(Ge,{id:"phone",type:"tel",placeholder:"+91 98765 43210",value:h.phone,onChange:U=>p({...h,phone:U.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"address",children:"Address"}),o.jsx(Ge,{id:"address",placeholder:"House/Flat No., Street, Locality",value:h.address,onChange:U=>p({...h,address:U.target.value}),required:!0})]}),o.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"city",children:"City"}),o.jsx(Ge,{id:"city",value:h.city,onChange:U=>p({...h,city:U.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"state",children:"State"}),o.jsx(Ge,{id:"state",value:h.state,onChange:U=>p({...h,state:U.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"pincode",children:"Pincode"}),o.jsx(Ge,{id:"pincode",value:h.pincode,onChange:U=>p({...h,pincode:U.target.value}),required:!0})]})]}),o.jsx(fe,{type:"submit",className:"w-full",disabled:d,children:d?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):o.jsxs(o.Fragment,{children:["Continue",o.jsx(fi,{className:"h-4 w-4 ml-2"})]})})]}),l==="otp_verify"&&o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"text-center",children:[o.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Enter the 6-digit code sent to ",o.jsx("strong",{children:h.email})]}),o.jsx(Xi,{maxLength:6,value:g,onChange:x,className:"justify-center",children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3}),o.jsx(Jt,{index:4}),o.jsx(Jt,{index:5})]})})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(fe,{variant:"outline",onClick:()=>u("form"),className:"flex-1",children:[o.jsx(td,{className:"h-4 w-4 mr-2"}),"Back"]}),o.jsx(fe,{onClick:q,disabled:g.length!==6||d,className:"flex-1",children:d?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Verify"})]})]})]})})]})}function Ase(){return o.jsx("footer",{className:"py-8 sm:py-12 px-4 border-t border-border/50 w-full overflow-hidden",children:o.jsx("div",{className:"container px-4 sm:px-6",children:o.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 sm:gap-6",children:[o.jsx(us,{size:"md"}),o.jsxs("nav",{className:"flex flex-wrap justify-center gap-6 text-sm text-muted-foreground",children:[o.jsx(Va,{to:"/support",className:"hover:text-foreground transition-colors",children:"Support"}),o.jsx(Va,{to:"/terms",className:"hover:text-foreground transition-colors",children:"Terms"}),o.jsx(Va,{to:"/privacy",className:"hover:text-foreground transition-colors",children:"Privacy"}),o.jsx(Va,{to:"/contact",className:"hover:text-foreground transition-colors",children:"Contact"})]}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",new Date().getFullYear()," Synka. All rights reserved."]})]})})})}function Rse(){return o.jsx("section",{className:"py-16 sm:py-28 px-4 bg-muted/30 w-full overflow-hidden",children:o.jsxs("div",{className:"container max-w-6xl px-4 sm:px-6",children:[o.jsxs("div",{className:"text-center mb-16",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-semibold",children:"Built to scale with your team"}),o.jsx("p",{className:"text-muted-foreground mt-3",children:"From solo professionals to startups and enterprises."})]}),o.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-16",children:[o.jsx(wk,{title:"Team",text:"Managers get visibility into contacts and activity across members."}),o.jsx(wk,{title:"Startup",text:"Shared events, workflows, and a unified CRM for growth."}),o.jsx(wk,{title:"Enterprise",text:"Custom solutions, permissions, and workflows tailored to you."})]}),o.jsxs("div",{className:"text-center max-w-2xl mx-auto",children:[o.jsx("h3",{className:"text-2xl font-semibold mb-3",children:"Lets build the right solution together"}),o.jsx("p",{className:"text-muted-foreground mb-6",children:"We design custom workflows and enterprise-grade solutions so your team can focus on products and customers  while we handle the rest."}),o.jsx("button",{className:"px-8 py-4 rounded-xl bg-primary text-primary-foreground",children:"Contact us for custom solutions"}),o.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Secure  Encrypted  Enterprise-ready"})]})]})})}function wk({title:e,text:t}){return o.jsxs("div",{className:"p-6 rounded-2xl bg-card border",children:[o.jsx("h4",{className:"font-semibold mb-2",children:e}),o.jsx("p",{className:"text-sm text-muted-foreground",children:t})]})}const UM=new Set,Dse=e=>UM.has(e)?Promise.resolve():new Promise(t=>{const n=new Image;n.onload=()=>{UM.add(e),t()},n.onerror=()=>t(),n.src=e}),Mse=e=>Promise.all(e.map(Dse)),$se=e=>{k.useEffect(()=>{const t=setTimeout(()=>{Mse(e)},100);return()=>clearTimeout(t)},[e])},Fse=["/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg","/images/ai/cofounder-primary.webp"],Pse=["1-tap digital business card exchange (NFC + QR)","Automatic lead capture","Smart follow-ups & reminders","Real-time analytics"],Ose=["Built-in CRM for contacts & notes","Team & employee card tracking","Founder & manager dashboards","AI-designed digital cards & templates"];function Lse(){const e=za(),[t,n]=k.useState(0);$se(Fse),k.useEffect(()=>{const a=setInterval(()=>{n(s=>s===0?1:0)},3500);return()=>clearInterval(a)},[]);const r=t===0?Pse:Ose;return o.jsxs("div",{className:"min-h-dvh w-full overflow-x-hidden bg-background",children:[o.jsx("section",{className:"relative bg-gradient-to-b from-primary/5 via-background to-background",children:o.jsx("div",{className:"max-w-7xl mx-auto py-10 md:py-16 px-3 sm:px-6",children:o.jsxs("div",{className:"grid lg:grid-cols-2 gap-10 items-center",children:[o.jsxs("div",{className:"space-y-6 text-center lg:text-left",children:[o.jsx("div",{className:"inline-flex items-center px-4 py-1.5 rounded-full bg-primary/10 text-primary text-sm font-medium",children:"SYNKA  Simply Connected"}),o.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-bold leading-tight",children:["Indias most powerful"," ",o.jsx("span",{className:"gradient-text",children:"digital business card"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"text-lg sm:text-xl font-medium text-foreground",children:"Smart NFC & QR business cards that share instantly and capture leads."}),o.jsx("p",{className:"text-base sm:text-lg text-muted-foreground",children:"AI-designed cards with built-in CRM and real-time analytics  all in one platform."})]}),o.jsx("div",{className:"relative h-28 max-w-xl mx-auto lg:mx-0",children:o.jsx("div",{className:"absolute inset-0 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 animate-fade",children:r.map(a=>o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-primary mt-1 flex-shrink-0"}),o.jsx("span",{className:"text-sm sm:text-base text-muted-foreground",children:a})]},a))},t)}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4 justify-center lg:justify-start",children:[o.jsxs(fe,{size:"lg",onClick:()=>e("/signup"),className:"group bg-primary text-primary-foreground px-8 py-6 rounded-full shadow-lg",children:["Create your free card",o.jsx(fi,{className:"h-5 w-5 ml-2 group-hover:translate-x-1 transition-transform"})]}),o.jsx(fe,{variant:"outline",size:"lg",onClick:()=>e("/contact"),className:"px-8 py-6 rounded-full",children:"Talk to us"})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Free forever digital business card  Lifetime free NFC visiting card on Orange (Pro) plan"})]}),o.jsx("div",{className:"relative flex justify-center lg:justify-end",children:o.jsx("div",{className:"relative w-full max-w-sm md:max-w-md",children:o.jsx("img",{src:"/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg",alt:"Synka NFC digital business card",className:"w-full rounded-3xl shadow-2xl"})})})]})})}),o.jsx(sse,{}),o.jsx(ose,{}),o.jsx(use,{}),o.jsx(Rse,{}),o.jsx("section",{className:"py-16 bg-muted/30 text-center",children:o.jsxs("div",{className:"container max-w-4xl space-y-6",children:[o.jsx("img",{src:"/images/ai/cofounder-primary.webp",alt:"AI designed digital business card",className:"mx-auto w-36 h-36 rounded-full shadow-lg"}),o.jsx("h2",{className:"text-3xl font-bold",children:"Designed by AI. Powered by intelligence."}),o.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Indias first AI-designed digital business card  tailored to your business, role, and personality."})]})}),o.jsx(jse,{}),o.jsx("section",{className:"py-20",children:o.jsx("div",{className:"container",children:o.jsxs("div",{className:"gradient-bg rounded-3xl p-12 text-center",children:[o.jsx("h2",{className:"text-4xl font-bold text-primary-foreground",children:"Create your digital business card in minutes"}),o.jsx("p",{className:"text-primary-foreground/80 mt-3",children:"Replace paper visiting cards forever with NFC-powered networking."}),o.jsx(fe,{size:"lg",onClick:()=>e("/signup"),className:"mt-6 bg-background text-foreground px-10 py-6 rounded-full",children:"Get started for free"})]})})}),o.jsx(Ase,{}),o.jsx(UL,{}),o.jsx("style",{children:`
        .animate-fade {
          animation: fadeUp 0.6s ease both;
        }
        @keyframes fadeUp {
          from {
            opacity: 0;
            transform: translateY(6px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}function K0(e){const t=k.useRef({value:e,previous:e});return k.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Y0="Checkbox",[zse]=qo(Y0),[Bse,dI]=zse(Y0);function Wse(e){const{__scopeCheckbox:t,checked:n,children:r,defaultChecked:a,disabled:s,form:i,name:l,onCheckedChange:u,required:d,value:c="on",internal_do_not_use_render:h}=e,[p,m]=Sl({prop:n,defaultProp:a??!1,onChange:u,caller:Y0}),[f,g]=k.useState(null),[x,y]=k.useState(null),b=k.useRef(!1),v=f?!!i||!!f.closest("form"):!0,w={checked:p,disabled:s,setChecked:m,control:f,setControl:g,name:l,form:i,value:c,hasConsumerStoppedPropagationRef:b,required:d,defaultChecked:Iu(a)?!1:a,isFormControl:v,bubbleInput:x,setBubbleInput:y};return o.jsx(Bse,{scope:t,...w,children:Vse(h)?h(w):r})}var cz="CheckboxTrigger",dz=k.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...r},a)=>{const{control:s,value:i,disabled:l,checked:u,required:d,setControl:c,setChecked:h,hasConsumerStoppedPropagationRef:p,isFormControl:m,bubbleInput:f}=dI(cz,e),g=sr(a,c),x=k.useRef(u);return k.useEffect(()=>{const y=s==null?void 0:s.form;if(y){const b=()=>h(x.current);return y.addEventListener("reset",b),()=>y.removeEventListener("reset",b)}},[s,h]),o.jsx(An.button,{type:"button",role:"checkbox","aria-checked":Iu(u)?"mixed":u,"aria-required":d,"data-state":gz(u),"data-disabled":l?"":void 0,disabled:l,value:i,...r,ref:g,onKeyDown:yn(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:yn(n,y=>{h(b=>Iu(b)?!0:!b),f&&m&&(p.current=y.isPropagationStopped(),p.current||y.stopPropagation())})})});dz.displayName=cz;var hI=k.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:s,required:i,disabled:l,value:u,onCheckedChange:d,form:c,...h}=e;return o.jsx(Wse,{__scopeCheckbox:n,checked:a,defaultChecked:s,disabled:l,required:i,onCheckedChange:d,name:r,form:c,value:u,internal_do_not_use_render:({isFormControl:p})=>o.jsxs(o.Fragment,{children:[o.jsx(dz,{...h,ref:t,__scopeCheckbox:n}),p&&o.jsx(fz,{__scopeCheckbox:n})]})})});hI.displayName=Y0;var hz="CheckboxIndicator",pz=k.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...a}=e,s=dI(hz,n);return o.jsx(Al,{present:r||Iu(s.checked)||s.checked===!0,children:o.jsx(An.span,{"data-state":gz(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});pz.displayName=hz;var mz="CheckboxBubbleInput",fz=k.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:s,defaultChecked:i,required:l,disabled:u,name:d,value:c,form:h,bubbleInput:p,setBubbleInput:m}=dI(mz,e),f=sr(n,m),g=K0(s),x=r_(r);k.useEffect(()=>{const b=p;if(!b)return;const v=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(v,"checked").set,S=!a.current;if(g!==s&&N){const C=new Event("click",{bubbles:S});b.indeterminate=Iu(s),N.call(b,Iu(s)?!1:s),b.dispatchEvent(C)}},[p,g,s,a]);const y=k.useRef(Iu(s)?!1:s);return o.jsx(An.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??y.current,required:l,disabled:u,name:d,value:c,form:h,...t,tabIndex:-1,ref:f,style:{...t.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});fz.displayName=mz;function Vse(e){return typeof e=="function"}function Iu(e){return e==="indeterminate"}function gz(e){return Iu(e)?"indeterminate":e?"checked":"unchecked"}const xz=k.forwardRef(({className:e,...t},n)=>o.jsx(hI,{ref:n,className:Ie("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:o.jsx(pz,{className:Ie("flex items-center justify-center text-current"),children:o.jsx(an,{className:"h-4 w-4"})})}));xz.displayName=hI.displayName;const Nk="synka_biometric_enabled",kk="synka_biometric_consent_asked",Use=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("fingerprint",2,2));const n=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");let r=0;for(let a=0;a<n.length;a++){const s=n.charCodeAt(a);r=(r<<5)-r+s,r=r&r}return r.toString(36)},hv="synka_cached_email",HM="synka_known_devices",Sk="synka_remember_me";function Hse(){const e=za(),n=Rl().state,r=FK(),a=(n==null?void 0:n.appLockMode)===!0,s=(n==null?void 0:n.returnTo)||"/my-card",{user:i,sendOtp:l,verifyOtp:u,verifyPin:d,checkPinExists:c,setPin:h,signInWithGoogle:p,signInWithLinkedIn:m,loginWithPinOnly:f}=ir(),[g,x]=k.useState(!1),[y,b]=k.useState(null),[v,w]=k.useState(""),[N,S]=k.useState(""),[C,_]=k.useState(""),[T,E]=k.useState(""),[j,I]=k.useState(""),[D,F]=k.useState("email"),[P,V]=k.useState(null),[$,O]=k.useState(null),[L,q]=k.useState(()=>zw()),[U,ee]=k.useState(!1),[M,G]=k.useState(null),[J,ve]=k.useState(!1),[Q,se]=k.useState(!1),[_e,Le]=k.useState(null),[Se,ye]=k.useState(!1),Fe=k.useRef(!1),[Te,Oe]=k.useState(()=>{if(Yt.isNativePlatform())return!0;const qe=localStorage.getItem(Sk);return qe===null?!0:qe==="true"}),He=async()=>{_e&&(localStorage.setItem(kk,"true"),localStorage.setItem(Nk,"true"),await Ow(_e.email,_e.userId),oe({title:"Biometric enabled!",description:"You can now log in faster next time."}),se(!1),e("/my-card"))},Ee=()=>{localStorage.setItem(kk,"true"),localStorage.setItem(Nk,"false"),se(!1),e("/my-card")};k.useEffect(()=>{am().then(G)},[]),k.useEffect(()=>{if(Yt.isNativePlatform())return;const qe=localStorage.getItem(Sk),it=()=>{qe==="false"&&sessionStorage.setItem("synka_session_temp","true")};return window.addEventListener("beforeunload",it),()=>window.removeEventListener("beforeunload",it)},[]),k.useEffect(()=>{const qe=localStorage.getItem(hv),it=zw(),Ct=n==null?void 0:n.email;if(it&&q(it),a){const pt=cI()||qe;pt&&(O(pt),w(pt),F("pin")),ye(!0);return}Ct?(w(Ct),ye(!0)):qe?(O(qe),w(qe),c(qe).then(({exists:pt,has_pin:Ut,full_name:Ln})=>{pt&&Ut&&(Ln&&(q(Ln),Zp(Ln)),F("pin")),ye(!0)})):ye(!0)},[n==null?void 0:n.email,a]),k.useEffect(()=>{if(!a||!Se||Fe.current||D!=="pin"||J||!Px())return;Fe.current=!0;const it=setTimeout(()=>{Re()},300);return()=>clearTimeout(it)},[a,Se,D,J]);const Re=async()=>{if(r){ve(!0);try{if(!(await Uae()).success){ve(!1);return}r.unlockWithPin(),ve(!1),setTimeout(()=>{e(s,{replace:!0})},50)}catch(qe){console.error("App lock biometric error:",qe),ve(!1)}}},Ke=qe=>{const it=Use(),Ct=JSON.parse(localStorage.getItem(HM)||"{}");Ct[qe]||(Ct[qe]=[]),Ct[qe].includes(it)||Ct[qe].push(it),localStorage.setItem(HM,JSON.stringify(Ct))},at=()=>{O(null),w(""),S(""),F("email")},Y=async()=>{b("google");const{error:qe}=await p();qe&&(b(null),oe({title:"Error",description:qe.message||"Failed to sign in with Google.",variant:"destructive"}))},ae=async()=>{b("linkedin");const{error:qe}=await m();qe&&(b(null),oe({title:"Error",description:qe.message||"Failed to sign in with LinkedIn.",variant:"destructive"}))};k.useEffect(()=>{i&&!a&&e("/my-card")},[i,e,a]);const we=async qe=>{if(qe.preventDefault(),!v)return;x(!0);const{exists:it,has_pin:Ct,user_id:pt,full_name:Ut}=await c(v);if(!it){x(!1),oe({title:"Welcome to Synka!",description:"Your journey starts here  let's create something amazing."}),e("/signup",{state:{email:v.trim()}});return}if(pt&&V(pt),Ut&&q(Ut),Ct)F("pin"),x(!1);else{const{error:Ln}=await l(v);x(!1),Ln?oe({title:"Error",description:Ln.message||"Failed to send verification code.",variant:"destructive"}):(F("set_pin"),oe({title:"Verification code sent!",description:"Enter the code from your email to set up your PIN."}))}},Ce=async qe=>{if(qe.preventDefault(),N.length!==4)return;if(x(!0),a&&r){const{error:Et,locked:Lt}=await d(v,N);if(Et){x(!1),Lt?oe({title:"Account Locked",description:Et.message,variant:"destructive"}):(oe({title:"Invalid PIN",description:Et.message,variant:"destructive"}),S(""));return}r.unlockWithPin(),x(!1),e(s,{replace:!0});return}const{error:it,locked:Ct,needs_pin_setup:pt,user_id:Ut}=await d(v,N);if(it){if(x(!1),Ct)oe({title:"Account Locked",description:it.message,variant:"destructive"});else if(pt){const{error:Et}=await l(v);Et?oe({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(F("set_pin"),oe({title:"Set up your PIN",description:"Enter the verification code to set your PIN."}))}else oe({title:"Invalid PIN",description:it.message,variant:"destructive"}),S("");return}const{error:Ln}=await f(v,Ut);if(Ln){x(!1),oe({title:"Error",description:Ln.message||"Failed to create session.",variant:"destructive"});return}Ke(v),localStorage.setItem(hv,v),L&&Zp(L),Dc(v),Yt.isNativePlatform()||localStorage.setItem(Sk,Te?"true":"false");const bt=localStorage.getItem(kk)==="true",Ot=localStorage.getItem(Nk)==="true";if(Yt.isNativePlatform()&&(M!=null&&M.available)&&Ut)if(bt)Ot&&await Ow(v,Ut);else{Le({email:v,userId:Ut}),x(!1),oe({title:"Welcome back!",description:"You have successfully logged in."}),se(!0);return}x(!1),oe({title:"Welcome back!",description:"You have successfully logged in."}),e("/my-card")},Ne=async()=>{ve(!0);const qe=await KL();if(!qe.success){if(ve(!1),qe.error==="cancelled")return;oe({title:"Biometric failed",description:qe.error||"Please try again or use your PIN.",variant:"destructive"});return}const{error:it}=await f(qe.email,qe.userId);if(it){ve(!1),oe({title:"Login failed",description:"Please use your PIN to log in.",variant:"destructive"});return}localStorage.setItem(hv,qe.email),qe.userId&&Dc(qe.email),ve(!1),oe({title:"Welcome back!",description:"Logged in with biometrics."}),e("/my-card")},he=async qe=>{if(qe.preventDefault(),C.length!==6)return;x(!0);const{error:it}=await u(v,C);x(!1),it?oe({title:"Error",description:it.message||"Invalid verification code.",variant:"destructive"}):(Ke(v),localStorage.setItem(hv,v),Dc(v),oe({title:"Welcome back!",description:"You have successfully logged in."}),e("/my-card"))},Ae=async qe=>{if(qe.preventDefault(),C.length!==6){oe({title:"Enter verification code",description:"Please enter the 6-digit code from your email.",variant:"destructive"});return}if(T.length!==4||j.length!==4){oe({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(T!==j){oe({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}x(!0);const{error:it}=await u(v,C);if(it){x(!1),oe({title:"Error",description:"Invalid verification code.",variant:"destructive"});return}const{exists:Ct,user_id:pt}=await c(v);if(!Ct||!pt){x(!1),oe({title:"Error",description:"Could not find your account.",variant:"destructive"});return}const{error:Ut}=await h(pt,T);if(x(!1),Ut){oe({title:"Error",description:"Failed to set PIN. Please try again.",variant:"destructive"});return}oe({title:"PIN set successfully!",description:"Welcome to Synka."}),L&&Zp(L),Dc(v),e("/my-card")},gt=async()=>{x(!0);const{error:qe}=await l(v);x(!1),qe?oe({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(F("forgot_pin_otp"),_(""),E(""),I(""),oe({title:"Verification code sent!",description:"Enter the code to reset your PIN."}))},ht=async qe=>{if(qe.preventDefault(),C.length!==6){oe({title:"Enter verification code",description:"Please enter the 6-digit code from your email.",variant:"destructive"});return}if(T.length!==4||j.length!==4){oe({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(T!==j){oe({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}x(!0);const{error:it}=await u(v,C);if(it){x(!1),oe({title:"Error",description:"Invalid verification code.",variant:"destructive"});return}const{exists:Ct,user_id:pt}=await c(v);if(!Ct||!pt){x(!1),oe({title:"Error",description:"Could not find your account.",variant:"destructive"});return}const{error:Ut}=await h(pt,T);if(x(!1),Ut){oe({title:"Error",description:"Failed to reset PIN. Please try again.",variant:"destructive"});return}oe({title:"PIN reset successfully!",description:"Welcome back to Synka."}),L&&Zp(L),Dc(v),e("/my-card")},Dt=()=>{if(a&&D==="pin")return"Welcome Back";switch(D){case"email":return"Welcome back";case"pin":return"Enter your PIN";case"otp":return"Verify your identity";case"set_pin":return"Set up your PIN";case"forgot_pin_otp":return"Reset your PIN";default:return"Welcome back"}},$t=()=>{if(a&&D==="pin")return"Continue to your Synka";switch(D){case"email":return"Sign in to your account to continue";case"pin":return"";case"otp":return"Enter the verification code sent to your email";case"set_pin":return"Create a 4-digit PIN for quick access";case"forgot_pin_otp":return"Enter the code and create a new PIN";default:return""}};return Se?o.jsxs(o.Fragment,{children:[o.jsx(YL,{open:Q,onOpenChange:se,onEnable:He,onSkip:Ee,biometricInfo:M}),o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden flex flex-col lg:flex-row",children:[o.jsx("div",{className:"flex-1 flex items-center justify-center p-4 sm:p-6 md:p-12 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:o.jsxs("div",{className:"w-full max-w-md space-y-6 sm:space-y-8 animate-fade-up",children:[!a&&o.jsx("div",{className:"mb-4",children:o.jsx(Va,{to:"/index",className:"inline-flex items-center text-sm font-medium text-muted-foreground hover:text-foreground",children:" Back to Home"})}),o.jsxs("div",{className:"text-center lg:text-left",children:[o.jsx("div",{className:"mb-8",children:o.jsx(us,{size:"lg"})}),o.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:Dt()}),o.jsx("p",{className:"text-muted-foreground",children:$t()})]}),D==="email"&&o.jsxs("form",{onSubmit:we,className:"space-y-6",children:[o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"email",children:"Email"}),o.jsxs("div",{className:"relative",children:[o.jsx(xi,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),o.jsx(Ge,{id:"email",type:"email",placeholder:"you@example.com",value:v,onChange:qe=>w(qe.target.value),className:"pl-10 h-12",required:!0})]})]})}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Please wait...":"Continue",o.jsx(fi,{className:"h-5 w-5"})]})]}),D==="pin"&&o.jsxs("form",{onSubmit:Ce,className:"space-y-6",children:[L&&o.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border border-border",children:[o.jsx("p",{className:"font-medium text-foreground text-lg",children:L}),U?o.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["(",v||$,")"]}):o.jsx("button",{type:"button",onClick:()=>ee(!0),className:"text-xs text-primary/70 hover:text-primary mt-1",children:"view email"})]}),(a&&Px()||(M==null?void 0:M.available)&&M.hasCredentials)&&o.jsxs(fe,{type:"button",variant:"outline",size:"xl",className:"w-full gap-3",onClick:a?Re:Ne,disabled:J,children:[J?o.jsx("span",{className:"animate-spin",children:""}):(M==null?void 0:M.biometryType)==="face"?o.jsx(D3,{className:"h-6 w-6"}):o.jsx(dw,{className:"h-6 w-6"}),J?"Authenticating...":a?`Unlock with ${Lw(M==null?void 0:M.biometryType)}`:`Sign in with ${Lw(M==null?void 0:M.biometryType)}`]}),(a&&Px()||(M==null?void 0:M.available)&&M.hasCredentials)&&o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center",children:o.jsx("span",{className:"w-full border-t border-border"})}),o.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:o.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or enter PIN"})})]}),o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"4-Digit PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:N,onChange:S,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]})}),!Yt.isNativePlatform()&&o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(xz,{id:"remember-me",checked:Te,onCheckedChange:qe=>Oe(qe===!0)}),o.jsx(We,{htmlFor:"remember-me",className:"text-sm text-muted-foreground cursor-pointer",children:"Remember me"})]}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g||N.length!==4,children:[g?"Verifying...":a?"Unlock":"Sign In",o.jsx(fi,{className:"h-5 w-5"})]}),!a&&o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs(fe,{type:"button",variant:"ghost",size:"sm",onClick:at,className:"text-muted-foreground",children:[o.jsx(E3,{className:"h-4 w-4 mr-1"}),"Different account"]}),o.jsx(fe,{type:"button",variant:"link",onClick:gt,disabled:g,children:"Forgot PIN?"})]})]}),D==="otp"&&o.jsxs("form",{onSubmit:he,className:"space-y-6",children:[o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"otp",children:"Verification Code"}),o.jsx(Ge,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:C,onChange:qe=>_(qe.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]})}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g||C.length!==6,children:[g?"Verifying...":"Complete Login",o.jsx(fi,{className:"h-5 w-5"})]}),o.jsx(fe,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("pin"),_("")},children:"Back"})]}),D==="set_pin"&&o.jsxs("form",{onSubmit:Ae,className:"space-y-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"setup-otp",children:"Verification Code"}),o.jsx(Ge,{id:"setup-otp",type:"text",placeholder:"Enter 6-digit code",value:C,onChange:qe=>_(qe.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Create 4-Digit PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:T,onChange:E,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Confirm PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:j,onChange:I,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]})]}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Setting up...":"Set PIN & Continue",o.jsx(fi,{className:"h-5 w-5"})]}),o.jsx(fe,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("email"),_(""),E(""),I("")},children:"Back"})]}),D==="forgot_pin_otp"&&o.jsxs("form",{onSubmit:ht,className:"space-y-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"reset-otp",children:"Verification Code"}),o.jsx(Ge,{id:"reset-otp",type:"text",placeholder:"Enter 6-digit code",value:C,onChange:qe=>_(qe.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"New 4-Digit PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:T,onChange:E,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Confirm New PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:j,onChange:I,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]})]}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Resetting...":"Reset PIN & Sign In",o.jsx(fi,{className:"h-5 w-5"})]}),o.jsx(fe,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("pin"),_(""),E(""),I("")},children:"Back"})]}),D==="email"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center",children:o.jsx("span",{className:"w-full border-t border-border"})}),o.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:o.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs(fe,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:Y,disabled:y!==null,children:[y==="google"?o.jsx("span",{className:"animate-spin mr-2",children:""}):o.jsxs("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:[o.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),o.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),o.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),o.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]}),o.jsxs(fe,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:ae,disabled:y!==null,children:[y==="linkedin"?o.jsx("span",{className:"animate-spin mr-2",children:""}):o.jsx("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"#0A66C2",children:o.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]})]}),!a&&o.jsxs("p",{className:"text-center text-muted-foreground",children:["Don't have an account?"," ",o.jsx(Va,{to:"/signup",className:"text-primary font-medium hover:underline",children:"Sign up"})]})]})}),o.jsx("div",{className:"hidden lg:flex flex-1 gradient-bg items-center justify-center p-12",children:o.jsxs("div",{className:"max-w-md text-center space-y-6",children:[o.jsx("div",{className:"w-32 h-32 mx-auto rounded-3xl glass flex items-center justify-center animate-float",children:D==="pin"&&(M!=null&&M.available)?o.jsx(dw,{className:"w-16 h-16 text-primary-foreground/80"}):o.jsx(CS,{className:"w-16 h-16 text-primary-foreground/80"})}),o.jsx("h2",{className:"text-3xl font-bold text-primary-foreground",children:D==="pin"&&(M!=null&&M.available)?"Secure Biometric Login":"Secure PIN Login"}),o.jsx("p",{className:"text-primary-foreground/80",children:D==="pin"&&(M!=null&&M.available)?"Use your fingerprint or face to log in instantly. Or enter your 4-digit PIN.":"Quick and secure access with your 4-digit PIN. No passwords to remember."})]})})]})]}):o.jsx("div",{className:"min-h-dvh flex items-center justify-center",children:o.jsx(us,{})})}var yz={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},GM=ge.createContext&&ge.createContext(yz),Gse=["attr","size","title"];function qse(e,t){if(e==null)return{};var n=Kse(e,t),r,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Kse(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Ww(){return Ww=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ww.apply(this,arguments)}function qM(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function Vw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?qM(Object(n),!0).forEach(function(r){Yse(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qM(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Yse(e,t,n){return t=Xse(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xse(e){var t=Zse(e,"string");return typeof t=="symbol"?t:t+""}function Zse(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bz(e){return e&&e.map((t,n)=>ge.createElement(t.tag,Vw({key:n},t.attr),bz(t.child)))}function Qse(e){return t=>ge.createElement(Jse,Ww({attr:Vw({},e.attr)},t),bz(e.child))}function Jse(e){var t=n=>{var{attr:r,size:a,title:s}=e,i=qse(e,Gse),l=a||n.size||"1em",u;return n.className&&(u=n.className),e.className&&(u=(u?u+" ":"")+e.className),ge.createElement("svg",Ww({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,i,{className:u,style:Vw(Vw({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&ge.createElement("title",null,s),e.children)};return GM!==void 0?ge.createElement(GM.Consumer,null,n=>t(n)):t(yz)}function pI(e){return Qse({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(e)}const sd=lf("Share",{web:()=>Qu(()=>import("./web-BSaYvwmp.js"),__vite__mapDeps([6,1,2,3])).then(e=>new e.ShareWeb)}),vz="synka_contacts_cache",wz="contacts",eie=60*60*1e3,Ck=e=>{try{const t=localStorage.getItem(`${vz}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<eie)return r}const n=f_(`${wz}_${e}`);if(n)return n}catch{}return[]},_k=(e,t)=>{try{localStorage.setItem(`${vz}_${e}`,JSON.stringify({data:t,timestamp:Date.now()})),m_(`${wz}_${e}`,t)}catch{}};function tie(){const{user:e}=ir(),[t,n]=k.useState(()=>e?Ck(e.id):[]),[r,a]=k.useState(()=>e?Ck(e.id).length===0:!1),[s,i]=k.useState(!1),[l,u]=k.useState(!1);k.useEffect(()=>{if(e){const y=Ck(e.id);y.length>0?(n(y),a(!1),u(!0),d().finally(()=>u(!1))):d();const b=()=>{console.log("[Contacts] Data sync triggered - refetching"),d()};return window.addEventListener("synka:data-sync",b),()=>window.removeEventListener("synka:data-sync",b)}else n([]),a(!1),i(!1)},[e]);const d=async()=>{if(!e)return;s||a(!0);const{data:y,error:b}=await le.from("contacts").select("*").eq("owner_id",e.id).order("created_at",{ascending:!1});if(b){console.error("Error fetching contacts:",b),n([]),a(!1),i(!0);return}const v=(y||[]).map(w=>w.id);if(v.length>0){const{data:w}=await le.from("contact_tags").select("contact_id, tag_id, tags(id, name, color)").in("contact_id",v),{data:N}=await le.from("contact_events").select("contact_id, event_id, events(id, title, start_time, end_time)").in("contact_id",v),S={},C={};(w||[]).forEach(T=>{S[T.contact_id]||(S[T.contact_id]=[]),T.tags&&S[T.contact_id].push(T.tags)}),(N||[]).forEach(T=>{C[T.contact_id]||(C[T.contact_id]=[]),T.events&&C[T.contact_id].push(T.events)});const _=(y||[]).map(T=>({...T,tags:S[T.id]||[],events:C[T.id]||[]}));n(_),e&&_k(e.id,_)}else n([]),e&&_k(e.id,[]);a(!1),i(!0)};return{contacts:t,loading:r,createContact:async(y,b)=>{if(!e)return{error:new Error("Not authenticated"),data:null};const v=y.notes?[{text:y.notes,timestamp:new Date().toISOString()}]:[],{data:w,error:N}=await le.from("contacts").insert({owner_id:e.id,name:y.name||"",company:y.company||null,designation:y.designation||null,email:y.email||null,phone:y.phone||null,whatsapp:y.whatsapp||null,linkedin:y.linkedin||null,website:y.website||null,notes_history:v,source:y.source||"manual"}).select().single();if(!N&&w){if(b&&b.length>0){const S=b.map(C=>({contact_id:w.id,event_id:C}));await le.from("contact_events").insert(S)}await d()}return{data:w,error:N}},updateContact:async(y,b)=>{const{notes:v,tags:w,events:N,...S}=b,{error:C}=await le.from("contacts").update(S).eq("id",y);return C||n(_=>_.map(T=>T.id===y?{...T,...b}:T)),{error:C}},deleteContact:async y=>{const{error:b}=await le.from("contacts").delete().eq("id",y);if(!b){const v=t.filter(w=>w.id!==y);n(v),e&&_k(e.id,v)}return{error:b}},addTagToContact:async(y,b)=>{const{error:v}=await le.from("contact_tags").insert({contact_id:y,tag_id:b});return{error:v}},removeTagFromContact:async(y,b)=>{const{error:v}=await le.from("contact_tags").delete().eq("contact_id",y).eq("tag_id",b);return{error:v}},addEventToContact:async(y,b)=>{const{error:v}=await le.from("contact_events").insert({contact_id:y,event_id:b});return{error:v}},removeEventFromContact:async(y,b)=>{const{error:v}=await le.from("contact_events").delete().eq("contact_id",y).eq("event_id",b);return{error:v}},refetch:d}}async function nie(e,t){const n=t.phone||t.whatsapp||null,r=t.whatsapp||t.phone||null,a=[],{data:s,error:i}=await le.from("contacts").insert({owner_id:e,name:t.name,company:t.company||null,designation:t.designation||null,email:t.email||null,phone:n,whatsapp:r,linkedin:t.linkedin||null,notes_history:a,source:"public_form"}).select().single();if(i)return console.error("Error creating contact:",i),{error:i};if(s){const l=new Date,{data:u}=await le.from("events").select("*").eq("user_id",e);if(u&&u.length>0){const d=u.filter(c=>{const h=new Date(c.start_time),p=c.end_time?new Date(c.end_time):h;return l>=h&&l<=p});if(d.length>0){const c=d.map(h=>({contact_id:s.id,event_id:h.id}));await le.from("contact_events").insert(c)}}}return{data:s,error:null}}function Nz(){const e=navigator.userAgent,t=`${window.screen.width}x${window.screen.height}`,n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=navigator.language,a=`${e}|${t}|${n}|${r}`;let s=0;for(let i=0;i<a.length;i++){const l=a.charCodeAt(i);s=(s<<5)-s+l,s=s&s}return Math.abs(s).toString(36)}async function rie(e,t,n="qr",r){const a=Nz();await le.from("scan_events").insert({user_id:e,card_id:t,event_id:r,source:n,device_hash:a,user_agent:navigator.userAgent})}async function KM(e,t){const n=Nz();await le.from("contact_saves").insert({user_id:e,card_id:t,device_hash:n})}function aie(){const{user:e}=ir(),[t,n]=k.useState(null),[r,a]=k.useState(!0),s=k.useCallback(async(l,u)=>{if(!e){n(null),a(!1);return}a(!0);try{const{data:d,error:c}=await le.rpc("get_dashboard_analytics",{p_user_id:e.id,p_start_date:(l==null?void 0:l.toISOString())||null,p_end_date:(u==null?void 0:u.toISOString())||null});if(c)console.error("Error fetching analytics:",c),n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0});else if(d){const h=d;n({card_views:h.card_views??0,contact_saves:h.contact_saves??0,connections_added:h.connections_added??0,attended_events:h.attended_events??0,views_in_attended_events:h.views_in_attended_events??0})}else n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0})}catch(d){console.error("Error fetching analytics:",d),n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0})}a(!1)},[e]),i=k.useCallback(async(l,u)=>{if(!e)return[];try{const{data:d,error:c}=await le.rpc("get_attended_events_list",{p_user_id:e.id,p_start_date:(l==null?void 0:l.toISOString())||null,p_end_date:(u==null?void 0:u.toISOString())||null});return c?(console.error("Error fetching attended events:",c),[]):d||[]}catch(d){return console.error("Error fetching attended events:",d),[]}},[e]);return k.useEffect(()=>{s()},[s]),{analytics:t,loading:r,refetch:s,fetchAttendedEvents:i}}function sie({slug:e}){const t=x3(),n=e||t.slug;return k.useEffect(()=>{if(Yt.isNativePlatform())return;if(!document.querySelector('meta[name="apple-itunes-app"]')){const a=document.createElement("meta");a.name="apple-itunes-app";const s=n?`synka://u/${n}`:"synka://";return a.content=`app-id=YOUR_APP_STORE_ID, app-argument=${s}`,document.head.appendChild(a),()=>{a.remove()}}},[n]),null}const iie={"#6366f1":{text:"#ffffff"},"#10b981":{text:"#ffffff"},"#f43f5e":{text:"#ffffff"},"#f59e0b":{text:"#1f2937"},"#06b6d4":{text:"#ffffff"},"#8b5cf6":{text:"#ffffff"},"#475569":{text:"#ffffff"},"#1e3a5f":{text:"#ffffff"}},YM=(e,t,n)=>Math.min(Math.max(e,t),n),oie=(e,t,n)=>{let r=e??50,a=t??38;return t!=null&&(t<25||t>65)&&(a=38),r=YM(r,35,65),a=YM(a,28,55),n&&(a=Math.min(a+8,60)),`${r}% ${a}%`};function mI({layout:e,photoUrl:t,logoUrl:n,name:r,designation:a,company:s,themeColor:i,faceX:l,faceY:u,logoX:d,logoY:c,className:h,isPhotoLoaded:p=!0}){var C;const[m,f]=k.useState(!1),[g,x]=k.useState(!1),y=p!==void 0?p:g;k.useEffect(()=>{if(!t){f(!1),x(!0);return}x(!1),f(!1);const _=new Image;_.onload=()=>{x(!0);const E=_.height/_.width;f(E>1.1)},_.onerror=()=>{x(!0)},_.src=t;const T=setTimeout(()=>{_.complete||x(!0)},3e3);return()=>clearTimeout(T)},[t]);const b=_=>_.split(" ").filter(Boolean).map(T=>T[0]).join("").toUpperCase().slice(0,2)||"U",v=i&&((C=iie[i])==null?void 0:C.text)||"#ffffff",w=()=>`${d??50}% ${c??50}%`,N=oie(l,u,m),S=w();return e==="photo-logo"?o.jsx("div",{className:Ie("w-full overflow-hidden rounded-3xl",h),children:o.jsx("div",{className:"w-full h-80 md:h-96 relative overflow-hidden bg-muted",children:t?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-2xl scale-125 opacity-50 transition-opacity duration-300",!y&&"opacity-0")}),o.jsx("img",{src:t,alt:r,className:Ie("relative z-10 w-full h-full object-cover transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{y||x(!0)}})]}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-6xl font-bold text-muted-foreground/40",children:b(r)})})})}):e==="wave-split"?o.jsxs("div",{className:Ie("relative w-full",h),children:[o.jsx("div",{className:"w-full h-80 md:h-96 overflow-hidden relative bg-muted",children:t?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-2xl scale-125 opacity-50 transition-opacity duration-300",!y&&"opacity-0")}),o.jsx("img",{src:t,alt:r,className:Ie("relative z-10 w-full h-full object-cover transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{y||x(!0)}})]}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-6xl font-bold text-muted-foreground/40",children:b(r)})})}),o.jsx("svg",{className:"absolute bottom-[-1px] left-0 w-full z-20",viewBox:"0 0 400 50",preserveAspectRatio:"none",children:o.jsx("path",{d:"M0,25 Q100,50 200,25 T400,25 L400,50 L0,50 Z",className:"fill-background"})})]}):e==="minimal-circle"?o.jsx("div",{className:Ie("flex justify-center pt-4",h),children:o.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-primary/20 shadow-lg bg-primary/10",children:t?o.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{y||x(!0)}}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-3xl font-bold text-primary",children:b(r)})})})}):e==="logo-photo"?o.jsx("div",{className:Ie("w-full flex justify-center pt-6 pb-4",h),children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-44 h-44 rounded-3xl overflow-hidden shadow-lg bg-muted",children:n?o.jsx("img",{src:n,alt:"Logo",className:"w-full h-full object-cover",style:{objectPosition:S}}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:"LOGO"})})}),t&&o.jsx("div",{className:"absolute -bottom-3 -left-3 w-16 h-16 rounded-full overflow-hidden border-2 border-white shadow-lg bg-white",children:o.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{y||x(!0)}})})]})}):e==="dark-professional"?o.jsxs("div",{className:Ie("relative w-full h-72 rounded-3xl bg-muted",h),children:[o.jsx("div",{className:`
            absolute inset-0
            overflow-hidden
            rounded-3xl

            md:left-12
            md:right-12
          `,children:t&&o.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-xl scale-110 opacity-70 transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N}})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 z-10",children:t?o.jsx("img",{src:t,alt:r,className:Ie("max-h-full max-w-full object-contain rounded-2xl shadow-xl transition-opacity duration-300",!y&&"opacity-0"),onLoad:()=>{y||x(!0)}}):o.jsx("div",{className:"w-32 h-32 rounded-2xl bg-muted-foreground/20 flex items-center justify-center",children:o.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:b(r)})})}),n&&o.jsx("div",{className:`
              absolute bottom-4 right-4
              md:right-16
              w-12 h-12
              rounded-full overflow-hidden
              shadow-lg z-20
              bg-black/20 backdrop-blur-md
            `,children:o.jsx("img",{src:n,alt:"Logo",className:"w-full h-full object-contain"})})]}):e==="photo-only"?o.jsx("div",{className:Ie("relative w-full aspect-[3/4] sm:aspect-[4/5] rounded-3xl overflow-hidden bg-muted","transition-all duration-300 ease-out",h),children:t?o.jsxs(o.Fragment,{children:[o.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-xl scale-110 opacity-70 transition-all duration-300 ease-out transition-opacity duration-300",!y&&"opacity-0")}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:o.jsx("img",{src:t,alt:r,className:Ie("max-h-full max-w-full object-contain rounded-2xl shadow-xl transition-all duration-300 ease-out transition-opacity duration-300",!y&&"opacity-0"),onLoad:()=>{y||x(!0)}})}),o.jsxs("div",{className:"absolute bottom-4 left-0 right-0 px-6 text-center pointer-events-none z-20 transition-all duration-300 ease-out",children:[o.jsx("h2",{className:"text-xl font-semibold text-white drop-shadow-md",children:r}),a&&o.jsx("p",{className:"text-sm text-white/90 mt-1 drop-shadow-sm",children:a}),s&&o.jsx("p",{className:"text-xs text-white/80 mt-0.5 drop-shadow-sm",children:s})]})]}):o.jsx("div",{className:"w-full h-full flex items-center justify-center",children:o.jsx("span",{className:"text-4xl font-bold text-muted-foreground",children:b(r)})})}):e==="logo-only"?o.jsx("div",{className:Ie("w-full bg-white flex justify-center pt-4 pb-2",h),children:t?o.jsx("div",{className:"w-36 h-36 rounded-3xl overflow-hidden shadow-lg bg-muted",children:o.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!y&&"opacity-0"),style:{objectPosition:N,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{y||x(!0)}})}):o.jsx("div",{className:"w-36 h-36 rounded-3xl bg-muted flex items-center justify-center",children:o.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:b(r)})})}):e==="color"&&i?o.jsx("div",{className:Ie("w-full bg-white flex justify-center pt-4 pb-2",h),children:o.jsx("div",{className:"w-36 h-36 rounded-3xl flex items-center justify-center shadow-lg",style:{backgroundColor:i},children:o.jsx("span",{className:"text-3xl font-bold select-none",style:{color:v},children:b(r)})})}):null}function lie(e,t=[]){let n=[];function r(s,i){const l=k.createContext(i);l.displayName=s+"Context";const u=n.length;n=[...n,i];const d=h=>{var y;const{scope:p,children:m,...f}=h,g=((y=p==null?void 0:p[e])==null?void 0:y[u])||l,x=k.useMemo(()=>f,Object.values(f));return o.jsx(g.Provider,{value:x,children:m})};d.displayName=s+"Provider";function c(h,p){var g;const m=((g=p==null?void 0:p[e])==null?void 0:g[u])||l,f=k.useContext(m);if(f)return f;if(i!==void 0)return i;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[d,c]}const a=()=>{const s=n.map(i=>k.createContext(i));return function(l){const u=(l==null?void 0:l[e])||s;return k.useMemo(()=>({[`__scope${e}`]:{...l,[e]:u}}),[l,u])}};return a.scopeName=e,[r,uie(a,...t)]}function uie(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(s){const i=r.reduce((l,{useScope:u,scopeName:d})=>{const h=u(s)[`__scope${d}`];return{...l,...h}},{});return k.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}var cie=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],kz=cie.reduce((e,t)=>{const n=g_(`Primitive.${t}`),r=k.forwardRef((a,s)=>{const{asChild:i,...l}=a,u=i?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),o.jsx(u,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),fI="Progress",gI=100,[die]=lie(fI),[hie,pie]=die(fI),Sz=k.forwardRef((e,t)=>{const{__scopeProgress:n,value:r=null,max:a,getValueLabel:s=mie,...i}=e;(a||a===0)&&!XM(a)&&console.error(fie(`${a}`,"Progress"));const l=XM(a)?a:gI;r!==null&&!ZM(r,l)&&console.error(gie(`${r}`,"Progress"));const u=ZM(r,l)?r:null,d=Uw(u)?s(u,l):void 0;return o.jsx(hie,{scope:n,value:u,max:l,children:o.jsx(kz.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":Uw(u)?u:void 0,"aria-valuetext":d,role:"progressbar","data-state":Iz(u,l),"data-value":u??void 0,"data-max":l,...i,ref:t})})});Sz.displayName=fI;var Cz="ProgressIndicator",_z=k.forwardRef((e,t)=>{const{__scopeProgress:n,...r}=e,a=pie(Cz,n);return o.jsx(kz.div,{"data-state":Iz(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:t})});_z.displayName=Cz;function mie(e,t){return`${Math.round(e/t*100)}%`}function Iz(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function Uw(e){return typeof e=="number"}function XM(e){return Uw(e)&&!isNaN(e)&&e>0}function ZM(e,t){return Uw(e)&&!isNaN(e)&&e<=t&&e>=0}function fie(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${gI}\`.`}function gie(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${gI} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var Tz=Sz,xie=_z;const Ez=k.forwardRef(({className:e,value:t,...n},r)=>o.jsx(Tz,{ref:r,className:Ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...n,children:o.jsx(xie,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Ez.displayName=Tz.displayName;const yie=5*1024*1024;function S2({documentName:e,documentUrl:t,isEditMode:n=!1,userId:r,cardId:a,isPremium:s=!1,onUpdate:i}){const[l,u]=k.useState(!1),[d,c]=k.useState(0),[h,p]=k.useState(e||""),m=k.useRef(null);k.useEffect(()=>{p(e||"")},[e]);const f=async()=>{if(!i||!s)return;const N=h.trim();N!==(e||"")&&await i({document_name:N||null})},g=N=>N.type!=="application/pdf"?"Only PDF files are allowed":N.size>yie?"Upload a file upto 5 MB":null,x=async(N,S)=>{var T;if(c(30),t)try{const E=(T=t.split("/documents/")[1])==null?void 0:T.split("?")[0];E&&await le.storage.from("documents").remove([E])}catch{}c(50);const{error:C}=await le.storage.from("documents").upload(S,N,{upsert:!0,contentType:"application/pdf",cacheControl:"0"});if(C)throw new Error(C.message);c(90);const{data:_}=le.storage.from("documents").getPublicUrl(S);return c(100),`${_.publicUrl}?t=${Date.now()}`},y=()=>{var N;if(!s){oe({title:"Upgrade to Orange",description:"Upgrade to Orange to unlock document uploads."});return}(N=m.current)==null||N.click()},b=async N=>{if(!r||!a||!i||!s)return;const S=g(N);if(S){oe({title:"Upload failed",description:S,variant:"destructive"});return}u(!0),c(0);try{const C=`${r}/${a}-document-${Date.now()}.pdf`,_=await x(N,C);await i({document_name:h.trim()||null,document_url:_}),oe({title:"Document uploaded",description:"Your document has been saved."})}catch(C){oe({title:"Upload failed",description:(C==null?void 0:C.message)||"Could not upload document.",variant:"destructive"})}finally{u(!1),c(0)}},v=async()=>{var N;if(!(!i||!s)){if(t)try{const S=(N=t.split("/documents/")[1])==null?void 0:N.split("?")[0];S&&await le.storage.from("documents").remove([S])}catch{}await i({document_name:null,document_url:null}),p(""),m.current&&(m.current.value=""),oe({title:"Document removed"})}},w=N=>{var C;const S=(C=N.target.files)==null?void 0:C[0];S&&b(S),N.target.value=""};return!n&&!t?null:n?o.jsxs("div",{className:"space-y-4",children:[o.jsx(We,{className:"font-semibold",children:"Document"}),o.jsxs("div",{className:"flex flex-col gap-3 p-3 rounded-xl bg-muted/50",children:[o.jsx(Ge,{placeholder:"e.g. Pitch Deck, Catalogue, Menu...",value:h,onChange:N=>p(N.target.value),onBlur:f,disabled:!s,className:"text-sm"}),t&&s&&o.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 p-3 rounded-lg bg-background/60 border border-border/40",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-medium truncate",children:h||"Document"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF  Tap to view"})]}),o.jsx(C3,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsxs("div",{className:t?"flex items-center justify-end gap-2":"flex justify-center",children:[!t&&o.jsxs(fe,{type:"button",variant:"outline",size:"sm",onClick:y,disabled:l,children:[!s&&o.jsx(yl,{className:"h-3 w-3 mr-1"}),o.jsx(Hp,{className:"h-3 w-3 mr-1"}),"Upload a PDF"]}),t&&s&&o.jsxs(o.Fragment,{children:[o.jsxs(fe,{type:"button",variant:"ghost",size:"sm",onClick:y,disabled:l,children:[o.jsx(Ay,{className:"h-3.5 w-3.5 mr-1"}),"Replace"]}),o.jsxs(fe,{type:"button",variant:"ghost",size:"sm",onClick:v,className:"text-destructive",children:[o.jsx(Do,{className:"h-3.5 w-3.5 mr-1"}),"Remove"]})]})]}),l&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ez,{value:d,className:"flex-1 h-2"}),o.jsxs("span",{className:"text-xs text-muted-foreground",children:[d,"%"]})]}),o.jsx("input",{ref:m,type:"file",accept:"application/pdf",className:"hidden",onChange:w})]})]}):o.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:`group flex items-center gap-4 px-4 py-3 rounded-2xl
                 active:scale-[0.98]
                 transition-all duration-150
                 hover:bg-muted/30`,children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:o.jsx(I3,{className:"h-5 w-5 text-foreground"})}),o.jsx("p",{className:"text-[15px] font-medium text-foreground truncate",children:e||"Document"})]})}const bie={instagram:()=>o.jsxs("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5"}),o.jsx("circle",{cx:"12",cy:"12",r:"4"}),o.jsx("circle",{cx:"17.5",cy:"6.5",r:"1.5",fill:"currentColor",stroke:"none"})]}),youtube:()=>o.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),twitter:()=>o.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),facebook:()=>o.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),calendly:()=>o.jsxs("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:[o.jsx("path",{d:"M19.655 14.262c-.124.209-.258.41-.402.603a6.642 6.642 0 0 1-2.126 1.876c-.259.153-.53.29-.81.41-.592.255-1.23.427-1.89.51a6.6 6.6 0 0 1-2.088-.067 6.672 6.672 0 0 1-4.808-3.803 6.636 6.636 0 0 1-.507-1.795 6.596 6.596 0 0 1 .142-2.347 6.65 6.65 0 0 1 1.338-2.645 6.674 6.674 0 0 1 2.081-1.673c.262-.135.533-.253.812-.354a6.598 6.598 0 0 1 2.976-.4c.68.07 1.335.24 1.95.5.288.122.567.262.836.42a6.664 6.664 0 0 1 2.094 1.872c.145.195.28.398.404.609l2.407-1.39a9.322 9.322 0 0 0-1.28-1.727 9.419 9.419 0 0 0-2.623-2.006 9.294 9.294 0 0 0-1.596-.695 9.353 9.353 0 0 0-5.848-.02 9.32 9.32 0 0 0-3.096 1.673 9.387 9.387 0 0 0-2.317 2.755 9.344 9.344 0 0 0-1.053 3.164 9.324 9.324 0 0 0 .088 3.293 9.342 9.342 0 0 0 1.059 2.81 9.39 9.39 0 0 0 1.885 2.297 9.41 9.41 0 0 0 2.508 1.652 9.303 9.303 0 0 0 2.9.786 9.346 9.346 0 0 0 2.948-.096 9.306 9.306 0 0 0 2.679-.923 9.388 9.388 0 0 0 2.996-2.617 9.326 9.326 0 0 0 1.29-1.993l-2.404-1.389z"}),o.jsx("path",{d:"M14.07 10.312a2.362 2.362 0 0 0-2.058-1.2 2.367 2.367 0 0 0-2.059 1.2 2.362 2.362 0 0 0 0 2.376 2.367 2.367 0 0 0 2.059 1.2 2.362 2.362 0 0 0 2.058-1.2 2.36 2.36 0 0 0 0-2.376z"})]})},vie={instagram:"Instagram",youtube:"YouTube",twitter:"Twitter",facebook:"Facebook",calendly:"Book a meeting"};function Io({platform:e,url:t,className:n}){if(!t)return null;const r=bie[e],a=vie[e];return o.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"group block",children:[o.jsxs("div",{className:Ie("flex items-center gap-4 px-4 py-3",n),children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:o.jsx(r,{})}),o.jsx("p",{className:"text-[15px] font-medium text-foreground truncate flex-1",children:a})]}),o.jsx("div",{className:"ml-[72px] h-px bg-border/40 group-last:hidden"})]})}function wie(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const jz=ge.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Ly=()=>{const e=ge.useContext(jz);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};wie(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const Nie=24,kie=typeof window<"u"?k.useLayoutEffect:k.useEffect;function QM(...e){return(...t)=>{for(let n of e)typeof n=="function"&&n(...t)}}function Sie(){return xI(/^Mac/)}function Cie(){return xI(/^iPhone/)}function JM(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function _ie(){return xI(/^iPad/)||Sie()&&navigator.maxTouchPoints>1}function Az(){return Cie()||_ie()}function xI(e){return typeof window<"u"&&window.navigator!=null?e.test(window.navigator.platform):void 0}const Ik=typeof document<"u"&&window.visualViewport;function e$(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function Rz(e){for(e$(e)&&(e=e.parentElement);e&&!e$(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const Iie=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let pv=0,Tk;function Tie(e={}){let{isDisabled:t}=e;kie(()=>{if(!t)return pv++,pv===1&&Az()&&(Tk=Eie()),()=>{pv--,pv===0&&(Tk==null||Tk())}},[t])}function Eie(){let e,t=0,n=h=>{e=Rz(h.target),!(e===document.documentElement&&e===document.body)&&(t=h.changedTouches[0].pageY)},r=h=>{if(!e||e===document.documentElement||e===document.body){h.preventDefault();return}let p=h.changedTouches[0].pageY,m=e.scrollTop,f=e.scrollHeight-e.clientHeight;f!==0&&((m<=0&&p>t||m>=f&&p<t)&&h.preventDefault(),t=p)},a=h=>{let p=h.target;C2(p)&&p!==document.activeElement&&(h.preventDefault(),p.style.transform="translateY(-2000px)",p.focus(),requestAnimationFrame(()=>{p.style.transform=""}))},s=h=>{let p=h.target;C2(p)&&(p.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{p.style.transform="",Ik&&(Ik.height<window.innerHeight?requestAnimationFrame(()=>{t$(p)}):Ik.addEventListener("resize",()=>t$(p),{once:!0}))}))},i=()=>{window.scrollTo(0,0)},l=window.pageXOffset,u=window.pageYOffset,d=QM(jie(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let c=QM(qg(document,"touchstart",n,{passive:!1,capture:!0}),qg(document,"touchmove",r,{passive:!1,capture:!0}),qg(document,"touchend",a,{passive:!1,capture:!0}),qg(document,"focus",s,!0),qg(window,"scroll",i));return()=>{d(),c(),window.scrollTo(l,u)}}function jie(e,t,n){let r=e.style[t];return e.style[t]=n,()=>{e.style[t]=r}}function qg(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}function t$(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let n=Rz(e);if(n!==document.documentElement&&n!==document.body&&n!==e){let r=n.getBoundingClientRect().top,a=e.getBoundingClientRect().top,s=e.getBoundingClientRect().bottom;const i=n.getBoundingClientRect().bottom+Nie;s>i&&(n.scrollTop+=a-r)}e=n.parentElement}}function C2(e){return e instanceof HTMLInputElement&&!Iie.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function Aie(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Rie(...e){return t=>e.forEach(n=>Aie(n,t))}function Dz(...e){return k.useCallback(Rie(...e),e)}const Mz=new WeakMap;function la(e,t,n=!1){if(!e||!(e instanceof HTMLElement))return;let r={};Object.entries(t).forEach(([a,s])=>{if(a.startsWith("--")){e.style.setProperty(a,s);return}r[a]=e.style[a],e.style[a]=s}),!n&&Mz.set(e,r)}function Die(e,t){if(!e||!(e instanceof HTMLElement))return;let n=Mz.get(e);n&&(e.style[t]=n[t])}const ca=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function mv(e,t){if(!e)return null;const n=window.getComputedStyle(e),r=n.transform||n.webkitTransform||n.mozTransform;let a=r.match(/^matrix3d\((.+)\)$/);return a?parseFloat(a[1].split(", ")[ca(t)?13:12]):(a=r.match(/^matrix\((.+)\)$/),a?parseFloat(a[1].split(", ")[ca(t)?5:4]):null)}function Mie(e){return 8*(Math.log(e+1)-2)}function Ek(e,t){if(!e)return()=>{};const n=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=n}}function $ie(...e){return(...t)=>{for(const n of e)typeof n=="function"&&n(...t)}}const _r={DURATION:.5,EASE:[.32,.72,0,1]},$z=.4,Fie=.25,Pie=100,Fz=8,kc=16,_2=26,jk="vaul-dragging";function Pz(e){const t=ge.useRef(e);return ge.useEffect(()=>{t.current=e}),ge.useMemo(()=>(...n)=>t.current==null?void 0:t.current.call(t,...n),[])}function Oie({defaultProp:e,onChange:t}){const n=ge.useState(e),[r]=n,a=ge.useRef(r),s=Pz(t);return ge.useEffect(()=>{a.current!==r&&(s(r),a.current=r)},[r,a,s]),n}function Oz({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,a]=Oie({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,l=Pz(n),u=ge.useCallback(d=>{if(s){const h=typeof d=="function"?d(e):d;h!==e&&l(h)}else a(d)},[s,e,a,l]);return[i,u]}function Lie({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:n,drawerRef:r,overlayRef:a,fadeFromIndex:s,onSnapPointChange:i,direction:l="bottom",container:u,snapToSequentialPoint:d}){const[c,h]=Oz({prop:e,defaultProp:n==null?void 0:n[0],onChange:t}),[p,m]=ge.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);ge.useEffect(()=>{function C(){m({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",C),()=>window.removeEventListener("resize",C)},[]);const f=ge.useMemo(()=>c===(n==null?void 0:n[n.length-1])||null,[n,c]),g=ge.useMemo(()=>n==null?void 0:n.findIndex(C=>C===c),[n,c]),x=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===c||!n,y=ge.useMemo(()=>{const C=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var _;return(_=n==null?void 0:n.map(T=>{const E=typeof T=="string";let j=0;if(E&&(j=parseInt(T,10)),ca(l)){const D=E?j:p?T*C.height:0;return p?l==="bottom"?C.height-D:-C.height+D:D}const I=E?j:p?T*C.width:0;return p?l==="right"?C.width-I:-C.width+I:I}))!=null?_:[]},[n,p,u]),b=ge.useMemo(()=>g!==null?y==null?void 0:y[g]:null,[y,g]),v=ge.useCallback(C=>{var _;const T=(_=y==null?void 0:y.findIndex(E=>E===C))!=null?_:null;i(T),la(r.current,{transition:`transform ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,transform:ca(l)?`translate3d(0, ${C}px, 0)`:`translate3d(${C}px, 0, 0)`}),y&&T!==y.length-1&&T!==s&&T<s?la(a.current,{transition:`opacity ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,opacity:"0"}):la(a.current,{transition:`opacity ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,opacity:"1"}),h(n==null?void 0:n[Math.max(T,0)])},[r.current,n,y,s,a,h]);ge.useEffect(()=>{if(c||e){var C;const _=(C=n==null?void 0:n.findIndex(T=>T===e||T===c))!=null?C:-1;y&&_!==-1&&typeof y[_]=="number"&&v(y[_])}},[c,e,n,y,v]);function w({draggedDistance:C,closeDrawer:_,velocity:T,dismissible:E}){if(s===void 0)return;const j=l==="bottom"||l==="right"?(b??0)-C:(b??0)+C,I=g===s-1,D=g===0,F=C>0;if(I&&la(a.current,{transition:`opacity ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`}),!d&&T>2&&!F){E?_():v(y[0]);return}if(!d&&T>2&&F&&y&&n){v(y[n.length-1]);return}const P=y==null?void 0:y.reduce(($,O)=>typeof $!="number"||typeof O!="number"?$:Math.abs(O-j)<Math.abs($-j)?O:$),V=ca(l)?window.innerHeight:window.innerWidth;if(T>$z&&Math.abs(C)<V*.4){const $=F?1:-1;if($>0&&f){v(y[n.length-1]);return}if(D&&$<0&&E&&_(),g===null)return;v(y[g+$]);return}v(P)}function N({draggedDistance:C}){if(b===null)return;const _=l==="bottom"||l==="right"?b-C:b+C;(l==="bottom"||l==="right")&&_<y[y.length-1]||(l==="top"||l==="left")&&_>y[y.length-1]||la(r.current,{transform:ca(l)?`translate3d(0, ${_}px, 0)`:`translate3d(${_}px, 0, 0)`})}function S(C,_){if(!n||typeof g!="number"||!y||s===void 0)return null;const T=g===s-1;if(g>=s&&_)return 0;if(T&&!_)return 1;if(!x&&!T)return null;const j=T?g+1:g-1,I=T?y[j]-y[j-1]:y[j+1]-y[j],D=C/Math.abs(I);return T?1-D:D}return{isLastSnapPoint:f,activeSnapPoint:c,shouldFade:x,getPercentageDragged:S,setActiveSnapPoint:h,activeSnapPointIndex:g,onRelease:w,onDrag:N,snapPointsOffset:y}}const zie=()=>()=>{};function Bie(){const{direction:e,isOpen:t,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:a}=Ly(),s=ge.useRef(null),i=k.useMemo(()=>document.body.style.backgroundColor,[]);function l(){return(window.innerWidth-_2)/window.innerWidth}ge.useEffect(()=>{if(t&&n){s.current&&clearTimeout(s.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;$ie(r&&!a?Ek(document.body,{background:"black"}):zie,Ek(u,{transformOrigin:ca(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${_r.DURATION}s`,transitionTimingFunction:`cubic-bezier(${_r.EASE.join(",")})`}));const d=Ek(u,{borderRadius:`${Fz}px`,overflow:"hidden",...ca(e)?{transform:`scale(${l()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${l()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{d(),s.current=window.setTimeout(()=>{i?document.body.style.background=i:document.body.style.removeProperty("background")},_r.DURATION*1e3)}}},[t,n,i])}let Kg=null;function Wie({isOpen:e,modal:t,nested:n,hasBeenOpened:r,preventScrollRestoration:a,noBodyStyles:s}){const[i,l]=ge.useState(()=>typeof window<"u"?window.location.href:""),u=ge.useRef(0),d=ge.useCallback(()=>{if(JM()&&Kg===null&&e&&!s){Kg={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:h,innerHeight:p}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-h}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const m=p-window.innerHeight;m&&u.current>=p&&(document.body.style.top=`${-(u.current+m)}px`)}),300)}},[e]),c=ge.useCallback(()=>{if(JM()&&Kg!==null&&!s){const h=-parseInt(document.body.style.top,10),p=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Kg),window.requestAnimationFrame(()=>{if(a&&i!==window.location.href){l(window.location.href);return}window.scrollTo(p,h)}),Kg=null}},[i]);return ge.useEffect(()=>{function h(){u.current=window.scrollY}return h(),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[]),ge.useEffect(()=>{n||!r||(e?(!window.matchMedia("(display-mode: standalone)").matches&&d(),t||window.setTimeout(()=>{c()},500)):c())},[e,r,i,t,n,d,c]),{restorePositionSetting:c}}function Vie({open:e,onOpenChange:t,children:n,onDrag:r,onRelease:a,snapPoints:s,shouldScaleBackground:i=!1,setBackgroundColorOnScale:l=!0,closeThreshold:u=Fie,scrollLockTimeout:d=Pie,dismissible:c=!0,handleOnly:h=!1,fadeFromIndex:p=s&&s.length-1,activeSnapPoint:m,setActiveSnapPoint:f,fixed:g,modal:x=!0,onClose:y,nested:b,noBodyStyles:v,direction:w="bottom",defaultOpen:N=!1,disablePreventScroll:S=!0,snapToSequentialPoint:C=!1,preventScrollRestoration:_=!1,repositionInputs:T=!0,onAnimationEnd:E,container:j,autoFocus:I=!1}){var D,F;const[P=!1,V]=Oz({defaultProp:N,prop:e,onChange:bt=>{t==null||t(bt),!bt&&!b&&he(),setTimeout(()=>{E==null||E(bt)},_r.DURATION*1e3),bt&&!x&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),bt||(document.body.style.pointerEvents="auto")}}),[$,O]=ge.useState(!1),[L,q]=ge.useState(!1),[U,ee]=ge.useState(!1),M=ge.useRef(null),G=ge.useRef(null),J=ge.useRef(null),ve=ge.useRef(null),Q=ge.useRef(null),se=ge.useRef(!1),_e=ge.useRef(null),Le=ge.useRef(0),Se=ge.useRef(!1),ye=ge.useRef(0),Fe=ge.useRef(null),Te=ge.useRef(((D=Fe.current)==null?void 0:D.getBoundingClientRect().height)||0),Oe=ge.useRef(((F=Fe.current)==null?void 0:F.getBoundingClientRect().width)||0),He=ge.useRef(0),Ee=ge.useCallback(bt=>{s&&bt===ae.length-1&&(G.current=new Date)},[]),{activeSnapPoint:Re,activeSnapPointIndex:Ke,setActiveSnapPoint:at,onRelease:Y,snapPointsOffset:ae,onDrag:we,shouldFade:Ce,getPercentageDragged:Ne}=Lie({snapPoints:s,activeSnapPointProp:m,setActiveSnapPointProp:f,drawerRef:Fe,fadeFromIndex:p,overlayRef:M,onSnapPointChange:Ee,direction:w,container:j,snapToSequentialPoint:C});Tie({isDisabled:!P||L||!x||U||!$||!T||!S});const{restorePositionSetting:he}=Wie({isOpen:P,modal:x,nested:b,hasBeenOpened:$,preventScrollRestoration:_,noBodyStyles:v});function Ae(){return(window.innerWidth-_2)/window.innerWidth}function gt(bt){var Ot,Et;!c&&!s||Fe.current&&!Fe.current.contains(bt.target)||(Te.current=((Ot=Fe.current)==null?void 0:Ot.getBoundingClientRect().height)||0,Oe.current=((Et=Fe.current)==null?void 0:Et.getBoundingClientRect().width)||0,q(!0),J.current=new Date,Az()&&window.addEventListener("touchend",()=>se.current=!1,{once:!0}),bt.target.setPointerCapture(bt.pointerId),Le.current=ca(w)?bt.pageY:bt.pageX)}function ht(bt,Ot){var Et,Lt;let At=bt;const zt=(Et=window.getSelection())==null?void 0:Et.toString(),Sn=Fe.current?mv(Fe.current,w):null,ot=new Date;if(At.hasAttribute("data-vaul-no-drag")||At.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(G.current&&ot.getTime()-G.current.getTime()<500)return!1;if(Sn!==null&&(w==="bottom"?Sn>0:Sn<0))return!0;if(zt&&zt.length>0)return!1;if(ot.getTime()-((Lt=Q.current)==null?void 0:Lt.getTime())<d&&Sn===0||Ot)return Q.current=ot,!1;for(;At;){if(At.scrollHeight>At.clientHeight){if(At.scrollTop!==0)return Q.current=new Date,!1;if(At.getAttribute("role")==="dialog")return!0}At=At.parentNode}return!0}function Dt(bt){if(Fe.current&&L){const Ot=w==="bottom"||w==="right"?1:-1,Et=(Le.current-(ca(w)?bt.pageY:bt.pageX))*Ot,Lt=Et>0,At=s&&!c&&!Lt;if(At&&Ke===0)return;const zt=Math.abs(Et),Sn=document.querySelector("[data-vaul-drawer-wrapper]"),ot=w==="bottom"||w==="top"?Te.current:Oe.current;let pe=zt/ot;const Me=Ne(zt,Lt);if(Me!==null&&(pe=Me),At&&pe>=1||!se.current&&!ht(bt.target,Lt))return;if(Fe.current.classList.add(jk),se.current=!0,la(Fe.current,{transition:"none"}),la(M.current,{transition:"none"}),s&&we({draggedDistance:Et}),Lt&&!s){const ze=Mie(Et),Ft=Math.min(ze*-1,0)*Ot;la(Fe.current,{transform:ca(w)?`translate3d(0, ${Ft}px, 0)`:`translate3d(${Ft}px, 0, 0)`});return}const Je=1-pe;if((Ce||p&&Ke===p-1)&&(r==null||r(bt,pe),la(M.current,{opacity:`${Je}`,transition:"none"},!0)),Sn&&M.current&&i){const ze=Math.min(Ae()+pe*(1-Ae()),1),Ft=8-pe*8,Ht=Math.max(0,14-pe*14);la(Sn,{borderRadius:`${Ft}px`,transform:ca(w)?`scale(${ze}) translate3d(0, ${Ht}px, 0)`:`scale(${ze}) translate3d(${Ht}px, 0, 0)`,transition:"none"},!0)}if(!s){const ze=zt*Ot;la(Fe.current,{transform:ca(w)?`translate3d(0, ${ze}px, 0)`:`translate3d(${ze}px, 0, 0)`})}}}ge.useEffect(()=>{var bt;function Ot(){if(!Fe.current||!T)return;const Et=document.activeElement;if(C2(Et)||Se.current){var Lt;const At=((Lt=window.visualViewport)==null?void 0:Lt.height)||0,zt=window.innerHeight;let Sn=zt-At;const ot=Fe.current.getBoundingClientRect().height||0,pe=ot>zt*.8;He.current||(He.current=ot);const Me=Fe.current.getBoundingClientRect().top;if(Math.abs(ye.current-Sn)>60&&(Se.current=!Se.current),s&&s.length>0&&ae&&Ke){const Je=ae[Ke]||0;Sn+=Je}if(ye.current=Sn,ot>At||Se.current){const Je=Fe.current.getBoundingClientRect().height;let ze=Je;Je>At&&(ze=At-(pe?Me:_2)),g?Fe.current.style.height=`${Je-Math.max(Sn,0)}px`:Fe.current.style.height=`${Math.max(ze,At-Me)}px`}else Fe.current.style.height=`${He.current}px`;s&&s.length>0&&!Se.current?Fe.current.style.bottom="0px":Fe.current.style.bottom=`${Math.max(Sn,0)}px`}}return(bt=window.visualViewport)==null||bt.addEventListener("resize",Ot),()=>{var Et;return(Et=window.visualViewport)==null?void 0:Et.removeEventListener("resize",Ot)}},[Ke,s,ae]);function $t(bt){it(),y==null||y(),bt||V(!1),setTimeout(()=>{s&&at(s[0])},_r.DURATION*1e3)}function qe(){if(!Fe.current)return;const bt=document.querySelector("[data-vaul-drawer-wrapper]"),Ot=mv(Fe.current,w);la(Fe.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`}),la(M.current,{transition:`opacity ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,opacity:"1"}),i&&Ot&&Ot>0&&P&&la(bt,{borderRadius:`${Fz}px`,overflow:"hidden",...ca(w)?{transform:`scale(${Ae()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ae()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${_r.DURATION}s`,transitionTimingFunction:`cubic-bezier(${_r.EASE.join(",")})`},!0)}function it(){!L||!Fe.current||(Fe.current.classList.remove(jk),se.current=!1,q(!1),ve.current=new Date)}function Ct(bt){if(!L||!Fe.current)return;Fe.current.classList.remove(jk),se.current=!1,q(!1),ve.current=new Date;const Ot=mv(Fe.current,w);if(!ht(bt.target,!1)||!Ot||Number.isNaN(Ot)||J.current===null)return;const Et=ve.current.getTime()-J.current.getTime(),Lt=Le.current-(ca(w)?bt.pageY:bt.pageX),At=Math.abs(Lt)/Et;if(At>.05&&(ee(!0),setTimeout(()=>{ee(!1)},200)),s){Y({draggedDistance:Lt*(w==="bottom"||w==="right"?1:-1),closeDrawer:$t,velocity:At,dismissible:c}),a==null||a(bt,!0);return}if(w==="bottom"||w==="right"?Lt>0:Lt<0){qe(),a==null||a(bt,!0);return}if(At>$z){$t(),a==null||a(bt,!1);return}var zt;const Sn=Math.min((zt=Fe.current.getBoundingClientRect().height)!=null?zt:0,window.innerHeight);var ot;const pe=Math.min((ot=Fe.current.getBoundingClientRect().width)!=null?ot:0,window.innerWidth),Me=w==="left"||w==="right";if(Math.abs(Ot)>=(Me?pe:Sn)*u){$t(),a==null||a(bt,!1);return}a==null||a(bt,!0),qe()}ge.useEffect(()=>(P&&(la(document.documentElement,{scrollBehavior:"auto"}),G.current=new Date),()=>{Die(document.documentElement,"scrollBehavior")}),[P]);function pt(bt){const Ot=bt?(window.innerWidth-kc)/window.innerWidth:1,Et=bt?-kc:0;_e.current&&window.clearTimeout(_e.current),la(Fe.current,{transition:`transform ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,transform:`scale(${Ot}) translate3d(0, ${Et}px, 0)`}),!bt&&Fe.current&&(_e.current=setTimeout(()=>{const Lt=mv(Fe.current,w);la(Fe.current,{transition:"none",transform:ca(w)?`translate3d(0, ${Lt}px, 0)`:`translate3d(${Lt}px, 0, 0)`})},500))}function Ut(bt,Ot){if(Ot<0)return;const Et=(window.innerWidth-kc)/window.innerWidth,Lt=Et+Ot*(1-Et),At=-kc+Ot*kc;la(Fe.current,{transform:ca(w)?`scale(${Lt}) translate3d(0, ${At}px, 0)`:`scale(${Lt}) translate3d(${At}px, 0, 0)`,transition:"none"})}function Ln(bt,Ot){const Et=ca(w)?window.innerHeight:window.innerWidth,Lt=Ot?(Et-kc)/Et:1,At=Ot?-kc:0;Ot&&la(Fe.current,{transition:`transform ${_r.DURATION}s cubic-bezier(${_r.EASE.join(",")})`,transform:ca(w)?`scale(${Lt}) translate3d(0, ${At}px, 0)`:`scale(${Lt}) translate3d(${At}px, 0, 0)`})}return ge.createElement(n_,{defaultOpen:N,onOpenChange:bt=>{!c&&!bt||(bt?O(!0):$t(!0),V(bt))},open:P},ge.createElement(jz.Provider,{value:{activeSnapPoint:Re,snapPoints:s,setActiveSnapPoint:at,drawerRef:Fe,overlayRef:M,onOpenChange:t,onPress:gt,onRelease:Ct,onDrag:Dt,dismissible:c,handleOnly:h,isOpen:P,isDragging:L,shouldFade:Ce,closeDrawer:$t,onNestedDrag:Ut,onNestedOpenChange:pt,onNestedRelease:Ln,keyboardIsOpen:Se,modal:x,snapPointsOffset:ae,direction:w,shouldScaleBackground:i,setBackgroundColorOnScale:l,noBodyStyles:v,container:j,autoFocus:I}},n))}const Lz=ge.forwardRef(function({...e},t){const{overlayRef:n,snapPoints:r,onRelease:a,shouldFade:s,isOpen:i,modal:l}=Ly(),u=Dz(t,n),d=r&&r.length>0;return l?ge.createElement(R0,{onMouseUp:a,ref:u,"data-vaul-overlay":"","data-vaul-snap-points":i&&d?"true":"false","data-vaul-snap-points-overlay":i&&s?"true":"false",...e}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});Lz.displayName="Drawer.Overlay";const zz=ge.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:n,...r},a){const{drawerRef:s,onPress:i,onRelease:l,onDrag:u,keyboardIsOpen:d,snapPointsOffset:c,modal:h,isOpen:p,direction:m,snapPoints:f,container:g,handleOnly:x,autoFocus:y}=Ly(),[b,v]=ge.useState(!1),w=Dz(a,s),N=ge.useRef(null),S=ge.useRef(null),C=ge.useRef(!1),_=f&&f.length>0;Bie();const T=(j,I,D=0)=>{if(C.current)return!0;const F=Math.abs(j.y),P=Math.abs(j.x),V=P>F,$=["bottom","right"].includes(I)?1:-1;if(I==="left"||I==="right"){if(!(j.x*$<0)&&P>=0&&P<=D)return V}else if(!(j.y*$<0)&&F>=0&&F<=D)return!V;return C.current=!0,!0};ge.useEffect(()=>{_&&window.requestAnimationFrame(()=>{v(!0)})},[]);function E(j){N.current=null,C.current=!1,l(j)}return ge.createElement(D0,{"data-vaul-drawer-direction":m,"data-vaul-drawer":"","data-vaul-delayed-snap-points":b?"true":"false","data-vaul-snap-points":p&&_?"true":"false","data-vaul-custom-container":g?"true":"false",...r,ref:w,style:c&&c.length>0?{"--snap-point-height":`${c[0]}px`,...t}:t,onPointerDown:j=>{x||(r.onPointerDown==null||r.onPointerDown.call(r,j),N.current={x:j.pageX,y:j.pageY},i(j))},onOpenAutoFocus:j=>{n==null||n(j),y||j.preventDefault()},onPointerDownOutside:j=>{if(e==null||e(j),!h||j.defaultPrevented){j.preventDefault();return}d.current&&(d.current=!1)},onFocusOutside:j=>{if(!h){j.preventDefault();return}},onPointerMove:j=>{if(S.current=j,x||(r.onPointerMove==null||r.onPointerMove.call(r,j),!N.current))return;const I=j.pageY-N.current.y,D=j.pageX-N.current.x,F=j.pointerType==="touch"?10:2;T({x:D,y:I},m,F)?u(j):(Math.abs(D)>F||Math.abs(I)>F)&&(N.current=null)},onPointerUp:j=>{r.onPointerUp==null||r.onPointerUp.call(r,j),N.current=null,C.current=!1,l(j)},onPointerOut:j=>{r.onPointerOut==null||r.onPointerOut.call(r,j),E(S.current)},onContextMenu:j=>{r.onContextMenu==null||r.onContextMenu.call(r,j),E(S.current)}})});zz.displayName="Drawer.Content";const Uie=250,Hie=120,Gie=ge.forwardRef(function({preventCycle:e=!1,children:t,...n},r){const{closeDrawer:a,isDragging:s,snapPoints:i,activeSnapPoint:l,setActiveSnapPoint:u,dismissible:d,handleOnly:c,isOpen:h,onPress:p,onDrag:m}=Ly(),f=ge.useRef(null),g=ge.useRef(!1);function x(){if(g.current){v();return}window.setTimeout(()=>{y()},Hie)}function y(){if(s||e||g.current){v();return}if(v(),(!i||i.length===0)&&d){a();return}if(l===i[i.length-1]&&d){a();return}const N=i.findIndex(C=>C===l);if(N===-1)return;const S=i[N+1];u(S)}function b(){f.current=window.setTimeout(()=>{g.current=!0},Uie)}function v(){window.clearTimeout(f.current),g.current=!1}return ge.createElement("div",{onClick:x,onPointerCancel:v,onPointerDown:w=>{c&&p(w),b()},onPointerMove:w=>{c&&m(w)},ref:r,"data-vaul-drawer-visible":h?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},ge.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});Gie.displayName="Drawer.Handle";function qie(e){const t=Ly(),{container:n=t.container,...r}=e;return ge.createElement(e_,{container:n,...r})}const Ml={Root:Vie,Content:zz,Overlay:Lz,Portal:qie,Title:M0,Description:$0},yI=({shouldScaleBackground:e=!0,...t})=>o.jsx(Ml.Root,{shouldScaleBackground:e,...t});yI.displayName="Drawer";const Kie=Ml.Portal,Bz=k.forwardRef(({className:e,...t},n)=>o.jsx(Ml.Overlay,{ref:n,className:Ie("fixed inset-0 z-50 bg-black/80",e),...t}));Bz.displayName=Ml.Overlay.displayName;const bI=k.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(Kie,{children:[o.jsx(Bz,{}),o.jsxs(Ml.Content,{ref:r,className:Ie("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",e),...n,children:[o.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));bI.displayName="DrawerContent";const vI=({className:e,...t})=>o.jsx("div",{className:Ie("grid gap-1.5 p-4 text-center sm:text-left",e),...t});vI.displayName="DrawerHeader";const Wz=k.forwardRef(({className:e,...t},n)=>o.jsx(Ml.Title,{ref:n,className:Ie("text-lg font-semibold leading-none tracking-tight",e),...t}));Wz.displayName=Ml.Title.displayName;const Yie=k.forwardRef(({className:e,...t},n)=>o.jsx(Ml.Description,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));Yie.displayName=Ml.Description.displayName;const Ak=768;function Xie(){const[e,t]=k.useState(void 0);return k.useEffect(()=>{const n=window.matchMedia(`(max-width: ${Ak-1}px)`),r=()=>{t(window.innerWidth<Ak)};return n.addEventListener("change",r),t(window.innerWidth<Ak),()=>n.removeEventListener("change",r)},[]),!!e}function Zie({open:e,onOpenChange:t,ownerName:n,ownerPhotoUrl:r,onSubmit:a,onSkip:s}){const i=Xie(),l=k.useRef(null),[u,d]=k.useState(!1),[c,h]=k.useState("idle"),[p,m]=k.useState(!1),[f,g]=k.useState({firstName:"",lastName:"",email:"",phone:"",designation:"",company:"",linkedin:""}),x=C=>{let _=C.trim();return _?(_=_.replace(/^https?:\/\//,""),_.includes("linkedin.com")?`https://${_}`:`https://linkedin.com/in/${_}`):""},y=async()=>{if(!f.firstName.trim()){oe({title:"First name is required",variant:"destructive"});return}d(!0);try{await a(f),t(!1),g({firstName:"",lastName:"",email:"",phone:"",designation:"",company:"",linkedin:""}),m(!1)}catch(C){console.error("Submit error:",C)}finally{d(!1)}},b=()=>{s(),t(!1)},v=()=>{var C;(C=l.current)==null||C.click()},w=async C=>{var T;const _=(T=C.target.files)==null?void 0:T[0];if(_){h("uploading");try{const[{fileToOptimizedBase64:E}]=await Promise.all([Qu(()=>Promise.resolve().then(()=>Z7e),void 0)]);h("processing");const j=await E(_),{data:I,error:D}=await le.functions.invoke("scan-business-card",{body:{image:j}});if(D)throw D;if(I!=null&&I.success&&(I!=null&&I.contact)){const F=I.contact,P=(F.name||"").split(" "),V=P[0]||"",$=P.slice(1).join(" ")||"";h("success"),g(O=>({firstName:V||O.firstName,lastName:$||O.lastName,email:F.email||O.email,phone:F.phone||O.phone,designation:F.designation||O.designation,company:F.company||O.company})),oe({title:"Card scanned!",description:"Details filled in. Please review."}),setTimeout(()=>h("idle"),2e3)}else h("failed"),oe({title:"Couldn't read card",description:"Please enter details manually.",variant:"destructive"}),setTimeout(()=>h("idle"),2e3)}catch(E){console.error("Scan error:",E),h("failed"),oe({title:"Scan failed",description:"Please enter details manually.",variant:"destructive"}),setTimeout(()=>h("idle"),2e3)}C.target.value=""}},N=()=>{switch(c){case"uploading":case"processing":return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-muted-foreground border-t-transparent rounded-full animate-spin"}),o.jsx("span",{className:"text-sm text-muted-foreground",children:c==="uploading"?"Uploading...":"Reading..."})]});case"success":return o.jsxs(o.Fragment,{children:[o.jsx(an,{className:"h-4 w-4 text-primary"}),o.jsx("span",{className:"text-sm text-primary",children:"Scanned!"})]});case"failed":return o.jsxs(o.Fragment,{children:[o.jsx(em,{className:"h-4 w-4 text-destructive"}),o.jsx("span",{className:"text-sm text-destructive",children:"Try again"})]});default:return o.jsxs(o.Fragment,{children:[o.jsx(em,{className:"h-4 w-4 text-muted-foreground"}),o.jsx("span",{className:"text-sm text-muted-foreground",children:"Scan business card"})]})}},S=o.jsxs("div",{className:"space-y-5",children:[o.jsx("input",{ref:l,type:"file",accept:"image/*",capture:"environment",onChange:w,className:"hidden"}),o.jsx("button",{type:"button",onClick:v,disabled:c==="uploading"||c==="processing",className:"w-full flex items-center justify-center gap-2 py-3 px-4 rounded-xl border border-dashed border-border hover:border-primary/50 hover:bg-muted/30 transition-all disabled:opacity-50",children:N()}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(We,{className:"text-xs text-muted-foreground",children:"First name *"}),o.jsx(Ge,{value:f.firstName,onChange:C=>g(_=>({..._,firstName:C.target.value})),placeholder:"First name",className:"h-11"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(We,{className:"text-xs text-muted-foreground",children:"Last name"}),o.jsx(Ge,{value:f.lastName,onChange:C=>g(_=>({..._,lastName:C.target.value})),placeholder:"Last name",className:"h-11"})]})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(We,{className:"text-xs text-muted-foreground",children:"Email"}),o.jsx(Ge,{type:"email",value:f.email,onChange:C=>g(_=>({..._,email:C.target.value})),placeholder:"your@email.com",className:"h-11"})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx(We,{className:"text-xs text-muted-foreground",children:"Phone"}),o.jsx(Ge,{value:f.phone,onChange:C=>g(_=>({..._,phone:C.target.value})),placeholder:"+1 234 567 890",className:"h-11"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx(Ge,{value:f.designation,onChange:C=>g(_=>({..._,designation:C.target.value})),placeholder:"Job title",className:"h-11"}),o.jsx(Ge,{value:f.company,onChange:C=>g(_=>({..._,company:C.target.value})),placeholder:"Organization / Brand",className:"h-11"})]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("button",{type:"button",onClick:()=>m(!p),className:"flex items-center gap-1 text-[11px] text-muted-foreground hover:text-foreground transition-colors",children:[o.jsx(qs,{className:`h-3 w-3 transition-transform ${p?"rotate-45":""}`}),o.jsx("span",{children:"LinkedIn"})]}),o.jsx("p",{className:"text-[11px] text-muted-foreground/70",children:"We don't sell your contact details"})]}),p&&o.jsxs("div",{className:"space-y-2 p-3 rounded-xl bg-muted/10 border border-border/30 transition-all duration-200",children:[o.jsx("label",{className:"text-xs text-muted-foreground",children:"LinkedIn profile"}),o.jsx(Ge,{value:f.linkedin||"",onChange:C=>g(_=>({..._,linkedin:C.target.value})),onBlur:C=>g(_=>({..._,linkedin:x(C.target.value)})),placeholder:"linkedin.com/in/yourname",className:"h-10"})]}),o.jsx(fe,{onClick:y,variant:"gradient",className:"w-full h-12 text-base font-medium",disabled:u,children:u?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin mr-2"}),"Sending..."]}):o.jsxs(o.Fragment,{children:[o.jsx(M3,{className:"h-4 w-4 mr-2"}),"Send"]})})]});return i?o.jsx(yI,{open:e,onOpenChange:t,children:o.jsxs(bI,{className:"max-h-[90dvh]",children:[o.jsxs(vI,{className:"relative px-4 py-3 border-b border-border/30",children:[o.jsx("button",{onClick:b,className:"absolute right-4 top-3 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Skip"}),o.jsxs("div",{className:"flex items-center gap-3 pr-12 min-w-0",children:[r&&o.jsx("img",{src:r,alt:n,className:"w-9 h-9 rounded-full object-cover flex-shrink-0"}),o.jsxs("p",{className:"text-sm font-medium text-foreground whitespace-nowrap truncate",children:["Share your contact with ",n]})]})]}),o.jsx("div",{className:"px-5 pt-4 pb-5 overflow-y-auto",children:S})]})}):o.jsx(gn,{open:e,onOpenChange:t,children:o.jsxs(cn,{className:"sm:max-w-md",hideCloseButton:!0,children:[o.jsxs(dn,{className:"relative px-4 py-3 border-b border-border/30",children:[o.jsx("button",{onClick:b,className:"absolute right-4 top-3 text-sm text-muted-foreground hover:text-foreground transition-colors",children:"Skip"}),o.jsxs("div",{className:"flex items-center gap-3",children:[r&&o.jsx("img",{src:r,alt:n,className:"w-9 h-9 rounded-full object-cover"}),o.jsxs("div",{className:"leading-tight",children:[o.jsx(hn,{className:"text-sm font-medium",children:"Share your contact"}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:["with ",n]})]})]})]}),o.jsx("div",{className:"pt-2",children:S})]})})}const Qie=e=>`https://wa.me/${e.replace(/[^0-9+]/g,"").replace("+","")}`,Yg=({icon:e,label:t,value:n,href:r,iconClass:a})=>o.jsxs("a",{href:r,target:r.startsWith("http")?"_blank":void 0,rel:r.startsWith("http")?"noopener noreferrer":void 0,className:"group flex items-center gap-3 p-3 rounded-xl hover:bg-muted/50 transition-colors",children:[o.jsx("div",{className:Ie("w-10 h-10 rounded-full bg-muted flex items-center justify-center transition-colors",a),children:o.jsx(e,{className:"h-5 w-5 text-foreground/70 group-hover:text-foreground transition-colors"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-xs text-muted-foreground",children:t}),o.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:n})]})]});function Jie(){const{slug:e}=x3(),[t]=QK(),{user:n,loading:r}=ir(),[a,s]=k.useState(null),[i,l]=k.useState(null),[u,d]=k.useState(null),[c,h]=k.useState(null),[p,m]=k.useState(!0),[f,g]=k.useState(!1),[x,y]=k.useState(!1),[b,v]=k.useState(!1),[w,N]=k.useState(!1),[S,C]=k.useState(!1),[_,T]=k.useState(!1),[E,j]=k.useState(!1),I=!!n&&!r,D=n&&a&&n.id===a.user_id;k.useEffect(()=>{e&&F()},[e]),k.useEffect(()=>{(async()=>{if(!n){d(null);return}const{data:G}=await le.from("cards").select("*").eq("user_id",n.id).eq("is_default",!0).maybeSingle();d(G)})()},[n]),k.useEffect(()=>{if(!a||f)return;(async()=>{const G=t.get("src")==="nfc"?"nfc":"qr",J=new Date,{data:ve}=await le.from("events").select("id, start_time, end_time").eq("user_id",a.user_id);let Q=null;if(ve&&ve.length>0){const se=ve.filter(_e=>{const Le=new Date(_e.start_time),Se=_e.end_time?new Date(_e.end_time):Le;return J>=Le&&J<=Se});Q=se.length>0?se[0].id:null}h(Q),rie(a.user_id,(i==null?void 0:i.id)||null,G,Q),g(!0)})()},[a,i,f,t]);const F=async()=>{if(!e)return;m(!0);const M=await lQ(e);s(M);const G=await ZZ(e);l(G),m(!1)},P=i?{name:i.full_name||(a==null?void 0:a.name)||"",designation:i.designation||(a==null?void 0:a.designation)||"",company:i.company||(a==null?void 0:a.company)||"",phone:i.phone||(a==null?void 0:a.phone)||"",email:i.email||(a==null?void 0:a.email)||"",website:i.website||(a==null?void 0:a.website)||"",whatsapp:i.whatsapp||(a==null?void 0:a.whatsapp)||"",linkedin:(i==null?void 0:i.linkedin)||"",about:i.about||(a==null?void 0:a.about)||"",photo_url:i.photo_url||(a==null?void 0:a.photo_url)||"",logo_url:i.logo_url||(a==null?void 0:a.logo_url)||""}:a?{name:a.name||"",designation:a.designation||"",company:a.company||"",phone:a.phone||"",email:a.email||"",website:a.website||"",whatsapp:a.whatsapp||"",linkedin:a.linkedin||"",about:a.about||"",photo_url:a.photo_url||"",logo_url:a.logo_url||""}:null,V=async()=>{var G,J,ve,Q,se,_e,Le,Se;if(!n||!a||!i){oe({title:"Unable to save",description:"Please sign in to save this contact.",variant:"destructive"});return}if(D){oe({title:"That's your own card!",description:"You cannot exchange with yourself."});return}const M={name:(u==null?void 0:u.full_name)||((G=n.user_metadata)==null?void 0:G.name)||((J=n.email)==null?void 0:J.split("@")[0])||"Synka User",email:(u==null?void 0:u.email)||n.email,phone:(u==null?void 0:u.phone)||((ve=n.user_metadata)==null?void 0:ve.phone)||"",whatsapp:(u==null?void 0:u.whatsapp)||(u==null?void 0:u.phone)||((Q=n.user_metadata)==null?void 0:Q.phone)||"",company:(u==null?void 0:u.company)||((se=n.user_metadata)==null?void 0:se.company)||"",designation:(u==null?void 0:u.designation)||((_e=n.user_metadata)==null?void 0:_e.designation)||"",linkedin:(u==null?void 0:u.linkedin)||"",website:(u==null?void 0:u.website)||"",about:(u==null?void 0:u.about)||"",photo_url:(u==null?void 0:u.photo_url)||"",logo_url:(u==null?void 0:u.logo_url)||""};v(!0),(Le=navigator.vibrate)==null||Le.call(navigator,[10,50,10]);try{const Fe=await(async Re=>{const{data:Ke}=await le.from("tags").select("id").eq("user_id",Re).eq("name","Synka Exchange").maybeSingle();if(Ke)return Ke.id;const{data:at}=await le.from("tags").insert({user_id:Re,name:"Synka Exchange",color:"#10B981"}).select("id").single();return at==null?void 0:at.id})(n.id),{data:Te}=await le.from("contacts").select("id, notes_history").eq("owner_id",n.id).eq("email",i.email).maybeSingle();let Oe=Te==null?void 0:Te.id;if(Te){const{data:Re}=await le.from("contacts").update({name:i.full_name||(P==null?void 0:P.name)||"Unknown",company:i.company,designation:i.designation,phone:i.phone,whatsapp:i.whatsapp,linkedin:i.linkedin,website:i.website,photo_url:i.photo_url||(P==null?void 0:P.photo_url)||null,about:i.about||(P==null?void 0:P.about)||null,synka_user_id:a.user_id,shared_card_id:i.id,source:"synka_exchange",updated_at:new Date().toISOString(),notes_history:[...Te.notes_history||[],{text:"Updated via Synka Exchange",timestamp:new Date().toISOString()}]}).eq("id",Te.id).select("id").single();Oe=Re==null?void 0:Re.id}else{const{data:Re}=await le.from("contacts").insert({owner_id:n.id,email:i.email,name:i.full_name||(P==null?void 0:P.name)||"Unknown",company:i.company,designation:i.designation,phone:i.phone,whatsapp:i.whatsapp,linkedin:i.linkedin,website:i.website,photo_url:i.photo_url||(P==null?void 0:P.photo_url)||null,about:i.about||(P==null?void 0:P.about)||null,synka_user_id:a.user_id,shared_card_id:i.id,source:"synka_exchange",notes_history:[{text:"Connected via Synka Exchange",timestamp:new Date().toISOString()}]}).select("id").single();Oe=Re==null?void 0:Re.id}Oe&&Fe&&await le.from("contact_tags").upsert({contact_id:Oe,tag_id:Fe},{onConflict:"contact_id,tag_id"});const{data:He,error:Ee}=await le.rpc("mutual_exchange_contact",{p_owner_id:a.user_id,p_viewer_id:n.id,p_viewer_email:M.email,p_viewer_name:M.name,p_viewer_phone:M.phone||null,p_viewer_whatsapp:M.whatsapp||null,p_viewer_company:M.company||null,p_viewer_designation:M.designation||null,p_viewer_linkedin:M.linkedin||null,p_viewer_website:M.website||null,p_viewer_photo_url:M.photo_url||null,p_viewer_about:M.about||null,p_viewer_synka_user_id:n.id,p_viewer_shared_card_id:(u==null?void 0:u.id)||null});if(Ee)throw console.error("Mutual exchange error:",Ee),new Error("Failed to save your contact to owner's CRM");console.log("Mutual exchange result:",He),N(!0),await KM(a.user_id,(i==null?void 0:i.id)||null),y(!0),(Se=navigator.vibrate)==null||Se.call(navigator,10),oe({title:"Connected!",description:"Contacts exchanged and updated successfully."})}catch(ye){console.error("Exchange error:",ye),oe({title:"Save failed",description:"Something went wrong. Please try again.",variant:"destructive"})}finally{v(!1)}},$=async M=>{if(!a)return;const G={name:`${M.firstName} ${M.lastName}`.trim(),company:M.company,designation:M.designation,email:M.email,phone:M.phone,whatsapp:M.phone,linkedin:M.linkedin||""},{error:J}=await nie(a.user_id,G);if(J)throw oe({title:"Error",description:"Failed to submit your contact. Please try again.",variant:"destructive"}),J;T(!0),L(),oe({title:"Contact shared!",description:`Your contact has been sent to ${P==null?void 0:P.name}.`})},O=()=>{L()},L=()=>{j(!0)},q=async()=>{var Q;if((Q=navigator.vibrate)==null||Q.call(navigator,10),!P||!a)return;await KM(a.user_id,(i==null?void 0:i.id)||null);const M=`BEGIN:VCARD
VERSION:3.0
FN:${P.name}
ORG:${P.company}
TITLE:${P.designation}
TEL;TYPE=CELL:${P.phone}
EMAIL:${P.email}
URL:${P.website?`https://${P.website}`:""}
NOTE:${P.about}
END:VCARD`,G=new Blob([M],{type:"text/vcard"}),J=URL.createObjectURL(G),ve=document.createElement("a");ve.href=J,ve.download=`${P.name.replace(/\s+/g,"_")}.vcf`,ve.click(),URL.revokeObjectURL(J),C(!0)},U=async()=>{var G;if((G=navigator.vibrate)==null||G.call(navigator,10),!P||!e)return;const M=tz(e);if(Yt.isNativePlatform())try{await sd.share({url:M});return}catch(J){console.error("Native share error:",J)}if(navigator.share)try{await navigator.share({url:M});return}catch(J){J instanceof Error&&J.name!=="AbortError"&&console.log("Share failed:",J)}try{await navigator.clipboard.writeText(M),oe({title:"Link copied!",description:"Card link copied to clipboard."})}catch{oe({title:"Share this link:",description:M,variant:"default"})}};if(p||r)return o.jsx("div",{className:"min-h-dvh w-full flex items-center justify-center bg-background pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:o.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})});if(!P||!P.name)return o.jsxs("div",{className:"min-h-dvh w-full flex flex-col items-center justify-center bg-background p-4 sm:p-6 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Card not found"}),o.jsx("p",{className:"text-muted-foreground mb-6",children:"This card doesn't exist or has been removed."}),o.jsx(Va,{to:"/",children:o.jsx(fe,{variant:"gradient",children:"Go to Synka"})})]});const ee=P.name.split(" ")[0];return x?o.jsx("div",{className:"min-h-dvh w-full flex flex-col items-center justify-center bg-background p-4 sm:p-6 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:o.jsxs("div",{className:"w-full max-w-md text-center space-y-6 animate-fade-up",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(an,{className:"h-10 w-10 text-primary"})}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground",children:w?"Connected on Synka!":"Contact Saved!"}),o.jsxs("p",{className:"text-muted-foreground",children:[P.name,"'s contact is saved to your CRM.",w?o.jsxs(o.Fragment,{children:[o.jsx("br",{}),"Your card has been shared back."]}):o.jsxs(o.Fragment,{children:[o.jsx("br",{}),o.jsx("span",{className:"text-sm",children:"Set a default card to auto-share next time."})]})]})]}),o.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[o.jsx(Va,{to:"/crm",children:o.jsxs(fe,{variant:"gradient",className:"w-full",children:[o.jsx(bl,{className:"h-4 w-4 mr-2"}),"View Contact"]})}),!w&&o.jsx(Va,{to:"/my-card",children:o.jsx(fe,{variant:"outline",className:"w-full",children:"Set Up Default Card"})}),w&&o.jsx(Va,{to:"/my-card",children:o.jsx(fe,{variant:"outline",className:"w-full",children:"Open My Card"})})]})]})}):o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background pt-[env(safe-area-inset-top)] pb-[calc(5rem+env(safe-area-inset-bottom))]",children:[o.jsx(sie,{slug:e}),o.jsx(Zie,{open:S,onOpenChange:C,ownerName:ee,ownerPhotoUrl:P.photo_url,onSubmit:$,onSkip:O}),o.jsxs("div",{className:"w-full max-w-lg mx-auto py-4 sm:py-6 px-3 sm:px-4 space-y-4 sm:space-y-6 animate-fade-up",children:[o.jsxs("div",{className:"bg-card/95 backdrop-blur-xl rounded-3xl border border-border/40 shadow-[0_20px_40px_rgba(0,0,0,0.06)] overflow-hidden",children:[o.jsxs("div",{className:"relative pb-4 flex flex-col items-center",children:[o.jsx(mI,{layout:(i==null?void 0:i.layout)||"photo-logo",photoUrl:P.photo_url,logoUrl:P.logo_url,name:P.name,designation:P.designation,company:P.company,themeColor:i==null?void 0:i.card_design,faceX:i==null?void 0:i.face_x,faceY:i==null?void 0:i.face_y,logoX:i==null?void 0:i.logo_x,logoY:i==null?void 0:i.logo_y}),o.jsxs("div",{className:"text-center mt-4 space-y-1",children:[o.jsx("h2",{className:"text-[22px] font-semibold tracking-tight text-foreground",children:P.name}),P.designation&&o.jsx("p",{className:"text-[14.5px] font-normal text-muted-foreground leading-tight",children:P.designation}),P.company&&o.jsx("p",{className:"text-[13.5px] text-muted-foreground/70 leading-tight",children:P.company})]})]}),o.jsx("div",{className:"mx-6 h-px bg-gradient-to-r from-transparent via-border/40 to-transparent"}),o.jsxs("div",{className:"p-6 space-y-2",children:[P.phone&&o.jsx(Yg,{icon:Ry,label:"Mobile",value:P.phone,href:`tel:${P.phone}`}),P.email&&o.jsx(Yg,{icon:xi,label:"Email",value:P.email,href:`mailto:${P.email}`}),P.website&&o.jsx(Yg,{icon:z0,label:"Website",value:"Visit Website",href:`https://${P.website}`}),P.whatsapp&&o.jsx(Yg,{icon:pI,label:"WhatsApp",value:"Connect on WhatsApp",href:Qie(P.whatsapp),iconClass:"text-foreground/80 group-hover:text-[#25D366]"}),o.jsx(S2,{documentName:(i==null?void 0:i.document_name)||null,documentUrl:(i==null?void 0:i.document_url)||null}),P.linkedin&&o.jsx(Yg,{icon:i_,label:"LinkedIn",value:"Connect on LinkedIn",href:`https://linkedin.com/in/${P.linkedin}`,iconClass:"text-foreground/80 group-hover:text-blue-600"}),(i==null?void 0:i.instagram)&&o.jsx(Io,{platform:"instagram",url:i.instagram}),(i==null?void 0:i.youtube)&&o.jsx(Io,{platform:"youtube",url:i.youtube}),(i==null?void 0:i.twitter)&&o.jsx(Io,{platform:"twitter",url:i.twitter}),(i==null?void 0:i.facebook)&&o.jsx(Io,{platform:"facebook",url:i.facebook}),(i==null?void 0:i.calendly)&&o.jsx(Io,{platform:"calendly",url:i.calendly})]}),o.jsxs("div",{className:"px-6 pb-6",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[I&&!D?o.jsx(fe,{variant:"gradient",className:"flex-1 h-12 font-medium tracking-tight",onClick:V,disabled:b,children:b?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):o.jsxs(o.Fragment,{children:[o.jsx(RY,{className:"h-4 w-4 mr-2"}),"Save to My Synka"]})}):D?o.jsxs(fe,{variant:"gradient",className:"flex-1 h-12 font-medium tracking-tight",onClick:q,children:[o.jsx(km,{className:"h-4 w-4 mr-2"}),"Save Contact"]}):o.jsxs(fe,{variant:"gradient",className:"flex-1 h-12 font-medium tracking-tight",onClick:q,children:[o.jsx(km,{className:"h-4 w-4 mr-2"}),"Save Contact"]}),o.jsx("button",{onClick:U,className:"h-12 w-12 flex-shrink-0 rounded-full border border-border/60 bg-background hover:bg-muted/50 flex items-center justify-center transition-all active:scale-95","aria-label":"Share card",children:o.jsx(F3,{className:"h-5 w-5 text-foreground/70"})})]}),I&&!D&&o.jsx("p",{className:"text-[11px] text-muted-foreground text-center mt-2",children:"Saves to your CRM and shares your card back"})]})]}),P.about&&o.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40",children:[o.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"About"}),o.jsx("p",{className:"text-muted-foreground text-sm whitespace-pre-line",children:P.about})]}),E&&!I&&o.jsx("div",{className:"text-center py-3",children:o.jsxs(Va,{to:"/signup",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[o.jsx(Hs,{className:"h-4 w-4 animate-pulse text-primary/70"}),"Create your free Synka card"]})}),D&&o.jsx("div",{className:"text-center py-4",children:o.jsx(Va,{to:"/my-card",children:o.jsx(fe,{variant:"outline",className:"w-full active:scale-[0.97] transition-transform",children:"Edit My Card"})})})]}),o.jsx(ese,{path:`/u/${e}`})]})}function eoe(){const e=za(),n=Rl().state,{sendOtp:r,verifyOtp:a,setPin:s,checkPinExists:i,signInWithGoogle:l,signInWithLinkedIn:u}=ir(),[d,c]=k.useState(!1),[h,p]=k.useState(null),[m,f]=k.useState(""),[g,x]=k.useState(""),[y,b]=k.useState((n==null?void 0:n.email)||""),[v,w]=k.useState(""),[N,S]=k.useState(""),[C,_]=k.useState(""),[T,E]=k.useState("details"),j=async()=>{p("google");const{error:L}=await l();L&&(p(null),oe({title:"Error",description:L.message||"Failed to sign up with Google.",variant:"destructive"}))},I=async()=>{p("linkedin");const{error:L}=await u();L&&(p(null),oe({title:"Error",description:L.message||"Failed to sign up with LinkedIn.",variant:"destructive"}))},D=async L=>{const{data:q,error:U}=await le.from("profiles").select("email").eq("email",L.toLowerCase().trim()).maybeSingle();return!U&&q!==null},F=L=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(L.trim()),P=L=>{const q=L.trim().replace(/[^\d+]/g,"");if(!q)return null;const U=q.replace(/\D/g,"");return q.startsWith("+")?U.length>=10?q:null:U.length>=10?`+91${U}`:null},V=async L=>{L.preventDefault();const q=m.trim(),U=y.trim().toLowerCase(),ee=g.trim();if(!q){oe({title:"Name required",description:"Please enter your full name.",variant:"destructive"});return}if(!U){oe({title:"Email required",description:"Please enter your email address.",variant:"destructive"});return}if(!F(U)){oe({title:"Invalid email",description:"Please enter a valid email address.",variant:"destructive"});return}if(!ee){oe({title:"Mobile required",description:"Please enter your mobile number.",variant:"destructive"});return}const M=P(ee);if(!M){oe({title:"Invalid mobile number",description:"Please enter a valid phone number.",variant:"destructive"});return}if(x(M),c(!0),await D(U)){c(!1),oe({title:"Account already exists",description:"This email is already registered. Redirecting to login...",variant:"destructive"}),setTimeout(()=>{e("/login",{state:{email:U}})},1500);return}const{error:J}=await r(U);c(!1),J?oe({title:"Error",description:J.message||"Failed to send verification code.",variant:"destructive"}):(E("otp"),oe({title:"Verification code sent!",description:"Check your email for the OTP to verify your account."}))},$=async L=>{if(L.preventDefault(),v.length!==6){oe({title:"Invalid code",description:"Please enter the 6-digit verification code.",variant:"destructive"});return}c(!0);const{error:q}=await a(y,v);if(c(!1),q)oe({title:"Error",description:q.message||"Invalid OTP. Please try again.",variant:"destructive"});else{const{data:{user:U}}=await le.auth.getUser();if(U){const ee=m.trim(),M=g.trim();await le.auth.updateUser({data:{name:ee,phone:M}}),await le.from("profiles").update({full_name:ee,phone:M}).eq("user_id",U.id);const{data:G}=await le.from("cards").select("id, name").eq("user_id",U.id).eq("is_default",!0).maybeSingle();G?await le.from("cards").update({name:"My Card",full_name:ee,email:y.trim().toLowerCase(),phone:M,whatsapp:M}).eq("id",G.id):await le.from("cards").insert({user_id:U.id,name:"My Card",is_default:!0,layout:"dark-professional",full_name:ee,email:y.trim().toLowerCase(),phone:M,whatsapp:M});try{await le.auth.refreshSession()}catch{}}E("set_pin"),oe({title:"Email verified!",description:"Now set up your 4-digit PIN for quick login."})}},O=async L=>{if(L.preventDefault(),N.length!==4||C.length!==4){oe({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(N!==C){oe({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}c(!0);const{data:{user:q}}=await le.auth.getUser();if(!q){c(!1),oe({title:"Error",description:"Session expired. Please try again.",variant:"destructive"}),E("details");return}const{error:U}=await s(q.id,N);c(!1),U?oe({title:"Error",description:"Failed to set PIN. Please try again.",variant:"destructive"}):(le.functions.invoke("welcome-email",{body:{email:y.trim().toLowerCase(),name:m.trim()}}).catch(ee=>{console.error("Welcome email error:",ee)}),oe({title:"Welcome to Synka!",description:"Your account is ready. Enjoy!"}),e("/my-card",{replace:!0}))};return o.jsxs("div",{className:"min-h-screen flex",children:[o.jsx("div",{className:"hidden lg:flex flex-1 gradient-bg items-center justify-center p-12",children:o.jsxs("div",{className:"max-w-md text-center space-y-6",children:[o.jsx("div",{className:"grid grid-cols-2 gap-4 max-w-xs mx-auto",children:[0,1,2,3].map(L=>o.jsx("div",{className:"aspect-[1.6/1] rounded-xl glass animate-float",style:{animationDelay:`${L*200}ms`}},L))}),o.jsx("h2",{className:"text-3xl font-bold text-primary-foreground",children:"Create your card in seconds"}),o.jsx("p",{className:"text-primary-foreground/80",children:"Join thousands of professionals who've elevated their networking game."})]})}),o.jsx("div",{className:"flex-1 flex items-center justify-center p-6 md:p-12",children:o.jsxs("div",{className:"w-full max-w-md space-y-8 animate-fade-up",children:[o.jsxs("div",{className:"text-center lg:text-left",children:[o.jsx("div",{className:"mb-8",children:o.jsx(us,{size:"lg"})}),o.jsxs("h1",{className:"text-3xl font-bold text-foreground mb-2",children:[T==="details"&&"Create your account",T==="otp"&&"Verify your email",T==="set_pin"&&"Set up your PIN"]}),o.jsxs("p",{className:"text-muted-foreground",children:[T==="details"&&"Start networking smarter today",T==="otp"&&"Enter the code sent to your email",T==="set_pin"&&"Create a 4-digit PIN for quick login"]})]}),T==="details"&&o.jsxs("form",{onSubmit:V,className:"space-y-5",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{htmlFor:"name",children:["Full Name ",o.jsx("span",{className:"text-destructive",children:"*"})]}),o.jsxs("div",{className:"relative",children:[o.jsx(bl,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),o.jsx(Ge,{id:"name",type:"text",placeholder:"John Doe",value:m,onChange:L=>f(L.target.value),className:"pl-10 h-12",required:!0})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{htmlFor:"mobile",children:["Mobile Number ",o.jsx("span",{className:"text-destructive",children:"*"})]}),o.jsxs("div",{className:"relative",children:[o.jsx(Ry,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),o.jsx(Ge,{id:"mobile",type:"tel",placeholder:"+91 98765 43210",value:g,onChange:L=>x(L.target.value),className:"pl-10 h-12",required:!0})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{htmlFor:"email",children:["Email ",o.jsx("span",{className:"text-destructive",children:"*"})]}),o.jsxs("div",{className:"relative",children:[o.jsx(xi,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),o.jsx(Ge,{id:"email",type:"email",placeholder:"you@example.com",value:y,onChange:L=>b(L.target.value),className:"pl-10 h-12",required:!0})]})]})]}),o.jsxs("div",{className:"text-sm text-muted-foreground",children:["By signing up, you agree to our"," ",o.jsx(Va,{to:"/terms",className:"text-primary hover:underline",children:"Terms"})," ","and"," ",o.jsx(Va,{to:"/privacy",className:"text-primary hover:underline",children:"Privacy Policy"})]}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d,children:[d?"Sending code...":"Continue",o.jsx(fi,{className:"h-5 w-5"})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center",children:o.jsx("span",{className:"w-full border-t border-border"})}),o.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:o.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs(fe,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:j,disabled:h!==null,children:[h==="google"?o.jsx("span",{className:"animate-spin mr-2",children:""}):o.jsxs("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:[o.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),o.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),o.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),o.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]}),o.jsxs(fe,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:I,disabled:h!==null,children:[h==="linkedin"?o.jsx("span",{className:"animate-spin mr-2",children:""}):o.jsx("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"#0A66C2",children:o.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]})]}),T==="otp"&&o.jsxs("form",{onSubmit:$,className:"space-y-6",children:[o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"otp",children:"Verification Code"}),o.jsx(Ge,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:v,onChange:L=>w(L.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]})}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d||v.length!==6,children:[d?"Verifying...":"Verify & Continue",o.jsx(fi,{className:"h-5 w-5"})]}),o.jsx(fe,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{E("details"),w("")},children:"Back to signup"})]}),T==="set_pin"&&o.jsxs("form",{onSubmit:O,className:"space-y-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Create 4-Digit PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:N,onChange:S,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Confirm PIN"}),o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:C,onChange:_,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})})]})]}),o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d||N.length!==4||C.length!==4,children:[d?"Setting up...":"Complete Setup",o.jsx(fi,{className:"h-5 w-5"})]})]}),o.jsxs("p",{className:"text-center text-muted-foreground",children:["Already have an account?"," ",o.jsx(Va,{to:"/login",className:"text-primary font-medium hover:underline",children:"Sign in"})]})]})})]})}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Vz,setPrototypeOf:n$,isFrozen:toe,getPrototypeOf:noe,getOwnPropertyDescriptor:roe}=Object;let{freeze:ms,seal:Si,create:I2}=Object,{apply:T2,construct:E2}=typeof Reflect<"u"&&Reflect;ms||(ms=function(t){return t});Si||(Si=function(t){return t});T2||(T2=function(t,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return t.apply(n,a)});E2||(E2=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new t(...r)});const fv=fs(Array.prototype.forEach),aoe=fs(Array.prototype.lastIndexOf),r$=fs(Array.prototype.pop),Xg=fs(Array.prototype.push),soe=fs(Array.prototype.splice),Xv=fs(String.prototype.toLowerCase),Rk=fs(String.prototype.toString),Dk=fs(String.prototype.match),Zg=fs(String.prototype.replace),ioe=fs(String.prototype.indexOf),ooe=fs(String.prototype.trim),Vi=fs(Object.prototype.hasOwnProperty),ns=fs(RegExp.prototype.test),Qg=loe(TypeError);function fs(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return T2(e,t,r)}}function loe(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return E2(e,n)}}function fn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Xv;n$&&n$(e,null);let r=t.length;for(;r--;){let a=t[r];if(typeof a=="string"){const s=n(a);s!==a&&(toe(t)||(t[r]=s),a=s)}e[a]=!0}return e}function uoe(e){for(let t=0;t<e.length;t++)Vi(e,t)||(e[t]=null);return e}function go(e){const t=I2(null);for(const[n,r]of Vz(e))Vi(e,n)&&(Array.isArray(r)?t[n]=uoe(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=go(r):t[n]=r);return t}function Jg(e,t){for(;e!==null;){const r=roe(e,t);if(r){if(r.get)return fs(r.get);if(typeof r.value=="function")return fs(r.value)}e=noe(e)}function n(){return null}return n}const a$=ms(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Mk=ms(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),$k=ms(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),coe=ms(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Fk=ms(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),doe=ms(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),s$=ms(["#text"]),i$=ms(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Pk=ms(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),o$=ms(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),gv=ms(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),hoe=Si(/\{\{[\w\W]*|[\w\W]*\}\}/gm),poe=Si(/<%[\w\W]*|[\w\W]*%>/gm),moe=Si(/\$\{[\w\W]*/gm),foe=Si(/^data-[\-\w.\u00B7-\uFFFF]+$/),goe=Si(/^aria-[\-\w]+$/),Uz=Si(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),xoe=Si(/^(?:\w+script|data):/i),yoe=Si(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Hz=Si(/^html$/i),boe=Si(/^[a-z][.\w]*(-[.\w]+)+$/i);var l$=Object.freeze({__proto__:null,ARIA_ATTR:goe,ATTR_WHITESPACE:yoe,CUSTOM_ELEMENT:boe,DATA_ATTR:foe,DOCTYPE_NAME:Hz,ERB_EXPR:poe,IS_ALLOWED_URI:Uz,IS_SCRIPT_OR_DATA:xoe,MUSTACHE_EXPR:hoe,TMPLIT_EXPR:moe});const ex={element:1,text:3,progressingInstruction:7,comment:8,document:9},voe=function(){return typeof window>"u"?null:window},woe=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return t.createPolicy(s,{createHTML(i){return i},createScriptURL(i){return i}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},u$=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Gz(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:voe();const t=wt=>Gz(wt);if(t.version="3.3.1",t.removed=[],!e||!e.document||e.document.nodeType!==ex.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:i,Node:l,Element:u,NodeFilter:d,NamedNodeMap:c=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:h,DOMParser:p,trustedTypes:m}=e,f=u.prototype,g=Jg(f,"cloneNode"),x=Jg(f,"remove"),y=Jg(f,"nextSibling"),b=Jg(f,"childNodes"),v=Jg(f,"parentNode");if(typeof i=="function"){const wt=n.createElement("template");wt.content&&wt.content.ownerDocument&&(n=wt.content.ownerDocument)}let w,N="";const{implementation:S,createNodeIterator:C,createDocumentFragment:_,getElementsByTagName:T}=n,{importNode:E}=r;let j=u$();t.isSupported=typeof Vz=="function"&&typeof v=="function"&&S&&S.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:I,ERB_EXPR:D,TMPLIT_EXPR:F,DATA_ATTR:P,ARIA_ATTR:V,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:O,CUSTOM_ELEMENT:L}=l$;let{IS_ALLOWED_URI:q}=l$,U=null;const ee=fn({},[...a$,...Mk,...$k,...Fk,...s$]);let M=null;const G=fn({},[...i$,...Pk,...o$,...gv]);let J=Object.seal(I2(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ve=null,Q=null;const se=Object.seal(I2(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let _e=!0,Le=!0,Se=!1,ye=!0,Fe=!1,Te=!0,Oe=!1,He=!1,Ee=!1,Re=!1,Ke=!1,at=!1,Y=!0,ae=!1;const we="user-content-";let Ce=!0,Ne=!1,he={},Ae=null;const gt=fn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ht=null;const Dt=fn({},["audio","video","img","source","image","track"]);let $t=null;const qe=fn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),it="http://www.w3.org/1998/Math/MathML",Ct="http://www.w3.org/2000/svg",pt="http://www.w3.org/1999/xhtml";let Ut=pt,Ln=!1,bt=null;const Ot=fn({},[it,Ct,pt],Rk);let Et=fn({},["mi","mo","mn","ms","mtext"]),Lt=fn({},["annotation-xml"]);const At=fn({},["title","style","font","a","script"]);let zt=null;const Sn=["application/xhtml+xml","text/html"],ot="text/html";let pe=null,Me=null;const Je=n.createElement("form"),ze=function(de){return de instanceof RegExp||de instanceof Function},Ft=function(){let de=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Me&&Me===de)){if((!de||typeof de!="object")&&(de={}),de=go(de),zt=Sn.indexOf(de.PARSER_MEDIA_TYPE)===-1?ot:de.PARSER_MEDIA_TYPE,pe=zt==="application/xhtml+xml"?Rk:Xv,U=Vi(de,"ALLOWED_TAGS")?fn({},de.ALLOWED_TAGS,pe):ee,M=Vi(de,"ALLOWED_ATTR")?fn({},de.ALLOWED_ATTR,pe):G,bt=Vi(de,"ALLOWED_NAMESPACES")?fn({},de.ALLOWED_NAMESPACES,Rk):Ot,$t=Vi(de,"ADD_URI_SAFE_ATTR")?fn(go(qe),de.ADD_URI_SAFE_ATTR,pe):qe,ht=Vi(de,"ADD_DATA_URI_TAGS")?fn(go(Dt),de.ADD_DATA_URI_TAGS,pe):Dt,Ae=Vi(de,"FORBID_CONTENTS")?fn({},de.FORBID_CONTENTS,pe):gt,ve=Vi(de,"FORBID_TAGS")?fn({},de.FORBID_TAGS,pe):go({}),Q=Vi(de,"FORBID_ATTR")?fn({},de.FORBID_ATTR,pe):go({}),he=Vi(de,"USE_PROFILES")?de.USE_PROFILES:!1,_e=de.ALLOW_ARIA_ATTR!==!1,Le=de.ALLOW_DATA_ATTR!==!1,Se=de.ALLOW_UNKNOWN_PROTOCOLS||!1,ye=de.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Fe=de.SAFE_FOR_TEMPLATES||!1,Te=de.SAFE_FOR_XML!==!1,Oe=de.WHOLE_DOCUMENT||!1,Re=de.RETURN_DOM||!1,Ke=de.RETURN_DOM_FRAGMENT||!1,at=de.RETURN_TRUSTED_TYPE||!1,Ee=de.FORCE_BODY||!1,Y=de.SANITIZE_DOM!==!1,ae=de.SANITIZE_NAMED_PROPS||!1,Ce=de.KEEP_CONTENT!==!1,Ne=de.IN_PLACE||!1,q=de.ALLOWED_URI_REGEXP||Uz,Ut=de.NAMESPACE||pt,Et=de.MATHML_TEXT_INTEGRATION_POINTS||Et,Lt=de.HTML_INTEGRATION_POINTS||Lt,J=de.CUSTOM_ELEMENT_HANDLING||{},de.CUSTOM_ELEMENT_HANDLING&&ze(de.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(J.tagNameCheck=de.CUSTOM_ELEMENT_HANDLING.tagNameCheck),de.CUSTOM_ELEMENT_HANDLING&&ze(de.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(J.attributeNameCheck=de.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),de.CUSTOM_ELEMENT_HANDLING&&typeof de.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(J.allowCustomizedBuiltInElements=de.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Fe&&(Le=!1),Ke&&(Re=!0),he&&(U=fn({},s$),M=[],he.html===!0&&(fn(U,a$),fn(M,i$)),he.svg===!0&&(fn(U,Mk),fn(M,Pk),fn(M,gv)),he.svgFilters===!0&&(fn(U,$k),fn(M,Pk),fn(M,gv)),he.mathMl===!0&&(fn(U,Fk),fn(M,o$),fn(M,gv))),de.ADD_TAGS&&(typeof de.ADD_TAGS=="function"?se.tagCheck=de.ADD_TAGS:(U===ee&&(U=go(U)),fn(U,de.ADD_TAGS,pe))),de.ADD_ATTR&&(typeof de.ADD_ATTR=="function"?se.attributeCheck=de.ADD_ATTR:(M===G&&(M=go(M)),fn(M,de.ADD_ATTR,pe))),de.ADD_URI_SAFE_ATTR&&fn($t,de.ADD_URI_SAFE_ATTR,pe),de.FORBID_CONTENTS&&(Ae===gt&&(Ae=go(Ae)),fn(Ae,de.FORBID_CONTENTS,pe)),de.ADD_FORBID_CONTENTS&&(Ae===gt&&(Ae=go(Ae)),fn(Ae,de.ADD_FORBID_CONTENTS,pe)),Ce&&(U["#text"]=!0),Oe&&fn(U,["html","head","body"]),U.table&&(fn(U,["tbody"]),delete ve.tbody),de.TRUSTED_TYPES_POLICY){if(typeof de.TRUSTED_TYPES_POLICY.createHTML!="function")throw Qg('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof de.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Qg('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=de.TRUSTED_TYPES_POLICY,N=w.createHTML("")}else w===void 0&&(w=woe(m,a)),w!==null&&typeof N=="string"&&(N=w.createHTML(""));ms&&ms(de),Me=de}},Ht=fn({},[...Mk,...$k,...coe]),ct=fn({},[...Fk,...doe]),vt=function(de){let Be=v(de);(!Be||!Be.tagName)&&(Be={namespaceURI:Ut,tagName:"template"});const lt=Xv(de.tagName),Mn=Xv(Be.tagName);return bt[de.namespaceURI]?de.namespaceURI===Ct?Be.namespaceURI===pt?lt==="svg":Be.namespaceURI===it?lt==="svg"&&(Mn==="annotation-xml"||Et[Mn]):!!Ht[lt]:de.namespaceURI===it?Be.namespaceURI===pt?lt==="math":Be.namespaceURI===Ct?lt==="math"&&Lt[Mn]:!!ct[lt]:de.namespaceURI===pt?Be.namespaceURI===Ct&&!Lt[Mn]||Be.namespaceURI===it&&!Et[Mn]?!1:!ct[lt]&&(At[lt]||!Ht[lt]):!!(zt==="application/xhtml+xml"&&bt[de.namespaceURI]):!1},ln=function(de){Xg(t.removed,{element:de});try{v(de).removeChild(de)}catch{x(de)}},fr=function(de,Be){try{Xg(t.removed,{attribute:Be.getAttributeNode(de),from:Be})}catch{Xg(t.removed,{attribute:null,from:Be})}if(Be.removeAttribute(de),de==="is")if(Re||Ke)try{ln(Be)}catch{}else try{Be.setAttribute(de,"")}catch{}},Na=function(de){let Be=null,lt=null;if(Ee)de="<remove></remove>"+de;else{const Rn=Dk(de,/^[\r\n\t ]+/);lt=Rn&&Rn[0]}zt==="application/xhtml+xml"&&Ut===pt&&(de='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+de+"</body></html>");const Mn=w?w.createHTML(de):de;if(Ut===pt)try{Be=new p().parseFromString(Mn,zt)}catch{}if(!Be||!Be.documentElement){Be=S.createDocument(Ut,"template",null);try{Be.documentElement.innerHTML=Ln?N:Mn}catch{}}const or=Be.body||Be.documentElement;return de&&lt&&or.insertBefore(n.createTextNode(lt),or.childNodes[0]||null),Ut===pt?T.call(Be,Oe?"html":"body")[0]:Oe?Be.documentElement:or},aa=function(de){return C.call(de.ownerDocument||de,de,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},qr=function(de){return de instanceof h&&(typeof de.nodeName!="string"||typeof de.textContent!="string"||typeof de.removeChild!="function"||!(de.attributes instanceof c)||typeof de.removeAttribute!="function"||typeof de.setAttribute!="function"||typeof de.namespaceURI!="string"||typeof de.insertBefore!="function"||typeof de.hasChildNodes!="function")},Da=function(de){return typeof l=="function"&&de instanceof l};function zn(wt,de,Be){fv(wt,lt=>{lt.call(t,de,Be,Me)})}const Ma=function(de){let Be=null;if(zn(j.beforeSanitizeElements,de,null),qr(de))return ln(de),!0;const lt=pe(de.nodeName);if(zn(j.uponSanitizeElement,de,{tagName:lt,allowedTags:U}),Te&&de.hasChildNodes()&&!Da(de.firstElementChild)&&ns(/<[/\w!]/g,de.innerHTML)&&ns(/<[/\w!]/g,de.textContent)||de.nodeType===ex.progressingInstruction||Te&&de.nodeType===ex.comment&&ns(/<[/\w]/g,de.data))return ln(de),!0;if(!(se.tagCheck instanceof Function&&se.tagCheck(lt))&&(!U[lt]||ve[lt])){if(!ve[lt]&&Cn(lt)&&(J.tagNameCheck instanceof RegExp&&ns(J.tagNameCheck,lt)||J.tagNameCheck instanceof Function&&J.tagNameCheck(lt)))return!1;if(Ce&&!Ae[lt]){const Mn=v(de)||de.parentNode,or=b(de)||de.childNodes;if(or&&Mn){const Rn=or.length;for(let lr=Rn-1;lr>=0;--lr){const jr=g(or[lr],!0);jr.__removalCount=(de.__removalCount||0)+1,Mn.insertBefore(jr,y(de))}}}return ln(de),!0}return de instanceof u&&!vt(de)||(lt==="noscript"||lt==="noembed"||lt==="noframes")&&ns(/<\/no(script|embed|frames)/i,de.innerHTML)?(ln(de),!0):(Fe&&de.nodeType===ex.text&&(Be=de.textContent,fv([I,D,F],Mn=>{Be=Zg(Be,Mn," ")}),de.textContent!==Be&&(Xg(t.removed,{element:de.cloneNode()}),de.textContent=Be)),zn(j.afterSanitizeElements,de,null),!1)},Bs=function(de,Be,lt){if(Y&&(Be==="id"||Be==="name")&&(lt in n||lt in Je))return!1;if(!(Le&&!Q[Be]&&ns(P,Be))){if(!(_e&&ns(V,Be))){if(!(se.attributeCheck instanceof Function&&se.attributeCheck(Be,de))){if(!M[Be]||Q[Be]){if(!(Cn(de)&&(J.tagNameCheck instanceof RegExp&&ns(J.tagNameCheck,de)||J.tagNameCheck instanceof Function&&J.tagNameCheck(de))&&(J.attributeNameCheck instanceof RegExp&&ns(J.attributeNameCheck,Be)||J.attributeNameCheck instanceof Function&&J.attributeNameCheck(Be,de))||Be==="is"&&J.allowCustomizedBuiltInElements&&(J.tagNameCheck instanceof RegExp&&ns(J.tagNameCheck,lt)||J.tagNameCheck instanceof Function&&J.tagNameCheck(lt))))return!1}else if(!$t[Be]){if(!ns(q,Zg(lt,O,""))){if(!((Be==="src"||Be==="xlink:href"||Be==="href")&&de!=="script"&&ioe(lt,"data:")===0&&ht[de])){if(!(Se&&!ns($,Zg(lt,O,"")))){if(lt)return!1}}}}}}}return!0},Cn=function(de){return de!=="annotation-xml"&&Dk(de,L)},gr=function(de){zn(j.beforeSanitizeAttributes,de,null);const{attributes:Be}=de;if(!Be||qr(de))return;const lt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:M,forceKeepAttr:void 0};let Mn=Be.length;for(;Mn--;){const or=Be[Mn],{name:Rn,namespaceURI:lr,value:jr}=or,Bn=pe(Rn),ka=jr;let Qn=Rn==="value"?ka:ooe(ka);if(lt.attrName=Bn,lt.attrValue=Qn,lt.keepAttr=!0,lt.forceKeepAttr=void 0,zn(j.uponSanitizeAttribute,de,lt),Qn=lt.attrValue,ae&&(Bn==="id"||Bn==="name")&&(fr(Rn,de),Qn=we+Qn),Te&&ns(/((--!?|])>)|<\/(style|title|textarea)/i,Qn)){fr(Rn,de);continue}if(Bn==="attributename"&&Dk(Qn,"href")){fr(Rn,de);continue}if(lt.forceKeepAttr)continue;if(!lt.keepAttr){fr(Rn,de);continue}if(!ye&&ns(/\/>/i,Qn)){fr(Rn,de);continue}Fe&&fv([I,D,F],vs=>{Qn=Zg(Qn,vs," ")});const ii=pe(de.nodeName);if(!Bs(ii,Bn,Qn)){fr(Rn,de);continue}if(w&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!lr)switch(m.getAttributeType(ii,Bn)){case"TrustedHTML":{Qn=w.createHTML(Qn);break}case"TrustedScriptURL":{Qn=w.createScriptURL(Qn);break}}if(Qn!==ka)try{lr?de.setAttributeNS(lr,Rn,Qn):de.setAttribute(Rn,Qn),qr(de)?ln(de):r$(t.removed)}catch{fr(Rn,de)}}zn(j.afterSanitizeAttributes,de,null)},Ws=function wt(de){let Be=null;const lt=aa(de);for(zn(j.beforeSanitizeShadowDOM,de,null);Be=lt.nextNode();)zn(j.uponSanitizeShadowNode,Be,null),Ma(Be),gr(Be),Be.content instanceof s&&wt(Be.content);zn(j.afterSanitizeShadowDOM,de,null)};return t.sanitize=function(wt){let de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Be=null,lt=null,Mn=null,or=null;if(Ln=!wt,Ln&&(wt="<!-->"),typeof wt!="string"&&!Da(wt))if(typeof wt.toString=="function"){if(wt=wt.toString(),typeof wt!="string")throw Qg("dirty is not a string, aborting")}else throw Qg("toString is not a function");if(!t.isSupported)return wt;if(He||Ft(de),t.removed=[],typeof wt=="string"&&(Ne=!1),Ne){if(wt.nodeName){const jr=pe(wt.nodeName);if(!U[jr]||ve[jr])throw Qg("root node is forbidden and cannot be sanitized in-place")}}else if(wt instanceof l)Be=Na("<!---->"),lt=Be.ownerDocument.importNode(wt,!0),lt.nodeType===ex.element&&lt.nodeName==="BODY"||lt.nodeName==="HTML"?Be=lt:Be.appendChild(lt);else{if(!Re&&!Fe&&!Oe&&wt.indexOf("<")===-1)return w&&at?w.createHTML(wt):wt;if(Be=Na(wt),!Be)return Re?null:at?N:""}Be&&Ee&&ln(Be.firstChild);const Rn=aa(Ne?wt:Be);for(;Mn=Rn.nextNode();)Ma(Mn),gr(Mn),Mn.content instanceof s&&Ws(Mn.content);if(Ne)return wt;if(Re){if(Ke)for(or=_.call(Be.ownerDocument);Be.firstChild;)or.appendChild(Be.firstChild);else or=Be;return(M.shadowroot||M.shadowrootmode)&&(or=E.call(r,or,!0)),or}let lr=Oe?Be.outerHTML:Be.innerHTML;return Oe&&U["!doctype"]&&Be.ownerDocument&&Be.ownerDocument.doctype&&Be.ownerDocument.doctype.name&&ns(Hz,Be.ownerDocument.doctype.name)&&(lr="<!DOCTYPE "+Be.ownerDocument.doctype.name+`>
`+lr),Fe&&fv([I,D,F],jr=>{lr=Zg(lr,jr," ")}),w&&at?w.createHTML(lr):lr},t.setConfig=function(){let wt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ft(wt),He=!0},t.clearConfig=function(){Me=null,He=!1},t.isValidAttribute=function(wt,de,Be){Me||Ft({});const lt=pe(wt),Mn=pe(de);return Bs(lt,Mn,Be)},t.addHook=function(wt,de){typeof de=="function"&&Xg(j[wt],de)},t.removeHook=function(wt,de){if(de!==void 0){const Be=aoe(j[wt],de);return Be===-1?void 0:soe(j[wt],Be,1)[0]}return r$(j[wt])},t.removeHooks=function(wt){j[wt]=[]},t.removeAllHooks=function(){j=u$()},t}var Vc=Gz();const xn=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{ref:n,className:Ie("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));xn.displayName="Card";const Fn=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{ref:n,className:Ie("flex flex-col space-y-1.5 p-6",e),...t}));Fn.displayName="CardHeader";const Pn=k.forwardRef(({className:e,...t},n)=>o.jsx("h3",{ref:n,className:Ie("text-2xl font-semibold leading-none tracking-tight",e),...t}));Pn.displayName="CardTitle";const gi=k.forwardRef(({className:e,...t},n)=>o.jsx("p",{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));gi.displayName="CardDescription";const wn=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{ref:n,className:Ie("p-6 pt-0",e),...t}));wn.displayName="CardContent";const Noe=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{ref:n,className:Ie("flex items-center p-6 pt-0",e),...t}));Noe.displayName="CardFooter";const Pa=k.forwardRef(({className:e,...t},n)=>o.jsx("textarea",{className:Ie("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...t}));Pa.displayName="Textarea";function qz({open:e,onOpenChange:t,title:n,description:r,confirmText:a="Delete",cancelText:s="Cancel",onConfirm:i,variant:l="destructive"}){return o.jsx(_m,{open:e,onOpenChange:t,children:o.jsxs(md,{children:[o.jsxs(fd,{children:[o.jsx(xd,{children:n}),o.jsx(yd,{children:r})]}),o.jsxs(gd,{children:[o.jsx(vd,{children:s}),o.jsx(bd,{onClick:i,className:l==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:a})]})]})})}function koe(e){const t=Soe(e),n=k.forwardRef((r,a)=>{const{children:s,...i}=r,l=k.Children.toArray(s),u=l.find(_oe);if(u){const d=u.props.children,c=l.map(h=>h===u?k.Children.count(d)>1?k.Children.only(null):k.isValidElement(d)?d.props.children:null:h);return o.jsx(t,{...i,ref:a,children:k.isValidElement(d)?k.cloneElement(d,void 0,c):null})}return o.jsx(t,{...i,ref:a,children:s})});return n.displayName=`${e}.Slot`,n}function Soe(e){const t=k.forwardRef((n,r)=>{const{children:a,...s}=n;if(k.isValidElement(a)){const i=Toe(a),l=Ioe(s,a.props);return a.type!==k.Fragment&&(l.ref=r?JC(r,i):i),k.cloneElement(a,l)}return k.Children.count(a)>1?k.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Coe=Symbol("radix.slottable");function _oe(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Coe}function Ioe(e,t){const n={...t};for(const r in t){const a=e[r],s=t[r];/^on[A-Z]/.test(r)?a&&s?n[r]=(...l)=>{const u=s(...l);return a(...l),u}:a&&(n[r]=a):r==="style"?n[r]={...a,...s}:r==="className"&&(n[r]=[a,s].filter(Boolean).join(" "))}return{...e,...n}}function Toe(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var X0="Popover",[Kz]=qo(X0,[P0]),zy=P0(),[Eoe,ec]=Kz(X0),Yz=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:a,onOpenChange:s,modal:i=!1}=e,l=zy(t),u=k.useRef(null),[d,c]=k.useState(!1),[h,p]=Sl({prop:r,defaultProp:a??!1,onChange:s,caller:X0});return o.jsx(c3,{...l,children:o.jsx(Eoe,{scope:t,contentId:rf(),triggerRef:u,open:h,onOpenChange:p,onOpenToggle:k.useCallback(()=>p(m=>!m),[p]),hasCustomAnchor:d,onCustomAnchorAdd:k.useCallback(()=>c(!0),[]),onCustomAnchorRemove:k.useCallback(()=>c(!1),[]),modal:i,children:n})})};Yz.displayName=X0;var Xz="PopoverAnchor",joe=k.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=ec(Xz,n),s=zy(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:l}=a;return k.useEffect(()=>(i(),()=>l()),[i,l]),o.jsx(a_,{...s,...r,ref:t})});joe.displayName=Xz;var Zz="PopoverTrigger",Qz=k.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=ec(Zz,n),s=zy(n),i=sr(t,a.triggerRef),l=o.jsx(An.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":r5(a.open),...r,ref:i,onClick:yn(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:o.jsx(a_,{asChild:!0,...s,children:l})});Qz.displayName=Zz;var wI="PopoverPortal",[Aoe,Roe]=Kz(wI,{forceMount:void 0}),Jz=e=>{const{__scopePopover:t,forceMount:n,children:r,container:a}=e,s=ec(wI,t);return o.jsx(Aoe,{scope:t,forceMount:n,children:o.jsx(Al,{present:n||s.open,children:o.jsx(r3,{asChild:!0,container:a,children:r})})})};Jz.displayName=wI;var Pm="PopoverContent",e5=k.forwardRef((e,t)=>{const n=Roe(Pm,e.__scopePopover),{forceMount:r=n.forceMount,...a}=e,s=ec(Pm,e.__scopePopover);return o.jsx(Al,{present:r||s.open,children:s.modal?o.jsx(Moe,{...a,ref:t}):o.jsx($oe,{...a,ref:t})})});e5.displayName=Pm;var Doe=koe("PopoverContent.RemoveScroll"),Moe=k.forwardRef((e,t)=>{const n=ec(Pm,e.__scopePopover),r=k.useRef(null),a=sr(t,r),s=k.useRef(!1);return k.useEffect(()=>{const i=r.current;if(i)return a3(i)},[]),o.jsx(s3,{as:Doe,allowPinchZoom:!0,children:o.jsx(t5,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:yn(e.onCloseAutoFocus,i=>{var l;i.preventDefault(),s.current||(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:yn(e.onPointerDownOutside,i=>{const l=i.detail.originalEvent,u=l.button===0&&l.ctrlKey===!0,d=l.button===2||u;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:yn(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),$oe=k.forwardRef((e,t)=>{const n=ec(Pm,e.__scopePopover),r=k.useRef(!1),a=k.useRef(!1);return o.jsx(t5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,l;(i=e.onCloseAutoFocus)==null||i.call(e,s),s.defaultPrevented||(r.current||(l=n.triggerRef.current)==null||l.focus(),s.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:s=>{var u,d;(u=e.onInteractOutside)==null||u.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const i=s.target;((d=n.triggerRef.current)==null?void 0:d.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&a.current&&s.preventDefault()}})}),t5=k.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:c,...h}=e,p=ec(Pm,n),m=zy(n);return i3(),o.jsx(o3,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:s,children:o.jsx(l3,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:o.jsx(u3,{"data-state":r5(p.open),role:"dialog",id:p.contentId,...m,...h,ref:t,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),n5="PopoverClose",Foe=k.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=ec(n5,n);return o.jsx(An.button,{type:"button",...r,ref:t,onClick:yn(e.onClick,()=>a.onOpenChange(!1))})});Foe.displayName=n5;var Poe="PopoverArrow",Ooe=k.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=zy(n);return o.jsx(d3,{...a,...r,ref:t})});Ooe.displayName=Poe;function r5(e){return e?"open":"closed"}var Loe=Yz,zoe=Qz,Boe=Jz,a5=e5;const j2=Loe,A2=zoe,Hw=k.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},a)=>o.jsx(Boe,{children:o.jsx(a5,{ref:a,align:t,sideOffset:n,className:Ie("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));Hw.displayName=a5.displayName;function Tn(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function ti(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function os(e,t){const n=Tn(e);return isNaN(t)?ti(e,NaN):(t&&n.setDate(n.getDate()+t),n)}function Ci(e,t){const n=Tn(e);if(isNaN(t))return ti(e,NaN);if(!t)return n;const r=n.getDate(),a=ti(e,n.getTime());a.setMonth(n.getMonth()+t+1,0);const s=a.getDate();return r>=s?a:(n.setFullYear(a.getFullYear(),a.getMonth(),r),n)}const NI=6048e5,Woe=864e5;let Voe={};function By(){return Voe}function Wo(e,t){var l,u,d,c;const n=By(),r=(t==null?void 0:t.weekStartsOn)??((u=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:u.weekStartsOn)??n.weekStartsOn??((c=(d=n.locale)==null?void 0:d.options)==null?void 0:c.weekStartsOn)??0,a=Tn(e),s=a.getDay(),i=(s<r?7:0)+s-r;return a.setDate(a.getDate()-i),a.setHours(0,0,0,0),a}function Nd(e){return Wo(e,{weekStartsOn:1})}function s5(e){const t=Tn(e),n=t.getFullYear(),r=ti(e,0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);const a=Nd(r),s=ti(e,0);s.setFullYear(n,0,4),s.setHours(0,0,0,0);const i=Nd(s);return t.getTime()>=a.getTime()?n+1:t.getTime()>=i.getTime()?n:n-1}function Eo(e){const t=Tn(e);return t.setHours(0,0,0,0),t}function Gw(e){const t=Tn(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function jo(e,t){const n=Eo(e),r=Eo(t),a=+n-Gw(n),s=+r-Gw(r);return Math.round((a-s)/Woe)}function Uoe(e){const t=s5(e),n=ti(e,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),Nd(n)}function R2(e,t){const n=t*7;return os(e,n)}function i5(e,t){return Ci(e,t*12)}function Hoe(e){let t;return e.forEach(function(n){const r=Tn(n);(t===void 0||t<r||isNaN(Number(r)))&&(t=r)}),t||new Date(NaN)}function Goe(e){let t;return e.forEach(n=>{const r=Tn(n);(!t||t>r||isNaN(+r))&&(t=r)}),t||new Date(NaN)}function As(e,t){const n=Eo(e),r=Eo(t);return+n==+r}function kI(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function qoe(e){if(!kI(e)&&typeof e!="number")return!1;const t=Tn(e);return!isNaN(Number(t))}function iy(e,t){const n=Tn(e),r=Tn(t),a=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return a*12+s}function Koe(e,t,n){const r=Wo(e,n),a=Wo(t,n),s=+r-Gw(r),i=+a-Gw(a);return Math.round((s-i)/NI)}function xv(e){const t=Tn(e);return t.setHours(23,59,59,999),t}function SI(e){const t=Tn(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Ds(e){const t=Tn(e);return t.setDate(1),t.setHours(0,0,0,0),t}function o5(e){const t=Tn(e),n=ti(e,0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function CI(e,t){var l,u,d,c;const n=By(),r=(t==null?void 0:t.weekStartsOn)??((u=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:u.weekStartsOn)??n.weekStartsOn??((c=(d=n.locale)==null?void 0:d.options)==null?void 0:c.weekStartsOn)??0,a=Tn(e),s=a.getDay(),i=(s<r?-7:0)+6-(s-r);return a.setDate(a.getDate()+i),a.setHours(23,59,59,999),a}function l5(e){return CI(e,{weekStartsOn:1})}const Yoe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Xoe=(e,t,n)=>{let r;const a=Yoe[e];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function Ok(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const Zoe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Qoe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Joe={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ele={date:Ok({formats:Zoe,defaultWidth:"full"}),time:Ok({formats:Qoe,defaultWidth:"full"}),dateTime:Ok({formats:Joe,defaultWidth:"full"})},tle={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},nle=(e,t,n,r)=>tle[e];function tx(e){return(t,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let a;if(r==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,l=n!=null&&n.width?String(n.width):i;a=e.formattingValues[l]||e.formattingValues[i]}else{const i=e.defaultWidth,l=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[l]||e.values[i]}const s=e.argumentCallback?e.argumentCallback(t):t;return a[s]}}const rle={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},ale={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},sle={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ile={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},ole={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},lle={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ule=(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},cle={ordinalNumber:ule,era:tx({values:rle,defaultWidth:"wide"}),quarter:tx({values:ale,defaultWidth:"wide",argumentCallback:e=>e-1}),month:tx({values:sle,defaultWidth:"wide"}),day:tx({values:ile,defaultWidth:"wide"}),dayPeriod:tx({values:ole,defaultWidth:"wide",formattingValues:lle,defaultFormattingWidth:"wide"})};function nx(e){return(t,n={})=>{const r=n.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],s=t.match(a);if(!s)return null;const i=s[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],u=Array.isArray(l)?hle(l,h=>h.test(i)):dle(l,h=>h.test(i));let d;d=e.valueCallback?e.valueCallback(u):u,d=n.valueCallback?n.valueCallback(d):d;const c=t.slice(i.length);return{value:d,rest:c}}}function dle(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function hle(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function ple(e){return(t,n={})=>{const r=t.match(e.matchPattern);if(!r)return null;const a=r[0],s=t.match(e.parsePattern);if(!s)return null;let i=e.valueCallback?e.valueCallback(s[0]):s[0];i=n.valueCallback?n.valueCallback(i):i;const l=t.slice(a.length);return{value:i,rest:l}}}const mle=/^(\d+)(th|st|nd|rd)?/i,fle=/\d+/i,gle={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},xle={any:[/^b/i,/^(a|c)/i]},yle={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ble={any:[/1/i,/2/i,/3/i,/4/i]},vle={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},wle={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Nle={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},kle={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Sle={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Cle={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},_le={ordinalNumber:ple({matchPattern:mle,parsePattern:fle,valueCallback:e=>parseInt(e,10)}),era:nx({matchPatterns:gle,defaultMatchWidth:"wide",parsePatterns:xle,defaultParseWidth:"any"}),quarter:nx({matchPatterns:yle,defaultMatchWidth:"wide",parsePatterns:ble,defaultParseWidth:"any",valueCallback:e=>e+1}),month:nx({matchPatterns:vle,defaultMatchWidth:"wide",parsePatterns:wle,defaultParseWidth:"any"}),day:nx({matchPatterns:Nle,defaultMatchWidth:"wide",parsePatterns:kle,defaultParseWidth:"any"}),dayPeriod:nx({matchPatterns:Sle,defaultMatchWidth:"any",parsePatterns:Cle,defaultParseWidth:"any"})},u5={code:"en-US",formatDistance:Xoe,formatLong:ele,formatRelative:nle,localize:cle,match:_le,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ile(e){const t=Tn(e);return jo(t,o5(t))+1}function c5(e){const t=Tn(e),n=+Nd(t)-+Uoe(t);return Math.round(n/NI)+1}function d5(e,t){var c,h,p,m;const n=Tn(e),r=n.getFullYear(),a=By(),s=(t==null?void 0:t.firstWeekContainsDate)??((h=(c=t==null?void 0:t.locale)==null?void 0:c.options)==null?void 0:h.firstWeekContainsDate)??a.firstWeekContainsDate??((m=(p=a.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)??1,i=ti(e,0);i.setFullYear(r+1,0,s),i.setHours(0,0,0,0);const l=Wo(i,t),u=ti(e,0);u.setFullYear(r,0,s),u.setHours(0,0,0,0);const d=Wo(u,t);return n.getTime()>=l.getTime()?r+1:n.getTime()>=d.getTime()?r:r-1}function Tle(e,t){var l,u,d,c;const n=By(),r=(t==null?void 0:t.firstWeekContainsDate)??((u=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:u.firstWeekContainsDate)??n.firstWeekContainsDate??((c=(d=n.locale)==null?void 0:d.options)==null?void 0:c.firstWeekContainsDate)??1,a=d5(e,t),s=ti(e,0);return s.setFullYear(a,0,r),s.setHours(0,0,0,0),Wo(s,t)}function h5(e,t){const n=Tn(e),r=+Wo(n,t)-+Tle(n,t);return Math.round(r/NI)+1}function Jn(e,t){const n=e<0?"-":"",r=Math.abs(e).toString().padStart(t,"0");return n+r}const Yl={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return Jn(t==="yy"?r%100:r,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):Jn(n+1,2)},d(e,t){return Jn(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return Jn(e.getHours()%12||12,t.length)},H(e,t){return Jn(e.getHours(),t.length)},m(e,t){return Jn(e.getMinutes(),t.length)},s(e,t){return Jn(e.getSeconds(),t.length)},S(e,t){const n=t.length,r=e.getMilliseconds(),a=Math.trunc(r*Math.pow(10,n-3));return Jn(a,t.length)}},Rp={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},c$={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const r=e.getFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return Yl.y(e,t)},Y:function(e,t,n,r){const a=d5(e,r),s=a>0?a:1-a;if(t==="YY"){const i=s%100;return Jn(i,2)}return t==="Yo"?n.ordinalNumber(s,{unit:"year"}):Jn(s,t.length)},R:function(e,t){const n=s5(e);return Jn(n,t.length)},u:function(e,t){const n=e.getFullYear();return Jn(n,t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Jn(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Jn(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return Yl.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return Jn(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const a=h5(e,r);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):Jn(a,t.length)},I:function(e,t,n){const r=c5(e);return t==="Io"?n.ordinalNumber(r,{unit:"week"}):Jn(r,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):Yl.d(e,t)},D:function(e,t,n){const r=Ile(e);return t==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Jn(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const a=e.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return Jn(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const a=e.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return Jn(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),a=r===0?7:r;switch(t){case"i":return String(a);case"ii":return Jn(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let a;switch(r===12?a=Rp.noon:r===0?a=Rp.midnight:a=r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let a;switch(r>=17?a=Rp.evening:r>=12?a=Rp.afternoon:r>=4?a=Rp.morning:a=Rp.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let r=e.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Yl.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):Yl.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return t==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Jn(r,t.length)},k:function(e,t,n){let r=e.getHours();return r===0&&(r=24),t==="ko"?n.ordinalNumber(r,{unit:"hour"}):Jn(r,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):Yl.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):Yl.s(e,t)},S:function(e,t){return Yl.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return h$(r);case"XXXX":case"XX":return Tc(r);case"XXXXX":case"XXX":default:return Tc(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return h$(r);case"xxxx":case"xx":return Tc(r);case"xxxxx":case"xxx":default:return Tc(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+d$(r,":");case"OOOO":default:return"GMT"+Tc(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+d$(r,":");case"zzzz":default:return"GMT"+Tc(r,":")}},t:function(e,t,n){const r=Math.trunc(e.getTime()/1e3);return Jn(r,t.length)},T:function(e,t,n){const r=e.getTime();return Jn(r,t.length)}};function d$(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),s=r%60;return s===0?n+String(a):n+String(a)+t+Jn(s,2)}function h$(e,t){return e%60===0?(e>0?"-":"+")+Jn(Math.abs(e)/60,2):Tc(e,t)}function Tc(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Jn(Math.trunc(r/60),2),s=Jn(r%60,2);return n+a+t+s}const p$=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},p5=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ele=(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],a=n[2];if(!a)return p$(e,t);let s;switch(r){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;case"PPPP":default:s=t.dateTime({width:"full"});break}return s.replace("{{date}}",p$(r,t)).replace("{{time}}",p5(a,t))},jle={p:p5,P:Ele},Ale=/^D+$/,Rle=/^Y+$/,Dle=["D","DD","YY","YYYY"];function Mle(e){return Ale.test(e)}function $le(e){return Rle.test(e)}function Fle(e,t,n){const r=Ple(e,t,n);if(console.warn(r),Dle.includes(e))throw new RangeError(r)}function Ple(e,t,n){const r=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ole=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Lle=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,zle=/^'([^]*?)'?$/,Ble=/''/g,Wle=/[a-zA-Z]/;function hr(e,t,n){var c,h,p,m,f,g,x,y;const r=By(),a=(n==null?void 0:n.locale)??r.locale??u5,s=(n==null?void 0:n.firstWeekContainsDate)??((h=(c=n==null?void 0:n.locale)==null?void 0:c.options)==null?void 0:h.firstWeekContainsDate)??r.firstWeekContainsDate??((m=(p=r.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)??1,i=(n==null?void 0:n.weekStartsOn)??((g=(f=n==null?void 0:n.locale)==null?void 0:f.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((y=(x=r.locale)==null?void 0:x.options)==null?void 0:y.weekStartsOn)??0,l=Tn(e);if(!qoe(l))throw new RangeError("Invalid time value");let u=t.match(Lle).map(b=>{const v=b[0];if(v==="p"||v==="P"){const w=jle[v];return w(b,a.formatLong)}return b}).join("").match(Ole).map(b=>{if(b==="''")return{isToken:!1,value:"'"};const v=b[0];if(v==="'")return{isToken:!1,value:Vle(b)};if(c$[v])return{isToken:!0,value:b};if(v.match(Wle))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:b}});a.localize.preprocessor&&(u=a.localize.preprocessor(l,u));const d={firstWeekContainsDate:s,weekStartsOn:i,locale:a};return u.map(b=>{if(!b.isToken)return b.value;const v=b.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&$le(v)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&Mle(v))&&Fle(v,t,String(e));const w=c$[v[0]];return w(l,v,a.localize,d)}).join("")}function Vle(e){const t=e.match(zle);return t?t[1].replace(Ble,"'"):e}function Ule(e){const t=Tn(e),n=t.getFullYear(),r=t.getMonth(),a=ti(e,0);return a.setFullYear(n,r+1,0),a.setHours(0,0,0,0),a.getDate()}function Hle(e){return Math.trunc(+Tn(e)/1e3)}function Gle(e){const t=Tn(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function qle(e,t){return Koe(Gle(e),Ds(e),t)+1}function D2(e,t){const n=Tn(e),r=Tn(t);return n.getTime()>r.getTime()}function m5(e,t){const n=Tn(e),r=Tn(t);return+n<+r}function _I(e,t){const n=Tn(e),r=Tn(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()}function Kle(e,t){const n=Tn(e),r=Tn(t);return n.getFullYear()===r.getFullYear()}function sm(e,t){return os(e,-t)}function Lk(e,t){const n=Tn(e),r=n.getFullYear(),a=n.getDate(),s=ti(e,0);s.setFullYear(r,t,15),s.setHours(0,0,0,0);const i=Ule(s);return n.setMonth(t,Math.min(a,i)),n}function m$(e,t){const n=Tn(e);return isNaN(+n)?ti(e,NaN):(n.setFullYear(t),n)}var Vt=function(){return Vt=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Vt.apply(this,arguments)};function Yle(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function f5(e,t,n){for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function Wy(e){return e.mode==="multiple"}function Vy(e){return e.mode==="range"}function Z0(e){return e.mode==="single"}var Xle={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Zle(e,t){return hr(e,"LLLL y",t)}function Qle(e,t){return hr(e,"d",t)}function Jle(e,t){return hr(e,"LLLL",t)}function eue(e){return"".concat(e)}function tue(e,t){return hr(e,"cccccc",t)}function nue(e,t){return hr(e,"yyyy",t)}var rue=Object.freeze({__proto__:null,formatCaption:Zle,formatDay:Qle,formatMonthCaption:Jle,formatWeekNumber:eue,formatWeekdayName:tue,formatYearCaption:nue}),aue=function(e,t,n){return hr(e,"do MMMM (EEEE)",n)},sue=function(){return"Month: "},iue=function(){return"Go to next month"},oue=function(){return"Go to previous month"},lue=function(e,t){return hr(e,"cccc",t)},uue=function(e){return"Week n. ".concat(e)},cue=function(){return"Year: "},due=Object.freeze({__proto__:null,labelDay:aue,labelMonthDropdown:sue,labelNext:iue,labelPrevious:oue,labelWeekNumber:uue,labelWeekday:lue,labelYearDropdown:cue});function hue(){var e="buttons",t=Xle,n=u5,r={},a={},s=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:rue,labels:due,locale:n,modifiersClassNames:r,modifiers:a,numberOfMonths:s,styles:i,today:l,mode:"default"}}function pue(e){var t=e.fromYear,n=e.toYear,r=e.fromMonth,a=e.toMonth,s=e.fromDate,i=e.toDate;return r?s=Ds(r):t&&(s=new Date(t,0,1)),a?i=SI(a):n&&(i=new Date(n,11,31)),{fromDate:s?Eo(s):void 0,toDate:i?Eo(i):void 0}}var g5=k.createContext(void 0);function mue(e){var t,n=e.initialProps,r=hue(),a=pue(n),s=a.fromDate,i=a.toDate,l=(t=n.captionLayout)!==null&&t!==void 0?t:r.captionLayout;l!=="buttons"&&(!s||!i)&&(l="buttons");var u;(Z0(n)||Wy(n)||Vy(n))&&(u=n.onSelect);var d=Vt(Vt(Vt({},r),n),{captionLayout:l,classNames:Vt(Vt({},r.classNames),n.classNames),components:Vt({},n.components),formatters:Vt(Vt({},r.formatters),n.formatters),fromDate:s,labels:Vt(Vt({},r.labels),n.labels),mode:n.mode||r.mode,modifiers:Vt(Vt({},r.modifiers),n.modifiers),modifiersClassNames:Vt(Vt({},r.modifiersClassNames),n.modifiersClassNames),onSelect:u,styles:Vt(Vt({},r.styles),n.styles),toDate:i});return o.jsx(g5.Provider,{value:d,children:e.children})}function xr(){var e=k.useContext(g5);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function x5(e){var t=xr(),n=t.locale,r=t.classNames,a=t.styles,s=t.formatters.formatCaption;return o.jsx("div",{className:r.caption_label,style:a.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:s(e.displayMonth,{locale:n})})}function fue(e){return o.jsx("svg",Vt({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:o.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function y5(e){var t,n,r=e.onChange,a=e.value,s=e.children,i=e.caption,l=e.className,u=e.style,d=xr(),c=(n=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:fue;return o.jsxs("div",{className:l,style:u,children:[o.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),o.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:a,onChange:r,children:s}),o.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,o.jsx(c,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function gue(e){var t,n=xr(),r=n.fromDate,a=n.toDate,s=n.styles,i=n.locale,l=n.formatters.formatMonthCaption,u=n.classNames,d=n.components,c=n.labels.labelMonthDropdown;if(!r)return o.jsx(o.Fragment,{});if(!a)return o.jsx(o.Fragment,{});var h=[];if(Kle(r,a))for(var p=Ds(r),m=r.getMonth();m<=a.getMonth();m++)h.push(Lk(p,m));else for(var p=Ds(new Date),m=0;m<=11;m++)h.push(Lk(p,m));var f=function(x){var y=Number(x.target.value),b=Lk(Ds(e.displayMonth),y);e.onChange(b)},g=(t=d==null?void 0:d.Dropdown)!==null&&t!==void 0?t:y5;return o.jsx(g,{name:"months","aria-label":c(),className:u.dropdown_month,style:s.dropdown_month,onChange:f,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:h.map(function(x){return o.jsx("option",{value:x.getMonth(),children:l(x,{locale:i})},x.getMonth())})})}function xue(e){var t,n=e.displayMonth,r=xr(),a=r.fromDate,s=r.toDate,i=r.locale,l=r.styles,u=r.classNames,d=r.components,c=r.formatters.formatYearCaption,h=r.labels.labelYearDropdown,p=[];if(!a)return o.jsx(o.Fragment,{});if(!s)return o.jsx(o.Fragment,{});for(var m=a.getFullYear(),f=s.getFullYear(),g=m;g<=f;g++)p.push(m$(o5(new Date),g));var x=function(b){var v=m$(Ds(n),Number(b.target.value));e.onChange(v)},y=(t=d==null?void 0:d.Dropdown)!==null&&t!==void 0?t:y5;return o.jsx(y,{name:"years","aria-label":h(),className:u.dropdown_year,style:l.dropdown_year,onChange:x,value:n.getFullYear(),caption:c(n,{locale:i}),children:p.map(function(b){return o.jsx("option",{value:b.getFullYear(),children:c(b,{locale:i})},b.getFullYear())})})}function yue(e,t){var n=k.useState(e),r=n[0],a=n[1],s=t===void 0?r:t;return[s,a]}function bue(e){var t=e.month,n=e.defaultMonth,r=e.today,a=t||n||r||new Date,s=e.toDate,i=e.fromDate,l=e.numberOfMonths,u=l===void 0?1:l;if(s&&iy(s,a)<0){var d=-1*(u-1);a=Ci(s,d)}return i&&iy(a,i)<0&&(a=i),Ds(a)}function vue(){var e=xr(),t=bue(e),n=yue(t,e.month),r=n[0],a=n[1],s=function(i){var l;if(!e.disableNavigation){var u=Ds(i);a(u),(l=e.onMonthChange)===null||l===void 0||l.call(e,u)}};return[r,s]}function wue(e,t){for(var n=t.reverseMonths,r=t.numberOfMonths,a=Ds(e),s=Ds(Ci(a,r)),i=iy(s,a),l=[],u=0;u<i;u++){var d=Ci(a,u);l.push(d)}return n&&(l=l.reverse()),l}function Nue(e,t){if(!t.disableNavigation){var n=t.toDate,r=t.pagedNavigation,a=t.numberOfMonths,s=a===void 0?1:a,i=r?s:1,l=Ds(e);if(!n)return Ci(l,i);var u=iy(n,e);if(!(u<s))return Ci(l,i)}}function kue(e,t){if(!t.disableNavigation){var n=t.fromDate,r=t.pagedNavigation,a=t.numberOfMonths,s=a===void 0?1:a,i=r?s:1,l=Ds(e);if(!n)return Ci(l,-i);var u=iy(l,n);if(!(u<=0))return Ci(l,-i)}}var b5=k.createContext(void 0);function Sue(e){var t=xr(),n=vue(),r=n[0],a=n[1],s=wue(r,t),i=Nue(r,t),l=kue(r,t),u=function(h){return s.some(function(p){return _I(h,p)})},d=function(h,p){u(h)||(p&&m5(h,p)?a(Ci(h,1+t.numberOfMonths*-1)):a(h))},c={currentMonth:r,displayMonths:s,goToMonth:a,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:u};return o.jsx(b5.Provider,{value:c,children:e.children})}function Uy(){var e=k.useContext(b5);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function f$(e){var t,n=xr(),r=n.classNames,a=n.styles,s=n.components,i=Uy().goToMonth,l=function(c){i(Ci(c,e.displayIndex?-e.displayIndex:0))},u=(t=s==null?void 0:s.CaptionLabel)!==null&&t!==void 0?t:x5,d=o.jsx(u,{id:e.id,displayMonth:e.displayMonth});return o.jsxs("div",{className:r.caption_dropdowns,style:a.caption_dropdowns,children:[o.jsx("div",{className:r.vhidden,children:d}),o.jsx(gue,{onChange:l,displayMonth:e.displayMonth}),o.jsx(xue,{onChange:l,displayMonth:e.displayMonth})]})}function Cue(e){return o.jsx("svg",Vt({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:o.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function _ue(e){return o.jsx("svg",Vt({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:o.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var qw=k.forwardRef(function(e,t){var n=xr(),r=n.classNames,a=n.styles,s=[r.button_reset,r.button];e.className&&s.push(e.className);var i=s.join(" "),l=Vt(Vt({},a.button_reset),a.button);return e.style&&Object.assign(l,e.style),o.jsx("button",Vt({},e,{ref:t,type:"button",className:i,style:l}))});function Iue(e){var t,n,r=xr(),a=r.dir,s=r.locale,i=r.classNames,l=r.styles,u=r.labels,d=u.labelPrevious,c=u.labelNext,h=r.components;if(!e.nextMonth&&!e.previousMonth)return o.jsx(o.Fragment,{});var p=d(e.previousMonth,{locale:s}),m=[i.nav_button,i.nav_button_previous].join(" "),f=c(e.nextMonth,{locale:s}),g=[i.nav_button,i.nav_button_next].join(" "),x=(t=h==null?void 0:h.IconRight)!==null&&t!==void 0?t:_ue,y=(n=h==null?void 0:h.IconLeft)!==null&&n!==void 0?n:Cue;return o.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&o.jsx(qw,{name:"previous-month","aria-label":p,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:a==="rtl"?o.jsx(x,{className:i.nav_icon,style:l.nav_icon}):o.jsx(y,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&o.jsx(qw,{name:"next-month","aria-label":f,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:a==="rtl"?o.jsx(y,{className:i.nav_icon,style:l.nav_icon}):o.jsx(x,{className:i.nav_icon,style:l.nav_icon})})]})}function g$(e){var t=xr().numberOfMonths,n=Uy(),r=n.previousMonth,a=n.nextMonth,s=n.goToMonth,i=n.displayMonths,l=i.findIndex(function(f){return _I(e.displayMonth,f)}),u=l===0,d=l===i.length-1,c=t>1&&(u||!d),h=t>1&&(d||!u),p=function(){r&&s(r)},m=function(){a&&s(a)};return o.jsx(Iue,{displayMonth:e.displayMonth,hideNext:c,hidePrevious:h,nextMonth:a,previousMonth:r,onPreviousClick:p,onNextClick:m})}function Tue(e){var t,n=xr(),r=n.classNames,a=n.disableNavigation,s=n.styles,i=n.captionLayout,l=n.components,u=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:x5,d;return a?d=o.jsx(u,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=o.jsx(f$,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=o.jsxs(o.Fragment,{children:[o.jsx(f$,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),o.jsx(g$,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=o.jsxs(o.Fragment,{children:[o.jsx(u,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),o.jsx(g$,{displayMonth:e.displayMonth,id:e.id})]}),o.jsx("div",{className:r.caption,style:s.caption,children:d})}function Eue(e){var t=xr(),n=t.footer,r=t.styles,a=t.classNames.tfoot;return n?o.jsx("tfoot",{className:a,style:r.tfoot,children:o.jsx("tr",{children:o.jsx("td",{colSpan:8,children:n})})}):o.jsx(o.Fragment,{})}function jue(e,t,n){for(var r=n?Nd(new Date):Wo(new Date,{locale:e,weekStartsOn:t}),a=[],s=0;s<7;s++){var i=os(r,s);a.push(i)}return a}function Aue(){var e=xr(),t=e.classNames,n=e.styles,r=e.showWeekNumber,a=e.locale,s=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,u=e.labels.labelWeekday,d=jue(a,s,i);return o.jsxs("tr",{style:n.head_row,className:t.head_row,children:[r&&o.jsx("td",{style:n.head_cell,className:t.head_cell}),d.map(function(c,h){return o.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":u(c,{locale:a}),children:l(c,{locale:a})},h)})]})}function Rue(){var e,t=xr(),n=t.classNames,r=t.styles,a=t.components,s=(e=a==null?void 0:a.HeadRow)!==null&&e!==void 0?e:Aue;return o.jsx("thead",{style:r.head,className:n.head,children:o.jsx(s,{})})}function Due(e){var t=xr(),n=t.locale,r=t.formatters.formatDay;return o.jsx(o.Fragment,{children:r(e.date,{locale:n})})}var II=k.createContext(void 0);function Mue(e){if(!Wy(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return o.jsx(II.Provider,{value:t,children:e.children})}return o.jsx($ue,{initialProps:e.initialProps,children:e.children})}function $ue(e){var t=e.initialProps,n=e.children,r=t.selected,a=t.min,s=t.max,i=function(d,c,h){var p,m;(p=t.onDayClick)===null||p===void 0||p.call(t,d,c,h);var f=!!(c.selected&&a&&(r==null?void 0:r.length)===a);if(!f){var g=!!(!c.selected&&s&&(r==null?void 0:r.length)===s);if(!g){var x=r?f5([],r):[];if(c.selected){var y=x.findIndex(function(b){return As(d,b)});x.splice(y,1)}else x.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,x,d,c,h)}}},l={disabled:[]};r&&l.disabled.push(function(d){var c=s&&r.length>s-1,h=r.some(function(p){return As(p,d)});return!!(c&&!h)});var u={selected:r,onDayClick:i,modifiers:l};return o.jsx(II.Provider,{value:u,children:n})}function TI(){var e=k.useContext(II);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function Fue(e,t){var n=t||{},r=n.from,a=n.to;return r&&a?As(a,e)&&As(r,e)?void 0:As(a,e)?{from:a,to:void 0}:As(r,e)?void 0:D2(r,e)?{from:e,to:a}:{from:r,to:e}:a?D2(e,a)?{from:a,to:e}:{from:e,to:a}:r?m5(e,r)?{from:e,to:r}:{from:r,to:e}:{from:e,to:void 0}}var EI=k.createContext(void 0);function Pue(e){if(!Vy(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return o.jsx(EI.Provider,{value:t,children:e.children})}return o.jsx(Oue,{initialProps:e.initialProps,children:e.children})}function Oue(e){var t=e.initialProps,n=e.children,r=t.selected,a=r||{},s=a.from,i=a.to,l=t.min,u=t.max,d=function(m,f,g){var x,y;(x=t.onDayClick)===null||x===void 0||x.call(t,m,f,g);var b=Fue(m,r);(y=t.onSelect)===null||y===void 0||y.call(t,b,m,f,g)},c={range_start:[],range_end:[],range_middle:[],disabled:[]};if(s?(c.range_start=[s],i?(c.range_end=[i],As(s,i)||(c.range_middle=[{after:s,before:i}])):c.range_end=[s]):i&&(c.range_start=[i],c.range_end=[i]),l&&(s&&!i&&c.disabled.push({after:sm(s,l-1),before:os(s,l-1)}),s&&i&&c.disabled.push({after:s,before:os(s,l-1)}),!s&&i&&c.disabled.push({after:sm(i,l-1),before:os(i,l-1)})),u){if(s&&!i&&(c.disabled.push({before:os(s,-u+1)}),c.disabled.push({after:os(s,u-1)})),s&&i){var h=jo(i,s)+1,p=u-h;c.disabled.push({before:sm(s,p)}),c.disabled.push({after:os(i,p)})}!s&&i&&(c.disabled.push({before:os(i,-u+1)}),c.disabled.push({after:os(i,u-1)}))}return o.jsx(EI.Provider,{value:{selected:r,onDayClick:d,modifiers:c},children:n})}function jI(){var e=k.useContext(EI);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Zv(e){return Array.isArray(e)?f5([],e):e!==void 0?[e]:[]}function Lue(e){var t={};return Object.entries(e).forEach(function(n){var r=n[0],a=n[1];t[r]=Zv(a)}),t}var to;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(to||(to={}));var zue=to.Selected,ll=to.Disabled,Bue=to.Hidden,Wue=to.Today,zk=to.RangeEnd,Bk=to.RangeMiddle,Wk=to.RangeStart,Vue=to.Outside;function Uue(e,t,n){var r,a=(r={},r[zue]=Zv(e.selected),r[ll]=Zv(e.disabled),r[Bue]=Zv(e.hidden),r[Wue]=[e.today],r[zk]=[],r[Bk]=[],r[Wk]=[],r[Vue]=[],r);return e.fromDate&&a[ll].push({before:e.fromDate}),e.toDate&&a[ll].push({after:e.toDate}),Wy(e)?a[ll]=a[ll].concat(t.modifiers[ll]):Vy(e)&&(a[ll]=a[ll].concat(n.modifiers[ll]),a[Wk]=n.modifiers[Wk],a[Bk]=n.modifiers[Bk],a[zk]=n.modifiers[zk]),a}var v5=k.createContext(void 0);function Hue(e){var t=xr(),n=TI(),r=jI(),a=Uue(t,n,r),s=Lue(t.modifiers),i=Vt(Vt({},a),s);return o.jsx(v5.Provider,{value:i,children:e.children})}function w5(){var e=k.useContext(v5);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Gue(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function que(e){return!!(e&&typeof e=="object"&&"from"in e)}function Kue(e){return!!(e&&typeof e=="object"&&"after"in e)}function Yue(e){return!!(e&&typeof e=="object"&&"before"in e)}function Xue(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Zue(e,t){var n,r=t.from,a=t.to;if(r&&a){var s=jo(a,r)<0;s&&(n=[a,r],r=n[0],a=n[1]);var i=jo(e,r)>=0&&jo(a,e)>=0;return i}return a?As(a,e):r?As(r,e):!1}function Que(e){return kI(e)}function Jue(e){return Array.isArray(e)&&e.every(kI)}function ece(e,t){return t.some(function(n){if(typeof n=="boolean")return n;if(Que(n))return As(e,n);if(Jue(n))return n.includes(e);if(que(n))return Zue(e,n);if(Xue(n))return n.dayOfWeek.includes(e.getDay());if(Gue(n)){var r=jo(n.before,e),a=jo(n.after,e),s=r>0,i=a<0,l=D2(n.before,n.after);return l?i&&s:s||i}return Kue(n)?jo(e,n.after)>0:Yue(n)?jo(n.before,e)>0:typeof n=="function"?n(e):!1})}function AI(e,t,n){var r=Object.keys(t).reduce(function(s,i){var l=t[i];return ece(e,l)&&s.push(i),s},[]),a={};return r.forEach(function(s){return a[s]=!0}),n&&!_I(e,n)&&(a.outside=!0),a}function tce(e,t){for(var n=Ds(e[0]),r=SI(e[e.length-1]),a,s,i=n;i<=r;){var l=AI(i,t),u=!l.disabled&&!l.hidden;if(!u){i=os(i,1);continue}if(l.selected)return i;l.today&&!s&&(s=i),a||(a=i),i=os(i,1)}return s||a}var nce=365;function N5(e,t){var n=t.moveBy,r=t.direction,a=t.context,s=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,u=a.weekStartsOn,d=a.fromDate,c=a.toDate,h=a.locale,p={day:os,week:R2,month:Ci,year:i5,startOfWeek:function(x){return a.ISOWeek?Nd(x):Wo(x,{locale:h,weekStartsOn:u})},endOfWeek:function(x){return a.ISOWeek?l5(x):CI(x,{locale:h,weekStartsOn:u})}},m=p[n](e,r==="after"?1:-1);r==="before"&&d?m=Hoe([d,m]):r==="after"&&c&&(m=Goe([c,m]));var f=!0;if(s){var g=AI(m,s);f=!g.disabled&&!g.hidden}return f?m:l.count>nce?l.lastFocused:N5(m,{moveBy:n,direction:r,context:a,modifiers:s,retry:Vt(Vt({},l),{count:l.count+1})})}var k5=k.createContext(void 0);function rce(e){var t=Uy(),n=w5(),r=k.useState(),a=r[0],s=r[1],i=k.useState(),l=i[0],u=i[1],d=tce(t.displayMonths,n),c=a??(l&&t.isDateDisplayed(l))?l:d,h=function(){u(a),s(void 0)},p=function(x){s(x)},m=xr(),f=function(x,y){if(a){var b=N5(a,{moveBy:x,direction:y,context:m,modifiers:n});As(a,b)||(t.goToDate(b,a),p(b))}},g={focusedDay:a,focusTarget:c,blur:h,focus:p,focusDayAfter:function(){return f("day","after")},focusDayBefore:function(){return f("day","before")},focusWeekAfter:function(){return f("week","after")},focusWeekBefore:function(){return f("week","before")},focusMonthBefore:function(){return f("month","before")},focusMonthAfter:function(){return f("month","after")},focusYearBefore:function(){return f("year","before")},focusYearAfter:function(){return f("year","after")},focusStartOfWeek:function(){return f("startOfWeek","before")},focusEndOfWeek:function(){return f("endOfWeek","after")}};return o.jsx(k5.Provider,{value:g,children:e.children})}function RI(){var e=k.useContext(k5);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function ace(e,t){var n=w5(),r=AI(e,n,t);return r}var DI=k.createContext(void 0);function sce(e){if(!Z0(e.initialProps)){var t={selected:void 0};return o.jsx(DI.Provider,{value:t,children:e.children})}return o.jsx(ice,{initialProps:e.initialProps,children:e.children})}function ice(e){var t=e.initialProps,n=e.children,r=function(s,i,l){var u,d,c;if((u=t.onDayClick)===null||u===void 0||u.call(t,s,i,l),i.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,s,i,l);return}(c=t.onSelect)===null||c===void 0||c.call(t,s,s,i,l)},a={selected:t.selected,onDayClick:r};return o.jsx(DI.Provider,{value:a,children:n})}function S5(){var e=k.useContext(DI);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function oce(e,t){var n=xr(),r=S5(),a=TI(),s=jI(),i=RI(),l=i.focusDayAfter,u=i.focusDayBefore,d=i.focusWeekAfter,c=i.focusWeekBefore,h=i.blur,p=i.focus,m=i.focusMonthBefore,f=i.focusMonthAfter,g=i.focusYearBefore,x=i.focusYearAfter,y=i.focusStartOfWeek,b=i.focusEndOfWeek,v=function($){var O,L,q,U;Z0(n)?(O=r.onDayClick)===null||O===void 0||O.call(r,e,t,$):Wy(n)?(L=a.onDayClick)===null||L===void 0||L.call(a,e,t,$):Vy(n)?(q=s.onDayClick)===null||q===void 0||q.call(s,e,t,$):(U=n.onDayClick)===null||U===void 0||U.call(n,e,t,$)},w=function($){var O;p(e),(O=n.onDayFocus)===null||O===void 0||O.call(n,e,t,$)},N=function($){var O;h(),(O=n.onDayBlur)===null||O===void 0||O.call(n,e,t,$)},S=function($){var O;(O=n.onDayMouseEnter)===null||O===void 0||O.call(n,e,t,$)},C=function($){var O;(O=n.onDayMouseLeave)===null||O===void 0||O.call(n,e,t,$)},_=function($){var O;(O=n.onDayPointerEnter)===null||O===void 0||O.call(n,e,t,$)},T=function($){var O;(O=n.onDayPointerLeave)===null||O===void 0||O.call(n,e,t,$)},E=function($){var O;(O=n.onDayTouchCancel)===null||O===void 0||O.call(n,e,t,$)},j=function($){var O;(O=n.onDayTouchEnd)===null||O===void 0||O.call(n,e,t,$)},I=function($){var O;(O=n.onDayTouchMove)===null||O===void 0||O.call(n,e,t,$)},D=function($){var O;(O=n.onDayTouchStart)===null||O===void 0||O.call(n,e,t,$)},F=function($){var O;(O=n.onDayKeyUp)===null||O===void 0||O.call(n,e,t,$)},P=function($){var O;switch($.key){case"ArrowLeft":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?l():u();break;case"ArrowRight":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?u():l();break;case"ArrowDown":$.preventDefault(),$.stopPropagation(),d();break;case"ArrowUp":$.preventDefault(),$.stopPropagation(),c();break;case"PageUp":$.preventDefault(),$.stopPropagation(),$.shiftKey?g():m();break;case"PageDown":$.preventDefault(),$.stopPropagation(),$.shiftKey?x():f();break;case"Home":$.preventDefault(),$.stopPropagation(),y();break;case"End":$.preventDefault(),$.stopPropagation(),b();break}(O=n.onDayKeyDown)===null||O===void 0||O.call(n,e,t,$)},V={onClick:v,onFocus:w,onBlur:N,onKeyDown:P,onKeyUp:F,onMouseEnter:S,onMouseLeave:C,onPointerEnter:_,onPointerLeave:T,onTouchCancel:E,onTouchEnd:j,onTouchMove:I,onTouchStart:D};return V}function lce(){var e=xr(),t=S5(),n=TI(),r=jI(),a=Z0(e)?t.selected:Wy(e)?n.selected:Vy(e)?r.selected:void 0;return a}function uce(e){return Object.values(to).includes(e)}function cce(e,t){var n=[e.classNames.day];return Object.keys(t).forEach(function(r){var a=e.modifiersClassNames[r];if(a)n.push(a);else if(uce(r)){var s=e.classNames["day_".concat(r)];s&&n.push(s)}}),n}function dce(e,t){var n=Vt({},e.styles.day);return Object.keys(t).forEach(function(r){var a;n=Vt(Vt({},n),(a=e.modifiersStyles)===null||a===void 0?void 0:a[r])}),n}function hce(e,t,n){var r,a,s,i=xr(),l=RI(),u=ace(e,t),d=oce(e,u),c=lce(),h=!!(i.onDayClick||i.mode!=="default");k.useEffect(function(){var S;u.outside||l.focusedDay&&h&&As(l.focusedDay,e)&&((S=n.current)===null||S===void 0||S.focus())},[l.focusedDay,e,n,h,u.outside]);var p=cce(i,u).join(" "),m=dce(i,u),f=!!(u.outside&&!i.showOutsideDays||u.hidden),g=(s=(a=i.components)===null||a===void 0?void 0:a.DayContent)!==null&&s!==void 0?s:Due,x=o.jsx(g,{date:e,displayMonth:t,activeModifiers:u}),y={style:m,className:p,children:x,role:"gridcell"},b=l.focusTarget&&As(l.focusTarget,e)&&!u.outside,v=l.focusedDay&&As(l.focusedDay,e),w=Vt(Vt(Vt({},y),(r={disabled:u.disabled,role:"gridcell"},r["aria-selected"]=u.selected,r.tabIndex=v||b?0:-1,r)),d),N={isButton:h,isHidden:f,activeModifiers:u,selectedDays:c,buttonProps:w,divProps:y};return N}function pce(e){var t=k.useRef(null),n=hce(e.date,e.displayMonth,t);return n.isHidden?o.jsx("div",{role:"gridcell"}):n.isButton?o.jsx(qw,Vt({name:"day",ref:t},n.buttonProps)):o.jsx("div",Vt({},n.divProps))}function mce(e){var t=e.number,n=e.dates,r=xr(),a=r.onWeekNumberClick,s=r.styles,i=r.classNames,l=r.locale,u=r.labels.labelWeekNumber,d=r.formatters.formatWeekNumber,c=d(Number(t),{locale:l});if(!a)return o.jsx("span",{className:i.weeknumber,style:s.weeknumber,children:c});var h=u(Number(t),{locale:l}),p=function(m){a(t,n,m)};return o.jsx(qw,{name:"week-number","aria-label":h,className:i.weeknumber,style:s.weeknumber,onClick:p,children:c})}function fce(e){var t,n,r=xr(),a=r.styles,s=r.classNames,i=r.showWeekNumber,l=r.components,u=(t=l==null?void 0:l.Day)!==null&&t!==void 0?t:pce,d=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:mce,c;return i&&(c=o.jsx("td",{className:s.cell,style:a.cell,children:o.jsx(d,{number:e.weekNumber,dates:e.dates})})),o.jsxs("tr",{className:s.row,style:a.row,children:[c,e.dates.map(function(h){return o.jsx("td",{className:s.cell,style:a.cell,role:"presentation",children:o.jsx(u,{displayMonth:e.displayMonth,date:h})},Hle(h))})]})}function x$(e,t,n){for(var r=n!=null&&n.ISOWeek?l5(t):CI(t,n),a=n!=null&&n.ISOWeek?Nd(e):Wo(e,n),s=jo(r,a),i=[],l=0;l<=s;l++)i.push(os(a,l));var u=i.reduce(function(d,c){var h=n!=null&&n.ISOWeek?c5(c):h5(c,n),p=d.find(function(m){return m.weekNumber===h});return p?(p.dates.push(c),d):(d.push({weekNumber:h,dates:[c]}),d)},[]);return u}function gce(e,t){var n=x$(Ds(e),SI(e),t);if(t!=null&&t.useFixedWeeks){var r=qle(e,t);if(r<6){var a=n[n.length-1],s=a.dates[a.dates.length-1],i=R2(s,6-r),l=x$(R2(s,1),i,t);n.push.apply(n,l)}}return n}function xce(e){var t,n,r,a=xr(),s=a.locale,i=a.classNames,l=a.styles,u=a.hideHead,d=a.fixedWeeks,c=a.components,h=a.weekStartsOn,p=a.firstWeekContainsDate,m=a.ISOWeek,f=gce(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:s,weekStartsOn:h,firstWeekContainsDate:p}),g=(t=c==null?void 0:c.Head)!==null&&t!==void 0?t:Rue,x=(n=c==null?void 0:c.Row)!==null&&n!==void 0?n:fce,y=(r=c==null?void 0:c.Footer)!==null&&r!==void 0?r:Eue;return o.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!u&&o.jsx(g,{}),o.jsx("tbody",{className:i.tbody,style:l.tbody,children:f.map(function(b){return o.jsx(x,{displayMonth:e.displayMonth,dates:b.dates,weekNumber:b.weekNumber},b.weekNumber)})}),o.jsx(y,{displayMonth:e.displayMonth})]})}function yce(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var bce=yce()?k.useLayoutEffect:k.useEffect,Vk=!1,vce=0;function y$(){return"react-day-picker-".concat(++vce)}function wce(e){var t,n=e??(Vk?y$():null),r=k.useState(n),a=r[0],s=r[1];return bce(function(){a===null&&s(y$())},[]),k.useEffect(function(){Vk===!1&&(Vk=!0)},[]),(t=e??a)!==null&&t!==void 0?t:void 0}function Nce(e){var t,n,r=xr(),a=r.dir,s=r.classNames,i=r.styles,l=r.components,u=Uy().displayMonths,d=wce(r.id?"".concat(r.id,"-").concat(e.displayIndex):void 0),c=r.id?"".concat(r.id,"-grid-").concat(e.displayIndex):void 0,h=[s.month],p=i.month,m=e.displayIndex===0,f=e.displayIndex===u.length-1,g=!m&&!f;a==="rtl"&&(t=[m,f],f=t[0],m=t[1]),m&&(h.push(s.caption_start),p=Vt(Vt({},p),i.caption_start)),f&&(h.push(s.caption_end),p=Vt(Vt({},p),i.caption_end)),g&&(h.push(s.caption_between),p=Vt(Vt({},p),i.caption_between));var x=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:Tue;return o.jsxs("div",{className:h.join(" "),style:p,children:[o.jsx(x,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),o.jsx(xce,{id:c,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function kce(e){var t=xr(),n=t.classNames,r=t.styles;return o.jsx("div",{className:n.months,style:r.months,children:e.children})}function Sce(e){var t,n,r=e.initialProps,a=xr(),s=RI(),i=Uy(),l=k.useState(!1),u=l[0],d=l[1];k.useEffect(function(){a.initialFocus&&s.focusTarget&&(u||(s.focus(s.focusTarget),d(!0)))},[a.initialFocus,u,s.focus,s.focusTarget,s]);var c=[a.classNames.root,a.className];a.numberOfMonths>1&&c.push(a.classNames.multiple_months),a.showWeekNumber&&c.push(a.classNames.with_weeknumber);var h=Vt(Vt({},a.styles.root),a.style),p=Object.keys(r).filter(function(f){return f.startsWith("data-")}).reduce(function(f,g){var x;return Vt(Vt({},f),(x={},x[g]=r[g],x))},{}),m=(n=(t=r.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:kce;return o.jsx("div",Vt({className:c.join(" "),style:h,dir:a.dir,id:a.id,nonce:r.nonce,title:r.title,lang:r.lang},p,{children:o.jsx(m,{children:i.displayMonths.map(function(f,g){return o.jsx(Nce,{displayIndex:g,displayMonth:f},g)})})}))}function Cce(e){var t=e.children,n=Yle(e,["children"]);return o.jsx(mue,{initialProps:n,children:o.jsx(Sue,{children:o.jsx(sce,{initialProps:n,children:o.jsx(Mue,{initialProps:n,children:o.jsx(Pue,{initialProps:n,children:o.jsx(Hue,{children:o.jsx(rce,{children:t})})})})})})})}function _ce(e){return o.jsx(Cce,Vt({},e,{children:o.jsx(Sce,{initialProps:e})}))}function Kw({className:e,classNames:t,showOutsideDays:n=!0,...r}){return o.jsx(_ce,{showOutsideDays:n,className:Ie("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Ie(Kx({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Ie(Kx({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...a})=>o.jsx(N3,{className:"h-4 w-4"}),IconRight:({...a})=>o.jsx(Hx,{className:"h-4 w-4"})},...r})}Kw.displayName="Calendar";const Ice=[{name:"Hot",color:"#ef4444"},{name:"Warm",color:"#f97316"},{name:"Cold",color:"#3b82f6"},{name:"Client",color:"#22c55e"},{name:"Follow-up",color:"#a855f7"}];let Uk=!1;const C5="synka_tags_cache",Hk=e=>{try{const t=localStorage.getItem(`${C5}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},Tce=(e,t)=>{try{localStorage.setItem(`${C5}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function _5(){const{user:e}=ir(),[t,n]=k.useState(()=>e?Hk(e.id):[]),[r,a]=k.useState(()=>e?Hk(e.id).length===0:!1);k.useEffect(()=>{if(e){const c=Hk(e.id);c.length>0&&t.length===0&&(n(c),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:c,error:h}=await le.from("tags").select("*").eq("user_id",e.id).order("created_at",{ascending:!0});h?(console.error("Error fetching tags:",h),n([])):c&&c.length===0?Uk||(Uk=!0,await i(),Uk=!1):(n(c),e&&Tce(e.id,c)),a(!1)},i=async()=>{if(!e)return;const c=Ice.map(m=>({...m,user_id:e.id})),{data:h,error:p}=await le.from("tags").insert(c).select();p?console.error("Error seeding tags:",p):n(h)};return{tags:t,loading:r,createTag:async(c,h)=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await le.from("tags").insert({user_id:e.id,name:c,color:h||"#6366f1"}).select().single();return!m&&p&&n(f=>[...f,p]),{data:p,error:m}},deleteTag:async c=>{const{error:h}=await le.from("tags").delete().eq("id",c);return h||n(p=>p.filter(m=>m.id!==c)),{error:h}},updateTag:async(c,h)=>{const{error:p}=await le.from("tags").update(h).eq("id",c);return p||n(m=>m.map(f=>f.id===c?{...f,...h}:f)),{error:p}},refetch:s}}const Ece=()=>{const e=new Date("2026-01-01T10:00:00+05:30"),t=new Date("2026-01-01T17:00:00+05:30");return[{title:"Networking Meetup",description:"Local business networking event",start_time:e.toISOString(),end_time:t.toISOString()}]};let Gk=!1;const I5="synka_events_cache",qk=e=>{try{const t=localStorage.getItem(`${I5}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},jce=(e,t)=>{try{localStorage.setItem(`${I5}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function MI(){const{user:e}=ir(),[t,n]=k.useState(()=>e?qk(e.id):[]),[r,a]=k.useState(()=>e?qk(e.id).length===0:!1);k.useEffect(()=>{if(e){const h=qk(e.id);h.length>0&&t.length===0&&(n(h),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:h,error:p}=await le.from("events").select("*").eq("user_id",e.id).order("start_time",{ascending:!1});p?(console.error("Error fetching events:",p),n([])):h&&h.length===0?Gk||(Gk=!0,await i(),Gk=!1):(n(h),e&&jce(e.id,h)),a(!1)},i=async()=>{if(!e)return;const h=Ece().map(f=>({...f,user_id:e.id})),{data:p,error:m}=await le.from("events").insert(h).select();m?console.error("Error seeding events:",m):n(p)};return{events:t,loading:r,addEvent:async h=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await le.from("events").insert({...h,user_id:e.id,start_time:h.start_time||new Date().toISOString()}).select().single();return!m&&p&&n(f=>[p,...f]),{data:p,error:m}},updateEvent:async(h,p)=>{const{error:m}=await le.from("events").update(p).eq("id",h);return m||n(f=>f.map(g=>g.id===h?{...g,...p}:g)),{error:m}},deleteEvent:async h=>{const{error:p}=await le.from("events").delete().eq("id",h);return p||n(m=>m.filter(f=>f.id!==h)),{error:p}},getActiveEventsForDate:h=>t.filter(p=>{const m=new Date(p.start_time),f=p.end_time?new Date(p.end_time):m;return h>=m&&h<=f}),refetch:s}}const Ace=Object.freeze(Object.defineProperty({__proto__:null,useEvents:MI},Symbol.toStringTag,{value:"Module"})),Rce=[{name:"Introduction",channel:"whatsapp",subject:null,body:`Hi {{name}}, It was nice connecting with you.
Sharing my details here: My Digital Card {{myCardLink}}
Happy to stay in touch.

{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Follow-up",channel:"whatsapp",subject:null,body:`Hello {{name}}, I hope you are keeping well.
Would be glad to connect at a time convenient for you.

{{myName}}
My Digital Card {{myCardLink}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Introduction",channel:"email",subject:"Connecting after our introduction",body:`Hello {{name}},

It was a pleasure connecting with you.

Please find my contact details below.
My Digital Card {{myCardLink}}

I look forward to continuing the conversation.

Warm regards,
{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Follow-up",channel:"email",subject:"Connecting further",body:`Hello {{name}},

I hope you are keeping well.
I thought this might be a good moment to reconnect.
Would be glad to connect at a time convenient for you.

My Digital Card {{myCardLink}}

Kind regards,
{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1}],b$=e=>{const t=[{regex:/\b(their|the|recipient's?)\s*(name|first\s*name)\b/gi,placeholder:"{{name}}"},{regex:/\b(their|the|recipient's?)\s*(company|organization|firm)\b/gi,placeholder:"{{company}}"},{regex:/\b(their|the|recipient's?)\s*(title|designation|role|position)\b/gi,placeholder:"{{designation}}"},{regex:/\b(my|your|sender's?)\s*(name|first\s*name)\b/gi,placeholder:"{{myName}}"},{regex:/\b(my|your|sender's?)\s*(company|organization|firm)\b/gi,placeholder:"{{myCompany}}"}];let n=e;return t.forEach(({regex:r,placeholder:a})=>{n=n.replace(r,a)}),n};let Kk=!1;const T5="synka_templates_cache",Yk=e=>{try{const t=localStorage.getItem(`${T5}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},Dce=(e,t)=>{try{localStorage.setItem(`${T5}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function E5(){const{user:e}=ir(),[t,n]=k.useState(()=>e?Yk(e.id):[]),[r,a]=k.useState(()=>e?Yk(e.id).length===0:!1);k.useEffect(()=>{if(e){const f=Yk(e.id);f.length>0&&t.length===0&&(n(f),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:f,error:g}=await le.from("contact_templates").select("*").eq("user_id",e.id).order("created_at",{ascending:!0});g?(console.error("Error fetching templates:",g),n([])):f&&f.length===0?Kk||(Kk=!0,await i(),Kk=!1):(n(f),e&&Dce(e.id,f)),a(!1)},i=async()=>{if(!e)return;const f=Rce.map(y=>({...y,user_id:e.id})),{data:g,error:x}=await le.from("contact_templates").insert(f).select();x?console.error("Error seeding templates:",x):n(g)};return{templates:t,loading:r,addTemplate:async f=>{if(!e)return{error:new Error("Not authenticated")};const g={...f,body:b$(f.body),subject:f.subject?b$(f.subject):null},{data:x,error:y}=await le.from("contact_templates").insert({...g,user_id:e.id}).select().single();return!y&&x&&n(b=>[...b,x]),{data:x,error:y}},updateTemplate:async(f,g)=>{const{error:x}=await le.from("contact_templates").update(g).eq("id",f);return x||n(y=>y.map(b=>b.id===f?{...b,...g}:b)),{error:x}},deleteTemplate:async f=>{const{error:g}=await le.from("contact_templates").delete().eq("id",f);return g||n(x=>x.filter(y=>y.id!==f)),{error:g}},getEmailTemplates:()=>t.filter(f=>f.channel==="email"||f.channel==="both"),getWhatsappTemplates:()=>t.filter(f=>f.channel==="whatsapp"||f.channel==="both"),getSelectedEmailTemplate:()=>t.find(f=>f.is_selected_for_email),getSelectedWhatsappTemplate:()=>t.find(f=>f.is_selected_for_whatsapp),refetch:s}}const j5="synka_signatures_cache",Xk=e=>{try{const t=localStorage.getItem(`${j5}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},Mce=(e,t)=>{try{localStorage.setItem(`${j5}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function A5(){const{user:e}=ir(),[t,n]=k.useState(()=>e?Xk(e.id):[]),[r,a]=k.useState(()=>e?Xk(e.id).length===0:!1);k.useEffect(()=>{if(e){const h=Xk(e.id);h.length>0&&t.length===0&&(n(h),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:h,error:p}=await le.from("email_signatures").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});p?(console.error("Error fetching signatures:",p),n([])):(n(h),e&&Mce(e.id,h)),a(!1)};return{signatures:t,loading:r,addSignature:async h=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await le.from("email_signatures").insert({...h,user_id:e.id}).select().single();return!m&&p&&n(f=>[p,...f]),{data:p,error:m}},updateSignature:async(h,p)=>{const{error:m}=await le.from("email_signatures").update(p).eq("id",h);return m||n(f=>f.map(g=>g.id===h?{...g,...p}:g)),{error:m}},deleteSignature:async h=>{const{error:p}=await le.from("email_signatures").delete().eq("id",h);return p||n(m=>m.filter(f=>f.id!==h)),{error:p}},selectSignature:async h=>{if(!e)return{error:new Error("Not authenticated")};await le.from("email_signatures").update({is_selected:!1}).eq("user_id",e.id);const{error:p}=await le.from("email_signatures").update({is_selected:!0}).eq("id",h);return p||n(m=>m.map(f=>({...f,is_selected:f.id===h}))),{error:p}},getSelectedSignature:()=>t.find(h=>h.is_selected),refetch:s}}function $ce(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}const Fce=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Tu(e){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n]);return t}let Dp=null;function R5(e={}){return Dp||(e.includeStyleProperties?(Dp=e.includeStyleProperties,Dp):(Dp=Tu(window.getComputedStyle(document.documentElement)),Dp))}function Yw(e,t){const r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function Pce(e){const t=Yw(e,"border-left-width"),n=Yw(e,"border-right-width");return e.clientWidth+t+n}function Oce(e){const t=Yw(e,"border-top-width"),n=Yw(e,"border-bottom-width");return e.clientHeight+t+n}function D5(e,t={}){const n=t.width||Pce(e),r=t.height||Oce(e);return{width:n,height:r}}function Lce(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const Us=16384;function zce(e){(e.width>Us||e.height>Us)&&(e.width>Us&&e.height>Us?e.width>e.height?(e.height*=Us/e.width,e.width=Us):(e.width*=Us/e.height,e.height=Us):e.width>Us?(e.height*=Us/e.width,e.width=Us):(e.width*=Us/e.height,e.height=Us))}function Xw(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>{r.decode().then(()=>{requestAnimationFrame(()=>t(r))})},r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=e})}async function Bce(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Wce(e,t,n){const r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${n}`),a.setAttribute("viewBox",`0 0 ${t} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),a.appendChild(s),s.appendChild(e),Bce(a)}const Ms=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return n===null?!1:n.constructor.name===t.name||Ms(n,t)};function Vce(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Uce(e,t){return R5(t).map(n=>{const r=e.getPropertyValue(n),a=e.getPropertyPriority(n);return`${n}: ${r}${a?" !important":""};`}).join(" ")}function Hce(e,t,n,r){const a=`.${e}:${t}`,s=n.cssText?Vce(n):Uce(n,r);return document.createTextNode(`${a}{${s}}`)}function v$(e,t,n,r){const a=window.getComputedStyle(e,n),s=a.getPropertyValue("content");if(s===""||s==="none")return;const i=Fce();try{t.className=`${t.className} ${i}`}catch{return}const l=document.createElement("style");l.appendChild(Hce(i,n,a,r)),t.appendChild(l)}function Gce(e,t,n){v$(e,t,":before",n),v$(e,t,":after",n)}const w$="application/font-woff",N$="image/jpeg",qce={woff:w$,woff2:w$,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:N$,jpeg:N$,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Kce(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function $I(e){const t=Kce(e).toLowerCase();return qce[t]||""}function Yce(e){return e.split(/,/)[1]}function M2(e){return e.search(/^(data:)/)!==-1}function Xce(e,t){return`data:${t};base64,${e}`}async function M5(e,t,n){const r=await fetch(e,t);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const a=await r.blob();return new Promise((s,i)=>{const l=new FileReader;l.onerror=i,l.onloadend=()=>{try{s(n({res:r,result:l.result}))}catch(u){i(u)}},l.readAsDataURL(a)})}const Zk={};function Zce(e,t,n){let r=e.replace(/\?.*/,"");return n&&(r=e),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),t?`[${t}]${r}`:r}async function FI(e,t,n){const r=Zce(e,t,n.includeQueryParams);if(Zk[r]!=null)return Zk[r];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{const s=await M5(e,n.fetchRequestInit,({res:i,result:l})=>(t||(t=i.headers.get("Content-Type")||""),Yce(l)));a=Xce(s,t)}catch(s){a=n.imagePlaceholder||"";let i=`Failed to fetch resource: ${e}`;s&&(i=typeof s=="string"?s:s.message),i&&console.warn(i)}return Zk[r]=a,a}async function Qce(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):Xw(t)}async function Jce(e,t){if(e.currentSrc){const s=document.createElement("canvas"),i=s.getContext("2d");s.width=e.clientWidth,s.height=e.clientHeight,i==null||i.drawImage(e,0,0,s.width,s.height);const l=s.toDataURL();return Xw(l)}const n=e.poster,r=$I(n),a=await FI(n,r,t);return Xw(a)}async function ede(e,t){var n;try{if(!((n=e==null?void 0:e.contentDocument)===null||n===void 0)&&n.body)return await Q0(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function tde(e,t){return Ms(e,HTMLCanvasElement)?Qce(e):Ms(e,HTMLVideoElement)?Jce(e,t):Ms(e,HTMLIFrameElement)?ede(e,t):e.cloneNode($5(e))}const nde=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",$5=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function rde(e,t,n){var r,a;if($5(t))return t;let s=[];return nde(e)&&e.assignedNodes?s=Tu(e.assignedNodes()):Ms(e,HTMLIFrameElement)&&(!((r=e.contentDocument)===null||r===void 0)&&r.body)?s=Tu(e.contentDocument.body.childNodes):s=Tu(((a=e.shadowRoot)!==null&&a!==void 0?a:e).childNodes),s.length===0||Ms(e,HTMLVideoElement)||await s.reduce((i,l)=>i.then(()=>Q0(l,n)).then(u=>{u&&t.appendChild(u)}),Promise.resolve()),t}function ade(e,t,n){const r=t.style;if(!r)return;const a=window.getComputedStyle(e);a.cssText?(r.cssText=a.cssText,r.transformOrigin=a.transformOrigin):R5(n).forEach(s=>{let i=a.getPropertyValue(s);s==="font-size"&&i.endsWith("px")&&(i=`${Math.floor(parseFloat(i.substring(0,i.length-2)))-.1}px`),Ms(e,HTMLIFrameElement)&&s==="display"&&i==="inline"&&(i="block"),s==="d"&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),r.setProperty(s,i,a.getPropertyPriority(s))})}function sde(e,t){Ms(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),Ms(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function ide(e,t){if(Ms(e,HTMLSelectElement)){const n=t,r=Array.from(n.children).find(a=>e.value===a.getAttribute("value"));r&&r.setAttribute("selected","")}}function ode(e,t,n){return Ms(t,Element)&&(ade(e,t,n),Gce(e,t,n),sde(e,t),ide(e,t)),t}async function lde(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const r={};for(let s=0;s<n.length;s++){const l=n[s].getAttribute("xlink:href");if(l){const u=e.querySelector(l),d=document.querySelector(l);!u&&d&&!r[l]&&(r[l]=await Q0(d,t,!0))}}const a=Object.values(r);if(a.length){const s="http://www.w3.org/1999/xhtml",i=document.createElementNS(s,"svg");i.setAttribute("xmlns",s),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.overflow="hidden",i.style.display="none";const l=document.createElementNS(s,"defs");i.appendChild(l);for(let u=0;u<a.length;u++)l.appendChild(a[u]);e.appendChild(i)}return e}async function Q0(e,t,n){return!n&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(r=>tde(r,t)).then(r=>rde(e,r,t)).then(r=>ode(e,r,t)).then(r=>lde(r,t))}const F5=/url\((['"]?)([^'"]+?)\1\)/g,ude=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,cde=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function dde(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function hde(e){const t=[];return e.replace(F5,(n,r,a)=>(t.push(a),n)),t.filter(n=>!M2(n))}async function pde(e,t,n,r,a){try{const s=n?$ce(t,n):t,i=$I(t);let l;return a||(l=await FI(s,i,r)),e.replace(dde(t),`$1${l}$3`)}catch{}return e}function mde(e,{preferredFontFormat:t}){return t?e.replace(cde,n=>{for(;;){const[r,,a]=ude.exec(n)||[];if(!a)return"";if(a===t)return`src: ${r};`}}):e}function P5(e){return e.search(F5)!==-1}async function O5(e,t,n){if(!P5(e))return e;const r=mde(e,n);return hde(r).reduce((s,i)=>s.then(l=>pde(l,i,t,n)),Promise.resolve(r))}async function Mp(e,t,n){var r;const a=(r=t.style)===null||r===void 0?void 0:r.getPropertyValue(e);if(a){const s=await O5(a,null,n);return t.style.setProperty(e,s,t.style.getPropertyPriority(e)),!0}return!1}async function fde(e,t){await Mp("background",e,t)||await Mp("background-image",e,t),await Mp("mask",e,t)||await Mp("-webkit-mask",e,t)||await Mp("mask-image",e,t)||await Mp("-webkit-mask-image",e,t)}async function gde(e,t){const n=Ms(e,HTMLImageElement);if(!(n&&!M2(e.src))&&!(Ms(e,SVGImageElement)&&!M2(e.href.baseVal)))return;const r=n?e.src:e.href.baseVal,a=await FI(r,$I(r),t);await new Promise((s,i)=>{e.onload=s,e.onerror=t.onImageErrorHandler?(...u)=>{try{s(t.onImageErrorHandler(...u))}catch(d){i(d)}}:i;const l=e;l.decode&&(l.decode=s),l.loading==="lazy"&&(l.loading="eager"),n?(e.srcset="",e.src=a):e.href.baseVal=a})}async function xde(e,t){const r=Tu(e.childNodes).map(a=>L5(a,t));await Promise.all(r).then(()=>e)}async function L5(e,t){Ms(e,Element)&&(await fde(e,t),await gde(e,t),await xde(e,t))}function yde(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(a=>{n[a]=r[a]}),e}const k$={};async function S$(e){let t=k$[e];if(t!=null)return t;const r=await(await fetch(e)).text();return t={url:e,cssText:r},k$[e]=t,t}async function C$(e,t){let n=e.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(n.match(/url\([^)]+\)/g)||[]).map(async i=>{let l=i.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),M5(l,t.fetchRequestInit,({result:u})=>(n=n.replace(i,`url(${u})`),[i,u]))});return Promise.all(s).then(()=>n)}function _$(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const u=a.exec(r);if(u===null)break;t.push(u[0])}r=r.replace(a,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(i,"gi");for(;;){let u=s.exec(r);if(u===null){if(u=l.exec(r),u===null)break;s.lastIndex=l.lastIndex}else l.lastIndex=s.lastIndex;t.push(u[0])}return t}async function bde(e,t){const n=[],r=[];return e.forEach(a=>{if("cssRules"in a)try{Tu(a.cssRules||[]).forEach((s,i)=>{if(s.type===CSSRule.IMPORT_RULE){let l=i+1;const u=s.href,d=S$(u).then(c=>C$(c,t)).then(c=>_$(c).forEach(h=>{try{a.insertRule(h,h.startsWith("@import")?l+=1:a.cssRules.length)}catch(p){console.error("Error inserting rule from remote css",{rule:h,error:p})}})).catch(c=>{console.error("Error loading remote css",c.toString())});r.push(d)}})}catch(s){const i=e.find(l=>l.href==null)||document.styleSheets[0];a.href!=null&&r.push(S$(a.href).then(l=>C$(l,t)).then(l=>_$(l).forEach(u=>{i.insertRule(u,i.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(e.forEach(a=>{if("cssRules"in a)try{Tu(a.cssRules||[]).forEach(s=>{n.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${a.href}`,s)}}),n))}function vde(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>P5(t.style.getPropertyValue("src")))}async function wde(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=Tu(e.ownerDocument.styleSheets),r=await bde(n,t);return vde(r)}function z5(e){return e.trim().replace(/["']/g,"")}function Nde(e){const t=new Set;function n(r){(r.style.fontFamily||getComputedStyle(r).fontFamily).split(",").forEach(s=>{t.add(z5(s))}),Array.from(r.children).forEach(s=>{s instanceof HTMLElement&&n(s)})}return n(e),t}async function kde(e,t){const n=await wde(e,t),r=Nde(e);return(await Promise.all(n.filter(s=>r.has(z5(s.style.fontFamily))).map(s=>{const i=s.parentStyleSheet?s.parentStyleSheet.href:null;return O5(s.cssText,i,t)}))).join(`
`)}async function Sde(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await kde(e,t);if(n){const r=document.createElement("style"),a=document.createTextNode(n);r.appendChild(a),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r)}}async function Cde(e,t={}){const{width:n,height:r}=D5(e,t),a=await Q0(e,t,!0);return await Sde(a,t),await L5(a,t),yde(a,t),await Wce(a,n,r)}async function _de(e,t={}){const{width:n,height:r}=D5(e,t),a=await Cde(e,t),s=await Xw(a),i=document.createElement("canvas"),l=i.getContext("2d"),u=t.pixelRatio||Lce(),d=t.canvasWidth||n,c=t.canvasHeight||r;return i.width=d*u,i.height=c*u,t.skipAutoScale||zce(i),i.style.width=`${d}`,i.style.height=`${c}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,i.width,i.height)),l.drawImage(s,0,0,i.width,i.height),i}async function $2(e,t={}){return(await _de(e,t)).toDataURL()}function Ide(e){e.CapacitorUtils.Synapse=new Proxy({},{get(t,n){return new Proxy({},{get(r,a){return(s,i,l)=>{const u=e.Capacitor.Plugins[n];if(u===void 0){l(new Error(`Capacitor plugin ${n} not found`));return}if(typeof u[a]!="function"){l(new Error(`Method ${a} not found in Capacitor plugin ${n}`));return}(async()=>{try{const d=await u[a](s);i(d)}catch(d){l(d)}})()}}})}})}function Tde(e){e.CapacitorUtils.Synapse=new Proxy({},{get(t,n){return e.cordova.plugins[n]}})}function Ede(e=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!e?Ide(window):window.cordova!==void 0&&Tde(window))}var id;(function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",e.ExternalCache="EXTERNAL_CACHE",e.LibraryNoCloud="LIBRARY_NO_CLOUD",e.Temporary="TEMPORARY"})(id||(id={}));var I$;(function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"})(I$||(I$={}));const Ox=lf("Filesystem",{web:()=>Qu(()=>import("./web-D7SQYno4.js"),__vite__mapDeps([7,1,2,3])).then(e=>new e.FilesystemWeb)});Ede();var J0="Switch",[jde]=qo(J0),[Ade,Rde]=jde(J0),B5=k.forwardRef((e,t)=>{const{__scopeSwitch:n,name:r,checked:a,defaultChecked:s,required:i,disabled:l,value:u="on",onCheckedChange:d,form:c,...h}=e,[p,m]=k.useState(null),f=sr(t,v=>m(v)),g=k.useRef(!1),x=p?c||!!p.closest("form"):!0,[y,b]=Sl({prop:a,defaultProp:s??!1,onChange:d,caller:J0});return o.jsxs(Ade,{scope:n,checked:y,disabled:l,children:[o.jsx(An.button,{type:"button",role:"switch","aria-checked":y,"aria-required":i,"data-state":H5(y),"data-disabled":l?"":void 0,disabled:l,value:u,...h,ref:f,onClick:yn(e.onClick,v=>{b(w=>!w),x&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})}),x&&o.jsx(U5,{control:p,bubbles:!g.current,name:r,value:u,checked:y,required:i,disabled:l,form:c,style:{transform:"translateX(-100%)"}})]})});B5.displayName=J0;var W5="SwitchThumb",V5=k.forwardRef((e,t)=>{const{__scopeSwitch:n,...r}=e,a=Rde(W5,n);return o.jsx(An.span,{"data-state":H5(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:t})});V5.displayName=W5;var Dde="SwitchBubbleInput",U5=k.forwardRef(({__scopeSwitch:e,control:t,checked:n,bubbles:r=!0,...a},s)=>{const i=k.useRef(null),l=sr(i,s),u=K0(n),d=r_(t);return k.useEffect(()=>{const c=i.current;if(!c)return;const h=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(h,"checked").set;if(u!==n&&m){const f=new Event("click",{bubbles:r});m.call(c,n),c.dispatchEvent(f)}},[u,n,r]),o.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:l,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});U5.displayName=Dde;function H5(e){return e?"checked":"unchecked"}var G5=B5,Mde=V5;const vu=k.forwardRef(({className:e,...t},n)=>o.jsx(G5,{className:Ie("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:n,children:o.jsx(Mde,{className:Ie("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));vu.displayName=G5.displayName;function $de(e){const t=Fde(e),n=k.forwardRef((r,a)=>{const{children:s,...i}=r,l=k.Children.toArray(s),u=l.find(Ode);if(u){const d=u.props.children,c=l.map(h=>h===u?k.Children.count(d)>1?k.Children.only(null):k.isValidElement(d)?d.props.children:null:h);return o.jsx(t,{...i,ref:a,children:k.isValidElement(d)?k.cloneElement(d,void 0,c):null})}return o.jsx(t,{...i,ref:a,children:s})});return n.displayName=`${e}.Slot`,n}function Fde(e){const t=k.forwardRef((n,r)=>{const{children:a,...s}=n;if(k.isValidElement(a)){const i=zde(a),l=Lde(s,a.props);return a.type!==k.Fragment&&(l.ref=r?JC(r,i):i),k.cloneElement(a,l)}return k.Children.count(a)>1?k.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var Pde=Symbol("radix.slottable");function Ode(e){return k.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Pde}function Lde(e,t){const n={...t};for(const r in t){const a=e[r],s=t[r];/^on[A-Z]/.test(r)?a&&s?n[r]=(...l)=>{const u=s(...l);return a(...l),u}:a&&(n[r]=a):r==="style"?n[r]={...a,...s}:r==="className"&&(n[r]=[a,s].filter(Boolean).join(" "))}return{...e,...n}}function zde(e){var r,a;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(a=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:a.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Bde=[" ","Enter","ArrowUp","ArrowDown"],Wde=[" ","Enter"],kd="Select",[e1,t1,Vde]=h3(kd),[pf]=qo(kd,[Vde,P0]),n1=P0(),[Ude,tc]=pf(kd),[Hde,Gde]=pf(kd),q5=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:a,onOpenChange:s,value:i,defaultValue:l,onValueChange:u,dir:d,name:c,autoComplete:h,disabled:p,required:m,form:f}=e,g=n1(t),[x,y]=k.useState(null),[b,v]=k.useState(null),[w,N]=k.useState(!1),S=F0(d),[C,_]=Sl({prop:r,defaultProp:a??!1,onChange:s,caller:kd}),[T,E]=Sl({prop:i,defaultProp:l,onChange:u,caller:kd}),j=k.useRef(null),I=x?f||!!x.closest("form"):!0,[D,F]=k.useState(new Set),P=Array.from(D).map(V=>V.props.value).join(";");return o.jsx(c3,{...g,children:o.jsxs(Ude,{required:m,scope:t,trigger:x,onTriggerChange:y,valueNode:b,onValueNodeChange:v,valueNodeHasChildren:w,onValueNodeHasChildrenChange:N,contentId:rf(),value:T,onValueChange:E,open:C,onOpenChange:_,dir:S,triggerPointerDownPosRef:j,disabled:p,children:[o.jsx(e1.Provider,{scope:t,children:o.jsx(Hde,{scope:e.__scopeSelect,onNativeOptionAdd:k.useCallback(V=>{F($=>new Set($).add(V))},[]),onNativeOptionRemove:k.useCallback(V=>{F($=>{const O=new Set($);return O.delete(V),O})},[]),children:n})}),I?o.jsxs(xB,{"aria-hidden":!0,required:m,tabIndex:-1,name:c,autoComplete:h,value:T,onChange:V=>E(V.target.value),disabled:p,form:f,children:[T===void 0?o.jsx("option",{value:""}):null,Array.from(D)]},P):null]})})};q5.displayName=kd;var K5="SelectTrigger",Y5=k.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:r=!1,...a}=e,s=n1(n),i=tc(K5,n),l=i.disabled||r,u=sr(t,i.onTriggerChange),d=t1(n),c=k.useRef("touch"),[h,p,m]=bB(g=>{const x=d().filter(v=>!v.disabled),y=x.find(v=>v.value===i.value),b=vB(x,g,y);b!==void 0&&i.onValueChange(b.value)}),f=g=>{l||(i.onOpenChange(!0),m()),g&&(i.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return o.jsx(a_,{asChild:!0,...s,children:o.jsx(An.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":yB(i.value)?"":void 0,...a,ref:u,onClick:yn(a.onClick,g=>{g.currentTarget.focus(),c.current!=="mouse"&&f(g)}),onPointerDown:yn(a.onPointerDown,g=>{c.current=g.pointerType;const x=g.target;x.hasPointerCapture(g.pointerId)&&x.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(f(g),g.preventDefault())}),onKeyDown:yn(a.onKeyDown,g=>{const x=h.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&p(g.key),!(x&&g.key===" ")&&Bde.includes(g.key)&&(f(),g.preventDefault())})})})});Y5.displayName=K5;var X5="SelectValue",Z5=k.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,children:s,placeholder:i="",...l}=e,u=tc(X5,n),{onValueNodeHasChildrenChange:d}=u,c=s!==void 0,h=sr(t,u.onValueNodeChange);return Bo(()=>{d(c)},[d,c]),o.jsx(An.span,{...l,ref:h,style:{pointerEvents:"none"},children:yB(u.value)?o.jsx(o.Fragment,{children:i}):s})});Z5.displayName=X5;var qde="SelectIcon",Q5=k.forwardRef((e,t)=>{const{__scopeSelect:n,children:r,...a}=e;return o.jsx(An.span,{"aria-hidden":!0,...a,ref:t,children:r||""})});Q5.displayName=qde;var Kde="SelectPortal",J5=e=>o.jsx(r3,{asChild:!0,...e});J5.displayName=Kde;var Sd="SelectContent",eB=k.forwardRef((e,t)=>{const n=tc(Sd,e.__scopeSelect),[r,a]=k.useState();if(Bo(()=>{a(new DocumentFragment)},[]),!n.open){const s=r;return s?O0.createPortal(o.jsx(tB,{scope:e.__scopeSelect,children:o.jsx(e1.Slot,{scope:e.__scopeSelect,children:o.jsx("div",{children:e.children})})}),s):null}return o.jsx(nB,{...e,ref:t})});eB.displayName=Sd;var Ui=10,[tB,nc]=pf(Sd),Yde="SelectContentImpl",Xde=$de("SelectContent.RemoveScroll"),nB=k.forwardRef((e,t)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:s,onPointerDownOutside:i,side:l,sideOffset:u,align:d,alignOffset:c,arrowPadding:h,collisionBoundary:p,collisionPadding:m,sticky:f,hideWhenDetached:g,avoidCollisions:x,...y}=e,b=tc(Sd,n),[v,w]=k.useState(null),[N,S]=k.useState(null),C=sr(t,Q=>w(Q)),[_,T]=k.useState(null),[E,j]=k.useState(null),I=t1(n),[D,F]=k.useState(!1),P=k.useRef(!1);k.useEffect(()=>{if(v)return a3(v)},[v]),i3();const V=k.useCallback(Q=>{const[se,..._e]=I().map(ye=>ye.ref.current),[Le]=_e.slice(-1),Se=document.activeElement;for(const ye of Q)if(ye===Se||(ye==null||ye.scrollIntoView({block:"nearest"}),ye===se&&N&&(N.scrollTop=0),ye===Le&&N&&(N.scrollTop=N.scrollHeight),ye==null||ye.focus(),document.activeElement!==Se))return},[I,N]),$=k.useCallback(()=>V([_,v]),[V,_,v]);k.useEffect(()=>{D&&$()},[D,$]);const{onOpenChange:O,triggerPointerDownPosRef:L}=b;k.useEffect(()=>{if(v){let Q={x:0,y:0};const se=Le=>{var Se,ye;Q={x:Math.abs(Math.round(Le.pageX)-(((Se=L.current)==null?void 0:Se.x)??0)),y:Math.abs(Math.round(Le.pageY)-(((ye=L.current)==null?void 0:ye.y)??0))}},_e=Le=>{Q.x<=10&&Q.y<=10?Le.preventDefault():v.contains(Le.target)||O(!1),document.removeEventListener("pointermove",se),L.current=null};return L.current!==null&&(document.addEventListener("pointermove",se),document.addEventListener("pointerup",_e,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",se),document.removeEventListener("pointerup",_e,{capture:!0})}}},[v,O,L]),k.useEffect(()=>{const Q=()=>O(!1);return window.addEventListener("blur",Q),window.addEventListener("resize",Q),()=>{window.removeEventListener("blur",Q),window.removeEventListener("resize",Q)}},[O]);const[q,U]=bB(Q=>{const se=I().filter(Se=>!Se.disabled),_e=se.find(Se=>Se.ref.current===document.activeElement),Le=vB(se,Q,_e);Le&&setTimeout(()=>Le.ref.current.focus())}),ee=k.useCallback((Q,se,_e)=>{const Le=!P.current&&!_e;(b.value!==void 0&&b.value===se||Le)&&(T(Q),Le&&(P.current=!0))},[b.value]),M=k.useCallback(()=>v==null?void 0:v.focus(),[v]),G=k.useCallback((Q,se,_e)=>{const Le=!P.current&&!_e;(b.value!==void 0&&b.value===se||Le)&&j(Q)},[b.value]),J=r==="popper"?F2:rB,ve=J===F2?{side:l,sideOffset:u,align:d,alignOffset:c,arrowPadding:h,collisionBoundary:p,collisionPadding:m,sticky:f,hideWhenDetached:g,avoidCollisions:x}:{};return o.jsx(tB,{scope:n,content:v,viewport:N,onViewportChange:S,itemRefCallback:ee,selectedItem:_,onItemLeave:M,itemTextRefCallback:G,focusSelectedItem:$,selectedItemText:E,position:r,isPositioned:D,searchRef:q,children:o.jsx(s3,{as:Xde,allowPinchZoom:!0,children:o.jsx(o3,{asChild:!0,trapped:b.open,onMountAutoFocus:Q=>{Q.preventDefault()},onUnmountAutoFocus:yn(a,Q=>{var se;(se=b.trigger)==null||se.focus({preventScroll:!0}),Q.preventDefault()}),children:o.jsx(l3,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:Q=>Q.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:o.jsx(J,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:Q=>Q.preventDefault(),...y,...ve,onPlaced:()=>F(!0),ref:C,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:yn(y.onKeyDown,Q=>{const se=Q.ctrlKey||Q.altKey||Q.metaKey;if(Q.key==="Tab"&&Q.preventDefault(),!se&&Q.key.length===1&&U(Q.key),["ArrowUp","ArrowDown","Home","End"].includes(Q.key)){let Le=I().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);if(["ArrowUp","End"].includes(Q.key)&&(Le=Le.slice().reverse()),["ArrowUp","ArrowDown"].includes(Q.key)){const Se=Q.target,ye=Le.indexOf(Se);Le=Le.slice(ye+1)}setTimeout(()=>V(Le)),Q.preventDefault()}})})})})})})});nB.displayName=Yde;var Zde="SelectItemAlignedPosition",rB=k.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:r,...a}=e,s=tc(Sd,n),i=nc(Sd,n),[l,u]=k.useState(null),[d,c]=k.useState(null),h=sr(t,C=>c(C)),p=t1(n),m=k.useRef(!1),f=k.useRef(!0),{viewport:g,selectedItem:x,selectedItemText:y,focusSelectedItem:b}=i,v=k.useCallback(()=>{if(s.trigger&&s.valueNode&&l&&d&&g&&x&&y){const C=s.trigger.getBoundingClientRect(),_=d.getBoundingClientRect(),T=s.valueNode.getBoundingClientRect(),E=y.getBoundingClientRect();if(s.dir!=="rtl"){const Se=E.left-_.left,ye=T.left-Se,Fe=C.left-ye,Te=C.width+Fe,Oe=Math.max(Te,_.width),He=window.innerWidth-Ui,Ee=p2(ye,[Ui,Math.max(Ui,He-Oe)]);l.style.minWidth=Te+"px",l.style.left=Ee+"px"}else{const Se=_.right-E.right,ye=window.innerWidth-T.right-Se,Fe=window.innerWidth-C.right-ye,Te=C.width+Fe,Oe=Math.max(Te,_.width),He=window.innerWidth-Ui,Ee=p2(ye,[Ui,Math.max(Ui,He-Oe)]);l.style.minWidth=Te+"px",l.style.right=Ee+"px"}const j=p(),I=window.innerHeight-Ui*2,D=g.scrollHeight,F=window.getComputedStyle(d),P=parseInt(F.borderTopWidth,10),V=parseInt(F.paddingTop,10),$=parseInt(F.borderBottomWidth,10),O=parseInt(F.paddingBottom,10),L=P+V+D+O+$,q=Math.min(x.offsetHeight*5,L),U=window.getComputedStyle(g),ee=parseInt(U.paddingTop,10),M=parseInt(U.paddingBottom,10),G=C.top+C.height/2-Ui,J=I-G,ve=x.offsetHeight/2,Q=x.offsetTop+ve,se=P+V+Q,_e=L-se;if(se<=G){const Se=j.length>0&&x===j[j.length-1].ref.current;l.style.bottom="0px";const ye=d.clientHeight-g.offsetTop-g.offsetHeight,Fe=Math.max(J,ve+(Se?M:0)+ye+$),Te=se+Fe;l.style.height=Te+"px"}else{const Se=j.length>0&&x===j[0].ref.current;l.style.top="0px";const Fe=Math.max(G,P+g.offsetTop+(Se?ee:0)+ve)+_e;l.style.height=Fe+"px",g.scrollTop=se-G+g.offsetTop}l.style.margin=`${Ui}px 0`,l.style.minHeight=q+"px",l.style.maxHeight=I+"px",r==null||r(),requestAnimationFrame(()=>m.current=!0)}},[p,s.trigger,s.valueNode,l,d,g,x,y,s.dir,r]);Bo(()=>v(),[v]);const[w,N]=k.useState();Bo(()=>{d&&N(window.getComputedStyle(d).zIndex)},[d]);const S=k.useCallback(C=>{C&&f.current===!0&&(v(),b==null||b(),f.current=!1)},[v,b]);return o.jsx(Jde,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:S,children:o.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:w},children:o.jsx(An.div,{...a,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});rB.displayName=Zde;var Qde="SelectPopperPosition",F2=k.forwardRef((e,t)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=Ui,...s}=e,i=n1(n);return o.jsx(u3,{...i,...s,ref:t,align:r,collisionPadding:a,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});F2.displayName=Qde;var[Jde,PI]=pf(Sd,{}),P2="SelectViewport",aB=k.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:r,...a}=e,s=nc(P2,n),i=PI(P2,n),l=sr(t,s.onViewportChange),u=k.useRef(0);return o.jsxs(o.Fragment,{children:[o.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),o.jsx(e1.Slot,{scope:n,children:o.jsx(An.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:yn(a.onScroll,d=>{const c=d.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:p}=i;if(p!=null&&p.current&&h){const m=Math.abs(u.current-c.scrollTop);if(m>0){const f=window.innerHeight-Ui*2,g=parseFloat(h.style.minHeight),x=parseFloat(h.style.height),y=Math.max(g,x);if(y<f){const b=y+m,v=Math.min(f,b),w=b-v;h.style.height=v+"px",h.style.bottom==="0px"&&(c.scrollTop=w>0?w:0,h.style.justifyContent="flex-end")}}}u.current=c.scrollTop})})})]})});aB.displayName=P2;var sB="SelectGroup",[ehe,the]=pf(sB),nhe=k.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=rf();return o.jsx(ehe,{scope:n,id:a,children:o.jsx(An.div,{role:"group","aria-labelledby":a,...r,ref:t})})});nhe.displayName=sB;var iB="SelectLabel",oB=k.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=the(iB,n);return o.jsx(An.div,{id:a.id,...r,ref:t})});oB.displayName=iB;var Zw="SelectItem",[rhe,lB]=pf(Zw),uB=k.forwardRef((e,t)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:s,...i}=e,l=tc(Zw,n),u=nc(Zw,n),d=l.value===r,[c,h]=k.useState(s??""),[p,m]=k.useState(!1),f=sr(t,b=>{var v;return(v=u.itemRefCallback)==null?void 0:v.call(u,b,r,a)}),g=rf(),x=k.useRef("touch"),y=()=>{a||(l.onValueChange(r),l.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return o.jsx(rhe,{scope:n,value:r,disabled:a,textId:g,isSelected:d,onItemTextChange:k.useCallback(b=>{h(v=>v||((b==null?void 0:b.textContent)??"").trim())},[]),children:o.jsx(e1.ItemSlot,{scope:n,value:r,disabled:a,textValue:c,children:o.jsx(An.div,{role:"option","aria-labelledby":g,"data-highlighted":p?"":void 0,"aria-selected":d&&p,"data-state":d?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...i,ref:f,onFocus:yn(i.onFocus,()=>m(!0)),onBlur:yn(i.onBlur,()=>m(!1)),onClick:yn(i.onClick,()=>{x.current!=="mouse"&&y()}),onPointerUp:yn(i.onPointerUp,()=>{x.current==="mouse"&&y()}),onPointerDown:yn(i.onPointerDown,b=>{x.current=b.pointerType}),onPointerMove:yn(i.onPointerMove,b=>{var v;x.current=b.pointerType,a?(v=u.onItemLeave)==null||v.call(u):x.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:yn(i.onPointerLeave,b=>{var v;b.currentTarget===document.activeElement&&((v=u.onItemLeave)==null||v.call(u))}),onKeyDown:yn(i.onKeyDown,b=>{var w;((w=u.searchRef)==null?void 0:w.current)!==""&&b.key===" "||(Wde.includes(b.key)&&y(),b.key===" "&&b.preventDefault())})})})})});uB.displayName=Zw;var gx="SelectItemText",cB=k.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,...s}=e,i=tc(gx,n),l=nc(gx,n),u=lB(gx,n),d=Gde(gx,n),[c,h]=k.useState(null),p=sr(t,y=>h(y),u.onItemTextChange,y=>{var b;return(b=l.itemTextRefCallback)==null?void 0:b.call(l,y,u.value,u.disabled)}),m=c==null?void 0:c.textContent,f=k.useMemo(()=>o.jsx("option",{value:u.value,disabled:u.disabled,children:m},u.value),[u.disabled,u.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:x}=d;return Bo(()=>(g(f),()=>x(f)),[g,x,f]),o.jsxs(o.Fragment,{children:[o.jsx(An.span,{id:u.textId,...s,ref:p}),u.isSelected&&i.valueNode&&!i.valueNodeHasChildren?O0.createPortal(s.children,i.valueNode):null]})});cB.displayName=gx;var dB="SelectItemIndicator",hB=k.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return lB(dB,n).isSelected?o.jsx(An.span,{"aria-hidden":!0,...r,ref:t}):null});hB.displayName=dB;var O2="SelectScrollUpButton",pB=k.forwardRef((e,t)=>{const n=nc(O2,e.__scopeSelect),r=PI(O2,e.__scopeSelect),[a,s]=k.useState(!1),i=sr(t,r.onScrollButtonChange);return Bo(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=u.scrollTop>0;s(d)};const u=n.viewport;return l(),u.addEventListener("scroll",l),()=>u.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),a?o.jsx(fB,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:u}=n;l&&u&&(l.scrollTop=l.scrollTop-u.offsetHeight)}}):null});pB.displayName=O2;var L2="SelectScrollDownButton",mB=k.forwardRef((e,t)=>{const n=nc(L2,e.__scopeSelect),r=PI(L2,e.__scopeSelect),[a,s]=k.useState(!1),i=sr(t,r.onScrollButtonChange);return Bo(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=u.scrollHeight-u.clientHeight,c=Math.ceil(u.scrollTop)<d;s(c)};const u=n.viewport;return l(),u.addEventListener("scroll",l),()=>u.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),a?o.jsx(fB,{...e,ref:i,onAutoScroll:()=>{const{viewport:l,selectedItem:u}=n;l&&u&&(l.scrollTop=l.scrollTop+u.offsetHeight)}}):null});mB.displayName=L2;var fB=k.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=e,s=nc("SelectScrollButton",n),i=k.useRef(null),l=t1(n),u=k.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return k.useEffect(()=>()=>u(),[u]),Bo(()=>{var c;const d=l().find(h=>h.ref.current===document.activeElement);(c=d==null?void 0:d.ref.current)==null||c.scrollIntoView({block:"nearest"})},[l]),o.jsx(An.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:yn(a.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(r,50))}),onPointerMove:yn(a.onPointerMove,()=>{var d;(d=s.onItemLeave)==null||d.call(s),i.current===null&&(i.current=window.setInterval(r,50))}),onPointerLeave:yn(a.onPointerLeave,()=>{u()})})}),ahe="SelectSeparator",gB=k.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return o.jsx(An.div,{"aria-hidden":!0,...r,ref:t})});gB.displayName=ahe;var z2="SelectArrow",she=k.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=n1(n),s=tc(z2,n),i=nc(z2,n);return s.open&&i.position==="popper"?o.jsx(d3,{...a,...r,ref:t}):null});she.displayName=z2;var ihe="SelectBubbleInput",xB=k.forwardRef(({__scopeSelect:e,value:t,...n},r)=>{const a=k.useRef(null),s=sr(r,a),i=K0(t);return k.useEffect(()=>{const l=a.current;if(!l)return;const u=window.HTMLSelectElement.prototype,c=Object.getOwnPropertyDescriptor(u,"value").set;if(i!==t&&c){const h=new Event("change",{bubbles:!0});c.call(l,t),l.dispatchEvent(h)}},[i,t]),o.jsx(An.select,{...n,style:{...GK,...n.style},ref:s,defaultValue:t})});xB.displayName=ihe;function yB(e){return e===""||e===void 0}function bB(e){const t=ou(e),n=k.useRef(""),r=k.useRef(0),a=k.useCallback(i=>{const l=n.current+i;t(l),function u(d){n.current=d,window.clearTimeout(r.current),d!==""&&(r.current=window.setTimeout(()=>u(""),1e3))}(l)},[t]),s=k.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return k.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,s]}function vB(e,t,n){const a=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let i=ohe(e,Math.max(s,0));a.length===1&&(i=i.filter(d=>d!==n));const u=i.find(d=>d.textValue.toLowerCase().startsWith(a.toLowerCase()));return u!==n?u:void 0}function ohe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var lhe=q5,wB=Y5,uhe=Z5,che=Q5,dhe=J5,NB=eB,hhe=aB,kB=oB,SB=uB,phe=cB,mhe=hB,CB=pB,_B=mB,IB=gB;const _a=lhe,Ia=uhe,ha=k.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(wB,{ref:r,className:Ie("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,o.jsx(che,{asChild:!0,children:o.jsx(Ux,{className:"h-4 w-4 opacity-50"})})]}));ha.displayName=wB.displayName;const TB=k.forwardRef(({className:e,...t},n)=>o.jsx(CB,{ref:n,className:Ie("flex cursor-default items-center justify-center py-1",e),...t,children:o.jsx(pY,{className:"h-4 w-4"})}));TB.displayName=CB.displayName;const EB=k.forwardRef(({className:e,...t},n)=>o.jsx(_B,{ref:n,className:Ie("flex cursor-default items-center justify-center py-1",e),...t,children:o.jsx(Ux,{className:"h-4 w-4"})}));EB.displayName=_B.displayName;const pa=k.forwardRef(({className:e,children:t,position:n="popper",...r},a)=>o.jsx(dhe,{children:o.jsxs(NB,{ref:a,className:Ie("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...r,children:[o.jsx(TB,{}),o.jsx(hhe,{className:Ie("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),o.jsx(EB,{})]})}));pa.displayName=NB.displayName;const fhe=k.forwardRef(({className:e,...t},n)=>o.jsx(kB,{ref:n,className:Ie("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));fhe.displayName=kB.displayName;const Nt=k.forwardRef(({className:e,children:t,...n},r)=>o.jsxs(SB,{ref:r,className:Ie("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(mhe,{children:o.jsx(an,{className:"h-4 w-4"})})}),o.jsx(phe,{children:t})]}));Nt.displayName=SB.displayName;const ghe=k.forwardRef(({className:e,...t},n)=>o.jsx(IB,{ref:n,className:Ie("-mx-1 my-1 h-px bg-muted",e),...t}));ghe.displayName=IB.displayName;const xhe="https://synka.in",oi=(e,t,n,r,a)=>{const i={compact:"8px",normal:"12px",relaxed:"16px"}[t.spacing],l=t.alignment,u=r&&e.photo_url?`<td style="padding-right: 15px; vertical-align: top;">
        <img src="${e.photo_url}" alt="${e.name}" width="80" height="80" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; display: block;" />
       </td>`:"",d=a&&e.logo_url?`<img src="${e.logo_url}" alt="${e.company}" height="28" style="height: 28px; max-width: 120px; margin-top: ${i}; display: block;${l==="center"?" margin-left: auto; margin-right: auto;":""}" />`:"",c=e.website?`<tr><td style="padding-top: 4px; text-align: ${l};"><a href="${e.website.startsWith("http")?e.website:"https://"+e.website}" style="color: #4F46E5; text-decoration: none; font-size: 12px;">${e.website.replace(/^https?:\/\//,"")}</a></td></tr>`:"",h=e.linkedin?`<tr><td style="padding-top: 4px; text-align: ${l};"><a href="${e.linkedin.startsWith("http")?e.linkedin:"https://linkedin.com/in/"+e.linkedin}" style="color: #0077B5; text-decoration: none; font-size: 12px;">LinkedIn</a></td></tr>`:"";switch(n){case"executive":return{name:r&&a?"Executive Pro":r?"Executive":a?"Executive Brand":"Executive Minimal",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; color: #333333;">
  <tr>
    ${u}
    <td style="border-left: 3px solid #4F46E5; padding-left: 15px; vertical-align: top;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 18px; font-weight: bold; color: #1a1a1a; padding-bottom: 4px; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 13px; color: #666666; padding-bottom: ${i}; text-align: ${l};">${e.designation}${e.company?` | ${e.company}`:""}</td></tr>
        <tr><td style="font-size: 12px; color: #333333; text-align: ${l};">${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}</td></tr>
        <tr><td style="font-size: 12px; color: #333333; padding-top: 2px; text-align: ${l};">${e.phone||""}</td></tr>
        ${c}
        ${h}
        ${d?`<tr><td style="padding-top: ${i};">${d}</td></tr>`:""}
      </table>
    </td>
  </tr>
</table>`};case"modern":return{name:r&&a?"Modern Complete":r?"Modern":a?"Modern Brand":"Modern Clean",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif;">
  <tr>
    <td style="padding: ${i}; background-color: #f8f9fa; border-radius: 8px;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          ${r&&e.photo_url?`<td style="vertical-align: top; padding-right: 15px;">
            <img src="${e.photo_url}" alt="${e.name}" width="70" height="70" style="width: 70px; height: 70px; border-radius: 12px; object-fit: cover; display: block;" />
          </td>`:""}
          <td style="vertical-align: top;">
            <table cellpadding="0" cellspacing="0" border="0">
              <tr><td style="font-size: 16px; font-weight: bold; color: #1a1a1a;">${e.name}</td></tr>
              <tr><td style="font-size: 12px; color: #6366F1; text-transform: uppercase; letter-spacing: 0.5px; padding-top: 2px;">${e.designation}</td></tr>
              <tr><td style="font-size: 12px; color: #666666; padding-top: 2px;">${e.company}</td></tr>
              <tr><td style="padding-top: ${i}; font-size: 12px;">
                ${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
                ${e.phone?`<span style="color: #999;"> | </span><span style="color: #333;">${e.phone}</span>`:""}
              </td></tr>
              ${a&&e.logo_url?`<tr><td style="padding-top: ${i};">${d}</td></tr>`:""}
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>`};case"minimal":return{name:"Minimal",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; color: #333333; border-top: 2px solid #4F46E5; padding-top: ${i};">
  <tr>
    <td style="padding-top: 10px;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 15px; font-weight: 600; color: #1a1a1a; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.designation}${e.company?` &middot; ${e.company}`:""}</td></tr>
        <tr><td style="padding-top: ${i}; font-size: 12px; text-align: ${l};">
          ${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
          ${e.phone?` &middot; ${e.phone}`:""}
        </td></tr>
        ${e.website?`<tr><td style="font-size: 12px; padding-top: 2px; text-align: ${l};"><a href="${e.website.startsWith("http")?e.website:"https://"+e.website}" style="color: #4F46E5; text-decoration: none;">${e.website.replace(/^https?:\/\//,"")}</a></td></tr>`:""}
      </table>
    </td>
  </tr>
</table>`};case"corporate":return{name:a?"Corporate":"Professional",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; color: #333333;">
  <tr>
    <td style="vertical-align: top;">
      ${a&&e.logo_url?`<img src="${e.logo_url}" alt="${e.company}" height="40" style="height: 40px; max-width: 150px; display: block; margin-bottom: ${i};" />`:""}
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 14px; font-weight: bold; color: #1a1a1a; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #4F46E5; padding-top: 2px; text-align: ${l};">${e.designation}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.company}</td></tr>
        <tr><td style="border-top: 1px solid #e5e7eb; margin-top: 10px; padding-top: ${i}; font-size: 12px; text-align: ${l};">
          ${e.email?`<span style="color: #333;">E: </span><a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
          ${e.phone?`<br/><span style="color: #333;">P: </span>${e.phone}`:""}
        </td></tr>
      </table>
    </td>
  </tr>
</table>`};case"classic":default:return{name:"Classic",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Georgia, serif; font-size: 13px; color: #333333;">
  <tr>
    <td>
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 16px; font-weight: 400; color: #1a1a1a; letter-spacing: 0.5px; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #888888; font-style: italic; padding-top: 4px; text-align: ${l};">${e.designation}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.company}</td></tr>
        <tr><td style="padding-top: ${i}; border-top: 1px solid #e5e7eb; margin-top: ${i};">
          <table cellpadding="0" cellspacing="0" border="0" style="margin-top: ${i};">
            <tr><td style="font-size: 12px; text-align: ${l};">${e.email?`<a href="mailto:${e.email}" style="color: #666666; text-decoration: none;">${e.email}</a>`:""}</td></tr>
            <tr><td style="font-size: 12px; text-align: ${l};">${e.phone||""}</td></tr>
          </table>
        </td></tr>
      </table>
    </td>
  </tr>
</table>`}}},yhe=e=>{const t=!!e.photo_url,n=!!e.logo_url,r={spacing:"normal",alignment:"left"},a=[];return t&&n?(a.push(oi(e,r,"minimal",!1,!1)),a.push(oi(e,r,"corporate",!1,!0)),a.push(oi(e,r,"executive",!0,!0))):t?(a.push(oi(e,r,"minimal",!1,!1)),a.push(oi(e,r,"executive",!0,!1)),a.push(oi(e,r,"modern",!0,!1))):n?(a.push(oi(e,r,"minimal",!1,!1)),a.push(oi(e,r,"corporate",!1,!0)),a.push(oi(e,r,"modern",!1,!0))):(a.push(oi(e,r,"minimal",!1,!1)),a.push(oi(e,r,"corporate",!1,!1)),a.push(oi(e,r,"classic",!1,!1))),a},bhe=e=>{const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""};function vhe({activeCard:e}){var _e,Le;const{user:t}=ir(),{profile:n}=Ko(),[r,a]=k.useState(null),[s,i]=k.useState(""),[l,u]=k.useState(!1),[d,c]=k.useState([]),[h,p]=k.useState(null),[m,f]=k.useState(null),[g,x]=k.useState(!1),[y,b]=k.useState(!1),[v,w]=k.useState(!1),[N,S]=k.useState(null),C=k.useRef(null),[_,T]=k.useState(!1),[E,j]=k.useState(0),[I,D]=k.useState(0),[F,P]=k.useState({showPhoto:!0,showLogo:!0,spacing:"normal",alignment:"left"}),V=k.useMemo(()=>({name:(e==null?void 0:e.full_name)||"Your Name",designation:(e==null?void 0:e.designation)||"",company:(e==null?void 0:e.company)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",linkedin:(e==null?void 0:e.linkedin)||"",photo_url:(e==null?void 0:e.photo_url)||"",logo_url:(e==null?void 0:e.logo_url)||""}),[e]),$=k.useMemo(()=>yhe(V),[V]);k.useEffect(()=>{(async()=>{if(!t||_)return;const{data:ye,error:Fe}=await le.from("email_signatures").select("*").eq("user_id",t.id).eq("is_selected",!0).maybeSingle();!Fe&&ye?p({name:ye.name,html:ye.html}):$.length>0&&p($[0]),T(!0)})()},[t,$,_]),k.useEffect(()=>{_&&!h&&$.length>0&&p($[0])},[_,h,$]);const O=(Se,ye,Fe)=>{let Te=Se;if(!Fe.showPhoto&&ye.photo_url){const Ee=ye.photo_url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");Te=Te.replace(new RegExp(`<img[^>]*src=["']${Ee}["'][^>]*>`,"gi"),""),Te=Te.replace(/<img[^>]*border-radius[^>]*50%[^>]*>/gi,""),Te=Te.replace(/<td[^>]*>\s*<\/td>/gi,"")}if(!Fe.showLogo&&ye.logo_url){const Ee=ye.logo_url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");Te=Te.replace(new RegExp(`<img[^>]*src=["']${Ee}["'][^>]*>`,"gi"),""),Te=Te.replace(/<img[^>]*alt=["'][^"']*logo[^"']*["'][^>]*>/gi,""),Te=Te.replace(/<tr>\s*<td[^>]*>\s*<\/td>\s*<\/tr>/gi,"")}const He={compact:"8px",normal:"12px",relaxed:"16px"}[Fe.spacing];return Te=Te.replace(/padding(-top|-bottom)?:\s*\d+px/gi,(Ee,Re)=>`padding${Re||""}: ${He}`),Te=Te.replace(/text-align:\s*(left|center|right)/gi,`text-align: ${Fe.alignment}`),Te},L=k.useMemo(()=>{if(!h)return null;const Se=O(h.html,V,F);return{name:h.name,html:Se}},[h,V,F]),q=Se=>{r===Se?a(null):(a(Se),Se==="ai"&&j(0),Se==="select"&&D(0))},U=async()=>{if(!s.trim()){oe({title:"Please describe your signature style",variant:"destructive"});return}u(!0);try{const{data:Se,error:ye}=await le.functions.invoke("generate-signatures",{body:{name:V.name,company:V.company,designation:V.designation,email:V.email,phone:V.phone,website:V.website,linkedin:V.linkedin,photo_url:V.photo_url,logo_url:V.logo_url,prompt:s}});if(ye)throw ye;if(Se!=null&&Se.signatures&&Array.isArray(Se.signatures))c(Se.signatures.slice(0,3)),j(0),oe({title:"Signatures generated!",description:"Select your preferred style."});else throw new Error("No signatures returned")}catch(Se){console.error("Error generating signatures:",Se),oe({title:"AI generation unavailable",description:"Try the Select tab for premium templates.",variant:"destructive"})}finally{u(!1)}},ee=async Se=>{p(Se),a(null),c([]),i(""),t&&t&&await le.from("email_signatures").upsert({user_id:t.id,name:Se.name,html:Se.html,is_selected:!0,updated_at:new Date().toISOString()},{onConflict:"user_id"}),oe({title:`"${Se.name}" selected`})},M=async()=>{if(h){try{const Se=h.html,ye=new Blob([Se],{type:"text/html"}),Fe=new Blob([bhe(Se)],{type:"text/plain"});await navigator.clipboard.write([new ClipboardItem({"text/html":ye,"text/plain":Fe})]),f("signature"),b(!0),oe({title:"Signature copied!",description:"Paste into Gmail or Outlook.",duration:3e3})}catch(Se){console.error("Clipboard API failed, trying fallback:",Se);try{const ye=window.getSelection(),Fe=document.createRange();C.current&&(Fe.selectNodeContents(C.current),ye==null||ye.removeAllRanges(),ye==null||ye.addRange(Fe),document.execCommand("copy"),ye==null||ye.removeAllRanges()),f("signature"),b(!0),oe({title:"Signature copied!",description:"Paste into Gmail or Outlook.",duration:3e3})}catch(ye){console.error("Failed to copy signature:",ye),oe({title:"Copy failed",description:"Please try again.",variant:"destructive"})}}setTimeout(()=>f(null),2500)}},G=async()=>{if(C.current){x(!0);try{const Se=await $2(C.current,{pixelRatio:2,backgroundColor:"#ffffff",style:{maxWidth:"600px"}});if(S(Se),/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||Yt.isNativePlatform()){if(Yt.isNativePlatform()){const Oe=Se.split(",")[1],He=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Ee=await Ox.writeFile({path:He,data:Oe,directory:id.Cache});await sd.share({title:"Email Signature",text:"My Synka email signature",files:[Ee.uri],dialogTitle:"Save or share signature"}),oe({title:"Signature ready to share!"})}else{const Oe=document.createElement("a");Oe.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,Oe.href=Se,Oe.click(),oe({title:"Image downloaded!",description:"Check your Downloads folder.",duration:3e3})}f("image"),w(!0);return}const Te=await(await fetch(Se)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":Te})]),f("image"),w(!0),oe({title:"Image copied to clipboard!",description:"Paste anywhere to use your signature as an image.",duration:3e3})}catch(Se){if(console.error("Failed to copy image:",Se),N){const ye=document.createElement("a");ye.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,ye.href=N,ye.click(),oe({title:"Image downloaded!",description:"Clipboard not supported, image was downloaded instead.",duration:3e3}),f("image"),w(!0)}else oe({title:"Image copy failed",description:"Your browser may not support image clipboard.",variant:"destructive"})}finally{x(!1),setTimeout(()=>f(null),2500)}}},J=async()=>{if(!N)return;if(Yt.isNativePlatform()){try{const ye=N.split(",")[1],Fe=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Te=await Ox.writeFile({path:Fe,data:ye,directory:id.Cache});await sd.share({title:"Email Signature",text:"My Synka email signature",files:[Te.uri],dialogTitle:"Save or share signature"}),oe({title:"Signature ready to share!"})}catch(ye){console.error("Share error:",ye),oe({title:"Could not share signature",variant:"destructive"})}return}const Se=document.createElement("a");Se.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,Se.href=N,Se.click(),oe({title:"Image downloaded!"})},ve=(n==null?void 0:n.slug)||(t==null?void 0:t.id)||"user",Q=`${xhe}/u/${ve}`,se=r===null;return o.jsxs("div",{className:"space-y-4 relative overflow-visible",children:[o.jsxs("div",{className:"grid w-full grid-cols-3 gap-1 p-1 rounded-lg bg-muted",children:[o.jsxs("button",{onClick:()=>q("ai"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="ai"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[o.jsx(Hs,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"AI"]}),o.jsxs("button",{onClick:()=>q("select"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="select"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[o.jsx(SY,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Select"]}),o.jsxs("button",{onClick:()=>q("edit"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="edit"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[o.jsx(Ay,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Edit"]})]}),r==="ai"&&o.jsxs("div",{className:"space-y-4 mt-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:o.jsx(td,{className:"h-4 w-4"})}),o.jsx("span",{className:"text-sm font-medium",children:"AI Signature Generator"})]}),d.length===0?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{className:"text-sm",children:"Describe how you want your email signature to look..."}),o.jsx(Pa,{value:s,onChange:Se=>i(Se.target.value),placeholder:"e.g., minimal, bold & premium, with photo, startup style, formal corporate...",rows:2,className:"resize-none text-sm"})]}),o.jsx(fe,{onClick:U,className:"w-full",size:"sm",disabled:l||!s.trim(),children:l?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Generate 3 Signatures"]})})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex gap-1 p-1 rounded-md bg-muted/50",children:d.map((Se,ye)=>o.jsx("button",{onClick:()=>j(ye),className:Ie("flex-1 px-3 py-1.5 text-xs font-medium rounded transition-all",E===ye?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:Se.name},ye))}),o.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:o.jsx("div",{dangerouslySetInnerHTML:{__html:Vc.sanitize(((_e=d[E])==null?void 0:_e.html)||"")}})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(fe,{onClick:()=>ee(d[E]),className:"flex-1",size:"sm",children:"Select This Signature"}),o.jsx(fe,{onClick:()=>{c([]),i("")},variant:"outline",size:"sm",children:"Regenerate"})]})]})]}),r==="select"&&o.jsxs("div",{className:"space-y-4 mt-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:o.jsx(td,{className:"h-4 w-4"})}),o.jsx("span",{className:"text-sm font-medium",children:"Select Template"})]}),o.jsx("div",{className:"flex gap-1 p-1 rounded-md bg-muted/50",children:$.map((Se,ye)=>o.jsx("button",{onClick:()=>D(ye),className:Ie("flex-1 px-3 py-1.5 text-xs font-medium rounded transition-all",I===ye?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:Se.name},ye))}),o.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:o.jsx("div",{dangerouslySetInnerHTML:{__html:Vc.sanitize(((Le=$[I])==null?void 0:Le.html)||"")}})}),o.jsx(fe,{onClick:()=>ee($[I]),className:"w-full",size:"sm",children:"Select This Signature"})]}),r==="edit"&&o.jsxs("div",{className:"space-y-4 mt-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:o.jsx(td,{className:"h-4 w-4"})}),o.jsx("span",{className:"text-sm font-medium",children:"Edit Settings"})]}),o.jsxs("div",{className:"space-y-4 p-3 rounded-lg border border-border bg-muted/30",children:[V.photo_url&&o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(We,{className:"text-sm",children:"Show Photo"}),o.jsx(vu,{checked:F.showPhoto,onCheckedChange:Se=>P(ye=>({...ye,showPhoto:Se}))})]}),V.logo_url&&o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(We,{className:"text-sm",children:"Show Logo"}),o.jsx(vu,{checked:F.showLogo,onCheckedChange:Se=>P(ye=>({...ye,showLogo:Se}))})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(We,{className:"text-sm",children:"Spacing"}),o.jsxs(_a,{value:F.spacing,onValueChange:Se=>P(ye=>({...ye,spacing:Se})),children:[o.jsx(ha,{className:"w-28 h-8 text-xs",children:o.jsx(Ia,{})}),o.jsxs(pa,{className:"z-[200]",children:[o.jsx(Nt,{value:"compact",children:"Compact"}),o.jsx(Nt,{value:"normal",children:"Normal"}),o.jsx(Nt,{value:"relaxed",children:"Relaxed"})]})]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(We,{className:"text-sm",children:"Alignment"}),o.jsxs(_a,{value:F.alignment,onValueChange:Se=>P(ye=>({...ye,alignment:Se})),children:[o.jsx(ha,{className:"w-28 h-8 text-xs",children:o.jsx(Ia,{})}),o.jsxs(pa,{className:"z-[200]",children:[o.jsx(Nt,{value:"left",children:"Left"}),o.jsx(Nt,{value:"center",children:"Center"}),o.jsx(Nt,{value:"right",children:"Right"})]})]})]})]}),L&&o.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:o.jsx("div",{dangerouslySetInnerHTML:{__html:Vc.sanitize(L.html)}})}),o.jsxs(fe,{onClick:()=>{L&&ee(L)},className:"w-full",size:"sm",disabled:!L,children:[o.jsx(pw,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]}),se&&h&&o.jsxs("div",{className:"space-y-3 pt-3 border-t border-border",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Selected: ",h.name]})}),o.jsx("div",{className:"rounded-lg border border-border bg-white overflow-auto",children:o.jsx("div",{ref:C,className:"p-4",style:{padding:"14px 18px"},dangerouslySetInnerHTML:{__html:Vc.sanitize(h.html)}})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(fe,{onClick:M,className:"flex-1",size:"sm",variant:m==="signature"?"secondary":"default",children:m==="signature"?o.jsxs(o.Fragment,{children:[o.jsx(an,{className:"h-4 w-4 mr-2"}),"Copied!"]}):o.jsxs(o.Fragment,{children:[o.jsx(SS,{className:"h-4 w-4 mr-2"}),"Copy"]})}),o.jsx(fe,{onClick:G,className:"flex-1",size:"sm",variant:m==="image"?"secondary":"outline",disabled:g,children:g?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"..."]}):m==="image"?o.jsxs(o.Fragment,{children:[o.jsx(an,{className:"h-4 w-4 mr-2"}),"Copied!"]}):o.jsxs(o.Fragment,{children:[o.jsx(NY,{className:"h-4 w-4 mr-2"}),"Image"]})}),o.jsxs(fe,{onClick:async()=>{if(C.current){x(!0);try{const Se=await $2(C.current,{pixelRatio:2,backgroundColor:"#ffffff",style:{maxWidth:"600px"}});if(Yt.isNativePlatform()){const ye=Se.split(",")[1],Fe=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Te=await Ox.writeFile({path:Fe,data:ye,directory:id.Cache});await sd.share({title:"Email Signature",text:"My Synka email signature",files:[Te.uri],dialogTitle:"Save or share signature"}),oe({title:"Signature ready to share!"})}else{const ye=document.createElement("a");ye.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,ye.href=Se,ye.click(),oe({title:"Image downloaded!"})}}catch(Se){console.error("Failed to generate/download image:",Se),oe({title:"Download failed",variant:"destructive"})}finally{x(!1)}}},className:"flex-1",size:"sm",variant:"outline",disabled:g,children:[o.jsx(km,{className:"h-4 w-4 mr-2"}),"Save"]})]})]}),o.jsx(gn,{open:y,onOpenChange:b,children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{className:"text-xl font-semibold",children:"Make this signature yours"})}),o.jsx("div",{className:"space-y-4 py-2",children:o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"1"}),o.jsxs("p",{className:"text-sm text-muted-foreground",children:["Open email settings on desktop ",o.jsx("span",{className:"text-xs",children:"(HTML signatures do not work on mobile apps)"})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"2"}),o.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Gmail:"})," Settings > See all settings > Signature"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Apple Mail:"})," Settings > Signatures"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Outlook:"})," Settings > Mail > Signatures"]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"3"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the copied signature"})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"4"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Apply and save - you are Synka ready with signatures!"})]})]})}),o.jsx(fe,{onClick:()=>b(!1),className:"w-full",children:"Got it!"})]})}),o.jsx(gn,{open:v,onOpenChange:w,children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{className:"text-xl font-semibold",children:"Use this image as your email signature"})}),o.jsxs("div",{className:"space-y-4 py-2",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"1"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Open email signature settings in your email client"})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"2"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the image into the signature area"})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"3"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Works where HTML is not supported"})]})]}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:["Image links to: ",o.jsx("a",{href:Q,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:Q})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(fe,{onClick:J,variant:"outline",className:"flex-1",children:[o.jsx(km,{className:"h-4 w-4 mr-2"}),"Download Image"]}),o.jsx(fe,{onClick:()=>w(!1),className:"flex-1",children:"Got it!"})]})]})})]})}function T$(e,t=80,n=50){t/=100,n/=100;const r=c=>(c+e/30)%12,a=t*Math.min(n,1-n),s=c=>n-a*Math.max(-1,Math.min(r(c)-3,Math.min(9-r(c),1))),i=Math.round(255*s(0)),l=Math.round(255*s(8)),u=Math.round(255*s(4)),d=c=>c.toString(16).padStart(2,"0");return`#${d(i)}${d(l)}${d(u)}`.toUpperCase()}function E$(e){if(!e)return null;const t=u=>String(u).padStart(2,"0"),n=e.getFullYear(),r=t(e.getMonth()+1),a=t(e.getDate()),s=t(e.getHours()),i=t(e.getMinutes()),l=t(e.getSeconds());return`${n}-${r}-${a}T${s}:${i}:${l}+05:30`}function j$(e){const t=e.replace("#","");if(t.length!==6)return 0;const n=parseInt(t.substring(0,2),16)/255,r=parseInt(t.substring(2,4),16)/255,a=parseInt(t.substring(4,6),16)/255,s=Math.max(n,r,a),i=Math.min(n,r,a);let l=0;if(s!==i){const u=s-i;switch(s){case n:l=(r-a)/u+(r<a?6:0);break;case r:l=(a-n)/u+2;break;case a:l=(n-r)/u+4;break}l=Math.round(l*60)}return Math.round(l||0)}const whe=["All","7 days","15 days","30 days","Custom"];function Nhe(){var Gl,rl,mo,al;const{profile:e}=Ko(),{user:t}=ir(),{cards:n,activeCard:r}=uf(),{tags:a,createTag:s,deleteTag:i}=_5(),{events:l,addEvent:u,deleteEvent:d}=MI(),{addTemplate:c,updateTemplate:h,deleteTemplate:p,getEmailTemplates:m,getWhatsappTemplates:f}=E5(),{addSignature:g,getSelectedSignature:x}=A5(),{analytics:y,loading:b,refetch:v}=aie(),w=((Gl=e==null?void 0:e.plan)==null?void 0:Gl.toLowerCase())==="orange",N=()=>{oe({title:"Orange Feature",description:"Upgrade to Orange & unlock this premium feature",action:o.jsx(fe,{variant:"outline",size:"sm",onClick:()=>window.location.href="/settings/upgrade",className:"border-orange-500 text-orange-600 hover:bg-orange-50",children:"Upgrade"})})},[S,C]=k.useState("All"),[_,T]=k.useState({from:void 0,to:void 0}),[E,j]=k.useState(!1),[I,D]=k.useState(!1),[F,P]=k.useState([]),[V,$]=k.useState(0),[O,L]=k.useState(0),[q,U]=k.useState(!1),ee=()=>{let X,Ue;return S==="7 days"?(X=Eo(sm(new Date,7)),Ue=xv(new Date)):S==="15 days"?(X=Eo(sm(new Date,15)),Ue=xv(new Date)):S==="30 days"?(X=Eo(sm(new Date,30)),Ue=xv(new Date)):S.startsWith("Custom:")&&_.from&&_.to&&(X=Eo(_.from),Ue=xv(_.to)),{startDate:X,endDate:Ue}},M=async()=>{U(!0);try{const{startDate:X,endDate:Ue}=ee(),mn=E$(X),Hn=E$(Ue),{data:K,error:ke}=await le.rpc("get_attended_events_list",{p_user_id:(t==null?void 0:t.id)||null,p_start_date:mn,p_end_date:Hn});if(ke){console.error("RPC get_attended_events error",ke),oe({title:"Failed to fetch attended events",variant:"destructive"}),P([]),$(0),L(0);return}const Z=(Array.isArray(K)?K:[]).map(je=>({id:String(je.id),title:je.title||je.name||`Event ${je.id}`,views:Number(je.views??je.count??0),start_time:je.start_time||null,end_time:je.end_time||null})).filter(je=>Number(je.views)>0),xe=Z.reduce((je,De)=>je+(De.views||0),0);P(Z),$(Z.length),L(xe)}catch(X){console.error("updateEventMetrics error",X),oe({title:"Failed to update event metrics",variant:"destructive"}),P([]),$(0),L(0)}finally{U(!1)}};k.useEffect(()=>{const{startDate:X,endDate:Ue}=ee();v(X,Ue),M()},[S,_,v]);const G=async()=>{D(!0),U(!0),await M(),U(!1)},[J,ve]=k.useState(null),[Q,se]=k.useState({name:"",subject:"",body:""}),[_e,Le]=k.useState(null),[Se,ye]=k.useState(!1),[Fe,Te]=k.useState(!1),[Oe,He]=k.useState(""),[Ee,Re]=k.useState(!1),[Ke,at]=k.useState(!1),[Y,ae]=k.useState({name:"",title:"",company:"",email:"",phone:""}),[we,Ce]=k.useState(!1),[Ne,he]=k.useState(!1),[Ae,gt]=k.useState(!1),[ht,Dt]=k.useState(""),[$t,qe]=k.useState([]),[it,Ct]=k.useState(0),[pt,Ut]=k.useState(!1),[Ln,bt]=k.useState(!1),[Ot,Et]=k.useState(""),Lt=async()=>{Ot.trim()&&(await s(Ot.trim()),Et(""))},[At,zt]=k.useState([{id:"expo",name:"Expo",color:void 0},{id:"tradefare",name:"Tradefare",color:void 0}]),[Sn,ot]=k.useState(""),[pe,Me]=k.useState([]),[Je,ze]=k.useState([]),[Ft,Ht]=k.useState(!1),[ct,vt]=k.useState(null),[ln,fr]=k.useState(200),[Na,aa]=k.useState(!1),[qr,Da]=k.useState(null),[zn,Ma]=k.useState(0),[Bs,Cn]=k.useState(!1),[gr,Ws]=k.useState(null),[wt,de]=k.useState({open:!1,title:"",description:"",onConfirm:()=>{}}),[Be,lt]=k.useState({title:"",start_time:"",end_time:"",description:""}),[Mn,or]=k.useState(!1),[Rn,lr]=k.useState(null),jr=k.useRef(null),Bn=k.useRef(null);k.useEffect(()=>Me(a||[]),[a]),k.useEffect(()=>ze(l||[]),[l]);const ka=X=>{X==="Custom"?j(!0):(C(X),T({from:void 0,to:void 0}))},Qn=()=>{_.from&&_.to&&(C(`Custom: ${hr(_.from,"dd MMM")}  ${hr(_.to,"dd MMM")}`),j(!1))},ii=X=>{zt(Ue=>Ue.filter(mn=>mn.id!==X&&mn.name!==X))},vs=X=>{vt(X);const Ue=(X==null?void 0:X.color)||(X==null?void 0:X.colorHex)||(X==null?void 0:X.color_hex)||void 0,mn=Ue?j$(Ue):200;fr(mn),Ht(!0)},Og=async X=>{if(fr(X),!ct)return;const Ue=T$(X,80,50),mn=Je.find(Hn=>String(Hn.id)===String(ct.id));mn?(ze(Hn=>Hn.map(K=>K.id===mn.id?{...K,color:Ue}:K)),vt(Hn=>Hn&&{...Hn,color:Ue})):(zt(Hn=>Hn.map(K=>K.id===ct.id?{...K,color:Ue}:K)),vt(Hn=>Hn&&{...Hn,color:Ue}))},Lg=async()=>{if(!ct)return;const X=Je.find(Ue=>String(Ue.id)===String(ct.id));X?de({open:!0,title:`Delete ${X.title}`,description:"This action cannot be undone.",onConfirm:async()=>{await d(X.id),Ht(!1),vt(null),de(Ue=>({...Ue,open:!1})),oe({title:"Event deleted"})}}):(ii(ct.id),Ht(!1),vt(null),oe({title:"Event removed"}))},zg=X=>{Da(X);const Ue=X!=null&&X.color?j$(X.color):200;Ma(Ue),aa(!0)},vc=async()=>{if(!qr)return;const X=qr.id;de({open:!0,title:`Delete ${qr.name}`,description:"This action cannot be undone.",onConfirm:async()=>{await i(X),aa(!1),Da(null),de(Ue=>({...Ue,open:!1})),oe({title:"Tag deleted"})}})},Vl=X=>{Ws(X),Cn(!0)},el=async()=>{if(!gr)return;const X=gr.id;de({open:!0,title:`Delete ${gr.title}`,description:"This action cannot be undone.",onConfirm:async()=>{await d(X),Cn(!1),Ws(null),de(Ue=>({...Ue,open:!1})),oe({title:"Event deleted"})}})};function $i(X){if(!X)return null;const Ue=X.length===16?`${X}:00`:X,mn=-new Date().getTimezoneOffset(),Hn=mn>=0?"+":"-",K=Math.abs(mn),ke=String(Math.floor(K/60)).padStart(2,"0"),Ye=String(K%60).padStart(2,"0");return`${Ue}${Hn}${ke}:${Ye}`}const kp=async()=>{if(!Be.title){oe({title:"Please provide event name",variant:"destructive"});return}try{let X=null,Ue=null;if(Be.start_time&&Be.end_time)X=$i(Be.start_time),Ue=$i(Be.end_time);else if(Be.start_time&&!Be.end_time){X=$i(Be.start_time);const mn=Be.start_time.split("T")[0];Ue=$i(`${mn}T23:59`)}else if(!Be.start_time&&Be.end_time){const mn=Be.end_time.split("T")[0];X=$i(`${mn}T00:00`),Ue=$i(Be.end_time)}if(Rn){const{updateEvent:mn}=await Qu(async()=>{const{updateEvent:Hn}=await Promise.resolve().then(()=>Ace);return{updateEvent:Hn}},void 0).then(Hn=>({updateEvent:Hn.useEvents}));await le.from("events").update({title:Be.title,start_time:X,end_time:Ue,description:Be.description||null}).eq("id",Rn),ze(Hn=>Hn.map(K=>K.id===Rn?{...K,title:Be.title,start_time:X,end_time:Ue,description:Be.description||null}:K)),oe({title:"Event updated!"})}else await u({title:Be.title,start_time:X,end_time:Ue,description:Be.description||null}),oe({title:"Event created!"});lt({title:"",start_time:"",end_time:"",description:""}),lr(null),or(!1)}catch(X){console.error("create/update event failed",X),oe({title:"Failed to save event",variant:"destructive"})}},Sp=X=>{lr(X.id),lt({title:X.title||"",start_time:X.start_time?_R(X.start_time):"",end_time:X.end_time?_R(X.end_time):"",description:X.description||""}),or(!0)},Cp=async X=>{if(!Oe.trim()){oe({title:"Please describe your template",variant:"destructive"});return}Re(!0);try{const{data:Ue,error:mn}=await le.functions.invoke("generate-template",{body:{prompt:Oe,channel:X}});if(mn)throw mn;Ue!=null&&Ue.template?(tl(X),se({name:`AI: ${Oe.slice(0,30)}...`,subject:Ue.subject||"",body:Ue.template}),oe({title:"Template generated!",description:"Review and save your template."})):oe({title:"No template returned",variant:"destructive"})}catch(Ue){console.error(Ue),oe({title:"Generation failed",variant:"destructive"})}finally{Re(!1),He(""),ye(!1),Te(!1)}},tl=(X,Ue)=>{ve(X),Ue?(Le(Ue.id),se({name:Ue.name||"",subject:Ue.subject||"",body:Ue.body||""})):(Le(null),se({name:"",subject:"",body:""}))},_p=()=>{ve(null),Le(null),se({name:"",subject:"",body:""})},nl=async()=>{if(!J)return oe({title:"Invalid mode",variant:"destructive"});if(!Q.name||!Q.body)return oe({title:"Name and body required",variant:"destructive"});_e?(await h(_e,{name:Q.name,subject:J==="email"&&Q.subject||null,body:Q.body,channel:J}),oe({title:"Template updated"})):(await c({name:Q.name,subject:J==="email"&&Q.subject||null,body:Q.body,channel:J,is_selected_for_email:!1,is_selected_for_whatsapp:!1}),oe({title:"Template created"})),_p()},Ul=()=>({name:(r==null?void 0:r.full_name)||(e==null?void 0:e.full_name)||(e==null?void 0:e.name)||"Your Name",title:(r==null?void 0:r.designation)||(e==null?void 0:e.designation)||"Your Title",company:(r==null?void 0:r.company)||(e==null?void 0:e.company)||"Your Company",email:(r==null?void 0:r.email)||(e==null?void 0:e.email)||"",phone:(r==null?void 0:r.phone)||(e==null?void 0:e.phone)||"",website:(r==null?void 0:r.website)||(e==null?void 0:e.website)||"",linkedin:(r==null?void 0:r.linkedin)||(e==null?void 0:e.linkedin)||"",photo_url:(r==null?void 0:r.photo_url)||(e==null?void 0:e.photo_url)||"",logo_url:(r==null?void 0:r.logo_url)||(e==null?void 0:e.logo_url)||""}),ho=X=>{const Ue=Ul();return`
<table style="font-family: Arial, sans-serif; font-size: 14px; color: #333;">
  <tr>
    <td style="padding-right: 15px; border-right: 2px solid #4F46E5;">
      ${Ue.photo_url?`<img src="${Ue.photo_url}" alt="${X.name}" style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover;">`:""}
    </td>
    <td style="padding-left: 15px;">
      <strong style="font-size: 16px; color: #1a1a1a;">${X.name||"Your Name"}</strong><br>
      <span style="color: #666;">${X.title||"Your Title"} | ${X.company||"Your Company"}</span><br>
      <span style="color: #4F46E5;">${X.email||""}</span><br>
      <span>${X.phone||""}</span>
    </td>
  </tr>
</table>`},Ip=async()=>{const X=ho(Y);await g({name:Y.name||"Custom Signature",html:X,is_selected:!0}),at(!1),oe({title:"Signature saved!"})},po=()=>{const X=Ul(),Ue=X.photo_url?`<img src="${X.photo_url}" alt="${X.name}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 10px;">`:"",mn=X.logo_url?`<img src="${X.logo_url}" alt="${X.company}" style="height: 30px; max-width: 100px; object-fit: contain;">`:"",Hn=[{name:"Minimal",html:`<div style="font-family: Arial, sans-serif; font-size: 13px;">${Ue}<strong>${X.name}</strong><br><span style="color: #666;">${X.title} | ${X.company}</span><br><a href="mailto:${X.email}" style="color: #4F46E5;">${X.email}</a> | ${X.phone}</div>`},{name:"Professional",html:`<table style="font-family: 'Segoe UI', Arial, sans-serif;"><tr>${X.photo_url?`<td style="padding-right: 12px;"><img src="${X.photo_url}" alt="${X.name}" style="width: 70px; height: 70px; border-radius: 8px; object-fit: cover;"></td>`:""}<td style="padding-right: 12px; border-right: 3px solid #4F46E5;"><strong style="font-size: 15px; color: #1a1a1a;">${X.name}</strong><br><em style="color: #666; font-size: 13px;">${X.title}</em></td><td style="padding-left: 12px; font-size: 12px;"><strong>${X.company}</strong>${mn?`<br>${mn}`:""}<br>${X.email}<br>${X.phone}</td></tr></table>`},{name:"Creative",html:`<div style="font-family: Georgia, serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 15px; border-radius: 8px;">${X.photo_url?`<img src="${X.photo_url}" alt="${X.name}" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; float: left; margin-right: 12px;">`:""}<strong style="font-size: 16px; color: #2d3748;">${X.name}</strong><br><span style="color: #718096; font-style: italic;">${X.title} @ ${X.company}</span><br><a href="mailto:${X.email}" style="color: #4F46E5; text-decoration: none;">${X.email}</a>${mn?`<br>${mn}`:""}</div>`},{name:"Elegant",html:`<table style="font-family: 'Helvetica Neue', Arial, sans-serif; border-top: 2px solid #e2e8f0; padding-top: 10px;"><tr>${X.photo_url?`<td style="padding-right: 15px;"><img src="${X.photo_url}" alt="${X.name}" style="width: 80px; height: 80px; border-radius: 10px; object-fit: cover;"></td>`:""}<td><span style="font-size: 15px; font-weight: 600; color: #1a202c;">${X.name}</span><br><span style="font-size: 12px; color: #718096; text-transform: uppercase; letter-spacing: 1px;">${X.title}</span><br><span style="font-size: 12px; color: #4a5568;">${X.company}</span>${mn?`<br>${mn}`:""}<br><span style="font-size: 12px; color: #4F46E5;">${X.email}</span></td></tr></table>`}];qe(Hn),Ct(0)},Tp=async()=>{bt(!0),he(!1),Ce(!0);const X=Ul();try{const{data:Ue,error:mn}=await le.functions.invoke("generate-signatures",{body:{name:X.name,company:X.company,designation:X.title,email:X.email,phone:X.phone,website:X.website,linkedin:X.linkedin,photo_url:X.photo_url,logo_url:X.logo_url,prompt:ht||"Premium professional signature"}});if(mn)throw mn;Ue!=null&&Ue.signatures&&Array.isArray(Ue.signatures)?(qe(Ue.signatures),Ct(0)):po()}catch(Ue){console.error("Error generating signatures:",Ue),po(),oe({title:"Using default signatures",description:"AI generation failed, showing defaults."})}finally{bt(!1)}},Hl=()=>{const X=$t[it];X&&(navigator.clipboard.writeText(X.html),Ut(!0),setTimeout(()=>Ut(!1),2e3),oe({title:"Signature HTML copied!",description:"Paste this into your email settings."}))},Ep=async()=>{const X=$t[it];X&&(await g({name:X.name,html:X.html,is_selected:!0}),oe({title:"Signature saved!"}))},wc=()=>{const X=$t[it];if(X){const Ue=X.html.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(div|p|td|tr|table)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/\n\s*\n/g,`

`).trim();window.location.href=`mailto:?body=${encodeURIComponent(`

---
`+Ue)}`}};return o.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-6 sm:space-y-8 animate-fade-up max-w-7xl mx-auto overflow-x-hidden",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Dashboard"}),o.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Welcome back",e!=null&&e.name?`, ${e.name.split(" ")[0]}`:"","! Here's your networking overview."]})]}),o.jsxs("div",{className:"flex gap-1.5 sm:gap-2 flex-wrap items-center",children:[whe.map(X=>o.jsx(fe,{variant:S===X||X==="Custom"&&S.startsWith("Custom:")?"default":"outline",size:"sm",className:"text-xs sm:text-sm px-2 sm:px-3",onClick:()=>ka(X),children:X},X)),S.startsWith("Custom:")&&o.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground ml-1 sm:ml-2 break-all",children:S})]}),o.jsx(gn,{open:E,onOpenChange:j,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:"Select Date Range"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex gap-4",children:[o.jsxs(j2,{children:[o.jsx(A2,{asChild:!0,children:o.jsxs(fe,{variant:"outline",className:"w-full justify-start text-left",children:[o.jsx(kS,{className:"mr-2 h-4 w-4"}),_.from?hr(_.from,"PPP"):"From date"]})}),o.jsx(Hw,{className:"w-auto p-0",align:"start",children:o.jsx(Kw,{mode:"single",selected:_.from,onSelect:X=>T(Ue=>({...Ue,from:X}))})})]}),o.jsxs(j2,{children:[o.jsx(A2,{asChild:!0,children:o.jsxs(fe,{variant:"outline",className:"w-full justify-start text-left",children:[o.jsx(kS,{className:"mr-2 h-4 w-4"}),_.to?hr(_.to,"PPP"):"To date"]})}),o.jsx(Hw,{className:"w-auto p-0",align:"start",children:o.jsx(Kw,{mode:"single",selected:_.to,onSelect:X=>T(Ue=>({...Ue,to:X}))})})]})]}),o.jsx(fe,{onClick:Qn,className:"w-full",disabled:!_.from||!_.to,children:"Apply Range"})]})]})}),o.jsx(X3,{children:o.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[o.jsx(xn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"0ms",animationFillMode:"forwards"},children:o.jsxs(wn,{className:"pt-6",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:o.jsx(_3,{className:"h-5 w-5 text-primary"})}),o.jsxs(tv,{children:[o.jsx(nv,{asChild:!0,children:o.jsx(Qb,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),o.jsx(hx,{children:o.jsx("p",{children:"Unique QR scans and NFC taps."})})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.card_views)??0).toLocaleString()}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Card Views"})]})]})}),o.jsx(xn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"100ms",animationFillMode:"forwards"},children:o.jsxs(wn,{className:"pt-6",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:o.jsx(Cl,{className:"h-5 w-5 text-primary"})}),o.jsxs(tv,{children:[o.jsx(nv,{asChild:!0,children:o.jsx(Qb,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),o.jsx(hx,{children:o.jsx("p",{children:"People who saved your contact to their device."})})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.contact_saves)??0).toLocaleString()}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact Saves"})]})]})}),o.jsx(xn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"200ms",animationFillMode:"forwards"},children:o.jsxs(wn,{className:"pt-6",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:o.jsx(CY,{className:"h-5 w-5 text-primary"})}),o.jsxs(tv,{children:[o.jsx(nv,{asChild:!0,children:o.jsx(Qb,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),o.jsx(hx,{children:o.jsx("p",{children:"Contacts you added to your CRM (manual, scanned, auto-captured)."})})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.connections_added)??0).toLocaleString()}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Connections Added"})]})]})}),o.jsx(xn,{className:"card-hover opacity-0 animate-fade-up cursor-pointer",style:{animationDelay:"300ms",animationFillMode:"forwards"},onClick:G,children:o.jsxs(wn,{className:"pt-6",children:[o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:o.jsx(Ru,{className:"h-5 w-5 text-primary"})}),o.jsxs(tv,{children:[o.jsx(nv,{asChild:!0,children:o.jsx(Qb,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),o.jsx(hx,{children:o.jsx("p",{children:"Attended events / unique card views across attended events. Click to view event-level breakdown."})})]})]}),o.jsxs("div",{className:"mt-4",children:[o.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":`${V} / ${O}`}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Events"})]})]})})]})}),o.jsx(gn,{open:I,onOpenChange:D,children:o.jsxs(cn,{className:"sm:max-w-lg",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Attended Events"})}),o.jsx("div",{className:"space-y-4",children:q?o.jsx("div",{className:"flex items-center justify-center py-8",children:o.jsx(Gt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):F.length===0?o.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No attended events in this period."}):o.jsx("div",{className:"space-y-3",children:F.map(X=>o.jsx("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:o.jsxs("div",{className:"flex items-start justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-sm",children:X.title}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[X.start_time?Jb(X.start_time):"",X.end_time&&` - ${Jb(X.end_time).split(", ")[1]}`]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-lg font-bold text-primary",children:X.views}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"unique views"})]})]})},X.id))})})]})}),o.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[o.jsxs(xn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"200ms",animationFillMode:"forwards"},onClick:w?void 0:N,children:[!w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),o.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:o.jsx(yl,{className:"h-4 w-4 text-white"})})})]}),o.jsx(Fn,{className:"pt-3",children:o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:o.jsx(xi,{className:"h-5 w-5 text-primary"})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx(Pn,{className:"text-lg truncate",children:"Email Templates"}),o.jsx(gi,{className:"truncate",children:"Quick templates for emails"})]})]}),o.jsxs("div",{className:"flex gap-1 shrink-0",children:[o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>ye(!0),disabled:!w,children:[o.jsx(Hs,{className:"h-4 w-4 mr-1"})," AI"]}),o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>tl("email"),disabled:!w,children:[o.jsx(qs,{className:"h-4 w-4 mr-1"})," Add"]})]})]})}),o.jsxs(wn,{className:"space-y-3",children:[m().map(X=>o.jsxs("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("span",{className:"font-medium text-sm",children:X.name}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(fe,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>tl("email",X),disabled:!w,children:o.jsx(Wv,{className:"h-4 w-4"})}),o.jsx(fe,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(X.id),disabled:!w,children:o.jsx(Do,{className:"h-4 w-4 text-destructive"})})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:X.body})]},X.id)),m().length===0&&o.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No email templates yet"})]})]}),o.jsxs(xn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"300ms",animationFillMode:"forwards"},onClick:w?void 0:N,children:[!w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),o.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:o.jsx(yl,{className:"h-4 w-4 text-white"})})})]}),o.jsx(Fn,{className:"pt-3",children:o.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[o.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center shrink-0",children:o.jsx(Sm,{className:"h-5 w-5 text-emerald-500"})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx(Pn,{className:"text-lg truncate",children:"WhatsApp Templates"}),o.jsx(gi,{className:"truncate",children:"Quick messages for WhatsApp"})]})]}),o.jsxs("div",{className:"flex gap-1 shrink-0",children:[o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>Te(!0),disabled:!w,children:[o.jsx(Hs,{className:"h-4 w-4 mr-1"})," AI"]}),o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>tl("whatsapp"),disabled:!w,children:[o.jsx(qs,{className:"h-4 w-4 mr-1"})," Add"]})]})]})}),o.jsxs(wn,{className:"space-y-3",children:[f().map(X=>o.jsxs("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("span",{className:"font-medium text-sm",children:X.name}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(fe,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>tl("whatsapp",X),disabled:!w,children:o.jsx(Wv,{className:"h-4 w-4"})}),o.jsx(fe,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(X.id),disabled:!w,children:o.jsx(Do,{className:"h-4 w-4 text-destructive"})})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:X.body})]},X.id)),f().length===0&&o.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No WhatsApp templates yet"})]})]}),o.jsxs(xn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"400ms",animationFillMode:"forwards"},onClick:w?void 0:N,children:[!w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),o.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:o.jsx(yl,{className:"h-4 w-4 text-white"})})})]}),o.jsx(Fn,{children:o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/10 flex items-center justify-center",children:o.jsx(xi,{className:"h-5 w-5 text-violet-500"})}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs("div",{children:[o.jsx(Pn,{className:"text-lg",children:"Email Signature"}),o.jsx(gi,{children:"AI-powered & premium templates synced with your card"})]})})]})})}),o.jsx(wn,{children:w?o.jsx(vhe,{activeCard:r}):o.jsx("div",{className:"py-4 text-center text-muted-foreground text-sm",children:"Upgrade to access email signatures"})})]}),o.jsxs(xn,{className:"opacity-0 animate-fade-up",style:{animationDelay:"500ms",animationFillMode:"forwards"},children:[o.jsx(Fn,{children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center",children:o.jsx(jY,{className:"h-5 w-5 text-blue-500"})}),o.jsxs("div",{children:[o.jsx(Pn,{className:"text-lg",children:"Tags"}),o.jsx(gi,{children:"Tap a tag to delete it."})]})]})}),o.jsxs(wn,{children:[o.jsx("div",{ref:jr,className:"flex flex-wrap gap-2",children:pe.map(X=>o.jsx("button",{onClick:()=>zg(X),className:Ie("inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm select-none cursor-pointer border"),style:{backgroundColor:"#F9FAFB",borderColor:"#111827",color:"#111827"},children:o.jsx("span",{children:X.name})},X.id))}),o.jsxs("div",{className:"flex gap-2 mt-4",children:[o.jsx(Ge,{placeholder:"New tag...",value:Ot,onChange:X=>Et(X.target.value),onKeyDown:X=>X.key==="Enter"&&Lt()}),o.jsx(fe,{variant:"outline",size:"icon",onClick:Lt,children:o.jsx(qs,{className:"h-4 w-4"})})]})]})]}),o.jsxs(xn,{className:Ie("lg:col-span-2 opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"600ms",animationFillMode:"forwards"},onClick:w?void 0:N,children:[!w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),o.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:o.jsx(yl,{className:"h-4 w-4 text-white"})})})]}),o.jsx(Fn,{children:o.jsxs("div",{className:"w-full",children:[o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center",children:o.jsx(Ru,{className:"h-5 w-5 text-amber-500"})}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs("div",{children:[o.jsx(Pn,{className:"text-lg",children:"Events"}),o.jsx(gi,{children:"Schedule an event."})]})})]})}),o.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[Je.filter(X=>!X.start_time&&!X.end_time).map(X=>o.jsx("button",{onClick:()=>w&&vs(X),className:"inline-flex items-center px-3 py-1 rounded-full text-sm cursor-pointer",style:{backgroundColor:X.color?`${X.color}20`:"#f3f4f6",border:`1px solid ${X.color?`${X.color}40`:"#e5e7eb"}`,color:X.color||void 0},disabled:!w,children:X.title},X.id)),o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>{lr(null),lt({title:"",start_time:"",end_time:"",description:""}),or(!0)},disabled:!w,children:[o.jsx(qs,{className:"h-4 w-4 mr-1"})," Add Event"]})]})]})}),o.jsxs(wn,{children:[Je.filter(X=>X.start_time||X.end_time).length>0&&o.jsxs("div",{className:"mb-4",children:[o.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Scheduled Events"}),o.jsx("div",{ref:Bn,className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Je.filter(X=>X.start_time||X.end_time).map(X=>o.jsxs("div",{className:"p-4 rounded-xl border border-border/50 bg-muted/30",children:[o.jsxs("div",{className:"flex items-start justify-between mb-2",children:[o.jsx("span",{className:"font-medium",children:X.title}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx("button",{onClick:()=>w&&Sp(X),className:"p-1 hover:bg-muted rounded",disabled:!w,children:o.jsx(Wv,{className:"h-4 w-4 text-muted-foreground"})}),o.jsx("button",{onClick:()=>w&&Vl(X),className:"p-1 hover:bg-destructive/10 rounded",disabled:!w,children:o.jsx(Do,{className:"h-4 w-4 text-destructive"})})]})]}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[X.start_time?Jb(X.start_time):"No start time",X.end_time&&`  ${Jb(X.end_time)}`]})]},X.id))})]}),Je.length===0&&o.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No events yet. Add events to auto-tag contacts created during event times."})]})]})]}),o.jsx(gn,{open:Ft,onOpenChange:X=>{X||(Ht(!1),vt(null))},children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsx(hn,{className:"flex items-center justify-between",children:o.jsx("span",{children:"Event options"})})}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{children:o.jsx("p",{className:"font-medium text-lg",children:(ct==null?void 0:ct.name)||(ct==null?void 0:ct.title)})}),o.jsxs("div",{children:[o.jsx(We,{children:"Change color"}),o.jsxs("div",{className:"mt-2",children:[o.jsx("div",{className:"rounded-md overflow-hidden",style:{boxShadow:"inset 0 1px 0 rgba(255,255,255,0.3)"},children:o.jsx("input",{type:"range",min:0,max:360,value:ln,onChange:X=>Og(Number(X.target.value)),className:"w-full h-6 appearance-none",style:{background:"linear-gradient(90deg, #ff0000 0%, #ff9900 12.5%, #ffff00 25%, #00ff00 37.5%, #00ffff 50%, #0066ff 62.5%, #7a00ff 75%, #ff00ff 87.5%, #ff0000 100%)",outline:"none"}})}),o.jsxs("div",{className:"flex items-center justify-between mt-2",children:[o.jsxs("div",{className:"inline-flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-md border",style:{background:T$(ln,80,50)}}),o.jsx("div",{className:"text-sm",children:o.jsx("div",{className:"font-medium",children:(ct==null?void 0:ct.name)||(ct==null?void 0:ct.title)})})]}),o.jsx("div",{className:"text-xs text-muted-foreground",children:"Color saved automatically"})]})]})]}),o.jsx("div",{className:"mt-2",children:o.jsx(fe,{variant:"destructive",className:"w-full",onClick:Lg,children:"Delete event"})})]})]})}),o.jsx(gn,{open:Na,onOpenChange:X=>{X||(aa(!1),Da(null))},children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsx(hn,{className:"flex items-center justify-between",children:o.jsx("span",{children:"Tag options"})})}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{children:o.jsx("p",{className:"font-medium text-lg",children:qr==null?void 0:qr.name})}),o.jsx(fe,{variant:"destructive",className:"w-full",onClick:vc,children:"Delete tag"})]})]})}),o.jsx(gn,{open:Bs,onOpenChange:X=>{X||(Cn(!1),Ws(null))},children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsxs(hn,{children:["Delete ",gr==null?void 0:gr.title]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone."}),o.jsx("div",{className:"mt-4",children:o.jsx(fe,{variant:"destructive",className:"w-full",onClick:el,children:"Delete"})})]})]})}),o.jsx(gn,{open:Mn,onOpenChange:X=>{X?or(!0):(or(!1),lr(null),lt({title:"",start_time:"",end_time:"",description:""}))},children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:Rn?"Edit Event":"Add Event"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Event Name"}),o.jsx(Ge,{value:Be.title,onChange:X=>lt(Ue=>({...Ue,title:X.target.value})),placeholder:"e.g., Tech Summit 2025"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{children:["Start Date & Time ",o.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),o.jsx(Ge,{type:"datetime-local",value:Be.start_time,onChange:X=>lt(Ue=>({...Ue,start_time:X.target.value}))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{children:["End Date & Time ",o.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),o.jsx(Ge,{type:"datetime-local",value:Be.end_time,onChange:X=>lt(Ue=>({...Ue,end_time:X.target.value}))})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave dates empty to create an event chip only. If only start is set, end defaults to 11:59 PM same day."}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Description (optional)"}),o.jsx(Pa,{value:Be.description,onChange:X=>lt(Ue=>({...Ue,description:X.target.value})),rows:2})]}),o.jsx(fe,{onClick:kp,className:"w-full",children:Rn?"Save Changes":"Create Event"})]})]})}),o.jsx(gn,{open:Se,onOpenChange:ye,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(xi,{className:"h-5 w-5 text-primary"}),"Create Email Template with AI"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Describe your email template"}),o.jsx(Pa,{value:Oe,onChange:X=>He(X.target.value),placeholder:"e.g., A professional follow-up email after meeting at a conference, asking to schedule a call...",rows:4}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"AI will generate a professional email with subject line and body."})]}),o.jsx(fe,{onClick:()=>Cp("email"),className:"w-full",disabled:Ee||!Oe.trim(),children:Ee?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Generate Email Template"]})})]})]})}),o.jsx(gn,{open:Fe,onOpenChange:Te,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(Sm,{className:"h-5 w-5 text-emerald-500"}),"Create WhatsApp Template with AI"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Describe your message"}),o.jsx(Pa,{value:Oe,onChange:X=>He(X.target.value),placeholder:"e.g., A quick follow-up message after meeting someone, casual and friendly...",rows:3}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"AI will generate a short, casual WhatsApp message."})]}),o.jsx(fe,{onClick:()=>Cp("whatsapp"),className:"w-full",disabled:Ee||!Oe.trim(),children:Ee?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):o.jsxs(o.Fragment,{children:[o.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Generate WhatsApp Template"]})})]})]})}),o.jsx(gn,{open:Ne,onOpenChange:he,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(Hs,{className:"h-5 w-5 text-primary"}),"Generate Email Signature"]})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Design Style (optional)"}),o.jsx(Pa,{value:ht,onChange:X=>Dt(X.target.value),placeholder:"e.g., Minimal with accent color, creative gradient style, corporate blue theme... Leave blank for random professional design",rows:3}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Describe your preferred style or leave blank for AI to choose."})]}),o.jsxs(fe,{onClick:Tp,className:"w-full",children:[o.jsx(Hs,{className:"h-4 w-4 mr-2"}),"Generate Signatures"]})]})]})}),o.jsx(gn,{open:we,onOpenChange:Ce,children:o.jsxs(cn,{className:"max-w-2xl",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Select Your Signature"})}),o.jsx("div",{className:"space-y-4",children:Ln?o.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary mb-4"}),o.jsx("p",{className:"text-muted-foreground",children:"Generating signatures with AI..."})]}):$t.length>0?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:$t.map((X,Ue)=>o.jsx("button",{onClick:()=>Ct(Ue),className:Ie("flex-shrink-0 px-4 py-2 rounded-lg border transition-all",it===Ue?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50"),children:X.name},Ue))}),o.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",children:o.jsx("div",{dangerouslySetInnerHTML:{__html:Vc.sanitize(((rl=$t[it])==null?void 0:rl.html)||"")}})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(fe,{onClick:Hl,className:"flex-1",children:[pt?o.jsx(an,{className:"h-4 w-4 mr-2"}):o.jsx(SS,{className:"h-4 w-4 mr-2"}),pt?"Copied!":"Copy HTML"]}),o.jsx(fe,{onClick:Ep,variant:"outline",className:"flex-1",children:"Save Signature"})]})]}):null})]})}),o.jsx(gn,{open:Ae,onOpenChange:gt,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:"Export Signature"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",children:o.jsx("div",{dangerouslySetInnerHTML:{__html:Vc.sanitize(((mo=$t[it])==null?void 0:mo.html)||((al=x())==null?void 0:al.html)||ho({name:(e==null?void 0:e.name)||"",title:(e==null?void 0:e.designation)||"",company:(e==null?void 0:e.company)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""}))}})}),o.jsxs("div",{className:"flex flex-col gap-2",children:[o.jsxs(fe,{onClick:Hl,className:"w-full",children:[pt?o.jsx(an,{className:"h-4 w-4 mr-2"}):o.jsx(SS,{className:"h-4 w-4 mr-2"}),pt?"Copied!":"Copy HTML"]}),o.jsxs(fe,{onClick:wc,variant:"outline",className:"w-full",children:[o.jsx(xi,{className:"h-4 w-4 mr-2"}),"Open Email with Signature"]})]})]})]})}),o.jsx(gn,{open:Ke,onOpenChange:at,children:o.jsxs(cn,{className:"max-w-2xl",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Edit Signature"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Name"}),o.jsx(Ge,{value:Y.name,onChange:X=>ae(Ue=>({...Ue,name:X.target.value}))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Title"}),o.jsx(Ge,{value:Y.title,onChange:X=>ae(Ue=>({...Ue,title:X.target.value}))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Company"}),o.jsx(Ge,{value:Y.company,onChange:X=>ae(Ue=>({...Ue,company:X.target.value}))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Email"}),o.jsx(Ge,{value:Y.email,onChange:X=>ae(Ue=>({...Ue,email:X.target.value}))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Phone"}),o.jsx(Ge,{value:Y.phone,onChange:X=>ae(Ue=>({...Ue,phone:X.target.value}))})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Preview"}),o.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",dangerouslySetInnerHTML:{__html:Vc.sanitize(ho(Y))}})]}),o.jsx(fe,{onClick:Ip,className:"w-full",children:"Save Signature"})]})]})}),o.jsx(gn,{open:!!J,onOpenChange:X=>{X||_p()},children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:_e?"Edit Template":"Add Template"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Template Name"}),o.jsx(Ge,{value:Q.name,onChange:X=>se(Ue=>({...Ue,name:X.target.value})),placeholder:"e.g., Follow-up"})]}),J==="email"&&o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Subject (for email)"}),o.jsx(Ge,{value:Q.subject,onChange:X=>se(Ue=>({...Ue,subject:X.target.value})),placeholder:"e.g., Great meeting you, {{name}}!"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Body"}),o.jsx(Pa,{value:Q.body,onChange:X=>se(Ue=>({...Ue,body:X.target.value})),rows:5,placeholder:J==="email"?"Hi {{name}}, ...":"Hey {{name}}, ..."}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:["Placeholders: ","{{name}}",", ","{{company}}",", ","{{designation}}",", ","{{myName}}",", ","{{myCompany}}"]})]}),o.jsx(fe,{onClick:nl,className:"w-full",children:_e?"Save Changes":"Save Template"})]})]})}),o.jsx(qz,{open:wt.open,onOpenChange:X=>de(Ue=>({...Ue,open:X})),title:wt.title,description:wt.description,onConfirm:wt.onConfirm})]})}const khe="#6366f1",She=500;function Che({open:e,onOpenChange:t,contactId:n,tags:r,events:a,localContactTags:s,localContactEvents:i,onTagToggle:l,onEventToggle:u,onTagCreated:d,onTagUpdated:c,onTagDeleted:h}){const[p,m]=k.useState(!1),[f,g]=k.useState(""),[x,y]=k.useState(!1),[b,v]=k.useState(null),[w,N]=k.useState(""),[S,C]=k.useState(!1),[_,T]=k.useState(!1),E=k.useRef(null),j=k.useRef(!1),I=async()=>{if(!f.trim()){oe({title:"Tag name required",variant:"destructive"});return}if(r.find(L=>L.name.toLowerCase()===f.trim().toLowerCase())){oe({title:"Tag already exists",variant:"destructive"});return}y(!0);try{const L=await(d==null?void 0:d(f.trim(),khe));L&&(oe({title:"Tag created"}),n&&l(n,L.id),g(""),m(!1))}catch(L){oe({title:"Failed to create tag",description:L==null?void 0:L.message,variant:"destructive"})}finally{y(!1)}},D=O=>{j.current=!1,E.current=setTimeout(()=>{j.current=!0,v(O),N(O.name)},She)},F=()=>{E.current&&(clearTimeout(E.current),E.current=null)},P=O=>{!j.current&&n&&l(n,O.id),j.current=!1},V=async()=>{if(!b||!w.trim()){oe({title:"Tag name required",variant:"destructive"});return}if(r.find(L=>L.id!==b.id&&L.name.toLowerCase()===w.trim().toLowerCase())){oe({title:"Tag already exists",variant:"destructive"});return}C(!0);try{await(c==null?void 0:c(b.id,w.trim())),oe({title:"Tag updated"}),v(null),N("")}catch(L){oe({title:"Failed to update tag",description:L==null?void 0:L.message,variant:"destructive"})}finally{C(!1)}},$=async()=>{if(b){T(!0);try{await(h==null?void 0:h(b.id)),oe({title:"Tag deleted"}),v(null),N("")}catch(O){oe({title:"Failed to delete tag",description:O==null?void 0:O.message,variant:"destructive"})}finally{T(!1)}}};return o.jsxs(o.Fragment,{children:[o.jsx(gn,{open:e,onOpenChange:t,children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Manage Tags & Events"})}),n&&o.jsxs("div",{className:"space-y-5",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsxs("p",{className:"text-sm font-medium",children:["Tags ",o.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(long press to edit)"})]}),!p&&o.jsxs(fe,{variant:"ghost",size:"sm",onClick:()=>m(!0),className:"h-7 text-xs",children:[o.jsx(qs,{className:"h-3.5 w-3.5 mr-1"}),"Add Tag"]})]}),p&&o.jsxs("div",{className:"mb-3 p-3 rounded-lg border border-border bg-muted/30 space-y-3",children:[o.jsx(Ge,{placeholder:"Tag name...",value:f,onChange:O=>g(O.target.value),className:"h-9",autoFocus:!0,onKeyDown:O=>{O.key==="Enter"&&I(),O.key==="Escape"&&(m(!1),g(""))}}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(fe,{variant:"outline",size:"sm",onClick:()=>{m(!1),g("")},disabled:x,className:"flex-1",children:"Cancel"}),o.jsx(fe,{size:"sm",onClick:I,disabled:x||!f.trim(),className:"flex-1",children:x?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Create"})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.map(O=>{const L=s.includes(O.id);return o.jsx("button",{onClick:()=>P(O),onMouseDown:()=>D(O),onMouseUp:F,onMouseLeave:F,onTouchStart:()=>D(O),onTouchEnd:F,onTouchCancel:F,className:Ie("px-3 py-1.5 rounded-full text-sm border transition-all select-none",L?"bg-blue-50 dark:bg-blue-950/40 border-blue-200 dark:border-blue-800 underline underline-offset-2 decoration-blue-500":"border-border hover:border-primary/50 bg-background"),children:O.name},O.id)}),r.length===0&&!p&&o.jsx("p",{className:"text-sm text-muted-foreground",children:"No tags yet"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium mb-2",children:"Events"}),o.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.map(O=>{const L=i.includes(O.id);return o.jsx("button",{onClick:()=>u(n,O.id),className:Ie("px-3 py-1.5 rounded-full text-sm border transition-all",L?"bg-blue-50 dark:bg-blue-950/40 border-blue-200 dark:border-blue-800 underline underline-offset-2 decoration-blue-500":"border-border hover:border-accent/50 bg-background"),children:O.title},O.id)}),a.length===0&&o.jsx("p",{className:"text-sm text-muted-foreground",children:"No events created"})]})]})]})]})}),o.jsx(gn,{open:!!b,onOpenChange:O=>!O&&v(null),children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Edit Tag"})}),o.jsxs("div",{className:"space-y-4 py-2",children:[o.jsx(Ge,{placeholder:"Tag name...",value:w,onChange:O=>N(O.target.value),className:"h-10",autoFocus:!0,onKeyDown:O=>{O.key==="Enter"&&V(),O.key==="Escape"&&v(null)}}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(fe,{variant:"destructive",size:"sm",onClick:$,disabled:S||_,className:"flex-1",children:_?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(Do,{className:"h-4 w-4 mr-1.5"}),"Delete"]})}),o.jsx(fe,{size:"sm",onClick:V,disabled:S||_||!w.trim(),className:"flex-1",children:S?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Save"})]})]})]})})]})}const _he=(e,t)=>{const[n,r]=k.useState(t??null);return k.useEffect(()=>{if(!e)return;let a=!1;(async()=>{const{data:l}=await le.from("cards").select("photo_url").eq("id",e).maybeSingle();!a&&(l==null?void 0:l.photo_url)!==n&&r((l==null?void 0:l.photo_url)??null)})();const i=le.channel(`card-avatar-${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"cards",filter:`id=eq.${e}`},l=>{var u;r(((u=l.new)==null?void 0:u.photo_url)??null)}).subscribe();return()=>{a=!0,le.removeChannel(i)}},[e]),n},Ihe=e=>{if(!e)return"?";const t=e.trim().split(/\s+/);return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():e.substring(0,2).toUpperCase()},A$={sm:"w-10 h-10 text-sm",md:"w-16 h-16 text-lg",lg:"w-24 h-24 text-2xl"},The="bg-[#F2F2F7]",Ehe="text-[#1C1C1E]",Qk=k.memo(function({name:t,photoUrl:n,sharedCardId:r,size:a="sm",className:s}){const[i,l]=k.useState(!1),u=_he(r,n),d=r?u??n:n;k.useEffect(()=>{l(!1)},[d]);const c=Ihe(t);return!d||i?o.jsx("div",{className:Ie("rounded-full flex items-center justify-center font-medium flex-shrink-0",The,Ehe,A$[a],s),children:c}):o.jsx("img",{src:d,alt:t,className:Ie("rounded-full object-cover flex-shrink-0",A$[a],s),onError:()=>l(!0)})}),jhe=e=>!e||!e.trim()?!0:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim()),Ahe=e=>(e==null?void 0:e.trim().toLowerCase())||"",R$=e=>{if(!e)return"";let t=e.trim();const n=t.startsWith("+");return t=t.replace(/\D/g,""),t?t.length===10?`+91${t}`:t.startsWith("91")&&t.length===12?`+${t}`:t.startsWith("0")&&t.length===11?`+91${t.slice(1)}`:t.length>=11?n||t.startsWith("91")?`+${t.replace(/^\+/,"")}`:`+${t}`:n?`+${t}`:t:""},Rhe=e=>{if(!e||!e.trim())return!0;const t=e.replace(/\D/g,"");return t.length>=10&&t.length<=15},jB=e=>{if(!e||!e.trim())return"";let t=e.trim();if(t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\s+/g,""),!t.match(/^https?:\/\//i)){if(t.includes("@"))return t;t=`https://${t}`}return t=t.replace(/^https?:\/+/i,n=>n.toLowerCase().includes("https")?"https://":"http://"),t=t.replace(/\/+$/,""),t},Dhe=e=>{if(!e||!e.trim())return!0;try{const t=jB(e);return new URL(t),!0}catch{return!1}},AB=e=>{if(!e||!e.trim())return{type:"unknown",username:"",fullUrl:""};let t=e.trim();t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\s+/g,""),t=t.replace(/\/+$/,"");const n=t.match(/(?:https?:\/\/)?(?:www\.)?linkedin\.com\/(in|company)\/([^\/\?#]+)/i);if(n){const s=n[1].toLowerCase()==="company"?"company":"personal",i=n[2];return{type:s,username:i,fullUrl:`https://www.linkedin.com/${s==="company"?"company":"in"}/${i}`}}const r=t.match(/^(in|company)\/([^\/\?#]+)/i);if(r){const s=r[1].toLowerCase()==="company"?"company":"personal",i=r[2];return{type:s,username:i,fullUrl:`https://www.linkedin.com/${s==="company"?"company":"in"}/${i}`}}const a=t.replace(/^.*linkedin\.com\/?(in|company)?\/?/i,"").replace(/[\/\?#].*$/,"");return a?{type:"personal",username:a,fullUrl:`https://www.linkedin.com/in/${a}`}:{type:"unknown",username:"",fullUrl:""}},Mhe=e=>AB(e).fullUrl,$he=e=>!e||!e.trim()?!0:AB(e).username.length>0,Qv=e=>e.email&&!jhe(e.email)?{isValid:!1,field:"email",message:"Invalid email address"}:e.phone&&!Rhe(e.phone)?{isValid:!1,field:"phone",message:"Invalid phone number"}:e.website&&!Dhe(e.website)?{isValid:!1,field:"website",message:"Invalid website URL"}:e.linkedin&&!$he(e.linkedin)?{isValid:!1,field:"linkedin",message:"Invalid LinkedIn profile"}:null,Jv=e=>({...e,email:e.email?Ahe(e.email):e.email,phone:e.phone?R$(e.phone):e.phone,whatsapp:e.whatsapp?R$(e.whatsapp):e.whatsapp,website:e.website?jB(e.website):e.website,linkedin:e.linkedin?Mhe(e.linkedin):e.linkedin}),Fhe="https://synka.in",Sc="pending_crm_interaction",rx="crm_returning_from_interaction";function Phe(){var ke,Ye;const e=za(),{user:t,loading:n}=ir(),{profile:r}=Ko(),{contacts:a,loading:s,createContact:i,updateContact:l,deleteContact:u,addTagToContact:d,removeTagFromContact:c,addEventToContact:h}=tie(),[p,m]=k.useState(a),{tags:f,createTag:g,updateTag:x,deleteTag:y}=_5(),{events:b,getActiveEventsForDate:v}=MI(),{getEmailTemplates:w,getWhatsappTemplates:N}=E5(),{getSelectedSignature:S}=A5(),[C,_]=k.useState(""),[T,E]=k.useState(!1),[j,I]=k.useState(!1),[D,F]=k.useState(!1),[P,V]=k.useState("All"),[$,O]=k.useState([]),[L,q]=k.useState([]),[U,ee]=k.useState(()=>localStorage.getItem("crm_sort_by")||"date"),[M,G]=k.useState(null),[J,ve]=k.useState(!1),[Q,se]=k.useState(!1),[_e,Le]=k.useState({name:"",company:"",designation:"",phone:"",email:"",whatsapp:"",linkedin:"",website:"",notes:"",tags:[]}),[Se,ye]=k.useState(null),[Fe,Te]=k.useState(!1),Oe=k.useRef(!1),He=k.useRef(null),Ee=k.useRef(null);k.useEffect(()=>{var W;M&&Le({name:M.name||"",company:M.company||"",designation:M.designation||"",phone:M.phone||"",email:M.email||"",whatsapp:M.whatsapp||"",linkedin:M.linkedin||"",website:M.website||"",notes:"",tags:((W=M.tags)==null?void 0:W.map(Z=>Z.id))||[]})},[M]),k.useEffect(()=>{Q&&setTimeout(()=>{var Z;(Z=He.current)==null||Z.focus();const W=He.current;W&&W.setSelectionRange(W.value.length,W.value.length)},120)},[Q]),k.useEffect(()=>{!Q&&Ee.current&&requestAnimationFrame(()=>{Ee.current.style.pointerEvents="auto"})},[Q]);function Re(W,Z){Le(xe=>({...xe,[W]:Z}))}async function Ke(){var Z,xe,je;if(!(M!=null&&M.id))return;if(!((Z=_e.name)!=null&&Z.trim())){ye("Name is required");return}const W=Qv({email:_e.email,phone:_e.phone,website:_e.website,linkedin:_e.linkedin});if(W){oe({title:W.message,variant:"destructive"});return}Te(!0),ye(null);try{const De=Jv({email:_e.email,phone:_e.phone,whatsapp:_e.whatsapp,website:_e.website,linkedin:_e.linkedin}),et={name:_e.name,company:_e.company||null,designation:_e.designation||null,phone:De.phone||null,email:De.email||null,whatsapp:De.whatsapp||null,linkedin:De.linkedin||null,website:De.website||null};if((xe=_e.notes)!=null&&xe.trim()){const Wn={text:_e.notes.trim(),timestamp:new Date().toISOString()},Fi=M.notes_history||[];et.notes_history=[Wn,...Fi]}const{error:Pt}=await l(M.id,et);if(Pt)throw Pt;G(Wn=>Wn?{...Wn,...et}:null),m(Wn=>Wn.map(Fi=>Fi.id===M.id?{...Fi,...et}:Fi)),et.notes_history&&Ne(et.notes_history),Le(Wn=>({...Wn,notes:""})),(je=He.current)==null||je.blur(),setTimeout(()=>{se(!1)},0),oe({title:"Contact updated"})}catch(De){console.error("Update error",De),ye((De==null?void 0:De.message)||"Update failed")}finally{Te(!1)}}const[at,Y]=k.useState(!1),[ae,we]=k.useState(""),[Ce,Ne]=k.useState([]),[he,Ae]=k.useState({open:!1,index:-1,systemText:"",userText:""}),gt=["WhatsApp Sent","Email Sent","Call Made"],ht=W=>{for(const Z of gt)if(W.startsWith(Z)){const xe=W.slice(Z.length);return xe.startsWith(" - ")?{systemText:Z,userText:xe.slice(3)}:{systemText:Z,userText:""}}return{systemText:"",userText:W}};k.useEffect(()=>{M!=null&&M.notes_history?Ne(M.notes_history):Ne([])},[M]),k.useEffect(()=>{!Q&&Ee.current&&requestAnimationFrame(()=>{Ee.current.scrollTop=0})},[Q]);const Dt=async()=>{if(!ae.trim()){oe({title:"Note cannot be empty",variant:"destructive"});return}if(!(M!=null&&M.id))return;const Z=[{text:ae,timestamp:new Date().toISOString()},...Ce],{error:xe}=await l(M.id,{notes_history:Z});xe||(Ne(Z),we(""),Y(!1),oe({title:"Note added"}))},[$t,qe]=k.useState(!1),[it,Ct]=k.useState(!1),[pt,Ut]=k.useState(!1),[Ln,bt]=k.useState(null),[Ot,Et]=k.useState(!1),[Lt,At]=k.useState("email"),[zt,Sn]=k.useState(null),[ot,pe]=k.useState([]),[Me,Je]=k.useState([]),[ze,Ft]=k.useState(null),[Ht,ct]=k.useState(!1),[vt,ln]=k.useState(""),[fr,Na]=k.useState(!1),[aa,qr]=k.useState(!1),[Da,zn]=k.useState("");k.useEffect(()=>{var W,Z;M&&pt&&(pe(((W=M.tags)==null?void 0:W.map(xe=>xe.id))||[]),Je(((Z=M.events)==null?void 0:Z.map(xe=>xe.id))||[]))},[M,pt]);const[Ma,Bs]=k.useState(!1),[Cn,gr]=k.useState(null),[Ws,wt]=k.useState(null),[de,Be]=k.useState(!1),lt=k.useRef(null),Mn=k.useRef(null),or=k.useRef(null),Rn=k.useRef(null),[lr,jr]=k.useState({open:!1,title:"",description:"",onConfirm:()=>{}}),[Bn,ka]=k.useState({name:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:"",notes:""});k.useEffect(()=>{!n&&!t&&e("/login")},[t,n,e]),k.useEffect(()=>{if(localStorage.getItem(rx)){localStorage.removeItem(rx);return}JSON.stringify(a)!==JSON.stringify(p)&&m(a)},[a]);const Qn=k.useCallback(()=>{try{const W=localStorage.getItem(Sc);if(!W)return;const Z=JSON.parse(W);Date.now()-new Date(Z.timestamp).getTime()<24*60*60*1e3?(Ft(Z),ct(!0)):localStorage.removeItem(Sc)}catch{localStorage.removeItem(Sc)}},[]);k.useEffect(()=>{const W=()=>{if(!Oe.current){Oe.current=!0;return}Qn()};return window.addEventListener("focus",W),()=>{window.removeEventListener("focus",W)}},[Qn]);const ii=(W,Z)=>{const xe={contactId:W.id,contactName:W.name,interactionType:Z,timestamp:new Date().toISOString()};localStorage.setItem(Sc,JSON.stringify(xe))},vs=()=>{localStorage.removeItem(Sc),Ft(null),ct(!1),Na(!1),ln(""),qr(!1),zn("")},Og=async()=>{if(localStorage.removeItem(Sc),!ze)return;const W=p.find(Pt=>Pt.id===ze.contactId);if(!W){vs();return}const Z=ze.interactionType==="whatsapp"?"WhatsApp Sent":ze.interactionType==="email"?"Email Sent":"Call Made",xe={text:Z,timestamp:new Date().toISOString()},je=W.notes_history||[],De=[xe,...je],{error:et}=await l(W.id,{notes_history:De});et?(oe({title:"Failed to save note",variant:"destructive"}),vs()):(Ne(De),G(Pt=>Pt&&Pt.id===W.id?{...Pt,notes_history:De}:Pt),m(Pt=>Pt.map(Wn=>Wn.id===W.id?{...Wn,notes_history:De,updated_at:new Date().toISOString()}:Wn)),qr(!0),zn(Z),ln(""),Na(!0),ct(!1))},Lg=()=>{localStorage.removeItem(Sc),qr(!1),zn(""),ln(""),Na(!0),ct(!1)},zg=async()=>{if(!ze){vs();return}const W=p.find(Z=>Z.id===ze.contactId);if(!W){vs();return}if(aa&&Da){const Z=W.notes_history||[];if(Z.length>0){const xe=[...Z],je=vt.trim()?`${Da} - ${vt.trim()}`:Da;xe[0]={...xe[0],text:je};const{error:De}=await l(W.id,{notes_history:xe});De||(m(et=>et.map(Pt=>Pt.id===W.id?{...Pt,notes_history:xe}:Pt)),Ne(xe),G(et=>et&&et.id===W.id?{...et,notes_history:xe}:et),vt.trim()&&oe({title:"Note updated"}))}}else if(!aa&&vt.trim()){const Z={text:vt.trim(),timestamp:new Date().toISOString()},xe=W.notes_history||[],je=[Z,...xe],{error:De}=await l(W.id,{notes_history:je});De||(m(et=>et.map(Pt=>Pt.id===W.id?{...Pt,notes_history:je,updated_at:new Date().toISOString()}:Pt)),oe({title:"Note added"}))}vs()},vc=()=>{vs()},Vl=W=>{var De;const Z=W.notes_history,xe=(De=Z==null?void 0:Z[0])!=null&&De.timestamp?new Date(Z[0].timestamp):null,je=new Date(W.updated_at);return xe&&xe>je?xe:je},el=p.filter(W=>{var et,Pt,Wn,Fi;const Z=W.name.toLowerCase().includes(C.toLowerCase())||((et=W.company)==null?void 0:et.toLowerCase().includes(C.toLowerCase()))||((Pt=W.email)==null?void 0:Pt.toLowerCase().includes(C.toLowerCase())),xe=$.length===0||((Wn=W.tags)==null?void 0:Wn.some(sl=>$.includes(sl.id))),je=L.length===0||((Fi=W.events)==null?void 0:Fi.some(sl=>L.includes(sl.id)));let De=!0;if(P!=="All"){const sl=parseInt(P),Bg=new Date;Bg.setDate(Bg.getDate()-sl),De=new Date(W.created_at)>=Bg}return Z&&xe&&je&&De}).sort((W,Z)=>{switch(U){case"name":return W.name.localeCompare(Z.name);case"date":return new Date(Z.created_at).getTime()-new Date(W.created_at).getTime();case"last_interaction":return Vl(Z).getTime()-Vl(W).getTime();default:return 0}}),$i=W=>{const Z=new Date(W),xe=new Date,je=Z.getDate()===xe.getDate()&&Z.getMonth()===xe.getMonth()&&Z.getFullYear()===xe.getFullYear(),De=new Date;De.setDate(xe.getDate()-1);const et=Z.getDate()===De.getDate()&&Z.getMonth()===De.getMonth()&&Z.getFullYear()===De.getFullYear(),Pt=Z.toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0});return je?`Today, ${Pt}`:et?`Yesterday, ${Pt}`:Z.getFullYear()===xe.getFullYear()?Z.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",hour12:!0}):Z.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})},kp=W=>{const Z=new Date(W),xe=new Date,je=Z.getDate()===xe.getDate()&&Z.getMonth()===xe.getMonth()&&Z.getFullYear()===xe.getFullYear(),De=new Date;De.setDate(xe.getDate()-1);const et=Z.getDate()===De.getDate()&&Z.getMonth()===De.getMonth()&&Z.getFullYear()===De.getFullYear();return je?"Today":et?"Yesterday":Z.getFullYear()===xe.getFullYear()?Z.toLocaleDateString("en-IN",{day:"2-digit",month:"short"}):Z.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})},Sp=W=>{const Z=new Date(W),xe=new Date,je=new Date(xe.getFullYear(),xe.getMonth(),xe.getDate()),De=new Date(je);De.setDate(De.getDate()-1);const et=new Date(je);et.setDate(je.getDate()-je.getDay());const Pt=new Date(et);Pt.setDate(Pt.getDate()-7);const Wn=new Date(xe.getFullYear(),xe.getMonth(),1);return Z>=je?"TODAY":Z>=De?"YESTERDAY":Z>=et?"THIS WEEK":Z>=Pt?"LAST WEEK":Z>=Wn?"THIS MONTH":"OLDER"},Cp=["TODAY","YESTERDAY","THIS WEEK","LAST WEEK","THIS MONTH","OLDER"],tl=async()=>{if(!Bn.name.trim()){oe({title:"Name is required",variant:"destructive"});return}const W=Qv({email:Bn.email,phone:Bn.phone,website:Bn.website,linkedin:Bn.linkedin});if(W){oe({title:W.message,variant:"destructive"});return}const Z=Jv({email:Bn.email,phone:Bn.phone,whatsapp:Bn.whatsapp,website:Bn.website,linkedin:Bn.linkedin}),je=v(new Date).map(et=>et.id),{error:De}=await i({...Bn,...Z,phone:Z.phone||Z.whatsapp||null,whatsapp:Z.whatsapp||Z.phone||null},je);De?oe({title:"Error creating contact",variant:"destructive"}):(qe(!1),ka({name:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:"",notes:""}),oe({title:"Contact added!"}))},_p=k.useCallback(async()=>{const{shouldUseNativeCamera:W,captureOrPickImage:Z}=await Qu(async()=>{const{shouldUseNativeCamera:xe,captureOrPickImage:je}=await import("./nativeCamera-Dnz8974A.js");return{shouldUseNativeCamera:xe,captureOrPickImage:je}},__vite__mapDeps([8,1,2,3]));if(W()){const xe=await Z();if(xe.error==="cancelled")return;if(!xe.success){oe({title:"Camera error",description:xe.error||"Could not capture image.",variant:"destructive"});return}xe.base64&&wt(`data:image/jpeg;base64,${xe.base64}`);return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){oe({title:"Camera not supported",description:"Your browser does not support camera access.",variant:"destructive"});return}const xe=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Rn.current=xe,Be(!0),await new Promise(De=>{const et=()=>{lt.current?De():requestAnimationFrame(et)};et()}),lt.current&&(lt.current.srcObject=xe,await lt.current.play())}catch(xe){console.error("Camera access error:",xe),Be(!1),xe.name==="NotAllowedError"?oe({title:"Camera access denied",description:"Please allow camera access in your browser settings.",variant:"destructive"}):xe.name==="NotFoundError"?oe({title:"No camera found",description:"Please connect a camera and try again.",variant:"destructive"}):oe({title:"Camera error",description:xe.message||"Could not access camera.",variant:"destructive"})}},[]),nl=k.useCallback(()=>{Rn.current&&(Rn.current.getTracks().forEach(W=>W.stop()),Rn.current=null),Be(!1)},[]),Ul=k.useCallback(()=>{if(lt.current&&Mn.current){const W=lt.current,Z=Mn.current;Z.width=W.videoWidth,Z.height=W.videoHeight;const xe=Z.getContext("2d");if(xe){xe.drawImage(W,0,0);const je=Z.toDataURL("image/jpeg",.8);wt(je),nl()}}},[nl]),ho=W=>{var xe;const Z=(xe=W.target.files)==null?void 0:xe[0];if(Z){const je=new FileReader;je.onload=De=>{var Pt;const et=(Pt=De.target)==null?void 0:Pt.result;wt(et),nl()},je.readAsDataURL(Z)}},Ip=async()=>{if(Ws){Bs(!0);try{const{data:W,error:Z}=await le.functions.invoke("scan-business-card",{body:{image:Ws}});if(Z)throw console.error("AI scan error:",Z),Z;if(W!=null&&W.success&&(W!=null&&W.contact)){const xe=W.contact;if(Object.entries(xe).filter(([De])=>De!=="source").some(([,De])=>De!=null&&De!=="")){gr(xe);const De=xe.source==="qr"?" (from QR)":xe.source==="mixed"?" (QR + text)":"";oe({title:"Card scanned!"+De,description:"Review the extracted information."})}else gr({name:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),oe({title:"Couldn't read this card clearly",description:"Please fill in the details manually.",variant:"destructive"})}else gr({name:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),oe({title:"Couldn't read this card",description:"Please fill in manually.",variant:"destructive"})}catch(W){console.error("Scan error:",W),gr({name:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),oe({title:"Couldn't read this card",description:"Please fill in manually.",variant:"destructive"})}finally{Bs(!1)}}},po=()=>{wt(null),gr(null),Bs(!1)},Tp=async()=>{if(!(Cn!=null&&Cn.name)){oe({title:"Name is required",variant:"destructive"});return}const W=Qv({email:Cn.email,phone:Cn.phone,website:Cn.website,linkedin:Cn.linkedin});if(W){oe({title:W.message,variant:"destructive"});return}const Z=Jv({email:Cn.email,phone:Cn.phone,whatsapp:Cn.whatsapp||Cn.phone,website:Cn.website,linkedin:Cn.linkedin}),je=v(new Date).map(et=>et.id),{error:De}=await i({name:Cn.name,company:Cn.company||null,designation:Cn.designation||null,email:Z.email||null,phone:Z.phone||null,whatsapp:Z.whatsapp||Z.phone||null,linkedin:Z.linkedin||null,website:Z.website||null,notes:Cn.notes||null},je);De?oe({title:"Error saving contact",variant:"destructive"}):(Ct(!1),po(),oe({title:"Contact saved!"}))};k.useEffect(()=>{it||(nl(),po())},[it,nl]);const Hl=async(W,Z)=>{const xe=ot.includes(Z),je=xe?ot.filter(De=>De!==Z):[...ot,Z];pe(je);try{if(xe?await c(W,Z):await d(W,Z),(M==null?void 0:M.id)===W){const De=je.map(et=>f.find(Pt=>Pt.id===et)).filter(Boolean);G(et=>({...et,tags:De}))}m(De=>De.map(et=>et.id===W?{...et,tags:je.map(Pt=>f.find(Wn=>Wn.id===Pt)).filter(Boolean)}:et))}catch{pe(ot),oe({title:"Failed to update tag",variant:"destructive"})}},Ep=async(W,Z)=>{const xe=Me.includes(Z),je=xe?Me.filter(De=>De!==Z):[...Me,Z];Je(je);try{if(xe?await le.from("contact_events").delete().eq("contact_id",W).eq("event_id",Z):await h(W,Z),(M==null?void 0:M.id)===W){const De=je.map(et=>b.find(Pt=>Pt.id===et)).filter(Boolean);G(et=>({...et,events:De}))}m(De=>De.map(et=>et.id===W?{...et,events:je.map(Pt=>b.find(Wn=>Wn.id===Pt)).filter(Boolean)}:et))}catch{Je(Me),oe({title:"Failed to update event",variant:"destructive"})}},wc=(W,Z)=>{const xe=r!=null&&r.public_slug?`${Fhe}/u/${r.public_slug}`:"",je=De=>{let et=De.replace(/{{name}}/g,Z.name||"").replace(/{{company}}/g,Z.company||"").replace(/{{designation}}/g,Z.designation||"").replace(/{{myName}}/g,(r==null?void 0:r.name)||"").replace(/{{myCompany}}/g,(r==null?void 0:r.company)||"").replace(/{{myCardLink}}/g,xe);return et=et.replace(/\n{3,}/g,`

`),et};return{body:je(W.body),subject:W.subject?je(W.subject):`Hello ${Z.name}`}},Gl=W=>{At("email"),Sn(W),Et(!0)},rl=W=>{At("whatsapp"),Sn(W),Et(!0)},mo=(W,Z)=>{if(!W.email){oe({title:"No email address",variant:"destructive"});return}const xe=Z?wc(Z,W):{body:"",subject:`Hello ${W.name}`},je=S();let De=xe.body;if(je!=null&&je.html){const et=je.html.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(div|p|td|tr|table)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/\n\s*\n/g,`

`).trim();De=`${De}

---
${et}`}ii(W,"email"),localStorage.setItem(rx,"1"),window.location.href=`mailto:${W.email}?subject=${encodeURIComponent(xe.subject)}&body=${encodeURIComponent(De)}`,Et(!1)},al=(W,Z)=>{const xe=W.replace(/\D/g,""),De=`https://api.whatsapp.com/send?phone=${xe.length===10?`91${xe}`:xe}`;return Z?`${De}&text=${encodeURIComponent(Z)}`:De},X=(W,Z)=>{const xe=W.whatsapp||W.phone;if(!xe){oe({title:"No WhatsApp number",variant:"destructive"});return}const je=Z?wc(Z,W):{body:""};ii(W,"whatsapp"),localStorage.setItem(rx,"1"),window.open(al(xe,je.body),"_blank"),Et(!1)},Ue=W=>{if(!W.phone){oe({title:"No phone number",variant:"destructive"});return}ii(W,"call"),localStorage.setItem(rx,"1"),window.location.href=`tel:${W.phone}`},mn=k.useMemo(()=>{if(U==="name")return null;const W={TODAY:[],YESTERDAY:[],"THIS WEEK":[],"LAST WEEK":[],"THIS MONTH":[],OLDER:[]};return el.forEach(Z=>{const xe=U==="last_interaction"?Vl(Z).toISOString():Z.created_at,je=Sp(xe);W[je].push(Z)}),W},[el,U]);if(n||!a&&s)return null;const Hn=W=>{Ir.light(),G(W),ve(!0),se(!1)},K=W=>{Ir.light(),ee(W),localStorage.setItem("crm_sort_by",W)};return o.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background font-inter",children:[o.jsx("div",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-xl border-b border-border/30",children:o.jsxs("div",{className:"w-full py-3 sm:py-4 px-3 sm:px-4 md:px-6 max-w-7xl mx-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("h1",{className:"text-[20px] font-semibold text-foreground tracking-tight font-inter",children:"Contacts"}),o.jsxs("div",{className:"flex gap-1.5",children:[o.jsx(fe,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-muted-foreground hover:text-foreground",onClick:()=>{Ir.light(),Ct(!0)},"aria-label":"Scan business card",children:o.jsx(NR,{className:"h-[18px] w-[18px]",strokeWidth:1.5})}),o.jsx(fe,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-primary",onClick:()=>{Ir.light(),qe(!0)},"aria-label":"Add contact",children:o.jsx(qs,{className:"h-5 w-5",strokeWidth:2})})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"relative flex-1",children:[o.jsx(dd,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/60"}),o.jsx(Ge,{placeholder:"Search",value:C,onChange:W=>_(W.target.value),className:"pl-9 pr-20 h-9 bg-secondary/50 border-0 rounded-xl text-[15px] placeholder:text-muted-foreground/50 focus-visible:ring-1 focus-visible:ring-border"})]}),o.jsxs(xw,{children:[o.jsx(yw,{asChild:!0,children:o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>Ir.light(),className:"h-9 w-9 rounded-xl text-muted-foreground hover:text-foreground",children:o.jsx(cY,{className:"h-4 w-4",strokeWidth:1.5})})}),o.jsxs(Yx,{align:"end",className:"w-48",children:[o.jsxs(Lp,{onClick:()=>K("name"),children:["Sort by Name",U==="name"&&o.jsx(an,{className:"ml-auto h-4 w-4 text-primary"})]}),o.jsxs(Lp,{onClick:()=>K("date"),children:["Date Added",U==="date"&&o.jsx(an,{className:"ml-auto h-4 w-4 text-primary"})]}),o.jsxs(Lp,{onClick:()=>K("last_interaction"),children:["Last Interaction",U==="last_interaction"&&o.jsx(an,{className:"ml-auto h-4 w-4 text-primary"})]})]})]}),o.jsxs(xw,{open:D,onOpenChange:F,children:[o.jsx(yw,{asChild:!0,children:o.jsxs("div",{className:"relative",children:[o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>Ir.light(),className:Ie("h-9 w-9 rounded-xl",$.length>0||L.length>0?"text-primary":"text-muted-foreground hover:text-foreground"),children:o.jsx(vY,{className:"h-4 w-4",strokeWidth:1.5})}),($.length>0||L.length>0)&&o.jsx("span",{className:"absolute top-2 right-2 h-1.5 w-1.5 rounded-full bg-primary"})]})}),o.jsxs(Yx,{align:"end",className:"w-56",children:[o.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[o.jsx(Uv,{className:"p-0",children:"Filters"}),($.length>0||L.length>0)&&o.jsx(fe,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive",onClick:W=>{W.preventDefault(),W.stopPropagation(),O([]),q([]),F(!1)},children:"Clear"})]}),o.jsx(Xx,{}),o.jsx(Uv,{className:"text-xs text-muted-foreground",children:"Tags"}),f==null?void 0:f.map(W=>o.jsxs(Lp,{onClick:()=>{O(Z=>Z.includes(W.id)?Z.filter(xe=>xe!==W.id):[...Z,W.id])},children:[o.jsx("span",{className:"w-2 h-2 rounded-full mr-2",style:{backgroundColor:W.color||"#888"}}),W.name,$.includes(W.id)&&o.jsx(an,{className:"ml-auto h-4 w-4 text-primary"})]},W.id)),o.jsx(Xx,{}),o.jsx(Uv,{className:"text-xs text-muted-foreground",children:"Events"}),b==null?void 0:b.map(W=>o.jsxs(Lp,{onClick:()=>{q(Z=>Z.includes(W.id)?Z.filter(xe=>xe!==W.id):[...Z,W.id])},children:[W.title,L.includes(W.id)&&o.jsx(an,{className:"ml-auto h-4 w-4 text-primary"})]},W.id))]})]})]})]})}),o.jsxs("div",{className:"w-full px-3 sm:px-4 md:px-6 pb-24 max-w-7xl mx-auto",children:[U==="name"||!mn?o.jsx("div",{className:"divide-y divide-border/30",children:el.map((W,Z)=>o.jsxs("div",{className:"group cursor-pointer transition-all duration-[120ms] active:bg-muted/40 active:scale-[0.985]",onClick:()=>Hn(W),children:[o.jsxs("div",{className:"flex items-center gap-3.5 px-4 py-3",children:[o.jsx(Qk,{name:W.name,photoUrl:W.photo_url,sharedCardId:W.shared_card_id,size:"sm"}),o.jsxs("div",{className:"flex-1 min-w-0 flex items-center",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"text-[16.5px] font-medium leading-tight text-foreground truncate font-inter",children:W.name}),(W.company||W.designation)&&o.jsx("p",{className:"text-[13px] font-normal text-muted-foreground truncate mt-0.5 leading-tight font-inter",children:W.company&&W.designation?`${W.company}  ${W.designation}`:W.company||W.designation})]}),o.jsx(vR,{className:"h-4 w-4 text-muted-foreground/40 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 ml-2"})]})]}),Z<el.length-1&&o.jsx("div",{className:"ml-[56px] border-b border-border/30"})]},W.id))}):o.jsx("div",{children:Cp.map(W=>{const Z=mn[W];return Z.length===0?null:o.jsxs("div",{children:[o.jsx("div",{className:"sticky top-[96px] z-[5] bg-background/90 backdrop-blur-sm px-4 py-1",children:o.jsx("span",{className:"text-[10.5px] font-semibold text-muted-foreground uppercase tracking-[0.12em]",children:W.replace("_"," ")})}),o.jsx("div",{className:"divide-y divide-border/30",children:Z.map((xe,je)=>o.jsxs("div",{className:"group cursor-pointer transition-all duration-[120ms] active:bg-muted/40 active:scale-[0.985]",onClick:()=>Hn(xe),children:[o.jsxs("div",{className:"flex items-center gap-3.5 px-4 py-3",children:[o.jsx(Qk,{name:xe.name,photoUrl:xe.photo_url,sharedCardId:xe.shared_card_id,size:"sm"}),o.jsxs("div",{className:"flex-1 min-w-0 flex items-center",children:[o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"text-[16.5px] font-medium leading-tight text-foreground truncate font-inter",children:xe.name}),(xe.company||xe.designation)&&o.jsx("p",{className:"text-[13px] font-normal text-muted-foreground truncate mt-0.5 leading-tight font-inter",children:xe.company&&xe.designation?`${xe.company}  ${xe.designation}`:xe.company||xe.designation})]}),o.jsx(vR,{className:"h-4 w-4 text-muted-foreground/40 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 ml-2"})]})]}),je<Z.length-1&&o.jsx("div",{className:"ml-[56px] border-b border-border/30"})]},xe.id))})]},W)})}),el.length===0&&!s&&o.jsxs("div",{className:"text-center py-16",children:[o.jsx("p",{className:"text-muted-foreground text-[15px]",children:"No contacts found"}),o.jsxs(fe,{variant:"ghost",className:"mt-3 text-primary font-medium",onClick:()=>{Ir.light(),qe(!0)},children:[o.jsx(qs,{className:"h-4 w-4 mr-1.5"})," Add your first contact"]})]})]}),o.jsx(gn,{open:$t,onOpenChange:qe,children:o.jsxs(cn,{className:"max-h-[90vh] overflow-y-auto",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Add Contact"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Name *"}),o.jsx(Ge,{value:Bn.name,onChange:W=>ka(Z=>({...Z,name:W.target.value})),placeholder:"Full name"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Organization/Brand"}),o.jsx(Ge,{value:Bn.company,onChange:W=>ka(Z=>({...Z,company:W.target.value})),placeholder:"Organization/Brand"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Role"}),o.jsx(Ge,{value:Bn.designation,onChange:W=>ka(Z=>({...Z,designation:W.target.value})),placeholder:"Role"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Email"}),o.jsx(Ge,{type:"email",value:Bn.email,onChange:W=>ka(Z=>({...Z,email:W.target.value})),placeholder:"email@example.com"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Phone"}),o.jsx(Ge,{value:Bn.phone,onChange:W=>ka(Z=>({...Z,phone:W.target.value})),placeholder:"+1 234 567 890"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"WhatsApp"}),o.jsx(Ge,{value:Bn.whatsapp,onChange:W=>ka(Z=>({...Z,whatsapp:W.target.value})),placeholder:"+1 234 567 890"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"LinkedIn"}),o.jsx(Ge,{value:Bn.linkedin,onChange:W=>ka(Z=>({...Z,linkedin:W.target.value})),placeholder:"username"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Website"}),o.jsx(Ge,{value:Bn.website,onChange:W=>ka(Z=>({...Z,website:W.target.value})),placeholder:"example.com"})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Notes"}),o.jsx(Pa,{value:Bn.notes,onChange:W=>ka(Z=>({...Z,notes:W.target.value})),placeholder:"Any notes...",rows:3})]}),o.jsx(fe,{variant:"gradient",className:"w-full",onClick:tl,children:"Save Contact"})]})]})}),o.jsx(gn,{open:it,onOpenChange:Ct,children:o.jsxs(cn,{className:"max-w-lg",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Scan Business Card"})}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("canvas",{ref:Mn,className:"hidden"}),o.jsx("input",{ref:or,type:"file",accept:"image/*",className:"hidden",onChange:ho}),!Cn&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"aspect-video bg-muted rounded-lg overflow-hidden relative",children:[de?o.jsx("video",{ref:lt,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}):Ws?o.jsx("img",{src:Ws,alt:"Captured card",className:"w-full h-full object-cover"}):o.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[o.jsx(em,{className:"h-12 w-12 text-muted-foreground mb-2"}),o.jsx("p",{className:"text-muted-foreground text-sm",children:"Capture or upload a business card"})]}),Ma&&o.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Extracting contact info..."})]})})]}),o.jsx("div",{className:"flex gap-2",children:Ws?o.jsxs(o.Fragment,{children:[o.jsxs(fe,{variant:"outline",className:"flex-1",onClick:po,children:[o.jsx(hw,{className:"h-4 w-4 mr-2"}),"Retake"]}),o.jsx(fe,{variant:"gradient",className:"flex-1",onClick:Ip,disabled:Ma,children:Ma?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Scanning..."]}):o.jsxs(o.Fragment,{children:[o.jsx(NR,{className:"h-4 w-4 mr-2"}),"Extract Info"]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs(fe,{variant:"outline",className:"flex-1",onClick:()=>{var W;return(W=or.current)==null?void 0:W.click()},children:[o.jsx(Hp,{className:"h-4 w-4 mr-2"}),"Upload"]}),de?o.jsxs(fe,{variant:"gradient",className:"flex-1",onClick:Ul,children:[o.jsx(em,{className:"h-4 w-4 mr-2"}),"Capture"]}):o.jsxs(fe,{variant:"gradient",className:"flex-1",onClick:_p,children:[o.jsx(em,{className:"h-4 w-4 mr-2"}),"Open Camera"]})]})})]}),Cn&&o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border border-border",children:[o.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Review extracted information:"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Name"}),o.jsx(Ge,{value:Cn.name||"",onChange:W=>gr(Z=>({...Z,name:W.target.value}))})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Company"}),o.jsx(Ge,{value:Cn.company||"",onChange:W=>gr(Z=>({...Z,company:W.target.value}))})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Designation"}),o.jsx(Ge,{value:Cn.designation||"",onChange:W=>gr(Z=>({...Z,designation:W.target.value}))})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Email"}),o.jsx(Ge,{value:Cn.email||"",onChange:W=>gr(Z=>({...Z,email:W.target.value}))})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Phone"}),o.jsx(Ge,{value:Cn.phone||"",onChange:W=>gr(Z=>({...Z,phone:W.target.value}))})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"Website"}),o.jsx(Ge,{value:Cn.website||"",onChange:W=>gr(Z=>({...Z,website:W.target.value}))})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx(We,{className:"text-xs",children:"LinkedIn"}),o.jsx(Ge,{value:Cn.linkedin||"",onChange:W=>gr(Z=>({...Z,linkedin:W.target.value}))})]})]})]})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(fe,{variant:"outline",className:"flex-1",onClick:po,children:[o.jsx(hw,{className:"h-4 w-4 mr-2"}),"Scan Again"]}),o.jsx(fe,{variant:"gradient",className:"flex-1",onClick:Tp,children:"Save Contact"})]})]})]})]})}),o.jsx(Che,{open:pt,onOpenChange:Ut,contactId:Ln,tags:f,events:b,localContactTags:ot,localContactEvents:Me,onTagToggle:Hl,onEventToggle:Ep,onTagCreated:async(W,Z)=>{const{data:xe,error:je}=await g(W,Z);return je||!xe?null:xe},onTagUpdated:async(W,Z)=>{await x(W,{name:Z})},onTagDeleted:async W=>{await y(W)}}),o.jsx(gn,{open:Ot,onOpenChange:Et,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:"Choose Template"})}),o.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[o.jsxs("button",{onClick:()=>{zt&&(Lt==="email"?mo(zt,null):X(zt,null))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all bg-muted/30",children:[o.jsx("p",{className:"font-medium",children:"No Template"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Send without using a template"})]}),(Lt==="email"?w():N()).map(W=>o.jsxs("button",{onClick:()=>{zt&&(Lt==="email"?mo(zt,W):X(zt,W))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all",children:[o.jsxs("div",{className:"flex items-center justify-between mb-1",children:[o.jsx("p",{className:"font-medium",children:W.name}),(Lt==="email"?W.is_selected_for_email:W.is_selected_for_whatsapp)&&o.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:"Default"})]}),Lt==="email"&&W.subject&&o.jsxs("p",{className:"text-xs text-muted-foreground mb-1",children:["Subject: ",W.subject]}),o.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:W.body})]},W.id))]})]})}),o.jsx(yI,{open:J,onOpenChange:W=>{setTimeout(()=>{var Z;ve(W),W||(se(!1),(Z=He.current)==null||Z.blur())},0)},children:o.jsxs(bI,{className:"h-[90vh] max-h-[90vh] rounded-t-3xl border-0 shadow-none pt-0 backdrop-blur-xl bg-background/90 [&>div:first-child]:hidden overflow-hidden",children:[o.jsx("div",{className:"flex justify-center mb-1 flex-shrink-0",children:o.jsx("div",{className:"h-1.5 w-12 rounded-full bg-muted-foreground/30"})}),M&&o.jsx("div",{className:"flex flex-col h-full overflow-hidden animate-in slide-in-from-bottom duration-300 ease-out",children:o.jsxs("div",{ref:Ee,className:"flex-1 overflow-y-auto overscroll-contain space-y-6 px-4 pb-6 scrollbar-hide",children:[o.jsxs(vI,{className:"text-center relative pt-0 mt-0",children:[o.jsx(Qk,{name:M.name,photoUrl:M.photo_url,sharedCardId:M.shared_card_id,size:"lg",className:"mx-auto mb-2"}),o.jsx(Wz,{className:"text-[22px] font-semibold tracking-tight mt-1",children:M.name}),(M.company||M.designation)&&o.jsx("p",{className:"text-[14px] text-muted-foreground mt-0.5",children:M.company&&M.designation?`${M.company}  ${M.designation}`:M.company||M.designation}),M.about&&o.jsx("p",{className:"text-[13px] text-muted-foreground mt-2 max-w-md mx-auto leading-relaxed",children:M.about}),o.jsx("div",{className:"absolute right-4 top-3 flex items-center gap-2",children:!Q&&o.jsx("button",{onClick:W=>{W.stopPropagation(),W.preventDefault(),setTimeout(()=>{se(!0)},0)},className:"absolute right-4 top-4 h-9 w-9 rounded-full bg-background/80 backdrop-blur border border-border/40 flex items-center justify-center active:scale-95",children:o.jsx(UN,{className:"w-5 h-5"})})})]}),Q&&M?o.jsxs("div",{className:"space-y-4 p-4 border-b border-border/50 bg-muted/30 rounded-b-lg mx-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Full name"}),o.jsx(Ge,{ref:He,value:_e.name,onChange:W=>Re("name",W.target.value),placeholder:"Full name"})]}),o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Organization/Brand"}),o.jsx(Ge,{value:_e.company,onChange:W=>Re("company",W.target.value),placeholder:"Organization/Brand"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Role"}),o.jsx(Ge,{value:_e.designation,onChange:W=>Re("designation",W.target.value),placeholder:"Role"})]}),o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Mobile"}),o.jsx(Ge,{value:_e.phone,onChange:W=>Re("phone",W.target.value),placeholder:"Mobile"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Email"}),o.jsx(Ge,{value:_e.email,onChange:W=>Re("email",W.target.value),placeholder:"Email"})]}),o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"WhatsApp"}),o.jsx(Ge,{value:_e.whatsapp,onChange:W=>Re("whatsapp",W.target.value),placeholder:"WhatsApp"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"LinkedIn"}),o.jsx(Ge,{value:_e.linkedin,onChange:W=>Re("linkedin",W.target.value),placeholder:"LinkedIn"})]}),o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Website"}),o.jsx(Ge,{value:_e.website,onChange:W=>Re("website",W.target.value),placeholder:"Website"})]})]}),o.jsxs("div",{children:[o.jsx(We,{className:"text-xs",children:"Add Note"}),o.jsx(Pa,{value:_e.notes,onChange:W=>Re("notes",W.target.value),placeholder:"Add a new note...",rows:3})]}),Se&&o.jsx("div",{className:"text-sm text-red-600",children:Se})]}):null,Q&&o.jsxs("div",{className:"border-t bg-background px-4 py-3 flex justify-between",children:[o.jsxs(fe,{variant:"destructive",onClick:()=>{jr({open:!0,title:`Delete ${M.name}`,description:"This action cannot be undone.",onConfirm:async()=>{var Z;const{error:W}=await u(M.id);W?(jr(xe=>({...xe,open:!1})),oe({title:"Failed to delete contact",variant:"destructive"})):(ve(!1),G(null),(Z=He.current)==null||Z.blur(),se(!1),jr(xe=>({...xe,open:!1})),oe({title:"Contact deleted"}))}})},disabled:Fe,children:[o.jsx(Do,{className:"w-4 h-4 mr-2"}),"Delete"]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>{var W;(W=He.current)==null||W.blur(),se(!1),M&&Le({name:M.name||"",company:M.company||"",designation:M.designation||"",phone:M.phone||"",email:M.email||"",whatsapp:M.whatsapp||"",linkedin:M.linkedin||"",website:M.website||"",notes:"",tags:ot})},className:"px-4 py-2 rounded-md border",disabled:Fe,children:"Cancel"}),o.jsxs("button",{onClick:Ke,disabled:Fe,className:"inline-flex items-center gap-2 px-5 py-2 rounded-md bg-primary text-white",children:[o.jsx(pw,{className:"w-4 h-4"}),"Save"]})]})]}),!Q&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[o.jsx("button",{onClick:()=>{var W,Z;bt(M.id),pe(((W=M.tags)==null?void 0:W.map(xe=>xe.id))||[]),Je(((Z=M.events)==null?void 0:Z.map(xe=>xe.id))||[]),Ut(!0)},className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Tag"}),o.jsx("button",{onClick:()=>Y(!0),className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Notes"})]}),(M.tags&&M.tags.length>0||M.events&&M.events.length>0)&&o.jsxs("div",{className:"flex flex-wrap justify-center gap-1.5 mt-3",children:[(ke=M.tags)==null?void 0:ke.map(W=>o.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-primary/10 text-primary",children:W.name},W.id)),(Ye=M.events)==null?void 0:Ye.map(W=>o.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-muted text-muted-foreground",children:W.title},W.id))]}),o.jsxs("div",{className:"space-y-3",children:[M.phone&&o.jsxs("button",{onClick:()=>Ue(M),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[o.jsx(Ry,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),o.jsx("span",{className:"text-foreground",children:M.phone})]}),M.email&&o.jsxs("button",{onClick:()=>Gl(M),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[o.jsx(xi,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),o.jsx("span",{className:"text-foreground",children:M.email})]}),(M.whatsapp||M.phone)&&o.jsxs("button",{onClick:()=>rl(M),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[o.jsx(pI,{className:"h-5 w-5 text-foreground/70"}),o.jsx("span",{className:"text-foreground",children:"Connect on WhatsApp"})]}),M.linkedin&&o.jsxs("a",{href:`https://linkedin.com/in/${M.linkedin}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[o.jsx(i_,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),o.jsx("span",{className:"text-foreground",children:"Connect on LinkedIn"})]}),M.website&&o.jsxs("a",{href:`https://${M.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[o.jsx(z0,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),o.jsx("span",{className:"text-foreground",children:"Visit Website"})]})]}),o.jsxs("div",{className:"text-center text-[10.5px] text-muted-foreground tracking-widest mt-4",children:[o.jsx("span",{className:"uppercase tracking-wider",children:"Contact Added"}),o.jsx("span",{children:"  "}),o.jsx("span",{children:kp(M.created_at)})]}),Ce.length>0&&o.jsxs("div",{className:"mx-2 mt-3 p-4 rounded-3xl bg-muted space-y-2",children:[o.jsx("p",{className:"text-[11px] tracking-wider text-muted-foreground mb-3",children:"NOTES"}),Ce.map((W,Z)=>o.jsxs("div",{className:"flex items-start justify-between gap-2 border-b pb-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-[15px] leading-relaxed text-foreground",children:W.text}),o.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:$i(W.timestamp)})]}),o.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[o.jsx("button",{onClick:()=>{const xe=ht(W.text);Ae({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:o.jsx(UN,{className:"w-3.5 h-3.5 text-muted-foreground"})}),o.jsx("button",{onClick:()=>{const xe=Z;jr({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const je=Ce.filter((De,et)=>et!==xe);l(M.id,{notes_history:je}),Ne(je),jr(De=>({...De,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:o.jsx(Do,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]})]})}),o.jsx(gn,{open:at,onOpenChange:Y,children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Notes"})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Pa,{value:ae,onChange:W=>we(W.target.value),placeholder:"Write a note...",className:"flex-1"}),o.jsx(fe,{variant:"gradient",onClick:Dt,children:o.jsx(pw,{className:"h-4 w-4"})})]}),o.jsxs("div",{className:"mt-4 space-y-3 max-h-[200px] overflow-y-auto",children:[Ce.length===0&&o.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No notes yet"}),Ce.map((W,Z)=>o.jsxs("div",{className:"p-3 rounded-lg bg-muted/40 border flex items-start justify-between gap-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-[15px] leading-relaxed",children:W.text}),o.jsx("p",{className:"text-[10px] text-muted-foreground",children:$i(W.timestamp)})]}),o.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[o.jsx("button",{onClick:()=>{const xe=ht(W.text);Ae({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:o.jsx(UN,{className:"w-3.5 h-3.5 text-muted-foreground"})}),o.jsx("button",{onClick:()=>{const xe=Z;jr({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const je=Ce.filter((De,et)=>et!==xe);l(M.id,{notes_history:je}),Ne(je),jr(De=>({...De,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:o.jsx(Do,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]})})]})}),o.jsx(qz,{open:lr.open,onOpenChange:W=>jr(Z=>({...Z,open:W})),title:lr.title,description:lr.description,onConfirm:lr.onConfirm}),o.jsx(gn,{open:he.open,onOpenChange:W=>Ae(Z=>({...Z,open:W})),children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{children:"Edit Note"})}),o.jsxs("div",{className:"space-y-3",children:[he.systemText&&o.jsx("div",{className:"inline-flex items-center px-3 py-1.5 bg-primary/10 text-primary rounded-full text-sm font-medium",children:he.systemText}),o.jsx(Pa,{value:he.userText,onChange:W=>Ae(Z=>({...Z,userText:W.target.value})),placeholder:he.systemText?"Add additional notes...":"Edit note...",rows:4,autoFocus:!0})]}),o.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[o.jsx(fe,{variant:"outline",onClick:()=>Ae({open:!1,index:-1,systemText:"",userText:""}),children:"Cancel"}),o.jsx(fe,{variant:"gradient",onClick:()=>{if(M){const W=[...Ce];let Z=he.systemText;he.userText.trim()&&(Z=he.systemText?`${he.systemText} - ${he.userText.trim()}`:he.userText.trim()),Z&&(W[he.index]={...W[he.index],text:Z},l(M.id,{notes_history:W}),Ne(W)),Ae({open:!1,index:-1,systemText:"",userText:""})}},children:"Save"})]})]})}),o.jsx(gn,{open:Ht,onOpenChange:W=>!W&&vs(),children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsxs(hn,{className:"text-center text-lg",children:[(ze==null?void 0:ze.interactionType)==="whatsapp"&&"WhatsApp sent to",(ze==null?void 0:ze.interactionType)==="email"&&"Email sent to",(ze==null?void 0:ze.interactionType)==="call"&&"Call made to"," ",ze==null?void 0:ze.contactName,"?"]})}),o.jsxs("div",{className:"flex justify-center gap-4 pt-4",children:[o.jsx(fe,{variant:"outline",onClick:Lg,className:"min-w-[80px]",children:"No"}),o.jsx(fe,{variant:"gradient",onClick:Og,className:"min-w-[80px]",children:"Yes"})]})]})}),o.jsx(gn,{open:fr,onOpenChange:W=>!W&&vc(),children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{children:aa?"Add Details":"Add Note (Optional)"})}),aa&&Da&&o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-md bg-primary/10 text-primary text-sm font-medium",children:Da}),o.jsx("span",{className:"text-xs text-muted-foreground",children:"(auto-logged)"})]}),o.jsx(Pa,{value:vt,onChange:W=>ln(W.target.value),placeholder:aa?"Add additional notes...":"Add a note about this interaction...",rows:4,autoFocus:!0}),o.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[o.jsx(fe,{variant:"outline",onClick:vc,children:aa?"Done":"Skip"}),o.jsx(fe,{variant:"gradient",onClick:zg,children:aa?"Save":"Save Note"})]})]})})]})}var Ohe=Object.defineProperty,Qw=Object.getOwnPropertySymbols,RB=Object.prototype.hasOwnProperty,DB=Object.prototype.propertyIsEnumerable,D$=(e,t,n)=>t in e?Ohe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,B2=(e,t)=>{for(var n in t||(t={}))RB.call(t,n)&&D$(e,n,t[n]);if(Qw)for(var n of Qw(t))DB.call(t,n)&&D$(e,n,t[n]);return e},W2=(e,t)=>{var n={};for(var r in e)RB.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Qw)for(var r of Qw(e))t.indexOf(r)<0&&DB.call(e,r)&&(n[r]=e[r]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Cd;(e=>{const t=class vn{constructor(u,d,c,h){if(this.version=u,this.errorCorrectionLevel=d,this.modules=[],this.isFunction=[],u<vn.MIN_VERSION||u>vn.MAX_VERSION)throw new RangeError("Version value out of range");if(h<-1||h>7)throw new RangeError("Mask value out of range");this.size=u*4+17;let p=[];for(let f=0;f<this.size;f++)p.push(!1);for(let f=0;f<this.size;f++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const m=this.addEccAndInterleave(c);if(this.drawCodewords(m),h==-1){let f=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const x=this.getPenaltyScore();x<f&&(h=g,f=x),this.applyMask(g)}}a(0<=h&&h<=7),this.mask=h,this.applyMask(h),this.drawFormatBits(h),this.isFunction=[]}static encodeText(u,d){const c=e.QrSegment.makeSegments(u);return vn.encodeSegments(c,d)}static encodeBinary(u,d){const c=e.QrSegment.makeBytes(u);return vn.encodeSegments([c],d)}static encodeSegments(u,d,c=1,h=40,p=-1,m=!0){if(!(vn.MIN_VERSION<=c&&c<=h&&h<=vn.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let f,g;for(f=c;;f++){const v=vn.getNumDataCodewords(f,d)*8,w=i.getTotalBits(u,f);if(w<=v){g=w;break}if(f>=h)throw new RangeError("Data too long")}for(const v of[vn.Ecc.MEDIUM,vn.Ecc.QUARTILE,vn.Ecc.HIGH])m&&g<=vn.getNumDataCodewords(f,v)*8&&(d=v);let x=[];for(const v of u){n(v.mode.modeBits,4,x),n(v.numChars,v.mode.numCharCountBits(f),x);for(const w of v.getData())x.push(w)}a(x.length==g);const y=vn.getNumDataCodewords(f,d)*8;a(x.length<=y),n(0,Math.min(4,y-x.length),x),n(0,(8-x.length%8)%8,x),a(x.length%8==0);for(let v=236;x.length<y;v^=253)n(v,8,x);let b=[];for(;b.length*8<x.length;)b.push(0);return x.forEach((v,w)=>b[w>>>3]|=v<<7-(w&7)),new vn(f,d,b,p)}getModule(u,d){return 0<=u&&u<this.size&&0<=d&&d<this.size&&this.modules[d][u]}getModules(){return this.modules}drawFunctionPatterns(){for(let c=0;c<this.size;c++)this.setFunctionModule(6,c,c%2==0),this.setFunctionModule(c,6,c%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const u=this.getAlignmentPatternPositions(),d=u.length;for(let c=0;c<d;c++)for(let h=0;h<d;h++)c==0&&h==0||c==0&&h==d-1||c==d-1&&h==0||this.drawAlignmentPattern(u[c],u[h]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(u){const d=this.errorCorrectionLevel.formatBits<<3|u;let c=d;for(let p=0;p<10;p++)c=c<<1^(c>>>9)*1335;const h=(d<<10|c)^21522;a(h>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,r(h,p));this.setFunctionModule(8,7,r(h,6)),this.setFunctionModule(8,8,r(h,7)),this.setFunctionModule(7,8,r(h,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,r(h,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,r(h,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,r(h,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let u=this.version;for(let c=0;c<12;c++)u=u<<1^(u>>>11)*7973;const d=this.version<<12|u;a(d>>>18==0);for(let c=0;c<18;c++){const h=r(d,c),p=this.size-11+c%3,m=Math.floor(c/3);this.setFunctionModule(p,m,h),this.setFunctionModule(m,p,h)}}drawFinderPattern(u,d){for(let c=-4;c<=4;c++)for(let h=-4;h<=4;h++){const p=Math.max(Math.abs(h),Math.abs(c)),m=u+h,f=d+c;0<=m&&m<this.size&&0<=f&&f<this.size&&this.setFunctionModule(m,f,p!=2&&p!=4)}}drawAlignmentPattern(u,d){for(let c=-2;c<=2;c++)for(let h=-2;h<=2;h++)this.setFunctionModule(u+h,d+c,Math.max(Math.abs(h),Math.abs(c))!=1)}setFunctionModule(u,d,c){this.modules[d][u]=c,this.isFunction[d][u]=!0}addEccAndInterleave(u){const d=this.version,c=this.errorCorrectionLevel;if(u.length!=vn.getNumDataCodewords(d,c))throw new RangeError("Invalid argument");const h=vn.NUM_ERROR_CORRECTION_BLOCKS[c.ordinal][d],p=vn.ECC_CODEWORDS_PER_BLOCK[c.ordinal][d],m=Math.floor(vn.getNumRawDataModules(d)/8),f=h-m%h,g=Math.floor(m/h);let x=[];const y=vn.reedSolomonComputeDivisor(p);for(let v=0,w=0;v<h;v++){let N=u.slice(w,w+g-p+(v<f?0:1));w+=N.length;const S=vn.reedSolomonComputeRemainder(N,y);v<f&&N.push(0),x.push(N.concat(S))}let b=[];for(let v=0;v<x[0].length;v++)x.forEach((w,N)=>{(v!=g-p||N>=f)&&b.push(w[v])});return a(b.length==m),b}drawCodewords(u){if(u.length!=Math.floor(vn.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let d=0;for(let c=this.size-1;c>=1;c-=2){c==6&&(c=5);for(let h=0;h<this.size;h++)for(let p=0;p<2;p++){const m=c-p,g=(c+1&2)==0?this.size-1-h:h;!this.isFunction[g][m]&&d<u.length*8&&(this.modules[g][m]=r(u[d>>>3],7-(d&7)),d++)}}a(d==u.length*8)}applyMask(u){if(u<0||u>7)throw new RangeError("Mask value out of range");for(let d=0;d<this.size;d++)for(let c=0;c<this.size;c++){let h;switch(u){case 0:h=(c+d)%2==0;break;case 1:h=d%2==0;break;case 2:h=c%3==0;break;case 3:h=(c+d)%3==0;break;case 4:h=(Math.floor(c/3)+Math.floor(d/2))%2==0;break;case 5:h=c*d%2+c*d%3==0;break;case 6:h=(c*d%2+c*d%3)%2==0;break;case 7:h=((c+d)%2+c*d%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[d][c]&&h&&(this.modules[d][c]=!this.modules[d][c])}}getPenaltyScore(){let u=0;for(let p=0;p<this.size;p++){let m=!1,f=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[p][x]==m?(f++,f==5?u+=vn.PENALTY_N1:f>5&&u++):(this.finderPenaltyAddHistory(f,g),m||(u+=this.finderPenaltyCountPatterns(g)*vn.PENALTY_N3),m=this.modules[p][x],f=1);u+=this.finderPenaltyTerminateAndCount(m,f,g)*vn.PENALTY_N3}for(let p=0;p<this.size;p++){let m=!1,f=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[x][p]==m?(f++,f==5?u+=vn.PENALTY_N1:f>5&&u++):(this.finderPenaltyAddHistory(f,g),m||(u+=this.finderPenaltyCountPatterns(g)*vn.PENALTY_N3),m=this.modules[x][p],f=1);u+=this.finderPenaltyTerminateAndCount(m,f,g)*vn.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let m=0;m<this.size-1;m++){const f=this.modules[p][m];f==this.modules[p][m+1]&&f==this.modules[p+1][m]&&f==this.modules[p+1][m+1]&&(u+=vn.PENALTY_N2)}let d=0;for(const p of this.modules)d=p.reduce((m,f)=>m+(f?1:0),d);const c=this.size*this.size,h=Math.ceil(Math.abs(d*20-c*10)/c)-1;return a(0<=h&&h<=9),u+=h*vn.PENALTY_N4,a(0<=u&&u<=2568888),u}getAlignmentPatternPositions(){if(this.version==1)return[];{const u=Math.floor(this.version/7)+2,d=this.version==32?26:Math.ceil((this.version*4+4)/(u*2-2))*2;let c=[6];for(let h=this.size-7;c.length<u;h-=d)c.splice(1,0,h);return c}}static getNumRawDataModules(u){if(u<vn.MIN_VERSION||u>vn.MAX_VERSION)throw new RangeError("Version number out of range");let d=(16*u+128)*u+64;if(u>=2){const c=Math.floor(u/7)+2;d-=(25*c-10)*c-55,u>=7&&(d-=36)}return a(208<=d&&d<=29648),d}static getNumDataCodewords(u,d){return Math.floor(vn.getNumRawDataModules(u)/8)-vn.ECC_CODEWORDS_PER_BLOCK[d.ordinal][u]*vn.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][u]}static reedSolomonComputeDivisor(u){if(u<1||u>255)throw new RangeError("Degree out of range");let d=[];for(let h=0;h<u-1;h++)d.push(0);d.push(1);let c=1;for(let h=0;h<u;h++){for(let p=0;p<d.length;p++)d[p]=vn.reedSolomonMultiply(d[p],c),p+1<d.length&&(d[p]^=d[p+1]);c=vn.reedSolomonMultiply(c,2)}return d}static reedSolomonComputeRemainder(u,d){let c=d.map(h=>0);for(const h of u){const p=h^c.shift();c.push(0),d.forEach((m,f)=>c[f]^=vn.reedSolomonMultiply(m,p))}return c}static reedSolomonMultiply(u,d){if(u>>>8||d>>>8)throw new RangeError("Byte out of range");let c=0;for(let h=7;h>=0;h--)c=c<<1^(c>>>7)*285,c^=(d>>>h&1)*u;return a(c>>>8==0),c}finderPenaltyCountPatterns(u){const d=u[1];a(d<=this.size*3);const c=d>0&&u[2]==d&&u[3]==d*3&&u[4]==d&&u[5]==d;return(c&&u[0]>=d*4&&u[6]>=d?1:0)+(c&&u[6]>=d*4&&u[0]>=d?1:0)}finderPenaltyTerminateAndCount(u,d,c){return u&&(this.finderPenaltyAddHistory(d,c),d=0),d+=this.size,this.finderPenaltyAddHistory(d,c),this.finderPenaltyCountPatterns(c)}finderPenaltyAddHistory(u,d){d[0]==0&&(u+=this.size),d.pop(),d.unshift(u)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=t;function n(l,u,d){if(u<0||u>31||l>>>u)throw new RangeError("Value out of range");for(let c=u-1;c>=0;c--)d.push(l>>>c&1)}function r(l,u){return(l>>>u&1)!=0}function a(l){if(!l)throw new Error("Assertion error")}const s=class Ar{constructor(u,d,c){if(this.mode=u,this.numChars=d,this.bitData=c,d<0)throw new RangeError("Invalid argument");this.bitData=c.slice()}static makeBytes(u){let d=[];for(const c of u)n(c,8,d);return new Ar(Ar.Mode.BYTE,u.length,d)}static makeNumeric(u){if(!Ar.isNumeric(u))throw new RangeError("String contains non-numeric characters");let d=[];for(let c=0;c<u.length;){const h=Math.min(u.length-c,3);n(parseInt(u.substring(c,c+h),10),h*3+1,d),c+=h}return new Ar(Ar.Mode.NUMERIC,u.length,d)}static makeAlphanumeric(u){if(!Ar.isAlphanumeric(u))throw new RangeError("String contains unencodable characters in alphanumeric mode");let d=[],c;for(c=0;c+2<=u.length;c+=2){let h=Ar.ALPHANUMERIC_CHARSET.indexOf(u.charAt(c))*45;h+=Ar.ALPHANUMERIC_CHARSET.indexOf(u.charAt(c+1)),n(h,11,d)}return c<u.length&&n(Ar.ALPHANUMERIC_CHARSET.indexOf(u.charAt(c)),6,d),new Ar(Ar.Mode.ALPHANUMERIC,u.length,d)}static makeSegments(u){return u==""?[]:Ar.isNumeric(u)?[Ar.makeNumeric(u)]:Ar.isAlphanumeric(u)?[Ar.makeAlphanumeric(u)]:[Ar.makeBytes(Ar.toUtf8ByteArray(u))]}static makeEci(u){let d=[];if(u<0)throw new RangeError("ECI assignment value out of range");if(u<128)n(u,8,d);else if(u<16384)n(2,2,d),n(u,14,d);else if(u<1e6)n(6,3,d),n(u,21,d);else throw new RangeError("ECI assignment value out of range");return new Ar(Ar.Mode.ECI,0,d)}static isNumeric(u){return Ar.NUMERIC_REGEX.test(u)}static isAlphanumeric(u){return Ar.ALPHANUMERIC_REGEX.test(u)}getData(){return this.bitData.slice()}static getTotalBits(u,d){let c=0;for(const h of u){const p=h.mode.numCharCountBits(d);if(h.numChars>=1<<p)return 1/0;c+=4+p+h.bitData.length}return c}static toUtf8ByteArray(u){u=encodeURI(u);let d=[];for(let c=0;c<u.length;c++)u.charAt(c)!="%"?d.push(u.charCodeAt(c)):(d.push(parseInt(u.substring(c+1,c+3),16)),c+=2);return d}};s.NUMERIC_REGEX=/^[0-9]*$/,s.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,s.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let i=s;e.QrSegment=s})(Cd||(Cd={}));(e=>{(t=>{const n=class{constructor(a,s){this.ordinal=a,this.formatBits=s}};n.LOW=new n(0,1),n.MEDIUM=new n(1,0),n.QUARTILE=new n(2,3),n.HIGH=new n(3,2),t.Ecc=n})(e.QrCode||(e.QrCode={}))})(Cd||(Cd={}));(e=>{(t=>{const n=class{constructor(a,s){this.modeBits=a,this.numBitsCharCount=s}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};n.NUMERIC=new n(1,[10,12,14]),n.ALPHANUMERIC=new n(2,[9,11,13]),n.BYTE=new n(4,[8,16,16]),n.KANJI=new n(8,[8,10,12]),n.ECI=new n(7,[0,0,0]),t.Mode=n})(e.QrSegment||(e.QrSegment={}))})(Cd||(Cd={}));var Qp=Cd;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Lhe={L:Qp.QrCode.Ecc.LOW,M:Qp.QrCode.Ecc.MEDIUM,Q:Qp.QrCode.Ecc.QUARTILE,H:Qp.QrCode.Ecc.HIGH},MB=128,$B="L",FB="#FFFFFF",PB="#000000",OB=!1,LB=1,zhe=4,Bhe=0,Whe=.1;function zB(e,t=0){const n=[];return e.forEach(function(r,a){let s=null;r.forEach(function(i,l){if(!i&&s!==null){n.push(`M${s+t} ${a+t}h${l-s}v1H${s+t}z`),s=null;return}if(l===r.length-1){if(!i)return;s===null?n.push(`M${l+t},${a+t} h1v1H${l+t}z`):n.push(`M${s+t},${a+t} h${l+1-s}v1H${s+t}z`);return}i&&s===null&&(s=l)})}),n.join("")}function BB(e,t){return e.slice().map((n,r)=>r<t.y||r>=t.y+t.h?n:n.map((a,s)=>s<t.x||s>=t.x+t.w?a:!1))}function Vhe(e,t,n,r){if(r==null)return null;const a=e.length+n*2,s=Math.floor(t*Whe),i=a/t,l=(r.width||s)*i,u=(r.height||s)*i,d=r.x==null?e.length/2-l/2:r.x*i,c=r.y==null?e.length/2-u/2:r.y*i,h=r.opacity==null?1:r.opacity;let p=null;if(r.excavate){let f=Math.floor(d),g=Math.floor(c),x=Math.ceil(l+d-f),y=Math.ceil(u+c-g);p={x:f,y:g,w:x,h:y}}const m=r.crossOrigin;return{x:d,y:c,h:u,w:l,excavation:p,opacity:h,crossOrigin:m}}function Uhe(e,t){return t!=null?Math.max(Math.floor(t),0):e?zhe:Bhe}function WB({value:e,level:t,minVersion:n,includeMargin:r,marginSize:a,imageSettings:s,size:i,boostLevel:l}){let u=ge.useMemo(()=>{const f=(Array.isArray(e)?e:[e]).reduce((g,x)=>(g.push(...Qp.QrSegment.makeSegments(x)),g),[]);return Qp.QrCode.encodeSegments(f,Lhe[t],n,void 0,void 0,l)},[e,t,n,l]);const{cells:d,margin:c,numCells:h,calculatedImageSettings:p}=ge.useMemo(()=>{let m=u.getModules();const f=Uhe(r,a),g=m.length+f*2,x=Vhe(m,i,f,s);return{cells:m,margin:f,numCells:g,calculatedImageSettings:x}},[u,i,s,r,a]);return{qrcode:u,margin:c,cells:d,numCells:h,calculatedImageSettings:p}}var Hhe=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),Ghe=ge.forwardRef(function(t,n){const r=t,{value:a,size:s=MB,level:i=$B,bgColor:l=FB,fgColor:u=PB,includeMargin:d=OB,minVersion:c=LB,boostLevel:h,marginSize:p,imageSettings:m}=r,g=W2(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:x}=g,y=W2(g,["style"]),b=m==null?void 0:m.src,v=ge.useRef(null),w=ge.useRef(null),N=ge.useCallback(F=>{v.current=F,typeof n=="function"?n(F):n&&(n.current=F)},[n]),[S,C]=ge.useState(!1),{margin:_,cells:T,numCells:E,calculatedImageSettings:j}=WB({value:a,level:i,minVersion:c,boostLevel:h,includeMargin:d,marginSize:p,imageSettings:m,size:s});ge.useEffect(()=>{if(v.current!=null){const F=v.current,P=F.getContext("2d");if(!P)return;let V=T;const $=w.current,O=j!=null&&$!==null&&$.complete&&$.naturalHeight!==0&&$.naturalWidth!==0;O&&j.excavation!=null&&(V=BB(T,j.excavation));const L=window.devicePixelRatio||1;F.height=F.width=s*L;const q=s/E*L;P.scale(q,q),P.fillStyle=l,P.fillRect(0,0,E,E),P.fillStyle=u,Hhe?P.fill(new Path2D(zB(V,_))):T.forEach(function(U,ee){U.forEach(function(M,G){M&&P.fillRect(G+_,ee+_,1,1)})}),j&&(P.globalAlpha=j.opacity),O&&P.drawImage($,j.x+_,j.y+_,j.w,j.h)}}),ge.useEffect(()=>{C(!1)},[b]);const I=B2({height:s,width:s},x);let D=null;return b!=null&&(D=ge.createElement("img",{src:b,key:b,style:{display:"none"},onLoad:()=>{C(!0)},ref:w,crossOrigin:j==null?void 0:j.crossOrigin})),ge.createElement(ge.Fragment,null,ge.createElement("canvas",B2({style:I,height:s,width:s,ref:N,role:"img"},y)),D)});Ghe.displayName="QRCodeCanvas";var OI=ge.forwardRef(function(t,n){const r=t,{value:a,size:s=MB,level:i=$B,bgColor:l=FB,fgColor:u=PB,includeMargin:d=OB,minVersion:c=LB,boostLevel:h,title:p,marginSize:m,imageSettings:f}=r,g=W2(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:x,cells:y,numCells:b,calculatedImageSettings:v}=WB({value:a,level:i,minVersion:c,boostLevel:h,includeMargin:d,marginSize:m,imageSettings:f,size:s});let w=y,N=null;f!=null&&v!=null&&(v.excavation!=null&&(w=BB(y,v.excavation)),N=ge.createElement("image",{href:f.src,height:v.h,width:v.w,x:v.x+x,y:v.y+x,preserveAspectRatio:"none",opacity:v.opacity,crossOrigin:v.crossOrigin}));const S=zB(w,x);return ge.createElement("svg",B2({height:s,width:s,viewBox:`0 0 ${b} ${b}`,ref:n,role:"img"},g),!!p&&ge.createElement("title",null,p),ge.createElement("path",{fill:l,d:`M0,0 h${b}v${b}H0z`,shapeRendering:"crispEdges"}),ge.createElement("path",{fill:u,d:S,shapeRendering:"crispEdges"}),N)});OI.displayName="QRCodeSVG";const yv=[{id:"photo-logo",name:"Classic Pro"},{id:"wave-split",name:"Wave Split"},{id:"minimal-circle",name:"Minimal Circle"},{id:"logo-photo",name:"Brand First"},{id:"dark-professional",name:"Dark Executive"},{id:"photo-only",name:"Portrait"},{id:"logo-only",name:"Corporate"},{id:"color",name:"Solid Color"}],Jk=[{value:"#6366f1",text:"#ffffff"},{value:"#10b981",text:"#ffffff"},{value:"#f43f5e",text:"#ffffff"},{value:"#f59e0b",text:"#1f2937"},{value:"#06b6d4",text:"#ffffff"},{value:"#8b5cf6",text:"#ffffff"},{value:"#475569",text:"#ffffff"},{value:"#1e3a5f",text:"#ffffff"}],bv=260,qhe=360,eS=20;function Khe({open:e,currentLayout:t,currentColor:n,photoUrl:r,logoUrl:a,name:s,designation:i,company:l,onClose:u,onSelect:d}){const c=k.useRef(null),[h,p]=k.useState(Math.max(0,yv.findIndex(y=>y.id===t))),[m,f]=k.useState(n||Jk[0].value),g=yv[h],x=g.id==="color";return k.useEffect(()=>{var y;(y=c.current)==null||y.scrollTo({left:h*(bv+eS),behavior:"instant"})},[e]),k.useEffect(()=>{if(e){const y=yv.findIndex(b=>b.id===t);p(y>=0?y:0),f(n||Jk[0].value)}},[e,t,n]),e?O0.createPortal(o.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-xl",onClick:u,children:o.jsxs("div",{onClick:y=>y.stopPropagation(),className:"w-full max-w-md mx-4 h-[85vh] rounded-3xl bg-white/85 dark:bg-black/85 backdrop-blur-2xl shadow-2xl overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"relative flex items-center justify-center px-5 pt-3 pb-2 shrink-0",children:[o.jsx("h2",{className:"font-semibold text-foreground",children:g.name}),o.jsx("button",{onClick:u,className:"absolute right-4 w-9 h-9 rounded-full bg-muted/40 hover:bg-muted flex items-center justify-center transition-colors",children:o.jsx(Mo,{className:"w-5 h-5"})})]}),o.jsxs("div",{className:"relative flex-1 overflow-hidden flex items-center",children:[o.jsx("button",{onClick:()=>{var y;return(y=c.current)==null?void 0:y.scrollBy({left:-280,behavior:"smooth"})},className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-background/80 hover:bg-background flex items-center justify-center shadow-lg",children:o.jsx(N3,{className:"w-5 h-5"})}),o.jsx("div",{ref:c,onScroll:()=>{var y;return p(Math.round((((y=c.current)==null?void 0:y.scrollLeft)||0)/(bv+eS)))},className:"flex gap-5 overflow-x-auto px-12 py-2 snap-x snap-mandatory scrollbar-hide h-full items-center",children:yv.map((y,b)=>o.jsx("div",{className:Ie("snap-center shrink-0 relative transition-all duration-500 rounded-3xl overflow-hidden bg-card border border-border/40",b===h?"scale-100 shadow-xl":"scale-[0.88] opacity-40"),style:{width:bv,height:qhe},children:o.jsx(mI,{layout:y.id,photoUrl:r,logoUrl:a,name:s,designation:i,company:l,themeColor:y.id==="color"?m:n,className:"w-full"})},y.id))}),o.jsx("button",{onClick:()=>{var y;return(y=c.current)==null?void 0:y.scrollBy({left:bv+eS,behavior:"smooth"})},className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-background/80 hover:bg-background flex items-center justify-center shadow-lg",children:o.jsx(Hx,{className:"w-5 h-5"})})]}),x&&o.jsx("div",{className:"flex justify-center gap-3 px-4 pt-2 pb-1 shrink-0",children:Jk.map(y=>o.jsx("button",{onClick:()=>f(y.value),className:Ie("w-8 h-8 rounded-full transition-all duration-200 border-2",m===y.value?"border-foreground scale-110 shadow-lg":"border-transparent hover:scale-105"),style:{backgroundColor:y.value},children:m===y.value&&o.jsx(an,{className:"w-4 h-4 mx-auto",style:{color:y.text}})},y.value))}),o.jsx("div",{className:"px-4 pt-2 pb-3 shrink-0",children:o.jsxs(fe,{type:"button",variant:"gradient",size:"xl",className:"w-full",onClick:y=>{y.stopPropagation(),d(g.id,x?m:n),u()},children:[o.jsx(an,{className:"w-5 h-5 mr-2"}),"Apply"]})})]})}),document.body):null}const Hy=e=>e?e.trim().replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\s+/g,"").replace(/^@/,""):"",Yhe=e=>{const t=Hy(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?instagram\.com\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://www.instagram.com/${a}`,displayValue:`@${a}`,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://www.instagram.com/${r}`,displayValue:`@${r}`,isValid:r.length>0}},Xhe=e=>{const t=Hy(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:twitter\.com|x\.com)\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://x.com/${a}`,displayValue:`@${a}`,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://x.com/${r}`,displayValue:`@${r}`,isValid:r.length>0}},Zhe=e=>{const t=Hy(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:facebook\.com|fb\.com)\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://www.facebook.com/${a}`,displayValue:a,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://www.facebook.com/${r}`,displayValue:r,isValid:r.length>0}},Qhe=e=>{const t=Hy(e);if(!t)return{url:"",displayValue:"",isValid:!0};if(t.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)/i)){let n=t;n.match(/^https?:\/\//i)||(n=`https://${n}`);const r=n.match(/@([^\/\?#]+)/),a=n.match(/\/channel\/([^\/\?#]+)/),s=r?`@${r[1]}`:a?"Channel":"YouTube";return{url:n,displayValue:s,isValid:!0}}if(t.startsWith("@")||e.trim().startsWith("@")){const n=t.replace(/^@/,"");return{url:`https://www.youtube.com/@${n}`,displayValue:`@${n}`,isValid:n.length>0}}return{url:`https://www.youtube.com/@${t}`,displayValue:`@${t}`,isValid:t.length>0}},Jhe=e=>{const t=Hy(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?calendly\.com\/([^#]+)/i);if(n)return{url:`https://calendly.com/${n[1].replace(/\/$/,"")}`,displayValue:"Book a meeting",isValid:!0};const r=t.replace(/\/$/,"");return{url:`https://calendly.com/${r}`,displayValue:"Book a meeting",isValid:r.length>0}},M$=(e,t)=>{switch(e){case"instagram":return Yhe(t);case"twitter":return Xhe(t);case"facebook":return Zhe(t);case"youtube":return Qhe(t);case"calendly":return Jhe(t);default:return{url:t,displayValue:t,isValid:!0}}},epe=e=>{switch(e){case"instagram":return"Username or full URL";case"twitter":return"Username or full URL";case"facebook":return"Page name or full URL";case"youtube":return"@handle or channel URL";case"calendly":return"Username or booking URL";default:return"Enter link"}},tpe=e=>{switch(e){case"instagram":return"Instagram";case"twitter":return"Twitter / X";case"facebook":return"Facebook";case"youtube":return"YouTube";case"calendly":return"Calendly";default:return e}},npe={instagram:()=>o.jsxs("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5"}),o.jsx("circle",{cx:"12",cy:"12",r:"4"}),o.jsx("circle",{cx:"17.5",cy:"6.5",r:"1.5",fill:"currentColor",stroke:"none"})]}),youtube:()=>o.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),twitter:()=>o.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),facebook:()=>o.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:o.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),calendly:()=>o.jsxs("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:[o.jsx("path",{d:"M19.655 14.262c-.124.209-.258.41-.402.603a6.642 6.642 0 0 1-2.126 1.876c-.259.153-.53.29-.81.41-.592.255-1.23.427-1.89.51a6.6 6.6 0 0 1-2.088-.067 6.672 6.672 0 0 1-4.808-3.803 6.636 6.636 0 0 1-.507-1.795 6.596 6.596 0 0 1 .142-2.347 6.65 6.65 0 0 1 1.338-2.645 6.674 6.674 0 0 1 2.081-1.673c.262-.135.533-.253.812-.354a6.598 6.598 0 0 1 2.976-.4c.68.07 1.335.24 1.95.5.288.122.567.262.836.42a6.664 6.664 0 0 1 2.094 1.872c.145.195.28.398.404.609l2.407-1.39a9.322 9.322 0 0 0-1.28-1.727 9.419 9.419 0 0 0-2.623-2.006 9.294 9.294 0 0 0-1.596-.695 9.353 9.353 0 0 0-5.848-.02 9.32 9.32 0 0 0-3.096 1.673 9.387 9.387 0 0 0-2.317 2.755 9.344 9.344 0 0 0-1.053 3.164 9.324 9.324 0 0 0 .088 3.293 9.342 9.342 0 0 0 1.059 2.81 9.39 9.39 0 0 0 1.885 2.297 9.41 9.41 0 0 0 2.508 1.652 9.303 9.303 0 0 0 2.9.786 9.346 9.346 0 0 0 2.948-.096 9.306 9.306 0 0 0 2.679-.923 9.388 9.388 0 0 0 2.996-2.617 9.326 9.326 0 0 0 1.29-1.993l-2.404-1.389z"}),o.jsx("path",{d:"M14.07 10.312a2.362 2.362 0 0 0-2.058-1.2 2.367 2.367 0 0 0-2.059 1.2 2.362 2.362 0 0 0 0 2.376 2.367 2.367 0 0 0 2.059 1.2 2.362 2.362 0 0 0 2.058-1.2 2.36 2.36 0 0 0 0-2.376z"})]})},rpe=["instagram","youtube","twitter","facebook","calendly"];function ape({values:e,onChange:t,disabled:n}){const[r,a]=k.useState(null),[s,i]=k.useState(""),l=c=>{r===c?(a(null),i("")):(a(c),i(e[c]||""))},u=()=>{if(!r)return;const c=M$(r,s);t(r,c.url),a(null),i("")},d=()=>{r&&(t(r,""),a(null),i(""))};return o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"flex items-center justify-between gap-2 p-2 rounded-xl bg-muted/30",children:rpe.map(c=>{const h=npe[c],p=!!e[c],m=r===c;return o.jsxs("button",{type:"button",onClick:()=>l(c),disabled:n,className:Ie("flex flex-col items-center gap-1 p-2 rounded-lg transition-all flex-1",m&&"bg-muted/50 ring-1 ring-border/50","text-muted-foreground hover:text-foreground",n&&"opacity-50 cursor-not-allowed"),children:[o.jsx(h,{}),!p&&o.jsxs("span",{className:"text-[9px] flex items-center gap-0.5 text-muted-foreground",children:[o.jsx(qs,{className:"h-2 w-2"}),"Add"]}),p&&o.jsx(an,{className:"h-3 w-3 text-green-500"})]},c)})}),r&&o.jsxs("div",{className:"space-y-2 p-3 rounded-xl bg-muted/20 border border-border/40 animate-fade-up",children:[o.jsx("label",{className:"text-sm font-medium text-foreground",children:tpe(r)}),o.jsx(Ge,{value:s,onChange:c=>i(c.target.value),placeholder:epe(r),disabled:n,className:"bg-background"}),s&&o.jsx("p",{className:"text-xs text-muted-foreground truncate",children:M$(r,s).url||"Enter a valid link"}),o.jsx("p",{className:"text-xs text-muted-foreground/70",children:"Make sure this link is correct"}),o.jsxs("div",{className:"flex gap-2 pt-1",children:[o.jsx(fe,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:n,className:"flex-1",children:"Clear"}),o.jsxs(fe,{type:"button",variant:"default",size:"sm",onClick:u,disabled:n,className:"flex-1",children:[o.jsx(an,{className:"h-4 w-4 mr-1"}),"Save"]})]})]})]})}var spe=Object.defineProperty,ipe=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),LI=(e,t)=>{for(var n in t)spe(e,n,{get:t[n],enumerable:!0})},ope={};LI(ope,{Abs:()=>ff,Acos:()=>qd,Acosh:()=>Kd,AdadeltaOptimizer:()=>sE,AdagradOptimizer:()=>iE,AdamOptimizer:()=>oE,AdamaxOptimizer:()=>lE,Add:()=>ac,AddN:()=>Yd,All:()=>gf,Any:()=>xf,ArgMax:()=>yf,ArgMin:()=>bf,Asin:()=>Xd,Asinh:()=>Zd,Atan:()=>Qd,Atan2:()=>eh,Atanh:()=>Jd,AvgPool:()=>th,AvgPool3D:()=>vf,AvgPool3DGrad:()=>Yy,AvgPoolGrad:()=>Ky,BackendWasm:()=>Z7,BatchMatMul:()=>nh,BatchToSpaceND:()=>wf,Bincount:()=>Nf,BitwiseAnd:()=>kf,BroadcastArgs:()=>Xy,BroadcastTo:()=>rW,Callback:()=>XU,CallbackList:()=>VV,Cast:()=>rh,Ceil:()=>ah,ClipByValue:()=>sc,Complex:()=>o1,ComplexAbs:()=>Zy,Concat:()=>Sf,Conv2D:()=>sh,Conv2DBackpropFilter:()=>l1,Conv2DBackpropInput:()=>ih,Conv3D:()=>oh,Conv3DBackpropFilterV2:()=>Cf,Conv3DBackpropInputV2:()=>_f,Cos:()=>lh,Cosh:()=>uh,CropAndResize:()=>Tf,Cumprod:()=>If,Cumsum:()=>ch,CustomCallback:()=>HV,DataStorage:()=>a1,DenseBincount:()=>Qy,DepthToSpace:()=>Ef,DepthwiseConv2dNative:()=>dh,DepthwiseConv2dNativeBackpropFilter:()=>u1,DepthwiseConv2dNativeBackpropInput:()=>c1,Diag:()=>Jy,Dilation2D:()=>hh,Dilation2DBackpropFilter:()=>zm,Dilation2DBackpropInput:()=>Lm,Draw:()=>d1,ENV:()=>UI,EarlyStopping:()=>ZU,Einsum:()=>h1,Elu:()=>mh,EluGrad:()=>jf,Environment:()=>tW,Equal:()=>Af,Erf:()=>fh,Exp:()=>gh,ExpandDims:()=>Rf,Expm1:()=>xh,FFT:()=>p1,Fill:()=>eb,FlipLeftRight:()=>Df,Floor:()=>yh,FloorDiv:()=>bh,FromPixels:()=>n0,FusedBatchNorm:()=>vh,FusedConv2D:()=>Id,FusedDepthwiseConv2D:()=>Td,GPGPUContext:()=>ow,GatherNd:()=>$f,GatherV2:()=>Mf,GraphModel:()=>Kj,Greater:()=>Ff,GreaterEqual:()=>wh,History:()=>UV,IFFT:()=>m1,Identity:()=>Nh,Imag:()=>f1,InputSpec:()=>Br,IsFinite:()=>kh,IsInf:()=>Sh,IsNan:()=>Ch,KernelBackend:()=>Gy,LRN:()=>Eh,LRNGrad:()=>Vf,LayerVariable:()=>$V,LayersModel:()=>wl,LeakyRelu:()=>_h,Less:()=>Pf,LessEqual:()=>Of,LinSpace:()=>Lf,Log:()=>Ih,Log1p:()=>Th,LogSoftmax:()=>sW,LogicalAnd:()=>zf,LogicalNot:()=>Bf,LogicalOr:()=>Wf,LogicalXor:()=>aW,LowerBound:()=>Qpe,MathBackendCPU:()=>Zj,MathBackendWebGL:()=>CA,MatrixBandPart:()=>Jpe,Max:()=>jh,MaxPool:()=>Rh,MaxPool3D:()=>Uf,MaxPool3DGrad:()=>nb,MaxPoolGrad:()=>tb,MaxPoolWithArgmax:()=>rb,Maximum:()=>Ah,Mean:()=>Dh,Min:()=>Mh,Minimum:()=>$h,MirrorPad:()=>Fh,Mod:()=>Ph,MomentumOptimizer:()=>uE,Multinomial:()=>Hf,Multiply:()=>Oh,Neg:()=>Gf,NonMaxSuppressionV3:()=>Kf,NonMaxSuppressionV4:()=>Yf,NonMaxSuppressionV5:()=>Xf,NotEqual:()=>qf,OP_SCOPE_SUFFIX:()=>YI,OneHot:()=>Lh,OnesLike:()=>Zf,Optimizer:()=>zl,OptimizerConstructors:()=>mV,Pack:()=>Qf,PadV2:()=>zh,Pool:()=>eme,Pow:()=>Bh,Prelu:()=>Wh,Prod:()=>Vh,RMSPropOptimizer:()=>cE,RNN:()=>Bl,RaggedGather:()=>g1,RaggedRange:()=>x1,RaggedTensorToTensor:()=>y1,Range:()=>ab,Rank:()=>H2,Real:()=>b1,RealDiv:()=>ph,Reciprocal:()=>Uh,Reduction:()=>Ha,Relu:()=>Hh,Relu6:()=>Kh,Reshape:()=>Jf,ResizeBilinear:()=>qh,ResizeBilinearGrad:()=>tg,ResizeNearestNeighbor:()=>Gh,ResizeNearestNeighborGrad:()=>eg,Reverse:()=>Yh,RotateWithOffset:()=>gg,Round:()=>Xh,Rsqrt:()=>Zh,SGDOptimizer:()=>tN,ScatterNd:()=>ng,SearchSorted:()=>ag,Select:()=>sg,Selu:()=>Qh,Sequential:()=>mN,Sigmoid:()=>np,Sign:()=>tp,Sin:()=>Jh,Sinh:()=>ep,Slice:()=>ig,Softmax:()=>ip,Softplus:()=>rp,SpaceToBatchND:()=>og,SparseFillEmptyRows:()=>sb,SparseReshape:()=>ug,SparseSegmentMean:()=>ib,SparseSegmentSum:()=>ob,SparseToDense:()=>cg,SplitV:()=>lg,Sqrt:()=>ap,Square:()=>lb,SquaredDifference:()=>op,StaticRegexReplace:()=>ub,Step:()=>oc,StridedSlice:()=>dg,StringNGrams:()=>cb,StringSplit:()=>db,StringToHashBucketFast:()=>hb,Sub:()=>lp,Sum:()=>sp,SymbolicTensor:()=>ao,Tan:()=>up,Tanh:()=>cp,Tensor:()=>Zt,TensorBuffer:()=>Wr,TensorScatterUpdate:()=>rg,Tile:()=>ic,TopK:()=>hg,Transform:()=>pg,Transpose:()=>vl,Unique:()=>pb,Unpack:()=>mg,UnsortedSegmentSum:()=>mb,UpperBound:()=>tme,Variable:()=>Ed,ZerosLike:()=>fg,_FusedMatMul:()=>_d,abs:()=>zr,acos:()=>eT,acosh:()=>tT,add:()=>$e,addN:()=>DW,all:()=>S1,any:()=>hy,argMax:()=>Dd,argMin:()=>nT,asin:()=>rT,asinh:()=>aT,atan:()=>sT,atan2:()=>iT,atanh:()=>oT,avgPool:()=>Pl,avgPool3d:()=>uT,backend:()=>XI,backend_util:()=>z,basicLSTMCell:()=>PW,batchNorm:()=>dp,batchNorm2d:()=>cT,batchNorm3d:()=>dT,batchNorm4d:()=>hT,batchToSpaceND:()=>wb,bincount:()=>pT,bitwiseAnd:()=>OW,booleanMaskAsync:()=>I6,broadcastArgs:()=>LW,broadcastTo:()=>od,broadcast_util:()=>xg,browser:()=>Mb,buffer:()=>nn,callbacks:()=>XCe,cast:()=>Xe,ceil:()=>mT,clipByValue:()=>Oa,clone:()=>Oo,complex:()=>El,concat:()=>nr,concat1d:()=>fT,concat2d:()=>gT,concat3d:()=>xT,concat4d:()=>yT,constraints:()=>LV,conv1d:()=>C1,conv2d:()=>Ya,conv2dTranspose:()=>_1,conv3d:()=>vT,conv3dTranspose:()=>wT,copyRegisteredKernels:()=>sme,cos:()=>Nb,cosh:()=>I1,cosineWindow:()=>X1,cumprod:()=>fy,cumsum:()=>T1,customGrad:()=>Ho,data:()=>w8,denseBincount:()=>s0,deprecationWarn:()=>bW,depthToSpace:()=>NT,depthwiseConv2d:()=>hp,deregisterOp:()=>JCe,device_util:()=>yb,diag:()=>BW,dilation2d:()=>kT,disableDeprecationWarnings:()=>$me,dispose:()=>qt,disposeVariables:()=>Fme,div:()=>ft,divNoNan:()=>ST,dot:()=>CT,dropout:()=>eE,einsum:()=>$c,elu:()=>yg,enableDebugMode:()=>Mme,enableProdMode:()=>Dme,enclosingPowerOfTwo:()=>tE,engine:()=>hi,ensureShape:()=>VW,env:()=>be,equal:()=>Fs,erf:()=>E1,euclideanNorm:()=>TT,exp:()=>La,expandDims:()=>ga,expm1:()=>ET,eye:()=>j1,fft:()=>Rb,fill:()=>$s,findBackend:()=>Wme,findBackendFactory:()=>Vme,floor:()=>vg,floorDiv:()=>k1,forceHalfFloat:()=>HG,fused:()=>Km,gather:()=>wg,gatherND:()=>A6,gather_util:()=>pE,getBackend:()=>vW,getGradient:()=>V2,getKernel:()=>uy,getKernelsForBackend:()=>r0,getThreadsCount:()=>r9e,gpgpu_util:()=>NG,grad:()=>wxe,grads:()=>Nxe,greater:()=>es,greaterEqual:()=>Ol,ifft:()=>qm,imag:()=>kb,image:()=>Ks,inTopKAsync:()=>R6,initializers:()=>zV,input:()=>sU,io:()=>Aa,irfft:()=>V1,isFinite:()=>jT,isInf:()=>AT,isNaN:()=>RT,keep:()=>Zr,kernel_impls:()=>Qo,layers:()=>BV,leakyRelu:()=>Sb,less:()=>Vm,lessEqual:()=>uc,linalg:()=>aE,linspace:()=>KW,loadGraphModel:()=>sIe,loadGraphModelSync:()=>iIe,loadLayersModel:()=>HSe,localResponseNormalization:()=>DT,log:()=>Ps,log1p:()=>Cb,logSigmoid:()=>MT,logSoftmax:()=>R1,logSumExp:()=>_b,logicalAnd:()=>_i,logicalNot:()=>Ib,logicalOr:()=>D1,logicalXor:()=>$T,losses:()=>U6,lowerBound:()=>XW,matMul:()=>en,math:()=>tV,max:()=>Qs,maxPool:()=>ua,maxPool3d:()=>FT,maxPoolWithArgmax:()=>ZW,maximum:()=>Zo,mean:()=>wr,memory:()=>Q2,meshgrid:()=>QW,metrics:()=>qU,min:()=>Wm,minimum:()=>Vu,mirrorPad:()=>PT,mod:()=>OT,model:()=>KSe,models:()=>KU,moments:()=>Tb,movingAverage:()=>T6,mul:()=>re,multiRNNCell:()=>JW,multinomial:()=>e6,neg:()=>pr,nextFrame:()=>mE,norm:()=>bg,notEqual:()=>Fd,oneHot:()=>Um,ones:()=>ds,onesLike:()=>Os,op:()=>ne,outerProduct:()=>t6,pad:()=>lo,pad1d:()=>n6,pad2d:()=>r6,pad3d:()=>a6,pad4d:()=>s6,pool:()=>LT,pow:()=>Uo,prelu:()=>jb,print:()=>JI,prod:()=>zT,profile:()=>Pme,raggedGather:()=>i6,raggedRange:()=>o6,raggedTensorToTensor:()=>l6,rand:()=>u6,randomGamma:()=>p6,randomNormal:()=>$1,randomStandardNormal:()=>m6,randomUniform:()=>cc,randomUniformInt:()=>f6,range:()=>Pd,ready:()=>zme,real:()=>Hm,reciprocal:()=>HT,registerBackend:()=>N1,registerCallbackConstructor:()=>XSe,registerGradient:()=>iW,registerKernel:()=>fb,registerOp:()=>QCe,regularizers:()=>YU,relu:()=>Kn,relu6:()=>F1,removeBackend:()=>Bme,reshape:()=>ue,reverse:()=>ai,reverse1d:()=>g6,reverse2d:()=>x6,reverse3d:()=>y6,reverse4d:()=>b6,rfft:()=>Db,round:()=>P1,rsqrt:()=>O1,scalar:()=>jt,scatterND:()=>E6,scatter_util:()=>G1,searchSorted:()=>M1,selu:()=>L1,separableConv2d:()=>Ng,sequential:()=>YSe,serialization:()=>Ve,setBackend:()=>Lme,setPlatform:()=>Ume,setThreadsCount:()=>n9e,setWasmPath:()=>e9e,setWasmPaths:()=>t9e,setWebGLContext:()=>GH,setdiff1dAsync:()=>v6,shared:()=>Qj,sigmoid:()=>wi,sign:()=>GT,signal:()=>V6,sin:()=>z1,sinh:()=>B1,slice:()=>pn,slice1d:()=>Ab,slice2d:()=>W1,slice3d:()=>kg,slice4d:()=>Gm,slice_util:()=>ea,softmax:()=>dc,softplus:()=>pp,spaceToBatchND:()=>Eb,sparse:()=>H6,sparseToDense:()=>j6,spectral:()=>W6,split:()=>hs,sqrt:()=>ba,square:()=>tr,squaredDifference:()=>U1,squeeze:()=>hc,stack:()=>Vr,step:()=>mp,stridedSlice:()=>qT,string:()=>G6,sub:()=>dt,sum:()=>kt,sumOutType:()=>w1,tan:()=>KT,tanh:()=>Wu,tensor:()=>Ka,tensor1d:()=>Vn,tensor2d:()=>Lo,tensor3d:()=>H1,tensor4d:()=>Uu,tensor5d:()=>w6,tensor6d:()=>N6,tensorScatterUpdate:()=>S6,tensor_util:()=>Qi,test_util:()=>c6,tidy:()=>ce,tile:()=>Rs,time:()=>Ome,topk:()=>XT,train:()=>jc,transpose:()=>tn,truncatedNormal:()=>K1,unique:()=>ZT,unregisterGradient:()=>ame,unregisterKernel:()=>rme,unsortedSegmentSum:()=>Y1,unstack:()=>Er,upcastType:()=>ni,upperBound:()=>C6,util:()=>A,valueAndGrad:()=>kxe,valueAndGrads:()=>Sxe,variable:()=>QT,variableGrads:()=>YW,version:()=>c9e,version_converter:()=>lIe,version_core:()=>Kwe,version_cpu:()=>uEe,version_layers:()=>PE,version_wasm:()=>a9e,version_webgl:()=>QFe,webgl:()=>JFe,webgl_util:()=>HH,where:()=>ya,whereAsync:()=>JT,zeros:()=>Nr,zerosLike:()=>Nn});var lpe=Object.create,zI=Object.defineProperty,upe=Object.getOwnPropertyDescriptor,cpe=Object.getOwnPropertyNames,dpe=Object.getPrototypeOf,hpe=Object.prototype.hasOwnProperty,Hr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Kt=(e,t)=>{for(var n in t)zI(e,n,{get:t[n],enumerable:!0})},ppe=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of cpe(t))!hpe.call(e,a)&&a!==n&&zI(e,a,{get:()=>t[a],enumerable:!(r=upe(t,a))||r.enumerable});return e},rc=(e,t,n)=>(n=e!=null?lpe(dpe(e)):{},ppe(!e||!e.__esModule?zI(n,"default",{value:e,enumerable:!0}):n,e)),mpe=Hr((e,t)=>{t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(I,D,F){this.low=I|0,this.high=D|0,this.unsigned=!!F}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0});function a(I){return(I&&I.__isLong__)===!0}r.isLong=a;var s={},i={};function l(I,D){var F,P,V;return D?(I>>>=0,(V=0<=I&&I<256)&&(P=i[I],P)?P:(F=d(I,(I|0)<0?-1:0,!0),V&&(i[I]=F),F)):(I|=0,(V=-128<=I&&I<128)&&(P=s[I],P)?P:(F=d(I,I<0?-1:0,!1),V&&(s[I]=F),F))}r.fromInt=l;function u(I,D){if(isNaN(I))return D?w:v;if(D){if(I<0)return w;if(I>=x)return T}else{if(I<=-y)return E;if(I+1>=y)return _}return I<0?u(-I,D).neg():d(I%g|0,I/g|0,D)}r.fromNumber=u;function d(I,D,F){return new r(I,D,F)}r.fromBits=d;var c=Math.pow;function h(I,D,F){if(I.length===0)throw Error("empty string");if(I==="NaN"||I==="Infinity"||I==="+Infinity"||I==="-Infinity")return v;if(typeof D=="number"?(F=D,D=!1):D=!!D,F=F||10,F<2||36<F)throw RangeError("radix");var P;if((P=I.indexOf("-"))>0)throw Error("interior hyphen");if(P===0)return h(I.substring(1),D,F).neg();for(var V=u(c(F,8)),$=v,O=0;O<I.length;O+=8){var L=Math.min(8,I.length-O),q=parseInt(I.substring(O,O+L),F);if(L<8){var U=u(c(F,L));$=$.mul(U).add(u(q))}else $=$.mul(V),$=$.add(u(q))}return $.unsigned=D,$}r.fromString=h;function p(I,D){return typeof I=="number"?u(I,D):typeof I=="string"?h(I,D):d(I.low,I.high,typeof D=="boolean"?D:I.unsigned)}r.fromValue=p;var m=65536,f=1<<24,g=m*m,x=g*g,y=x/2,b=l(f),v=l(0);r.ZERO=v;var w=l(0,!0);r.UZERO=w;var N=l(1);r.ONE=N;var S=l(1,!0);r.UONE=S;var C=l(-1);r.NEG_ONE=C;var _=d(-1,2147483647,!1);r.MAX_VALUE=_;var T=d(-1,-1,!0);r.MAX_UNSIGNED_VALUE=T;var E=d(0,-2147483648,!1);r.MIN_VALUE=E;var j=r.prototype;j.toInt=function(){return this.unsigned?this.low>>>0:this.low},j.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},j.toString=function(I){if(I=I||10,I<2||36<I)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(E)){var D=u(I),F=this.div(D),P=F.mul(D).sub(this);return F.toString(I)+P.toInt().toString(I)}else return"-"+this.neg().toString(I);for(var V=u(c(I,6),this.unsigned),$=this,O="";;){var L=$.div(V),q=$.sub(L.mul(V)).toInt()>>>0,U=q.toString(I);if($=L,$.isZero())return U+O;for(;U.length<6;)U="0"+U;O=""+U+O}},j.getHighBits=function(){return this.high},j.getHighBitsUnsigned=function(){return this.high>>>0},j.getLowBits=function(){return this.low},j.getLowBitsUnsigned=function(){return this.low>>>0},j.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var I=this.high!=0?this.high:this.low,D=31;D>0&&!(I&1<<D);D--);return this.high!=0?D+33:D+1},j.isZero=function(){return this.high===0&&this.low===0},j.eqz=j.isZero,j.isNegative=function(){return!this.unsigned&&this.high<0},j.isPositive=function(){return this.unsigned||this.high>=0},j.isOdd=function(){return(this.low&1)===1},j.isEven=function(){return(this.low&1)===0},j.equals=function(I){return a(I)||(I=p(I)),this.unsigned!==I.unsigned&&this.high>>>31===1&&I.high>>>31===1?!1:this.high===I.high&&this.low===I.low},j.eq=j.equals,j.notEquals=function(I){return!this.eq(I)},j.neq=j.notEquals,j.ne=j.notEquals,j.lessThan=function(I){return this.comp(I)<0},j.lt=j.lessThan,j.lessThanOrEqual=function(I){return this.comp(I)<=0},j.lte=j.lessThanOrEqual,j.le=j.lessThanOrEqual,j.greaterThan=function(I){return this.comp(I)>0},j.gt=j.greaterThan,j.greaterThanOrEqual=function(I){return this.comp(I)>=0},j.gte=j.greaterThanOrEqual,j.ge=j.greaterThanOrEqual,j.compare=function(I){if(a(I)||(I=p(I)),this.eq(I))return 0;var D=this.isNegative(),F=I.isNegative();return D&&!F?-1:!D&&F?1:this.unsigned?I.high>>>0>this.high>>>0||I.high===this.high&&I.low>>>0>this.low>>>0?-1:1:this.sub(I).isNegative()?-1:1},j.comp=j.compare,j.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(N)},j.neg=j.negate,j.add=function(I){a(I)||(I=p(I));var D=this.high>>>16,F=this.high&65535,P=this.low>>>16,V=this.low&65535,$=I.high>>>16,O=I.high&65535,L=I.low>>>16,q=I.low&65535,U=0,ee=0,M=0,G=0;return G+=V+q,M+=G>>>16,G&=65535,M+=P+L,ee+=M>>>16,M&=65535,ee+=F+O,U+=ee>>>16,ee&=65535,U+=D+$,U&=65535,d(M<<16|G,U<<16|ee,this.unsigned)},j.subtract=function(I){return a(I)||(I=p(I)),this.add(I.neg())},j.sub=j.subtract,j.multiply=function(I){if(this.isZero())return v;if(a(I)||(I=p(I)),n){var D=n.mul(this.low,this.high,I.low,I.high);return d(D,n.get_high(),this.unsigned)}if(I.isZero())return v;if(this.eq(E))return I.isOdd()?E:v;if(I.eq(E))return this.isOdd()?E:v;if(this.isNegative())return I.isNegative()?this.neg().mul(I.neg()):this.neg().mul(I).neg();if(I.isNegative())return this.mul(I.neg()).neg();if(this.lt(b)&&I.lt(b))return u(this.toNumber()*I.toNumber(),this.unsigned);var F=this.high>>>16,P=this.high&65535,V=this.low>>>16,$=this.low&65535,O=I.high>>>16,L=I.high&65535,q=I.low>>>16,U=I.low&65535,ee=0,M=0,G=0,J=0;return J+=$*U,G+=J>>>16,J&=65535,G+=V*U,M+=G>>>16,G&=65535,G+=$*q,M+=G>>>16,G&=65535,M+=P*U,ee+=M>>>16,M&=65535,M+=V*q,ee+=M>>>16,M&=65535,M+=$*L,ee+=M>>>16,M&=65535,ee+=F*U+P*q+V*L+$*O,ee&=65535,d(G<<16|J,ee<<16|M,this.unsigned)},j.mul=j.multiply,j.divide=function(I){if(a(I)||(I=p(I)),I.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&I.low===-1&&I.high===-1)return this;var D=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,I.low,I.high);return d(D,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:v;var F,P,V;if(this.unsigned){if(I.unsigned||(I=I.toUnsigned()),I.gt(this))return w;if(I.gt(this.shru(1)))return S;V=w}else{if(this.eq(E)){if(I.eq(N)||I.eq(C))return E;if(I.eq(E))return N;var $=this.shr(1);return F=$.div(I).shl(1),F.eq(v)?I.isNegative()?N:C:(P=this.sub(I.mul(F)),V=F.add(P.div(I)),V)}else if(I.eq(E))return this.unsigned?w:v;if(this.isNegative())return I.isNegative()?this.neg().div(I.neg()):this.neg().div(I).neg();if(I.isNegative())return this.div(I.neg()).neg();V=v}for(P=this;P.gte(I);){F=Math.max(1,Math.floor(P.toNumber()/I.toNumber()));for(var O=Math.ceil(Math.log(F)/Math.LN2),L=O<=48?1:c(2,O-48),q=u(F),U=q.mul(I);U.isNegative()||U.gt(P);)F-=L,q=u(F,this.unsigned),U=q.mul(I);q.isZero()&&(q=N),V=V.add(q),P=P.sub(U)}return V},j.div=j.divide,j.modulo=function(I){if(a(I)||(I=p(I)),n){var D=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,I.low,I.high);return d(D,n.get_high(),this.unsigned)}return this.sub(this.div(I).mul(I))},j.mod=j.modulo,j.rem=j.modulo,j.not=function(){return d(~this.low,~this.high,this.unsigned)},j.and=function(I){return a(I)||(I=p(I)),d(this.low&I.low,this.high&I.high,this.unsigned)},j.or=function(I){return a(I)||(I=p(I)),d(this.low|I.low,this.high|I.high,this.unsigned)},j.xor=function(I){return a(I)||(I=p(I)),d(this.low^I.low,this.high^I.high,this.unsigned)},j.shiftLeft=function(I){return a(I)&&(I=I.toInt()),(I&=63)===0?this:I<32?d(this.low<<I,this.high<<I|this.low>>>32-I,this.unsigned):d(0,this.low<<I-32,this.unsigned)},j.shl=j.shiftLeft,j.shiftRight=function(I){return a(I)&&(I=I.toInt()),(I&=63)===0?this:I<32?d(this.low>>>I|this.high<<32-I,this.high>>I,this.unsigned):d(this.high>>I-32,this.high>=0?0:-1,this.unsigned)},j.shr=j.shiftRight,j.shiftRightUnsigned=function(I){if(a(I)&&(I=I.toInt()),I&=63,I===0)return this;var D=this.high;if(I<32){var F=this.low;return d(F>>>I|D<<32-I,D>>>I,this.unsigned)}else return I===32?d(D,0,this.unsigned):d(D>>>I-32,0,this.unsigned)},j.shru=j.shiftRightUnsigned,j.shr_u=j.shiftRightUnsigned,j.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},j.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},j.toBytes=function(I){return I?this.toBytesLE():this.toBytesBE()},j.toBytesLE=function(){var I=this.high,D=this.low;return[D&255,D>>>8&255,D>>>16&255,D>>>24,I&255,I>>>8&255,I>>>16&255,I>>>24]},j.toBytesBE=function(){var I=this.high,D=this.low;return[I>>>24,I>>>16&255,I>>>8&255,I&255,D>>>24,D>>>16&255,D>>>8&255,D&255]},r.fromBytes=function(I,D,F){return F?r.fromBytesLE(I,D):r.fromBytesBE(I,D)},r.fromBytesLE=function(I,D){return new r(I[0]|I[1]<<8|I[2]<<16|I[3]<<24,I[4]|I[5]<<8|I[6]<<16|I[7]<<24,D)},r.fromBytesBE=function(I,D){return new r(I[4]<<24|I[5]<<16|I[6]<<8|I[7],I[0]<<24|I[1]<<16|I[2]<<8|I[3],D)}}),fpe=Hr(()=>{}),gpe=Hr(()=>{}),xpe=Hr((e,t)=>{(function(n,r,a){function s(d){var c=this,h=u();c.next=function(){var p=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=p-(c.c=p|0)},c.c=1,c.s0=h(" "),c.s1=h(" "),c.s2=h(" "),c.s0-=h(d),c.s0<0&&(c.s0+=1),c.s1-=h(d),c.s1<0&&(c.s1+=1),c.s2-=h(d),c.s2<0&&(c.s2+=1),h=null}function i(d,c){return c.c=d.c,c.s0=d.s0,c.s1=d.s1,c.s2=d.s2,c}function l(d,c){var h=new s(d),p=c&&c.state,m=h.next;return m.int32=function(){return h.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&i(p,h),m.state=function(){return i(h,{})}),m}function u(){var d=4022871197,c=function(h){h=String(h);for(var p=0;p<h.length;p++){d+=h.charCodeAt(p);var m=.02519603282416938*d;d=m>>>0,m-=d,m*=d,d=m>>>0,m-=d,d+=m*4294967296}return(d>>>0)*23283064365386963e-26};return c}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.alea=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),ype=Hr((e,t)=>{(function(n,r,a){function s(u){var d=this,c="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var p=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^p^p>>>8},u===(u|0)?d.x=u:c+=u;for(var h=0;h<c.length+64;h++)d.x^=c.charCodeAt(h)|0,d.next()}function i(u,d){return d.x=u.x,d.y=u.y,d.z=u.z,d.w=u.w,d}function l(u,d){var c=new s(u),h=d&&d.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xor128=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),bpe=Hr((e,t)=>{(function(n,r,a){function s(u){var d=this,c="";d.next=function(){var p=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^(p^p<<1))|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,u===(u|0)?d.x=u:c+=u;for(var h=0;h<c.length+64;h++)d.x^=c.charCodeAt(h)|0,h==c.length&&(d.d=d.x<<10^d.x>>>4),d.next()}function i(u,d){return d.x=u.x,d.y=u.y,d.z=u.z,d.w=u.w,d.v=u.v,d.d=u.d,d}function l(u,d){var c=new s(u),h=d&&d.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xorwow=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),vpe=Hr((e,t)=>{(function(n,r,a){function s(u){var d=this;d.next=function(){var h=d.x,p=d.i,m,f;return m=h[p],m^=m>>>7,f=m^m<<24,m=h[p+1&7],f^=m^m>>>10,m=h[p+3&7],f^=m^m>>>3,m=h[p+4&7],f^=m^m<<7,m=h[p+7&7],m=m^m<<13,f^=m^m<<9,h[p]=f,d.i=p+1&7,f};function c(h,p){var m,f=[];if(p===(p|0))f[0]=p;else for(p=""+p,m=0;m<p.length;++m)f[m&7]=f[m&7]<<15^p.charCodeAt(m)+f[m+1&7]<<13;for(;f.length<8;)f.push(0);for(m=0;m<8&&f[m]===0;++m);for(m==8?f[7]=-1:f[m],h.x=f,h.i=0,m=256;m>0;--m)h.next()}c(d,u)}function i(u,d){return d.x=u.x.slice(),d.i=u.i,d}function l(u,d){u==null&&(u=+new Date);var c=new s(u),h=d&&d.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=c.next,p.quick=p,h&&(h.x&&i(h,c),p.state=function(){return i(c,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xorshift7=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),wpe=Hr((e,t)=>{(function(n,r,a){function s(u){var d=this;d.next=function(){var h=d.w,p=d.X,m=d.i,f,g;return d.w=h=h+1640531527|0,g=p[m+34&127],f=p[m=m+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=p[m]=g^f,d.i=m,g+(h^h>>>16)|0};function c(h,p){var m,f,g,x,y,b=[],v=128;for(p===(p|0)?(f=p,p=null):(p=p+"\0",f=0,v=Math.max(v,p.length)),g=0,x=-32;x<v;++x)p&&(f^=p.charCodeAt((x+32)%p.length)),x===0&&(y=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,x>=0&&(y=y+1640531527|0,m=b[x&127]^=f+y,g=m==0?g+1:0);for(g>=128&&(b[(p&&p.length||0)&127]=-1),g=127,x=4*128;x>0;--x)f=b[g+34&127],m=b[g=g+1&127],f^=f<<13,m^=m<<17,f^=f>>>15,m^=m>>>12,b[g]=f^m;h.w=y,h.X=b,h.i=g}c(d,u)}function i(u,d){return d.i=u.i,d.w=u.w,d.X=u.X.slice(),d}function l(u,d){u==null&&(u=+new Date);var c=new s(u),h=d&&d.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=c.next,p.quick=p,h&&(h.X&&i(h,c),p.state=function(){return i(c,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xor4096=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Npe=Hr((e,t)=>{(function(n,r,a){function s(u){var d=this,c="";d.next=function(){var p=d.b,m=d.c,f=d.d,g=d.a;return p=p<<25^p>>>7^m,m=m-f|0,f=f<<24^f>>>8^g,g=g-p|0,d.b=p=p<<20^p>>>12^m,d.c=m=m-f|0,d.d=f<<16^m>>>16^g,d.a=g-p|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,u===Math.floor(u)?(d.a=u/4294967296|0,d.b=u|0):c+=u;for(var h=0;h<c.length+20;h++)d.b^=c.charCodeAt(h)|0,d.next()}function i(u,d){return d.a=u.a,d.b=u.b,d.c=u.c,d.d=u.d,d}function l(u,d){var c=new s(u),h=d&&d.state,p=function(){return(c.next()>>>0)/4294967296};return p.double=function(){do var m=c.next()>>>11,f=(c.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=c.next,p.quick=p,h&&(typeof h=="object"&&i(h,c),p.state=function(){return i(c,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.tychei=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),kpe=Hr(()=>{}),Spe=Hr((e,t)=>{(function(n,r,a){var s=256,i=6,l=52,u="random",d=a.pow(s,i),c=a.pow(2,l),h=c*2,p=s-1,m;function f(N,S,C){var _=[];S=S==!0?{entropy:!0}:S||{};var T=b(y(S.entropy?[N,w(r)]:N??v(),3),_),E=new g(_),j=function(){for(var I=E.g(i),D=d,F=0;I<c;)I=(I+F)*s,D*=s,F=E.g(1);for(;I>=h;)I/=2,D/=2,F>>>=1;return(I+F)/D};return j.int32=function(){return E.g(4)|0},j.quick=function(){return E.g(4)/4294967296},j.double=j,b(w(E.S),r),(S.pass||C||function(I,D,F,P){return P&&(P.S&&x(P,E),I.state=function(){return x(E,{})}),F?(a[u]=I,D):I})(j,T,"global"in S?S.global:this==a,S.state)}function g(N){var S,C=N.length,_=this,T=0,E=_.i=_.j=0,j=_.S=[];for(C||(N=[C++]);T<s;)j[T]=T++;for(T=0;T<s;T++)j[T]=j[E=p&E+N[T%C]+(S=j[T])],j[E]=S;(_.g=function(I){for(var D,F=0,P=_.i,V=_.j,$=_.S;I--;)D=$[P=p&P+1],F=F*s+$[p&($[P]=$[V=p&V+D])+($[V]=D)];return _.i=P,_.j=V,F})(s)}function x(N,S){return S.i=N.i,S.j=N.j,S.S=N.S.slice(),S}function y(N,S){var C=[],_=typeof N,T;if(S&&_=="object")for(T in N)try{C.push(y(N[T],S-1))}catch{}return C.length?C:_=="string"?N:N+"\0"}function b(N,S){for(var C=N+"",_,T=0;T<C.length;)S[p&T]=p&(_^=S[p&T]*19)+C.charCodeAt(T++);return w(S)}function v(){try{var N;return m&&(N=m.randomBytes)?N=N(s):(N=new Uint8Array(s),(n.crypto||n.msCrypto).getRandomValues(N)),w(N)}catch{var S=n.navigator,C=S&&S.plugins;return[+new Date,n,C,n.screen,w(r)]}}function w(N){return String.fromCharCode.apply(0,N)}if(b(a.random(),r),typeof t=="object"&&t.exports){t.exports=f;try{m=kpe()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):a["seed"+u]=f})(typeof self<"u"?self:e,[],Math)}),r1=Hr((e,t)=>{var n=xpe(),r=ype(),a=bpe(),s=vpe(),i=wpe(),l=Npe(),u=Spe();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=s,u.xor4096=i,u.tychei=l,t.exports=u}),VB=Hr(()=>{}),BI=Hr(()=>{}),UB=Hr(()=>{}),Cpe=Hr(()=>{}),_pe=Hr(()=>{}),Ipe=Hr(()=>{}),Tpe=Hr((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};function s(){return O.buffer!=se&&Te(O.buffer),_e}function i(){return O.buffer!=se&&Te(O.buffer),Le}function l(){return O.buffer!=se&&Te(O.buffer),Se}function u(){return O.buffer!=se&&Te(O.buffer),ye}function d(){return O.buffer!=se&&Te(O.buffer),Fe}var c=typeof a<"u"?a:{},h,p;c.ready=new Promise(function(K,ke){h=K,p=ke});var m;typeof process<"u"&&process.listeners&&(m={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var f=Object.assign({},c),g=(K,ke)=>{throw ke},x=typeof window=="object",y=typeof importScripts=="function",b=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",v=c.ENVIRONMENT_IS_PTHREAD||!1,w="";function N(K){return c.locateFile?c.locateFile(K,w):w+K}var S,C,_;function T(K){K instanceof Et||P("exiting due to exception: "+K)}if(b){var E=BI(),j=UB();y?w=j.dirname(w)+"/":w=__dirname+"/",S=(ke,Ye)=>(ke=Ct(ke)?new URL(ke):j.normalize(ke),E.readFileSync(ke,Ye?void 0:"utf8")),_=ke=>{var Ye=S(ke,!0);return Ye.buffer||(Ye=new Uint8Array(Ye)),Ye},C=(ke,Ye,W)=>{ke=Ct(ke)?new URL(ke):j.normalize(ke),E.readFile(ke,function(Z,xe){Z?W(Z):Ye(xe.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(ke){if(!(ke instanceof Et))throw ke}),process.on("unhandledRejection",function(ke){throw ke}),g=(ke,Ye)=>{if(at())throw process.exitCode=ke,Ye;T(Ye),process.exit(ke)},c.inspect=function(){return"[Emscripten Module object]"};let K;try{K=Cpe()}catch(ke){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),ke}global.Worker=K.Worker}else(x||y)&&(y?w=self.location.href:typeof document<"u"&&document.currentScript&&(w=document.currentScript.src),typeof r<"u"&&r&&(w=r),w.indexOf("blob:")!==0?w=w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):w="",b||(S=K=>{var ke=new XMLHttpRequest;return ke.open("GET",K,!1),ke.send(null),ke.responseText},y&&(_=K=>{var ke=new XMLHttpRequest;return ke.open("GET",K,!1),ke.responseType="arraybuffer",ke.send(null),new Uint8Array(ke.response)}),C=(K,ke,Ye)=>{var W=new XMLHttpRequest;W.open("GET",K,!0),W.responseType="arraybuffer",W.onload=()=>{if(W.status==200||W.status==0&&W.response){ke(W.response);return}Ye()},W.onerror=Ye,W.send(null)}));b&&typeof performance>"u"&&(global.performance=_pe().performance);var I=console.log.bind(console),D=console.warn.bind(console);b&&(I=K=>E.writeSync(1,K+`
`),D=K=>E.writeSync(2,K+`
`));var F=c.print||I,P=c.printErr||D;Object.assign(c,f),f=null,c.arguments&&c.arguments,c.thisProgram&&c.thisProgram,c.quit&&(g=c.quit);var V;c.wasmBinary&&(V=c.wasmBinary);var $=c.noExitRuntime||!0;typeof WebAssembly!="object"&&$t("no native wasm support detected");var O,L,q=!1,U;function ee(K,ke){K||$t(ke)}var M=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function G(K,ke,Ye){ke>>>=0;for(var W=ke+Ye,Z=ke;K[Z]&&!(Z>=W);)++Z;if(Z-ke>16&&K.buffer&&M)return M.decode(K.buffer instanceof SharedArrayBuffer?K.slice(ke,Z):K.subarray(ke,Z));for(var xe="";ke<Z;){var je=K[ke++];if(!(je&128)){xe+=String.fromCharCode(je);continue}var De=K[ke++]&63;if((je&224)==192){xe+=String.fromCharCode((je&31)<<6|De);continue}var et=K[ke++]&63;if((je&240)==224?je=(je&15)<<12|De<<6|et:je=(je&7)<<18|De<<12|et<<6|K[ke++]&63,je<65536)xe+=String.fromCharCode(je);else{var Pt=je-65536;xe+=String.fromCharCode(55296|Pt>>10,56320|Pt&1023)}}return xe}function J(K,ke){return K>>>=0,K?G(i(),K,ke):""}function ve(K,ke,Ye,W){if(Ye>>>=0,!(W>0))return 0;for(var Z=Ye,xe=Ye+W-1,je=0;je<K.length;++je){var De=K.charCodeAt(je);if(De>=55296&&De<=57343){var et=K.charCodeAt(++je);De=65536+((De&1023)<<10)|et&1023}if(De<=127){if(Ye>=xe)break;ke[Ye++>>>0]=De}else if(De<=2047){if(Ye+1>=xe)break;ke[Ye++>>>0]=192|De>>6,ke[Ye++>>>0]=128|De&63}else if(De<=65535){if(Ye+2>=xe)break;ke[Ye++>>>0]=224|De>>12,ke[Ye++>>>0]=128|De>>6&63,ke[Ye++>>>0]=128|De&63}else{if(Ye+3>=xe)break;ke[Ye++>>>0]=240|De>>18,ke[Ye++>>>0]=128|De>>12&63,ke[Ye++>>>0]=128|De>>6&63,ke[Ye++>>>0]=128|De&63}}return ke[Ye>>>0]=0,Ye-Z}function Q(K,ke,Ye){return ve(K,i(),ke,Ye)}var se,_e,Le,Se,ye,Fe;v&&(se=c.buffer);function Te(K){se=K,c.HEAP8=_e=new Int8Array(K),c.HEAP16=new Int16Array(K),c.HEAP32=Se=new Int32Array(K),c.HEAPU8=Le=new Uint8Array(K),c.HEAPU16=new Uint16Array(K),c.HEAPU32=ye=new Uint32Array(K),c.HEAPF32=new Float32Array(K),c.HEAPF64=Fe=new Float64Array(K)}var Oe=c.INITIAL_MEMORY||16777216;if(v)O=c.wasmMemory,se=c.buffer;else if(c.wasmMemory)O=c.wasmMemory;else if(O=new WebAssembly.Memory({initial:Oe/65536,maximum:65536,shared:!0}),!(O.buffer instanceof SharedArrayBuffer))throw P("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),b&&P("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");O&&(se=O.buffer),Oe=se.byteLength,Te(se);var He,Ee=[],Re=[],Ke=[];function at(){return $}function Y(){if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)Ce(c.preRun.shift());Ft(Ee)}function ae(){!v&&Ft(Re)}function we(){if(!v){if(c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;)he(c.postRun.shift());Ft(Ke)}}function Ce(K){Ee.unshift(K)}function Ne(K){Re.unshift(K)}function he(K){Ke.unshift(K)}var Ae=0,gt=null;function ht(K){Ae++,c.monitorRunDependencies&&c.monitorRunDependencies(Ae)}function Dt(K){if(Ae--,c.monitorRunDependencies&&c.monitorRunDependencies(Ae),Ae==0&&gt){var ke=gt;gt=null,ke()}}function $t(K){c.onAbort&&c.onAbort(K),K="Aborted("+K+")",P(K),q=!0,U=1,K+=". Build with -sASSERTIONS for more info.";var ke=new WebAssembly.RuntimeError(K);throw p(ke),ke}var qe="data:application/octet-stream;base64,";function it(K){return K.startsWith(qe)}function Ct(K){return K.startsWith("file://")}var pt;pt="tfjs-backend-wasm-threaded-simd.wasm",it(pt)||(pt=N(pt));function Ut(K){try{if(K==pt&&V)return new Uint8Array(V);if(_)return _(K);throw"both async and sync fetching of the wasm failed"}catch(ke){$t(ke)}}function Ln(){if(!V&&(x||y)){if(typeof fetch=="function"&&!Ct(pt))return fetch(pt,{credentials:"same-origin"}).then(function(K){if(!K.ok)throw"failed to load wasm binary file at '"+pt+"'";return K.arrayBuffer()}).catch(function(){return Ut(pt)});if(C)return new Promise(function(K,ke){C(pt,function(Ye){K(new Uint8Array(Ye))},ke)})}return Promise.resolve().then(function(){return Ut(pt)})}function bt(){var K={env:Ul,wasi_snapshot_preview1:Ul};function ke(je,De){var et=je.exports;if(c.asm=et,Na(c.asm._emscripten_tls_init),He=c.asm.__indirect_function_table,Ne(c.asm.__wasm_call_ctors),L=De,!v){var Pt=ze.unusedWorkers.length;ze.unusedWorkers.forEach(function(Wn){ze.loadWasmModuleToWorker(Wn,function(){--Pt||Dt()})})}}v||ht();function Ye(je){ke(je.instance,je.module)}function W(je){return Ln().then(function(De){return WebAssembly.instantiate(De,K)}).then(function(De){return De}).then(je,function(De){P("failed to asynchronously prepare wasm: "+De),$t(De)})}function Z(){return!V&&typeof WebAssembly.instantiateStreaming=="function"&&!it(pt)&&!Ct(pt)&&!b&&typeof fetch=="function"?fetch(pt,{credentials:"same-origin"}).then(function(je){var De=WebAssembly.instantiateStreaming(je,K);return De.then(Ye,function(et){return P("wasm streaming compile failed: "+et),P("falling back to ArrayBuffer instantiation"),W(Ye)})}):W(Ye)}if(c.instantiateWasm)try{var xe=c.instantiateWasm(K,ke);return xe}catch(je){P("Module.instantiateWasm callback failed with error: "+je),p(je)}return Z().catch(p),{}}var Ot={};function Et(K){this.name="ExitStatus",this.message="Program terminated with exit("+K+")",this.status=K}function Lt(K){var ke=ze.pthreads[K];delete ze.pthreads[K],ke.terminate(),Hl(K),ze.runningWorkers.splice(ze.runningWorkers.indexOf(ke),1),ke.pthread_ptr=0}function At(K){var ke=ze.pthreads[K];ke.postMessage({cmd:"cancel"})}function zt(K){var ke=ze.pthreads[K];ee(ke),ze.returnWorkerToPool(ke)}function Sn(K){var ke=ze.getNewWorker();if(!ke)return 6;ze.runningWorkers.push(ke),ze.pthreads[K.pthread_ptr]=ke,ke.pthread_ptr=K.pthread_ptr;var Ye={cmd:"run",start_routine:K.startRoutine,arg:K.arg,pthread_ptr:K.pthread_ptr};return ke.runPthread=()=>{b&&ke.ref(),ke.postMessage(Ye,K.transferList),delete ke.runPthread},ke.loaded&&ke.runPthread(),0}function ot(K){if(v)return Qn(1,1,K);U=K,at()||(ze.terminateAllThreads(),c.onExit&&c.onExit(K),q=!0),g(K,new Et(K))}function pe(K,ke){if(U=K,!ke&&v)throw ct(K),"unwind";ot(K)}var Me=pe;function Je(K){if(K instanceof Et||K=="unwind")return U;g(1,K)}var ze={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){v?ze.initWorker():ze.initMainThread()},initMainThread:function(){for(var K=8;K--;)ze.allocateUnusedWorker()},initWorker:function(){$=!1},setExitStatus:function(K){U=K},terminateAllThreads:function(){for(var K of Object.values(ze.pthreads))ze.returnWorkerToPool(K);for(var K of ze.unusedWorkers)K.terminate();ze.unusedWorkers=[]},returnWorkerToPool:function(K){var ke=K.pthread_ptr;delete ze.pthreads[ke],ze.unusedWorkers.push(K),ze.runningWorkers.splice(ze.runningWorkers.indexOf(K),1),K.pthread_ptr=0,b&&K.unref(),Hl(ke)},receiveObjectTransfer:function(K){},threadInitTLS:function(){ze.tlsInitFunctions.forEach(K=>K())},loadWasmModuleToWorker:function(K,ke){K.onmessage=xe=>{var je=xe.data,De=je.cmd;if(K.pthread_ptr&&(ze.currentProxiedOperationCallerThread=K.pthread_ptr),je.targetThread&&je.targetThread!=ho()){var et=ze.pthreads[je.targetThread];et?et.postMessage(je,je.transferList):P('Internal error! Worker sent a message "'+De+'" to target pthread '+je.targetThread+", but that thread no longer exists!"),ze.currentProxiedOperationCallerThread=void 0;return}De==="processProxyingQueue"?gr(je.queue):De==="spawnThread"?Sn(je):De==="cleanupThread"?zt(je.thread):De==="killThread"?Lt(je.thread):De==="cancelThread"?At(je.thread):De==="loaded"?(K.loaded=!0,b&&K.unref(),ke&&ke(K),K.runPthread&&K.runPthread()):De==="print"?F("Thread "+je.threadId+": "+je.text):De==="printErr"?P("Thread "+je.threadId+": "+je.text):De==="alert"?alert("Thread "+je.threadId+": "+je.text):je.target==="setimmediate"?K.postMessage(je):De==="callHandler"?c[je.handler](...je.args):De&&P("worker sent an unknown command "+De),ze.currentProxiedOperationCallerThread=void 0},K.onerror=xe=>{var je="worker sent an error!";throw P(je+" "+xe.filename+":"+xe.lineno+": "+xe.message),xe},b&&(K.on("message",function(xe){K.onmessage({data:xe})}),K.on("error",function(xe){K.onerror(xe)}),K.on("detachedExit",function(){}));var Ye=[],W=["onExit","onAbort","print","printErr"];for(var Z of W)c.hasOwnProperty(Z)&&Ye.push(Z);K.postMessage({cmd:"load",handlers:Ye,urlOrBlob:c.mainScriptUrlOrBlob||r,wasmMemory:O,wasmModule:L})},allocateUnusedWorker:function(){var K,ke=N("tfjs-backend-wasm-threaded-simd.worker.js");K=new Worker(ke),ze.unusedWorkers.push(K)},getNewWorker:function(){return ze.unusedWorkers.length==0&&(ze.allocateUnusedWorker(),ze.loadWasmModuleToWorker(ze.unusedWorkers[0])),ze.unusedWorkers.pop()}};c.PThread=ze;function Ft(K){for(;K.length>0;)K.shift()(c)}function Ht(){var K=ho(),ke=l()[K+52>>>2],Ye=l()[K+56>>>2],W=ke-Ye;wc(ke,W),rl(ke)}c.establishStackSpace=Ht;function ct(K){if(v)return Qn(2,0,K);try{Me(K)}catch(ke){Je(ke)}}var vt=[];function ln(K){var ke=vt[K];return ke||(K>=vt.length&&(vt.length=K+1),vt[K]=ke=He.get(K)),ke}function fr(K,ke){var Ye=ln(K)(ke);at()?ze.setExitStatus(Ye):Ep(Ye)}c.invokeEntryPoint=fr;function Na(K){ze.tlsInitFunctions.push(K)}function aa(K){Ip(K,!y,1,!x),ze.threadInitTLS()}function qr(K){v?postMessage({cmd:"cleanupThread",thread:K}):zt(K)}function Da(K,ke,Ye,W){return v?Qn(3,1,K,ke,Ye,W):zn(K,ke,Ye,W)}function zn(K,ke,Ye,W){if(typeof SharedArrayBuffer>"u")return P("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var Z=[],xe=0;if(v&&(Z.length===0||xe))return Da(K,ke,Ye,W);var je={startRoutine:Ye,pthread_ptr:K,arg:W,transferList:Z};return v?(je.cmd="spawnThread",postMessage(je,Z),0):Sn(je)}function Ma(){return 65536}var Bs=!0;function Cn(){return Bs}function gr(K){Atomics.store(l(),K>>2,1),ho()&&Tp(K),Atomics.compareExchange(l(),K>>2,1,0)}c.executeNotifiedProxyingQueue=gr;function Ws(K,ke,Ye,W){if(K==ke)setTimeout(()=>gr(W));else if(v)postMessage({targetThread:K,cmd:"processProxyingQueue",queue:W});else{var Z=ze.pthreads[K];if(!Z)return;Z.postMessage({cmd:"processProxyingQueue",queue:W})}return 1}function wt(K,ke,Ye){return-1}function de(){$t("")}function Be(K){Be.shown||(Be.shown={}),Be.shown[K]||(Be.shown[K]=1,b&&(K="warning: "+K),P(K))}function lt(){b||y||Be("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")}function Mn(){return Date.now()}function or(){return 4294901760}function Rn(){return or()}var lr;b?lr=()=>{var K=process.hrtime();return K[0]*1e3+K[1]/1e6}:lr=()=>performance.timeOrigin+performance.now();function jr(K,ke,Ye){i().copyWithin(K>>>0,ke>>>0,ke+Ye>>>0)}function Bn(){return b?Ipe().cpus().length:navigator.hardwareConcurrency}function ka(K){var ke=Gl(),Ye=K();return rl(ke),Ye}function Qn(K,ke){var Ye=arguments.length-2,W=arguments;return ka(()=>{for(var Z=Ye,xe=mo(Z*8),je=xe>>3,De=0;De<Ye;De++){var et=W[2+De];d()[je+De>>>0]=et}return po(K,Z,xe,ke)})}var ii=[];function vs(K,ke,Ye){ii.length=ke;for(var W=Ye>>3,Z=0;Z<ke;Z++)ii[Z]=d()[W+Z>>>0];var xe=K<0,je=xe?Ot[-K-1]:nl[K];return je.apply(null,ii)}function Og(K){try{return O.grow(K-se.byteLength+65535>>>16),Te(O.buffer),1}catch{}}function Lg(K){var ke=i().length;if(K=K>>>0,K<=ke)return!1;var Ye=or();if(K>Ye)return!1;let W=(et,Pt)=>et+(Pt-et%Pt)%Pt;for(var Z=1;Z<=4;Z*=2){var xe=ke*(1+.2/Z);xe=Math.min(xe,K+100663296);var je=Math.min(Ye,W(Math.max(K,xe),65536)),De=Og(je);if(De)return!0}return!1}function zg(){throw"unwind"}function vc(K){return v?Qn(4,1,K):52}function Vl(K,ke,Ye,W,Z){return v?Qn(5,1,K,ke,Ye,W,Z):70}var el=[null,[],[]];function $i(K,ke){var Ye=el[K];ke===0||ke===10?((K===1?F:P)(G(Ye,0)),Ye.length=0):Ye.push(ke)}function kp(K,ke,Ye,W){if(v)return Qn(6,1,K,ke,Ye,W);for(var Z=0,xe=0;xe<Ye;xe++){var je=u()[ke>>>2],De=u()[ke+4>>>2];ke+=8;for(var et=0;et<De;et++)$i(K,i()[je+et>>>0]);Z+=De}return u()[W>>>2]=Z,0}function Sp(K){var ke=c["_"+K];return ke}function Cp(K,ke){s().set(K,ke>>>0)}function tl(K,ke,Ye,W,Z){var xe={string:Vs=>{var jp=0;if(Vs!=null&&Vs!==0){var mR=(Vs.length<<2)+1;jp=mo(mR),Q(Vs,jp,mR)}return jp},array:Vs=>{var jp=mo(Vs.length);return Cp(Vs,jp),jp}};function je(Vs){return ke==="string"?J(Vs):ke==="boolean"?!!Vs:Vs}var De=Sp(K),et=[],Pt=0;if(W)for(var Wn=0;Wn<W.length;Wn++){var Fi=xe[Ye[Wn]];Fi?(Pt===0&&(Pt=Gl()),et[Wn]=Fi(W[Wn])):et[Wn]=W[Wn]}var sl=De.apply(null,et);function Bg(Vs){return Pt!==0&&rl(Pt),je(Vs)}return sl=Bg(sl),sl}function _p(K,ke,Ye,W){Ye=Ye||[];var Z=Ye.every(je=>je==="number"||je==="boolean"),xe=ke!=="string";return xe&&Z&&!W?Sp(K):function(){return tl(K,ke,Ye,arguments)}}ze.init();var nl=[null,ot,ct,Da,vc,Vl,kp],Ul={__emscripten_init_main_thread_js:aa,__emscripten_thread_cleanup:qr,__pthread_create_js:zn,_emscripten_default_pthread_stack_size:Ma,_emscripten_get_now_is_monotonic:Cn,_emscripten_notify_task_queue:Ws,_emscripten_set_offscreencanvas_size:wt,abort:de,emscripten_check_blocking_allowed:lt,emscripten_date_now:Mn,emscripten_get_heap_max:Rn,emscripten_get_now:lr,emscripten_memcpy_big:jr,emscripten_num_logical_cores:Bn,emscripten_receive_on_main_thread_js:vs,emscripten_resize_heap:Lg,emscripten_unwind_to_js_event_loop:zg,exit:Me,fd_close:vc,fd_seek:Vl,fd_write:kp,memory:O||c.wasmMemory};bt(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.__wasm_call_ctors).apply(null,arguments)},c._init=function(){return(c._init=c.asm.init).apply(null,arguments)},c._init_with_threads_count=function(){return(c._init_with_threads_count=c.asm.init_with_threads_count).apply(null,arguments)},c._get_threads_count=function(){return(c._get_threads_count=c.asm.get_threads_count).apply(null,arguments)},c._register_tensor=function(){return(c._register_tensor=c.asm.register_tensor).apply(null,arguments)},c._dispose_data=function(){return(c._dispose_data=c.asm.dispose_data).apply(null,arguments)},c._dispose=function(){return(c._dispose=c.asm.dispose).apply(null,arguments)},c._Abs=function(){return(c._Abs=c.asm.Abs).apply(null,arguments)},c._Acos=function(){return(c._Acos=c.asm.Acos).apply(null,arguments)},c._Acosh=function(){return(c._Acosh=c.asm.Acosh).apply(null,arguments)},c._Add=function(){return(c._Add=c.asm.Add).apply(null,arguments)},c._AddN=function(){return(c._AddN=c.asm.AddN).apply(null,arguments)},c._All=function(){return(c._All=c.asm.All).apply(null,arguments)},c._Any=function(){return(c._Any=c.asm.Any).apply(null,arguments)},c._ArgMax=function(){return(c._ArgMax=c.asm.ArgMax).apply(null,arguments)},c._ArgMin=function(){return(c._ArgMin=c.asm.ArgMin).apply(null,arguments)},c._Asin=function(){return(c._Asin=c.asm.Asin).apply(null,arguments)},c._Asinh=function(){return(c._Asinh=c.asm.Asinh).apply(null,arguments)},c._Atan=function(){return(c._Atan=c.asm.Atan).apply(null,arguments)},c._Atan2=function(){return(c._Atan2=c.asm.Atan2).apply(null,arguments)},c._Atanh=function(){return(c._Atanh=c.asm.Atanh).apply(null,arguments)},c._AvgPool=function(){return(c._AvgPool=c.asm.AvgPool).apply(null,arguments)},c._AvgPool3D=function(){return(c._AvgPool3D=c.asm.AvgPool3D).apply(null,arguments)},c._AvgPool3DGrad=function(){return(c._AvgPool3DGrad=c.asm.AvgPool3DGrad).apply(null,arguments)},c._AvgPoolGrad=function(){return(c._AvgPoolGrad=c.asm.AvgPoolGrad).apply(null,arguments)},c._BatchMatMul=function(){return(c._BatchMatMul=c.asm.BatchMatMul).apply(null,arguments)},c._Bincount=function(){return(c._Bincount=c.asm.Bincount).apply(null,arguments)},c._BitwiseAnd=function(){return(c._BitwiseAnd=c.asm.BitwiseAnd).apply(null,arguments)},c._Ceil=function(){return(c._Ceil=c.asm.Ceil).apply(null,arguments)},c._ClipByValue=function(){return(c._ClipByValue=c.asm.ClipByValue).apply(null,arguments)},c._Conv2D=function(){return(c._Conv2D=c.asm.Conv2D).apply(null,arguments)},c._Conv2DBackpropInput=function(){return(c._Conv2DBackpropInput=c.asm.Conv2DBackpropInput).apply(null,arguments)},c._Conv3D=function(){return(c._Conv3D=c.asm.Conv3D).apply(null,arguments)},c._Conv3DBackpropFilterV2=function(){return(c._Conv3DBackpropFilterV2=c.asm.Conv3DBackpropFilterV2).apply(null,arguments)},c._Conv3DBackpropInputV2=function(){return(c._Conv3DBackpropInputV2=c.asm.Conv3DBackpropInputV2).apply(null,arguments)},c._Cos=function(){return(c._Cos=c.asm.Cos).apply(null,arguments)},c._Cosh=function(){return(c._Cosh=c.asm.Cosh).apply(null,arguments)},c._CropAndResize=function(){return(c._CropAndResize=c.asm.CropAndResize).apply(null,arguments)},c._Cumprod=function(){return(c._Cumprod=c.asm.Cumprod).apply(null,arguments)},c._Cumsum=function(){return(c._Cumsum=c.asm.Cumsum).apply(null,arguments)},c._DenseBincount=function(){return(c._DenseBincount=c.asm.DenseBincount).apply(null,arguments)},c._DepthToSpace=function(){return(c._DepthToSpace=c.asm.DepthToSpace).apply(null,arguments)},c._DepthwiseConv2dNative=function(){return(c._DepthwiseConv2dNative=c.asm.DepthwiseConv2dNative).apply(null,arguments)},c._Diag=function(){return(c._Diag=c.asm.Diag).apply(null,arguments)},c._Dilation2D=function(){return(c._Dilation2D=c.asm.Dilation2D).apply(null,arguments)},c._Dilation2DBackpropFilter=function(){return(c._Dilation2DBackpropFilter=c.asm.Dilation2DBackpropFilter).apply(null,arguments)},c._Dilation2DBackpropInput=function(){return(c._Dilation2DBackpropInput=c.asm.Dilation2DBackpropInput).apply(null,arguments)},c._Elu=function(){return(c._Elu=c.asm.Elu).apply(null,arguments)},c._EluGrad=function(){return(c._EluGrad=c.asm.EluGrad).apply(null,arguments)},c._Equal=function(){return(c._Equal=c.asm.Equal).apply(null,arguments)},c._Erf=function(){return(c._Erf=c.asm.Erf).apply(null,arguments)},c._Exp=function(){return(c._Exp=c.asm.Exp).apply(null,arguments)},c._Expm1=function(){return(c._Expm1=c.asm.Expm1).apply(null,arguments)},c._FlipLeftRight=function(){return(c._FlipLeftRight=c.asm.FlipLeftRight).apply(null,arguments)},c._Floor=function(){return(c._Floor=c.asm.Floor).apply(null,arguments)},c._FloorDiv=function(){return(c._FloorDiv=c.asm.FloorDiv).apply(null,arguments)},c._FusedBatchNorm=function(){return(c._FusedBatchNorm=c.asm.FusedBatchNorm).apply(null,arguments)},c._FusedConv2D=function(){return(c._FusedConv2D=c.asm.FusedConv2D).apply(null,arguments)},c._FusedDepthwiseConv2D=function(){return(c._FusedDepthwiseConv2D=c.asm.FusedDepthwiseConv2D).apply(null,arguments)},c._Gather=function(){return(c._Gather=c.asm.Gather).apply(null,arguments)},c._GatherNd=function(){return(c._GatherNd=c.asm.GatherNd).apply(null,arguments)},c._Greater=function(){return(c._Greater=c.asm.Greater).apply(null,arguments)},c._GreaterEqual=function(){return(c._GreaterEqual=c.asm.GreaterEqual).apply(null,arguments)},c._IsFinite=function(){return(c._IsFinite=c.asm.IsFinite).apply(null,arguments)},c._IsInf=function(){return(c._IsInf=c.asm.IsInf).apply(null,arguments)},c._IsNan=function(){return(c._IsNan=c.asm.IsNan).apply(null,arguments)},c._LRN=function(){return(c._LRN=c.asm.LRN).apply(null,arguments)},c._LRNGrad=function(){return(c._LRNGrad=c.asm.LRNGrad).apply(null,arguments)},c._LeakyRelu=function(){return(c._LeakyRelu=c.asm.LeakyRelu).apply(null,arguments)},c._Less=function(){return(c._Less=c.asm.Less).apply(null,arguments)},c._LessEqual=function(){return(c._LessEqual=c.asm.LessEqual).apply(null,arguments)},c._LinSpace=function(){return(c._LinSpace=c.asm.LinSpace).apply(null,arguments)},c._Log=function(){return(c._Log=c.asm.Log).apply(null,arguments)},c._Log1p=function(){return(c._Log1p=c.asm.Log1p).apply(null,arguments)},c._LogicalAnd=function(){return(c._LogicalAnd=c.asm.LogicalAnd).apply(null,arguments)},c._LogicalNot=function(){return(c._LogicalNot=c.asm.LogicalNot).apply(null,arguments)},c._LogicalOr=function(){return(c._LogicalOr=c.asm.LogicalOr).apply(null,arguments)},c._LogicalXor=function(){return(c._LogicalXor=c.asm.LogicalXor).apply(null,arguments)},c._Max=function(){return(c._Max=c.asm.Max).apply(null,arguments)},c._MaxPool=function(){return(c._MaxPool=c.asm.MaxPool).apply(null,arguments)},c._MaxPool3D=function(){return(c._MaxPool3D=c.asm.MaxPool3D).apply(null,arguments)},c._MaxPool3DGrad=function(){return(c._MaxPool3DGrad=c.asm.MaxPool3DGrad).apply(null,arguments)},c._MaxPoolGrad=function(){return(c._MaxPoolGrad=c.asm.MaxPoolGrad).apply(null,arguments)},c._MaxPoolWithArgmax=function(){return(c._MaxPoolWithArgmax=c.asm.MaxPoolWithArgmax).apply(null,arguments)},c._Maximum=function(){return(c._Maximum=c.asm.Maximum).apply(null,arguments)},c._Mean=function(){return(c._Mean=c.asm.Mean).apply(null,arguments)},c._Min=function(){return(c._Min=c.asm.Min).apply(null,arguments)},c._Minimum=function(){return(c._Minimum=c.asm.Minimum).apply(null,arguments)},c._MirrorPad=function(){return(c._MirrorPad=c.asm.MirrorPad).apply(null,arguments)},c._Mod=function(){return(c._Mod=c.asm.Mod).apply(null,arguments)},c._Multinomial=function(){return(c._Multinomial=c.asm.Multinomial).apply(null,arguments)},c._Multiply=function(){return(c._Multiply=c.asm.Multiply).apply(null,arguments)},c._Neg=function(){return(c._Neg=c.asm.Neg).apply(null,arguments)},c._NonMaxSuppressionV3=function(){return(c._NonMaxSuppressionV3=c.asm.NonMaxSuppressionV3).apply(null,arguments)},c._NonMaxSuppressionV4=function(){return(c._NonMaxSuppressionV4=c.asm.NonMaxSuppressionV4).apply(null,arguments)},c._NonMaxSuppressionV5=function(){return(c._NonMaxSuppressionV5=c.asm.NonMaxSuppressionV5).apply(null,arguments)},c._NotEqual=function(){return(c._NotEqual=c.asm.NotEqual).apply(null,arguments)},c._OneHot=function(){return(c._OneHot=c.asm.OneHot).apply(null,arguments)},c._PadV2=function(){return(c._PadV2=c.asm.PadV2).apply(null,arguments)},c._Pow=function(){return(c._Pow=c.asm.Pow).apply(null,arguments)},c._Prelu=function(){return(c._Prelu=c.asm.Prelu).apply(null,arguments)},c._Prod=function(){return(c._Prod=c.asm.Prod).apply(null,arguments)},c._RealDiv=function(){return(c._RealDiv=c.asm.RealDiv).apply(null,arguments)},c._Reciprocal=function(){return(c._Reciprocal=c.asm.Reciprocal).apply(null,arguments)},c._Relu=function(){return(c._Relu=c.asm.Relu).apply(null,arguments)},c._Relu6=function(){return(c._Relu6=c.asm.Relu6).apply(null,arguments)},c._ResizeBilinear=function(){return(c._ResizeBilinear=c.asm.ResizeBilinear).apply(null,arguments)},c._ResizeBilinearGrad=function(){return(c._ResizeBilinearGrad=c.asm.ResizeBilinearGrad).apply(null,arguments)},c._ResizeNearestNeighbor=function(){return(c._ResizeNearestNeighbor=c.asm.ResizeNearestNeighbor).apply(null,arguments)},c._ResizeNearestNeighborGrad=function(){return(c._ResizeNearestNeighborGrad=c.asm.ResizeNearestNeighborGrad).apply(null,arguments)},c._Reverse=function(){return(c._Reverse=c.asm.Reverse).apply(null,arguments)},c._RotateWithOffset=function(){return(c._RotateWithOffset=c.asm.RotateWithOffset).apply(null,arguments)},c._Round=function(){return(c._Round=c.asm.Round).apply(null,arguments)},c._Rsqrt=function(){return(c._Rsqrt=c.asm.Rsqrt).apply(null,arguments)},c._ScatterNd=function(){return(c._ScatterNd=c.asm.ScatterNd).apply(null,arguments)},c._SearchSorted=function(){return(c._SearchSorted=c.asm.SearchSorted).apply(null,arguments)},c._SelectV2=function(){return(c._SelectV2=c.asm.SelectV2).apply(null,arguments)},c._Selu=function(){return(c._Selu=c.asm.Selu).apply(null,arguments)},c._Sigmoid=function(){return(c._Sigmoid=c.asm.Sigmoid).apply(null,arguments)},c._Sign=function(){return(c._Sign=c.asm.Sign).apply(null,arguments)},c._Sin=function(){return(c._Sin=c.asm.Sin).apply(null,arguments)},c._Sinh=function(){return(c._Sinh=c.asm.Sinh).apply(null,arguments)},c._Softmax=function(){return(c._Softmax=c.asm.Softmax).apply(null,arguments)},c._Softplus=function(){return(c._Softplus=c.asm.Softplus).apply(null,arguments)},c._SparseFillEmptyRows=function(){return(c._SparseFillEmptyRows=c.asm.SparseFillEmptyRows).apply(null,arguments)},c._SparseReshape=function(){return(c._SparseReshape=c.asm.SparseReshape).apply(null,arguments)},c._SparseSegmentReduction=function(){return(c._SparseSegmentReduction=c.asm.SparseSegmentReduction).apply(null,arguments)},c._SparseToDense=function(){return(c._SparseToDense=c.asm.SparseToDense).apply(null,arguments)},c._Sqrt=function(){return(c._Sqrt=c.asm.Sqrt).apply(null,arguments)},c._Square=function(){return(c._Square=c.asm.Square).apply(null,arguments)},c._SquaredDifference=function(){return(c._SquaredDifference=c.asm.SquaredDifference).apply(null,arguments)},c._Step=function(){return(c._Step=c.asm.Step).apply(null,arguments)},c._StridedSlice=function(){return(c._StridedSlice=c.asm.StridedSlice).apply(null,arguments)},c._Sub=function(){return(c._Sub=c.asm.Sub).apply(null,arguments)},c._Sum=function(){return(c._Sum=c.asm.Sum).apply(null,arguments)},c._Tan=function(){return(c._Tan=c.asm.Tan).apply(null,arguments)},c._Tanh=function(){return(c._Tanh=c.asm.Tanh).apply(null,arguments)},c._TensorScatterUpdate=function(){return(c._TensorScatterUpdate=c.asm.TensorScatterUpdate).apply(null,arguments)},c._Tile=function(){return(c._Tile=c.asm.Tile).apply(null,arguments)},c._TopK=function(){return(c._TopK=c.asm.TopK).apply(null,arguments)},c._Transform=function(){return(c._Transform=c.asm.Transform).apply(null,arguments)},c._Transpose=function(){return(c._Transpose=c.asm.Transpose).apply(null,arguments)},c.__FusedMatMul=function(){return(c.__FusedMatMul=c.asm._FusedMatMul).apply(null,arguments)},c._malloc=function(){return(c._malloc=c.asm.malloc).apply(null,arguments)},c._free=function(){return(c._free=c.asm.free).apply(null,arguments)},c.__emscripten_tls_init=function(){return(c.__emscripten_tls_init=c.asm._emscripten_tls_init).apply(null,arguments)};var ho=c._pthread_self=function(){return(ho=c._pthread_self=c.asm.pthread_self).apply(null,arguments)};c.___errno_location=function(){return(c.___errno_location=c.asm.__errno_location).apply(null,arguments)};var Ip=c.__emscripten_thread_init=function(){return(Ip=c.__emscripten_thread_init=c.asm._emscripten_thread_init).apply(null,arguments)};c.__emscripten_thread_crashed=function(){return(c.__emscripten_thread_crashed=c.asm._emscripten_thread_crashed).apply(null,arguments)},c._emscripten_main_thread_process_queued_calls=function(){return(c._emscripten_main_thread_process_queued_calls=c.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},c._emscripten_main_browser_thread_id=function(){return(c._emscripten_main_browser_thread_id=c.asm.emscripten_main_browser_thread_id).apply(null,arguments)};var po=c._emscripten_run_in_main_runtime_thread_js=function(){return(po=c._emscripten_run_in_main_runtime_thread_js=c.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)};c._emscripten_dispatch_to_thread_=function(){return(c._emscripten_dispatch_to_thread_=c.asm.emscripten_dispatch_to_thread_).apply(null,arguments)};var Tp=c.__emscripten_proxy_execute_task_queue=function(){return(Tp=c.__emscripten_proxy_execute_task_queue=c.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)},Hl=c.__emscripten_thread_free_data=function(){return(Hl=c.__emscripten_thread_free_data=c.asm._emscripten_thread_free_data).apply(null,arguments)},Ep=c.__emscripten_thread_exit=function(){return(Ep=c.__emscripten_thread_exit=c.asm._emscripten_thread_exit).apply(null,arguments)},wc=c._emscripten_stack_set_limits=function(){return(wc=c._emscripten_stack_set_limits=c.asm.emscripten_stack_set_limits).apply(null,arguments)},Gl=c.stackSave=function(){return(Gl=c.stackSave=c.asm.stackSave).apply(null,arguments)},rl=c.stackRestore=function(){return(rl=c.stackRestore=c.asm.stackRestore).apply(null,arguments)},mo=c.stackAlloc=function(){return(mo=c.stackAlloc=c.asm.stackAlloc).apply(null,arguments)};c.dynCall_iijjiiii=function(){return(c.dynCall_iijjiiii=c.asm.dynCall_iijjiiii).apply(null,arguments)},c.dynCall_jiji=function(){return(c.dynCall_jiji=c.asm.dynCall_jiji).apply(null,arguments)},c.keepRuntimeAlive=at,c.wasmMemory=O,c.cwrap=_p,c.ExitStatus=Et,c.PThread=ze;var al;gt=function K(){al||X(),al||(gt=K)};function X(K){if(Ae>0)return;if(v){h(c),ae(),startWorker(c);return}if(Y(),Ae>0)return;function ke(){al||(al=!0,c.calledRun=!0,!q&&(ae(),h(c),c.onRuntimeInitialized&&c.onRuntimeInitialized(),we()))}c.setStatus?(c.setStatus("Running..."),setTimeout(function(){setTimeout(function(){c.setStatus("")},1),ke()},1)):ke()}if(c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);c.preInit.length>0;)c.preInit.pop()();X();var Ue;m&&(Ue={uncaughtException:process.listeners("uncaughtException").filter(function(K){return!m.uncaughtException.indexOf(K)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(K){return!m.unhandledRejection.indexOf(K)>-1})});var mn;if(typeof WasmBackendModule<"u")mn=WasmBackendModule;else if(typeof a<"u")mn=a;else throw new Error("Could not find wasm module in post.js");if(Ue){var Hn=mn._dispose;mn._dispose=function(){Hn(),Ue.uncaughtException.forEach(function(K){process.removeListener("uncaughtException",K)}),Ue.unhandledRejection.forEach(function(K){process.removeListener("unhandledRejection",K)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModuleThreadedSimd=n)}),Epe=Hr((e,t)=>{t.exports.wasmWorkerContents=`"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"
");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};`}),jpe=Hr((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};var s=typeof a<"u"?a:{},i,l;s.ready=new Promise(function(pe,Me){i=pe,l=Me});var u;typeof process<"u"&&process.listeners&&(u={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var d=Object.assign({},s),c=typeof window=="object",h=typeof importScripts=="function",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m="";function f(pe){return s.locateFile?s.locateFile(pe,m):m+pe}var g,x,y;if(p){var b=BI(),v=UB();h?m=v.dirname(m)+"/":m=__dirname+"/",g=(pe,Me)=>(pe=Oe(pe)?new URL(pe):v.normalize(pe),b.readFileSync(pe,Me?void 0:"utf8")),y=pe=>{var Me=g(pe,!0);return Me.buffer||(Me=new Uint8Array(Me)),Me},x=(pe,Me,Je)=>{pe=Oe(pe)?new URL(pe):v.normalize(pe),b.readFile(pe,function(ze,Ft){ze?Je(ze):Me(Ft.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(pe){if(!(pe instanceof at))throw pe}),process.on("unhandledRejection",function(pe){throw pe}),s.inspect=function(){return"[Emscripten Module object]"}}else(c||h)&&(h?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",g=pe=>{var Me=new XMLHttpRequest;return Me.open("GET",pe,!1),Me.send(null),Me.responseText},h&&(y=pe=>{var Me=new XMLHttpRequest;return Me.open("GET",pe,!1),Me.responseType="arraybuffer",Me.send(null),new Uint8Array(Me.response)}),x=(pe,Me,Je)=>{var ze=new XMLHttpRequest;ze.open("GET",pe,!0),ze.responseType="arraybuffer",ze.onload=()=>{if(ze.status==200||ze.status==0&&ze.response){Me(ze.response);return}Je()},ze.onerror=Je,ze.send(null)});var w=s.print||console.log.bind(console),N=s.printErr||console.warn.bind(console);Object.assign(s,d),d=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&s.quit;var S;s.wasmBinary&&(S=s.wasmBinary),s.noExitRuntime,typeof WebAssembly!="object"&&ye("no native wasm support detected");var C,_=!1,T=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function E(pe,Me,Je){Me>>>=0;for(var ze=Me+Je,Ft=Me;pe[Ft]&&!(Ft>=ze);)++Ft;if(Ft-Me>16&&pe.buffer&&T)return T.decode(pe.subarray(Me,Ft));for(var Ht="";Me<Ft;){var ct=pe[Me++];if(!(ct&128)){Ht+=String.fromCharCode(ct);continue}var vt=pe[Me++]&63;if((ct&224)==192){Ht+=String.fromCharCode((ct&31)<<6|vt);continue}var ln=pe[Me++]&63;if((ct&240)==224?ct=(ct&15)<<12|vt<<6|ln:ct=(ct&7)<<18|vt<<12|ln<<6|pe[Me++]&63,ct<65536)Ht+=String.fromCharCode(ct);else{var fr=ct-65536;Ht+=String.fromCharCode(55296|fr>>10,56320|fr&1023)}}return Ht}function j(pe,Me){return pe>>>=0,pe?E(V,pe,Me):""}function I(pe,Me,Je,ze){if(Je>>>=0,!(ze>0))return 0;for(var Ft=Je,Ht=Je+ze-1,ct=0;ct<pe.length;++ct){var vt=pe.charCodeAt(ct);if(vt>=55296&&vt<=57343){var ln=pe.charCodeAt(++ct);vt=65536+((vt&1023)<<10)|ln&1023}if(vt<=127){if(Je>=Ht)break;Me[Je++>>>0]=vt}else if(vt<=2047){if(Je+1>=Ht)break;Me[Je++>>>0]=192|vt>>6,Me[Je++>>>0]=128|vt&63}else if(vt<=65535){if(Je+2>=Ht)break;Me[Je++>>>0]=224|vt>>12,Me[Je++>>>0]=128|vt>>6&63,Me[Je++>>>0]=128|vt&63}else{if(Je+3>=Ht)break;Me[Je++>>>0]=240|vt>>18,Me[Je++>>>0]=128|vt>>12&63,Me[Je++>>>0]=128|vt>>6&63,Me[Je++>>>0]=128|vt&63}}return Me[Je>>>0]=0,Je-Ft}function D(pe,Me,Je){return I(pe,V,Me,Je)}var F,P,V,$;function O(pe){F=pe,s.HEAP8=P=new Int8Array(pe),s.HEAP16=new Int16Array(pe),s.HEAP32=new Int32Array(pe),s.HEAPU8=V=new Uint8Array(pe),s.HEAPU16=new Uint16Array(pe),s.HEAPU32=$=new Uint32Array(pe),s.HEAPF32=new Float32Array(pe),s.HEAPF64=new Float64Array(pe)}s.INITIAL_MEMORY;var L=[],q=[],U=[];function ee(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)J(s.preRun.shift());Y(L)}function M(){Y(q)}function G(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)Q(s.postRun.shift());Y(U)}function J(pe){L.unshift(pe)}function ve(pe){q.unshift(pe)}function Q(pe){U.unshift(pe)}var se=0,_e=null;function Le(pe){se++,s.monitorRunDependencies&&s.monitorRunDependencies(se)}function Se(pe){if(se--,s.monitorRunDependencies&&s.monitorRunDependencies(se),se==0&&_e){var Me=_e;_e=null,Me()}}function ye(pe){s.onAbort&&s.onAbort(pe),pe="Aborted("+pe+")",N(pe),_=!0,pe+=". Build with -sASSERTIONS for more info.";var Me=new WebAssembly.RuntimeError(pe);throw l(Me),Me}var Fe="data:application/octet-stream;base64,";function Te(pe){return pe.startsWith(Fe)}function Oe(pe){return pe.startsWith("file://")}var He;He="tfjs-backend-wasm.wasm",Te(He)||(He=f(He));function Ee(pe){try{if(pe==He&&S)return new Uint8Array(S);if(y)return y(pe);throw"both async and sync fetching of the wasm failed"}catch(Me){ye(Me)}}function Re(){if(!S&&(c||h)){if(typeof fetch=="function"&&!Oe(He))return fetch(He,{credentials:"same-origin"}).then(function(pe){if(!pe.ok)throw"failed to load wasm binary file at '"+He+"'";return pe.arrayBuffer()}).catch(function(){return Ee(He)});if(x)return new Promise(function(pe,Me){x(He,function(Je){pe(new Uint8Array(Je))},Me)})}return Promise.resolve().then(function(){return Ee(He)})}function Ke(){var pe={env:Ln,wasi_snapshot_preview1:Ln};function Me(ct,vt){var ln=ct.exports;s.asm=ln,C=s.asm.memory,O(C.buffer),s.asm.__indirect_function_table,ve(s.asm.__wasm_call_ctors),Se()}Le();function Je(ct){Me(ct.instance)}function ze(ct){return Re().then(function(vt){return WebAssembly.instantiate(vt,pe)}).then(function(vt){return vt}).then(ct,function(vt){N("failed to asynchronously prepare wasm: "+vt),ye(vt)})}function Ft(){return!S&&typeof WebAssembly.instantiateStreaming=="function"&&!Te(He)&&!Oe(He)&&!p&&typeof fetch=="function"?fetch(He,{credentials:"same-origin"}).then(function(ct){var vt=WebAssembly.instantiateStreaming(ct,pe);return vt.then(Je,function(ln){return N("wasm streaming compile failed: "+ln),N("falling back to ArrayBuffer instantiation"),ze(Je)})}):ze(Je)}if(s.instantiateWasm)try{var Ht=s.instantiateWasm(pe,Me);return Ht}catch(ct){N("Module.instantiateWasm callback failed with error: "+ct),l(ct)}return Ft().catch(l),{}}function at(pe){this.name="ExitStatus",this.message="Program terminated with exit("+pe+")",this.status=pe}function Y(pe){for(;pe.length>0;)pe.shift()(s)}function ae(){ye("")}function we(){return 4294901760}function Ce(){return we()}function Ne(pe,Me,Je){V.copyWithin(pe>>>0,Me>>>0,Me+Je>>>0)}function he(pe){try{return C.grow(pe-F.byteLength+65535>>>16),O(C.buffer),1}catch{}}function Ae(pe){var Me=V.length;pe=pe>>>0;var Je=we();if(pe>Je)return!1;let ze=(ln,fr)=>ln+(fr-ln%fr)%fr;for(var Ft=1;Ft<=4;Ft*=2){var Ht=Me*(1+.2/Ft);Ht=Math.min(Ht,pe+100663296);var ct=Math.min(Je,ze(Math.max(pe,Ht),65536)),vt=he(ct);if(vt)return!0}return!1}function gt(pe){return 52}function ht(pe,Me,Je,ze,Ft){return 70}var Dt=[null,[],[]];function $t(pe,Me){var Je=Dt[pe];Me===0||Me===10?((pe===1?w:N)(E(Je,0)),Je.length=0):Je.push(Me)}function qe(pe,Me,Je,ze){for(var Ft=0,Ht=0;Ht<Je;Ht++){var ct=$[Me>>>2],vt=$[Me+4>>>2];Me+=8;for(var ln=0;ln<vt;ln++)$t(pe,V[ct+ln>>>0]);Ft+=vt}return $[ze>>>2]=Ft,0}function it(pe){var Me=s["_"+pe];return Me}function Ct(pe,Me){P.set(pe,Me>>>0)}function pt(pe,Me,Je,ze,Ft){var Ht={string:zn=>{var Ma=0;if(zn!=null&&zn!==0){var Bs=(zn.length<<2)+1;Ma=Et(Bs),D(zn,Ma,Bs)}return Ma},array:zn=>{var Ma=Et(zn.length);return Ct(zn,Ma),Ma}};function ct(zn){return Me==="string"?j(zn):Me==="boolean"?!!zn:zn}var vt=it(pe),ln=[],fr=0;if(ze)for(var Na=0;Na<ze.length;Na++){var aa=Ht[Je[Na]];aa?(fr===0&&(fr=bt()),ln[Na]=aa(ze[Na])):ln[Na]=ze[Na]}var qr=vt.apply(null,ln);function Da(zn){return fr!==0&&Ot(fr),ct(zn)}return qr=Da(qr),qr}function Ut(pe,Me,Je,ze){Je=Je||[];var Ft=Je.every(ct=>ct==="number"||ct==="boolean"),Ht=Me!=="string";return Ht&&Ft&&!ze?it(pe):function(){return pt(pe,Me,Je,arguments)}}var Ln={abort:ae,emscripten_get_heap_max:Ce,emscripten_memcpy_big:Ne,emscripten_resize_heap:Ae,fd_close:gt,fd_seek:ht,fd_write:qe};Ke(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.__wasm_call_ctors).apply(null,arguments)},s._init=function(){return(s._init=s.asm.init).apply(null,arguments)},s._init_with_threads_count=function(){return(s._init_with_threads_count=s.asm.init_with_threads_count).apply(null,arguments)},s._get_threads_count=function(){return(s._get_threads_count=s.asm.get_threads_count).apply(null,arguments)},s._register_tensor=function(){return(s._register_tensor=s.asm.register_tensor).apply(null,arguments)},s._dispose_data=function(){return(s._dispose_data=s.asm.dispose_data).apply(null,arguments)},s._dispose=function(){return(s._dispose=s.asm.dispose).apply(null,arguments)},s._Abs=function(){return(s._Abs=s.asm.Abs).apply(null,arguments)},s._Acos=function(){return(s._Acos=s.asm.Acos).apply(null,arguments)},s._Acosh=function(){return(s._Acosh=s.asm.Acosh).apply(null,arguments)},s._Add=function(){return(s._Add=s.asm.Add).apply(null,arguments)},s._AddN=function(){return(s._AddN=s.asm.AddN).apply(null,arguments)},s._All=function(){return(s._All=s.asm.All).apply(null,arguments)},s._Any=function(){return(s._Any=s.asm.Any).apply(null,arguments)},s._ArgMax=function(){return(s._ArgMax=s.asm.ArgMax).apply(null,arguments)},s._ArgMin=function(){return(s._ArgMin=s.asm.ArgMin).apply(null,arguments)},s._Asin=function(){return(s._Asin=s.asm.Asin).apply(null,arguments)},s._Asinh=function(){return(s._Asinh=s.asm.Asinh).apply(null,arguments)},s._Atan=function(){return(s._Atan=s.asm.Atan).apply(null,arguments)},s._Atan2=function(){return(s._Atan2=s.asm.Atan2).apply(null,arguments)},s._Atanh=function(){return(s._Atanh=s.asm.Atanh).apply(null,arguments)},s._AvgPool=function(){return(s._AvgPool=s.asm.AvgPool).apply(null,arguments)},s._AvgPool3D=function(){return(s._AvgPool3D=s.asm.AvgPool3D).apply(null,arguments)},s._AvgPool3DGrad=function(){return(s._AvgPool3DGrad=s.asm.AvgPool3DGrad).apply(null,arguments)},s._AvgPoolGrad=function(){return(s._AvgPoolGrad=s.asm.AvgPoolGrad).apply(null,arguments)},s._BatchMatMul=function(){return(s._BatchMatMul=s.asm.BatchMatMul).apply(null,arguments)},s._Bincount=function(){return(s._Bincount=s.asm.Bincount).apply(null,arguments)},s._BitwiseAnd=function(){return(s._BitwiseAnd=s.asm.BitwiseAnd).apply(null,arguments)},s._Ceil=function(){return(s._Ceil=s.asm.Ceil).apply(null,arguments)},s._ClipByValue=function(){return(s._ClipByValue=s.asm.ClipByValue).apply(null,arguments)},s._Conv2D=function(){return(s._Conv2D=s.asm.Conv2D).apply(null,arguments)},s._Conv2DBackpropInput=function(){return(s._Conv2DBackpropInput=s.asm.Conv2DBackpropInput).apply(null,arguments)},s._Conv3D=function(){return(s._Conv3D=s.asm.Conv3D).apply(null,arguments)},s._Conv3DBackpropFilterV2=function(){return(s._Conv3DBackpropFilterV2=s.asm.Conv3DBackpropFilterV2).apply(null,arguments)},s._Conv3DBackpropInputV2=function(){return(s._Conv3DBackpropInputV2=s.asm.Conv3DBackpropInputV2).apply(null,arguments)},s._Cos=function(){return(s._Cos=s.asm.Cos).apply(null,arguments)},s._Cosh=function(){return(s._Cosh=s.asm.Cosh).apply(null,arguments)},s._CropAndResize=function(){return(s._CropAndResize=s.asm.CropAndResize).apply(null,arguments)},s._Cumprod=function(){return(s._Cumprod=s.asm.Cumprod).apply(null,arguments)},s._Cumsum=function(){return(s._Cumsum=s.asm.Cumsum).apply(null,arguments)},s._DenseBincount=function(){return(s._DenseBincount=s.asm.DenseBincount).apply(null,arguments)},s._DepthToSpace=function(){return(s._DepthToSpace=s.asm.DepthToSpace).apply(null,arguments)},s._DepthwiseConv2dNative=function(){return(s._DepthwiseConv2dNative=s.asm.DepthwiseConv2dNative).apply(null,arguments)},s._Diag=function(){return(s._Diag=s.asm.Diag).apply(null,arguments)},s._Dilation2D=function(){return(s._Dilation2D=s.asm.Dilation2D).apply(null,arguments)},s._Dilation2DBackpropFilter=function(){return(s._Dilation2DBackpropFilter=s.asm.Dilation2DBackpropFilter).apply(null,arguments)},s._Dilation2DBackpropInput=function(){return(s._Dilation2DBackpropInput=s.asm.Dilation2DBackpropInput).apply(null,arguments)},s._Elu=function(){return(s._Elu=s.asm.Elu).apply(null,arguments)},s._EluGrad=function(){return(s._EluGrad=s.asm.EluGrad).apply(null,arguments)},s._Equal=function(){return(s._Equal=s.asm.Equal).apply(null,arguments)},s._Erf=function(){return(s._Erf=s.asm.Erf).apply(null,arguments)},s._Exp=function(){return(s._Exp=s.asm.Exp).apply(null,arguments)},s._Expm1=function(){return(s._Expm1=s.asm.Expm1).apply(null,arguments)},s._FlipLeftRight=function(){return(s._FlipLeftRight=s.asm.FlipLeftRight).apply(null,arguments)},s._Floor=function(){return(s._Floor=s.asm.Floor).apply(null,arguments)},s._FloorDiv=function(){return(s._FloorDiv=s.asm.FloorDiv).apply(null,arguments)},s._FusedBatchNorm=function(){return(s._FusedBatchNorm=s.asm.FusedBatchNorm).apply(null,arguments)},s._FusedConv2D=function(){return(s._FusedConv2D=s.asm.FusedConv2D).apply(null,arguments)},s._FusedDepthwiseConv2D=function(){return(s._FusedDepthwiseConv2D=s.asm.FusedDepthwiseConv2D).apply(null,arguments)},s._Gather=function(){return(s._Gather=s.asm.Gather).apply(null,arguments)},s._GatherNd=function(){return(s._GatherNd=s.asm.GatherNd).apply(null,arguments)},s._Greater=function(){return(s._Greater=s.asm.Greater).apply(null,arguments)},s._GreaterEqual=function(){return(s._GreaterEqual=s.asm.GreaterEqual).apply(null,arguments)},s._IsFinite=function(){return(s._IsFinite=s.asm.IsFinite).apply(null,arguments)},s._IsInf=function(){return(s._IsInf=s.asm.IsInf).apply(null,arguments)},s._IsNan=function(){return(s._IsNan=s.asm.IsNan).apply(null,arguments)},s._LRN=function(){return(s._LRN=s.asm.LRN).apply(null,arguments)},s._LRNGrad=function(){return(s._LRNGrad=s.asm.LRNGrad).apply(null,arguments)},s._LeakyRelu=function(){return(s._LeakyRelu=s.asm.LeakyRelu).apply(null,arguments)},s._Less=function(){return(s._Less=s.asm.Less).apply(null,arguments)},s._LessEqual=function(){return(s._LessEqual=s.asm.LessEqual).apply(null,arguments)},s._LinSpace=function(){return(s._LinSpace=s.asm.LinSpace).apply(null,arguments)},s._Log=function(){return(s._Log=s.asm.Log).apply(null,arguments)},s._Log1p=function(){return(s._Log1p=s.asm.Log1p).apply(null,arguments)},s._LogicalAnd=function(){return(s._LogicalAnd=s.asm.LogicalAnd).apply(null,arguments)},s._LogicalNot=function(){return(s._LogicalNot=s.asm.LogicalNot).apply(null,arguments)},s._LogicalOr=function(){return(s._LogicalOr=s.asm.LogicalOr).apply(null,arguments)},s._LogicalXor=function(){return(s._LogicalXor=s.asm.LogicalXor).apply(null,arguments)},s._Max=function(){return(s._Max=s.asm.Max).apply(null,arguments)},s._MaxPool=function(){return(s._MaxPool=s.asm.MaxPool).apply(null,arguments)},s._MaxPool3D=function(){return(s._MaxPool3D=s.asm.MaxPool3D).apply(null,arguments)},s._MaxPool3DGrad=function(){return(s._MaxPool3DGrad=s.asm.MaxPool3DGrad).apply(null,arguments)},s._MaxPoolGrad=function(){return(s._MaxPoolGrad=s.asm.MaxPoolGrad).apply(null,arguments)},s._MaxPoolWithArgmax=function(){return(s._MaxPoolWithArgmax=s.asm.MaxPoolWithArgmax).apply(null,arguments)},s._Maximum=function(){return(s._Maximum=s.asm.Maximum).apply(null,arguments)},s._Mean=function(){return(s._Mean=s.asm.Mean).apply(null,arguments)},s._Min=function(){return(s._Min=s.asm.Min).apply(null,arguments)},s._Minimum=function(){return(s._Minimum=s.asm.Minimum).apply(null,arguments)},s._MirrorPad=function(){return(s._MirrorPad=s.asm.MirrorPad).apply(null,arguments)},s._Mod=function(){return(s._Mod=s.asm.Mod).apply(null,arguments)},s._Multinomial=function(){return(s._Multinomial=s.asm.Multinomial).apply(null,arguments)},s._Multiply=function(){return(s._Multiply=s.asm.Multiply).apply(null,arguments)},s._Neg=function(){return(s._Neg=s.asm.Neg).apply(null,arguments)},s._NonMaxSuppressionV3=function(){return(s._NonMaxSuppressionV3=s.asm.NonMaxSuppressionV3).apply(null,arguments)},s._NonMaxSuppressionV4=function(){return(s._NonMaxSuppressionV4=s.asm.NonMaxSuppressionV4).apply(null,arguments)},s._NonMaxSuppressionV5=function(){return(s._NonMaxSuppressionV5=s.asm.NonMaxSuppressionV5).apply(null,arguments)},s._NotEqual=function(){return(s._NotEqual=s.asm.NotEqual).apply(null,arguments)},s._OneHot=function(){return(s._OneHot=s.asm.OneHot).apply(null,arguments)},s._PadV2=function(){return(s._PadV2=s.asm.PadV2).apply(null,arguments)},s._Pow=function(){return(s._Pow=s.asm.Pow).apply(null,arguments)},s._Prelu=function(){return(s._Prelu=s.asm.Prelu).apply(null,arguments)},s._Prod=function(){return(s._Prod=s.asm.Prod).apply(null,arguments)},s._RealDiv=function(){return(s._RealDiv=s.asm.RealDiv).apply(null,arguments)},s._Reciprocal=function(){return(s._Reciprocal=s.asm.Reciprocal).apply(null,arguments)},s._Relu=function(){return(s._Relu=s.asm.Relu).apply(null,arguments)},s._Relu6=function(){return(s._Relu6=s.asm.Relu6).apply(null,arguments)},s._ResizeBilinear=function(){return(s._ResizeBilinear=s.asm.ResizeBilinear).apply(null,arguments)},s._ResizeBilinearGrad=function(){return(s._ResizeBilinearGrad=s.asm.ResizeBilinearGrad).apply(null,arguments)},s._ResizeNearestNeighbor=function(){return(s._ResizeNearestNeighbor=s.asm.ResizeNearestNeighbor).apply(null,arguments)},s._ResizeNearestNeighborGrad=function(){return(s._ResizeNearestNeighborGrad=s.asm.ResizeNearestNeighborGrad).apply(null,arguments)},s._Reverse=function(){return(s._Reverse=s.asm.Reverse).apply(null,arguments)},s._RotateWithOffset=function(){return(s._RotateWithOffset=s.asm.RotateWithOffset).apply(null,arguments)},s._Round=function(){return(s._Round=s.asm.Round).apply(null,arguments)},s._Rsqrt=function(){return(s._Rsqrt=s.asm.Rsqrt).apply(null,arguments)},s._ScatterNd=function(){return(s._ScatterNd=s.asm.ScatterNd).apply(null,arguments)},s._SearchSorted=function(){return(s._SearchSorted=s.asm.SearchSorted).apply(null,arguments)},s._SelectV2=function(){return(s._SelectV2=s.asm.SelectV2).apply(null,arguments)},s._Selu=function(){return(s._Selu=s.asm.Selu).apply(null,arguments)},s._Sigmoid=function(){return(s._Sigmoid=s.asm.Sigmoid).apply(null,arguments)},s._Sign=function(){return(s._Sign=s.asm.Sign).apply(null,arguments)},s._Sin=function(){return(s._Sin=s.asm.Sin).apply(null,arguments)},s._Sinh=function(){return(s._Sinh=s.asm.Sinh).apply(null,arguments)},s._Softmax=function(){return(s._Softmax=s.asm.Softmax).apply(null,arguments)},s._Softplus=function(){return(s._Softplus=s.asm.Softplus).apply(null,arguments)},s._SparseFillEmptyRows=function(){return(s._SparseFillEmptyRows=s.asm.SparseFillEmptyRows).apply(null,arguments)},s._SparseReshape=function(){return(s._SparseReshape=s.asm.SparseReshape).apply(null,arguments)},s._SparseSegmentReduction=function(){return(s._SparseSegmentReduction=s.asm.SparseSegmentReduction).apply(null,arguments)},s._SparseToDense=function(){return(s._SparseToDense=s.asm.SparseToDense).apply(null,arguments)},s._Sqrt=function(){return(s._Sqrt=s.asm.Sqrt).apply(null,arguments)},s._Square=function(){return(s._Square=s.asm.Square).apply(null,arguments)},s._SquaredDifference=function(){return(s._SquaredDifference=s.asm.SquaredDifference).apply(null,arguments)},s._Step=function(){return(s._Step=s.asm.Step).apply(null,arguments)},s._StridedSlice=function(){return(s._StridedSlice=s.asm.StridedSlice).apply(null,arguments)},s._Sub=function(){return(s._Sub=s.asm.Sub).apply(null,arguments)},s._Sum=function(){return(s._Sum=s.asm.Sum).apply(null,arguments)},s._Tan=function(){return(s._Tan=s.asm.Tan).apply(null,arguments)},s._Tanh=function(){return(s._Tanh=s.asm.Tanh).apply(null,arguments)},s._TensorScatterUpdate=function(){return(s._TensorScatterUpdate=s.asm.TensorScatterUpdate).apply(null,arguments)},s._Tile=function(){return(s._Tile=s.asm.Tile).apply(null,arguments)},s._TopK=function(){return(s._TopK=s.asm.TopK).apply(null,arguments)},s._Transform=function(){return(s._Transform=s.asm.Transform).apply(null,arguments)},s._Transpose=function(){return(s._Transpose=s.asm.Transpose).apply(null,arguments)},s.__FusedMatMul=function(){return(s.__FusedMatMul=s.asm._FusedMatMul).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.malloc).apply(null,arguments)},s._free=function(){return(s._free=s.asm.free).apply(null,arguments)},s.___errno_location=function(){return(s.___errno_location=s.asm.__errno_location).apply(null,arguments)};var bt=s.stackSave=function(){return(bt=s.stackSave=s.asm.stackSave).apply(null,arguments)},Ot=s.stackRestore=function(){return(Ot=s.stackRestore=s.asm.stackRestore).apply(null,arguments)},Et=s.stackAlloc=function(){return(Et=s.stackAlloc=s.asm.stackAlloc).apply(null,arguments)};s.dynCall_iijjiiii=function(){return(s.dynCall_iijjiiii=s.asm.dynCall_iijjiiii).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.dynCall_jiji).apply(null,arguments)},s.cwrap=Ut;var Lt;_e=function pe(){Lt||At(),Lt||(_e=pe)};function At(pe){if(se>0||(ee(),se>0))return;function Me(){Lt||(Lt=!0,s.calledRun=!0,!_&&(M(),i(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),G()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),Me()},1)):Me()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();At();var zt;u&&(zt={uncaughtException:process.listeners("uncaughtException").filter(function(pe){return!u.uncaughtException.indexOf(pe)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(pe){return!u.unhandledRejection.indexOf(pe)>-1})});var Sn;if(typeof a<"u")Sn=a;else if(typeof WasmBackendModuleThreadedSimd<"u")Sn=WasmBackendModuleThreadedSimd;else throw new Error("Could not find wasm module in post.js");if(zt){var ot=Sn._dispose;Sn._dispose=function(){ot(),zt.uncaughtException.forEach(function(pe){process.removeListener("uncaughtException",pe)}),zt.unhandledRejection.forEach(function(pe){process.removeListener("unhandledRejection",pe)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModule=n)}),a1=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},Gy=class{refCount(e){return ws("refCount")}incRef(e){return ws("incRef")}timerAvailable(){return!0}time(e){return ws("time")}read(e){return ws("read")}readSync(e){return ws("readSync")}readToGPU(e,t){return ws("readToGPU")}numDataIds(){return ws("numDataIds")}disposeData(e,t){return ws("disposeData")}write(e,t,n){return ws("write")}move(e,t,n,r,a){return ws("move")}createTensorFromGPUData(e,t,n){return ws("createTensorFromGPUData")}memory(){return ws("memory")}floatPrecision(){return ws("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return ws("dispose")}};function ws(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function HB(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,Jw(e,t,n)}function Ape(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,Jw(e,n,r),Jw(t,n,r)}function oy(e,t,n){return Math.max(e,Math.min(t,n))}function Rpe(e){return e%2===0?e:e+1}function Jw(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function Dpe(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function Mpe(e,t){let n=Math.random();return t*n+(1-n)*e}function $pe(e,t){let n=0;for(let r=0;r<e.length;r++){let a=Number(e[r])-Number(t[r]);n+=a*a}return n}function H(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function Qa(e,t,n=""){H($l(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Gd(e){H(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Xn(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Fpe(e){return e.length===0}function GB(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function $l(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Om(e){return e%1===0}function Ppe(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{let t=Math.exp(2*e);return(t-1)/(t+1)}}function Ope(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Lpe(e){let t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return HB(t),t}function Lx(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function zpe(e,t=a=>0,n,r){return new Promise((a,s)=>{let i=0,l=()=>{if(e()){a();return}i++;let u=t(i);if(n!=null&&i>=n){s();return}r!=null?r(l,u):setTimeout(l,u)};l()})}function Bpe(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let a=e.slice();return a[r]=t/n,a}function Ei(e,t){let n=t.length;return e=e==null?t.map((r,a)=>a):[].concat(e),H(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),H(e.every(r=>Om(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function qB(e,t){let n=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||a?null:Ei(t,e).sort(),i=0;for(let l=0;l<e.length;++l){if(s!=null){if(s[i]===l&&e[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${e[l]}' is not 1`);(s[i]==null||s[i]>l)&&e[l]===1&&(n.push(e[l]),r.push(l)),s[i]<=l&&i++}e[l]!==1&&(n.push(e[l]),r.push(l))}return{newShape:n,keptDims:r}}function KB(e,t){return WI(e,t)}function WI(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function YB(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function XB(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function Wpe(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function e0(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function ZB(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function wu(e){return typeof e=="string"||e instanceof String}function QB(e){return typeof e=="boolean"}function JB(e){return typeof e=="number"}function qy(e){return Array.isArray(e)?qy(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":JB(e)?"float32":wu(e)?"string":QB(e)?"bool":"float32"}function Pu(e){return!!(e&&e.constructor&&e.call&&e.apply)}function t0(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function mf(e){let t=e.length;if(t<2)return[];let n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function eW(e,t,n,r=!1){let a=new Array;if(t.length===1){let s=t[0]*(r?2:1);for(let i=0;i<s;i++)a[i]=n[e+i]}else{let s=t[0],i=t.slice(1),l=i.reduce((u,d)=>u*d)*(r?2:1);for(let u=0;u<s;u++)a[u]=eW(e+u*l,i,n,r)}return a}function im(e,t,n=!1){if(e.length===0)return t[0];let r=e.reduce((a,s)=>a*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return eW(0,e,t,n)}function Vpe(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function VI(e,t){let n=s1(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function s1(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Upe(e,t){let n=e.reduce((r,a)=>r*a,1);if(t==null||t==="float32")return im(e,new Float32Array(n));if(t==="int32")return im(e,new Int32Array(n));if(t==="bool")return im(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function zs(e){e.forEach(t=>{H(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function Hpe(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Gpe(e,t,n){if(t===0)return[];if(t===1)return[e];let r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function i1(e){return e&&e.then&&typeof e.then=="function"}var $$="tfjsflags",tW=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=qpe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(be().getBool("IS_TEST")||be().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let r=this.urlFlags[e];be().getBool("IS_TEST")||be().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(i1(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);$$ in e&&e[$$].split(",").forEach(t=>{let[n,r]=t.split(":");this.urlFlags[n]=Ype(n,r)})}};function qpe(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(Kpe(t,r[0],r[1]),r.join("="))),t}function Kpe(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function Ype(e,t){let n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function be(){return UI}var UI=null;function Xpe(e){UI=e}var tS;function nW(){if(tS==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");tS=e}return tS}function Zpe(){let e=nW();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function HI(e,t){let n=Zpe();if(n.has(e))return n.get(e);{let r=t();return n.set(e,r),n.get(e)}}var ff="Abs",qd="Acos",Kd="Acosh",ac="Add",Yd="AddN",gf="All",xf="Any",yf="ArgMax",bf="ArgMin",Xd="Asin",Zd="Asinh",Qd="Atan",Jd="Atanh",eh="Atan2",th="AvgPool",Ky="AvgPoolGrad",vf="AvgPool3D",Yy="AvgPool3DGrad",nh="BatchMatMul",wf="BatchToSpaceND",Nf="Bincount",kf="BitwiseAnd",rW="BroadcastTo",Xy="BroadcastArgs",rh="Cast",ah="Ceil",sc="ClipByValue",o1="Complex",Zy="ComplexAbs",Sf="Concat",sh="Conv2D",l1="Conv2DBackpropFilter",ih="Conv2DBackpropInput",oh="Conv3D",Cf="Conv3DBackpropFilterV2",_f="Conv3DBackpropInputV2",lh="Cos",uh="Cosh",If="Cumprod",ch="Cumsum",Tf="CropAndResize",Qy="DenseBincount",Ef="DepthToSpace",dh="DepthwiseConv2dNative",u1="DepthwiseConv2dNativeBackpropFilter",c1="DepthwiseConv2dNativeBackpropInput",Jy="Diag",hh="Dilation2D",Lm="Dilation2DBackpropInput",zm="Dilation2DBackpropFilter",d1="Draw",ph="RealDiv",h1="Einsum",mh="Elu",jf="EluGrad",fh="Erf",Af="Equal",gh="Exp",Rf="ExpandDims",xh="Expm1",p1="FFT",eb="Fill",Df="FlipLeftRight",yh="Floor",bh="FloorDiv",vh="FusedBatchNorm",Mf="GatherV2",$f="GatherNd",Ff="Greater",wh="GreaterEqual",Nh="Identity",m1="IFFT",f1="Imag",kh="IsFinite",Sh="IsInf",Ch="IsNan",_h="LeakyRelu",Pf="Less",Of="LessEqual",Lf="LinSpace",Ih="Log",Th="Log1p",zf="LogicalAnd",Bf="LogicalNot",Wf="LogicalOr",aW="LogicalXor",sW="LogSoftmax",Qpe="LowerBound",Eh="LRN",Vf="LRNGrad",Jpe="MatrixBandPart",jh="Max",Ah="Maximum",Rh="MaxPool",tb="MaxPoolGrad",Uf="MaxPool3D",nb="MaxPool3DGrad",rb="MaxPoolWithArgmax",Dh="Mean",Mh="Min",$h="Minimum",Fh="MirrorPad",Ph="Mod",Hf="Multinomial",Oh="Multiply",Gf="Neg",qf="NotEqual",Kf="NonMaxSuppressionV3",Yf="NonMaxSuppressionV4",Xf="NonMaxSuppressionV5",Zf="OnesLike",Lh="OneHot",Qf="Pack",zh="PadV2",eme="Pool",Bh="Pow",Wh="Prelu",Vh="Prod",g1="RaggedGather",x1="RaggedRange",y1="RaggedTensorToTensor",ab="Range",b1="Real",Uh="Reciprocal",Hh="Relu",Jf="Reshape",Gh="ResizeNearestNeighbor",eg="ResizeNearestNeighborGrad",qh="ResizeBilinear",tg="ResizeBilinearGrad",Kh="Relu6",Yh="Reverse",Xh="Round",Zh="Rsqrt",ng="ScatterNd",rg="TensorScatterUpdate",ag="SearchSorted",sg="Select",Qh="Selu",ig="Slice",Jh="Sin",ep="Sinh",tp="Sign",np="Sigmoid",rp="Softplus",ap="Sqrt",sp="Sum",og="SpaceToBatchND",lg="SplitV",ip="Softmax",sb="SparseFillEmptyRows",ug="SparseReshape",ib="SparseSegmentMean",ob="SparseSegmentSum",cg="SparseToDense",op="SquaredDifference",lb="Square",ub="StaticRegexReplace",dg="StridedSlice",cb="StringNGrams",db="StringSplit",hb="StringToHashBucketFast",lp="Sub",up="Tan",cp="Tanh",ic="Tile",hg="TopK",pg="Transform",vl="Transpose",pb="Unique",mg="Unpack",mb="UnsortedSegmentSum",tme="UpperBound",fg="ZerosLike",oc="Step",n0="FromPixels",gg="RotateWithOffset",_d="_FusedMatMul",Id="FusedConv2D",Td="FusedDepthwiseConv2D";function uu(...e){be().getBool("IS_TEST")||be().getBool("PROD")||console.warn(...e)}function nme(...e){be().getBool("IS_TEST")||be().getBool("PROD")||console.log(...e)}var Bm=HI("kernelRegistry",()=>new Map),ly=HI("gradRegistry",()=>new Map);function uy(e,t){let n=GI(e,t);return Bm.get(n)}function V2(e){return ly.get(e)}function r0(e){let t=Bm.entries(),n=[];for(;;){let{done:r,value:a}=t.next();if(r)break;let[s,i]=a,[l]=s.split("_");l===e&&n.push(i)}return n}function fb(e){let{kernelName:t,backendName:n}=e,r=GI(t,n);Bm.has(r)&&uu(`The kernel '${t}' for backend '${n}' is already registered`),Bm.set(r,e)}function iW(e){let{kernelName:t}=e;ly.has(t)&&be().getBool("DEBUG")&&uu(`Overriding the gradient for '${t}'`),ly.set(t,e)}function rme(e,t){let n=GI(e,t);if(!Bm.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);Bm.delete(n)}function ame(e){if(!ly.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);ly.delete(e)}function sme(e,t){r0(e).forEach(n=>{let r=Object.assign({},n,{backendName:t});fb(r)})}function GI(e,t){return`${t}_${e}`}var A={};Kt(A,{arraysEqual:()=>$l,arraysEqualWithNull:()=>GB,assert:()=>H,assertNonNegativeIntegerDimensions:()=>zs,assertNonNull:()=>Gd,assertShapesMatch:()=>Qa,bytesFromStringArray:()=>ZB,bytesPerElement:()=>e0,checkConversionForErrors:()=>YB,clamp:()=>oy,computeStrides:()=>mf,convertBackendValuesAndArrayBuffer:()=>Vpe,createScalarValue:()=>dme,createShuffledIndices:()=>Lpe,decodeString:()=>a0,distSquared:()=>$pe,encodeString:()=>xb,fetch:()=>pme,fingerPrint64:()=>cme,flatten:()=>Ou,getArrayFromDType:()=>WI,getTypedArrayFromDType:()=>KB,hasEncodingLoss:()=>Wpe,hexToLong:()=>gb,indexToLoc:()=>Gpe,inferDtype:()=>qy,inferFromImplicitShape:()=>Bpe,isBoolean:()=>QB,isFunction:()=>Pu,isInt:()=>Om,isNumber:()=>JB,isPromise:()=>i1,isScalarShape:()=>Fpe,isString:()=>wu,isTypedArray:()=>fa,isValidDtype:()=>XB,locToIndex:()=>Hpe,makeOnesTypedArray:()=>VI,makeZerosNestedTypedArray:()=>Upe,makeZerosTypedArray:()=>s1,nearestDivisor:()=>t0,nearestLargerEven:()=>Rpe,now:()=>cy,parseAxisParam:()=>Ei,randUniform:()=>Mpe,repeatedTry:()=>zpe,rightPad:()=>Lx,shuffle:()=>HB,shuffleCombo:()=>Ape,sizeFromShape:()=>Xn,sizeToSquarishShape:()=>Ope,squeezeShape:()=>qB,sum:()=>Dpe,swap:()=>Jw,tanh:()=>Ppe,toNestedArray:()=>im,toTypedArray:()=>v1});function oW(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var F$=rc(mpe()),Mc=F$.default||F$;function gb(e){return Mc.fromString(e,!0,16)}var lW=gb("c3a5c85c97cb3127"),Ec=gb("b492b66fbe98f273"),Ua=gb("9ae16a3b2f90404f");function U2(e){return e.xor(e.shru(47))}function uW(e,t,n){let r=e.slice(t,t+n);return Mc.fromBytes(Array.from(r),!0,!0)}function dr(e,t){return uW(e,t,8)}function P$(e,t){return uW(e,t,4)}function ma(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function Eu(e,t,n=gb("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function ime(e,t,n,r,a,s){a=a.add(e),s=ma(s.add(a).add(r),21);let i=a;return a=a.add(t),a=a.add(n),s=s.add(ma(a,44)),[a.add(r),s.add(i)]}function vv(e,t,n,r){return ime(dr(e,t),dr(e,t+8),dr(e,t+16),dr(e,t+24),n,r)}function ome(e,t=e.length){if(t>=8){let n=Ua.add(t*2),r=dr(e,0).add(Ua),a=dr(e,t-8),s=ma(a,37).mul(n).add(r),i=ma(r,25).add(a).mul(n);return Eu(s,i,n)}if(t>=4){let n=Ua.add(t*2),r=P$(e,0);return Eu(r.shl(3).add(t),P$(e,t-4),n)}if(t>0){let n=e[0],r=e[t>>1],a=e[t-1],s=n+(r<<8),i=t+(a<<2);return U2(Ua.mul(s).xor(lW.mul(i))).mul(Ua)}return Ua}function lme(e,t=e.length){let n=Ua.add(t*2),r=dr(e,0).mul(Ec),a=dr(e,8),s=dr(e,t-8).mul(n),i=dr(e,t-16).mul(Ua);return Eu(ma(r.add(a),43).add(ma(s,30)).add(i),r.add(ma(a.add(Ua),18)).add(s),n)}function ume(e,t=e.length){let n=Ua.add(t*2),r=dr(e,0).mul(Ua),a=dr(e,8),s=dr(e,t-8).mul(n),i=dr(e,t-16).mul(Ua),l=ma(r.add(a),43).add(ma(s,30)).add(i),u=Eu(l,r.add(ma(a.add(Ua),18)).add(s),n),d=dr(e,16).mul(n),c=dr(e,24),h=l.add(dr(e,t-32)).mul(n),p=u.add(dr(e,t-24)).mul(n);return Eu(ma(d.add(c),43).add(ma(h,30)).add(p),d.add(ma(c.add(r),18)).add(h),n)}function cme(e,t=e.length){let n=Mc.fromNumber(81,!0);if(t<=32)return t<=16?ome(e,t):lme(e,t);if(t<=64)return ume(e,t);let r=n,a=n.mul(Ec).add(113),s=U2(a.mul(Ua).add(113)).mul(Ua),i=[Mc.UZERO,Mc.UZERO],l=[Mc.UZERO,Mc.UZERO];r=r.mul(Ua).add(dr(e,0));let u=0,d=(t-1>>6)*64,c=d+(t-1&63)-63;do r=ma(r.add(a).add(i[0]).add(dr(e,u+8)),37).mul(Ec),a=ma(a.add(i[1]).add(dr(e,u+48)),42).mul(Ec),r=r.xor(l[1]),a=a.add(i[0]).add(dr(e,u+40)),s=ma(s.add(l[0]),33).mul(Ec),i=vv(e,u,i[1].mul(Ec),r.add(l[0])),l=vv(e,u+32,s.add(l[1]),a.add(dr(e,u+16))),[s,r]=[r,s],u+=64;while(u!==d);let h=Ec.add(s.and(255).shl(1));return u=c,l[0]=l[0].add(t-1&63),i[0]=i[0].add(l[0]),l[0]=l[0].add(i[0]),r=ma(r.add(a).add(i[0]).add(dr(e,u+8)),37).mul(h),a=ma(a.add(i[1]).add(dr(e,u+48)),42).mul(h),r=r.xor(l[1].mul(9)),a=a.add(i[0].mul(9).add(dr(e,u+40))),s=ma(s.add(l[0]),33).mul(h),i=vv(e,u,i[1].mul(h),r.add(l[0])),l=vv(e,u+32,s.add(l[1]),a.add(dr(e,u+16))),[s,r]=[r,s],Eu(Eu(i[0],l[0],h).add(U2(a).mul(lW)).add(s),Eu(i[1],l[1],h).add(r),h)}function dme(e,t){return t==="string"?xb(e):v1([e],t)}function hme(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function v1(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=Ou(e)),be().getBool("DEBUG")&&YB(e,t),hme(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){let n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function cy(){return be().platform.now()}function pme(e,t){return be().platform.fetch(e,t)}function xb(e,t="utf-8"){return t=t||"utf-8",be().platform.encode(e,t)}function a0(e,t="utf-8"){return t=t||"utf-8",be().platform.decode(e,t)}function fa(e){return be().platform.isTypedArray!=null?be().platform.isTypedArray(e):oW(e)}function Ou(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||i1(e)||e==null||fa(e)&&n)t.push(e);else if(Array.isArray(e)||fa(e))for(let r=0;r<e.length;++r)Ou(e[r],t,n);else{let r=-1;for(let a of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)Ou(e[a],t,n)}return t}var mme=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new gme)}profileKernel(e,t,n){let r,a=()=>{r=n()},s,i=cy();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(a);else{a();for(let l of r)l.dataSync();s=Promise.resolve({kernelMs:cy()-i})}if(be().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){let u=r[l];u.data().then(d=>{fme(d,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then(l=>l.kernelMs),extraInfo:s.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:s}=e;n.forEach(i=>{Promise.all([i.data(),r,s]).then(l=>{this.logger.logKernelProfile(t,i,l[0],l[1],a,l[2])})})}};function fme(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){let a=e[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${n}'`),!0}return!1}var gme=class{logKernelProfile(e,t,n,r,a,s){let i=typeof r=="number"?Lx(`${r}ms`,9):r.error,l=Lx(e,25),u=t.rank,d=t.size,c=Lx(t.shape.toString(),14),h="";for(let p in a){let m=a[p];if(m!=null){let f=m.shape||t.shape,g=f.length;h+=`${p}: ${g}D ${g>0?f:""} `}}console.log(`%c${l}	%c${i}	%c${u}D ${c}	%c${d}	%c${h}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function xme(e,t,n){let r={},a={};for(let u=0;u<t.length;u++)r[t[u].id]=!0;for(let u=0;u<e.length;u++){let d=e[u],c=d.inputs;for(let h in c){let p=c[h],m=!1;for(let f=0;f<t.length;f++)if(r[p.id]){d.outputs.forEach(g=>r[g.id]=!0),m=!0,a[d.id]=!0;break}if(m)break}}let s={};s[n.id]=!0;let i={};for(let u=e.length-1;u>=0;u--){let d=e[u],c=d.inputs;for(let h=0;h<d.outputs.length;h++)if(s[d.outputs[h].id]){for(let p in c)s[c[p].id]=!0,i[d.id]=!0;break}}let l=[];for(let u=0;u<e.length;u++){let d=e[u];if(a[d.id]&&i[d.id]){let c={};for(let p in d.inputs){let m=d.inputs[p];r[m.id]&&(c[p]=m)}let h=Object.assign({},d);h.inputs=c,h.outputs=d.outputs,l.push(h)}}return l}function yme(e,t,n,r){for(let a=t.length-1;a>=0;a--){let s=t[a],i=[];if(s.outputs.forEach(u=>{let d=e[u.id];d!=null?i.push(d):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let l=s.gradient(i);for(let u in s.inputs){if(!(u in l))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(l)}.`);let d=n(()=>l[u]());if(d.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${d.dtype}'`);let c=s.inputs[u];if(!$l(d.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${u}' has shape '${d.shape}', which does not match the shape of the input '${c.shape}'`);if(e[c.id]==null)e[c.id]=d;else{let h=e[c.id];e[c.id]=r(h,d),h.dispose()}}}}var O$=20,ax=3,nS=7;function bme(e,t,n,r){let a=mf(t),s=vme(e,t,n,a),i=t.length,l=ew(e,t,n,a,s),u=["Tensor"];return r&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${i}`),u.push(`  shape: [${t}]`),u.push("  values:")),u.push(l.map(d=>"    "+d).join(`
`)),u.join(`
`)}function vme(e,t,n,r){let a=Xn(t),s=r[r.length-1],i=new Array(s).fill(0),l=t.length,u=n==="complex64"?yx(e):e;if(l>1)for(let d=0;d<a/s;d++){let c=d*s;for(let h=0;h<s;h++)i[h]=Math.max(i[h],xx(u[c+h],0,n).length)}return i}function xx(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(nS))} + ${parseFloat(e[1].toFixed(nS))}j`:wu(e)?r=`'${e}'`:n==="bool"?r=cW(e):r=parseFloat(e.toFixed(nS)).toString(),Lx(r,t)}function cW(e){return e===0?"false":"true"}function ew(e,t,n,r,a,s=!0){let i=n==="complex64"?2:1,l=t[0],u=t.length;if(u===0){if(n==="complex64"){let g=yx(e);return[xx(g[0],0,n)]}return n==="bool"?[cW(e[0])]:[e[0].toString()]}if(u===1){if(l>O$){let g=ax*i,x=Array.from(e.slice(0,g)),y=Array.from(e.slice((l-ax)*i,l*i));return n==="complex64"&&(x=yx(x),y=yx(y)),["["+x.map((b,v)=>xx(b,a[v],n)).join(", ")+", ..., "+y.map((b,v)=>xx(b,a[l-ax+v],n)).join(", ")+"]"]}return["["+(n==="complex64"?yx(e):Array.from(e)).map((g,x)=>xx(g,a[x],n)).join(", ")+"]"]}let d=t.slice(1),c=r.slice(1),h=r[0]*i,p=[];if(l>O$){for(let g=0;g<ax;g++){let x=g*h,y=x+h;p.push(...ew(e.slice(x,y),d,n,c,a,!1))}p.push("...");for(let g=l-ax;g<l;g++){let x=g*h,y=x+h;p.push(...ew(e.slice(x,y),d,n,c,a,g===l-1))}}else for(let g=0;g<l;g++){let x=g*h,y=x+h;p.push(...ew(e.slice(x,y),d,n,c,a,g===l-1))}let m=u===2?",":"";p[0]="["+(l>0?p[0]+m:"");for(let g=1;g<p.length-1;g++)p[g]=" "+p[g]+m;let f=`,
`;for(let g=2;g<u;g++)f+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(s?"":f),p}function yx(e){let t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Wr=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=Xn(e),n!=null){let r=n.length;H(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||WI(t,this.size),this.strides=mf(e)}set(e,...t){t.length===0&&(t=[0]),H(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let r of e){if(r<0||r>=this.shape[t]){let a=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(a)}t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return qi().makeTensor(this.values,this.shape,this.dtype)}},qi=null,Wp=null;function wme(e){qi=e}function Nme(e){Wp=e}var Zt=class{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Xn(e),this.strides=mf(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Wp.buffer(this.shape,this.dtype,e)}bufferSync(){return Wp.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return im(this.shape,e,this.dtype==="complex64")}arraySync(){return im(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=qi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>a0(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),qi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=qi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>a0(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await qi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),qi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Wp.print(this,e)}clone(){return this.throwIfDisposed(),Wp.clone(this)}toString(e=!1){let t=this.dataSync();return bme(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Wp.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),qi().makeVariable(this,e,t,n)}};Object.defineProperty(Zt,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function Pe(){return HI("Tensor",()=>Zt)}Pe();var Ed=class extends Zt{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!$l(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);qi().disposeTensor(this),this.dataId=e.dataId,qi().incRef(this,null)}dispose(){qi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Ed,Symbol.hasInstance,{value:e=>e instanceof Zt&&e.assign!=null&&e.assign instanceof Function});var Qi={};Kt(Qi,{assertTypesMatch:()=>pW,getTensorsInContainer:()=>qI,isTensorInList:()=>Sme,makeTypesMatch:()=>Cr});var H2;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(H2||(H2={}));var G2;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(G2||(G2={}));var q2;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(q2||(q2={}));var K2;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(K2||(K2={}));var Y2;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(Y2||(Y2={}));var kme={float32:K2,int32:G2,bool:q2,complex64:Y2};function ni(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return kme[e][t]}function w1(e){return ni(e,"int32")}function dW(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function hW(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Cr(e,t){if(e.dtype===t.dtype)return[e,t];let n=ni(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function pW(e,t){H(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function Sme(e,t){return t.some(n=>n.id===e.id)}function qI(e){let t=[];return mW(e,t,new Set),t}function mW(e,t,n){if(e==null)return;if(e instanceof Zt){t.push(e);return}if(!Cme(e))return;let r=e;for(let a in r){let s=r[a];n.has(s)||(n.add(s),mW(s,t,n))}}function Cme(e){return Array.isArray(e)||typeof e=="object"}function rS(e){return e.kernelName!=null}var L$=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},KI=class X2{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new L$}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){let{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(uu(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;let{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new mme(this.backendInstance),!0}setupRegisteredKernels(){r0(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){r0(t).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[t])})}initializeBackend(t){let n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{let r=n.factory();if(r&&!(r instanceof Gy)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,s=r.then(i=>a<this.pendingBackendInitId?!1:(this.registry[t]=i,this.pendingBackendInit=null,!0)).catch(i=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,uu(`Initialization of backend ${t} failed`),uu(i.stack||i.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return uu(`Initialization of backend ${t} failed`),uu(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n],{success:a,asyncInit:s}=this.initializeBackend(r);if(s||a)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){let r=this.state.tensorInfo.get(n),a=r.backend,s=this.readSync(n),i=a.refCount(n);a.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=n(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(t,n,r){t();try{let a=r();return n(),a}catch(a){throw n(),a}}nextTensorId(){return X2.nextTensorId++}nextVariableId(){return X2.nextVariableId++}clone(t){let n=te.runKernel(Nh,{x:t}),r={x:t},a=i=>({x:()=>{let l="float32",u={x:i},d={dtype:l};return te.runKernel(rh,u,d)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],a,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,uy(t,this.backendName)==null)throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){let a=this.backend.numDataIds(),s=0;r.forEach(u=>{s+=u.dtype==="complex64"?3:1});let i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=a-n-s-i;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[],a=this.isTapeOn(),s=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let u,d=rS(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(rS(t)){let{kernelName:f,inputs:g,attrs:x}=t;this.backendName==null&&this.backend;let y=uy(f,this.backendName);H(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),l=()=>{let b=this.backend.numDataIds();u=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});let v=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,b,v);let w=v.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(a){let N=this.getTensorsForGradient(f,g,w);r=this.saveTensorsForBackwardMode(N)}return w}}else{let{forwardFunc:f}=t,g=x=>{a&&(r=x.map(y=>this.keep(this.clone(y))))};l=()=>{let x=this.backend.numDataIds();u=this.tidy(()=>f(this.backend,g));let y=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,x,y),y}}let{inputs:c,attrs:h}=t,p=rS(t)?null:t.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=l():(m=this.profiler.profileKernel(d,c,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),a&&this.addTapeNode(d,c,n,p,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(f=>c[f]!=null?c[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(u)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(t,n,r){let a=V2(t);if(a!=null){let s=a.inputsToSave||[],i=a.outputsToSave||[],l;a.saveAllInputs?(H(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(n).map(d=>n[d])):l=s.map(d=>n[d]);let u=r.filter((d,c)=>i[c]);return l.concat(u)}return[]}makeTensor(t,n,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let s=t;r==="string"&&wu(t[0])&&(s=t.map(u=>xb(u)));let i=a.write(s,n,r),l=new Zt(n,r,i,this.nextTensorId());if(this.trackTensor(l,a),r==="string"){let u=this.state.tensorInfo.get(i),d=ZB(s);this.state.numBytes+=d-u.bytes,u.bytes=d}return l}makeTensorFromDataId(t,n,r,a){r=r||"float32";let s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,a)}makeTensorFromTensorInfo(t,n){let{dataId:r,shape:a,dtype:s}=t,i=new Zt(a,s,r,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(t,n=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.cast(a));let s=new Ed(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*e0(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof Ed||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;let n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){let r=t.size*e0(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(let t in this.state.registeredVariables){let n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){let t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;let n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,a,s,i){let l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},u=V2(t);u!=null&&(a=u.gradFunc),a!=null&&(l.gradient=d=>(d=d.map((c,h)=>{if(c==null){let p=r[h],m=s1(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return c}),a(d.length>1?d:d[0],s,i))),this.state.activeTape.push(l)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){let n=qI(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let i=this.state.activeScope.track[s];!i.kept&&!r.has(i.id)&&i.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===a.id&&this.track(s)})}gradients(t,n,r,a=!1){if(H(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));H(s instanceof Zt,()=>"The result y returned by f() must be a tensor.");let i=xme(this.state.activeTape,n,s);if(!a&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=r??_me(s.shape),yme(l,i,d=>this.tidy(d),Ime);let u=n.map(d=>l[d.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(d=>{for(let c of d.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:u}})}customGrad(t){return H(Pu(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{H(n.every(l=>l instanceof Zt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};n.forEach((l,u)=>{a[u]=l});let s=(l,u)=>(r=t(...n,u),H(r.value instanceof Zt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),H(Pu(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),i=(l,u)=>{let d=r.gradFunc(l,u),c=Array.isArray(d)?d:[d];H(c.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),H(c.every(p=>p instanceof Zt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let h={};return c.forEach((p,m)=>{h[m]=()=>p}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:i,inputs:a})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){let n=cy(),r=await this.backend.time(t);return r.wallMs=cy()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new L$;for(let t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};KI.nextTensorId=0;KI.nextVariableId=0;function _me(e){let t=VI(Xn(e),"float32");return te.makeTensor(t,e,"float32")}function fW(){let e=nW();if(e._tfengine==null){let t=new tW(e);e._tfengine=new KI(t)}return Xpe(e._tfengine.ENV),wme(()=>e._tfengine),e._tfengine}var te=fW();function Ime(e,t){let n={a:e,b:t};return te.runKernel(ac,n)}var yb={};Kt(yb,{isBrowser:()=>gW,isMobile:()=>jme,mockIsMobile:()=>Eme});function Tme(){return typeof navigator<"u"&&navigator!=null}var Z2;function Eme(e){Z2=e}function jme(e){if(Z2!==void 0)return Z2;if(e||Tme()){if(e||(e=navigator),e.product==="ReactNative")return!0;let t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){let n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function gW(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var gs=be();gs.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});gs.registerFlag("IS_BROWSER",()=>gW());gs.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");gs.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));gs.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));gs.registerFlag("PROD",()=>!1);gs.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>gs.getBool("DEBUG"));gs.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);gs.registerFlag("IS_TEST",()=>!1);gs.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>gs.getBool("DEBUG"));gs.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);gs.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);gs.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function Vo(e,t){let n=e;if(fa(e))return t==="string"?[]:[e.length];if(dW(e)){let a=e.channels||"RGBA";return[e.height,e.width*a.length]}else if(hW(e))return[e.buffer.size/(t==null?4:e0(t))];if(!Array.isArray(e))return[];let r=[];for(;Array.isArray(n)||fa(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&be().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&xW(e,r,[]),r}function xW(e,t,n){if(n=n||[],!Array.isArray(e)&&!fa(e)){H(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}H(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),H(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);let r=t.slice(1);for(let a=0;a<e.length;++a)xW(e[a],r,n.concat(a))}function z$(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function B(e,t,n,r="numeric"){if(e instanceof Pe())return z$(r,e.dtype,t,n),e;let a=qy(e);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),z$(r,a,t,n),e==null||!fa(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){let l=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}let s=Vo(e,a);!fa(e)&&!Array.isArray(e)&&(e=[e]);let i=a!=="string"?v1(e,a):Ou(e,[],!0);return te.makeTensor(i,s,a)}function dy(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((a,s)=>B(a,`${t}[${s}]`,n,r))}var YI="__op";function ne(e){let t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+YI;let a=(...s)=>{te.startScope(n);try{let i=r(...s);return i1(i)&&console.error("Cannot return a Promise inside of tidy."),te.endScope(i),i}catch(i){throw te.endScope(null),i}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}function Ame(e,t){let n=B(e,"real","complex"),r=B(t,"imag","complex");Qa(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:n,imag:r};return te.runKernel(o1,a)}var El=ne({complex_:Ame});function lc(e,t,n,r){if(r==null)r=qy(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(hW(e)||dW(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return te.backend.createTensorFromGPUData(e,t||n,r)}if(!fa(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){zs(t);let a=Xn(t),s=Xn(n);H(a===s,()=>`Based on the provided shape, [${t}], the tensor should have ${a} values but has ${s}`);for(let i=0;i<n.length;++i){let l=n[i],u=i===n.length-1?l!==Xn(t.slice(i)):!0;H(n[i]===t[i]||!u,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!fa(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?v1(e,r):Ou(e,[],!0),te.makeTensor(e,t,r)}function Ka(e,t,n){let r=Vo(e,n);return lc(e,t,r,n)}var jd={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Fl=class yW{static join(t){return new yW(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>fa(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){let a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let s=n+a.byteLength;this.shards.push({buffer:a,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);let r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);let a=n-t,s=new ArrayBuffer(a),i=new Uint8Array(s),l=0;for(let u=r;u<this.shards.length;u++){let d=this.shards[u],c=t+l-d.start,h=l,p=Math.min(n,d.end)-d.start,m=new Uint8Array(d.buffer,c,p-c);if(i.set(m,h),l+=m.length,n<d.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(a){return t<a.start?-1:t>=a.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let r=Rme(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}};function Rme(e,t){let n=0,r=e.length;for(;n<=r;){let a=Math.floor((r-n)/2)+n,s=t(e[a]);if(s===0)return a;s<0?r=a:n=a+1}return-1}function Dme(){be().set("PROD",!0)}function Mme(){be().set("DEBUG",!0)}function $me(){be().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function bW(e){be().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Fme(){te.disposeVariables()}function hi(){return te}function Q2(){return te.memory()}function Pme(e){return te.profile(e)}function ce(e,t){return te.tidy(e,t)}function qt(e){qI(e).forEach(t=>t.dispose())}function Zr(e){return te.keep(e)}function Ome(e){return te.time(e)}function Lme(e){return te.setBackend(e)}function zme(){return te.ready()}function vW(){return te.backendName}function Bme(e){te.removeBackend(e)}function Wme(e){return te.findBackend(e)}function Vme(e){return te.findBackendFactory(e)}function N1(e,t,n=1){return te.registerBackend(e,t,n)}function XI(){return te.backend}function Ume(e,t){be().setPlatform(e,t)}var Lu=4;async function Hme(e,t){let n=[],r=[],a=Array.isArray(e)?e.map(i=>i.name):Object.keys(e);for(let i=0;i<a.length;++i){let l=a[i],u=Array.isArray(e)?e[i].tensor:e[l];if(u.dtype!=="float32"&&u.dtype!=="int32"&&u.dtype!=="bool"&&u.dtype!=="string"&&u.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${u.dtype}`);let d={name:l,shape:u.shape,dtype:u.dtype};if(u.dtype==="string"){let c=new Promise(async h=>{let p=await u.bytes(),m=p.reduce((x,y)=>x+y.length,0)+Lu*p.length,f=new Uint8Array(m),g=0;for(let x=0;x<p.length;x++){let y=p[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(b,g),g+=Lu,f.set(y,g),g+=y.length}h(f)});r.push(c)}else r.push(u.data());t!=null&&(d.group=t),n.push(d)}let s=await Promise.all(r);return{data:Kme(s),specs:n}}function wW(e,t){let n=new Fl(e),r={},a=0;for(let s of t){let i=Gme(s,(l,u)=>n.slice(a+l,a+u));r[s.name]=NW(s,n.slice(a,a+i)),a+=i}return r}function Gme(e,t){let n=Xn(e.shape),r;if("quantization"in e){let a=e.quantization;r=jd[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=Lu+new Uint32Array(t(a,a+Lu))[0];return a}else r=jd[e.dtype];return n*r}async function qme(e,t){let n=Xn(e.shape),r;if("quantization"in e){let a=e.quantization;r=jd[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=Lu+new Uint32Array(await t(a,a+Lu))[0];return a}else r=jd[e.dtype];return n*r}function NW(e,t){let n=e.name,r=e.dtype,a=e.shape,s=Xn(a),i,l=0;if("quantization"in e){let u=e.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error(`Weight ${e.name} with quantization ${u.dtype} doesn't have corresponding metadata min and scale.`)}else if(u.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${e.name} is quantized with ${u.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${e.name} has unknown quantization dtype ${u.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let d=jd[u.dtype],c=u.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(r==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){i=new Float32Array(c.length);for(let h=0;h<c.length;h++){let p=c[h];i[h]=p*u.scale+u.min}}else if(u.dtype==="float16")i=tfe()(c);else throw new Error(`Unsupported quantization type ${u.dtype} for weight type float32.`);else if(r==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error(`Unsupported quantization type ${u.dtype} for weight type int32.`);i=new Int32Array(c.length);for(let h=0;h<c.length;h++){let p=c[h];i[h]=Math.round(p*u.scale+u.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);l+=s*d}else if(r==="string"){let u=Xn(e.shape);i=[];for(let d=0;d<u;d++){let c=new Uint32Array(t.slice(l,l+Lu))[0];l+=Lu;let h=new Uint8Array(t.slice(l,l+c));i.push(h),l+=c}}else{let u=jd[r];if(r==="float32")i=new Float32Array(t);else if(r==="int32")i=new Int32Array(t);else if(r==="bool")i=new Uint8Array(t);else if(r==="complex64"){i=new Float32Array(t);let d=new Float32Array(i.length/2),c=new Float32Array(i.length/2);for(let f=0;f<d.length;f++)d[f]=i[f*2],c[f]=i[f*2+1];let h=Ka(d,a,"float32"),p=Ka(c,a,"float32"),m=El(h,p);return h.dispose(),p.dispose(),m}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);l+=s*u}return Ka(i,a,r)}async function B$(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){let{done:a,value:s}=await e.read();if(a&&s==null){let l=n-r.byteLength;throw new Error(`Reader is done but ${l} bytes are still expected`)}let i=new Uint8Array(r.length+s.byteLength);i.set(r,0),i.set(new Uint8Array(s),r.length),r=i}return r.buffer}async function kW(e,t){let n={},r=e.getReader(),a=new ArrayBuffer(0);for(let s of t){let i=await qme(s,async(d,c)=>(a=await B$(r,a,c),a.slice(d,c)));a=await B$(r,a,i);let l=a.slice(0,i);a=a.slice(i);let u=NW(s,l);if(n[s.name]=u,vW()==="webgpu"){let d=XI();"uploadToGPU"in d&&Xn(u.shape)>=be().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&d.uploadToGPU(u.dataId)}}return n}function Kme(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let r=new Uint8Array(t),a=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),a),a+=s.byteLength}),r.buffer}var ZI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function W$(e){return ZI?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function Yme(e){if(ZI)return Buffer.from(e).toString("base64");let t=new Uint8Array(e),n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Xme(e){if(ZI){let r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function Zme(e){return Fl.join(e)}function V$(e){let t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);let n=e.split(t);return n[n.length-1]}function SW(e,t){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function CW(e,t,n){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function QI(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),CW(e,n,r)}function bb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:W$(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:W$(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new Fl(e.weightData).byteLength}}function J2(e){let t=[];for(let n of e)t.push(...n.weights);return t}function Qme(){let e=n=>{let r=n<<13,a=0;for(;!(r&8388608);)a-=8388608,r<<=1;return r&=-8388609,a+=947912704,r|a},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function Jme(){let e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function efe(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function tfe(){let e=Qme(),t=Jme(),n=efe();return r=>{let a=new ArrayBuffer(4*r.length),s=new Uint32Array(a);for(let i=0;i<r.length;i++){let l=r[i],u=e[n[l>>10]+(l&1023)]+t[l>>10];s[i]=u}return new Float32Array(a)}}var ri=class zi{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return zi.instance==null&&(zi.instance=new zi),zi.instance}static registerSaveRouter(t){zi.getInstance().saveRouters.push(t)}static registerLoadRouter(t){zi.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return zi.getHandlers(t,"save")}static getLoadHandlers(t,n){return zi.getHandlers(t,"load",n)}static getHandlers(t,n,r){let a=[];return(n==="load"?zi.getInstance().loadRouters:zi.getInstance().saveRouters).forEach(s=>{let i=s(t,r);i!==null&&a.push(i)}),a}},nfe=e=>ri.registerSaveRouter(e),rfe=e=>ri.registerLoadRouter(e),afe=e=>ri.getSaveHandlers(e),sfe=(e,t)=>ri.getLoadHandlers(e,t),eC="tensorflowjs",tC=1,Uc="models_store",Nu="model_info_store";function _W(){if(!be().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function nC(e){let t=e.result;t.createObjectStore(Uc,{keyPath:"modelPath"}),t.createObjectStore(Nu,{keyPath:"modelPath"})}var Ad=class{constructor(e){if(this.indexedDB=_W(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,r)=>{let a=this.indexedDB.open(eC,tC);a.onupgradeneeded=()=>nC(a),a.onsuccess=()=>{let s=a.result;if(t==null){let i=s.transaction(Uc,"readonly"),l=i.objectStore(Uc).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return s.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(l.result.modelArtifacts)},l.onerror=u=>(s.close(),r(l.error)),i.oncomplete=()=>s.close()}else{t.weightData=Fl.join(t.weightData);let i=bb(t),l=s.transaction(Nu,"readwrite"),u=l.objectStore(Nu),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:i})}catch(h){return r(h)}let c;d.onsuccess=()=>{c=s.transaction(Uc,"readwrite");let h=c.objectStore(Uc),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:i})}catch(m){return r(m)}p.onsuccess=()=>n({modelArtifactsInfo:i}),p.onerror=m=>{u=l.objectStore(Nu);let f=u.delete(this.modelPath);f.onsuccess=()=>(s.close(),r(p.error)),f.onerror=g=>(s.close(),r(p.error))}},d.onerror=h=>(s.close(),r(d.error)),l.oncomplete=()=>{c==null?s.close():c.oncomplete=()=>s.close()}}},a.onerror=s=>r(a.error)})}};Ad.URL_SCHEME="indexeddb://";var IW=e=>be().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Ad.URL_SCHEME)?ife(e.slice(Ad.URL_SCHEME.length)):null;ri.registerSaveRouter(IW);ri.registerLoadRouter(IW);function ife(e){return new Ad(e)}function ofe(e){return e.startsWith(Ad.URL_SCHEME)?e.slice(Ad.URL_SCHEME.length):e}var lfe=class{constructor(){this.indexedDB=_W()}async listModels(){return new Promise((e,t)=>{let n=this.indexedDB.open(eC,tC);n.onupgradeneeded=()=>nC(n),n.onsuccess=()=>{let r=n.result,a=r.transaction(Nu,"readonly"),s=a.objectStore(Nu).getAll();s.onsuccess=()=>{let i={};for(let l of s.result)i[l.modelPath]=l.modelArtifactsInfo;e(i)},s.onerror=i=>(r.close(),t(s.error)),a.oncomplete=()=>r.close()},n.onerror=r=>t(n.error)})}async removeModel(e){return e=ofe(e),new Promise((t,n)=>{let r=this.indexedDB.open(eC,tC);r.onupgradeneeded=()=>nC(r),r.onsuccess=()=>{let a=r.result,s=a.transaction(Nu,"readwrite"),i=s.objectStore(Nu),l=i.get(e),u;l.onsuccess=()=>{if(l.result==null)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let d=i.delete(e),c=()=>{u=a.transaction(Uc,"readwrite");let h=u.objectStore(Uc).delete(e);h.onsuccess=()=>t(l.result.modelArtifactsInfo),h.onerror=p=>n(l.error)};d.onsuccess=c,d.onerror=h=>(c(),a.close(),n(l.error))}},l.onerror=d=>(a.close(),n(l.error)),s.oncomplete=()=>{u==null?a.close():u.oncomplete=()=>a.close()}},r.onerror=a=>n(r.error)})}},xl="/",Vp="tensorflowjs_models",TW="info",ufe="model_topology",cfe="weight_specs",dfe="weight_data",hfe="model_metadata";function EW(e){return{info:[Vp,e,TW].join(xl),topology:[Vp,e,ufe].join(xl),weightSpecs:[Vp,e,cfe].join(xl),weightData:[Vp,e,dfe].join(xl),modelMetadata:[Vp,e,hfe].join(xl)}}function jW(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function pfe(e){let t=e.split(xl);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(xl)}function mfe(e){return e.startsWith(Rd.URL_SCHEME)?e.slice(Rd.URL_SCHEME.length):e}var Rd=class{constructor(e){if(!be().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=EW(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=bb(e),a=Fl.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Yme(a));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch{throw jW(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;let a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){let i=JSON.parse(a);t.format=i.format,t.generatedBy=i.generatedBy,t.convertedBy=i.convertedBy,i.signature!=null&&(t.signature=i.signature),i.userDefinedMetadata!=null&&(t.userDefinedMetadata=i.userDefinedMetadata),i.modelInitializer!=null&&(t.modelInitializer=i.modelInitializer),i.initializerSignature!=null&&(t.initializerSignature=i.initializerSignature),i.trainingConfig!=null&&(t.trainingConfig=i.trainingConfig)}let s=this.LS.getItem(this.keys.weightData);if(s==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Xme(s),t}};Rd.URL_SCHEME="localstorage://";var AW=e=>be().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Rd.URL_SCHEME)?ffe(e.slice(Rd.URL_SCHEME.length)):null;ri.registerSaveRouter(AW);ri.registerLoadRouter(AW);function ffe(e){return new Rd(e)}var gfe=class{constructor(){H(be().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),H(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},t=Vp+xl,n=xl+TW;for(let r=0;r<this.LS.length;++r){let a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){let s=pfe(a);e[s]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){e=mfe(e);let t=EW(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return jW(t),n}},om="://",zu=class eu{constructor(){this.managers={}}static getInstance(){return eu.instance==null&&(eu.instance=new eu),eu.instance}static registerManager(t,n){H(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(om)&&(t=t.slice(0,t.indexOf(om))),H(t.length>0,()=>"scheme must not be an empty string.");let r=eu.getInstance();H(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){let n=eu.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(eu.getInstance().managers)}};function tw(e){if(e.indexOf(om)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${zu.getSchemes().join(",")}`);return{scheme:e.split(om)[0],path:e.split(om)[1]}}async function RW(e,t,n=!1){H(e!==t,()=>`Old path and new path are the same: '${e}'`);let r=ri.getLoadHandlers(e);H(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),H(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);let a=r[0],s=ri.getSaveHandlers(t);H(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),H(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);let i=s[0],l=tw(e).scheme,u=tw(e).path,d=l===tw(e).scheme,c=await a.load();n&&d&&await zu.getManager(l).removeModel(u);let h=await i.save(c);return n&&!d&&await zu.getManager(l).removeModel(u),h.modelArtifactsInfo}async function xfe(){let e=zu.getSchemes(),t={};for(let n of e){let r=await zu.getManager(n).listModels();for(let a in r){let s=n+om+a;t[s]=r[a]}}return t}async function yfe(e){let t=tw(e);return zu.getManager(t.scheme).removeModel(t.path)}async function bfe(e,t){return RW(e,t,!1)}async function vfe(e,t){return RW(e,t,!0)}var wfe=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!be().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let r=this.functionRefs[n.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return oW(e)}};if(be().get("IS_BROWSER")){be().setPlatform("browser",new wfe);try{zu.registerManager(Rd.URL_SCHEME,new gfe)}catch{}try{zu.registerManager(Ad.URL_SCHEME,new lfe)}catch{}}var Nfe={importFetch:()=>fpe()},aS,kfe=class{constructor(){this.util=gpe(),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return be().global.fetch!=null?be().global.fetch(e,t):(aS==null&&(aS=Nfe.importFetch()),aS(e,t))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}};be().get("IS_NODE")&&!be().get("IS_BROWSER")&&be().setPlatform("node",new kfe);function nn(e,t="float32",n){return t=t||"float32",zs(e),new Wr(e,t,n)}function Sfe(e,t){let n=B(e,"x","cast");if(!XB(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:n},a={dtype:t};return te.runKernel(rh,r,a)}var Xe=ne({cast_:Sfe});function Cfe(e){let t={x:B(e,"x","clone","string_or_numeric")};return te.runKernel(Nh,t)}var Oo=ne({clone_:Cfe});function JI(e,t=!1){console.log(e.toString(t))}fW();var _fe={buffer:nn,cast:Xe,clone:Oo,print:JI};Nme(_fe);function Ife(e,t){let n=B(e,"a","add"),r=B(t,"b","add");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(ac,a)}var $e=ne({add_:Ife});function Tfe(e,t){let n=B(e,"a","floorDiv"),r=B(t,"b","floorDiv");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(bh,a)}var k1=ne({floorDiv_:Tfe});function Efe(e,t){let n=B(e,"a","div"),r=B(t,"b","div");if([n,r]=Cr(n,r),n.dtype==="int32"&&r.dtype==="int32")return k1(n,r);let a={a:n,b:r},s={};return te.runKernel(ph,a,s)}var ft=ne({div_:Efe});function jfe(e,t){let n=B(e,"a","mul"),r=B(t,"b","mul");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(Oh,a)}var re=ne({mul_:jfe});function Afe(e){let t=B(e,"x","abs");if(t.dtype==="complex64"){let n={x:t};return te.runKernel(Zy,n)}else{let n={x:t};return te.runKernel(ff,n)}}var zr=ne({abs_:Afe});function Rfe(e){let t={x:B(e,"x","acos")};return te.runKernel(qd,t)}var eT=ne({acos_:Rfe});function Dfe(e){let t={x:B(e,"x","acosh")};return te.runKernel(Kd,t)}var tT=ne({acosh_:Dfe});function Mfe(e){H(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),H(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);let t=e.map((a,s)=>B(a,`tensors${s}`,"addN")),n=t[0];t.forEach(a=>{if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(a=>{if(!$l(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let r=t;return te.runKernel(Yd,r)}var DW=ne({addN_:Mfe});function $fe(e,t=null,n=!1){let r={x:B(e,"x","all","bool")},a={axis:t,keepDims:n};return te.runKernel(gf,r,a)}var S1=ne({all_:$fe});function Ffe(e,t=null,n=!1){let r={x:B(e,"x","any","bool")},a={axis:t,keepDims:n};return te.runKernel(xf,r,a)}var hy=ne({any_:Ffe});function Pfe(e,t=0){let n={x:B(e,"x","argMax")},r={axis:t};return te.runKernel(yf,n,r)}var Dd=ne({argMax_:Pfe});function Ofe(e,t=0){let n={x:B(e,"x","argMin")},r={axis:t};return te.runKernel(bf,n,r)}var nT=ne({argMin_:Ofe});function Lfe(e){let t={x:B(e,"x","asin")};return te.runKernel(Xd,t)}var rT=ne({asin_:Lfe});function zfe(e){let t={x:B(e,"x","asinh")};return te.runKernel(Zd,t)}var aT=ne({asinh_:zfe});function Bfe(e){let t={x:B(e,"x","atan")};return te.runKernel(Qd,t)}var sT=ne({atan_:Bfe});function Wfe(e,t){let n=B(e,"a","atan2"),r=B(t,"b","atan2");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(eh,a)}var iT=ne({atan2_:Wfe});function Vfe(e){let t={x:B(e,"x","atanh")};return te.runKernel(Jd,t)}var oT=ne({atanh_:Vfe});function Ufe(e,t,n,r,a="NHWC",s){let i=e[3],l=[...t,i],u=FW(a);return vb(e,l,n,s,r,null,null,u)}function MW(e,t,n,r,a,s,i="channelsLast"){let[l,u]=py(t),d;if(i==="channelsLast")d=[l,u,e[3],e[3]];else if(i==="channelsFirst")d=[l,u,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return vb(e,d,n,r,a,s,!1,i)}function Hfe(e,t,n,r,a,s,i="NDHWC"){let[l,u,d]=rC(t),c,h;if(i==="NDHWC")h="channelsLast",c=[l,u,d,e[4],e[4]];else if(i==="NCDHW")h="channelsFirst",c=[l,u,d,e[1],e[1]];else throw new Error(`Unknown dataFormat ${i}`);return $W(e,c,n,r,a,!1,h,s)}function vb(e,t,n,r,a,s,i=!1,l="channelsLast"){let[u,d,c,h]=[-1,-1,-1,-1];if(l==="channelsLast")[u,d,c,h]=e;else if(l==="channelsFirst")[u,h,d,c]=e;else throw new Error(`Unknown dataFormat ${l}`);let[p,m,,f]=t,[g,x]=py(n),[y,b]=py(r),v=lm(p,y),w=lm(m,b),{padInfo:N,outHeight:S,outWidth:C}=Kfe(a,d,c,g,x,v,w,s,l),_=i?f*h:f,T;return l==="channelsFirst"?T=[u,_,S,C]:l==="channelsLast"&&(T=[u,S,C,_]),{batchSize:u,dataFormat:l,inHeight:d,inWidth:c,inChannels:h,outHeight:S,outWidth:C,outChannels:_,padInfo:N,strideHeight:g,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:e,outShape:T,filterShape:t}}function $W(e,t,n,r,a,s=!1,i="channelsLast",l){let[u,d,c,h,p]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[u,d,c,h,p]=e;else if(i==="channelsFirst")[u,p,d,c,h]=e;else throw new Error(`Unknown dataFormat ${i}`);let[m,f,g,,x]=t,[y,b,v]=rC(n),[w,N,S]=rC(r),C=lm(m,w),_=lm(f,N),T=lm(g,S),{padInfo:E,outDepth:j,outHeight:I,outWidth:D}=Yfe(a,d,c,h,y,b,v,C,_,T,l),F=s?x*p:x,P;return i==="channelsFirst"?P=[u,F,j,I,D]:i==="channelsLast"&&(P=[u,j,I,D,F]),{batchSize:u,dataFormat:i,inDepth:d,inHeight:c,inWidth:h,inChannels:p,outDepth:j,outHeight:I,outWidth:D,outChannels:F,padInfo:E,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:m,filterHeight:f,filterWidth:g,effectiveFilterDepth:C,effectiveFilterHeight:_,effectiveFilterWidth:T,dilationDepth:w,dilationHeight:N,dilationWidth:S,inShape:e,outShape:P,filterShape:t}}function Gfe(e,t,n,r,a){r==null&&(r=lT(e,t,n));let s=e[0],i=e[1],l=my((s-t+2*r)/n+1,a),u=my((i-t+2*r)/n+1,a);return[l,u]}function qfe(e,t,n,r,a,s){a==null&&(a=lT(e,t[0],r[0]));let i=[0,0,0,n];for(let l=0;l<3;l++)e[l]+2*a>=t[l]&&(i[l]=my((e[l]-t[l]+2*a)/r[l]+1,s));return i}function lT(e,t,n,r=1){let a=lm(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function py(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function rC(e){return typeof e=="number"?[e,e,e]:e}function lm(e,t){return t<=1?e:e+(e-1)*(t-1)}function Kfe(e,t,n,r,a,s,i,l,u){let d,c,h;if(typeof e=="number"){d={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};let p=Gfe([t,n],s,r,e,l);c=p[0],h=p[1]}else if(e==="same"){c=Math.ceil(t/r),h=Math.ceil(n/a);let p=Math.max(0,(c-1)*r+s-t),m=Math.max(0,(h-1)*a+i-n),f=Math.floor(p/2),g=p-f,x=Math.floor(m/2),y=m-x;d={top:f,bottom:g,left:x,right:y,type:"SAME"}}else if(e==="valid")d={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-s+1)/r),h=Math.ceil((n-i+1)/a);else if(typeof e=="object"){let p=u==="channelsLast"?e[1][0]:e[2][0],m=u==="channelsLast"?e[1][1]:e[2][1],f=u==="channelsLast"?e[2][0]:e[3][0],g=u==="channelsLast"?e[2][1]:e[3][1];d={top:p,bottom:m,left:f,right:g,type:p===0&&m===0&&f===0&&g===0?"VALID":"EXPLICIT"},c=my((t-s+p+m)/r+1,l),h=my((n-i+f+g)/a+1,l)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:d,outHeight:c,outWidth:h}}function Yfe(e,t,n,r,a,s,i,l,u,d,c){let h,p,m,f;if(e==="valid"&&(e=0),typeof e=="number"){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};let g=qfe([t,n,r,1],[l,u,d],1,[a,s,i],e,c);p=g[0],m=g[1],f=g[2]}else if(e==="same"){p=Math.ceil(t/a),m=Math.ceil(n/s),f=Math.ceil(r/i);let g=(p-1)*a+l-t,x=(m-1)*s+u-n,y=(f-1)*i+d-r,b=Math.floor(g/2),v=g-b,w=Math.floor(x/2),N=x-w,S=Math.floor(y/2),C=y-S;h={top:w,bottom:N,left:S,right:C,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outDepth:p,outHeight:m,outWidth:f}}function my(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function Bu(e){let[t,n,r]=py(e);return t===1&&n===1&&r===1}function Xo(e,t){return Bu(e)||Bu(t)}function Md(e){return py(e).every(t=>t>0)}function FW(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function Ja(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")H(Om(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(a=>{H(Om(a),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${a}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}function Xfe(e,t){let n={x:B(e,"x","reshape","string_or_numeric")},r={shape:t};return te.runKernel(Jf,n,r)}var ue=ne({reshape_:Xfe});function Zfe(e,t,n,r,a){let s=B(e,"x","avgPool","float32"),i=1;H(Xo(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let l=s,u=!1;s.rank===3&&(u=!0,l=ue(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),Ja("avgPool",r,a);let d={x:l},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},h=te.runKernel(th,d,c);return h=Xe(h,s.dtype),u?ue(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Pl=ne({avgPool_:Zfe});function Qfe(e,t,n,r,a,s="NDHWC"){let i=B(e,"x","avgPool3d","float32"),l=i,u=!1;i.rank===4&&(u=!0,l=ue(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),H(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),H(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ja("avgPool3d",r,a);let d={x:l},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},h=te.runKernel(vf,d,c);return h=Xe(h,l.dtype),u?ue(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var uT=ne({avgPool3d_:Qfe});function Jfe(e,t=0){H(e.length>=1,()=>"Pass at least one tensor to concat");let n=dy(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return Oo(n[0]);let r=n,a={axis:t};return te.runKernel(Sf,r,a)}var nr=ne({concat_:Jfe});function ege(e,t,n=!1,r=!1){let a=B(e,"a","matMul"),s=B(t,"b","matMul");[a,s]=Cr(a,s);let i={a,b:s},l={transposeA:n,transposeB:r};return te.runKernel(nh,i,l)}var en=ne({matMul_:ege});function tge(e){let t={x:B(e,"x","sigmoid","float32")};return te.runKernel(np,t)}var wi=ne({sigmoid_:tge});function nge(e,t,n){let r=B(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},s={begin:t,size:n};return te.runKernel(ig,a,s)}var pn=ne({slice_:nge});function rge(e){let t={x:B(e,"x","tanh","float32")};return te.runKernel(cp,t)}var Wu=ne({tanh_:rge});function age(e,t,n,r,a,s){let i=B(e,"forgetBias","basicLSTMCell"),l=B(t,"lstmKernel","basicLSTMCell"),u=B(n,"lstmBias","basicLSTMCell"),d=B(r,"data","basicLSTMCell"),c=B(a,"c","basicLSTMCell"),h=B(s,"h","basicLSTMCell"),p=nr([d,h],1),m=en(p,l),f=$e(m,u),g=f.shape[0],x=f.shape[1]/4,y=[g,x],b=pn(f,[0,0],y),v=pn(f,[0,x],y),w=pn(f,[0,x*2],y),N=pn(f,[0,x*3],y),S=$e(re(wi(b),Wu(v)),re(c,wi($e(i,w)))),C=re(Wu(S),wi(N));return[S,C]}var PW=ne({basicLSTMCell_:age});function sge(e,t,n){let r=B(e,"x","batchToSpaceND"),a=t.reduce((l,u)=>l*u);H(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),H(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),H(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`);let s={x:r},i={blockShape:t,crops:n};return te.runKernel(wf,s,i)}var wb=ne({batchToSpaceND_:sge});function ige(e){let t;return e.rank===0||e.rank===1?t=ue(e,[1,1,1,e.size]):e.rank===2?t=ue(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=ue(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}function oge(e,t,n,r,a,s){s==null&&(s=.001);let i=B(e,"x","batchNorm"),l=B(t,"mean","batchNorm"),u=B(n,"variance","batchNorm"),d;a!=null&&(d=B(a,"scale","batchNorm"));let c;r!=null&&(c=B(r,"offset","batchNorm")),H(l.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),H(c==null||l.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),H(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:ige(i),scale:d,offset:c,mean:l,variance:u},p={varianceEpsilon:s},m=te.runKernel(vh,h,p);return ue(m,i.shape)}var dp=ne({batchNorm_:oge});function lge(e,t,n,r,a,s){let i=B(e,"x","batchNorm"),l=B(t,"mean","batchNorm"),u=B(n,"variance","batchNorm"),d;a!=null&&(d=B(a,"scale","batchNorm"));let c;return r!=null&&(c=B(r,"offset","batchNorm")),H(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),H(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),H(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&H(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${d.rank}.`),c!=null&&H(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),dp(i,l,u,c,d,s)}var cT=ne({batchNorm2d_:lge});function uge(e,t,n,r,a,s){let i=B(e,"x","batchNorm"),l=B(t,"mean","batchNorm"),u=B(n,"variance","batchNorm"),d;a!=null&&(d=B(a,"scale","batchNorm"));let c;return r!=null&&(c=B(r,"offset","batchNorm")),H(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),H(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),H(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&H(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${d.rank}.`),c!=null&&H(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),dp(i,l,u,c,d,s)}var dT=ne({batchNorm3d_:uge});function cge(e,t,n,r,a,s){let i=B(e,"x","batchNorm"),l=B(t,"mean","batchNorm"),u=B(n,"variance","batchNorm"),d;a!=null&&(d=B(a,"scale","batchNorm"));let c;return r!=null&&(c=B(r,"offset","batchNorm")),H(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),H(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),H(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&H(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${d.rank}.`),c!=null&&H(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),dp(i,l,u,c,d,s)}var hT=ne({batchNorm4d_:cge});function dge(e,t,n){let r=B(e,"x","bincount"),a=B(t,"weights","bincount");H(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),H(n>=0,()=>`size must be non-negative, but got ${n}.`),H(a.size===r.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`);let s={x:r,weights:a},i={size:n};return te.runKernel(Nf,s,i)}var pT=ne({bincount_:dge});function hge(e,t){let n=B(e,"x","bitwiseAnd"),r=B(t,"y","bitwiseAnd");if(!$l(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);let a={a:n,b:r};return te.runKernel(kf,a)}var OW=ne({bitwiseAnd_:hge});function pge(e,t){let n=B(e,"s0","broadcastArgs","int32"),r=B(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);let a={s0:n,s1:r};return te.runKernel(Xy,a)}var LW=ne({broadcastArgs_:pge});function mge(e,t){let n=B(e,"broadcastTo","x"),r=n.shape;if(zs(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let u=n.shape.slice();for(;u.length<t.length;)u.unshift(1);n=ue(n,u)}let a=n.shape,s=Array.from(t);for(let u=t.length-1;u>=0;u--)if(a[u]===t[u])s[u]=1;else if(n.shape[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Oo(n);let i={x:n},l={reps:s};return te.runKernel(ic,i,l)}var od=ne({broadcastTo_:mge});function fge(e){let t={x:B(e,"x","ceil","float32")};return te.runKernel(ah,t)}var mT=ne({ceil_:fge});function $s(e,t,n){zs(e),n=n||qy(t);let r={shape:e,value:t,dtype:n};return te.runKernel(eb,{},r)}function gge(e,t,n){let r=B(e,"x","clipByValue");if(H(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return $s(r.shape,t,r.dtype);let a={x:r},s={clipValueMin:t,clipValueMax:n};return te.runKernel(sc,a,s)}var Oa=ne({clipByValue_:gge});function xge(e){return nr(e,0)}var fT=ne({concat1d_:xge});function yge(e,t){return nr(e,t)}var gT=ne({concat2d_:yge});function bge(e,t){return nr(e,t)}var xT=ne({concat3d_:bge});function vge(e,t){return nr(e,t)}var yT=ne({concat4d_:vge});function wge(e,t,n,r,a="NHWC",s=[1,1],i){let l=B(e,"x","conv2d","float32"),u=B(t,"filter","conv2d","float32"),d=l,c=!1;l.rank===3&&(c=!0,d=ue(l,[1,l.shape[0],l.shape[1],l.shape[2]])),H(d.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${d.rank}.`),H(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ja("conv2d",r,i);let h=a==="NHWC"?d.shape[3]:d.shape[1];H(h===u.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`),H(Xo(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),H(Md(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),H(Md(n),()=>"Error in conv2D: Strides should be larger than 0.");let p={x:d,filter:u},m={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i},f=te.runKernel(sh,p,m);return c?ue(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Ya=ne({conv2d_:wge});function Nge(e,t,n,r,a="NWC",s=1,i){let l=B(e,"x","conv1d"),u=B(t,"filter","conv1d"),d=l,c=!1;l.rank===2&&(c=!0,d=ue(l,[1,l.shape[0],l.shape[1]])),H(d.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${d.rank}.`),H(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ja("conv1d",r,i),H(d.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${d.shape[2]}) must match input depth for filter ${u.shape[1]}.`),H(Xo(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),H(Md(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),H(Md(n),()=>"Error in conv1D: Stride should be larger than 0."),H(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let h=ue(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=ue(d,[d.shape[0],1,d.shape[1],d.shape[2]]),m=Ya(p,h,[1,n],r,"NHWC",[1,s],i);return c?ue(m,[m.shape[2],m.shape[3]]):ue(m,[m.shape[0],m.shape[2],m.shape[3]])}var C1=ne({conv1d_:Nge});function kge(e,t,n,r,a,s="NHWC",i){H(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let l=e,u=t,d=!1;t.rank===3&&(d=!0,u=ue(t,[1,t.shape[0],t.shape[1],t.shape[2]]),l=[1,e[0],e[1],e[2]]),H(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),H(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),H(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);let c=s==="NHWC"?l[3]:l[1],h=s==="NHWC"?u.shape[3]:u.shape[1];H(c===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[2]}.`),H(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),Ja("conv2dDerInput",a,i);let p={dy:u,filter:n},m={strides:r,pad:a,dataFormat:s,dimRoundingMode:i,inputShape:l},f=te.runKernel(ih,p,m);return d?ue(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var bT=ne({conv2DBackpropInput_:kge});function Sge(e,t,n,r,a,s){let i=B(e,"x","conv2dTranspose"),l=B(t,"filter","conv2dTranspose");return bT(n,i,l,r,a,"NHWC",s)}var _1=ne({conv2dTranspose_:Sge});function Cge(e,t,n,r,a="NDHWC",s=[1,1,1]){let i=B(e,"x","conv3d"),l=B(t,"filter","conv3d"),u=i,d=!1;i.rank===4&&(d=!0,u=ue(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),H(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),H(u.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${l.shape[3]}.`),H(Xo(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),H(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`),H(Md(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),H(Md(n),()=>"Error in conv3D: Strides should be larger than 0.");let c={x:u,filter:l},h={strides:n,pad:r,dataFormat:a,dilations:s},p=te.runKernel(oh,c,h);return d?ue(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var vT=ne({conv3d_:Cge});function _ge(e,t,n,r,a){H(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,i=t,l=!1;t.rank===4&&(l=!0,i=ue(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);let u=s[4],d=i.shape[4];H(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),H(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),H(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),H(u===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`),H(d===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[4]}.`);let c={dy:i,filter:n},h={pad:a,strides:r,inputShape:s},p=te.runKernel(_f,c,h);return l?ue(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var zW=ne({conv3DBackpropInput_:_ge});function Ige(e,t,n,r,a){let s=B(e,"x","conv3dTranspose"),i=B(t,"filter","conv3dTranspose");return zW(n,s,i,r,a)}var wT=ne({conv3dTranspose_:Ige});function Tge(e){let t={x:B(e,"x","cos","float32")};return te.runKernel(lh,t)}var Nb=ne({cos_:Tge});function Ege(e){let t={x:B(e,"x","cosh","float32")};return te.runKernel(uh,t)}var I1=ne({cosh_:Ege});function jge(e,t=0,n=!1,r=!1){let a={x:B(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:r};return te.runKernel(If,a,s)}var fy=ne({cumprod_:jge});function Age(e,t=0,n=!1,r=!1){let a={x:B(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:r};return te.runKernel(ch,a,s)}var T1=ne({cumsum_:Age});function Rge(e,t,n,r=!1){let a=B(e,"x","denseBincount"),s=B(t,"weights","denseBincount");H(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),H(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),H(n>=0,()=>`size must be non-negative, but got ${n}.`),H(s.size===a.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${s.shape}.`);let i={x:a,weights:s},l={size:n,binaryOutput:r};return te.runKernel(Qy,i,l)}var s0=ne({denseBincount_:Rge});function Dge(e,t,n="NHWC"){let r=B(e,"x","depthToSpace","float32"),a=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],i=n==="NHWC"?r.shape[3]:r.shape[1];H(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),H(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t}  for depthToSpace with input shape
    ${r.shape}`),H(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),H(i%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${i} for depthToSpace with input shape ${r.shape}`);let l={x:r},u={blockSize:t,dataFormat:n};return te.runKernel(Ef,l,u)}var NT=ne({depthToSpace_:Dge});function Mge(e,t,n,r,a="NHWC",s=[1,1],i){let l=B(e,"x","depthwiseConv2d","float32"),u=B(t,"filter","depthwiseConv2d","float32"),d=l,c=!1;l.rank===3&&(c=!0,d=ue(l,[1,l.shape[0],l.shape[1],l.shape[2]])),H(d.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),H(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let h=a==="NHWC"?d.shape[3]:d.shape[1];H(h===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ja("depthwiseConv2d",r,i);let p={x:d,filter:u},m={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i},f=te.runKernel(dh,p,m);return c?ue(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var hp=ne({depthwiseConv2d_:Mge});function $ge(e){let t={x:B(e,"x","diag")};return te.runKernel(Jy,t)}var BW=ne({diag_:$ge});function Fge(e,t,n,r,a=[1,1],s="NHWC"){let i=B(e,"x","dilation2d"),l=B(t,"filter","dilation2d");H(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),H(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),H(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let u=i,d=!1;i.rank===3&&(u=ue(i,[1,i.shape[0],i.shape[1],i.shape[2]]),d=!0),H(u.shape[3]===l.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${l.shape[2]}`);let c={x:u,filter:l},h={strides:n,pad:r,dilations:a},p=te.runKernel(hh,c,h);return d?ue(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var kT=ne({dilation2d_:Fge}),xg={};Kt(xg,{assertAndGetBroadcastShape:()=>rr,getBroadcastDims:()=>WW,getReductionAxes:()=>Ur});function WW(e,t){let n=e.length,r=[];for(let a=0;a<n;a++){let s=n-1-a,i=e[s]||1;(t[t.length-1-a]||1)>1&&i===1&&r.unshift(s)}return r}function Ur(e,t){let n=[];for(let r=0;r<t.length;r++){let a=e[e.length-r-1],s=t.length-r-1,i=t[s];(a==null||a===1&&i>1)&&n.unshift(s)}return n}function rr(e,t){let n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let s=e[e.length-a-1];s==null&&(s=1);let i=t[t.length-a-1];if(i==null&&(i=1),s===1)r[n-a-1]=i;else if(i===1)r[n-a-1]=s;else if(s!==i){let l=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(l)}else r[n-a-1]=s}return r}function Pge(e,t){let n=B(e,"a","equal","string_or_numeric"),r=B(t,"b","equal","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Af,a)}var Fs=ne({equal_:Pge});function Oge(e,t,n){let r=B(t,"a","where"),a=B(n,"b","where"),s=B(e,"condition","where","bool"),i=rr(rr(s.shape,r.shape),a.shape),l=od(s,i),u=od(r,i),d=od(a,i),c={condition:l,t:u,e:d};return te.runKernel(sg,c)}var ya=ne({where_:Oge});function Lge(e){let t={x:B(e,"x","zerosLike")};return te.runKernel(fg,t)}var Nn=ne({zerosLike_:Lge});function zge(e,t){let n=B(e,"a","div"),r=B(t,"b","div");[n,r]=Cr(n,r);let a=ft(n,r),s=Nn(a),i=Fs(r,s);return ya(i,s,a)}var ST=ne({divNoNan_:zge});function Bge(e,t){let n=B(e,"t1","dot"),r=B(t,"t2","dot");H((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);let a=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(H(a===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${s}.`),n.rank===1&&r.rank===1){let i=ue(n,[1,-1]),l=ue(r,[-1,1]),u=en(i,l);return ue(u,[])}else if(n.rank===1&&r.rank===2){let i=ue(n,[1,-1]),l=ue(r,[r.shape[0],r.shape[1]]),u=en(i,l);return ue(u,[u.size])}else if(n.rank===2&&r.rank===1){let i=ue(r,[-1,1]),l=en(n,i);return ue(l,[l.size])}else{let i=ue(r,[r.shape[0],r.shape[1]]);return en(n,i)}}var CT=ne({dot_:Bge});function Wge(e,...t){let n=t.map((a,s)=>B(a,`tensors${s}`,"einsum")),r={equation:e};return te.runKernel(h1,n,r)}var $c=ne({einsum_:Wge});function Vge(e){let t={x:B(e,"x","elu","float32")};return te.runKernel(mh,t)}var yg=ne({elu_:Vge});function Uge(e,t){let n=B(e,"x","ensureShape","string_or_numeric");if(!GB(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}var VW=ne({ensureShape_:Uge});function Hge(e){let t=B(e,"x","erf");H(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=Xe(t,"float32"));let n={x:t};return te.runKernel(fh,n)}var E1=ne({erf_:Hge});function _T(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function UW(e,t,n){let r=e.length+t.length,a=[],s=0,i=0;for(let l=0;l<r;l++)n.indexOf(l)===-1?a.push(e[s++]):a.push(t[i++]);return a}function HW(e,t){let n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);let a=t.map(s=>e[s]);return[n,a]}function $d(e,t){let n=t.map(r=>1);return UW(e,n,t)}function Gge(e,t,n){H(_T(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function GW(e,t){if(_T(e,t))return null;let n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function IT(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function qge(e,t){let n=[];for(let r=t-e;r<t;++r)n.push(r);return n}function Kge(e,t=null,n=!1){let r={x:B(e,"x","max")},a={reductionIndices:t,keepDims:n};return te.runKernel(jh,r,a)}var Qs=ne({max_:Kge});function Yge(e,t=null,n=!1){let r={x:B(e,"x","min")},a={axis:t,keepDims:n};return te.runKernel(Mh,r,a)}var Wm=ne({min_:Yge});function Xge(e,t){let n=B(e,"base","pow"),r=B(t,"exp","pow");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(Bh,a)}var Uo=ne({pow_:Xge});function jt(e,t){if((fa(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&fa(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return lc(e,[],[],t)}function Zge(e){let t={x:B(e,"x","sqrt","float32")};return te.runKernel(ap,t)}var ba=ne({sqrt_:Zge});function Qge(e){let t=B(e,"x","square"),n={};return te.runKernel("Square",{x:t},n)}var tr=ne({square_:Qge});function Jge(e,t=null,n=!1){let r=B(e,"x","sum");r.dtype==="bool"&&(r=Xe(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return te.runKernel(sp,a,s)}var kt=ne({sum_:Jge});function exe(e,t="euclidean",n=null,r=!1){e=B(e,"x","norm");let a=qW(e,t,n),s=a.shape;if(r){let i=Ei(n,e.shape);s=$d(a.shape,i)}return ue(a,s)}function qW(e,t,n=null){if(e.rank===0)return zr(e);if(e.rank!==1&&n===null)return qW(ue(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return kt(zr(e),n);if(t===1/0)return Qs(zr(e),n);if(t===-1/0)return Wm(zr(e),n);if(t==="euclidean"||t===2)return ba(kt(Uo(zr(e),jt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return Qs(kt(zr(e),n[0]),n[1]-1);if(t===1/0)return Qs(kt(zr(e),n[1]),n[0]);if(t===-1/0)return Wm(kt(zr(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return ba(kt(tr(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}var bg=ne({norm_:exe});function txe(e,t=null,n=!1){return bg(e,"euclidean",t,n)}var TT=ne({euclideanNorm_:txe});function nxe(e){let t={x:B(e,"x","exp")};return te.runKernel(gh,t)}var La=ne({exp_:nxe});function rxe(e,t=0){let n=B(e,"x","expandDims","string_or_numeric");H(t<=n.rank,()=>"Axis must be <= rank of the tensor");let r={input:n},a={dim:t};return te.runKernel(Rf,r,a)}var ga=ne({expandDims_:rxe});function axe(e){let t={x:B(e,"x","expm1")};return te.runKernel(xh,t)}var ET=ne({expm1_:axe});function sxe(e,t){let n=B(e,"x","tile","string_or_numeric");H(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);let r={x:n},a={reps:t};return te.runKernel(ic,r,a)}var Rs=ne({tile_:sxe});function ixe(e,t,n,r="float32"){t==null&&(t=e);let a=nn([e,t],r),s=e<=t?e:t;for(let l=0;l<s;++l)a.set(1,l,l);let i=ue(a.toTensor(),[e,t]);if(n==null)return i;if(n.length===1)return Rs(ga(i,0),[n[0],1,1]);if(n.length===2)return Rs(ga(ga(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return Rs(ga(ga(ga(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}var j1=ne({eye_:ixe});function oxe(e){let t={x:B(e,"x","floor","float32")};return te.runKernel(yh,t)}var vg=ne({floor_:oxe});function lxe(e,t,n=0,r=0){let a=B(e,"x","gather"),s=B(t,"indices","gather","int32"),i={x:a,indices:s},l={axis:n,batchDims:r};return te.runKernel(Mf,i,l)}var wg=ne({gather_:lxe});function uxe(e,t){let n=B(e,"a","greater","string_or_numeric"),r=B(t,"b","greater","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Ff,a)}var es=ne({greater_:uxe});function cxe(e,t){let n=B(e,"a","greaterEqual","string_or_numeric"),r=B(t,"b","greaterEqual","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(wh,a)}var Ol=ne({greaterEqual_:cxe});function dxe(e){let t={input:B(e,"input","imag")};return te.runKernel(f1,t)}var kb=ne({imag_:dxe});function hxe(e){let t={x:B(e,"x","isFinite")};return te.runKernel(kh,t)}var jT=ne({isFinite_:hxe});function pxe(e){let t={x:B(e,"x","isInf")};return te.runKernel(Sh,t)}var AT=ne({isInf_:pxe});function mxe(e){let t={x:B(e,"x","isNaN")};return te.runKernel(Ch,t)}var RT=ne({isNaN_:mxe});function fxe(e,t=.2){let n={x:B(e,"x","leakyRelu")},r={alpha:t};return te.runKernel(_h,n,r)}var Sb=ne({leakyRelu_:fxe});function gxe(e,t){let n=B(e,"a","less","string_or_numeric"),r=B(t,"b","less","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Pf,a)}var Vm=ne({less_:gxe});function xxe(e,t){let n=B(e,"a","lessEqual","string_or_numeric"),r=B(t,"b","lessEqual","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Of,a)}var uc=ne({lessEqual_:xxe});function KW(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");let r={start:e,stop:t,num:n};return te.runKernel(Lf,{},r)}function yxe(e,t=5,n=1,r=1,a=.5){let s=B(e,"x","localResponseNormalization");H(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),H(Om(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let i=s,l=!1;s.rank===3&&(l=!0,i=ue(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let u={x:i},d={depthRadius:t,bias:n,alpha:r,beta:a},c=te.runKernel(Eh,u,d);return l?ue(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var DT=ne({localResponseNormalization_:yxe});function bxe(e){let t={x:B(e,"x","log","float32")};return te.runKernel(Ih,t)}var Ps=ne({log_:bxe});function vxe(e){let t={x:B(e,"x","log1p")};return te.runKernel(Th,t)}var Cb=ne({log1p_:vxe});function wxe(e){return H(Pu(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{let r=B(t,"x","tf.grad","string_or_numeric"),a=n!=null?B(n,"dy","tf.grad"):null;return te.tidy(()=>{let{value:s,grads:i}=te.gradients(()=>e(r),[r],a);return a!=null&&Qa(s.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),A1(i),i[0]})}}function Nxe(e){return H(Pu(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{H(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");let r=dy(t,"args","tf.grads","string_or_numeric"),a=n!=null?B(n,"dy","tf.grads"):null;return te.tidy(()=>{let{value:s,grads:i}=te.gradients(()=>e(...r),r,a);return a!=null&&Qa(s.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),A1(i),i})}}function kxe(e){return H(Pu(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{H(t instanceof Zt,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),H(n==null||n instanceof Zt,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");let{grads:r,value:a}=te.gradients(()=>e(t),[t],n);return A1(r),{grad:r[0],value:a}}}function Sxe(e){return H(Pu(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{H(Array.isArray(t)&&t.every(a=>a instanceof Zt),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),H(n==null||n instanceof Zt,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");let r=te.gradients(()=>e(...t),t,n);return n!=null&&Qa(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),A1(r.grads),r}}function YW(e,t){H(Pu(e),()=>"The f passed in variableGrads(f) must be a function"),H(t==null||Array.isArray(t)&&t.every(d=>d instanceof Ed),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let n=t!=null;if(!n){t=[];for(let d in te.registeredVariables)t.push(te.registeredVariables[d])}let r=n?t.filter(d=>!d.trainable):null,a=t.length;t=t.filter(d=>d.trainable),H(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let s=!0,{value:i,grads:l}=te.gradients(e,t,null,s);H(l.some(d=>d!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),H(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let u={};return t.forEach((d,c)=>{l[c]!=null&&(u[d.name]=l[c])}),r!=null&&r.forEach(d=>u[d.name]=null),{value:i,grads:u}}function Ho(e){return te.customGrad(e)}function A1(e){if(e.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Cxe(e){let t={x:B(e,"x","neg")};return te.runKernel(Gf,t)}var pr=ne({neg_:Cxe});function _xe(e){let t={x:B(e,"x","softplus")};return te.runKernel(rp,t)}var pp=ne({softplus_:_xe});function Ixe(e){let t=B(e,"x","logSigmoid");return Ho(n=>({value:pr(pp(pr(n))),gradFunc:r=>re(r,wi(pr(n)))}))(t)}var MT=ne({logSigmoid_:Ixe});function Txe(e,t){let n=B(e,"a","sub"),r=B(t,"b","sub");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(lp,a)}var dt=ne({sub_:Txe});function Exe(e,t=-1){let n=B(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return Ho((r,a)=>{let s=Qs(r,t,!0),i=dt(r,s),l=dt(Xe(i,"float32"),Ps(kt(La(i),t,!0)));return a([l]),{value:l,gradFunc:(u,d)=>{let[c]=d,h=!0,p=La(c);return dt(u,re(kt(u,t,h),p))}}})(n)}var R1=ne({logSoftmax_:Exe});function jxe(e,t=null,n=!1){let r=B(e,"x","logSumExp"),a=Ei(t,r.shape),s=Qs(r,a,!0),i=dt(r,s),l=La(i),u=kt(l,a),d=Ps(u),c=$e(ue(s,d.shape),d);if(n){let h=$d(c.shape,a);return ue(c,h)}return c}var _b=ne({logSumExp_:jxe});function Axe(e,t){let n=B(e,"a","logicalAnd","bool"),r=B(t,"b","logicalAnd","bool");rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(zf,a)}var _i=ne({logicalAnd_:Axe});function Rxe(e){let t={x:B(e,"x","logicalNot","bool")};return te.runKernel(Bf,t)}var Ib=ne({logicalNot_:Rxe});function Dxe(e,t){let n=B(e,"a","logicalOr","bool"),r=B(t,"b","logicalOr","bool");rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Wf,a)}var D1=ne({logicalOr_:Dxe});function Mxe(e,t){let n=B(e,"a","logicalXor","bool"),r=B(t,"b","logicalXor","bool");return rr(n.shape,r.shape),_i(D1(e,t),Ib(_i(e,t)))}var $T=ne({logicalXor_:Mxe}),wv=2147483648;function $xe(e,t,n="left"){let r=B(e,"sortedSequence","searchSorted"),a=B(t,"values","searchSorted"),s=r.shape[r.shape.length-1],i=a.shape[a.shape.length-1],l=ue(r,[-1,s]),u=ue(a,[-1,i]);if(l.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(l.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Xn(u.shape)>=wv)throw new Error(`values tensor size must less than ${wv}`);if(l.shape[1]>=wv)throw new Error(`trailing dim_size must less than ${wv} for int32 output type, was ${l.shape[1]}`);let d={sortedSequence:l,values:u},c={side:n};return te.runKernel(ag,d,c)}var M1=ne({searchSorted_:$xe});function XW(e,t){return M1(e,t,"left")}function Fxe(e,t,n,r,a){let s=B(e,"x","maxPool"),i=1,l=s,u=!1;s.rank===3&&(u=!0,l=ue(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),H(Xo(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Ja("maxPool",r,a);let d={x:l},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},h=te.runKernel(Rh,d,c);return u?ue(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var ua=ne({maxPool_:Fxe});function Pxe(e,t=[1,1,1],n,r,a,s="NDHWC"){let i=B(e,"x","maxPool3d"),l=i,u=!1;i.rank===4&&(u=!0,l=ue(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),H(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),H(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Ja("maxPool3d",r,a);let d={x:l},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},h=te.runKernel(Uf,d,c);return u?ue(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var FT=ne({maxPool3d_:Pxe});function Oxe(e,t,n,r,a=!1){let s={x:B(e,"x","maxPoolWithArgmax")},i={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},l=te.runKernel(rb,s,i);return{result:l[0],indexes:l[1]}}var ZW=ne({maxPoolWithArgmax_:Oxe});function Lxe(e,t){let n=B(e,"a","maximum"),r=B(t,"b","maximum");[n,r]=Cr(n,r),n.dtype==="bool"&&(n=Xe(n,"int32"),r=Xe(r,"int32")),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(Ah,a)}var Zo=ne({maximum_:Lxe});function zxe(e,t=null,n=!1){let r={x:B(e,"x","mean")},a={axis:t,keepDims:n};return te.runKernel(Dh,r,a)}var wr=ne({mean_:zxe});function Nr(e,t="float32"){if(zs(e),t==="complex64"){let r=Nr(e,"float32"),a=Nr(e,"float32");return El(r,a)}let n=s1(Xn(e),t);return te.makeTensor(n,e,t)}function ds(e,t="float32"){if(zs(e),t==="complex64"){let r=ds(e,"float32"),a=Nr(e,"float32");return El(r,a)}let n=VI(Xn(e),t);return te.makeTensor(n,e,t)}function QW(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=B(e,"x","meshgrid",e instanceof Zt?e.dtype:"float32");if(t===void 0)return[r];let a=B(t,"y","meshgrid",t instanceof Zt?t.dtype:"float32"),s=Xn(r.shape),i=Xn(a.shape);return n==="xy"?(r=ue(r,[1,-1]),a=ue(a,[-1,1]),[en(ds([i,1],r.dtype),r),en(a,ds([1,s],a.dtype))]):(r=ue(r,[-1,1]),a=ue(a,[1,-1]),[en(r,ds([1,i],r.dtype)),en(ds([s,1],a.dtype),a)])}function Bxe(e,t){let n=B(e,"a","minimum"),r=B(t,"b","minimum");[n,r]=Cr(n,r),n.dtype==="bool"&&(n=Xe(n,"int32"),r=Xe(r,"int32")),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel($h,a)}var Vu=ne({minimum_:Bxe});function Wxe(e,t,n){H(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);let r=B(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");H(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let a=n==="reflect"?1:0;for(let l=0;l<r.rank;l++)H(t[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),H(t[l][0]>=0&&t[l][0]<=r.shape[l]-a&&t[l][1]>=0&&t[l][1]<=r.shape[l]-a,()=>`Padding in dimension ${l} cannot be greater than or equal to ${r.shape[l]-a} or less than 0 for input of shape ${r.shape}`);let s={paddings:t,mode:n},i={x:r};return te.runKernel(Fh,i,s)}var PT=ne({mirrorPad_:Wxe});function Vxe(e,t){let n=B(e,"a","mod"),r=B(t,"b","mod");[n,r]=Cr(n,r);let a={a:n,b:r};return te.runKernel(Ph,a)}var OT=ne({mod_:Vxe});function Uxe(e,t=null,n=!1){e=B(e,"x","moments");let r=Ei(t,e.shape),a=wr(e,r,n),s=a.shape;n||(s=$d(a.shape,r));let i=tr(dt(Xe(e,"float32"),ue(a,s))),l=wr(i,r,n);return{mean:a,variance:l}}var Tb=ne({moments_:Uxe});function Hxe(e,t,n,r){let a=B(t,"data","multiRNNCell"),s=dy(n,"c","multiRNNCell"),i=dy(r,"h","multiRNNCell"),l=a,u=[];for(let h=0;h<e.length;h++){let p=e[h](l,s[h],i[h]);u.push(p[0]),u.push(p[1]),l=p[1]}let d=[],c=[];for(let h=0;h<u.length;h+=2)d.push(u[h]),c.push(u[h+1]);return[d,c]}var JW=ne({multiRNNCell_:Hxe});function Gxe(e,t,n,r=!1){let a=B(e,"logits","multinomial"),s=a.size,i=a.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(i>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${i}`);n=n||Math.random();let l={logits:i===1?ue(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},d=te.runKernel(Hf,l,u);return i===1?ue(d,[d.size]):d}var e6=ne({multinomial_:Gxe});function qxe(e,t){let n=B(e,"a","notEqual","string_or_numeric"),r=B(t,"b","notEqual","string_or_numeric");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r};return te.runKernel(qf,a)}var Fd=ne({notEqual_:qxe});function Kxe(e,t,n=1,r=0,a="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:B(e,"indices","oneHot","int32")},i={dtype:a,depth:t,onValue:n,offValue:r};return te.runKernel(Lh,s,i)}var Um=ne({oneHot_:Kxe});function Yxe(e){let t={x:B(e,"x","onesLike")};return te.runKernel(Zf,t)}var Os=ne({onesLike_:Yxe});function Xxe(e,t){let n=B(e,"v1","outerProduct"),r=B(t,"v2","outerProduct");H(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);let a=ue(n,[-1,1]),s=ue(r,[1,-1]);return en(a,s)}var t6=ne({outerProduct_:Xxe});function Zxe(e,t,n=0){let r=B(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:t,constantValue:n},s={x:r};return te.runKernel(zh,s,a)}var lo=ne({pad_:Zxe});function Qxe(e,t,n=0){return H(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),lo(e,[t],n)}var n6=ne({pad1d_:Qxe});function Jxe(e,t,n=0){return H(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),lo(e,t,n)}var r6=ne({pad2d_:Jxe});function eye(e,t,n=0){return H(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),lo(e,t,n)}var a6=ne({pad3d_:eye});function tye(e,t,n=0){return H(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),lo(e,t,n)}var s6=ne({pad4d_:tye});function nye(e,t,n){let r=B(e,"x","spaceToBatchND");H(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),H(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),H(r.shape.reduce((i,l,u)=>u>0&&u<=t.length?i&&(l+n[u-1][0]+n[u-1][1])%t[u-1]===0:i,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);let a={x:r},s={blockShape:t,paddings:n};return te.runKernel(og,a,s)}var Eb=ne({spaceToBatchND_:nye});function rye(e,t,n,r,a,s,i){a==null&&(a=[1,1]),s==null&&(s=1),r===0&&(r="valid");let l=B(e,"x","maxPool"),u=l,d=!1;l.rank===3&&(d=!0,u=ue(l,[1,l.shape[0],l.shape[1],l.shape[2]])),H(Xo(s,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${a}'`);let c=MW(u.shape,t,s,a,r),h=[c.dilationHeight,c.dilationWidth],p;r==="same"?p=sye([c.filterHeight,c.filterWidth],h):p=[[0,0],[0,0]];let m=h[0]===1&&h[1]===1,[f,g]=aye([c.inHeight,c.inWidth],h,p),x=m?r:"valid",y=m?u:Eb(u,h,f),b=(n==="avg"?()=>Pl(y,t,s,x,i):()=>ua(y,t,s,x,i))(),v=m?b:wb(b,h,g);return d?ue(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function aye(e,t,n){let r=n.map(c=>c[0]),a=n.map(c=>c[1]),s=e.concat(r,a),i=t.map((c,h)=>(c-s[h]%c)%c),l=a.map((c,h)=>c+i[h]),u=t.map((c,h)=>[r[h],l[h]]),d=t.map((c,h)=>[0,i[h]]);return[u,d]}function sye(e,t){let n=e.map((s,i)=>s+(s-1)*(t[i]-1)).map(s=>s-1),r=n.map(s=>Math.floor(s/2)),a=n.map((s,i)=>s-r[i]);return n.map((s,i)=>[r[i],a[i]])}var LT=ne({pool_:rye});function iye(e,t){let n=B(e,"x","prelu"),r=B(t,"alpha","prelu"),a={x:n,alpha:r};return te.runKernel(Wh,a)}var jb=ne({prelu_:iye});function oye(e,t=null,n=!1){let r=B(e,"x","prod");r.dtype==="bool"&&(r=Xe(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return te.runKernel(Vh,a,s)}var zT=ne({prod_:oye});function lye(e,t,n,r){let a=e.map((c,h)=>B(c,`tensors${h}`,"raggedGather","int32")),s=B(t,"paramsDenseValues","raggedGather"),i=B(n,"indices","raggedGather","int32"),l={paramsNestedSplits:a,paramsDenseValues:s,indices:i},u={outputRaggedRank:r},d=te.runKernel(g1,l,u);return{outputNestedSplits:d.slice(0,d.length-1),outputDenseValues:d[d.length-1]}}var i6=ne({raggedGather_:lye});function uye(e,t,n){let r=B(e,"starts","raggedRange"),a=B(t,"limits","raggedRange",r.dtype),s=B(n,"deltas","raggedRange",r.dtype),i={starts:r,limits:a,deltas:s},l=te.runKernel(x1,i);return{rtNestedSplits:l[0],rtDenseValues:l[1]}}var o6=ne({raggedRange_:uye});function cye(e,t,n,r,a){let s=B(e,"shape","raggedTensorToTensor","int32"),i=B(t,"values","raggedTensorToTensor"),l=B(n,"defaultValue","raggedTensorToTensor",i.dtype),u=r.map((h,p)=>B(h,`tensors${p}`,"raggedTensorToTensor","int32")),d={shape:s,values:i,defaultValue:l,rowPartitionTensors:u},c={rowPartitionTypes:a};return te.runKernel(y1,d,c)}var l6=ne({raggedTensorToTensor_:cye});function dye(e,t,n){zs(e);let r=Xn(e),a=null;if(n==null||n==="float32")a=new Float32Array(r);else if(n==="int32")a=new Int32Array(r);else if(n==="bool")a=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)a[s]=t();return te.makeTensor(a,e,n)}var u6=ne({rand_:dye}),BT=rc(r1()),c6={};Kt(c6,{TEST_EPSILON_FLOAT16:()=>d6,createVideoElement:()=>bye,encodeStrings:()=>h6,expectArrayBuffersEqual:()=>yye,expectArraysClose:()=>pye,expectArraysEqual:()=>fye,expectNumbersClose:()=>gye,expectPromiseToFail:()=>mye,expectValuesInRange:()=>xye,play:()=>vye,testEpsilon:()=>WT});var hye=.001,d6=.1;function pye(e,t,n){return n==null&&(n=WT()),aC(e,t,(r,a)=>VT(r,a,n))}function WT(){return te.backend.floatPrecision()===32?hye:d6}function aC(e,t,n){let r=!0;if((fa(e)||fa(t))&&(r=!1),fa(e)&&fa(t)&&(r=!0),r){let i=e.constructor.name,l=t.constructor.name;if(i!==l)throw new Error(`Arrays are of different type. Actual: ${i}. Expected: ${l}`)}if(Array.isArray(e)&&Array.isArray(t)){let i=Vo(e),l=Vo(t);if(!$l(i,l))throw new Error(`Arrays have different shapes. Actual: [${i}]. Expected: [${l}]`)}let a=fa(e)?e:Ou(e),s=fa(t)?t:Ou(t);if(a.length!==s.length)throw new Error(`Arrays have different lengths actual: ${a.length} vs expected: ${s.length}.
Actual:   ${a}.
Expected: ${s}.`);for(let i=0;i<s.length;++i){let l=a[i],u=s[i];if(!n(l,u))throw new Error(`Arrays differ: actual[${i}] = ${l}, expected[${i}] = ${u}.
Actual:   ${a}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function mye(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function fye(e,t){let n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return wu(e)||wu(e[0])||wu(t)||wu(t[0])?aC(e,n,(r,a)=>r==a):aC(e,t,(r,a)=>VT(r,a,0))}function gye(e,t,n){if(n==null&&(n=WT()),!VT(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function VT(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function xye(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function yye(e,t){let n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error(`Expected ArrayBuffer value at ${a} to be ${r[a]} but got ${n[a]} instead`)}function h6(e){for(let t=0;t<e.length;t++){let n=e[t];Array.isArray(n)?h6(n):e[t]=xb(n)}return e}function bye(e){let t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function vye(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}var UT=class{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=a||Math.random();this.random=BT.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let r=this.nextVal;return this.nextVal=NaN,r}let e,t,n=!1;for(;!n;){let r,a,s;do r=2*this.random()-1,a=2*this.random()-1,s=r*r+a*a;while(s>=1||s===0);let i=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*i,t=this.mean+this.stdDev*a*i,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},wye=class{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;let a=r||Math.random();this.randu=BT.alea(a.toString()),this.randn=new UT(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,s;for(;;){do r=this.randn.nextValue(),s=1+this.c*r;while(s<=0);if(s*=s*s,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-s+Math.log(s)),a=this.randu(),a<t||Math.log(a)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},Nye=class{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=BT.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function kye(e,t,n=1,r="float32",a){if(zs(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);let s=new wye(t,n,r,a),i=nn(e,r);for(let l=0;l<i.values.length;l++)i.values[l]=s.nextValue();return i.toTensor()}var p6=ne({randomGamma_:kye});function Sye(e,t=0,n=1,r,a){if(zs(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let s=new UT(t,n,r,!1,a),i=nn(e,r);for(let l=0;l<i.values.length;l++)i.values[l]=s.nextValue();return i.toTensor()}var $1=ne({randomNormal_:Sye});function Cye(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return $1(e,0,1,t,n)}var m6=ne({randomStandardNormal_:Cye});function _ye(e,t=0,n=1,r="float32",a){zs(e);let s=nn(e,r),i=new Nye(t,n,null,a);for(let l=0;l<s.values.length;l++)s.values[l]=i.nextValue();return s.toTensor()}var cc=ne({randomUniform_:_ye});function Iye(e,t,n,r){return cc(e,t,n,"int32",r)}var f6=ne({randomUniformInt_:Iye});function Pd(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");let a={start:e,stop:t,step:n,dtype:r};return te.runKernel(ab,{},a)}function Tye(e){let t={input:B(e,"input","real")};return te.runKernel(b1,t)}var Hm=ne({real_:Tye});function Eye(e){let t={x:B(e,"x","reciprocal")};return te.runKernel(Uh,t)}var HT=ne({reciprocal_:Eye});function jye(e){let t={x:B(e,"x","relu")};return te.runKernel(Hh,t)}var Kn=ne({relu_:jye});function Aye(e){let t={x:B(e,"x","relu6")};return te.runKernel(Kh,t)}var F1=ne({relu6_:Aye});function Rye(e,t){let n={x:B(e,"x","reverse")},r={dims:t};return te.runKernel(Yh,n,r)}var ai=ne({reverse_:Rye});function Dye(e){let t=B(e,"x","reverse");return H(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),ai(t,0)}var g6=ne({reverse1d_:Dye});function Mye(e,t){let n=B(e,"x","reverse");return H(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),ai(n,t)}var x6=ne({reverse2d_:Mye});function $ye(e,t){let n=B(e,"x","reverse");return H(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),ai(n,t)}var y6=ne({reverse3d_:$ye});function Fye(e,t){let n=B(e,"x","reverse");return H(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),ai(n,t)}var b6=ne({reverse4d_:Fye});function Pye(e){let t={x:B(e,"x","round")};return te.runKernel(Xh,t)}var P1=ne({round_:Pye});function Oye(e){let t={x:B(e,"x","rsqrt","float32")};return te.runKernel(Zh,t)}var O1=ne({rsqrt_:Oye});function Lye(e){let t={x:B(e,"x","selu")};return te.runKernel(Qh,t)}var L1=ne({selu_:Lye});function zye(e,t,n,r,a,s=[1,1],i="NHWC"){let l=B(e,"x","separableConv2d"),u=B(t,"depthwiseFilter","separableConv2d"),d=B(n,"pointwiseFilter","separableConv2d"),c=l,h=!1;if(l.rank===3&&(h=!0,c=ue(l,[1,l.shape[0],l.shape[1],l.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),H(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),H(d.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),H(d.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${d.shape[0]}.`),H(d.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${d.shape[1]}.`);let p=u.shape[2],m=u.shape[3];H(d.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${d.shape[2]}.`);let f=hp(c,u,r,a,i,s),g=Ya(f,d,1,"valid",i);return h?ue(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Ng=ne({separableConv2d_:zye});async function Bye(e,t){let n=B(e,"x","setdiff1d"),r=B(t,"y","setdiff1d");H(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),H(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),H(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);let a=await n.data(),s=await r.data(),i=new Set(s),l=0;for(let c=0;c<a.length;c++)i.has(a[c])||l++;let u=new Wr([l],n.dtype),d=new Wr([l],"int32");for(let c=0,h=0;c<a.length;c++)i.has(a[c])||(u.values[h]=a[c],d.values[h]=c,h++);return[u.toTensor(),d.toTensor()]}var v6=Bye;function Wye(e){let t={x:B(e,"x","sign")};return te.runKernel(tp,t)}var GT=ne({sign_:Wye});function Vye(e){let t={x:B(e,"x","sin","float32")};return te.runKernel(Jh,t)}var z1=ne({sin_:Vye});function Uye(e){let t={x:B(e,"x","sinh")};return te.runKernel(ep,t)}var B1=ne({sinh_:Uye});function Hye(e,t,n){let r=B(e,"x","slice1d");return H(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),pn(r,[t],[n])}var Ab=ne({slice1d_:Hye});function Gye(e,t,n){let r=B(e,"x","slice2d");return H(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),pn(r,t,n)}var W1=ne({slice2d_:Gye});function qye(e,t,n){let r=B(e,"x","slice3d");return H(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),pn(r,t,n)}var kg=ne({slice3d_:qye});function Kye(e,t,n){let r=B(e,"x","slice4d");return H(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),pn(r,t,n)}var Gm=ne({slice4d_:Kye});function Yye(e,t=-1){let n=B(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let r={logits:n},a={dim:t};return te.runKernel(ip,r,a)}var dc=ne({softmax_:Yye});function Xye(e){H(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);let t={input:e};return te.runKernel(p1,t)}var Rb=ne({fft_:Xye});function Zye(e){H(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);let t={input:e};return te.runKernel(m1,t)}var qm=ne({ifft_:Zye});function Qye(e){let t=e.shape[e.shape.length-1],n=e.size/t,r;if(t<=2){let a=ue(e,[n,t]);r=qm(a)}else{let a=[n,2*(t-1)],s=ue(Hm(e),[n,t]),i=ue(kb(e),[n,t]),l=ai(pn(s,[0,1],[n,t-2]),1),u=re(ai(pn(i,[0,1],[n,t-2]),1),jt(-1)),d=nr([s,l],1),c=nr([i,u],1),h=ue(El(d,c),[a[0],a[1]]);r=qm(h)}if(r=Hm(r),e.rank===3&&e.shape[0]!==0){let a=r,s=e.shape[0];r=ue(r,[s,r.shape[0]/s,r.shape[1]]),a.dispose()}return r}var V1=ne({irfft_:Qye});function Jye(e,t,n=0){let r={x:B(e,"x","split")},a={numOrSizeSplits:t,axis:n};return te.runKernel(lg,r,a)}var hs=ne({split_:Jye});function ebe(e,t){H(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1],r=e.size/n,a;if(t!=null&&t<n){let f=e.shape.map(x=>0),g=e.shape.map(x=>x);g[e.shape.length-1]=t,a=pn(e,f,g),n=t}else if(t!=null&&t>n){let f=e.shape.map(g=>g);f[e.shape.length-1]=t-n,a=nr([e,Nr(f)],e.shape.length-1),n=t}else a=e;let s=Nn(a),i=ue(El(a,s),[r,n]),l=Rb(i),u=Math.floor(n/2)+1,d=Hm(l),c=kb(l),h=hs(d,[u,n-u],d.shape.length-1),p=hs(c,[u,n-u],c.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=u,ue(El(h[0],p[0]),m)}var Db=ne({rfft_:ebe});function tbe(e,t){let n=B(e,"a","squaredDifference"),r=B(t,"b","squaredDifference");[n,r]=Cr(n,r),rr(n.shape,r.shape);let a={a:n,b:r},s={};return te.runKernel(op,a,s)}var U1=ne({squaredDifference_:tbe});function nbe(e,t){let n=B(e,"x","squeeze","string_or_numeric");return ue(n,qB(n.shape,t).newShape)}var hc=ne({squeeze_:nbe});function rbe(e,t=0){let n=dy(e,"tensors","stack","string_or_numeric");H(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&H(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");let r=n,a={axis:t};return te.runKernel(Qf,r,a)}var Vr=ne({stack_:rbe});function abe(e,t=0){let n={x:B(e,"x","step")},r={alpha:t};return te.runKernel(oc,n,r)}var mp=ne({step_:abe});function sbe(e,t,n,r,a=0,s=0,i=0,l=0,u=0){let d={x:B(e,"x","stridedSlice","string_or_numeric")},c={begin:t,end:n,strides:r,beginMask:a,endMask:s,ellipsisMask:i,newAxisMask:l,shrinkAxisMask:u};return te.runKernel(dg,d,c)}var qT=ne({stridedSlice_:sbe});function ibe(e){let t={x:B(e,"x","tan","float32")};return te.runKernel(up,t)}var KT=ne({tan_:ibe});function Vn(e,t){Gd(e);let n=Vo(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return lc(e,null,n,t)}function Lo(e,t,n){if(Gd(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=Vo(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return lc(e,t,r,n)}function H1(e,t,n){if(Gd(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let r=Vo(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return lc(e,t,r,n)}function Uu(e,t,n){if(Gd(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let r=Vo(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return lc(e,t,r,n)}function w6(e,t,n){if(Gd(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let r=Vo(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return lc(e,t,r,n)}function N6(e,t,n){if(Gd(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let r=Vo(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,lc(e,t,r,n)}var G1={};Kt(G1,{calculateShapes:()=>k6,validateInput:()=>q1,validateUpdateShape:()=>YT});function YT(e,t,n){let r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(s+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(s+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(s+` update.rank != ${a+e.length-r}`);for(let i=0;i<a;++i)if(n.shape[i]!==t.shape[i])throw new Error(s+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${t.shape[i]}).`);for(let i=0;i<n.rank-a;++i)if(n.shape[i+a]!==e[i+r])throw new Error(s+` updates.shape[${i+a}] (${n.shape[i+a]}) != shape[${i+a}] (${e[i+a]})`)}function q1(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}YT(n,t,e)}function k6(e,t,n){let r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length,i=1;for(let h=a;h<s;++h)i*=n[h];let l=a<1?1:a,u=Xn(t.shape)/l,d=[...mf(n.slice(0,a)),1],c=Xn(n);return{sliceRank:a,numUpdates:u,sliceSize:i,strides:d,outputSize:c}}function obe(e,t,n){let r=B(e,"tensor","tensorScatterupdate"),a=B(t,"indices","tensorScatterupdate","int32"),s=B(n,"updates","tensorScatterupdate");if(q1(s,a,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);let i={tensor:r,indices:a,updates:s},l={};return te.runKernel(rg,i,l)}var S6=ne({tensorScatterUpdate_:obe});function lbe(e,t=1,n=!0){let r=B(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);let s={x:r},i={k:t,sorted:n},[l,u]=te.runKernel(hg,s,i);return{values:l,indices:u}}var XT=ne({topk_:lbe});function ube(e,t=0,n=1,r,a){if(zs(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new UT(t,n,r,!0,a),i=nn(e,r);for(let l=0;l<i.values.length;l++)i.values[l]=s.nextValue();return i.toTensor()}var K1=ne({truncatedNormal_:ube});function cbe(e,t=0){let n=B(e,"x","unique","string_or_numeric");H(n.rank>0,()=>"The input tensor must be at least 1D");let r={x:n},a={axis:t},[s,i]=te.runKernel(pb,r,a);return{values:s,indices:i}}var ZT=ne({unique_:cbe});function dbe(e,t,n){let r=B(e,"x","unsortedSegmentSum"),a=B(t,"segmentIds","unsortedSegmentSum","int32");H(Om(n),()=>"numSegments must be of dtype int");let s={x:r,segmentIds:a},i={numSegments:n};return te.runKernel(mb,s,i)}var Y1=ne({unsortedSegmentSum_:dbe});function hbe(e,t=0){let n=B(e,"x","unstack","string_or_numeric");H(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);let r={value:n},a={axis:t};return te.runKernel(mg,r,a)}var Er=ne({unstack_:hbe});function C6(e,t){return M1(e,t,"right")}function QT(e,t=!0,n,r){return te.makeVariable(e,t,n,r)}function _6(e,t){let n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);let r=nn(e,"int32"),a=nn([n.length,e.length],"int32");for(let s=0;s<n.length;s++){let i=r.indexToLoc(n[s]),l=s*e.length;a.values.set(i,l)}return a.toTensor()}async function pbe(e){let t=B(e,"condition","whereAsync","bool"),n=await t.data(),r=_6(t.shape,n);return e!==t&&t.dispose(),r}var JT=pbe;async function mbe(e,t,n){let r=B(e,"tensor","boolMask"),a=B(t,"mask","boolMask","bool"),s=n??0,i=a.rank,l=r.shape;H(i>0,()=>"mask cannot be scalar"),Qa(l.slice(s,s+i),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let u=1;for(let g=s;g<s+i;g++)u*=l[g];let d=l.slice(0,s).concat([u],l.slice(s+i)),c=ue(r,d),h=ue(a,[-1]),p=await JT(h),m=hc(p,[1]),f=wg(c,m,s);return e!==r&&r.dispose(),t!==a&&a.dispose(),m.dispose(),c.dispose(),h.dispose(),p.dispose(),f}var I6=mbe;function fbe(e,t,n){let r=B(e,"x","transpose");if(t==null&&(t=r.shape.map((i,l)=>l).reverse()),H(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(i=>{H(i>=0&&i<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();let a={x:r},s={perm:t};return r.dtype==="complex64"?ce(()=>{let i=Hm(r),l=kb(r);return i=te.runKernel(vl,{x:i},s),l=te.runKernel(vl,{x:l},s),n&&(l=pr(l)),El(i,l)}):te.runKernel(vl,a,s)}var tn=ne({transpose_:fbe});function gbe(e,t,n,r,a=!0){let s=B(e,"v","movingAverage"),i=B(t,"x","movingAverage"),l=B(n,"decay","movingAverage");pW(s,i),H($l(s.shape,i.shape),()=>"Shape mismatch in v and x");let u=jt(1),d=dt(u,l),c=re(dt(i,s),d);if(a){H(r!=null,()=>"When using zeroDebias: true, step is required.");let h=B(r,"step","movingAverage");c=ft(c,dt(u,Uo(l,h)))}return $e(s,c)}var T6=ne({movingAverage_:gbe});function xbe(e,t,n){zs(n);let r=B(e,"indices","scatterND","int32"),a=B(t,"updates","scatterND");q1(a,r,n);let s={indices:r,updates:a},i={shape:n};return te.runKernel(ng,s,i)}var E6=ne({scatterND_:xbe});function ybe(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);let a=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);let i=t.size;if(!(t.rank===0||t.rank===1&&i===a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function bbe(e,t,n,r=0){zs(n);let a=B(e,"sparseIndices","sparseToDense","int32"),s=B(t,"sparseValues","sparseToDense","string_or_numeric"),i=B(r,"defaultValue","sparseToDense",s.dtype);ybe(a,s,n,i);let l={sparseIndices:a,sparseValues:s,defaultValue:i},u={outputShape:n};return te.runKernel(cg,l,u)}var j6=ne({sparseToDense_:bbe});function vbe(e,t){let n=B(t,"indices","gatherND","int32"),r={params:B(e,"x","gatherND","string_or_numeric"),indices:n};return te.runKernel($f,r)}var A6=ne({gatherND_:vbe});function wbe(e,t){if(t==null)return e.shape.slice();if($l(e.shape,t))return t;if(e.shape.length===t.length){let n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}function Nbe(e,t,n,r){let a=B(e,"x","dropout");if(H(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),H(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof Zt?a.clone():a;let s=wbe(a,n),i=1-t,l=ft(vg($e(cc(s,0,1,"float32",r),i)),i);return re(a,l)}var eE=ne({dropout_:Nbe});function tE(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function X1(e,t,n){let r=1-e%2,a=new Float32Array(e);for(let s=0;s<e;++s){let i=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(i)}return Vn(a,"float32")}async function kbe(e,t,n=1){let r=B(e,"predictions","inTopK"),a=B(t,"targets","inTopK");H(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),H(r.rank-1===a.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${a.rank}`),Qa(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=r.shape[r.shape.length-1];H(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);let i=await r.data(),l=await a.data(),[u,d]=[i.length/s,s],c=KB("bool",u);for(let h=0;h<u;h++){let p=h*d,m=i.subarray(p,p+d),f=[];for(let g=0;g<m.length;g++)f.push({value:m[g],index:g});f.sort((g,x)=>x.value-g.value),c[h]=0;for(let g=0;g<n;g++)if(f[g].index===l[h]){c[h]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),Ka(c,a.shape,"bool")}var R6=kbe,Km={};Kt(Km,{conv2d:()=>_be,depthwiseConv2d:()=>jbe,matMul:()=>Rbe});function Sbe(e,t,n,r,a,s="NHWC",i){let l=e;e.rank===3&&(l=ue(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=ue(t,[1,t.shape[0],t.shape[1],t.shape[2]])),H(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),H(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),H(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);let d=s==="NHWC"?l.shape[3]:l.shape[1],c=s==="NHWC"?u.shape[3]:u.shape[1];H(d===n[2],()=>`Error in conv2dDerFilter: depth of input ${d}) must match input depth in filter (${n[2]}.`),H(c===n[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${n[3]}).`),Ja("conv2dDerFilter",a,i);let h={x:l,dy:u},p={strides:r,pad:a,dataFormat:s,dimRoundingMode:i,filterShape:n};return te.runKernel(l1,h,p)}var nE=ne({conv2DBackpropFilter_:Sbe});function Z1(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return re(e,mp(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Q1(e,t){let n=t,r=Ur(e.shape,t.shape);return r.length>0&&(n=kt(n,r)),ue(n,e.shape)}function J1(e,t,n,r){if(t==="linear")return e;if(t==="relu")return Kn(e);if(t==="elu")return yg(e);if(t==="relu6")return F1(e);if(t==="prelu")return jb(e,n);if(t==="leakyrelu")return Sb(e,r);if(t==="sigmoid")return wi(e);throw new Error(`Unknown fused activation ${t}.`)}var eN=(e,t)=>!(e>0)||t==="linear";function Cbe({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:l,activation:u="linear",preluActivationWeights:d,leakyreluAlpha:c}){if(u=u||"linear",eN(te.state.gradientDepth,u)===!1){H(a==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Ya(e,t,n,r,a,s,i);return l!=null&&(S=$e(S,l)),J1(S,u,d,c)}let h=B(e,"x","conv2d","float32"),p=B(t,"filter","conv2d","float32"),m=h,f=!1;h.rank===3&&(f=!0,m=ue(h,[1,h.shape[0],h.shape[1],h.shape[2]])),H(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),H(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),Ja("fused conv2d",r,i);let g=a==="NHWC"?m.shape[3]:m.shape[1];H(p.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`),H(Xo(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);let x=vb(m.shape,p.shape,n,s,r,i),y;l!=null&&(y=B(l,"bias","fused conv2d"),[y]=Cr(y,h),a==="NHWC"?rr(x.outShape,y.shape):(H(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),H(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(d!=null){let S=d.shape;if(H(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)H(S[0]===1||S[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${x.outChannels}).`);else if(S.length===3)try{rr(S,x.outShape)}catch{let _=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(_)}b=B(d,"prelu weights","fused conv2d")}let v=(S,C)=>{H(a==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`);let[_,T,E,j]=C,I=Z1(S,E,u);H(Bu(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let D=bT(T.shape,I,_,n,r),F=nE(T,I,_.shape,n,r),P=[D,F];if(j!=null){let V=Q1(j,I);P.push(V)}return P},w={x:m,filter:p,bias:y,preluActivationWeights:b},N={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:c};return l==null?Ho((S,C,_)=>{let T=te.runKernel(Id,w,N);return _([C,S,T]),f&&(T=ue(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:v}})(m,p):Ho((S,C,_,T)=>{let E=te.runKernel(Id,w,N);return T([C,S,E,_]),f&&(E=ue(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:v}})(m,p,y)}var _be=ne({fusedConv2d_:Cbe});function Ibe(e,t,n,r,a,s=[1,1],i){let l=e;e.rank===3&&(l=ue(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u=t;u.rank===3&&(u=ue(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={x:l,dy:u},c={strides:r,pad:a,dimRoundingMode:i,dilations:s,filterShape:n};return te.runKernel(u1,d,c)}var D6=ne({depthwiseConv2dNativeBackpropFilter_:Ibe});function Tbe(e,t,n,r,a,s=[1,1],i){let l=t,u=!1;t.rank===3&&(u=!0,l=ue(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={dy:l,filter:n},c={strides:r,pad:a,dimRoundingMode:i,dilations:s,inputShape:e},h=te.runKernel(c1,d,c);return u?ue(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var M6=ne({depthwiseConv2dNativeBackpropInput_:Tbe});function Ebe({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:l,activation:u="linear",preluActivationWeights:d,leakyreluAlpha:c}){if(eN(te.state.gradientDepth,u)===!1){let N=hp(e,t,n,r,a,s,i);return l!=null&&(N=$e(N,l)),J1(N,u,d,c)}let h=B(e,"x","depthwiseConv2d","float32"),p=B(t,"filter","depthwiseConv2d","float32"),m=h,f=!1;h.rank===3&&(f=!0,m=ue(h,[1,h.shape[0],h.shape[1],h.shape[2]])),H(m.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${m.rank}.`),H(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),H(m.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${m.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),s==null&&(s=[1,1]),H(Xo(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Ja("fused depthwiseConv2d",r,i);let g=vb(m.shape,p.shape,n,s,r,i,!0),x;l!=null&&(x=B(l,"bias","fused conv2d"),[x]=Cr(x,h),rr(g.outShape,x.shape));let y;d!=null&&(y=B(d,"prelu weights","fused depthwiseConv2d"));let b=(N,S)=>{H(Bu(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[C,_,T,E]=S,j=Z1(N,T,u),I=M6(_.shape,j,C,n,r,s,i),D=D6(_,j,C.shape,n,r,s,i);if(E!=null){let F=Q1(x,j);return[I,D,F]}return[I,D]},v={x:m,filter:p,bias:x,preluActivationWeights:y},w={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:i,activation:u,leakyreluAlpha:c};return l==null?Ho((N,S,C)=>{let _=te.runKernel(Td,v,w);return C([S,N,_]),f&&(_=ue(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:b}})(m,p):Ho((N,S,C,_)=>{let T=te.runKernel(Td,v,w);return _([S,N,T,C]),f&&(T=ue(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:b}})(m,p,x)}var jbe=ne({fusedDepthwiseConv2d_:Ebe});function Abe({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:l=.2}){if(eN(te.state.gradientDepth,s)===!1){let E=en(e,t,n,r);return a!=null&&(E=$e(E,a)),J1(E,s,i,l)}let u=B(e,"a","fused matMul"),d=B(t,"b","fused matMul");[u,d]=Cr(u,d);let c=n?u.shape[u.rank-2]:u.shape[u.rank-1],h=r?d.shape[d.rank-1]:d.shape[d.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],m=r?d.shape[d.rank-2]:d.shape[d.rank-1],f=u.shape.slice(0,-2),g=d.shape.slice(0,-2),x=Xn(f),y=Xn(g);H(c===h,()=>`Error in fused matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${u.shape} and ${d.shape} and transposeA=${n} and transposeB=${r} must match.`);let b=rr(u.shape.slice(0,-2),d.shape.slice(0,-2)).concat([p,m]),v=n?ue(u,[x,c,p]):ue(u,[x,p,c]),w=r?ue(d,[y,m,h]):ue(d,[y,h,m]),N;a!=null&&(N=B(a,"bias","fused matMul"),[N]=Cr(N,u),rr(b,N.shape));let S;i!=null&&(S=B(i,"prelu weights","fused matMul"));let C=(E,j)=>{let[I,D,F,P]=j,V=Z1(ue(E,F.shape),F,s),$,O;if(!n&&!r?($=en(V,D,!1,!0),O=en(I,V,!0,!1)):!n&&r?($=en(V,D,!1,!1),O=en(V,I,!0,!1)):n&&!r?($=en(D,V,!1,!0),O=en(I,V,!1,!1)):($=en(D,V,!0,!0),O=en(V,I,!0,!0)),a!=null){let L=Q1(P,V);return[$,O,L]}else return[$,O]},_={a:v,b:w,bias:N,preluActivationWeights:S},T={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:l};return a==null?Ho((E,j,I)=>{let D=te.runKernel(_d,_,T);return I([E,j,D]),{value:ue(D,b),gradFunc:C}})(v,w):Ho((E,j,I,D)=>{let F=te.runKernel(_d,_,T);return D([E,j,F,I]),{value:ue(F,b),gradFunc:C}})(v,w,N)}var Rbe=ne({fusedMatMul_:Abe});function Dbe(e){return X1(e,.54,.46)}var Mbe=ne({hammingWindow_:Dbe});function $be(e){return X1(e,.5,.5)}var $6=ne({hannWindow_:$be});function Fbe(e,t,n,r=!1,a=0){let s=0,i=[];for(;s+t<=e.size;)i.push(pn(e,s,t)),s+=n;if(r)for(;s<e.size;){let l=s+t-e.size,u=nr([pn(e,s,t-l),$s([l],a)]);i.push(u),s+=n}return i.length===0?Lo([],[0,t]):ue(nr(i),[i.length,t])}var F6=ne({frame_:Fbe});function Pbe(e,t,n,r,a=$6){r==null&&(r=tE(t));let s=F6(e,t,n),i=re(s,a(t));return Db(i,r)}var Obe=ne({stft_:Pbe});function Lbe(e,t,n,r,a="bilinear",s=0){let i=B(e,"image","cropAndResize"),l=B(t,"boxes","cropAndResize","float32"),u=B(n,"boxInd","cropAndResize","int32"),d=l.shape[0];H(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),H(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${d},4] but had shape ${l.shape}.`),H(u.rank===1&&u.shape[0]===d,()=>`Error in cropAndResize: boxInd must be have size [${d}] but had shape ${l.shape}.`),H(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),H(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),H(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let c={image:i,boxes:l,boxInd:u},h={method:a,extrapolationValue:s,cropSize:r};return te.runKernel(Tf,c,h)}var zbe=ne({cropAndResize_:Lbe});function Bbe(e){let t=B(e,"image","flipLeftRight","float32");H(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let n={image:t};return te.runKernel(Df,n,{})}var Wbe=ne({flipLeftRight_:Bbe});function Vbe(e){let t=B(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];H(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),H(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Rs(t,a)}var Ube=ne({grayscaleToRGB_:Vbe});function Hbe(e){let t=B(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];H(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),H(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);let a=t.dtype,s=Xe(t,"float32"),i=Vn([.2989,.587,.114]),l;switch(t.rank){case 2:l=$c("ij,j->i",s,i);break;case 3:l=$c("ijk,k->ij",s,i);break;case 4:l=$c("ijkl,l->ijk",s,i);break;case 5:l=$c("ijklm,m->ijkl",s,i);break;case 6:l=$c("ijklmn,n->ijklm",s,i);break;default:throw new Error("Not a valid tensor rank.")}return l=ga(l,-1),Xe(l,a)}var Gbe=ne({rgbToGrayscale_:Hbe});function qbe(e,t,n=0,r=.5){let a=B(e,"image","rotateWithOffset","float32");H(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let s={image:a},i={radians:t,fillValue:n,center:r};return te.runKernel(gg,s,i)}var Kbe=ne({rotateWithOffset_:qbe});function Sg(e,t,n,r,a,s){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=e.shape[0];return n=Math.min(n,i),H(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),H(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),H(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),H(t.rank===1,()=>"scores must be a 1D tensor"),H(t.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${t.shape[0]}`),H(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}function Ybe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=B(e,"boxes","nonMaxSuppression","float32"),i=B(t,"scores","nonMaxSuppression","float32"),l=Sg(s,i,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;let u={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return te.runKernel(Kf,{boxes:s,scores:i},u)}var Xbe=ne({nonMaxSuppression_:Ybe});function Zbe(e,t,n){let r=Qbe(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function Qbe(e,t,n){return eve(e,t,n||Jbe)}function Jbe(e,t){return e>t?1:e<t?-1:0}function eve(e,t,n){let r=0,a=e.length,s=0,i=!1;for(;r<a;){s=r+(a-r>>>1);let l=n(t,e[s]);l>0?r=s+1:(a=s,i=!l)}return i?r:-r-1}function P6(e,t,n,r,a){return rE(e,t,n,r,a,0)}function O6(e,t,n,r,a,s){return rE(e,t,n,r,a,0,!1,s,!0)}function L6(e,t,n,r,a,s){return rE(e,t,n,r,a,s,!0)}function rE(e,t,n,r,a,s,i=!1,l=!1,u=!1){let d=[];for(let x=0;x<t.length;x++)t[x]>a&&d.push({score:t[x],boxIndex:x,suppressBeginIndex:0});d.sort(U$);let c=s>0?-.5/s:0,h=[],p=[];for(;h.length<n&&d.length>0;){let x=d.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=x;if(y<a)break;let w=!1;for(let N=h.length-1;N>=v;--N){let S=tve(e,b,h[N]);if(S>=r){w=!0;break}if(x.score=x.score*nve(r,c,S),x.score<=a)break}x.suppressBeginIndex=h.length,w||(x.score===y?(h.push(b),p.push(x.score)):x.score>a&&Zbe(d,x,U$))}let m=h.length,f=n-m;l&&f>0&&(h.push(...new Array(f).fill(0)),p.push(...new Array(f).fill(0)));let g={selectedIndices:h};return i&&(g.selectedScores=p),u&&(g.validOutputs=m),g}function tve(e,t,n){let r=e.subarray(t*4,t*4+4),a=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),l=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),d=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),m=(l-s)*(u-i),f=(h-d)*(p-c);if(m<=0||f<=0)return 0;let g=Math.max(s,d),x=Math.max(i,c),y=Math.min(l,h),b=Math.min(u,p),v=Math.max(y-g,0)*Math.max(b-x,0);return v/(m+f-v)}function nve(e,t,n){let r=Math.exp(t*n*n);return n<=e?r:0}function U$(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}async function rve(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=B(e,"boxes","nonMaxSuppressionAsync"),i=B(t,"scores","nonMaxSuppressionAsync"),l=Sg(s,i,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;let u=await Promise.all([s.data(),i.data()]),d=u[0],c=u[1],{selectedIndices:h}=P6(d,c,n,r,a);return s!==e&&s.dispose(),i!==t&&i.dispose(),Vn(h,"int32")}var ave=rve;function sve(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let i=B(e,"boxes","nonMaxSuppression"),l=B(t,"scores","nonMaxSuppression"),u=Sg(i,l,n,r,a,s);n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,s=u.softNmsSigma;let d={boxes:i,scores:l},c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s},h=te.runKernel(Xf,d,c);return{selectedIndices:h[0],selectedScores:h[1]}}var ive=ne({nonMaxSuppressionWithScore_:sve});async function ove(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let i=B(e,"boxes","nonMaxSuppressionAsync"),l=B(t,"scores","nonMaxSuppressionAsync"),u=Sg(i,l,n,r,a,s);n=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,s=u.softNmsSigma;let d=await Promise.all([i.data(),l.data()]),c=d[0],h=d[1],{selectedIndices:p,selectedScores:m}=L6(c,h,n,r,a,s);return i!==e&&i.dispose(),l!==t&&l.dispose(),{selectedIndices:Vn(p,"int32"),selectedScores:Vn(m)}}var lve=ove;function uve(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let i=B(e,"boxes","nonMaxSuppression"),l=B(t,"scores","nonMaxSuppression"),u=Sg(i,l,n,r,a,null),d=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,p={boxes:i,scores:l},m={maxOutputSize:d,iouThreshold:c,scoreThreshold:h,padToMaxOutputSize:s},f=te.runKernel(Yf,p,m);return{selectedIndices:f[0],validOutputs:f[1]}}var cve=ne({nonMaxSuppressionPadded_:uve});async function dve(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let i=B(e,"boxes","nonMaxSuppressionAsync"),l=B(t,"scores","nonMaxSuppressionAsync"),u=Sg(i,l,n,r,a,null),d=u.maxOutputSize,c=u.iouThreshold,h=u.scoreThreshold,[p,m]=await Promise.all([i.data(),l.data()]),{selectedIndices:f,validOutputs:g}=O6(p,m,d,c,h,s);return i!==e&&i.dispose(),l!==t&&l.dispose(),{selectedIndices:Vn(f,"int32"),validOutputs:jt(g,"int32")}}var hve=dve;function pve(e,t,n=!1,r=!1){let a=B(e,"images","resizeBilinear");H(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),H(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),H(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=a,i=!1;a.rank===3&&(i=!0,s=ue(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let l={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},d=te.runKernel(qh,l,u);return i?ue(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var z6=ne({resizeBilinear_:pve});function mve(e,t,n=!1,r=!1){let a=B(e,"images","resizeNearestNeighbor");H(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),H(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),H(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),H(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=a,i=!1;a.rank===3&&(i=!0,s=ue(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let l={images:s},u={alignCorners:n,halfPixelCenters:r,size:t},d=te.runKernel(Gh,l,u);return i?ue(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var B6=ne({resizeNearestNeighbor_:mve});function fve(e,t="binary",n=!1,r=.5){let a=B(e,"image","threshold"),s=.2989,i=.587,l=.114,u=a.shape[0]*a.shape[1],d=re(Vn([r]),255),c,h,p,m;if(H(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),H(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),H(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),H(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),a.shape[2]===3){[c,h,p]=hs(a,[1,1,1],-1);let g=re(c,s),x=re(h,i),y=re(p,l);m=$e($e(g,x),y)}else m=e;if(t==="otsu"){let g=pT(Xe(P1(m),"int32"),Ka([]),256);d=gve(g,u)}let f=n?uc(m,d):es(m,d);return Xe(re(f,255),"int32")}function gve(e,t){let n=Vn([-1]),r=Vn([0]),a=Vn([0]),s,i,l,u,d,c;for(let h=0;h<e.size-1;h++){s=pn(e,0,h+1),i=pn(e,h+1),d=ft(kt(s),t),c=ft(kt(i),t);let p=kt(re(s,Pd(0,s.size)));l=ft(p,kt(s));let m=$s(i.shape,s.size),f=$e(Pd(0,i.size),m),g=re(i,f);u=ft(kt(g),kt(i));let x=dt(l,u),y=dt(l,u),b=re(d,c);a=re(re(b,x),y);let v=es(a,r);r=ya(v,a,r),n=ya(v,Vn([h]),n)}return n}var xve=ne({threshold_:fve});function yve(e,t,n="nearest",r="constant",a=0,s){let i=B(e,"image","transform","float32"),l=B(t,"transforms","transform","float32");H(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),H(l.rank===2&&(l.shape[0]===i.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),H(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let u={image:i,transforms:l},d={interpolation:n,fillMode:r,fillValue:a,outputShape:s};return te.runKernel(pg,u,d)}var bve=ne({transform_:yve});function vve(e,t,n){let r=B(e,"a","bandPart");H(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let a=r.shape,[s,i]=r.shape.slice(-2),l,u;typeof t=="number"?(H(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),H(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),l=B(t<0?s:t,"numLower","bandPart")):(H(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),l=ya(Vm(t,0),s,Vu(t,s))),typeof n=="number"?(H(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),H(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),u=B(n<0?i:n,"numUpper","bandPart")):(H(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),u=ya(Vm(n,0),i,Vu(n,i)));let d=ue(Pd(0,s,1,"int32"),[-1,1]),c=Pd(0,i,1,"int32"),h=dt(d,c),p=_i(uc(h,l),Ol(h,pr(u))),m=Nr([s,i],r.dtype);return ue(Vr(Er(ue(r,[-1,s,i])).map(f=>ya(p,f,m))),a)}var wve=ne({bandPart_:vve});function Nve(e){let t;if(Array.isArray(e)){t=!1,H(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=e[0].shape[0];for(let s=1;s<e.length;++s)H(e[s].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${a})`)}else t=!0,e=hs(e,e.shape[0],0).map(a=>hc(a,[0]));H(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);let n=[],r=e;for(let a=0;a<e.length;++a)n.push(te.tidy(()=>{let s=r[a];if(a>0)for(let i=0;i<a;++i){let l=re(kt(re(n[i],s)),n[i]);s=dt(s,l)}return ft(s,bg(s,"euclidean"))}));return t?Vr(n,0):n}var kve=ne({gramSchmidt_:Nve});function Sve(e,t=!1){if(H(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return H$(e,t);{let n=e.shape.slice(0,e.shape.length-2).reduce((u,d)=>u*d),r=Er(ue(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];r.forEach(u=>{let[d,c]=H$(u,t);a.push(d),s.push(c)});let i=ue(Vr(a,0),e.shape),l=ue(Vr(s,0),e.shape);return[i,l]}}function H$(e,t=!1){return te.tidy(()=>{H(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);let n=e.shape[0],r=e.shape[1],a=j1(n),s=Oo(e),i=Lo([[1]],[1,1]),l=Oo(i),u=n>=r?r:n;for(let d=0;d<u;++d){let c=s,h=l,p=a;[l,s,a]=te.tidy(()=>{let m=pn(s,[d,d],[n-d,1]),f=bg(m),g=pn(s,[d,d],[1,1]),x=ya(es(g,0),Lo([[-1]]),Lo([[1]])),y=dt(g,re(x,f)),b=ft(m,y);b.shape[0]===1?l=Oo(i):l=nr([i,pn(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);let v=pr(ft(en(x,y),f)),w=pn(s,[d,0],[n-d,r]),N=re(v,l),S=tn(l);if(d===0)s=dt(w,en(N,en(S,w)));else{let T=dt(w,en(N,en(S,w)));s=nr([pn(s,[0,0],[d,r]),T],0)}let C=tn(N),_=pn(a,[0,d],[n,a.shape[1]-d]);if(d===0)a=dt(_,en(en(_,l),C));else{let T=dt(_,en(en(_,l),C));a=nr([pn(a,[0,0],[n,d]),T],1)}return[l,s,a]}),qt([c,h,p])}return!t&&n>r&&(a=pn(a,[0,0],[n,r]),s=pn(s,[0,0],[r,r])),[a,s]})}var Cve=ne({qr_:Sve}),Ha;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ha||(Ha={}));function _ve(e,t,n=Ha.SUM_BY_NONZERO_WEIGHTS){let r=B(e,"losses","computeWeightedLoss"),a=null;t!=null&&(a=B(t,"weights","computeWeightedLoss"));let s=a==null?r:re(r,a);if(n===Ha.NONE)return s;if(n===Ha.SUM)return kt(s);if(n===Ha.MEAN){if(a==null)return wr(s);{let i=r.size/a.size,l=ft(kt(s),kt(a));return i>1?ft(l,jt(i)):l}}if(n===Ha.SUM_BY_NONZERO_WEIGHTS){if(a==null)return ft(kt(s),jt(r.size));{let i=re(a,ds(r.shape)),l=Xe(kt(Fd(i,jt(0))),"float32");return ft(kt(s),l)}}throw Error(`Unknown reduction: ${n}`)}var Ll=ne({computeWeightedLoss_:_ve});function Ive(e,t,n,r=Ha.SUM_BY_NONZERO_WEIGHTS){let a=B(e,"labels","absoluteDifference"),s=B(t,"predictions","absoluteDifference"),i=null;n!=null&&(i=B(n,"weights","absoluteDifference")),Qa(a.shape,s.shape,"Error in absoluteDifference: ");let l=zr(dt(a,s));return Ll(l,i,r)}var Tve=ne({absoluteDifference_:Ive});function Eve(e,t,n,r,a=Ha.SUM_BY_NONZERO_WEIGHTS){let s=B(e,"labels","cosineDistance"),i=B(t,"predictions","cosineDistance"),l=null;r!=null&&(l=B(r,"weights","cosineDistance")),Qa(s.shape,i.shape,"Error in cosineDistance: ");let u=jt(1),d=dt(u,kt(re(s,i),n,!0));return Ll(d,l,a)}var jve=ne({cosineDistance_:Eve});function Ave(e,t,n,r=Ha.SUM_BY_NONZERO_WEIGHTS){let a=B(e,"labels","hingeLoss"),s=B(t,"predictions","hingeLoss"),i=null;n!=null&&(i=B(n,"weights","hingeLoss")),Qa(a.shape,s.shape,"Error in hingeLoss: ");let l=jt(1);a=dt(re(jt(2),a),l);let u=Kn(dt(l,re(a,s)));return Ll(u,i,r)}var Rve=ne({hingeLoss_:Ave});function Dve(e,t,n,r=1,a=Ha.SUM_BY_NONZERO_WEIGHTS){let s=B(e,"labels","huberLoss"),i=B(t,"predictions","huberLoss"),l=null;n!=null&&(l=B(n,"weights","huberLoss")),Qa(s.shape,i.shape,"Error in huberLoss: ");let u=jt(r),d=zr(dt(i,s)),c=Vu(d,u),h=dt(d,c),p=$e(re(jt(.5),tr(c)),re(u,h));return Ll(p,l,a)}var Mve=ne({huberLoss_:Dve});function $ve(e,t,n,r=1e-7,a=Ha.SUM_BY_NONZERO_WEIGHTS){let s=B(e,"labels","logLoss"),i=B(t,"predictions","logLoss"),l=null;n!=null&&(l=B(n,"weights","logLoss")),Qa(s.shape,i.shape,"Error in logLoss: ");let u=jt(1),d=jt(r),c=pr(re(s,Ps($e(i,d)))),h=re(dt(u,s),Ps($e(dt(u,i),d))),p=dt(c,h);return Ll(p,l,a)}var Fve=ne({logLoss_:$ve});function Pve(e,t,n,r=Ha.SUM_BY_NONZERO_WEIGHTS){let a=B(e,"labels","meanSquaredError"),s=B(t,"predictions","meanSquaredError"),i=null;n!=null&&(i=B(n,"weights","meanSquaredError")),Qa(a.shape,s.shape,"Error in meanSquaredError: ");let l=U1(a,s);return Ll(l,i,r)}var Ove=ne({meanSquaredError_:Pve});function Lve(e,t){let n=B(e,"labels","sigmoidCrossEntropyWithLogits"),r=B(t,"logits","sigmoidCrossEntropyWithLogits");Qa(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=Kn(r),s=re(r,n),i=Cb(La(pr(zr(r))));return $e(dt(a,s),i)}function zve(e,t,n,r=0,a=Ha.SUM_BY_NONZERO_WEIGHTS){let s=B(e,"multiClassLabels","sigmoidCrossEntropy"),i=B(t,"logits","sigmoidCrossEntropy"),l=null;if(n!=null&&(l=B(n,"weights","sigmoidCrossEntropy")),Qa(s.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){let d=jt(r),c=jt(1),h=jt(.5);s=$e(re(s,dt(c,d)),re(h,d))}let u=Lve(s,i);return Ll(u,l,a)}var Bve=ne({sigmoidCrossEntropy_:zve});function Wve(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return Ho((r,a,s)=>{let i=_b(a,[n],!0),l=dt(Xe(a,"float32"),i);s([r,l]);let u=pr(re(l,r));return{value:kt(u,[n]),gradFunc:(d,c)=>{let[h,p]=c,m=$d(d.shape,[n]);return[re(ue(d,m),dt(Xe(h,"float32"),La(p))),re(ue(d,m),dt(La(p),Xe(h,"float32")))]}}})(e,t)}function Vve(e,t,n,r=0,a=Ha.SUM_BY_NONZERO_WEIGHTS){let s=B(e,"onehotLabels","softmaxCrossEntropy"),i=B(t,"logits","softmaxCrossEntropy"),l=null;if(n!=null&&(l=B(n,"weights","softmaxCrossEntropy")),Qa(s.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){let d=jt(r),c=jt(1),h=jt(s.shape[1]);s=$e(re(s,dt(c,d)),ft(d,h))}let u=Wve(s,i);return Ll(u,l,a)}var Uve=ne({softmaxCrossEntropy_:Vve});function Hve(e,t,n,r){let a=B(e,"indices","sparseFillEmptyRows","int32"),s=B(t,"values","sparseFillEmptyRows"),i=B(n,"denseShape","sparseFillEmptyRows","int32"),l=B(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(i.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${i.shape}`);if(l.rank!==0)throw new Error(`Default value should be a scalar but received shape ${l.shape}`);let u={indices:a,values:s,denseShape:i,defaultValue:l},d=te.runKernel(sb,u);return{outputIndices:d[0],outputValues:d[1],emptyRowIndicator:d[2],reverseIndexMap:d[3]}}var Gve=ne({sparseFillEmptyRows_:Hve});function qve(e,t,n){let r=B(e,"inputIndices","sparseReshape","int32"),a=B(t,"inputShape","sparseReshape","int32"),s=B(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);let i={inputIndices:r,inputShape:a,newShape:s},l=te.runKernel(ug,i);return{outputIndices:l[0],outputShape:l[1]}}var Kve=ne({sparseReshape_:qve});function Yve(e,t,n){let r=B(e,"data","sparseSegmentMean"),a=B(t,"indices","sparseSegmentMean","int32"),s=B(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);let i={data:r,indices:a,segmentIds:s};return te.runKernel(ib,i)}var Xve=ne({sparseSegmentMean_:Yve});function Zve(e,t,n){let r=B(e,"data","sparseSegmentSum"),a=B(t,"indices","sparseSegmentSum","int32"),s=B(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);let i={data:r,indices:a,segmentIds:s};return te.runKernel(ob,i)}var Qve=ne({sparseSegmentSum_:Zve});function Jve(e,t,n,r,a,s,i,l){let u=B(e,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);let d=B(t,"dataSplits","stringNGrams");if(d.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let c={separator:n,nGramWidths:r,leftPad:a,rightPad:s,padWidth:i,preserveShortSequences:l},h={data:u,dataSplits:d},p=te.runKernel(cb,h,c);return{nGrams:p[0],nGramsSplits:p[1]}}var ewe=ne({stringNGrams_:Jve});function twe(e,t,n=!0){let r=B(e,"input","stringSplit","string"),a=B(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let s={skipEmpty:n},i={input:r,delimiter:a},l=te.runKernel(db,i,s);return{indices:l[0],values:l[1],shape:l[2]}}var nwe=ne({stringSplit_:twe});function rwe(e,t){let n=B(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let a={input:n};return te.runKernel(hb,a,r)}var awe=ne({stringToHashBucketFast_:rwe});function swe(e,t,n,r=!0){let a=B(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return te.runKernel(ub,{x:a},s)}var iwe=ne({staticRegexReplace_:swe}),W6={fft:Rb,ifft:qm,rfft:Db,irfft:V1},V6={hammingWindow:Mbe,hannWindow:$6,frame:F6,stft:Obe},Ks={flipLeftRight:Wbe,grayscaleToRGB:Ube,resizeNearestNeighbor:B6,resizeBilinear:z6,rgbToGrayscale:Gbe,rotateWithOffset:Kbe,cropAndResize:zbe,nonMaxSuppression:Xbe,nonMaxSuppressionAsync:ave,nonMaxSuppressionWithScore:ive,nonMaxSuppressionWithScoreAsync:lve,nonMaxSuppressionPadded:cve,nonMaxSuppressionPaddedAsync:hve,threshold:xve,transform:bve},aE={bandPart:wve,gramSchmidt:kve,qr:Cve},U6={absoluteDifference:Tve,computeWeightedLoss:Ll,cosineDistance:jve,hingeLoss:Rve,huberLoss:Mve,logLoss:Fve,meanSquaredError:Ove,sigmoidCrossEntropy:Bve,softmaxCrossEntropy:Uve},H6={sparseFillEmptyRows:Gve,sparseReshape:Kve,sparseSegmentMean:Xve,sparseSegmentSum:Qve},G6={stringNGrams:ewe,stringSplit:nwe,stringToHashBucketFast:awe,staticRegexReplace:iwe},Ve={};Kt(Ve,{Serializable:()=>q6,SerializationMap:()=>K6,getRegisteredName:()=>lwe,registerClass:()=>Y6});var owe=new Map,sC=new Map,q6=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},K6=class Up{constructor(){this.classNameMap={}}static getMap(){return Up.instance==null&&(Up.instance=new Up),Up.instance}static register(t){Up.getMap().classNameMap[t.className]=[t,t.fromConfig]}};function Y6(e,t,n){H(e.className!=null,()=>"Class being registered does not have the static className property defined."),H(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),H(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);let r=n,a=t+">"+r;return K6.register(e),owe.set(a,e),sC.set(e,a),e}function lwe(e){return sC.has(e)?sC.get(e):e.className}var zl=class extends q6{minimize(e,t=!1,n){let{value:r,grads:a}=this.computeGradients(e,n);if(n!=null){let s=n.map(i=>({name:i.name,tensor:a[i.name]}));this.applyGradients(s)}else this.applyGradients(a);return qt(a),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return YW(e,t)}dispose(){this.iterations_!=null&&qt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:jt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(zl,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});var sE=class extends zl{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=te.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=te.registeredVariables[t],a=!1;this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:ce(()=>Nn(r).variable(a))}),this.accumulatedUpdates[n]==null&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:ce(()=>Nn(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let i=this.accumulatedGrads[n].variable,l=this.accumulatedUpdates[n].variable;ce(()=>{let u=$e(re(i,this.rho),re(tr(s),1-this.rho)),d=re(ft(ba($e(l,this.epsilon)),ba($e(i,this.epsilon))),s),c=$e(re(l,this.rho),re(tr(d),1-this.rho));i.assign(u),l.assign(c);let h=$e(re(d,-this.learningRate),r);r.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(qt(this.accumulatedGrads.map(e=>e.variable)),qt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}},iE=class extends zl{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=te.registeredVariables[t];this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:ce(()=>$s(r.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[n].tensor:e[t];if(a==null)return;let s=this.accumulatedGrads[n].variable;ce(()=>{let i=$e(s,tr(a));s.assign(i);let l=$e(re(ft(a,ba($e(i,te.backend.epsilon()))),-this.learningRate),r);r.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&qt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}},oE=class extends zl{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ce(()=>{this.accBeta1=jt(t).variable(),this.accBeta2=jt(n).variable()}),r==null&&(this.epsilon=te.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ce(()=>{let n=dt(1,this.accBeta1),r=dt(1,this.accBeta2);t.forEach((a,s)=>{let i=te.registeredVariables[a],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:ce(()=>Nn(i).variable(l))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${a}/v`,variable:ce(()=>Nn(i).variable(l))});let u=Array.isArray(e)?e[s].tensor:e[a];if(u==null)return;let d=this.accumulatedFirstMoment[s].variable,c=this.accumulatedSecondMoment[s].variable,h=$e(re(d,this.beta1),re(u,1-this.beta1)),p=$e(re(c,this.beta2),re(tr(u),1-this.beta2)),m=ft(h,n),f=ft(p,r);d.assign(h),c.assign(p);let g=$e(re(ft(m,$e(ba(f),this.epsilon)),-this.learningRate),i);i.assign(g)}),this.accBeta1.assign(re(this.accBeta1,this.beta1)),this.accBeta2.assign(re(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&qt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&qt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),ce(()=>{this.accBeta1.assign(Uo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Uo(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}},lE=class extends zl{static get className(){return"Adamax"}constructor(e,t,n,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ce(()=>{this.iteration=jt(0).variable(),this.accBeta1=jt(t).variable()}),r==null&&(this.epsilon=te.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ce(()=>{let n=dt(1,this.accBeta1),r=ft(-this.learningRate,$e(re(this.iteration,this.decay),1));t.forEach((a,s)=>{let i=te.registeredVariables[a],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:Nn(i).variable(l)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${a}/v`,variable:Nn(i).variable(l)});let u=Array.isArray(e)?e[s].tensor:e[a];if(u==null)return;let d=this.accumulatedFirstMoment[s].variable,c=this.accumulatedWeightedInfNorm[s].variable,h=$e(re(d,this.beta1),re(u,1-this.beta1)),p=re(c,this.beta2),m=zr(u),f=Zo(p,m);d.assign(h),c.assign(f);let g=$e(re(ft(r,n),ft(h,$e(f,this.epsilon))),i);i.assign(g)}),this.iteration.assign($e(this.iteration,1)),this.accBeta1.assign(re(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&qt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&qt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}},tN=class extends zl{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=Array.isArray(e)?e[n].tensor:e[t];if(r==null)return;let a=te.registeredVariables[t];ce(()=>{let s=$e(re(this.c,r),a);a.assign(s)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Zr(jt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}},uE=class extends tN{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=jt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=te.registeredVariables[t];this.accumulations[n]==null&&(this.accumulations[n]={originalName:`${t}/momentum`,variable:ce(()=>Nn(r).variable(!1))});let a=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];s!=null&&ce(()=>{let i,l=$e(re(this.m,a),s);this.useNesterov?i=$e(re(this.c,$e(s,re(l,this.m))),r):i=$e(re(this.c,l),r),a.assign(l),r.assign(i)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&qt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}},cE=class extends zl{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,r==null&&(this.epsilon=te.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=te.registeredVariables[t],a=!1;this.accumulatedMeanSquares[n]==null&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:ce(()=>Nn(r).variable(a))}),this.accumulatedMoments[n]==null&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:ce(()=>Nn(r).variable(a))}),this.accumulatedMeanGrads[n]==null&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:ce(()=>Nn(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let i=this.accumulatedMeanSquares[n].variable,l=this.accumulatedMoments[n].variable;ce(()=>{let u=$e(re(i,this.decay),re(tr(s),1-this.decay));if(this.centered){let d=this.accumulatedMeanGrads[n].variable,c=$e(re(d,this.decay),re(s,1-this.decay)),h=ft(re(s,this.learningRate),ba(dt(u,$e(tr(c),this.epsilon)))),p=$e(re(l,this.momentum),h);i.assign(u),d.assign(c),l.assign(p);let m=dt(r,p);r.assign(m)}else{let d=$e(re(i,this.decay),re(tr(s),1-this.decay)),c=$e(re(l,this.momentum),ft(re(s,this.learningRate),ba($e(d,this.epsilon))));i.assign(d),l.assign(c);let h=dt(r,c);r.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&qt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&qt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&qt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}},uwe=[sE,iE,oE,lE,uE,cE,tN];function cwe(){for(let e of uwe)Y6(e)}var Aa={};Kt(Aa,{CompositeArrayBuffer:()=>Fl,browserFiles:()=>xwe,browserHTTPRequest:()=>kwe,concatenateArrayBuffers:()=>Zme,copyModel:()=>bfe,decodeWeights:()=>wW,decodeWeightsStream:()=>kW,encodeWeights:()=>Hme,fromMemory:()=>Cwe,fromMemorySync:()=>eV,getLoadHandlers:()=>sfe,getModelArtifactsForJSON:()=>QI,getModelArtifactsForJSONSync:()=>CW,getModelArtifactsInfoForJSON:()=>bb,getSaveHandlers:()=>afe,getWeightSpecs:()=>J2,http:()=>hE,isHTTPScheme:()=>oC,listModels:()=>xfe,loadWeights:()=>bwe,moveModel:()=>vfe,registerLoadRouter:()=>rfe,registerSaveRouter:()=>nfe,removeModel:()=>yfe,weightsLoaderFactory:()=>Z6,withSaveHandler:()=>_we,withSaveHandlerSync:()=>Iwe});var dwe="model",hwe=".json",pwe=".weights.bin";function G$(e){return new Promise(t=>setTimeout(t)).then(e)}var i0=class iC{constructor(t){if(!be().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(iC.URL_SCHEME)&&(t=t.slice(iC.URL_SCHEME.length)),(t==null||t.length===0)&&(t=dwe),this.modelJsonFileName=t+hwe,this.weightDataFileName=t+pwe}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=Fl.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=SW(t,a),i=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=i,await G$(()=>l.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=r,await G$(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:bb(t)}}}};i0.URL_SCHEME="downloads://";var mwe=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{let n=new FileReader;n.onload=r=>{let a=JSON.parse(r.target.result),s=a.modelTopology;if(s==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:s});return}let i=QI(a,l=>this.loadWeights(l));e(i)},n.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})}loadWeights(e){let t=[],n=[];for(let s of e)t.push(...s.weights),n.push(...s.paths);let r=this.checkManifestAndWeightFiles(e),a=n.map(s=>this.loadWeightsFile(s,r[s]));return Promise.all(a).then(s=>[t,s])}loadWeightsFile(e,t){return new Promise((n,r)=>{let a=new FileReader;a.onload=s=>{let i=s.target.result;n(i)},a.onerror=s=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){let t=[],n=this.weightsFiles.map(a=>V$(a.name)),r={};for(let a of e)a.paths.forEach(s=>{let i=V$(s);if(t.indexOf(i)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${i}'`);if(t.push(i),n.indexOf(i)===-1)throw new Error(`Weight file with basename '${i}' is not provided.`);r[s]=this.weightsFiles[n.indexOf(i)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}},fwe=e=>be().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(i0.URL_SCHEME)?gwe(e.slice(i0.URL_SCHEME.length)):null;ri.registerSaveRouter(fwe);function gwe(e="model"){return new i0(e)}function xwe(e){return new mwe(e)}function q$(e,t,n,r){i(e),n=n??0,r=r??1,l(n,r);let a=0,s=u=>(u.then(d=>{let c=n+ ++a/e.length*(r-n);return t(c),d}),u);function i(u){H(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function l(u,d){H(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),H(d>=0&&d<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${d}`),H(d>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${d}`)}return Promise.all(e.map(s))}async function X6(e,t){t==null&&(t={});let n=t.fetchFunc==null?be().platform.fetch:t.fetchFunc,r=e.map(s=>n(s,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?await Promise.all(r):await q$(r,t.onProgress,0,.5)).map(s=>s.arrayBuffer());return t.onProgress==null?await Promise.all(a):await q$(a,t.onProgress,.5,1)}function ywe(e,t){var n;let r=t.fetchFunc==null?be().platform.fetch:t.fetchFunc,a=0,s;return(n=t.onProgress)===null||n===void 0||n.call(t,0),new ReadableStream({pull:async i=>{for(var l;a<e.length;){s||(s=(await r(e[a],t.requestInit,{isBinary:!0})).body.getReader());let{done:u,value:d}=await s.read();if(u){a++,s=void 0,(l=t.onProgress)===null||l===void 0||l.call(t,a/e.length);continue}i.enqueue(d);return}i.close()}})}async function bwe(e,t="",n,r){return Z6(a=>X6(a,{requestInit:r}))(e,t,n)}function Z6(e){return async(t,n="",r)=>{let a=t.map(()=>!1),s={},i=r!=null?r.map(()=>!1):[],l=[];if(t.forEach((m,f)=>{let g=0;m.weights.forEach(x=>{let y="quantization"in x?x.quantization.dtype:x.dtype,b=jd[y]*Xn(x.shape),v=()=>{a[f]=!0,s[f]==null&&(s[f]=[]),s[f].push({manifestEntry:x,groupOffset:g,sizeBytes:b})};r!=null?r.forEach((w,N)=>{w===x.name&&(v(),i[N]=!0)}):v(),l.push(x.name),g+=b})}),!i.every(m=>m)){let m=r.filter((f,g)=>!i[g]);throw new Error(`Could not find weights in manifest with names: ${m.join(", ")}. 
Manifest JSON has weights with names: ${l.join(", ")}.`)}let u=a.reduce((m,f,g)=>(f&&m.push(g),m),[]),d=[];u.forEach(m=>{t[m].paths.forEach(f=>{let g=n+(n.endsWith("/")?"":"/")+f;d.push(g)})});let c=await e(d),h={},p=0;return u.forEach(m=>{let f=t[m].paths.length,g=new Fl(c.slice(p,p+f));s[m].forEach(x=>{let y=g.slice(x.groupOffset,x.groupOffset+x.sizeBytes),b=wW(y,[x.manifestEntry]);for(let v in b)h[v]=b[v]}),p+=f}),h}}var vwe="application/octet-stream",wwe="application/json",dE=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(H(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=be().platform.fetch,H(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&H(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=SW(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:wwe}),"model.json"),e.weightData!=null){let s=Fl.join(e.weightData);t.body.append("model.weights.bin",new Blob([s],{type:vwe}),"model.weights.bin")}let a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:bb(e),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let s=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s)}let n=t.modelTopology,r=t.weightsManifest;if(n==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return QI(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=J2(e.weightsManifest),r=()=>ywe(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:r})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=Nwe(t),a=this.weightPathPrefix||n,s=[],i=[];for(let l of e)for(let u of l.paths)this.weightUrlConverter!=null?i.push(this.weightUrlConverter(u)):s.push(a+u+r);return this.weightUrlConverter&&s.push(...await Promise.all(i)),s}async loadWeights(e){let t=await this.getWeightUrls(e),n=J2(e),r=await X6(t,this.loadOptions);return[n,r]}};dE.URL_SCHEME_REGEX=/^https?:\/\//;function Nwe(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}function oC(e){return e.match(dE.URL_SCHEME_REGEX)!=null}var Q6=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>oC(r)):n=oC(e),n)return hE(e,t)}return null};ri.registerSaveRouter(Q6);ri.registerLoadRouter(Q6);function hE(e,t){return new dE(e,t)}function kwe(e,t){return hE(e,t)}var sS=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},J6=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},Swe=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}};function Cwe(e,t,n,r){let a=arguments;return new Swe(eV(...a))}function eV(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new sS(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new sS({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new sS({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function _we(e){return new J6(e)}function Iwe(e){return new J6(e)}var tV={};Kt(tV,{confusionMatrix:()=>Ewe});function Twe(e,t,n){let r=B(e,"labels","confusionMatrix"),a=B(t,"predictions","confusionMatrix");H(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),H(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),H(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),H(r.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),H(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);let s=Um(Xe(r,"int32"),n),i=Um(Xe(a,"int32"),n),l=tn(s),u=en(l,i);return Xe(u,"int32")}var Ewe=ne({confusionMatrix_:Twe}),Mb={};Kt(Mb,{draw:()=>Pwe,fromPixels:()=>Owe,fromPixelsAsync:()=>Mwe,toPixels:()=>Fwe});var Cc,K$=!1;function nV(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,s=!1,i=!1,l=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)l=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(uy(n0,te.backendName)!=null){let p={pixels:e},m={numChannels:t};return te.runKernel(n0,p,m)}let[u,d]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],c;if(i)c=e.getContext("2d").getImageData(0,0,u,d).data;else if(r||n)c=e.data;else if(s||a||l){if(Cc==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Cc=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Cc=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Cc.canvas.width=u,Cc.canvas.height=d,Cc.drawImage(e,0,0,u,d),c=Cc.getImageData(0,0,u,d).data}let h;if(t===4)h=new Int32Array(c);else{let p=u*d;h=new Int32Array(p*t);for(let m=0;m<p;m++)for(let f=0;f<t;++f)h[m*t+f]=c[m*4+f]}return H1(h,[d,u,t],"int32")}function jwe(e){return e!=null&&e.data instanceof Uint8Array}function Awe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Rwe(e){return e!=null&&e.width!==0&&e.height!==0}function Dwe(e){return Awe()&&!(e instanceof ImageBitmap)&&Rwe(e)&&!jwe(e)}async function Mwe(e,t=3){let n=null;if(be().getBool("WRAP_TO_IMAGEBITMAP")&&Dwe(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return nV(n,t)}function rV(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function $we(e){let t=(e==null?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function Fwe(e,t){let n=B(e,"img","toPixels");if(!(e instanceof Zt)){let d=n;n=Xe(d,"int32"),d.dispose()}rV(n);let[r,a]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],i=await n.data(),l=n.dtype==="float32"?255:1,u=new Uint8ClampedArray(a*r*4);for(let d=0;d<r*a;++d){let c=[0,0,0,255];for(let p=0;p<s;p++){let m=i[d*s+p];if(n.dtype==="float32"){if(m<0||m>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${m}.`)}else if(n.dtype==="int32"&&(m<0||m>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${m}.`);s===1?(c[0]=m*l,c[1]=m*l,c[2]=m*l):c[p]=m*l}let h=d*4;u[h+0]=Math.round(c[0]),u[h+1]=Math.round(c[1]),u[h+2]=Math.round(c[2]),u[h+3]=Math.round(c[3])}if(t!=null){K$||uy(d1,te.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),K$=!0),t.width=a,t.height=r;let d=t.getContext("2d"),c=new ImageData(u,a,r);d.putImageData(c,0,0)}return n!==e&&n.dispose(),u}function Pwe(e,t,n){let r=B(e,"img","draw");if(!(e instanceof Zt)){let i=r;r=Xe(i,"int32"),i.dispose()}rV(r),$we(n==null?void 0:n.imageOptions);let a={image:r},s={canvas:t,options:n};te.runKernel(d1,a,s)}var Owe=ne({fromPixels_:nV}),pE={};Kt(pE,{prepareAndValidate:()=>aV});function aV(e,t){let n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(Xn(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let a=t.shape,s=a[a.length-1],i=1;for(let h=0;h<a.length-1;++h)i*=a[h];let l=e.shape,u=a.slice();u.pop();let d=1;for(let h=s;h<n;++h)d*=l[h],u.push(l[h]);let c=[...mf(e.shape).map(h=>h/d),1].slice(0,s);return[u,i,d,c]}var ea={};Kt(ea,{assertParamsValid:()=>zwe,computeFlatOffset:()=>Hwe,computeOutShape:()=>Wwe,getNormalizedAxes:()=>Vwe,isSliceContinous:()=>Uwe,maskToAxes:()=>Bwe,parseSliceParams:()=>pV,sliceInfo:()=>Gwe,startForAxis:()=>dV,startIndicesWithElidedDims:()=>lV,stopForAxis:()=>hV,stopIndicesWithElidedDims:()=>uV,stridesForAxis:()=>cV,stridesWithElidedDims:()=>sV});var lC=-2,Lwe=-1;function zwe(e,t,n){let r=e.shape.length;H(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),H(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let a=0;a<r;++a)H(t[a]+n[a]<=e.shape[a],()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`)}function Bwe(e){let t=[],n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function Wwe(e,t,n){let r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function sV(e,t,n,r){let a=[...e];for(let s=a.length;s<r.length;s++)a.push(1);for(let s=0;s<n;s++)s===0?a[t]=1:(a.splice(t,0,1),a.pop());return a}function iV(e,t,n){return n<=e?n:n-(t-1)}function oV(e,t){let n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function Vwe(e,t,n,r,a,s,i,l,u){let d=e.length,c=new Array(d),h=new Array(d),p=new Array(d);if(t.length&&n>0){let m=t[0],f=n+1;c=lV(i,m,f,r,e),h=uV(l,m,f,a,e),p=sV(s,m,f,e)}else for(let m=0;m<d;m++)c[m]=dV(i,r,s,e,m,u),h[m]=hV(l,a,s,e,m,u),p[m]=cV(s,m,u);return{begin:c,end:h,strides:p}}function lV(e,t,n,r,a){let s=[...a],i=oV(n,t);for(let l=0;l<s.length;l++)if(i.indexOf(l)>-1)s[l]=0;else{let u=iV(t,n,l),d=r[u];e&1<<u&&(d=0),s[l]=d}return s}function uV(e,t,n,r,a){let s=[...a],i=oV(n,t);for(let l=0;l<s.length;l++)if(i.indexOf(l)>-1)s[l]=Number.MAX_SAFE_INTEGER;else{let u=iV(t,n,l),d=r[u];e&1<<u&&(d=Number.MAX_SAFE_INTEGER),s[l]=d}for(let l=0;l<s.length;l++){let u=a[l];s[l]<0&&(s[l]+=u),s[l]=oy(0,s[l],a[l])}return s}function cV(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function dV(e,t,n,r,a,s){let i=t[a],l=n[a]||1;(e&1<<a||s&1<<a||i==null)&&(l>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let u=r[a];return i<0&&(i+=u),i=oy(0,i,u-1),i}function hV(e,t,n,r,a,s){let i=t[a],l=n[a]||1;(e&1<<a||s&1<<a||i==null)&&(l>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let u=r[a];return i<0&&(i+=u),l>0?i=oy(0,i,u):i=oy(-1,i,u-1),i}function Uwe(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function Hwe(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function pV(e,t,n){let r,a=e.shape.length;typeof t=="number"?r=[t,...new Array(a-1).fill(0)]:t.length<a?r=t.concat(new Array(a-t.length).fill(0)):r=t.slice(),r.forEach(i=>{H(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(a).fill(-1):typeof n=="number"?s=[n,...new Array(a-1).fill(-1)]:n.length<a?s=n.concat(new Array(a-n.length).fill(-1)):s=n,s=s.map((i,l)=>i>=0?i:(H(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${l}.`),e.shape[l]-r[l])),[r,s]}function Gwe(e,t,n,r,a,s,i,l,u){let d;if(r==null?(d=new Array(t.length),d.fill(1)):d=r,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1,h={dims:d.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:d.slice(),beginMask:a,endMask:s,ellipsisMask:i,newAxisMask:l,shrinkAxisMask:u};for(let b=0;b<h.dims;b++)c&&1<<b&l&&h.numAddAxisAfterEllipsis++,1<<b&i&&(c=!0);c||(h.ellipsisMask|=1<<h.dims,h.dims++);let p={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};qwe(h,p);let m=!0,f=!0,g=!0,x=[],y=[];for(let b=0;b<e.length;++b){if(p.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let v=!!(p.shrinkAxisMask&1<<b),w=e[b];if(w===-1){x.push(v?1:-1);continue}let N=[p.beginMask&1<<b,p.endMask&1<<b],S=[p.strides[b]>0?0:-1,p.strides[b]>0?w:w-1];if(v&&p.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&p.strides[b]===1;let C=!!(p.beginMask&1<<b&&p.endMask&1<<b);if(p.beginValid&&p.endValid){if(v){let j=p.begin[b]<0?w+p.begin[b]:p.begin[b];if(p.begin[b]=j,p.end[b]=p.begin[b]+1,j<0||j>=w)throw Error(`slice index ${p.begin[b]} of dimension ${b} out of bounds.`)}else p.begin[b]=Y$(p.begin[b],0,p.strides[b],w,N,S),p.end[b]=Y$(p.end[b],1,p.strides[b],w,N,S);let E=p.strides[b]===1&&p.begin[b]===0&&p.end[b]===w;m=m&&E,f=f&&(b===0&&p.strides[b]===1||E)}else m=m&&p.strides[b]===1&&C,f=f&&(b===0&&p.strides[b]===1||C);let _,T=!1;if(p.beginValid&&p.endValid?(_=p.end[b]-p.begin[b],T=!0):v?(_=1,T=!0):C&&w>=0&&(p.strides[b]<0?_=-w:_=w,T=!0),T){let E;_===0||_<0!=p.strides[b]<0?E=0:E=Math.trunc(_/p.strides[b])+(_%p.strides[b]!==0?1:0),x.push(E)}else x.push(-1)}for(let b=0;b<p.finalShapeGatherIndices.length;++b){let v=p.finalShapeGatherIndices[b];v>=0?y.push(x[v]):v===lC&&y.push(1)}return{finalShapeSparse:y.filter((b,v)=>p.finalShapeGatherIndices[v]!==lC),finalShape:y,isIdentity:m,sliceDim0:f,isSimpleSlice:g,begin:p.begin,end:p.end,strides:p.strides}}function qwe(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){let a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(lC),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(Lwe),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function Y$(e,t,n,r,a,s){if(a[t])return n>0?s[t]:s[t+1&1];{let i=e<0?r+e:e;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var Kwe="4.22.0",mV=class{static sgd(e){return new tN(e)}static momentum(e,t,n=!1){return new uE(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,a=!1){return new cE(e,t,n,r,a)}static adam(e=.001,t=.9,n=.999,r=null){return new oE(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new sE(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,a=0){return new lE(e,t,n,r,a)}static adagrad(e,t=.1){return new iE(e,t)}},jc=mV,Ywe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function mE(){return new Promise(e=>Ywe(()=>e()))}var z={};Kt(z,{ERF_A1:()=>c0e,ERF_A2:()=>d0e,ERF_A3:()=>h0e,ERF_A4:()=>p0e,ERF_A5:()=>m0e,ERF_P:()=>u0e,PARALLELIZE_THRESHOLD:()=>fE,RowPartitionType:()=>So,SELU_SCALE:()=>gV,SELU_SCALEALPHA:()=>fV,applyActivation:()=>J1,assertAndGetBroadcastShape:()=>rr,assertAxesAreInnerMostDims:()=>Gge,assertParamsConsistent:()=>Xwe,assignToTypedArray:()=>v0e,axesAreInnerMostDims:()=>_T,calculateShapes:()=>k6,checkEinsumDimSizes:()=>_0e,checkPadOnDimRoundingMode:()=>Ja,combineLocations:()=>UW,combineRaggedTensorToTensorShapes:()=>Qwe,complexWithEvenIndex:()=>x0e,complexWithOddIndex:()=>y0e,computeConv2DInfo:()=>vb,computeConv3DInfo:()=>$W,computeDefaultPad:()=>lT,computeDilation2DInfo:()=>Ufe,computeOptimalWindowSize:()=>n0e,computeOutAndReduceShapes:()=>HW,computeOutShape:()=>Zwe,computePool2DInfo:()=>MW,computePool3DInfo:()=>Hfe,convertConv2DDataFormat:()=>FW,decodeEinsumEquation:()=>S0e,eitherStridesOrDilationsAreOne:()=>Xo,expandShapeToKeepDim:()=>$d,exponent:()=>N0e,exponents:()=>w0e,fromStringArrayToUint8:()=>q0e,fromUint8ToStringArray:()=>G0e,getAxesPermutation:()=>GW,getBroadcastDims:()=>WW,getComplexWithIndex:()=>b0e,getEinsumComputePath:()=>I0e,getEinsumPermutation:()=>C0e,getFusedBiasGradient:()=>Q1,getFusedDyActivation:()=>Z1,getImageCenter:()=>r0e,getInnerMostAxes:()=>qge,getPermuted:()=>s0e,getRaggedRank:()=>e0e,getReductionAxes:()=>Ur,getReshaped:()=>a0e,getReshapedPermuted:()=>i0e,getRowPartitionTypesHelper:()=>Jwe,getSliceBeginCoords:()=>o0e,getSliceSize:()=>l0e,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>A0e,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>R0e,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>D0e,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>F0e,getSparseReshapeInputOutputMismatchErrorMessage:()=>O0e,getSparseReshapeInputOutputMultipleErrorMessage:()=>P0e,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>M0e,getSparseReshapeNegativeOutputDimErrorMessage:()=>$0e,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>W0e,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>L0e,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>z0e,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>B0e,getUndoAxesPermutation:()=>IT,isIdentityPermutation:()=>T0e,log:()=>nme,mergeRealAndImagArrays:()=>f0e,prepareAndValidate:()=>aV,prepareSplitSize:()=>j0e,segment_util:()=>xV,shouldFuse:()=>eN,slice_util:()=>ea,splitRealAndImagArrays:()=>g0e,stridesOrDilationsArePositive:()=>Md,tupleValuesAreOne:()=>Bu,upcastType:()=>ni,validateDefaultValueShape:()=>t0e,validateInput:()=>q1,validateUpdateShape:()=>YT,warn:()=>uu});function Xwe(e,t){let n=e[0].length;e.forEach((a,s)=>{H(a.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),H(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);let r=e[0];e.forEach((a,s)=>{for(let i=0;i<n;i++)H(i===t||a[i]===r[i],()=>`Error in concat${n}D: Shape of tensors[${s}] (${a}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function Zwe(e,t){let n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var So;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(So||(So={}));function Qwe(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let a=1;a<n.length;++a){let s=n[a],i=r[r.length-n.length+a],l=r[i];if(s>=0)if(l>=0){if(l!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${a+e}] = ${s} but shape[${a+e}] = ${l}`)}else r[i]=s}return r}function Jwe(e){let t={FIRST_DIM_SIZE:So.FIRST_DIM_SIZE,VALUE_ROWIDS:So.VALUE_ROWIDS,ROW_LENGTHS:So.ROW_LENGTHS,ROW_SPLITS:So.ROW_SPLITS,ROW_LIMITS:So.ROW_LIMITS,ROW_STARTS:So.ROW_STARTS},n=[];for(let r of e)if(r in t)n.push(t[r]);else break;return n}function e0e(e){return e.length===0?0:e[0]===So.FIRST_DIM_SIZE?e.length-1:e.length}function t0e(e,t){if(e==null||t==null)return;let n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let a=0;a<Math.min(n,r-1);++a){let s=e[a],i=t[a+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${a-e.length}] = ${s} but ragged tensor input.flatValues.shape[${a-e.length}] = ${i}`)}}var fE=30;function n0e(e){return e<=fE?e:t0(e,Math.floor(Math.sqrt(e)))}function r0e(e,t,n){let r=n*(typeof e=="number"?e:e[0]),a=t*(typeof e=="number"?e:e[1]);return[r,a]}function a0e(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);let s=t.length;for(let i=0;i<s;++i)a=a.concat([e[i+1]/t[i],t[i]]);a=a.concat(e.slice(s+1))}return a}function s0e(e,t,n=!0){let r=[];if(n){r.push(t);for(let a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{let a=[],s=[];for(let i=1;i<e;++i)i>=t*2+1||i%2===1?s.push(i):a.push(i);r.push(...a),r.push(0),r.push(...s)}return r}function i0e(e,t,n,r=!0){let a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?a.push(t[s-1]*e[s]):a.push(e[s]/t[s-1]):a.push(e[s]);return a}function o0e(e,t){let n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function l0e(e,t,n){let r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var fV=1.7580993408473768,gV=1.0507009873554805,u0e=.3275911,c0e=.254829592,d0e=-.284496736,h0e=1.421413741,p0e=-1.453152027,m0e=1.061405429;function f0e(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function g0e(e){let t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function x0e(e){let t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function y0e(e){let t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function b0e(e,t){let n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function v0e(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function w0e(e,t){let n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){let s=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(s),r[a]=Math.sin(s)}return{real:n,imag:r}}function N0e(e,t,n){let r=(n?2:-2)*Math.PI*(e/t),a=Math.cos(r),s=Math.sin(r);return{real:a,imag:s}}var iS="->",k0e=/->/g,X$=",",Z$="...";function S0e(e,t){e=e.replace(/\s/g,"");let n=(e.length-e.replace(k0e,"").length)/iS.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${iS}").`);let[r,a]=e.split(iS);H(r.indexOf(Z$)===-1,()=>`The ellipsis notation ("${Z$}") is not supported yet.`);let s=r.split(X$),i=s.length;if(t!==i)throw new Error(`Expected ${i} input tensors, received ${t}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let l=[];for(let p=0;p<a.length;++p){let m=a[p];if(!s.some(f=>f.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);l.indexOf(m)===-1&&l.push(m)}for(let p=0;p<r.length;++p){let m=r[p];l.indexOf(m)===-1&&m!==X$&&l.push(m)}let u=new Array(s.length);for(let p=0;p<i;++p){if(new Set(s[p].split("")).size!==s[p].length)throw new Error(`Found duplicate axes in input component ${s[p]}. Support for duplicate axes in input is not implemented yet.`);u[p]=[];for(let m=0;m<s[p].length;++m)u[p].push(l.indexOf(s[p][m]))}let d=l.length,c=a.length,h=[];for(let p=c;p<d;++p)h.push(p);return{allDims:l,summedDims:h,idDims:u}}function C0e(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;let r=[];for(let a=0;a<e;++a)n[a]===-1&&r.push(a);return n=n.filter(a=>a!==-1),{permutationIndices:n,expandDims:r}}function _0e(e,t,n){let r=new Array(e);for(let a=0;a<n.length;++a){let s=n[a].shape;for(let i=0;i<t[a].length;++i)r[t[a][i]]===void 0?r[t[a][i]]=s[i]:H(r[t[a][i]]===s[i],()=>`Expected dimension ${r[t[a][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function I0e(e,t){let n=e,r=[],a=0;e.length===0&&n.push(-1),a=e.length+1;for(let i=0;i<a;++i)r.push([]);let s=[];for(let i=0;i<n.length;++i){let l=n[i],u=E0e(t,l);for(let d of u)s.indexOf(d)===-1&&(r[i].push(d),s.push(d))}return{path:n,steps:r}}function T0e(e){return e.every((t,n)=>t===n)}function E0e(e,t){let n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function j0e(e,t,n=0){let r=[];if(typeof t=="number")H(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{let a=t.reduce((i,l)=>(l===-1&&(i+=1),i),0);H(a<=1,()=>"There should be only one negative value in split array.");let s=t.indexOf(-1);if(s!==-1){let i=t.reduce((l,u)=>u>0?l+u:l);t[s]=e.shape[n]-i}H(e.shape[n]===t.reduce((i,l)=>i+l),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function A0e(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function R0e(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function D0e(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function M0e(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function $0e(e,t){return`size ${e} must be non-negative, not ${t}`}function F0e(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function P0e(e,t){let n=Xn(e),r=Xn(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function O0e(e,t){let n=Xn(e),r=Xn(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}function L0e(){return"segment ids must be >= 0"}function z0e(){return"segment ids are not increasing"}function B0e(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function W0e(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var xV={};Kt(xV,{collectGatherOpShapeInfo:()=>H0e,computeOutShape:()=>U0e,segOpComputeOptimalWindowSize:()=>V0e});function V0e(e,t){let n=!1,r;for(e<=fE?(r=e,n=!0):r=t0(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=t0(e,r+1);return r}function U0e(e,t,n){let r=[],a=e.length;for(let s=0;s<a;s++)s!==t?r.push(e[s]):r.push(n);return r}function H0e(e,t,n,r){let a=t.shape.length,s=e.shape.length;if(r!==0&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${e.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);let i=e.shape[n],l=[],u=1,d=1,c=1;for(let h=0;h<r;++h)l.push(e.shape[h]),u*=e.shape[h];for(let h=r;h<n;h++)l.push(e.shape[h]),d*=e.shape[h];for(let h=r;h<a;h++)l.push(t.shape[h]);for(let h=n+1;h<s;h++)l.push(e.shape[h]),c*=e.shape[h];return{batchSize:u,sliceSize:c,outerSize:d,dimSize:i,outputShape:l}}function G0e(e){try{return e.map(t=>a0(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function q0e(e){return e.map(t=>xb(t))}var Qo={};Kt(Qo,{nonMaxSuppressionV3Impl:()=>P6,nonMaxSuppressionV4Impl:()=>O6,nonMaxSuppressionV5Impl:()=>L6,whereImpl:()=>_6});cwe();var yV={kernelName:ff,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,mp(Xe(n,"float32"),-1))}}},K0e={kernelName:qd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=tr(Xe(n,"float32")),a=ba(dt(jt(1),r));return pr(ft(e,a))}}}},Y0e={kernelName:Kd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=ba(dt(tr(Xe(n,"float32")),1));return ft(e,r)}}}},X0e={kernelName:ac,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=e,i=Ur(n.shape,a);return i.length>0&&(s=kt(s,i)),ue(s,n.shape)},b:()=>{let s=e,i=Ur(r.shape,a);return i.length>0&&(s=kt(s,i)),ue(s,r.shape)}}}},Z0e={kernelName:Yd,saveAllInputs:!0,gradFunc:(e,t)=>{let n={};return t.forEach((r,a)=>{n[a]=()=>e.clone()}),n}},Q0e={kernelName:yf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Nn(n)}}},J0e={kernelName:bf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Nn(n)}}},e1e={kernelName:Xd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,ba(dt(jt(1),tr(Xe(n,"float32")))))}}},t1e={kernelName:Zd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=ba($e(jt(1),tr(Xe(n,"float32"))));return ft(e,r)}}}},n1e={kernelName:eh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=$e(tr(n),tr(r)),i=re(e,ft(r,s)),l=Ur(n.shape,a);return l.length>0&&(i=kt(i,l)),ue(i,n.shape)},b:()=>{let s=$e(tr(n),tr(r)),i=pr(re(e,ft(n,s))),l=Ur(r.shape,a);return l.length>0&&(i=kt(i,l)),ue(i,r.shape)}}}},r1e={kernelName:Qd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,$e(tr(Xe(n,"float32")),1))}}},a1e={kernelName:Jd,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,dt(jt(1),tr(Xe(n,"float32"))))}}};function s1e(e,t,n,r,a,s){let i=B(e,"dy","avgPool3dGrad"),l=B(t,"input","avgPool3dGrad"),u=i,d=l,c=!1;l.rank===4&&(c=!0,u=ue(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),d=ue(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),H(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),H(d.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),Ja("avgPool3dGrad",a,s);let h={dy:u,input:d},p={filterSize:n,strides:r,pad:a,dimRoundingMode:s},m=te.runKernel(Yy,h,p);return c?ue(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var i1e=ne({avgPool3dGrad_:s1e}),o1e={kernelName:vf,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:i,dimRoundingMode:l}=n;return{x:()=>i1e(e,r,a,s,i,l)}}};function l1e(e,t,n,r,a){let s=B(e,"dy","avgPoolGrad"),i=B(t,"input","avgPoolGrad");H(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let l=i,u=s,d=!1;i.rank===3&&(d=!0,l=ue(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=ue(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),H(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);let c={dy:u,input:l},h={filterSize:n,strides:r,pad:a},p=te.runKernel(Ky,c,h);return d?ue(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var u1e=ne({avgPoolGrad_:l1e}),c1e={kernelName:th,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:i}=n;return{x:()=>u1e(e,r,a,s,i)}}},d1e={kernelName:nh,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{let[r,a]=t,{transposeA:s,transposeB:i}=n;return!s&&!i?{a:()=>en(e,a,!1,!0),b:()=>en(r,e,!0,!1)}:!s&&i?{a:()=>en(e,a,!1,!1),b:()=>en(e,r,!0,!1)}:s&&!i?{a:()=>en(a,e,!1,!0),b:()=>en(r,e,!1,!1)}:{a:()=>en(a,e,!0,!0),b:()=>en(e,r,!0,!0)}}},h1e={kernelName:wf,gradFunc:(e,t,n)=>{let{blockShape:r,crops:a}=n;return{x:()=>Eb(e,r,a)}}},p1e={kernelName:rW,gradFunc:(e,t,n)=>{let r=n,a=r.inputShape,s=r.shape,i=Array.from(s);for(let u=a.length-1;u>=0;u--)if(a[u]===s[u])i[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${s}].`);let l=[];for(let u=0;u<i.length;u++)i[u]>1&&l.push(u);return{x:()=>kt(e,l,!0)}}},m1e={kernelName:rh,gradFunc:e=>({x:()=>e.clone()})},f1e={kernelName:ah,gradFunc:e=>({x:()=>Nn(e)})},g1e={kernelName:sc,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{clipValueMin:a,clipValueMax:s}=n;return{x:()=>ya(_i(Ol(r,a),uc(r,s)),e,Nn(e))}}},x1e={kernelName:Zy,inputsToSave:["x"],gradFunc:yV.gradFunc},y1e={kernelName:Sf,saveAllInputs:!0,gradFunc:(e,t,n)=>{let r=t.map(l=>l.shape),{axis:a}=n,s=Ei(a,t[0].shape)[0],i=r.map(l=>l[s]);return hs(e,i,s).map(l=>()=>l)}},b1e={kernelName:sh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{dilations:s,strides:i,pad:l,dataFormat:u}=n;return H(Bu(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>bT(r.shape,e,a,i,l,u),filter:()=>nE(r,e,a.shape,i,l,u)}}},v1e={kernelName:ih,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{strides:s,pad:i,dataFormat:l,dimRoundingMode:u}=n;return{dy:()=>Ya(e,a,s,i,l,1,u),filter:()=>nE(e,r,a.shape,s,i,l,u)}}};function w1e(e,t,n,r,a){let s=e;e.rank===4&&(s=ue(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let i=t;i.rank===4&&(i=ue(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),H(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),H(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),H(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),H(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),H(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);let l={x:s,dy:i},u={strides:r,pad:a,filterShape:n};return te.runKernel(Cf,l,u)}var N1e=ne({conv3DBackpropFilter_:w1e}),k1e={kernelName:oh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s}=n;H(Bu(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[i,l]=t;return{x:()=>zW(i.shape,e,l,a,s),filter:()=>N1e(i,e,l.shape,a,s)}}},S1e={kernelName:lh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(pr(z1(Xe(n,"float32"))),e)}}},C1e={kernelName:uh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(B1(Xe(n,"float32")),e)}}},_1e={kernelName:ch,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a,exclusive:s,reverse:i}=n;return{x:()=>{let l=GW([a],r.rank),u=T1(e,a,s,!i);return l!=null&&(u=tn(u,l)),u}}}},I1e={kernelName:dh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s,dimRoundingMode:i}=n,l=r??[1,1];H(Bu(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);let[u,d]=t;return H(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),H(d.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${d.rank}.`),H(u.shape[3]===d.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),H(Xo(a,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${l}'.`),Ja("depthwiseConv2d",s,i),{x:()=>M6(u.shape,e,d,a,s,l,i),filter:()=>D6(u,e,d.shape,a,s,l,i)}}},T1e={kernelName:hh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,s={x:r,filter:a,dy:e},i={x:r,filter:a,dy:e};return{x:()=>te.runKernel(Lm,s,n),filter:()=>te.runKernel(zm,i,n)}}},E1e={kernelName:mh,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t,r={dy:e,y:n};return{x:()=>te.runKernel(jf,r)}}},j1e={kernelName:fh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=re(La(pr(tr(n))),2/Math.sqrt(Math.PI));return{x:()=>re(e,r)}}},A1e={kernelName:gh,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,n)}}},R1e={kernelName:Rf,inputsToSave:["input"],gradFunc:(e,t)=>{let[n]=t;return{input:()=>ue(e,n.shape)}}},D1e={kernelName:xh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,La(n))}}},M1e={kernelName:yh,gradFunc:e=>({x:()=>Nn(e)})},$1e={kernelName:bh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=ft(e,Xe(r,"float32")),i=Ur(n.shape,a);return i.length>0?ue(kt(s,i),n.shape):s},b:()=>{let s=re(e,Xe(n,"float32")),i=Ur(r.shape,a);i.length>0&&(s=ue(kt(s,i),r.shape));let l=tr(r);return pr(ft(s,Xe(l,"float32")))}}}},F1e={kernelName:vh,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{let{varianceEpsilon:r}=n,[a,s,i,l]=t,u=l??jt(1),d=Ur(s.shape,a.shape),c=[];if(s.rank===1){for(let g=0;g<a.shape.length-1;++g)c.push(a.shape[g]);c.push(1)}let h=dt(a,s),p=re(e,u),m=O1($e(i,jt(r))),f=re(re(re(m,m),m),jt(-.5));return{x:()=>s.rank===1?ue(re(re(e,Rs(ue(m,[1,1,1,s.shape[0]]),c)),u),a.shape):ue(re(re(e,m),u),a.shape),mean:()=>{let g=re(re(m,jt(-1)),p);return s.rank===1&&(g=kt(g,d)),ue(g,s.shape)},variance:()=>{let g=re(re(f,h),p);return s.rank===1&&(g=kt(g,d)),ue(g,s.shape)},scale:()=>{let g=re(h,m),x=re(e,g);return s.rank===1&&(x=kt(x,d)),ue(x,s.shape)},offset:()=>{let g=e;return s.rank===1&&(g=kt(g,d)),ue(g,s.shape)}}}},P1e={kernelName:Mf,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{let[r,a]=t,{axis:s,batchDims:i}=n,l=Ei(s,r.shape)[0],u=(d,c,h)=>()=>{let p=d.shape,m=c.size,f=p.slice(0,l),g=f.length,x=p.slice(s,p.length).slice(1),y=x.length,b=Q$(0,g),v=Q$(g+1,g+1+y),w=J$([f,[m],x]),N=ue(h,w),S=ue(c,[m]),C=J$([[g],b,v]),_=tn(N,C),T=Y1(_,S,d.shape[l]),E=IT(C);return T=tn(T,E),T};if(i===1){let d=r.shape[0],c=r.split(d,0);return{x:()=>Vr(c.map((h,p)=>u(h,a.slice(p,1),e.slice(p,1))())).reshape(r.shape),indices:()=>a}}else return{x:u(r,a,e),indices:()=>a}}};function Q$(e,t){let n=[];for(let r=e;r<t;++r)n.push(r);return n}function J$(e){let t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var O1e={kernelName:wh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>Nn(n),b:()=>Nn(r)}}},L1e={kernelName:Nh,gradFunc:e=>({x:()=>Xe(e,"float32")})},z1e={kernelName:kh,gradFunc:e=>({x:()=>Nn(e)})},B1e={kernelName:Sh,gradFunc:e=>({x:()=>Nn(e)})},W1e={kernelName:Ch,gradFunc:e=>({x:()=>Nn(e)})},V1e={kernelName:_h,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{alpha:a}=n,s=es(r,0);return{x:()=>ya(s,e,re(e,a))}}},U1e={kernelName:Th,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,$e(n,1))}}},H1e={kernelName:Ih,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,Xe(n,"float32"))}}},G1e={kernelName:sW,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n;return{logits:()=>{let s=La(r);return dt(e,re(kt(e,a,!0),s))}}}};function q1e(e,t,n,r=5,a=1,s=1,i=.5){let l={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:s,beta:i};return te.runKernel(Vf,l,u)}var K1e=ne({localResponseNormalizationBackprop_:q1e}),Y1e={kernelName:Eh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{depthRadius:s,bias:i,alpha:l,beta:u}=n;return{x:()=>K1e(r,a,e,s,i,l,u)}}};function bV(e,t,n,r){return t.rank<n.rank&&(t=ue(t,$d(t.shape,r))),e.rank<n.rank&&(e=ue(e,$d(e.shape,r))),{x:()=>re(e,Xe(Fs(n,t),e.dtype))}}var eF={kernelName:jh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{reductionIndices:a}=r,s=t[0],i=t[1],l=Ei(a,s.shape),u=bV(e,i,s,l);return{x:()=>u.x()}}},X1e={kernelName:Ah,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>re(e,Xe(Ol(n,r),"float32")),b:()=>re(e,Xe(Vm(n,r),"float32"))}}};function Z1e(e,t,n,r,a,s,i){let l=B(e,"dy","maxPool3dGrad"),u=B(t,"input","maxPool3dGrad"),d=B(n,"output","maxPool3dGrad"),c=l,h=u,p=d,m=!1;u.rank===4&&(m=!0,c=ue(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=ue(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=ue(d,[1,d.shape[0],d.shape[1],d.shape[2],d.shape[3]])),H(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),H(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),H(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),Ja("maxPool3dGrad",s,i);let f={dy:c,input:h,output:p},g={filterSize:r,strides:a,pad:s,dimRoundingMode:i},x=te.runKernel(nb,f,g);return m?ue(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}var Q1e=ne({maxPool3dGrad_:Z1e}),J1e={kernelName:Uf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=n;return{x:()=>Q1e(e,r,a,s,i,l,u)}}};function eNe(e,t,n,r,a,s,i){let l=B(e,"dy","maxPoolGrad"),u=B(t,"input","maxPoolGrad"),d=B(n,"output","maxPoolGrad");H(u.rank===l.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${l.rank})`),H(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),H(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ja("maxPoolGrad",s,i);let c={dy:l,input:u,output:d},h={filterSize:r,strides:a,pad:s,dimRoundingMode:i};return te.runKernel(tb,c,h)}var tNe=ne({maxPoolGrad_:eNe}),nNe={kernelName:Rh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:i,pad:l}=n;return{x:()=>tNe(e,r,a,s,i,l)}}},rNe={kernelName:Dh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=Ei(a,r.shape),i=HW(r.shape,s)[1],l=Xn(i);return{x:()=>{let u=r.shape.slice();s.forEach(c=>{u[c]=1});let d=ue(e,u);return ft(re(d,ds(r.shape,"float32")),l)}}}},aNe={kernelName:Mh,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{axis:a}=r,[s,i]=t,l=Ei(a,s.shape),u=bV(e,i,s,l);return{x:()=>u.x()}}},sNe={kernelName:$h,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>re(e,Xe(uc(n,r),"float32")),b:()=>re(e,Xe(es(n,r),"float32"))}}},iNe={kernelName:Fh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(i=>i[0]);return{x:()=>pn(e,s,r.shape)}}},oNe={kernelName:Ph,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=Ur(n.shape,a);return s.length>0?ue(kt(e,s),n.shape):e},b:()=>{let s=re(e,pr(vg(ft(n,r)))),i=Ur(r.shape,a);return i.length>0?ue(kt(s,i),r.shape):s}}}},lNe={kernelName:Oh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=re(e,Xe(r,"float32")),i=Ur(n.shape,a);return i.length>0?ue(kt(s,i),n.shape):s},b:()=>{let s=re(e,Xe(n,"float32")),i=Ur(r.shape,a);return i.length>0?ue(kt(s,i),r.shape):s}}}},uNe={kernelName:Gf,gradFunc:e=>({x:()=>pr(e)})},cNe={kernelName:Lh,inputsToSave:["indices"],gradFunc:(e,t)=>{let n=t[0];return{indices:()=>Nr(n.shape,"float32")}}},dNe={kernelName:Zf,gradFunc:e=>({x:()=>Nn(e)})},hNe={kernelName:Qf,saveAllInputs:!0,gradFunc:(e,t,n)=>{let{axis:r}=n;return Er(e,r).map(a=>()=>a)}},tF={kernelName:zh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(i=>i[0]);return{x:()=>pn(e,s,r.shape)}}},pNe={kernelName:Bh,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{let[n,r,a]=t,s=n,i=r,l=rr(s.shape,i.shape);return{a:()=>{let u=Xe(i,"float32"),d=re(e,re(u,Uo(s,dt(u,jt(1))))),c=Ur(s.shape,l);return c.length>0&&(d=kt(d,c)),ue(d,s.shape)},b:()=>{let u=es(s,0),d=ya(u,Ps(s),Nn(s)),c=re(e,re(a,d)),h=Ur(i.shape,l);return h.length>0&&(c=kt(c,h)),ue(c,i.shape)}}}},mNe={kernelName:Wh,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{let[n,r]=t,a=es(n,0);return{x:()=>ya(a,e,re(e,r)),alpha:()=>{let s=ya(a,Nn(e),re(e,n)),i=Ur(r.shape,e.shape);return i.length>0&&(s=kt(s,i)),ue(s,r.shape)}}}};function fNe(e,t,n){let r=e.shape.slice();r[n]=1;let a=ue(t,r),s=fy(e,n,!0,!1),i=fy(e,n,!0,!0),l=re(s,i);return re(a,l)}function gNe(e,t,n){let r=e.shape.length,a=r-n.length,s=z.getAxesPermutation(n,r),i=e;s!=null&&(i=tn(e,s));let l=i.shape.slice(),u=l.splice(r-n.length,n.length).reduce((h,p)=>h*p,1);l.push(u);let d=i.reshape(l),c=fNe(d,t,a);if(c=c.reshape(i.shape),s!=null){let h=z.getUndoAxesPermutation(s);c=tn(c,h)}return c}var xNe={kernelName:Vh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=[];return a==null?s=r.shape.map((i,l)=>l):typeof a=="number"?s=[a]:s=a,{x:()=>gNe(r,e,s)}}},yNe={kernelName:ph,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=ft(e,Xe(r,"float32")),i=Ur(n.shape,a);return i.length>0?ue(kt(s,i),n.shape):s},b:()=>{let s=re(e,Xe(n,"float32")),i=Ur(r.shape,a);i.length>0&&(s=ue(kt(s,i),r.shape));let l=tr(r);return pr(ft(s,Xe(l,"float32")))}}}},bNe={kernelName:Uh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,pr(tr(n)))}}},vNe={kernelName:Kh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=re(uc(n,6),mp(n));return{x:()=>re(e,Xe(r,"float32"))}}},wNe={kernelName:Hh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,Xe(mp(n),"float32"))}}},NNe={kernelName:Jf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ue(e,n.shape)}}},kNe={kernelName:qh,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>te.runKernel(tg,a,n)}}},SNe={kernelName:Gh,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>te.runKernel(eg,a,n)}}},CNe={kernelName:Yh,gradFunc:(e,t,n)=>{let{dims:r}=n,a=Ei(r,e.shape);return{x:()=>ai(e,a)}}},_Ne={kernelName:Xh,gradFunc:e=>({x:()=>Nn(e)})},INe={kernelName:Zh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pr(ft(e,re(Uo(n,1.5),2)))}}},TNe={kernelName:sg,inputsToSave:["condition"],gradFunc:(e,t)=>{let[n]=t;return{condition:()=>Xe(Nn(n),"float32"),t:()=>re(e,Xe(n,e.dtype)),e:()=>re(e,Xe(Ib(n),e.dtype))}}},ENe={kernelName:Qh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=es(n,jt(0)),a=jt(fV),s=jt(gV),i=re(e,s),l=re(re(e,a),La(Xe(n,"float32")));return ya(r,i,l)}}}},jNe={kernelName:np,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,re(n,dt(jt(1),n)))}}},ANe={kernelName:tp,gradFunc:e=>({x:()=>Nn(e)})},RNe={kernelName:Jh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(Nb(Xe(n,"float32")),e)}}},DNe={kernelName:ep,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(I1(Xe(n,"float32")),e)}}},MNe={kernelName:ig,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{begin:a,size:s}=n,i=r.shape,[l,u]=pV(r,a,s),d=[];for(let c=0;c<e.rank;c++)d.push([l[c],i[c]-l[c]-u[c]]);return{x:()=>lo(e,d)}}},$Ne={kernelName:ip,outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{dim:a}=n,s=!0,i=re(e,r);return{logits:()=>dt(i,re(kt(i,[a],s),r))}}},FNe={kernelName:rp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,wi(n))}}},nF={kernelName:og,gradFunc:(e,t,n)=>{let{blockShape:r,paddings:a}=n;return{x:()=>wb(e,r,a)}}},rF={kernelName:lg,gradFunc:(e,t,n)=>{let{axis:r}=n;return{x:()=>nr(e,r)}}},PNe={kernelName:ap,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,re(ba(Xe(n,"float32")),2))}}},ONe={kernelName:lb,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(e,re(Xe(n,"float32"),2))}}},LNe={kernelName:op,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=jt(2);return{a:()=>re(e,re(a,dt(n,r))),b:()=>re(e,re(a,dt(r,n)))}}},zNe={kernelName:oc,gradFunc:e=>({x:()=>Nn(e)})},BNe={kernelName:lp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=rr(n.shape,r.shape);return{a:()=>{let s=e,i=Ur(n.shape,a);return i.length>0&&(s=kt(s,i)),ue(s,n.shape)},b:()=>{let s=e,i=Ur(r.shape,a);return i.length>0&&(s=kt(s,i)),ue(pr(s),r.shape)}}}},WNe={kernelName:sp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,a=r.shape.slice(),{axis:s}=n;Ei(s,r.shape).forEach(u=>{a[u]=1});let i=ue(e,a),l=re(i,ds(r.shape,"float32"));return{x:()=>l}}},VNe={kernelName:up,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>ft(e,tr(Nb(n)))}}},UNe={kernelName:cp,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>re(dt(jt(1),tr(n)),e)}}},HNe={kernelName:ic,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{reps:a}=n;return{x:()=>{let s=Nn(r);if(r.rank===1)for(let i=0;i<a[0];++i)s=$e(s,pn(e,[i*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let i=0;i<a[0];++i)for(let l=0;l<a[1];++l)s=$e(s,pn(e,[i*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let i=0;i<a[0];++i)for(let l=0;l<a[1];++l)for(let u=0;u<a[2];++u)s=$e(s,pn(e,[i*r.shape[0],l*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let i=0;i<a[0];++i)for(let l=0;l<a[1];++l)for(let u=0;u<a[2];++u)for(let d=0;d<a[3];++d)s=$e(s,pn(e,[i*r.shape[0],l*r.shape[1],u*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}},GNe={kernelName:vl,gradFunc:(e,t,n)=>{let r=n,{perm:a}=r,s=IT(a);return{x:()=>tn(e,s)}}},qNe={kernelName:mg,gradFunc:(e,t,n)=>{let r=n,{axis:a}=r;return{value:()=>Vr(e,a)}}},KNe={kernelName:mb,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>YNe(e,n)}}};function YNe(e,t){let n=Zo(t,Nn(t)),r=wg(e,n),a=Ol(t,jt(0,"int32")),s=r.rank-a.rank;for(let l=0;l<s;++l)a=ga(a,l+1);a=_i(a,ds(r.shape,"bool"));let i=Nn(r);return ya(a,r,i)}var XNe={kernelName:fg,gradFunc:e=>({x:()=>Nn(e)})},ZNe=[yV,K0e,Y0e,X0e,Z0e,Q0e,J0e,e1e,t1e,n1e,r1e,a1e,o1e,c1e,d1e,h1e,p1e,m1e,f1e,g1e,x1e,y1e,v1e,b1e,k1e,S1e,C1e,_1e,I1e,T1e,yNe,E1e,j1e,A1e,R1e,D1e,$1e,M1e,F1e,P1e,O1e,L1e,z1e,B1e,W1e,V1e,U1e,H1e,G1e,Y1e,eF,eF,X1e,J1e,nNe,rNe,aNe,sNe,iNe,oNe,lNe,uNe,cNe,dNe,hNe,tF,tF,pNe,mNe,xNe,bNe,vNe,wNe,NNe,kNe,SNe,CNe,_Ne,INe,TNe,ENe,jNe,ANe,RNe,DNe,MNe,$Ne,FNe,nF,nF,rF,rF,PNe,LNe,ONe,zNe,BNe,WNe,VNe,UNe,HNe,GNe,qNe,KNe,XNe];for(let e of ZNe)iW(e);Pe().prototype.abs=function(){return this.throwIfDisposed(),zr(this)};Pe().prototype.acos=function(){return this.throwIfDisposed(),eT(this)};Pe().prototype.acosh=function(){return this.throwIfDisposed(),tT(this)};Pe().prototype.add=function(e){return this.throwIfDisposed(),$e(this,e)};Pe().prototype.all=function(e,t){return this.throwIfDisposed(),S1(this,e,t)};Pe().prototype.any=function(e,t){return this.throwIfDisposed(),hy(this,e,t)};Pe().prototype.argMax=function(e){return this.throwIfDisposed(),Dd(this,e)};Pe().prototype.argMin=function(e){return this.throwIfDisposed(),nT(this,e)};Pe().prototype.asScalar=function(){return this.throwIfDisposed(),H(this.size===1,()=>"The array must have only 1 element."),ue(this,[])};Pe().prototype.asType=function(e){return this.throwIfDisposed(),Xe(this,e)};Pe().prototype.as1D=function(){return this.throwIfDisposed(),ue(this,[this.size])};Pe().prototype.as2D=function(e,t){return this.throwIfDisposed(),ue(this,[e,t])};Pe().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),ue(this,[e,t,n])};Pe().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),ue(this,[e,t,n,r])};Pe().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),ue(this,[e,t,n,r,a])};Pe().prototype.asin=function(){return this.throwIfDisposed(),rT(this)};Pe().prototype.asinh=function(){return this.throwIfDisposed(),aT(this)};Pe().prototype.atan=function(){return this.throwIfDisposed(),sT(this)};Pe().prototype.atan2=function(e){return this.throwIfDisposed(),iT(this,e)};Pe().prototype.atanh=function(){return this.throwIfDisposed(),oT(this)};Pe().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Pl(this,e,t,n,r)};Pe().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),wb(this,e,t)};Pe().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),dp(this,e,t,n,r,a)};Pe().prototype.broadcastTo=function(e){return this.throwIfDisposed(),od(this,e)};Pe().prototype.cast=function(e){return this.throwIfDisposed(),Xe(this,e)};Pe().prototype.ceil=function(){return this.throwIfDisposed(),mT(this)};Pe().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Oa(this,e,t)};Pe().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof Zt&&(e=[e]),nr([this,...e],t)};Pe().prototype.conv1d=function(e,t,n,r,a,s){return this.throwIfDisposed(),C1(this,e,t,n,r,a,s)};Pe().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),_1(this,e,t,n,r,a)};Pe().prototype.conv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Ya(this,e,t,n,r,a,s)};Pe().prototype.cos=function(){return this.throwIfDisposed(),Nb(this)};Pe().prototype.cosh=function(){return this.throwIfDisposed(),I1(this)};Pe().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),fy(this,e,t,n)};Pe().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),T1(this,e,t,n)};Pe().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),NT(this,e,t)};Pe().prototype.depthwiseConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),hp(this,e,t,n,r,a,s)};Pe().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),kT(this,e,t,n,r,a)};Pe().prototype.divNoNan=function(e){return this.throwIfDisposed(),ST(this,e)};Pe().prototype.div=function(e){return this.throwIfDisposed(),ft(this,e)};Pe().prototype.dot=function(e){return this.throwIfDisposed(),CT(this,e)};Pe().prototype.elu=function(){return this.throwIfDisposed(),yg(this)};Pe().prototype.equal=function(e){return this.throwIfDisposed(),Fs(this,e)};Pe().prototype.erf=function(){return this.throwIfDisposed(),E1(this)};Pe().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),TT(this,e,t)};Pe().prototype.exp=function(){return this.throwIfDisposed(),La(this)};Pe().prototype.expandDims=function(e){return this.throwIfDisposed(),ga(this,e)};Pe().prototype.expm1=function(){return this.throwIfDisposed(),ET(this)};Pe().prototype.fft=function(){return this.throwIfDisposed(),Rb(this)};Pe().prototype.flatten=function(){return this.throwIfDisposed(),ue(this,[this.size])};Pe().prototype.floor=function(){return this.throwIfDisposed(),vg(this)};Pe().prototype.floorDiv=function(e){return this.throwIfDisposed(),k1(this,e)};Pe().prototype.gather=function(e,t,n){return this.throwIfDisposed(),wg(this,e,t,n)};Pe().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ol(this,e)};Pe().prototype.greater=function(e){return this.throwIfDisposed(),es(this,e)};Pe().prototype.ifft=function(){return this.throwIfDisposed(),qm(this)};Pe().prototype.irfft=function(){return this.throwIfDisposed(),V1(this)};Pe().prototype.isFinite=function(){return this.throwIfDisposed(),jT(this)};Pe().prototype.isInf=function(){return this.throwIfDisposed(),AT(this)};Pe().prototype.isNaN=function(){return this.throwIfDisposed(),RT(this)};Pe().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Sb(this,e)};Pe().prototype.lessEqual=function(e){return this.throwIfDisposed(),uc(this,e)};Pe().prototype.less=function(e){return this.throwIfDisposed(),Vm(this,e)};Pe().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),DT(this,e,t,n,r)};Pe().prototype.logSigmoid=function(){return this.throwIfDisposed(),MT(this)};Pe().prototype.logSoftmax=function(e){return this.throwIfDisposed(),R1(this,e)};Pe().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),_b(this,e,t)};Pe().prototype.log=function(){return this.throwIfDisposed(),Ps(this)};Pe().prototype.log1p=function(){return this.throwIfDisposed(),Cb(this)};Pe().prototype.logicalAnd=function(e){return this.throwIfDisposed(),_i(this,e)};Pe().prototype.logicalNot=function(){return this.throwIfDisposed(),Ib(this)};Pe().prototype.logicalOr=function(e){return this.throwIfDisposed(),D1(this,e)};Pe().prototype.logicalXor=function(e){return this.throwIfDisposed(),$T(this,e)};Pe().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),en(this,e,t,n)};Pe().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ua(this,e,t,n,r)};Pe().prototype.max=function(e,t){return this.throwIfDisposed(),Qs(this,e,t)};Pe().prototype.maximum=function(e){return this.throwIfDisposed(),Zo(this,e)};Pe().prototype.mean=function(e,t){return this.throwIfDisposed(),wr(this,e,t)};Pe().prototype.min=function(e,t){return this.throwIfDisposed(),Wm(this,e,t)};Pe().prototype.minimum=function(e){return this.throwIfDisposed(),Vu(this,e)};Pe().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),PT(this,e,t)};Pe().prototype.mod=function(e){return this.throwIfDisposed(),OT(this,e)};Pe().prototype.mul=function(e){return this.throwIfDisposed(),re(this,e)};Pe().prototype.neg=function(){return this.throwIfDisposed(),pr(this)};Pe().prototype.norm=function(e,t,n){return this.throwIfDisposed(),bg(this,e,t,n)};Pe().prototype.notEqual=function(e){return this.throwIfDisposed(),Fd(this,e)};Pe().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),Um(this,e,t,n)};Pe().prototype.onesLike=function(){return this.throwIfDisposed(),Os(this)};Pe().prototype.pad=function(e,t){return this.throwIfDisposed(),lo(this,e,t)};Pe().prototype.pool=function(e,t,n,r,a,s){return this.throwIfDisposed(),LT(this,e,t,n,r,a,s)};Pe().prototype.pow=function(e){return this.throwIfDisposed(),Uo(this,e)};Pe().prototype.prelu=function(e){return this.throwIfDisposed(),jb(this,e)};Pe().prototype.prod=function(e,t){return this.throwIfDisposed(),zT(this,e,t)};Pe().prototype.reciprocal=function(){return this.throwIfDisposed(),HT(this)};Pe().prototype.relu=function(){return this.throwIfDisposed(),Kn(this)};Pe().prototype.relu6=function(){return this.throwIfDisposed(),F1(this)};Pe().prototype.reshapeAs=function(e){return this.throwIfDisposed(),ue(this,e.shape)};Pe().prototype.reshape=function(e){return this.throwIfDisposed(),ue(this,e)};Pe().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),z6(this,e,t,n)};Pe().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),B6(this,e,t,n)};Pe().prototype.reverse=function(e){return this.throwIfDisposed(),ai(this,e)};Pe().prototype.rfft=function(){return this.throwIfDisposed(),Db(this)};Pe().prototype.round=function(){return this.throwIfDisposed(),P1(this)};Pe().prototype.rsqrt=function(){return this.throwIfDisposed(),O1(this)};Pe().prototype.selu=function(){return this.throwIfDisposed(),L1(this)};Pe().prototype.separableConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Ng(this,e,t,n,r,a,s)};Pe().prototype.sigmoid=function(){return this.throwIfDisposed(),wi(this)};Pe().prototype.sign=function(){return this.throwIfDisposed(),GT(this)};Pe().prototype.sin=function(){return this.throwIfDisposed(),z1(this)};Pe().prototype.sinh=function(){return this.throwIfDisposed(),B1(this)};Pe().prototype.slice=function(e,t){return this.throwIfDisposed(),pn(this,e,t)};Pe().prototype.softmax=function(e){return this.throwIfDisposed(),dc(this,e)};Pe().prototype.softplus=function(){return this.throwIfDisposed(),pp(this)};Pe().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Eb(this,e,t)};Pe().prototype.split=function(e,t){return this.throwIfDisposed(),hs(this,e,t)};Pe().prototype.sqrt=function(){return this.throwIfDisposed(),ba(this)};Pe().prototype.square=function(){return this.throwIfDisposed(),tr(this)};Pe().prototype.squaredDifference=function(e){return this.throwIfDisposed(),U1(this,e)};Pe().prototype.squeeze=function(e){return this.throwIfDisposed(),hc(this,e)};Pe().prototype.stack=function(e,t){this.throwIfDisposed();let n=e instanceof Zt?[this,e]:[this,...e];return Vr(n,t)};Pe().prototype.step=function(e){return this.throwIfDisposed(),mp(this,e)};Pe().prototype.stridedSlice=function(e,t,n,r,a,s,i,l){return this.throwIfDisposed(),qT(this,e,t,n,r,a,s,i,l)};Pe().prototype.sub=function(e){return this.throwIfDisposed(),dt(this,e)};Pe().prototype.sum=function(e,t){return this.throwIfDisposed(),kt(this,e,t)};Pe().prototype.tan=function(){return this.throwIfDisposed(),KT(this)};Pe().prototype.tanh=function(){return this.throwIfDisposed(),Wu(this)};Pe().prototype.tile=function(e){return this.throwIfDisposed(),Rs(this,e)};Pe().prototype.toBool=function(){return this.throwIfDisposed(),Xe(this,"bool")};Pe().prototype.toFloat=function(){return this.throwIfDisposed(),Xe(this,"float32")};Pe().prototype.toInt=function(){return this.throwIfDisposed(),Xe(this,"int32")};Pe().prototype.topk=function(e,t){return this.throwIfDisposed(),XT(this,e,t)};Pe().prototype.transpose=function(e){return this.throwIfDisposed(),tn(this,e)};Pe().prototype.unique=function(e){return this.throwIfDisposed(),ZT(this,e)};Pe().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Y1(this,e,t)};Pe().prototype.unstack=function(e){return this.throwIfDisposed(),Er(this,e)};Pe().prototype.where=function(e,t){return this.throwIfDisposed(),ya(e,this,t)};Pe().prototype.zerosLike=function(){return this.throwIfDisposed(),Nn(this)};var su=class vV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vV.prototype)}},Ao=class wV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,wV.prototype)}},me=class NV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,NV.prototype)}},sn=class kV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,kV.prototype)}},QNe=class SV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,SV.prototype)}},CV=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function Od(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{let n=new Array(t);return n.fill(e),n}}function Co(e,t){if(!e)throw new QNe(t)}function aF(e,t){let n=0;for(let r of e)r===t&&n++;return n}function ls(e){return e.length===1?e[0]:e}function qn(e){return Array.isArray(e)?e:[e]}function cl(e){let t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Fc(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}var li={};function gE(e){if(e==null)return null;let t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function uC(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>uC(t));else{let t=Object.keys(e);for(let n of t){let r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:uC(r))}}}function $b(e,t={},n={},r="object",a=!1){if(typeof e=="string"){let s=e,i;if(s in n)i=n[s];else if(s in li)i=li[s];else if(i=t[s],i==null)throw new me(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=e;if(s.className==null||s.config==null)throw new me(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,l,u;if(i in n?[l,u]=n[i]:i in li?[l,u]=li.className:i in t&&([l,u]=t[i]),l==null)throw new me(`Unknown ${r}: ${i}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(u!=null){let d={};for(let m of Object.keys(li))d[m]=li[m];for(let m of Object.keys(n))d[m]=n[m];let c=s.config;c.customObjects=d;let h=Object.assign({},li);for(let m of Object.keys(n))li[m]=n[m];uC(s.config);let p=u(l,s.config,n,a);return li=Object.assign({},h),p}else{let d=Object.assign({},li);for(let h of Object.keys(n))li[h]=n[h];let c=new l(s.config);return li=Object.assign({},d),c}}}function JNe(e,t){return e<t?-1:e>t?1:0}function Nv(e,t){return-1*JNe(e,t)}function ju(e){if(e==null)return e;let t=[];for(let n of e)t.indexOf(n)===-1&&t.push(n);return t}function eke(e){if(e==null)throw new me(`Invalid value in obj: ${JSON.stringify(e)}`);for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}function fp(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new me(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function xE(e,t,n=0,r=1/0){return Co(n>=0),Co(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(a=>typeof a===t)}function xa(e,t){Array.isArray(e)?(A.assert(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>xa(n,`element ${r+1} of ${t}`))):A.assert(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${_V(e)}.`)}function _V(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>_V(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function tke(e,t,n){let r=n!=null?n():A.now(),a;return(...s)=>{let i=n!=null?n():A.now();return i-r<t||(r=i,a=e(...s)),a}}function IV(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}var nke=0;function TV(){return nke++}var kv={};function nN(e=""){return e in kv||(kv[e]=0),kv[e]+=1,e+kv[e].toString()}var rke=["channelsFirst","channelsLast"],ake=["nearest","bilinear"],ske=["valid","same","causal"],ike=["max","avg"],oke=["sum","mul","concat","ave"],$p=new Map;function Pr(e){fp(rke,"DataFormat",e)}function lke(e){fp(ake,"InterpolationFormat",e)}function si(e){fp(ske,"PaddingMode",e)}function EV(e){fp(ike,"PoolMode",e)}var zx=[],sF="/";function ld(e,t){zx.push(e);try{let n=t();return zx.pop(),n}catch(n){throw zx.pop(),n}}function uke(){return zx.length===0?"":zx.join(sF)+sF}function jV(e){if(!RV(e))throw new Error("Not a valid tensor name: '"+e+"'");return uke()+e}function AV(e){if(!RV(e))throw new Error("Not a valid tensor name: '"+e+"'");$p.has(e)||$p.set(e,0);let t=$p.get(e);if($p.set(e,$p.get(e)+1),t>0){let n=`${e}_${t}`;return $p.set(n,1),n}else return e}var cke=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function RV(e){return!!e.match(cke)}function dke(e){return e===parseInt(e.toString(),10)}function Au(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function Ym(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r<t&&(t=r)}return t}function Hu(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r>t&&(t=r)}return t}function no(e,t){if(t<e)throw new me(`end (${t}) < begin (${e}) is forbidden.`);let n=[];for(let r=e;r<t;++r)n.push(r);return n}var oS;function Qr(){return oS==null&&(oS=XI().epsilon()),oS}function ro(){return"channelsLast"}function jl(e,t){return Xe(e,t)}function Fb(e,t=-1){let n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),ue(e,n)}function hke(e,t){return ce(()=>{if(e.shape.length!==2)throw new me(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);let n=Fb(e,1);return cC(n,[1,t,1])})}function pke(e){let t=[Au(e.shape)];return ue(e,t)}function mke(e){if(e.rank<=1)throw new me(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);let t=[e.shape[0],Au(e.shape,1)];return ue(e,t)}function ud(e,t,n){return ce(()=>{switch(e.rank){case 1:return Ab(e,t,n);case 2:return W1(e,[t,0],[n,e.shape[1]]);case 3:return kg(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Gm(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return pn(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return pn(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new me(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function lS(e,t,n){return ce(()=>{switch(e.rank){case 1:return Ab(e,t,n);case 2:return W1(e,[0,t],[e.shape[0],n]);case 3:return kg(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Gm(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new me(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function Sv(e,t,n,r){return ce(()=>{switch(e.rank){case 1:return Ab(e,t,n);case 2:switch(r){case 1:return ud(e,t,n);case 2:return lS(e,t,n);default:throw new me(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return ud(e,t,n);case 2:return kg(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return lS(e,t,n);default:throw new me(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return ud(e,t,n);case 2:return Gm(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Gm(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return lS(e,t,n);default:throw new me(`The axis is not within the rank of the tensor ${r}`)}default:throw new me(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function yE(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),nr(e,t)}function iF(e,t){switch(e.rank){case 1:return fT([e,t]);case 2:return gT([e,t],0);case 3:return xT([e,t],0);case 4:return yT([e,t],0);default:throw new me(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function cC(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new me(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return Rs(e,t)}function rN(e,t=0,n=1,r,a){return $1(e,t,n,r,a)}function zo(e,t,n,r){if(e.rank<2||t.rank<2)throw new sn(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){let a=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(a!==s)throw new sn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return Km.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?dC(e.rank,r,ro()):null,activation:n});{let a=e.shape.slice(),s=a.pop();e=ue(e,[-1,s]);let i=t.shape.slice(),l=i.pop(),u=i.pop(),d=[...i,l],c=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=ue(tn(t,c),[u,-1]);let h=[...a,...d];return ue(Km.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?dC(e.rank,r,ro()):null,activation:n}),h)}}function DV(e,t,n){return ce(()=>(Array.isArray(t)?t=Vn(t,"int32"):t=Xe(t,"int32"),wg(e,t,n)))}function Pb(e){return re(e,e)}function dC(e,t,n){let r=t.shape;if(t.rank!==1&&t.rank!==e)throw new me(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?ue(t,[1,r[0],1,1,1]):ue(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?ue(t,[1,1,1,1,r[0]]):ue(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?ue(t,[1,r[0],1,1]):ue(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?ue(t,[1,1,1,r[0]]):ue(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?ue(t,[1,r[0],1]):ue(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?ue(t,[1,1,r[0]]):ue(t,[1].concat(r))}else if(e<3)return t;throw new me(`Unsupported input rank by biasAdd: ${t.rank}`)}function uo(e,t,n){return ce(()=>(n==null&&(n=ro()),Pr(n),$e(e,dC(e.rank,t,n))))}function fke(e,t=1){if(t!==1)throw new sn(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return yg(e)}function gke(e){return ce(()=>ft(e,$e(zr(e),1)))}function MV(e,t,n,r){return ce(()=>eE(e,t,n,r))}function xke(e){return ce(()=>{let t=$e(.5,re(.2,e));return Oa(t,0,1)})}function Ob(e,t,n=!1){return n?e():t()}var yke=["fanIn","fanOut","fanAvg"],bke=["normal","uniform","truncatedNormal"];function vke(e){fp(yke,"FanMode",e)}function wke(e){fp(bke,"Distribution",e)}var ji=class extends Ve.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},bE=class extends ji{apply(e,t){return Nr(e,t)}};bE.className="Zeros";Ve.registerClass(bE);var aN=class extends ji{apply(e,t){return ds(e,t)}};aN.className="Ones";Ve.registerClass(aN);var vE=class extends ji{constructor(e){if(super(),typeof e!="object")throw new me(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new me(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return ce(()=>re(jt(this.value),ds(e,t)))}getConfig(){return{value:this.value}}};vE.className="Constant";Ve.registerClass(vE);var wE=class extends ji{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return cc(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}};wE.className="RandomUniform";Ve.registerClass(wE);var NE=class extends ji{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new sn(`randomNormal does not support dType ${t}.`);return rN(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};NE.className="RandomNormal";Ve.registerClass(NE);var kE=class extends ji{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new sn(`truncatedNormal does not support dType ${t}.`);return K1(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};kE.className="TruncatedNormal";Ve.registerClass(kE);var SE=class extends ji{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return ce(()=>{if(e.length!==2||e[0]!==e[1])throw new me("Identity matrix initializer can only be used for 2D square matrices.");return re(this.gain,j1(e[0]))})}getConfig(){return{gain:this.gain}}};SE.className="Identity";Ve.registerClass(SE);function Nke(e,t="channelsLast"){let n,r;if(Pr(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){let a=Au(e,2);n=e[1]*a,r=e[0]*a}else if(t==="channelsLast"){let a=Au(e,0,e.length-2);n=e[e.length-2]*a,r=e[e.length-1]*a}}else{let a=Au(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}var xs=class extends ji{constructor(e){if(super(),e.scale<0)throw new me(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,vke(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,wke(this.distribution),this.seed=e.seed}apply(e,t){let n=Nke(e),r=n[0],a=n[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,r):this.mode==="fanOut"?s/=Math.max(1,a):s/=Math.max(1,(r+a)/2),this.distribution==="normal"){let i=Math.sqrt(s);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new sn(`${this.getClassName()} does not support dType ${t}.`);return K1(e,0,i,t,this.seed)}else{let i=Math.sqrt(3*s);return cc(e,-i,i,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}};xs.className="VarianceScaling";Ve.registerClass(xs);var sN=class extends xs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xs.className}};sN.className="GlorotUniform";Ve.registerClass(sN);var iN=class extends xs{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xs.className}};iN.className="GlorotNormal";Ve.registerClass(iN);var oN=class extends xs{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xs.className}};oN.className="HeNormal";Ve.registerClass(oN);var lN=class extends xs{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xs.className}};lN.className="HeUniform";Ve.registerClass(lN);var uN=class extends xs{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xs.className}};uN.className="LeCunNormal";Ve.registerClass(uN);var cN=class extends xs{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xs.className}};cN.className="LeCunUniform";Ve.registerClass(cN);var CE=class extends ji{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return ce(()=>{if(e.length<2)throw new sn("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;let n=A.sizeFromShape(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);let s=[Math.max(r,n),Math.min(r,n)],i=rN(s,0,1,t,this.seed),l=aE.qr(i,!1),u=l[0],d=l[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return u=re(u,d.sign()),n<r&&(u=u.transpose()),re(jt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}};CE.className="Orthogonal";Ve.registerClass(CE);var oF={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function lF(e,t={}){return $b(e,Ve.SerializationMap.getMap().classNameMap,t,"initializer")}function Sr(e){return gE(e)}function br(e){if(typeof e=="string"){let t=e in oF?oF[e]:e;if(t==="GlorotNormal")return new iN;if(t==="GlorotUniform")return new sN;if(t==="HeNormal")return new oN;if(t==="HeUniform")return new lN;if(t==="LeCunNormal")return new uN;if(t==="LeCunUniform")return new cN;{let n={};return n.className=t,n.config={},lF(n)}}else return e instanceof ji?e:lF(e)}function hC(e){return Array.isArray(e)&&Array.isArray(e[0])}function o0(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Bt(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new me(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function En(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new me(`Expected exactly 1 Shape; got ${e.length}`)}else return e}function l0(e){let t=0;for(let n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,a)=>r*a);return t}var uF="Variable",$V=class{constructor(e,t="float32",n=uF,r=!0,a=null){this.dtype=t??"float32",this.shape=e.shape,this.id=TV(),n=n??uF,this.originalName=jV(n),this.name=AV(this.originalName),this.trainable_=r,this.constraint=a,this.val=QT(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),kke(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function kke(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function pC(e){return e.map(t=>t.read())}function _E(e){e.forEach(t=>{t[0].write(t[1])})}var Br=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},ao=class{constructor(e,t,n,r,a,s,i){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=i,this.id=TV(),s!=null&&(this.originalName=jV(s),this.name=AV(this.originalName)),this.rank=t.length}},Ske=0,dN=class{constructor(e,t){this.callArgs=t,this.id=Ske++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n!=null&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Cke=0,on=class extends Ve.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Cke++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){let n=this.getClassName();t=cl(n)+"_"+nN(n)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let a=null;e.batchSize!=null&&(a=e.batchSize),n=[a].concat(e.inputShape)}this.batchInputShape=n;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Ao(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new me(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ls(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ls(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new su(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new su(`Layer ${this.name} is not connected, no input to return.`);return ls(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new su(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new su(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ls(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){let t=qn(e);if(this.inputSpec==null||this.inputSpec.length===0)return;let n=qn(this.inputSpec);if(t.length!==n.length)throw new me(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){let a=t[r],s=n[r];if(s==null)continue;let i=a.rank;if(s.ndim!=null&&i!==s.ndim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${i}`);if(s.maxNDim!=null&&i>s.maxNDim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${i}`);if(s.minNDim!=null&&i<s.minNDim)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${i}.`);if(s.dtype!=null&&a.dtype!==s.dtype)throw new me(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${a.dtype}.`);if(s.axes){let l=a.shape;for(let u in s.axes){let d=Number(u),c=s.axes[u],h=d>=0?l[d]:l[l.length+d];if(c!=null&&[c,null].indexOf(h)===-1)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${c} but got shape ${l}.`)}}if(s.shape!=null)for(let l=0;l<s.shape.length;++l){let u=s.shape[l],d=a.shape[l];if(u!=null&&d!=null&&u!==d)throw new me(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${a.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();let n=qn(e),r=Tke(e),a=Eke(e);if(r===a)throw new me("Arguments to apply() must be all SymbolicTensors or all Tensors");return ld(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let s=[];for(let i of qn(e))s.push(i.shape);this.build(ls(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let s=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,s);let i=qn(s),l=[];for(let u of i)n.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(s=ls(l),this.activityRegularizer!=null)throw new sn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=_ke(e),i=this.computeOutputShape(s),l,u=Ike(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?s[0]:s),i!=null&&i.length>0&&Array.isArray(i[0])?l=i.map((d,c)=>new ao(u,d,this,qn(e),t,this.name,c)):l=new ao(u,i,this,qn(e),t,this.name),this.addInboundNode(e,l,null,null,s,i,t),this._refCount++,this.activityRegularizer!=null)throw new sn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,r)=>{n!=null&&e[r]!=null&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new su(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let t of this.inboundNodes){let n=JSON.stringify(t.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new su(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ao(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return l0(this.weights)}build(e){this.built=!0}getWeights(e=!1){return pC(e?this.trainableWeights:this.weights)}setWeights(e){ce(()=>{let t=this.weights;if(t.length!==e.length)throw new me(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;let n=[],r=pC(t);for(let a=0;a<r.length;++a){let s=r[a],i=t[a],l=e[a];if(!A.arraysEqual(s.shape,l.shape))throw new me(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);n.push([i,l])}_E(n)})}addWeight(e,t,n,r,a,s,i,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new me(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():br("zeros"));let u=r.apply(t,n),d=new $V(u,n,e,s,i);return u.dispose(),a!=null&&this.addLoss(()=>a.apply(d.read())),s==null&&(s=!0),s?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=qn(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;let r=this.computeMask(e,n),a=qn(t),s=qn(r);if(a.length!==s.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let i=0;i<a.length;i++)a[i].kerasMask=s[i]}addInboundNode(e,t,n,r,a,s,i=null){let l=qn(e);t=qn(t),n=qn(n),r=qn(r),a=o0(a),s=o0(s);let u=[],d=[],c=[];for(let h of l)u.push(h.sourceLayer),d.push(h.nodeIndex),c.push(h.tensorIndex);new dN({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:c,inputTensors:l,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:s},i);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function _ke(e){e=qn(e);let t=[];for(let n of e)t.push(n.shape);return ls(t)}function Ike(e){return"float32"}function FV(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{let r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{let a=[];for(let s=0;s<r.inboundLayers.length;s++){let i=r.inputTensors[s],l=r.inboundLayers[s],u=r.nodeIndices[s],d=FV(i,l,u);for(let c of d)a.indexOf(c)===-1&&a.push(c)}return a}}}function Tke(e){let t=!0;for(let n of qn(e))if(!(n instanceof ao)){t=!1;break}return t}function Eke(e){let t=!0;for(let n of qn(e))if(n instanceof ao){t=!1;break}return t}var Cg=class extends on{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:nN("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new me("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new me("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new me("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];let r=new ao(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new dN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new me(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}};Cg.className="InputLayer";Ve.registerClass(Cg);function PV(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new me("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new Cg({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function jke(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return Xe(t,e.dtype)}catch{throw new me(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}var Jp=class OV{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof OV)for(let n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(let n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=jke(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new me(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof ao){if(this.id2Value[t.id]==null)throw new me(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{let n=this.name2Id[t];if(n==null)throw new me(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof ao){if(this.id2Value[t.id]==null)throw new me(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{let n=this.name2Id[t];if(n==null)throw new me(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&qt(this.id2Mask)}},u0=new CV,c0=new CV;function Ake(e){u0!=null&&u0.setMaxEntries(e),c0!=null&&c0.setMaxEntries(e)}function bx(e,t,n,r){let a=n==null?!1:n.training,s=Array.isArray(e),i=s?e:[e],l=i.map(f=>f.name),u=[],d=t.names();for(let f of l)d.indexOf(f)!==-1?u.push(t.getValue(f)):u.push(null);let c=l.join(",")+"|"+t.names().sort().join(","),h=u0.get(c),p;if(h==null){let f=Rke(i,t);h=f.sorted,p=f.recipientCounts,u0.put(c,h),c0.put(c,p)}p={},a||Object.assign(p,c0.get(c));let m=new Jp(t);for(let f=0;f<h.length;++f){let g=h[f],x=g.sourceLayer;if(x instanceof Cg)continue;let y=[],b=[],v=[],w=!1;for(let T of g.inputs){let E=m.getValue(T),j=m.getMask(T);y.push(E),b.push(j),j!=null&&(w=!0),a||(p[T.name]--,p[T.name]===0&&!t.hasKey(T)&&l.indexOf(T.name)===-1&&!E.isDisposed&&T.sourceLayer.stateful!==!0&&v.push(E))}w&&(n=n||{},n.mask=b[0]);let N=qn(x.apply(y,n)),S=null;x.supportsMasking&&(S=x.computeMask(y,b));let C=Mke(g),_=Array.isArray(C)?C:[C];for(let T=0;T<_.length;++T){m.hasKey(_[T])||m.add(_[T],N[T],Array.isArray(S)?S[0]:S);let E=l.indexOf(_[T].name);E!==-1&&(u[E]=N[T])}a||qt(v)}return m.disposeMasks(),s?u:u[0]}function Rke(e,t){A.assert(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){let a=cF(e[0],t);n=a.sorted,r=a.recipientMap}else{let a=new Set;for(let s of e){let{sorted:i,recipientMap:l}=cF(s,t);for(let u of i)a.has(u.name)||(n.push(u),a.add(u.name));for(let u in l)r[u]==null&&(r[u]=new Set),l[u].forEach(d=>r[u].add(d))}}return{sorted:n,recipientCounts:Dke(r)}}function Dke(e){let t={};for(let n in e)t[n]=e[n].size;return t}function cF(e,t){let n=new Set,r=[],a={};for(let l of t.names())n.add(l);let s=[],i=[];for(s.push(e);s.length>0;){let l=s[s.length-1];if(n.has(l.name)){s.pop();continue}let u=i[i.length-1]===s.length-1;if(l.inputs.length===0||u)s.pop(),r.push(l),n.add(l.name),u&&i.pop();else{i.push(s.length-1);for(let d of l.inputs)a[d.name]==null&&(a[d.name]=new Set),a[d.name].add(l.name),!n.has(d.name)&&s.push(d)}}return{sorted:r,recipientMap:a}}function Mke(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(let a of e.sourceLayer.inboundNodes[r].outputTensors)if(a.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}var $ke=be();$ke.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Ake);var LV={};Kt(LV,{maxNorm:()=>Fke,minMaxNorm:()=>Lke,nonNeg:()=>Oke,unitNorm:()=>Pke});function IE(e,t){return ce(()=>ba(kt(re(e,e),t,!0)))}var Lb=class extends Ve.Serializable{getConfig(){return{}}},TE=class extends Lb{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>{let t=IE(e,this.axis),n=Oa(t,0,this.maxValue);return re(e,ft(n,$e(Qr(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}};TE.className="MaxNorm";Ve.registerClass(TE);var EE=class extends Lb{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>ft(e,$e(Qr(),IE(e,this.axis))))}getConfig(){return{axis:this.axis}}};EE.className="UnitNorm";Ve.registerClass(EE);var jE=class extends Lb{apply(e){return Kn(e)}};jE.className="NonNeg";Ve.registerClass(jE);var AE=class extends Lb{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ce(()=>{let t=IE(e,this.axis),n=$e(re(this.rate,Oa(t,this.minValue,this.maxValue)),re(1-this.rate,t));return re(e,ft(n,$e(Qr(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}};AE.className="MinMaxNorm";Ve.registerClass(AE);var dF={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ta(e){return gE(e)}function hF(e,t={}){return $b(e,Ve.SerializationMap.getMap().classNameMap,t,"constraint")}function na(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in dF?dF[e]:e,config:{}};return hF(t)}else return e instanceof Lb?e:hF(e)}function Fke(e){return new TE(e)}function Pke(e){return new EE(e)}function Oke(){return new jE}function Lke(e){return new AE(e)}var zV={};Kt(zV,{constant:()=>Wke,glorotNormal:()=>Yke,glorotUniform:()=>Kke,heNormal:()=>Xke,heUniform:()=>Zke,identity:()=>Gke,leCunNormal:()=>Qke,leCunUniform:()=>Jke,ones:()=>Bke,orthogonal:()=>eSe,randomNormal:()=>Uke,randomUniform:()=>Vke,truncatedNormal:()=>Hke,varianceScaling:()=>qke,zeros:()=>zke});function zke(){return new bE}function Bke(){return new aN}function Wke(e){return new vE(e)}function Vke(e){return new wE(e)}function Uke(e){return new NE(e)}function Hke(e){return new kE(e)}function Gke(e){return new SE(e)}function qke(e){return new xs(e)}function Kke(e){return new sN(e)}function Yke(e){return new iN(e)}function Xke(e){return new oN(e)}function Zke(e){return new lN(e)}function Qke(e){return new uN(e)}function Jke(e){return new cN(e)}function eSe(e){return new CE(e)}var BV={};Kt(BV,{Layer:()=>on,RNN:()=>Bl,RNNCell:()=>Bb,activation:()=>A2e,add:()=>z2e,alphaDropout:()=>kCe,average:()=>B2e,averagePooling1d:()=>Vj,averagePooling2d:()=>Uj,averagePooling3d:()=>Hj,avgPool1d:()=>X2e,avgPool2d:()=>Q2e,avgPool3d:()=>eCe,avgPooling1d:()=>Z2e,avgPooling2d:()=>J2e,avgPooling3d:()=>tCe,batchNormalization:()=>q2e,bidirectional:()=>fCe,categoryEncoding:()=>TCe,centerCrop:()=>_Ce,concatenate:()=>W2e,conv1d:()=>N2e,conv2d:()=>k2e,conv2dTranspose:()=>S2e,conv3d:()=>C2e,conv3dTranspose:()=>_2e,convLstm2d:()=>dCe,convLstm2dCell:()=>hCe,cropping2D:()=>T2e,dense:()=>R2e,depthwiseConv2d:()=>j2e,dot:()=>G2e,dropout:()=>D2e,elu:()=>g2e,embedding:()=>L2e,flatten:()=>$2e,gaussianDropout:()=>NCe,gaussianNoise:()=>wCe,globalAveragePooling1d:()=>nCe,globalAveragePooling2d:()=>rCe,globalMaxPool1d:()=>xCe,globalMaxPool2d:()=>yCe,globalMaxPooling1d:()=>VU,globalMaxPooling2d:()=>UU,gru:()=>sCe,gruCell:()=>iCe,input:()=>sU,inputLayer:()=>f2e,layerNormalization:()=>K2e,leakyReLU:()=>y2e,lstm:()=>oCe,lstmCell:()=>lCe,masking:()=>SCe,maxPool1d:()=>bCe,maxPool2d:()=>vCe,maxPooling1d:()=>HU,maxPooling2d:()=>GU,maxPooling3d:()=>aCe,maximum:()=>V2e,minimum:()=>U2e,multiply:()=>H2e,permute:()=>O2e,prelu:()=>b2e,randomWidth:()=>ECe,reLU:()=>x2e,repeatVector:()=>F2e,rescaling:()=>CCe,reshape:()=>P2e,resizing:()=>ICe,rnn:()=>pCe,separableConv2d:()=>I2e,simpleRNN:()=>uCe,simpleRNNCell:()=>cCe,softmax:()=>v2e,spatialDropout1d:()=>M2e,stackedRNNCells:()=>mCe,thresholdedReLU:()=>w2e,timeDistributed:()=>gCe,upSampling2d:()=>E2e,zeroPadding2d:()=>Y2e});async function tu(e){if(e==null)return;let t=[],n=[],r=[];for(let a in e){let s=e[a];if(typeof s!="number"){let i=s;t.push(i.data()),n.push(a),r.push(i)}}if(t.length>0){let a=await Promise.all(t);for(let s=0;s<a.length;++s)e[n[s]]=a[s][0];qt(r)}}function WV(e){if(e!=null)for(let t in e){let n=e[t];typeof n!="number"&&n.dispose()}}var pF;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(pF||(pF={}));var tSe=125,Xm=class{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}},VV=class{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(let t of this.callbacks)t.setParams(e)}setModel(e){for(let t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainEnd(e)}},nSe=class extends Xm{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});let n=t.size==null?0:t.size;this.seen+=n;for(let r in t){let a=t[r];if(typeof a=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+a*n;else{let s;r in this.totals?s=this.totals[r]:this.totals[r]=0;let i=ce(()=>$e(this.totals[r],re(a,n)));this.totals[r]=i,s!=null&&s.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?t[n]=this.totals[n]/this.seen:ce(()=>{let r=re(ft(1,this.seen),this.totals[n]);t[n]=r,this.totals[n].dispose(),Zr(t[n])}))}},UV=class extends Xm{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(let n in t)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){let e=[],t=[],n=[];for(let a in this.history){let s=this.history[a];for(let i=0;i<s.length;++i)if(typeof s[i]!="number"){let l=s[i];e.push(l.data()),t.push(a),n.push(i)}}let r=await Promise.all(e);for(let a=0;a<r.length;++a)this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}},HV=class extends Xm{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||mE,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=tSe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");A.isNumber(this.yieldEvery)&&(this.maybeWait=tke(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){let r=[];this.yield!=null&&(await tu(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await tu(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){let n=[];this.epochEnd!=null&&(await tu(t),n.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){this.batchBegin!=null&&(await tu(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){let n=[];this.batchEnd!=null&&(await tu(t),n.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):A.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await tu(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await tu(e),await this.trainEnd(e))}};function GV(e,t){return e==null&&(e={}),e instanceof Xm?[e]:Array.isArray(e)&&e[0]instanceof Xm?e:qn(e).map(n=>new HV(n,t))}var RE=class xo{constructor(){}static registerCallbackConstructor(t,n){A.assert(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),xo.checkForDuplicate(n),xo.constructors[t]==null&&(xo.constructors[t]=[]),xo.constructors[t].push(n)}static checkForDuplicate(t){for(let n in xo.constructors)xo.constructors[+n].forEach(r=>{if(r===t)throw new me("Duplicate callback constructor.")})}static clear(){xo.constructors={}}static createCallbacks(t){let n=[];for(let r in xo.constructors){let a=+r;t>=a&&n.push(...xo.constructors[a])}return n.map(r=>new r)}};RE.constructors={};function qV(e,t,n,r,a,s,i,l,u){let d=new UV,c=[new nSe,...RE.createCallbacks(t)];e!=null&&c.push(...e),c.push(d);let h=new VV(c);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:s,batchSize:i,verbose:t,doValidation:l,metrics:u}),{callbackList:h,history:d}}function Ji(e,t={},n=!1){return $b(e,Ve.SerializationMap.getMap().classNameMap,t,"layer",n)}function d0(e,t){return ce(()=>{e.dtype!=="float32"&&(e=Xe(e,"float32"));let n=kt(Pb(e),t,!0),r=$s(n.shape,Qr()),a=ba(Zo(n,r));return ft(e,a)})}function gp(e,t){return ce(()=>wr(Pb(dt(t,e)),-1))}function hN(e,t){return ce(()=>wr(zr(dt(t,e)),-1))}function _g(e,t){return ce(()=>{let n=dt(e,t),r=Oa(zr(e),Qr(),Number.MAX_VALUE),a=zr(ft(n,r));return re(100,wr(a,-1))})}function rSe(e,t){return ce(()=>{let n=Oa(t,Qr(),Number.MAX_VALUE),r=Ps($e(1,n)),a=Oa(e,Qr(),Number.MAX_VALUE),s=Ps($e(1,a));return wr(Pb(dt(r,s)),-1)})}function aSe(e,t){return ce(()=>{let n=Zo(0,dt(1,re(e,t)));return wr(Pb(n),-1)})}function sSe(e,t){return ce(()=>{let n=Zo(0,dt(1,re(e,t)));return wr(n,-1)})}function iSe(e,t){return ce(()=>{let n=kt(re(e,t),-1),r=Qs(re(dt(1,e),t),-1);return Zo(0,$e(1,dt(r,n)))})}function oSe(e,t){return ce(()=>{let n=Math.log(2),r=dt(t,e),a=dt($e(r,pp(re(-2,r))),n);return wr(a,-1)})}function gy(e,t,n=!1){return ce(()=>{if(n)t=dc(t);else{let r=kt(t,t.shape.length-1,!0);t=ft(t,r)}return t=Oa(t,Qr(),1-Qr()),pr(kt(re(Xe(e,"float32"),Ps(t)),t.shape.length-1))})}function h0(e,t,n=!1){return ce(()=>{let r=Xe(vg(pke(e)),"int32");t=Oa(t,Qr(),1-Qr());let a=t.shape,s=ue(Um(r,a[a.length-1]),a);return gy(s,t,n)})}function lSe(e,t){if(!A.arraysEqual(e.shape,t.shape))throw new me(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return ce(()=>{let n=Kn(t),r=pr(zr(t));return $e(dt(n,re(t,e)),Cb(La(r)))})}function pN(e,t){return ce(()=>{let n;return n=Oa(t,Qr(),1-Qr()),n=Ps(ft(n,dt(1,n))),wr(lSe(e,n),-1)})}function uSe(e,t){return ce(()=>{let n=Oa(e,Qr(),1),r=Oa(t,Qr(),1);return kt(re(e,Ps(ft(n,r))),-1)})}function cSe(e,t){return ce(()=>{let n=Ps($e(Qr(),t));return wr(dt(t,re(e,n)),-1)})}function DE(e,t){return ce(()=>{let n=d0(e,-1),r=d0(t,-1),a=re(n,r);return pr(kt(a,-1))})}var p0={meanSquaredError:gp,meanAbsoluteError:hN,meanAbsolutePercentageError:_g,meanSquaredLogarithmicError:rSe,squaredHinge:aSe,hinge:sSe,categoricalHinge:iSe,logcosh:oSe,categoricalCrossentropy:gy,sparseCategoricalCrossentropy:h0,binaryCrossentropy:pN,kullbackLeiblerDivergence:uSe,poisson:cSe,cosineProximity:DE};function uS(e){if(typeof e=="string"){if(e in p0)return p0[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new me(t)}else return e}function ME(e,t){return ce(()=>{let n=re(.5,Os(t)),r=jl(es(t,n),e.dtype);return wr(Fs(e,r),-1)})}function $E(e,t){return ce(()=>jl(Fs(Dd(e,-1),Dd(t,-1)),"float32"))}function KV(e,t){return ce(()=>Xe(kt(_i(Fs(e,1),Fs(t,1))),"float32"))}function dSe(e,t){return ce(()=>Xe(kt(_i(Fs(e,1),Fs(t,0))),"float32"))}function hSe(e,t){return ce(()=>Xe(kt(_i(Fs(e,0),Fs(t,1))),"float32"))}function YV(e,t){return ce(()=>{let n=KV(e,t),r=hSe(e,t),a=$e(n,r);return Xe(ya(es(a,0),ft(n,a),0),"float32")})}function pSe(e,t){return ce(()=>{let n=KV(e,t),r=dSe(e,t),a=$e(n,r);return Xe(ya(es(a,0),ft(n,a),0),"float32")})}function XV(e,t){return pN(e,t)}function ZV(e,t){return e.rank===t.rank&&(e=hc(e,[e.rank-1])),t=Dd(t,-1),t.dtype!==e.dtype&&(t=Xe(t,e.dtype)),Xe(Fs(e,t),"float32")}function mSe(e,t){return ce(()=>{let n=e.sub(t).square().sum(),r=e.sub(e.mean()).square().sum();return jt(1).sub(n.div(r))})}var fSe=gp,gSe=gp,xSe=hN,ySe=hN,bSe=_g,vSe=_g,FE=gy,wSe=DE,QV=h0,m0={binaryAccuracy:ME,categoricalAccuracy:$E,precision:YV,categoricalCrossentropy:FE,sparseCategoricalCrossentropy:QV,mse:fSe,MSE:gSe,mae:xSe,MAE:ySe,mape:bSe,MAPE:vSe,cosine:wSe};function NSe(e){if(typeof e=="string"&&e in m0)return m0[e];if(typeof e!="string"&&e!=null)return e;throw new me(`Unknown metric ${e}`)}function Cv(e){if(Co(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(let n of Object.keys(p0))if(p0[n]===e){t=n;break}if(t!==void 0)return t;for(let n of Object.keys(m0))if(m0[n]===e){t=n;break}return t!==void 0?t:e.name}}function kSe(e){let t={Adagrad:()=>jc.adagrad(.01),Adadelta:()=>jc.adadelta(1,.95,Qr()),Adam:()=>jc.adam(.001,.9,.999,Qr()),Adamax:()=>jc.adamax(.002,.9,.999,Qr(),0),RMSProp:()=>jc.rmsprop(.001,.9,0,Qr()),SGD:()=>jc.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new me(`Unknown Optimizer ${e}`)}function mF(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!mC(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){let r=JSON.stringify(e);r.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function mC(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){let t=Object.keys(e);for(let n of t)if(typeof n!="string"||!mC(e[n]))return!1;return!0}else if(Array.isArray(e)){for(let t of e)if(!mC(t))return!1;return!0}else return!1;else{let t=typeof e;return t==="string"||t==="number"||t==="boolean"}}function SSe(e,t,n,r=console.log){let a=_Se(e),s=["Layer (type)","Input Shape","Output shape","Param #"];a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(c=>Math.floor(t*c)));let i;if(!a){s.push("Receives inputs"),i=[];for(let c in e.nodesByDepth)i.push(...e.nodesByDepth[c])}r("_".repeat(t)),f0(s,n,r),r("=".repeat(t));let l=e.layers;for(let c=0;c<l.length;++c)a?ISe(l[c],n,r):TSe(l[c],n,i,r),r((c===l.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();let u=CSe(e),d=l0(e.nonTrainableWeights);r(`Total params: ${u+d}`),r(`Trainable params: ${u}`),r(`Non-trainable params: ${d}`),r("_".repeat(t))}function CSe(e){let t;return e.collectedTrainableWeights!=null?t=l0(e.collectedTrainableWeights):t=l0(e.trainableWeights),t}function _Se(e){let t=!0,n=[],r=[];for(let a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(let a of n){if(a.length>1||a.length===1&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(let a of e.layers){let s=!1;for(let i of a.inboundNodes)if(r.indexOf(i)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function f0(e,t,n=console.log){let r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function ISe(e,t,n){let r,a;try{a=e.inboundNodes.map(u=>JSON.stringify(u.inputShapes)).join(",")}catch{a="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}let s=e.name,i=e.getClassName(),l=[`${s} (${i})`,a,r,e.countParams().toString()];f0(l,t,n)}function TSe(e,t,n,r){let a,s;try{s=e.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{s="multiple"}try{a=JSON.stringify(e.outputShape)}catch{a="multiple"}let i=[];for(let h of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){let m=h.inboundLayers[p].name,f=h.nodeIndices[p],g=h.tensorIndices[p];i.push(`${m}[${f}][${g}]`)}let l=e.name,u=e.getClassName(),d=i.length===0?"":i[0],c=[`${l} (${u})`,s,a,e.countParams().toString(),d];f0(c,t,r);for(let h=1;h<i.length;++h)f0(["","","","",i[h]],t,r)}function JV(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function xy(e,t){if(e===null)return null;if(typeof e=="string")return Fc(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];JV(t,a,s)?n.push(s):n.push(xy(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r];if(r==="name"&&typeof a=="string")n[r]=a;else{let s=Fc(r);n[s]=xy(a,s)}}return n}}function fC(e,t){if(e==null)return null;if(typeof e=="string")return cl(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];JV(t,a,s)?n.push(s):n.push(fC(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r],s=cl(r);(r==="name"||r==="className")&&typeof a=="string"?n[s]=a:n[s]=fC(a,r)}return n}}var PE="4.22.0",ESe=e=>{let t=Object.keys(e);if(t.length===0)return!1;let n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))},jSe=class yo extends on{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let b=this.getClassName().toLowerCase();this.name=nN(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],ju(this.inputs).length!==this.inputs.length)throw new me(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);ju(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let b of this.outputs){let v=b.sourceLayer,w=b.nodeIndex,N=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(N)}for(let b of this.inputs){let v=b.sourceLayer,w=b.nodeIndex,N=b.tensorIndex;Co(w===0,"input layer has >1 nodes"),Co(N===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){let v=this.inputLayers[b];if(!(v instanceof Cg))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(let b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);let n={},r={},a={},s={},i={},l=[],u=(b,v,w,N,S,C)=>{(N==null||S==null||C==null)&&(N=b.sourceLayer,S=b.nodeIndex,C=b.tensorIndex);let _=N.inboundNodes[S];if(w.indexOf(_)!==-1)throw new Ao(`The tensor ${b.name} at layer "${N.name}" is part of a cycle.`);if(v.indexOf(_)!==-1)return;this.containerNodes.add(yo.nodeKey(N,S)),N.id in i||(i[N.id]=Object.keys(i).length),w.indexOf(_)===-1&&w.push(_);let T=_.inboundLayers.length;for(let E=0;E<T;E++){let j=_.inputTensors[E],I=_.inboundLayers[E],D=_.nodeIndices[E],F=_.tensorIndices[E];u(j,v,w,I,D,F)}for(v.push(_);w.indexOf(_)>=0;)w.splice(w.indexOf(_),1);l.push(_)},d=[],c=[];for(let b of this.outputs)u(b,d,c);let h=l.slice().reverse();for(let b of h){r[b.id]=b,b.id in n||(n[b.id]=0);let v=n[b.id],w=a[b.outboundLayer.id]==null?0:a[b.outboundLayer.id];v=Math.max(v,w),a[b.outboundLayer.id]=v,s[b.outboundLayer.id]=b.outboundLayer,n[b.id]=v;for(let N=0;N<b.inboundLayers.length;N++){let S=b.inboundLayers[N],C=b.nodeIndices[N],_=S.inboundNodes[C],T=n[_.id]==null?0:n[_.id];n[_.id]=Math.max(v+1,T),r[_.id]=_}}let p={};for(let b in n){let v=n[b];v in p||(p[v]=[]),p[v].push(r[b])}let m={};for(let b in a){let v=a[b];v in m||(m[v]=[]),m[v].push(s[b])}let f=Object.keys(m).map(b=>parseInt(b,10)).sort(Nv);this.layers=[];for(let b of f){let v=m[b];v.sort((w,N)=>{let S=i[w.id],C=i[N.id];return S<C?-1:S>C?1:0});for(let w of v)w instanceof yo&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=m,f=Object.keys(p).map(b=>parseInt(b,10)).sort(Nv);let g=this.inputs.slice(),x=[];for(let b of f)for(let v of p[b]){let w=v.outboundLayer;if(w!=null){for(let N of v.inputTensors)if(g.indexOf(N)===-1)throw new Ao(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(let N of v.outputTensors)g.push(N);x.push(w.name)}}this.nodesByDepth=p;let y=this.layers.map(b=>b.name);for(let b of y){let v=y.filter(w=>w===b).length;if(v!==1)throw new Ao(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new dN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(let n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new me("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){let r={},a=0,s=ESe(t);s&&this.parseWeights(t);for(let l of this.layers)for(let[u,d]of l.weights.entries()){let c=s?`${d.name.split("/").slice(0,-1).join("/")+"/"}${u}`:d.originalName;if(r[c]!=null)throw new me(`Duplicate weight name: ${c}`);r[c]=d,a++}let i=[];for(let l in t){let u=l;if(r[l]==null){let d=l.split("/");u=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(r[u]!=null)i.push([r[u],t[l]]);else if(n)throw new me(`Provided weight data has no target variable: ${l}`);delete r[u]}if(n){let l=[];for(let u in r)l.push(u);if(l.length>0)throw new me(`${l.length} of ${a} weights are not set: ${l}`)}_E(i)}parseWeights(t){for(let n in Object.keys(t)){let r=n.split("/"),a=["vars","layer_checkpoint_dependencies"],s=r.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!a.includes(i)).join("/");s!==n&&(t[s]=t[n],delete t[n])}}updatedConfig(){let t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${PE}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){let r=fC(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return ce(()=>{t=qn(t);let r=new Jp;for(let a=0;a<this.inputs.length;++a)r.add(this.inputs[a],t[a]);return bx(this.outputs,r,n)})}computeMask(t,n){return ce(()=>{t=qn(t);let r;return n==null?r=Od(null,t.length):r=qn(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){let n=o0(t);if(n.length!==this.inputLayers.length)throw new me(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let l=0;l<n.length;l++){let u=this.inputLayers[l],d=n[l],c=u.name+"_0_0";r[c]=d}let a=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Nv);if(a.length>1)for(let l of a){let u=this.nodesByDepth[l];for(let d of u){let c=d.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(c.id)!==-1)continue;let h=[];for(let g=0;g<d.inboundLayers.length;g++){let x=d.inboundLayers[g],y=d.nodeIndices[g],b=d.tensorIndices[g],v=`${x.name}_${y}_${b}`,w=r[v];h.push(w)}let p=c.computeOutputShape(ls(h)),m=o0(p),f=c.inboundNodes.indexOf(d);for(let g=0;g<m.length;g++){let x=`${c.name}_${f}_${g}`;r[x]=m[g]}}}let s=[],i=[];for(let l=0;l<this.outputLayers.length;l++){let u=this.outputLayers[l],d=this.outputLayersNodeIndices[l],c=this.outputLayersTensorIndices[l],h=`${u.name}_${d}_${c}`;i.push(h)}for(let l=0;l<i.length;l++){let u=i[l];Co(u in r),s.push(r[u])}return ls(s)}runInternalGraph(t,n){n==null&&(n=Od(null,t.length));let r={};for(let u=0;u<this.inputs.length;++u){let d=this.inputs[u],c=t[u],h=n[u];r[d.id]=[c,h]}let a=Object.keys(this.nodesByDepth).map(u=>parseInt(u,10)).sort(Nv);for(let u of a){let d=this.nodesByDepth[u];for(let c of d){let h=c.outboundLayer,p=c.inputTensors,m=c.outputTensors,f=new Array;for(let g of p)g.id in r&&f.push(r[g.id]);if(f.length===p.length){let g={},x,y,b,v;if(c.callArgs!=null&&(g=c.callArgs),f.length===1){let[w,N]=f[0];g.mask==null&&(g.mask=N),b=qn(h.call(w,g)),v=qn(h.computeMask(w,N)),x=[w],y=[N]}else x=f.map(w=>w[0]),y=f.map(w=>w[1]),g.mask==null&&(g.mask=y),b=qn(h.call(x,g)),v=qn(h.computeMask(x,y));if(h.activityRegularizer)throw new sn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<m.length;++w){let N=m[w],S=b[w],C=v[w];r[N.id]=[S,C]}}}}let s=[],i=[],l=[];for(let u of this.outputs){Co(u.id in r,`Could not compute output ${u.name} : ${u.id}`);let[d,c]=r[u.id];l.push(d.shape),s.push(d),i.push(c)}return[s,i,l]}buildNodeConversionMap(t){let n={},r;for(let a of this.layers){r=a instanceof yo?1:0;for(let s=0;s<a.inboundNodes.length;s++){let i=yo.nodeKey(a,s);this.containerNodes.has(i)&&(n[i]=r,r+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new me("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(let r of this.layers)if(r.name===t)return r;throw new me(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new me(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return ce(()=>{let t=[];for(let n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){let a=yo.nodeKey(n,r);this.containerNodes.has(a)&&t.push(...n.calculateLosses())}return t})}getConfig(){let t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(let i of this.layers){let l=i.getClassName(),u=i.getConfig(),d=[];for(let h=0;h<i.inboundNodes.length;h++){let p=i.inboundNodes[h],m=yo.nodeKey(i,h),f={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(p.inboundLayers.length>0){let g=[];for(let x=0;x<p.inboundLayers.length;x++){let y=p.inboundLayers[x],b=p.nodeIndices[x],v=p.tensorIndices[x],w=yo.nodeKey(y,b),N=n[w];N==null&&(N=0),g.push([y.name,N,v,f])}d.push(g)}}}let c={};c.name=i.name,c.className=l,c.config=u,c.inboundNodes=d,r.push(c)}t.layers=r;let a=[];for(let i=0;i<this.inputLayers.length;i++){let l=this.inputLayers[i],u=this.inputLayersNodeIndices[i],d=yo.nodeKey(l,u);if(!this.containerNodes.has(d))continue;let c=n[d];c==null&&(c=0);let h=this.inputLayersTensorIndices[i];a.push([l.name,c,h])}t.inputLayers=a;let s=[];for(let i=0;i<this.outputLayers.length;i++){let l=this.outputLayers[i],u=this.outputLayersNodeIndices[i],d=yo.nodeKey(l,u);if(!this.containerNodes.has(d))continue;let c=n[d];c==null&&(c=0);let h=this.outputLayersTensorIndices[i];s.push([l.name,c,h])}return t.outputLayers=s,t}static fromConfig(t,n,r={},a=!1){let s={},i={};function l(x,y){x.name in i?i[x.name].push(y):i[x.name]=[y]}function u(x,y){let b=[],v;for(let w of y){let N=w[0],S=w[1],C=w[2];if(v=w[3]==null?{}:w[3],!(N in s)){l(x,y);return}let _=s[N];if(_.inboundNodes.length<=S){l(x,y);return}let T=_.inboundNodes[S];b.push(T.outputTensors[C])}b.length>0&&x.apply(ls(b),v)}function d(x){let y=x.name,b=Ji(x,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(a),s[y]=b,x.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new me(`Corrupted configuration, expected array for nodeData: ${v}`);l(b,v)})}let c=n.name,h=n.layers;for(let x of h)d(x);for(;!eke(i);)for(let x of h){let y=s[x.name];if(y.name in i){let b=i[y.name];delete i[y.name];for(let v of b)u(y,v)}}let p=[],m=[],f=n.inputLayers;for(let x of f){let y=x[0],b=x[1],v=x[2];Co(y in s);let w=s[y].inboundNodes[b].outputTensors;p.push(w[v])}let g=n.outputLayers;for(let x of g){let y=x[0],b=x[1],v=x[2];Co(y in s);let w=s[y].inboundNodes[b].outputTensors;m.push(w[v])}return new t({inputs:p,outputs:m,name:c})}get stateful(){if(this._stateful)throw new me("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){ce(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}};function ASe(e,t,n){let r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(a=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){let a=[];return t.forEach(s=>{s in e?a.push(e[s]):a.push(null)}),a}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function eU(e,t){return ASe(e,t,"classWeight")}async function tU(e,t,n,r){if(n!=null){let a=ce(()=>{if(e.shape.length===1)return Oo(e);if(e.shape.length===2){if(e.shape[1]>1)return Dd(e,1);if(e.shape[1]===1)return ue(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await a.data());qt(a);let i=[];return s.forEach(l=>{if(n[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);i.push(n[l])}),Vn(i,"float32")}else return null}function RSe(e,t){return re(e,t)}var DSe=32;function nU(e,t){let n,r,a=t;n=a.xs,r=a.ys,A.assert(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let s=fF("input",e.inputNames,n),i=fF("output",e.outputNames,r),l=s[0].shape[0];A.assert(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),A.assert(i.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let u=0;u<s.length;u++)A.assert(s[u].shape[0]===l,()=>`Batch size mismatch: input ${e.inputNames[u]} has ${s[u].shape[0]}; expected  ${l} based on input ${e.inputNames[0]}.`);for(let u=0;u<i.length;u++)A.assert(i[u].shape[0]===l,()=>`Batch size mismatch: output ${e.outputNames[u]} has ${i[u].shape[0]}; expected  ${l} based on input ${e.inputNames[0]}.`);return{xs:s,ys:i}}function fF(e,t,n){if(n instanceof Zt)return[n];if(Array.isArray(n))return A.assert(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{let r=[];for(let a of t){if(n[a]==null)throw new me(`The feature data generated by the dataset lacks the required ${e} key '${a}'.`);r.push(n[a])}return r}}function MSe(e){if(e.length===3)throw new sn("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function $Se(e,t,n){let r=n.batchesPerEpoch!=null;if(A.assert(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),A.assert(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),A.assert(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),A.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),A.assert(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{let a=n.validationData!=null,s,i;if(a)if(gF(n.validationData))A.assert(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{let x=MSe(n.validationData);s=x.xs,i=x.ys}let l=e.makeTrainFunction(),u=e.getDedupedMetricsNames(),d;a?d=u.slice().concat(u.map(x=>"val_"+x)):d=u.slice();let c=GV(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:p,history:m}=qV(c,h,n.epochs,null,null,FSe(t,n),null,a,d);p.setModel(e),e.history=m,await p.onTrainBegin(),e.stopTraining_=!1;let f=n.initialEpoch==null?0:n.initialEpoch,g=await t.iterator();for(;f<n.epochs;){let x={};await p.onEpochBegin(f);let y=0,b=0;for(r||(g=await t.iterator());!r||y<n.batchesPerEpoch;){let v=await g.next();if(r&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){let{xs:w,ys:N}=nU(e,v.value),S={};S.batch=b,S.size=w[0].shape[0],await p.onBatchBegin(b,S);let C=[];if(n.classWeight!=null){let E=eU(n.classWeight,e.outputNames);for(let j=0;j<E.length;++j)C.push(await tU(N[j],null,E[j]))}let _=w.concat(N).concat(C),T=l(_);qt(_);for(let E=0;E<u.length;++E){let j=u[E],I=T[E];S[j]=I,Zr(I)}await p.onBatchEnd(b,S),WV(S),b++,y++}if(r?y>=n.batchesPerEpoch:v.done){if(a){let w;gF(n.validationData)?w=qn(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):w=qn(e.evaluate(s,i,{batchSize:n.validationBatchSize==null?DSe:n.validationBatchSize,verbose:0}));for(let N=0;N<e.metricsNames.length;++N)x[`val_${e.metricsNames[N]}`]=w[N]}break}if(e.stopTraining_)break}if(await p.onEpochEnd(f,x),f++,e.stopTraining_)break}return await p.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function FSe(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function gF(e){return typeof e.iterator=="function"}function PSe(e){return typeof e.next=="function"}async function OSe(e,t,n){n=n||{};let r=n.batches!=null,a=e.testFunction,s=[];if(n.verbose>0)throw new sn("Verbose mode is not implemented yet.");A.assert(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);let i=PSe(t)?t:await t.iterator(),l=0,u=0;for(;!r||u<n.batches;){let d=await i.next();if(s=ce(()=>{if(d.value){let{xs:c,ys:h}=nU(e,d.value),p=c.concat(h),m=ce(()=>a(p));if(qt(p),u===0)for(let g=0;g<m.length;++g)s.push(jt(0));let f=p[0].shape[0];for(let g=0;g<m.length;++g){let x=m[g],y=s[g];s[g]=ce(()=>$e(s[g],re(f,x))),u>0&&qt(y)}qt(m),l+=f,++u}return s}),d.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let d=0;d<s.length;++d){let c=s[d];s[d]=ft(s[d],l),qt(c)}return ls(s)}function cS(e){A.assert(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function sx(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>ud(r,t,n-t)):ud(e,t,n-t)}function gC(e,t){return ce(()=>e==null?null:Array.isArray(e)?e.map(n=>gC(n,t)):DV(e,t.dtype==="int32"?t:Xe(t,"int32")))}function dS(e,t){let n=[],r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function rU(e){let t=[];e instanceof Zt&&(e=[e]);for(let n=0;n<e.length;++n){let r=e[n];if(r.rank===1)t.push(Fb(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Li(e,t){if(e==null)return;let n=[];if(t instanceof Zt)n.push(t.id);else if(Array.isArray(t))t.forEach(a=>n.push(a.id));else if(t!=null)for(let a in t){let s=t[a];n.push(s.id)}let r=[];if(e instanceof Zt)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(a=>{n.indexOf(a.id)===-1&&r.push(a)});else if(e!=null)for(let a in e){let s=e[a];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(a=>{a.isDisposed||a.dispose()})}function LSe(e){return e instanceof Zt}function xC(e){return Array.isArray(e)}function xF(e){return!LSe(e)&&!xC(e)}function yF(e,t,n,r=!0,a=""){if(t==null||t.length===0){if(e!=null){let i=!1;if(xC(e)&&e.length>0)i=!0;else if(xF(e)){for(let l in e)if(e.hasOwnProperty(l)){i=!0;break}}else i=!0;if(i)throw new me(`Error when checking model ${a} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(i=>null);let s;if(xF(e)){e=e,s=[];for(let i of t){if(e[i]==null)throw new me(`No data provided for "${i}". Need data for each key in: ${t}`);s.push(e[i])}}else if(xC(e)){if(e=e,e.length!==t.length)throw new me(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new me(`The model ${a} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=rU(s),n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;let l=s[i];if(l.shape.length!==n[i].length)throw new me(`Error when checking ${a}: expected ${t[i]} to have ${n[i].length} dimension(s). but got array with shape ${l.shape}`);for(let u=0;u<n[i].length;++u){if(u===0&&!r)continue;let d=l.shape[u],c=n[i][u];if(c!=null&&c>=0&&d!==c)throw new me(`${a} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${a} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return s}function zSe(e,t,n){let r=ju(e.map(s=>s.shape[0]));r.sort();let a=ju(t.map(s=>s.shape[0]));if(a.sort(),r.length>1)throw new me(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(a.length>1)throw new me(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&a.length>0&&!A.arraysEqual(r,a))throw new me(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${a[0]} target sample(s).`)}function BSe(e,t,n){let r=[gp,pN,gy];for(let a=0;a<e.length;++a){let s=e[a],i=t[a],l=n[a];if(i!=null){if(i===gy&&s.shape[s.shape.length-1]===1)throw new me(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(i)!==-1){let u=s.shape.slice(1),d=l.slice(1);for(let c=0;c<u.length;++c){let h=u[c],p=d[c];if(p!=null&&h!==p)throw new me(`A target Tensor with shape ${s.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function bF(e,t,n,r=!0,a=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new me(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new me(`The model expects ${t.length} ${a} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let i=0;i<t.length;++i){if(n[i]==null)continue;let l=s[i];if(l.shape.length!==n[i].length)throw new me(`Error when checking ${a}: expected ${t[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let u=0;u<n[i].length;++u){if(u===0&&!r)continue;let d=l.shape[u],c=n[i][u];if(c!=null&&c!==d)throw new me(`Error when checking ${a}: expected ${t[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function WSe(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{let r=[];for(let a of t){let s=n.hasOwnProperty(a)?n[a]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}var VSe="layers-model",wl=class extends jSe{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new me("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");SSe(this,e,t,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=kSe(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof zl))throw new me("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let s in e.loss)if(this.outputNames.indexOf(s)===-1)throw new me(`Unknown entry in loss dictionary: "${s}". Only expected the following keys: ${this.outputNames}`);for(let s of this.outputNames)e.loss[s]==null&&console.warn(`Output "${s}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${s} during training`),t.push(uS(e.loss[s]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new me(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(s=>uS(s))}else{let s=uS(e.loss);this.outputs.forEach(i=>{t.push(s)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){let i=this.internalOutputShapes[s],l=this.outputNames[s];this.feedOutputNames.push(l),this.feedOutputShapes.push(i),this.feedLossFns.push(this.lossFunctions[s])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ld("loss",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let i=this.lossFunctions[s];this.outputs.length>1&&(this.metricsTensors.push([i,s]),this.metricsNames.push(this.outputNames[s]+"_loss"))}});let r=WSe(e.metrics,this.outputNames),a=(s,i,l)=>{this.outputNames.length>1&&(i=this.outputNames[s]+"_"+i),this.metricsNames.push(i),this.metricsTensors.push([l,s])};ld("metric",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let i=r[s];(l=>{let u="",d,c,h;for(let p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){let f=this.internalOutputShapes[s];f[f.length-1]===1||this.lossFunctions[s]===pN?["accuracy","acc"].indexOf(p)!==-1?c=ME:["crossentropy","ce"].indexOf(p)!==-1&&(c=XV):this.lossFunctions[s]===h0?["accuracy","acc"].indexOf(p)!==-1?c=ZV:["crossentropy","ce"].indexOf(p)!==-1&&(c=QV):["accuracy","acc"].indexOf(p)!==-1?c=$E:["crossentropy","ce"].indexOf(p)!==-1&&(c=FE);let g;["accuracy","acc"].indexOf(p)!==-1?g="acc":["crossentropy","ce"].indexOf(p)!==-1&&(g="ce"),h=c,d=u+g}else h=NSe(p),d=u+Cv(p);let m;ld(d,()=>{m=h}),a(s,d,m)}})(i)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){let r=n.batchSize==null?32:n.batchSize;cS(r);let a=this.standardizeUserDataXY(e,t,!0,r);try{let s=a[0].concat(a[1]);this.makeTestFunction();let i=this.testFunction,l=this.testLoop(i,s,r,n.verbose,n.steps);return ls(l)}finally{Li(a[0],e),Li(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),OSe(this,e,t)}checkNumSamples(e,t,n,r="steps"){let a;if(n!=null){if(a=null,t!=null)throw new me(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?a=e[0].shape[0]:a=e.shape[0];else throw new me(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return a}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new me("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),s=new Jp;if(e instanceof Zt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new me(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)s.add(this.inputs[l],e[l])}else for(let l of this.inputs){let u=e[l.name];if(u==null)throw new me(`No value is provided for the model's input ${l.name}`);s.add(l,u)}let i=bx(a,s);return n?i:i[0]}retrieveSymbolicTensors(e){let t=Od(null,e.length),n=e.length;for(let r of this.layers){let a=Array.isArray(r.output)?r.output:[r.output],s=a.map(i=>i.name);for(let i=0;i<e.length;++i){let l=s.indexOf(e[i]);if(l!==-1&&(t[i]=a[l],n--),n===0)break}if(n===0)break}if(n>0){let r=[];throw t.forEach((a,s)=>{a==null&&r.push(e[s])}),new me(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,n=!1){return ce(()=>{let r=this.checkNumSamples(e);if(n)throw new sn("Verbose predictLoop() is not implemented yet.");let a=dS(r,t),s=this.outputs.map(i=>[]);for(let i=0;i<a.length;++i)ce(()=>{let l=a[i][0],u=a[i][1],d=sx(e,l,u),c=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)c.push({key:this.inputs[p],value:d[p]});else c.push({key:this.inputs[0],value:d});let h=new Jp(c);return bx(this.outputs,h)}).forEach((l,u)=>s[u].push(l));return ls(s.map(i=>nr(i,0)))})}predict(e,t={}){let n=rU(e);bF(n,this.inputNames,this.feedInputShapes,!1);try{let r=t.batchSize==null?32:t.batchSize;return cS(r),this.predictLoop(n,r)}finally{Li(n,e)}}predictOnBatch(e){bF(e,this.inputNames,this.feedInputShapes,!0);let t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(this.optimizer_==null)throw new Ao("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let a=[];for(let s=0;s<this.feedOutputShapes.length;++s){let i=this.feedOutputShapes[s];this.feedLossFns[s]===h0?a.push(i.slice(0,i.length-1).concat([1])):a.push(i)}if(e=yF(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=yF(t,this.feedOutputNames,a,!1,"target"),zSe(e,t),BSe(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new me(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,a=!0,s){let[i,l]=this.standardizeUserDataXY(e,t,a,s);if(n!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){let d=eU(r,this.outputNames);u=[];for(let c=0;c<d.length;++c)u.push(await tU(l[c],null,d[c]))}return[i,l,u]}testLoop(e,t,n,r=0,a){return ce(()=>{let s=this.checkNumSamples(t,n,a,"steps"),i=[];if(r>0)throw new sn("Verbose mode is not implemented yet.");if(a!=null)throw new sn("steps mode in testLoop() is not implemented yet");{let l=dS(s,n),u=Vn(no(0,s));for(let d=0;d<l.length;++d){let c=l[d][0],h=l[d][1],p=ud(u,c,h-c),m=gC(t,p),f=e(m);if(d===0)for(let g=0;g<f.length;++g)i.push(jt(0));for(let g=0;g<f.length;++g){let x=f[g];i[g]=$e(i[g],re(h-c,x))}}for(let d=0;d<i.length;++d)i[d]=ft(i[d],s)}return i})}getDedupedMetricsNames(){let e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){let r=e[n],a=r;if(aF(e,r)>1){let s=aF(e.slice(0,n),r);a+=`_${s}`}t.push(a)}return t}makeTrainFunction(){return e=>{let t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),s=[],i=()=>{let u=[];for(let p=0;p<this.inputs.length;++p)u.push({key:this.inputs[p],value:n[p]});let d=new Jp(u),c=bx(this.outputs,d,{training:!0}),h;for(let p=0;p<this.lossFunctions.length;++p){let m=this.lossFunctions[p],f=m(r[p],c[p]);a[p]!=null&&(f=RSe(f,a[p]));let g=wr(f);t.push(g),p===0?h=f:h=$e(h,f)}for(let p=0;p<this.metricsTensors.length;++p){let m;if(this.outputs.length>1&&p<this.outputs.length)m=t[p];else{let f=this.metricsTensors[p][0],g=this.metricsTensors[p][1];m=wr(f(r[g],c[g]))}Zr(m),s.push(m)}return h=wr(h),this.calculateLosses().forEach(p=>{h=$e(h,p)}),h},l=this.collectedTrainableWeights.map(u=>u.read());return[this.optimizer_.minimize(i,!0,l)].concat(s)}}makeTestFunction(){this.testFunction=e=>ce(()=>{let t=[],n,r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let u=0;u<this.inputs.length;++u)s.push({key:this.inputs[u],value:r[u]});let i=new Jp(s),l=bx(this.outputs,i);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],c=wr(d(a[u],l[u]));u===0?n=c:n=$e(n,c),t.push(n)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],c=this.metricsTensors[u][1],h=wr(d(a[c],l[c]));t.push(h)}return t})}async fit(e,t,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,a,s,i,l,u,d,c,h;try{let p=n.batchSize==null?32:n.batchSize;cS(p);let m=await this.standardizeUserData(e,t,n.sampleWeight,n.classWeight,!1,p);r=m[0],a=m[1],h=m[2];let f=!1,g;if(n.validationData!=null&&n.validationData.length>0){if(f=!0,n.validationData.length===2)l=n.validationData[0],u=n.validationData[1];else throw n.validationData.length===3?new sn("validationData including sample weights is not supported yet."):new me(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let S=await this.standardizeUserData(l,u,null,null,!0,p);d=S[0],c=S[1],g=d.concat(c)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){f=!0;let S=Math.floor(r[0].shape[0]*(1-n.validationSplit)),C=r[0].shape[0];d=sx(r,S,C),s=r,r=sx(r,0,S),c=sx(a,S,C),i=a,a=sx(a,0,S),g=d.concat(c)}else n.validationSteps!=null&&(f=!0);let x=r.concat(a).concat(h);this.checkTrainableWeightsConsistency();let y=this.makeTrainFunction(),b=this.getDedupedMetricsNames(),v,w;f?(this.makeTestFunction(),v=this.testFunction,w=b.slice().concat(b.map(S=>"val_"+S))):(v=null,g=[],w=b.slice());let N=GV(n.callbacks,n.yieldEvery);return await this.fitLoop(y,x,b,p,n.epochs,n.verbose,N,v,g,n.shuffle,w,n.initialEpoch,null,null)}finally{this.isTraining=!1,Li(r,e),Li(a,t),Li(s,e),Li(i,t),Li(d,l),Li(c,u),h!=null&&qt(h)}}async fitLoop(e,t,n,r,a,s,i,l,u,d,c,h,p,m){r==null&&(r=32),a==null&&(a=1),d==null&&(d=!0),h==null&&(h=0);let f=!1;if(l!=null&&u!=null&&(f=!0),m!=null&&(f=!0,p==null))throw new me("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=this.checkNumSamples(t,r,p,"steps_per_epoch"),x;g!=null&&(x=no(0,g)),s==null&&(s=1);let{callbackList:y,history:b}=qV(i,s,a,h,g,p,r,f,c);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<a;++v){await y.onEpochBegin(v);let w={};if(p!=null)throw new sn("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new sn("batch shuffling is not implemneted yet");d&&A.shuffle(x);let N=Vn(x),S=dS(g,r);for(let C=0;C<S.length;++C){let _={};if(await y.onBatchBegin(C,_),ce(()=>{let T=S[C][0],E=S[C][1],j=ud(N,T,E-T);_.batch=C,_.size=E-T;let I=gC(t,j),D=e(I);for(let F=0;F<n.length;++F){let P=n[F],V=D[F];_[P]=V,Zr(V)}if(C===S.length-1&&f){let F=this.testLoop(l,u,r);for(let P=0;P<n.length;++P){let V=n[P],$=F[P];Zr($),w["val_"+V]=$}}}),await y.onBatchEnd(C,_),WV(_),this.stopTraining_)break}N.dispose()}if(await y.onEpochEnd(v,w),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return $Se(this,e,t)}async trainOnBatch(e,t){let n=await this.standardizeUserData(e,t),r=n[0],a=n[1],s=this.makeTrainFunction()(r.concat(a)),i=[];for(let l of s){let u=await l.data();i.push(u[0])}return qt(s),Li(n[0],e),Li(n[1],t),ls(i)}getNamedWeights(e){let t=[],n=e!=null&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let s=0;s<r.length;++s)n&&!r[s].trainable||t.push({name:r[s].originalName,tensor:a[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let t=Q2().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Q2().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=cl(this.loss);else if(Array.isArray(this.loss)){for(let t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>cl(t))}else{let t=Object.keys(this.loss);e={};let n=this.loss;for(let r of t)if(typeof n[r]=="string")e[r]=cl(n[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[cl(Cv(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>cl(Cv(e)));{let e={};for(let t in this.metrics)e[t]=cl(Cv(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let t=xy(e.optimizer_config),n=Ji(t),r;if(typeof e.loss=="string")r=Fc(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(s=>Fc(s));else if(e.loss!=null){r={};for(let s in e.loss)r[s]=Fc(e.loss[s])}let a;if(Array.isArray(e.metrics))a=e.metrics.map(s=>Fc(s));else if(e.metrics!=null){a={};for(let s in e.metrics)a[s]=Fc(e.metrics[s])}this.compile({loss:r,metrics:a,optimizer:n})}async save(e,t){if(typeof e=="string"){let a=Aa.getSaveHandlers(e);if(a.length===0)throw new me(`Cannot find any save handlers for URL '${e}'`);if(a.length>1)throw new me(`Found more than one (${a.length}) save handlers for URL '${e}'`);e=a[0]}if(e.save==null)throw new me("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await Aa.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:VSe,generatedBy:`TensorFlow.js tfjs-layers v${PE}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){r.trainingConfig=this.getTrainingConfig();let a="optimizer",{data:s,specs:i}=await Aa.encodeWeights(await this.optimizer.getWeights(),a);n.specs.push(...i),n.data=Aa.concatenateArrayBuffers([n.data,s])}return this.userDefinedMetadata!=null&&(mF(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){mF(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}};wl.className="Model";Ve.registerClass(wl);var aU=class extends wl{};aU.className="Functional";Ve.registerClass(aU);async function USe(e,t){"modelTopology"in e||(e={modelTopology:e}),e=e;let n=e.modelTopology;n.model_config!=null&&(n=n.model_config);let r=xy(n),a=Ji(r,t);if(e.weightsManifest!=null){let s=await Aa.loadWeights(e.weightsManifest,e.pathPrefix,a.weights.map(l=>l.originalName)),i={};for(let l of a.weights)i[l.originalName]=s[l.originalName];a.loadWeights(i),qt(s)}return a}async function HSe(e,t){if(t==null&&(t={}),typeof e=="string"){let n=Aa.getLoadHandlers(e,t);if(n.length===0)n.push(Aa.browserHTTPRequest(e,t));else if(n.length>1)throw new me(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return GSe(e,void 0,t)}async function GSe(e,t,n){if(n==null&&(n={}),e.load==null)throw new me("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await e.load(),a=r.modelTopology;a.model_config!=null&&(a=a.model_config);let s=n.strict==null?!0:n.strict,i=r.weightData!=null&&r.weightSpecs!=null&&s,l=Ji(xy(a),t,i),u=r.trainingConfig;if(u!=null&&l.loadTrainingConfig(u),r.userDefinedMetadata!=null&&l.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new me("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:d,optimizerWeights:c}=qSe(r.weightData,r.weightSpecs);l.loadWeights(d,s),l.optimizer!=null&&c.length>0&&await l.optimizer.setWeights(c),qt(d),qt(c.map(h=>h.tensor))}return l}function qSe(e,t){let n=Aa.decodeWeights(e,t),r={},a=[];return t.forEach(s=>{s.group==="optimizer"?a.push({name:s.name,tensor:n[s.name]}):r[s.name]=n[s.name]}),{modelWeights:r,optimizerWeights:a}}var mN=class yC extends wl{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:nN("sequential_"),t.layers!=null)for(let n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new me(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){let n=t instanceof yC||t instanceof wl,r;if(n){if(r=t,r.outputs.length!==1)throw new me("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new me("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new me("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let a=PV({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(a)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new me(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new me("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=FV(this.outputs[0])}this.inboundNodes=[],new dN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Od(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(a=>a.shape),outputShapes:this.outputs[0].shape})}else{let a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(En(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new wl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new Ao("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new Ao("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new Ao("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new Ao("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},a=!1){let s,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new me("Legacy serialization format not supported yet.");s=n}else A.assert(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,i=n;let l=new t(i);if(!(l instanceof yC))throw new sn(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let u of s){let d=Ji(u,void 0,a);a&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(t){if(this.model==null)throw new me("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new me("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let t=[];for(let n of this.layers){let r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}};mN.className="Sequential";Ve.registerClass(mN);function KSe(e){return new wl(e)}function YSe(e){return new mN(e)}function sU(e){return PV(e)}function XSe(e,t){RE.registerCallbackConstructor(e,t)}var Ba=class extends Ve.Serializable{getConfig(){return{}}},iU=class extends Ba{apply(e,t=1){return fke(e,t)}};iU.className="elu";Ve.registerClass(iU);var oU=class extends Ba{apply(e){return L1(e)}};oU.className="selu";Ve.registerClass(oU);var lU=class extends Ba{apply(e){return Kn(e)}};lU.className="relu";Ve.registerClass(lU);var uU=class extends Ba{apply(e){return ce(()=>Vu(6,Kn(e)))}};uU.className="relu6";Ve.registerClass(uU);var cU=class extends Ba{apply(e){return e}};cU.className="linear";Ve.registerClass(cU);var dU=class extends Ba{apply(e){return wi(e)}};dU.className="sigmoid";Ve.registerClass(dU);var hU=class extends Ba{apply(e){return xke(e)}};hU.className="hardSigmoid";Ve.registerClass(hU);var pU=class extends Ba{apply(e){return pp(e)}};pU.className="softplus";Ve.registerClass(pU);var mU=class extends Ba{apply(e){return gke(e)}};mU.className="softsign";Ve.registerClass(mU);var fU=class extends Ba{apply(e){return Wu(e)}};fU.className="tanh";Ve.registerClass(fU);var OE=class extends Ba{apply(e,t=-1){return dc(e,t)}};OE.className="softmax";Ve.registerClass(OE);var gU=class extends Ba{apply(e,t=-1){return R1(e,t)}};gU.className="logSoftmax";Ve.registerClass(gU);var xU=class extends Ba{apply(e){return ce(()=>ce(()=>{let t=Math.sqrt(2),n=re(.5,$e(1,E1(ft(e,t))));return re(e,n)}))}};xU.className="gelu";Ve.registerClass(xU);var yU=class extends Ba{apply(e){return ce(()=>re(.5,re(e,$e(1,Wu(re(ba(ft(2,Math.PI)),$e(e,re(.044715,Uo(e,3)))))))))}};yU.className="gelu_new";Ve.registerClass(yU);var bU=class extends Ba{apply(e){return ce(()=>re(e,Wu(pp(e))))}};bU.className="mish";Ve.registerClass(bU);var vU=class extends Ba{apply(e,t=1){return ce(()=>re(wi(re(e,t)),e))}};vU.className="swish";Ve.registerClass(vU);function Gu(e){return e.getClassName()}function hS(e,t={}){return $b(e,Ve.SerializationMap.getMap().classNameMap,t,"activation")}function qu(e){if(e==null){let t={};return t.className="linear",t.config={},hS(t)}if(typeof e=="string"){let t={};return t.className=e,t.config={},hS(t)}else return e instanceof Ba?e:hS(e)}function LE(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}var wU=class extends Ve.Serializable{},zb=class extends wU{constructor(e){super(),LE(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ce(()=>{let t=Nr([1]);return this.hasL1&&(t=$e(t,kt(re(this.l1,zr(e))))),this.hasL2&&(t=$e(t,kt(re(this.l2,Pb(e))))),ue(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}};zb.className="L1L2";Ve.registerClass(zb);function ZSe(e){return LE(e),new zb({l1:e!=null?e.l1:null,l2:0})}function QSe(e){return LE(e),new zb({l2:e!=null?e.l2:null,l1:0})}var vF={l1l2:"L1L2"};function ur(e){return gE(e)}function wF(e,t={}){return $b(e,Ve.SerializationMap.getMap().classNameMap,t,"regularizer")}function vr(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in vF?vF[e]:e,config:{}};return wF(t)}else return e instanceof wU?e:wF(e)}var zE=class extends on{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Bt(e);let n=Kn(e);return this.maxValue!=null&&(n=Oa(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}};zE.className="ReLU";Ve.registerClass(zE);var BE=class extends on{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=Bt(e);return Sb(n,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};BE.className="LeakyReLU";Ve.registerClass(BE);var WE=class extends on{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=br(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=vr(e.alphaRegularizer),this.alphaConstraint=na(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new me(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=En(e);let t=e.slice(1);if(this.sharedAxes!=null)for(let r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new Br({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=Bt(e),jb(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Sr(this.alphaInitializer),alphaRegularizer:ur(this.alphaRegularizer),alphaConstraint:ta(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}};WE.className="PReLU";Ve.registerClass(WE);var VE=class extends on{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new sn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=Bt(e);return yg(n)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};VE.className="ELU";Ve.registerClass(VE);var UE=class extends on{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){let n=Bt(e);return re(n,Xe(es(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}};UE.className="ThresholdedReLU";Ve.registerClass(UE);var HE=class extends on{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new OE().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return ce(()=>{let n=Bt(e),r=t.mask;if(r!=null){let a=re(dt(ds(n.shape),Xe(r,n.dtype)),jt(-1e9));n=$e(n,a)}return this.axis instanceof Array?this.axis.length>1?La(dt(n,_b(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};HE.className="Softmax";Ve.registerClass(HE);function um(e,t,n){if(typeof e=="number")return Od(e,t);if(e.length!==t)throw new me(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){let a=e[r];if(!dke(a))throw new me(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${a}`)}return e}function eo(e,t,n,r,a=1){if(e==null)return e;let s=t+(t-1)*(a-1),i;return n==="same"?i=e:i=e-s+1,Math.floor((i+r-1)/r)}function _o(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+Hu([n-t,0]);else if(r==="same")e=e*t;else throw new me(`Unsupport padding mode: ${r}.`);return e}function GE(e,t){return ce(()=>(Pr(t),t==="channelsFirst"?tn(e,[0,2,3,1]):e))}function NU(e,t){return ce(()=>(Pr(t),t==="channelsFirst"?tn(e,[0,2,3,4,1]):e))}function JSe(e,t,n,r=1,a="valid",s,i=1){return ce(()=>{if(s==null&&(s=ro()),Pr(s),e.shape.length!==3)throw new me(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new me(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new me(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(s==="channelsFirst"&&(e=tn(e,[0,2,1])),a==="causal")throw new sn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=C1(e,t,r,a==="same"?"same":"valid","NWC",i);return n!=null&&(l=uo(l,n)),l})}function NF(e,t,n,r=[1,1],a="valid",s,i,l=null){return ce(()=>{if(s==null&&(s=ro()),Pr(s),e.rank!==3&&e.rank!==4)throw new me(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new me(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let u=GE(e,s);if(a==="causal")throw new sn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Km.conv2d({x:u,filter:t,strides:r,pad:a==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:l}),s==="channelsFirst"&&(u=tn(u,[0,3,1,2])),u})}function e2e(e,t,n,r=[1,1,1],a="valid",s,i){return ce(()=>{if(s==null&&(s=ro()),Pr(s),e.rank!==4&&e.rank!==5)throw new me(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new me(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let l=NU(e,s);if(a==="causal")throw new sn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=vT(l,t,r,a==="same"?"same":"valid","NDHWC",i),n!=null&&(l=uo(l,n)),s==="channelsFirst"&&(l=tn(l,[0,4,1,2,3])),l})}var kU=class SU extends on{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",SU.verifyArgs(n),this.rank=t,xa(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new sn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=um(n.kernelSize,t,"kernelSize"),this.strides=um(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,si(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Pr(this.dataFormat),this.activation=qu(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=br(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=na(n.biasConstraint),this.biasRegularizer=vr(n.biasRegularizer),this.activityRegularizer=vr(n.activityRegularizer),this.dilationRate=um(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new me(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new me(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new me(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Co("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!xE(t.kernelSize,"number",1,3))throw new me(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Gu(this.activation),useBias:this.useBias,biasInitializer:Sr(this.biasInitializer),biasRegularizer:ur(this.biasRegularizer),activityRegularizer:ur(this.activityRegularizer),biasConstraint:ta(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}},fN=class CU extends kU{constructor(t,n){super(t,n),this.kernel=null,CU.verifyArgs(n),this.filters=n.filters,xa(this.filters,"filters"),this.kernelInitializer=br(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=na(n.kernelConstraint),this.kernelRegularizer=vr(n.kernelRegularizer)}build(t){t=En(t);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new me(`The channel dimension of the input should be defined. Found ${t[n]}`);let r=t[n],a=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return ce(()=>{t=Bt(t);let r,a=this.bias==null?null:this.bias.read(),s=IV(this.activation.getClassName());if(s!=null&&this.rank===2)r=NF(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=JSe(t,this.kernel.read(),a,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=NF(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=e2e(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new sn("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=En(t);let n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){let i=eo(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(i)}let a=[t[0]];return this.dataFormat==="channelsLast"?(a=a.concat(n),a.push(this.filters)):(a.push(this.filters),a=a.concat(n)),a}getConfig(){let t={filters:this.filters,kernelInitializer:Sr(this.kernelInitializer),kernelRegularizer:ur(this.kernelRegularizer),kernelConstraint:ta(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new me(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}},gN=class _U extends fN{constructor(t){super(2,t),_U.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!xE(t.kernelSize,"number",1,2))throw new me(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}};gN.className="Conv2D";Ve.registerClass(gN);var xN=class IU extends fN{constructor(t){super(3,t),IU.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new me(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}};xN.className="Conv3D";Ve.registerClass(xN);var qE=class extends gN{constructor(e){if(super(e),this.inputSpec=[new Br({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new me(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=En(e),e.length!==4)throw new me("Input should have rank 4; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new me("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Br({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return ce(()=>{let n=Bt(e);if(n.shape.length!==4)throw new me(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,i;this.dataFormat==="channelsFirst"?(s=2,i=3):(s=1,i=2);let l=r[s],u=r[i],d=this.kernelSize[0],c=this.kernelSize[1],h=this.strides[0],p=this.strides[1],m=_o(l,h,d,this.padding),f=_o(u,p,c,this.padding),g=[a,m,f,this.filters];this.dataFormat!=="channelsLast"&&(n=tn(n,[0,2,3,1]));let x=_1(n,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=tn(x,[0,3,1,2])),this.bias!=null&&(x=uo(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=En(e);let t=e.slice(),n,r,a;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3):(n=3,r=1,a=2);let s=this.kernelSize[0],i=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[n]=this.filters,t[r]=_o(t[r],l,s,this.padding),t[a]=_o(t[a],u,i,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};qE.className="Conv2DTranspose";Ve.registerClass(qE);var KE=class extends xN{constructor(e){if(super(e),this.inputSpec=[new Br({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new me(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=En(e),e.length!==5)throw new me("Input should have rank 5; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new me("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Br({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return ce(()=>{let n=Bt(e);if(n.shape.length!==5)throw new me(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,i,l;this.dataFormat==="channelsFirst"?(l=2,s=3,i=4):(l=1,s=2,i=3);let u=r[l],d=r[s],c=r[i],h=this.kernelSize[0],p=this.kernelSize[1],m=this.kernelSize[2],f=this.strides[0],g=this.strides[1],x=this.strides[2],y=_o(u,f,h,this.padding),b=_o(d,g,p,this.padding),v=_o(c,x,m,this.padding),w=[a,y,b,v,this.filters];this.dataFormat!=="channelsLast"&&(n=tn(n,[0,2,3,4,1]));let N=wT(n,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(N=tn(N,[0,4,1,2,3])),this.bias!==null&&(N=uo(N,this.bias.read(),this.dataFormat)),this.activation!==null&&(N=this.activation.apply(N)),N})}computeOutputShape(e){e=En(e);let t=e.slice(),n,r,a,s;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3,s=4):(n=4,r=1,a=2,s=3);let i=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],c=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=_o(t[r],d,i,this.padding),t[a]=_o(t[a],c,l,this.padding),t[s]=_o(t[s],h,u,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};KE.className="Conv3DTranspose";Ve.registerClass(KE);var TU=class extends fN{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new me("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new me("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new me(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=br(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=vr(t.depthwiseRegularizer),this.depthwiseConstraint=na(t.depthwiseConstraint),this.pointwiseInitializer=br(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=vr(t.pointwiseRegularizer),this.pointwiseConstraint=na(t.pointwiseConstraint)}build(e){if(e=En(e),e.length<this.rank+2)throw new me(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new me(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);let n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);let s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new Br({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return ce(()=>{e=Bt(e);let n;if(this.rank===1)throw new sn("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=tn(e,[0,2,3,1])),n=Ng(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=uo(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=tn(n,[0,3,1,2])),n})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Sr(this.depthwiseInitializer),e.pointwiseInitializer=Sr(this.pointwiseInitializer),e.depthwiseRegularizer=ur(this.depthwiseRegularizer),e.pointwiseRegularizer=ur(this.pointwiseRegularizer),e.depthwiseConstraint=ta(this.depthwiseConstraint),e.pointwiseConstraint=ta(this.pointwiseConstraint),e}};TU.className="SeparableConv";var YE=class extends TU{constructor(e){super(2,e)}};YE.className="SeparableConv2D";Ve.registerClass(YE);var XE=class EU extends fN{constructor(t){super(1,t),EU.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){let t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!xE(t.kernelSize,"number",1,1))throw new me(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}};XE.className="Conv1D";Ve.registerClass(XE);var ZE=class extends on{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return ce(()=>{if(e=Bt(e),this.dataFormat==="channelsLast"){let n=Sv(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Sv(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let n=Sv(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Sv(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};ZE.className="Cropping2D";Ve.registerClass(ZE);var QE=class extends on{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,lke(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let t=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,n]}else{let t=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return ce(()=>{let n=Bt(e),r=n.shape;if(this.dataFormat==="channelsFirst"){n=tn(n,[0,2,3,1]);let a=this.size[0]*r[2],s=this.size[1]*r[3],i=this.interpolation==="nearest"?Ks.resizeNearestNeighbor(n,[a,s]):Ks.resizeBilinear(n,[a,s]);return tn(i,[0,3,1,2])}else{let a=this.size[0]*r[1],s=this.size[1]*r[2];return this.interpolation==="nearest"?Ks.resizeNearestNeighbor(n,[a,s]):Ks.resizeBilinear(n,[a,s])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}};QE.className="UpSampling2D";Ve.registerClass(QE);function t2e(e,t,n=[1,1],r="valid",a,s){return ce(()=>{a==null&&(a=ro()),Pr(a);let i=GE(e,a);if(e.rank!==4)throw new me(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new me(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return i=hp(i,t,n,r==="same"?"same":"valid","NHWC",s),a==="channelsFirst"&&(i=tn(i,[0,3,1,2])),i})}var JE=class extends kU{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=br(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=na(e.depthwiseConstraint),this.depthwiseRegularizer=vr(e.depthwiseRegularizer)}build(e){if(e=En(e),e.length<4)throw new me(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new me(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);let n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{e=Bt(e);let n=t2e(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=uo(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=En(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=eo(t,this.kernelSize[0],this.padding,this.strides[0]),s=eo(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,a,s]:[e[0],a,s,r]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Sr(this.depthwiseInitializer),e.depthwiseRegularizer=ur(this.depthwiseRegularizer),e.depthwiseConstraint=ta(this.depthwiseRegularizer),e}};JE.className="DepthwiseConv2D";Ve.registerClass(JE);function jU(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new me("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(s){return s==null||Array.isArray(s)?s:[s]}return t=a(t),n=a(n),{inputs:e,initialState:t,constants:n}}function AU(e,t,n,r=!1,a,s,i=!1,l=!1){return ce(()=>{let u=t.shape.length;if(u<3)throw new me(`Input should be at least 3D, but is ${u}D.`);let d=[1,0].concat(no(2,u));t=tn(t,d),s!=null,i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=Xe(Xe(a,"bool"),"float32"),a.rank===u-1&&(a=ga(a,-1)),a=tn(a,d)),r&&(t=ai(t,0),a!=null&&(a=ai(a,0)));let c=[],h,p=n,m=t.shape[0],f=Er(t),g;a!=null&&(g=Er(a));for(let y=0;y<m;++y){let b=f[y],v=ce(()=>e(b,p));if(a==null)h=v[0],p=v[1];else{let w=ce(()=>{let N=g[y],S=dt(Os(N),N),C=$e(re(v[0],N),re(p[0],S)),_=p.map((T,E)=>$e(re(v[1][E],N),re(T,S)));return{output:C,newStates:_}});h=w.output,p=w.newStates}l&&c.push(h)}let x;return l&&(x=Vr(c,1)),[h,x,p]})}var Bl=class RU extends on{constructor(t){super(t);let n;if(t.cell==null)throw new me("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new vN({cells:t.cell}):n=t.cell,n.stateSize==null)throw new me("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Br({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return no(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){hC(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let r=n[0],a;if(this.returnSequences?a=[t[0],t[1],r]:a=[t[0],r],this.returnState){let s=[];for(let i of n)s.push([t[0],i]);return[a].concat(s)}else return a}computeMask(t,n){return ce(()=>{Array.isArray(n)&&(n=n[0]);let r=this.returnSequences?n:null;if(this.returnState){let a=this.states.map(s=>null);return[r].concat(a)}else return r})}get states(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new sn("Constants support is not implemented in RNN yet.");hC(t)&&(t=t[0]),t=t;let n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new Br({shape:[n,null,...r]});let a=[t[0]].concat(t.slice(2));this.cell.build(a);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!A.arraysEqual(this.stateSpec.map(i=>i.shape[i.shape.length-1]),s))throw new me(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(i=>new Br({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){ce(()=>{if(!this.stateful)throw new su("Cannot call resetStates() on an RNN Layer that is not stateful.");let r=this.inputSpec[0].shape[0];if(r==null)throw new me("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Nr([r,a])):this.states_=[Nr([r,this.cell.stateSize])];else if(t==null)qt(this.states_),this.keptStates!=null&&(qt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Nr([r,a])):this.states_[0]=Nr([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new me(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):qt(this.states_);for(let a=0;a<this.states_.length;++a){let s=t[a],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[a]:this.cell.stateSize,l=[r,i];if(!A.arraysEqual(s.shape,l))throw new me(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[a]=s}}this.states_=this.states_.map(a=>Zr(a.clone()))})}apply(t,n){let r=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});let s=jU(t,r,a,this.numConstants);t=s.inputs,r=s.initialState,a=s.constants;let i=[],l=[];if(r!=null){n.initialState=r,i=i.concat(r),this.stateSpec=[];for(let u of r)this.stateSpec.push(new Br({shape:u.shape}));l=l.concat(this.stateSpec)}if(a!=null&&(n.constants=a,i=i.concat(a),this.numConstants=a.length),i[0]instanceof ao){let u=[t].concat(i),d=this.inputSpec.concat(l),c=this.inputSpec;this.inputSpec=d;let h=super.apply(u,n);return this.inputSpec=c,h}else return super.apply(t,n)}call(t,n){return ce(()=>{let r=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;t=Bt(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));let i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==i)throw new me(`RNN Layer has ${i} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:a},u=AU((m,f)=>{let g=this.cell.call([m].concat(f),l);return[g[0],g.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),d=u[0],c=u[1],h=u[2];this.stateful&&this.resetStates(h,a);let p=this.returnSequences?c:d;return this.returnState?[p].concat(h):p})}getInitialState(t){return ce(()=>{let n=Nr(t.shape);return n=kt(n,[1,2]),n=Fb(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?cC(n,[1,r]):n):this.cell.stateSize>1?[cC(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){let t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);let r=this.cell.getConfig();return this.getClassName()===RU.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){let a=n.cell,s=Ji(a,r);return new t(Object.assign(n,{cell:s}))}};Bl.className="RNN";Ve.registerClass(Bl);var Bb=class extends on{},yN=class extends Bb{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,xa(this.units,"units"),this.activation=qu(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=br(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=br(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=br(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=vr(e.kernelRegularizer),this.recurrentRegularizer=vr(e.recurrentRegularizer),this.biasRegularizer=vr(e.biasRegularizer),this.kernelConstraint=na(e.kernelConstraint),this.recurrentConstraint=na(e.recurrentConstraint),this.biasConstraint=na(e.biasConstraint),this.dropout=Ym([1,Hu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ym([1,Hu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=En(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{if(e=e,e.length!==2)throw new me(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];let r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ku({ones:()=>Os(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ku({ones:()=>Os(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let a,s=this.dropoutMask,i=this.recurrentDropoutMask;s!=null?a=zo(re(e,s),this.kernel.read()):a=zo(e,this.kernel.read()),this.bias!=null&&(a=uo(a,this.bias.read())),i!=null&&(n=re(n,i));let l=$e(a,zo(n,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Gu(this.activation),useBias:this.useBias,kernelInitializer:Sr(this.kernelInitializer),recurrentInitializer:Sr(this.recurrentInitializer),biasInitializer:Sr(this.biasInitializer),kernelRegularizer:ur(this.kernelRegularizer),recurrentRegularizer:ur(this.recurrentRegularizer),biasRegularizer:ur(this.biasRegularizer),activityRegularizer:ur(this.activityRegularizer),kernelConstraint:ta(this.kernelConstraint),recurrentConstraint:ta(this.recurrentConstraint),biasConstraint:ta(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}};yN.className="SimpleRNNCell";Ve.registerClass(yN);var ej=class extends Bl{constructor(e){e.cell=new yN(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}};ej.className="SimpleRNN";Ve.registerClass(ej);var bN=class extends Bb{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new me("GRUCell does not support reset_after parameter set to true.");this.units=e.units,xa(this.units,"units"),this.activation=qu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=br(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=br(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=br(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=vr(e.kernelRegularizer),this.recurrentRegularizer=vr(e.recurrentRegularizer),this.biasRegularizer=vr(e.biasRegularizer),this.kernelConstraint=na(e.kernelConstraint),this.recurrentConstraint=na(e.recurrentConstraint),this.biasConstraint=na(e.biasConstraint),this.dropout=Ym([1,Hu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ym([1,Hu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=En(e);let t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return ce(()=>{if(e=e,e.length!==2)throw new me(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training==null?!1:t.training,r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ku({ones:()=>Os(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ku({ones:()=>Os(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,s=this.recurrentDropoutMask,i,l,u;0<this.dropout&&this.dropout<1&&(e=re(e,a[0]));let d=zo(e,this.kernel.read());this.useBias&&(d=uo(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=re(r,s[0]));let c=this.recurrentKernel.read(),[h,p]=hs(c,[2*this.units,this.units],c.rank-1),m=zo(r,h),[f,g,x]=hs(d,3,d.rank-1),[y,b]=hs(m,2,m.rank-1);i=this.recurrentActivation.apply($e(f,y)),l=this.recurrentActivation.apply($e(g,b));let v=zo(re(l,r),p);u=this.activation.apply($e(x,v));let w=$e(re(i,r),re($e(1,pr(i)),u));return[w,w]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Gu(this.activation),recurrentActivation:Gu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sr(this.kernelInitializer),recurrentInitializer:Sr(this.recurrentInitializer),biasInitializer:Sr(this.biasInitializer),kernelRegularizer:ur(this.kernelRegularizer),recurrentRegularizer:ur(this.recurrentRegularizer),biasRegularizer:ur(this.biasRegularizer),activityRegularizer:ur(this.activityRegularizer),kernelConstraint:ta(this.kernelConstraint),recurrentConstraint:ta(this.recurrentConstraint),biasConstraint:ta(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}};bN.className="GRUCell";Ve.registerClass(bN);var tj=class extends Bl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new bN(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};tj.className="GRU";Ve.registerClass(tj);var Wb=class extends Bb{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,xa(this.units,"units"),this.activation=qu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=br(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=br(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=br(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=vr(e.kernelRegularizer),this.recurrentRegularizer=vr(e.recurrentRegularizer),this.biasRegularizer=vr(e.biasRegularizer),this.kernelConstraint=na(e.kernelConstraint),this.recurrentConstraint=na(e.recurrentConstraint),this.biasConstraint=na(e.biasConstraint),this.dropout=Ym([1,Hu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ym([1,Hu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=En(e);let n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){let a=this.biasInitializer,s=this.units;r=new(t=class extends ji{apply(i,l){let u=a.apply([s]),d=new aN().apply([s]),c=a.apply([s*2]);return iF(iF(u,d),c)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return ce(()=>{let n=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new me(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1],a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ku({ones:()=>Os(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ku({ones:()=>Os(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,i=this.recurrentDropoutMask,l,u,d,c;0<this.dropout&&this.dropout<1&&(e=re(e,s[0]));let h=zo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=re(r,i[0])),h=$e(h,zo(r,this.recurrentKernel.read())),this.useBias&&(h=uo(h,this.bias.read()));let[p,m,f,g]=hs(h,4,h.rank-1);l=this.recurrentActivation.apply(p),u=this.recurrentActivation.apply(m),d=$e(re(u,a),re(l,this.activation.apply(f))),c=this.recurrentActivation.apply(g);let x=re(c,this.activation.apply(d));return[x,x,d]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:Gu(this.activation),recurrentActivation:Gu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sr(this.kernelInitializer),recurrentInitializer:Sr(this.recurrentInitializer),biasInitializer:Sr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ur(this.kernelRegularizer),recurrentRegularizer:ur(this.recurrentRegularizer),biasRegularizer:ur(this.biasRegularizer),activityRegularizer:ur(this.activityRegularizer),kernelConstraint:ta(this.kernelConstraint),recurrentConstraint:ta(this.recurrentConstraint),biasConstraint:ta(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}};Wb.className="LSTMCell";Ve.registerClass(Wb);var nj=class extends Bl{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Wb(e),super(e)}call(e,t){return ce(()=>{this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};nj.className="LSTM";Ve.registerClass(nj);var vN=class extends Bb{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return ce(()=>{e=e;let n=e.slice(1),r=[];for(let i of this.cells.slice().reverse())Array.isArray(i.stateSize)?r.push(n.splice(0,i.stateSize.length)):r.push(n.splice(0,1));r.reverse();let a=[],s;for(let i=0;i<this.cells.length;++i){let l=this.cells[i];n=r[i],i===0?s=[e[0]].concat(n):s=[s[0]].concat(n),s=l.call(s,t),a.push(s.slice(1))}n=[];for(let i of a.slice().reverse())n.push(...i);return[s[0]].concat(n)})}build(e){hC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((n,r)=>{ld(`RNNCell_${r}`,()=>{n.build(e),Array.isArray(n.stateSize)?t=n.stateSize[0]:t=n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){let e=super.getConfig(),t=r=>({className:r.getClassName(),config:r.getConfig()}),n={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),n)}static fromConfig(e,t,n={}){let r=[];for(let a of t.cells)r.push(Ji(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let n of this.cells)t.push(...n.trainableWeights);return t.concat(e)}return e}getWeights(){let e=[];for(let t of this.cells)e.push(...t.weights);return pC(e)}setWeights(e){let t=[];for(let n of this.cells){let r=n.weights.length,a=e.splice(r);for(let s=0;s<n.weights.length;++s)t.push([n.weights[s],a[s]])}_E(t)}};vN.className="StackedRNNCells";Ve.registerClass(vN);function Ku(e){let{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:s}=e,i=()=>s!=null?s(t(),n):MV(t(),n),l=()=>Ob(i,t,r);return!a||a<=1?Zr(l().clone()):Array(a).fill(void 0).map(l).map(u=>Zr(u.clone()))}var n2e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},DU=class extends Bl{constructor(e){if(e.unroll)throw new sn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new sn("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Br({ndim:5})]}call(e,t){return ce(()=>{if(this.cell.dropoutMask!=null&&(qt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(qt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new me("ConvRNN2D cell does not support constants");let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return ce(()=>{let{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)],s=Nr(a);return Array.isArray(t)?Array(t.length).fill(s):[s]})}resetStates(e,t=!1){ce(()=>{if(!this.stateful)throw new su("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(n[0]==null)throw new me("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nr(a)):this.states_=[Nr(a)];else if(e==null)qt(this.states_),this.keptStates!=null&&(qt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Nr(a)):this.states_[0]=Nr(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new me(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):qt(this.states_);for(let s=0;s<this.states_.length;++s){let i=e[s],l=a;if(!A.arraysEqual(i.shape,l))throw new me(`State ${s} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${i.shape}`);this.states_[s]=i}}this.states_=this.states_.map(s=>Zr(s.clone()))})}computeSingleOutputShape(e){let{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:s,dilationRate:i}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],c=eo(u,r[0],a,s[0],i[0]),h=eo(d,r[1],a,s[1],i[1]);return[...e.slice(0,2),...l?[n,c,h]:[c,h,n]]}};DU.className="ConvRNN2D";var wN=class extends Wb{constructor(e){let{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:s,dilationRate:i}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,xa(this.filters,"filters"),this.kernelSize=um(n,2,"kernelSize"),this.kernelSize.forEach(l=>xa(l,"kernelSize")),this.strides=um(r||1,2,"strides"),this.strides.forEach(l=>xa(l,"strides")),this.padding=a||"valid",si(this.padding),this.dataFormat=s||"channelsLast",Pr(this.dataFormat),this.dilationRate=um(i||1,2,"dilationRate"),this.dilationRate.forEach(l=>xa(l,"dilationRate"))}build(e){var t;e=En(e);let n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new me(`The channel dimension of the input should be defined. Found ${e[n]}`);let r=e[n],a=4,s=this.kernelSize.concat([r,this.filters*a]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let i=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;l=new(t=class extends ji{apply(c,h){let p=u.apply([d]),m=ds([d]),f=u.apply([d*2]);return yE([p,m,f])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return ce(()=>{if(e.length!==3)throw new me(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training||!1,r=e[0],a=e[1],s=e[2],i=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ku({ones:()=>Os(r),rate:this.dropout,training:n,count:i,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,u=(L,q,U)=>!q||!q[U]?L:re(q[U],L),d=u(r,l,0),c=u(r,l,1),h=u(r,l,2),p=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ku({ones:()=>Os(a),rate:this.recurrentDropout,training:n,count:i,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,f=u(a,m,0),g=u(a,m,1),x=u(a,m,2),y=u(a,m,3),b=3,[v,w,N,S]=hs(this.kernel.read(),i,b),[C,_,T,E]=this.useBias?hs(this.bias.read(),i):[null,null,null,null];d=this.inputConv(d,v,C,this.padding),c=this.inputConv(c,w,_,this.padding),h=this.inputConv(h,N,T,this.padding),p=this.inputConv(p,S,E,this.padding);let[j,I,D,F]=hs(this.recurrentKernel.read(),i,b);f=this.recurrentConv(f,j),g=this.recurrentConv(g,I),x=this.recurrentConv(x,D),y=this.recurrentConv(y,F);let P=this.recurrentActivation.apply($e(d,f)),V=this.recurrentActivation.apply($e(c,g)),$=$e(re(V,s),re(P,this.activation.apply($e(h,x)))),O=re(this.recurrentActivation.apply($e(p,y)),this.activation.apply($));return[O,O,$]})}getConfig(){let e=super.getConfig(),{units:t}=e,n=n2e(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){let a=Ya(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?uo(a,n,this.dataFormat):a}recurrentConv(e,t){return Ya(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}};wN.className="ConvLSTM2DCell";Ve.registerClass(wN);var rj=class extends DU{constructor(e){let t=new wN(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}};rj.className="ConvLSTM2D";Ve.registerClass(rj);var NN=class extends on{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return n}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);if(0<this.rate&&this.rate<1){let r=t.training==null?!1:t.training,a=this.getNoiseShape(n);return Ob(()=>MV(n,this.rate,a,this.seed),()=>n,r)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}};NN.className="Dropout";Ve.registerClass(NN);var aj=class extends NN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let t=e.shape;return[t[0],1,t[2]]}};aj.className="SpatialDropout1D";Ve.registerClass(aj);var sj=class extends on{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,xa(this.units,"units"),this.activation=qu(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=br(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=br(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=na(e.kernelConstraint),this.biasConstraint=na(e.biasConstraint),this.kernelRegularizer=vr(e.kernelRegularizer),this.biasRegularizer=vr(e.biasRegularizer),this.activityRegularizer=vr(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=En(e);let t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=En(e);let t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e),r=IV(this.activation.getClassName()),a;return r!=null?a=zo(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=zo(n,this.kernel.read()),this.bias!=null&&(a=uo(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){let e={units:this.units,activation:Gu(this.activation),useBias:this.useBias,kernelInitializer:Sr(this.kernelInitializer),biasInitializer:Sr(this.biasInitializer),kernelRegularizer:ur(this.kernelRegularizer),biasRegularizer:ur(this.biasRegularizer),activityRegularizer:ur(this.activityRegularizer),kernelConstraint:ta(this.kernelConstraint),biasConstraint:ta(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}};sj.className="Dense";Ve.registerClass(sj);var ij=class extends on{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=En(e);for(let t of e.slice(1))if(t==null)throw new me(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Au(e,1)]}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){let r=[0];for(let a=2;a<n.rank;++a)r.push(a);r.push(1),n=tn(n,r)}return mke(n)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let t=super.getConfig();return Object.assign(e,t),e}};ij.className="Flatten";Ve.registerClass(ij);var oj=class extends on{constructor(e){super(e),this.supportsMasking=!0,this.activation=qu(e.activation)}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);return this.activation.apply(n)})}getConfig(){let e={activation:Gu(this.activation)},t=super.getConfig();return Object.assign(e,t),e}};oj.className="Activation";Ve.registerClass(oj);var lj=class extends on{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return ce(()=>(e=Bt(e),hke(e,this.n)))}getConfig(){let e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}};lj.className="RepeatVector";Ve.registerClass(lj);var uj=class extends on{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){let n="Total size of new array must be unchanged.",r=t.slice(),a=1,s=null;for(let l=0;l<r.length;++l){let u=r[l];if(this.isUnknown(u))if(s===null)s=l;else throw new me("Can only specifiy one unknown dimension.");else a*=u}let i=Au(e);if(s!==null){if(a===0||i%a!==0)throw new me(n);r[s]=i/a}else if(i!==a)throw new me(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return ue(n,a)})}getConfig(){let e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}};uj.className="Reshape";Ve.registerClass(uj);var cj=class extends on{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let t=no(1,e.dims.length+1);if(!A.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Br({ndim:this.dims.length+1})]}computeOutputShape(e){e=En(e);let t=e.slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return tn(Bt(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}};cj.className="Permute";Ve.registerClass(cj);var dj=class extends on{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){let n=Bt(e);return hy(Fd(n,this.maskValue),-1)}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e),r=hy(Fd(n,this.maskValue),-1,!0);return re(n,Xe(r,n.dtype))})}};dj.className="Masking";Ve.registerClass(dj);var hj=class extends on{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(qn(e.inputLength))}this.inputDim=e.inputDim,xa(this.inputDim,"inputDim"),this.outputDim=e.outputDim,xa(this.outputDim,"outputDim"),this.embeddingsInitializer=br(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=vr(e.embeddingsRegularizer),this.activityRegularizer=vr(e.activityRegularizer),this.embeddingsConstraint=na(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return ce(()=>this.maskZero?(e=Bt(e),Fd(e,Nn(e))):null)}computeOutputShape(e){if(e=En(e),this.inputLength==null)return[...e,this.outputDim];let t=qn(this.inputLength);if(t.length!==e.length-1)throw new me(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){let a=t[r],s=e[r+1];if(a!=null&&s!=null&&a!==s)throw new me(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);a==null&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);n.dtype!=="int32"&&(n=jl(n,"int32"));let r=DV(this.embeddings.read(),ue(n,[n.size]));return ue(r,En(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Sr(this.embeddingsInitializer),embeddingsRegularizer:ur(this.embeddingsRegularizer),activityRegularizer:ur(this.activityRegularizer),embeddingsConstraint:ta(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}};hj.className="Embedding";Ve.registerClass(hj);var xp=class extends on{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new sn}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;let n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){let a=e[e.length-t.length+r],s=t[r];if(a==null||s==null||a<0||s<0)n.push(null);else if(a===1)n.push(s);else if(s===1)n.push(a);else{if(a!==s)throw new me("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[En(e)]),e=e,e.length<2)throw new me(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(let a of e)a!=null&&a[0]!==null&&t.push(a[0]);if(t=ju(t),t.length>1)throw new me(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let a=1;a<e.length;++a){let s=e[a]==null?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=e.map(a=>a.length);e.indexOf(null)===-1&&ju(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return ce(()=>{if(e=e,this.reshapeRequired){let n=[],r=e.map(a=>a.rank);if(r.indexOf(null)===-1){let a=Hu(r);for(let s of e){let i=s.rank;for(let l=0;l<a-i;++l)s=Fb(s,1);n.push(s)}return this.mergeFunction(n)}else{let a=!1;for(let l of e){let u=l.rank;if(u==null){let d=l.shape,c=d[0],h=d.slice(1).concat([c]),p=ue(l,[c].concat(Au(d.slice(1))));p=tn(p,[1,0]),p=ue(p,h),n.push(p),a=!0}else if(u>1){let d=no(1,u).concat([0]);n.push(tn(l,d)),a=!0}else n.push(l)}let s=this.mergeFunction(n),i=s.rank;if(a){if(i==null){let l=s.shape,u=l.length,d=l[u-1],c=[d].concat(l.slice(0,l.length-1));s=ue(tn(ue(s,[-1,d]),[1,0]),c)}else if(i>1){let l=[i-1].concat(no(0,i-1));s=tn(s,l)}}return s}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){let a=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,a)}let n=[];for(let r of e)r!=null&&r[0]!==null&&n.push(r[0]);return n=ju(n),n.length===1?t=n.concat(t):t=[null].concat(t),t}computeMask(e,t){return ce(()=>{if(t==null)return null;if(!Array.isArray(t))throw new me("`mask` should be an Array");if(!Array.isArray(e))throw new me("`inputs` should be an Array");if(t.length!==e.length)throw new me(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:ga(r,0));let n=t[0];for(let r=1;r<t.length-1;++r)n=_i(n,t[r]);return n})}},pj=class extends xp{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=$e(t,e[n]);return t})}};pj.className="Add";Ve.registerClass(pj);var mj=class extends xp{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=re(t,e[n]);return t})}};mj.className="Multiply";Ve.registerClass(mj);var fj=class extends xp{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=$e(t,e[n]);return re(1/e.length,t)})}};fj.className="Average";Ve.registerClass(fj);var gj=class extends xp{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=Zo(t,e[n]);return t})}};gj.className="Maximum";Ve.registerClass(gj);var xj=class extends xp{constructor(e){super(e)}mergeFunction(e){return ce(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=Vu(t,e[n]);return t})}};xj.className="Minimum";Ve.registerClass(xj);var yj=class extends xp{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new me("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(let r of e)if(r!=null){t=!1;break}if(t)return;let n=[];for(let r=0;r<e.length;++r){let a=e[r].slice();a.splice(this.axis,1);let s=!1;for(let i of n)if(A.arraysEqual(i,a)){s=!0;break}s||n.push(a)}if(n.length>1)throw new me("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ce(()=>yE(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new me("A `Concatenate` layer should be called on a list of inputs.");let t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(let a of t.slice(1)){if(n[r]==null||a[r]==null){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new me("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new me("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new me(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return ce(()=>{let n=!0;if(t.forEach(s=>{if(s!=null){n=!1;return}}),n)return null;let r=[];for(let s=0;s<e.length;++s)t[s]==null?r.push(Xe(Os(e[s]),"bool")):t[s].rank<e[s].rank?r.push(ga(t[s],-1)):r.push(t[s]);let a=nr(r,this.axis);return S1(a,-1,!1)})}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};yj.className="Concatenate";Ve.registerClass(yj);function ix(e,t){for(;e<0;)e+=t;return e}function r2e(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new sn("batchDot is not implemented for tensors of 4D or higher rank yet");if(A.assert(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),A.assert(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new sn("batchDot is not implemented for complex64-type Tensors yet.");let r=e.shape.length,a=t.shape.length;n==null&&(n=[r-1,a-2]);let s=n;return ce(()=>{let i;if(r>a){i=r-a;let u=[];for(let d=0;d<i;++d)u.push(1);t=ue(t,t.shape.concat(u))}else if(a>r){i=a-r;let u=[];for(let d=0;d<i;++d)u.push(1);e=ue(e,e.shape.concat(u))}else i=0;let l;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?l=kt(re(e,t),s[0]):l=kt(re(tn(e,[1,0]),t),s[1]);else{let u=s[0]!==e.shape.length-1,d=s[1]===t.shape.length-1;l=en(e,t,u,d)}if(i>0){let u;r>a?u=r+a-3:u=r-1;let d=[];for(let c=u;c<u+i;++c)d.push(c);l=hc(l,d)}return l.shape.length===1&&(l=ga(l,1)),l})}var bj=class extends xp{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){A.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0],n=e[1];if(t.length>3||n.length>3)throw new sn("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new me(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new me(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],n=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((a,s)=>ix(a,e[s].shape.length)):r=[ix(this.axes,t.shape.length),ix(this.axes,n.shape.length)],this.normalize&&(t=d0(t,r[0]),n=d0(n,r[1])),r2e(t,n,r)}interpretAxes(e,t){let n;return Array.isArray(this.axes)?n=this.axes:n=[ix(this.axes,e.length),ix(this.axes,t.length)],n}computeOutputShape(e){A.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new sn("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);let a=t.concat(n);return a.length===1&&a.push(1),a}computeMask(e,t){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}};bj.className="Dot";Ve.registerClass(bj);var vj=class extends on{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);return Ob(()=>$e(rN(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}};vj.className="GaussianNoise";Ve.registerClass(vj);var wj=class extends on{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ce(()=>{this.invokeCallHook(e,t);let n=Bt(e);return this.rate>0&&this.rate<1?Ob(()=>{let r=Math.sqrt(this.rate/(1-this.rate));return re(n,rN(n.shape,1,r))},()=>n,t.training||!1):n})}};wj.className="GaussianDropout";Ve.registerClass(wj);var Nj=class extends on{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Bt(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return ce(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return Ob(()=>{let r=Bt(e),a=-1.6732632423543772*1.0507009873554805,s=Ol(cc(n),this.rate);s=jl(s,"float32");let i=((1-this.rate)*(1+this.rate*a**2))**-.5,l=-i*a*this.rate,u=$e(re(r,s),re($e(s,-1),a));return $e(re(u,i),l)},()=>Bt(e),t.training||!1)}return e})}};Nj.className="AlphaDropout";Ve.registerClass(Nj);function yy(e,t,n,r,a,s=.001){let i;if(e.rank===2)i=cT(e,t,n,r,a,s);else if(e.rank===3)i=dT(e,t,n,r,a,s);else if(e.rank===4)i=hT(e,t,n,r,a,s);else throw new sn(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return i}function a2e(e,t,n,r,a=.001){return ce(()=>{let s=Tb(e,r),i=s.mean,l=s.variance;return[yy(e,i,l,n,t,a),i,l]})}function s2e(e,t,n,r,a=.001){return ce(()=>{let s=Tb(e,r),i=s.mean,l=s.variance,u=[];for(let m of no(0,e.rank))r.indexOf(m)!==-1?u.push(1):u.push(e.shape[m]);let d=ue(i,u),c=ue(l,u),h=t==null?null:ue(t,u),p=n==null?null:ue(n,u);return[yy(e,d,c,p,h,a),i,l]})}function i2e(e,t,n,r,a=.001){return A.arraysEqual(r.slice().sort(),no(0,e.rank-1))?a2e(e,t,n,r,a):s2e(e,t,n,r,a)}var kj=class extends on{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=br(e.betaInitializer||"zeros"),this.gammaInitializer=br(e.gammaInitializer||"ones"),this.movingMeanInitializer=br(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=br(e.movingVarianceInitializer||"ones"),this.betaConstraint=na(e.betaConstraint),this.gammaConstraint=na(e.gammaConstraint),this.betaRegularizer=vr(e.betaRegularizer),this.gammaRegularizer=vr(e.gammaRegularizer)}build(e){e=En(e);let t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(n==null)throw new me(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Br({ndim:e.length,axes:{[t]:n}})];let r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return ce(()=>{let n=t.training==null?!1:t.training,r=Bt(e),a=r.shape,s=a.length,i=no(0,s),l=this.axis>=0?this.axis:this.axis+s;i.splice(l,1);let u=Od(1,s);u[l]=a[l];let d=i.slice();d.sort();let c=!A.arraysEqual(d,no(0,s).slice(0,s-1)),h=()=>{if(c){let x=ue(this.movingMean.read(),u),y=ue(this.movingVariance.read(),u),b=this.center?ue(this.beta.read(),u):null,v=this.scale?ue(this.gamma.read(),u):null;return yy(r,x,y,b,v,this.epsilon)}else return yy(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return h();let[p,m,f]=i2e(r,this.gamma.read(),this.beta.read(),i,this.epsilon),g=(x,y,b)=>{ce(()=>{let v=1-b,w=x.read(),N=re(dt(w,y),v);x.write(dt(w,N))})};return g(this.movingMean,m,this.momentum),g(this.movingVariance,f,this.momentum),p})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sr(this.betaInitializer),gammaInitializer:Sr(this.gammaInitializer),movingMeanInitializer:Sr(this.movingMeanInitializer),movingVarianceInitializer:Sr(this.movingVarianceInitializer),betaRegularizer:ur(this.betaRegularizer),gammaRegularizer:ur(this.gammaRegularizer),betaConstraint:ta(this.betaConstraint),gammaConstraint:ta(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}};kj.className="BatchNormalization";Ve.registerClass(kj);var Sj=class extends on{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=br(e.betaInitializer||"zeros"),this.gammaInitializer=br(e.gammaInitializer||"ones"),this.betaRegularizer=vr(e.betaRegularizer),this.gammaRegularizer=vr(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=En(e);let t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(let a of this.axis)if(a<0||a>=t)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==ju(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(a=>e[a]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){let n=Bt(e),r=n.shape,a=r.length;return ce(()=>{let{mean:s,variance:i}=Tb(n,this.axis,!0),l=Od(1,a);for(let m of this.axis)l[m]=r[m];let u=m=>m!=null&&m.shape.length!==a?ue(m,l):m,d=this.scale?u(this.gamma.read()):null,c=this.center?u(this.beta.read()):null,h=[],p=[];for(let m=0;m<a;++m)this.axis.indexOf(m)!==-1?(h.push(r[m]),p.push(1)):(h.push(1),p.push(r[m]));return s=Rs(s,h),i=Rs(i,h),d!=null&&(d=Rs(d,p)),c!=null&&(c=Rs(c,p)),yy(n,s,i,c,d,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sr(this.betaInitializer),gammaInitializer:Sr(this.gammaInitializer),betaRegularizer:ur(this.betaRegularizer),gammaRegularizer:ur(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}};Sj.className="LayerNormalization";Ve.registerClass(Sj);function o2e(e,t,n){return ce(()=>{if(e.rank!==4)throw new me(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new me("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=ro()),n!=="channelsLast"&&n!=="channelsFirst")throw new me(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],lo(e,r)})}var Cj=class extends on{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?ro():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new me(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new me(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new me(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new Br({ndim:4})]}computeOutputShape(e){e=En(e);let t,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],t,n]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],t,n,e[3]])}call(e,t){return ce(()=>o2e(Bt(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};Cj.className="ZeroPadding2D";Ve.registerClass(Cj);function kN(e,t,n,r,a,s){return ce(()=>{Pr(a),EV(s),si(r),n==null&&(n=[1,1]),r==null&&(r="valid"),a==null&&(a=ro()),s==null&&(s="max"),e=GE(e,a);let i,l=r==="same"?"same":"valid";return s==="max"?i=ua(e,t,n,l):i=Pl(e,t,n,l),a==="channelsFirst"&&(i=tn(i,[0,3,1,2])),i})}function MU(e,t,n,r,a,s){return ce(()=>{Pr(a),EV(s),si(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),a==null&&(a=ro()),s==null&&(s="max"),e=NU(e,a);let i,l=r==="same"?"same":"valid";return s==="max"?i=FT(e,t,n,l):i=uT(e,t,n,l),a==="channelsFirst"&&(i=tn(i,[0,4,1,2,3])),i})}var $U=class extends on{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new me(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(xa(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new me(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);xa(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,si(this.padding),this.inputSpec=[new Br({ndim:3})]}computeOutputShape(e){e=En(e);let t=eo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return ce(()=>{this.invokeCallHook(e,t),e=Fb(Bt(e),2);let n=this.poolingFunction(Bt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return hc(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}},_j=class extends $U{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),kN(e,t,n,r,a,"max")}};_j.className="MaxPooling1D";Ve.registerClass(_j);var Ij=class extends $U{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),kN(e,t,n,r,a,"avg")}};Ij.className="AveragePooling1D";Ve.registerClass(Ij);var FU=class extends on{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new me(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];xa(this.poolSize,"poolSize"),xa(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pr(this.dataFormat),si(this.padding),this.inputSpec=[new Br({ndim:4})]}computeOutputShape(e){e=En(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=eo(t,this.poolSize[0],this.padding,this.strides[0]),n=eo(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return ce(()=>(this.invokeCallHook(e,t),this.poolingFunction(Bt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},Tj=class extends FU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),kN(e,t,n,r,a,"max")}};Tj.className="MaxPooling2D";Ve.registerClass(Tj);var Ej=class extends FU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),kN(e,t,n,r,a,"avg")}};Ej.className="AveragePooling2D";Ve.registerClass(Ej);var PU=class extends on{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new me(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];xa(this.poolSize,"poolSize"),xa(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pr(this.dataFormat),si(this.padding),this.inputSpec=[new Br({ndim:5})]}computeOutputShape(e){e=En(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=eo(t,this.poolSize[0],this.padding,this.strides[0]),n=eo(n,this.poolSize[1],this.padding,this.strides[1]),r=eo(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return ce(()=>(this.invokeCallHook(e,t),this.poolingFunction(Bt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},jj=class extends PU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),MU(e,t,n,r,a,"max")}};jj.className="MaxPooling3D";Ve.registerClass(jj);var Aj=class extends PU{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return Pr(a),si(r),MU(e,t,n,r,a,"avg")}};Aj.className="AveragePooling3D";Ve.registerClass(Aj);var OU=class extends on{constructor(e){super(e),this.inputSpec=[new Br({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new sn}},Rj=class extends OU{constructor(e){super(e||{})}call(e,t){return ce(()=>{let n=Bt(e);return wr(n,1)})}};Rj.className="GlobalAveragePooling1D";Ve.registerClass(Rj);var Dj=class extends OU{constructor(e){super(e||{})}call(e,t){return ce(()=>{let n=Bt(e);return Qs(n,1)})}};Dj.className="GlobalMaxPooling1D";Ve.registerClass(Dj);var LU=class extends on{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pr(this.dataFormat),this.inputSpec=[new Br({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new sn}getConfig(){let e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},Mj=class extends LU{call(e,t){return ce(()=>{let n=Bt(e);return this.dataFormat==="channelsLast"?wr(n,[1,2]):wr(n,[2,3])})}};Mj.className="GlobalAveragePooling2D";Ve.registerClass(Mj);var $j=class extends LU{call(e,t){return ce(()=>{let n=Bt(e);return this.dataFormat==="channelsLast"?Qs(n,[1,2]):Qs(n,[2,3])})}};$j.className="GlobalMaxPooling2D";Ve.registerClass($j);var zU=class extends on{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){let r=t.layer,a=Ji(r,n);delete t.layer;let s={layer:a};return Object.assign(s,t),new e(s)}},Fj=class extends zU{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=En(e),e.length<3)throw new me(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=En(e);let t=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return ce(()=>(e=Bt(e),AU((n,r)=>[Bt(this.layer.call(n,t)),[]],e,[],!1,null,null,!1,!0)[1]))}};Fj.className="TimeDistributed";Ve.registerClass(Fj);function l2e(e){fp(oke,"BidirectionalMergeMode",e)}var u2e="concat",Pj=class extends zU{constructor(e){super(e);let t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=Ji(n),t.goBackwards=t.goBackwards!==!0;let r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Ji(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?u2e:e.mergeMode,l2e(this.mergeMode),e.weights)throw new sn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let n,r,a;return this.returnState&&(a=t.slice(1)),n=t[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,r=[n]):this.mergeMode==null?r=[n,n.slice()]:r=[n],this.returnState?this.mergeMode==null?r.concat(a).concat(a.slice()):[n].concat(a).concat(a.slice()):ls(r)}apply(e,t){let n=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});let a=jU(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&r==null)return super.apply(e,t);let s=[],i=[];if(n!=null){let u=n.length;if(u%2>0)throw new me("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);let d=n.map(c=>new Br({shape:c.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),i.push(...d)}if(r!=null)throw new sn("Support for constants in Bidirectional layers is not implemented yet.");let l=s[0]instanceof ao;for(let u of s)if(u instanceof ao!==l)throw new me("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){let u=[e].concat(s),d=this.inputSpec.concat(i),c=this.inputSpec;this.inputSpec=d;let h=super.apply(u,t);return this.inputSpec=c,h}else return super.apply(e,t)}call(e,t){return ce(()=>{let n=t.initialState,r,a;if(n==null)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{let l=n.slice(0,n.length/2),u=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let s;this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=ai(a,1));let i;return this.mergeMode==="concat"?i=yE([r,a]):this.mergeMode==="sum"?i=$e(r,a):this.mergeMode==="ave"?i=re(.5,$e(r,a)):this.mergeMode==="mul"?i=re(r,a):this.mergeMode==null&&(i=[r,a]),this.returnState?this.mergeMode==null?i.concat(s):[i].concat(s):i})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ld(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ld(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[t,t]:n=t:this.mergeMode==null?n=[null,null]:n=null,this.returnState){let r=this.forwardLayer.states.map(a=>null);return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){let n=Ji(t.layer);if(delete t.layer,t.numConstants!=null)throw new sn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let r=t;return r.layer=n,new e(r)}};Pj.className="Bidirectional";Ve.registerClass(Pj);var Oj=class extends on{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ce(()=>(e=Bt(e),e.dtype!=="float32"&&(e=jl(e,"float32")),$e(re(e,this.scale),this.offset)))}};Oj.className="Rescaling";Ve.registerClass(Oj);var{resizeBilinear:c2e,cropAndResize:d2e}=Ks,Lj=class extends on{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,s,i,l){return ce(()=>{let u,d=!1,c=t/s,h=n/i,p=(r+t)/s,m=(a+n)/i,f=[c,h,p,m],g=[];e.rank===3?(d=!0,u=Vr([e])):u=e;for(let v=0;v<u.shape[0];v++)g.push(f);let x=Ka(g,[g.length,4]),y=Pd(0,g.length,1,"int32"),b=d2e(u,x,y,[r,a],"nearest");return jl(d?Bt(Er(b)):b,l)})}upsize(e,t,n,r){return ce(()=>{let a=c2e(e,[t,n]);return jl(a,r)})}call(e,t){return ce(()=>{let n=Bt(e),r=n.dtype,a=n.shape,s=a[a.length-3],i=a[a.length-2],l=0;s!==this.height&&(l=Math.floor((s-this.height)/2));let u=0;return i!==this.width&&(u=Math.floor((i-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(n,l,u,this.height,this.width,s,i,r):this.upsize(e,this.height,this.width,r)})}getConfig(){let e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=En(e);let t=e.length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}};Lj.className="CenterCrop";Ve.registerClass(Lj);function h2e(e,t,n,r){let a=Bt(e);if(a.dtype!=="int32"&&(a=jl(a,"int32")),t==="int")return a;let s=a.shape;if(a.rank===0&&(a=ga(a,-1)),t==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=ga(a,-1)),a.rank>2)throw new me(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${a.rank}.`);let i=["multiHot","oneHot"].includes(t),l=a,u;if(typeof r<"u"&&t==="count"?u=s0(l,r,n,i):u=s0(l,[],n,i),t!=="tfIdf")return u;if(r)return re(u,r);throw new me("When outputMode is 'tfIdf', weights must be provided.")}var zj=class extends on{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=En(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return ce(()=>{e=Bt(e),e.dtype!=="int32"&&(e=jl(e,"int32"));let n;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new me(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);n=Bt(t.countWeights)}let r=Qs(e),a=Wm(e),s=es(this.numTokens,r).bufferSync().get(0),i=Ol(a,0).bufferSync().get(0);if(!(s&&i))throw new me(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return h2e(e,this.outputMode,this.numTokens,n)})}};zj.className="CategoryEncoding";Ve.registerClass(zj);var p2e=["bilinear","nearest"],kF=new Set(p2e),Bj=class extends on{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(kF.has(e.interpolation))this.interpolation=e.interpolation;else throw new me(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=En(e);let t=e[2];return[this.height,this.width,t]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return ce(()=>{let n=[this.height,this.width];if(this.interpolation==="bilinear")return Ks.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Ks.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...kF]} are supported`)})}};Bj.className="Resizing";Ve.registerClass(Bj);var BU=class{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}};BU.className="RandomSeed";var WU=class extends on{constructor(e){super(e),this.randomGenerator=new BU(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}};WU.className="BaseRandomLayer";var m2e=["bilinear","nearest"],SF=new Set(m2e),Wj=class extends WU{constructor(e){super(e);let{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new me(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new me(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new me(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(n)if(SF.has(n))this.interpolation=n;else throw new me(`Invalid interpolation parameter: ${n} is not implemented`)}getConfig(){let e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=En(e);let t=e[2];return[this.imgHeight,-1,t]}call(e,t){return ce(()=>{let n=Bt(e);this.imgHeight=n.shape[n.shape.length-3];let r=n.shape[n.shape.length-2];this.widthFactor=cc([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*r;a=Math.round(a);let s=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return Ks.resizeBilinear(e,s);case"nearest":return Ks.resizeNearestNeighbor(e,s);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...SF]} are supported`)}})}};Wj.className="RandomWidth";Ve.registerClass(Wj);function f2e(e){return new Cg(e)}function g2e(e){return new VE(e)}function x2e(e){return new zE(e)}function y2e(e){return new BE(e)}function b2e(e){return new WE(e)}function v2e(e){return new HE(e)}function w2e(e){return new UE(e)}function N2e(e){return new XE(e)}function k2e(e){return new gN(e)}function S2e(e){return new qE(e)}function C2e(e){return new xN(e)}function _2e(e){return new KE(e)}function I2e(e){return new YE(e)}function T2e(e){return new ZE(e)}function E2e(e){return new QE(e)}function j2e(e){return new JE(e)}function A2e(e){return new oj(e)}function R2e(e){return new sj(e)}function D2e(e){return new NN(e)}function M2e(e){return new aj(e)}function $2e(e){return new ij(e)}function F2e(e){return new lj(e)}function P2e(e){return new uj(e)}function O2e(e){return new cj(e)}function L2e(e){return new hj(e)}function z2e(e){return new pj(e)}function B2e(e){return new fj(e)}function W2e(e){return new yj(e)}function V2e(e){return new gj(e)}function U2e(e){return new xj(e)}function H2e(e){return new mj(e)}function G2e(e){return new bj(e)}function q2e(e){return new kj(e)}function K2e(e){return new Sj(e)}function Y2e(e){return new Cj(e)}function Vj(e){return new Ij(e)}function X2e(e){return Vj(e)}function Z2e(e){return Vj(e)}function Uj(e){return new Ej(e)}function Q2e(e){return Uj(e)}function J2e(e){return Uj(e)}function Hj(e){return new Aj(e)}function eCe(e){return Hj(e)}function tCe(e){return Hj(e)}function nCe(e){return new Rj(e)}function rCe(e){return new Mj(e)}function VU(e){return new Dj(e)}function UU(e){return new $j(e)}function HU(e){return new _j(e)}function GU(e){return new Tj(e)}function aCe(e){return new jj(e)}function sCe(e){return new tj(e)}function iCe(e){return new bN(e)}function oCe(e){return new nj(e)}function lCe(e){return new Wb(e)}function uCe(e){return new ej(e)}function cCe(e){return new yN(e)}function dCe(e){return new rj(e)}function hCe(e){return new wN(e)}function pCe(e){return new Bl(e)}function mCe(e){return new vN(e)}function fCe(e){return new Pj(e)}function gCe(e){return new Fj(e)}var xCe=VU,yCe=UU,bCe=HU,vCe=GU;function wCe(e){return new vj(e)}function NCe(e){return new wj(e)}function kCe(e){return new Nj(e)}function SCe(e){return new dj(e)}function CCe(e){return new Oj(e)}function _Ce(e){return new Lj(e)}function ICe(e){return new Bj(e)}function TCe(e){return new zj(e)}function ECe(e){return new Wj(e)}var qU={};Kt(qU,{MAPE:()=>zCe,MSE:()=>VCe,binaryAccuracy:()=>jCe,binaryCrossentropy:()=>ACe,categoricalAccuracy:()=>DCe,categoricalCrossentropy:()=>MCe,cosineProximity:()=>PCe,mape:()=>BCe,meanAbsoluteError:()=>OCe,meanAbsolutePercentageError:()=>LCe,meanSquaredError:()=>WCe,mse:()=>UCe,precision:()=>$Ce,r2Score:()=>HCe,recall:()=>FCe,sparseCategoricalAccuracy:()=>RCe});function jCe(e,t){return ME(e,t)}function ACe(e,t){return XV(e,t)}function RCe(e,t){return ZV(e,t)}function DCe(e,t){return $E(e,t)}function MCe(e,t){return FE(e,t)}function $Ce(e,t){return YV(e,t)}function FCe(e,t){return pSe(e,t)}function PCe(e,t){return DE(e,t)}function OCe(e,t){return hN(e,t)}function LCe(e,t){return _g(e,t)}function zCe(e,t){return _g(e,t)}function BCe(e,t){return _g(e,t)}function WCe(e,t){return gp(e,t)}function VCe(e,t){return gp(e,t)}function UCe(e,t){return gp(e,t)}function HCe(e,t){return mSe(e,t)}var KU={};Kt(KU,{modelFromJSON:()=>USe});var YU={};Kt(YU,{l1:()=>qCe,l1l2:()=>GCe,l2:()=>KCe});function GCe(e){return new zb(e)}function qCe(e){return ZSe(e)}function KCe(e){return QSe(e)}var XU=class extends Xm{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof wl))throw new Error("model must be a LayersModel, not some other Container");this.model=e}};function _v(e,t){return e<t}function CF(e,t){return e>t}var ZU=class extends XU{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new sn("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=_v:this.mode==="max"?this.monitorFunc=CF:this.monitor.indexOf("acc")!==-1?this.monitorFunc=CF:this.monitorFunc=_v,this.monitorFunc===_v&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===_v?1/0:-1/0}async onEpochEnd(e,t){await tu(t);let n=this.getMonitorValue(t);n!=null&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});let t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}};function YCe(e){return new ZU(e)}var XCe={earlyStopping:YCe},ZCe=be();ZCe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Ns;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(Ns||(Ns={}));var _F;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(_F||(_F={}));var Gj={};function QCe(e,t){let n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};Gj[e]=n}function QU(e){return Gj[e]}function JCe(e){delete Gj[e]}function R(e,t,n,r,a){let s=t.inputParams[e];if(s&&s.inputIndexStart!==void 0){let l=s.inputIndexStart,u=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?l+1:s.inputIndexEnd,d=l<0?t.inputNames.length+l:l;if(s.type==="tensor")return Ta(t.inputNames[d],n,r,a);if(s.type==="tensors"){let p=t.inputs.slice(l,u);return t.inputNames.slice(l,u).filter((m,f)=>{var g;return((g=p[f])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(m=>Ta(m,n,r,a))}let c=Ta(t.inputNames[d],n,r,a),h=c.dataSync();return s.type==="number"?h[0]:A.toNestedArray(c.shape,h)}let i=t.attrParams[e];return i&&i.value}function Ta(e,t,n,r){let[a,s]=Is(e,n);if(r!=null){let l=r.getHashTableHandleByName(a);if(l!=null)return l}let i=n.currentContextIds.find(l=>!!t[g0(a,l)]);return i!==void 0?t[g0(a,i)][s]:void 0}function IF(e,t,n){return t[g0(e,n.currentContextId)]}function dl(e,t){let[n,r,a]=Is(e,t);return[g0(n,t&&t.currentContextId),r,a]}function g0(e,t){return t?`${e}-${t}`:e}function Is(e,t){if(e==="")return["",0,void 0];let n=t!=null&&t.parseNodeNameCache!=null;if(n){let s=t.parseNodeNameCache.get(e);if(s!=null)return s}let r=e.split(":"),a;if(r.length===1)a=[e,0,void 0];else{let s=r[0],i=r.length===3?r[1]:void 0,l=Number(r[r.length-1]);a=[s,l,i]}return n&&t.parseNodeNameCache.set(e,a),a}function nw(e,t,n){let r=R("pad",e,t,n);if(r==="explicit"){r=R("explicitPaddings",e,t,n);let a=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)a[s][0]=r[s*2],a[s][1]=r[s*2+1];return a}return r}function hl(e){return e.kept?e:Oo(e)}var JU={};Kt(JU,{json:()=>e_e});var e_e=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],e8={};Kt(e8,{json:()=>t_e});var t_e=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],t8={};Kt(t8,{json:()=>n_e});var n_e=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],n8={};Kt(n8,{json:()=>r_e});var r_e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],r8={};Kt(r8,{json:()=>a_e});var a_e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],a8={};Kt(a8,{json:()=>s_e});var s_e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],s8={};Kt(s8,{json:()=>i_e});var i_e=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],i8={};Kt(i8,{json:()=>o_e});var o_e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],o8={};Kt(o8,{json:()=>l_e});var l_e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],l8={};Kt(l8,{json:()=>u_e});var u_e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],u8={};Kt(u8,{json:()=>c_e});var c_e=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],c8={};Kt(c8,{json:()=>d_e});var d_e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],d8={};Kt(d8,{json:()=>h_e});var h_e=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],h8={};Kt(h8,{json:()=>p_e});var p_e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],p8={};Kt(p8,{json:()=>m_e});var m_e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],m8={};Kt(m8,{json:()=>f_e});var f_e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],f8={};Kt(f8,{json:()=>g_e});var g_e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],g8={};Kt(g8,{json:()=>x_e});var x_e=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],x8={};Kt(x8,{json:()=>y_e});var y_e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],TF=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let e=[JU,e8,t8,n8,r8,a8,s8,i8,o8,l8,u8,c8,d8,h8,p8,m8,f8,g8,x8],t=[].concat(...e.map(n=>n.json));this.opMappers=t.reduce((n,r)=>(n[r.tfOpName]=r,n),{})}transformGraph(e,t={}){let n=e.node,r=[],a=[],s=[],i=n.reduce((f,g)=>(f[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?r.push(f[g.name]):g.op==="Const"?a.push(f[g.name]):(g.input==null||g.input.length===0)&&s.push(f[g.name]),f),{}),l=[],u=[],d={},c={};t!=null&&(d=this.mapSignatureEntries(t.inputs),c=this.mapSignatureEntries(t.outputs));let h=Object.keys(i);h.forEach(f=>{let g=i[f];g.inputNames.forEach((x,y)=>{let[b,,v]=dl(x),w=i[b];if(w.outputs!=null){let N=w.outputs.indexOf(v);if(N!==-1){let S=`${b}:${N}`;g.inputNames[y]=S}}g.inputs.push(w),w.children.push(g)})}),Object.keys(c).length===0?h.forEach(f=>{let g=i[f];g.children.length===0&&u.push(g)}):Object.keys(c).forEach(f=>{let[g]=dl(f),x=i[g];x!=null&&(x.signatureKey=c[f],u.push(x))}),Object.keys(d).length>0?Object.keys(d).forEach(f=>{let[g]=dl(f),x=i[g];x&&(x.signatureKey=d[f],l.push(x))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((f,g)=>(f[g.signature.name]=this.mapFunction(g),f),{}));let m={nodes:i,inputs:l,outputs:u,weights:a,placeholders:r,signature:t,functions:p};return s.length>0&&(m.initNodes=s),m}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){let t=QU(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});let n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce((r,a)=>(r[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},r),{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce((r,a)=>{let s=a.type,i;switch(a.type){case"string":i=bC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=bC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":i=_C(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=_C(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":i=wC(e.attr,a.tfName,a.defaultValue||0),i===void 0&&a.tfDeprecatedName&&(i=wC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":i=CC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=CC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":i=vC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=vC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":i=TC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=TC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":i=SC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=SC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":i=IC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=IC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":i=NC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=NC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":i=kC(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=kC(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":i=EF(e.attr,a.tfName,a.defaultValue),i===void 0&&a.tfDeprecatedName&&(i=EF(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${e.op}`)}return r[a.name]={value:i,type:s},r},{})),n}mapFunction(e){let t=e.nodeDef,n=[],r=[],a={};t!=null&&(a=t.reduce((d,c)=>(d[c.name]=this.mapNode(c),c.op==="Const"&&r.push(d[c.name]),d),{}));let s=[],i=[];e.signature.inputArg.forEach(d=>{let[c]=dl(d.name),h={name:c,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:qj(d.type),type:"dtype"}},children:[]};h.signatureKey=d.name,s.push(h),a[c]=h}),Object.keys(a).forEach(d=>{let c=a[d];c.inputNames.forEach((h,p)=>{let[m,,f]=dl(h),g=a[m];if(g.outputs!=null){let x=g.outputs.indexOf(f);if(x!==-1){let y=`${m}:${x}`;c.inputNames[p]=y}}c.inputs.push(g),g.children.push(c)})});let l=e.ret;e.signature.outputArg.forEach(d=>{let[c,h]=dl(l[d.name]),p=a[c];p!=null&&(p.defaultOutput=h,i.push(p))});let u=this.mapArgsToSignature(e);return{nodes:a,inputs:s,outputs:i,weights:r,placeholders:n,signature:u}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n),t),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}}};function b_e(e){let t=be().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function y8(e,t){let n=Array.isArray(e)?String.fromCharCode.apply(null,e):b_e(e);return t?n:n.toLowerCase()}function bC(e,t,n,r=!1){let a=e[t];return a!=null?y8(a.s,r):n}function vC(e,t,n){let r=e[t];return r?r.b:n}function wC(e,t,n){let r=e[t]||{},a=r.i!=null?r.i:r.f!=null?r.f:n;return typeof a=="number"?a:parseInt(a,10)}function qj(e){switch(typeof e=="string"&&(e=Ns[e]),e){case Ns.DT_FLOAT:case Ns.DT_HALF:return"float32";case Ns.DT_INT32:case Ns.DT_INT64:case Ns.DT_INT8:case Ns.DT_UINT8:return"int32";case Ns.DT_BOOL:return"bool";case Ns.DT_DOUBLE:return"float32";case Ns.DT_STRING:return"string";case Ns.DT_COMPLEX64:case Ns.DT_COMPLEX128:return"complex64";default:return null}}function EF(e,t,n){let r=e[t];return r&&r.func?r.func.name:n}function NC(e,t,n){let r=e[t];return r&&r.type?qj(r.type):n}function kC(e,t,n){let r=e[t];return r&&r.list&&r.list.type?r.list.type.map(a=>qj(a)):n}function b8(e){if(!e.unknownRank)return e.dim!=null?e.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function SC(e,t,n){let r=e[t];return r&&r.shape?b8(r.shape):n}function CC(e,t,n){let r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(a=>typeof a=="number"?a:parseInt(a,10)):n}function _C(e,t,n,r=!1){let a=e[t];return a&&a.list&&a.list.s?a.list.s.map(s=>y8(s,r)):n}function IC(e,t,n){let r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(a=>b8(a)):n}function TC(e,t,n){let r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var v_e=class{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,a)=>(r[a]=this.getAttr(a),r),{}))}getInput(e){return Ta(e,this.tensorMap,this.context)}getAttr(e,t){let n=this.node.rawAttrs[e];if(n.tensor!=null)return Ta(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return wC(this.node.rawAttrs,e,t);if(n.s!=null)return bC(this.node.rawAttrs,e,t);if(n.b!=null)return vC(this.node.rawAttrs,e,t);if(n.shape!=null)return SC(this.node.rawAttrs,e,t);if(n.type!=null)return NC(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return CC(this.node.rawAttrs,e,t);if(n.list.s!=null)return _C(this.node.rawAttrs,e,t);if(n.list.shape!=null)return IC(this.node.rawAttrs,e,t);if(n.list.b!=null)return TC(this.node.rawAttrs,e,t);if(n.list.type!=null)return kC(this.node.rawAttrs,e,t)}return t}},wa={};Kt(wa,{OP_SCOPE_SUFFIX:()=>YI,abs:()=>zr,acos:()=>eT,acosh:()=>tT,add:()=>$e,addN:()=>DW,all:()=>S1,any:()=>hy,argMax:()=>Dd,argMin:()=>nT,asin:()=>rT,asinh:()=>aT,atan:()=>sT,atan2:()=>iT,atanh:()=>oT,avgPool:()=>Pl,avgPool3d:()=>uT,basicLSTMCell:()=>PW,batchNorm:()=>dp,batchNorm2d:()=>cT,batchNorm3d:()=>dT,batchNorm4d:()=>hT,batchToSpaceND:()=>wb,bincount:()=>pT,bitwiseAnd:()=>OW,booleanMaskAsync:()=>I6,broadcastArgs:()=>LW,broadcastTo:()=>od,buffer:()=>nn,cast:()=>Xe,ceil:()=>mT,clipByValue:()=>Oa,clone:()=>Oo,complex:()=>El,concat:()=>nr,concat1d:()=>fT,concat2d:()=>gT,concat3d:()=>xT,concat4d:()=>yT,conv1d:()=>C1,conv2d:()=>Ya,conv2dTranspose:()=>_1,conv3d:()=>vT,conv3dTranspose:()=>wT,cos:()=>Nb,cosh:()=>I1,cosineWindow:()=>X1,cumprod:()=>fy,cumsum:()=>T1,denseBincount:()=>s0,depthToSpace:()=>NT,depthwiseConv2d:()=>hp,diag:()=>BW,dilation2d:()=>kT,div:()=>ft,divNoNan:()=>ST,dot:()=>CT,dropout:()=>eE,einsum:()=>$c,elu:()=>yg,enclosingPowerOfTwo:()=>tE,ensureShape:()=>VW,equal:()=>Fs,erf:()=>E1,euclideanNorm:()=>TT,exp:()=>La,expandDims:()=>ga,expm1:()=>ET,eye:()=>j1,fft:()=>Rb,fill:()=>$s,floor:()=>vg,floorDiv:()=>k1,fused:()=>Km,gather:()=>wg,gatherND:()=>A6,greater:()=>es,greaterEqual:()=>Ol,ifft:()=>qm,imag:()=>kb,image:()=>Ks,inTopKAsync:()=>R6,irfft:()=>V1,isFinite:()=>jT,isInf:()=>AT,isNaN:()=>RT,leakyRelu:()=>Sb,less:()=>Vm,lessEqual:()=>uc,linalg:()=>aE,linspace:()=>KW,localResponseNormalization:()=>DT,log:()=>Ps,log1p:()=>Cb,logSigmoid:()=>MT,logSoftmax:()=>R1,logSumExp:()=>_b,logicalAnd:()=>_i,logicalNot:()=>Ib,logicalOr:()=>D1,logicalXor:()=>$T,losses:()=>U6,lowerBound:()=>XW,matMul:()=>en,max:()=>Qs,maxPool:()=>ua,maxPool3d:()=>FT,maxPoolWithArgmax:()=>ZW,maximum:()=>Zo,mean:()=>wr,meshgrid:()=>QW,min:()=>Wm,minimum:()=>Vu,mirrorPad:()=>PT,mod:()=>OT,moments:()=>Tb,movingAverage:()=>T6,mul:()=>re,multiRNNCell:()=>JW,multinomial:()=>e6,neg:()=>pr,norm:()=>bg,notEqual:()=>Fd,oneHot:()=>Um,ones:()=>ds,onesLike:()=>Os,op:()=>ne,outerProduct:()=>t6,pad:()=>lo,pad1d:()=>n6,pad2d:()=>r6,pad3d:()=>a6,pad4d:()=>s6,pool:()=>LT,pow:()=>Uo,prelu:()=>jb,print:()=>JI,prod:()=>zT,raggedGather:()=>i6,raggedRange:()=>o6,raggedTensorToTensor:()=>l6,rand:()=>u6,randomGamma:()=>p6,randomNormal:()=>$1,randomStandardNormal:()=>m6,randomUniform:()=>cc,randomUniformInt:()=>f6,range:()=>Pd,real:()=>Hm,reciprocal:()=>HT,relu:()=>Kn,relu6:()=>F1,reshape:()=>ue,reverse:()=>ai,reverse1d:()=>g6,reverse2d:()=>x6,reverse3d:()=>y6,reverse4d:()=>b6,rfft:()=>Db,round:()=>P1,rsqrt:()=>O1,scalar:()=>jt,scatterND:()=>E6,searchSorted:()=>M1,selu:()=>L1,separableConv2d:()=>Ng,setdiff1dAsync:()=>v6,sigmoid:()=>wi,sign:()=>GT,signal:()=>V6,sin:()=>z1,sinh:()=>B1,slice:()=>pn,slice1d:()=>Ab,slice2d:()=>W1,slice3d:()=>kg,slice4d:()=>Gm,softmax:()=>dc,softplus:()=>pp,spaceToBatchND:()=>Eb,sparse:()=>H6,sparseToDense:()=>j6,spectral:()=>W6,split:()=>hs,sqrt:()=>ba,square:()=>tr,squaredDifference:()=>U1,squeeze:()=>hc,stack:()=>Vr,step:()=>mp,stridedSlice:()=>qT,string:()=>G6,sub:()=>dt,sum:()=>kt,tan:()=>KT,tanh:()=>Wu,tensor:()=>Ka,tensor1d:()=>Vn,tensor2d:()=>Lo,tensor3d:()=>H1,tensor4d:()=>Uu,tensor5d:()=>w6,tensor6d:()=>N6,tensorScatterUpdate:()=>S6,tile:()=>Rs,topk:()=>XT,transpose:()=>tn,truncatedNormal:()=>K1,unique:()=>ZT,unsortedSegmentSum:()=>Y1,unstack:()=>Er,upperBound:()=>C6,variable:()=>QT,where:()=>ya,whereAsync:()=>JT,zeros:()=>Nr,zerosLike:()=>Nn});var w_e=(e,t,n,r=wa)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(R("a",e,t,n),R("b",e,t,n))];case"AddN":return[r.addN(R("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(R("a",e,t,n),R("b",e,t,n))];case"Mul":return[r.mul(R("a",e,t,n),R("b",e,t,n))];case"RealDiv":case"Div":return[r.div(R("a",e,t,n),R("b",e,t,n))];case"DivNoNan":return[r.divNoNan(R("a",e,t,n),R("b",e,t,n))];case"FloorDiv":return[r.floorDiv(R("a",e,t,n),R("b",e,t,n))];case"Sub":return[r.sub(R("a",e,t,n),R("b",e,t,n))];case"Minimum":return[r.minimum(R("a",e,t,n),R("b",e,t,n))];case"Maximum":return[r.maximum(R("a",e,t,n),R("b",e,t,n))];case"Pow":return[r.pow(R("a",e,t,n),R("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(R("a",e,t,n),R("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},N_e=(e,t,n,r=wa)=>{switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(R("x",e,t,n))];case"Acos":return[r.acos(R("x",e,t,n))];case"Acosh":return[r.acosh(R("x",e,t,n))];case"Asin":return[r.asin(R("x",e,t,n))];case"Asinh":return[r.asinh(R("x",e,t,n))];case"Atan":return[r.atan(R("x",e,t,n))];case"Atan2":return[r.atan2(R("x",e,t,n),R("y",e,t,n))];case"Atanh":return[r.atanh(R("x",e,t,n))];case"Ceil":return[r.ceil(R("x",e,t,n))];case"Complex":return[r.complex(R("real",e,t,n),R("imag",e,t,n))];case"Cos":return[r.cos(R("x",e,t,n))];case"Cosh":return[r.cosh(R("x",e,t,n))];case"Elu":return[r.elu(R("x",e,t,n))];case"Erf":return[r.erf(R("x",e,t,n))];case"Exp":return[r.exp(R("x",e,t,n))];case"Expm1":return[r.expm1(R("x",e,t,n))];case"Floor":return[r.floor(R("x",e,t,n))];case"Log":return[r.log(R("x",e,t,n))];case"Log1p":return[r.log1p(R("x",e,t,n))];case"Imag":return[r.imag(R("x",e,t,n))];case"Neg":return[r.neg(R("x",e,t,n))];case"Reciprocal":return[r.reciprocal(R("x",e,t,n))];case"Real":return[r.real(R("x",e,t,n))];case"Relu":return[r.relu(R("x",e,t,n))];case"Round":return[r.round(R("x",e,t,n))];case"Selu":return[r.selu(R("x",e,t,n))];case"Sigmoid":return[r.sigmoid(R("x",e,t,n))];case"Sin":return[r.sin(R("x",e,t,n))];case"Sign":return[r.sign(R("x",e,t,n))];case"Sinh":return[r.sinh(R("x",e,t,n))];case"Softplus":return[r.softplus(R("x",e,t,n))];case"Sqrt":return[r.sqrt(R("x",e,t,n))];case"Square":return[r.square(R("x",e,t,n))];case"Tanh":return[r.tanh(R("x",e,t,n))];case"Tan":return[r.tan(R("x",e,t,n))];case"ClipByValue":return[r.clipByValue(R("x",e,t,n),R("clipValueMin",e,t,n),R("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(R("x",e,t,n))];case"Rsqrt":return[r.rsqrt(Ta(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(R("x",e,t,n),R("alpha",e,t,n))];case"Prelu":return[r.prelu(R("x",e,t,n),R("alpha",e,t,n))];case"IsNan":return[r.isNaN(Ta(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(Ta(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(Ta(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function pi(e,t,n=""){if(!(typeof e=="number"||typeof t=="number")){A.assert(e.length===t.length,()=>n+` Shapes ${e} and ${t} must match`);for(let r=0;r<e.length;r++){let a=e[r],s=t[r];A.assert(a<0||s<0||a===s,()=>n+` Shapes ${e} and ${t} must match`)}}}function jF(e){return!(typeof e=="number"||e.some(t=>t<0))}function ox(e,t,n){let r=EC(e,n),a=!jF(r);if(a&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach(s=>{r=EC(s.shape,r)}),!jF(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function EC(e,t){if(typeof e=="number")return t;if(typeof t=="number")return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);let n=[];for(let r=0;r<e.length;++r){let a=e[r],s=t[r];if(a>=0&&s>=0&&a!==s)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:s}return n}var k_e=class{constructor(e,t,n,r,a,s,i){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=s,this.clearAfterRead=i,this.tensors=[],this.closed_=!1,this.idTensor=jt(0),Zr(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);let t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),pi(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,Zr(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((n,r)=>this.write(n,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Ka([],[0].concat(this.elementShape));let n=this.readMany(e);return pi(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Vr(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Ka([],[0].concat(this.elementShape));let t=[];for(let r=0;r<this.size();r++)t.push(r);let n=this.readMany(t);return pi(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),nr(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);let n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Er(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0,r=e.map(l=>(n+=l,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);let a=n===0?0:t.size/n,s=[];ce(()=>{t=ue(t,[1,n,a]);for(let l=0;l<e.length;++l){let u=[0,l===0?0:r[l-1],0],d=[1,e[l],a];s[l]=ue(pn(t,u,d),this.elementShape)}return s});let i=[];for(let l=0;l<e.length;l++)i[l]=l;this.writeMany(i,s)}},SN=class jC{get id(){return this.idTensor.id}constructor(t,n,r,a=-1){this.tensors=t,this.elementShape=n,this.elementDtype=r,t!=null&&t.forEach(s=>{if(r!==s.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${s.dtype}`);pi(n,s.shape,"TensorList shape mismatch: "),Zr(s)}),this.idTensor=jt(0),this.maxNumElements=a,Zr(this.idTensor)}copy(){return new jC([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(n=>{(t==null||!t.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,n,r=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);pi(t,this.elementShape,"TensorList shape mismatch: ");let a=ox(this.elementShape,this.tensors,t);return ce(()=>{let s=this.tensors.map(i=>ue(i,a));return Vr(s,0)})}popBack(t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let r=ox(this.elementShape,this.tensors,t),a=this.tensors.pop();return a.kept=!1,pi(a.shape,t,"TensorList shape mismatch: "),ue(a,r)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(pi(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Zr(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);let n=new jC([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(let r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}getItem(t,n,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);pi(this.tensors[t].shape,n,"TensorList shape mismatch: ");let a=ox(this.elementShape,this.tensors,n);return ue(this.tensors[t],a)}setItem(t,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);pi(this.elementShape,n.shape,"TensorList shape mismatch: "),Zr(n),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=n}gather(t,n,r){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);pi(this.elementShape,r,"TensorList shape mismatch: "),t=t.slice(0,this.size());let a=ox(this.elementShape,this.tensors,r);return t.length===0?Ka([],[0].concat(a)):ce(()=>{let s=t.map(i=>ue(this.tensors[i],a));return Vr(s,0)})}concat(t,n){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);pi(this.elementShape,n,"TensorList shape mismatch: ");let r=ox(this.elementShape,this.tensors,n);return this.size()===0?Ka([],[0].concat(r)):ce(()=>{let a=this.tensors.map(s=>ue(s,r));return nr(a,0)})}};function S_e(e,t,n){let r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);let a=e.shape.slice(1);pi(a,t,"TensorList shape mismatch: ");let s=Er(e);return new SN(s,t,r)}function C_e(e,t,n,r){return new SN([],e,t,r)}function __e(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let a=Math.max(...t);if(r!=null&&r!==-1&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);let s=new SN([],n,e.dtype,r),i=Er(e,0);return t.forEach((l,u)=>{s.setItem(l,i[u])}),s}function I_e(e,t,n){let r=0,a=t.map(c=>(r+=c,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${e.shape}`);let s=e.shape.slice(1),i=EC(s,n),l=r===0?0:e.size/r,u=ce(()=>{let c=[];e=ue(e,[1,r,l]);for(let h=0;h<t.length;++h){let p=[0,h===0?0:a[h-1],0],m=[1,t[h],l];c[h]=ue(pn(e,p,m),i)}return e.dispose(),c}),d=new SN([],n,e.dtype,t.length);for(let c=0;c<u.length;c++)d.setItem(c,u[c]);return d}var T_e=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{let r=R("thenBranch",e,t,n),a=R("elseBranch",e,t,n),s=R("cond",e,t,n),i=R("args",e,t,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(i,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{let r=R("body",e,t,n),a=R("cond",e,t,n),s=R("args",e,t,n),i=await n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),l=s.map(c=>c.id),u=await i[0].data();i.forEach(c=>{!c.kept&&l.indexOf(c.id)===-1&&c.dispose()});let d=s;for(;u[0];){let c=d;d=await n.functionMap[r].executeFunctionAsync(d,n.tensorArrayMap,n.tensorListMap);let h=d.map(m=>m.id);c.forEach(m=>{!m.kept&&l.indexOf(m.id)===-1&&h.indexOf(m.id)===-1&&m.dispose()});let p=await n.functionMap[a].executeFunctionAsync(d,n.tensorArrayMap,n.tensorListMap);u=await p[0].data(),p.forEach(m=>{!m.kept&&l.indexOf(m.id)===-1&&h.indexOf(m.id)===-1&&m.dispose()})}return d}case"LoopCond":{let r=R("pred",e,t,n);return[hl(r)]}case"Switch":{let r=R("pred",e,t,n),a=R("data",e,t,n);return a.kept||(a=hl(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{let r=e.inputNames.find(a=>Ta(a,t,n)!==void 0);if(r){let a=Ta(r,t,n);return[hl(a)]}return}case"Enter":{let r=R("frameName",e,t,n),a=R("tensor",e,t,n);return n.enterFrame(r),[hl(a)]}case"Exit":{let r=R("tensor",e,t,n);return n.exitFrame(),[hl(r)]}case"NextIteration":{let r=R("tensor",e,t,n);return n.nextIteration(),[hl(r)]}case"TensorArrayV3":{let r=R("size",e,t,n),a=R("dtype",e,t,n),s=R("elementShape",e,t,n),i=R("dynamicSize",e,t,n),l=R("clearAfterRead",e,t,n),u=R("identicalElementShapes",e,t,n),d=R("name",e,t,n),c=new k_e(d,a,r,s,u,i,l);return n.addTensorArray(c),[c.idTensor,jt(1)]}case"TensorArrayWriteV3":{let r=R("tensorArrayId",e,t,n),a=R("index",e,t,n),s=R("tensor",e,t,n),i=n.getTensorArray(r.id);return i.write(a,s),[i.idTensor]}case"TensorArrayReadV3":{let r=R("tensorArrayId",e,t,n),a=R("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{let r=R("tensorArrayId",e,t,n),a=R("indices",e,t,n),s=R("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,s)]}case"TensorArrayScatterV3":{let r=R("tensorArrayId",e,t,n),a=R("indices",e,t,n),s=R("tensor",e,t,n),i=n.getTensorArray(r.id);return i.scatter(a,s),[i.idTensor]}case"TensorArrayConcatV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),s=R("dtype",e,t,n);return[a.concat(s)]}case"TensorArraySplitV3":{let r=R("tensorArrayId",e,t,n),a=R("tensor",e,t,n),s=R("lengths",e,t,n),i=n.getTensorArray(r.id);return i.split(s,a),[i.idTensor]}case"TensorArraySizeV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return[jt(a.size(),"int32")]}case"TensorArrayCloseV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{let r=R("tensorListId",e,t,n),a=R("index",e,t,n),s=R("tensor",e,t,n),i=n.getTensorList(r.id);return i.setItem(a,s),[i.idTensor]}case"TensorListGetItem":{let r=R("tensorListId",e,t,n),a=R("index",e,t,n),s=R("elementShape",e,t,n),i=R("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,s,i)]}case"TensorListScatterV2":case"TensorListScatter":{let r=R("indices",e,t,n),a=R("tensor",e,t,n),s=R("elementShape",e,t,n),i=R("numElements",e,t,n),l=__e(a,r,s,i);return n.addTensorList(l),[l.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r=R("elementShape",e,t,n),a=R("elementDType",e,t,n),s;e.op==="TensorListReserve"?s="numElements":s="maxNumElements";let i=R(s,e,t,n),l=e.op==="TensorListReserve"?-1:i,u=C_e(r,a,i,l);return n.addTensorList(u),[u.idTensor]}case"TensorListGather":{let r=R("tensorListId",e,t,n),a=R("indices",e,t,n),s=R("elementShape",e,t,n),i=R("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,i,s)]}case"TensorListStack":{let r=R("tensorListId",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n),i=R("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,s,i)]}case"TensorListFromTensor":{let r=R("tensor",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n),i=S_e(r,a,s);return n.addTensorList(i),[i.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let r=R("tensorListId",e,t,n),a=n.getTensorList(r.id),s=R("dtype",e,t,n),i=R("elementShape",e,t,n);return[a.concat(s,i)]}case"TensorListPushBack":{let r=R("tensorListId",e,t,n),a=R("tensor",e,t,n),s=n.getTensorList(r.id);return s.pushBack(a),[s.idTensor]}case"TensorListPopBack":{let r=R("tensorListId",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,s)]}case"TensorListSplit":{let r=R("tensor",e,t,n),a=R("elementShape",e,t,n),s=R("lengths",e,t,n),i=I_e(r,s,a);return n.addTensorList(i),[i.idTensor]}case"TensorListLength":{let r=R("tensorListId",e,t,n),a=n.getTensorList(r.id);return[jt(a.size(),"int32")]}case"TensorListResize":{let r=R("tensorListId",e,t,n),a=R("size",e,t,n),s=n.getTensorList(r.id).resize(a);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};function AF(e,t,n){let[r,a]=R("fusedOps",e,t,n),s=r==="biasadd",i=!s,l=a==="prelu",u=r==="fusedbatchnorm",d=R("numArgs",e,t,n);if(s){if(l&&d!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&s&&d!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let c=R("strides",e,t,n),h=nw(e,t,n),p=R("dataFormat",e,t,n).toUpperCase(),m=R("dilations",e,t,n),[f,g]=R("args",e,t,n);i&&(g=f,f=void 0);let x=R("leakyreluAlpha",e,t,n);return{stride:c,pad:h,dataFormat:p,dilations:m,biasArg:f,preluArg:g,activationFunc:a,leakyreluAlpha:x}}var E_e=(e,t,n,r=wa)=>{switch(e.op){case"Conv1D":{let a=R("stride",e,t,n),s=R("pad",e,t,n),i=R("dataFormat",e,t,n).toUpperCase(),l=R("dilation",e,t,n);return[r.conv1d(R("x",e,t,n),R("filter",e,t,n),a,s,i,l)]}case"Conv2D":{let a=R("strides",e,t,n),s=nw(e,t,n),i=R("dataFormat",e,t,n).toUpperCase(),l=R("dilations",e,t,n);return[r.conv2d(R("x",e,t,n),R("filter",e,t,n),[a[1],a[2]],s,i,[l[1],l[2]])]}case"_FusedConv2D":{let{stride:a,pad:s,dataFormat:i,dilations:l,biasArg:u,preluArg:d,activationFunc:c,leakyreluAlpha:h}=AF(e,t,n);return[r.fused.conv2d({x:R("x",e,t,n),filter:R("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:i,dilations:[l[1],l[2]],bias:u,activation:c,preluActivationWeights:d,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{let{stride:a,pad:s,dataFormat:i,dilations:l,biasArg:u,preluArg:d,activationFunc:c,leakyreluAlpha:h}=AF(e,t,n);return[r.fused.depthwiseConv2d({x:R("x",e,t,n),filter:R("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:i,dilations:[l[1],l[2]],bias:u,activation:c,preluActivationWeights:d,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let a=R("outputShape",e,t,n),s=R("strides",e,t,n),i=nw(e,t,n);return[r.conv2dTranspose(R("x",e,t,n),R("filter",e,t,n),a,[s[1],s[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let a=R("strides",e,t,n),s=nw(e,t,n),i=R("dilations",e,t,n),l=R("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(R("input",e,t,n),R("filter",e,t,n),[a[1],a[2]],s,l,[i[1],i[2]])]}case"Conv3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("dataFormat",e,t,n).toUpperCase(),l=R("dilations",e,t,n);return[r.conv3d(R("x",e,t,n),R("filter",e,t,n),[a[1],a[2],a[3]],s,i,[l[1],l[2],l[3]])]}case"AvgPool":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("kernelSize",e,t,n);return[r.avgPool(R("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s)]}case"MaxPool":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("kernelSize",e,t,n);return[r.maxPool(R("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s)]}case"MaxPoolWithArgmax":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("kernelSize",e,t,n),l=R("includeBatchInIndex",e,t,n),{result:u,indexes:d}=r.maxPoolWithArgmax(R("x",e,t,n),[i[1],i[2]],[a[1],a[2]],s,l);return[u,d]}case"AvgPool3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("kernelSize",e,t,n);return[r.avgPool3d(R("x",e,t,n),[i[1],i[2],i[3]],[a[1],a[2],a[3]],s)]}case"MaxPool3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("kernelSize",e,t,n);return[r.maxPool3d(R("x",e,t,n),[i[1],i[2],i[3]],[a[1],a[2],a[3]],s)]}case"Dilation2D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),i=R("dilations",e,t,n),l=a[1],u=a[2],d=i[1],c=i[2];return[r.dilation2d(R("x",e,t,n),R("filter",e,t,n),[l,u],s,[d,c],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},j_e=(e,t,n,r=wa)=>{switch(e.op){case"Fill":{let a=R("shape",e,t,n),s=R("dtype",e,t,n),i=R("value",e,t,n);return[r.fill(a,i,s)]}case"LinSpace":{let a=R("start",e,t,n),s=R("stop",e,t,n),i=R("num",e,t,n);return[r.linspace(a,s,i)]}case"Multinomial":{let a=R("logits",e,t,n),s=R("numSamples",e,t,n),i=R("seed",e,t,n);return[r.multinomial(a,s,i)]}case"OneHot":{let a=R("indices",e,t,n),s=R("depth",e,t,n),i=R("onValue",e,t,n),l=R("offValue",e,t,n),u=R("dtype",e,t,n);return[r.oneHot(a,s,i,l,u)]}case"Ones":return[r.ones(R("shape",e,t,n),R("dtype",e,t,n))];case"OnesLike":return[r.onesLike(R("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(R("shape",e,t,n),R("dtype",e,t,n),R("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(R("shape",e,t,n),R("minval",e,t,n),R("maxval",e,t,n),R("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(R("shape",e,t,n),R("minval",e,t,n),R("maxval",e,t,n),R("seed",e,t,n))];case"Range":{let a=R("start",e,t,n),s=R("stop",e,t,n),i=R("step",e,t,n);return[r.range(a,s,i,R("dtype",e,t,n))]}case"TruncatedNormal":{let a=R("shape",e,t,n),s=R("mean",e,t,n),i=R("stdDev",e,t,n),l=R("seed",e,t,n);return[r.truncatedNormal(a,s,i,R("dtype",e,t,n),l)]}case"Zeros":return[r.zeros(R("shape",e,t,n),R("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function pS(e,t,n){let r=R("boxes",e,t,n),a=R("scores",e,t,n),s=R("maxOutputSize",e,t,n),i=R("iouThreshold",e,t,n),l=R("scoreThreshold",e,t,n),u=R("softNmsSigma",e,t,n);return{boxes:r,scores:a,maxOutputSize:s,iouThreshold:i,scoreThreshold:l,softNmsSigma:u}}var A_e=async(e,t,n,r,a=wa)=>{switch(e.op){case"NonMaxSuppressionV5":{let{boxes:s,scores:i,maxOutputSize:l,iouThreshold:u,scoreThreshold:d,softNmsSigma:c}=pS(e,t,n),h=await a.image.nonMaxSuppressionWithScoreAsync(s,i,l,u,d,c);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:s,scores:i,maxOutputSize:l,iouThreshold:u,scoreThreshold:d}=pS(e,t,n),c=R("padToMaxOutputSize",e,t,n),h=await a.image.nonMaxSuppressionPaddedAsync(s,i,l,u,d,c);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:s,scores:i,maxOutputSize:l,iouThreshold:u,scoreThreshold:d}=pS(e,t,n);return[await a.image.nonMaxSuppressionAsync(s,i,l,u,d)]}case"Where":{let s=a.cast(R("condition",e,t,n),"bool"),i=[await a.whereAsync(s)];return s.dispose(),i}case"ListDiff":return a.setdiff1dAsync(R("x",e,t,n),R("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}},R_e=(e,t,n,r=wa)=>{switch(e.op){case"LowerBound":{let a=R("sortedSequence",e,t,n),s=R("values",e,t,n);return[r.lowerBound(a,s)]}case"TopKV2":{let a=R("x",e,t,n),s=R("k",e,t,n),i=R("sorted",e,t,n),l=r.topk(a,s,i);return[l.values,l.indices]}case"UpperBound":{let a=R("sortedSequence",e,t,n),s=R("values",e,t,n);return[r.upperBound(a,s)]}case"Unique":{let a=R("x",e,t,n),s=r.unique(a);return[s.values,s.indices]}case"UniqueV2":{let a=R("x",e,t,n),s=R("axis",e,t,n),i=r.unique(a,s);return[i.values,i.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},D_e=(e,t,n,r=wa)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":let a=R("default",e,t,n);return[Ta(e.name,t,n)||a];case"Placeholder":return[Ta(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let c=R("x",e,t,n);return[hl(c)]}case"IdentityN":return R("x",e,t,n).map(c=>hl(c));case"Snapshot":let s=R("x",e,t,n);return[hl(s)];case"Shape":return[r.tensor1d(R("x",e,t,n).shape,"int32")];case"ShapeN":return R("x",e,t,n).map(c=>r.tensor1d(c.shape));case"Size":return[r.scalar(R("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(R("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":let i=R("x",e,t,n),l=R("data",e,t,n),u=R("message",e,t,n),d=R("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(u);for(let c=0;c<l.length;c++)console.log(Array.prototype.slice.call(l[c].dataSync()).slice(0,d));return[i];default:throw TypeError(`Node type ${e.op} is not implemented`)}},M_e=class{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=jt(0),this.tensorMap=new Map,Zr(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return jt(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),ce(()=>{let r=Er(t),a=n.length,s=r.length;A.assert(a===s,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${s} elements.`);for(let i=0;i<a;i++){let l=n[i],u=r[i];Zr(u),this.tensorMap.set(l,u)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return ce(()=>{let r=[];for(let a=0;a<n.length;a++){let s=n[a],i=this.findWithDefault(s,t);r.push(i)}return Vr(r)})}findWithDefault(e,t){let n=this.tensorMap.get(e);return n??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}},$_e=async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{let a=r.getHashTableHandleByName(e.name);if(a!=null)return[a];{let s=R("keyDType",e,t,n),i=R("valueDType",e,t,n),l=new M_e(s,i);return r.addHashTable(e.name,l),[l.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let a=R("tableHandle",e,t,n,r),s=R("keys",e,t,n),i=R("values",e,t,n);return[await r.getHashTableById(a.id).import(s,i)]}case"LookupTableFind":case"LookupTableFindV2":{let a=R("tableHandle",e,t,n,r),s=R("keys",e,t,n),i=R("defaultValue",e,t,n);return[await r.getHashTableById(a.id).find(s,i)]}case"LookupTableSize":case"LookupTableSizeV2":{let a=R("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},F_e=(e,t,n,r=wa)=>{switch(e.op){case"ResizeBilinear":{let a=R("images",e,t,n),s=R("size",e,t,n),i=R("alignCorners",e,t,n),l=R("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[s[0],s[1]],i,l)]}case"ResizeNearestNeighbor":{let a=R("images",e,t,n),s=R("size",e,t,n),i=R("alignCorners",e,t,n),l=R("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[s[0],s[1]],i,l)]}case"CropAndResize":{let a=R("image",e,t,n),s=R("boxes",e,t,n),i=R("boxInd",e,t,n),l=R("cropSize",e,t,n),u=R("method",e,t,n),d=R("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,s,i,l,u,d)]}case"ImageProjectiveTransformV3":{let a=R("images",e,t,n),s=R("transforms",e,t,n),i=R("outputShape",e,t,n),l=R("fillValue",e,t,n),u=R("interpolation",e,t,n),d=R("fillMode",e,t,n);return[r.image.transform(a,s,u.toLowerCase(),d.toLowerCase(),l,i)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},P_e=(e,t,n,r=wa)=>{switch(e.op){case"Equal":return[r.equal(R("a",e,t,n),R("b",e,t,n))];case"NotEqual":return[r.notEqual(R("a",e,t,n),R("b",e,t,n))];case"Greater":return[r.greater(R("a",e,t,n),R("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(R("a",e,t,n),R("b",e,t,n))];case"Less":return[r.less(R("a",e,t,n),R("b",e,t,n))];case"LessEqual":return[r.lessEqual(R("a",e,t,n),R("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(R("a",e,t,n),R("b",e,t,n))];case"LogicalNot":return[r.logicalNot(R("a",e,t,n))];case"LogicalOr":return[r.logicalOr(R("a",e,t,n),R("b",e,t,n))];case"Select":case"SelectV2":return[r.where(R("condition",e,t,n),R("a",e,t,n),R("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(R("a",e,t,n),R("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},O_e=(e,t,n,r=wa)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(R("a",e,t,n),R("b",e,t,n),R("transposeA",e,t,n),R("transposeB",e,t,n))];case"Einsum":return[r.einsum(R("equation",e,t,n),...R("tensors",e,t,n))];case"Transpose":return[r.transpose(R("x",e,t,n),R("perm",e,t,n))];case"_FusedMatMul":let[a,s]=R("fusedOps",e,t,n),i=a==="biasadd",l=s==="prelu",u=R("numArgs",e,t,n),d=R("leakyreluAlpha",e,t,n);if(i){if(l&&u!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&u!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[c,h]=R("args",e,t,n);return[r.fused.matMul({a:R("a",e,t,n),b:R("b",e,t,n),transposeA:R("transposeA",e,t,n),transposeB:R("transposeB",e,t,n),bias:c,activation:s,preluActivationWeights:h,leakyreluAlpha:d})];case"MatrixBandPart":return[r.linalg.bandPart(R("a",e,t,n),R("numLower",e,t,n),R("numUpper",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},L_e=(e,t,n,r=wa)=>{switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(R("x",e,t,n),R("axis",e,t,n),R("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(R("x",e,t,n),R("mean",e,t,n),R("variance",e,t,n),R("offset",e,t,n),R("scale",e,t,n),R("epsilon",e,t,n))];case"FusedBatchNormV3":return[r.batchNorm(R("x",e,t,n),R("mean",e,t,n),R("variance",e,t,n),R("offset",e,t,n),R("scale",e,t,n),R("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(R("x",e,t,n),R("radius",e,t,n),R("bias",e,t,n),R("alpha",e,t,n),R("beta",e,t,n))];case"Softmax":return[r.softmax(R("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},z_e=(e,t,n,r=wa)=>{switch(e.op){case"RaggedGather":{let{outputNestedSplits:a,outputDenseValues:s}=r.raggedGather(R("paramsNestedSplits",e,t,n),R("paramsDenseValues",e,t,n),R("indices",e,t,n),R("outputRaggedRank",e,t,n));return a.concat(s)}case"RaggedRange":{let{rtNestedSplits:a,rtDenseValues:s}=r.raggedRange(R("starts",e,t,n),R("limits",e,t,n),R("splits",e,t,n));return[a,s]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(R("shape",e,t,n),R("values",e,t,n),R("defaultValue",e,t,n),R("rowPartitionTensors",e,t,n),R("rowPartitionTypes",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},B_e=(e,t,n,r=wa)=>{switch(e.op){case"Max":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.max(R("x",e,t,n),l,u)]}case"Mean":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.mean(R("x",e,t,n),l,u)]}case"Min":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.min(R("x",e,t,n),l,u)]}case"Sum":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.sum(R("x",e,t,n),l,u)]}case"All":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.all(R("x",e,t,n),l,u)]}case"Any":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.any(R("x",e,t,n),l,u)]}case"ArgMax":{let l=R("axis",e,t,n);return[r.argMax(R("x",e,t,n),l)]}case"ArgMin":{let l=R("axis",e,t,n);return[r.argMin(R("x",e,t,n),l)]}case"Prod":{let l=R("axis",e,t,n),u=R("keepDims",e,t,n);return[r.prod(R("x",e,t,n),l,u)]}case"Cumprod":{let l=R("axis",e,t,n),u=R("exclusive",e,t,n),d=R("reverse",e,t,n);return[r.cumprod(R("x",e,t,n),l,u,d)]}case"Cumsum":{let l=R("axis",e,t,n),u=R("exclusive",e,t,n),d=R("reverse",e,t,n);return[r.cumsum(R("x",e,t,n),l,u,d)]}case"Bincount":let a=R("x",e,t,n),s=R("weights",e,t,n),i=R("size",e,t,n);return[r.bincount(a,s,i)];case"DenseBincount":{let l=R("x",e,t,n),u=R("weights",e,t,n),d=R("size",e,t,n),c=R("binaryOutput",e,t,n);return[r.denseBincount(l,u,d,c)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},W_e=(e,t,n,r=wa)=>{switch(e.op){case"ConcatV2":case"Concat":{let a=R("n",e,t,n),s=R("axis",e,t,n),i=R("tensors",e,t,n);return i=i.slice(0,a),[r.concat(i,s)]}case"Gather":{let a=R("x",e,t,n),s=R("indices",e,t,n);return[r.gather(a,r.cast(s,"int32"),0)]}case"GatherV2":{let a=R("axis",e,t,n),s=R("batchDims",e,t,n),i=R("x",e,t,n),l=R("indices",e,t,n);return[r.gather(i,r.cast(l,"int32"),a,s)]}case"Reverse":{let a=R("dims",e,t,n),s=[];for(let l=0;l<a.length;l++)a[l]&&s.push(l);let i=R("x",e,t,n);return[r.reverse(i,s)]}case"ReverseV2":{let a=R("axis",e,t,n),s=R("x",e,t,n);return[r.reverse(s,a)]}case"Slice":{let a=R("begin",e,t,n),s=R("size",e,t,n);return[r.slice(R("x",e,t,n),a,s)]}case"StridedSlice":{let a=R("begin",e,t,n),s=R("end",e,t,n),i=R("strides",e,t,n),l=R("beginMask",e,t,n),u=R("endMask",e,t,n),d=R("ellipsisMask",e,t,n),c=R("newAxisMask",e,t,n),h=R("shrinkAxisMask",e,t,n),p=R("x",e,t,n);return[r.stridedSlice(p,a,s,i,l,u,d,c,h)]}case"Pack":return ce(()=>{let a=R("axis",e,t,n),s=R("tensors",e,t,n),i=s[0].shape,l=r.squeeze(s[0]).shape,u=s.map(d=>{let c=A.arraysEqual(d.shape,i);if(!c&&!A.arraysEqual(r.squeeze(d).shape,l))throw new Error("the input tensors shape does not match");return c?d:r.reshape(d,i)});return[r.stack(u,a)]});case"Unpack":{let a=R("axis",e,t,n),s=R("tensor",e,t,n);return r.unstack(s,a)}case"Tile":{let a=R("reps",e,t,n);return[r.tile(R("x",e,t,n),a)]}case"Split":case"SplitV":{let a=R("axis",e,t,n),s=R("numOrSizeSplits",e,t,n),i=R("x",e,t,n);return r.split(i,s,a)}case"ScatterNd":{let a=R("indices",e,t,n),s=R("values",e,t,n),i=R("shape",e,t,n);return[r.scatterND(a,s,i)]}case"GatherNd":{let a=R("x",e,t,n),s=R("indices",e,t,n);return[r.gatherND(a,s)]}case"SparseToDense":{let a=R("sparseIndices",e,t,n),s=R("outputShape",e,t,n),i=R("sparseValues",e,t,n),l=R("defaultValue",e,t,n);return[r.sparseToDense(a,i,s,i.dtype===l.dtype?l:r.cast(l,i.dtype))]}case"TensorScatterUpdate":{let a=R("indices",e,t,n),s=R("values",e,t,n),i=R("tensor",e,t,n);return[r.tensorScatterUpdate(i,a,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},V_e=(e,t,n,r=wa)=>{switch(e.op){case"SparseFillEmptyRows":{let{outputIndices:a,outputValues:s,emptyRowIndicator:i,reverseIndexMap:l}=r.sparse.sparseFillEmptyRows(R("indices",e,t,n),R("values",e,t,n),R("denseShape",e,t,n),R("defaultValue",e,t,n));return[a,s,i,l]}case"SparseReshape":{let{outputIndices:a,outputShape:s}=r.sparse.sparseReshape(R("inputIndices",e,t,n),R("inputShape",e,t,n),R("newShape",e,t,n));return[a,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(R("data",e,t,n),R("indices",e,t,n),R("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(R("data",e,t,n),R("indices",e,t,n),R("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},U_e=(e,t,n,r=wa)=>{switch(e.op){case"FFT":return[r.fft(R("x",e,t,n))];case"IFFT":return[r.ifft(R("x",e,t,n))];case"RFFT":return[r.rfft(R("x",e,t,n))];case"IRFFT":return[r.irfft(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},H_e=(e,t,n,r=wa)=>{switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(R("input",e,t,n),R("pattern",e,t,n),R("rewrite",e,t,n),R("replaceGlobal",e,t,n))];case"StringNGrams":{let{nGrams:a,nGramsSplits:s}=r.string.stringNGrams(R("data",e,t,n),R("dataSplits",e,t,n),R("separator",e,t,n),R("nGramWidths",e,t,n),R("leftPad",e,t,n),R("rightPad",e,t,n),R("padWidth",e,t,n),R("preserveShortSequences",e,t,n));return[a,s]}case"StringSplit":{let{indices:a,values:s,shape:i}=r.string.stringSplit(R("input",e,t,n),R("delimiter",e,t,n),R("skipEmpty",e,t,n));return[a,s,i]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(R("input",e,t,n),R("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},G_e=(e,t,n,r=wa)=>{switch(e.op){case"Cast":return[r.cast(R("x",e,t,n),R("dtype",e,t,n))];case"ExpandDims":{let a=R("axis",e,t,n);return[r.expandDims(R("x",e,t,n),a)]}case"Squeeze":{let a=R("axis",e,t,n);return[r.squeeze(R("x",e,t,n),a)]}case"Reshape":return[r.reshape(R("x",e,t,n),R("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(R("x",e,t,n),R("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(R("x",e,t,n),R("padding",e,t,n),R("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(R("x",e,t,n),R("padding",e,t,n),R("constantValue",e,t,n))];case"SpaceToBatchND":{let a=R("blockShape",e,t,n),s=R("paddings",e,t,n);return[r.spaceToBatchND(R("x",e,t,n),a,s)]}case"BatchToSpaceND":{let a=R("blockShape",e,t,n),s=R("crops",e,t,n);return[r.batchToSpaceND(R("x",e,t,n),a,s)]}case"DepthToSpace":{let a=R("blockSize",e,t,n),s=R("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(R("x",e,t,n),a,s)]}case"BroadcastTo":return[r.broadcastTo(R("x",e,t,n),R("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(R("s0",e,t,n),R("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function RF(e,t,n,r,a=ce){let s=((i,l,u)=>{switch(i.category){case"arithmetic":return a(()=>w_e(i,l,u));case"basic_math":return a(()=>N_e(i,l,u));case"control":return T_e(i,l,u);case"convolution":return a(()=>E_e(i,l,u));case"creation":return a(()=>j_e(i,l,u));case"dynamic":return A_e(i,l,u);case"evaluation":return a(()=>R_e(i,l,u));case"image":return a(()=>F_e(i,l,u));case"graph":return a(()=>D_e(i,l,u));case"logical":return a(()=>P_e(i,l,u));case"matrices":return a(()=>O_e(i,l,u));case"normalization":return a(()=>L_e(i,l,u));case"ragged":return a(()=>z_e(i,l,u));case"reduction":return a(()=>B_e(i,l,u));case"slice_join":return a(()=>W_e(i,l,u));case"sparse":return a(()=>V_e(i,l,u));case"spectral":return a(()=>U_e(i,l,u));case"string":return a(()=>H_e(i,l,u));case"transformation":return a(()=>G_e(i,l,u));case"hash_table":return $_e(i,l,u,r);case"custom":let d=QU(i.op);if(d&&d.customExecutor)return d.customExecutor(new v_e(i,l,u));throw TypeError(`Custom op ${i.op} is not registered.`);default:throw TypeError(`Unknown op '${i.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return A.isPromise(s)?s.then(i=>[].concat(i)):[].concat(s)}var DF=class{constructor(e={},t={},n={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let e=[];for(let t=0;t<this.contexts.length-1;t++){let n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(let t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(let t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}};function MF(e,t,n,r){let a=new Set,s=[],i=null,l=null,u=new Set,d=new Set(Object.keys(e).map(p=>Is(p)[0]));r=r||[];let c=new Set(r.map(p=>Is(p.name)[0])),h=[...t];for(;h.length>0;){let p=h.pop();if((Pc(p)||eIe(p)||tIe(p))&&i==null&&(i=p,l=i.children.map(m=>m.name).filter(m=>a.has(m))),a.add(p.name),n[p.name]==null&&!d.has(p.name)&&!c.has(p.name)){if(p.inputs.length===0){s.push(p.name);continue}p.inputs.forEach(m=>{u.has(m.name)||(u.add(m.name),h.push(m))})}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:s,dynamicNode:i,syncInputs:l}}function q_e(e,t){let{usedNodes:n,inputs:r}=t,a=Object.keys(r).map(x=>Is(x)[0]).map(x=>e.nodes[x]),s=e.initNodes||[],i=x=>n.has(typeof x=="string"?x:x.name);function l(x){return[...new Map(x.map(y=>[y.name,y])).values()]}let u=l([...a,...e.weights,...s]).filter(i),d=l([...u,...Object.values(e.nodes)]).filter(i),c=new Map(d.map(x=>[x.name,x])),h={};for(let x of d){h[x.name]=h[x.name]||0;for(let y of x.children)i(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}let p=Object.entries(h).filter(([,x])=>x===0).map(([x])=>x),m=[...p];for(;p.length>0;){let x=p.pop(),y=c.get(x);for(let b of y.children.filter(i))--h[b.name]===0&&(m.push(b.name),p.push(b.name))}let f=m.map(x=>c.get(x)),g=K_e(f,u);return Y_e(g,u),g}function K_e(e,t){let n=new Map(e.map(s=>[s.name,s])),r=t.map(s=>s.name),a=new Set(r);for(;r.length>0;){let s=r.pop(),i=n.get(s);for(let l of i.children)!n.has(l.name)||a.has(l.name)||(a.add(l.name),r.push(l.name))}return e.filter(s=>a.has(s.name))}var Iv=class extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}};function Y_e(e,t){let n=new Map(e.map((l,u)=>[l.name,u])),r=new Set(t.map(l=>l.name)),a=l=>r.has(typeof l=="string"?l:l.name),s=new Set(e.map(l=>l.name)),i=l=>s.has(typeof l=="string"?l:l.name);for(let l of e){for(let u of l.children.filter(i)){if(!n.has(u.name))throw new Iv(`Child ${u.name} of node ${l.name} is unreachable.`);if(n.get(l.name)>n.get(u.name))throw new Iv(`Node ${l.name} is scheduled to run after its child ${u.name}.`)}if(!a(l))for(let u of l.inputs){if(!n.has(u.name))throw new Iv(`Input ${u.name} of node ${l.name} is unreachable.`);if(n.get(u.name)>n.get(l.name))throw new Iv(`Node ${l.name} is scheduled to run before its input ${u.name}.`)}}}function X_e(e){let t=new Map(e.map((l,u)=>[l.name,u])),n=Number.MAX_SAFE_INTEGER,r=e.map((l,u)=>Pc(l)?n:u),a=l=>{let u=r[t.get(l.name)];return u??-1},s=e.map((l,u)=>l.children.map(a).reduce((d,c)=>Math.max(d,c),r[u])),i=new Map;for(let l=0;l<e.length;++l){let u=s[l];if(u===n)continue;let d=e[l],c=e[u];i.has(c.name)||i.set(c.name,[]),i.get(c.name).push(d)}return i}var Z_e=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),Q_e=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),J_e=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Pc(e){return Z_e.has(e.op)}function eIe(e){return Q_e.has(e.op)}function tIe(e){return J_e.has(e.op)}var $F=class v8{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let n=Object.keys(t).map(r=>t[r].map(a=>a.id));this._weightIds=[].concat(...n),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let n=t.signatureKey||t.name;return t.defaultOutput?`${n}:${t.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((t,n)=>(t[n]=this._functions[n].signature,t),{})}constructor(t,n){this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(r=>{this._functionExecutorMap[r]=new v8(t.functions[r],this)})}getCompilationKey(t,n){let r=t.map(s=>s.name).sort(),a=n.map(s=>s.name).sort();return r.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)}compile(t,n){let r=MF(t,n,this.weightMap,this._initNodes),{missingInputs:a,dynamicNode:s,syncInputs:i}=r;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${i}]`);if(a.length>0){let d=n.map(h=>h.name),c=Object.keys(t);throw new Error(`Cannot compute the outputs [${d}] from the provided inputs [${c}]. Missing the following inputs: [${a}]`)}let l=q_e(this.graph,r),u=X_e(l);return{orderedNodes:l,nodeLiveUntilMap:u}}cloneAndKeepTensor(t){if(t==null)return null;let n=t.clone();return Zr(n),n}cloneTensorList(t){return t?t.map(n=>this.cloneAndKeepTensor(n)):null}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,this.cloneTensorList(r)]))}execute(t,n){this.disposeIntermediateTensors(),t=this.mapInputs(t);let r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n);let a=r.map(p=>this.graph.nodes[Is(p)[0]]),s=n.map(p=>Is(p)[0]),i=new Set(s),l=s.map(p=>this.graph.nodes[p]);l.length===0&&(l=this._outputs);let u=this.getCompilationKey(a,l),d=this.compiledMap.get(u);d==null&&(d=this.compile(t,l),this.compiledMap.set(u,d));try{this.keepIntermediateTensors=be().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}let c={},h={};return ce(()=>{let p=new DF(this.weightMap,c,h,this.functionExecutorMap,this.parseNodeNameCache),m=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach(y=>{let[b,v]=Is(y,p),w=[];w[v]=t[y],m[b]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[b]=this.cloneTensorList(w))});let f=this.getFrozenTensorIds(m),{orderedNodes:g,nodeLiveUntilMap:x}=d;for(let y of g){if(m[y.name])continue;let b=RF(y,m,p,this._resourceManager);if(A.isPromise(b))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);m[y.name]=b,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(b)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,m,p,f,i,x.get(y.name))}return this.parent==null&&p.dispose(f),n.map(y=>Ta(y,m,p))})}getFrozenTensorIds(t){let n=[].concat.apply([],Object.keys(t).map(r=>t[r]).map(r=>r.map(a=>a.id)));return new Set(n)}checkTensorForDisposal(t,n,r,a,s,i,l){if(!(Pc(n)||i.has(t))){for(let u of r[t])u!=null&&(l[u.id]=(l[u.id]||0)+n.children.length);for(let u of n.inputs){if(Pc(u))continue;let d=IF(u.name,r,a);if(d!=null)for(let c of d){if(!c||c.kept||s.has(c.id))continue;let h=l[c.id];h===1?(c.dispose(),delete l[c.id]):h!=null&&l[c.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,n,r,a,s,i){function l(u){return Pc(u)||s.has(u.name)}if(!(Pc(t)||i==null))for(let u of i){if(l(u))continue;let d=IF(u.name,n,r);for(let c of d)!c||c.kept||a.has(c.id)||c.dispose()}}async executeAsync(t,n){return this._executeAsync(t,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(t=>{for(let n of t)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(t,n,r=!1,a={},s={}){this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=be().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}let i=new DF(this.weightMap,a,s,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let l=await this.executeWithControlFlow(t,i,n,r),u=n.map(p=>Ta(p,l,i)),d=u.map(p=>p.id),c=Object.keys(t).map(p=>t[p].id),h=new Set([...d,...c,...this.weightIds]);return Object.values(l).forEach(p=>{p.forEach(m=>{m&&!m.isDisposed&&!h.has(m.id)&&m.dispose()})}),this.parent==null&&i.dispose(h),u}async executeFunctionAsync(t,n,r){let a=t.reduce((s,i,l)=>(s[this.inputs[l].name]=i,s),{});return this._executeAsync(a,this.outputNodes,!0,n,r)}async executeWithControlFlow(t,n,r,a){let s=Object.keys(t),i=s.map(w=>this.graph.nodes[Is(w)[0]]),l=r.map(w=>Is(w)[0]),u=new Set(l),d=l.map(w=>this.graph.nodes[w]);d.length===0&&(d=this._outputs);let{usedNodes:c,missingInputs:h,dynamicNode:p,syncInputs:m}=MF(t,d,this.weightMap,this._initNodes),f=[...i,...this.graph.weights,...this._initNodes||[]].map(w=>({node:w,contexts:n.currentContext})),g=Object.assign({},this.weightMap);Object.keys(t).forEach(w=>{let[N,S]=Is(w),C=[];C[S]=t[w],g[N]=C});let x={},y=this.getFrozenTensorIds(g),b={};for(;f.length>0;){let w=this.processStack(i,f,n,g,b,y,u,x,c);await Promise.all(w)}p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let v=d.filter(w=>!Pc(w)&&!Ta(w.name,g,n)).map(w=>w.name);if(v.length>0){let w="";throw p!=null&&(w=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${m}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${s}]. Consider providing the following inputs: [${h}]. ${w}`)}return g}processStack(t,n,r,a,s,i,l,u,d){let c=[];for(;n.length>0;){let h=n.pop();r.currentContext=h.contexts;let p="";if(h.node.op==="Enter"&&R("isConstant",h.node,a,r)&&([p]=dl(h.node.name,r)),a[h.node.name]==null){let m=RF(h.node,a,r,this._resourceManager);p||([p]=dl(h.node.name,r));let f=r.currentContext;A.isPromise(m)?c.push(m.then(g=>(a[p]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(g)),r.currentContext=f,this.checkTensorForDisposal(p,h.node,a,r,i,l,u),this.processChildNodes(h.node,n,r,a,s,d),g))):(a[p]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(m)),this.checkTensorForDisposal(p,h.node,a,r,i,l,u),this.processChildNodes(h.node,n,r,a,s,d))}else this.processChildNodes(h.node,n,r,a,s,d)}return c}processChildNodes(t,n,r,a,s,i){t.children.forEach(l=>{let[u]=dl(l.name,r);s[u]||!i.has(l.name)||(l.op==="Merge"?l.inputNames.some(d=>!!Ta(d,a,r))&&(s[u]=!0,n.push({contexts:r.currentContext,node:l})):l.inputNames.every(d=>!!Ta(d,a,r))&&(s[u]=!0,n.push({contexts:r.currentContext,node:l})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(n=>n.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(n=>{let r=t[n],[a]=Is(n),s=this.graph.nodes[a];if(s.attrParams.shape&&s.attrParams.shape.value){let i=s.attrParams.shape.value,l=i.length===r.shape.length&&r.shape.every((u,d)=>i[d]===-1||i[d]===u);A.assert(l,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${i}], but was [${r.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&A.assert(r.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(t){var n,r;let a={};for(let s in t){let i=(r=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||r===void 0?void 0:r[s];i!=null?a[i.name]=t[s]:a[s]=t[s]}return a}checkInputs(t){let n=Object.keys(t).filter(r=>{let[a]=Is(r);return this.graph.nodes[a]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(t){return t.map(n=>{var r,a;let s=(a=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||a===void 0?void 0:a[n];return s!=null?s.name:n},{})}checkOutputs(t){t.forEach(n=>{let[r]=Is(n);if(!this.graph.nodes[r])throw new Error(`The output '${n}' is not found in the graph`)})}},nIe=class{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(let e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(let e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}},rIe="?tfjs-format=file",aIe="model.json",Kj=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=Aa){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new nIe}findIOHandler(){let e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{let t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let e=this.handler.load();return A.isPromise(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){let t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let t=await kW(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;let n=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}if(this.signature=r,this.version=`${n.versions.producer}.${n.versions.minConsumer}`,this.executor=new $F(TF.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){let a=TF.Instance.transformGraph(e.modelInitializer);this.initializer=new $F(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){let n=this.io.getSaveHandlers(e);if(n.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(n.length>1)throw new Error(`Found more than one (${n.length}) save handlers for URL '${e}'`);e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){let t=e instanceof Zt?[e]:e,n={};return t.forEach((r,a)=>n[this.structuredOutputKeys[a]]=r),n}return e}predict(e,t){let n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){let n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof Zt)&&!Array.isArray(e)){let a=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(a!=null)for(let s in a){let i=a[s];i.resourceId!=null&&(e[s]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];let n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((a,s)=>{var i,l,u;let d=(u=(l=(i=this.signature)===null||i===void 0?void 0:i.inputs)===null||l===void 0?void 0:l[s])===null||u===void 0?void 0:u.resourceId;return d!=null?a[s]=this.resourceIdToCapturedInput[d]:a[s]=e[r++],a},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){let t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){let a=n[r],s=t[a];this.resourceIdToCapturedInput[s.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&qt(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};async function sIe(e,t={},n=Aa){if(e==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof e=="string"&&(e=oIe(e));let r=new Kj(e,t,n);return await r.load(),r}function iIe(e){if(e==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let t;if(e instanceof Array){let[r,a]=e;if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");let s=Aa.getWeightSpecs(r.weightsManifest),i=Aa.getModelArtifactsForJSONSync(r,s,a);t=Aa.fromMemorySync(i)}else if("load"in e)t=e;else if("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e)t=Aa.fromMemorySync(e);else throw new Error("Unknown model format");let n=new Kj(t);return n.load(),n}function oIe(e){return e.endsWith("/")||(e=e+"/"),`${e}${aIe}${rIe}`}var lIe="4.22.0",w8={};Kt(w8,{CSVDataset:()=>R8,Dataset:()=>Ig,FileDataSource:()=>L8,TextLineDataset:()=>A8,URLDataSource:()=>z8,array:()=>AIe,csv:()=>UIe,func:()=>HIe,generator:()=>GIe,microphone:()=>KIe,version_data:()=>YIe,webcam:()=>qIe,zip:()=>RIe});var uIe=rc(r1()),cIe=rc(r1());function dIe(e,t){return x0(e,t)}function x0(e,t,n=new Map,r=new Set){if(e==null)return null;if(typeof Blob=="function"&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Zm(e)){let s=Array.isArray(e)?[]:{};r.add(e);for(let i in e){let l=e[i],u=x0(l,t,n,r);s[i]=u}return r.delete(e),e.__proto__&&(s.__proto__=e.__proto__),s}else throw new Error(`Can't recurse into non-iterable type: ${e}`);else return n.set(e,a.value),a.value}function hIe(e,t=k8){return N8(e,t)}function N8(e,t,n=new Set){let r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Zm(r)){let s=Array.isArray(r)?[]:{};n.add(r);for(let i in r){let l=e.map(d=>d[i]),u=N8(l,t,n);s[i]=u}return n.delete(r),s}else throw new Error(`Can't recurse into non-iterable type: ${r}`);else return a.value}function k8(e){return e===null?null:Zm(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function S8(e,t){let n=new Map;x0(e,t,n);for(let r of Array.from(n.keys())){let a=n.get(r);if(A.isPromise(a)){let s=await a;n.set(r,s)}}return x0(e,t,n)}function Zm(e){let t=!1;if(be().get("IS_BROWSER"))t=e instanceof TextDecoder;else{let{StringDecoder:n}=VB();t=e instanceof n}return e!=null&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||typeof e=="object"&&!(e instanceof Zt)&&!(e instanceof Promise)&&!t)}function pIe(e){return e==null||mIe(e)||Array.isArray(e)||typeof e=="object"&&e instanceof Zt||A.isTypedArray(e)}function mIe(e){return e===null||typeof e!="object"&&typeof e!="function"}function fIe(e){return dIe(e,gIe)}function gIe(e){return e instanceof Zt?{value:e.clone(),recurse:!1}:Zm(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var C8=class{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}},_8=class I8 extends C8{constructor(){super(I8.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){let t=this.capacity*2,n=new Array(t),r=this.length();for(let a=0;a<r;a++)n[a]=this.get(this.wrap(this.begin+a));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=r}};_8.INITIAL_CAPACITY=32;function T8(e){return new bIe(e)}function Yj(e){return new vIe(e)}function xIe(e,t){return new E8(e,t)}function yIe(e,t=ku.FAIL){return new EIe(e,t)}var va=class{async toArray(){let e=[],t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),t=[],n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new IIe(this,e)}filter(e){return new CIe(this,e)}map(e){return new _Ie(this,e)}mapAsync(e){return new FF(this,e)}serialMapAsync(e){return new FF(this,e).serial()}flatmap(e){return new TIe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new SIe(this,e,t)}columnMajorBatch(e,t=!0,n=k8){return this.rowMajorBatch(e,t).map(r=>hIe(r,n))}concatenate(e,t){return new E8(T8([this,e]),t)}take(e){return e<0||e==null?this:new kIe(this,e)}skip(e){return e<0||e==null?this:new NIe(this,e)}prefetch(e){return new j8(this,e)}shuffle(e,t){return new jIe(this,e,t)}serial(){return new wIe(this)}},bIe=class extends va{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:fIe(e),done:!1}}},vIe=class extends va{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}},wIe=class extends va{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}},NIe=class extends va{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;qt(e.value)}return this.upstream.next()}},kIe=class extends va{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}},SIe=class extends va{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}},CIe=class extends va{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;qt(e.value)}}},_Ie=class extends va{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=Qi.getTensorsInContainer(e.value),n=this.transform(e.value),r=Qi.getTensorsInContainer(n);for(let a of t)Qi.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},IIe=class extends va{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}},FF=class extends va{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=Qi.getTensorsInContainer(e.value),n=await this.transform(e.value),r=Qi.getTensorsInContainer(n);for(let a of t)Qi.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},Xj=class extends va{constructor(){super(),this.outputQueue=new _8,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}},TIe=class extends Xj{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let t=Qi.getTensorsInContainer(e.value),n=this.transform(e.value),r=Qi.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(let a of t)Qi.isTensorInList(a,r)||a.dispose();return!0}},E8=class extends va{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){let n=await this.moreIterators.next();if(n.done)return{value:null,done:!0};this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}},ku;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(ku||(ku={}));var EIe=class extends va{constructor(e,t=ku.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;function r(s){return s instanceof va?{value:s.next().then(i=>(t++,i.done&&n++,i.value)),recurse:!1}:{value:null,recurse:!0}}let a=await S8(this.iterators,r);if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case ku.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case ku.SHORTEST:return{value:null,done:!0};case ku.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}},j8=class extends va{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new C8(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}},jIe=class extends j8{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=cIe.alea(n||A.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}},Ig=class{constructor(){this.size=null}batch(e,t=!0){let n=this;A.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:t?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),Cs(async()=>(await n.iterator()).columnMajorBatch(e,t,DIe),r)}concatenate(e){let t=this,n;return this.size===1/0||e.size===1/0?n=1/0:this.size!=null&&e.size!=null?n=this.size+e.size:n=null,Cs(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){let t=this,n;return this.size===1/0?n=1/0:n=null,Cs(async()=>(await t.iterator()).filter(r=>ce(()=>e(r))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let t=this;return Cs(async()=>(await t.iterator()).map(n=>ce(()=>e(n))),this.size)}mapAsync(e){let t=this;return Cs(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let t=this;return Cs(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){let t=this,n;return this.size!=null&&e>0?n=this.size*e:e===0?n=0:this.size!=null&&(e===void 0||e<0)?n=1/0:n=null,Cs(async()=>{let r=Yj(async()=>({value:await t.iterator(),done:!1}));return xIe(r.take(e))},n)}skip(e){let t=this,n;return this.size!=null&&e>=0&&this.size>=e?n=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?n=0:n=null,Cs(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t,n=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let r=this,a=uIe.alea(t||A.now().toString());return Cs(async()=>{let s=a.int32();return n&&(s+=a.int32()),(await r.iterator()).shuffle(e,s.toString())},this.size)}take(e){let t=this,n;return this.size!=null&&this.size>e?n=e:this.size!=null&&this.size<=e?n=this.size:n=null,Cs(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}};Ig.MAX_BUFFER_SIZE=1e4;function Cs(e,t=null){return new class extends Ig{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function AIe(e){return Cs(async()=>T8(e),e.length)}function RIe(e){if(!Zm(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=t==null?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(let n in e)t=t==null?e[n].size:Math.min(t,e[n].size);return Cs(async()=>{let n=await S8(e,r=>{if(r instanceof Ig)return{value:r.iterator(),recurse:!1};if(Zm(r))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return yIe(n,ku.SHORTEST)},t)}function DIe(e){if(e===null)return null;let t=e[0];return pIe(t)?{value:MIe(e),recurse:!1}:{value:null,recurse:!0}}function MIe(e){if(e.length===0)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof Zt?Vr(e):Ka(e)}var A8=class extends Ig{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e))}},Tv='"',lx=Symbol("out"),PF=Symbol("field"),Ev=Symbol("quote"),mS=Symbol("quoteafterquote"),OF=Symbol("quoteinquote"),R8=class extends Ig{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){let e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&A.assert(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);let t=this.fullColumnNames.reduce((r,a)=>(r[a]=r[a]+1||1,r),{}),n=Object.keys(t).filter(r=>t[r]>1);if(A.assert(n.length===0,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs){for(let r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){let e=await(await this.base.iterator()).next();if(e.done)throw new Error("No data was found for CSV parsing.");let t=e.value;return this.parseRow(t,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new A8(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(A.assert(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){let t=this.parseRow(e),n={},r={};for(let a=0;a<this.fullColumnNames.length;a++){let s=this.fullColumnNames[a],i=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!i)){let l=t[a],u=null;if(l==="")if(i&&i.default!==void 0)u=i.default;else{if(i&&(i.required||i.isLabel))throw new Error(`Required column ${s} is empty in this line: ${e}`);u=void 0}else{let d=Number(l);if(isNaN(d))i&&i.dtype==="bool"?u=this.getBoolean(l):u=l;else if(!i||!i.dtype)u=d;else switch(i.dtype){case"float32":u=d;break;case"int32":u=Math.floor(d);break;case"bool":u=this.getBoolean(l);break;default:u=d}}i&&i.isLabel?r[s]=u:n[s]=u}}return Object.keys(r).length===0?n:{xs:n,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){let n=[],r=0,a=e.length,s=lx;for(let i=0;i<a;i++)switch(s){case lx:switch(e.charAt(i)){case Tv:r=i+1,s=Ev;break;case this.delimiter:if(r=i+1,this.delimiter===" "&&this.delimWhitespace)break;n.push(""),s=lx;break;default:s=PF,r=i;break}break;case PF:switch(e.charAt(i)){case this.delimiter:n.push(e.substring(r,i)),s=lx,r=i+1;break}break;case Ev:switch(e.charAt(i)){case Tv:s=mS;break}break;case mS:switch(e.charAt(i)){case this.delimiter:n.push(e.substring(r,i-1)),s=lx,r=i+1;break;case Tv:s=Ev;break;default:s=OF;break}break;case OF:switch(e.charAt(i)){case Tv:s=Ev;break}break}if(s===mS?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}},$Ie=class D8 extends va{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;let n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=t.includeSpectrogram!==!1,this.includeWaveform=t.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(!be().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");let n=new D8(t);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(r){throw new Error(`Error thrown while initializing video stream: ${r.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");let t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);let n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,n,r=await this.getAudioData();if(this.includeSpectrogram){let a=this.flattenQueue(r.freqDataQueue);t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){let a=this.flattenQueue(r.timeDataQueue);n=this.getTensorFromAudioDataArray(a,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){let t=[],n=[],r=0;return new Promise(a=>{let s=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&a({freqDataQueue:t,timeDataQueue:n}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++r===this.numFrames&&(clearInterval(s),a({freqDataQueue:t,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){let n=t[0].length,r=new Float32Array(t.length*n);return t.forEach((a,s)=>r.set(a,s*n)),r}getTensorFromAudioDataArray(t,n){let r=new Float32Array(A.sizeFromShape(n));return r.set(t,r.length-t.length),Ka(r,n)}},FIe=class M8 extends va{constructor(t,n){if(super(),this.webcamVideoElement=t,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=Vn([0],"int32"),this.webcamConfig.centerCrop){let r=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,a=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,s=(1-r)/2,i=(1-a)/2,l=s+r,u=a+i;this.cropBox=Lo([i,s,u,l],[1,4])}else this.cropBox=Lo([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,n={}){if(!be().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}let r=new M8(t,n);return await r.start(),r}async start(){this.webcamConfig.facingMode&&A.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=Mb.fromPixels(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{t.dispose()}else return{value:t,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(t){return ce(()=>{let n=ga(Xe(t,"float32"),0),r;r=Ks.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");let a=r.shape;return ue(r,a.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}},$8=class{},F8=class extends va{split(e){return new PIe(this,e)}},PIe=class extends F8{constructor(e,t){super(),this.upstream=e,this.impl=new OIe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},OIe=class extends Xj{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){let e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);let t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(let n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}},LIe=class extends va{decodeUTF8(){return new zIe(this)}},zIe=class extends F8{constructor(e){super(),this.upstream=e,this.impl=new BIe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},BIe=class extends Xj{constructor(e){if(super(),this.upstream=e,be().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:t}=VB();this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){let e=await this.upstream.next(),t;if(e.done)return!1;t=e.value;let n;return be().get("IS_BROWSER")?n=this.decoder.decode(t,{stream:!0}):n=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0}},P8=class extends LIe{constructor(e,t={}){super(),this.file=e,this.options=t,A.assert(e instanceof Uint8Array||(be().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((e,t)=>{let n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{let r=new FileReader;r.onload=s=>{let i=r.result;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),!(i instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(i)},r.onabort=s=>t(new Error("Aborted")),r.onerror=s=>t(new Error(s.type));let a=this.file.slice(this.offset,n);r.readAsArrayBuffer(a)}this.offset=n}),done:!1}}};async function WIe(e,t={},n){let r,a;typeof e=="string"?r=e:(r=e.url,a=VIe(e));let s=await(0,A.fetch)(r,a);if(s.ok){let i=new Uint8Array(await s.arrayBuffer());return new P8(i,t)}else throw new Error(s.statusText)}var VIe=e=>({method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity});function O8(e){return typeof e=="string"&&e.slice(0,7)==="file://"}var L8=class extends $8{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(O8(this.input)&&be().get("IS_NODE")){let e=BI();this.input=e.readFileSync(this.input.slice(7))}return new P8(this.input,this.options)}},z8=class extends $8{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return O8(this.url)?new L8(this.url,this.fileOptions).iterator():WIe(this.url,this.fileOptions)}};function UIe(e,t={}){return new R8(new z8(e),t)}function HIe(e){let t=Yj(e);return Cs(async()=>t)}function GIe(e){return Cs(async()=>{let t=await e();return Yj(()=>t.next())})}async function qIe(e,t){return FIe.create(e,t)}async function KIe(e){return $Ie.create(e)}var YIe="4.22.0";function St(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&A.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}var XIe=Qo.whereImpl,Zj=class B8 extends Gy{nextDataId(){return B8.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new a1(this,hi())}write(t,n,r){this.firstUse&&(this.firstUse=!1,be().get("IS_NODE")&&z.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let a={id:this.nextDataId()};return this.data.set(a,{values:t,dtype:r,refCount:1}),a}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&A.isString(r[0])){let s=r.map(i=>A.encodeString(i));a=this.write(s,t,n)}else a=this.write(r,t,n);return{dataId:a,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){let n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){let n=this.data.get(t);n.refCount--}}move(t,n,r,a,s){this.data.set(t,{values:n,dtype:a,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){let{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){let a=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return z.mergeRealAndImagArrays(a,s)}return A.convertBackendValuesAndArrayBuffer(this.data.get(t).values,n)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>A.decodeString(a));return nn(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return nn(t.shape,t.dtype,n)}makeOutput(t,n,r){return hi().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;let{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){let n=A.now();return t(),{kernelMs:A.now()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){St([t],"where");let n=this.readSync(t.dataId);return XIe(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};Zj.nextDataId=0;var Qj={};Kt(Qj,{addImpl:()=>U8,bincountImpl:()=>eA,bincountReduceImpl:()=>H8,bitwiseAndImpl:()=>G8,castImpl:()=>V8,ceilImpl:()=>q8,concatImpl:()=>tA,equalImpl:()=>K8,expImpl:()=>X8,expm1Impl:()=>Q8,floorDivImpl:()=>eH,floorImpl:()=>J8,gatherNdImpl:()=>tH,gatherV2Impl:()=>nH,greaterEqualImpl:()=>aH,greaterImpl:()=>rH,lessEqualImpl:()=>iH,lessImpl:()=>sH,linSpaceImpl:()=>oH,logImpl:()=>lH,maxImpl:()=>uH,maximumImpl:()=>cH,minimumImpl:()=>dH,multiplyImpl:()=>nA,negImpl:()=>hH,notEqualImpl:()=>pH,prodImpl:()=>mH,raggedGatherImpl:()=>fH,raggedRangeImpl:()=>gH,raggedTensorToTensorImpl:()=>xH,rangeImpl:()=>aA,rsqrtImpl:()=>yH,scatterImpl:()=>Hc,sigmoidImpl:()=>YTe,simpleAbsImpl:()=>W8,sliceImpl:()=>b0,sparseFillEmptyRowsImpl:()=>vH,sparseReshapeImpl:()=>wH,sparseSegmentReductionImpl:()=>sA,sqrtImpl:()=>QTe,squaredDifferenceImpl:()=>NH,staticRegexReplaceImpl:()=>kH,stridedSliceImpl:()=>SH,stringNGramsImpl:()=>iA,stringSplitImpl:()=>oA,stringToHashBucketFastImpl:()=>lA,subImpl:()=>CH,tileImpl:()=>_H,topKImpl:()=>TH,transposeImpl:()=>rA,uniqueImpl:()=>cA});function W8(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var ZIe=e=>{let{x:t}=e.inputs,n=e.backend;St(t,"abs");let r=new Float32Array(A.sizeFromShape(t.shape)),a=n.data.get(t.dataId).values;return r=W8(a),n.makeOutput(r,t.shape,t.dtype)},QIe={kernelName:ff,backendName:"cpu",kernelFunc:ZIe};function Or(e){return(t,n,r,a,s)=>{let i=z.assertAndGetBroadcastShape(t,n),l=i.length,u=A.computeStrides(i),d=A.sizeFromShape(i),c=A.getTypedArrayFromDType(s,d),h=t.length,p=n.length,m=A.computeStrides(t),f=A.computeStrides(n),g=z.getBroadcastDims(t,i),x=z.getBroadcastDims(n,i);if(g.length+x.length===0)for(let y=0;y<c.length;++y)c[y]=e(r[y%r.length],a[y%a.length]);else for(let y=0;y<c.length;++y){let b=A.indexToLoc(y,l,u),v=b.slice(-h);g.forEach(C=>v[C]=0);let w=A.locToIndex(v,h,m),N=b.slice(-p);x.forEach(C=>N[C]=0);let S=A.locToIndex(N,p,f);c[y]=e(r[w],a[S])}return[c,i]}}function Es(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,l=n.makeTensorInfo(r.shape,"complex64"),u=n.data.get(l.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(a.shape,"float32",i)},l}var JIe={kernelName:o1,backendName:"cpu",kernelFunc:Es};function y0(e,t,n="float32"){if(n==="complex64"){let a=y0(e,t,"float32"),s=y0(e,t,"float32");return Es({inputs:{real:a,imag:s},backend:e})}let r=A.makeZerosTypedArray(A.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function Go(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var eTe={kernelName:Nh,backendName:"cpu",kernelFunc:Go};function Ld(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var tTe={kernelName:b1,backendName:"cpu",kernelFunc:Ld};function V8(e,t,n,r){if(r==="int32"){let a=Int32Array.from(e);return[t,"int32",a]}if(r==="bool"){let a=A.toTypedArray([0],n),[s,i]=Or((l,u)=>l!==u?1:0)(t,[],e,a,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function Yu(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return Go({inputs:{x:a},backend:n});let c=y0(n,a.shape,a.dtype),h=Yu({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),p=Es({inputs:{real:h,imag:c},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),p}if(a.dtype==="complex64"){let c=Ld({inputs:{input:a},backend:n}),h=Yu({inputs:{x:c},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(c),h}if(!A.hasEncodingLoss(a.dtype,s)){let c=Go({inputs:{x:a},backend:n});return{dataId:c.dataId,shape:c.shape,dtype:s}}let i=n.data.get(a.dataId).values,[l,u,d]=V8(i,a.shape,a.dtype,s);return n.makeTensorInfo(l,u,d)}var nTe={kernelName:rh,backendName:"cpu",kernelFunc:Yu};function ra(e,t,n,r){return n==null?({inputs:a,backend:s})=>{let{a:i,b:l}=a,u=s;St([i,l],e);let d=u.data.get(i.dataId).values,c=u.data.get(l.dataId).values,h=i.dtype==="string"?z.fromUint8ToStringArray(d):d,p=i.dtype==="string"?z.fromUint8ToStringArray(c):c,m=r||i.dtype,[f,g]=t(i.shape,l.shape,h,p,m);return u.makeTensorInfo(g,m,f)}:({inputs:a,backend:s})=>{let{a:i,b:l}=a,u=s;if(i.dtype==="complex64"||l.dtype==="complex64"){let d=Yu({inputs:{x:i},backend:u,attrs:{dtype:"complex64"}}),c=u.data.get(d.dataId),h=c.complexTensorInfos.real,p=c.complexTensorInfos.imag,m=u.data.get(h.dataId).values,f=u.data.get(p.dataId).values,g=Yu({inputs:{x:l},backend:u,attrs:{dtype:"complex64"}}),x=u.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,v=u.data.get(y.dataId).values,w=u.data.get(b.dataId).values,[N,S,C]=n(i.shape,l.shape,m,f,v,w),_=u.makeTensorInfo(C,"float32",N),T=u.makeTensorInfo(C,"float32",S),E=Es({inputs:{real:_,imag:T},backend:u});return u.disposeIntermediateTensorInfo(d),u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(_),u.disposeIntermediateTensorInfo(T),E}else{let d=u.data.get(i.dataId).values,c=u.data.get(l.dataId).values,h=r||i.dtype,[p,m]=t(i.shape,l.shape,d,c,h);return u.makeTensorInfo(m,h,p)}}}function Jj(e){return(t,n,r,a,s,i)=>{let l=z.assertAndGetBroadcastShape(t,n),u=A.sizeFromShape(l),d=l.length,c=A.computeStrides(l),h=A.getTypedArrayFromDType("float32",u),p=A.getTypedArrayFromDType("float32",u),m=z.getBroadcastDims(t,l),f=z.getBroadcastDims(n,l),g=z.mergeRealAndImagArrays(r,a),x=z.mergeRealAndImagArrays(s,i),y=t.length,b=A.computeStrides(t),v=n.length,w=A.computeStrides(n);if(m.length+f.length===0)for(let N=0;N<h.length;N++){let S=N%g.length,C=N%x.length,_=e(g[S*2],g[S*2+1],x[C*2],x[C*2+1]);h[N]=_.real,p[N]=_.imag}else for(let N=0;N<h.length;N++){let S=A.indexToLoc(N,d,c),C=S.slice(-y);m.forEach(I=>C[I]=0);let _=A.locToIndex(C,y,b),T=S.slice(-v);f.forEach(I=>T[I]=0);let E=A.locToIndex(T,v,w),j=e(g[_*2],g[_*2+1],x[E*2],x[E*2+1]);h[N]=j.real,p[N]=j.imag}return[h,p,l]}}var U8=Or((e,t)=>e+t),rTe=Jj((e,t,n,r)=>({real:e+n,imag:t+r})),Qm=ra(ac,U8,rTe),aTe={kernelName:ac,backendName:"cpu",kernelFunc:Qm};function eA(e,t,n,r,a){let s=A.sizeFromShape(r),i=A.makeZerosTypedArray(a,n);for(let l=0;l<e.length;l++){let u=e[l];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(s>0?i[u]+=t[l]:i[u]+=1)}return i}function H8(e,t,n,r=!1){let a=e.shape[0],s=e.shape[1],i=nn([a,n],t.dtype);for(let l=0;l<a;l++)for(let u=0;u<s;u++){let d=e.get(l,u);if(d<0)throw new Error("Input x must be non-negative!");d>=n||(r?i.set(1,l,d):t.size>0?i.set(i.get(l,d)+t.get(l,u),l,d):i.set(i.get(l,d)+1,l,d))}return i}var G8=Or((e,t)=>e&t),sTe=ra(kf,G8),iTe={kernelName:kf,backendName:"cpu",kernelFunc:sTe};function Jo(e){return(t,n,r)=>{let a=A.getArrayFromDType(n,t.length);for(let s=0;s<t.length;++s)a[s]=e(t[s],r);return a}}function Zn(e,t,n){let r=Jo(t);return pc(e,r,n)}function pc(e,t,n){return({inputs:r,attrs:a,backend:s})=>{let{x:i}=r;St(i,e);let l=s,u=l.data.get(i.dataId).values,d;if(i.dtype==="string"){if(!Array.isArray(u))throw new Error("String tensor's value was not an instance of Array");d=z.fromUint8ToStringArray(u)}else d=u;let c=n||i.dtype,h=t(d,c,a);return l.makeTensorInfo(i.shape,c,h)}}var q8=Jo(e=>Math.ceil(e)),oTe=pc(ah,q8),lTe={kernelName:ah,backendName:"cpu",kernelFunc:oTe};function tA(e,t,n,r){let a=A.getArrayFromDType(n,A.sizeFromShape(t));if(r&&n!=="string"){let s=0;e.forEach(i=>{let l=A.sizeFromShape(i.shape);a.set(i.vals,s),s+=l})}else{let s=0;e.forEach(i=>{let l=n==="string"?z.fromUint8ToStringArray(i.vals):i.vals,u=0;for(let d=0;d<i.shape[0];++d){let c=d*t[1]+s;for(let h=0;h<i.shape[1];++h)a[c+h]=l[u++]}s+=i.shape[1]})}return a}var K8=Or((e,t)=>e===t?1:0),Y8=ra(Af,K8,null,"bool"),uTe={kernelName:Af,backendName:"cpu",kernelFunc:Y8},X8=Jo(e=>Math.exp(e)),Z8=pc(gh,X8,"float32"),cTe={kernelName:gh,backendName:"cpu",kernelFunc:Z8},Q8=Jo(e=>Math.expm1(e)),dTe=pc(xh,Q8),hTe={kernelName:xh,backendName:"cpu",kernelFunc:dTe},J8=Jo(e=>Math.floor(e)),pTe=pc(yh,J8),mTe={kernelName:yh,backendName:"cpu",kernelFunc:pTe},eH=Or((e,t)=>Math.floor(e/t)),fTe=ra(bh,eH,null,"int32"),gTe={kernelName:bh,backendName:"cpu",kernelFunc:fTe};function tH(e,t,n,r,a,s,i,l,u){let d=nn([r,s],n);for(let c=0;c<r;c++){let h=[],p=0;for(let m=0;m<a;m++){let f=e[c*a+m];p+=f*i[m],h.push(f)}if(p<0||p>=u/s)throw new Error(`Invalid indices: ${h} does not index into ${l}`);for(let m=0;m<s;m++)d.values[c*s+m]=t.get(...t.indexToLoc(p*s+m))}return d}function nH(e,t,n){let r=nn(n,e.dtype);for(let a=0;a<r.size;++a){let s=r.indexToLoc(a).slice(),i=s[0],l=s[2],u=t.locToIndex([i,l]);s[2]=t.values[u];let d=e.locToIndex(s);0<=d&&d<e.values.length&&(r.values[a]=e.values[d])}return r}var rH=Or((e,t)=>e>t?1:0),xTe=ra(Ff,rH,null,"bool"),yTe={kernelName:Ff,backendName:"cpu",kernelFunc:xTe},aH=Or((e,t)=>e>=t?1:0),bTe=ra(wh,aH,null,"bool"),vTe={kernelName:wh,backendName:"cpu",kernelFunc:bTe},sH=Or((e,t)=>e<t?1:0),wTe=ra(Pf,sH,null,"bool"),NTe={kernelName:Pf,backendName:"cpu",kernelFunc:wTe},iH=Or((e,t)=>e<=t?1:0),kTe=ra(Of,iH,null,"bool"),STe={kernelName:Of,backendName:"cpu",kernelFunc:kTe};function oH(e,t,n){let r=(t-e)/(n-1),a=A.makeZerosTypedArray(n,"float32");a[0]=e;for(let s=1;s<a.length;s++)a[s]=a[s-1]+r;return a}var lH=Jo(e=>Math.log(e)),CTe=pc(Ih,lH),_Te={kernelName:Ih,backendName:"cpu",kernelFunc:CTe};function uH(e,t,n,r){let a=A.getTypedArrayFromDType(r,A.sizeFromShape(n));for(let s=0;s<a.length;++s){let i=s*t,l=e[i];for(let u=0;u<t;++u){let d=e[i+u];(Number.isNaN(d)||d>l)&&(l=d)}a[s]=l}return a}var cH=Or((e,t)=>Math.max(e,t)),ITe=ra(Ah,cH),TTe={kernelName:Ah,backendName:"cpu",kernelFunc:ITe},dH=Or((e,t)=>Math.min(e,t)),ETe=ra($h,dH),jTe={kernelName:$h,backendName:"cpu",kernelFunc:ETe},nA=Or((e,t)=>e*t),ATe=Jj((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),CN=ra(Oh,nA,ATe),RTe={kernelName:Oh,backendName:"cpu",kernelFunc:CN};function hH(e,t,n){let r=A.createScalarValue(-1,n);return nA([],t,r,e,n)}function DTe(e){let{inputs:t,backend:n}=e,{x:r}=t;St(r,"neg");let a=n.data.get(r.dataId).values,[s,i]=hH(a,r.shape,r.dtype);return n.makeTensorInfo(i,r.dtype,s)}var MTe={kernelName:Gf,backendName:"cpu",kernelFunc:DTe},pH=Or((e,t)=>e!==t?1:0),$Te=ra(qf,pH,null,"bool"),FTe={kernelName:qf,backendName:"cpu",kernelFunc:$Te};function rA(e,t,n,r,a){let s=t.length,i=A.sizeFromShape(t),l=A.computeStrides(t),u=A.computeStrides(a),d=A.getTypedArrayFromDType(n,A.sizeFromShape(a));for(let c=0;c<i;++c){let h=A.indexToLoc(c,s,l),p=new Array(h.length);for(let f=0;f<p.length;f++)p[f]=h[r[f]];let m=A.locToIndex(p,s,u);d[m]=e[c]}return d}function ys(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:s}=n;St(a,"transpose");let i=a.shape.length,l=new Array(i);for(let c=0;c<l.length;c++)l[c]=a.shape[s[c]];let u=r.data.get(a.dataId).values,d=rA(u,a.shape,a.dtype,s,l);return{dataId:r.write(d,l,a.dtype),shape:l,dtype:a.dtype}}var PTe={kernelName:vl,backendName:"cpu",kernelFunc:ys};function mH(e,t,n,r){let[a,s]=z.computeOutAndReduceShapes(e,r),i=ni(t,"int32"),l=A.makeZerosTypedArray(A.sizeFromShape(a),i),u=A.sizeFromShape(s);for(let d=0;d<l.length;++d){let c=d*u,h=1;for(let p=0;p<u;++p)h*=n[c+p];l[d]=h}return{outVals:l,outShape:a,outDtype:i}}function OTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;St(a,"prod");let l=a.shape.length,u=A.parseAxisParam(s,a.shape),d=z.getAxesPermutation(u,l),c=u,h=a,p=[];d!=null&&(h=ys({inputs:{x:a},backend:n,attrs:{perm:d}}),p.push(h),c=z.getInnerMostAxes(c.length,l));let m=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:x}=mH(h.shape,h.dtype,m,c),y=g;return i&&(y=z.expandShapeToKeepDim(g,u)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(y,x,f)}var LTe={kernelName:Vh,backendName:"cpu",kernelFunc:OTe};function zTe(e,t,n){e.forEach((r,a)=>{if(r<0||r>=n){let s=A.indexToLoc(a,t.length,A.computeStrides(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function BTe(e,t){for(let n=0;n<e.length;++n){let r=e[n],a=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function WTe(e,t,n,r){let a=[],s=0,i=t.length-1+n.length,l=new Array(i).fill(null).map(()=>[0]);BTe(n,r);let u=1;for(let d=0;d<t.length-1;++d){u*=t[d];let c=t[d+1];for(let h=1;h<u+1;++h)l[d].push(h*c)}for(let d=0;d<e.length;++d){let c=e[d],h=e[d]+1;for(let p=0;p<n.length;++p){let m=n[p],f=p+t.length-1;if(f>=0){let g=l[f],x=g[g.length-1]-m[c];for(let y=c;y<h;++y)l[f].push(m[y+1]+x)}c=m[c],h=m[h]}h!==c&&(a.push([c,h]),s+=h-c)}return{outSplits:l,valueSlices:a,numValues:s}}function VTe(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n].length,a=A.getArrayFromDType("int32",r);t.push(a),e[n].forEach((s,i)=>a[i]=s)}return t}function LF(e,t){let n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function UTe(e,t,n,r,a,s){let i=LF(t,2)[1],l=LF(s,2)[1],u=0;for(let d of n)for(let c=d[0];c<d[1];++c){for(let h=0;h<r;++h)a[u*l+h]=e[c*i+h];++u}}function HTe(e,t,n,r,a){let s=t.slice();s[0]=a;let i=A.getArrayFromDType(n,A.sizeFromShape(s)),l=e.length,u=l===0?0:l/t[0];return UTe(e,t,r,u,i,s),[i,s]}function fH(e,t,n,r,a,s,i,l){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");let u=t[0][0]-1;if(zTe(s,i,u),r.length===0)throw new Error("params.rank must be nonzero");let d=r[0],{outSplits:c,valueSlices:h,numValues:p}=WTe(s,i,e,d),m=VTe(c),f=HTe(n,r,a,h,p);return[m,f[0],f[1]]}var zF=2147483647;function gH(e,t,n,r,a,s,i){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let l=t.length===0,u=a.length===0,d=i.length===0,c=[];l||c.push(t[0]),u||c.push(a[0]),d||c.push(i[0]);for(let x=1;x<c.length;++x)if(c[x]!==c[x-1])throw new Error("starts, limits, and deltas must have the same shape");let h=c.length===0?1:c[0],p=A.getArrayFromDType("int32",h+1);p[0]=0;for(let x=0;x<h;++x){let y=l?e[0]:e[x],b=u?r[0]:r[x],v=d?s[0]:s[x];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&b<y||v<0&&b>y)w=0;else if(w=Math.ceil(Math.abs((b-y)/v)),w>zF)throw new Error(`Requires ((limit - start) / delta) <= ${zF}`);p[x+1]=p[x]+w}let m=p[h],f=A.getArrayFromDType(n,m),g=0;for(let x=0;x<h;++x){let y=p[x+1]-p[x],b=l?e[0]:e[x],v=d?s[0]:s[x];for(let w=0;w<y;++w)f[g++]=b,b+=v}return[p,f]}var ui=z.RowPartitionType,GTe=class AC{constructor(t,n,r,a,s,i,l,u,d,c){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=l,this.rowPartitionValues=u,this.rowPartitionValuesShapes=d,this.rowPartitionTypes=z.getRowPartitionTypesHelper(c),this.raggedRank=z.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===ui.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===ui.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){let n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case ui.VALUE_ROWIDS:return AC.getMaxWidthValueRowID(n);case ui.ROW_SPLITS:return AC.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ui[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){let n=t.length;if(n===0||n===1)return 0;let r=0;for(let a=0;a<n-1;++a){let s=t[a+1]-t[a];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){let n=t.length;if(n===0)return 0;let r=0,a=t[0],s=0;for(let i=1;i<n;++i){let l=t[i];l!==a&&(a=l,s=Math.max(i-r,s),r=i)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return WF(t,r)}calculateOutputSize(t){let n=this.valuesShape,r=this.defaultValueShape;z.validateDefaultValueShape(r,n);let a=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=z.combineRaggedTensorToTensorShapes(this.raggedRank,a,n);s[0]<0&&(s[0]=t);for(let i=1;i<=this.raggedRank;++i)s[i]<0&&(s[i]=this.getMaxWidth(i));return s}calculateFirstParentOutputIndex(t,n,r){let a=Math.min(t,r),s=[],i=0;for(let l=0;l<a;++l,i+=n)s.push(i);for(let l=a;l<t;++l)s.push(-1);return A.assert(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,a){let s=t.length,i=[];for(let l=0;l<s-1;++l){let u=t[l+1]-t[l],d=Math.min(a,u),c=n[l];c===-1&&(d=0);for(let h=0;h<d;++h)i.push(c),c+=r;for(let h=0;h<u-d;++h)i.push(-1)}if(s>0&&i.length!==t[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(t,n,r,a){let s=t.length,i=[];if(s===0)return[];let l=0,u=t[0];if(u>=n.length)throw new Error(`Got currentValueRowId=${u}, which is not less than ${n.length}`);let d=n[u];i.push(d);for(let c=1;c<s;++c){let h=t[c];if(h===u)d>=0&&(++l,l<a?d+=r:d=-1);else{if(l=0,u=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);d=n[h]}i.push(d)}if(i.length!==t.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(t,n,r,a){let s=this.getRowPartitionTensor(t),i=this.getRowPartitionTypeByDimension(t);switch(i){case ui.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,a);case ui.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,a);default:throw new Error(`Unsupported partition type: ${ui[i]}`)}}getFirstDimensionSize(){let t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let n=this.rowPartitionTypes[0];switch(n){case ui.FIRST_DIM_SIZE:return t[0];case ui.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ui.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ui[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let i=r.length-2;i>=0;--i)r[i]=r[i+1]*n[i+1];let a=WF(n,!1),s=A.getArrayFromDType(this.valuesDType,A.sizeFromShape(a));if(r[0]*n[0]>0){let i=this.calculateFirstParentOutputIndex(t,r[0],n[0]);for(let l=1;l<=this.raggedRank;++l)i=this.calculateOutputIndex(l-1,i,r[l],n[l]);this.setOutput(this.raggedRank,i,s,a)}return[a,s]}setOutput(t,n,r,a){if(r.length===0)return;let s=this.values,i=r,l=a.slice();l=l.slice(t+1);let u=A.sizeFromShape(l),d=n.length,c=this.defaultValue;if(c.length!==u&&c.length!==1){let f=this.defaultValueShape;ce(()=>{let g=ue(c,f);c=od(g,l).dataSync()})}let h=0,p=0,m=0;for(let f=0;f<=d;++f){let g=f<d?n[f]:-1;if(g===m){++m;continue}if(p<m){let x=s.subarray(h*u),y=i.subarray(p*u),b=(m-p)*u;BF(y,x,b)}if(f>=d){let x=r.length;g=Math.floor(x/u)}if(g>m)if(this.defaultValue.length===1)i.subarray(m*u,g*u).fill(this.defaultValue[0]),m=g;else for(;g>m;){let x=i.slice(m*u);BF(x,c,u),++m}g<0?(h=f+1,p=m):(h=f,p=m,m=p+1)}}};function BF(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function WF(e,t){let n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function xH(e,t,n,r,a,s,i,l,u,d){return new GTe(e,t,n,r,a,s,i,l,u,d).compute()}function aA(e,t,n,r){let a=e===t,s=e<t&&n<0,i=t<e&&n>1;if(a||s||i)return A.makeZerosTypedArray(0,r);let l=Math.abs(Math.ceil((t-e)/n)),u=A.makeZerosTypedArray(l,r);t<e&&n===1&&(n=-1),u[0]=e;for(let d=1;d<u.length;d++)u[d]=u[d-1]+n;return u}var yH=Jo(e=>1/Math.sqrt(e)),qTe=pc(Zh,yH),KTe={kernelName:Zh,backendName:"cpu",kernelFunc:qTe};function Hc(e,t,n,r,a,s,i,l,u,d){let c=[r/a,a],h=e.values,p=t.values;if(r===0)return nn(n,t.dtype);let m=u instanceof Wr?u:nn(c,t.dtype);typeof u=="string"||typeof u=="number"?m.values.fill(u):typeof u=="boolean"&&m.values.fill(+u);for(let f=0;f<s;f++){let g=[],x=0;for(let y=0;y<i;y++){let b=h[f*i+y];g.push(b),x+=b*l[y]}if(x<0||x>=r/a)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<a;y++)d?m.values[x*a+y]+=p[f*a+y]:m.values[x*a+y]=t.rank===0?p[0]:p[f*a+y]}return m}var YTe=Jo(e=>1/(1+Math.exp(-e))),bH=Zn(np,e=>1/(1+Math.exp(-e))),XTe={kernelName:np,backendName:"cpu",kernelFunc:bH};function b0(e,t,n,r,a){let s=ea.isSliceContinous(r,t,n),i=A.sizeFromShape(n),l=A.computeStrides(r);if(s){let h=ea.computeFlatOffset(t,l);return a==="string"?e.slice(h,h+i):e.subarray(h,h+i)}let u=a==="string"?z.fromUint8ToStringArray(e):e,d=nn(r,a,u),c=nn(n,a);for(let h=0;h<c.size;++h){let p=c.indexToLoc(h),m=p.map((f,g)=>f+t[g]);c.set(d.get(...m),...p)}return a==="string"?z.fromStringArrayToUint8(c.values):c.values}function zd(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:i}=r;St(a,"slice");let[l,u]=ea.parseSliceParams(a,s,i);ea.assertParamsValid(a,l,u);let d=n.data.get(a.dataId).values,c=b0(d,l,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,c)}var ZTe={kernelName:ig,backendName:"cpu",kernelFunc:zd};function vH(e,t,n,r,a,s,i){let l=t[0],u=s[0],d=new Array(u),c=new Array(l),h=t[1];if(u===0){if(l!==0)throw new Error(z.getSparseFillEmptyRowsIndicesDenseShapeMismatch(l));let x=A.getArrayFromDType(n,0),y=A.getArrayFromDType(a,0);return[x,[0,h],y,d,c]}let p=!0,m=0,f=new Array(u).fill(0);for(let x=0;x<l;++x){let y=e[x*h];if(y<0)throw new Error(z.getSparseFillEmptyRowsNegativeIndexErrorMessage(x,y));if(y>=u)throw new Error(z.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(x,y,u));++f[y],p=p&&y>=m,m=y}let g=!0;for(let x=0;x<u;++x){let y=f[x]===0;d[x]=y,g=g&&!y,f[x]=Math.max(f[x],1),x>0&&(f[x]+=f[x-1])}if(g&&p){let x=e,y=r;for(let b=0;b<l;++b)c[b]=b;return[x,[l,h],y,d,c]}else{let x=f[u-1],y=A.getArrayFromDType(n,x*h),b=A.getArrayFromDType(a,x),v=new Array(u).fill(0);for(let w=0;w<l;++w){let N=e[w*h],S=v[N],C=(N===0?0:f[N-1])+S;v[N]++;for(let _=0;_<h;++_)y[C*h+_]=e[w*h+_];b[C]=r[w],c[w]=C}for(let w=0;w<u;++w)if(v[w]===0){let N=w===0?0:f[w-1];y[N*h+0]=w;for(let S=1;S<h;++S)y[N*h+S]=0;b[N]=i}return[y,[x,h],b,d,c]}}function wH(e,t,n,r,a){let s=A.sizeFromShape(r),i=t[0],l=a.length,u=[],d=1,c=-1;for(let g=0;g<l;++g){let x=a[g];if(x===-1){if(c!==-1)throw new Error(z.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,g));c=g,u.push(1)}else{if(x<0)throw new Error(z.getSparseReshapeNegativeOutputDimErrorMessage(g,x));d*=x,u.push(x)}}if(c!==-1){if(d<=0)throw new Error(z.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(s/d);if(d*g!==s)throw new Error(z.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[c]=g}if(A.sizeFromShape(u)!==s)throw new Error(z.getSparseReshapeInputOutputMismatchErrorMessage(r,u));let h=r.length,p=[];if(h>0){p[h-1]=1;for(let g=h-2;g>=0;--g)p[g]=p[g+1]*r[g+1]}let m=[];if(l>0){m[l-1]=1;for(let g=l-2;g>=0;--g)m[g]=m[g+1]*u[g+1]}let f=A.getArrayFromDType(n,i*l);for(let g=0;g<i;++g){let x=0;for(let y=0;y<h;++y)x+=e[g*h+y]*p[y];for(let y=0;y<l;++y)f[g*l+y]=Math.trunc(x/m[y]),x%=m[y]}return[f,[i,l],u]}function sA(e,t,n,r,a,s=!1,i=0){let l=r.length,u=[t[0],e.length/t[0]],d=u[1],c=l>0?a[l-1]+1:0;if(c<0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let h=t.slice();h[0]=c;let p=h.reduce((b,v)=>b*v,1),m=A.getArrayFromDType(n,p);if(l===0)return c>0&&m.fill(i),[m,h];if(c<=0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let f=0,g=1,x=0,y=a[f];for(;;){let b=0;if(g<l){if(b=a[g],y===b){++g;continue}if(y>=b)throw new Error(z.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=c)throw new Error(z.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,c));y>x&&m.fill(i,x*d,y*d);for(let v=f;v<g;++v){let w=r[v];if(w<0||w>=u[0])throw new Error(z.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(v,r[v],u[0]));for(let N=0;N<d;N++)m[y*d+N]+=e[w*d+N]}if(s)for(let v=0;v<d;v++)m[y*d+v]/=g-f;if(f=g,++g,x=y+1,y=b,g>l)break}return x<c&&m.fill(i,x*d,c*d),[m,h]}var QTe=Jo(e=>Math.sqrt(e)),JTe=Zn(ap,e=>Math.sqrt(e)),eEe={kernelName:ap,backendName:"cpu",kernelFunc:JTe},NH=Or((e,t)=>{let n=e-t;return n*n}),tEe=ra(op,NH),nEe={kernelName:op,backendName:"cpu",kernelFunc:tEe},kH=Jo((e,t)=>{let{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)}),rEe=pc(ub,kH),aEe={kernelName:ub,backendName:"cpu",kernelFunc:rEe};function SH(e,t,n,r){let a=nn(e,t.dtype);for(let s=0;s<a.size;s++){let i=a.indexToLoc(s),l=new Array(i.length);for(let u=0;u<l.length;u++)l[u]=i[u]*n[u]+r[u];a.set(t.get(...l),...i)}return a}var sEe=class{constructor(e,t,n,r,a,s){this.separator=A.encodeString(e),this.nGramWidths=t,this.leftPad=A.encodeString(n),this.rightPad=A.encodeString(r),this.padWidth=a,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){let n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,s){for(let i=0;i<a;++i){let l=this.getPadWidth(s),u=Math.max(0,l-i),d=Math.max(0,l-(a-(i+1))),c=s-(u+d),h=t+(u>0?0:i-l),p=0;p+=u*this.leftPad.length;for(let y=0;y<c;++y)p+=e[h+y].length;p+=d*this.rightPad.length;let m=u+d+c-1;p+=m*this.separator.length,n[r+i]=new Uint8Array(p);let f=n[r+i],g=0,x=y=>y.forEach(b=>f[g++]=b);for(let y=0;y<u;++y)x(this.leftPad),x(this.separator);for(let y=0;y<c-1;++y)x(e[h+y]),x(this.separator);if(c>0){x(e[h+c-1]);for(let y=0;y<d;++y)x(this.separator),x(this.rightPad)}else{for(let y=0;y<d-1;++y)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,t){let n=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=n,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${n}]`);l=t[u]}if(l!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${l}`)}let a=r-1,s=A.getArrayFromDType("int32",r);if(n===0||r===0){let l=new Array(n);for(let u=0;u<=a;++u)s[u]=0;return[l,s]}s[0]=0;for(let l=1;l<=a;++l){let u=t[l]-t[l-1],d=0;this.nGramWidths.forEach(c=>{d+=this.getNumNGrams(u,c)}),this.preserveShort&&u>0&&d===0&&(d=1),s[l]=s[l-1]+d}let i=new Array(s[a]);for(let l=0;l<a;++l){let u=t[l],d=s[l];if(this.nGramWidths.forEach(c=>{let h=t[l+1]-t[l],p=this.getNumNGrams(h,c);this.createNGrams(e,u,i,d,p,c),d+=p}),this.preserveShort&&d===s[l]){let c=t[l+1]-t[l];if(c===0)continue;let h=c+2*this.padWidth;this.createNGrams(e,u,i,d,1,h)}}return[i,s]}};function iA(e,t,n,r,a,s,i,l){return new sEe(n,r,a,s,i,l).compute(e,t)}function iEe(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){let s=t[0],i=e.indexOf(s);for(;i!==-1;){let l=e.subarray(0,i);(!n||l.length!==0)&&r.push(l),e=e.subarray(i+1),i=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let a=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){let i=e.subarray(a,s);(!n||i.length!==0)&&r.push(i),a=s+1}}function oA(e,t,n){let r=e.length,a=[],s=0,i=0,l=new Array(r);for(let p=0;p<r;++p){let m=a.length;iEe(e[p],t,n,a);let f=a.length-m;l[p]=f,s+=f,i=Math.max(i,f)}let u=A.getArrayFromDType("int32",s*2),d=new Array(s),c=[r,i],h=0;for(let p=0;p<r;++p)for(let m=0;m<l[p];++m)u[h*2]=p,u[h*2+1]=m,d[h]=a[h],++h;return[u,d,c]}function lA(e,t){let n=A.getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=A.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var CH=Or((e,t)=>e-t),oEe=Jj((e,t,n,r)=>({real:e-n,imag:t-r})),uA=ra(lp,CH,oEe),lEe={kernelName:lp,backendName:"cpu",kernelFunc:uA};function _H(e,t){let n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];let r=nn(n,e.dtype);for(let a=0;a<r.values.length;++a){let s=r.indexToLoc(a),i=new Array(e.rank);for(let u=0;u<i.length;u++)i[u]=s[u]%e.shape[u];let l=e.locToIndex(i);r.values[a]=e.values[l]}return r}var vx=(e,t)=>{let n=t.value-e.value;return n===0?e.index-t.index:n};function IH(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){let l=r-n+1,u=t-n+1,d=Math.log(l),c=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*c*(l-c)/l)*Math.sign(u-l/2),p=Math.max(n,Math.floor(t-u*c/l+h)),m=Math.min(r,Math.floor(t+(l-u)*c/l+h));IH(e,t,p,m)}let a=e[t],s=n,i=r;for(A.swap(e,n,t),vx(e[r],a)>0&&A.swap(e,n,r);s<i;){for(A.swap(e,s,i),s++,i--;vx(e[s],a)<0;)s=s+1;for(;vx(e[i],a)>0;)i=i-1}vx(e[n],a)===0?A.swap(e,n,i):(i=i+1,A.swap(e,i,r)),i<=t&&(n=i+1),t<=i&&(r=i-1)}}function TH(e,t,n,r,a){let s=t[t.length-1],[i,l]=[e.length/s,s],u=A.getTypedArrayFromDType(n,i*r),d=A.getTypedArrayFromDType("int32",i*r);for(let h=0;h<i;h++){let p=h*l,m=e.subarray(p,p+l),f=new Array(m.length);m.forEach((b,v)=>f[v]={value:b,index:v}),r<f.length&&(IH(f,r),f=f.slice(0,r)),a&&f.sort(vx);let g=h*r,x=u.subarray(g,g+r),y=d.subarray(g,g+r);for(let b=0;b<r;b++)x[b]=f[b].value,y[b]=f[b].index}let c=t.slice();return c[c.length-1]=r,[nn(c,n,u),nn(c,"int32",d)]}function cA(e,t,n,r){let a=A.parseAxisParam(t,n)[0],s=[1,n[0],1];for(let f=0;f<a;f++)s[0]*=n[f];s[1]=n[a];for(let f=a+1;f<n.length;f++)s[2]*=n[f];let i=new Map,l=new Int32Array(n[a]),u=new Wr(s,r,e),d=[],c=s[0]===1&&s[2]===1;for(let f=0;f<n[a];f++){let g;if(c)g=e[f].toString();else{let y=[];for(let b=0;b<s[0];b++)for(let v=0;v<s[2];v++)y.push(u.get(b,f,v));g=y.join(",")}let x=i.get(g);if(x!=null)l[f]=x;else{let y=i.size;i.set(g,y),l[f]=y,d.push(f)}}let h=s.slice();h[1]=i.size;let p=new Wr(h,r);d.forEach((f,g)=>{for(let x=0;x<s[0];x++)for(let y=0;y<s[2];y++)p.set(u.get(x,f,y),x,g,y)});let m=n.slice();return m[a]=h[1],{outputValues:p.values,outputShape:m,indices:l}}var uEe="4.22.0";N1("cpu",()=>new Zj,1);var EH=Zn(mh,e=>e>=0?e:Math.exp(e)-1),cEe={kernelName:mh,backendName:"cpu",kernelFunc:EH};function jH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r;St([a],"leakyRelu");let i=A.sizeFromShape(a.shape),l=n.data.get(a.dataId).values,u=A.getTypedArrayFromDType("float32",i);for(let d=0;d<l.length;d++)u[d]=l[d]<0?s*l[d]:l[d];return n.makeTensorInfo(a.shape,"float32",u)}var dEe={kernelName:_h,backendName:"cpu",kernelFunc:jH},hEe=Or((e,t)=>e<0?t*e:e);function AH(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t;St([r,a],"prelu");let s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,[l,u]=hEe(r.shape,a.shape,s,i,"float32");return n.makeTensorInfo(u,"float32",l)}var pEe={kernelName:Wh,backendName:"cpu",kernelFunc:AH},RH=Zn(Hh,e=>Math.max(0,e)),mEe={kernelName:Hh,backendName:"cpu",kernelFunc:RH},DH=Zn(Kh,e=>Math.min(Math.max(0,e),6)),fEe={kernelName:Kh,backendName:"cpu",kernelFunc:DH};function v0(e,t,n,r,a){if(n==="linear")return Go({inputs:{x:t},backend:e});if(n==="relu")return RH({inputs:{x:t},backend:e});if(n==="elu")return EH({inputs:{x:t},backend:e});if(n==="relu6")return DH({inputs:{x:t},backend:e});if(n==="prelu")return AH({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return jH({inputs:{x:t},backend:e,attrs:{alpha:a}});if(n==="sigmoid")return bH({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function mr(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,i=A.sizeFromShape(a.shape),l=A.inferFromImplicitShape(s,i),u=A.sizeFromShape(l);A.assert(i===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${a.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(a.dataId);let d=n.data.get(a.dataId);if(d.complexTensorInfos!=null){let c=d.complexTensorInfos.real,h=d.complexTensorInfos.imag;c.shape=l,h.shape=l}return{dataId:a.dataId,shape:l,dtype:a.dtype}}var gEe={kernelName:Jf,backendName:"cpu",kernelFunc:mr};function MH(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:l}=r;St([a,s],"matMul");let u=a.shape.length,d=s.shape.length,c=i?a.shape[u-2]:a.shape[u-1],h=l?s.shape[d-1]:s.shape[d-2],p=i?a.shape[u-1]:a.shape[u-2],m=l?s.shape[d-2]:s.shape[d-1],f=a.shape.slice(0,-2),g=s.shape.slice(0,-2),x=A.sizeFromShape(f),y=A.sizeFromShape(g),b=xg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([p,m]);A.assert(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${i} and transposeB=${l} must match.`);let v=i?[x,c,p]:[x,p,c],w=l?[y,m,h]:[y,h,m],N=mr({inputs:{x:a},backend:n,attrs:{shape:v}}),S=mr({inputs:{x:s},backend:n,attrs:{shape:w}}),C=i?N.shape[1]:N.shape[2],_=i?N.shape[2]:N.shape[1],T=l?S.shape[1]:S.shape[2],E=Math.max(x,y),j=n.data.get(N.dataId).values,I=n.data.get(S.dataId).values,D=A.computeStrides(N.shape),F=A.computeStrides(S.shape),[P,V,$]=i?[D[0],1,D[1]]:[D[0],D[1],1],[O,L,q]=l?[1,F[1],F[0]]:[F[1],1,F[0]],U=_*T,ee=nn([E,_,T],N.dtype),M=ee.values,G=n.blockSize;for(let J=0;J<E;J++){let ve=J%x,Q=J%y;for(let se=0;se<_;se+=G){let _e=Math.min(se+G,_);for(let Le=0;Le<T;Le+=G){let Se=Math.min(Le+G,T);for(let ye=0;ye<C;ye+=G){let Fe=Math.min(ye+G,C);for(let Te=se;Te<_e;Te++)for(let Oe=Le;Oe<Se;Oe++){let He=0;for(let Ee=ye;Ee<Fe;Ee++){let Re=j[ve*P+Te*V+Ee*$],Ke=I[Ee*O+Oe*L+Q*q];He+=Re*Ke}M[J*U+(Te*T+Oe)]+=He}}}}}return n.disposeIntermediateTensorInfo(N),n.disposeIntermediateTensorInfo(S),n.makeTensorInfo(b,ee.dtype,ee.values)}var xEe={kernelName:nh,backendName:"cpu",kernelFunc:MH};function yEe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:l}=t,{transposeA:u,transposeB:d,activation:c,leakyreluAlpha:h}=r,p,m,f,g=[];p=MH({inputs:{a,b:s},attrs:{transposeA:u,transposeB:d},backend:n}),i&&(m=Qm({inputs:{a:p,b:i},backend:n}),g.push(p),p=m),c&&(f=v0(n,p,c,l,h),g.push(p),p=f);for(let x of g)n.disposeIntermediateTensorInfo(x);return p}var bEe={kernelName:_d,backendName:"cpu",kernelFunc:yEe},vEe=Zn(qd,e=>Math.acos(e)),wEe={kernelName:qd,backendName:"cpu",kernelFunc:vEe},NEe=Zn(Kd,e=>Math.acosh(e)),kEe={kernelName:Kd,backendName:"cpu",kernelFunc:NEe};function SEe(e){let{inputs:t,backend:n}=e,r=t;St(t,"addN");let a=r.map(l=>n.data.get(l.dataId).values),s=nn(r[0].shape,r[0].dtype),i=s.values;for(let l=0;l<r.length;l++){let u=a[l];for(let d=0;d<i.length;d++)i[d]+=u[d]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}var CEe={kernelName:Yd,backendName:"cpu",kernelFunc:SEe};function _Ee(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;St(a,"all");let l=A.parseAxisParam(s,a.shape),u=l,d=z.getAxesPermutation(u,a.shape.length),c=a;d!=null&&(c=ys({inputs:{x:a},backend:n,attrs:{perm:d}}),u=z.getInnerMostAxes(u.length,a.shape.length)),z.assertAxesAreInnerMostDims("all",u,c.shape.length);let[h,p]=z.computeOutAndReduceShapes(c.shape,u),m=A.sizeFromShape(p),f=A.makeZerosTypedArray(A.sizeFromShape(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let N=g[b+w];v=v&&N}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(h,c.dtype,f);if(i){let y=z.expandShapeToKeepDim(h,l),b=mr({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var IEe={kernelName:gf,backendName:"cpu",kernelFunc:_Ee};function TEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;St(a,"any");let l=A.parseAxisParam(s,a.shape),u=l,d=z.getAxesPermutation(u,a.shape.length),c=a;d!=null&&(c=ys({inputs:{x:a},backend:n,attrs:{perm:d}}),u=z.getInnerMostAxes(u.length,a.shape.length)),z.assertAxesAreInnerMostDims("any",u,c.shape.length);let[h,p]=z.computeOutAndReduceShapes(c.shape,u),m=A.sizeFromShape(p),f=A.makeZerosTypedArray(A.sizeFromShape(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let N=g[b+w];v=v||N}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(h,c.dtype,f);if(i){let y=z.expandShapeToKeepDim(h,l),b=mr({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var EEe={kernelName:xf,backendName:"cpu",kernelFunc:TEe};function jEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;St(a,"argMax");let i=A.parseAxisParam(s,a.shape),l=z.getAxesPermutation(i,a.shape.length),u=a,d=[];l!=null&&(u=ys({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(u),i=z.getInnerMostAxes(i.length,u.shape.length)),i=[i[0]],z.assertAxesAreInnerMostDims("argMax",i,u.shape.length);let[c,h]=z.computeOutAndReduceShapes(u.shape,i),p=A.sizeFromShape(c),m=A.makeZerosTypedArray(p,"int32"),f=A.sizeFromShape(h),g=n.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let y=x*f,b=g[y],v=0;for(let w=0;w<f;++w){let N=g[y+w];N>b&&(b=N,v=w)}m[x]=v}return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",m)}var AEe={kernelName:yf,backendName:"cpu",kernelFunc:jEe};function REe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;St(a,"argMin");let i=A.parseAxisParam(s,a.shape),l=z.getAxesPermutation(i,a.shape.length),u=a,d=[];l!=null&&(u=ys({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(u),i=z.getInnerMostAxes(i.length,u.shape.length)),i=[i[0]],z.assertAxesAreInnerMostDims("argMin",i,u.shape.length);let[c,h]=z.computeOutAndReduceShapes(u.shape,i),p=A.sizeFromShape(c),m=A.makeZerosTypedArray(p,"int32"),f=A.sizeFromShape(h),g=n.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let y=x*f,b=g[y],v=0;for(let w=0;w<f;++w){let N=g[y+w];N<b&&(b=N,v=w)}m[x]=v}return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(c,"int32",m)}var DEe={kernelName:bf,backendName:"cpu",kernelFunc:REe},MEe=Zn(Xd,e=>Math.asin(e)),$Ee={kernelName:Xd,backendName:"cpu",kernelFunc:MEe},FEe=Zn(Zd,e=>Math.asinh(e)),PEe={kernelName:Zd,backendName:"cpu",kernelFunc:FEe},OEe=Zn(Qd,e=>Math.atan(e)),LEe={kernelName:Qd,backendName:"cpu",kernelFunc:OEe},zEe=Or((e,t)=>Math.atan2(e,t)),BEe=ra(eh,zEe),WEe={kernelName:eh,backendName:"cpu",kernelFunc:BEe},VEe=Zn(Jd,e=>Math.atanh(e)),UEe={kernelName:Jd,backendName:"cpu",kernelFunc:VEe};function dA(e,t,n,r,a,s){let i=a.strideHeight,l=a.strideWidth,u=a.dilationHeight,d=a.dilationWidth,c=a.effectiveFilterHeight,h=a.effectiveFilterWidth,p=a.padInfo.top,m=a.padInfo.left,f=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=nn(a.outShape,n),x=g.values,y=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],v=a.outShape[3];for(let w=0;w<a.batchSize;++w){let N=w*y,S=w*r[0];for(let C=0;C<a.inChannels;++C)for(let _=0;_<a.outHeight;++_){let T=_*i-p,E=Math.max(0,T),j=Math.min(a.inHeight,c+T),I=N+_*b;for(let D=0;D<a.outWidth;++D){let F=D*l-m,P=Math.max(0,F),V=Math.min(a.inWidth,h+F),$=f,O=0,L=0;for(let U=E;U<j;U+=u){let ee=S+U*r[1];for(let M=P;M<V;M+=d){let G=ee+M*r[2],J=e[G+C];s==="max"&&J>$?$=J:s==="avg"&&(O+=J,L++)}if(isNaN($))break}let q=I+D*v+C;x[q]=s==="avg"?O/L:$}}}return g}function $H(e,t,n,r,a=!1,s=!1){let i=nn(r.outShape,"int32"),l=r.strideHeight,u=r.strideWidth,d=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,f=r.padInfo.left,g=nn(t,n,e);for(let x=0;x<r.batchSize;++x)for(let y=0;y<r.inChannels;++y)for(let b=0;b<r.outHeight;++b){let v=b*l-m,w=v;for(;w<0;)w+=d;let N=Math.min(r.inHeight,h+v);for(let S=0;S<r.outWidth;++S){let C=S*u-f,_=C;for(;_<0;)_+=c;let T=Math.min(r.inWidth,p+C),E=Number.NEGATIVE_INFINITY,j=-1;for(let I=w;I<N;I+=d){let D=I-v;for(let F=_;F<T;F+=c){let P=F-C,V=g.get(x,I,F,y);V>E&&(E=V,a?j=s?((x*r.inHeight+I)*r.inWidth+F)*r.inChannels+y:(I*r.inWidth+F)*r.inChannels+y:j=D*p+P)}}i.set(j,x,b,S,y)}}return i}function FH(e,t,n,r,a,s){let i=a.strideDepth,l=a.strideHeight,u=a.strideWidth,d=a.dilationDepth,c=a.dilationHeight,h=a.dilationWidth,p=a.effectiveFilterDepth,m=a.effectiveFilterHeight,f=a.effectiveFilterWidth,g=a.padInfo.front,x=a.padInfo.top,y=a.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=nn(a.outShape,n),w=v.values,N=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],C=a.outShape[3]*a.outShape[4],_=a.outShape[4];for(let T=0;T<a.batchSize;++T){let E=T*N,j=T*r[0];for(let I=0;I<a.inChannels;++I)for(let D=0;D<a.outDepth;++D){let F=D*i-g,P=F;for(;P<0;)P+=d;let V=Math.min(a.inDepth,p+F),$=E+D*S;for(let O=0;O<a.outHeight;++O){let L=O*l-x,q=L;for(;q<0;)q+=c;let U=Math.min(a.inHeight,m+L),ee=$+O*C;for(let M=0;M<a.outWidth;++M){let G=M*u-y,J=G;for(;J<0;)J+=h;let ve=Math.min(a.inWidth,f+G),Q=ee+M*_,se=b,_e=0,Le=0;for(let ye=P;ye<V;ye+=d){let Fe=j+ye*r[1];for(let Te=q;Te<U;Te+=c){let Oe=Fe+Te*r[2];for(let He=J;He<ve;He+=h){let Ee=Oe+He*r[3],Re=e[Ee+I];if(s==="max"&&Re>se?se=Re:s==="avg"&&(_e+=Re,Le++),isNaN(se))break}if(isNaN(se))break}if(isNaN(se))break}let Se=Q+I;w[Se]=s==="avg"?_e/Math.max(Le,1):se}}}}return v}function HEe(e,t){let n=nn(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,s=t.strideWidth,i=t.dilationDepth,l=t.dilationHeight,u=t.dilationWidth,d=t.effectiveFilterDepth,c=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,m=t.padInfo.top,f=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let x=0;x<t.inChannels;++x)for(let y=0;y<t.outDepth;++y){let b=y*r-p,v=b;for(;v<0;)v+=i;let w=Math.min(t.inDepth,d+b);for(let N=0;N<t.outHeight;++N){let S=N*a-m,C=S;for(;C<0;)C+=l;let _=Math.min(t.inHeight,c+S);for(let T=0;T<t.outWidth;++T){let E=T*s-f,j=E;for(;j<0;)j+=u;let I=Math.min(t.inWidth,h+E),D=Number.NEGATIVE_INFINITY,F=-1;for(let P=v;P<w;P+=i){let V=P-b;for(let $=C;$<_;$+=l){let O=$-S;for(let L=j;L<I;L+=u){let q=L-E,U=e.get(g,P,$,L,x);U>=D&&(D=U,F=V*c*h+O*c+q)}}}n.set(F,g,y,N,T,x)}}}return n}function GEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;St(a,"avgPool");let{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=r,d=1;A.assert(z.eitherStridesOrDilationsAreOne(i,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let c=z.computePool2DInfo(a.shape,s,i,d,l,u),h;if(c.filterWidth===1&&c.filterHeight===1&&A.arraysEqual(c.inShape,c.outShape))h=Go({inputs:{x:a},backend:n});else{let p=n.data.get(a.dataId).values,m=A.computeStrides(a.shape),f=dA(p,a.shape,a.dtype,m,c,"avg");h=n.makeTensorInfo(c.outShape,a.dtype,f.values)}return h}var qEe={kernelName:th,backendName:"cpu",kernelFunc:GEe};function KEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u,dataFormat:d}=r;St(a,"avgPool3d");let c=z.computePool3DInfo(a.shape,s,i,1,l,u,d),h=n.data.get(a.dataId).values,p=FH(h,a.shape,a.dtype,A.computeStrides(a.shape),c,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}var YEe={kernelName:vf,backendName:"cpu",kernelFunc:KEe};function XEe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=r;St([a,s],"avgPool3DGrad");let c=z.computePool3DInfo(s.shape,i,l,1,u,d),h=c.strideDepth,p=c.strideHeight,m=c.strideWidth,f=c.filterDepth,g=c.filterHeight,x=c.filterWidth,y=c.dilationDepth,b=c.dilationHeight,v=c.dilationWidth,w=c.effectiveFilterDepth,N=c.effectiveFilterHeight,S=c.effectiveFilterWidth,C=w-1-c.padInfo.front,_=S-1-c.padInfo.left,T=N-1-c.padInfo.top,E=nn(s.shape,"float32"),j=1/(f*g*x),I=n.bufferSync(a);for(let D=0;D<c.batchSize;++D)for(let F=0;F<c.inChannels;++F)for(let P=0;P<c.inDepth;++P)for(let V=0;V<c.inHeight;++V)for(let $=0;$<c.inWidth;++$){let O=P-C,L=V-T,q=$-_,U=0;for(let ee=0;ee<w;ee+=y){let M=(O+ee)/h;if(!(M<0||M>=c.outDepth||Math.floor(M)!==M))for(let G=0;G<N;G+=b){let J=(L+G)/p;if(!(J<0||J>=c.outHeight||Math.floor(J)!==J))for(let ve=0;ve<S;ve+=v){let Q=(q+ve)/m;if(Q<0||Q>=c.outWidth||Math.floor(Q)!==Q)continue;let se=I.get(D,M,J,Q,F);U+=se}}}E.set(U*j,D,P,V,$,F)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}var ZEe={kernelName:Yy,backendName:"cpu",kernelFunc:XEe};function QEe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s;St([a,s],"avgPoolGrad");let{filterSize:l,strides:u,pad:d}=r,c=z.computePool2DInfo(i.shape,l,u,1,d),h=c.strideHeight,p=c.strideWidth,m=c.filterHeight,f=c.filterWidth,g=c.dilationHeight,x=c.dilationWidth,y=c.effectiveFilterHeight,b=c.effectiveFilterWidth,v=b-1-c.padInfo.left,w=y-1-c.padInfo.top,N=nn(i.shape,"float32"),S=1/(m*f),C=n.data.get(a.dataId).values,_=nn(a.shape,"float32",C);for(let T=0;T<c.batchSize;++T)for(let E=0;E<c.inChannels;++E)for(let j=0;j<c.inHeight;++j)for(let I=0;I<c.inWidth;++I){let D=j-w,F=I-v,P=0;for(let V=0;V<y;V+=g){let $=(D+V)/h;if(!($<0||$>=c.outHeight||Math.floor($)!==$))for(let O=0;O<b;O+=x){let L=(F+O)/p;if(L<0||L>=c.outWidth||Math.floor(L)!==L)continue;let q=_.get(T,$,L,E);P+=q}}N.set(P*S,T,j,I,E)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}var JEe={kernelName:Ky,backendName:"cpu",kernelFunc:QEe};function eje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,scale:s,offset:i,mean:l,variance:u}=t;A.assert(l.shape.length===u.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A.assert(i==null||l.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A.assert(s==null||l.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),St([a,l,u,s,i],"batchNorm");let{varianceEpsilon:d}=r;d==null&&(d=.001);let c=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,p=n.data.get(u.dataId).values,m=s?n.data.get(s.dataId).values:new Float32Array([1]),f=i?n.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(c.length),x=f.length,y=m.length,b=p.length,v=h.length,w=0,N=0,S=0,C=0;for(let _=0;_<c.length;++_)g[_]=f[w++]+(c[_]-h[N++])*m[S++]/Math.sqrt(p[C++]+d),w>=x&&(w=0),N>=v&&(N=0),S>=y&&(S=0),C>=b&&(C=0);return n.makeTensorInfo(a.shape,a.dtype,g)}var tje={kernelName:vh,backendName:"cpu",kernelFunc:eje};function nje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r;St([a],"batchToSpaceND");let l=s.reduce((y,b)=>y*b),u=z.getReshaped(a.shape,s,l),d=z.getPermuted(u.length,s.length),c=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(i,s.length),p=z.getSliceSize(c,i,s.length),m=mr({inputs:{x:a},backend:n,attrs:{shape:u}}),f=ys({inputs:{x:m},backend:n,attrs:{perm:d}}),g=mr({inputs:{x:f},backend:n,attrs:{shape:c}}),x=zd({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}var rje={kernelName:wf,backendName:"cpu",kernelFunc:nje};function aje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i}=r,l=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,d=eA(l,u,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,d)}var sje={kernelName:Nf,backendName:"cpu",kernelFunc:aje};function ije(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.data.get(r.dataId).values,i=n.data.get(a.dataId).values,l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeTensorInfo([l.length],"int32",Int32Array.from(l))}var oje={kernelName:Xy,backendName:"cpu",kernelFunc:ije},lje=Zn(sc,(e,t)=>{let n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),uje={kernelName:sc,backendName:"cpu",kernelFunc:lje},cje=e=>{let{x:t}=e.inputs,n=e.backend,r=new Float32Array(A.sizeFromShape(t.shape)),a=n.data.get(t.dataId),s=a.complexTensorInfos.real,i=a.complexTensorInfos.imag,l=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values;for(let d=0;d<l.length;d++){let c=l[d],h=u[d];r[d]=Math.hypot(c,h)}return n.makeOutput(r,t.shape,"float32")},dje={kernelName:Zy,backendName:"cpu",kernelFunc:cje};function Jm(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var hje={kernelName:f1,backendName:"cpu",kernelFunc:Jm};function ef(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=A.parseAxisParam(a,t[0].shape)[0],i=t.map(g=>g.shape);z.assertParamsConsistent(i,s);let l=z.computeOutShape(t.map(g=>g.shape),s);if(A.sizeFromShape(l)===0)return n.makeTensorInfo(l,t[0].dtype,[]);let u=t.filter(g=>A.sizeFromShape(g.shape)>0);if(u.length===1)return Go({inputs:{x:u[0]},backend:n});if(u[0].dtype==="complex64"){let g=u.map(w=>Ld({inputs:{input:w},backend:n})),x=u.map(w=>Jm({inputs:{input:w},backend:n})),y=ef({inputs:g,backend:n,attrs:{axis:s}}),b=ef({inputs:x,backend:n,attrs:{axis:s}}),v=Es({inputs:{real:y,imag:b},backend:n});return g.forEach(w=>n.disposeIntermediateTensorInfo(w)),x.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),v}let d=u.map(g=>{let x=[-1,A.sizeFromShape(g.shape.slice(s))];return mr({inputs:{x:g},backend:n,attrs:{shape:x}})}),c=d.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));l=z.computeOutShape(d.map(g=>g.shape),1);let h=d[0].shape[0]===1,p=tA(c,l,t[0].dtype,h),m=z.computeOutShape(u.map(g=>g.shape),s),f=n.makeTensorInfo(m,t[0].dtype,p);return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var pje={kernelName:Sf,backendName:"cpu",kernelFunc:ef};function PH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dataFormat:u,dilations:d,dimRoundingMode:c}=r;St([a,s],"conv2d");let h=z.convertConv2DDataFormat(u),p=z.computeConv2DInfo(a.shape,s.shape,i,d,l,c,!1,h),m=p.filterHeight,f=p.filterWidth,g=p.dilationHeight,x=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v=p.dataFormat==="channelsLast",w=new Wr(p.outShape,a.dtype),N=A.computeStrides(a.shape),S=A.computeStrides(s.shape),C=N[0],_=v?N[1]:N[2],T=v?N[2]:1,E=v?1:N[1],j=w.strides[0],I=v?w.strides[1]:w.strides[2],D=v?w.strides[2]:1,F=v?1:w.strides[1],P=n.data.get(a.dataId).values,V=n.data.get(s.dataId).values,$=w.values;for(let O=0;O<p.batchSize;++O){let L=O*C,q=O*j;for(let U=0;U<p.outHeight;++U){let ee=q+U*I,M=U*p.strideHeight-b;for(let G=0;G<m;++G){let J=M+G*g;if(J<0||J>=p.inHeight)continue;let ve=G*S[0],Q=L+J*_;for(let se=0;se<p.outWidth;++se){let _e=ee+se*D,Le=se*p.strideWidth-y;for(let Se=0;Se<f;++Se){let ye=Le+Se*x;if(ye<0||ye>=p.inWidth)continue;let Fe=ve+Se*S[1],Te=Q+ye*T,Oe=Fe;for(let He=0;He<p.inChannels;++He){let Ee=P[Te+He*E];for(let Re=0;Re<p.outChannels;++Re)$[_e+Re*F]+=Ee*V[Oe+Re];Oe+=p.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,$)}var mje={kernelName:sh,backendName:"cpu",kernelFunc:PH};function fje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:l,dataFormat:u,dimRoundingMode:d,filterShape:c}=r;St([a,s],"conv2dBackpropFilter");let h=z.convertConv2DDataFormat(u),p=z.computeConv2DInfo(a.shape,c,i,1,l,d,!1,h),{strideHeight:m,strideWidth:f,filterHeight:g,filterWidth:x}=p,y=p.dataFormat==="channelsLast",b=new Wr(p.filterShape,"float32"),v=p.padInfo.left,w=p.padInfo.top,N=n.data.get(a.dataId).values,S=n.data.get(s.dataId).values,C=new Wr(a.shape,a.dtype,N),_=new Wr(s.shape,s.dtype,S);for(let T=0;T<g;++T){let E=Math.max(0,Math.ceil((w-T)/m)),j=Math.min(p.outHeight,(p.inHeight+w-T)/m);for(let I=0;I<x;++I){let D=Math.max(0,Math.ceil((v-I)/f)),F=Math.min(p.outWidth,(p.inWidth+v-I)/f);for(let P=0;P<p.inChannels;++P)for(let V=0;V<p.outChannels;++V){let $=0;for(let O=0;O<p.batchSize;++O)for(let L=E;L<j;++L){let q=T+L*m-w;for(let U=D;U<F;++U){let ee=I+U*f-v;y?$+=C.get(O,q,ee,P)*_.get(O,L,U,V):$+=C.get(O,P,q,ee)*_.get(O,V,L,U)}}b.set($,T,I,P,V)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}var gje={kernelName:l1,backendName:"cpu",kernelFunc:fje};function xje(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:i,strides:l,pad:u,dataFormat:d,dimRoundingMode:c}=r;St([a,s],"conv2dBackpropInput");let h=A.computeStrides(s.shape),p=A.computeStrides(a.shape),m=z.convertConv2DDataFormat(d),f=z.computeConv2DInfo(i,s.shape,l,1,u,c,!1,m),g=new Wr(f.inShape,"float32"),x=g.values,y=n.data.get(a.dataId).values,b=n.data.get(s.dataId).values,[v,w,N]=h,{batchSize:S,filterHeight:C,filterWidth:_,inChannels:T,inHeight:E,inWidth:j,outChannels:I,outHeight:D,outWidth:F,strideHeight:P,strideWidth:V}=f;m=f.dataFormat;let $=C-1-f.padInfo.top,O=_-1-f.padInfo.left,L=m==="channelsLast",q=g.strides[0],U=L?g.strides[1]:g.strides[2],ee=L?g.strides[2]:1,M=L?1:g.strides[1],G=p[0],J=L?p[1]:p[2],ve=L?p[2]:1,Q=L?1:p[1];for(let se=0;se<S;++se)for(let _e=0;_e<T;++_e)for(let Le=0;Le<E;++Le){let Se=Le-$,ye=Math.max(0,Math.ceil(Se/P)),Fe=Math.min(D,(C+Se)/P);for(let Te=0;Te<j;++Te){let Oe=Te-O,He=Math.max(0,Math.ceil(Oe/V)),Ee=Math.min(F,(_+Oe)/V),Re=0;for(let at=ye;at<Fe;++at){let Y=at*P-Se;for(let ae=He;ae<Ee;++ae){let we=ae*V-Oe,Ce=G*se+J*at+ve*ae,Ne=v*(C-1-Y)+w*(_-1-we)+N*_e;for(let he=0;he<I;++he){let Ae=y[Ce+Q*he],gt=b[Ne+he];Re+=Ae*gt}}}let Ke=q*se+U*Le+ee*Te+M*_e;x[Ke]=Re}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}var yje={kernelName:ih,backendName:"cpu",kernelFunc:xje};function bje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u}=r;St([a,s],"conv3d");let d=z.computeConv3DInfo(a.shape,s.shape,i,u,l),{filterDepth:c,filterHeight:h,filterWidth:p,dilationDepth:m,dilationHeight:f,dilationWidth:g,padInfo:x}=d,y=x.front,b=x.left,v=x.top,w=new Wr(d.outShape,a.dtype),N=n.data.get(a.dataId).values,S=n.data.get(s.dataId).values,C=w.values,_=A.computeStrides(a.shape),T=A.computeStrides(s.shape);for(let E=0;E<d.batchSize;++E){let j=E*_[0],I=E*w.strides[0];for(let D=0;D<d.outDepth;++D){let F=I+D*w.strides[1],P=D*d.strideDepth-y;for(let V=0;V<c;++V){let $=P+V*m;if($<0||$>=d.inDepth)continue;let O=V*T[0],L=j+$*_[1];for(let q=0;q<d.outHeight;++q){let U=F+q*w.strides[2],ee=q*d.strideHeight-v;for(let M=0;M<h;++M){let G=ee+M*f;if(G<0||G>=d.inHeight)continue;let J=O+M*T[1],ve=L+G*_[2];for(let Q=0;Q<d.outWidth;++Q){let se=U+Q*d.outChannels,_e=Q*d.strideWidth-b;for(let Le=0;Le<p;++Le){let Se=_e+Le*g;if(Se<0||Se>=d.inWidth)continue;let ye=J+Le*T[2],Fe=ve+Se*d.inChannels,Te=ye;for(let Oe=0;Oe<d.inChannels;++Oe){let He=N[Fe+Oe];for(let Ee=0;Ee<d.outChannels;++Ee)C[se+Ee]+=He*S[Te+Ee];Te+=d.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var vje={kernelName:oh,backendName:"cpu",kernelFunc:bje};function wje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:l,filterShape:u}=r;St([a,s],"conv3dBackpropFilterV2");let d=A.computeStrides(a.shape),c=A.computeStrides(s.shape),h=z.computeConv3DInfo(a.shape,u,i,1,l),p=h.strideDepth,m=h.strideHeight,f=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new Wr(h.filterShape,"float32"),v=b.values,[w,N,S,C]=b.strides,_=n.data.get(s.dataId).values,[T,E,j,I]=c,D=n.data.get(a.dataId).values,[F,P,V,$]=d,O=h.padInfo.front,L=h.padInfo.left,q=h.padInfo.top;for(let U=0;U<g;++U){let ee=Math.max(0,Math.ceil((O-U)/p)),M=Math.min(h.outDepth,(h.inDepth+O-U)/p),G=U*w;for(let J=0;J<x;++J){let ve=Math.max(0,Math.ceil((q-J)/m)),Q=Math.min(h.outHeight,(h.inHeight+q-J)/m),se=J*N+G;for(let _e=0;_e<y;++_e){let Le=Math.max(0,Math.ceil((L-_e)/f)),Se=Math.min(h.outWidth,(h.inWidth+L-_e)/f),ye=_e*S+se;for(let Fe=0;Fe<h.inChannels;++Fe){let Te=Fe*C+ye;for(let Oe=0;Oe<h.outChannels;++Oe){let He=0;for(let Ee=0;Ee<h.batchSize;++Ee){let Re=Ee*F,Ke=Ee*T;for(let at=ee;at<M;++at){let Y=(U+at*p-O)*P+Re,ae=at*E+Ke;for(let we=ve;we<Q;++we){let Ce=(J+we*m-q)*V+Y,Ne=we*j+ae;for(let he=Le;he<Se;++he){let Ae=(_e+he*f-L)*$+Ce,gt=he*I+Ne;He+=D[Ae+Fe]*_[gt+Oe]}}}}v[Te+Oe]=He}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}var Nje={kernelName:Cf,backendName:"cpu",kernelFunc:wje};function kje(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:l,inputShape:u}=r;St([a],"conv3dBackpropInputV2");let d=A.computeStrides(a.shape),c=A.computeStrides(s.shape),h=z.computeConv3DInfo(u,s.shape,l,1,i),p=new Wr(h.inShape,"float32"),m=p.values,[f,g,x,y]=p.strides,b=n.data.get(a.dataId).values,[v,w,N,S]=d,C=n.data.get(s.dataId).values,[_,T,E,j]=c,{batchSize:I,filterDepth:D,filterHeight:F,filterWidth:P,inChannels:V,inDepth:$,inHeight:O,inWidth:L,outChannels:q,outDepth:U,outHeight:ee,outWidth:M,strideDepth:G,strideHeight:J,strideWidth:ve}=h,Q=D-1-h.padInfo.front,se=F-1-h.padInfo.top,_e=P-1-h.padInfo.left;for(let Le=0;Le<I;++Le)for(let Se=0;Se<V;++Se)for(let ye=0;ye<$;++ye){let Fe=ye-Q,Te=Math.max(0,Math.ceil(Fe/G)),Oe=Math.min(U,(D+Fe)/G);for(let He=0;He<O;++He){let Ee=He-se,Re=Math.max(0,Math.ceil(Ee/J)),Ke=Math.min(ee,(F+Ee)/J);for(let at=0;at<L;++at){let Y=at-_e,ae=Math.max(0,Math.ceil(Y/ve)),we=Math.min(M,(P+Y)/ve),Ce=0;for(let Ne=Te;Ne<Oe;++Ne){let he=Ne*G-Fe;for(let Ae=Re;Ae<Ke;++Ae){let gt=Ae*J-Ee;for(let ht=ae;ht<we;++ht){let Dt=ht*ve-Y,$t=v*Le+w*Ne+N*Ae+S*ht,qe=_*(D-1-he)+T*(F-1-gt)+E*(P-1-Dt)+j*Se;for(let it=0;it<q;++it){let Ct=b[$t+it],pt=C[qe+it];Ce+=Ct*pt}}}}m[f*Le+g*ye+x*He+y*at+Se]=Ce}}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}var Sje={kernelName:_f,backendName:"cpu",kernelFunc:kje},Cje=Zn(lh,e=>Math.cos(e)),_je={kernelName:lh,backendName:"cpu",kernelFunc:Cje},Ije=Zn(uh,e=>Math.cosh(e)),Tje={kernelName:uh,backendName:"cpu",kernelFunc:Ije};function Eje(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:i}=t,{cropSize:l,method:u,extrapolationValue:d}=r,[c,h,p,m]=a.shape,f=s.shape[0],[g,x]=l,y=nn([f,g,x,m],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(i.dataId).values,w=n.data.get(a.dataId).values,N=A.computeStrides(a.shape),S=A.computeStrides(y.shape);for(let C=0;C<f;C++){let _=C*4,T=b[_],E=b[_+1],j=b[_+2],I=b[_+3],D=v[C];if(D>=c)continue;let F=g>1?(j-T)*(h-1)/(g-1):0,P=x>1?(I-E)*(p-1)/(x-1):0;for(let V=0;V<g;V++){let $=g>1?T*(h-1)+V*F:.5*(T+j)*(h-1);if($<0||$>h-1){for(let O=0;O<x;O++)for(let L=0;L<m;L++){let q=L+O*S[2]+V*S[1]+C*S[0];y.values[q]=d}continue}if(u==="bilinear"){let O=Math.floor($),L=Math.ceil($),q=$-O;for(let U=0;U<x;U++){let ee=x>1?E*(p-1)+U*P:.5*(E+I)*(p-1);if(ee<0||ee>p-1){for(let ve=0;ve<m;ve++){let Q=ve+U*S[2]+V*S[1]+C*S[0];y.values[Q]=d}continue}let M=Math.floor(ee),G=Math.ceil(ee),J=ee-M;for(let ve=0;ve<m;ve++){let Q=ve+M*N[2]+O*N[1]+D*N[0],se=w[Q];Q=ve+G*N[2]+O*N[1]+D*N[0];let _e=w[Q];Q=ve+M*N[2]+L*N[1]+D*N[0];let Le=w[Q];Q=ve+G*N[2]+L*N[1]+D*N[0];let Se=w[Q],ye=se+(_e-se)*J,Fe=Le+(Se-Le)*J;Q=ve+U*S[2]+V*S[1]+C*S[0],y.values[Q]=ye+(Fe-ye)*q}}}else for(let O=0;O<x;++O){let L=x>1?E*(p-1)+O*P:.5*(E+I)*(p-1);if(L<0||L>p-1){for(let ee=0;ee<m;ee++){let M=ee+O*S[2]+V*S[1]+C*S[0];y.values[M]=d}continue}let q=Math.round(L),U=Math.round($);for(let ee=0;ee<m;ee++){let M=ee+q*N[2]+U*N[1]+D*N[0],G=ee+O*S[2]+V*S[1]+C*S[0];y.values[G]=w[M]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}var jje={kernelName:Tf,backendName:"cpu",kernelFunc:Eje};function Aje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r;St(a,"cumprod");let u=z.getAxesPermutation([s],a.shape.length),d=a;u!=null&&(d=ys({inputs:{x:a},backend:n,attrs:{perm:u}}));let c=z.getInnerMostAxes(1,a.shape.length)[0];if(c!==d.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${c}`);let h=ni(d.dtype,"int32"),p=A.makeOnesTypedArray(A.sizeFromShape(d.shape),h),m=n.data.get(d.dataId).values,f=d.shape[d.shape.length-1],g=l?(y,b)=>y+f-b-1:(y,b)=>y+b;for(let y=0;y<m.length;y+=f)for(let b=0;b<f;b++){let v=g(y,b);if(b===0)p[v]=i?1:m[v];else{let w=g(y,b-1);p[v]=i?m[w]*p[w]:m[v]*p[w]}}let x=n.makeTensorInfo(d.shape,h,p);if(u!=null){let y=z.getUndoAxesPermutation(u),b=ys({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(d),b}return x}var Rje={kernelName:If,backendName:"cpu",kernelFunc:Aje};function Dje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r;St(a,"cumsum");let u=z.getAxesPermutation([s],a.shape.length),d=a;u!=null&&(d=ys({inputs:{x:a},backend:n,attrs:{perm:u}}));let c=z.getInnerMostAxes(1,a.shape.length)[0];if(c!==d.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${c}`);let h=ni(d.dtype,"int32"),p=A.makeZerosTypedArray(A.sizeFromShape(d.shape),h),m=n.data.get(d.dataId).values,f=d.shape[d.shape.length-1],g=l?(y,b)=>y+f-b-1:(y,b)=>y+b;for(let y=0;y<m.length;y+=f)for(let b=0;b<f;b++){let v=g(y,b);if(b===0)p[v]=i?0:m[v];else{let w=g(y,b-1);p[v]=i?m[w]+p[w]:m[v]+p[w]}}let x=n.makeTensorInfo(d.shape,h,p);if(u!=null){let y=z.getUndoAxesPermutation(u),b=ys({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(d),b}return x}var Mje={kernelName:ch,backendName:"cpu",kernelFunc:Dje};function $je(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i,binaryOutput:l}=r;if(a.shape.length===1){let u=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,c=eA(u,d,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,c)}else if(a.shape.length===2){let u=n.bufferSync(a),d=n.bufferSync(s),c=H8(u,d,i,l);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var Fje={kernelName:Qy,backendName:"cpu",kernelFunc:$je};function Pje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:i}=r;A.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);let l=a.shape[0],u=a.shape[1],d=a.shape[2],c=a.shape[3],h=u*s,p=d*s,m=c/(s*s),f=n.data.get(a.dataId).values,g=new Float32Array(l*h*p*m),x=0;for(let y=0;y<l;++y)for(let b=0;b<h;++b){let v=Math.floor(b/s),w=b%s;for(let N=0;N<p;++N){let S=Math.floor(N/s),C=N%s,_=(w*s+C)*m;for(let T=0;T<m;++T){let E=T+_+c*(S+d*(v+u*y));g[x++]=f[E]}}}return n.makeTensorInfo([l,h,p,m],a.dtype,g)}var Oje={kernelName:Ef,backendName:"cpu",kernelFunc:Pje};function OH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u,dimRoundingMode:d}=r;St([a,s],"depthwiseConv2DNative");let c=A.computeStrides(a.shape),h=A.computeStrides(s.shape),p=u;p==null&&(p=[1,1]),A.assert(z.eitherStridesOrDilationsAreOne(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);let m=z.computeConv2DInfo(a.shape,s.shape,i,p,l,d,!0),{filterHeight:f,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=m,v=b.left,w=b.top,N=m.outChannels/m.inChannels,S=new Wr(m.outShape,a.dtype),C=n.data.get(a.dataId).values,_=n.data.get(s.dataId).values,T=S.values;for(let E=0;E<m.batchSize;++E){let j=E*c[0],I=E*S.strides[0];for(let D=0;D<m.outHeight;++D){let F=I+D*S.strides[1],P=D*m.strideHeight-w;for(let V=0;V<f;++V){let $=P+V*x;if($<0||$>=m.inHeight)continue;let O=V*h[0],L=j+$*c[1];for(let q=0;q<m.outWidth;++q){let U=F+q*S.strides[2],ee=q*m.strideWidth-v;for(let M=0;M<g;++M){let G=ee+M*y;if(G<0||G>=m.inWidth)continue;let J=O+M*h[1],ve=L+G*m.inChannels,Q=U,se=J;for(let _e=0;_e<m.inChannels;++_e){let Le=C[ve+_e];for(let Se=0;Se<N;++Se)T[Q+Se]+=Le*_[se+Se];Q+=N,se+=N}}}}}}return n.makeTensorInfo(S.shape,S.dtype,S.values)}var Lje={kernelName:dh,backendName:"cpu",kernelFunc:OH};function zje(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,dilations:l,pad:u,dimRoundingMode:d,filterShape:c}=r;St([a,s],"depthwiseConv2dNativeBackpropFilter");let h=z.computeConv2DInfo(a.shape,c,i,l,u,d,!0),{strideHeight:p,strideWidth:m,filterHeight:f,filterWidth:g}=h,x=new Wr(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=n.data.get(a.dataId).values,N=new Wr(a.shape,a.dtype,w),S=n.data.get(s.dataId).values,C=new Wr(s.shape,s.dtype,S);for(let _=0;_<f;++_){let T=Math.max(0,Math.ceil((b-_)/p)),E=Math.min(h.outHeight,(h.inHeight+b-_)/p);for(let j=0;j<g;++j){let I=Math.max(0,Math.ceil((y-j)/m)),D=Math.min(h.outWidth,(h.inWidth+y-j)/m);for(let F=0;F<h.outChannels;++F){let P=Math.trunc(F/v),V=F%v,$=0;for(let O=0;O<h.batchSize;++O)for(let L=T;L<E;++L){let q=_+L*p-b;for(let U=I;U<D;++U){let ee=j+U*m-y;$+=N.get(O,q,ee,P)*C.get(O,L,U,F)}}x.set($,_,j,P,V)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}var Bje={kernelName:u1,backendName:"cpu",kernelFunc:zje};function Wje(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:i,dilations:l,pad:u,dimRoundingMode:d,inputShape:c}=r;St([a,s],"depthwiseConv2DNativeBackpropInput");let h=A.computeStrides(a.shape),p=A.computeStrides(s.shape),m=z.computeConv2DInfo(c,s.shape,i,l,u,d,!0),f=new Wr(m.inShape,"float32"),g=f.values,[x,y,b]=f.strides,v=n.data.get(a.dataId).values,[w,N,S]=h,C=n.data.get(s.dataId).values,[_,T,E]=p,{batchSize:j,filterHeight:I,filterWidth:D,inChannels:F,inHeight:P,inWidth:V,outChannels:$,outHeight:O,outWidth:L,strideHeight:q,strideWidth:U}=m,ee=I-1-m.padInfo.top,M=D-1-m.padInfo.left,G=$/F;for(let J=0;J<j;++J)for(let ve=0;ve<F;++ve)for(let Q=0;Q<P;++Q){let se=Q-ee,_e=Math.max(0,Math.ceil(se/q)),Le=Math.min(O,(I+se)/q);for(let Se=0;Se<V;++Se){let ye=Se-M,Fe=Math.max(0,Math.ceil(ye/U)),Te=Math.min(L,(D+ye)/U),Oe=0;for(let He=_e;He<Le;++He){let Ee=He*q-se;for(let Re=Fe;Re<Te;++Re){let Ke=Re*U-ye,at=w*J+N*He+S*Re,Y=_*(I-1-Ee)+T*(D-1-Ke)+E*ve;for(let ae=0;ae<G;++ae){let we=ve*G+ae,Ce=v[at+we],Ne=C[Y+ae];Oe+=Ce*Ne}}}g[x*J+y*Q+b*Se+ve]=Oe}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}var Vje={kernelName:c1,backendName:"cpu",kernelFunc:Wje};function Uje(e){let{inputs:t,backend:n}=e,{x:r}=t,a=A.sizeFromShape(r.shape),s=n.data.get(r.dataId).values,i=nn([a,a],r.dtype),l=i.values;for(let d=0;d<s.length;d++)l[d*a+d]=s[d];let u=[...r.shape,...r.shape];return n.makeTensorInfo(u,i.dtype,i.values)}var Hje={kernelName:Jy,backendName:"cpu",kernelFunc:Uje},Gje={kernelName:hh,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a}=e,{strides:s,pad:i,dilations:l}=n,u=t,d=u.data.get(r.dataId).values,c=r.shape.length,h=u.data.get(a.dataId).values,p=a.shape.length,{batchSize:m,inHeight:f,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:N,filterHeight:S,filterWidth:C,dilationHeight:_,dilationWidth:T,outShape:E}=z.computeDilation2DInfo(r.shape,a.shape,s,i,"NHWC",l),j=A.sizeFromShape(E),I=E.length,D=A.getArrayFromDType(r.dtype,j);for(let F=0;F<m;++F)for(let P=0;P<y;++P){let V=P*w-v.top;for(let $=0;$<b;++$){let O=$*N-v.left;for(let L=0;L<x;++L){let q=Number.MIN_SAFE_INTEGER;for(let ee=0;ee<S;++ee){let M=V+ee*_;if(M>=0&&M<f)for(let G=0;G<C;++G){let J=O+G*T;if(J>=0&&J<g){let ve=A.locToIndex([F,M,J,L],c,A.computeStrides(r.shape)),Q=A.locToIndex([ee,G,L],p,A.computeStrides(a.shape)),se=d[ve]+h[Q];se>q&&(q=se)}}}let U=A.locToIndex([F,P,$,L],I,A.computeStrides(E));D[U]=q}}}return{dataId:u.write(A.toTypedArray(D,r.dtype),E,r.dtype),shape:E,dtype:r.dtype}}},qje={kernelName:zm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:i,pad:l,dilations:u}=n,d=t,c=A.toNestedArray(r.shape,d.data.get(r.dataId).values),h=A.toNestedArray(a.shape,d.data.get(a.dataId).values),{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:N,filterWidth:S,dilationHeight:C,dilationWidth:_,outShape:T}=z.computeDilation2DInfo(r.shape,a.shape,i,l,"NHWC",u);A.assert(s.rank===T.length,()=>`Error in ${zm}, dy must have the same rank as output ${T.length}, but got ${s.rank}`);let E=A.toNestedArray(T,d.data.get(s.dataId).values),j=A.makeZerosNestedTypedArray(a.shape,a.dtype);for(let I=0;I<p;++I)for(let D=0;D<x;++D){let F=D*v-b.top;for(let P=0;P<y;++P){let V=P*w-b.left;for(let $=0;$<g;++$){let O=Number.MIN_SAFE_INTEGER,L=0,q=0;for(let U=0;U<N;++U){let ee=F+U*C;if(ee>=0&&ee<m)for(let M=0;M<S;++M){let G=V+M*_;if(G>=0&&G<f){let J=c[I][ee][G][$]+h[U][M][$];J>O&&(O=J,L=U,q=M)}}}j[L][q][$]+=E[I][D][P][$]}}}return{dataId:d.write(A.toTypedArray(j,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Kje={kernelName:Lm,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:i,pad:l,dilations:u}=n,d=t,c=A.toNestedArray(r.shape,d.data.get(r.dataId).values),h=A.toNestedArray(a.shape,d.data.get(a.dataId).values),{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:N,filterWidth:S,dilationHeight:C,dilationWidth:_,outShape:T}=z.computeDilation2DInfo(r.shape,a.shape,i,l,"NHWC",u);A.assert(s.rank===T.length,()=>`Error in ${Lm}, dy must have the same rank as output ${T.length}, but got ${s.rank}`);let E=A.toNestedArray(T,d.data.get(s.dataId).values),j=A.makeZerosNestedTypedArray(r.shape,r.dtype);for(let I=0;I<p;++I)for(let D=0;D<x;++D){let F=D*v-b.top;for(let P=0;P<y;++P){let V=P*w-b.left;for(let $=0;$<g;++$){let O=Number.MIN_SAFE_INTEGER,L=F<0?0:F,q=V<0?0:V;for(let U=0;U<N;++U){let ee=F+U*C;if(ee>=0&&ee<m)for(let M=0;M<S;++M){let G=V+M*_;if(G>=0&&G<f){let J=c[I][ee][G][$]+h[U][M][$];J>O&&(O=J,L=ee,q=G)}}}j[I][L][q][$]+=E[I][D][P][$]}}}return{dataId:d.write(A.toTypedArray(j,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function Yje(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:s,options:i}=r,{contextOptions:l,imageOptions:u}=i||{},d=(u==null?void 0:u.alpha)||1,c=(l==null?void 0:l.contextType)||"2d";if(c!=="2d")throw new Error(`Context type ${l.contextType} is not supported by the CPU backend.`);let h=s.getContext(c,(l==null?void 0:l.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${c} type.`);let[p,m]=a.shape.slice(0,2),f=a.shape.length===2?1:a.shape[2],g=n.data.get(a.dataId).values,x=a.dtype==="float32"?255:1,y=new Uint8ClampedArray(m*p*4);for(let v=0;v<p*m;++v){let w=[0,0,0,255*d];for(let S=0;S<f;S++){let C=g[v*f+S];if(a.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(a.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);f===1?(w[0]=C*x,w[1]=C*x,w[2]=C*x):w[S]=C*x}let N=v*4;y[N+0]=Math.round(w[0]),y[N+1]=Math.round(w[1]),y[N+2]=Math.round(w[2]),y[N+3]=Math.round(w[3])}s.width=m,s.height=p;let b=new ImageData(y,m,p);return h.putImageData(b,0,0),a}var Xje={kernelName:d1,backendName:"cpu",kernelFunc:Yje};function Vb(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;St(a,"sum");let l;a.dtype==="bool"?l=Yu({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):l=Go({inputs:{x:a},backend:n});let u=l.shape.length,d=A.parseAxisParam(s,l.shape),c=z.getAxesPermutation(d,u),h=d,p=l;c!=null&&(p=ys({inputs:{x:l},backend:n,attrs:{perm:c}}),h=z.getInnerMostAxes(h.length,u)),z.assertAxesAreInnerMostDims("sum",h,p.shape.length);let[m,f]=z.computeOutAndReduceShapes(p.shape,h),g=z.upcastType(p.dtype,"int32"),x=y0(n,m,g),y=A.sizeFromShape(f),b=n.data.get(x.dataId).values,v=n.data.get(p.dataId).values;for(let w=0;w<b.length;++w){let N=w*y,S=0;for(let C=0;C<y;++C)S+=v[N+C];b[w]=S}if(i){let w=z.expandShapeToKeepDim(x.shape,d),N=x;x=mr({inputs:{x},backend:n,attrs:{shape:w}}),n.disposeIntermediateTensorInfo(N)}return n.disposeIntermediateTensorInfo(l),c!=null&&n.disposeIntermediateTensorInfo(p),x}var Zje={kernelName:sp,backendName:"cpu",kernelFunc:Vb};function Qje(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:i,summedDims:l,idDims:u}=z.decodeEinsumEquation(a,s.length);z.checkEinsumDimSizes(i.length,u,s);let{path:d,steps:c}=z.getEinsumComputePath(l,u),h=c.length,p=null,m=i.length,f=[];for(let g=0;g<h;++g){for(let x of c[g]){let{permutationIndices:y,expandDims:b}=z.getEinsumPermutation(m,u[x]),v;z.isIdentityPermutation(y)?v=s[x]:(v=ys({inputs:{x:s[x]},backend:n,attrs:{perm:y}}),f.push(v));let w=v.shape.slice();for(let N=0;N<b.length;++N)w.splice(b[N],0,1);A.arraysEqual(v.shape,w)||(v=mr({inputs:{x:v},backend:n,attrs:{shape:w}}),f.push(v)),p===null?p=v:(p=CN({inputs:{a:v,b:p},backend:n}),f.push(p))}g<h-1&&(d[g]>=0&&(p=Vb({inputs:{x:p},backend:n,attrs:{axis:d[g]-(i.length-m),keepDims:!1}}),f.push(p)),m--)}for(let g of f)g!==p&&n.disposeIntermediateTensorInfo(g);return p}var Jje={kernelName:h1,backendName:"cpu",kernelFunc:Qje};function eAe(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t;St([r,a],"eluGrad");let s=new Float32Array(A.sizeFromShape(a.shape)),i=n.data.get(a.dataId).values,l=n.data.get(r.dataId).values;for(let u=0;u<i.length;++u){let d=i[u];d>=0?s[u]=l[u]:s[u]=l[u]*(d+1)}return n.makeTensorInfo(a.shape,"float32",s)}var tAe={kernelName:jf,backendName:"cpu",kernelFunc:eAe},nAe=z.ERF_P,rAe=z.ERF_A1,aAe=z.ERF_A2,sAe=z.ERF_A3,iAe=z.ERF_A4,oAe=z.ERF_A5,lAe=Zn(fh,e=>{let t=Math.sign(e),n=Math.abs(e),r=1/(1+nAe*n);return t*(1-((((oAe*r+iAe)*r+sAe)*r+aAe)*r+rAe)*r*Math.exp(-n*n))}),uAe={kernelName:fh,backendName:"cpu",kernelFunc:lAe};function w0(e){let{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:s}=r,i=a.shape.length,l=a.shape.slice(),u=s;return s<0&&(A.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+s+1),l.splice(u,0,1),mr({inputs:{x:a},backend:n,attrs:{shape:l}})}var cAe={kernelName:Rf,backendName:"cpu",kernelFunc:w0},dAe=Or((e,t)=>e/t),hA=ra(ph,dAe),RC={kernelName:ph,backendName:"cpu",kernelFunc:hA};function LH(e,t,n){let r=e.shape,a=r[0],s=r[1],i=n.data.get(e.dataId),l=i.complexTensorInfos.real,u=i.complexTensorInfos.imag,d=[a,s],c=A.sizeFromShape(d),h=A.getTypedArrayFromDType("float32",c),p=A.getTypedArrayFromDType("float32",c);for(let x=0;x<a;x++){let y=zd({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,s]}}),b=zd({inputs:{x:u},backend:n,attrs:{begin:[x,0],size:[1,s]}}),v=Es({inputs:{real:y,imag:b},backend:n}),{real:w,imag:N}=hAe(v,t,n),S=z.mergeRealAndImagArrays(w,N);for(let C=0;C<s;C++){let _=z.getComplexWithIndex(S,C);h[x*s+C]=_.real,p[x*s+C]=_.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v)}let m=n.makeTensorInfo(d,"float32",h),f=n.makeTensorInfo(d,"float32",p),g=Es({inputs:{real:m,imag:f},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}function hAe(e,t,n){let r=A.sizeFromShape(e.shape),a=n.data.get(e.dataId),s=n.data.get(a.complexTensorInfos.real.dataId).values,i=n.data.get(a.complexTensorInfos.imag.dataId).values;if(pAe(r)){let l=DC(s,i,r,t,n),u=[e.shape[0],e.shape[1]];if(t){let d=n.makeTensorInfo(u,"float32",l.real),c=n.makeTensorInfo(u,"float32",l.imag),h=n.makeTensorInfo([],"float32",A.createScalarValue(r,"float32")),p=Go({inputs:{x:h},backend:n}),m=RC.kernelFunc({inputs:{a:d,b:h},backend:n}),f=RC.kernelFunc({inputs:{a:c,b:p},backend:n}),g=n.data.get(m.dataId).values,x=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),{real:g,imag:x}}return l}else{let l=z.mergeRealAndImagArrays(s,i),u=mAe(l,r,t);return z.splitRealAndImagArrays(u)}}function pAe(e){return(e&e-1)===0}function DC(e,t,n,r,a){if(n===1)return{real:e,imag:t};let s=z.mergeRealAndImagArrays(e,t),i=n/2,l=z.complexWithEvenIndex(s),u=l.real,d=l.imag,c=[u.length],h=a.makeTensorInfo(c,"float32",u),p=a.makeTensorInfo(c,"float32",d),m=Es({inputs:{real:h,imag:p},backend:a}),f=z.complexWithOddIndex(s),g=f.real,x=f.imag,y=[g.length],b=a.makeTensorInfo(y,"float32",g),v=a.makeTensorInfo(y,"float32",x),w=Es({inputs:{real:b,imag:v},backend:a}),N=DC(u,d,i,r,a),S=N.real,C=N.imag,_=[S.length],T=a.makeTensorInfo(_,"float32",S),E=a.makeTensorInfo(_,"float32",C),j=Es({inputs:{real:T,imag:E},backend:a}),I=DC(g,x,i,r,a),D=I.real,F=I.imag,P=[D.length],V=a.makeTensorInfo(P,"float32",D),$=a.makeTensorInfo(P,"float32",F),O=Es({inputs:{real:V,imag:$},backend:a}),L=z.exponents(n,r),q=[L.real.length],U=a.makeTensorInfo(q,"float32",L.real),ee=a.makeTensorInfo(q,"float32",L.imag),M=Es({inputs:{real:U,imag:ee},backend:a}),G=CN({inputs:{a:M,b:O},backend:a}),J=Qm({inputs:{a:j,b:G},backend:a}),ve=uA({inputs:{a:j,b:G},backend:a}),Q=Ld({inputs:{input:J},backend:a}),se=Ld({inputs:{input:ve},backend:a}),_e=Jm({inputs:{input:J},backend:a}),Le=Jm({inputs:{input:ve},backend:a}),Se=ef({inputs:[Q,se],backend:a,attrs:{axis:0}}),ye=ef({inputs:[_e,Le],backend:a,attrs:{axis:0}}),Fe=a.data.get(Se.dataId).values,Te=a.data.get(ye.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo($),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(ee),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(J),a.disposeIntermediateTensorInfo(ve),a.disposeIntermediateTensorInfo(Q),a.disposeIntermediateTensorInfo(_e),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(Le),a.disposeIntermediateTensorInfo(Se),a.disposeIntermediateTensorInfo(ye),{real:Fe,imag:Te}}function mAe(e,t,n){let r=new Float32Array(t*2);for(let a=0;a<t;a++){let s=0,i=0;for(let l=0;l<t;l++){let u=z.exponent(a*l,t,n),d=z.getComplexWithIndex(e,l);s+=d.real*u.real-d.imag*u.imag,i+=d.real*u.imag+d.imag*u.real}n&&(s/=t,i/=t),z.assignToTypedArray(r,s,i,a)}return r}function fAe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=A.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=a/s,l=mr({inputs:{x:r},backend:n,attrs:{shape:[i,s]}}),u=LH(l,!1,n),d=mr({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),d}var gAe={kernelName:p1,backendName:"cpu",kernelFunc:fAe};function pA(e){let{backend:t,attrs:n}=e,{shape:r,value:a,dtype:s}=n,i=s||A.inferDtype(a),l=A.getArrayFromDType(i,A.sizeFromShape(r));return yAe(l,a),t.makeTensorInfo(r,i,l)}var xAe={kernelName:eb,backendName:"cpu",kernelFunc:pA};function yAe(e,t,n){e.fill(t)}var bAe={kernelName:Df,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,a=n,s=A.getTypedArrayFromDType(r.dtype,A.sizeFromShape(r.shape)),[i,l,u,d]=r.shape,c=a.data.get(r.dataId).values;for(let h=0;h<i;h++){let p=h*u*l*d;for(let m=0;m<l;m++){let f=m*(u*d);for(let g=0;g<u;g++){let x=g*d;for(let y=0;y<d;y++){let b=Math.round(u-g-1),v=p+f+x+y,w=c[v];if(b>=0&&b<u){let N=b*d,S=p+f+N+y;w=c[S]}s[v]=w}}}}return{dataId:a.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function vAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=PH({inputs:{x:a,filter:s},backend:n,attrs:{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p}});if(i){let x=g;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){let y=mr({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});g=Qm({inputs:{a:g,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else g=Qm({inputs:{a:g,b:i},backend:n});n.disposeIntermediateTensorInfo(x)}if(m){let x=g;if(c==="NCHW"&&m==="prelu"&&l.shape.length===1&&l.shape[0]!==1){let y=mr({inputs:{x:l},backend:n,attrs:{shape:[l.shape[0],1,1]}});g=v0(n,g,m,y,f),n.disposeIntermediateTensorInfo(y)}else g=v0(n,g,m,l,f);n.disposeIntermediateTensorInfo(x)}return g}var wAe={kernelName:Id,backendName:"cpu",kernelFunc:vAe};function NAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=OH({inputs:{x:a,filter:s},backend:n,attrs:{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p}});if(i){let x=g;g=Qm({inputs:{a:g,b:i},backend:n}),n.disposeIntermediateTensorInfo(x)}if(m){let x=g;g=v0(n,g,m,l,f),n.disposeIntermediateTensorInfo(x)}return g}var kAe={kernelName:Td,backendName:"cpu",kernelFunc:NAe};function SAe(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=A.sizeFromShape(r.shape),i=a.shape,l=i[i.length-1],[u,d,c,h]=z.prepareAndValidate(r,a);if(d===0)return n.makeTensorInfo(u,r.dtype,[]);let p=n.data.get(a.dataId).values,m=n.bufferSync(r),f=tH(p,m,r.dtype,d,l,c,h,r.shape,s);return n.makeTensorInfo(u,r.dtype,f.values)}var CAe={kernelName:$f,backendName:"cpu",kernelFunc:SAe};function _Ae(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:i,batchDims:l}=r;St([a,s],"gatherV2");let u=A.parseAxisParam(i,a.shape)[0],d=n.data.get(s.dataId).values,c=a.shape[u];for(let w=0;w<d.length;++w){let N=d[w];A.assert(N<=c-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${c-1}]`)}let h=l;l==null&&(h=0);let p=A.sizeFromShape(s.shape),m=z.segment_util.collectGatherOpShapeInfo(a,s,u,h),f=mr({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=mr({inputs:{x:s},backend:n,attrs:{shape:[m.batchSize,p/m.batchSize]}}),x=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],y=n.bufferSync(g),b=n.bufferSync(f),v=nH(b,y,x);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,v.dtype,v.values)}var IAe={kernelName:Mf,backendName:"cpu",kernelFunc:_Ae};function TAe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=A.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],i=a/s,l=mr({inputs:{x:r},backend:n,attrs:{shape:[i,s]}}),u=LH(l,!0,n),d=mr({inputs:{x:u},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(u),d}var EAe={kernelName:m1,backendName:"cpu",kernelFunc:TAe},jAe=Zn(kh,e=>Number.isFinite(e)?1:0,"bool"),AAe={kernelName:kh,backendName:"cpu",kernelFunc:jAe},RAe=Zn(Sh,e=>Math.abs(e)===1/0?1:0,"bool"),DAe={kernelName:Sh,backendName:"cpu",kernelFunc:RAe},MAe=Zn(Ch,e=>Number.isNaN(e)?1:0,"bool"),$Ae={kernelName:Ch,backendName:"cpu",kernelFunc:MAe};function FAe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,i=oH(r,a,s);return t.makeTensorInfo([i.length],"float32",i)}var PAe={kernelName:Lf,backendName:"cpu",kernelFunc:FAe},OAe=Zn(Th,e=>Math.log1p(e)),LAe={kernelName:Th,backendName:"cpu",kernelFunc:OAe},zAe=Or((e,t)=>e&&t),BAe=ra(zf,zAe,null,"bool"),WAe={kernelName:zf,backendName:"cpu",kernelFunc:BAe},VAe=Zn(Bf,e=>e?0:1,"bool"),UAe={kernelName:Bf,backendName:"cpu",kernelFunc:VAe},HAe=Or((e,t)=>e||t),GAe=ra(Wf,HAe,null,"bool"),qAe={kernelName:Wf,backendName:"cpu",kernelFunc:GAe};function KAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:l,beta:u}=r;St(a,"LRN");let d=a.shape[3],c=d-1,h=n.data.get(a.dataId).values,p=A.sizeFromShape(a.shape),m=new Float32Array(p);function f(g){let x=g%d,y=g-x+Math.max(0,x-s),b=g-x+Math.min(x+s,c),v=0;for(;y<=b;y++){let w=h[y];v+=w*w}return v}for(let g=0;g<p;g++){let x=f(g),y=h[g]*Math.pow(i+l*x,-u);m[g]=y}return n.makeTensorInfo(a.shape,a.dtype,m)}var YAe={kernelName:Eh,backendName:"cpu",kernelFunc:KAe};function XAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:l,bias:u,alpha:d,beta:c}=r;St(i,"LRNGrad");let h=A.sizeFromShape(i.shape),p=i.shape[3],m=n.data.get(i.dataId).values,f=n.data.get(a.dataId).values,g=n.data.get(s.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){let v=b%p,w=b-v+Math.max(0,v-l),N=b-v+Math.min(p,v+l+1),S=0;for(let C=w;C<N;C++)S+=Math.pow(f[C],2);S=d*S+u;for(let C=w;C<N;C++){let _=-2*d*c*f[C]*g[b]/S;b===C&&(_+=Math.pow(S,-c)),_*=m[b],x[C]+=_}}return n.makeTensorInfo(i.shape,a.dtype,x)}var ZAe={kernelName:Vf,backendName:"cpu",kernelFunc:XAe};function zH(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:i}=r,l=n,u=a.shape,d=u.length,c=A.parseAxisParam(s,u),h=c,p=z.getAxesPermutation(h,d),m=l.data.get(a.dataId).values;if(p!=null){let w=new Array(d);for(let N=0;N<w.length;N++)w[N]=u[p[N]];m=rA(m,u,a.dtype,p,w),h=z.getInnerMostAxes(h.length,d),u=w}St(a,"max"),z.assertAxesAreInnerMostDims("max",h,d);let[f,g]=z.computeOutAndReduceShapes(u,h),x=A.sizeFromShape(g),y=uH(m,x,f,a.dtype),b=l.write(y,f,a.dtype),v=f;return i&&(v=z.expandShapeToKeepDim(f,c)),{dataId:b,shape:v,dtype:a.dtype}}var QAe={kernelName:jh,backendName:"cpu",kernelFunc:zH};function JAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;St(a,"maxPool");let{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=r,d=1;A.assert(z.eitherStridesOrDilationsAreOne(i,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let c=z.computePool2DInfo(a.shape,s,i,d,l,u),h;if(c.filterWidth===1&&c.filterHeight===1&&A.arraysEqual(c.inShape,c.outShape))h=Go({inputs:{x:a},backend:n});else{let p=n.data.get(a.dataId).values,m=A.computeStrides(a.shape),f=dA(p,a.shape,a.dtype,m,c,"max");h=n.makeTensorInfo(c.outShape,a.dtype,f.values)}return h}var eRe={kernelName:Rh,backendName:"cpu",kernelFunc:JAe};function tRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u,dataFormat:d}=r;St(a,"maxPool3d");let c=z.computePool3DInfo(a.shape,s,i,1,l,u,d),h=n.data.get(a.dataId).values,p=FH(h,a.shape,a.dtype,A.computeStrides(a.shape),c,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}var nRe={kernelName:Uf,backendName:"cpu",kernelFunc:tRe};function rRe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=r;St([a,s],"maxPool3DGrad");let c=z.computePool3DInfo(s.shape,i,l,1,u,d),h=n.bufferSync(s),p=HEe(h,c),m=c.strideDepth,f=c.strideHeight,g=c.strideWidth,x=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,v=c.effectiveFilterDepth,w=c.effectiveFilterHeight,N=c.effectiveFilterWidth,S=v-1-c.padInfo.front,C=N-1-c.padInfo.left,_=w-1-c.padInfo.top,T=nn(s.shape,"float32"),E=n.bufferSync(a);for(let j=0;j<c.batchSize;++j)for(let I=0;I<c.inChannels;++I)for(let D=0;D<c.inDepth;++D)for(let F=0;F<c.inHeight;++F)for(let P=0;P<c.inWidth;++P){let V=D-S,$=F-_,O=P-C,L=0;for(let q=0;q<v;q+=x){let U=(V+q)/m;if(!(U<0||U>=c.outDepth||Math.floor(U)!==U))for(let ee=0;ee<w;ee+=y){let M=($+ee)/f;if(!(M<0||M>=c.outHeight||Math.floor(M)!==M))for(let G=0;G<N;G+=b){let J=(O+G)/g;if(J<0||J>=c.outWidth||Math.floor(J)!==J)continue;let ve=v*w*N-1-p.get(j,U,M,J,I),Q=q*w*N+ee*N+G,se=ve===Q?1:0;if(se===0)continue;let _e=E.get(j,U,M,J,I);L+=_e*se}}}T.set(L,j,D,F,P,I)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}var aRe={kernelName:nb,backendName:"cpu",kernelFunc:rRe};function sRe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:i}=t,l=s;St([s,i],"maxPoolGrad");let{filterSize:u,strides:d,pad:c,dimRoundingMode:h}=r,p=z.computePool2DInfo(l.shape,u,d,1,c,h),m=n.data.get(l.dataId).values,f=nn(p.outShape,l.dtype,$H(m,l.shape,l.dtype,p).values),g=p.strideHeight,x=p.strideWidth,y=p.dilationHeight,b=p.dilationWidth,v=p.effectiveFilterHeight,w=p.effectiveFilterWidth,N=w-1-p.padInfo.left,S=v-1-p.padInfo.top,C=nn(l.shape,"float32"),_=n.data.get(a.dataId).values,T=nn(a.shape,"float32",_);for(let E=0;E<p.batchSize;++E)for(let j=0;j<p.inChannels;++j)for(let I=0;I<p.inHeight;++I)for(let D=0;D<p.inWidth;++D){let F=I-S,P=D-N,V=0;for(let $=0;$<v;$+=y){let O=(F+$)/g;if(!(O<0||O>=p.outHeight||Math.floor(O)!==O))for(let L=0;L<w;L+=b){let q=(P+L)/x;if(q<0||q>=p.outWidth||Math.floor(q)!==q)continue;let U=v*w-1-f.get(E,O,q,j),ee=$*w+L,M=U===ee?1:0;if(M===0)continue;let G=T.get(E,O,q,j);V+=G*M}}C.set(V,E,I,D,j)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}var iRe={kernelName:tb,backendName:"cpu",kernelFunc:sRe};function oRe(e,t,n,r,a){let s=A.computeStrides(t),i=dA(e,t,n,s,a,"max"),l=$H(e,t,n,a,!0,r);return[i.values,l.values]}var lRe={kernelName:rb,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:i,includeBatchInIndex:l}=t,u=n;St(r,"MaxPoolWithArgmax");let d=u.data.get(r.dataId).values,c=z.computePool2DInfo(r.shape,a,s,[1,1],i),[h,p]=oRe(d,r.shape,r.dtype,l,c),m=u.write(h,c.outShape,r.dtype),f=u.write(p,c.outShape,r.dtype);return[{dataId:m,shape:c.outShape,dtype:r.dtype},{dataId:f,shape:c.outShape,dtype:"int32"}]}};function uRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,l=A.parseAxisParam(s,a.shape),u=z.computeOutAndReduceShapes(a.shape,l)[1],d=A.sizeFromShape(u),c=[],h=n.makeTensorInfo([],"float32",new Float32Array([d]));c.push(h);let p=Yu({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(p);let m=hA({inputs:{a:p,b:h},backend:n});c.push(m);let f=Vb({inputs:{x:m},backend:n,attrs:{axis:s,keepDims:i}});return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var cRe={kernelName:Dh,backendName:"cpu",kernelFunc:uRe};function dRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;St(a,"min");let l=A.parseAxisParam(s,a.shape),u=l,d=z.getAxesPermutation(u,a.shape.length),c=a;d!=null&&(c=ys({inputs:{x:a},backend:n,attrs:{perm:d}}),u=z.getInnerMostAxes(u.length,a.shape.length)),z.assertAxesAreInnerMostDims("min",u,c.shape.length);let[h,p]=z.computeOutAndReduceShapes(c.shape,u),m=A.sizeFromShape(p),f=A.makeZerosTypedArray(A.sizeFromShape(h),c.dtype),g=n.data.get(c.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let N=g[b+w];(Number.isNaN(N)||N<v)&&(v=N)}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(c);let x=n.makeTensorInfo(h,c.dtype,f);if(i){let y=z.expandShapeToKeepDim(h,l),b=mr({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var hRe={kernelName:Mh,backendName:"cpu",kernelFunc:dRe};function pRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,mode:i}=r;St(a,"mirrorPad");let l=s.map((b,v)=>b[0]+a.shape[v]+b[1]),u=s.map(b=>b[0]),d=s.map((b,v)=>b[0]+a.shape[v]),c=i==="reflect"?0:1,h=n.data.get(a.dataId).values,p=a.shape.length,m=A.computeStrides(a.shape),f=A.sizeFromShape(l),g=l.length,x=A.computeStrides(l),y=A.getTypedArrayFromDType(a.dtype,f);for(let b=0;b<f;b++){let v=A.indexToLoc(b,g,x);for(let N=0;N<g;N++)v[N]<u[N]?v[N]=u[N]*2-v[N]-c:v[N]>=d[N]&&(v[N]=(d[N]-1)*2-v[N]+c);v=v.map((N,S)=>N-u[S]);let w=A.locToIndex(v,p,m);y[b]=h[w]}return{dataId:n.write(y,l,a.dtype),shape:l,dtype:a.dtype}}var mRe={kernelName:Fh,backendName:"cpu",kernelFunc:pRe},fRe=Or((e,t)=>{let n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),gRe=ra(Ph,fRe),xRe={kernelName:Ph,backendName:"cpu",kernelFunc:gRe},yRe=rc(r1());function BH(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,i=a.shape.length,l=s;if(l===-1&&(l=i-1),l!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${l}`);let u=A.parseAxisParam([l],a.shape),d=zH({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),c=z.expandShapeToKeepDim(d.shape,u),h=mr({inputs:{x:d},backend:n,attrs:{shape:c}}),p=uA({inputs:{a,b:h},backend:n}),m=Z8({inputs:{x:p},backend:n}),f=Vb({inputs:{x:m},backend:n,attrs:{axis:u,keepDims:!1}}),g=mr({inputs:{x:f},backend:n,attrs:{shape:c}}),x=hA({inputs:{a:m,b:g},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}var bRe={kernelName:ip,backendName:"cpu",kernelFunc:BH};function vRe(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:l}=r;St(a,"multinomial");let u=l?a:BH({inputs:{logits:a},backend:n,attrs:{dim:-1}}),d=u.shape[0],c=u.shape[1],h=n.data.get(u.dataId).values,p=[d,s],m=A.makeZerosTypedArray(A.sizeFromShape(p),"int32");for(let f=0;f<d;++f){let g=f*c,x=new Float32Array(c-1);x[0]=h[g];for(let v=1;v<x.length;++v)x[v]=x[v-1]+h[g+v];let y=yRe.alea(i.toString()),b=f*s;for(let v=0;v<s;++v){let w=y();m[b+v]=x.length;for(let N=0;N<x.length;N++)if(w<x[N]){m[b+v]=N;break}}}return l||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",m)}var wRe={kernelName:Hf,backendName:"cpu",kernelFunc:vRe},NRe=Qo.nonMaxSuppressionV3Impl;function kRe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u}=r;St(a,"NonMaxSuppression");let d=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,{selectedIndices:h}=NRe(d,c,i,l,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}var SRe={kernelName:Kf,backendName:"cpu",kernelFunc:kRe},CRe=Qo.nonMaxSuppressionV4Impl;function _Re(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:d}=r;St(a,"NonMaxSuppressionPadded");let c=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:p,validOutputs:m}=CRe(c,h,i,l,u,d);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}var IRe={kernelName:Yf,backendName:"cpu",kernelFunc:_Re},TRe=Qo.nonMaxSuppressionV5Impl;function ERe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,softNmsSigma:d}=r;St(a,"NonMaxSuppressionWithScore");let c=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,p=i,m=l,f=u,g=d,{selectedIndices:x,selectedScores:y}=TRe(c,h,p,m,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var jRe={kernelName:Xf,backendName:"cpu",kernelFunc:ERe};function ARe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:l,offValue:u}=r;St(a,"oneHot");let d=A.sizeFromShape(a.shape),c=new Float32Array(d*i);c.fill(u);let h=n.data.get(a.dataId).values;for(let p=0;p<d;++p)h[p]>=0&&h[p]<i&&(c[p*i+h[p]]=l);return n.makeTensorInfo([...a.shape,i],s,c)}var RRe={kernelName:Lh,backendName:"cpu",kernelFunc:ARe};function N0(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let a=Ld({inputs:{input:r},backend:n}),s=N0({inputs:{x:a},backend:n}),i=Jm({inputs:{input:r},backend:n}),l=N0({inputs:{x:i},backend:n}),u=Es({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}else return pA({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var DRe={kernelName:fg,backendName:"cpu",kernelFunc:N0};function WH(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let a=Ld({inputs:{input:r},backend:n}),s=WH({inputs:{x:a},backend:n}),i=Jm({inputs:{input:r},backend:n}),l=N0({inputs:{x:i},backend:n}),u=Es({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}else return pA({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var MRe={kernelName:Zf,backendName:"cpu",kernelFunc:WH};function VH(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return w0({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{A.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),A.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],u=t.map(c=>{let h=w0({inputs:{input:c},backend:n,attrs:{dim:a}});return l.push(h),h}),d=ef({inputs:u,backend:n,attrs:{axis:a}});return l.forEach(c=>n.disposeIntermediateTensorInfo(c)),d}var $Re={kernelName:Qf,backendName:"cpu",kernelFunc:VH};function FRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:i}=r;St(a,"pad");let l=s.map((y,b)=>y[0]+a.shape[b]+y[1]),u=s.map(y=>y[0]),d=n.data.get(a.dataId).values,c=A.sizeFromShape(a.shape),h=a.shape.length,p=A.computeStrides(a.shape),m=A.sizeFromShape(l),f=l.length,g=A.computeStrides(l),x=A.getTypedArrayFromDType(a.dtype,m);i!==0&&x.fill(i);for(let y=0;y<c;y++){let b=A.indexToLoc(y,h,p).map((w,N)=>w+u[N]),v=A.locToIndex(b,f,g);x[v]=d[y]}return{dataId:n.write(x,l,a.dtype),shape:l,dtype:a.dtype}}var UH={kernelName:zh,backendName:"cpu",kernelFunc:FRe},PRe=Or((e,t)=>Math.pow(e,t)),ORe=ra(Bh,PRe),LRe={kernelName:Bh,backendName:"cpu",kernelFunc:ORe};function zRe(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:i}=t,{outputRaggedRank:l}=r,u=a.map(y=>n.data.get(y.dataId).values),d=a.map(y=>y.shape),c=n.data.get(s.dataId).values,h=n.data.get(i.dataId).values,[p,m,f]=fH(u,d,c,s.shape,s.dtype,h,i.shape),g=p.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,s.dtype,m);return g.concat([x])}var BRe={kernelName:g1,backendName:"cpu",kernelFunc:zRe};function WRe(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,i=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,[d,c]=gH(i,r.shape,r.dtype,l,a.shape,u,s.shape),h=n.makeTensorInfo([d.length],"int32",d),p=n.makeTensorInfo([c.length],r.dtype,c);return[h,p]}var VRe={kernelName:x1,backendName:"cpu",kernelFunc:WRe};function URe(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:i,rowPartitionTensors:l}=t,{rowPartitionTypes:u}=r,d=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,h=n.data.get(i.dataId).values,p=l.map(x=>n.data.get(x.dataId).values),m=l.map(x=>x.shape),[f,g]=xH(d,a.shape,c,s.shape,s.dtype,h,i.shape,p,m,u);return n.makeTensorInfo(f,s.dtype,g)}var HRe={kernelName:y1,backendName:"cpu",kernelFunc:URe};function GRe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,dtype:s,step:i}=n,l=aA(r,a,i,s);return t.makeTensorInfo([l.length],s,l)}var qRe={kernelName:ab,backendName:"cpu",kernelFunc:GRe},KRe=Zn(Uh,e=>1/e),YRe={kernelName:Uh,backendName:"cpu",kernelFunc:KRe};function XRe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:l}=r;St(a,"resizeBilinear");let u=A.computeStrides(a.shape),[d,c]=l,[h,p,m,f]=a.shape,g=n.data.get(a.dataId).values,x=new Float32Array(A.sizeFromShape([h,d,c,f])),y=[s&&d>1?p-1:p,s&&c>1?m-1:m],b=[s&&d>1?d-1:d,s&&c>1?c-1:c],v=0,w=y[0]/b[0],N=y[1]/b[1];for(let S=0;S<h;S++)for(let C=0;C<d;C++){let _;i?_=w*(C+.5)-.5:_=w*C;let T=Math.max(0,Math.floor(_)),E=_-T,j=Math.min(p-1,Math.ceil(_)),I=S*u[0]+T*u[1],D=S*u[0]+j*u[1];for(let F=0;F<c;F++){let P;i?P=N*(F+.5)-.5:P=N*F;let V=Math.max(0,Math.floor(P)),$=P-V,O=Math.min(m-1,Math.ceil(P)),L=I+V*u[2],q=D+V*u[2],U=I+O*u[2],ee=D+O*u[2];for(let M=0;M<f;M++){let G=g[L+M],J=g[q+M],ve=g[U+M],Q=g[ee+M],se=G+(ve-G)*$,_e=J+(Q-J)*$,Le=se+(_e-se)*E;x[v++]=Le}}}return n.makeTensorInfo([h,d,c,f],"float32",x)}var ZRe={kernelName:qh,backendName:"cpu",kernelFunc:XRe};function QRe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r;St([s,a],"resizeBilinearGrad");let l=A.computeStrides(a.shape),[u,d,c,h]=a.shape,[,p,m]=s.shape,f=new Float32Array(u*d*c*h),g=[i&&p>1?d-1:d,i&&m>1?c-1:c],x=[i&&p>1?p-1:p,i&&m>1?m-1:m],y=g[0]/x[0],b=g[1]/x[1],v=n.data.get(s.dataId).values,w=0;for(let N=0;N<u;N++){let S=N*l[0];for(let C=0;C<p;C++){let _=C*y,T=Math.floor(_),E=Math.min(Math.ceil(_),d-1),j=S+T*l[1],I=S+E*l[1],D=_-T,F=1-D;for(let P=0;P<m;P++){let V=P*b,$=Math.floor(V),O=Math.min(Math.ceil(V),c-1),L=V-$,q=1-L,U=j+$*l[2],ee=j+O*l[2],M=I+$*l[2],G=I+O*l[2],J=F*q,ve=F*L,Q=D*q,se=D*L;for(let _e=0;_e<h;_e++){let Le=v[w++];f[U+_e]+=Le*J,f[ee+_e]+=Le*ve,f[M+_e]+=Le*Q,f[G+_e]+=Le*se}}}}return n.makeTensorInfo([u,c,d,h],"float32",f)}var JRe={kernelName:tg,backendName:"cpu",kernelFunc:QRe};function eDe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:l}=r;St(a,"resizeNearestNeighbor");let u=A.computeStrides(a.shape),[d,c]=l,[h,p,m,f]=a.shape,g=n.data.get(a.dataId).values,x=new Float32Array(h*d*c*f),y=[s&&d>1?p-1:p,s&&c>1?m-1:m],b=[s&&d>1?d-1:d,s&&c>1?c-1:c],v=y[0]/b[0],w=y[1]/b[1],N=0;for(let S=0;S<h;S++){let C=S*u[0];for(let _=0;_<d;_++){let T=i?v*(_+.5):v*_,E=Math.min(p-1,s?Math.round(T):Math.floor(T));i&&(E=Math.max(0,E));let j=C+E*u[1];for(let I=0;I<c;I++){let D=i?w*(I+.5):w*I,F=Math.min(m-1,s?Math.round(D):Math.floor(D));i&&(F=Math.max(0,F));let P=j+F*u[2];for(let V=0;V<f;V++){let $=g[P+V];x[N++]=$}}}}return n.makeTensorInfo([h,d,c,f],a.dtype,x)}var tDe={kernelName:Gh,backendName:"cpu",kernelFunc:eDe};function nDe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r;St([s,a],"resizeNearestNeighborGrad");let l=A.computeStrides(a.shape),u=A.computeStrides(s.shape),[d,c,h,p]=a.shape,[,m,f]=s.shape,g=new Float32Array(d*c*h*p),x=n.data.get(s.dataId).values,y=[i&&m>1?c-1:c,i&&f>1?h-1:h],b=[i&&m>1?m-1:m,i&&f>1?f-1:f],v=y[0]/b[0],w=y[1]/b[1],N=1/v,S=1/w,C=Math.ceil(N)*2+2,_=Math.ceil(S)*2+2;for(let T=0;T<d;T++){let E=T*l[0];for(let j=0;j<c;j++){let I=E+j*l[1],D=Math.floor(j*N),F=Math.floor(D-C/2);for(let P=0;P<h;P++){let V=I+P*l[2],$=Math.floor(P*S),O=Math.floor($-_/2);for(let L=0;L<p;L++){let q=0;for(let U=0;U<C;U++){let ee=U+F;if(ee<0||ee>=m)continue;let M=E+ee*u[1],G=ee*v,J=Math.min(c-1,i?Math.round(G):Math.floor(G));if(j===J)for(let ve=0;ve<_;ve++){let Q=ve+O;if(Q<0||Q>=f)continue;let se=M+Q*u[2],_e=Q*w,Le=Math.min(h-1,i?Math.round(_e):Math.floor(_e));P===Le&&(q+=x[se+L])}}g[V+L]=q}}}}return n.makeTensorInfo(a.shape,a.dtype,g)}var rDe={kernelName:eg,backendName:"cpu",kernelFunc:nDe};function aDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r;St(a,"reverse");let i=a.shape.length,l=A.parseAxisParam(s,a.shape);if(i===0)return Go({inputs:{x:a},backend:n});let u=new Wr(a.shape,a.dtype),d=n.bufferSync(a);for(let c=0;c<u.size;c++){let h=u.indexToLoc(c),p=h.slice();l.forEach(m=>p[m]=a.shape[m]-1-p[m]),u.set(d.get(...p),...h)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}var sDe={kernelName:Yh,backendName:"cpu",kernelFunc:aDe},iDe={kernelName:gg,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:i}=t,l=n,u=A.getTypedArrayFromDType(r.dtype,A.sizeFromShape(r.shape)),[d,c,h,p]=r.shape,[m,f]=z.getImageCenter(i,c,h),g=255,x=Math.sin(a),y=Math.cos(a),b=l.data.get(r.dataId).values;for(let v=0;v<d;v++){let w=v*h*c*p;for(let N=0;N<c;N++){let S=N*(h*p);for(let C=0;C<h;C++){let _=C*p;for(let T=0;T<p;T++){let E=[d,N,C,T],j=E[2],I=E[1],D=(j-m)*y-(I-f)*x,F=(j-m)*x+(I-f)*y;D=Math.round(D+m),F=Math.round(F+f);let P=s;if(typeof s!="number"&&(T===3?P=g:P=s[T]),D>=0&&D<h&&F>=0&&F<c){let $=F*(h*p),O=D*p,L=w+$+O+T;P=b[L]}let V=w+S+_+T;u[V]=P}}}}return{dataId:l.write(u,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},oDe=Zn(Xh,e=>{let t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),lDe={kernelName:Xh,backendName:"cpu",kernelFunc:oDe};function uDe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:i}=r,{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=z.calculateShapes(s,a,i),p=!0,m=n.bufferSync(a),f=n.bufferSync(s),g=Hc(m,f,i,h,d,u,l,c,0,p);return n.makeTensorInfo(i,g.dtype,g.values)}var cDe={kernelName:ng,backendName:"cpu",kernelFunc:uDe};function dDe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function hDe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}function pDe(e,t,n,r,a,s){let i=A.getArrayFromDType("int32",n*a);for(let l=0;l<n;++l){let u=e.slice(l*r,(l+1)*r),d=l*a;for(let c=0;c<a;++c)i[d+c]=s==="left"?dDe(u,t[c+d]):hDe(u,t[c+d])}return i}function mDe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r,l=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,d=pDe(l,u,a.shape[0],a.shape[1],s.shape[1],i);return n.makeTensorInfo(s.shape,"int32",d)}var fDe={kernelName:ag,backendName:"cpu",kernelFunc:mDe};function gDe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t;St([r,a,s],"select");let i=r.shape.length,l=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,c=ni(a.dtype,s.dtype),h=A.makeZerosTypedArray(A.sizeFromShape(a.shape),c),p=0,m=i===0||i>1||a.shape.length===1?1:A.sizeFromShape(a.shape.slice(1));for(let f=0;f<l.length;f++)for(let g=0;g<m;g++)l[f]===1?h[p++]=u[f]:h[p++]=d[f];return n.makeTensorInfo(a.shape,c,h)}var xDe={kernelName:sg,backendName:"cpu",kernelFunc:gDe},yDe=z.SELU_SCALEALPHA,bDe=z.SELU_SCALE,vDe=Zn(Qh,e=>e>=0?bDe*e:yDe*(Math.exp(e)-1)),wDe={kernelName:Qh,backendName:"cpu",kernelFunc:vDe},NDe=Zn(tp,e=>e<0?-1:e>0?1:0),kDe={kernelName:tp,backendName:"cpu",kernelFunc:NDe},SDe=Zn(Jh,e=>Math.sin(e)),CDe={kernelName:Jh,backendName:"cpu",kernelFunc:SDe},_De=Zn(ep,e=>Math.sinh(e)),IDe={kernelName:ep,backendName:"cpu",kernelFunc:_De},TDe=11920928955078125e-23,VF=Math.log(TDe)+2,EDe=Zn(rp,e=>{let t=e>-VF,n=e<VF,r=Math.exp(e),a;return n?a=r:t?a=e:a=Math.log(1+r),a}),jDe={kernelName:rp,backendName:"cpu",kernelFunc:EDe};function ADe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r;St([a],"spaceToBatchND");let l=A.sizeFromShape(s),u=[[0,0]];u.push(...i);for(let x=1+s.length;x<a.shape.length;++x)u.push([0,0]);let d=UH.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=z.getReshaped(d.shape,s,l,!1),h=z.getPermuted(c.length,s.length,!1),p=z.getReshapedPermuted(d.shape,s,l,!1),m=mr({inputs:{x:d},backend:n,attrs:{shape:c}}),f=ys({inputs:{x:m},backend:n,attrs:{perm:h}}),g=mr({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}var RDe={kernelName:og,backendName:"cpu",kernelFunc:ADe};function DDe(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${a.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let l=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,c=n.data.get(i.dataId).values[0],[h,p,m,f,g]=vH(l,r.shape,r.dtype,u,a.dtype,d,c);return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([p[0]],a.dtype,m),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}var MDe={kernelName:sb,backendName:"cpu",kernelFunc:DDe};function $De(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(n.data.get(a.dataId).values),l=n.data.get(r.dataId).values,u=Array.from(n.data.get(s.dataId).values),[d,c,h]=wH(l,r.shape,r.dtype,i,u);return[n.makeTensorInfo(c,r.dtype,d),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}var FDe={kernelName:ug,backendName:"cpu",kernelFunc:$De};function PDe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,[d,c]=sA(i,r.shape,r.dtype,l,u,!0);return n.makeTensorInfo(c,r.dtype,d)}var ODe={kernelName:ib,backendName:"cpu",kernelFunc:PDe};function LDe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,[d,c]=sA(i,r.shape,r.dtype,l,u);return n.makeTensorInfo(c,r.dtype,d)}var zDe={kernelName:ob,backendName:"cpu",kernelFunc:LDe};function BDe(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=t,{outputShape:l}=r,{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=z.calculateShapes(s,a,l),m=!1,f=n.bufferSync(a),g;switch(s.dtype){case"bool":{let x=n.bufferSync(s),y=!!n.data.get(i.dataId).values[0];g=Hc(f,x,l,p,c,d,u,h,y,m);break}case"float32":{let x=n.bufferSync(s),y=n.data.get(i.dataId).values[0];g=Hc(f,x,l,p,c,d,u,h,y,m);break}case"int32":{let x=n.bufferSync(s),y=n.data.get(i.dataId).values[0];g=Hc(f,x,l,p,c,d,u,h,y,m);break}case"string":{let x=n.bufferSync(s),y=A.decodeString(n.data.get(i.dataId).values[0]);g=Hc(f,x,l,p,c,d,u,h,y,m);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(l,g.dtype,g.values)}var WDe={kernelName:cg,backendName:"cpu",kernelFunc:BDe};function VDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=r,l=A.parseAxisParam(i,a.shape)[0],u=z.prepareSplitSize(a,s,l),d=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map(h=>{let p=[...c];p[l]=h;let m=zd({inputs:{x:a},backend:n,attrs:{begin:d,size:p}});return d[l]+=h,m})}var UDe={kernelName:lg,backendName:"cpu",kernelFunc:VDe},HDe={kernelName:lb,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t;St(n,"square");let a=r.data.get(n.dataId).values,s=new Float32Array(a.length);for(let i=0;i<a.length;++i){let l=a[i];s[i]=l*l}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},GDe=Zn(oc,(e,t)=>{let n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),qDe={kernelName:oc,backendName:"cpu",kernelFunc:GDe};function KDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:i,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r;St(a,"stridedSlice");let{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=ea.sliceInfo(a.shape,s,i,l,u,d,c,h,p),N;if(g)N=mr({inputs:{x:a},backend:n,attrs:{shape:f}});else if(x||y){A.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let S=ea.computeOutShape(b,v,w),C=zd({inputs:{x:a},backend:n,attrs:{begin:b,size:S}});N=mr({inputs:{x:C},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(C)}else{let S=n.bufferSync(a),C=SH(m,S,w,b);N=n.makeTensorInfo(f,C.dtype,C.values)}return N}var YDe={kernelName:dg,backendName:"cpu",kernelFunc:KDe};function XDe(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:i,rightPad:l,padWidth:u,preserveShortSequences:d}=r,{data:c,dataSplits:h}=t,p=n.data.get(c.dataId).values,m=n.data.get(h.dataId).values,[f,g]=iA(p,m,a,s,i,l,u,d);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}var ZDe={kernelName:cb,backendName:"cpu",kernelFunc:XDe};function QDe(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:i}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let l=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values[0],[d,c,h]=oA(l,u,a),p=c.length;return[n.makeTensorInfo([p,2],"int32",d),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}var JDe={kernelName:db,backendName:"cpu",kernelFunc:QDe};function eMe(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let i=n.data.get(s.dataId).values,l=lA(i,a);return n.makeTensorInfo(s.shape,"int32",l)}var tMe={kernelName:hb,backendName:"cpu",kernelFunc:eMe},nMe=Zn(up,e=>Math.tan(e)),rMe={kernelName:up,backendName:"cpu",kernelFunc:nMe},aMe=Zn(cp,e=>Math.tanh(e)),sMe={kernelName:cp,backendName:"cpu",kernelFunc:aMe};function iMe(e){let{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:s}=t,{sliceRank:i,numUpdates:l,sliceSize:u,strides:d,outputSize:c}=z.calculateShapes(s,a,r.shape),h=!1,p=n.bufferSync(a),m=n.bufferSync(s),f=n.bufferSync(r),g=Hc(p,m,r.shape,c,u,l,i,d,f,h);return n.makeTensorInfo(r.shape,g.dtype,g.values)}var oMe={kernelName:rg,backendName:"cpu",kernelFunc:iMe};function lMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;St(a,"tile");let i=_H(n.bufferSync(a),s);return n.makeTensorInfo(i.shape,i.dtype,i.values)}var uMe={kernelName:ic,backendName:"cpu",kernelFunc:lMe};function cMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:i}=r;St(a,"topk");let l=n.data.get(a.dataId).values,[u,d]=TH(l,a.shape,a.dtype,s,i);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(d.shape,d.dtype,d.values)]}var dMe={kernelName:hg,backendName:"cpu",kernelFunc:cMe};function hMe(e){let{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:s}=t,{interpolation:i,fillMode:l,fillValue:u,outputShape:d}=n,[c,h,p,m]=a.shape,[f,g]=d??[h,p],x=[c,f,g,m],y=A.computeStrides(a.shape),b=y[0],v=y[1],w=y[2],N=A.computeStrides(x),S=N[0],C=N[1],_=N[2],T=A.getTypedArrayFromDType(a.dtype,A.sizeFromShape(x));T.fill(u);let E=r.data.get(a.dataId).values,j=r.data.get(s.dataId).values;for(let I=0;I<c;++I){let D=s.shape[0]===1?j:j.subarray(I*8,I*8+8);for(let F=0;F<f;++F)for(let P=0;P<g;++P)for(let V=0;V<m;++V){let $,O=D[6]*P+D[7]*F+1;if(O===0)continue;let L=(D[0]*P+D[1]*F+D[2])/O,q=(D[3]*P+D[4]*F+D[5])/O,U=UF(L,p,l),ee=UF(q,h,l);switch(i){case"nearest":$=yMe(E,h,p,b,v,w,I,ee,U,V,u);break;case"bilinear":$=bMe(E,h,p,b,v,w,I,ee,U,V,u);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}let M=I*S+F*C+P*_+V;T[M]=$}return r.makeTensorInfo(x,a.dtype,T)}return{dataId:r.write(T,x,a.dtype),shape:a.shape,dtype:a.dtype}}var pMe={kernelName:pg,backendName:"cpu",kernelFunc:hMe};function UF(e,t,n){switch(n){case"reflect":return mMe(e,t);case"wrap":return fMe(e,t);case"nearest":return xMe(e,t);case"constant":default:return gMe(e)}}function mMe(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{let r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return A.clamp(0,n,t-1)}function fMe(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{let r=t-1;n-=t*Math.trunc(n/r)}return A.clamp(0,n,t-1)}function gMe(e,t){return e}function xMe(e,t){return A.clamp(0,e,t-1)}function wx(e,t,n,r,a,s,i,l,u,d,c){let h=i*r+l*a+u*s+d;return 0<=l&&l<t&&0<=u&&u<n?e[h]:c}function yMe(e,t,n,r,a,s,i,l,u,d,c){let h=Math.round(l),p=Math.round(u);return wx(e,t,n,r,a,s,i,h,p,d,c)}function bMe(e,t,n,r,a,s,i,l,u,d,c){let h=Math.floor(l),p=Math.floor(u),m=h+1,f=p+1,g=(f-u)*wx(e,t,n,r,a,s,i,h,p,d,c)+(u-p)*wx(e,t,n,r,a,s,i,h,f,d,c),x=(f-u)*wx(e,t,n,r,a,s,i,m,p,d,c)+(u-p)*wx(e,t,n,r,a,s,i,m,f,d,c);return(m-l)*g+(l-h)*x}function vMe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;St(s,"unique");let i=r.data.get(s.dataId).values,{outputValues:l,outputShape:u,indices:d}=cA(i,a,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,l),r.makeTensorInfo([d.length],"int32",d)]}var wMe={kernelName:pb,backendName:"cpu",kernelFunc:vMe};function NMe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a.shape.length,l=a.shape[s],u=new Array(i-1),d=0;for(let m=0;m<i;m++)m!==s&&(u[d++]=a.shape[m]);let c=new Array(i).fill(0),h=a.shape.slice();h[s]=1;let p=new Array(l);for(let m=0;m<p.length;m++){c[s]=m;let f=zd({inputs:{x:a},backend:n,attrs:{begin:c,size:h}});p[m]=mr({inputs:{x:f},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(f)}return p}var kMe={kernelName:mg,backendName:"cpu",kernelFunc:NMe};function SMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:i}=r;St(a,"unsortedSegmentSum");let l=a.shape.length,u=s.shape.length,d=[],c=[],h=l-u,p=s;for(let f=0;f<h;++f){let g=w0({inputs:{input:p},backend:n,attrs:{dim:f+1}});p=g,c.push(g)}for(let f=0;f<i;++f){let g=A.createScalarValue(f,"int32"),x=n.makeTensorInfo([],"int32",g),y=Y8({inputs:{a:x,b:p},backend:n}),b=Yu({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=CN({inputs:{a:b,b:a},backend:n}),w=Vb({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});d.push(w),c.push(x),c.push(y),c.push(b),c.push(v),c.push(w)}let m=VH({inputs:d,backend:n,attrs:{axis:0}});return c.forEach(f=>n.disposeIntermediateTensorInfo(f)),m}var CMe={kernelName:mb,backendName:"cpu",kernelFunc:SMe},_Me=[bEe,QIe,wEe,kEe,aTe,CEe,IEe,EEe,AEe,DEe,$Ee,PEe,LEe,WEe,UEe,qEe,YEe,ZEe,JEe,xEe,tje,rje,sje,iTe,oje,nTe,lTe,uje,JIe,dje,pje,mje,gje,yje,vje,Nje,Sje,_je,Tje,jje,Rje,Mje,Fje,Oje,Lje,Bje,Vje,Hje,Gje,qje,Kje,Xje,Jje,cEe,tAe,uTe,uAe,cTe,cAe,hTe,gAe,xAe,bAe,mTe,gTe,wAe,kAe,CAe,IAe,yTe,vTe,eTe,EAe,hje,AAe,DAe,$Ae,dEe,NTe,STe,PAe,_Te,LAe,WAe,UAe,qAe,YAe,ZAe,QAe,TTe,eRe,nRe,aRe,iRe,lRe,cRe,hRe,jTe,mRe,xRe,wRe,RTe,MTe,SRe,IRe,jRe,FTe,RRe,MRe,$Re,UH,LRe,pEe,LTe,BRe,VRe,HRe,qRe,tTe,RC,YRe,mEe,fEe,gEe,ZRe,JRe,tDe,rDe,sDe,iDe,lDe,KTe,cDe,fDe,xDe,wDe,XTe,kDe,CDe,IDe,ZTe,bRe,jDe,RDe,MDe,FDe,ODe,zDe,WDe,UDe,eEe,HDe,nEe,aEe,qDe,YDe,ZDe,JDe,tMe,lEe,Zje,rMe,sMe,oMe,uMe,dMe,pMe,PTe,wMe,kMe,CMe,DRe];for(let e of _Me)fb(e);var HH={};Kt(HH,{assertNotComplex:()=>Eg,bindCanvasToFramebuffer:()=>PMe,bindColorTextureToFramebuffer:()=>aw,bindTextureToProgramUniformSampler:()=>oG,bindTextureUnit:()=>aG,bindVertexBufferToProgramAttribute:()=>MC,callAndCheck:()=>ut,canBeRepresented:()=>qH,createFragmentShader:()=>XH,createFramebuffer:()=>rG,createProgram:()=>ZH,createStaticIndexBuffer:()=>eG,createStaticVertexBuffer:()=>JH,createTexture:()=>tG,createVertexShader:()=>YH,getBatchDim:()=>Bd,getExtensionOrThrow:()=>Nx,getFramebufferErrorMessage:()=>lG,getMaxTexturesInShader:()=>hG,getNumChannels:()=>$Me,getProgramUniformLocation:()=>iG,getProgramUniformLocationOrThrow:()=>sG,getRowsCols:()=>Wd,getShapeAs3D:()=>Sx,getTextureShapeFromLogicalShape:()=>cG,getWebGLDisjointQueryTimerVersion:()=>pG,getWebGLErrorMessage:()=>KH,getWebGLMaxTextureSize:()=>dG,hasExtension:()=>Xs,isCapableOfRenderingToFloatTexture:()=>mG,isDownloadFloatTextureEnabled:()=>fG,isReshapeFree:()=>vy,isWebGLFenceEnabled:()=>gG,isWebGLVersionEnabled:()=>FC,linkProgram:()=>QH,logShaderSourceAndInfoLog:()=>fA,resetMaxTextureSize:()=>OMe,resetMaxTexturesInShader:()=>LMe,unbindColorTextureFromFramebuffer:()=>$C,unbindTextureUnit:()=>FMe,validateFramebuffer:()=>kx,validateProgram:()=>rw,validateTextureSize:()=>nG});var Oc={},jv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function GH(e,t){Oc[e]=t}function so(e,t){if(!(e in Oc)||t!=null){let r=TMe(e,t);if(r!==null)Oc[e]=r;else return console.log("Could not get context for WebGL version",e),null}let n=Oc[e];return n==null||n.isContextLost()?(delete Oc[e],so(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Oc[e])}function IMe(e){if(!be().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function TMe(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=t??IMe(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Oc[e]},!1),be().getBool("SOFTWARE_WEBGL_ENABLED")&&(jv.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",jv)||n.getContext("experimental-webgl",jv):n.getContext("webgl2",jv)}var by;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(by||(by={}));var Ys;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(Ys||(Ys={}));var Ea;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ea||(Ea={}));function Ub(e,t){return[t,e]}function EMe(e,t){return e*t}function Av(e){let t=A.sizeFromShape(e),n=Math.ceil(t/4);return A.sizeToSquarishShape(n)}function Tg(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function jMe(e,t){let[n,r]=Tg(e,t);return n*r*4}function mA(e,t){let n=e,r,a,s,i,l,u,d,c,h,p;return be().getNumber("WEBGL_VERSION")===2?(r=n.R32F,a=n.R16F,s=n.RGBA16F,i=n.RGBA32F,l=n.RED,d=4,c=1,h=n.HALF_FLOAT,p=n.FLOAT,u=n.RGBA8):(r=e.RGBA,a=e.RGBA,s=e.RGBA,i=n.RGBA,l=e.RGBA,d=4,c=4,h=t!=null?t.HALF_FLOAT_OES:null,p=e.FLOAT,u=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:l,downloadTextureFormat:u,downloadUnpackNumChannels:d,defaultNumChannels:c,textureTypeHalfFloat:h,textureTypeFloat:p}}function ut(e,t){let n=t();return be().getBool("DEBUG")&&AMe(e),n}function AMe(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+KH(e,t))}var RMe=596e-10,DMe=65504;function qH(e){return!!(be().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||RMe<Math.abs(e)&&Math.abs(e)<DMe)}function KH(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Nx(e,t){return Wl(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function YH(e,t){let n=Wl(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ut(e,()=>e.shaderSource(n,t)),ut(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function XH(e,t){let n=Wl(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ut(e,()=>e.shaderSource(n,t)),ut(e,()=>e.compileShader(n)),be().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw fA(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var MMe=/ERROR: [0-9]+:([0-9]+):/g;function fA(e,t){let n=MMe.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}let r=+n[1],a=e.split(`
`),s=a.length.toString().length+2,i=a.map((h,p)=>A.rightPad((p+1).toString(),s)+h),l=0;for(let h=0;h<i.length;h++)l=Math.max(i[h].length,l);let u=i.slice(0,r-1),d=i.slice(r-1,r),c=i.slice(r);console.log(u.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${A.rightPad(d[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function ZH(e){return Wl(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function QH(e,t){if(ut(e,()=>e.linkProgram(t)),!be().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function rw(e,t){if(ut(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function JH(e,t){let n=Wl(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ut(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),ut(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function eG(e,t){let n=Wl(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return ut(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),ut(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function $Me(){return be().getNumber("WEBGL_VERSION")===2?1:4}function tG(e){return Wl(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function nG(e,t){let n=be().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){let r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){let r=`[${e}x${t}]`,a=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function rG(e){return Wl(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function MC(e,t,n,r,a,s,i){let l=e.getAttribLocation(t,n);return l===-1?!1:(ut(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),ut(e,()=>e.vertexAttribPointer(l,a,e.FLOAT,!1,s,i)),ut(e,()=>e.enableVertexAttribArray(l)),!0)}function aG(e,t,n){uG(e,n),ut(e,()=>e.activeTexture(e.TEXTURE0+n)),ut(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function FMe(e,t){uG(e,t),ut(e,()=>e.activeTexture(e.TEXTURE0+t)),ut(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function sG(e,t,n){return Wl(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function iG(e,t,n){return e.getUniformLocation(t,n)}function oG(e,t,n,r){ut(e,()=>aG(e,t,r)),ut(e,()=>e.uniform1i(n,r))}function PMe(e){ut(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ut(e,()=>e.viewport(0,0,e.canvas.width,e.canvas.height)),ut(e,()=>e.scissor(0,0,e.canvas.width,e.canvas.height))}function aw(e,t,n){ut(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),ut(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function $C(e,t){ut(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),ut(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function kx(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+lG(e,t))}function lG(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function Wl(e,t,n){let r=ut(e,()=>t());if(r==null)throw new Error(n);return r}function uG(e,t){let n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){let a=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${a}.`)}}function Bd(e,t=2){return A.sizeFromShape(e.slice(0,e.length-t))}function Wd(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Sx(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[Bd(e),...Wd(e)]),t}function cG(e,t=!1){let n=be().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=be().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&be().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((l,u)=>u>=e.length-2?A.nearestLargerEven(e[u]):e[u]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=A.squeezeShape(e).newShape);let a=A.sizeFromShape(e),s=null;e.length<=1&&a<=n?s=[1,a]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);let i=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||i)if(t){let l=Bd(e),u=2,d=2;e.length&&([u,d]=Wd(e)),a=l*(u/2)*(d/2),s=A.sizeToSquarishShape(a).map(c=>c*2)}else s=A.sizeToSquarishShape(a);return s}function Rv(e){return e%2===0}function vy(e,t){if(e=e.slice(-2),t=t.slice(-2),A.arraysEqual(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){let n=e[e.length-1],r=t[t.length-1];if(n===r||Rv(n)&&Rv(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&Rv(e[0])&&Rv(t[0])}var sw,iw;function dG(e){if(sw==null){let t=so(e);sw=t.getParameter(t.MAX_TEXTURE_SIZE)}return sw}function OMe(){sw=null}function LMe(){iw=null}function hG(e){if(iw==null){let t=so(e);iw=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,iw)}function pG(e){if(e===0)return 0;let t,n=so(e);return Xs(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:Xs(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function Xs(e,t){return e.getExtension(t)!=null}function FC(e){try{if(so(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function mG(e){if(e===0)return!1;let t=so(e);if(e===1){if(!Xs(t,"OES_texture_float"))return!1}else if(!Xs(t,"EXT_color_buffer_float"))return!1;return PC(t)}function fG(e){if(e===0)return!1;let t=so(e);if(e===1){if(!Xs(t,"OES_texture_float")||!Xs(t,"WEBGL_color_buffer_float"))return!1}else{if(Xs(t,"EXT_color_buffer_float"))return PC(t);let n="EXT_color_buffer_half_float";if(Xs(t,n)){let r=t.getExtension(n);return zMe(t,r)}return!1}return PC(t)}function PC(e){let t=mA(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function zMe(e,t){let n=mA(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),s}function gG(e){return e!==2?!1:so(e).fenceSync!=null}function Eg(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&A.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var It=be();It.registerFlag("HAS_WEBGL",()=>It.getNumber("WEBGL_VERSION")>0);It.registerFlag("WEBGL_VERSION",()=>FC(2)?2:FC(1)?1:0);It.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);It.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>It.get("WEBGL_VERSION")===2);It.registerFlag("WEBGL_CPU_FORWARD",()=>!0);It.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);It.registerFlag("WEBGL_PACK",()=>It.getBool("HAS_WEBGL"));It.registerFlag("WEBGL_PACK_NORMALIZATION",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_CLIP",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_REDUCE",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_LAZILY_UNPACK",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_CONV_IM2COL",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>It.getBool("WEBGL_PACK"));It.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>dG(It.getNumber("WEBGL_VERSION")));It.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>hG(It.getNumber("WEBGL_VERSION")));It.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let e=It.getNumber("WEBGL_VERSION");return e===0?0:pG(e)});It.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>It.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!yb.isMobile());It.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>mG(It.getNumber("WEBGL_VERSION")));It.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>It.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:It.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));It.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>fG(It.getNumber("WEBGL_VERSION")));It.registerFlag("WEBGL_FENCE_API_ENABLED",()=>gG(It.getNumber("WEBGL_VERSION")));It.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>It.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);It.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});It.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>yb.isMobile()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});It.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);It.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);It.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);It.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);It.registerFlag("WEBGL_EXP_CONV",()=>!1);It.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>It.getBool("IS_TEST"));It.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);It.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);It.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);It.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function ts(){let e,t,n,r,a,s,i,l,u,d;return be().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",i="out vec4 outputColor;",l=be().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",d=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",i="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,d=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:i,defineSpecialNaN:l,defineSpecialInf:u,defineRound:d}}function yp(e,t,n="index"){let r=A.computeStrides(t);return r.map((a,s)=>{let i=`int ${e[s]} = ${n} / ${a}`,l=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${a}`:`index -= ${e[s]} * ${a}`;return`${i}; ${l};`}).join("")}function _N(e,t,n="index"){let r=A.computeStrides(t);return r.map((a,s)=>{let i=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,l=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${i}; ${l};`}).join("")}function BMe(e,t){let n=e.length,r=e.map(s=>`${t}[${s}]`),a=new Array(n-1);a[n-2]=r[n-1];for(let s=n-3;s>=0;--s)a[s]=`(${a[s+1]} * ${r[s+1]})`;return a}function WMe(e,t,n="index"){let r=e.map((s,i)=>i),a=BMe(r,t);return a.map((s,i)=>{let l=`int ${e[i]} = ${n} / ${a[i]}`,u=i===a.length-1?`int ${e[i+1]} = ${n} - ${e[i]} * ${a[i]}`:`index -= ${e[i]} * ${a[i]}`;return`${l}; ${u};`}).join("")}function gA(e){let t=A.computeStrides(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function xA(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var xG=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:yG}=z;function VMe(e,t,n){let r=[];if(e.forEach(p=>{let m=A.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(r.push(`uniform sampler2D ${p.name};`),r.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){let{uniformShape:f}=yA(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(f.length){case 1:r.push(`uniform int ${p.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${p.name}Shape;`);break}r.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{r.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});let a=r.join(`
`),s=e.map(p=>UMe(p,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=t.texShape,l=ts(),u=qMe(l),d,c,h=XMe(l);return t.isPacked?(d=HMe(t.logicalShape,i,n.enableShapeUniforms),c=YMe(l)):(d=GMe(t.logicalShape,i,n.enableShapeUniforms),c=KMe(l)),n.packedInputs&&(h+=e$e),[h,u,c,a,d,s,n.userCode].join(`
`)}function jg(e,t=!1){let n=e.shapeInfo.logicalShape;switch(n.length){case 0:return h$e(e,t);case 1:return m$e(e,t);case 2:return g$e(e,t);case 3:return y$e(e,t);case 4:return v$e(e,t);case 5:return w$e(e);case 6:return N$e(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function bG(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return d$e(e);case 1:return p$e(e,t);case 2:return f$e(e,t);case 3:return x$e(e,t);default:return b$e(e,t)}}function UMe(e,t,n=!1,r){let a="";n?a+=bG(e,r):a+=jg(e,r);let s=e.shapeInfo.logicalShape,i=t.logicalShape;return s.length<=i.length&&(n?a+=k$e(e,t):a+=S$e(e,t)),a}function HMe(e,t,n){switch(e.length){case 0:return vG();case 1:return t$e(e,t,n);case 2:return u$e(e,t,n);case 3:return r$e(e,t,n);default:return s$e(e,t,n)}}function GMe(e,t,n){switch(e.length){case 0:return vG();case 1:return n$e(e,t,n);case 2:return c$e(e,t,n);case 3:return a$e(e,t,n);case 4:return i$e(e,t,n);case 5:return o$e(e,t);case 6:return l$e(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function qMe(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function KMe(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function YMe(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function XMe(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${ZMe}
    ${QMe}
    ${JMe}
  `}var ZMe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,QMe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,JMe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,e$e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function vG(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function t$e(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function n$e(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function r$e(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),s=a*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec3(b, r, c);
    }
  `}function a$e(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${_N(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;let r=yp(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function s$e(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),s=a*Math.ceil(e[e.length-2]/2),i=s,l="",u="b, r, c";for(let d=2;d<e.length-1;d++)i*=e[e.length-d-1],l=`
      int b${d} = index / ${i};
      index -= b${d} * ${i};
    `+l,u=`b${d}, `+u;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${l}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec${e.length}(${u});
    }
  `}function i$e(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${_N(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;let r=yp(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function o$e(e,t){let n=yp(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function l$e(e,t){let n=yp(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function u$e(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(A.arraysEqual(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let a=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec2(r, c);
    }
  `}function c$e(e,t,n){return A.arraysEqual(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function bp(e){return`offset${e}`}function d$e(e){let t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ts();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function h$e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;let[a,s]=e.shapeInfo.texShape;if(a===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let i=bp(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;let[l,u]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${l}, ${u}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function p$e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,s=ts();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;let i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function m$e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Ag(e)}
      }
    `;let a=e.shapeInfo.texShape,s=a[0],i=a[1];if(i===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let l=bp(n);return i===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${l});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${l});
      return sampleTexture(${n}, uv);
    }
  `}function f$e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,i=s[0],l=s[1],u=ts();if(s!=null&&A.arraysEqual(n,s))return t?`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${u.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${i}.0);

        return ${u.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${a}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `;let d=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${a}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${d[0]}, ${d[1]}, row, col);
      return ${u.texture2D}(${r}, uv);
    }
  `}function g$e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&A.arraysEqual(n,s)){if(t)return`
      float ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let p=s[0],m=s[1];return`
    float ${a}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:i,keptDims:l}=A.squeezeShape(n),u=i;if(u.length<n.length){let p=Rg(e,u),m=["row","col"];return`
      ${jg(p,t)}
      float ${a}(int row, int col) {
        return ${a}(${Dg(m,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Ag(e)}
      }
    `;let d=s[0],c=s[1],h=bp(r);return c===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `:d===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${a}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${a}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${d}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function x$e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){let p=n.slice(1),m=[1,2],f=Rg(e,p),g=["b","row","col"];return`
        ${bG(f,t)}
        vec4 ${a}(int b, int row, int col) {
          return ${a}(${Dg(g,m)});
        }
      `}let l=ts();if(t)return`
    vec4 ${a}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let u=i[0],d=i[1],c=Math.ceil(n[2]/2),h=c*Math.ceil(n[1]/2);return`
    vec4 ${a}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${u}, ${d}, ${h}, ${c}, b, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function y$e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],i=n[2],{newShape:l,keptDims:u}=A.squeezeShape(n),d=l;if(d.length<n.length){let g=Rg(e,d),x=["row","col","depth"];return`
        ${jg(g,t)}
        float ${a}(int row, int col, int depth) {
          return ${a}(${Dg(x,u)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${Ag(e)}
      }
    `;let c=e.shapeInfo.texShape,h=c[0],p=c[1],m=e.shapeInfo.flatOffset;if(p===s&&m==null)return t?`
      float ${a}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${a}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===i&&m==null)return t?`
      float ${a}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;let f=bp(r);return t?`
    float ${a}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${a}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function b$e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=ts();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);
    }
  `;let s=e.shapeInfo.logicalShape,i=s.length,l=e.shapeInfo.texShape,u=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=u[0],c=u[1],h=Math.ceil(s[i-1]/2),p=h*Math.ceil(s[i-2]/2),m="int b, int row, int col",f=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<i-1;g++)m=`int b${g}, `+m,p*=s[i-g-1],f=`b${g} * ${p} + `+f;return`
    vec4 ${r}(${m}) {
      int index = ${f};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${d});
      return ${a.texture2D}(${n}, uv);
    }
  `}function v$e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],i=n[2]*s,l=n[1]*i,{newShape:u,keptDims:d}=A.squeezeShape(n);if(u.length<n.length){let b=Rg(e,u),v=["row","col","depth","depth2"];return`
      ${jg(b,t)}
      float ${a}(int row, int col, int depth, int depth2) {
        return ${a}(${Dg(v,d)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${i}, ${s}, 1)));
        ${Ag(e)}
      }
    `;let c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1],f=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,x=`int stride0 = ${r}Shape[1] * stride1;`;if(m===l&&c==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        ${f}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===s&&c==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=bp(r);return t?`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${p}, ${m}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function w$e(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],s=t[3]*a,i=t[2]*s,l=t[1]*i,{newShape:u,keptDims:d}=A.squeezeShape(t);if(u.length<t.length){let g=Rg(e,u),x=["row","col","depth","depth2","depth3"];return`
      ${jg(g)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Dg(x,d)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${i}, ${s}, ${a})) +
          depth3;
        ${Ag(e)}
      }
    `;let c=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1];if(m===l&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;let f=bp(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${i} + depth * ${s} +
          depth2 * ${a} + depth3 + ${f};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function N$e(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:s}=A.squeezeShape(t);if(a.length<t.length){let x=Rg(e,a),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${jg(x)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Dg(y,s)});
      }
    `}let i=t[5],l=t[4]*i,u=t[3]*l,d=t[2]*u,c=t[1]*d;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${d}, ${u}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ag(e)}
      }
    `;let h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],f=p[1];if(f===c&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${d}, ${u}, ${l}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===i&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;let g=bp(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${d} + depth * ${u} +
          depth2 * ${l} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${m}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Ag(e){let t=e.name,n=A.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function k$e(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,i=t.logicalShape.length,l=yG(e.shapeInfo.logicalShape,t.logicalShape),u=ar(i),d=i-s,c,h=["x","y","z","w","u","v"];s===0?c="":i<2&&l.length>=1?c="coords = 0;":c=l.map(x=>`coords.${h[x+d]} = 0;`).join(`
`);let p="";i<2&&s>0?p="coords":p=e.shapeInfo.logicalShape.map((x,y)=>`coords.${h[y+d]}`).join(", ");let m="return outputValue;",f=A.sizeFromShape(e.shapeInfo.logicalShape)===1,g=A.sizeFromShape(t.logicalShape)===1;if(s===1&&!f&&!g)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(f&&!g)i===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(l.length){let x=s-2,y=s-1;l.indexOf(x)>-1&&l.indexOf(y)>-1?m="return vec4(outputValue.x);":l.indexOf(x)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(y)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${a}() {
      ${u} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${p});
      ${m}
    }
  `}function S$e(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=t.texShape,i=e.shapeInfo.texShape,l=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&l===u&&e.shapeInfo.flatOffset==null&&A.arraysEqual(i,s))return`
      float ${a}() {
        return sampleTexture(${n}, resultUV);
      }
    `;let d=ar(u),c=yG(e.shapeInfo.logicalShape,t.logicalShape),h=u-l,p,m=["x","y","z","w","u","v"];l===0?p="":u<2&&c.length>=1?p="coords = 0;":p=c.map(g=>`coords.${m[g+h]} = 0;`).join(`
`);let f="";return u<2&&l>0?f="coords":f=e.shapeInfo.logicalShape.map((g,x)=>`coords.${m[x+h]}`).join(", "),`
    float ${a}() {
      ${d} coords = getOutputCoords();
      ${p}
      return get${r}(${f});
    }
  `}function ar(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function yA(e,t,n){let{newShape:r,keptDims:a}=A.squeezeShape(t),s=t.length,i=e&&s===3&&t[0]===1,l=i?t.slice(1):r,u=!e&&s>1&&!A.arraysEqual(t,n)&&r.length<s||i;return{useSqueezeShape:u,uniformShape:u?l:t,keptDims:a}}function Rg(e,t){let n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Dg(e,t){return t.map(n=>e[n]).join(", ")}function C$e(e,t,n,r){let a=n.map((c,h)=>{let p={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(p.flatOffset=c.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:p}}),s=a.map(c=>c.shapeInfo),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=VMe(a,i,t),u=XH(e.gl,l),d=e.createProgram(u);return be().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:l,webGLProgram:d,inShapeInfos:s,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(d),Object.assign({program:t,fragmentShader:u,source:l,webGLProgram:d,inShapeInfos:s,outShapeInfo:i},wG(e,t,d)))}function wG(e,t,n){let r=[],a=[],s,i,l,u=null,d=null;d=e.getUniformLocation(n,"NAN",!1),be().getNumber("WEBGL_VERSION")===1&&(u=e.getUniformLocation(n,"INFINITY",!1));let c=!1;for(let h of t.variableNames){let p={name:h,uniform:e.getUniformLocation(n,h,c),offset:e.getUniformLocation(n,`offset${h}`,c)};t.enableShapeUniforms&&(p.shape=e.getUniformLocation(n,`${h}Shape`,c),p.texShape=e.getUniformLocation(n,`${h}TexShape`,c)),r.push(p)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",c),l=e.getUniformLocation(n,"outShapeStrides",c),i=e.getUniformLocation(n,"outTexShape",c)),t.customUniforms)for(let h of t.customUniforms)a.push(e.getUniformLocation(n,h.name,c));return{variablesLocations:r,customUniformLocations:a,infLoc:u,nanLoc:d,outShapeLocation:s,outShapeStridesLocation:l,outTexShapeLocation:i}}function HF(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{let a=n.logicalShape,s=t[r],i=s.shape;if(!A.arraysEqual(a,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${a} and ${i} must match`);if(n.isUniform&&s.isUniform)return;let l=n.texShape,u=s.isUniform?null:s.texData.texShape;if(!A.arraysEqual(l,u))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${u} must match`)})}function _$e(e,t,n,r,a){t.program.enableShapeUniforms||(HF(t.inShapeInfos,n),HF([t.outShapeInfo],[r]));let s=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):e.setOutputMatrixTexture(s.texture,i[0],i[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),be().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let u=0;u<n.length;++u){let d=n[u],{uniform:c,offset:h,shape:p,texShape:m}=t.variablesLocations[u];if(p){let{uniformShape:f}=yA(t.program.packedInputs,d.shape,d.texData.texShape);switch(f.length){case 1:e.gl.uniform1iv(p,new Int32Array(f));break;case 2:e.gl.uniform2iv(p,new Int32Array(f));break;case 3:e.gl.uniform3iv(p,new Int32Array(f));break;case 4:e.gl.uniform4iv(p,new Int32Array(f));break}}if(m&&e.gl.uniform2i(m,d.texData.texShape[0],d.texData.texShape[1]),c!=null){if(d.isUniform){if(A.sizeFromShape(d.shape)<2)e.gl.uniform1f(c,d.uniformValues[0]);else{let f=d.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),e.gl.uniform1fv(c,f)}continue}d.texData.slice!=null&&h!=null&&e.gl.uniform1i(h,d.texData.slice.flatOffset),e.setInputMatrixTexture(d.texData.texture.texture,c,u)}}let l=t.outShapeLocation;if(l)switch(r.shape.length){case 1:e.gl.uniform1iv(l,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(l,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(l,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(l,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){let u=A.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let u=0;u<t.program.customUniforms.length;++u){let d=t.program.customUniforms[u],c=t.customUniformLocations[u],h=a[u];if(d.type==="float")e.gl.uniform1fv(c,h);else if(d.type==="vec2")e.gl.uniform2fv(c,h);else if(d.type==="vec3")e.gl.uniform3fv(c,h);else if(d.type==="vec4")e.gl.uniform4fv(c,h);else if(d.type==="int")e.gl.uniform1iv(c,h);else if(d.type==="ivec2")e.gl.uniform2iv(c,h);else if(d.type==="ivec3")e.gl.uniform3iv(c,h);else if(d.type==="ivec4")e.gl.uniform4iv(c,h);else throw Error(`uniform type ${d.type} is not supported yet.`)}e.executeProgram()}function I$e(e,t,n){let r="";t.concat(n).forEach(i=>{let l=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!i.isUniform){let u=i.texData.texShape,{useSqueezeShape:d,uniformShape:c,keptDims:h}=yA(e.packedInputs,i.shape,u),p="",m="",f="";if(c.length===1&&e.packedInputs){let N=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p=`${N[0]>1}_${N[1]>1}`}else if(c.length===2&&!e.packedInputs)m=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!e.packedInputs){let N=A.computeStrides(c);f=`${N[0]===u[1]}_${N[N.length-1]===u[1]}`}let g=i.shape.length,x=c.length===2&&A.arraysEqual(i.shape,u),y=A.sizeFromShape(i.shape)===1,b=z.getBroadcastDims(i.shape,n.shape),v=!e.packedInputs&&g===n.shape.length&&A.arraysEqual(u,n.texData.texShape),w=e.packedInputs||c.length>2?"":`${u[0]>1}_${u[1]>1}`;r+=`${g}_${v}_${d?h:""}_${c.length}_${y}_${b}_${x}_${p}_${m}_${f}_${w}_${l}`}else{let u=i.isUniform?"uniform":i.texData.texShape;r+=`${i.shape}_${u}_${l}`}});let a=e.userCode,s=e.constructor.name;return s+="_"+r+"_"+a+`${be().getNumber("WEBGL_VERSION")}`,s}function Wa(e){return be().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var T$e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=by.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=ts();this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?_N(["r","c","d"],e):yp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}},E$e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=by.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=ts();this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?_N(["r","c","d"],e):yp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}},j$e=class{constructor(e){this.variableNames=["A"],this.outTexUsage=Ys.DOWNLOAD;let t=ts();this.outputShape=e,this.userCode=`
      ${xG}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}},A$e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ys.DOWNLOAD;let t=ts();this.outputShape=e,this.userCode=`
      ${xG}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}},R$e={R:0,G:1,B:2,A:3},GF=class{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=ts();this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let s="";for(let i=0;i<n.length;i++){let l=n[i];s+=`
          if(offset == ${i}) {
            result = values[${R$e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?xA():gA(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${s}
        }
        ${r.output} = vec4(${a}, 0., 0., 0.);
      }
    `}},D$e=class{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=ts();this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let l=s*2+i;r+=`
          localCoords = coords;
          if(localCoords[2] + ${i} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${i};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?xA():gA(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${n.output} = ${a};
        }
    `}},NG={};Kt(NG,{bindVertexProgramAttributeStreams:()=>AG,createBufferFromOutputTexture:()=>MG,createFloat16MatrixTexture:()=>IG,createFloat16PackedMatrixTexture:()=>jG,createFloat32MatrixTexture:()=>_G,createIndexBuffer:()=>CG,createPackedMatrixTexture:()=>EG,createUnsignedBytesMatrixTexture:()=>TG,createVertexBuffer:()=>SG,createVertexShader:()=>kG,downloadByteEncodedFloatMatrixFromOutputTexture:()=>FG,downloadFloat32MatrixFromBuffer:()=>$G,downloadMatrixFromPackedOutputTexture:()=>OG,downloadPackedMatrixFromBuffer:()=>PG,getInternalFormatForFloat16MatrixTexture:()=>vA,getInternalFormatForFloat16PackedMatrixTexture:()=>kA,getInternalFormatForFloat32MatrixTexture:()=>bA,getInternalFormatForPackedMatrixTexture:()=>NA,getInternalFormatForUnsignedBytesMatrixTexture:()=>wA,uploadDenseMatrixToTexture:()=>RG,uploadPixelDataToTexture:()=>DG});function kG(e){let t=ts(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return YH(e,n)}function SG(e){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return JH(e,t)}function CG(e){let t=new Uint16Array([0,1,2,2,1,3]);return eG(e,t)}function Hb(e,t,n,r,a,s){nG(t,n);let i=tG(e),l=e.TEXTURE_2D;return ut(e,()=>e.bindTexture(l,i)),ut(e,()=>e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),ut(e,()=>e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),ut(e,()=>e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.NEAREST)),ut(e,()=>e.texParameteri(l,e.TEXTURE_MAG_FILTER,e.NEAREST)),be().getNumber("WEBGL_VERSION")===1?ut(e,()=>e.texImage2D(l,0,r,t,n,0,a,s,null)):ut(e,()=>e.texStorage2D(l,1,r,t,n)),ut(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:i,texShape:[n,t]}}function bA(e){return e.internalFormatFloat}function _G(e,t,n,r){let[a,s]=Ub(t,n);return Hb(e,a,s,bA(r),r.textureFormatFloat,e.FLOAT)}function vA(e){return e.internalFormatHalfFloat}function IG(e,t,n,r){let[a,s]=Ub(t,n);return Hb(e,a,s,vA(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function wA(e){return e.downloadTextureFormat}function TG(e,t,n,r){let[a,s]=Ub(t,n);return Hb(e,a,s,wA(r),e.RGBA,e.UNSIGNED_BYTE)}function NA(e){return e.internalFormatPackedFloat}function EG(e,t,n,r){let[a,s]=Tg(t,n);return Hb(e,a,s,NA(r),e.RGBA,e.FLOAT)}function kA(e){return e.internalFormatPackedHalfFloat}function jG(e,t,n,r){let[a,s]=Tg(t,n);return Hb(e,a,s,kA(r),e.RGBA,r.textureTypeHalfFloat)}function AG(e,t,n){return ut(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),MC(e,t,"clipSpacePos",n,3,20,0)&&MC(e,t,"uv",n,2,20,12)}function RG(e,t,n,r,a,s){ut(e,()=>e.bindTexture(e.TEXTURE_2D,t));let i,l,u;a instanceof Uint8Array?(i=new Uint8Array(n*r*4),l=e.UNSIGNED_BYTE,u=e.RGBA):(i=new Float32Array(n*r*4),l=e.FLOAT,u=s.internalFormatPackedFloat),i.set(a),be().getNumber("WEBGL_VERSION")===2?ut(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,l,i)):ut(e,()=>e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,l,i)),ut(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function DG(e,t,n){ut(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?be().getNumber("WEBGL_VERSION")===2?ut(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):ut(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):be().getNumber("WEBGL_VERSION")===2?ut(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):ut(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),ut(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function MG(e,t,n,r){let a=e.createBuffer();ut(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a));let s=4*4*t*n;return ut(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ)),ut(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),ut(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),a}function $G(e,t,n){let r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function FG(e,t,n,r){let[a,s]=Ub(t,n),i=4,l=new Uint8Array(EMe(t*n,i));return ut(e,()=>e.readPixels(0,0,a,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function PG(e,t,n,r,a,s,i,l){let u=e,d=new Float32Array(jMe(s,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,d),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),d}function OG(e,t,n){let r=new Float32Array(t*n*4);return ut(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}var ow=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=be().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,GH(t,e)):this.gl=so(t),e=this.gl,be().getNumber("WEBGL_VERSION")===2){let a=e;this.createVertexArray=()=>ut(a,()=>a.createVertexArray()),this.bindVertexArray=s=>ut(a,()=>a.bindVertexArray(s)),this.deleteVertexArray=s=>ut(a,()=>a.deleteVertexArray(s)),this.getVertexArray=()=>ut(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(e!=null){let a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ut(e,()=>a.createVertexArrayOES()),this.bindVertexArray=s=>ut(e,()=>a.bindVertexArrayOES(s)),this.deleteVertexArray=s=>ut(e,()=>a.deleteVertexArrayOES(s)),this.getVertexArray=()=>ut(e,()=>e.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),be().getNumber("WEBGL_VERSION")===1){let a="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=Nx(this.gl,a),Xs(this.gl,s))this.textureHalfFloatExtension=Nx(this.gl,s);else if(be().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Xs(this.gl,r))this.colorBufferHalfFloatExtension=Nx(this.gl,r);else if(be().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Xs(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(Xs(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=SG(this.gl),this.indexBuffer=CG(this.gl),this.framebuffer=rG(this.gl),this.textureConfig=mA(this.gl,this.textureHalfFloatExtension)}get debug(){return be().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;ut(e,()=>e.finish()),ut(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ut(e,()=>e.deleteFramebuffer(this.framebuffer)),ut(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ut(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ut(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),_G(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),IG(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),TG(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),DG(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),RG(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),jG(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),EG(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&($C(this.gl,this.framebuffer),this.outputTexture=null),ut(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>FG(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,a,s){return PG(this.gl,e,t,n,r,a,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return $G(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let r=MG(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(be().getBool("WEBGL_FENCE_API_ENABLED")){let r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let s=r.clientWaitSync(a,0,0);return s===r.ALREADY_SIGNALED||s===r.CONDITION_SATISFIED},t=a}else be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>OG(this.gl,t,n))}createProgram(e){this.throwIfDisposed();let t=this.gl;this.vertexShader==null&&(this.vertexShader=kG(t));let n=ZH(t);ut(t,()=>t.attachShader(n,this.vertexShader)),ut(t,()=>t.attachShader(n,e)),QH(t,n);let r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&rw(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;ut(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),AG(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ut(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&rw(this.gl,this.program),ut(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?sG(this.gl,e,t):iG(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),ut(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),oG(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[r,a]=Tg(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&rw(this.gl,this.program),kx(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ut(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ut(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Nx(this.gl,be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.createQuery();return n.beginQuery(r.TIME_ELAPSED_EXT,a),a}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await A.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),r=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=M$e(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:n}=this.itemsToPoll[t];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in be().platform&&(n=be().platform.setTimeoutCustom.bind(be().platform)),A.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),aw(this.gl,e,this.framebuffer),this.debug&&kx(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(aw(this.gl,this.outputTexture,this.framebuffer),this.debug&&kx(this.gl)):$C(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let r=this.gl;aw(r,e,this.framebuffer),this.debug&&kx(r),this.outputTexture=e,ut(r,()=>r.viewport(0,0,t,n)),ut(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),ut(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function M$e(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}var{addImpl:$$e,bincountImpl:LG,bincountReduceImpl:F$e,bitwiseAndImpl:P$e,castImpl:O$e,ceilImpl:L$e,concatImpl:z$e,equalImpl:B$e,expImpl:W$e,expm1Impl:V$e,floorImpl:U$e,gatherNdImpl:H$e,gatherV2Impl:G$e,greaterImpl:q$e,greaterEqualImpl:K$e,lessImpl:Y$e,lessEqualImpl:X$e,linSpaceImpl:Z$e,logImpl:Q$e,maxImpl:J$e,maximumImpl:eFe,minimumImpl:tFe,multiplyImpl:nFe,negImpl:rFe,notEqualImpl:aFe,prodImpl:sFe,raggedGatherImpl:iFe,raggedRangeImpl:oFe,raggedTensorToTensorImpl:lFe,rangeImpl:uFe,rsqrtImpl:cFe,scatterImpl:dFe,sigmoidImpl:hFe,simpleAbsImpl:zG,sliceImpl:pFe,sparseFillEmptyRowsImpl:mFe,sparseReshapeImpl:fFe,sparseSegmentReductionImpl:BG,sqrtImpl:gFe,staticRegexReplaceImpl:xFe,stridedSliceImpl:yFe,stringNGramsImpl:bFe,stringSplitImpl:vFe,stringToHashBucketFastImpl:wFe,subImpl:NFe,tileImpl:kFe,topKImpl:SFe,transposeImpl:SA,uniqueImpl:CFe}=Qj;function WG(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function Ga(e,t){return t===1?[e]:WG(e,t)}function _Fe(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}var IFe=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Wa(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let t=Ga("rc",this.rank),n=ar(this.rank),r=this.getOutOfBoundsCondition(t),a=this.getSetup(t),s=this.getOutput(t);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${n===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)a=`${e[e.length-1-s]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){let t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}},VG=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length);let n="";for(let r=0;r<4;r++){let a="thisRC = rc;";r%2===1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+=`
        ${a}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${TFe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?xA():gA(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function TFe(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?WMe(["r","c","d"],"inputShape"):yp(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}var EFe=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let r=KF(t,n),a=YF(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);let s=qF(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[a].pop();return this.usedTextures[a].push(l),l}let i;return r===Ea.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Ea.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Ea.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Ea.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Ea.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),i}releaseTexture(e,t,n,r){if(this.freeTextures==null)return;let a=KF(n,r),s=YF(t,a,r);s in this.freeTextures||(this.freeTextures[s]=[]);let i=qF(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=be().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=i):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;let u=this.usedTextures[s],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function jFe(e,t){let n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function qF(e,t,n,r,a){let s=AFe(t,r),i;if(a){let[u,d]=Tg(e[0],e[1]);i=u*d}else{let[u,d]=Ub(e[0],e[1]);i=u*d}let l=jFe(n,s);return i*l}function AFe(e,t){switch(e){case Ea.PACKED_2X2_FLOAT32:return NA(t);case Ea.PACKED_2X2_FLOAT16:return kA(t);case Ea.UNPACKED_FLOAT32:return bA(t);case Ea.UNPACKED_FLOAT16:return vA(t);case Ea.PACKED_4X1_UNSIGNED_BYTE:return wA(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function RFe(e){return be().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Ea.PACKED_2X2_FLOAT32:Ea.UNPACKED_FLOAT32:e?Ea.PACKED_2X2_FLOAT16:Ea.UNPACKED_FLOAT16}function KF(e,t){if(e===Ys.UPLOAD)return Ea.PACKED_2X2_FLOAT32;if(e===Ys.RENDER||e==null)return RFe(t);if(e===Ys.DOWNLOAD||e===Ys.PIXELS)return Ea.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function YF(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}var Ro=class{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Ai="if (isnan(x)) return x;",DFe="return x;",XF="return abs(x);",MFe="return (x >= 0.0) ? x : (exp(x) - 1.0);",$Fe=Ai+`
  return (x < 0.0) ? 0.0 : x;
`,FFe=Ai+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,iu="return x;",PFe="return 1.0 / (1.0 + exp(-1.0 * x));",OFe="return x;",LFe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zFe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,BFe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,WFe="return 1.0 / (1.0 + exp(-1.0 * x));",Su=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}},VFe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length);let t=e.length,n=Ga("rc",t),r=ar(t),a=_Fe(t,n),s=n.slice(-2),i=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${i}));
      }
    `}},UFe=Qo.whereImpl,HFe=1e-7,GFe=1e-4,fS={};function qFe(e){return e in fS||(fS[e]={}),fS[e]}var KFe=be().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),YFe=600;function XFe(){return be().global.screen==null?1024:be().global.screen.height*be().global.screen.width*window.devicePixelRatio*YFe/1024/1024}var CA=class UG extends Gy{nextDataId(){return UG.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!be().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof ow)n=t;else{let r=so(be().getNumber("WEBGL_VERSION"),t);n=new ow(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let r=so(be().getNumber("WEBGL_VERSION"));n=new ow(r),this.binaryCache=qFe(be().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new EFe(this.gpgpu),this.numMBBeforeWarning=XFe(),this.texData=new a1(this,hi())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,a,s,i){let l=this.makeTensorInfo(n,r),u=this.texData.get(l.dataId);u.isPacked=!1,u.texture={texture:t,texShape:[a,s]},u.texShape=[a,s];let d=Sx(n),c=new GF(d,!1,i),h=this.runWebGLProgram(c,[l],r,[[a,s]]);return h.shape=n,u.texture=null,this.disposeIntermediateTensorInfo(l),h.dataId}write(t,n,r){if((be().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||be().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let a={id:this.nextDataId()};return this.texData.set(a,{shape:n,dtype:r,values:t,usage:Ys.UPLOAD,refCount:1}),a}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){let n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){let n=this.texData.get(t);n.refCount--}}move(t,n,r,a,s){if(be().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:a,values:n,usage:Ys.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){let n=this.texData.get(t),{values:r,dtype:a,complexTensorInfos:s,slice:i,shape:l,isPacked:u}=n;if(i!=null){let p;u?p=new Su(l,iu):p=new Ro(l,iu);let m=this.runWebGLProgram(p,[{dataId:t,shape:l,dtype:a}],a),f=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),f}if(r!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return r;let d=this.activeTimers!=null,c;d&&(c=A.now());let h;if(a==="complex64"){let p=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);h=z.mergeRealAndImagArrays(p,m)}else h=this.getValuesFromTexture(t);return d&&(this.downloadWaitMs+=A.now()-c),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){let f=this.pendingRead.get(t);return new Promise(g=>f.push(g))}let n=this.texData.get(t),{values:r,shape:a,slice:s,dtype:i,complexTensorInfos:l,isPacked:u}=n;if(s!=null){let f;u?f=new Su(a,iu):f=new Ro(a,iu);let g=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(r!=null)return this.convertAndCacheOnCPU(t);if(be().getBool("DEBUG")&&!be().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&be().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let d=null,c;if(i!=="complex64"&&be().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(t);let f=this.texData.get(c.dataId);d=this.gpgpu.createBufferFromTexture(f.texture.texture,...Av(a))}this.pendingRead.set(t,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(i==="complex64"){let f=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=f[0],x=f[1];h=z.mergeRealAndImagArrays(g,x)}else if(d==null)h=this.getValuesFromTexture(t);else{let f=A.sizeFromShape(a);h=this.gpgpu.downloadFloat32MatrixFromBuffer(d,f)}if(c!=null&&this.disposeIntermediateTensorInfo(c),d!=null){let f=this.gpgpu.gl;ut(f,()=>f.deleteBuffer(d))}let p=this.convertAndCacheOnCPU(t,h),m=this.pendingRead.get(t);return this.pendingRead.delete(t),m.forEach(f=>f(p)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&hi().removeDataId(t,this),this.pendingDeletes--),p}readToGPU(t,n={}){let r=this.texData.get(t),{values:a,shape:s,slice:i,dtype:l,isPacked:u,texture:d}=r;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let m;u?m=new Su(s,iu):m=new Ro(s,iu);let f=this.runWebGLProgram(m,[{dataId:t,shape:s,dtype:l}],l),g=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),g}if(d==null)throw a!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let c=this.decode(t,n.customTexShape),h=hi().makeTensorFromTensorInfo(c),p=this.texData.get(c.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>A.decodeString(a));return nn(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return nn(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){let r=t[n];if(!qH(r))throw be().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:n,dtype:r,isPacked:a}=this.texData.get(t),s=A.sizeFromShape(n);if(be().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let p=this.decode(t),m=this.texData.get(p.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...Av(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(p),f}let i=be().getBool("WEBGL_PACK")&&a===!0,l=i?Sx(n):n,u=i?new A$e(l):new j$e(l),d=this.runWebGLProgram(u,[{shape:l,dtype:r,dataId:t}],"float32"),c=this.texData.get(d.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(d),h}timerAvailable(){return be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){let n=this.activeTimers,r=[],a=!1;this.programTimersStack==null?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t();let s=A.flatten(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),i=A.flatten(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=n,a&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let u=await Promise.all(s);l.kernelMs=A.sum(u),l.getExtraProfileInfo=()=>u.map((d,c)=>({name:i[c],ms:d})).map(d=>`${d.name}: ${d.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:A.now(),endMs:null}}endTimer(t){return be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=A.now(),t)}async getQueryTime(t){if(be().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);let{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){let{texture:n,dtype:r,texShape:a,usage:s,isPacked:i,slice:l}=this.texData.get(t),u=l&&l.origDataId||t,d=this.dataRefCount.get(u);d>1?this.dataRefCount.set(u,d-1):(this.dataRefCount.delete(u),n!=null&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,s,i)));let c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=KFe){return be().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&A.sizeFromShape(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){z.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=t.dataSync();return UFe(t.shape,n)}packedUnaryOp(t,n,r){let a=new Su(t.shape,n),s=this.compileAndRun(a,[t],r);return hi().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let a=zG(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,a)}if(be().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XF,t.dtype);let n=new Ro(t.shape,XF),r=this.compileAndRun(n,[t]);return hi().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&A.isString(r[0])){let s=r.map(i=>A.encodeString(i));a=this.write(s,t,n)}else a=this.write(r,t,n);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:n}}makeOutput(t,n,r){return hi().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){let n=new VFe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){let n=new IFe(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){let r=[Bd(t.shape),...Wd(t.shape)],a={dtype:t.dtype,shape:r,dataId:t.dataId},s=[Bd(n),...Wd(n)],i=new VG(s,r),l=!0,u=[r],d=this.runWebGLProgram(i,[a],t.dtype,u,l);return{dataId:d.dataId,shape:n,dtype:d.dtype}}decode(t,n){let r=this.texData.get(t),{isPacked:a,shape:s,dtype:i}=r;if(n!=null){let p=A.sizeFromShape(s),m=n[0]*n[1]*4;A.assert(p<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let l=Sx(s),u;a?u=new E$e(l):u=new T$e(l);let d=!0,c=[n??Av(l)],h=this.runWebGLProgram(u,[{shape:l,dtype:i,dataId:t}],i,c,d,n);return{dtype:i,shape:s,dataId:h.dataId}}runWebGLProgram(t,n,r,a,s=!1,i){let l=this.makeTensorInfo(t.outputShape,r),u=this.texData.get(l.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===by.DENSE){let y=i??Av(t.outputShape);u.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(u.usage=t.outTexUsage),A.sizeFromShape(l.shape)===0)return u.values=A.getTypedArrayFromDType(l.dtype,0),l;let d=[],c=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&A.sizeFromShape(y.shape)<=be().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),d.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!vy(b.shape,y.shape)){let v=y,w=y.shape;y.shape=b.shape,y=this.packedReshape(y,w),d.push(y),b=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(l.dataId);let h={shape:l.shape,texData:u,isUniform:!1},p=I$e(t,c,h),m=this.getAndSaveBinary(p,()=>C$e(this.gpgpu,t,c,h)),f=this.activeTimers!=null,g;f&&(g=this.startTimer()),be().get("ENGINE_COMPILE_ONLY")||_$e(this.gpgpu,m,c,h,a),d.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));let x=be().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){let y=A.now();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!be().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){let y=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),y}return l}compileAndRun(t,n,r,a,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,a,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(be().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ce(()=>{if(!be().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=be().getBool("DEBUG");be().set("DEBUG",!1);let n=this.abs(jt(1e-8)).dataSync()[0];if(be().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?HFe:GFe}uploadToGPU(t){let n=this.texData.get(t),{shape:r,dtype:a,values:s,texture:i,usage:l,isPacked:u}=n;if(i!=null)return;let d=this.activeTimers!=null,c;d&&(c=A.now());let h=n.texShape;if(h==null&&(h=cG(r,u),n.texShape=h),s!=null){let p=Sx(r),m,f=h[1],g=h[0],x=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(u||!x)&&([f,g]=Tg(h[0],h[1])),u?m=new D$e(p,x):m=new GF(p,x);let y=x?[g,f]:h,b=this.makeTensorInfo(y,a),v=this.texData.get(b.dataId);x?v.usage=Ys.PIXELS:v.usage=Ys.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),f,g,s);let w=[[g,f]],N=this.runWebGLProgram(m,[b],a,w,!0),S=this.texData.get(N.dataId);n.texShape=S.texShape,n.isPacked=S.isPacked,n.usage=S.usage,be().get("ENGINE_COMPILE_ONLY")?this.disposeData(N.dataId):(n.texture=S.texture,n.values=null,this.texData.delete(N.dataId)),this.disposeIntermediateTensorInfo(b),d&&(this.uploadWaitMs+=A.now()-c)}else{let p=this.acquireTexture(h,l,a,u);n.texture=p}}convertAndCacheOnCPU(t,n){let r=this.texData.get(t),{dtype:a}=r;return n!=null&&(r.values=ZFe(n,a)),r.values}acquireTexture(t,n,r,a){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,a)}computeBytes(t,n){return t[0]*t[1]*A.bytesPerElement(n)}checkCompileCompletion(){for(let[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){let t=[];if(this.gpgpu.parallelCompilationExtension){for(let[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(let[,n]of Object.entries(this.binaryCache)){let r=new Promise(a=>{try{this.checkCompletion_(n),a(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await mE(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(fA(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);let{variablesLocations:n,customUniformLocations:r,infLoc:a,nanLoc:s,outShapeLocation:i,outShapeStridesLocation:l,outTexShapeLocation:u}=wG(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=a,t.nanLoc=s,t.outShapeLocation=i,t.outShapeStridesLocation=l,t.outTexShapeLocation=u}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";let{texture:a,height:s,width:i,channels:l}=t,u=hi().backend;if(!u.gpgpu.gl.isTexture(a))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let d=u.writeTexture(a,n,r,s,i,l);return hi().makeTensorFromDataId(d,n,r,u)}};CA.nextDataId=0;function ZFe(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){let n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}var QFe="4.22.0";function HG(){be().set("WEBGL_FORCE_F16_TEXTURES",!0)}yb.isBrowser()&&N1("webgl",()=>new CA,2);var JFe={forceHalfFloat:HG},_A=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Vd=class{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=z.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Wa(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}},vp=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,Mg=class{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=z.assertAndGetBroadcastShape(t,n);let a=this.outputShape.length;this.enableShapeUniforms=Wa(a);let s="";if(r)if(a===0||A.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${ar(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let i=Ga("coords",a);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${i[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${i[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${i[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${i[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function Ls(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var ePe={kernelName:Nh,backendName:"webgl",kernelFunc:Ls};function mc(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.makeTensorInfo(r.shape,"complex64"),i=n.texData.get(s.dataId),l=Ls({inputs:{x:r},backend:n}),u=Ls({inputs:{x:a},backend:n});return i.complexTensorInfos={real:l,imag:u},s}var tPe={kernelName:o1,backendName:"webgl",kernelFunc:mc},GG="return (a < 0.) ? b * a : a;",qG=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function nPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r,i=n.makeTensorInfo([],"float32",A.createScalarValue(s,"float32")),l=be().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mg(qG,a.shape,i.shape):new Vd(GG,a.shape,i.shape),u=n.runWebGLProgram(l,[a,i],"float32");return n.disposeIntermediateTensorInfo(i),u}var rPe={kernelName:_h,backendName:"webgl",kernelFunc:nPe},KG="return (a < 0.) ? b * a : a;",YG=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function aPe(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=be().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mg(YG,r.shape,a.shape):new Vd(KG,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],"float32")}var sPe={kernelName:Wh,backendName:"webgl",kernelFunc:aPe},$g="if (isnan(x)) return x;";function In({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:s})=>{let{x:i}=a,l=s,u=r||i.dtype;if(l.shouldExecuteOnCPU([i])&&n!=null){let h=l.texData.get(i.dataId),p=n(h.values,u);return l.makeTensorInfo(i.shape,u,p)}let d=be().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,c;return d?c=new Su(i.shape,t):c=new Ro(i.shape,e),l.runWebGLProgram(c,[i],u)}}function Ra({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:s}){return({inputs:i,backend:l})=>{let{a:u,b:d}=i,c=l;if(r&&u.dtype==="complex64"){let f=c.texData.get(u.dataId),g=c.texData.get(d.dataId),[x,y]=[[f.complexTensorInfos.real,g.complexTensorInfos.real],[f.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{let[w,N]=v,S={dataId:w.dataId,dtype:w.dtype,shape:u.shape},C={dataId:N.dataId,dtype:N.dtype,shape:d.shape},_=new Vd(e,u.shape,d.shape);return c.runWebGLProgram(_,[S,C],ni(w.dtype,N.dtype))}),b=mc({inputs:{real:x,imag:y},backend:c});return c.disposeIntermediateTensorInfo(x),c.disposeIntermediateTensorInfo(y),b}let h=s||ni(u.dtype,d.dtype);if((u.dtype==="string"||d.dtype==="string"||c.shouldExecuteOnCPU([u,d]))&&a!=null){let f=c.texData.get(u.dataId).values,g=c.texData.get(d.dataId).values,x=u.dtype==="string"?z.fromUint8ToStringArray(f):f,y=u.dtype==="string"?z.fromUint8ToStringArray(g):g,[b,v]=a(u.shape,d.shape,x,y,h),w=c.makeTensorInfo(v,h),N=c.texData.get(w.dataId);return N.values=b,w}let p=be().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,m;return p?m=new Mg(t,u.shape,d.shape,n):m=new Vd(e,u.shape,d.shape),c.runWebGLProgram(m,[u,d],h)}}function wy(e,t=!1){if(e==="linear")return t?OFe:DFe;if(e==="relu")return t?zFe:$Fe;if(e==="elu")return t?LFe:MFe;if(e==="relu6")return t?BFe:FFe;if(e==="prelu")return t?YG:KG;if(e==="leakyrelu")return t?qG:GG;if(e==="sigmoid")return t?WFe:PFe;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}var XG=class{constructor(e,t,n,r=!1,a=!1,s=!1,i=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Wa(this.outputShape.length);let d=r?e[1]:e[2],c=Math.ceil(d/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";i&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${i}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${i}
        }`:g=`vec4 activation(vec4 x) {
          ${i}
        }`,x="result = activation(result);");let y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(v=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${c}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${v};
        for (int i = 0; i < ${c}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${f[0]});
          result += (${m[1]} * ${f[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${x}

        setOutput(result);
      }
    `}},ZF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},QF=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=z.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}},JF="return a * b;";function IA(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=z.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){let l=n.texData.get(r.dataId),u=n.texData.get(a.dataId),d=new QF(ZF.REAL,r.shape,a.shape),c=new QF(ZF.IMAG,r.shape,a.shape),h=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:a.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:a.shape}],p=n.runWebGLProgram(d,h,"float32"),m=n.runWebGLProgram(c,h,"float32"),f=mc({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}if(n.shouldExecuteOnCPU([r,a])){let l=n.texData.get(r.dataId),u=n.texData.get(a.dataId),[d,c]=nFe(r.shape,a.shape,l.values,u.values,s),h=n.makeTensorInfo(c,s),p=n.texData.get(h.dataId);return p.values=d,h}let i;return be().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Mg(JF,r.shape,a.shape):i=new Vd(JF,r.shape,a.shape),n.runWebGLProgram(i,[r,a],s)}var iPe={kernelName:Oh,backendName:"webgl",kernelFunc:IA};function oPe(e,t,n){let r=[Bd(e.shape),...Wd(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},s=[Bd(t),...Wd(t)],i=new VG(s,r),l=!0,u=[r],d=n.runWebGLProgram(i,[a],e.dtype,u,l);return{dataId:d.dataId,shape:t,dtype:d.dtype}}function st(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,i=n,l=A.sizeFromShape(a.shape),u=A.inferFromImplicitShape(s,l),d=A.sizeFromShape(u);A.assert(l===d,()=>`The new shape (${u}) has ${d} elements and the old shape (${a.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);let c=i.texData.get(a.dataId);return c.isPacked&&!vy(a.shape,u)&&!(c.texture!==null&&vy(c.shape,u))?oPe(a,u,i):(i.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var lPe={kernelName:Jf,backendName:"webgl",kernelFunc:st},eP=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let i=Math.floor(n/4)*4,l=n%4,u="sumValue += dot(values, ones);";if(t!=null){let c=1/t;u=`sumValue += dot(values * ${A.isInt(c)?c.toPrecision(2):c}, ones);`}let d="";a%n>0&&(d=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${i}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${i};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}},uPe=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let i="0.0",l="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",l="min"):t==="max"&&(i="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");let d=Math.floor(n/4)*4,c=n%4,h=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(i="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(i="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let m="";a%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${i};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${i});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${d};
        if (${c===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${c===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${c===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${u});
      }
    `}};function cPe(e){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let n=t.length?t[t.length-1].outSize:e[1],r=z.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function wp(e,t,n,r){let a=cPe(e.shape),s=e;for(let i=0;i<a.length;i++){let{inSize:l,windowSize:u,outSize:d}=a[i],c,h;n==="mean"?c=i===0?new eP({windowSize:u,inSize:l,batchSize:e.shape[0],outSize:d},l):new eP({windowSize:u,inSize:l,batchSize:e.shape[0],outSize:d}):c=new uPe({windowSize:u,inSize:l,batchSize:e.shape[0],outSize:d},n),h=s,s=r.runWebGLProgram(c,[s],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return s}var dPe=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[t[s]];this.outputShape=n,this.rank=n.length;let r=ar(this.rank),a=hPe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}};function hPe(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}var pPe=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let d=0;d<n.length;d++)n[d]=e[t[d]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let r=ar(this.rank),a=WG("rc",this.rank),s=new Array(this.rank);for(let d=0;d<t.length;d++)s[t[d]]=a[d];let i=`vec2(${s.slice(-2).join()})`,l=`++${a[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${s.join()}), ${i})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}};function IN(e,t,n){let r=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pPe(e.shape,t):new dPe(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function mPe(e,t,n,r){let a=t,s=e.shape.length,i=A.parseAxisParam(a,e.shape),l=i,u=z.getAxesPermutation(l,s),d=u!=null,c=e;d&&(c=IN(e,u,r),l=z.getInnerMostAxes(l.length,s)),z.assertAxesAreInnerMostDims("sum",l,s);let[h,p]=z.computeOutAndReduceShapes(c.shape,l),m=h;n&&(m=z.expandShapeToKeepDim(h,i));let f=A.sizeFromShape(p),g=A.sizeFromShape(e.shape)/f,x=st({inputs:{x:c},attrs:{shape:[g,f]},backend:r}),y=w1(e.dtype),b=wp(x,y,"sum",r),v=st({inputs:{x:b},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(b),d&&r.disposeIntermediateTensorInfo(c),v}function TN(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r;return mPe(a,s,i,n)}var fPe={kernelName:sp,backendName:"webgl",kernelFunc:TN};function Xa(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:s}=r,i=n,l=a.shape.length,u=new Array(l);for(let c=0;c<u.length;c++)u[c]=a.shape[s[c]];let d;if(i.shouldExecuteOnCPU([a])){let c=i.texData.get(a.dataId).values,h=SA(c,a.shape,a.dtype,s,u);d=i.makeTensorInfo(u,a.dtype);let p=i.texData.get(d.dataId);p.values=h}else d=IN(a,s,i);return d}var gPe={kernelName:vl,backendName:"webgl",kernelFunc:Xa},ZG=1e3;function k0({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:l=0,activation:u=null}){let d=e.shape.length,c=t.shape.length,h=n?e.shape[d-2]:e.shape[d-1],p=r?t.shape[c-1]:t.shape[c-2],m=n?e.shape[d-1]:e.shape[d-2],f=r?t.shape[c-2]:t.shape[c-1],g=e.shape.slice(0,-2),x=t.shape.slice(0,-2),y=A.sizeFromShape(g),b=A.sizeFromShape(x),v=xg.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([m,f]);A.assert(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);let w=n?[y,h,m]:[y,m,h],N=r?[b,f,p]:[b,p,f],S=st({inputs:{x:e},backend:a,attrs:{shape:w}}),C=st({inputs:{x:t},backend:a,attrs:{shape:N}}),_=[S,C],T=Math.max(y,b),E=n?S.shape[1]:S.shape[2],j=s!=null,I=i!=null,D=u==="leakyrelu",F=u!=null?wy(u,!0):null,P=j||I||D||F!=null,V;if((m===1||f===1)&&E>ZG&&P===!1){let O=S,L=C;n&&(O=Xa({inputs:{x:S},backend:a,attrs:{perm:[0,2,1]}}),_.push(O)),r&&(L=Xa({inputs:{x:C},backend:a,attrs:{perm:[0,2,1]}}),_.push(L));let q=f!==1,U=f===1,ee=O;q&&(ee=st({inputs:{x:O},backend:a,attrs:{shape:[T,E,1]}}),_.push(ee));let M=f===1?2:1,G=L;U&&(G=st({inputs:{x:L},backend:a,attrs:{shape:[T,1,E]}}),_.push(G));let J=IA({inputs:{a:ee,b:G},backend:a});V=TN({inputs:{x:J},backend:a,attrs:{axis:M,keepDims:!0}}),_.push(J)}else{let O=ni(e.dtype,t.dtype),L=new XG(w,N,[T,m,f],n,r,j,F,I,D),q=[S,C];if(s!=null&&q.push(s),I&&q.push(i),D){let U=a.makeTensorInfo([],"float32",A.createScalarValue(l,"float32"));q.push(U),_.push(U)}V=a.runWebGLProgram(L,q,O)}let $=st({inputs:{x:V},backend:a,attrs:{shape:v}});_.push(V);for(let O of _)a.disposeIntermediateTensorInfo(O);return $}function xPe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:l}=t,{transposeA:u,transposeB:d,activation:c,leakyreluAlpha:h}=r;return k0({a,b:s,transposeA:u,transposeB:d,backend:n,bias:i,preluActivationWeights:l,leakyreluAlpha:h,activation:c})}var yPe={kernelName:_d,backendName:"webgl",kernelFunc:xPe},tP="return abs(x);";function bPe(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let s=n.texData.get(r.dataId),i=zG(s.values);return n.makeTensorInfo(r.shape,r.dtype,i)}let a;return be().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Su(r.shape,tP):a=new Ro(r.shape,tP),n.runWebGLProgram(a,[r],r.dtype)}var vPe={kernelName:ff,backendName:"webgl",kernelFunc:bPe},wPe=Ai+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,NPe=In({opSnippet:wPe}),kPe={kernelName:qd,backendName:"webgl",kernelFunc:NPe},SPe=Ai+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,CPe=In({opSnippet:SPe}),_Pe={kernelName:Kd,backendName:"webgl",kernelFunc:CPe},nP="return a + b;",IPe=Ra({opSnippet:nP,packedOpSnippet:nP,supportsComplex:!0,cpuKernelImpl:$$e}),TPe={kernelName:ac,backendName:"webgl",kernelFunc:IPe},EPe=class{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`float v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}},jPe=class{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`vec4 v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}};function lw(e){let{inputs:t,backend:n}=e,r=t;if(r.length===1)return Ls({inputs:{x:r[0]},backend:n});if(r.length>be().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),u=lw({inputs:r.slice(0,l),backend:n}),d=lw({inputs:r.slice(l),backend:n});return lw({inputs:[u,d],backend:n})}let a=r.map(l=>l.dtype).reduce((l,u)=>ni(l,u)),s=r.map(l=>l.shape),i=be().getBool("WEBGL_PACK")?new jPe(r[0].shape,s):new EPe(r[0].shape,s);return n.runWebGLProgram(i,r,a)}var APe={kernelName:Yd,backendName:"webgl",kernelFunc:lw};function RPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,l=a.shape.length,u=A.parseAxisParam(s,a.shape),d=u,c=z.getAxesPermutation(d,l),h=a;c!=null&&(h=Xa({inputs:{x:a},backend:n,attrs:{perm:c}}),d=z.getInnerMostAxes(d.length,l)),z.assertAxesAreInnerMostDims("all",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=A.sizeFromShape(m),g=st({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=wp(g,g.dtype,"all",n),y;if(i){let b=z.expandShapeToKeepDim(p,u);y=st({inputs:{x},backend:n,attrs:{shape:b}})}else y=st({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(h),y}var DPe={kernelName:gf,backendName:"webgl",kernelFunc:RPe};function MPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,l=a.shape.length,u=A.parseAxisParam(s,a.shape),d=u,c=z.getAxesPermutation(d,l),h=a;c!=null&&(h=Xa({inputs:{x:a},backend:n,attrs:{perm:c}}),d=z.getInnerMostAxes(d.length,l)),z.assertAxesAreInnerMostDims("any",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=A.sizeFromShape(m),g=st({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=wp(g,g.dtype,"any",n),y;if(i){let b=z.expandShapeToKeepDim(p,u);y=st({inputs:{x},backend:n,attrs:{shape:b}})}else y=st({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(h),y}var $Pe={kernelName:xf,backendName:"webgl",kernelFunc:MPe},FPe=class{constructor(e,t,n){this.variableNames=["A"];let{windowSize:r,batchSize:a,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];let i=t==="max"?">":"<",l=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${i} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}},PPe=class{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");let i=this.outputShape,l=i.length,u=ar(l),d=Ga("coords",l),c,h;if(s===1){h=l+1;let C=ar(h);c=`
        ${C} sourceLocR = ${C}(${d.join()}, 0);
        ++${d[l-1]};
        ${C} sourceLocG = ${C}(${d.join()}, 0);
        ++${d[l-2]};
        ${C} sourceLocA = ${C}(${d.join()}, 0);
        --${d[l-1]};
        ${C} sourceLocB = ${C}(${d.join()}, 0);
        --${d[l-2]};`}else h=l,c=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;let p=["x","y","z","w","u","v"].slice(0,h),m="."+p[h-1],f=p.map(C=>"int "+C),g=Ga("sourceLocR",h-1).concat("inIdx.r"),x=Ga("sourceLocG",h-1).concat("inIdx.g"),y=Ga("sourceLocB",h-1).concat("inIdx.b"),b=Ga("sourceLocA",h-1).concat("inIdx.a"),v=n==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()})));`,N=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,S=r?"":`
      float getBestIndicesAChannel(${f.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${f.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${S}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${i[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${i[l-2]-1};
        ${c}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function QG(e,t,n,r=null){let a=t.shape[0],s=t.shape[1];r!=null&&(a=r.shape[0],s=r.shape[1]);let i=z.computeOptimalWindowSize(s),l={windowSize:i,inSize:s,batchSize:a,outSize:Math.ceil(s/i)},u=new FPe(l,n,r==null),d=[t];r!=null&&d.push(r);let c=e.runWebGLProgram(u,d,"int32");if(c.shape[1]===1)return c;let h=QG(e,t,n,c);return e.disposeIntermediateTensorInfo(c),h}function JG(e,t,n,r=null){let a=r!=null?r.shape:t.shape,s=a[a.length-1],i=z.computeOptimalWindowSize(s),l=new PPe(a,i,n,r==null),u=r==null?[t]:[t,r],d=e.runWebGLProgram(l,u,"int32");if(d.shape.length===t.shape.length){let c=JG(e,t,n,d);return e.disposeIntermediateTensorInfo(d),c}return d}function e9(e,t,n,r){let a=[n];if(z.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!be().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let s=[],i=e.texData.get(t.dataId),l=i!==null&&i.isPacked,u=t;l&&(u=e.unpackTensor(t),s.push(u));let[d,c]=z.computeOutAndReduceShapes(u.shape,a),h=A.sizeFromShape(c),p=st({inputs:{x:u},backend:e,attrs:{shape:[-1,h]}});s.push(p);let m=QG(e,p,r);s.push(m);let f=st({inputs:{x:m},backend:e,attrs:{shape:d}});return s.forEach(g=>e.disposeIntermediateTensorInfo(g)),f}return JG(e,t,r)}function OPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,i=A.parseAxisParam(s,a.shape),l=z.getAxesPermutation(i,a.shape.length),u=a,d=[];l!=null&&(u=Xa({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(u),i=z.getInnerMostAxes(i.length,u.shape.length)),z.assertAxesAreInnerMostDims("argMax",[i[0]],u.shape.length);let c=e9(n,u,i[0],"max");return d.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}var LPe={kernelName:yf,backendName:"webgl",kernelFunc:OPe};function zPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,i=A.parseAxisParam(s,a.shape),l=z.getAxesPermutation(i,a.shape.length),u=a,d=[];l!=null&&(u=Xa({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(u),i=z.getInnerMostAxes(i.length,u.shape.length)),z.assertAxesAreInnerMostDims("argMin",[i[0]],u.shape.length);let c=e9(n,u,i[0],"min");return d.forEach(h=>n.disposeIntermediateTensorInfo(h)),c}var BPe={kernelName:bf,backendName:"webgl",kernelFunc:zPe},WPe=Ai+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,VPe=In({opSnippet:WPe}),UPe={kernelName:Xd,backendName:"webgl",kernelFunc:VPe},HPe=Ai+"return log(x + sqrt(x * x + 1.0));",GPe=In({opSnippet:HPe}),qPe={kernelName:Zd,backendName:"webgl",kernelFunc:GPe},KPe=Ai+`
  return atan(x);
`,YPe=In({opSnippet:KPe}),XPe={kernelName:Qd,backendName:"webgl",kernelFunc:YPe},ZPe=_A+`
  return atan(a, b);
`,QPe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+vp+`
  return result;
`,JPe=Ra({opSnippet:ZPe,packedOpSnippet:QPe}),e3e={kernelName:eh,backendName:"webgl",kernelFunc:JPe},t3e=Ai+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,n3e=In({opSnippet:t3e}),r3e={kernelName:Jd,backendName:"webgl",kernelFunc:n3e},Ny=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,i=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,c=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;let f=t==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(f||(y="-1.0 / 1e-20"),n){let C=">=";this.userCode=`
        const ivec2 strides = ivec2(${i}, ${l});
        const ivec2 pads = ivec2(${p}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${c};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${C} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?a?g:x:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(v="avgValue / max(count, 1.0)");let w=Math.floor(s/4)*4,N=s%4,S=`
      if (${f}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${l});
      const ivec2 pads = ivec2(${p}, ${m});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${c};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${S}
          }

          int xC = xCCorner + ${w};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${S}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${S}
          }
        }
        setOutput(${v});
      }
    `}},TA=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,i=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,c=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=e.padInfo.front,x=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b=t==="avg",v="0.0";if(b||(v="-1.0 / 1e-20"),n){let T=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${i}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${x}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${c}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${f};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${T} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${f} +
                      wR * ${f} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let w="max",N=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(N="avgValue / max(count, 1.0)");let S=Math.floor(s/4)*4,C=s%4,_=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${i}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${S}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${_}
            }

            int xC = xCCorner + ${S};
            if (${C===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${C===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${C===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${_}
            }
          }
        }
        setOutput(${N});
      }
    `}};function a3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Eg(a,"avgPool");let{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=r,d=1;A.assert(z.eitherStridesOrDilationsAreOne(i,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let c=z.computePool2DInfo(a.shape,s,i,d,l,u);if(c.filterWidth===1&&c.filterHeight===1&&A.arraysEqual(c.inShape,c.outShape))return Ls({inputs:{x:a},backend:n});let h=new Ny(c,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}var s3e={kernelName:th,backendName:"webgl",kernelFunc:a3e};function i3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u,dataFormat:d}=r,c=[1,1,1],h=z.computePool3DInfo(a.shape,s,i,c,l,u,d),p=new TA(h,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}var o3e={kernelName:vf,backendName:"webgl",kernelFunc:i3e},l3e=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,i=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,c=u-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${c});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${i}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},u3e=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,c=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=c-1-e.padInfo.front,f=h-1-e.padInfo.top,g=p-1-e.padInfo.left,x=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${f}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function c3e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s,{filterSize:l,strides:u,pad:d,dimRoundingMode:c}=r,h=[1,1,1],p=z.computePool3DInfo(i.shape,l,u,h,d,c),m=new u3e(p);return n.runWebGLProgram(m,[a],i.dtype)}var d3e={kernelName:Yy,backendName:"webgl",kernelFunc:c3e};function h3e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s;Eg([a,s],"avgPoolGrad");let{filterSize:l,strides:u,pad:d}=r,c=z.computePool2DInfo(i.shape,l,u,1,d),h=new l3e(c);return n.runWebGLProgram(h,[a],i.dtype)}var p3e={kernelName:Ky,backendName:"webgl",kernelFunc:h3e};function m3e(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:l}=r;return k0({a,b:s,transposeA:i,transposeB:l,backend:n})}var f3e={kernelName:nh,backendName:"webgl",kernelFunc:m3e},g3e=class{constructor(e,t,n,r,a,s){this.outputShape=[],this.variableNames=["x","mean","variance"],z.assertAndGetBroadcastShape(e,t),z.assertAndGetBroadcastShape(e,n);let i="0.0";r!=null&&(z.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let l="1.0";a!=null&&(z.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${i};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}},x3e=class{constructor(e,t,n,r,a,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],z.assertAndGetBroadcastShape(e,t),z.assertAndGetBroadcastShape(e,n);let i="vec4(0.0)";r!=null&&(z.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");let l="vec4(1.0)";a!=null&&(z.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${i};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}},y3e=({inputs:e,backend:t,attrs:n})=>{let{x:r,mean:a,variance:s,offset:i,scale:l}=e;A.assert(a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A.assert(l==null||a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:u}=n;u==null&&(u=.001);let d=[r,a,s],c=null;i!=null&&(c=i.shape,d.push(i));let h=null;l!=null&&(h=l.shape,d.push(l));let p=be().getBool("WEBGL_PACK_NORMALIZATION")?new x3e(r.shape,a.shape,s.shape,c,h,u):new g3e(r.shape,a.shape,s.shape,c,h,u);return t.runWebGLProgram(p,d,d[0].dtype)},b3e={kernelName:vh,backendName:"webgl",kernelFunc:y3e},v3e=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let t=ar(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=w3e(this.rank),r,a=e.map((s,i)=>`sourceLoc.${OC[i]} = start[${i}] + coords.${OC[i]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${n}));
      }
    `}},OC=["x","y","z","w","u","v"];function w3e(e){if(e===1)return"sourceLoc";if(e<=6)return OC.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}var N3e=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=ar(this.rank),n=Ga("coords",this.rank),r=Ga("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${a})`,i=`
      result.x = ${s};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${s};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${s};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${s};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,c)=>`start[${c}]`).join()});`:e.map((d,c)=>`${r[c]} = ${n[c]} + start[${c}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${i}
        ${l}
        setOutput(result);
      }
    `}};function k3e(e,t,n,r){let a=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),i=r.texData.get(s.dataId);Object.assign(i,a),i.refCount=1,i.shape=n,i.dtype=e.dtype;let l=ea.computeFlatOffset(t,A.computeStrides(e.shape));a.slice&&(l+=a.slice.flatOffset),i.slice={flatOffset:l,origDataId:a.slice&&a.slice.origDataId||e.dataId};let u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),s}function Fg(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:i}=r,[l,u]=ea.parseSliceParams(a,s,i);if(ea.assertParamsValid(a,l,u),A.sizeFromShape(u)===0)return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||a.dtype==="string"){let h=n.texData.get(a.dataId),p=pFe(h.values,l,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,p)}let{isPacked:d}=n.texData.get(a.dataId),c=ea.isSliceContinous(a.shape,l,u);if(d||!c){let h=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new N3e(u):new v3e(u),p=[l];return n.runWebGLProgram(h,[a],a.dtype,p)}return n.uploadToGPU(a.dataId),k3e(a,l,u,n)}var S3e={kernelName:ig,backendName:"webgl",kernelFunc:Fg},C3e=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r;A.assert(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let l=s.reduce((b,v)=>b*v),u=z.getReshaped(a.shape,s,l),d=z.getPermuted(u.length,s.length),c=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(i,s.length),p=z.getSliceSize(c,i,s.length),m=[],f=st({inputs:{x:a},backend:n,attrs:{shape:u}}),g=Xa({inputs:{x:f},backend:n,attrs:{perm:d}}),x=st({inputs:{x:g},backend:n,attrs:{shape:c}}),y=Fg({inputs:{x},backend:n,attrs:{begin:h,size:p}});return m.push(f),m.push(g),m.push(x),m.forEach(b=>n.disposeIntermediateTensorInfo(b)),y},_3e={kernelName:wf,backendName:"webgl",kernelFunc:C3e};function I3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i}=r,l=n.readSync(a.dataId),u=n.readSync(s.dataId),d=LG(l,u,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,d)}var T3e={kernelName:Nf,backendName:"webgl",kernelFunc:I3e},E3e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,j3e=`
  return float(int(a.r) & int(b.r));
`;function A3e(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=be().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=be().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||i===1){let u=n.texData.get(r.dataId).values,d=n.texData.get(a.dataId).values,[c,h]=P$e(r.shape,a.shape,u,d,r.dtype),p=n.makeTensorInfo(h,r.dtype),m=n.texData.get(p.dataId);return m.values=c,p}let l;return s?l=new Mg(E3e,r.shape,a.shape,!1):l=new Vd(j3e,r.shape,a.shape),n.runWebGLProgram(l,[r,a],r.dtype)}var R3e={kernelName:kf,backendName:"webgl",kernelFunc:A3e};function D3e(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.readSync(r.dataId),i=n.readSync(a.dataId),l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeTensorInfo([l.length],"int32",Int32Array.from(l))}var M3e={kernelName:Xy,backendName:"webgl",kernelFunc:D3e},$3e="return float(a != b);",t9=Ra({opSnippet:$3e,cpuKernelImpl:aFe,dtype:"bool"}),F3e={kernelName:qf,backendName:"webgl",kernelFunc:t9};function Gb(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Ls({inputs:{x:a.complexTensorInfos.real},backend:n})}var P3e={kernelName:b1,backendName:"webgl",kernelFunc:Gb},O3e="return float(int(x));";function L3e(e,t){let n=new Ro(e.shape,O3e),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function LC(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return Ls({inputs:{x:a},backend:n});let i=Nr(a.shape),l=LC({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=mc({inputs:{real:l,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(l),u}if(a.dtype==="complex64"){let i=Gb({inputs:{input:a},backend:n}),l=LC({inputs:{x:i},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(i),l}if(!A.hasEncodingLoss(a.dtype,s)){let i=Ls({inputs:{x:a},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(n.shouldExecuteOnCPU([a])){let i=n.texData.get(a.dataId).values,[l,u,d]=O$e(i,a.shape,a.dtype,s);return n.makeTensorInfo(l,u,d)}if(s==="int32")return L3e(a,n);if(s==="bool"){let i=n.makeTensorInfo([],"bool",A.getTypedArrayFromDType("bool",1)),l=t9({inputs:{a,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${s}`)}var z3e={kernelName:rh,backendName:"webgl",kernelFunc:LC},rP="return ceil(x);",B3e=In({opSnippet:rP,packedOpSnippet:rP,cpuKernelImpl:L$e}),W3e={kernelName:ah,backendName:"webgl",kernelFunc:B3e},V3e=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}},U3e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function H3e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:i}=r,l;be().getBool("WEBGL_PACK_CLIP")?l=new U3e(a.shape):l=new V3e(a.shape);let u=[[s],[i]];return n.runWebGLProgram(l,[a],a.dtype,u)}var G3e={kernelName:sc,backendName:"webgl",kernelFunc:H3e},q3e=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function aP(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function K3e(e){let{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),s=new q3e(r.shape),i=[aP(r,a.complexTensorInfos.real),aP(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(s,i,i[0].dtype)}var Y3e={kernelName:Zy,backendName:"webgl",kernelFunc:K3e},X3e=class{constructor(e){this.outputShape=[],this.outputShape=z.computeOutShape(e,1),this.variableNames=e.map((s,i)=>`T${i}`);let t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<t.length;s++){let i=t[s-1];n.push(`else if (yC < ${t[s]}) setOutput(getT${s}(yR, yC-${i}));`)}let r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}},Z3e=class{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=z.computeOutShape(e,t);let n=this.outputShape,r=n.length,a=ar(r),s=Ga("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((f,g)=>`T${g}`);let l=new Array(e.length-1);l[0]=e[0][t];for(let f=1;f<l.length;f++)l[f]=l[f-1]+e[f][t];let u=i[t],d=i.slice(-2),c=i.join(),h=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${c}), vec2(${d.join()}));
        }`;for(let f=1;f<l.length;f++){let g=l[f-1];h+=`
        if (${u} < ${l[f]}  && ${u} >= ${l[f-1]}) {
          return getChannel(
            getT${f}(${Dv(i,u,g)}),
            vec2(${Dv(d,u,g)}));
        }`}let p=l.length,m=l[l.length-1];h+=`
        return getChannel(
          getT${p}(${Dv(i,u,m)}),
          vec2(${Dv(d,u,m)}));`,this.userCode=`
      float getValue(${i.map(f=>"int "+f)}) {
        ${h}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[r-1]} = ${s[r-1]} + 1;
        if (${s[r-1]} < ${n[r-1]}) {
          result.g = getValue(${s});
        }

        ${s[r-2]} = ${s[r-2]} + 1;
        if (${s[r-2]} < ${n[r-2]}) {
          result.a = getValue(${s});
        }

        ${s[r-1]} = ${s[r-1]} - 1;
        if (${s[r-2]} < ${n[r-2]} &&
            ${s[r-1]} < ${n[r-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function Dv(e,t,n){let r=e.indexOf(t);return e.map((a,s)=>s===r?`${a} - ${n}`:a).join()}function EN(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Ls({inputs:{x:a.complexTensorInfos.imag},backend:n})}var Q3e={kernelName:f1,backendName:"webgl",kernelFunc:EN};function Cx(e,t,n){let r=e[0].dtype;if(r==="complex64"){let m=e.map(b=>Gb({inputs:{input:b},backend:n})),f=e.map(b=>EN({inputs:{input:b},backend:n})),g=Cx(m,t,n),x=Cx(f,t,n),y=mc({inputs:{real:g,imag:x},backend:n});return m.forEach(b=>n.disposeIntermediateTensorInfo(b)),f.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),y}let a=n.shouldExecuteOnCPU(e);if(r==="string"&&(a=!0),a){let m=e.map(w=>{let N=[-1,A.sizeFromShape(w.shape.slice(t))];return st({inputs:{x:w},backend:n,attrs:{shape:N}})}),f=m.map(w=>({vals:n.readSync(w.dataId),shape:w.shape})),g=z.computeOutShape(m.map(w=>w.shape),1),x=m[0].shape[0]===1,y=z$e(f,g,r,x),b=z.computeOutShape(e.map(w=>w.shape),t),v=n.makeTensorInfo(b,r,y);return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}let s=e.filter(m=>A.sizeFromShape(m.shape)>0),i=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let m=i?new Ro(e[0].shape,iu):new Su(e[0].shape,iu);return n.runWebGLProgram(m,e,r)}let l=be().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>l){let m=[];for(let g=0;g<s.length;g+=l){let x=s.slice(g,g+l);m.push(Cx(x,t,n))}let f=Cx(m,t,n);for(let g of m)n.disposeIntermediateTensorInfo(g);return f}if(i){let m=new Z3e(s.map(f=>f.shape),t);return n.runWebGLProgram(m,s,r)}let{tensors2D:u,outShape:d}=J3e(s,t,n),c=new X3e(u.map(m=>m.shape)),h=n.runWebGLProgram(c,u,r);u.forEach(m=>n.disposeIntermediateTensorInfo(m));let p=st({inputs:{x:h},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(h),p}function J3e(e,t,n){let r=z.computeOutShape(e.map(a=>a.shape),t);return{tensors2D:e.map(a=>st({inputs:{x:a},attrs:{shape:[-1,A.sizeFromShape(a.shape.slice(t))]},backend:n})),outShape:r}}function n9(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=A.parseAxisParam(a,t[0].shape)[0],i=t.map(d=>d.shape);z.assertParamsConsistent(i,s);let l=z.computeOutShape(t.map(d=>d.shape),s);if(A.sizeFromShape(l)===0)return n.makeTensorInfo(l,t[0].dtype,[]);let u=t.filter(d=>A.sizeFromShape(d.shape)>0);return u.length===1?Ls({inputs:{x:u[0]},backend:n}):Cx(u,s,n)}var eOe={kernelName:Sf,backendName:"webgl",kernelFunc:n9},r9=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let s=e.padInfo.top,i=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,c=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,f=e.inChannels%4,g=e.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,b=g?3:1,v="",w="";n&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:v=`
          float activation(float x) {
            ${n}
          }
        `,w="result = activation(result);");let N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${c};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${f===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${f===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${f===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${w}
        setOutput(result);
      }
    `}},tOe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,c=e.filterDepth,h=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,f=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${s}, ${i});
      const ivec3 pads = ivec3(${t}, ${n}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${c}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${f===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${f===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${f===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},a9=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Wa(this.outputShape.length);let s=e.padInfo.left,i=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,c=d,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<d;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<d;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(c+1)/2;g++){let x=g*2;if(h+=`
           xC = xCCorner + ${x*l};
           `,i===1){if(x<d&&(s%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,l===1&&x>0?h+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<d)){let y=s%2===0?A.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:h+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):y===1?h+=`
                     xC${x+1} = xTexelC${x};
                     `:h+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<d&&(s%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<d&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<d&&(h+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<d&&(h+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<d&&(h+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let p="",m="";n&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:a?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:p=`vec4 activation(vec4 x) {
           ${n}
         }`,m="result = activation(result);");let f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${f}
         ${m}
         setOutput(result);
       }
     `}},nOe=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Wa(this.outputShape.length);let{dataFormat:n}=t,r=ts(),a=n==="channelsLast",s=a?1:2,i=a?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,u="";for(let d=0;d<=1;d++)for(let c=0;c<=1;c++)u+=`
          blockIndex = rc.z + ${c};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${i}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+c}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+c}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}};function S0(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function s9({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:l=null}){let u=e.shape,d=r.texData.get(e.dataId),c=n.inChannels,h=u[0]*u[1]*u[2],p=n.outChannels,m=n.dataFormat==="channelsLast",f=!1,g=!1,x,y=[];if(s!=null){let b=S0(s.shape,m);b!=null&&(s=st({inputs:{x:s},backend:r,attrs:{shape:b}}),y.push(s))}if(a!=null){let b=S0(a.shape,m);b!=null&&(a=st({inputs:{x:a},backend:r,attrs:{shape:b}}),y.push(a))}if(!((h===1||p===1)&&c>ZG)&&d.isPacked&&m&&d.texture!=null&&u[2]%2!==0&&A.arraysEqual(d.shape.slice(-3),u.slice(-3))){let b=u[0]*u[1]*(u[2]+1),v={dataId:e.dataId,shape:[1,b,n.inChannels],dtype:e.dtype},w=d.shape;d.shape=d.shape.slice(),d.shape[d.shape.length-2]++,A.assert(vy(d.shape,v.shape),()=>`packed reshape ${d.shape} to ${v.shape} isn't free`);let N=st({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(N);let S=k0({a:v,b:N,backend:r,transposeA:f,transposeB:g,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:i}),C=r.texData.get(S.dataId);A.assert(C.isPacked,()=>"batchMatMul result is expected to be packed"),d.shape=w,C.shape=n.outShape,x=Ls({inputs:{x:S},backend:r}),x.shape=n.outShape,y.push(S)}else{let b=n.outHeight*n.outWidth,v=st({inputs:{x:e},backend:r,attrs:{shape:m?[n.batchSize,b,n.inChannels]:[n.batchSize,n.inChannels,b]}}),w=st({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),N=k0({a:m?v:w,b:m?w:v,transposeA:!m,transposeB:g,backend:r,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:i});x=st({inputs:{x:N},backend:r,attrs:{shape:n.outShape}}),y.push(v),y.push(w),y.push(N)}for(let b of y)r.disposeIntermediateTensorInfo(b);return x}function i9({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:l=null}){let{filterWidth:u,filterHeight:d,inChannels:c,outWidth:h,outHeight:p,dataFormat:m}=n,f=m==="channelsLast",g=u*d*c,x=p*h,y=[n.batchSize,g,x],b=!0,v=!1,w=[];if(s!=null){let O=S0(s.shape,f);O!=null&&(s=st({inputs:{x:s},backend:r,attrs:{shape:O}}),w.push(s))}if(a!=null){let O=S0(a.shape,f);O!=null&&(a=st({inputs:{x:a},backend:r,attrs:{shape:O}}),w.push(a))}let N=st({inputs:{x:t},backend:r,attrs:{shape:[1,g,A.sizeFromShape(t.shape)/g]}});w.push(N);let S=new nOe(y,n),C=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(S,[e],"float32",C),T=st({inputs:{x:_},backend:r,attrs:{shape:y}});w.push(_),w.push(T);let E=a!=null,j=s!=null,I=l==="leakyrelu",D=l?wy(l,!0):null,F=new XG(f?T.shape:N.shape,f?N.shape:T.shape,f?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],b,v,E,D,j,I),P=f?[T,N]:[N,T];if(a&&P.push(a),j&&P.push(s),I){let O=r.makeTensorInfo([],"float32",A.createScalarValue(i,"float32"));P.push(O),w.push(O)}let V=r.runWebGLProgram(F,P,"float32"),$=st({inputs:{x:V},backend:r,attrs:{shape:n.outShape}});w.push(V);for(let O of w)r.disposeIntermediateTensorInfo(O);return $}function rOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dataFormat:u,dilations:d,dimRoundingMode:c}=r,h=z.convertConv2DDataFormat(u),p=z.computeConv2DInfo(a.shape,s.shape,i,d,l,c,!1,h),m;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))m=s9({x:a,filter:s,convInfo:p,backend:n});else if(p.strideWidth<=2&&h==="channelsLast"&&be().getBool("WEBGL_EXP_CONV")){let g=new a9(p),x=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];m=n.runWebGLProgram(g,[a,s],"float32",x)}else if(be().getBool("WEBGL_CONV_IM2COL"))m=i9({x:a,filter:s,convInfo:p,backend:n});else{let g=new r9(p);m=n.runWebGLProgram(g,[a,s],"float32")}let f=st({inputs:{x:m},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(m),f}var aOe={kernelName:sh,backendName:"webgl",kernelFunc:rOe},sOe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},iOe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dataFormat==="channelsLast",i=t-1-e.padInfo.top,l=n-1-e.padInfo.left,u=s?1:2,d=s?2:3,c=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${c}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},oOe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${a};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${i};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},lOe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,i=e.strideWidth,l=t-1-e.padInfo.front,u=n-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function uOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:l,dataFormat:u,dimRoundingMode:d,filterShape:c}=r,h=z.convertConv2DDataFormat(u),p=z.computeConv2DInfo(a.shape,c,i,1,l,d,!1,h),m=new sOe(p);return n.runWebGLProgram(m,[a,s],"float32")}var cOe={kernelName:l1,backendName:"webgl",kernelFunc:uOe},dOe=class{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Wa(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function hOe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:i,strides:l,pad:u,dataFormat:d,dimRoundingMode:c}=r,h=z.convertConv2DDataFormat(d),p=z.computeConv2DInfo(i,s.shape,l,1,u,c,!1,h);if(be().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){let m=[[p.strideHeight,p.strideWidth]],f=new dOe(p);return n.runWebGLProgram(f,[a,s],"float32",m)}else{let m=new iOe(p);return n.runWebGLProgram(m,[a,s],"float32")}}var pOe={kernelName:ih,backendName:"webgl",kernelFunc:hOe};function mOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u}=r,d=z.computeConv3DInfo(a.shape,s.shape,i,u,l),c=new tOe(d);return n.runWebGLProgram(c,[a,s],"float32")}var fOe={kernelName:oh,backendName:"webgl",kernelFunc:mOe};function gOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:l,filterShape:u}=r,d=z.computeConv3DInfo(a.shape,u,i,1,l),c=new oOe(d);return n.runWebGLProgram(c,[a,s],"float32")}var xOe={kernelName:Cf,backendName:"webgl",kernelFunc:gOe};function yOe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:l,inputShape:u}=r,d=z.computeConv3DInfo(u,s.shape,l,1,i),c=new lOe(d);return n.runWebGLProgram(c,[a,s],"float32")}var bOe={kernelName:_f,backendName:"webgl",kernelFunc:yOe},vOe=$g+`
  return cos(x);
`,wOe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${vp}
  return result;
`,NOe=In({opSnippet:vOe,packedOpSnippet:wOe}),kOe={kernelName:lh,backendName:"webgl",kernelFunc:NOe},SOe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,COe=In({opSnippet:SOe}),_Oe={kernelName:uh,backendName:"webgl",kernelFunc:COe},IOe=class{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,i,l,u]=e,[d]=t,[c,h]=n;this.outputShape=[d,c,h,u];let p=r==="bilinear"?1:0,[m,f]=[`${i-1}.0`,`${l-1}.0`],[g,x,y]=c>1?[`${(i-1)/(c-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[b,v,w]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${f} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}},TOe=e=>{let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:i}=t,{cropSize:l,method:u,extrapolationValue:d}=r,c=new IOe(a.shape,s.shape,l,u,d);return n.runWebGLProgram(c,[a,s,i],"float32")},EOe={kernelName:Tf,backendName:"webgl",kernelFunc:TOe},ky;(function(e){e.Prod="*",e.Sum="+"})(ky||(ky={}));var sP=class{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let a=this.outputShape.length,s=this.op===ky.Prod?"1.0":"0.0",i=n?s:`getX(${iP(a,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],u="",d="";n?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${ar(a)} coords = getOutputCoords();
        int end = ${oP(a,"coords",this.op)};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${oP(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${iP(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function iP(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function oP(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function o9(e,t,n,r,a,s){let i=t.shape.length,l=z.getAxesPermutation([r],i),u=t;l!=null&&(u=Xa({inputs:{x:t},backend:n,attrs:{perm:l}}));let d=z.getInnerMostAxes(1,i)[0];if(d!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let c=u.shape[d],h=Ls({inputs:{x:u},backend:n});for(let p=0;p<=Math.ceil(Math.log2(c))-1;p++){let m=new sP(e,u.shape,!1,s),f=[[p]],g=h;h=n.runWebGLProgram(m,[h],h.dtype,f),n.disposeIntermediateTensorInfo(g)}if(a){let p=new sP(e,u.shape,a,s),m=h;h=n.runWebGLProgram(p,[h],h.dtype),n.disposeIntermediateTensorInfo(m)}if(l!=null){let p=z.getUndoAxesPermutation(l),m=Xa({inputs:{x:h},backend:n,attrs:{perm:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),m}return h}function jOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r;return o9(ky.Prod,a,n,s,i,l)}var AOe={kernelName:If,backendName:"webgl",kernelFunc:jOe};function ROe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r;return o9(ky.Sum,a,n,s,i,l)}var DOe={kernelName:ch,backendName:"webgl",kernelFunc:ROe};function MOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:i,binaryOutput:l}=r;if(a.shape.length===1){let u=n.readSync(a.dataId),d=n.readSync(s.dataId),c=LG(u,d,s.dtype,s.shape,i);return n.makeTensorInfo([i],s.dtype,c)}else if(a.shape.length===2){let u=n.bufferSync(a),d=n.bufferSync(s),c=F$e(u,d,i,l);return n.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var $Oe={kernelName:Qy,backendName:"webgl",kernelFunc:MOe},FOe=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function POe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:i}=r,l=a.shape[0],u=i==="NHWC"?a.shape[1]:a.shape[2],d=i==="NHWC"?a.shape[2]:a.shape[3],c=i==="NHWC"?a.shape[3]:a.shape[1],h=u*s,p=d*s,m=c/(s*s),f=i==="NHWC"?[l,h,p,m]:[l,m,h,p],g=new FOe(f,s,i);return n.runWebGLProgram(g,[a],a.dtype)}var OOe={kernelName:Ef,backendName:"webgl",kernelFunc:POe},l9=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Wa(this.outputShape.length);let s=e.filterHeight,i=e.filterWidth,l=e.outChannels/e.inChannels,u="",d="";n&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:u=`
          float activation(float x) {
            ${n}
          }
        `,d="result = activation(result);");let c=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${i}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${c}
        ${d}
        setOutput(result);
      }
    `}},u9=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Wa(this.outputShape.length);let s=e.outChannels/e.inChannels,i=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,c=e.filterWidth,h=c,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<c;x++)p+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;p+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let x=0;x<c;x++)p+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(h+1)/2;x++){let y=x*2;if(p+=`
          xC = xCCorner + ${y*u};
          `,l===1){if(y<c&&(i%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,u===1&&y>0?p+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<c)){let b=i%2===0?A.nearestLargerEven(u):u;u%2===0&&i%2===1||u%2!==0&&i%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,u>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:p+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):b===1?p+=`
                    xC${y+1} = xTexelC${y};
                    `:p+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<c&&(i%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<c&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<c&&(p+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<c&&(p+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<c&&(p+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let m="",f="";n&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:m=`vec4 activation(vec4 x) {
          ${n}
        }`,f="result = activation(result);");let g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${f}
        setOutput(result);
      }
    `}};function LOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u,dimRoundingMode:d}=r,c=u;c==null&&(c=[1,1]),A.assert(z.eitherStridesOrDilationsAreOne(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let h=z.computeConv2DInfo(a.shape,s.shape,i,c,l,d,!0),p;be().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new u9(h):p=new l9(h);let m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,s],"float32",m)}var zOe={kernelName:dh,backendName:"webgl",kernelFunc:LOe},BOe=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},WOe=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.top,i=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function VOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,dilations:l,pad:u,dimRoundingMode:d,filterShape:c}=r,h=z.computeConv2DInfo(a.shape,c,i,l,u,d,!0),p=new BOe(h);return n.runWebGLProgram(p,[a,s],"float32")}var UOe={kernelName:u1,backendName:"webgl",kernelFunc:VOe};function HOe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:i,dilations:l,pad:u,dimRoundingMode:d,inputShape:c}=r,h=z.computeConv2DInfo(c,s.shape,i,l,u,d,!0),p=new WOe(h);return n.runWebGLProgram(p,[a,s],"float32")}var GOe={kernelName:c1,backendName:"webgl",kernelFunc:HOe},qOe=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function KOe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],s=A.sizeFromShape(r.shape),i=st({inputs:{x:r},backend:n,attrs:{shape:[s]}}),l=new qOe(s),u=n.runWebGLProgram(l,[i],i.dtype),d=st({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(u),d}var YOe={kernelName:Jy,backendName:"webgl",kernelFunc:KOe},XOe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:s,filterHeight:i,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:c,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${s});
      const ivec2 pads = ivec2(${c}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${i}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function ZOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u}=r,d=z.computeDilation2DInfo(a.shape,s.shape,i,l,"NHWC",u),c,h=new XOe(d);c=n.runWebGLProgram(h,[a,s],"float32");let p=st({inputs:{x:c},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(c),p}var QOe={kernelName:hh,backendName:"webgl",kernelFunc:ZOe};function JOe(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:i,summedDims:l,idDims:u}=z.decodeEinsumEquation(a,s.length);z.checkEinsumDimSizes(i.length,u,s);let{path:d,steps:c}=z.getEinsumComputePath(l,u),h=c.length,p=null,m=i.length,f=[];for(let g=0;g<h;++g){for(let x of c[g]){let{permutationIndices:y,expandDims:b}=z.getEinsumPermutation(m,u[x]),v;z.isIdentityPermutation(y)?v=s[x]:(v=Xa({inputs:{x:s[x]},backend:n,attrs:{perm:y}}),f.push(v));let w=v.shape.slice();for(let N=0;N<b.length;++N)w.splice(b[N],0,1);A.arraysEqual(v.shape,w)||(v=st({inputs:{x:v},backend:n,attrs:{shape:w}}),f.push(v)),p===null?p=v:(p=IA({inputs:{a:v,b:p},backend:n}),f.push(p))}g<h-1&&(d[g]>=0&&(p=TN({inputs:{x:p},backend:n,attrs:{axis:d[g]-(i.length-m),keepDims:!1}}),f.push(p)),m--)}for(let g of f)g!==p&&n.disposeIntermediateTensorInfo(g);return p}var e4e={kernelName:h1,backendName:"webgl",kernelFunc:JOe},t4e="return (x >= 0.0) ? x : (exp(x) - 1.0);",n4e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,r4e=In({opSnippet:t4e,packedOpSnippet:n4e}),a4e={kernelName:mh,backendName:"webgl",kernelFunc:r4e},s4e="return (b >= 0.0) ? a : a * (b + 1.0);",i4e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,o4e=e=>{let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=be().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Mg(i4e,r.shape,a.shape):new Vd(s4e,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],r.dtype)},l4e={kernelName:jf,backendName:"webgl",kernelFunc:o4e},u4e=`
  return vec4(equal(a, b));
`,c4e="return float(a == b);",d4e=Ra({opSnippet:c4e,packedOpSnippet:u4e,dtype:"bool",cpuKernelImpl:B$e}),h4e={kernelName:Af,backendName:"webgl",kernelFunc:d4e},p4e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${z.ERF_P};
  float a1 = ${z.ERF_A1};
  float a2 = ${z.ERF_A2};
  float a3 = ${z.ERF_A3};
  float a4 = ${z.ERF_A4};
  float a5 = ${z.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,m4e=In({opSnippet:p4e}),f4e={kernelName:fh,backendName:"webgl",kernelFunc:m4e},g4e=$g+`
  return exp(x);
`,x4e=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,c9=In({opSnippet:g4e,packedOpSnippet:x4e,cpuKernelImpl:W$e,dtype:"float32"}),y4e={kernelName:gh,backendName:"webgl",kernelFunc:c9};function zC(e){let{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:s}=t,i=s.shape.length,l=s.shape.slice(),u=a;return a<0&&(A.assert(-(i+1)<=a,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+a+1),l.splice(u,0,1),st({inputs:{x:s},backend:r,attrs:{shape:l}})}var b4e={kernelName:Rf,backendName:"webgl",kernelFunc:zC},lP="return exp(x) - 1.0;",v4e=In({opSnippet:lP,packedOpSnippet:lP,cpuKernelImpl:V$e}),w4e={kernelName:xh,backendName:"webgl",kernelFunc:v4e},uP=class{constructor(e,t,n){this.variableNames=["real","imag"];let r=t[1];this.outputShape=t;let a=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0",i;if(e==="real")i="return real * expR - imag * expI;";else if(e==="imag")i="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${i}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function d9(e,t,n){let r=n.texData.get(e.dataId),a=A.sizeFromShape(e.shape),s=e.shape[e.shape.length-1],i=a/s,l=st({inputs:{x:e},backend:n,attrs:{shape:[i,s]}}),u=l.shape,d=new uP("real",u,t),c=new uP("imag",u,t),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],p=n.runWebGLProgram(d,h,"float32"),m=n.runWebGLProgram(c,h,"float32"),f=mc({inputs:{real:p,imag:m},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m);let g=st({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),g}function N4e(e){let{inputs:t,backend:n}=e,{input:r}=t;return d9(r,!1,n)}var k4e={kernelName:p1,backendName:"webgl",kernelFunc:N4e},S4e=class{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function qb(e){let{backend:t,attrs:n}=e,{shape:r,value:a}=n,{dtype:s}=n;if(s=s||A.inferDtype(a),s==="string"){let i=A.getArrayFromDType(s,A.sizeFromShape(r));return i.fill(a),t.makeTensorInfo(r,s,i)}else{let i=new S4e(r,a),l=[[a]];return t.runWebGLProgram(i,[],s,l)}}var C4e={kernelName:eb,backendName:"webgl",kernelFunc:qb},_4e=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}},I4e={kernelName:Df,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,a=new _4e(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},cP="return floor(x);",T4e=In({opSnippet:cP,packedOpSnippet:cP,cpuKernelImpl:U$e}),E4e={kernelName:yh,backendName:"webgl",kernelFunc:T4e},j4e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,A4e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,R4e=Ra({opSnippet:j4e,packedOpSnippet:A4e,dtype:"int32"}),D4e={kernelName:bh,backendName:"webgl",kernelFunc:R4e},M4e=class{constructor(e){this.variableNames=["A"];let t=ts(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}},$4e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=ts(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${n}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}},F4e={kernelName:n0,backendName:"webgl",kernelFunc:P4e},Fp,gS=be().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function P4e(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:a}=t,{numChannels:s}=r,i=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,[u,d]=i?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=[d,u],h=[d,u,s];if(l||i){let g=be().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Fp==null||g!==gS)&&(gS=g,Fp=document.createElement("canvas").getContext("2d",{willReadFrequently:gS})),Fp.canvas.width=u,Fp.canvas.height=d,Fp.drawImage(a,0,0,u,d),a=Fp.canvas}let p=n.makeTensorInfo(c,"int32");n.texData.get(p.dataId).usage=Ys.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);let m=be().getBool("WEBGL_PACK")?new $4e(h):new M4e(h),f=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),f}function O4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dataFormat:c,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=z.convertConv2DDataFormat(c),x=z.computeConv2DInfo(a.shape,s.shape,u,h,d,p,!1,g),y,b=[],v=i!=null,w=l!=null,N=m==="leakyrelu",S=()=>{let _=[a,s],T=(E,j)=>{if(j==="NCHW"&&E.shape.length===1&&E.shape[0]!==1){let I=st({inputs:{x:E},backend:n,attrs:{shape:[E.shape[0],1,1]}});return b.push(I),I}return E};if(v&&_.push(T(i,c)),w&&_.push(T(l,c)),N){let E=n.makeTensorInfo([],"float32",A.createScalarValue(f,"float32"));_.push(E),b.push(E)}return _};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=s9({x:a,filter:s,convInfo:x,backend:n,bias:i,activation:m,preluActivationWeights:l,leakyreluAlpha:f});else if(x.strideWidth<=2&&g==="channelsLast"&&be().getBool("WEBGL_EXP_CONV")){let _=m?wy(m,!0):null,T=new a9(x,v,_,w,N),E=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],j=S();y=n.runWebGLProgram(T,j,"float32",E)}else if(be().getBool("WEBGL_CONV_IM2COL"))y=i9({x:a,filter:s,convInfo:x,backend:n,bias:i,activation:m,preluActivationWeights:l,leakyreluAlpha:f});else{let _=m?wy(m,!1):null,T=new r9(x,v,_,w,N),E=S();y=n.runWebGLProgram(T,E,"float32")}let C=st({inputs:{x:y},backend:n,attrs:{shape:x.outShape}});return b.push(y),b.forEach(_=>n.disposeIntermediateTensorInfo(_)),C}var L4e={kernelName:Id,backendName:"webgl",kernelFunc:O4e};function z4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dilations:c,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=r,f=[],g=c;g==null&&(g=[1,1]),A.assert(z.eitherStridesOrDilationsAreOne(u,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${g}'`);let x=z.computeConv2DInfo(a.shape,s.shape,u,g,d,h,!0),y=be().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=p?wy(p,y):null,v=[a,s],w=i!=null,N=l!=null,S=p==="leakyrelu";if(w&&v.push(i),N&&v.push(l),S){let E=n.makeTensorInfo([],"float32",A.createScalarValue(m,"float32"));v.push(E),f.push(E)}let C;y?C=new u9(x,w,b,N,S):C=new l9(x,w,b,N,S);let _=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],T=n.runWebGLProgram(C,v,"float32",_);return f.forEach(E=>n.disposeIntermediateTensorInfo(E)),T}var B4e={kernelName:Td,backendName:"webgl",kernelFunc:z4e},W4e=class{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;let a=ar(n.length),s=`
    int index;`;for(let i=0;i<this.sliceDim;i++)s+=`
          index = round(getIndices(coords[0], ${i}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[i]};
          flattenIndex += index * ${this.strides[i]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function V4e(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=a.shape,i=s[s.length-1],l=A.sizeFromShape(r.shape),[u,d,c,h]=z.prepareAndValidate(r,a),p=st({inputs:{x:a},backend:n,attrs:{shape:[d,i]}}),m=st({inputs:{x:r},backend:n,attrs:{shape:[A.sizeFromShape(r.shape)/c,c]}});if(n.shouldExecuteOnCPU([r,a])||r.dtype==="string"){let y=n.readSync(a.dataId),b=n.bufferSync(r),v=H$e(y,b,r.dtype,d,i,c,h,r.shape,l);return n.makeTensorInfo(u,r.dtype,v.values)}let f=new W4e(i,h,[d,c],r.shape),g=n.runWebGLProgram(f,[m,p],m.dtype),x=st({inputs:{x:g},backend:n,attrs:{shape:u}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),x}var U4e={kernelName:$f,backendName:"webgl",kernelFunc:V4e},H4e=class{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=ar(this.rank),r=G4e(e);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}};function G4e(e,t){let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let a=0;a<e.length;a++)a===2?r.push("index"):r.push(`${n[a]}`);return r.join()}function h9(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:i,batchDims:l}=r,u=A.parseAxisParam(i,a.shape)[0];if(be().get("DEBUG")){let b=n.readSync(s.dataId),v=a.shape[u];for(let w=0;w<b.length;++w){let N=b[w];A.assert(N<=v-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${v-1}]`)}}let d=z.segment_util.collectGatherOpShapeInfo(a,s,u,l),c=A.sizeFromShape(s.shape),h=[],p=st({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=st({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,c/d.batchSize]}});h.push(p),h.push(m);let f=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,s])||a.dtype==="string"){let b=n.bufferSync(m),v=n.bufferSync(p),w=G$e(v,b,f);return h.forEach(N=>n.disposeIntermediateTensorInfo(N)),n.makeTensorInfo(d.outputShape,w.dtype,w.values)}let g=new H4e(p.shape,f),x=n.runWebGLProgram(g,[p,m],p.dtype);h.push(x);let y=st({inputs:{x},backend:n,attrs:{shape:d.outputShape}});return h.forEach(b=>n.disposeIntermediateTensorInfo(b)),y}var q4e={kernelName:Mf,backendName:"webgl",kernelFunc:h9},K4e="return float(a > b);",Y4e=`
  return vec4(greaterThan(a, b));
`,X4e=Ra({opSnippet:K4e,packedOpSnippet:Y4e,cpuKernelImpl:q$e,dtype:"bool"}),Z4e={kernelName:Ff,backendName:"webgl",kernelFunc:X4e},Q4e="return float(a >= b);",J4e=`
  return vec4(greaterThanEqual(a, b));
`,eLe=Ra({opSnippet:Q4e,packedOpSnippet:J4e,dtype:"bool",cpuKernelImpl:K$e}),tLe={kernelName:wh,backendName:"webgl",kernelFunc:eLe};function nLe(e){let{inputs:t,backend:n}=e,{input:r}=t;return d9(r,!0,n)}var rLe={kernelName:m1,backendName:"webgl",kernelFunc:nLe},aLe="return float(!isnan(x) && !isinf(x));",sLe=In({opSnippet:aLe,dtype:"bool"}),iLe={kernelName:kh,backendName:"webgl",kernelFunc:sLe},oLe="return float(isinf(x));",lLe=In({opSnippet:oLe,dtype:"bool"}),uLe={kernelName:Sh,backendName:"webgl",kernelFunc:lLe},cLe="return float(isnan(x));",dLe=In({opSnippet:cLe,dtype:"bool"}),hLe={kernelName:Ch,backendName:"webgl",kernelFunc:dLe},pLe="return float(a < b);",mLe=`
  return vec4(lessThan(a, b));
`,fLe=Ra({opSnippet:pLe,packedOpSnippet:mLe,cpuKernelImpl:Y$e,dtype:"bool"}),gLe={kernelName:Pf,backendName:"webgl",kernelFunc:fLe},xLe="return float(a <= b);",yLe=`
  return vec4(lessThanEqual(a, b));
`,bLe=Ra({opSnippet:xLe,packedOpSnippet:yLe,cpuKernelImpl:X$e,dtype:"bool"}),vLe={kernelName:Of,backendName:"webgl",kernelFunc:bLe};function wLe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,i=Z$e(r,a,s);return t.makeTensorInfo([i.length],"float32",i)}var NLe={kernelName:Lf,backendName:"webgl",kernelFunc:wLe},kLe=$g+`
  return x < 0.0 ? 0./0. : log(x);
`,SLe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,CLe=In({opSnippet:kLe,packedOpSnippet:SLe,cpuKernelImpl:Q$e}),_Le={kernelName:Ih,backendName:"webgl",kernelFunc:CLe},ILe=$g+`
  return log(1.0 + x);
`,TLe=In({opSnippet:ILe}),ELe={kernelName:Th,backendName:"webgl",kernelFunc:TLe},jLe="return float(a >= 1.0 && b >= 1.0);",ALe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,RLe=Ra({opSnippet:jLe,packedOpSnippet:ALe,dtype:"bool"}),DLe={kernelName:zf,backendName:"webgl",kernelFunc:RLe},MLe="return float(!(x >= 1.0));",$Le=In({opSnippet:MLe}),FLe={kernelName:Bf,backendName:"webgl",kernelFunc:$Le},PLe="return float(a >= 1.0 || b >= 1.0);",OLe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,LLe=Ra({opSnippet:PLe,packedOpSnippet:OLe,dtype:"bool"}),zLe={kernelName:Wf,backendName:"webgl",kernelFunc:LLe},BLe=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];let s=t,i=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${r}) * sum`;a===.5?l=`inversesqrt(${u})`:a===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${i}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}},WLe=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=t,i=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${r}) * sum`;a===.5?l=`inversesqrt(${u})`:a===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${i}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}},VLe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:l,beta:u}=r,d=be().getBool("WEBGL_PACK_NORMALIZATION")?new WLe(a.shape,s,i,l,u):new BLe(a.shape,s,i,l,u);return n.runWebGLProgram(d,[a],a.dtype)},ULe={kernelName:Eh,backendName:"webgl",kernelFunc:VLe},HLe=class{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}},GLe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:l,bias:u,alpha:d,beta:c}=r,h=new HLe(a.shape,l,u,d,c);return n.runWebGLProgram(h,[a,s,i],a.dtype)},qLe={kernelName:Vf,backendName:"webgl",kernelFunc:GLe};function KLe(e,t,n,r){let a=A.sizeFromShape(t),s=A.sizeFromShape(e.shape)/a,i=st({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),l=wp(i,e.dtype,"max",r),u=st({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(l),u}function p9(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:i}=r,l=a.shape.length,u=A.parseAxisParam(s,a.shape),d=u,c=z.getAxesPermutation(d,l),h=c!=null,p=n.shouldExecuteOnCPU([a]),m=a;if(h){if(p){let b=n.texData.get(m.dataId).values,v=new Array(l);for(let S=0;S<v.length;S++)v[S]=a.shape[c[S]];let w=SA(b,a.shape,a.dtype,c,v);m=n.makeTensorInfo(v,a.dtype);let N=n.texData.get(m.dataId);N.values=w}else m=IN(a,c,n);d=z.getInnerMostAxes(d.length,l)}z.assertAxesAreInnerMostDims("max",d,l);let[f,g]=z.computeOutAndReduceShapes(m.shape,d),x=f;i&&(x=z.expandShapeToKeepDim(f,u));let y;if(p){let b=n.texData.get(m.dataId).values,v=J$e(b,A.sizeFromShape(g),x,a.dtype);y=n.makeTensorInfo(x,a.dtype);let w=n.texData.get(y.dataId);w.values=v}else y=KLe(m,g,x,n);return h&&n.disposeIntermediateTensorInfo(m),y}var YLe={kernelName:jh,backendName:"webgl",kernelFunc:p9},XLe=_A+`
  return max(a, b);
`,ZLe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+vp+`
  return result;
`,QLe=Ra({opSnippet:XLe,packedOpSnippet:ZLe,cpuKernelImpl:eFe}),JLe={kernelName:Ah,backendName:"webgl",kernelFunc:QLe};function eze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Eg(a,"maxPool");let{filterSize:s,strides:i,pad:l,dimRoundingMode:u}=r,d=1;A.assert(z.eitherStridesOrDilationsAreOne(i,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let c=z.computePool2DInfo(a.shape,s,i,d,l,u);if(c.filterWidth===1&&c.filterHeight===1&&A.arraysEqual(c.inShape,c.outShape))return Ls({inputs:{x:a},backend:n});let h=new Ny(c,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}var tze={kernelName:Rh,backendName:"webgl",kernelFunc:eze};function nze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dataFormat:u,dimRoundingMode:d}=r,c=[1,1,1],h=z.computePool3DInfo(a.shape,s,i,c,l,d,u),p=new TA(h,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}var rze={kernelName:Uf,backendName:"webgl",kernelFunc:nze},aze=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,s=e.effectiveFilterWidth,i=a-1-e.padInfo.top,l=s-1-e.padInfo.left,u=a*s-1;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},sze=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,i=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,c=l-1-e.padInfo.front,h=u-1-e.padInfo.top,p=d-1-e.padInfo.left,m=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${i}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function ize(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,i=s,{filterSize:l,strides:u,pad:d,dimRoundingMode:c}=r,h=[1,1,1],p=z.computePool3DInfo(i.shape,l,u,h,d,c),m=new TA(p,"max",!0),f=n.runWebGLProgram(m,[i],i.dtype),g=new sze(p),x=n.runWebGLProgram(g,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),x}var oze={kernelName:nb,backendName:"webgl",kernelFunc:ize};function lze(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:i}=t,l=s;Eg([s,i],"maxPoolGrad");let{filterSize:u,strides:d,pad:c,dimRoundingMode:h}=r,p=z.computePool2DInfo(l.shape,u,d,1,c,h),m=!0,f=new Ny(p,"max",m),g=n.runWebGLProgram(f,[l],l.dtype),x=new aze(p),y=n.runWebGLProgram(x,[a,g],l.dtype);return n.disposeIntermediateTensorInfo(g),y}var uze={kernelName:tb,backendName:"webgl",kernelFunc:lze};function cze(e,t,n,r){let a=new Ny(n,"max",!1),s=r.runWebGLProgram(a,[e],"float32");a=new Ny(n,"max",!0,!0,t);let i=r.runWebGLProgram(a,[e],"float32");return[s,i]}var dze={kernelName:rb,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:i,includeBatchInIndex:l}=t,u=n;A.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let d=[1,1];A.assert(z.eitherStridesOrDilationsAreOne(s,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${d}'`);let c=z.computePool2DInfo(r.shape,a,s,d,i),[h,p]=cze(r,l,c,u);return[h,p]}};function hze(e,t,n,r){let a=A.sizeFromShape(t),s=A.sizeFromShape(e.shape)/a,i=st({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),l=wp(i,"float32","mean",r),u=st({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(l),u}var pze={kernelName:Dh,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{keepDims:a,axis:s}=t,i=n,l=r.shape.length,u=A.parseAxisParam(s,r.shape),d=u,c=z.getAxesPermutation(d,l),h=c!=null,p=i.shouldExecuteOnCPU([r]),m=[],f=r;if(h){if(p){let v=i.texData.get(f.dataId).values,w=new Array(l);for(let C=0;C<w.length;C++)w[C]=r.shape[c[C]];let N=SA(v,r.shape,r.dtype,c,w);f=i.makeTensorInfo(w,r.dtype);let S=i.texData.get(f.dataId);S.values=N}else f=IN(r,c,i);m.push(f),d=z.getInnerMostAxes(d.length,l)}z.assertAxesAreInnerMostDims("sum",d,l);let[g,x]=z.computeOutAndReduceShapes(f.shape,d),y=g;a&&(y=z.expandShapeToKeepDim(g,u));let b=hze(f,x,y,i);for(let v of m)i.disposeIntermediateTensorInfo(v);return b}};function mze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,l=a.shape.length,u=A.parseAxisParam(s,a.shape),d=u,c=z.getAxesPermutation(d,l),h=a;c!=null&&(h=Xa({inputs:{x:a},backend:n,attrs:{perm:c}}),d=z.getInnerMostAxes(d.length,a.shape.length)),z.assertAxesAreInnerMostDims("min",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=A.sizeFromShape(m),g=st({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=wp(g,g.dtype,"min",n),y;if(i){let b=z.expandShapeToKeepDim(p,u);y=st({inputs:{x},backend:n,attrs:{shape:b}})}else y=st({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),c!=null&&n.disposeIntermediateTensorInfo(h),y}var fze={kernelName:Mh,backendName:"webgl",kernelFunc:mze},gze=_A+`
  return min(a, b);
`,xze=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+vp+`
  return result;
`,yze=Ra({opSnippet:gze,packedOpSnippet:xze,cpuKernelImpl:tFe}),bze={kernelName:$h,backendName:"webgl",kernelFunc:yze},vze=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((d,c)=>d[0]+e[c]+d[1]);let r=e.length,a=ar(r),s=t.map(d=>d[0]).join(","),i=t.map((d,c)=>d[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=n==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${s};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}},wze=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,f)=>m[0]+e[f]+m[1]);let r=e.length,a=ar(r),s=t.map(m=>m[0]).join(","),i=t.map((m,f)=>m[0]+e[f]).join(","),l=Ga("rc",r),u=Ga("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,c=r===1?"source":`vec2(${u.slice(-2).join()})`,h=n==="reflect"?0:1,p="";if(r===1){let m=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${c});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${c});
        }
      `}else{let m=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${c});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${c});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${u.join()}), ${c});
          ${l[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${u.join()}), ${c});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}},Nze=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{paddings:a,mode:s}=n,i=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wze(r.shape,a,s):new vze(r.shape,a,s);return t.runWebGLProgram(i,[r],r.dtype)},kze={kernelName:Fh,backendName:"webgl",kernelFunc:Nze},Sze=`if (b == 0.0) return NAN;
  return mod(a, b);`,Cze=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+vp+`
  return result;
`,_ze=Ra({opSnippet:Sze,packedOpSnippet:Cze}),Ize={kernelName:Ph,backendName:"webgl",kernelFunc:_ze},Tze=class{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}},Eze=`
if (a == b) {
  return 1.0;
};
return a / b;`,jze=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,m9=Ra({opSnippet:Eze,packedOpSnippet:jze,checkOutOfBounds:!0}),Aze={kernelName:ph,backendName:"webgl",kernelFunc:m9},dP="return a - b;",f9=Ra({opSnippet:dP,packedOpSnippet:dP,supportsComplex:!0,cpuKernelImpl:NFe}),Rze={kernelName:lp,backendName:"webgl",kernelFunc:f9};function g9(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,i=A.parseAxisParam([s],a.shape),l=p9({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),u=z.expandShapeToKeepDim(l.shape,i),d=st({inputs:{x:l},backend:n,attrs:{shape:u}}),c=f9({inputs:{a,b:d},backend:n}),h=c9({inputs:{x:c},backend:n}),p=TN({inputs:{x:h},backend:n,attrs:{axis:i,keepDims:!1}}),m=st({inputs:{x:p},backend:n,attrs:{shape:u}}),f=m9({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}var Dze={kernelName:ip,backendName:"webgl",kernelFunc:g9};function Mze(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:l}=r,u=l?a:g9({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),d=u.shape[0],c=u.shape[1],h=new Tze(d,c,s),p=[[i]],m=n.runWebGLProgram(h,[u],"int32",p);return l||n.disposeIntermediateTensorInfo(u),m}var $ze={kernelName:Hf,backendName:"webgl",kernelFunc:Mze},Fze=Ai+`
  return -x;
`,Pze=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Oze(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){let s=n.texData.get(r.dataId),[i,l]=rFe(s.values,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,i)}let a;return be().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Su(r.shape,Pze):a=new Ro(r.shape,Fze),n.runWebGLProgram(a,[r],r.dtype)}var Lze={kernelName:Gf,backendName:"webgl",kernelFunc:Oze},zze=Qo.nonMaxSuppressionV3Impl;function Bze(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u}=r,d=n.readSync(a.dataId),c=n.readSync(s.dataId),{selectedIndices:h}=zze(d,c,i,l,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}var Wze={kernelName:Kf,backendName:"webgl",kernelFunc:Bze},Vze=Qo.nonMaxSuppressionV4Impl;function Uze(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,padToMaxOutputSize:d}=r,c=n.readSync(a.dataId),h=n.readSync(s.dataId),{selectedIndices:p,validOutputs:m}=Vze(c,h,i,l,u,d);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}var Hze={kernelName:Yf,backendName:"webgl",kernelFunc:Uze},Gze=Qo.nonMaxSuppressionV5Impl;function qze(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:i,iouThreshold:l,scoreThreshold:u,softNmsSigma:d}=r,c=n.readSync(a.dataId),h=n.readSync(s.dataId),p=i,m=l,f=u,g=d,{selectedIndices:x,selectedScores:y}=Gze(c,h,p,m,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var Kze={kernelName:Xf,backendName:"webgl",kernelFunc:qze},Yze=class{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${n}),
                      float(index == coords.y)));
      }
    `}},Xze=e=>{let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:l,offValue:u}=r,d=A.sizeFromShape(a.shape),c=new Yze(d,i,l,u),h=st({inputs:{x:a},backend:n,attrs:{shape:[d]}}),p=n.runWebGLProgram(c,[h],s);n.disposeIntermediateTensorInfo(h);let m=[...a.shape,i],f=st({inputs:{x:p},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(p),f},Zze={kernelName:Lh,backendName:"webgl",kernelFunc:Xze};function C0(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){let a=Gb({inputs:{input:r},backend:n}),s=C0({inputs:{x:a},backend:n}),i=EN({inputs:{input:r},backend:n}),l=C0({inputs:{x:i},backend:n}),u=mc({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}else return qb({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}var Qze={kernelName:fg,backendName:"webgl",kernelFunc:C0};function x9(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let a=Gb({inputs:{input:r},backend:n}),s=x9({inputs:{x:a},backend:n}),i=EN({inputs:{input:r},backend:n}),l=C0({inputs:{x:i},backend:n}),u=mc({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),u}else return qb({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}var Jze={kernelName:Zf,backendName:"webgl",kernelFunc:x9};function e5e(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return zC({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{A.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),A.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],u=t.map(c=>{let h=zC({inputs:{input:c},backend:n,attrs:{dim:a}});return l.push(h),h}),d=n9({inputs:u,backend:n,attrs:{axis:a}});return l.forEach(c=>n.disposeIntermediateTensorInfo(c)),d}var t5e={kernelName:Qf,backendName:"webgl",kernelFunc:e5e},n5e=class{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);let r=e.length,a=ar(r),s=t.map(u=>u[0]).join(","),i=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${s};
        int end = ${i};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${i});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}},r5e=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((f,g)=>f[0]+e[g]+f[1]);let r=e.length,a=ar(r),s=t.map(f=>f[0]).join(","),i=t.map((f,g)=>f[0]+e[g]).join(","),l=Ga("rc",r),u=Ga("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,c=r===1?"source":`vec2(${u.slice(-2).join()})`,h=[`${a} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let f=0,g=r===1?2:4;f<g;f++)m+=`
        ${h[f]}
        if (${p}) {
          result[${f}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${f}] = getChannel(getX(${u.join()}), ${c});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${i});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}},y9=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:i}=r;if(A.sizeFromShape(a.shape)===0){let d=s.map((c,h)=>c[0]+a.shape[h]+c[1]);return qb({backend:n,attrs:{shape:d,value:i,dtype:a.dtype}})}let l=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new r5e(a.shape,s,i):new n5e(a.shape,s,i),u=[[i]];return n.runWebGLProgram(l,[a],a.dtype,u)},a5e={kernelName:zh,backendName:"webgl",kernelFunc:y9},s5e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,i5e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+vp+`
  return result;
`,o5e=Ra({opSnippet:s5e,packedOpSnippet:i5e}),l5e={kernelName:Bh,backendName:"webgl",kernelFunc:o5e};function u5e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:i}=r,l=a.shape.length,u=[],d=A.parseAxisParam(s,a.shape),c=d,h=z.getAxesPermutation(c,l),p=a;h!=null&&(p=Xa({inputs:{x:a},backend:n,attrs:{perm:h}}),c=z.getInnerMostAxes(c.length,l),u.push(p)),z.assertAxesAreInnerMostDims("prod",c,l);let m;if(n.shouldExecuteOnCPU([p])){let f=n.texData.get(p.dataId).values,{outVals:g,outShape:x,outDtype:y}=sFe(p.shape,p.dtype,f,c);m=n.makeTensorInfo(x,y,g)}else{let[f,g]=z.computeOutAndReduceShapes(p.shape,c),x=A.sizeFromShape(g),y=st({inputs:{x:p},backend:n,attrs:{shape:[-1,x]}}),b=w1(a.dtype),v=wp(y,b,"prod",n);m=st({inputs:{x:v},backend:n,attrs:{shape:f}}),u.push(y),u.push(v)}if(i){u.push(m);let f=z.expandShapeToKeepDim(m.shape,d);m=st({inputs:{x:m},backend:n,attrs:{shape:f}})}return u.forEach(f=>n.disposeIntermediateTensorInfo(f)),m}var c5e={kernelName:Vh,backendName:"webgl",kernelFunc:u5e};function d5e(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:i}=t,{outputRaggedRank:l}=r,u=a.map(y=>n.readSync(y.dataId)),d=a.map(y=>y.shape),c=n.readSync(s.dataId),h=n.readSync(i.dataId),[p,m,f]=iFe(u,d,c,s.shape,s.dtype,h,i.shape,l),g=p.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,s.dtype,m);return g.concat([x])}var h5e={kernelName:g1,backendName:"webgl",kernelFunc:d5e};function p5e(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,i=n.readSync(r.dataId),l=n.readSync(a.dataId),u=n.readSync(s.dataId),[d,c]=oFe(i,r.shape,r.dtype,l,a.shape,u,s.shape),h=n.makeTensorInfo([d.length],"int32",d),p=n.makeTensorInfo([c.length],r.dtype,c);return[h,p]}var m5e={kernelName:x1,backendName:"webgl",kernelFunc:p5e};function f5e(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:i,rowPartitionTensors:l}=t,{rowPartitionTypes:u}=r,d=n.readSync(a.dataId),c=n.readSync(s.dataId),h=n.readSync(i.dataId),p=l.map(x=>n.readSync(x.dataId)),m=l.map(x=>x.shape),[f,g]=lFe(d,a.shape,c,s.shape,s.dtype,h,i.shape,p,m,u);return n.makeTensorInfo(f,s.dtype,g)}var g5e={kernelName:y1,backendName:"webgl",kernelFunc:f5e},b9=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:i}=n,l=uFe(r,a,s,i);return t.makeTensorInfo([l.length],i,l)},x5e={kernelName:ab,backendName:"webgl",kernelFunc:b9},y5e="return 1.0 / x;",b5e=In({opSnippet:y5e}),v5e={kernelName:Uh,backendName:"webgl",kernelFunc:b5e},w5e=Ai+`
  return (x < 0.0) ? 0.0 : x;
`,N5e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,k5e=In({opSnippet:w5e,packedOpSnippet:N5e}),S5e={kernelName:Hh,backendName:"webgl",kernelFunc:k5e},C5e=Ai+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,_5e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,I5e=In({opSnippet:C5e,packedOpSnippet:_5e}),T5e={kernelName:Kh,backendName:"webgl",kernelFunc:I5e},E5e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,i,l,u]=e;this.outputShape=[s,t,n,u];let d=[r&&t>1?i-1:i,r&&n>1?l-1:l],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h;a?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/c[0]},
          ${d[1]/c[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}},j5e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,i,l,u]=e;this.outputShape=[s,t,n,u];let d=[r&&t>1?i-1:i,r&&n>1?l-1:l],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h;a?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/c[0]},
          ${d[1]/c[1]},
          ${d[1]/c[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function A5e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:l}=r,[u,d]=l,c=be().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new j5e(a.shape,u,d,s,i):new E5e(a.shape,u,d,s,i);return n.runWebGLProgram(c,[a],"float32")}var R5e={kernelName:qh,backendName:"webgl",kernelFunc:A5e},D5e=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,i]=e,l=[n&&s>1?r-1:r,n&&i>1?a-1:a],u=[n&&s>1?s-1:s,n&&i>1?i-1:i],d=l[0]/u[0],c=l[1]/u[1],h=1/d,p=1/c,m=Math.ceil(h)*2+2,f=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${c});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function M5e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,l=new D5e(s.shape,a.shape,i);return n.runWebGLProgram(l,[s],s.dtype)}var $5e={kernelName:tg,backendName:"webgl",kernelFunc:M5e},F5e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,i,l,u]=e;this.outputShape=[s,t,n,u];let d=[r&&t>1?i-1:i,r&&n>1?l-1:l],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0",p;a?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/c[0]},
          ${d[1]/c[1]});
      const vec2 inputShapeRC = vec2(${i}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}},P5e=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,i,l,u]=e;this.outputShape=[s,t,n,u];let d=[r&&t>1?i-1:i,r&&n>1?l-1:l],c=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0",p;a?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/c[0]},
          ${d[1]/c[1]},
          ${d[1]/c[1]});
      const vec3 inputShapeRC = vec3(${i}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function O5e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:i,size:l}=r,[u,d]=l,c=be().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new P5e(a.shape,u,d,s,i):new F5e(a.shape,u,d,s,i);return n.runWebGLProgram(c,[a],a.dtype)}var L5e={kernelName:Gh,backendName:"webgl",kernelFunc:O5e},z5e=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,i]=e,l=[n&&s>1?r-1:r,n&&i>1?a-1:a],u=[n&&s>1?s-1:s,n&&i>1?i-1:i],d=l[0]/u[0],c=l[1]/u[1],h=1/d,p=1/c,m=Math.ceil(h)*2+2,f=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${c});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${i}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function B5e(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,l=new z5e(s.shape,a.shape,i);return n.runWebGLProgram(l,[s],s.dtype)}var W5e={kernelName:eg,backendName:"webgl",kernelFunc:B5e},V5e=class{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let r=i=>t.indexOf(i)!==-1&&e[i]!==1?`${e[i]} - coords[${i}] - 1`:`coords[${i}]`,a=e.map((i,l)=>r(l)).join(","),s=ar(n);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}},U5e=class{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let r=Ga("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,i=ar(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${i} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${a}){
            result.g = ${u(r.slice())};
          }
          if(${s}) {
            result.b = ${d(r.slice())};
            if(${a}) {
              result.a = ${c(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return h(m)}function u(m){return m[n-1]="("+m[n-1]+" + 1)",h(m)}function d(m){return m[n-2]="("+m[n-2]+" + 1)",h(m)}function c(m){return m[n-1]="("+m[n-1]+" + 1)",m[n-2]="("+m[n-2]+" + 1)",h(m)}function h(m){let f=e.map((y,b)=>p(b,m)),g=f.join(","),x=f.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function p(m,f){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${f[m]} - 1`:`${f[m]}`}}};function H5e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,i=a.shape.length,l=A.parseAxisParam(s,a.shape);if(i===0)return Ls({inputs:{x:a},backend:n});let u=be().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new U5e(a.shape,l):new V5e(a.shape,l);return n.runWebGLProgram(u,[a],a.dtype)}var G5e={kernelName:Yh,backendName:"webgl",kernelFunc:H5e},q5e=class{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],r=e[2];this.outputShape=e;let a="";typeof t=="number"?a=`float outputValue = ${t.toFixed(2)};`:a=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}},K5e={kernelName:gg,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:i}=t,l=n,u=new q5e(r.shape,s),[d,c]=z.getImageCenter(i,r.shape[1],r.shape[2]),h=[[d,c,Math.sin(a),Math.cos(a)]];return l.runWebGLProgram(u,[r],r.dtype,h)}},Y5e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,X5e=In({opSnippet:Y5e}),Z5e={kernelName:Xh,backendName:"webgl",kernelFunc:X5e},Q5e="return inversesqrt(x);",J5e=In({opSnippet:Q5e,cpuKernelImpl:cFe}),eBe={kernelName:Zh,backendName:"webgl",kernelFunc:J5e},EA=class{constructor(e,t,n,r,a,s,i=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let u=ar(a.length),d=ar(s.length),c="";n===1?c="i":n===2&&(c="i, j");let h=`getIndices(${c})`,p="";r===1?p="i":r===2&&(p="i, coords[1]");let m=`getUpdates(${p})`,f="";l&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,x=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}},tBe=class{constructor(e,t,n,r,a,s,i=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let u=ar(a.length),d=ar(s.length),c="";n===1?c="i":n===2&&(c="i, j");let h=`getIndices(${c})`,p="";r===1?p="i":r===2&&(p="i, coords[1]");let m=`getUpdates(${p})`,f="";l&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,x=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}};function nBe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:i}=r,{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=z.calculateShapes(s,a,i),p=[h/d,d];if(h===0)return n.makeTensorInfo(i,a.dtype);let m=st({inputs:{x:a},backend:n,attrs:{shape:[u,l]}}),f=st({inputs:{x:s},backend:n,attrs:{shape:[u,d]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),x;be().getBool("WEBGL_PACK")?x=new tBe(u,l,m.shape.length,f.shape.length,c,p):x=new EA(u,l,m.shape.length,f.shape.length,c,p);let y=n.runWebGLProgram(x,[f,m,g],f.dtype),b=st({inputs:{x:y},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}var rBe={kernelName:ng,backendName:"webgl",kernelFunc:nBe},aBe=class{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let a="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,i=be().getNumber("WEBGL_VERSION")===2?a:s,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${i}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function sBe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r,l=new aBe(a.shape[0],a.shape[1],s.shape[1],i),u=[[a.shape[1]]];return n.runWebGLProgram(l,[a,s],"int32",u)}var iBe={kernelName:ag,backendName:"webgl",kernelFunc:sBe},oBe=class{constructor(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;let r,a;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)a="resRC",r="resRC";else{let i=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${i[d]}`),d<e&&l.push(`${i[d]}`);r=l.join(),a=u.join()}let s=ar(n);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}};function lBe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,i=new oBe(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(i,[r,a,s],ni(a.dtype,s.dtype))}var uBe={kernelName:sg,backendName:"webgl",kernelFunc:lBe},cBe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${z.SELU_SCALEALPHA};
  float scale = ${z.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,dBe=In({opSnippet:cBe}),hBe={kernelName:Qh,backendName:"webgl",kernelFunc:dBe},pBe=$g+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,mBe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fBe=In({opSnippet:pBe,packedOpSnippet:mBe,cpuKernelImpl:hFe}),gBe={kernelName:np,backendName:"webgl",kernelFunc:fBe},xBe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,yBe=In({opSnippet:xBe}),bBe={kernelName:tp,backendName:"webgl",kernelFunc:yBe},vBe=$g+`
  return sin(x);
`,wBe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${vp}
  return result;
`,NBe=In({opSnippet:vBe,packedOpSnippet:wBe}),kBe={kernelName:Jh,backendName:"webgl",kernelFunc:NBe},SBe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,CBe=In({opSnippet:SBe}),_Be={kernelName:ep,backendName:"webgl",kernelFunc:CBe},IBe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,TBe=In({opSnippet:IBe}),EBe={kernelName:rp,backendName:"webgl",kernelFunc:TBe},jBe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r;A.assert(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let l=s.reduce((y,b)=>y*b),u=[[0,0]];u.push(...i);for(let y=1+s.length;y<a.shape.length;++y)u.push([0,0]);let d=[],c=y9({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=z.getReshaped(c.shape,s,l,!1),p=z.getPermuted(h.length,s.length,!1),m=z.getReshapedPermuted(c.shape,s,l,!1),f=st({inputs:{x:c},backend:n,attrs:{shape:h}}),g=Xa({inputs:{x:f},backend:n,attrs:{perm:p}}),x=st({inputs:{x:g},backend:n,attrs:{shape:m}});return d.push(c),d.push(f),d.push(g),d.forEach(y=>n.disposeIntermediateTensorInfo(y)),x},ABe={kernelName:og,backendName:"webgl",kernelFunc:jBe};function RBe(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${a.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let l=n.readSync(r.dataId),u=n.readSync(a.dataId),d=n.readSync(s.dataId),c=n.readSync(i.dataId)[0],[h,p,m,f,g]=mFe(l,r.shape,r.dtype,u,a.dtype,d,c);return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([p[0]],a.dtype,m),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}var DBe={kernelName:sb,backendName:"webgl",kernelFunc:RBe};function MBe(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(n.readSync(a.dataId)),l=n.readSync(r.dataId),u=Array.from(n.readSync(s.dataId)),[d,c,h]=fFe(l,r.shape,r.dtype,i,u);return[n.makeTensorInfo(c,r.dtype,d),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}var $Be={kernelName:ug,backendName:"webgl",kernelFunc:MBe};function FBe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=n.readSync(r.dataId),l=n.readSync(a.dataId),u=n.readSync(s.dataId),[d,c]=BG(i,r.shape,r.dtype,l,u,!0);return n.makeTensorInfo(c,r.dtype,d)}var PBe={kernelName:ib,backendName:"webgl",kernelFunc:FBe};function OBe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=n.readSync(r.dataId),l=n.readSync(a.dataId),u=n.readSync(s.dataId),[d,c]=BG(i,r.shape,r.dtype,l,u);return n.makeTensorInfo(c,r.dtype,d)}var LBe={kernelName:ob,backendName:"webgl",kernelFunc:OBe};function zBe(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=t,{outputShape:l}=r,{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=z.calculateShapes(s,a,l),m=!1;if(s.dtype==="string"){let y=n.bufferSync(a),b=n.bufferSync(s),v=A.decodeString(n.readSync(i.dataId)[0]),w=dFe(y,b,l,p,c,d,u,h,v,m);return n.makeTensorInfo(l,w.dtype,w.values)}let f=new EA(d,u,a.shape.length,s.shape.length,h,[p,1],m),g=n.runWebGLProgram(f,[s,a,i],s.dtype),x=st({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(g),x}var BBe={kernelName:cg,backendName:"webgl",kernelFunc:zBe};function WBe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=r,l=A.parseAxisParam(i,a.shape)[0],u=z.prepareSplitSize(a,s,l),d=a.shape.length,c=new Array(d).fill(0),h=a.shape.slice();return u.map(p=>{let m=[...h];m[l]=p;let f=Fg({inputs:{x:a},backend:n,attrs:{begin:c,size:m}});return c[l]+=p,f})}var VBe={kernelName:lg,backendName:"webgl",kernelFunc:WBe},hP="return sqrt(x);",UBe=In({opSnippet:hP,packedOpSnippet:hP,cpuKernelImpl:gFe}),HBe={kernelName:ap,backendName:"webgl",kernelFunc:UBe},GBe="return x * x;",qBe=In({opSnippet:GBe}),KBe={kernelName:lb,backendName:"webgl",kernelFunc:qBe},pP="return (a - b) * (a - b);",YBe=Ra({opSnippet:pP,packedOpSnippet:pP}),XBe={kernelName:op,backendName:"webgl",kernelFunc:YBe};function ZBe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");let s=n.readSync(a.dataId),i=z.fromUint8ToStringArray(s),l=xFe(i,"string",r);return n.makeTensorInfo(a.shape,"string",l)}var QBe={kernelName:ub,backendName:"webgl",kernelFunc:ZBe};function JBe({inputs:e,attrs:t,backend:n}){let{x:r}=e,a=Ai+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new Ro(r.shape,a);return n.runWebGLProgram(s,[r],r.dtype)}var eWe={kernelName:oc,backendName:"webgl",kernelFunc:JBe},tWe=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let r=n.length,a=ar(n.length),s=ar(n.length),i="";if(r===1)i="coords * strides + begin";else{let l=0;i=n.map((u,d)=>(l++,n.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${e});
      ${a} strides = ${a}(${t});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};function nWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:i,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=ea.sliceInfo(a.shape,s,i,l,u,d,c,h,p),N;if(g)N=st({inputs:{x:a},backend:n,attrs:{shape:f}});else if(x||y){A.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let C=ea.computeOutShape(b,v,w),_=Fg({inputs:{x:a},backend:n,attrs:{begin:b,size:C}});N=st({inputs:{x:_},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(_)}else if(n.shouldExecuteOnCPU([a])){let C=n.readSync(a.dataId),_=nn(a.shape,a.dtype,C),T=yFe(m,_,w,b);N=n.makeTensorInfo(f,a.dtype,T.values)}else{let C=new tWe(b,w,m);N=n.runWebGLProgram(C,[a],a.dtype)}let S=st({inputs:{x:N},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(N),S}var rWe={kernelName:dg,backendName:"webgl",kernelFunc:nWe};function aWe(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:i,rightPad:l,padWidth:u,preserveShortSequences:d}=r,{data:c,dataSplits:h}=t,p=n.readSync(c.dataId),m=n.readSync(h.dataId),[f,g]=bFe(p,m,a,s,i,l,u,d);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}var sWe={kernelName:cb,backendName:"webgl",kernelFunc:aWe};function iWe(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:i}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let l=n.readSync(s.dataId),u=n.readSync(i.dataId)[0],[d,c,h]=vFe(l,u,a),p=c.length;return[n.makeTensorInfo([p,2],"int32",d),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}var oWe={kernelName:db,backendName:"webgl",kernelFunc:iWe};function lWe(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let i=n.readSync(s.dataId),l=wFe(i,a);return n.makeTensorInfo(s.shape,"int32",l)}var uWe={kernelName:hb,backendName:"webgl",kernelFunc:lWe},cWe="return tan(x);",dWe=In({opSnippet:cWe}),hWe={kernelName:up,backendName:"webgl",kernelFunc:dWe},pWe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,mWe=In({opSnippet:pWe}),fWe={kernelName:cp,backendName:"webgl",kernelFunc:mWe};function gWe(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:s,updates:i}=t,{sliceRank:l,numUpdates:u,sliceSize:d,strides:c,outputSize:h}=z.calculateShapes(i,s,a.shape),p=[h/d,d];if(h===0)return n.makeTensorInfo(a.shape,s.dtype);let m=st({inputs:{x:s},backend:n,attrs:{shape:[u,l]}}),f=st({inputs:{x:i},backend:n,attrs:{shape:[u,d]}}),g=st({inputs:{x:a},backend:n,attrs:{shape:p}}),x=new EA(u,l,m.shape.length,f.shape.length,c,p,!1,!0),y=n.runWebGLProgram(x,[f,m,g],g.dtype),b=st({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}var xWe={kernelName:rg,backendName:"webgl",kernelFunc:gWe},yWe=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s]*t[s];this.outputShape=n,this.rank=n.length;let r=ar(this.rank),a=bWe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}};function bWe(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push(`imod(${n[a]}, ${e[a]})`);return r.join()}function v9(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;if(a.dtype==="string"||a.shape.length>5){let l=n.readSync(a.dataId),u=a.dtype==="string"?l.map(h=>A.decodeString(h)):l,d=nn(a.shape,a.dtype,u),c=kFe(d,s);return n.makeTensorInfo(c.shape,c.dtype,c.values)}let i=new yWe(a.shape,s);return n.runWebGLProgram(i,[a],a.dtype)}var vWe={kernelName:ic,backendName:"webgl",kernelFunc:v9},wWe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},NWe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function _c(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function mP(e){let t=1;for(;t<e;)t*=2;return t}function kWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:i}=r,l=be().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=be().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),d=a.shape,c=d[d.length-1];if(n.shouldExecuteOnCPU([a])||c<l||s>u){let T=n.readSync(a.dataId),[E,j]=SFe(T,d,a.dtype,s,i);return[n.makeTensorInfo(E.shape,E.dtype,E.values),n.makeTensorInfo(j.shape,j.dtype,j.values)]}if(s===0)return d[d.length-1]=0,[n.makeTensorInfo(d,a.dtype,[]),n.makeTensorInfo(d,"int32",[])];if(c===1)return[a,qb({attrs:{shape:d,dtype:"int32",value:0},backend:n})];let h=n.texData.get(a.dataId),p=h!==null&&h.isPacked,m=p?n.unpackTensor(a):a,f=A.sizeFromShape(d)/c,g=st({inputs:{x:m},attrs:{shape:[f,c]},backend:n});p&&_c(n,m);let x=mP(s),y=mP(c),b=null,v=()=>b===null?[g,g]:[g,b],w=(T,E,j)=>{let I=v(),D=new wWe(j),F=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[T],[E]],P=b;b=n.runWebGLProgram(D,I,"int32",F),_c(n,P)};for(let T=1;T<x;T*=2){let E=T*2;for(let j=T;j>=1;j/=2)w(E,j,[f,y])}for(let T=y;T>x;T/=2){let E=v(),j=new NWe([f,T/2]),I=[[c],[b===null?1:0],[x]],D=b;b=n.runWebGLProgram(j,E,"int32",I),_c(n,D);let F=x/2,P=F*2;for(let V=F;V>=1;V/=2)w(P,V,b.shape)}let N=b;b=Fg({inputs:{x:b},backend:n,attrs:{begin:0,size:[f,s]}}),_c(n,N);let S=h9({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});_c(n,g);let C=d.slice(0,-1);C.push(s),N=b,b=st({inputs:{x:b},attrs:{shape:C},backend:n}),_c(n,N);let _=S;return S=st({inputs:{x:S},attrs:{shape:C},backend:n}),_c(n,_),[S,b]}var SWe={kernelName:hg,backendName:"webgl",kernelFunc:kWe},CWe=class{constructor(e,t,n,r,a,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let i=n==="nearest"?1:2,l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${i} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function _We(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:s}=t,{interpolation:i,fillMode:l,fillValue:u,outputShape:d}=r,[c,h,p,m]=a.shape,[f,g]=d??[h,p],x=[c,f,g,m],y=new CWe(h,p,i,l,u,x);return n.runWebGLProgram(y,[a,s],"float32")}var IWe={kernelName:pg,backendName:"webgl",kernelFunc:_We};function TWe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;Eg(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=r.readSync(s.dataId),{outputValues:l,outputShape:u,indices:d}=CFe(i,a,s.shape,s.dtype);return[r.makeTensorInfo(u,s.dtype,l),r.makeTensorInfo([d.length],"int32",d)]}var EWe={kernelName:pb,backendName:"webgl",kernelFunc:TWe};function jWe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a,l=i.shape.length,u=a.shape[s],d=new Array(l-1),c=0;for(let g=0;g<l;g++)g!==s&&(d[c++]=i.shape[g]);let h=[],p=new Array(l).fill(0),m=i.shape.slice();m[s]=1;let f=new Array(u);for(let g=0;g<f.length;g++){p[s]=g;let x=Fg({inputs:{x:i},backend:n,attrs:{begin:p,size:m}}),y=st({inputs:{x},backend:n,attrs:{shape:d}});f[g]=y,h.push(x)}return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var AWe={kernelName:mg,backendName:"webgl",kernelFunc:jWe},RWe=class{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,r=e.batchSize,a=e.inSize,s=e.numSegments,i=s*Math.ceil(a/n);this.outputShape=[r,i];let l="0.0",u="sumValue",d=Math.floor(n/4)*4,c=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";a%n>0&&(p=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let m="";a%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${d};
        if (${c===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${u});
      }
    `}};function DWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:i}=r,l=a.shape.length,u=[],d=0,c=z.getAxesPermutation([d],l),h=a;c!=null&&(h=Xa({inputs:{x:a},backend:n,attrs:{perm:c}}),u.push(h),d=z.getInnerMostAxes(1,l)[0]);let p=z.segment_util.computeOutShape(h.shape,d,i),m=A.sizeFromShape([h.shape[d]]),f=st({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}});u.push(f);let g=w1(a.dtype),x=(w,N,S,C,_)=>{let T=w.shape[0],E=w.shape[1],j=z.segment_util.segOpComputeOptimalWindowSize(E,_),I={windowSize:j,inSize:E,batchSize:T,numSegments:_},D=new RWe(I,N),F=n.compileAndRun(D,[w,S],C);if(u.push(F),F.shape[1]===_)return F;let P=b9({backend:n,attrs:{start:0,stop:_,step:1,dtype:"float32"}}),V=v9({inputs:{x:P},backend:n,attrs:{reps:[E/j]}});return u.push(P),u.push(V),x(F,N,V,C,_)},y=x(f,"unsortedSegmentSum",s,g,i),b=st({inputs:{x:y},backend:n,attrs:{shape:p}}),v=b;if(c!=null){u.push(b);let w=z.getUndoAxesPermutation(c);v=Xa({inputs:{x:v},backend:n,attrs:{perm:w}})}return u.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}var MWe={kernelName:mb,backendName:"webgl",kernelFunc:DWe},$We=[yPe,vPe,kPe,_Pe,TPe,APe,DPe,$Pe,LPe,BPe,UPe,qPe,XPe,e3e,r3e,s3e,o3e,d3e,p3e,f3e,b3e,_3e,T3e,R3e,M3e,z3e,W3e,G3e,tPe,Y3e,eOe,aOe,cOe,pOe,fOe,xOe,bOe,kOe,_Oe,EOe,AOe,DOe,$Oe,OOe,zOe,UOe,GOe,YOe,QOe,e4e,a4e,l4e,h4e,f4e,y4e,b4e,w4e,k4e,C4e,I4e,E4e,D4e,F4e,L4e,B4e,U4e,q4e,Z4e,tLe,ePe,rLe,Q3e,iLe,uLe,hLe,rPe,gLe,vLe,NLe,_Le,ELe,DLe,FLe,zLe,ULe,qLe,YLe,JLe,tze,rze,oze,uze,dze,pze,fze,bze,kze,Ize,$ze,iPe,Lze,Wze,Hze,Kze,F3e,Zze,Jze,t5e,a5e,l5e,sPe,c5e,h5e,m5e,g5e,x5e,P3e,Aze,v5e,S5e,T5e,lPe,R5e,$5e,L5e,W5e,G5e,K5e,Z5e,eBe,rBe,iBe,uBe,hBe,gBe,bBe,kBe,_Be,S3e,Dze,EBe,ABe,DBe,$Be,PBe,LBe,BBe,VBe,HBe,KBe,XBe,QBe,eWe,rWe,sWe,oWe,uWe,Rze,fPe,hWe,fWe,xWe,vWe,SWe,IWe,gPe,EWe,AWe,MWe,Qze];for(let e of $We)fb(e);var jn;(function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"})(jn||(jn={}));var Sy;(function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"})(Sy||(Sy={}));var w9;function FWe(e){w9=e.wasm.cwrap(_d,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])}function PWe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:i,preluActivationWeights:l}=t;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");let{transposeA:u,transposeB:d,activation:c,leakyreluAlpha:h}=r,p=n.dataIdMap.get(a.dataId).id,m=n.dataIdMap.get(s.dataId).id,f=0;if(i!=null){let _=n.dataIdMap.get(i.dataId);if(_.shape.length!==1)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${_.shape.length}.`);f=_.id}let g=l==null?0:n.dataIdMap.get(l.dataId).id,x=Sy[c];if(x==null)throw new Error(`${c} activation not yet supported for FusedConv2D in the wasm backend.`);let y=u?a.shape[2]:a.shape[1],b=d?s.shape[1]:s.shape[2],v=xg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)),w=n.makeOutput([...v,y,b],a.dtype),N=n.dataIdMap.get(w.dataId).id,S=new Uint8Array(new Int32Array(a.shape).buffer),C=new Uint8Array(new Int32Array(s.shape).buffer);return w9(p,S,a.shape.length,m,C,s.shape.length,u,d,x,f,g,h||0,N),w}var OWe={kernelName:_d,backendName:"wasm",setupFunc:FWe,kernelFunc:PWe};function kn(e,t){let n;function r(s){n=s.wasm.cwrap(e,null,["number","number","number"])}function a(s){let{backend:i,inputs:{x:l}}=s,u=i.dataIdMap.get(l.dataId).id,d=i.makeOutput(l.shape,t||l.dtype),c=i.dataIdMap.get(d.dataId).id;return A.sizeFromShape(d.shape)===0||n(u,jn[l.dtype],c),d}return{kernelName:e,backendName:"wasm",setupFunc:r,kernelFunc:a}}var LWe=kn(ff),zWe=kn(qd),BWe=kn(Kd);function Gr(e,t,n){let r;function a(i){r=i.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])}function s(i){let{backend:l,inputs:u}=i,{a:d,b:c}=u,h=l.dataIdMap.get(d.dataId).id,p=l.dataIdMap.get(c.dataId).id,m=n??d.dtype,f=z.assertAndGetBroadcastShape(d.shape,c.shape),g=l.makeOutput(f,m);if(A.sizeFromShape(f)===0)return g;let x=new Uint8Array(new Int32Array(d.shape).buffer),y=new Uint8Array(new Int32Array(c.shape).buffer),b=l.dataIdMap.get(g.dataId).id;return r(h,x,d.shape.length,p,y,c.shape.length,jn[d.dtype],b),g}return{kernelName:e,backendName:"wasm",setupFunc:a,kernelFunc:s}}var WWe=Gr(ac),N9;function VWe(e){N9=e.wasm.cwrap(Yd,null,["array","number","number","number"])}function UWe(e){let{inputs:t,backend:n}=e,r=n.makeOutput(t[0].shape,t[0].dtype);if(A.sizeFromShape(r.shape)===0)return r;let a=t.map(l=>n.dataIdMap.get(l.dataId).id),s=new Uint8Array(new Int32Array(a).buffer),i=n.dataIdMap.get(r.dataId).id;return N9(s,a.length,jn[r.dtype],i),r}var HWe={kernelName:Yd,backendName:"wasm",setupFunc:VWe,kernelFunc:UWe};function jN(e){let{inputs:{x:t},backend:n}=e;if(t.dtype==="string")return Ka(n.readSync(t.dataId),t.shape,t.dtype);let r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var GWe={kernelName:Nh,backendName:"wasm",kernelFunc:jN},k9;function qWe(e){k9=e.wasm.cwrap(vl,null,["number","array","number","number","number","array","number"])}function Xu(e){let{inputs:t,backend:n,attrs:r}=e,[a,s]=YWe(t.x.shape,r.perm),i=!0;for(let f=0;f<s.length;f++)s[f]!==f&&(i=!1);let l=KWe(t.x.shape,r.perm),u={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(i){let f=jN({inputs:t,backend:n});return f.shape=l,f}let d=n.makeOutput(l,u.dtype),c=n.dataIdMap.get(u.dataId).id,h=n.dataIdMap.get(d.dataId).id,p=new Uint8Array(new Int32Array(s).buffer),m=new Uint8Array(new Int32Array(u.shape).buffer);return k9(c,m,u.shape.length,jn[u.dtype],h,p,s.length),d}function KWe(e,t){let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}function YWe(e,t){let n=[],r=[];for(let a=0;a<e.length;++a)e[a]!==1&&n.push(e[a]),e[t[a]]!==1&&r.push(t[a]);for(let a=0;a<r.length;++a){let s=-1;for(let i=0;i<r.length;++i)r[i]>=a&&(s===-1||r[s]>r[i])&&(s=i);r[s]=a}return[n,r]}var XWe={kernelName:vl,backendName:"wasm",kernelFunc:Xu,setupFunc:qWe};function fc(e,t,n){let r=e.shape,a=e.shape.length,s=A.parseAxisParam(t,r),i=s,l=z.getAxesPermutation(i,a),u=null,d=!1;if(l!=null){let c=new Array(a);for(let p=0;p<c.length;p++)c[p]=r[l[p]];i=z.getInnerMostAxes(i.length,a),u=Xu({inputs:{x:e},attrs:{perm:l},backend:n});let h=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==h&&(d=!0)}return{transposed:u,originalAxes:s,axes:i,inputWasTransposed:d}}var S9;function ZWe(e){S9=e.wasm.cwrap(gf,null,["number, number, number"])}function QWe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=i,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=fc(i,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;u=d,l=b}let m=u.shape.length;z.assertAxesAreInnerMostDims("all",c,m);let[f,g]=z.computeOutAndReduceShapes(u.shape,c),x=A.sizeFromShape(g),y=t.makeOutput(f,i.dtype);if(A.sizeFromShape(u.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;S9(l,x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var JWe={kernelName:gf,backendName:"wasm",setupFunc:ZWe,kernelFunc:QWe},C9;function e6e(e){C9=e.wasm.cwrap(xf,null,["number, number, number"])}function t6e(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=i,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=fc(i,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;u=d,l=b}let m=u.shape.length;z.assertAxesAreInnerMostDims("any",c,m);let[f,g]=z.computeOutAndReduceShapes(u.shape,c),x=A.sizeFromShape(g),y=t.makeOutput(f,i.dtype);if(A.sizeFromShape(u.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;C9(l,x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var n6e={kernelName:xf,backendName:"wasm",setupFunc:e6e,kernelFunc:t6e};function _9(e){let t;function n(a){t=a.wasm.cwrap(e,null,["number","number","number","number","number"])}function r(a){let{backend:s,inputs:i,attrs:l}=a,{axis:u}=l,{x:d}=i,c=s.dataIdMap.get(d.dataId).id,h=c,p=d,{transposed:m,axes:f,inputWasTransposed:g}=fc(d,u,s);if(g){let N=s.dataIdMap.get(m.dataId).id;N!==c&&(p=m,h=N)}let x=p.shape.slice(0,-1),y=s.makeOutput(x,"int32"),b=s.dataIdMap.get(y.dataId).id,v=A.sizeFromShape(y.shape),w=p.shape[f[0]];return t(h,jn[p.dtype],v,w,b),g&&s.disposeData(m.dataId),y}return{kernelName:e,backendName:"wasm",setupFunc:n,kernelFunc:r}}var r6e=_9(yf),a6e=_9(bf),s6e=kn(Xd),i6e=kn(Zd),o6e=kn(Qd),l6e=Gr(eh),u6e=kn(Jd),I9;function c6e(e){I9=e.wasm.cwrap(th,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function d6e(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=n,c=z.computePool2DInfo(a.shape,i,l,1,u,d),h=c.filterHeight,p=c.filterWidth,m=c.padInfo.top,f=c.padInfo.right,g=c.padInfo.bottom,x=c.padInfo.left,y=c.strideHeight,b=c.strideWidth,v=c.inChannels;if(c.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${c.dataFormat}'. Please use 'channelsLast'.`);if(c.dilationWidth!==1||c.dilationHeight!==1)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${c.dilationHeight}, ${c.dilationWidth}].`);let w=r.makeOutput(c.outShape,"float32"),N=r.dataIdMap.get(w.dataId).id;return I9(s,a.shape[0],a.shape[1],a.shape[2],h,p,m,f,g,x,y,b,v,N),w}var h6e={kernelName:th,backendName:"wasm",setupFunc:c6e,kernelFunc:d6e},T9;function p6e(e){T9=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function m6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u,dataFormat:d}=r,c=z.computePool3DInfo(a.shape,s,i,1,l,u,d),h=n.makeOutput(c.outShape,a.dtype);return T9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),h}var f6e={kernelName:vf,backendName:"wasm",setupFunc:p6e,kernelFunc:m6e},E9;function g6e(e){E9=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function x6e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=r,c=z.computePool3DInfo(s.shape,i,l,1,u,d),h=n.makeOutput(s.shape,s.dtype);return E9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left,c.filterDepth,c.filterHeight,c.filterWidth),h}var y6e={kernelName:Yy,backendName:"wasm",setupFunc:g6e,kernelFunc:x6e},j9;function b6e(e){j9=e.wasm.cwrap("AvgPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function v6e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u}=r,d=z.computePool2DInfo(s.shape,i,l,1,u),c=n.makeOutput(s.shape,s.dtype);return j9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.top,d.padInfo.left,d.filterHeight,d.filterWidth),c}var w6e={kernelName:Ky,backendName:"wasm",setupFunc:b6e,kernelFunc:v6e};function ps(e){let{inputs:t,attrs:n}=e,{x:r}=t,{shape:a}=n,s=A.sizeFromShape(r.shape),i=A.inferFromImplicitShape(a,s);return A.assert(s===A.sizeFromShape(i),()=>`new shape: ${i}, old shape: ${r.shape}. New shape and old shape must have the same number of elements.`),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:i,dtype:r.dtype}}var N6e={kernelName:Jf,backendName:"wasm",kernelFunc:ps},A9;function k6e(e){A9=e.wasm.cwrap(nh,null,["number","array","number","number","array","number","number","number","number"])}function S6e(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:i,transposeB:l}=r;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");let u=a.shape.length,d=s.shape.length,c=i?a.shape[u-2]:a.shape[u-1],h=l?s.shape[d-1]:s.shape[d-2],p=i?a.shape[u-1]:a.shape[u-2],m=l?s.shape[d-2]:s.shape[d-1],f=a.shape.slice(0,-2),g=s.shape.slice(0,-2),x=A.sizeFromShape(f),y=A.sizeFromShape(g),b=xg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([p,m]);A.assert(c===h,()=>`Error in matMul: inner shapes (${c}) and (${h}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${i} and transposeB=${l} must match.`);let v=i?[x,c,p]:[x,p,c],w=l?[y,m,h]:[y,h,m],N=ps({inputs:{x:a},backend:n,attrs:{shape:v}}),S=ps({inputs:{x:s},backend:n,attrs:{shape:w}}),C=n.dataIdMap.get(N.dataId).id,_=n.dataIdMap.get(S.dataId).id,T=i?N.shape[2]:N.shape[1],E=l?S.shape[1]:S.shape[2],j=Math.max(x,y),I=n.makeOutput([j,T,E],N.dtype),D=n.dataIdMap.get(I.dataId).id,F=new Uint8Array(new Int32Array(N.shape).buffer),P=new Uint8Array(new Int32Array(S.shape).buffer);return A9(C,F,N.shape.length,_,P,S.shape.length,i,l,D),n.disposeData(N.dataId),n.disposeData(S.dataId),I.shape=b,I}var C6e={kernelName:nh,backendName:"wasm",setupFunc:k6e,kernelFunc:S6e};function Ud(e){let{inputs:{x:t},attrs:{begin:n,size:r},backend:a}=e,[s,i]=ea.parseSliceParams(t,n,r),l=ea.isSliceContinous(t.shape,s,i),u=a.readSync(t.dataId),d=a.makeOutput(i,t.dtype),c=A.computeStrides(t.shape),h=a.dataIdMap.get(d.dataId);if(l){let f=ea.computeFlatOffset(s,c);return t.dtype==="string"?h.stringBytes=u.slice(f,f+A.sizeFromShape(i)):a.typedArrayFromHeap(d).set(u.subarray(f,f+A.sizeFromShape(i))),d}if(t.dtype==="string"){let f=b0(u,s,i,t.shape,t.dtype);return h.stringBytes=f,d}let p=a.typedArrayFromHeap(d),m=t.shape.length;if(m===2)_6e(u,c[0],p,s,i);else if(m===3)I6e(u,c[0],c[1],p,s,i);else if(m===4)T6e(u,c[0],c[1],c[2],p,s,i);else{let f=b0(u,s,i,t.shape,t.dtype);p.set(f)}return d}function _6e(e,t,n,r,a){let s=0,i=r[0],l=r[1],u=i+a[0];for(let d=i;d<u;d++){let c=d*t+l;n.set(e.subarray(c,c+a[1]),s),s+=a[1]}}function I6e(e,t,n,r,a,s){let i=0,l=a[0],u=a[1],d=a[2],c=l+s[0],h=u+s[1];for(let p=l;p<c;p++)for(let m=u;m<h;m++){let f=p*t+m*n+d;r.set(e.subarray(f,f+s[2]),i),i+=s[2]}}function T6e(e,t,n,r,a,s,i){let l=0,u=s[0],d=s[1],c=s[2],h=u+i[0],p=d+i[1],m=c+i[2],f=s[3];for(let g=u;g<h;g++)for(let x=d;x<p;x++)for(let y=c;y<m;y++){let b=g*t+x*n+y*r+f;a.set(e.subarray(b,b+i[3]),l),l+=i[3]}}var E6e={kernelName:ig,backendName:"wasm",kernelFunc:Ud};function j6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:i}=r,l=s.reduce((y,b)=>y*b),u=z.getReshaped(a.shape,s,l),d=z.getPermuted(u.length,s.length),c=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(i,s.length),p=z.getSliceSize(c,i,s.length),m=ps({inputs:{x:a},backend:n,attrs:{shape:u}}),f=Xu({inputs:{x:m},backend:n,attrs:{perm:d}}),g=ps({inputs:{x:f},backend:n,attrs:{shape:c}}),x=Ud({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return n.disposeData(m.dataId),n.disposeData(f.dataId),n.disposeData(g.dataId),x}var A6e={kernelName:wf,backendName:"wasm",kernelFunc:j6e},R9;function R6e(e){R9=e.wasm.cwrap(Nf,null,["number","number","boolean","number","number","number"])}function D6e(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:i}=r,l=s.shape.reduce((h,p)=>h*p,1)!==0,u=a.shape.length===1?[i]:[a.shape[0],i],d=t.makeOutput(u,s.dtype);function c(h){return t.dataIdMap.get(h.dataId).id}return R9(c(a),i,l,c(s),jn[s.dtype],c(d)),d}var M6e={kernelName:Nf,backendName:"wasm",setupFunc:R6e,kernelFunc:D6e},$6e=Gr(kf);function F6e(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.typedArrayFromHeap(r),i=n.typedArrayFromHeap(a),l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return n.makeOutput([l.length],"int32",void 0,new Int32Array(l))}var P6e={kernelName:Xy,backendName:"wasm",kernelFunc:F6e};function gc(e){let{inputs:{x:t},attrs:{dtype:n},backend:r}=e,a=r.makeOutput(t.shape,n),s=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(s),a}var O6e={kernelName:rh,backendName:"wasm",kernelFunc:gc},L6e=kn(ah),D9;function z6e(e){D9=e.wasm.cwrap(sc,null,["number","number","number","number"])}function B6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:i}=r,l=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(u.dataId).id;return D9(l,s,i,d),u}var W6e={kernelName:sc,backendName:"wasm",setupFunc:z6e,kernelFunc:B6e};function M9(e){let{inputs:t,backend:n}=e,r=A.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map(m=>m.shape);z.assertParamsConsistent(a,r);let s=z.computeOutShape(t.map(m=>m.shape),r),i=t.filter(m=>A.sizeFromShape(m.shape)>0);if(i.length===1)return jN({inputs:{x:i[0]},backend:n});let l=n.makeOutput(s,t[0].dtype);if(A.sizeFromShape(s)===0)return l;if(i[0].dtype==="string"){let m=i.map(v=>{let w=[-1,A.sizeFromShape(v.shape.slice(r))];return ps({inputs:{x:v},backend:n,attrs:{shape:w}})}),f=m.map(v=>({vals:n.readSync(v.dataId),shape:v.shape}));s=z.computeOutShape(m.map(v=>v.shape),1);let g=m[0].shape[0]===1,x=tA(f,s,t[0].dtype,g),y=z.computeOutShape(i.map(v=>v.shape),r);l.shape=y;let b=n.dataIdMap.get(l.dataId);return b.stringBytes=z.fromStringArrayToUint8(x),m.forEach(v=>n.disposeData(v.dataId)),l}let u=A.sizeFromShape(i[0].shape.slice(0,r)),d=0,c=i.map(m=>{let f=A.sizeFromShape(m.shape.slice(r));return d+=f,f}),h=i.map(m=>n.typedArrayFromHeap(m)),p=n.typedArrayFromHeap(l);for(let m=0;m<u;m++){let f=m*d;for(let g=0;g<h.length;g++){let x=c[g],y=m*x,b=h[g].subarray(y,y+x);p.set(b,f),f+=x}}return l}var V6e={kernelName:Sf,backendName:"wasm",kernelFunc:M9},$9;function U6e(e){$9=e.wasm.cwrap(sh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function H6e(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,i=r.dataIdMap.get(a.dataId).id,l=r.dataIdMap.get(s.dataId).id,{strides:u,dilations:d,pad:c,dimRoundingMode:h,dataFormat:p}=n,m=z.convertConv2DDataFormat(p),f=z.computeConv2DInfo(a.shape,s.shape,u,d,c,h,!1,m),g=f.filterHeight,x=f.filterWidth,y=f.padInfo.top,b=f.padInfo.right,v=f.padInfo.bottom,w=f.padInfo.left,N=f.dilationHeight,S=f.dilationWidth,C=f.strideHeight,_=f.strideWidth,T=f.inChannels,E=f.outChannels,j=f.padInfo.type==="SAME"?1:0;if(f.dataFormat!=="channelsLast")throw new Error(`wasm backend Conv2D does not support dataFormat:'${f.dataFormat}'. Please use 'channelsLast'.`);let I=r.makeOutput(f.outShape,"float32"),D=r.dataIdMap.get(I.dataId).id;return $9(i,a.shape[0],a.shape[1],a.shape[2],l,g,x,y,b,v,w,j,N,S,C,_,T,E,D),I}var G6e={kernelName:sh,backendName:"wasm",setupFunc:U6e,kernelFunc:H6e},F9;function q6e(e){F9=e.wasm.cwrap(ih,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function K6e(e){let{backend:t,inputs:n,attrs:r}=e,{dy:a,filter:s}=n,{strides:i,pad:l,dataFormat:u,dimRoundingMode:d,inputShape:c}=r,h=1,p=z.convertConv2DDataFormat(u),m=z.computeConv2DInfo(c,s.shape,i,h,l,d,!1,p),{batchSize:f,filterHeight:g,filterWidth:x,inChannels:y,inHeight:b,inWidth:v,outChannels:w,outHeight:N,outWidth:S,strideHeight:C,strideWidth:_}=m,T=g-1-m.padInfo.top,E=x-1-m.padInfo.left,j=m.dataFormat==="channelsLast",I=A.computeStrides(m.inShape),D=A.computeStrides(a.shape),[F,P,V]=A.computeStrides(s.shape),$=I[0],O=j?I[1]:I[2],L=j?I[2]:1,q=j?1:I[1],U=D[0],ee=j?D[1]:D[2],M=j?D[2]:1,G=j?1:D[1],J=t.makeOutput(m.inShape,"float32"),ve=t.dataIdMap.get(J.dataId).id,Q=t.dataIdMap.get(a.dataId).id,se=t.dataIdMap.get(s.dataId).id;return F9(Q,se,f,g,x,b,v,y,N,S,w,C,_,T,E,F,P,V,$,O,L,q,U,ee,M,G,ve),J}var Y6e={kernelName:ih,backendName:"wasm",setupFunc:q6e,kernelFunc:K6e},P9;function X6e(e){P9=e.wasm.cwrap(oh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function Z6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u}=r;if(a.dtype!=="float32")throw new Error(`Tensor x must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(a.shape,s.shape,i,u,l),c=n.makeOutput(d.outShape,a.dtype);return P9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}var Q6e={kernelName:oh,backendName:"wasm",setupFunc:X6e,kernelFunc:Z6e},O9;function J6e(e){O9=e.wasm.cwrap(Cf,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function eVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:i,pad:l,filterShape:u}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(a.shape,u,i,1,l),c=n.makeOutput(d.filterShape,s.dtype);return O9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}var tVe={kernelName:Cf,backendName:"wasm",setupFunc:J6e,kernelFunc:eVe},L9;function nVe(e){L9=e.wasm.cwrap(_f,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function rVe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:i,strides:l,inputShape:u}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(u,s.shape,l,1,i),c=n.makeOutput(d.inShape,a.dtype);return L9(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(c.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),c}var aVe={kernelName:_f,backendName:"wasm",setupFunc:nVe,kernelFunc:rVe},sVe=kn(lh),iVe=kn(uh),BC;(function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"})(BC||(BC={}));var z9;function oVe(e){z9=e.wasm.cwrap(Tf,null,["number","number","number","number","array","number","number","number","number","number"])}function lVe(e){let{backend:t,inputs:n,attrs:r}=e,{method:a,extrapolationValue:s,cropSize:i}=r,{image:l,boxes:u,boxInd:d}=n,c=u.shape[0],[h,p]=i,m=[c,h,p,l.shape[3]],f=t.dataIdMap.get(l.dataId),g;l.dtype!=="float32"&&(g=gc({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),f=t.dataIdMap.get(g.dataId));let x=f.id,y=t.dataIdMap.get(u.dataId).id,b=t.dataIdMap.get(d.dataId).id,v=t.makeOutput(m,"float32"),w=t.dataIdMap.get(v.dataId).id,N=new Uint8Array(new Int32Array(l.shape).buffer);return z9(x,y,b,c,N,h,p,BC[a],s,w),g!=null&&t.disposeData(g.dataId),v}var uVe={kernelName:Tf,backendName:"wasm",setupFunc:oVe,kernelFunc:lVe},B9;function cVe(e){B9=e.wasm.cwrap(If,null,["number","number","number","number","number","number"])}function dVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r,u=a.shape.length;A.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumprod does not support ${a.dtype} tensors in the WASM backend`);let d=z.getAxesPermutation([s],u),c=a;d!==null&&(c=Xu({inputs:{x:a},attrs:{perm:d},backend:n}));let h=z.getInnerMostAxes(1,u)[0];z.assertAxesAreInnerMostDims("cumprod",[h],u);let p=n.makeOutput(c.shape,c.dtype),m=c.shape[h],f=n.dataIdMap.get(c.dataId).id,g=n.dataIdMap.get(p.dataId).id;B9(f,i?1:0,l?1:0,m,g,jn[a.dtype]);let x=p;if(d!==null){let y=z.getUndoAxesPermutation(d);x=Xu({inputs:{x:p},attrs:{perm:y},backend:n}),n.disposeData(c.dataId),n.disposeData(p.dataId)}return x}var hVe={kernelName:If,backendName:"wasm",setupFunc:cVe,kernelFunc:dVe},W9;function pVe(e){W9=e.wasm.cwrap(ch,null,["number","number","number","number","number","number"])}function mVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:i,reverse:l}=r,u=a.shape.length;A.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumsum does not support ${a.dtype} tensors in the WASM backend`);let d=z.getAxesPermutation([s],u),c=a;d!==null&&(c=Xu({inputs:{x:a},attrs:{perm:d},backend:n}));let h=z.getInnerMostAxes(1,u)[0];z.assertAxesAreInnerMostDims("cumsum",[h],u);let p=n.makeOutput(c.shape,c.dtype),m=c.shape[h],f=n.dataIdMap.get(c.dataId).id,g=n.dataIdMap.get(p.dataId).id;W9(f,i?1:0,l?1:0,m,g,jn[a.dtype]);let x=p;if(d!==null){let y=z.getUndoAxesPermutation(d);x=Xu({inputs:{x:p},attrs:{perm:y},backend:n}),n.disposeData(c.dataId),n.disposeData(p.dataId)}return x}var fVe={kernelName:ch,backendName:"wasm",setupFunc:pVe,kernelFunc:mVe},V9;function gVe(e){V9=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])}function xVe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:i,binaryOutput:l}=r,u=s.shape.reduce((p,m)=>p*m,1)!==0,d=a.shape.length===1?[i]:[a.shape[0],i],c=t.makeOutput(d,s.dtype);function h(p){return t.dataIdMap.get(p.dataId).id}return V9(h(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,i,u,h(s),jn[s.dtype],l,h(c)),c}var yVe={kernelName:Qy,backendName:"wasm",setupFunc:gVe,kernelFunc:xVe},U9;function bVe(e){U9=e.wasm.cwrap(Ef,null,["number","number","number","array","number","array","array","number","number"])}function vVe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{blockSize:s,dataFormat:i}=r,l=a.shape[0],u=i==="NHWC"?a.shape[1]:a.shape[2],d=i==="NHWC"?a.shape[2]:a.shape[3],c=i==="NHWC"?a.shape[3]:a.shape[1],h=u*s,p=d*s,m=c/(s*s),f=i==="NHWC"?[l,h,p,m]:[l,m,h,p],g=t.makeOutput(f,"float32"),x=t.dataIdMap.get(a.dataId).id,y=new Uint8Array(new Int32Array(A.computeStrides(a.shape)).buffer),b=new Uint8Array(new Int32Array(f).buffer),v=new Uint8Array(new Int32Array(A.computeStrides(f)).buffer),w=t.dataIdMap.get(g.dataId).id;return U9(x,s,i==="NHWC"?1:0,y,a.shape.length-1,b,v,f.length,w),g}var wVe={kernelName:Ef,backendName:"wasm",setupFunc:bVe,kernelFunc:vVe},H9;function NVe(e){H9=e.wasm.cwrap(dh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function kVe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,i=r.dataIdMap.get(a.dataId).id,l=r.dataIdMap.get(s.dataId).id,{strides:u,dilations:d,pad:c,dimRoundingMode:h}=n,p=d??[1,1],m=z.computeConv2DInfo(a.shape,s.shape,u,p,c,h,!0),f=m.filterHeight,g=m.filterWidth,x=m.padInfo.top,y=m.padInfo.right,b=m.padInfo.bottom,v=m.padInfo.left,w=m.dilationHeight,N=m.dilationWidth,S=m.strideHeight,C=m.strideWidth,_=m.inChannels,T=m.outChannels,E=m.padInfo.type==="SAME"?1:0;if(m.dataFormat!=="channelsLast")throw new Error(`wasm backend DepthwiseConv2dNative does not support dataFormat:'${m.dataFormat}'. Please use 'channelsLast'.`);let j=r.makeOutput(m.outShape,"float32"),I=r.dataIdMap.get(j.dataId).id;return H9(i,a.shape[0],a.shape[1],a.shape[2],l,f,g,x,y,b,v,E,w,N,S,C,_,T,I),j}var SVe={kernelName:dh,backendName:"wasm",setupFunc:NVe,kernelFunc:kVe},G9;function CVe(e){G9=e.wasm.cwrap("Diag",null,["number","number","number","number"])}function _Ve(e){let{inputs:t,backend:n}=e,{x:r}=t,a=A.sizeFromShape(r.shape),s=n.makeOutput([...r.shape,...r.shape],r.dtype);return G9(n.dataIdMap.get(r.dataId).id,jn[r.dtype],a,n.dataIdMap.get(s.dataId).id),s}var IVe={kernelName:Jy,backendName:"wasm",setupFunc:CVe,kernelFunc:_Ve},q9;function TVe(e){q9=e.wasm.cwrap(hh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function EVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:i,pad:l,dilations:u}=r;if(a.dtype!==s.dtype)throw new Error(`Dilation2D error: x must have the same dtype as filter. Got ${a.dtype} and ${s.dtype}`);let d=z.computeDilation2DInfo(a.shape,s.shape,i,l,"NHWC",u),c=n.makeOutput(d.outShape,a.dtype);return q9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(c.dataId).id,jn[a.dtype],d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.filterHeight,d.filterWidth,d.padInfo.top,d.padInfo.left),c}var jVe={kernelName:hh,backendName:"wasm",setupFunc:TVe,kernelFunc:EVe},K9;function AVe(e){K9=e.wasm.cwrap(zm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function RVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:i}=t,{strides:l,pad:u,dilations:d}=r;if(a.dtype!==s.dtype||a.dtype!==i.dtype)throw new Error(`Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${i.dtype}`);let c=z.computeDilation2DInfo(a.shape,s.shape,l,u,"NHWC",d),h=n.makeOutput(s.shape,s.dtype);return K9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(h.dataId).id,jn[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),h}var DVe={kernelName:zm,backendName:"wasm",setupFunc:AVe,kernelFunc:RVe},Y9;function MVe(e){Y9=e.wasm.cwrap(Lm,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function $Ve(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:i}=t,{strides:l,pad:u,dilations:d}=r;if(a.dtype!==s.dtype||a.dtype!==i.dtype)throw new Error(`Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${i.dtype}`);let c=z.computeDilation2DInfo(a.shape,s.shape,l,u,"NHWC",d),h=n.makeOutput(a.shape,a.dtype);return Y9(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(h.dataId).id,jn[a.dtype],c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.filterHeight,c.filterWidth,c.padInfo.top,c.padInfo.left),h}var FVe={kernelName:Lm,backendName:"wasm",setupFunc:MVe,kernelFunc:$Ve},PVe=kn(mh),X9;function OVe(e){X9=e.wasm.cwrap(jf,null,["number","number","number"])}function LVe(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=n.makeOutput(a.shape,"float32"),i=l=>n.dataIdMap.get(l.dataId).id;return X9(i(a),i(r),i(s)),s}var zVe={kernelName:jf,backendName:"wasm",setupFunc:OVe,kernelFunc:LVe},BVe=!1,WVe=Gr(Af,BVe,"bool"),VVe=kn(fh),UVe=kn(gh,"float32");function WC(e){let{inputs:t,attrs:n,backend:r}=e,{input:a}=t,{dim:s}=n,i=a.shape.length,l=a.shape.slice(),u=s;return s<0&&(A.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),u=i+s+1),l.splice(u,0,1),ps({inputs:{x:a},backend:r,attrs:{shape:l}})}var HVe={kernelName:Rf,backendName:"wasm",kernelFunc:WC},GVe=kn(xh,"float32");function Z9(e){let{attrs:{shape:t,value:n},backend:r}=e,{attrs:{dtype:a}}=e;a=a||A.inferDtype(n);let s=r.makeOutput(t,a);return r.typedArrayFromHeap(s).fill(n),s}var qVe={kernelName:eb,backendName:"wasm",kernelFunc:Z9},Q9;function KVe(e){Q9=e.wasm.cwrap(Df,null,["number","number","number","number","number","number"])}function YVe(e){let{inputs:t,backend:n}=e,{image:r}=t,a=n.makeOutput(r.shape,r.dtype),s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,[l,u,d,c]=r.shape;return Q9(s,l,u,d,c,i),a}var XVe={kernelName:Df,backendName:"wasm",kernelFunc:YVe,setupFunc:KVe},ZVe=kn(yh),QVe=Gr(bh),J9;function JVe(e){J9=e.wasm.cwrap(vh,null,["number","number","number","number","number","number","number"])}function eUe(e){let{backend:t,inputs:n,attrs:r}=e,{varianceEpsilon:a}=r,{x:s,mean:i,variance:l,offset:u,scale:d}=n,c=t.dataIdMap.get(s.dataId).id,h=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(l.dataId).id,m=u!=null?t.dataIdMap.get(u.dataId).id:0,f=d!=null?t.dataIdMap.get(d.dataId).id:0,g=t.makeOutput(s.shape,s.dtype);if(A.sizeFromShape(s.shape)===0)return g;let x=t.dataIdMap.get(g.dataId).id;return J9(c,h,p,m,f,a,x),g}var tUe={kernelName:vh,backendName:"wasm",setupFunc:JVe,kernelFunc:eUe},e7;function nUe(e){e7=e.wasm.cwrap(Id,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function rUe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dilations:c,dataFormat:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=n,g=z.computeConv2DInfo(a.shape,s.shape,u,c,d,p),x=Sy[m];if(x==null)throw new Error(`${m} activation not yet supported for FusedConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(s.dataId).id,v=g.outChannels,w=0;if(i!=null){let M=r.dataIdMap.get(i.dataId);if(M.shape.length!==1)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${M.shape.length}.`);if(M.shape[0]!==v)throw new Error(`FusedConv2D bias shape (${M.shape}) does not match the number of output channels (${v})`);w=M.id}let N=g.filterHeight,S=g.filterWidth,C=g.padInfo.top,_=g.padInfo.right,T=g.padInfo.bottom,E=g.padInfo.left,j=g.dilationHeight,I=g.dilationWidth,D=g.strideHeight,F=g.strideWidth,P=g.inChannels,V=g.padInfo.type==="SAME"?1:0,$=g.batchSize,O=g.inHeight,L=g.inWidth;if(h!=="NHWC")throw new Error(`wasm backend FusedConv2D does not support dataFormat:'${h}'. Please use 'NHWC'.`);let q=r.makeOutput(g.outShape,"float32"),U=r.dataIdMap.get(q.dataId).id,ee=l==null?0:r.dataIdMap.get(l.dataId).id;return e7(y,$,O,L,b,N,S,w,C,_,T,E,V,j,I,D,F,P,v,x,ee,f||0,U),q}var aUe={kernelName:Id,backendName:"wasm",setupFunc:nUe,kernelFunc:rUe},t7;function sUe(e){t7=e.wasm.cwrap(Td,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function iUe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:i,preluActivationWeights:l}=t,{strides:u,pad:d,dilations:c,dataFormat:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=n,g=z.computeConv2DInfo(a.shape,s.shape,u,c,d,p,!0),x=Sy[m];if(x==null)throw new Error(`${m} activation not yet supported for FusedDepthwiseConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(s.dataId).id,v=g.outChannels,w=0;if(i!=null){let M=r.dataIdMap.get(i.dataId);if(M.shape.length!==1)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${M.shape.length}.`);if(M.shape[0]!==v)throw new Error(`FusedDepthwiseConv2D bias shape (${M.shape}) does not match the number of output channels (${v})`);w=M.id}let N=g.filterHeight,S=g.filterWidth,C=g.padInfo.top,_=g.padInfo.right,T=g.padInfo.bottom,E=g.padInfo.left,j=g.dilationHeight,I=g.dilationWidth,D=g.strideHeight,F=g.strideWidth,P=g.inChannels,V=g.padInfo.type==="SAME"?1:0,$=g.batchSize,O=g.inHeight,L=g.inWidth;if(h!=="NHWC")throw new Error(`wasm backend FusedDepthwiseConv2D does not support dataFormat:'${h}'. Please use 'NHWC'.`);let q=r.makeOutput(g.outShape,"float32"),U=r.dataIdMap.get(q.dataId).id,ee=l==null?0:r.dataIdMap.get(l.dataId).id;return t7(y,$,O,L,b,N,S,w,C,_,T,E,V,j,I,D,F,P,v,x,ee,f||0,U),q}var oUe={kernelName:Td,backendName:"wasm",setupFunc:sUe,kernelFunc:iUe},n7;function lUe(e){n7=e.wasm.cwrap($f,null,["number","number","number","number","number","number","array","number"])}function uUe(e){let{backend:t,inputs:n}=e,{params:r,indices:a}=n,[s,i,l,u]=pE.prepareAndValidate(r,a),d=t.makeOutput(s,r.dtype);if(i===0)return d;let c=a.shape,h=c[c.length-1],p=t.dataIdMap.get(r.dataId).id,m=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(u).buffer),g=t.dataIdMap.get(d.dataId).id;return n7(p,jn[r.dtype],m,i,h,l,f,g),d}var cUe={kernelName:$f,backendName:"wasm",setupFunc:lUe,kernelFunc:uUe},r7;function dUe(e){r7=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])}function hUe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,indices:s}=n,{axis:i,batchDims:l}=r,u=A.parseAxisParam(i,a.shape)[0],d=t.readSync(s.dataId),c=a.shape[u];for(let C=0;C<d.length;++C){let _=d[C];A.assert(_<=c-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${c-1}]`)}let h=z.segment_util.collectGatherOpShapeInfo(a,s,u,l),p=ps({inputs:{x:a},attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]},backend:t}),m=A.sizeFromShape(s.shape),f=ps({inputs:{x:s},attrs:{shape:[h.batchSize,m/h.batchSize]},backend:t}),g=[h.batchSize,h.outerSize,m/h.batchSize,h.sliceSize],x=t.makeOutput(g,a.dtype);if(A.sizeFromShape(a.shape)===0)return x;let y=p.shape.length-1,b=t.dataIdMap.get(p.dataId).id,v=t.dataIdMap.get(f.dataId).id,w=t.dataIdMap.get(x.dataId).id,N=new Uint8Array(new Int32Array(A.computeStrides(p.shape)).buffer),S=new Uint8Array(new Int32Array(A.computeStrides(g)).buffer);return r7(b,jn[a.dtype],N,y,v,h.batchSize,S,w),t.disposeData(p.dataId),t.disposeData(f.dataId),x.shape=h.outputShape,x}var pUe={kernelName:Mf,backendName:"wasm",setupFunc:dUe,kernelFunc:hUe},mUe=!1,fUe=Gr(Ff,mUe,"bool"),gUe=!1,xUe=Gr(wh,gUe,"bool"),yUe=kn(kh,"bool"),bUe=kn(Sh,"bool"),vUe=kn(Ch,"bool"),a7;function wUe(e){a7=e.wasm.cwrap(_h,null,["number","number","number","number"])}function NUe(e){let{inputs:{x:t},attrs:{alpha:n},backend:r}=e,a=r.dataIdMap.get(t.dataId).id,s=r.makeOutput(t.shape,"float32");if(A.sizeFromShape(t.shape)!==0){let i=r.dataIdMap.get(s.dataId).id;a7(a,jn[t.dtype],n,i)}return s}var kUe={kernelName:_h,backendName:"wasm",setupFunc:wUe,kernelFunc:NUe},SUe=!1,CUe=Gr(Pf,SUe,"bool"),_Ue=!1,IUe=Gr(Of,_Ue,"bool"),s7;function TUe(e){s7=e.wasm.cwrap(Lf,null,["number","number","number","number"])}function EUe(e){let{attrs:t,backend:n}=e,{start:r,stop:a,num:s}=t,i=Math.floor(s),l=n.makeOutput([i],"float32");return s7(n.dataIdMap.get(l.dataId).id,r,a,i),l}var jUe={kernelName:Lf,backendName:"wasm",setupFunc:TUe,kernelFunc:EUe},AUe=kn(Ih),RUe=kn(Th),DUe=!1,MUe=Gr(zf,DUe,"bool"),$Ue=kn(Bf),FUe=!1,PUe=Gr(Wf,FUe,"bool"),OUe=!1,LUe=Gr(aW,OUe,"bool"),i7;function zUe(e){i7=e.wasm.cwrap(Eh,null,["number","number","number","number","number","number","number"])}function BUe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:i,alpha:l,beta:u}=r;if(a.dtype!=="float32")throw new Error("LRN error: x must have dtype float32");let d=n.makeOutput(a.shape,a.dtype);return i7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,a.shape[3],s,i,l,u),d}var WUe={kernelName:Eh,backendName:"wasm",setupFunc:zUe,kernelFunc:BUe},o7;function VUe(e){o7=e.wasm.cwrap(Vf,null,["number","number","number","number","number","number","number","number","number"])}function UUe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:i}=t,{depthRadius:l,bias:u,alpha:d,beta:c}=r;if(a.dtype!=="float32"||s.dtype!=="float32"||i.dtype!=="float32")throw new Error("LRNGrad error: x, y, and dy must have dtype float32");let h=n.makeOutput(a.shape,a.dtype);return o7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(i.dataId).id,n.dataIdMap.get(h.dataId).id,i.shape[3],l,u,d,c),h}var HUe={kernelName:Vf,backendName:"wasm",setupFunc:VUe,kernelFunc:UUe},l7;function GUe(e){l7=e.wasm.cwrap(jh,null,["number","number","number","number"])}function qUe(e){let{backend:t,inputs:n,attrs:r}=e,{reductionIndices:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=i,{transposed:d,axes:c,originalAxes:h,inputWasTransposed:p}=fc(i,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;u=d,l=b}let m=u.shape.length;z.assertAxesAreInnerMostDims("max",c,m);let[f,g]=z.computeOutAndReduceShapes(u.shape,c),x=A.sizeFromShape(g),y=t.makeOutput(f,i.dtype);if(A.sizeFromShape(u.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;l7(l,jn[i.dtype],x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var KUe={kernelName:jh,backendName:"wasm",setupFunc:GUe,kernelFunc:qUe},YUe=Gr(Ah),u7;function XUe(e){u7=e.wasm.cwrap(Rh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function ZUe(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id;A.assert(a.dtype==="float32",()=>`Error in MaxPool: only float32 input is supported. Got ${a.dtype}.`);let{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=n,c=z.computePool2DInfo(a.shape,i,l,1,u,d),h=c.filterHeight,p=c.filterWidth,m=c.padInfo.top,f=c.padInfo.right,g=c.padInfo.bottom,x=c.padInfo.left,y=c.dilationHeight,b=c.dilationWidth,v=c.strideHeight,w=c.strideWidth,N=c.inChannels,S=c.outChannels;if(c.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${c.dataFormat}'. Please use 'channelsLast'.`);let C=r.makeOutput(c.outShape,"float32"),_=r.dataIdMap.get(C.dataId).id;return u7(s,a.shape[0],a.shape[1],a.shape[2],h,p,m,f,g,x,y,b,v,w,N,S,_),C}var QUe={kernelName:Rh,backendName:"wasm",setupFunc:XUe,kernelFunc:ZUe},c7;function JUe(e){c7=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function e8e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,dimRoundingMode:u,dataFormat:d}=r,c=z.computePool3DInfo(a.shape,s,i,1,l,u,d),h=n.makeOutput(c.outShape,a.dtype);return c7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),h}var t8e={kernelName:Uf,backendName:"wasm",setupFunc:JUe,kernelFunc:e8e},d7;function n8e(e){d7=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function r8e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=r,c=z.computePool3DInfo(s.shape,i,l,1,u,d),h=n.makeOutput(s.shape,s.dtype);return d7(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,c.batchSize,c.inChannels,c.inDepth,c.inHeight,c.inWidth,c.outDepth,c.outHeight,c.outWidth,c.strideDepth,c.strideHeight,c.strideWidth,c.dilationDepth,c.dilationHeight,c.dilationWidth,c.effectiveFilterDepth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.front,c.padInfo.top,c.padInfo.left),h}var a8e={kernelName:nb,backendName:"wasm",setupFunc:n8e,kernelFunc:r8e},h7;function s8e(e){h7=e.wasm.cwrap("MaxPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function i8e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:i,strides:l,pad:u,dimRoundingMode:d}=r,c=z.computePool2DInfo(s.shape,i,l,1,u,d),h=n.makeOutput(s.shape,s.dtype);return h7(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.top,c.padInfo.left),h}var o8e={kernelName:tb,backendName:"wasm",setupFunc:s8e,kernelFunc:i8e},p7;function l8e(e){p7=e.wasm.cwrap("MaxPoolWithArgmax",null,["number","number","number","number","boolean","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function u8e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:i,pad:l,includeBatchInIndex:u}=r;A.assert(a.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.shape.length}.`);let d=[1,1];A.assert(z.eitherStridesOrDilationsAreOne(i,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);let c=z.computePool2DInfo(a.shape,s,i,[1,1],l),h=n.makeOutput(c.outShape,a.dtype),p=n.makeOutput(c.outShape,"int32");return p7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,n.dataIdMap.get(p.dataId).id,jn[a.dtype],u,c.batchSize,c.inChannels,c.inHeight,c.inWidth,c.outHeight,c.outWidth,c.strideHeight,c.strideWidth,c.dilationHeight,c.dilationWidth,c.effectiveFilterHeight,c.effectiveFilterWidth,c.padInfo.top,c.padInfo.left),[h,p]}var c8e={kernelName:rb,backendName:"wasm",setupFunc:l8e,kernelFunc:u8e},m7;function d8e(e){m7=e.wasm.cwrap(Dh,null,["number, number, number"])}function h8e(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=l,d=i,{transposed:c,axes:h,originalAxes:p,inputWasTransposed:m}=fc(i,a,t),f=h;if(m){let w=t.dataIdMap.get(c.dataId).id;w!==l&&(d=c,u=w,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("mean",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=A.sizeFromShape(x),b=d;d.dtype!=="float32"&&(b=gc({backend:t,inputs:{x:d},attrs:{dtype:"float32"}}),u=t.dataIdMap.get(b.dataId).id);let v=t.makeOutput(g,"float32");if(A.sizeFromShape(d.shape)!==0){let w=t.dataIdMap.get(v.dataId).id;m7(u,y,w)}if(m&&t.disposeData(c.dataId),s){let w=z.expandShapeToKeepDim(v.shape,p);v.shape=w}return d.dtype!=="float32"&&t.disposeData(b.dataId),v}var p8e={kernelName:Dh,backendName:"wasm",setupFunc:d8e,kernelFunc:h8e},f7;function m8e(e){f7=e.wasm.cwrap(Mh,null,["number","number","number","number"])}function f8e(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=l,d=i,{transposed:c,axes:h,originalAxes:p,inputWasTransposed:m}=fc(i,a,t);if(m){let v=t.dataIdMap.get(c.dataId).id;v!==l&&(d=c,u=v)}let f=d.shape.length;z.assertAxesAreInnerMostDims("min",h,f);let[g,x]=z.computeOutAndReduceShapes(d.shape,h),y=A.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(A.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;f7(u,jn[i.dtype],y,v)}if(m&&t.disposeData(c.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var g8e={kernelName:Mh,backendName:"wasm",setupFunc:m8e,kernelFunc:f8e},x8e=Gr($h),VC;(function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"})(VC||(VC={}));var g7;function y8e(e){g7=e.wasm.cwrap(Fh,null,["number","array","number","number","array","array","number","number"])}function b8e(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,mode:a}}=e,s=r.map((f,g)=>f[0]+t.shape[g]+f[1]),i=n.dataIdMap.get(t.dataId).id,l=n.makeOutput(s,t.dtype),u=n.dataIdMap.get(l.dataId).id,d=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(f=>f[0]),h=r.map(f=>f[1]),p=new Uint8Array(new Int32Array(c).buffer),m=new Uint8Array(new Int32Array(h).buffer);return g7(i,d,t.shape.length,jn[t.dtype],p,m,VC[a],u),l}var v8e={kernelName:Fh,backendName:"wasm",kernelFunc:b8e,setupFunc:y8e},x7;function w8e(e){x7=e.wasm.cwrap(ip,null,["number","number","number","number"])}function y7(e){let{backend:t,inputs:{logits:n},attrs:{dim:r}}=e,a=t.dataIdMap.get(n.dataId).id,s=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(s.dataId).id,l=n.shape[r],u=A.sizeFromShape(n.shape)/l;return A.sizeFromShape(s.shape)===0||x7(a,i,l,u),s}var N8e={kernelName:ip,backendName:"wasm",setupFunc:w8e,kernelFunc:y7},b7;function k8e(e){b7=e.wasm.cwrap(Hf,null,["number","number","number","number","number","number"])}function S8e(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:i,normalized:l}=r;if(a.dtype!=="float32")throw new Error(`Tensor logits must have dtype float32, got ${a.dtype}`);let u=l?a:y7({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),[d,c]=u.shape,h=n.makeOutput([d,s],"int32");return b7(n.dataIdMap.get(u.dataId).id,d,c,s,i,n.dataIdMap.get(h.dataId).id),l||n.disposeData(u.dataId),h}var C8e={kernelName:Hf,backendName:"wasm",setupFunc:k8e,kernelFunc:S8e},_8e=Gr(Ph),I8e=Gr(Oh),T8e=kn(Gf);function jA(e,t){let n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],s=n[2],i=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:s,pValidOutputs:i}}var v7;function E8e(e){v7=e.wasm.cwrap(Kf,"number",["number","number","number","number","number"])}function j8e(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i}=r,{boxes:l,scores:u}=n,d=t.dataIdMap.get(l.dataId).id,c=t.dataIdMap.get(u.dataId).id,h=v7(d,c,s,a,i),{pSelectedIndices:p,selectedSize:m,pSelectedScores:f,pValidOutputs:g}=jA(t,h);return t.wasm._free(f),t.wasm._free(g),t.makeOutput([m],"int32",p)}var A8e={kernelName:Kf,backendName:"wasm",setupFunc:E8e,kernelFunc:j8e},w7;function R8e(e){w7=e.wasm.cwrap(Yf,"number",["number","number","number","number","number","bool"])}function D8e(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i,padToMaxOutputSize:l}=r,{boxes:u,scores:d}=n,c=t.dataIdMap.get(u.dataId).id,h=t.dataIdMap.get(d.dataId).id,p=w7(c,h,s,a,i,l),{pSelectedIndices:m,selectedSize:f,pSelectedScores:g,pValidOutputs:x}=jA(t,p);t.wasm._free(g);let y=t.makeOutput([f],"int32",m),b=t.makeOutput([],"int32",x);return[y,b]}var M8e={kernelName:Yf,backendName:"wasm",setupFunc:R8e,kernelFunc:D8e},N7;function $8e(e){N7=e.wasm.cwrap(Xf,"number",["number","number","number","number","number","number"])}function F8e(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:i,softNmsSigma:l}=r,{boxes:u,scores:d}=n,c=t.dataIdMap.get(u.dataId).id,h=t.dataIdMap.get(d.dataId).id,p=N7(c,h,s,a,i,l),{pSelectedIndices:m,selectedSize:f,pSelectedScores:g,pValidOutputs:x}=jA(t,p);t.wasm._free(x);let y=t.makeOutput([f],"int32",m),b=t.makeOutput([f],"float32",g);return[y,b]}var P8e={kernelName:Xf,backendName:"wasm",setupFunc:$8e,kernelFunc:F8e},O8e=!1,L8e=Gr(qf,O8e,"bool"),k7;function z8e(e){k7=e.wasm.cwrap(Lh,null,["number","number","number","number","number"])}function B8e(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:i,onValue:l,offValue:u}=r,d=n.makeOutput([...a.shape,i],s),c=n.dataIdMap.get(d.dataId).id,h=n.dataIdMap.get(a.dataId).id;return k7(h,i,l,u,c),d}var W8e={kernelName:Lh,backendName:"wasm",setupFunc:z8e,kernelFunc:B8e};function V8e(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}var U8e={kernelName:Zf,backendName:"wasm",kernelFunc:V8e};function H8e(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return WC({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,i=t[0].dtype;t.forEach(c=>{A.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),A.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],u=t.map(c=>{let h=WC({inputs:{input:c},backend:n,attrs:{dim:a}});return l.push(h),h}),d=M9({inputs:u,backend:n,attrs:{axis:a}});return l.forEach(c=>n.disposeData(c.dataId)),d}var G8e={kernelName:Qf,backendName:"wasm",kernelFunc:H8e},S7;function q8e(e){S7=e.wasm.cwrap(zh,null,["number","array","number","number","array","array","number","number"])}function K8e(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:a}}=e,s=r.map((f,g)=>f[0]+t.shape[g]+f[1]);if(A.sizeFromShape(t.shape)===0)return Z9({backend:n,attrs:{shape:s,value:a,dtype:t.dtype}});let i=n.dataIdMap.get(t.dataId).id,l=n.makeOutput(s,t.dtype),u=n.dataIdMap.get(l.dataId).id,d=new Uint8Array(new Int32Array(t.shape).buffer),c=r.map(f=>f[0]),h=r.map(f=>f[1]),p=new Uint8Array(new Int32Array(c).buffer),m=new Uint8Array(new Int32Array(h).buffer);return S7(i,d,t.shape.length,jn[t.dtype],p,m,a,u),l}var C7={kernelName:zh,backendName:"wasm",kernelFunc:K8e,setupFunc:q8e},Y8e=Gr(Bh),_7;function X8e(e){_7=e.wasm.cwrap(Wh,null,["number","number","number"])}function Z8e(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,l=s,u=r,d=u;u.dtype!=="float32"&&(d=gc({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),l=n.dataIdMap.get(d.dataId).id);let c=n.makeOutput(r.shape,"float32"),h=n.dataIdMap.get(c.dataId).id;return _7(l,i,h),u.dtype!=="float32"&&n.disposeData(d.dataId),c}var Q8e={kernelName:Wh,backendName:"wasm",setupFunc:X8e,kernelFunc:Z8e},I7;function J8e(e){I7=e.wasm.cwrap(Vh,null,["number","number","number","number"])}function eHe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=l,d=i,{transposed:c,axes:h,originalAxes:p,inputWasTransposed:m}=fc(i,a,t),f=h;if(m){let v=t.dataIdMap.get(c.dataId).id;v!==l&&(d=c,u=v,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("prod",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=A.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(A.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;I7(u,y,jn[b.dtype],v)}if(m&&t.disposeData(c.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var tHe={kernelName:Vh,backendName:"wasm",setupFunc:J8e,kernelFunc:eHe},nHe=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:i}=n,l=aA(r,a,s,i),u=t.makeOutput([l.length],i);return t.typedArrayFromHeap(u).set(l),u},rHe={kernelName:ab,backendName:"wasm",kernelFunc:nHe},aHe=Gr(ph),sHe=kn(Uh),iHe=kn(Hh),oHe=kn(Kh),T7;function lHe(e){T7=e.wasm.cwrap(qh,null,["number","number","number","number","number","number","number","number","number","number"])}function uHe(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:i,size:l}=r,[u,d]=l,[c,h,p,m]=a.shape,f=[c,u,d,m],g=t.dataIdMap.get(a.dataId),x;g.dtype!=="float32"&&(x=gc({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(x.dataId));let y=g.id,b=t.makeOutput(f,"float32");if(A.sizeFromShape(a.shape)===0)return b;let v=t.dataIdMap.get(b.dataId).id;return T7(y,c,h,p,m,u,d,s?1:0,i?1:0,v),x!=null&&t.disposeData(x.dataId),b}var cHe={kernelName:qh,backendName:"wasm",setupFunc:lHe,kernelFunc:uHe},E7;function dHe(e){E7=e.wasm.cwrap(tg,null,["number","number","number","array","array","boolean"])}function hHe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,l=n.makeOutput(a.shape,"float32"),u=n.dataIdMap.get(a.dataId),d;return u.dtype!=="float32"&&(d=gc({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),u=n.dataIdMap.get(d.dataId)),E7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),i),d!=null&&n.disposeData(d.dataId),l}var pHe={kernelName:tg,backendName:"wasm",setupFunc:dHe,kernelFunc:hHe},j7;function mHe(e){j7=e.wasm.cwrap(Gh,null,["number","number","number","number","number","number","number","number","number","number"])}function fHe(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:i,size:l}=r,[u,d]=l,[c,h,p,m]=a.shape,f=[c,u,d,m],g=t.makeOutput(f,"float32");if(A.sizeFromShape(a.shape)===0)return g;let x=t.dataIdMap.get(a.dataId),y;x.dtype!=="float32"&&(y=gc({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(y.dataId));let b=x.id,v=t.dataIdMap.get(g.dataId).id;return j7(b,c,h,p,m,u,d,s?1:0,i?1:0,v),y!=null&&t.disposeData(y.dataId),g}var gHe={kernelName:Gh,backendName:"wasm",setupFunc:mHe,kernelFunc:fHe},A7;function xHe(e){A7=e.wasm.cwrap(eg,null,["number","number","number","array","array","boolean"])}function yHe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:i}=r,l=n.makeOutput(a.shape,"float32"),u=n.dataIdMap.get(a.dataId),d;return u.dtype!=="float32"&&(d=gc({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),u=n.dataIdMap.get(d.dataId)),A7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),i),d!=null&&n.disposeData(d.dataId),l}var bHe={kernelName:eg,backendName:"wasm",setupFunc:xHe,kernelFunc:yHe},R7;function vHe(e){R7=e.wasm.cwrap(Yh,null,["number","array","number","array","number","number"])}function wHe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,i=A.parseAxisParam(s,a.shape);if(a.shape.length===0)return jN({inputs:{x:a},backend:n});let l=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(l.dataId).id,c=new Uint8Array(new Int32Array(i).buffer),h=new Uint8Array(new Int32Array(a.shape).buffer);R7(u,c,i.length,h,a.shape.length,d);let p=ps({inputs:{x:l},attrs:{shape:a.shape},backend:n});return n.disposeData(l.dataId),p}var NHe={kernelName:Yh,backendName:"wasm",kernelFunc:wHe,setupFunc:vHe},D7;function kHe(e){D7=e.wasm.cwrap(gg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function SHe(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{radians:s,fillValue:i,center:l}=r,u=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(u.dataId).id,[h,p,m,f]=a.shape,[g,x]=z.getImageCenter(l,p,m),y=i===0,b=255,v=typeof i=="number"?[i,i,i,y?0:b]:[...i,b],w=new Uint8Array(new Int32Array(v).buffer);return D7(d,h,p,m,f,s,g,x,w,v.length,c),u}var CHe={kernelName:gg,backendName:"wasm",kernelFunc:SHe,setupFunc:kHe},_He=kn(Xh),IHe=kn(Zh),M7;function THe(e){M7=e.wasm.cwrap(ng,null,["number","number","number","number","number","number","array","number","number"])}function EHe(e){let{backend:t,inputs:n,attrs:r}=e,{indices:a,updates:s}=n,{shape:i}=r,l=t.makeOutput(i,s.dtype);if(A.sizeFromShape(i)===0)return l;let{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=G1.calculateShapes(s,a,i),m=t.dataIdMap.get(a.dataId).id,f=t.dataIdMap.get(s.dataId).id,g=new Uint8Array(new Int32Array(h).buffer),x=t.dataIdMap.get(l.dataId).id;return M7(m,f,jn[s.dtype],u,d,c,g,p,x),l}var jHe={kernelName:ng,backendName:"wasm",setupFunc:THe,kernelFunc:EHe},$7;function AHe(e){$7=e.wasm.cwrap(ag,null,["number","number","number","number","number","number","bool","number"])}function RHe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:i}=r;if(a.dtype!==s.dtype)throw new Error(`SearchSorted error: sorted_sequence must have the same dtype as values. Got ${a.dtype} and ${s.dtype}`);let l=n.makeOutput(s.shape,"int32");function u(d){return n.dataIdMap.get(d.dataId).id}return $7(u(a),u(s),a.shape[0],a.shape[1],s.shape[1],jn[a.dtype],i==="left",u(l)),l}var DHe={kernelName:ag,backendName:"wasm",setupFunc:AHe,kernelFunc:RHe},F7;function MHe(e){F7=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}function $He(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,i=n.dataIdMap.get(r.dataId).id,l=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(s.dataId).id,d=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(d.dataId).id,h=r.shape.length,p=a.shape.length,m=h===0||h>1||p===1?1:A.sizeFromShape(a.shape.slice(1));return F7(i,l,u,m,c),d}var FHe={kernelName:sg,backendName:"wasm",kernelFunc:$He,setupFunc:MHe},PHe=kn(Qh),P7;function OHe(e){P7=e.wasm.cwrap(np,null,["number","number"])}function LHe(e){let{backend:t,inputs:{x:n}}=e,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(a.dataId).id;return A.sizeFromShape(a.shape)===0||P7(r,s),a}var zHe={kernelName:"Sigmoid",backendName:"wasm",setupFunc:OHe,kernelFunc:LHe},BHe=kn(tp),WHe=kn(Jh),VHe=kn(ep),UHe=kn(rp);function HHe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:i}=r,l=A.sizeFromShape(s),u=[[0,0]];u.push(...i);for(let x=1+s.length;x<a.shape.length;++x)u.push([0,0]);let d=C7.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),c=z.getReshaped(d.shape,s,l,!1),h=z.getPermuted(c.length,s.length,!1),p=z.getReshapedPermuted(d.shape,s,l,!1),m=ps({inputs:{x:d},backend:n,attrs:{shape:c}}),f=Xu({inputs:{x:m},backend:n,attrs:{perm:h}}),g=ps({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeData(d.dataId),n.disposeData(m.dataId),n.disposeData(f.dataId),g}var GHe={kernelName:og,backendName:"wasm",kernelFunc:HHe},O7;function qHe(e){O7=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])}function KHe(e){let{backend:t,inputs:n}=e,{indices:r,values:a,denseShape:s,defaultValue:i}=n,l=r.shape[0],u=r.shape[1],d=t.readSync(s.dataId)[0],c=[l+d,u],h=t.dataIdMap.get(r.dataId).id,p=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,f=t.makeOutput(c,r.dtype),g=t.dataIdMap.get(f.dataId).id,x=t.makeOutput(c.slice(0,1),a.dtype),y=t.dataIdMap.get(x.dataId).id,b=t.makeOutput([d],"bool"),v=t.dataIdMap.get(b.dataId).id,w=t.makeOutput([l],r.dtype),N=t.dataIdMap.get(w.dataId).id,S=t.makeOutput([4],"int32"),C=t.dataIdMap.get(S.dataId).id,_=O7(h,p,jn[a.dtype],l,d,u,m,g,y,v,N,C),T=t.readSync(S.dataId),E;switch(T[0]){case 1:{E=z.getSparseFillEmptyRowsIndicesDenseShapeMismatch(T[1]);break}case 2:{E=z.getSparseFillEmptyRowsNegativeIndexErrorMessage(T[1],T[2]);break}case 3:E=z.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(T[1],T[2],T[3]);break;default:E=""}if(t.disposeData(S.dataId),E)throw t.disposeData(f.dataId),t.disposeData(x.dataId),t.disposeData(b.dataId),t.disposeData(w.dataId),new Error(E);let j=f,I=x;return _!==c[0]&&(j=Ud({inputs:{x:f},attrs:{begin:0,size:[_,u]},backend:t}),I=Ud({inputs:{x},attrs:{begin:0,size:_},backend:t}),t.disposeData(f.dataId),t.disposeData(x.dataId)),[j,I,b,w]}var YHe={kernelName:sb,backendName:"wasm",setupFunc:qHe,kernelFunc:KHe},L7;function XHe(e){L7=e.wasm.cwrap(ug,null,["number","number","number","number","number","number","number"])}function ZHe(e){let{backend:t,inputs:n}=e,{inputIndices:r,inputShape:a,newShape:s}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=t.dataIdMap.get(r.dataId).id,l=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(s.dataId).id,d=r.shape[0],c=A.sizeFromShape(s.shape),h=t.makeOutput([d,c],r.dtype),p=t.dataIdMap.get(h.dataId).id,m=t.makeOutput([c],s.dtype),f=t.dataIdMap.get(m.dataId).id,g=t.makeOutput([3],"int32"),x=t.dataIdMap.get(g.dataId).id;L7(i,l,u,d,p,f,x);let y=t.readSync(g.dataId),b;switch(y[0]){case 0:{b=z.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break}case 1:{b=z.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break}case 2:b=z.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:{let v=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(m.dataId));b=z.getSparseReshapeInputOutputMultipleErrorMessage(v,w);break}case 4:{let v=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(m.dataId));b=z.getSparseReshapeInputOutputMismatchErrorMessage(v,w);break}default:b=""}if(t.disposeData(g.dataId),b)throw t.disposeData(h.dataId),t.disposeData(m.dataId),new Error(b);return[h,m]}var QHe={kernelName:ug,backendName:"wasm",setupFunc:XHe,kernelFunc:ZHe},z7;function B7(e){z7=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function W7(e,t){let{backend:n,inputs:r}=e,{data:a,indices:s,segmentIds:i}=r,l=s.shape[0],u=n.readSync(i.dataId,l-1,l)[0],d=l>0?u+1:0;if(d<0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let c=a.shape.slice();c[0]=d;let h=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(s.dataId).id,m=n.dataIdMap.get(i.dataId).id,f=n.makeOutput(c,a.dtype),g=n.dataIdMap.get(f.dataId).id,x=n.makeOutput([4],"int32"),y=n.dataIdMap.get(x.dataId).id;z7(h,jn[a.dtype],a.shape[0],p,m,g,y,t,0);let b=n.readSync(x.dataId),v;switch(b[0]){case 0:{v=z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break}case 1:{v=z.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break}case 2:v=z.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:v=z.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:v=""}if(n.disposeData(x.dataId),v)throw n.disposeData(f.dataId),new Error(v);return f}function JHe(e){return W7(e,!0)}var eGe={kernelName:ib,backendName:"wasm",setupFunc:B7,kernelFunc:JHe};function tGe(e){return W7(e,!1)}var nGe={kernelName:ob,backendName:"wasm",setupFunc:B7,kernelFunc:tGe},V7;function rGe(e){V7=e.wasm.cwrap(cg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function aGe(e){let{backend:t,inputs:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:i}=n,{outputShape:l}=r,u=t.makeOutput(l,i.dtype);if(A.sizeFromShape(l)===0)return u;let{sliceRank:d,numUpdates:c,sliceSize:h,strides:p,outputSize:m}=z.calculateShapes(s,a,l),f=t.dataIdMap.get(a.dataId).id,g=t.dataIdMap.get(s.dataId).id,x=t.dataIdMap.get(i.dataId).id,y=new Uint8Array(new Int32Array(p).buffer),b=t.dataIdMap.get(u.dataId).id;return V7(f,g,s.shape.length,x,jn[i.dtype],d,c,h,y,m,b),u}var sGe={kernelName:cg,backendName:"wasm",setupFunc:rGe,kernelFunc:aGe};function iGe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:i}=n,l=A.parseAxisParam(i,a.shape)[0],u=z.prepareSplitSize(a,s,l),d=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map(h=>{let p=[...c];p[l]=h;let m=Ud({inputs:{x:a},attrs:{begin:d,size:p},backend:r});return d[l]+=h,m})}var oGe={kernelName:lg,backendName:"wasm",kernelFunc:iGe},lGe=kn(ap),uGe=kn(lb),cGe=Gr(op),U7;function dGe(e){U7=e.wasm.cwrap(oc,null,["number","number","number","number"])}function hGe(e){let{backend:t,inputs:n,attrs:r}=e,{alpha:a}=r,{x:s}=n,i=t.dataIdMap.get(s.dataId).id,l=t.makeOutput(s.shape,s.dtype),u=t.dataIdMap.get(l.dataId).id;return U7(i,a,jn[s.dtype],u),l}var pGe={kernelName:oc,backendName:"wasm",setupFunc:dGe,kernelFunc:hGe},H7;function mGe(e){H7=e.wasm.cwrap(dg,null,["number","array","number","array","array","array","array","array","number","number"])}function fGe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{begin:s,end:i,strides:l,beginMask:u,endMask:d,ellipsisMask:c,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=ea.sliceInfo(a.shape,s,i,l,u,d,c,h,p),N;if(g)N=ps({inputs:{x:a},backend:t,attrs:{shape:f}});else if(x||y){A.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let S=ea.computeOutShape(b,v,w),C=Ud({inputs:{x:a},backend:t,attrs:{begin:b,size:S}});N=ps({inputs:{x:C},backend:t,attrs:{shape:f}}),t.disposeData(C.dataId)}else{let S=t.makeOutput(m,"float32"),C=t.dataIdMap.get(a.dataId).id,_=new Uint8Array(new Int32Array(A.computeStrides(a.shape)).buffer),T=new Uint8Array(new Int32Array(b).buffer),E=new Uint8Array(new Int32Array(v).buffer),j=new Uint8Array(new Int32Array(w).buffer),I=new Uint8Array(new Int32Array(m).buffer),D=new Uint8Array(new Int32Array(A.computeStrides(m)).buffer),F=t.dataIdMap.get(S.dataId).id;H7(C,_,a.shape.length,T,E,j,I,D,m.length,F),N=ps({inputs:{x:S},backend:t,attrs:{shape:f}}),t.disposeData(S.dataId)}return N}var gGe={kernelName:dg,backendName:"wasm",setupFunc:mGe,kernelFunc:fGe};function xGe(e){let{backend:t,inputs:n,attrs:r}=e,{data:a,dataSplits:s}=n,{separator:i,nGramWidths:l,leftPad:u,rightPad:d,padWidth:c,preserveShortSequences:h}=r,p=t.readSync(a.dataId),m=t.readSync(s.dataId),[f,g]=iA(p,m,i,l,u,d,c,h),x=t.makeOutput([f.length],"string"),y=t.dataIdMap.get(x.dataId);y.stringBytes=f;let b=t.makeOutput(s.shape,"int32");return t.typedArrayFromHeap(b).set(g),[x,b]}var yGe={kernelName:cb,backendName:"wasm",kernelFunc:xGe};function bGe(e){let{backend:t,inputs:n,attrs:r}=e,{input:a,delimiter:s}=n,{skipEmpty:i}=r,l=t.readSync(a.dataId),u=t.readSync(s.dataId),[d,c,h]=oA(l,u[0],i),p=c.length,m=t.makeOutput([p,2],"int32");t.typedArrayFromHeap(m).set(d);let f=t.makeOutput([p],"string"),g=t.dataIdMap.get(f.dataId);g.stringBytes=c;let x=t.makeOutput([2],"int32");return t.typedArrayFromHeap(x).set(h),[m,f,x]}var vGe={kernelName:db,backendName:"wasm",kernelFunc:bGe};function wGe(e){let{backend:t,inputs:n,attrs:r}=e,{input:a}=n,{numBuckets:s}=r,i=t.readSync(a.dataId),l=lA(i,s),u=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(u).set(l),u}var NGe={kernelName:hb,backendName:"wasm",kernelFunc:wGe},kGe=Gr(lp),G7;function SGe(e){G7=e.wasm.cwrap(sp,null,["number","number","number","number"])}function CGe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:i}=n,l=t.dataIdMap.get(i.dataId).id,u=l,d=i,{transposed:c,axes:h,originalAxes:p,inputWasTransposed:m}=fc(i,a,t),f=h;if(m){let v=t.dataIdMap.get(c.dataId).id;v!==l&&(d=c,u=v,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("sum",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=A.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(A.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;G7(u,y,jn[b.dtype],v)}if(m&&t.disposeData(c.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var _Ge={kernelName:sp,backendName:"wasm",setupFunc:SGe,kernelFunc:CGe},IGe=kn(up),TGe=kn(cp),q7;function EGe(e){q7=e.wasm.cwrap(rg,null,["number","number","number","number","number","number","array","number","number","number"])}function jGe(e){let{backend:t,inputs:n,attrs:r}=e,{tensor:a,indices:s,updates:i}=n,l=t.makeOutput(a.shape,a.dtype);if(A.sizeFromShape(a.shape)===0)return l;let{sliceRank:u,numUpdates:d,sliceSize:c,strides:h,outputSize:p}=G1.calculateShapes(i,s,a.shape),m=t.dataIdMap.get(s.dataId).id,f=t.dataIdMap.get(i.dataId).id,g=t.dataIdMap.get(a.dataId).id,x=new Uint8Array(new Int32Array(h).buffer),y=t.dataIdMap.get(l.dataId).id;return q7(m,f,jn[i.dtype],u,d,c,x,p,y,g),l}var AGe={kernelName:rg,backendName:"wasm",setupFunc:EGe,kernelFunc:jGe},K7;function RGe(e){K7=e.wasm.cwrap(ic,null,["number","array","number","array","number","number"])}function DGe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,s=n.dataIdMap.get(a.dataId).id,{reps:i}=r,l=new Array(a.shape.length);for(let p=0;p<l.length;p++)l[p]=a.shape[p]*i[p];let u=new Uint8Array(new Int32Array(a.shape).buffer),d=new Uint8Array(new Int32Array(l).buffer),c=n.makeOutput(l,a.dtype),h=n.dataIdMap.get(c.dataId).id;return K7(s,u,a.shape.length,d,l.length,jn[c.dtype],h),c}var MGe={kernelName:ic,backendName:"wasm",setupFunc:RGe,kernelFunc:DGe},Y7;function $Ge(e){Y7=e.wasm.cwrap(hg,null,["number","array","number","number","number","bool","number","number"])}var FGe=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{k:a,sorted:s}=n,i=t.dataIdMap.get(r.dataId).id,l=new Uint8Array(new Int32Array(r.shape).buffer),u=r.shape.slice();u[u.length-1]=a;let d=t.makeOutput(u,r.dtype),c=t.dataIdMap.get(d.dataId).id,h=t.makeOutput(u,"int32"),p=t.dataIdMap.get(h.dataId).id;return Y7(i,l,r.shape.length,jn[r.dtype],a,s,c,p),[d,h]},PGe={kernelName:hg,backendName:"wasm",setupFunc:$Ge,kernelFunc:FGe},X7;function OGe(e){X7=e.wasm.cwrap(pg,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])}function LGe(e){let{backend:t,inputs:n,attrs:r}=e,{image:a,transforms:s}=n,{interpolation:i,fillMode:l,fillValue:u,outputShape:d}=r,[c,h,p,m]=a.shape,[f,g]=d??[h,p],x=[c,f,g,m],y=new Uint8Array(new Int32Array(A.computeStrides(a.shape)).buffer),b=new Uint8Array(new Int32Array(A.computeStrides(x)).buffer),v=t.makeOutput(x,a.dtype),w=t.dataIdMap.get(v.dataId).id,N=t.dataIdMap.get(a.dataId).id,S=t.dataIdMap.get(s.dataId).id,C=i==="nearest"?1:2,_;switch(l){case"constant":_=1;break;case"reflect":_=2;break;case"wrap":_=3;break;case"nearest":_=4;break;default:_=1;break}return X7(N,S,s.shape[0]>1,c,f,g,m,p,h,y,a.shape.length-1,b,x.length-1,C,_,u,w),v}var zGe={kernelName:pg,backendName:"wasm",setupFunc:OGe,kernelFunc:LGe};function BGe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t,{outputValues:i,outputShape:l,indices:u}=cA(r.readSync(s.dataId),a,s.shape,s.dtype);return[r.makeOutput(l,s.dtype,void 0,i),r.makeOutput([u.length],"int32",void 0,u)]}var WGe={kernelName:pb,backendName:"wasm",kernelFunc:BGe};function VGe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let i=a.shape[s],l=a.shape.length,u=new Array(l-1),d=0;for(let m=0;m<l;m++)m!==s&&(u[d++]=a.shape[m]);let c=new Array(i),h=new Array(l).fill(0),p=a.shape.slice();p[s]=1;for(let m=0;m<c.length;m++)h[s]=m,c[m]=Ud({inputs:{x:a},attrs:{begin:h,size:p},backend:n});return c.map(({dataId:m,dtype:f})=>({dataId:m,dtype:f,shape:u}))}var UGe={kernelName:mg,backendName:"wasm",kernelFunc:VGe};function HGe(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}var GGe={kernelName:fg,backendName:"wasm",kernelFunc:HGe},qGe=[OWe,LWe,zWe,BWe,WWe,HWe,JWe,n6e,r6e,a6e,s6e,i6e,o6e,l6e,u6e,h6e,w6e,f6e,y6e,C6e,A6e,M6e,$6e,P6e,O6e,L6e,W6e,V6e,G6e,Y6e,Q6e,tVe,aVe,sVe,iVe,uVe,hVe,fVe,yVe,wVe,SVe,IVe,jVe,DVe,FVe,PVe,zVe,WVe,VVe,UVe,HVe,GVe,qVe,XVe,ZVe,QVe,tUe,aUe,oUe,cUe,pUe,fUe,xUe,GWe,yUe,bUe,vUe,kUe,CUe,IUe,jUe,RUe,AUe,MUe,$Ue,PUe,LUe,WUe,HUe,KUe,YUe,QUe,t8e,a8e,o8e,c8e,p8e,g8e,x8e,v8e,C8e,_8e,I8e,T8e,A8e,M8e,P8e,L8e,W8e,U8e,G8e,C7,Y8e,Q8e,tHe,rHe,aHe,sHe,iHe,oHe,N6e,cHe,pHe,gHe,bHe,NHe,CHe,_He,IHe,jHe,DHe,FHe,PHe,zHe,BHe,WHe,VHe,E6e,N8e,UHe,GHe,YHe,QHe,eGe,nGe,sGe,oGe,lGe,uGe,cGe,pGe,gGe,yGe,vGe,NGe,kGe,_Ge,IGe,TGe,AGe,MGe,PGe,zGe,XWe,WGe,UGe,GGe];for(let e of qGe)fb(e);var UC=be();UC.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))}catch{return!1}});UC.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{if(UC.get("IS_NODE"))return!1;try{return new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}});var fP=rc(Tpe()),KGe=rc(Epe()),gP=rc(jpe()),xP=fP.default||fP,YGe=gP.default||gP,Z7=class extends Gy{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.initWithThreadsCount(Q7),HC=this.wasm.tfjs.getThreadsCount(),this.dataIdMap=new a1(this,hi())}write(e,t,n){let r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){let t=A.now();return e(),{kernelMs:A.now()-t}}move(e,t,n,r,a){let s=this.dataIdNextNumber++;if(r==="string"){let d=t;this.dataIdMap.set(e,{id:s,stringBytes:d,shape:n,dtype:r,memoryOffset:null,refCount:a});return}let i=A.sizeFromShape(n),l=i*A.bytesPerElement(r),u=this.wasm._malloc(l)>>>0;this.dataIdMap.set(e,{id:s,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(s,i,u),t!=null&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,l),u)}async read(e){return this.readSync(e)}readSync(e,t,n){let{memoryOffset:r,dtype:a,shape:s,stringBytes:i}=this.dataIdMap.get(e);if(a==="string")return(t==null||t===0)&&(n==null||n>=i.length)?i:i.slice(t,n);t=t||0,n=n||A.sizeFromShape(s);let l=A.bytesPerElement(a),u=this.wasm.HEAPU8.slice(r+t*l,r+n*l);return QGe(u.buffer,a)}disposeData(e,t=!1){if(this.dataIdMap.has(e)){let n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}incRef(e){let t=this.dataIdMap.get(e);t!=null&&t.refCount++}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n,r){let a;if(n==null)a=this.write(r??null,e,t);else{let s=this.dataIdNextNumber++;a={id:s},this.dataIdMap.set(a,{id:s,memoryOffset:n,shape:e,dtype:t,refCount:1});let i=A.sizeFromShape(e);this.wasm.tfjs.registerTensor(s,i,n)}return{dataId:a,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){let r=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),s=A.sizeFromShape(e);switch(t){case"float32":return new Float32Array(r,a,s);case"int32":return new Int32Array(r,a,s);case"bool":return new Uint8Array(r,a,s);default:throw new Error(`Unknown dtype ${t}`)}}};function XGe(e){return(t,n)=>(A.fetch(e,{credentials:"same-origin"}).then(r=>{r.ok||t.env.a(`failed to load wasm binary file at '${e}'`),r.arrayBuffer().then(a=>{WebAssembly.instantiate(a,t).then(s=>{n(s.instance,s.module)})})}),{})}function yP(e,t,n){if(_0!=null)return _0;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),Bx!=null&&Bx[r]!=null?Bx[r]:n+r}async function ZGe(){let[e,t]=await Promise.all([be().getAsync("WASM_HAS_SIMD_SUPPORT"),be().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,r)=>{let a={};a.locateFile=(l,u)=>{if(l.endsWith(".worker.js")){let d=KGe.wasmWorkerContents.replace(/\n/g,"\\n"),c=new Blob([d],{type:"application/javascript"});return URL.createObjectURL(c)}return l.endsWith(".wasm")?yP(e,t,_x??u):u+l},AA&&(a.instantiateWasm=XGe(yP(e,t,_x??"")));let s=!1;a.onAbort=()=>{s||Wx||(Wx=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))};let i;t&&e&&_0==null?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+xP.toString()],{type:"text/javascript"}),i=xP(a)):i=YGe(a),i.then(l=>{s=!0,Wx=!1;let u=null;l.tfjs={init:l.cwrap("init",null,[]),initWithThreadsCount:l.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:l.cwrap("get_threads_count","number",[]),registerTensor:l.cwrap("register_tensor",null,["number","number","number"]),disposeData:l.cwrap("dispose_data",u,["number"]),dispose:l.cwrap("dispose",u,[])},n({wasm:l})}).catch(r)})}function QGe(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error(`Unknown dtype ${t}`)}}var JGe=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],_0=null,_x=null,Bx={},Wx=!1,AA=!1;function e9e(e,t=!1){if(bW("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),Wx)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");_0=e,AA=t}function t9e(e,t=!1){if(Wx)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if(typeof e=="string")_x=e;else{Bx=e;let n=JGe.filter(r=>Bx[r]==null);if(n.length>0)throw new Error(`There were no entries found for the following binaries: ${n.join(",")}. Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.`)}AA=t}var Q7=-1,HC=-1;function n9e(e){Q7=e}function r9e(){if(HC===-1)throw new Error("WASM backend not initialized.");return HC}var a9e="4.22.0",s9e=2;N1("wasm",async()=>{let{wasm:e}=await ZGe();return new Z7(e)},s9e);var bP="4.22.0",i9e="4.22.0",o9e="4.22.0",l9e="4.22.0",u9e="4.22.0",c9e={tfjs:bP,"tfjs-core":bP,"tfjs-converter":i9e,"tfjs-backend-cpu":o9e,"tfjs-backend-webgl":l9e,"tfjs-backend-wasm":u9e},d9e={};LI(d9e,{AnchorPosition:()=>mq,DrawBox:()=>xq,DrawBoxOptions:()=>gq,DrawFaceLandmarks:()=>Mq,DrawFaceLandmarksOptions:()=>Dq,DrawTextField:()=>OA,DrawTextFieldOptions:()=>PA,drawContour:()=>nu,drawDetections:()=>S9e,drawFaceExpressions:()=>P9e,drawFaceLandmarks:()=>L9e});function nu(e,t,n=!1){if(e.beginPath(),t.slice(1).forEach(({x:r,y:a},s)=>{let i=t[s];e.moveTo(i.x,i.y),e.lineTo(r,a)}),n){let r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}var h9e={};LI(h9e,{computeReshapedDimensions:()=>nq,getCenterPoint:()=>DA,isDimensions:()=>qC,isEven:()=>GC,isFloat:()=>tq,isTensor:()=>Pg,isTensor1D:()=>p9e,isTensor2D:()=>eq,isTensor3D:()=>Kb,isTensor4D:()=>Nl,isValidNumber:()=>cd,isValidProbablitiy:()=>m9e,range:()=>tf,round:()=>RA});var cm=class J7{constructor(t,n){if(!cd(t)||!cd(n))throw new Error(`Dimensions.constructor - expected width and height to be valid numbers, instead have ${JSON.stringify({width:t,height:n})}`);this._width=t,this._height=n}get width(){return this._width}get height(){return this._height}reverse(){return new J7(1/this.width,1/this.height)}};function Pg(e,t){return e instanceof Zt&&e.shape.length===t}function p9e(e){return Pg(e,1)}function eq(e){return Pg(e,2)}function Kb(e){return Pg(e,3)}function Nl(e){return Pg(e,4)}function tq(e){return e%1!==0}function GC(e){return e%2===0}function RA(e,t=2){let n=10**t;return Math.floor(e*n)/n}function qC(e){return e&&e.width&&e.height}function nq({width:e,height:t},n){let r=n/Math.max(t,e);return new cm(Math.round(e*r),Math.round(t*r))}function DA(e){return e.reduce((t,n)=>t.add(n),new er(0,0)).div(new er(e.length,e.length))}function tf(e,t,n){return Array(e).fill(0).map((r,a)=>t+a*n)}function cd(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||e===0}function m9e(e){return cd(e)&&e>=0&&e<=1}var er=class Ac{constructor(t,n){this._x=t,this._y=n}get x(){return this._x}get y(){return this._y}add(t){return new Ac(this.x+t.x,this.y+t.y)}sub(t){return new Ac(this.x-t.x,this.y-t.y)}mul(t){return new Ac(this.x*t.x,this.y*t.y)}div(t){return new Ac(this.x/t.x,this.y/t.y)}abs(){return new Ac(Math.abs(this.x),Math.abs(this.y))}magnitude(){return Math.sqrt(this.x**2+this.y**2)}floor(){return new Ac(Math.floor(this.x),Math.floor(this.y))}},Hd=class Bi{static isRect(t){return!!t&&[t.x,t.y,t.width,t.height].every(cd)}static assertIsValidBox(t,n,r=!1){if(!Bi.isRect(t))throw new Error(`${n} - invalid box: ${JSON.stringify(t)}, expected object with properties x, y, width, height`);if(!r&&(t.width<0||t.height<0))throw new Error(`${n} - width (${t.width}) and height (${t.height}) must be positive numbers`)}constructor(t,n=!0){let r=t||{},a=[r.left,r.top,r.right,r.bottom].every(cd),s=[r.x,r.y,r.width,r.height].every(cd);if(!s&&!a)throw new Error(`Box.constructor - expected box to be IBoundingBox | IRect, instead have ${JSON.stringify(r)}`);let[i,l,u,d]=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top];Bi.assertIsValidBox({x:i,y:l,width:u,height:d},"Box.constructor",n),this._x=i,this._y=l,this._width=u,this._height=d}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get area(){return this.width*this.height}get topLeft(){return new er(this.left,this.top)}get topRight(){return new er(this.right,this.top)}get bottomLeft(){return new er(this.left,this.bottom)}get bottomRight(){return new er(this.right,this.bottom)}round(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.round(s));return new Bi({x:t,y:n,width:r,height:a})}floor(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.floor(s));return new Bi({x:t,y:n,width:r,height:a})}toSquare(){let{x:t,y:n,width:r,height:a}=this,s=Math.abs(r-a);return r<a&&(t-=s/2,r+=s),a<r&&(n-=s/2,a+=s),new Bi({x:t,y:n,width:r,height:a})}rescale(t){let n=qC(t)?t.width:t,r=qC(t)?t.height:t;return new Bi({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}pad(t,n){let[r,a,s,i]=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new Bi({x:r,y:a,width:s,height:i})}clipAtImageBorders(t,n){let{x:r,y:a,right:s,bottom:i}=this,l=Math.max(r,0),u=Math.max(a,0),d=s-l,c=i-u,h=Math.min(d,t-l),p=Math.min(c,n-u);return new Bi({x:l,y:u,width:h,height:p}).floor()}shift(t,n){let{width:r,height:a}=this,s=this.x+t,i=this.y+n;return new Bi({x:s,y:i,width:r,height:a})}padAtBorders(t,n){let r=this.width+1,a=this.height+1,s=1,i=1,l=r,u=a,d=this.left,c=this.top,h=this.right,p=this.bottom;return h>n&&(l=-h+n+r,h=n),p>t&&(u=-p+t+a,p=t),d<1&&(u=2-d,d=1),c<1&&(u=2-c,c=1),{dy:i,edy:u,dx:s,edx:l,y:c,ey:p,x:d,ex:h,w:r,h:a}}calibrate(t){return new Bi({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}},rq=class extends Hd{constructor(e,t,n,r,a=!1){super({left:e,top:t,right:n,bottom:r},a)}},aq=class sq{constructor(t,n,r,a,s){this._imageDims=new cm(s.width,s.height),this._score=t,this._classScore=n,this._className=r,this._box=new Hd(a).rescale(this._imageDims)}get score(){return this._score}get classScore(){return this._classScore}get className(){return this._className}get box(){return this._box}get imageDims(){return this._imageDims}get imageWidth(){return this.imageDims.width}get imageHeight(){return this.imageDims.height}get relativeBox(){return new Hd(this._box).rescale(this.imageDims.reverse())}forSize(t,n){return new sq(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}},io=class iq extends aq{constructor(t,n,r){super(t,t,"",n,r)}forSize(t,n){let{score:r,relativeBox:a,imageDims:s}=super.forSize(t,n);return new iq(r,a,s)}};function f9e(e,t,n=!0){let r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),s=r*a;return n?s/(e.area+t.area-s):s/Math.min(e.area,t.area)}function g9e(e){let t=e.map(l=>l.x),n=e.map(l=>l.y),r=t.reduce((l,u)=>u<l?u:l,1/0),a=n.reduce((l,u)=>u<l?u:l,1/0),s=t.reduce((l,u)=>l<u?u:l,0),i=n.reduce((l,u)=>l<u?u:l,0);return new rq(r,a,s,i)}function x9e(e,t,n,r=!0){let a=t.map((i,l)=>({score:i,boxIndex:l})).sort((i,l)=>i.score-l.score).map(i=>i.boxIndex),s=[];for(;a.length>0;){let i=a.pop();s.push(i);let l=a,u=[];for(let d=0;d<l.length;d++){let c=l[d],h=e[i],p=e[c];u.push(f9e(h,p,r))}a=a.filter((d,c)=>u[c]<=n)}return s}function Yb(e,t){return ce(()=>{let[n,r,a]=t,s=$s([...e.shape.slice(0,3),1],n,"float32"),i=$s([...e.shape.slice(0,3),1],r,"float32"),l=$s([...e.shape.slice(0,3),1],a,"float32"),u=nr([s,i,l],3);return dt(e,u)})}function y9e(e,t=!1){return ce(()=>{let[n,r]=e.shape.slice(1);if(n===r)return e;let a=Math.abs(n-r),s=Math.round(a*(t?.5:1)),i=n>r?2:1,l=h=>{let p=e.shape.slice();return p[i]=h,$s(p,0,"float32")},u=l(s),d=a-u.shape[i],c=[t&&d?l(d):null,e,u].filter(h=>!!h).map(h=>Xe(h,"float32"));return nr(c,i)})}function xS(e){return 1/(1+Math.exp(-e))}var oq=class extends Hd{constructor(e,t,n,r,a=!1){super({x:e,y:t,width:n,height:r},a)}},b9e=.5,v9e=.43,w9e=.45,I0=class{constructor(e,t,n=new er(0,0)){let{width:r,height:a}=t;this._imgDims=new cm(r,a),this._shift=n,this._positions=e.map(s=>s.mul(new er(r,a)).add(n))}get shift(){return new er(this._shift.x,this._shift.y)}get imageWidth(){return this._imgDims.width}get imageHeight(){return this._imgDims.height}get positions(){return this._positions}get relativePositions(){return this._positions.map(e=>e.sub(this._shift).div(new er(this.imageWidth,this.imageHeight)))}forSize(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}shiftBy(e,t){return new this.constructor(this.relativePositions,this._imgDims,new er(e,t))}shiftByPoint(e){return this.shiftBy(e.x,e.y)}align(e,t={}){if(e){let a=e instanceof io?e.box.floor():new Hd(e);return this.shiftBy(a.x,a.y).align(null,t)}let{useDlibAlignment:n,minBoxPadding:r}={useDlibAlignment:!1,minBoxPadding:.2,...t};return n?this.alignDlib():this.alignMinBbox(r)}alignDlib(){let e=this.getRefPointsForAlignment(),[t,n,r]=e,a=c=>r.sub(c).magnitude(),s=(a(t)+a(n))/2,i=Math.floor(s/w9e),l=DA(e),u=Math.floor(Math.max(0,l.x-b9e*i)),d=Math.floor(Math.max(0,l.y-v9e*i));return new oq(u,d,Math.min(i,this.imageWidth+u),Math.min(i,this.imageHeight+d))}alignMinBbox(e){let t=g9e(this.positions);return t.pad(t.width*e,t.height*e)}getRefPointsForAlignment(){throw new Error("getRefPointsForAlignment not implemented by base class")}},lq=class extends I0{getJawOutline(){return this.positions.slice(0,17)}getLeftEyeBrow(){return this.positions.slice(17,22)}getRightEyeBrow(){return this.positions.slice(22,27)}getNose(){return this.positions.slice(27,36)}getLeftEye(){return this.positions.slice(36,42)}getRightEye(){return this.positions.slice(42,48)}getMouth(){return this.positions.slice(48,68)}getRefPointsForAlignment(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(DA)}};function T0(e){return e.detection instanceof io}function uq(e,t){return{...e,detection:t}}function cq(){let e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:()=>document.createElement("canvas"),createImageElement:()=>document.createElement("img"),createVideoElement:()=>document.createElement("video"),fetch:e,readFile:()=>{throw new Error("readFile - filesystem not available for browser environment")}}}function MA(){return typeof global=="object"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null}function dq(e){let t="";if(!e&&MA())try{e=ipe("fs")}catch(n){t=n.toString()}return{readFile:e?n=>new Promise((r,a)=>{e.readFile(n,(s,i)=>s?a(s):r(i))}):()=>{throw new Error(`readFile - failed to require fs in nodejs environment with error: ${t}`)}}}function hq(){let e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.Video||global.HTMLVideoElement,r=()=>{if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},a=()=>{if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=()=>{if(n)return new n;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},i=global.fetch,l=dq();return{Canvas:e||class{},CanvasRenderingContext2D:global.CanvasRenderingContext2D||class{},Image:t||class{},ImageData:global.ImageData||class{},Video:global.HTMLVideoElement||class{},createCanvasElement:r,createImageElement:a,createVideoElement:s,fetch:i,...l}}function pq(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var ia;function N9e(){if(!ia)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ia}function KC(e){ia=e}function $A(){return pq()?KC(cq()):MA()?KC(hq()):null}function k9e(e){if(ia||$A(),!ia)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");let{Canvas:t=ia.Canvas,Image:n=ia.Image}=e;ia.Canvas=t,ia.Image=n,ia.createCanvasElement=e.createCanvasElement||(()=>new t),ia.createImageElement=e.createImageElement||(()=>new n),ia.ImageData=e.ImageData||ia.ImageData,ia.Video=e.Video||ia.Video,ia.fetch=e.fetch||ia.fetch,ia.readFile=e.readFile||ia.readFile}var bs={getEnv:N9e,setEnv:KC,initialize:$A,createBrowserEnv:cq,createFileSystem:dq,createNodejsEnv:hq,monkeyPatch:k9e,isBrowser:pq,isNodejs:MA};$A();function FA(e){return!bs.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function Zu(e){let{Canvas:t,CanvasRenderingContext2D:n}=bs.getEnv();if(e instanceof n)return e;let r=FA(e);if(!(r instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");let a=r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var mq=(e=>(e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e))(mq||{}),PA=class{constructor(e={}){let{anchorPosition:t,backgroundColor:n,fontColor:r,fontSize:a,fontStyle:s,padding:i}=e;this.anchorPosition=t||"TOP_LEFT",this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=s||"Georgia",this.padding=i||4}},OA=class fq{constructor(t,n,r={}){this.text=typeof t=="string"?[t]:t instanceof fq?t.text:t,this.anchor=n,this.options=new PA(r)}measureWidth(t){let{padding:n}=this.options;return this.text.map(r=>t.measureText(r).width).reduce((r,a)=>r<a?a:r,0)+2*n}measureHeight(){let{fontSize:t,padding:n}=this.options;return this.text.length*t+2*n}getUpperLeft(t,n){let{anchorPosition:r}=this.options,a=r==="BOTTOM_RIGHT"||r==="TOP_RIGHT",s=r==="BOTTOM_LEFT"||r==="BOTTOM_RIGHT",i=this.measureWidth(t),l=this.measureHeight(),u=a?this.anchor.x-i:this.anchor.x,d=s?this.anchor.y-l:this.anchor.y;if(n){let{width:c,height:h}=n,p=Math.max(Math.min(u,c-i),0),m=Math.max(Math.min(d,h-l),0);return{x:p,y:m}}return{x:u,y:d}}draw(t){let n=FA(t),r=Zu(n),{backgroundColor:a,fontColor:s,fontSize:i,fontStyle:l,padding:u}=this.options;r.font=`${i}px ${l}`;let d=this.measureWidth(r),c=this.measureHeight();r.fillStyle=a;let h=this.getUpperLeft(r,n);r.fillRect(h.x,h.y,d,c),r.fillStyle=s,this.text.forEach((p,m)=>{let f=u+h.x,g=u+h.y+(m+1)*i;r.fillText(p,f,g)})}},gq=class{constructor(e={}){let{boxColor:t,lineWidth:n,label:r,drawLabelOptions:a}=e;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;let s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new PA({...s,...a})}},xq=class{constructor(e,t={}){this.box=new Hd(e),this.options=new gq(t)}draw(e){let t=Zu(e),{boxColor:n,lineWidth:r}=this.options,{x:a,y:s,width:i,height:l}=this.box;t.strokeStyle=n,t.lineWidth=r,t.strokeRect(a,s,i,l);let{label:u}=this.options;u&&new OA([u],{x:a-r/2,y:s},this.options.drawLabelOptions).draw(e)}};function S9e(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof io?n.score:T0(n)?n.detection.score:void 0,a=n instanceof io?n.box:T0(n)?n.detection.box:new Hd(n),s=r?`${RA(r)}`:void 0;new xq(a,{label:s}).draw(e)})}function yq(e){let{Image:t,Video:n}=bs.getEnv();return e instanceof t&&e.complete||e instanceof n&&e.readyState>=3}function C9e(e){return new Promise((t,n)=>{if(e instanceof bs.getEnv().Canvas||yq(e)){t(null);return}function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),n(s))}function a(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),t(s))}e.addEventListener("load",a),e.addEventListener("error",r)})}function bq(e){let{Image:t,Video:n}=bs.getEnv();return e instanceof t?new cm(e.naturalWidth,e.naturalHeight):e instanceof n?new cm(e.videoWidth,e.videoHeight):new cm(e.width,e.height)}function E0({width:e,height:t}){let{createCanvasElement:n}=bs.getEnv(),r=n();return r.width=e,r.height=t,r}function vq(e,t){let{ImageData:n}=bs.getEnv();if(!(e instanceof n)&&!yq(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");let{width:r,height:a}=bq(e),s=E0({width:r,height:a});return e instanceof n?Zu(s).putImageData(e,0,0):Zu(s).drawImage(e,0,0,r,a),s}async function _9e(e,t){let n=t||bs.getEnv().createCanvasElement(),[r,a,s]=e.shape.slice(Nl(e)?1:0),i=ce(()=>e.as3D(r,a,s).toInt());return await Mb.toPixels(i,n),i.dispose(),n}function vP(e){let{Image:t,Canvas:n,Video:r}=bs.getEnv();return e instanceof t||e instanceof n||e instanceof r}function I9e(e,t,n=!1){let{Image:r,Canvas:a}=bs.getEnv();if(!(e instanceof r||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return E0({width:1,height:1});let s=bq(e),i=t/Math.max(s.height,s.width),l=i*s.width,u=i*s.height,d=E0({width:t,height:t}),c=e instanceof a?e:vq(e),h=Math.abs(l-u)/2,p=n&&l<u?h:0,m=n&&u<l?h:0;return c.width>0&&c.height>0&&Zu(d).drawImage(c,p,m,l,u),d}var j0=class{constructor(e,t=!1){if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(e))throw new Error(`NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ${e}`);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((n,r)=>{if(Kb(n)){this._imageTensors[r]=n,this._inputDimensions[r]=n.shape;return}if(Nl(n)){let s=n.shape[0];if(s!==1)throw new Error(`NetInput - tf.Tensor4D with batchSize ${s} passed, but not supported in input array`);this._imageTensors[r]=n,this._inputDimensions[r]=n.shape.slice(1);return}let a=n instanceof bs.getEnv().Canvas?n:vq(n);this._canvases[r]=a,this._inputDimensions[r]=[a.height,a.width,3]})}get imageTensors(){return this._imageTensors}get canvases(){return this._canvases}get isBatchInput(){return this.batchSize>1||this._treatAsBatchInput}get batchSize(){return this._batchSize}get inputDimensions(){return this._inputDimensions}get inputSize(){return this._inputSize}get reshapedInputDimensions(){return tf(this.batchSize,0,1).map((e,t)=>this.getReshapedInputDimensions(t))}getInput(e){return this.canvases[e]||this.imageTensors[e]}getInputDimensions(e){return this._inputDimensions[e]}getInputHeight(e){return this._inputDimensions[e][0]}getInputWidth(e){return this._inputDimensions[e][1]}getReshapedInputDimensions(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");let t=this.getInputWidth(e),n=this.getInputHeight(e);return nq({width:t,height:n},this.inputSize)}toBatchTensor(e,t=!0){return this._inputSize=e,ce(()=>{let n=tf(this.batchSize,0,1).map(r=>{let a=this.getInput(r);if(a instanceof Zt){let s=Nl(a)?a:ga(a);return s=y9e(s,t),(s.shape[1]!==e||s.shape[2]!==e)&&(s=Ks.resizeBilinear(s,[e,e],!1,!1)),s.as3D(e,e,3)}if(a instanceof bs.getEnv().Canvas)return Mb.fromPixels(I9e(a,e,t));throw new Error(`toBatchTensor - at batchIdx ${r}, expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ${a}`)});return Vr(n.map(r=>Xe(r,"float32"))).as4D(this.batchSize,e,e,3)})}};async function Za(e){if(e instanceof j0)return e;let t=Array.isArray(e)?e:[e];if(!t.length)throw new Error("toNetInput - empty array passed as input");let n=a=>Array.isArray(e)?` at input index ${a}:`:"",r=t.map(FA);return r.forEach((a,s)=>{if(!vP(a)&&!Kb(a)&&!Nl(a))throw typeof t[s]=="string"?new Error(`toNetInput -${n(s)} string passed, but could not resolve HTMLElement for element id ${t[s]}`):new Error(`toNetInput -${n(s)} expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id`);if(Nl(a)){let i=a.shape[0];if(i!==1)throw new Error(`toNetInput -${n(s)} tf.Tensor4D with batchSize ${i} passed, but not supported in input array`)}}),await Promise.all(r.map(a=>vP(a)&&C9e(a))),new j0(r,Array.isArray(e))}async function LA(e,t){let{Canvas:n}=bs.getEnv(),r=e;if(!(e instanceof n)){let s=await Za(e);if(s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");let i=s.getInput(0);r=i instanceof n?i:await _9e(i)}let a=Zu(r);return t.map(s=>s instanceof io?s.forSize(r.width,r.height).box.floor():s).map(s=>s.clipAtImageBorders(r.width,r.height)).map(({x:s,y:i,width:l,height:u})=>{let d=E0({width:l,height:u});return l>0&&u>0&&Zu(d).putImageData(a.getImageData(s,i,l,u),0,0),d})}async function zA(e,t){if(!Kb(e)&&!Nl(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Nl(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return ce(()=>{let[n,r,a]=e.shape.slice(Nl(e)?1:0);return t.map(s=>s instanceof io?s.forSize(r,n).box:s).map(s=>s.clipAtImageBorders(r,n)).filter(s=>s.width>0&&s.height>0).map(({x:s,y:i,width:l,height:u})=>kg(e.as3D(n,r,a),[i,s,0],[u,l,a]))})}async function T9e(e,t){let{fetch:n}=bs.getEnv(),r=await n(e,t);if(!(r.status<400))throw new Error(`failed to fetch: (${r.status}) ${r.statusText}, from url: ${r.url}`);return r}async function E9e(e){return(await T9e(e)).json()}function wq(e,t){let n=`${t}-weights_manifest.json`;if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:`/${n}`};let r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");let a=e.split("/").filter(l=>l),s=e.endsWith(".json")?a[a.length-1]:n,i=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return i=e.startsWith("/")?`/${i}`:i,{modelBaseUri:i,manifestUri:i==="/"?`/${s}`:`${i}/${s}`}}async function j9e(e,t){let{manifestUri:n,modelBaseUri:r}=wq(e,t),a=await E9e(n);return Aa.loadWeights(a,r)}var xc=class{constructor(e){this._params=void 0,this._paramMappings=[],this._name=e}get params(){return this._params}get paramMappings(){return this._paramMappings}get isLoaded(){return!!this.params}getParamFromPath(e){let{obj:t,objProp:n}=this.traversePropertyPath(e);return t[n]}reassignParamFromPath(e,t){let{obj:n,objProp:r}=this.traversePropertyPath(e);n[r].dispose(),n[r]=t}getParamList(){return this._paramMappings.map(({paramPath:e})=>({path:e,tensor:this.getParamFromPath(e)}))}getTrainableParams(){return this.getParamList().filter(e=>e.tensor instanceof Ed)}getFrozenParams(){return this.getParamList().filter(e=>!(e.tensor instanceof Ed))}variable(){this.getFrozenParams().forEach(({path:e,tensor:t})=>{this.reassignParamFromPath(e,t.variable())})}freeze(){this.getTrainableParams().forEach(({path:e,tensor:t})=>{let n=Ka(t.dataSync());t.dispose(),this.reassignParamFromPath(e,n)})}dispose(e=!0){this.getParamList().forEach(t=>{if(e&&t.tensor.isDisposed)throw new Error(`param tensor has already been disposed for path ${t.path}`);t.tensor.dispose()}),this._params=void 0}serializeParams(){return new Float32Array(this.getParamList().map(({tensor:e})=>Array.from(e.dataSync())).reduce((e,t)=>e.concat(t)))}async load(e){if(e instanceof Float32Array){this.extractWeights(e);return}await this.loadFromUri(e)}async loadFromUri(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromUri - expected model uri`);let t=await j9e(e,this.getDefaultModelName());this.loadFromWeightMap(t)}async loadFromDisk(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromDisk - expected model file path`);let{readFile:t}=bs.getEnv(),{manifestUri:n,modelBaseUri:r}=wq(e,this.getDefaultModelName()),a=u=>Promise.all(u.map(d=>t(d).then(c=>typeof c=="string"?Buffer.from(c):c.buffer))),s=Aa.weightsLoaderFactory(a),i=JSON.parse((await t(n)).toString()),l=await s(i,r);this.loadFromWeightMap(l)}loadFromWeightMap(e){let{paramMappings:t,params:n}=this.extractParamsFromWeightMap(e);this._paramMappings=t,this._params=n}extractWeights(e){let{paramMappings:t,params:n}=this.extractParams(e);this._paramMappings=t,this._params=n}traversePropertyPath(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");let t=e.split("/").reduce((a,s)=>{if(!a.nextObj.hasOwnProperty(s))throw new Error(`traversePropertyPath - object does not have property ${s}, for path ${e}`);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),{obj:n,objProp:r}=t;if(!n||!r||!(n[r]instanceof Zt))throw new Error(`traversePropertyPath - parameter is not a tensor, for path ${e}`);return{obj:n,objProp:r}}};function Zs(e,t,n){return ce(()=>{let r=Ng(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=$e(r,t.bias),r})}function yS(e,t,n=!1){return ce(()=>{let r=Kn(n?$e(Ya(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Zs(e,t.conv0,[2,2])),a=Zs(r,t.conv1,[1,1]),s=Kn($e(r,a)),i=Zs(s,t.conv2,[1,1]);return Kn($e(r,$e(a,i)))})}function Mv(e,t,n=!1,r=!0){return ce(()=>{let a=Kn(n?$e(Ya(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Zs(e,t.conv0,r?[2,2]:[1,1])),s=Zs(a,t.conv1,[1,1]),i=Kn($e(a,s)),l=Zs(i,t.conv2,[1,1]),u=Kn($e(a,$e(s,l))),d=Zs(u,t.conv3,[1,1]);return Kn($e(a,$e(s,$e(l,d))))})}function Vx(e,t,n="same",r=!1){return ce(()=>{let a=$e(Ya(e,t.filters,[1,1],n),t.bias);return r?Kn(a):a})}function yc(e,t){Object.keys(e).forEach(n=>{t.some(r=>r.originalPath===n)||e[n].dispose()})}function BA(e,t){return(n,r,a,s)=>{let i=Uu(e(n*r*a*a),[a,a,n,r]),l=Vn(e(r));return t.push({paramPath:`${s}/filters`},{paramPath:`${s}/bias`}),{filters:i,bias:l}}}function Nq(e,t){return(n,r,a)=>{let s=Lo(e(n*r),[n,r]),i=Vn(e(r));return t.push({paramPath:`${a}/weights`},{paramPath:`${a}/bias`}),{weights:s,bias:i}}}var kq=class{constructor(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}};function WA(e,t){return(n,r,a)=>{let s=Uu(e(9*n),[3,3,n,1]),i=Uu(e(n*r),[1,1,n,r]),l=Vn(e(r));return t.push({paramPath:`${a}/depthwise_filter`},{paramPath:`${a}/pointwise_filter`},{paramPath:`${a}/bias`}),new kq(s,i,l)}}function VA(e){return t=>{let n=e(`${t}/depthwise_filter`,4),r=e(`${t}/pointwise_filter`,4),a=e(`${t}/bias`,1);return new kq(n,r,a)}}function Np(e,t){return(n,r,a)=>{let s=e[n];if(!Pg(s,r))throw new Error(`expected weightMap[${n}] to be a Tensor${r}D, instead have ${s}`);return t.push({originalPath:n,paramPath:a||n}),s}}function bc(e){let t=e;function n(a){let s=t.slice(0,a);return t=t.slice(a),s}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function Sq(e,t){let n=BA(e,t),r=WA(e,t);function a(i,l,u,d=!1){let c=d?n(i,l,3,`${u}/conv0`):r(i,l,`${u}/conv0`),h=r(l,l,`${u}/conv1`),p=r(l,l,`${u}/conv2`);return{conv0:c,conv1:h,conv2:p}}function s(i,l,u,d=!1){let{conv0:c,conv1:h,conv2:p}=a(i,l,u,d),m=r(l,l,`${u}/conv3`);return{conv0:c,conv1:h,conv2:p,conv3:m}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function A9e(e){let t=[],{extractWeights:n,getRemainingWeights:r}=bc(e),{extractDenseBlock4Params:a}=Sq(n,t),s=a(3,32,"dense0",!0),i=a(32,64,"dense1"),l=a(64,128,"dense2"),u=a(128,256,"dense3");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:l,dense3:u}}}function Cq(e){return t=>{let n=e(`${t}/filters`,4),r=e(`${t}/bias`,1);return{filters:n,bias:r}}}function _q(e,t){let n=Np(e,t),r=Cq(n),a=VA(n);function s(l,u=!1){let d=u?r(`${l}/conv0`):a(`${l}/conv0`),c=a(`${l}/conv1`),h=a(`${l}/conv2`);return{conv0:d,conv1:c,conv2:h}}function i(l,u=!1){let d=u?r(`${l}/conv0`):a(`${l}/conv0`),c=a(`${l}/conv1`),h=a(`${l}/conv2`),p=a(`${l}/conv3`);return{conv0:d,conv1:c,conv2:h,conv3:p}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:i}}function R9e(e){let t=[],{extractDenseBlock4Params:n}=_q(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return yc(e,t),{params:r,paramMappings:t}}var Iq=class extends xc{constructor(){super("FaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return ce(()=>{let n=Xe(e.toBatchTensor(112,!0),"float32"),r=Yb(n,[122.782,117.001,104.298]).div(255),a=Mv(r,t.dense0,!0);return a=Mv(a,t.dense1),a=Mv(a,t.dense2),a=Mv(a,t.dense3),a=Pl(a,[7,7],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await Za(e))}getDefaultModelName(){return"face_feature_extractor_model"}extractParamsFromWeightMap(e){return R9e(e)}extractParams(e){return A9e(e)}};function YC(e,t){return ce(()=>$e(en(e,t.weights),t.bias))}function D9e(e,t,n){let r=[],{extractWeights:a,getRemainingWeights:s}=bc(e),i=Nq(a,r)(t,n,"fc");if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{paramMappings:r,params:{fc:i}}}function M9e(e){let t=[],n=Np(e,t);function r(s){let i=n(`${s}/weights`,2),l=n(`${s}/bias`,1);return{weights:i,bias:l}}let a={fc:r("fc")};return yc(e,t),{params:a,paramMappings:t}}function Tq(e){let t={},n={};return Object.keys(e).forEach(r=>{let a=r.startsWith("fc")?n:t;a[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var Eq=class extends xc{constructor(e,t){super(e),this._faceFeatureExtractor=t}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return ce(()=>{let n=e instanceof j0?this.faceFeatureExtractor.forwardInput(e):e;return YC(n.as2D(n.shape[0],-1),t.fc)})}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return D9e(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=Tq(e);return this.faceFeatureExtractor.loadFromWeightMap(t),M9e(n)}extractParams(e){let t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),s=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)}},wP=["neutral","happy","sad","angry","fearful","disgusted","surprised"],UA=class{constructor(e){if(this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,e.length!==7)throw new Error(`FaceExpressions.constructor - expected probabilities.length to be 7, have: ${e.length}`);wP.forEach((t,n)=>{this[t]=e[n]})}asSortedArray(){return wP.map(e=>({expression:e,probability:this[e]})).sort((e,t)=>t.probability-e.probability)}},$9e=class extends Eq{constructor(e=new Iq){super("FaceExpressionNet",e)}forwardInput(e){return ce(()=>dc(this.runNet(e)))}async forward(e){return this.forwardInput(await Za(e))}async predictExpressions(e){let t=await Za(e),n=await this.forwardInput(t),r=await Promise.all(Er(n).map(async s=>{let i=s.dataSync();return s.dispose(),i}));n.dispose();let a=r.map(s=>new UA(s));return t.isBatchInput?a:a[0]}getDefaultModelName(){return"face_expression_model"}getClassifierChannelsIn(){return 256}getClassifierChannelsOut(){return 7}};function F9e(e){return e.expressions instanceof UA}function jq(e,t){return{...e,expressions:t}}function P9e(e,t,n=.1,r){(Array.isArray(t)?t:[t]).forEach(a=>{let s=a instanceof UA?a:F9e(a)?a.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");let i=s.asSortedArray().filter(u=>u.probability>n),l=T0(a)?a.detection.box.bottomLeft:r||new er(0,0);new OA(i.map(u=>`${u.expression} (${RA(u.probability)})`),l).draw(e)})}function Aq(e){return T0(e)&&e.landmarks instanceof I0&&e.unshiftedLandmarks instanceof I0&&e.alignedRect instanceof io}function O9e(e){let t=u=>u*180/Math.PI,n=(u,d)=>Math.sqrt((u.x-d.x)**2+(u.y-d.y)**2),r={roll:void 0,pitch:void 0,yaw:void 0},a=(u,d,c)=>{let h=Math.floor(u.x-d.x),p=Math.floor(d.x-c.x);return h-p},s=(u,d)=>{let c=Math.hypot(d.x-u.x,d.y-u.y),h=d.y-u.y,p=Math.asin(h/c),m=t(p),f=Math.floor(90-m),g=d.x-u.x<0?-1:1;return f*g},i=(u,d,c)=>{let h=n(u,c),p=new er((u.x+c.x)/2,(u.y+c.y)/2),m=n(d,p),f=Math.atan(m/h),g=Math.floor(t(f)),x=p.y-d.y<0?-1:1;return g*x};if(!e||!e.positions||e.positions.length!==68)return r;let l=e.positions;return r.roll=s(l[27],l[66]),r.pitch=i(l[14],l[30],l[2]),r.yaw=a(l[14],l[33],l[2]),r}function Rq(e,t){let{box:n}=e.detection,r=t.shiftBy(n.x,n.y),a=r.align(),{imageDims:s}=e.detection,i=new io(e.detection.score,a.rescale(s.reverse()),s),l=O9e(t);return{...e,landmarks:r,unshiftedLandmarks:t,alignedRect:i,angle:l}}var Dq=class{constructor(e={}){let{drawLines:t=!0,drawPoints:n=!0,lineWidth:r,lineColor:a,pointSize:s,pointColor:i}=e;this.drawLines=t,this.drawPoints=n,this.lineWidth=r||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=i||"rgba(255, 0, 255, 1)"}},Mq=class{constructor(e,t={}){this.faceLandmarks=e,this.options=new Dq(t)}draw(e){let t=Zu(e),{drawLines:n,drawPoints:r,lineWidth:a,lineColor:s,pointSize:i,pointColor:l}=this.options;if(n&&this.faceLandmarks instanceof lq&&(t.strokeStyle=s,t.lineWidth=a,nu(t,this.faceLandmarks.getJawOutline()),nu(t,this.faceLandmarks.getLeftEyeBrow()),nu(t,this.faceLandmarks.getRightEyeBrow()),nu(t,this.faceLandmarks.getNose()),nu(t,this.faceLandmarks.getLeftEye(),!0),nu(t,this.faceLandmarks.getRightEye(),!0),nu(t,this.faceLandmarks.getMouth(),!0)),r){t.strokeStyle=l,t.fillStyle=l;let u=d=>{t.beginPath(),t.arc(d.x,d.y,i,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(u)}}};function L9e(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof I0?n:Aq(n)?n.landmarks:void 0;if(!r)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new Mq(r).draw(e)})}function z9e(e,t){let n=BA(e,t),r=WA(e,t);function a(i,l,u){let d=r(i,l,`${u}/separable_conv0`),c=r(l,l,`${u}/separable_conv1`),h=n(i,l,1,`${u}/expansion_conv`);return{separable_conv0:d,separable_conv1:c,expansion_conv:h}}function s(i,l){let u=r(i,i,`${l}/separable_conv0`),d=r(i,i,`${l}/separable_conv1`),c=r(i,i,`${l}/separable_conv2`);return{separable_conv0:u,separable_conv1:d,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:s}}function B9e(e,t){let n=[],{extractWeights:r,getRemainingWeights:a}=bc(e),{extractConvParams:s,extractSeparableConvParams:i,extractReductionBlockParams:l,extractMainBlockParams:u}=z9e(r,n),d=s(3,32,3,"entry_flow/conv_in"),c=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:c,reduction_block_1:h},m={};tf(t,0,1).forEach(y=>{m[`main_block_${y}`]=u(128,`middle_flow/main_block_${y}`)});let f=l(128,256,"exit_flow/reduction_block"),g=i(256,512,"exit_flow/separable_conv"),x={reduction_block:f,separable_conv:g};if(a().length!==0)throw new Error(`weights remaing after extract: ${a().length}`);return{paramMappings:n,params:{entry_flow:p,middle_flow:m,exit_flow:x}}}function W9e(e,t){let n=Np(e,t),r=Cq(n),a=VA(n);function s(l){let u=a(`${l}/separable_conv0`),d=a(`${l}/separable_conv1`),c=r(`${l}/expansion_conv`);return{separable_conv0:u,separable_conv1:d,expansion_conv:c}}function i(l){let u=a(`${l}/separable_conv0`),d=a(`${l}/separable_conv1`),c=a(`${l}/separable_conv2`);return{separable_conv0:u,separable_conv1:d,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:i}}function V9e(e,t){let n=[],{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:i}=W9e(e,n),l=r("entry_flow/conv_in"),u=s("entry_flow/reduction_block_0"),d=s("entry_flow/reduction_block_1"),c={conv_in:l,reduction_block_0:u,reduction_block_1:d},h={};tf(t,0,1).forEach(g=>{h[`main_block_${g}`]=i(`middle_flow/main_block_${g}`)});let p=s("exit_flow/reduction_block"),m=a("exit_flow/separable_conv"),f={reduction_block:p,separable_conv:m};return yc(e,n),{params:{entry_flow:c,middle_flow:h,exit_flow:f},paramMappings:n}}function $q(e,t,n){return $e(Ya(e,t.filters,n,"same"),t.bias)}function bS(e,t,n=!0){let r=n?Kn(e):e;return r=Zs(r,t.separable_conv0,[1,1]),r=Zs(Kn(r),t.separable_conv1,[1,1]),r=ua(r,[3,3],[2,2],"same"),r=$e(r,$q(e,t.expansion_conv,[2,2])),r}function U9e(e,t){let n=Zs(Kn(e),t.separable_conv0,[1,1]);return n=Zs(Kn(n),t.separable_conv1,[1,1]),n=Zs(Kn(n),t.separable_conv2,[1,1]),n=$e(n,e),n}var H9e=class extends xc{constructor(e){super("TinyXception"),this._numMainBlocks=e}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyXception - load model before inference");return ce(()=>{let n=Xe(e.toBatchTensor(112,!0),"float32"),r=Yb(n,[122.782,117.001,104.298]).div(255),a=Kn($q(r,t.entry_flow.conv_in,[2,2]));return a=bS(a,t.entry_flow.reduction_block_0,!1),a=bS(a,t.entry_flow.reduction_block_1),tf(this._numMainBlocks,0,1).forEach(s=>{a=U9e(a,t.middle_flow[`main_block_${s}`])}),a=bS(a,t.exit_flow.reduction_block),a=Kn(Zs(a,t.exit_flow.separable_conv,[1,1])),a})}async forward(e){return this.forwardInput(await Za(e))}getDefaultModelName(){return"tiny_xception_model"}extractParamsFromWeightMap(e){return V9e(e,this._numMainBlocks)}extractParams(e){return B9e(e,this._numMainBlocks)}};function G9e(e){let t=[],{extractWeights:n,getRemainingWeights:r}=bc(e),a=Nq(n,t),s=a(512,1,"fc/age"),i=a(512,2,"fc/gender");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{fc:{age:s,gender:i}}}}function q9e(e){let t=[],n=Np(e,t);function r(s){let i=n(`${s}/weights`,2),l=n(`${s}/bias`,1);return{weights:i,bias:l}}let a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return yc(e,t),{params:a,paramMappings:t}}var K9e=(e=>(e.FEMALE="female",e.MALE="male",e))(K9e||{}),Y9e=class extends xc{constructor(e=new H9e(2)){super("AgeGenderNet"),this._faceFeatureExtractor=e}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return ce(()=>{let n=e instanceof j0?this.faceFeatureExtractor.forwardInput(e):e,r=Pl(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1),a=YC(r,t.fc.age).as1D(),s=YC(r,t.fc.gender);return{age:a,gender:s}})}forwardInput(e){return ce(()=>{let{age:t,gender:n}=this.runNet(e);return{age:t,gender:dc(n)}})}async forward(e){return this.forwardInput(await Za(e))}async predictAgeAndGender(e){let t=await Za(e),n=await this.forwardInput(t),r=Er(n.age),a=Er(n.gender),s=r.map((l,u)=>({ageTensor:l,genderTensor:a[u]})),i=await Promise.all(s.map(async({ageTensor:l,genderTensor:u})=>{let d=l.dataSync()[0],c=u.dataSync()[0],h=c>.5,p=h?"male":"female",m=h?c:1-c;return l.dispose(),u.dispose(),{age:d,gender:p,genderProbability:m}}));return n.age.dispose(),n.gender.dispose(),t.isBatchInput?i:i[0]}getDefaultModelName(){return"age_gender_model"}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return G9e(e)}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=Tq(e);return this.faceFeatureExtractor.loadFromWeightMap(t),q9e(n)}extractParams(e){let t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}},Fq=class extends Eq{postProcess(e,t,n){let r=n.map(({width:s,height:i})=>{let l=t/Math.max(i,s);return{width:s*l,height:i*l}}),a=r.length;return ce(()=>{let s=(d,c)=>Vr([$s([68],d,"float32"),$s([68],c,"float32")],1).as2D(1,136).as1D(),i=(d,c)=>{let{width:h,height:p}=r[d];return c(h,p)?Math.abs(h-p)/2:0},l=d=>i(d,(c,h)=>c<h),u=d=>i(d,(c,h)=>h<c);return e.mul($s([a,136],t,"float32")).sub(Vr(Array.from(Array(a),(d,c)=>s(l(c),u(c))))).div(Vr(Array.from(Array(a),(d,c)=>s(r[c].width,r[c].height))))})}forwardInput(e){return ce(()=>{let t=this.runNet(e);return this.postProcess(t,e.inputSize,e.inputDimensions.map(([n,r])=>({height:n,width:r})))})}async forward(e){return this.forwardInput(await Za(e))}async detectLandmarks(e){let t=await Za(e),n=ce(()=>Er(this.forwardInput(t))),r=await Promise.all(n.map(async(a,s)=>{let i=Array.from(a.dataSync()),l=i.filter((d,c)=>GC(c)),u=i.filter((d,c)=>!GC(c));return new lq(Array(68).fill(0).map((d,c)=>new er(l[c],u[c])),{height:t.getInputHeight(s),width:t.getInputWidth(s)})}));return n.forEach(a=>a.dispose()),t.isBatchInput?r:r[0]}getClassifierChannelsOut(){return 136}},X9e=class extends Fq{constructor(e=new Iq){super("FaceLandmark68Net",e)}getDefaultModelName(){return"face_landmark_68_model"}getClassifierChannelsIn(){return 256}};function Z9e(e){let t=[],{extractDenseBlock3Params:n}=_q(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return yc(e,t),{params:r,paramMappings:t}}function Q9e(e){let t=[],{extractWeights:n,getRemainingWeights:r}=bc(e),{extractDenseBlock3Params:a}=Sq(n,t),s=a(3,32,"dense0",!0),i=a(32,64,"dense1"),l=a(64,128,"dense2");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:i,dense2:l}}}var J9e=class extends xc{constructor(){super("TinyFaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ce(()=>{let n=Xe(e.toBatchTensor(112,!0),"float32"),r=Yb(n,[122.782,117.001,104.298]).div(255),a=yS(r,t.dense0,!0);return a=yS(a,t.dense1),a=yS(a,t.dense2),a=Pl(a,[14,14],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await Za(e))}getDefaultModelName(){return"face_feature_extractor_tiny_model"}extractParamsFromWeightMap(e){return Z9e(e)}extractParams(e){return Q9e(e)}},e7e=class extends Fq{constructor(e=new J9e){super("FaceLandmark68TinyNet",e)}getDefaultModelName(){return"face_landmark_68_tiny_model"}getClassifierChannelsIn(){return 128}};function t7e(e,t){return $e(re(e,t.weights),t.biases)}function HA(e,t,n,r,a="same"){let{filters:s,bias:i}=t.conv,l=Ya(e,s,n,a);return l=$e(l,i),l=t7e(l,t.scale),r?Kn(l):l}function n7e(e,t){return HA(e,t,[1,1],!0)}function Pq(e,t){return HA(e,t,[1,1],!1)}function Oq(e,t){return HA(e,t,[2,2],!0,"valid")}function r7e(e,t){function n(l,u,d){let c=e(l),h=c.length/(u*d*d);if(tq(h))throw new Error(`depth has to be an integer: ${h}, weights.length: ${c.length}, numFilters: ${u}, filterSize: ${d}`);return ce(()=>tn(Uu(c,[u,h,d,d]),[2,3,1,0]))}function r(l,u,d,c){let h=n(l,u,d),p=Vn(e(u));return t.push({paramPath:`${c}/filters`},{paramPath:`${c}/bias`}),{filters:h,bias:p}}function a(l,u){let d=Vn(e(l)),c=Vn(e(l));return t.push({paramPath:`${u}/weights`},{paramPath:`${u}/biases`}),{weights:d,biases:c}}function s(l,u,d,c){let h=r(l,u,d,`${c}/conv`),p=a(u,`${c}/scale`);return{conv:h,scale:p}}function i(l,u,d,c,h=!1){let p=s((h?.5:1)*l,u,d,`${c}/conv1`),m=s(l,u,d,`${c}/conv2`);return{conv1:p,conv2:m}}return{extractConvLayerParams:s,extractResidualLayerParams:i}}function a7e(e){let{extractWeights:t,getRemainingWeights:n}=bc(e),r=[],{extractConvLayerParams:a,extractResidualLayerParams:s}=r7e(t,r),i=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),u=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),c=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),f=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),v=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),N=ce(()=>tn(Lo(t(256*128),[128,256]),[1,0]));if(r.push({paramPath:"fc"}),n().length!==0)throw new Error(`weights remaing after extract: ${n().length}`);return{params:{conv32_down:i,conv32_1:l,conv32_2:u,conv32_3:d,conv64_down:c,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:f,conv128_1:g,conv128_2:x,conv256_down:y,conv256_1:b,conv256_2:v,conv256_down_out:w,fc:N},paramMappings:r}}function s7e(e,t){let n=Np(e,t);function r(i){let l=n(`${i}/scale/weights`,1),u=n(`${i}/scale/biases`,1);return{weights:l,biases:u}}function a(i){let l=n(`${i}/conv/filters`,4),u=n(`${i}/conv/bias`,1),d=r(i);return{conv:{filters:l,bias:u},scale:d}}function s(i){return{conv1:a(`${i}/conv1`),conv2:a(`${i}/conv2`)}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function i7e(e){let t=[],{extractConvLayerParams:n,extractResidualLayerParams:r}=s7e(e,t),a=n("conv32_down"),s=r("conv32_1"),i=r("conv32_2"),l=r("conv32_3"),u=r("conv64_down"),d=r("conv64_1"),c=r("conv64_2"),h=r("conv64_3"),p=r("conv128_down"),m=r("conv128_1"),f=r("conv128_2"),g=r("conv256_down"),x=r("conv256_1"),y=r("conv256_2"),b=r("conv256_down_out"),{fc:v}=e;if(t.push({originalPath:"fc",paramPath:"fc"}),!eq(v))throw new Error(`expected weightMap[fc] to be a Tensor2D, instead have ${v}`);let w={conv32_down:a,conv32_1:s,conv32_2:i,conv32_3:l,conv64_down:u,conv64_1:d,conv64_2:c,conv64_3:h,conv128_down:p,conv128_1:m,conv128_2:f,conv256_down:g,conv256_1:x,conv256_2:y,conv256_down_out:b,fc:v};return yc(e,t),{params:w,paramMappings:t}}function fo(e,t){let n=n7e(e,t.conv1);return n=Pq(n,t.conv2),n=$e(n,e),n=Kn(n),n}function $v(e,t){let n=Oq(e,t.conv1);n=Pq(n,t.conv2);let r=Pl(e,2,2,"valid"),a=Nr(r.shape),s=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){let i=[...n.shape];i[1]=1;let l=Nr(i);n=nr([n,l],1);let u=[...n.shape];u[2]=1;let d=Nr(u);n=nr([n,d],2)}return r=s?nr([r,a],3):r,n=$e(r,n),n=Kn(n),n}var o7e=class extends xc{constructor(){super("FaceRecognitionNet")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return ce(()=>{let n=Xe(e.toBatchTensor(150,!0),"float32"),r=Yb(n,[122.782,117.001,104.298]).div(255),a=Oq(r,t.conv32_down);a=ua(a,3,2,"valid"),a=fo(a,t.conv32_1),a=fo(a,t.conv32_2),a=fo(a,t.conv32_3),a=$v(a,t.conv64_down),a=fo(a,t.conv64_1),a=fo(a,t.conv64_2),a=fo(a,t.conv64_3),a=$v(a,t.conv128_down),a=fo(a,t.conv128_1),a=fo(a,t.conv128_2),a=$v(a,t.conv256_down),a=fo(a,t.conv256_1),a=fo(a,t.conv256_2),a=$v(a,t.conv256_down_out);let s=a.mean([1,2]);return en(s,t.fc)})}async forward(e){return this.forwardInput(await Za(e))}async computeFaceDescriptor(e){var t;if((t=e==null?void 0:e.shape)!=null&&t.some(s=>s<=0))return new Float32Array(128);let n=await Za(e),r=ce(()=>Er(this.forwardInput(n))),a=await Promise.all(r.map(s=>s.data()));return r.forEach(s=>s.dispose()),n.isBatchInput?a:a[0]}getDefaultModelName(){return"face_recognition_model"}extractParamsFromWeightMap(e){return i7e(e)}extractParams(e){return a7e(e)}};function Lq(e,t){return{...e,descriptor:t}}function zq(e,t){return{...e,age:t}}function Bq(e,t,n){return{...e,gender:t,genderProbability:n}}function l7e(e,t){function n(u,d){let c=Uu(e(9*u),[3,3,u,1]),h=Vn(e(u)),p=Vn(e(u)),m=Vn(e(u)),f=Vn(e(u));return t.push({paramPath:`${d}/filters`},{paramPath:`${d}/batch_norm_scale`},{paramPath:`${d}/batch_norm_offset`},{paramPath:`${d}/batch_norm_mean`},{paramPath:`${d}/batch_norm_variance`}),{filters:c,batch_norm_scale:h,batch_norm_offset:p,batch_norm_mean:m,batch_norm_variance:f}}function r(u,d,c,h,p){let m=Uu(e(u*d*c*c),[c,c,u,d]),f=Vn(e(d));return t.push({paramPath:`${h}/filters`},{paramPath:`${h}/${p?"batch_norm_offset":"bias"}`}),{filters:m,bias:f}}function a(u,d,c,h){let{filters:p,bias:m}=r(u,d,c,h,!0);return{filters:p,batch_norm_offset:m}}function s(u,d,c){let h=n(u,`${c}/depthwise_conv`),p=a(u,d,1,`${c}/pointwise_conv`);return{depthwise_conv:h,pointwise_conv:p}}function i(){let u=a(3,32,3,"mobilenetv1/conv_0"),d=s(32,64,"mobilenetv1/conv_1"),c=s(64,128,"mobilenetv1/conv_2"),h=s(128,128,"mobilenetv1/conv_3"),p=s(128,256,"mobilenetv1/conv_4"),m=s(256,256,"mobilenetv1/conv_5"),f=s(256,512,"mobilenetv1/conv_6"),g=s(512,512,"mobilenetv1/conv_7"),x=s(512,512,"mobilenetv1/conv_8"),y=s(512,512,"mobilenetv1/conv_9"),b=s(512,512,"mobilenetv1/conv_10"),v=s(512,512,"mobilenetv1/conv_11"),w=s(512,1024,"mobilenetv1/conv_12"),N=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:d,conv_2:c,conv_3:h,conv_4:p,conv_5:m,conv_6:f,conv_7:g,conv_8:x,conv_9:y,conv_10:b,conv_11:v,conv_12:w,conv_13:N}}function l(){let u=a(1024,256,1,"prediction_layer/conv_0"),d=a(256,512,3,"prediction_layer/conv_1"),c=a(512,128,1,"prediction_layer/conv_2"),h=a(128,256,3,"prediction_layer/conv_3"),p=a(256,128,1,"prediction_layer/conv_4"),m=a(128,256,3,"prediction_layer/conv_5"),f=a(256,64,1,"prediction_layer/conv_6"),g=a(64,128,3,"prediction_layer/conv_7"),x=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),y=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),v=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),N=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),S=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),E=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),j=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor");return{conv_0:u,conv_1:d,conv_2:c,conv_3:h,conv_4:p,conv_5:m,conv_6:f,conv_7:g,box_predictor_0:{box_encoding_predictor:x,class_predictor:y},box_predictor_1:{box_encoding_predictor:b,class_predictor:v},box_predictor_2:{box_encoding_predictor:w,class_predictor:N},box_predictor_3:{box_encoding_predictor:S,class_predictor:C},box_predictor_4:{box_encoding_predictor:_,class_predictor:T},box_predictor_5:{box_encoding_predictor:E,class_predictor:j}}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:l}}function u7e(e){let t=[],{extractWeights:n,getRemainingWeights:r}=bc(e),{extractMobilenetV1Params:a,extractPredictionLayerParams:s}=l7e(n,t),i=a(),l=s(),u={extra_dim:H1(n(5118*4),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{params:{mobilenetv1:i,prediction_layer:l,output_layer:u},paramMappings:t}}function c7e(e,t){let n=Np(e,t);function r(d,c,h){let p=n(`${d}/Conv2d_${c}_pointwise/weights`,4,`${h}/filters`),m=n(`${d}/Conv2d_${c}_pointwise/convolution_bn_offset`,1,`${h}/batch_norm_offset`);return{filters:p,batch_norm_offset:m}}function a(d){let c=`mobilenetv1/conv_${d}`,h=`MobilenetV1/Conv2d_${d}_depthwise`,p=`${c}/depthwise_conv`,m=`${c}/pointwise_conv`,f=n(`${h}/depthwise_weights`,4,`${p}/filters`),g=n(`${h}/BatchNorm/gamma`,1,`${p}/batch_norm_scale`),x=n(`${h}/BatchNorm/beta`,1,`${p}/batch_norm_offset`),y=n(`${h}/BatchNorm/moving_mean`,1,`${p}/batch_norm_mean`),b=n(`${h}/BatchNorm/moving_variance`,1,`${p}/batch_norm_variance`);return{depthwise_conv:{filters:f,batch_norm_scale:g,batch_norm_offset:x,batch_norm_mean:y,batch_norm_variance:b},pointwise_conv:r("MobilenetV1",d,m)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function i(d,c){let h=n(`${d}/weights`,4,`${c}/filters`),p=n(`${d}/biases`,1,`${c}/bias`);return{filters:h,bias:p}}function l(d){let c=i(`Prediction/BoxPredictor_${d}/BoxEncodingPredictor`,`prediction_layer/box_predictor_${d}/box_encoding_predictor`),h=i(`Prediction/BoxPredictor_${d}/ClassPredictor`,`prediction_layer/box_predictor_${d}/class_predictor`);return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:u}}function d7e(e){let t=[],{extractMobilenetV1Params:n,extractPredictionLayerParams:r}=c7e(e,t),a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Kb(a))throw new Error(`expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ${a}`);let s={mobilenetv1:n(),prediction_layer:r(),output_layer:{extra_dim:a}};return yc(e,t),{params:s,paramMappings:t}}function bo(e,t,n){return ce(()=>{let r=Ya(e,t.filters,n,"same");return r=$e(r,t.batch_norm_offset),Oa(r,0,6)})}var h7e=.0010000000474974513;function p7e(e,t,n){return ce(()=>{let r=hp(e,t.filters,n,"same");return r=dp(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,h7e),Oa(r,0,6)})}function m7e(e){return[2,4,6,12].some(t=>t===e)?[2,2]:[1,1]}function f7e(e,t){return ce(()=>{let n,r=bo(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((a,s)=>{let i=s+1,l=m7e(i);r=p7e(r,a.depthwise_conv,l),r=bo(r,a.pointwise_conv,[1,1]),i===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function g7e(e,t,n){let r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),s=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),l=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),d=Math.min(r[n][1],r[n][3]),c=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),p=(i-a)*(l-s),m=(c-u)*(h-d);if(p<=0||m<=0)return 0;let f=Math.max(a,u),g=Math.max(s,d),x=Math.min(i,c),y=Math.min(l,h),b=Math.max(x-f,0)*Math.max(y-g,0);return b/(p+m-b)}function x7e(e,t,n,r,a){let s=e.shape[0],i=Math.min(n,s),l=t.map((c,h)=>({score:c,boxIndex:h})).filter(c=>c.score>a).sort((c,h)=>h.score-c.score),u=c=>c<=r?1:0,d=[];return l.forEach(c=>{if(d.length>=i)return;let h=c.score;for(let p=d.length-1;p>=0;--p){let m=g7e(e,c.boxIndex,d[p]);if(m!==0&&(c.score*=u(m),c.score<=a))break}h===c.score&&d.push(c.boxIndex)}),d}function y7e(e){let t=Er(tn(e,[1,0])),n=[dt(t[2],t[0]),dt(t[3],t[1])],r=[$e(t[0],ft(n[0],2)),$e(t[1],ft(n[1],2))];return{sizes:n,centers:r}}function b7e(e,t){let{sizes:n,centers:r}=y7e(e),a=Er(tn(t,[1,0])),s=ft(re(La(ft(a[2],5)),n[0]),2),i=$e(re(ft(a[0],10),n[0]),r[0]),l=ft(re(La(ft(a[3],5)),n[1]),2),u=$e(re(ft(a[1],10),n[1]),r[1]);return tn(Vr([dt(i,s),dt(u,l),$e(i,s),$e(u,l)]),[1,0])}function v7e(e,t,n){return ce(()=>{let r=e.shape[0],a=b7e(ue(Rs(n.extra_dim,[r,1,1]),[-1,4]),ue(e,[-1,4]));a=ue(a,[r,a.shape[0]/r,4]);let s=wi(pn(t,[0,0,1],[-1,-1,-1])),i=pn(s,[0,0,0],[-1,-1,1]);i=ue(i,[r,i.shape[1]]);let l=Er(a),u=Er(i);return{boxes:l,scores:u}})}function Pp(e,t){return ce(()=>{let n=e.shape[0],r=ue(Vx(e,t.box_encoding_predictor),[n,-1,1,4]),a=ue(Vx(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function w7e(e,t,n){return ce(()=>{let r=bo(e,n.conv_0,[1,1]),a=bo(r,n.conv_1,[2,2]),s=bo(a,n.conv_2,[1,1]),i=bo(s,n.conv_3,[2,2]),l=bo(i,n.conv_4,[1,1]),u=bo(l,n.conv_5,[2,2]),d=bo(u,n.conv_6,[1,1]),c=bo(d,n.conv_7,[2,2]),h=Pp(t,n.box_predictor_0),p=Pp(e,n.box_predictor_1),m=Pp(a,n.box_predictor_2),f=Pp(i,n.box_predictor_3),g=Pp(u,n.box_predictor_4),x=Pp(c,n.box_predictor_5),y=nr([h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,f.boxPredictionEncoding,g.boxPredictionEncoding,x.boxPredictionEncoding],1),b=nr([h.classPrediction,p.classPrediction,m.classPrediction,f.classPrediction,g.classPrediction,x.classPrediction],1);return{boxPredictions:y,classPredictions:b}})}var AN=class{constructor({minConfidence:e,maxResults:t}={}){if(this._name="SsdMobilenetv1Options",this._minConfidence=e||.5,this._maxResults=t||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(`${this._name} - expected minConfidence to be a number between 0 and 1`);if(typeof this._maxResults!="number")throw new Error(`${this._name} - expected maxResults to be a number`)}get minConfidence(){return this._minConfidence}get maxResults(){return this._maxResults}},N7e=class extends xc{constructor(){super("SsdMobilenetv1")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return ce(()=>{let n=Xe(e.toBatchTensor(512,!1),"float32"),r=dt(ft(n,127.5),1),a=f7e(r,t.mobilenetv1),{boxPredictions:s,classPredictions:i}=w7e(a.out,a.conv11,t.prediction_layer);return v7e(s,i,t.output_layer)})}async forward(e){return this.forwardInput(await Za(e))}async locateFaces(e,t={}){let{maxResults:n,minConfidence:r}=new AN(t),a=await Za(e),{boxes:s,scores:i}=this.forwardInput(a),l=s[0],u=i[0];for(let y=1;y<s.length;y++)s[y].dispose(),i[y].dispose();let d=Array.from(u.dataSync()),c=x7e(l,d,n,.5,r),h=a.getReshapedInputDimensions(0),p=a.inputSize,m=p/h.width,f=p/h.height,g=l.arraySync(),x=c.map(y=>{let[b,v]=[Math.max(0,g[y][0]),Math.min(1,g[y][2])].map(S=>S*f),[w,N]=[Math.max(0,g[y][1]),Math.min(1,g[y][3])].map(S=>S*m);return new io(d[y],new oq(w,b,N-w,v-b),{height:a.getInputHeight(0),width:a.getInputWidth(0)})});return l.dispose(),u.dispose(),x}getDefaultModelName(){return"ssd_mobilenetv1_model"}extractParamsFromWeightMap(e){return d7e(e)}extractParams(e){return u7e(e)}},k7e=.4,S7e=[new er(.738768,.874946),new er(2.42204,2.65704),new er(4.30971,7.04493),new er(10.246,4.59428),new er(12.6868,11.8741)],C7e=[new er(1.603231,2.094468),new er(6.041143,7.080126),new er(2.882459,3.518061),new er(4.266906,5.178857),new er(9.041765,10.66308)],_7e=[117.001,114.697,97.404],I7e="tiny_yolov2_model",T7e="tiny_yolov2_separable_conv_model",Fv=e=>typeof e=="number";function E7e(e){if(!e)throw new Error(`invalid config: ${e}`);if(typeof e.withSeparableConvs!="boolean")throw new Error(`config.withSeparableConvs has to be a boolean, have: ${e.withSeparableConvs}`);if(!Fv(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error(`config.iouThreshold has to be a number between [0, 1], have: ${e.iouThreshold}`);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(t=>typeof t=="string"))throw new Error(`config.classes has to be an array class names: string[], have: ${JSON.stringify(e.classes)}`);if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(t=>t||{}).every(t=>Fv(t.x)&&Fv(t.y)))throw new Error(`config.anchors has to be an array of { x: number, y: number }, have: ${JSON.stringify(e.anchors)}`);if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Fv)))throw new Error(`config.meanRgb has to be an array of shape [number, number, number], have: ${JSON.stringify(e.meanRgb)}`)}function GA(e){return ce(()=>{let t=re(e,jt(.10000000149011612));return $e(Kn(dt(e,t)),t)})}function Xl(e,t){return ce(()=>{let n=lo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ya(n,t.conv.filters,[1,1],"valid"),n=dt(n,t.bn.sub),n=re(n,t.bn.truediv),n=$e(n,t.conv.bias),GA(n)})}function Zl(e,t){return ce(()=>{let n=lo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ng(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=$e(n,t.bias),GA(n)})}function j7e(e,t){let n=BA(e,t);function r(i,l){let u=Vn(e(i)),d=Vn(e(i));return t.push({paramPath:`${l}/sub`},{paramPath:`${l}/truediv`}),{sub:u,truediv:d}}function a(i,l,u){let d=n(i,l,3,`${u}/conv`),c=r(l,`${u}/bn`);return{conv:d,bn:c}}let s=WA(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function A7e(e,t,n,r){let{extractWeights:a,getRemainingWeights:s}=bc(e),i=[],{extractConvParams:l,extractConvWithBatchNormParams:u,extractSeparableConvParams:d}=j7e(a,i),c;if(t.withSeparableConvs){let[h,p,m,f,g,x,y,b,v]=r,w=t.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),N=d(p,m,"conv1"),S=d(m,f,"conv2"),C=d(f,g,"conv3"),_=d(g,x,"conv4"),T=d(x,y,"conv5"),E=b?d(y,b,"conv6"):void 0,j=v?d(b,v,"conv7"):void 0,I=l(v||b||y,5*n,1,"conv8");c={conv0:w,conv1:N,conv2:S,conv3:C,conv4:_,conv5:T,conv6:E,conv7:j,conv8:I}}else{let[h,p,m,f,g,x,y,b,v]=r,w=u(h,p,"conv0"),N=u(p,m,"conv1"),S=u(m,f,"conv2"),C=u(f,g,"conv3"),_=u(g,x,"conv4"),T=u(x,y,"conv5"),E=u(y,b,"conv6"),j=u(b,v,"conv7"),I=l(v,5*n,1,"conv8");c={conv0:w,conv1:N,conv2:S,conv3:C,conv4:_,conv5:T,conv6:E,conv7:j,conv8:I}}if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{params:c,paramMappings:i}}function R7e(e,t){let n=Np(e,t);function r(l){let u=n(`${l}/sub`,1),d=n(`${l}/truediv`,1);return{sub:u,truediv:d}}function a(l){let u=n(`${l}/filters`,4),d=n(`${l}/bias`,1);return{filters:u,bias:d}}function s(l){let u=a(`${l}/conv`),d=r(`${l}/bn`);return{conv:u,bn:d}}let i=VA(n);return{extractConvParams:a,extractConvWithBatchNormParams:s,extractSeparableConvParams:i}}function D7e(e,t){let n=[],{extractConvParams:r,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}=R7e(e,n),i;if(t.withSeparableConvs){let l=t.filterSizes&&t.filterSizes.length||9;i={conv0:t.isFirstLayerConv2d?r("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:l>7?s("conv6"):void 0,conv7:l>8?s("conv7"):void 0,conv8:r("conv8")}}else i={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:r("conv8")};return yc(e,n),{params:i,paramMappings:n}}var qA=class{constructor({inputSize:e,scoreThreshold:t}={}){if(this._name="TinyYolov2Options",this._inputSize=e||416,this._scoreThreshold=t||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(`${this._name} - expected inputSize to be a number divisible by 32`);if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(`${this._name} - expected scoreThreshold to be a number between 0 and 1`)}get inputSize(){return this._inputSize}get scoreThreshold(){return this._scoreThreshold}},Wq=class Vq extends xc{constructor(t){super("TinyYolov2"),E7e(t),this._config=t}get config(){return this._config}get withClassScores(){return this.config.withClassScores||this.config.classes.length>1}get boxEncodingSize(){return 5+(this.withClassScores?this.config.classes.length:0)}runTinyYolov2(t,n){let r=Xl(t,n.conv0);return r=ua(r,[2,2],[2,2],"same"),r=Xl(r,n.conv1),r=ua(r,[2,2],[2,2],"same"),r=Xl(r,n.conv2),r=ua(r,[2,2],[2,2],"same"),r=Xl(r,n.conv3),r=ua(r,[2,2],[2,2],"same"),r=Xl(r,n.conv4),r=ua(r,[2,2],[2,2],"same"),r=Xl(r,n.conv5),r=ua(r,[2,2],[1,1],"same"),r=Xl(r,n.conv6),r=Xl(r,n.conv7),Vx(r,n.conv8,"valid",!1)}runMobilenet(t,n){let r=this.config.isFirstLayerConv2d?GA(Vx(t,n.conv0,"valid",!1)):Zl(t,n.conv0);return r=ua(r,[2,2],[2,2],"same"),r=Zl(r,n.conv1),r=ua(r,[2,2],[2,2],"same"),r=Zl(r,n.conv2),r=ua(r,[2,2],[2,2],"same"),r=Zl(r,n.conv3),r=ua(r,[2,2],[2,2],"same"),r=Zl(r,n.conv4),r=ua(r,[2,2],[2,2],"same"),r=Zl(r,n.conv5),r=ua(r,[2,2],[1,1],"same"),r=n.conv6?Zl(r,n.conv6):r,r=n.conv7?Zl(r,n.conv7):r,Vx(r,n.conv8,"valid",!1)}forwardInput(t,n){let{params:r}=this;if(!r)throw new Error("TinyYolov2 - load model before inference");return ce(()=>{let a=Xe(t.toBatchTensor(n,!1),"float32");return a=this.config.meanRgb?Yb(a,this.config.meanRgb):a,a=a.div(255),this.config.withSeparableConvs?this.runMobilenet(a,r):this.runTinyYolov2(a,r)})}async forward(t,n){return this.forwardInput(await Za(t),n)}async detect(t,n={}){let{inputSize:r,scoreThreshold:a}=new qA(n),s=await Za(t),i=await this.forwardInput(s,r),l=ce(()=>Er(i)[0].expandDims()),u={width:s.getInputWidth(0),height:s.getInputHeight(0)},d=await this.extractBoxes(l,s.getReshapedInputDimensions(0),a);i.dispose(),l.dispose();let c=d.map(f=>f.box),h=d.map(f=>f.score),p=d.map(f=>f.classScore),m=d.map(f=>this.config.classes[f.label]);return x9e(c.map(f=>f.rescale(r)),h,this.config.iouThreshold,!0).map(f=>new aq(h[f],p[f],m[f],c[f],u))}getDefaultModelName(){return""}extractParamsFromWeightMap(t){return D7e(t,this.config)}extractParams(t){let n=this.config.filterSizes||Vq.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(r!==7&&r!==8&&r!==9)throw new Error(`TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ${r} filterSizes in config`);return A7e(t,this.config,this.boxEncodingSize,n)}async extractBoxes(t,n,r){let{width:a,height:s}=n,i=Math.max(a,s),l=i/a,u=i/s,d=t.shape[1],c=this.config.anchors.length,[h,p,m]=ce(()=>{let y=t.reshape([d,d,c,this.boxEncodingSize]),b=y.slice([0,0,0,0],[d,d,c,4]),v=y.slice([0,0,0,4],[d,d,c,1]),w=this.withClassScores?dc(y.slice([0,0,0,5],[d,d,c,this.config.classes.length]),3):jt(0);return[b,v,w]}),f=[],g=await p.array(),x=await h.array();for(let y=0;y<d;y++)for(let b=0;b<d;b++)for(let v=0;v<c;v++){let w=xS(g[y][b][v][0]);if(!r||w>r){let N=(b+xS(x[y][b][v][0]))/d*l,S=(y+xS(x[y][b][v][1]))/d*u,C=Math.exp(x[y][b][v][2])*this.config.anchors[v].x/d*l,_=Math.exp(x[y][b][v][3])*this.config.anchors[v].y/d*u,T=N-C/2,E=S-_/2,j={row:y,col:b,anchor:v},{classScore:I,label:D}=this.withClassScores?await this.extractPredictedClass(m,j):{classScore:1,label:0};f.push({box:new rq(T,E,T+C,E+_),score:w,classScore:w*I,label:D,...j})}}return h.dispose(),p.dispose(),m.dispose(),f}async extractPredictedClass(t,n){let{row:r,col:a,anchor:s}=n,i=await t.array();return Array(this.config.classes.length).fill(0).map((l,u)=>i[r][a][s][u]).map((l,u)=>({classScore:l,label:u})).reduce((l,u)=>l.classScore>u.classScore?l:u)}};Wq.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var Uq=Wq,M7e=class extends Uq{constructor(e=!0){let t={withSeparableConvs:e,iouThreshold:k7e,classes:["face"],...e?{anchors:C7e,meanRgb:_7e}:{anchors:S7e,withClassScores:!0}};super(t)}get withSeparableConvs(){return this.config.withSeparableConvs}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new io(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return this.withSeparableConvs?T7e:I7e}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},Hq=class extends qA{constructor(){super(...arguments),this._name="TinyFaceDetectorOptions"}},Xb=class{async then(e){return e(await this.run())}async run(){throw new Error("ComposableTask - run is not implemented")}};async function RN(e,t,n,r,a=({alignedRect:s})=>s){let s=e.map(u=>Aq(u)?a(u):u.detection),i=r||(t instanceof Zt?await zA(t,s):await LA(t,s)),l=await n(i);return i.forEach(u=>u instanceof Zt&&u.dispose()),l}async function KA(e,t,n,r,a){return RN([e],t,async s=>n(s[0]),r,a)}var $7e=.4,F7e=[new er(1.603231,2.094468),new er(6.041143,7.080126),new er(2.882459,3.518061),new er(4.266906,5.178857),new er(9.041765,10.66308)],P7e=[117.001,114.697,97.404],O7e=class extends Uq{constructor(){let e={withSeparableConvs:!0,iouThreshold:$7e,classes:["face"],anchors:F7e,meanRgb:P7e,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};super(e)}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new io(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return"tiny_face_detector_model"}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},Ni={ssdMobilenetv1:new N7e,tinyFaceDetector:new O7e,tinyYolov2:new M7e,faceLandmark68Net:new X9e,faceLandmark68TinyNet:new e7e,faceRecognitionNet:new o7e,faceExpressionNet:new $9e,ageGenderNet:new Y9e},Gq=class extends Xb{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},YA=class extends Gq{async run(){let e=await this.parentTask,t=await RN(e,this.input,async n=>Promise.all(n.map(r=>Ni.faceExpressionNet.predictExpressions(r))),this.extractedFaces);return e.map((n,r)=>jq(n,t[r]))}withAgeAndGender(){return new JA(this,this.input)}},XA=class extends Gq{async run(){let e=await this.parentTask;if(!e)return;let t=await KA(e,this.input,n=>Ni.faceExpressionNet.predictExpressions(n),this.extractedFaces);return jq(e,t)}withAgeAndGender(){return new eR(this,this.input)}},ZA=class extends YA{withAgeAndGender(){return new tR(this,this.input)}withFaceDescriptors(){return new rR(this,this.input)}},QA=class extends XA{withAgeAndGender(){return new nR(this,this.input)}withFaceDescriptor(){return new aR(this,this.input)}},qq=class extends Xb{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},JA=class extends qq{async run(){let e=await this.parentTask,t=await RN(e,this.input,async n=>Promise.all(n.map(r=>Ni.ageGenderNet.predictAgeAndGender(r))),this.extractedFaces);return e.map((n,r)=>{let{age:a,gender:s,genderProbability:i}=t[r];return zq(Bq(n,s,i),a)})}withFaceExpressions(){return new YA(this,this.input)}},eR=class extends qq{async run(){let e=await this.parentTask;if(!e)return;let{age:t,gender:n,genderProbability:r}=await KA(e,this.input,a=>Ni.ageGenderNet.predictAgeAndGender(a),this.extractedFaces);return zq(Bq(e,n,r),t)}withFaceExpressions(){return new XA(this,this.input)}},tR=class extends JA{withFaceExpressions(){return new ZA(this,this.input)}withFaceDescriptors(){return new rR(this,this.input)}},nR=class extends eR{withFaceExpressions(){return new QA(this,this.input)}withFaceDescriptor(){return new aR(this,this.input)}},Kq=class extends Xb{constructor(e,t){super(),this.parentTask=e,this.input=t}},rR=class extends Kq{async run(){let e=await this.parentTask;return(await RN(e,this.input,t=>Promise.all(t.map(n=>Ni.faceRecognitionNet.computeFaceDescriptor(n))),null,t=>t.landmarks.align(null,{useDlibAlignment:!0}))).map((t,n)=>Lq(e[n],t))}withFaceExpressions(){return new ZA(this,this.input)}withAgeAndGender(){return new tR(this,this.input)}},aR=class extends Kq{async run(){let e=await this.parentTask;if(!e)return;let t=await KA(e,this.input,n=>Ni.faceRecognitionNet.computeFaceDescriptor(n),null,n=>n.landmarks.align(null,{useDlibAlignment:!0}));return Lq(e,t)}withFaceExpressions(){return new QA(this,this.input)}withAgeAndGender(){return new nR(this,this.input)}},Yq=class extends Xb{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.useTinyLandmarkNet=n}get landmarkNet(){return this.useTinyLandmarkNet?Ni.faceLandmark68TinyNet:Ni.faceLandmark68Net}},L7e=class extends Yq{async run(){let e=await this.parentTask,t=e.map(a=>a.detection),n=this.input instanceof Zt?await zA(this.input,t):await LA(this.input,t),r=await Promise.all(n.map(a=>this.landmarkNet.detectLandmarks(a)));return n.forEach(a=>a instanceof Zt&&a.dispose()),e.filter((a,s)=>r[s]).map((a,s)=>Rq(a,r[s]))}withFaceExpressions(){return new ZA(this,this.input)}withAgeAndGender(){return new tR(this,this.input)}withFaceDescriptors(){return new rR(this,this.input)}},z7e=class extends Yq{async run(){let e=await this.parentTask;if(!e)return;let{detection:t}=e,n=this.input instanceof Zt?await zA(this.input,[t]):await LA(this.input,[t]),r=await this.landmarkNet.detectLandmarks(n[0]);return n.forEach(a=>a instanceof Zt&&a.dispose()),Rq(e,r)}withFaceExpressions(){return new QA(this,this.input)}withAgeAndGender(){return new nR(this,this.input)}withFaceDescriptor(){return new aR(this,this.input)}},Xq=class extends Xb{constructor(e,t=new AN){super(),this.input=e,this.options=t}},B7e=class extends Xq{async run(){let{input:e,options:t}=this,n;if(t instanceof Hq)n=Ni.tinyFaceDetector.locateFaces(e,t);else if(t instanceof AN)n=Ni.ssdMobilenetv1.locateFaces(e,t);else if(t instanceof qA)n=Ni.tinyYolov2.locateFaces(e,t);else throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");return n}runAndExtendWithFaceDetections(){return new Promise((e,t)=>{this.run().then(n=>e(n.map(r=>uq({},r)))).catch(n=>t(n))})}withFaceLandmarks(e=!1){return new L7e(this.runAndExtendWithFaceDetections(),this.input,e)}withFaceExpressions(){return new YA(this.runAndExtendWithFaceDetections(),this.input)}withAgeAndGender(){return new JA(this.runAndExtendWithFaceDetections(),this.input)}},W7e=class extends Xq{async run(){let e=await new B7e(this.input,this.options),t=e[0];return e.forEach(n=>{n.score>t.score&&(t=n)}),t}runAndExtendWithFaceDetection(){return new Promise(async e=>{let t=await this.run();e(t?uq({},t):void 0)})}withFaceLandmarks(e=!1){return new z7e(this.runAndExtendWithFaceDetection(),this.input,e)}withFaceExpressions(){return new XA(this.runAndExtendWithFaceDetection(),this.input)}withAgeAndGender(){return new eR(this.runAndExtendWithFaceDetection(),this.input)}};function V7e(e,t=new AN){return new W7e(e,t)}let NP=!1;const U7e="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model";async function H7e(){NP||(await Ni.tinyFaceDetector.loadFromUri(U7e),NP=!0)}async function G7e(e){return await H7e(),new Promise(t=>{const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{try{const r=await V7e(n,new Hq);if(!r)return t(null);const a=(r.box.x+r.box.width/2)/n.width,s=(r.box.y+r.box.height/2)/n.height;t({x:Math.round(a*100),y:Math.round(s*100)})}catch(r){console.warn("Face detection error:",r),t(null)}},n.onerror=()=>t(null)})}const Pv=512,kP=3;function q7e({open:e,imageFile:t,onClose:n,onSave:r}){const[a,s]=k.useState(""),[i,l]=k.useState(!1),[u,d]=k.useState(!1),c=k.useRef(null),h=k.useRef(null),p=k.useRef(1),m=k.useRef(1),f=k.useRef({x:0,y:0}),g=k.useRef(null),x=k.useRef(null),y=k.useRef(null),b=k.useCallback(()=>{const L=c.current,q=h.current;if(!L||!q)return null;const ee=L.getBoundingClientRect().width,M=q.naturalWidth||1,G=q.naturalHeight||1;return{containerSize:ee,imgW:M,imgH:G}},[]),v=k.useCallback(()=>{const L=b();if(!L)return 1;const{containerSize:q,imgW:U,imgH:ee}=L;return Math.max(q/U,q/ee)},[b]),w=k.useCallback(()=>{const L=b();if(!L)return;const{containerSize:q,imgW:U,imgH:ee}=L,M=p.current,G=U*M,J=ee*M,ve=Math.max(0,(G-q)/2),Q=Math.max(0,(J-q)/2);f.current.x=Math.max(-ve,Math.min(ve,f.current.x)),f.current.y=Math.max(-Q,Math.min(Q,f.current.y))},[b]),N=k.useCallback(()=>{const L=h.current;if(!L)return;w();const{x:q,y:U}=f.current,ee=p.current;L.style.transform=`
    translate(-50%, -50%)
    translate(${q}px, ${U}px)
    scale(${ee})
  `},[w]),S=k.useCallback(()=>{y.current||(y.current=requestAnimationFrame(()=>{N(),y.current=null}))},[N]),C=k.useCallback(()=>{const L=b();if(!L||L.containerSize===0){requestAnimationFrame(C);return}m.current=v(),p.current=m.current,f.current={x:0,y:0},N(),d(!0)},[b,v,N]);k.useEffect(()=>{if(!t)return;d(!1);const L=URL.createObjectURL(t);return s(L),()=>URL.revokeObjectURL(L)},[t]);const _=k.useCallback(()=>{requestAnimationFrame(()=>{requestAnimationFrame(C)})},[C]),T=L=>{if(L.preventDefault(),L.touches.length===1)g.current={x:L.touches[0].clientX,y:L.touches[0].clientY};else if(L.touches.length===2){const q=L.touches[0].clientX-L.touches[1].clientX,U=L.touches[0].clientY-L.touches[1].clientY;x.current=Math.hypot(q,U),g.current={x:(L.touches[0].clientX+L.touches[1].clientX)/2,y:(L.touches[0].clientY+L.touches[1].clientY)/2}}},E=L=>{if(L.preventDefault(),L.touches.length===1&&g.current){const q=L.touches[0].clientX-g.current.x,U=L.touches[0].clientY-g.current.y;f.current.x+=q,f.current.y+=U,g.current={x:L.touches[0].clientX,y:L.touches[0].clientY},S()}else if(L.touches.length===2&&x.current!==null){const q=L.touches[0].clientX-L.touches[1].clientX,U=L.touches[0].clientY-L.touches[1].clientY,ee=Math.hypot(q,U),M=ee/x.current,G=Math.max(m.current,Math.min(kP,p.current*M));p.current=G,x.current=ee,S()}},j=()=>{g.current=null,x.current=null},I=L=>{L.button===0&&(L.preventDefault(),g.current={x:L.clientX,y:L.clientY})},D=L=>{if(!g.current)return;L.preventDefault();const q=L.clientX-g.current.x,U=L.clientY-g.current.y;f.current.x+=q,f.current.y+=U,g.current={x:L.clientX,y:L.clientY},S()},F=()=>{g.current=null},P=L=>{L.preventDefault();const q=L.deltaY>0?.9:1.1,U=Math.max(m.current,Math.min(kP,p.current*q));p.current=U,S()},V=()=>{m.current=v(),p.current=m.current,f.current={x:0,y:0},N()},$=async()=>{if(a){l(!0);try{const L=await G7e(a);if(!L)return;const q=b();if(!q)return;const{containerSize:U,imgW:ee,imgH:M}=q;m.current=v(),p.current=m.current*1.2;const G=L.x/100*ee*p.current,J=L.y/100*M*p.current,ve=ee*p.current/2,Q=M*p.current/2;f.current={x:ve-G,y:Q-J},N()}finally{l(!1)}}},O=()=>{const L=h.current,q=b();if(!L||!q)return;const{containerSize:U,imgW:ee,imgH:M}=q,G=p.current,{x:J,y:ve}=f.current,Q=ee*G,se=M*G,_e=(Q-U)/2-J,Le=(se-U)/2-ve,Se=_e/G,ye=Le/G,Fe=U/G,Te=document.createElement("canvas");Te.width=Pv,Te.height=Pv,Te.getContext("2d").drawImage(L,Se,ye,Fe,Fe,0,0,Pv,Pv),Te.toBlob(He=>He&&r(He),"image/webp",.85)};return o.jsx(gn,{open:e,onOpenChange:n,children:o.jsxs(cn,{className:"max-w-md p-0",children:[o.jsx(dn,{className:"p-4",children:o.jsx(hn,{children:"Adjust Profile Photo"})}),o.jsx("div",{className:"px-4",children:o.jsxs("div",{ref:c,className:"relative w-full aspect-square overflow-hidden rounded-xl bg-black cursor-grab active:cursor-grabbing",style:{touchAction:"none"},onTouchStart:T,onTouchMove:E,onTouchEnd:j,onMouseDown:I,onMouseMove:D,onMouseUp:F,onMouseLeave:F,onWheel:P,children:[a&&o.jsx("img",{ref:h,src:a,alt:"Crop preview",draggable:!1,onLoad:_,className:`absolute top-1/2 left-1/2 max-w-none select-none ${u?"opacity-100":"opacity-0"}`,style:{transformOrigin:"center center"}}),o.jsx("div",{className:"pointer-events-none absolute inset-0 grid grid-cols-3 grid-rows-3",children:[...Array(9)].map((L,q)=>o.jsx("div",{className:"border border-white/30"},q))})]})}),o.jsxs("div",{className:"px-4 py-3 flex gap-2",children:[o.jsxs(fe,{variant:"outline",onClick:$,disabled:i,children:[i?o.jsx(Gt,{className:"h-4 w-4 animate-spin mr-1"}):o.jsx(wY,{className:"h-4 w-4 mr-1"}),"Face"]}),o.jsxs(fe,{variant:"outline",onClick:V,children:[o.jsx(hw,{className:"h-4 w-4 mr-1"})," Reset"]})]}),o.jsxs("div",{className:"flex gap-2 p-4 pt-0",children:[o.jsx(fe,{variant:"outline",onClick:n,children:"Cancel"}),o.jsx(fe,{onClick:O,children:"Save"})]})]})})}const Zq=k.forwardRef(({name:e,designation:t,company:n,photoUrl:r,publicUrl:a,slug:s},i)=>{const[l,u]=k.useState(null),[d,c]=k.useState(!1);k.useEffect(()=>{if(!r){c(!0);return}(async()=>{try{const f=await(await fetch(r,{mode:"cors"})).blob(),g=new FileReader;g.onloadend=()=>{u(g.result),c(!0)},g.onerror=()=>{u(r),c(!0)},g.readAsDataURL(f)}catch(m){console.error("Failed to preload photo:",m),u(r),c(!0)}})()},[r]);const h=p=>p.split(" ").filter(Boolean).map(m=>m[0]).join("").toUpperCase().slice(0,2)||"U";return s.startsWith("/u/")&&`${s}`,o.jsx("div",{ref:i,style:{width:1080,height:1350,background:"linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:"80px 60px",fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',position:"absolute",left:"-9999px",top:"-9999px",overflow:"hidden",pointerEvents:"none"},children:o.jsxs("div",{style:{width:"100%",maxWidth:900,background:"#ffffff",borderRadius:48,boxShadow:"0 20px 60px rgba(0, 0, 0, 0.07), 0 6px 18px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",alignItems:"center",padding:"56px 48px 48px",flex:1},children:[o.jsx("div",{style:{width:200,height:200,borderRadius:"50%",overflow:"hidden",border:"6px solid #f1f3f4",background:"linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 32px rgba(0, 0, 0, 0.1)",marginBottom:32},children:l?o.jsx("img",{src:l,alt:e,style:{width:"100%",height:"100%",objectFit:"cover"}}):o.jsx("span",{style:{fontSize:72,fontWeight:600,color:"#9ca3af"},children:h(e)})}),o.jsx("h1",{style:{fontSize:72,fontWeight:700,color:"#1a1a1a",margin:0,textAlign:"center",letterSpacing:"-0.02em",lineHeight:1.1},children:e}),t&&o.jsx("p",{style:{fontSize:36,fontWeight:500,color:"#4b5563",margin:"18px 0 0",textAlign:"center"},children:t}),n&&o.jsx("p",{style:{fontSize:32,fontWeight:500,color:"#9ca3af",margin:"10px 0 0",textAlign:"center",letterSpacing:"0.02em"},children:n}),o.jsxs("div",{style:{marginTop:36,background:"#ffffff",borderRadius:32,padding:36,boxShadow:"0 6px 24px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.06)",display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx(OI,{value:a,size:320,level:"H",includeMargin:!1,bgColor:"#ffffff",fgColor:"#1a1a1a"}),o.jsx("p",{style:{fontSize:30,fontWeight:600,color:"#111827",margin:"28px 0 10px",textAlign:"center",letterSpacing:"-0.01em"},children:"Scan to connect instantly"}),o.jsx("p",{style:{fontSize:26,fontWeight:500,color:"#6b7280",margin:0,textAlign:"center"},children:"SYNKA.in"})]})]})})});Zq.displayName="ShareableCardImage";const DN=200,SP=.92,K7e=.6,MN=e=>new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.src=URL.createObjectURL(e)}),sR=async(e,t=DN)=>{const n="image/jpeg";let r=SP,a=null,s=K7e,i=SP;for(let l=0;l<6&&(r=(s+i)/2,a=await new Promise(d=>{e.toBlob(c=>d(c),n,r)}),!!a);l++){const u=a.size/1024;if(u>t)i=r;else if(u<t*.7)s=r;else break}return a||(a=await new Promise((l,u)=>{e.toBlob(d=>d?l(d):u(new Error("Failed to create blob")),n,.85)})),a};async function Y7e(e,t,n){const r=await MN((e instanceof Blob,e)),a=document.createElement("canvas"),s=a.getContext("2d"),i=512;a.width=i,a.height=i;const l=Math.min(r.width,r.height);let u=0,d=0;if(t!==void 0&&n!==void 0){const h=t/100*r.width,p=n/100*r.height;u=Math.max(0,Math.min(h-l/2,r.width-l)),d=Math.max(0,Math.min(p-l/2,r.height-l))}else u=(r.width-l)/2,d=(r.height-l)/2;s.drawImage(r,u,d,l,l,0,0,i,i),URL.revokeObjectURL(r.src);const c=await sR(a,DN);return{blob:c,width:i,height:i,sizeKB:Math.round(c.size/1024)}}async function Qq(e){const t=await MN(e),n=document.createElement("canvas"),r=n.getContext("2d");n.width=t.width,n.height=t.height,r.drawImage(t,0,0),URL.revokeObjectURL(t.src);const a=await sR(n,DN);return{blob:a,width:t.width,height:t.height,sizeKB:Math.round(a.size/1024)}}async function Jq(e){const t=await MN(e),n=600,r=300;let a=t.width,s=t.height;if(a>n||s>r){const c=Math.min(n/a,r/s);a=Math.round(a*c),s=Math.round(s*c)}const i=document.createElement("canvas"),l=i.getContext("2d");i.width=a,i.height=s,l.drawImage(t,0,0,a,s),URL.revokeObjectURL(t.src);const u=e.type==="image/png";let d;return u?d=await new Promise((c,h)=>{i.toBlob(p=>p?c(p):h(new Error("Failed to create blob")),"image/png")}):d=await sR(i,DN),{blob:d,width:a,height:s,sizeKB:Math.round(d.size/1024)}}async function X7e(e,t=1600){const n=await MN(e);let r=n.width,a=n.height;if(r>t||a>t){const l=Math.min(t/r,t/a);r=Math.round(r*l),a=Math.round(a*l)}const s=document.createElement("canvas"),i=s.getContext("2d");return s.width=r,s.height=a,i.drawImage(n,0,0,r,a),URL.revokeObjectURL(n.src),s.toDataURL("image/jpeg",.85)}async function XC(e,t,n="profiles"){if(!t)return!1;try{const a=new URL(t).pathname.split(`/storage/v1/object/public/${n}/`);if(a.length<2)return!1;const s=a[1],{error:i}=await e.storage.from(n).remove([s]);return i?(console.warn("Failed to delete old image:",i),!1):!0}catch(r){return console.warn("Error deleting storage image:",r),!1}}const Z7e=Object.freeze(Object.defineProperty({__proto__:null,deleteStorageImage:XC,fileToOptimizedBase64:X7e,optimizeCroppedImage:Qq,optimizeLogo:Jq,optimizeProfilePhoto:Y7e},Symbol.toStringTag,{value:"Module"})),Q7e="https://synka.in";async function J7e(e,t){const r=await(await fetch(e)).blob();return new File([r],t,{type:r.type||"image/png"})}async function eqe(e){const t=new Image;t.crossOrigin="anonymous",await new Promise((l,u)=>{t.onload=()=>l(),t.onerror=()=>u(new Error("Failed to load image")),t.src=e});const n=80,r=document.createElement("canvas"),a=r.getContext("2d");if(!a)return e;r.width=t.width,r.height=t.height+n,a.fillStyle="#f8f9fa",a.fillRect(0,0,r.width,r.height),a.drawImage(t,0,0);const s=r.width/2,i=t.height+26;return a.fillStyle="#111111",a.font='500 26px -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',a.textAlign="right",a.textBaseline="top",a.fillText("Powered by",s-6,i),a.fillStyle="#F97316",a.font='700 26px -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.fillText("SYNKA",s+6,i),r.toDataURL("image/png",1)}function tqe(){const[e,t]=k.useState(!1),n=k.useRef(null),r=k.useCallback(async i=>{if(!n.current)return console.error("Card ref not available"),null;const l=n.current;try{const u=l.querySelectorAll("img"),d=Array.from(u).map(h=>new Promise(p=>{if(h.complete&&h.naturalHeight!==0)p();else{const m=setTimeout(()=>p(),5e3);h.onload=()=>{clearTimeout(m),p()},h.onerror=()=>{clearTimeout(m),p()}}}));await Promise.all(d),await new Promise(h=>setTimeout(h,300));const c=await $2(l,{quality:1,pixelRatio:2,cacheBust:!0,skipFonts:!1,backgroundColor:"#f8f9fa",width:1080,height:1350,includeQueryParams:!0,style:{position:"static",left:"auto",top:"auto",transform:"none"}});return await eqe(c)}catch(u){return console.error("Error generating card image:",u),null}},[]),a=k.useCallback(async i=>{if(!n.current){console.error("Card ref not available"),oe({title:"Download failed",description:"Card element not ready. Please try again.",variant:"destructive"});return}t(!0);try{const l=await r(i);if(!l)throw new Error("Failed to generate image");const u=`${i.name.replace(/\s+/g,"-").toLowerCase()}-synka-card.png`;if(Yt.isNativePlatform()){try{const c=l.split(",")[1],h=await Ox.writeFile({path:u,data:c,directory:id.Cache}),p=i.publicUrl||`${Q7e}/c/${i.slug}`;await sd.share({title:"My Digital Card",text:`Check out my digital business card: ${p}`,files:[h.uri],dialogTitle:"Share your card"}),await Ir.success(),oe({title:"Card ready to share!",description:"Choose where to save or share."})}catch(c){console.error("Native share error:",c),oe({title:"Share failed",description:"Could not share card image.",variant:"destructive"})}return}const d=document.createElement("a");d.download=u,d.href=l,document.body.appendChild(d),d.click(),document.body.removeChild(d),oe({title:"Card image downloaded",description:"Share it on WhatsApp, LinkedIn, or anywhere!"})}catch(l){console.error("Error generating card image:",l),oe({title:"Download failed",description:"Could not generate card image. Please try again.",variant:"destructive"})}finally{t(!1)}},[r]),s=k.useCallback(async i=>{const l=await r(i);if(!l)return null;const u=`${i.name.replace(/\s+/g,"-").toLowerCase()}-synka-card.png`;return await J7e(l,u)},[r]);return{cardRef:n,isGenerating:e,downloadCard:a,generateCardImage:r,generateCardFile:s}}function ux({icon:e,value:t,href:n,iconClass:r}){return o.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"group block",children:[o.jsxs("div",{className:"flex items-center gap-4 px-4 py-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:o.jsx(e,{className:Ie("h-[18px] w-[18px] text-foreground/90",r)})}),o.jsx("p",{className:"text-[15px] font-medium text-foreground truncate flex-1",children:t})]}),o.jsx("div",{className:"ml-[72px] h-px bg-border/40 group-last:hidden"})]})}const nqe=e=>{const t=e.replace(/\D/g,"");return`https://api.whatsapp.com/send?phone=${t.length===10?`91${t}`:t}`};function rqe(){const e=za(),t=Rl(),{user:n,loading:r}=ir(),{profile:a}=Ko(),{activeCard:s,loading:i,updateCard:l,refetch:u}=uf(),{cardRef:d,isGenerating:c,generateCardFile:h}=tqe(),[p,m]=k.useState(!1),[f,g]=k.useState(!1),[x,y]=k.useState("photo-logo"),[b,v]=k.useState(null),[w,N]=k.useState({name:"",designation:"",company:"",phone:"",email:"",website:"",whatsapp:"",linkedin:"",about:"",photo_url:"",logo_url:"",instagram:"",youtube:"",twitter:"",facebook:"",calendly:""}),[S,C]=k.useState(!1),[_,T]=k.useState(!1),[E,j]=k.useState(null),[I,D]=k.useState(!1),F=k.useRef(null),P=k.useRef(null);k.useRef(!1);const V=r||i,[$,O]=k.useState(!1);k.useEffect(()=>{s&&(s.full_name||s.email||s.phone)&&O(!0)},[s]);const L=$,q=k.useRef(!1),U=k.useRef(null);k.useEffect(()=>{q.current=!0},[]),k.useEffect(()=>{},[r,n]);const ee=k.useRef(null);k.useEffect(()=>{if(!s&&!a)return;const Ee=(s==null?void 0:s.id)||"no-card";if(ee.current===Ee&&(s==null?void 0:s.is_default)===U.current)return;const Re={name:(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"",designation:(s==null?void 0:s.designation)||"",company:(s==null?void 0:s.company)||"",phone:(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"",email:(s==null?void 0:s.email)||(a==null?void 0:a.email)||(n==null?void 0:n.email)||"",website:(s==null?void 0:s.website)||"",whatsapp:(s==null?void 0:s.whatsapp)||"",linkedin:(s==null?void 0:s.linkedin)||"",about:(s==null?void 0:s.about)||"",photo_url:(s==null?void 0:s.photo_url)||"",logo_url:(s==null?void 0:s.logo_url)||"",instagram:(s==null?void 0:s.instagram)||"",youtube:(s==null?void 0:s.youtube)||"",twitter:(s==null?void 0:s.twitter)||"",facebook:(s==null?void 0:s.facebook)||"",calendly:(s==null?void 0:s.calendly)||""};N(at=>{const Y=JSON.stringify(at),ae=JSON.stringify(Re);return Y===ae?at:Re}),s!=null&&s.layout&&s.layout!==x&&y(s.layout);const Ke=(s==null?void 0:s.card_design)??null;Ke!==b&&v(Ke),ee.current=Ee,U.current=(s==null?void 0:s.is_default)??null},[s]),k.useEffect(()=>{const Ee=new URLSearchParams(t.search);Ee.get("edit")==="true"&&!p&&(m(!0),Ee.delete("edit"),e({pathname:t.pathname,search:Ee.toString()},{replace:!0}))},[t.search,p,e]);const M=a!=null&&a.public_slug?tz(a.public_slug):"";s!=null&&s.phone||a!=null&&a.phone||s!=null&&s.whatsapp,s!=null&&s.whatsapp||s!=null&&s.phone||a!=null&&a.phone;const G=async()=>{var Y;if((Y=navigator.vibrate)==null||Y.call(navigator,10),!s)return;const Ee=Qv({email:w.email,phone:w.phone,website:w.website,linkedin:w.linkedin});if(Ee){oe({title:Ee.message,variant:"destructive"});return}const Re=Jv({email:w.email,phone:w.phone,whatsapp:w.whatsapp,website:w.website,linkedin:w.linkedin});!Re.phone&&Re.whatsapp?Re.phone=Re.whatsapp:!Re.whatsapp&&Re.phone&&(Re.whatsapp=Re.phone);const Ke={...w,...Re};N(Ke);const{error:at}=await l(s.id,{full_name:Ke.name,designation:Ke.designation,company:Ke.company,phone:Ke.phone,email:Ke.email,website:Ke.website,whatsapp:Ke.whatsapp,linkedin:Ke.linkedin,about:Ke.about,photo_url:Ke.photo_url,logo_url:Ke.logo_url,layout:x,card_design:b??null,instagram:Ke.instagram||null,youtube:Ke.youtube||null,twitter:Ke.twitter||null,facebook:Ke.facebook||null,calendly:Ke.calendly||null});if(at)oe({title:"Error",description:"Failed to save changes. Please try again.",variant:"destructive"});else{m(!1),oe({title:"Card updated!",description:"Your changes have been saved."});const ae=new URLSearchParams(t.search);ae.get("edit")==="true"&&(ae.delete("edit"),e({pathname:t.pathname,search:ae.toString()},{replace:!0}))}},J=Ee=>{var Ke;const Re=(Ke=Ee.target.files)==null?void 0:Ke[0];!Re||!n||!s||(j(Re),T(!0),Ee.target.value="")},ve=async Ee=>{if(!(!n||!s)){D(!0),T(!1);try{s.photo_url&&await XC(le,s.photo_url,"profiles");const Re=await Qq(Ee),Ke=`photos/${n.id}-${Date.now()}.jpg`,{error:at}=await le.storage.from("profiles").upload(Ke,Re.blob,{upsert:!0,contentType:Re.blob.type});if(at)throw console.error("Upload error:",at.message),at;const{data:Y}=le.storage.from("profiles").getPublicUrl(Ke),ae=Y.publicUrl;N(we=>({...we,photo_url:ae})),await l(s.id,{photo_url:ae}),oe({title:"Photo updated",description:`Optimized to ${Re.sizeKB}KB`})}catch(Re){oe({title:"Upload failed",description:(Re==null?void 0:Re.message)||"Could not upload photo. Please try again.",variant:"destructive"})}finally{D(!1),j(null)}}},Q=async Ee=>{var Ke;const Re=(Ke=Ee.target.files)==null?void 0:Ke[0];if(!(!Re||!n||!s))try{s.logo_url&&await XC(le,s.logo_url,"profiles");const at=await Jq(Re),Y=at.blob.type==="image/png"?"png":"jpg",ae=`logos/${n.id}-${Date.now()}.${Y}`,{error:we}=await le.storage.from("profiles").upload(ae,at.blob,{upsert:!0,contentType:at.blob.type});if(we)throw we;const{data:Ce}=le.storage.from("profiles").getPublicUrl(ae),Ne=Ce.publicUrl;N(he=>({...he,logo_url:Ne})),await l(s.id,{logo_url:Ne}),oe({title:"Logo updated",description:`Optimized to ${at.sizeKB}KB`})}catch(at){console.error("Logo upload error:",at),oe({title:"Upload failed",description:"Could not upload logo. Please try again.",variant:"destructive"})}},se=async()=>{C(!0);try{const{data:Ee,error:Re}=await le.functions.invoke("generate-about",{body:{name:w.name,company:w.company,designation:w.designation,email:w.email,linkedin:w.linkedin,website:w.website,use_web_search:!0}});if(Re)throw Re;Ee!=null&&Ee.about&&(N(Ke=>({...Ke,about:Ee.about})),oe({title:"About generated!",description:"Your professional summary has been created from live web info."}))}catch(Ee){console.error("Error generating about:",Ee),oe({title:"Error",description:"Failed to generate about. Please try again.",variant:"destructive"})}finally{C(!1)}},_e=()=>{var Ee;(Ee=navigator.vibrate)==null||Ee.call(navigator,10),M&&(navigator.clipboard.writeText(M),oe({title:"Link copied!",description:"Share it with anyone."}))},Le=async()=>{if(await Ir.light(),!M){_e();return}if(Yt.isNativePlatform()){try{await sd.share({url:M}),await Ir.success()}catch(Ee){console.error("Native share error:",Ee),_e()}return}if(navigator.share){try{await navigator.share({url:M}),await Ir.success()}catch(Ee){Ee.name!=="AbortError"&&(console.error("Web share error:",Ee),_e())}return}_e()},Se=async(Ee,Re)=>{y(Ee),v(Re??null),s&&await l(s.id,{layout:Ee,card_design:Re??null})},ye=async()=>{var Y;await Ir.light();const Ee=(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"";if(!Ee){oe({title:"Complete your card",description:"Add your name to share your card image.",variant:"destructive"});return}const Re=await h({name:Ee,designation:(s==null?void 0:s.designation)||void 0,company:(s==null?void 0:s.company)||void 0,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,publicUrl:M,slug:a!=null&&a.public_slug?`/u/${a.public_slug}`:"",isPremium:(a==null?void 0:a.plan)==="Orange"});if(!Re){oe({title:"Failed",description:"Could not generate card image.",variant:"destructive"});return}if(Yt.isNativePlatform()){const ae=await new Promise((Ce,Ne)=>{const he=new FileReader;he.onload=()=>Ce(he.result.split(",")[1]),he.onerror=Ne,he.readAsDataURL(Re)}),we=await Ox.writeFile({path:`Synka-${Date.now()}.png`,data:ae,directory:id.Documents,recursive:!0});await sd.share({title:"My Digital Card",text:"Check out my digital business card",files:[we.uri]}),await Ir.success();return}if((Y=navigator.canShare)!=null&&Y.call(navigator,{files:[Re]}))try{await navigator.share({title:"My Digital Card",files:[Re]}),await Ir.success();return}catch{}const Ke=URL.createObjectURL(Re),at=document.createElement("a");at.href=Ke,at.download=Re.name,at.click(),URL.revokeObjectURL(Ke),await Ir.success()},Fe=(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"",Te=(s==null?void 0:s.email)||(a==null?void 0:a.email)||"",Oe=(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"",He=(s==null?void 0:s.whatsapp)||(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"";return o.jsxs("div",{className:Ie("w-full py-4 sm:py-6 px-3 sm:px-4 space-y-4 sm:space-y-6 mx-auto max-w-full sm:max-w-md lg:max-w-[460px]",!q.current&&"animate-fade-up"),children:[s&&!s.is_default&&o.jsx("div",{className:"flex items-center justify-center gap-2 py-2 px-4 bg-muted/50 border border-border/40 rounded-xl",children:o.jsx("span",{className:"text-sm text-muted-foreground",children:"This card is private. Set as default to make it public."})}),o.jsxs("div",{className:"bg-card/95 backdrop-blur-xl rounded-3xl border border-border/40 shadow-[0_20px_40px_rgba(0,0,0,0.06)] overflow-hidden",children:[o.jsxs("div",{className:"relative pt-0 pb-4 flex flex-col items-center",children:[L?o.jsx(mI,{layout:x,photoUrl:s.photo_url,logoUrl:s.logo_url,name:Fe,designation:s.designation||void 0,company:s.company||void 0,themeColor:b,faceX:s.face_x,faceY:s.face_y,logoX:s.logo_x,logoY:s.logo_y}):o.jsx("div",{className:"w-full h-72 rounded-3xl bg-muted/40 animate-pulse"}),L&&x!=="photo-only"?o.jsxs("div",{className:"text-center mt-4 space-y-1 text-foreground",children:[o.jsx("h2",{className:"text-[22px] font-semibold tracking-tight text-foreground",children:Fe}),(s==null?void 0:s.designation)&&o.jsx("p",{className:"text-[14.5px] font-normal text-muted-foreground leading-tight",children:s.designation}),(s==null?void 0:s.company)&&o.jsx("p",{className:"text-[13.5px] text-muted-foreground/70 leading-tight",children:s.company})]}):o.jsxs("div",{className:"text-center mt-4 space-y-2",children:[o.jsx("div",{className:"h-6 w-40 mx-auto bg-muted/40 rounded animate-pulse"}),o.jsx("div",{className:"h-4 w-28 mx-auto bg-muted/30 rounded animate-pulse"})]})]}),o.jsx("div",{className:"mx-6 h-px bg-gradient-to-r from-transparent via-border/40 to-transparent"}),o.jsxs("div",{className:"p-6 space-y-2",children:[Oe&&o.jsx(ux,{icon:Ry,value:Oe,href:`tel:${Oe}`}),Te&&o.jsx(ux,{icon:xi,value:Te,href:`mailto:${Te}`}),(s==null?void 0:s.website)&&o.jsx(ux,{icon:z0,value:"Visit Website",href:s.website.startsWith("http")?s.website:`https://${s.website}`}),He&&o.jsx(ux,{icon:pI,value:"Connect on WhatsApp",href:nqe(He),iconClass:"text-foreground/80 group-hover:text-[#25D366]"}),o.jsx(S2,{documentName:s==null?void 0:s.document_name,documentUrl:s==null?void 0:s.document_url}),(s==null?void 0:s.linkedin)&&o.jsx(ux,{icon:i_,value:"Connect on LinkedIn",href:`https://linkedin.com/in/${s.linkedin}`,iconClass:"text-foreground/80 group-hover:text-blue-600"}),(s==null?void 0:s.instagram)&&o.jsx(Io,{platform:"instagram",url:s.instagram}),(s==null?void 0:s.youtube)&&o.jsx(Io,{platform:"youtube",url:s.youtube}),(s==null?void 0:s.twitter)&&o.jsx(Io,{platform:"twitter",url:s.twitter}),(s==null?void 0:s.facebook)&&o.jsx(Io,{platform:"facebook",url:s.facebook}),(s==null?void 0:s.calendly)&&o.jsx(Io,{platform:"calendly",url:s.calendly})]})]}),(s==null?void 0:s.about)&&o.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40",children:[o.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"About"}),o.jsx("p",{className:"text-muted-foreground text-sm whitespace-pre-line",children:s.about})]}),o.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40 flex flex-col items-center",children:[o.jsx("div",{className:"p-4 rounded-2xl bg-white shadow-sm",children:M?o.jsx(OI,{value:M,size:160,level:"H",includeMargin:!0}):o.jsx("div",{className:"w-[160px] h-[160px] flex items-center justify-center text-muted-foreground text-sm",children:"Loading QR..."})}),M&&o.jsx("p",{className:"sr-only",children:M.replace(Zae(),"")})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(fe,{variant:"outline",className:"flex-1 min-w-0 active:scale-[0.97] transition-transform",onClick:()=>{Ir.light(),ye()},disabled:V||!Fe||c,children:[o.jsx(km,{className:"h-4 w-4 mr-2 shrink-0"}),o.jsx("span",{className:"truncate",children:c?"Saving...":"Download"})]}),o.jsxs(fe,{variant:"outline",className:"flex-1 min-w-0 active:scale-[0.97] transition-transform",onClick:()=>g(!0),disabled:V,children:[o.jsx(A3,{className:"h-4 w-4 mr-2 shrink-0"}),o.jsx("span",{className:"truncate",children:"Layout"})]})]}),o.jsxs(fe,{variant:"gradient",className:"w-full font-medium tracking-tight",onClick:Le,disabled:V,children:[o.jsx(F3,{className:"h-4 w-4 mr-2"}),"Share"]})]}),o.jsx(Zq,{ref:d,name:Fe,designation:(s==null?void 0:s.designation)||void 0,company:(s==null?void 0:s.company)||void 0,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,publicUrl:M,slug:a!=null&&a.public_slug?`/u/${a.public_slug}`:"",isPremium:(a==null?void 0:a.plan)==="Orange"}),o.jsx(gn,{open:p,onOpenChange:m,children:o.jsxs(cn,{className:"max-w-lg max-h-[92vh] rounded-3xl overflow-y-auto",children:[o.jsx(dn,{children:o.jsx(hn,{className:"text-[22px] font-semibold tracking-tight",children:"Edit Your Card"})}),o.jsxs("div",{className:"space-y-6 py-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx(We,{className:"font-semibold",children:"Photo"}),o.jsx("div",{className:"aspect-square rounded-2xl overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var Ee;return(Ee=F.current)==null?void 0:Ee.click()},children:w.photo_url?o.jsx("img",{src:w.photo_url,alt:"Photo",className:"w-full h-full object-cover",style:{objectPosition:`${(s==null?void 0:s.face_x)??50}% ${(s==null?void 0:s.face_y)??50}%`}}):o.jsx(Hp,{className:"h-8 w-8 text-muted-foreground"})}),o.jsx("input",{ref:F,type:"file",accept:"image/*",className:"hidden",onChange:J}),o.jsxs(fe,{variant:"outline",className:"w-full",onClick:()=>{var Ee;return(Ee=F.current)==null?void 0:Ee.click()},disabled:V,children:[o.jsx(Hp,{className:"h-4 w-4 mr-2"}),w.photo_url?"Change Photo":"Upload Photo"]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(We,{className:"font-semibold",children:"Logo"}),o.jsx("div",{className:"aspect-square rounded-full overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var Ee;return(Ee=P.current)==null?void 0:Ee.click()},children:w.logo_url?o.jsx("img",{src:w.logo_url,alt:"Logo",className:"w-full h-full object-cover"}):o.jsx(Hp,{className:"h-8 w-8 text-muted-foreground"})}),o.jsx("input",{ref:P,type:"file",accept:"image/*",className:"hidden",onChange:Q}),o.jsxs(fe,{variant:"outline",className:"w-full",onClick:()=>{var Ee;return(Ee=P.current)==null?void 0:Ee.click()},disabled:V,children:[o.jsx(Hp,{className:"h-4 w-4 mr-2"}),w.logo_url?"Change Logo":"Upload Logo"]})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Name *"}),o.jsx(Ge,{value:w.name,onChange:Ee=>N(Re=>({...Re,name:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Role *"}),o.jsx(Ge,{value:w.designation,onChange:Ee=>N(Re=>({...Re,designation:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Organization/Brand"}),o.jsx(Ge,{value:w.company,onChange:Ee=>N(Re=>({...Re,company:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Phone"}),o.jsx(Ge,{value:w.phone,onChange:Ee=>N(Re=>({...Re,phone:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Email"}),o.jsx(Ge,{value:w.email,onChange:Ee=>N(Re=>({...Re,email:Ee.target.value})),disabled:V})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Website"}),o.jsx(Ge,{value:w.website,onChange:Ee=>N(Re=>({...Re,website:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"WhatsApp"}),o.jsx(Ge,{value:w.whatsapp,onChange:Ee=>N(Re=>({...Re,whatsapp:Ee.target.value})),disabled:V})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"LinkedIn Username"}),o.jsx(Ge,{value:w.linkedin,onChange:Ee=>N(Re=>({...Re,linkedin:Ee.target.value})),disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Social Links"}),o.jsx(ape,{values:{instagram:w.instagram,youtube:w.youtube,twitter:w.twitter,facebook:w.facebook,calendly:w.calendly},onChange:(Ee,Re)=>{N(Ke=>({...Ke,[Ee]:Re}))},disabled:V})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx(We,{children:"About Me"}),o.jsxs(fe,{variant:"ghost",size:"sm",onClick:se,disabled:V||S,children:[o.jsx(Hs,{className:Ie("h-4 w-4 mr-1",S&&"animate-spin")}),S?"Generating...":"Generate with AI"]})]}),o.jsx(Pa,{placeholder:"Tell people about yourself...",value:w.about,onChange:Ee=>N(Re=>({...Re,about:Ee.target.value})),rows:3,disabled:V})]})]}),o.jsx(S2,{documentName:(s==null?void 0:s.document_name)||null,documentUrl:(s==null?void 0:s.document_url)||null,isEditMode:!0,userId:n==null?void 0:n.id,cardId:s==null?void 0:s.id,isPremium:(a==null?void 0:a.plan)==="Orange",onUpdate:async Ee=>{s&&await l(s.id,Ee)}}),o.jsxs(fe,{variant:"gradient",className:"w-full font-medium tracking-tight",onClick:G,disabled:V,children:[o.jsx(an,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})}),o.jsx(Khe,{open:f,onClose:()=>g(!1),currentLayout:x,currentColor:b,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,name:Fe,designation:(s==null?void 0:s.designation)||"Professional",company:(s==null?void 0:s.company)||"Company",onSelect:Se}),E&&o.jsx(q7e,{open:_,onClose:()=>{T(!1),j(null)},imageFile:E,onSave:ve})]})}function iR(){if(Yt.isNativePlatform())return{isSupported:!1,isNative:!0,message:"NFC writing is not available in the app. Please use Chrome browser on Android to write NFC tags."};const t="NDEFReader"in window;return{isSupported:t,isNative:!1,message:t?void 0:"NFC is not supported on this browser. Please use Chrome on Android."}}async function aqe(e,t){const n=iR();if(!n.isSupported)return{success:!1,error:n.message||"NFC is not supported on this device"};try{const r=new NDEFReader,s=new TextEncoder().encode(t);return await r.write({records:[{recordType:"url",data:e},{recordType:"mime",mediaType:"text/vcard",data:s}]}),{success:!0}}catch(r){return console.error("NFC write error:",r),{success:!1,error:(r==null?void 0:r.message)||"Failed to write to NFC tag"}}}function sqe(e){const t=["BEGIN:VCARD","VERSION:3.0"];if(e.name){t.push(`FN:${e.name}`);const n=e.name.trim().split(" "),r=n.length>1?n.pop():"",a=n.join(" ");t.push(`N:${r};${a};;;`)}return e.company&&t.push(`ORG:${e.company}`),e.designation&&t.push(`TITLE:${e.designation}`),e.phone&&t.push(`TEL;TYPE=CELL:${e.phone}`),e.email&&t.push(`EMAIL:${e.email}`),e.url&&t.push(`URL:${e.url}`),t.push("END:VCARD"),t.join(`\r
`)}const iqe=[{id:"profile",icon:bl,label:"Profile",description:"View and edit your account",action:"navigate"},{id:"order-nfc",icon:Js,label:"Get your NFC Card",description:"Order a physical smart card",action:"navigate"},{id:"upgrade",icon:Js,label:"Upgrade Plan",description:"Access premium features",action:"navigate"},{id:"demo",icon:xY,label:"Features Demo",description:"How to use & FAQ",action:"navigate"},{id:"support",icon:gY,label:"Support",description:"Get help when you need it",action:"navigate"}];function oqe(){var Q;const e=za(),{theme:t,toggleTheme:n}=uO(),{signOut:r}=ir(),{profile:a,loading:s}=Ko(),{activeCard:i,loading:l}=uf(),[u,d]=k.useState(!1),[c,h]=k.useState(!1),[p,m]=k.useState(!1),[f,g]=k.useState(!1),[x,y]=k.useState(Fx()),[b,v]=k.useState(null),[w,N]=k.useState(localStorage.getItem("synka_biometric_enabled")==="true"),S=k.useRef(!0),C=((Q=a==null?void 0:a.plan)==null?void 0:Q.toLowerCase())==="orange",[_,T]=k.useState(""),[E,j]=k.useState(""),[I,D]=k.useState(""),[F,P]=k.useState(""),[V,$]=k.useState("");k.useEffect(()=>{const se=iR();h(se.isSupported),Yt.isNativePlatform()&&am().then(v)},[]),k.useEffect(()=>{u&&(T((i==null?void 0:i.full_name)||""),j((i==null?void 0:i.company)||""),D((i==null?void 0:i.designation)||""),P((i==null?void 0:i.phone)||(i==null?void 0:i.whatsapp)||""),$((i==null?void 0:i.email)||""))},[u,i]);const O=async()=>{await r(),oe({title:"Logged out",description:"See you next time!"}),e("/login",{replace:!0})},L=()=>{const se=!x;y(se),Gae(se),!se&&w&&(N(!1),localStorage.setItem("synka_biometric_enabled","false")),oe({title:se?"App Lock enabled":"App Lock disabled",description:se?"You will need to unlock the app when you open it.":"App will open directly without unlock."})},q=()=>{if(!x)return;const se=!w;N(se),localStorage.setItem("synka_biometric_enabled",String(se)),oe({title:se?"Biometric enabled":"Biometric disabled",description:se?"Use biometrics to unlock the app.":"PIN will be required to unlock."})},U=se=>{switch(se){case"profile":e("/settings/profile");break;case"order-nfc":e("/order-nfc-card");break;case"upgrade":e("/settings/upgrade");break;case"demo":e("/support");break;case"support":e("/contact");break}},ee=async()=>{const se=a==null?void 0:a.slug;if(!se){oe({title:"Public view missing",description:"Please set your public view slug in your profile before writing NFC.",variant:"destructive"});return}const Le=`${window.location.origin}/u/${se}`,Se=()=>{const ye=["BEGIN:VCARD","VERSION:3.0"];if(_){ye.push(`FN:${_}`);const Fe=_.trim().split(" "),Te=Fe.length>1?Fe.pop():"",Oe=Fe.join(" ");ye.push(`N:${Te};${Oe};;;`)}return E&&ye.push(`ORG:${E}`),I&&ye.push(`TITLE:${I}`),F&&ye.push(`TEL;TYPE=CELL:${F}`),V&&ye.push(`EMAIL:${V}`),ye.push(`URL:${Le}`),ye.push("END:VCARD"),ye.join(`\r
`)};if(!("NDEFReader"in window)){oe({title:"NFC not supported",description:"Your device or browser does not support NFC writing.",variant:"destructive"});return}m(!0);try{const ye=new NDEFReader,Fe=Se(),Oe=new TextEncoder().encode(Fe);await ye.write({records:[{recordType:"url",data:Le},{recordType:"mime",mediaType:"text/vcard",data:Oe}]}),oe({title:"NFC written successfully",description:"Profile URL and contact card saved to NFC tag."}),d(!1)}catch(ye){console.error("NFC write error:",ye),oe({title:"NFC write failed",description:(ye==null?void 0:ye.message)||"Make sure NFC is enabled and hold the tag close.",variant:"destructive"})}finally{m(!1)}},M=s||l,G=zw();cI();const J=(a==null?void 0:a.full_name)||(i==null?void 0:i.full_name)||G||"";k.useEffect(()=>{a!=null&&a.full_name?Zp(a.full_name):i!=null&&i.full_name&&Zp(i.full_name),a!=null&&a.email?Dc(a.email):i!=null&&i.email&&Dc(i.email)},[a==null?void 0:a.full_name,a==null?void 0:a.email,i==null?void 0:i.full_name,i==null?void 0:i.email]);const ve=se=>se?se.split(" ").filter(Boolean).map(_e=>_e[0]).join("").toUpperCase():"";return o.jsxs("div",{className:Ie("w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-4 sm:space-y-6 max-w-2xl mx-auto",!S.current&&"animate-fade-up"),children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Settings"}),o.jsx("p",{className:"text-muted-foreground",children:"Manage your account and preferences"})]}),o.jsx("button",{onClick:()=>e("/settings/profile"),className:"w-full p-6 rounded-2xl bg-card border border-border/50 card-hover text-left",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center overflow-hidden bg-muted",children:i!=null&&i.photo_url?o.jsx("img",{src:i.photo_url,alt:J,className:"w-full h-full object-cover",style:{objectPosition:`${(i==null?void 0:i.face_x)??50}% ${(i==null?void 0:i.face_y)??38}%`}}):o.jsx("span",{className:"text-2xl font-bold text-muted-foreground",children:ve(J)||"U"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[M&&!G?o.jsx("div",{className:"h-5 w-32 bg-muted rounded animate-pulse"}):o.jsxs("h2",{className:"text-lg font-semibold text-foreground truncate",children:["Hi ",J||"there"]}),(a==null?void 0:a.plan)==="Orange"&&o.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mt-1 rounded-full text-xs font-semibold text-white",style:{backgroundColor:"#F26B4F"},children:"Orange"})]}),o.jsx(Hx,{className:"h-5 w-5 text-muted-foreground"})]})}),o.jsx("div",{className:"p-4 rounded-2xl bg-card border border-border/50",children:o.jsxs("button",{onClick:n,className:"flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:t==="light"?o.jsx(P3,{className:"h-5 w-5 text-amber-500"}):o.jsx(j3,{className:"h-5 w-5 text-violet-500"})}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:"font-medium text-foreground",children:"Appearance"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:t==="light"?"Light mode":"Dark mode"})]})]}),o.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",t==="dark"?"bg-primary":"bg-muted"),children:o.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",t==="dark"&&"translate-x-5")})})]})}),o.jsx("div",{className:"space-y-2",children:iqe.map((se,_e)=>o.jsxs("button",{onClick:()=>U(se.id),className:Ie("w-full p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4 card-hover text-left"),children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:o.jsx(se.icon,{className:"h-5 w-5 text-foreground"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-foreground",children:se.label}),o.jsx("p",{className:"text-sm text-muted-foreground",children:se.description})]}),o.jsx(Hx,{className:"h-5 w-5 text-muted-foreground"})]},se.id))}),Yt.isNativePlatform()&&o.jsx("div",{className:"p-4 rounded-2xl bg-card border border-border/50",children:o.jsxs("button",{onClick:L,className:"flex items-center justify-between w-full",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:o.jsx(yl,{className:"h-5 w-5 text-foreground"})}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:"font-medium text-foreground",children:"App Lock"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:x?w?"Biometric or PIN on open":"PIN required on open":"Opens directly"})]})]}),o.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",x?"bg-primary":"bg-muted"),children:o.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",x&&"translate-x-5")})})]})}),Yt.isNativePlatform()&&(b==null?void 0:b.available)&&o.jsx("div",{className:Ie("p-4 rounded-2xl bg-card border border-border/50 -mt-2",!x&&"opacity-50"),children:o.jsxs("button",{onClick:q,disabled:!x,className:"flex items-center justify-between w-full disabled:cursor-not-allowed",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:o.jsx(dw,{className:Ie("h-5 w-5",x?"text-foreground":"text-muted-foreground")})}),o.jsxs("div",{className:"text-left",children:[o.jsx("p",{className:Ie("font-medium",x?"text-foreground":"text-muted-foreground"),children:"Biometric Unlock"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:x?`Use ${Lw(b.biometryType)} to unlock`:"Enable App Lock first"})]})]}),o.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",w&&x?"bg-primary":"bg-muted"),children:o.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",w&&x&&"translate-x-5")})})]})}),o.jsxs("div",{className:"p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4 card-hover",children:[o.jsxs("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center relative",children:[o.jsx(IS,{className:"h-5 w-5 text-foreground"}),!C&&o.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:o.jsx(yl,{className:"h-2.5 w-2.5 text-white"})})]}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-foreground",children:"NFC Writer"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Write your public view slug & offline data to NFC tags"})]}),o.jsx("div",{children:o.jsx(fe,{variant:"ghost",onClick:()=>{C?d(!0):g(!0)},children:C?"Open":o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(yl,{className:"h-3 w-3"}),"Open"]})})})]}),o.jsx(gn,{open:f,onOpenChange:g,children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center",children:o.jsx(yl,{className:"h-5 w-5 text-orange-500"})}),o.jsx("span",{children:"Orange Feature"})]})}),o.jsxs("div",{className:"space-y-4 py-2",children:[o.jsx("p",{className:"text-muted-foreground",children:"NFC Writing is a premium feature available exclusively for Orange plan users. Upgrade now to unlock this and many other powerful features!"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>g(!1),children:"Maybe Later"}),o.jsx(fe,{className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>{g(!1),e("/settings/upgrade")},children:"Upgrade Now"})]})]})]})}),o.jsxs("button",{onClick:O,className:"w-full p-4 rounded-2xl bg-destructive/10 border border-destructive/20 flex items-center gap-4 hover:bg-destructive/20 transition-colors",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:o.jsx(E3,{className:"h-5 w-5 text-destructive"})}),o.jsxs("div",{className:"flex-1 text-left",children:[o.jsx("p",{className:"font-medium text-destructive",children:"Logout"}),o.jsx("p",{className:"text-sm text-destructive/70",children:"Sign out of your account"})]})]}),o.jsx("p",{className:"text-center text-sm text-muted-foreground pt-6",children:"Synka v1.0.0"}),o.jsx(gn,{open:u,onOpenChange:d,children:o.jsxs(cn,{className:"max-w-md",children:[o.jsx(dn,{children:o.jsx(hn,{children:"NFC Writer - Confirm & Edit"})}),o.jsxs("div",{className:"space-y-4 py-4",children:[!c&&o.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:o.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:Yt.isNativePlatform()?"NFC writing requires Chrome browser on Android. Please open synka.in in Chrome to write NFC tags.":"NFC is not supported on this device/browser. Please use Chrome on Android."})}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Name"}),o.jsx(Ge,{value:_,onChange:se=>T(se.target.value)})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Company"}),o.jsx(Ge,{value:E,onChange:se=>j(se.target.value)})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Designation"}),o.jsx(Ge,{value:I,onChange:se=>D(se.target.value)})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Phone"}),o.jsx(Ge,{value:F,onChange:se=>P(se.target.value)})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Email"}),o.jsx(Ge,{value:V,onChange:se=>$(se.target.value)})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>d(!1),disabled:p,children:"Cancel"}),o.jsx(fe,{variant:"gradient",className:"flex-1",onClick:ee,disabled:!c||p,children:p?"Waiting for tag...":"Write to NFC"})]})]})]})})]})}var oR="Radio",[lqe,eK]=qo(oR),[uqe,cqe]=lqe(oR),tK=k.forwardRef((e,t)=>{const{__scopeRadio:n,name:r,checked:a=!1,required:s,disabled:i,value:l="on",onCheck:u,form:d,...c}=e,[h,p]=k.useState(null),m=sr(t,x=>p(x)),f=k.useRef(!1),g=h?d||!!h.closest("form"):!0;return o.jsxs(uqe,{scope:n,checked:a,disabled:i,children:[o.jsx(An.button,{type:"button",role:"radio","aria-checked":a,"data-state":sK(a),"data-disabled":i?"":void 0,disabled:i,value:l,...c,ref:m,onClick:yn(e.onClick,x=>{a||u==null||u(),g&&(f.current=x.isPropagationStopped(),f.current||x.stopPropagation())})}),g&&o.jsx(aK,{control:h,bubbles:!f.current,name:r,value:l,checked:a,required:s,disabled:i,form:d,style:{transform:"translateX(-100%)"}})]})});tK.displayName=oR;var nK="RadioIndicator",rK=k.forwardRef((e,t)=>{const{__scopeRadio:n,forceMount:r,...a}=e,s=cqe(nK,n);return o.jsx(Al,{present:r||s.checked,children:o.jsx(An.span,{"data-state":sK(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:t})})});rK.displayName=nK;var dqe="RadioBubbleInput",aK=k.forwardRef(({__scopeRadio:e,control:t,checked:n,bubbles:r=!0,...a},s)=>{const i=k.useRef(null),l=sr(i,s),u=K0(n),d=r_(t);return k.useEffect(()=>{const c=i.current;if(!c)return;const h=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(h,"checked").set;if(u!==n&&m){const f=new Event("click",{bubbles:r});m.call(c,n),c.dispatchEvent(f)}},[u,n,r]),o.jsx(An.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:l,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});aK.displayName=dqe;function sK(e){return e?"checked":"unchecked"}var hqe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$N="RadioGroup",[pqe]=qo($N,[p3,eK]),iK=p3(),oK=eK(),[mqe,fqe]=pqe($N),lK=k.forwardRef((e,t)=>{const{__scopeRadioGroup:n,name:r,defaultValue:a,value:s,required:i=!1,disabled:l=!1,orientation:u,dir:d,loop:c=!0,onValueChange:h,...p}=e,m=iK(n),f=F0(d),[g,x]=Sl({prop:s,defaultProp:a??null,onChange:h,caller:$N});return o.jsx(mqe,{scope:n,name:r,required:i,disabled:l,value:g,onValueChange:x,children:o.jsx(qK,{asChild:!0,...m,orientation:u,dir:f,loop:c,children:o.jsx(An.div,{role:"radiogroup","aria-required":i,"aria-orientation":u,"data-disabled":l?"":void 0,dir:f,...p,ref:t})})})});lK.displayName=$N;var uK="RadioGroupItem",cK=k.forwardRef((e,t)=>{const{__scopeRadioGroup:n,disabled:r,...a}=e,s=fqe(uK,n),i=s.disabled||r,l=iK(n),u=oK(n),d=k.useRef(null),c=sr(t,d),h=s.value===a.value,p=k.useRef(!1);return k.useEffect(()=>{const m=g=>{hqe.includes(g.key)&&(p.current=!0)},f=()=>p.current=!1;return document.addEventListener("keydown",m),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",m),document.removeEventListener("keyup",f)}},[]),o.jsx(KK,{asChild:!0,...l,focusable:!i,active:h,children:o.jsx(tK,{disabled:i,required:s.required,checked:h,...u,...a,name:s.name,ref:c,onCheck:()=>s.onValueChange(a.value),onKeyDown:yn(m=>{m.key==="Enter"&&m.preventDefault()}),onFocus:yn(a.onFocus,()=>{var m;p.current&&((m=d.current)==null||m.click())})})})});cK.displayName=uK;var gqe="RadioGroupIndicator",dK=k.forwardRef((e,t)=>{const{__scopeRadioGroup:n,...r}=e,a=oK(n);return o.jsx(rK,{...a,...r,ref:t})});dK.displayName=gqe;var hK=lK,pK=cK,xqe=dK;const mK=k.forwardRef(({className:e,...t},n)=>o.jsx(hK,{className:Ie("grid gap-2",e),...t,ref:n}));mK.displayName=hK.displayName;const fK=k.forwardRef(({className:e,...t},n)=>o.jsx(pK,{ref:n,className:Ie("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:o.jsx(xqe,{className:"flex items-center justify-center",children:o.jsx(S3,{className:"h-2.5 w-2.5 fill-current text-current"})})}));fK.displayName=pK.displayName;const Rc=()=>Yt.isNativePlatform(),vS=()=>Rc()?"synka://payment/callback":window.location.origin;function gK(){const[e,t]=k.useState(!1),n=k.useCallback(()=>new Promise(s=>{if(window.Razorpay){s(!0);return}const i=document.createElement("script");i.src="https://checkout.razorpay.com/v1/checkout.js",i.onload=()=>s(!0),i.onerror=()=>s(!1),document.body.appendChild(i)}),[]),r=k.useCallback(async s=>{var i;t(!0);try{if(!await n())throw new Error("Failed to load Razorpay SDK");const{data:{session:u}}=await le.auth.getSession();if(!u)throw new Error("Please login to continue");const d=await le.functions.invoke("create-order",{body:{product_type:s.product_type,amount:s.amount,quantity:s.quantity||1,card_variant:s.card_variant}});if(d.error)throw new Error(d.error.message||"Failed to create order");const{order:c,prefill:h,key_id:p}=d.data,m={key:p,amount:c.amount,currency:c.currency,name:"Synka",description:`Order: ${c.order_number}`,order_id:c.razorpay_order_id,prefill:{name:h.name,email:h.email,contact:h.contact},config:{display:{hide:[{method:"wallet"}],preferences:{show_default_blocks:!0}}},theme:{color:"#F97316"},...Rc()&&{callback_url:vS(),redirect:!1},handler:async g=>{var x,y;try{const b=await le.functions.invoke("verify-payment",{body:{razorpay_order_id:g.razorpay_order_id,razorpay_payment_id:g.razorpay_payment_id,razorpay_signature:g.razorpay_signature,type:"order"}});if(b.error)throw new Error("Payment verification failed");yt.success("Payment successful!"),(x=s.onSuccess)==null||x.call(s,b.data)}catch(b){console.error("Payment verification error:",b),yt.error("Payment verification failed. Please contact support."),(y=s.onFailure)==null||y.call(s,b)}},modal:{ondismiss:()=>{t(!1),yt.info("Payment cancelled")},escape:!Rc(),backdropclose:!1}},f=new window.Razorpay(m);f.on("payment.failed",async g=>{var x,y,b;console.error("Payment failed:",g.error),yt.error(g.error.description||"Payment failed");try{await le.from("orders").update({status:"payment_failed",updated_at:new Date().toISOString()}).eq("razorpay_order_id",c.razorpay_order_id),await le.from("payments").insert({user_id:u.user.id,order_id:c.id,razorpay_order_id:c.razorpay_order_id,amount:c.amount/100,status:"failed",error_code:(x=g.error)==null?void 0:x.code,error_description:(y=g.error)==null?void 0:y.description})}catch(v){console.error("Failed to update order status:",v)}(b=s.onFailure)==null||b.call(s,g.error),t(!1)}),f.open()}catch(l){console.error("Payment initiation error:",l),yt.error(l.message||"Failed to initiate payment"),(i=s.onFailure)==null||i.call(s,l)}finally{t(!1)}},[n]),a=k.useCallback(async s=>{var i;t(!0);try{if(!await n())throw new Error("Failed to load Razorpay SDK");const{data:{session:u}}=await le.auth.getSession();if(!u)throw new Error("Please login to continue");const d=await le.functions.invoke("create-subscription",{body:{plan_type:s.plan_type}});if(d.error)throw new Error(d.error.message||"Failed to create subscription");const{subscription:c,prefill:h,key_id:p,use_subscription_api:m}=d.data;let f;m&&c.razorpay_subscription_id?f={key:p,subscription_id:c.razorpay_subscription_id,name:"Synka",description:`Orange Plan - ${s.plan_type==="annually"?"Annual":"Monthly"} (Auto-renewal)`,prefill:{name:h.name,email:h.email,contact:h.contact},theme:{color:"#F97316"},recurring_token:{max_amount:s.plan_type==="annually"?199900:29900,expire_by:Math.floor(Date.now()/1e3)+365*24*60*60},...Rc()&&{callback_url:vS(),redirect:!1},handler:async x=>{var y,b;try{const v=await le.functions.invoke("verify-payment",{body:{razorpay_subscription_id:x.razorpay_subscription_id,razorpay_payment_id:x.razorpay_payment_id,razorpay_signature:x.razorpay_signature,type:"subscription",subscription_id:c.id}});if(v.error)throw new Error("Payment verification failed");yt.success("Subscription activated with auto-renewal! Welcome to Orange!"),(y=s.onSuccess)==null||y.call(s,v.data)}catch(v){console.error("Payment verification error:",v),yt.error("Payment verification failed. Please contact support."),(b=s.onFailure)==null||b.call(s,v)}},modal:{ondismiss:()=>{t(!1),yt.info("Payment cancelled")},escape:!Rc(),backdropclose:!1}}:f={key:p,amount:c.amount,currency:c.currency,name:"Synka",description:`Orange Plan - ${s.plan_type==="annually"?"Annual":"Monthly"}`,order_id:c.razorpay_order_id,prefill:{name:h.name,email:h.email,contact:h.contact},config:{display:{hide:[{method:"wallet"}],preferences:{show_default_blocks:!0}}},theme:{color:"#F97316"},...Rc()&&{callback_url:vS(),redirect:!1},handler:async x=>{var y,b;try{const v=await le.functions.invoke("verify-payment",{body:{razorpay_order_id:x.razorpay_order_id,razorpay_payment_id:x.razorpay_payment_id,razorpay_signature:x.razorpay_signature,type:"subscription",subscription_id:c.id}});if(v.error)throw new Error("Payment verification failed");yt.success("Subscription activated! Welcome to Orange!"),(y=s.onSuccess)==null||y.call(s,v.data)}catch(v){console.error("Payment verification error:",v),yt.error("Payment verification failed. Please contact support."),(b=s.onFailure)==null||b.call(s,v)}},modal:{ondismiss:()=>{t(!1),yt.info("Payment cancelled")},escape:!Rc(),backdropclose:!1}};const g=new window.Razorpay(f);g.on("payment.failed",x=>{var y;console.error("Payment failed:",x.error),yt.error(x.error.description||"Payment failed"),(y=s.onFailure)==null||y.call(s,x.error),t(!1)}),g.open()}catch(l){console.error("Subscription initiation error:",l),yt.error(l.message||"Failed to initiate subscription"),(i=s.onFailure)==null||i.call(s,l)}finally{t(!1)}},[n]);return{loading:e,initiatePayment:r,initiateSubscription:a}}const cx=[{id:"pvc",name:"NFC Business Card",price:499,priceDisplay:"499",description:"Smart. Simple. Everyday use.",features:["Tap to share (NFC + QR)","Lightweight PVC card","Matte or Glossy finish","Water resistant","Free replacement*"],popular:!1},{id:"metal",name:"Metal NFC Card",price:1499,priceDisplay:"1,499",description:"Designed to impress. Built to last.",features:["Tap to share (NFC + QR)","Solid metal body","Precision laser engraving","Priority delivery","Lifetime durability","Free replacement*"],popular:!0}],dx=[{id:"metal-gold",name:"Metal Gold",type:"metal",image:"/images/card/metal-nfc-card-gold.jpeg"},{id:"metal-rose-gold",name:"Metal Rose Gold",type:"metal",image:"/images/card/metal-nfc-card-rose-gold.jpeg"},{id:"metal-silver",name:"Metal Silver",type:"metal",image:"/images/card/metal-nfc-card-silver.jpeg"},{id:"metal-black",name:"Metal Black",type:"metal",image:"/images/card/metal-nfc-card-black.jpeg"},{id:"metal-unsure",name:"Not Sure - We'll Suggest Best",type:"metal",image:"/images/card/metal-nfc-business-cards.jpeg"},{id:"nfc-white-gloss",name:"NFC White Gloss",type:"pvc",image:"/images/card/pvc-nfc-card-white-gloss.jpeg",hint:"Any color can be printed on white"},{id:"nfc-black-matt",name:"NFC Black Matt",type:"pvc",image:"/images/card/pvc-nfc-card-black-matt.jpeg"},{id:"nfc-black-gloss",name:"NFC Black Gloss",type:"pvc",image:"/images/card/pvc-nfc-card-black-gloss.jpeg"}],yqe=e=>e==="paid"?{label:"Paid - Processing",color:"default",icon:""}:e==="payment_failed"?{label:"Payment Failed",color:"destructive",icon:""}:e==="pending"||e==="created"?{label:"Pending Payment",color:"secondary",icon:""}:e==="Placed"?{label:"Order Placed",color:"default",icon:""}:e==="Approved"?{label:"Approved",color:"default",icon:""}:e==="Dispatched"?{label:"Dispatched",color:"default",icon:""}:e==="Done"?{label:"Delivered",color:"default",icon:""}:e==="NA"?{label:"Cancelled",color:"destructive",icon:""}:{label:e,color:"outline",icon:""};function bqe(){var $,O,L,q,U,ee;const e=za(),{user:t,loading:n}=ir(),{activeCard:r,cards:a,loading:s}=uf(),{profile:i}=Ko(),{initiatePayment:l}=gK(),[u,d]=k.useState("pvc"),[c,h]=k.useState("nfc-white-gloss"),[p,m]=k.useState(1),[f,g]=k.useState([]),[x,y]=k.useState(!0),[b,v]=k.useState(!1),[w,N]=k.useState(!1),[S,C]=k.useState(!1),[_,T]=k.useState(null),[E,j]=k.useState({name:"",phone:"",address:"",pincode:""}),I=!s&&a.length===0,D=dx.filter(M=>M.type===u);k.useEffect(()=>{const M=dx.find(G=>G.type===u);M&&h(M.id)},[u]),k.useEffect(()=>{if(!t)return;const M=async()=>{y(!0);const{data:J,error:ve}=await le.from("orders").select("id, order_number, product_type, quantity, amount, status, created_at").eq("user_id",t.id).order("created_at",{ascending:!1});!ve&&J&&g(J),y(!1)};M();const G=le.channel("user-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`user_id=eq.${t.id}`},()=>{M()}).subscribe();return()=>{le.removeChannel(G)}},[t]),k.useEffect(()=>{(r||i)&&j(M=>({...M,name:(r==null?void 0:r.full_name)||(i==null?void 0:i.full_name)||M.name,phone:(r==null?void 0:r.phone)||(i==null?void 0:i.phone)||M.phone}))},[r,i]),k.useEffect(()=>{!n&&!t&&e("/login")},[t,n,e]);const F=async M=>{if(M.preventDefault(),!t)return;if(!E.name||!E.phone||!E.address||!E.pincode){oe({title:"Missing information",description:"Please fill in all shipping details.",variant:"destructive"});return}v(!0);const G=cx.find(Q=>Q.id===u),J=((G==null?void 0:G.price)||0)*p;l({product_type:u==="pvc"?"pvc":"metal",amount:J,quantity:p,card_variant:c,onSuccess:Q=>{v(!1),N(!0),C(!1),T(null)},onFailure:Q=>{v(!1),C(!0),T((Q==null?void 0:Q.message)||"Could not process payment. Please try again.")}})},P=()=>{C(!1),T(null)},V=()=>{N(!1),m(1),d("pvc"),h("nfc-white-gloss")};return n||s?o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):S?o.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-2xl mx-auto animate-fade-up",children:o.jsx(xn,{className:"border-destructive/20 bg-gradient-to-b from-destructive/5 to-transparent",children:o.jsxs(wn,{className:"pt-8 pb-8 text-center space-y-6",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-destructive/10 flex items-center justify-center",children:o.jsx(ki,{className:"h-10 w-10 text-destructive"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Payment Failed"}),o.jsx("p",{className:"text-muted-foreground",children:_||"Your payment could not be processed. Please try again."})]}),o.jsxs("div",{className:"bg-muted/50 rounded-xl p-6 text-left space-y-3",children:[o.jsx("h3",{className:"font-semibold text-foreground",children:"What you can do:"}),o.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-primary"}),"Check your payment details and try again"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-primary"}),"Ensure sufficient balance in your account"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-primary"}),"Try a different payment method"]})]})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>e("/dashboard"),children:"Go to Dashboard"}),o.jsxs(fe,{variant:"gradient",className:"flex-1",onClick:P,children:[o.jsx(B0,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})]})})}):w?o.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-2xl mx-auto animate-fade-up",children:o.jsx(xn,{className:"border-primary/20 bg-gradient-to-b from-primary/5 to-transparent",children:o.jsxs(wn,{className:"pt-8 pb-8 text-center space-y-6",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(R3,{className:"h-10 w-10 text-primary"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:" Order Received!"}),o.jsx("p",{className:"text-muted-foreground",children:"Thank you for your order"})]}),o.jsxs("div",{className:"bg-muted/50 rounded-xl p-6 text-left space-y-4",children:[o.jsx("h3",{className:"font-semibold text-foreground",children:"What happens next?"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:o.jsx(ja,{className:"h-4 w-4 text-primary"})}),o.jsx("div",{children:o.jsx("p",{className:"font-medium text-foreground",children:"Our team will contact you within 24 hours"})})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:o.jsx(A3,{className:"h-4 w-4 text-primary"})}),o.jsx("div",{children:o.jsx("p",{className:"font-medium text-foreground",children:"You'll receive card design options created by AI"})})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:o.jsx(k3,{className:"h-4 w-4 text-primary"})}),o.jsx("div",{children:o.jsx("p",{className:"font-medium text-foreground",children:"Review & approve design"})})]}),o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:o.jsx(AY,{className:"h-4 w-4 text-primary"})}),o.jsx("div",{children:o.jsx("p",{className:"font-medium text-foreground",children:"We print & dispatch your card"})})]})]}),o.jsx("div",{className:"pt-2 border-t border-border",children:o.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",o.jsx("span",{className:"font-medium",children:"Estimated delivery:"})," 57 business days after approval"]})})]}),o.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>e("/dashboard"),children:"Go to Dashboard"}),o.jsx(fe,{variant:"gradient",className:"flex-1",onClick:V,children:"Place Another Order"})]})]})})}):o.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-4xl mx-auto animate-fade-up",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:o.jsx(td,{className:"h-5 w-5"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Order NFC Card"}),o.jsx("p",{className:"text-muted-foreground",children:"Get your physical smart business card"})]})]}),!x&&f.length>0&&o.jsxs(xn,{className:"mb-8",children:[o.jsxs(Fn,{children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Bv,{className:"h-5 w-5 text-primary"}),o.jsx(Pn,{className:"text-lg",children:"Your Orders"})]}),o.jsx(gi,{children:"Track your NFC card orders"})]}),o.jsx(wn,{children:o.jsx("div",{className:"space-y-3",children:f.map(M=>{const G=yqe(M.status);return o.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border bg-muted/30",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"font-mono font-semibold text-sm",children:M.order_number}),o.jsx(nt,{variant:"outline",className:"uppercase text-xs",children:M.product_type==="pvc"?"PVC Card":"Metal Card"})]}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",M.quantity,"  ",Number(M.amount).toLocaleString()]})]}),o.jsxs(nt,{variant:G.color,children:[G.icon," ",G.label]})]},M.id)})})})]}),x&&o.jsx("div",{className:"flex items-center justify-center py-8 mb-8",children:o.jsx(Gt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),I&&o.jsxs("div",{className:"mb-6 p-4 rounded-xl bg-primary/10 border border-primary/20 flex items-start gap-3",children:[o.jsx(Hs,{className:"h-5 w-5 text-primary mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Welcome to Synka!"}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Order your NFC card and your digital card will be created instantly. You can customize it anytime from the My Card section."})]})]}),o.jsxs("form",{onSubmit:F,className:"space-y-8",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h2",{className:"text-lg font-semibold",children:"Select Card Type"}),o.jsx(mK,{value:u,onValueChange:d,className:"grid md:grid-cols-2 gap-4",children:cx.map(M=>o.jsxs(We,{htmlFor:M.id,className:Ie("relative flex flex-col p-6 rounded-2xl border-2 cursor-pointer transition-all",u===M.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[o.jsx(fK,{value:M.id,id:M.id,className:"sr-only"}),M.popular&&o.jsx("span",{className:"absolute -top-3 left-4 px-3 py-1 bg-primary text-primary-foreground text-xs font-medium rounded-full",children:"Popular"}),o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"font-semibold text-lg",children:M.name}),o.jsx("p",{className:"text-sm text-muted-foreground",children:M.description})]}),o.jsx("div",{className:"text-right",children:o.jsx("p",{className:"text-2xl font-bold text-primary",children:M.priceDisplay})})]}),o.jsx("ul",{className:"space-y-2",children:M.features.map((G,J)=>o.jsxs("li",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[o.jsx(an,{className:"h-4 w-4 text-primary"}),G]},J))}),u===M.id&&o.jsx("div",{className:"absolute top-4 right-4",children:o.jsx("div",{className:"w-6 h-6 rounded-full bg-primary flex items-center justify-center",children:o.jsx(an,{className:"h-4 w-4 text-primary-foreground"})})})]},M.id))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"card-variant",children:"Select Card Finish"}),o.jsxs(_a,{value:c,onValueChange:h,children:[o.jsx(ha,{className:"w-full",children:o.jsx(Ia,{placeholder:"Select a card variant",children:c&&o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("img",{src:($=dx.find(M=>M.id===c))==null?void 0:$.image,alt:"",className:"w-10 h-6 object-cover rounded"}),o.jsx("span",{children:(O=dx.find(M=>M.id===c))==null?void 0:O.name})]})})}),o.jsx(pa,{children:D.map(M=>o.jsx(Nt,{value:M.id,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("img",{src:M.image,alt:M.name,className:"w-12 h-8 object-cover rounded"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{children:M.name}),"hint"in M&&M.hint&&o.jsx("span",{className:"text-xs text-muted-foreground",children:M.hint})]})]})},M.id))})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Our team will contact you to collect logo, design preferences & branding details."}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[o.jsx("span",{className:"font-medium",children:"AI Designs Your Card"}),"  Our team checks and recommends  You approve  Final approval  Print  Dispatch"]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"quantity",children:"Quantity"}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(fe,{type:"button",variant:"outline",size:"icon",onClick:()=>m(Math.max(1,p-1)),children:"-"}),o.jsx(Ge,{id:"quantity",type:"number",min:"1",max:"10",value:p,onChange:M=>m(Math.max(1,parseInt(M.target.value)||1)),className:"w-20 text-center"}),o.jsx(fe,{type:"button",variant:"outline",size:"icon",onClick:()=>m(Math.min(10,p+1)),children:"+"})]})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{children:[o.jsx(Pn,{className:"text-lg",children:"Shipping Address"}),o.jsx(gi,{children:"Where should we deliver your card?"})]}),o.jsxs(wn,{className:"space-y-4",children:[o.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"name",children:"Full Name"}),o.jsx(Ge,{id:"name",value:E.name,onChange:M=>j({...E,name:M.target.value}),required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"phone",children:"Phone Number"}),o.jsx(Ge,{id:"phone",type:"tel",value:E.phone,onChange:M=>j({...E,phone:M.target.value}),required:!0})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"address",children:"Address"}),o.jsx(Ge,{id:"address",value:E.address,onChange:M=>j({...E,address:M.target.value}),placeholder:"House/Flat No., Street, Locality, City, State",required:!0})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"pincode",children:"Pincode"}),o.jsx(Ge,{id:"pincode",value:E.pincode,onChange:M=>j({...E,pincode:M.target.value}),placeholder:"6-digit pincode",maxLength:6,required:!0})]})]})]}),o.jsxs(xn,{children:[o.jsx(Fn,{children:o.jsx(Pn,{className:"text-lg",children:"Order Summary"})}),o.jsx(wn,{children:o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsxs("span",{className:"text-muted-foreground",children:[(L=cx.find(M=>M.id===u))==null?void 0:L.name,"  ",p]}),o.jsx("span",{className:"font-medium",children:(q=cx.find(M=>M.id===u))==null?void 0:q.priceDisplay})]}),o.jsx("div",{className:"flex justify-between text-sm",children:o.jsxs("span",{className:"text-muted-foreground",children:["Variant: ",(U=dx.find(M=>M.id===c))==null?void 0:U.name]})}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),o.jsx("span",{className:"font-medium text-primary",children:"Free"})]}),o.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[o.jsx("span",{className:"font-semibold",children:"Total"}),o.jsxs("span",{className:"font-bold text-lg",children:["",((((ee=cx.find(M=>M.id===u))==null?void 0:ee.price)||0)*p).toLocaleString()]})]})]})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs(fe,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:b,children:[b?o.jsx(Gt,{className:"h-5 w-5 mr-2 animate-spin"}):o.jsx(Js,{className:"h-5 w-5 mr-2"}),b?"Placing Order...":"Place Order"]}),o.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(an,{className:"h-3 w-3 text-primary"}),"Design approval before printing"]}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(an,{className:"h-3 w-3 text-primary"}),"Free replacement available*"]}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(TY,{className:"h-3 w-3 text-primary"}),"Secure payment"]})]})]})]})]})}const Cy=YK,nf=k.forwardRef(({className:e,...t},n)=>o.jsx(m3,{ref:n,className:Ie("inline-flex h-10 items-center justify-center rounded-xl bg-secondary p-1 text-muted-foreground",e),...t}));nf.displayName=m3.displayName;const $n=k.forwardRef(({className:e,...t},n)=>o.jsx(f3,{ref:n,className:Ie("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-card data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));$n.displayName=f3.displayName;const $a=k.forwardRef(({className:e,...t},n)=>o.jsx(g3,{ref:n,className:Ie("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));$a.displayName=g3.displayName;const Ri=k.forwardRef(({className:e,...t},n)=>o.jsx("div",{className:"relative w-full overflow-auto",children:o.jsx("table",{ref:n,className:Ie("w-full caption-bottom text-sm",e),...t})}));Ri.displayName="Table";const Di=k.forwardRef(({className:e,...t},n)=>o.jsx("thead",{ref:n,className:Ie("[&_tr]:border-b",e),...t}));Di.displayName="TableHeader";const Mi=k.forwardRef(({className:e,...t},n)=>o.jsx("tbody",{ref:n,className:Ie("[&_tr:last-child]:border-0",e),...t}));Mi.displayName="TableBody";const vqe=k.forwardRef(({className:e,...t},n)=>o.jsx("tfoot",{ref:n,className:Ie("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));vqe.displayName="TableFooter";const Un=k.forwardRef(({className:e,...t},n)=>o.jsx("tr",{ref:n,className:Ie("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Un.displayName="TableRow";const rt=k.forwardRef(({className:e,...t},n)=>o.jsx("th",{ref:n,className:Ie("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));rt.displayName="TableHead";const Ze=k.forwardRef(({className:e,...t},n)=>o.jsx("td",{ref:n,className:Ie("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Ze.displayName="TableCell";const wqe=k.forwardRef(({className:e,...t},n)=>o.jsx("caption",{ref:n,className:Ie("mt-4 text-sm text-muted-foreground",e),...t}));wqe.displayName="TableCaption";function Nqe(){const{isAdmin:e,loading:t,users:n,fetchUsers:r,upgradeUserPlan:a,downgradeUserPlan:s}=oo(),[i,l]=k.useState(!0),[u,d]=k.useState(""),[c,h]=k.useState(null),[p,m]=k.useState(null),f=k.useRef(null);k.useEffect(()=>{if(t)return;if(!e){l(!1);return}const v=async()=>{l(!0);try{await r()}finally{l(!1)}},w=()=>{f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{r()},300)};v();const N=le.channel("admin-profiles-changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},w).subscribe();return()=>{f.current&&window.clearTimeout(f.current),le.removeChannel(N)}},[t,e,r]);const g=(v,w)=>{m({type:"upgrade",userId:v,userName:w})},x=(v,w)=>{m({type:"downgrade",userId:v,userName:w})},y=async()=>{if(p){h(p.userId);try{p.type==="upgrade"?(await a(p.userId,"Orange"),yt.success(`${p.userName||"User"} upgraded to Orange plan`)):(await s(p.userId),yt.success(`${p.userName||"User"} downgraded to Free plan`))}catch{yt.error(`Failed to ${p.type} user`)}finally{h(null),m(null)}}},b=n.filter(v=>{var w,N,S;return((w=v.full_name)==null?void 0:w.toLowerCase().includes(u.toLowerCase()))||((N=v.email)==null?void 0:N.toLowerCase().includes(u.toLowerCase()))||((S=v.phone)==null?void 0:S.includes(u))});return i?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative flex-1 max-w-sm",children:[o.jsx(dd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),o.jsx(Ge,{placeholder:"Search users...",value:u,onChange:v=>d(v.target.value),className:"pl-10"})]}),o.jsxs(nt,{variant:"secondary",children:[n.length," users"]})]}),o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"Name"}),o.jsx(rt,{children:"Email"}),o.jsx(rt,{children:"Mobile"}),o.jsx(rt,{children:"Plan"}),o.jsx(rt,{children:"Role"}),o.jsx(rt,{children:"Signup Date"}),o.jsx(rt,{children:"Actions"})]})}),o.jsx(Mi,{children:b.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):b.map(v=>o.jsxs(Un,{children:[o.jsx(Ze,{className:"font-medium",children:v.full_name||"N/A"}),o.jsx(Ze,{children:v.email||"N/A"}),o.jsx(Ze,{children:v.phone||"N/A"}),o.jsx(Ze,{children:o.jsx(nt,{variant:v.plan==="Orange"?"default":"secondary",children:v.plan})}),o.jsx(Ze,{children:o.jsx(nt,{variant:v.role==="admin"?"destructive":"outline",children:v.role})}),o.jsx(Ze,{children:hr(new Date(v.created_at),"MMM d, yyyy")}),o.jsx(Ze,{children:v.role!=="admin"&&o.jsx(o.Fragment,{children:v.plan==="Free"?o.jsx(fe,{size:"sm",onClick:()=>g(v.user_id,v.full_name||"User"),disabled:c===v.user_id,children:c===v.user_id?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(fY,{className:"h-4 w-4 mr-1"}),"Upgrade"]})}):o.jsx(fe,{size:"sm",variant:"outline",onClick:()=>x(v.user_id,v.full_name||"User"),disabled:c===v.user_id,children:c===v.user_id?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsxs(o.Fragment,{children:[o.jsx(mY,{className:"h-4 w-4 mr-1"}),"Downgrade"]})})})})]},v.id))})]})})]}),o.jsx(_m,{open:!!p,onOpenChange:v=>!v&&m(null),children:o.jsxs(md,{children:[o.jsxs(fd,{children:[o.jsx(xd,{children:(p==null?void 0:p.type)==="upgrade"?"Upgrade User Plan":"Downgrade User Plan"}),o.jsx(yd,{children:(p==null?void 0:p.type)==="upgrade"?o.jsxs(o.Fragment,{children:["Are you sure you want to upgrade ",o.jsx("strong",{children:p==null?void 0:p.userName})," to the ",o.jsx("strong",{children:"Orange"})," plan?"]}):o.jsxs(o.Fragment,{children:["Are you sure you want to downgrade ",o.jsx("strong",{children:p==null?void 0:p.userName})," to the ",o.jsx("strong",{children:"Free"})," plan?"]})})]}),o.jsxs(gd,{children:[o.jsx(vd,{children:"Cancel"}),o.jsx(bd,{onClick:y,children:(p==null?void 0:p.type)==="upgrade"?"Yes, Upgrade":"Yes, Downgrade"})]})]})})]})}const kqe=e=>e==="paid"||e==="Placed"||e==="Approved"||e==="Dispatched"||e==="Done"?o.jsxs(nt,{className:"bg-green-500/10 text-green-600 border-green-500/20",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Paid"]}):e==="payment_failed"?o.jsxs(nt,{variant:"destructive",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Failed"]}):e==="pending"||e==="created"?o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Pending"]}):e==="NA"?o.jsxs(nt,{variant:"outline",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Cancelled"]}):o.jsx(nt,{variant:"outline",children:e}),Sqe=e=>e==="paid"?"Placed":["Placed","Approved","Dispatched","Done","NA"].includes(e)?e:"pending";function Cqe(){const{isAdmin:e,loading:t,orders:n,fetchOrders:r,updateOrderStatus:a}=oo(),[s,i]=k.useState(!0),[l,u]=k.useState(null),d=k.useRef(null),[c,h]=k.useState(new Set);k.useEffect(()=>{if(t)return;if(!e){i(!1);return}const f=async()=>{i(!0);try{await r();const{data:y}=await le.from("deleted_users").select("email, user_id");if(y){const{data:b}=await le.from("profiles").select("user_id"),v=new Set((b||[]).map(N=>N.user_id)),w=y.filter(N=>!v.has(N.user_id)).map(N=>N.email).filter(Boolean);h(new Set(w))}}finally{i(!1)}},g=()=>{d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{r()},300)};f();const x=le.channel("admin-pvc-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},g).subscribe();return()=>{d.current&&window.clearTimeout(d.current),le.removeChannel(x)}},[t,e,r]);const p=async(f,g)=>{u(f);try{await a(f,g),yt.success("Order status updated")}catch{yt.error("Failed to update order status")}finally{u(null)}},m=n.filter(f=>f.product_type==="pvc");return s?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(Js,{className:"h-5 w-5 text-muted-foreground"}),o.jsxs(nt,{variant:"secondary",children:[m.length," PVC orders"]})]}),o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"Order #"}),o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Email"}),o.jsx(rt,{children:"Phone"}),o.jsx(rt,{children:"Variant"}),o.jsx(rt,{children:"Qty"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"Payment"}),o.jsx(rt,{children:"Dispatch"}),o.jsx(rt,{children:"Date"})]})}),o.jsx(Mi,{children:m.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No PVC orders yet"})}):m.map(f=>{var v;const g=l===f.id,x=f.user_email&&c.has(f.user_email),y=Sqe(f.status),b=f.status==="paid"||["Placed","Approved","Dispatched","Done"].includes(f.status);return o.jsxs(Un,{children:[o.jsx(Ze,{className:"font-mono font-medium text-sm",children:f.order_number||"-"}),o.jsxs(Ze,{className:"font-medium",children:[f.user_name,x&&o.jsx(nt,{variant:"destructive",className:"ml-2 text-xs",children:"Deleted"})]}),o.jsx(Ze,{children:f.user_email}),o.jsx(Ze,{children:f.user_phone||"-"}),o.jsx(Ze,{children:o.jsx("span",{className:"text-sm capitalize",children:((v=f.card_variant)==null?void 0:v.replace(/-/g," "))||"-"})}),o.jsx(Ze,{children:f.quantity}),o.jsx(Ze,{children:f.amount>0?`${Number(f.amount).toLocaleString()}`:"-"}),o.jsx(Ze,{children:kqe(f.status)}),o.jsx(Ze,{children:b?o.jsxs(_a,{value:y,onValueChange:w=>p(f.id,w),disabled:g,children:[o.jsx(ha,{className:"w-32",children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"Placed",children:"Placed"}),o.jsx(Nt,{value:"Approved",children:"Approved"}),o.jsx(Nt,{value:"Dispatched",children:"Dispatched"}),o.jsx(Nt,{value:"Done",children:"Done"}),o.jsx(Nt,{value:"NA",children:"NA"})]})]}):o.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),o.jsx(Ze,{children:hr(new Date(f.created_at),"MMM d, yyyy")})]},f.id)})})]})})]})}const _qe=e=>e==="paid"||e==="Placed"||e==="Approved"||e==="Dispatched"||e==="Done"?o.jsxs(nt,{className:"bg-green-500/10 text-green-600 border-green-500/20",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Paid"]}):e==="payment_failed"?o.jsxs(nt,{variant:"destructive",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Failed"]}):e==="pending"||e==="created"?o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Pending"]}):e==="NA"?o.jsxs(nt,{variant:"outline",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Cancelled"]}):o.jsx(nt,{variant:"outline",children:e}),Iqe=e=>e==="paid"?"Placed":["Placed","Approved","Dispatched","Done","NA"].includes(e)?e:"pending";function Tqe(){const{isAdmin:e,loading:t,orders:n,fetchOrders:r,updateOrderStatus:a}=oo(),[s,i]=k.useState(!0),[l,u]=k.useState(null),d=k.useRef(null),[c,h]=k.useState(new Set);k.useEffect(()=>{if(t)return;if(!e){i(!1);return}const f=async()=>{i(!0);try{await r();const{data:y}=await le.from("deleted_users").select("email, user_id");if(y){const{data:b}=await le.from("profiles").select("user_id"),v=new Set((b||[]).map(N=>N.user_id)),w=y.filter(N=>!v.has(N.user_id)).map(N=>N.email).filter(Boolean);h(new Set(w))}}finally{i(!1)}},g=()=>{d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{r()},300)};f();const x=le.channel("admin-metal-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},g).subscribe();return()=>{d.current&&window.clearTimeout(d.current),le.removeChannel(x)}},[t,e,r]);const p=async(f,g)=>{u(f);try{await a(f,g),yt.success("Order status updated")}catch{yt.error("Failed to update order status")}finally{u(null)}},m=n.filter(f=>f.product_type==="metal");return s?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(kY,{className:"h-5 w-5 text-muted-foreground"}),o.jsxs(nt,{variant:"secondary",children:[m.length," Metal orders"]})]}),o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"Order #"}),o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Email"}),o.jsx(rt,{children:"Phone"}),o.jsx(rt,{children:"Variant"}),o.jsx(rt,{children:"Qty"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"Payment"}),o.jsx(rt,{children:"Dispatch"}),o.jsx(rt,{children:"Date"})]})}),o.jsx(Mi,{children:m.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No Metal orders yet"})}):m.map(f=>{var v;const g=l===f.id,x=f.user_email&&c.has(f.user_email),y=Iqe(f.status),b=f.status==="paid"||["Placed","Approved","Dispatched","Done"].includes(f.status);return o.jsxs(Un,{children:[o.jsx(Ze,{className:"font-mono font-medium text-sm",children:f.order_number||"-"}),o.jsxs(Ze,{className:"font-medium",children:[f.user_name,x&&o.jsx(nt,{variant:"destructive",className:"ml-2 text-xs",children:"Deleted"})]}),o.jsx(Ze,{children:f.user_email}),o.jsx(Ze,{children:f.user_phone||"-"}),o.jsx(Ze,{children:o.jsx("span",{className:"text-sm capitalize",children:((v=f.card_variant)==null?void 0:v.replace(/-/g," "))||"-"})}),o.jsx(Ze,{children:f.quantity}),o.jsx(Ze,{children:f.amount>0?`${Number(f.amount).toLocaleString()}`:"-"}),o.jsx(Ze,{children:_qe(f.status)}),o.jsx(Ze,{children:b?o.jsxs(_a,{value:y,onValueChange:w=>p(f.id,w),disabled:g,children:[o.jsx(ha,{className:"w-32",children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"Placed",children:"Placed"}),o.jsx(Nt,{value:"Approved",children:"Approved"}),o.jsx(Nt,{value:"Dispatched",children:"Dispatched"}),o.jsx(Nt,{value:"Done",children:"Done"}),o.jsx(Nt,{value:"NA",children:"NA"})]})]}):o.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})}),o.jsx(Ze,{children:hr(new Date(f.created_at),"MMM d, yyyy")})]},f.id)})})]})})]})}const CP=e=>new Date(e).toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",day:"2-digit",month:"short",year:"numeric"});function Eqe(){const{isAdmin:e,loading:t,upgradeUserPlan:n,downgradeUserPlan:r}=oo(),[a,s]=k.useState(!0),[i,l]=k.useState([]),[u,d]=k.useState(null),[c,h]=k.useState("active"),p=k.useRef(null),m=async()=>{const{data:N,error:S}=await le.from("subscriptions").select("*").eq("plan_type","monthly").order("created_at",{ascending:!1});if(S){console.error("Error fetching subscriptions:",S);return}const C=await Promise.all((N||[]).map(async _=>{var j,I,D,F,P;const[T,E]=await Promise.all([le.from("profiles").select("full_name, email, phone").eq("user_id",_.user_id).maybeSingle(),le.from("cards").select("full_name, phone").eq("user_id",_.user_id).eq("is_default",!0).maybeSingle()]);return{..._,user_name:((j=T.data)==null?void 0:j.full_name)||((I=E.data)==null?void 0:I.full_name)||"Unknown",user_email:((D=T.data)==null?void 0:D.email)||"Unknown",user_phone:((F=T.data)==null?void 0:F.phone)||((P=E.data)==null?void 0:P.phone)||null}}));l(C)};k.useEffect(()=>{if(t)return;if(!e){s(!1);return}const N=async()=>{s(!0),await m(),s(!1)},S=()=>{p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(()=>{m()},300)};N();const C=le.channel("admin-orange-monthly-subs-changes").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions"},S).subscribe();return()=>{p.current&&window.clearTimeout(p.current),le.removeChannel(C)}},[t,e]);const f=i.filter(N=>{if(N.payment_status==="admin")switch(c){case"active":return N.status==="active";case"halted":return N.status==="halted";case"cancelled":return N.status==="cancelled";case"completed":return N.status==="completed"||N.status==="expired";default:return!0}if((N.payment_status==="pending"||N.payment_status==="failed")&&N.status!=="active"&&N.status!=="completed"&&N.status!=="cancelled"&&N.status!=="halted")return!1;switch(c){case"active":return N.status==="active";case"halted":return N.status==="halted";case"cancelled":return N.status==="cancelled";case"completed":return N.status==="completed"||N.status==="expired";default:return!0}}),g=N=>i.filter(S=>{if(S.payment_status==="admin")switch(N){case"active":return S.status==="active";case"halted":return S.status==="halted";case"cancelled":return S.status==="cancelled";case"completed":return S.status==="completed"||S.status==="expired";default:return!0}if((S.payment_status==="pending"||S.payment_status==="failed")&&S.status!=="active"&&S.status!=="completed"&&S.status!=="cancelled"&&S.status!=="halted")return!1;switch(N){case"active":return S.status==="active";case"halted":return S.status==="halted";case"cancelled":return S.status==="cancelled";case"completed":return S.status==="completed"||S.status==="expired";default:return!0}}).length,x=async(N,S)=>{d(N.id);try{const C={status:S,updated_at:new Date().toISOString()};S==="cancelled"&&N.status!=="cancelled"&&(C.cancelled_at=new Date().toISOString(),C.auto_renew=!1),S==="halted"&&(C.auto_renew=!1,C.cancellation_reason="Bank mandate halted by admin");const{error:_}=await le.from("subscriptions").update(C).eq("id",N.id);if(_)throw _;S==="active"&&N.status!=="active"?(await n(N.user_id,"Orange"),yt.success("Subscription activated and user upgraded to Orange")):S==="completed"||S==="expired"?(await r(N.user_id),yt.success("Subscription expired and user downgraded to Free")):S==="halted"?(await r(N.user_id),yt.success("Subscription halted and user downgraded to Free")):S==="cancelled"?yt.success("Subscription cancelled. User will downgrade after end date."):yt.success("Status updated"),await m()}catch(C){console.error("Error updating status:",C),yt.error("Failed to update status")}finally{d(null)}},y=async N=>{d(N.id);try{const{error:S}=await le.from("subscriptions").update({auto_renew:!N.auto_renew,updated_at:new Date().toISOString()}).eq("id",N.id);if(S)throw S;yt.success(`Auto-renew ${N.auto_renew?"disabled":"enabled"}`),await m()}catch(S){console.error("Error toggling auto-renew:",S),yt.error("Failed to update auto-renew")}finally{d(null)}},b=N=>{switch(N){case"active":return o.jsxs(nt,{className:"bg-green-500 text-white",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Active"]});case"halted":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(uw,{className:"w-3 h-3 mr-1"}),"Halted"]});case"cancelled":return o.jsxs(nt,{variant:"outline",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Cancelled"]});case"completed":case"expired":return o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Expired"]});default:return o.jsx(nt,{variant:"outline",children:N})}},v=N=>{switch(N){case"paid":return o.jsx(nt,{className:"bg-green-500 text-white",children:"Paid"});case"admin":return o.jsx(nt,{className:"bg-purple-500 text-white",children:"Admin"});case"failed":return o.jsx(nt,{variant:"destructive",children:"Failed"});case"pending":return o.jsx(nt,{variant:"secondary",children:"Pending"});default:return o.jsx(nt,{variant:"outline",children:N})}},w=N=>N.status==="halted"?o.jsxs(nt,{variant:"destructive",children:[o.jsx(To,{className:"w-3 h-3 mr-1"}),"Halted"]}):N.mandate_created?o.jsx(nt,{className:"bg-green-500 text-white",children:"Active"}):o.jsx(nt,{variant:"outline",children:"Not Set"});return a?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(Ru,{className:"h-5 w-5 text-orange-500"}),o.jsxs(nt,{className:"bg-orange-500 text-white",children:[g("all")," Monthly Subscriptions"]})]}),o.jsxs(Cy,{value:c,onValueChange:h,children:[o.jsxs(nf,{className:"flex flex-wrap h-auto gap-1 bg-muted/50 p-1",children:[o.jsxs($n,{value:"active",className:"flex items-center gap-1 text-xs",children:[o.jsx(bi,{className:"w-3 h-3"}),"Active (",g("active"),")"]}),o.jsxs($n,{value:"halted",className:"flex items-center gap-1 text-xs text-destructive",children:[o.jsx(uw,{className:"w-3 h-3"}),"Halted (",g("halted"),")"]}),o.jsxs($n,{value:"cancelled",className:"flex items-center gap-1 text-xs",children:[o.jsx(ki,{className:"w-3 h-3"}),"Cancelled (",g("cancelled"),")"]}),o.jsxs($n,{value:"completed",className:"flex items-center gap-1 text-xs",children:[o.jsx(ja,{className:"w-3 h-3"}),"Expired (",g("completed"),")"]})]}),o.jsx($a,{value:c,className:"mt-4",children:o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Status"}),o.jsx(rt,{children:"Payment"}),o.jsx(rt,{children:"Start Date"}),o.jsx(rt,{children:"End Date"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"E-Mandate"}),o.jsx(rt,{children:"Auto Renew"}),o.jsx(rt,{children:"Actions"})]})}),o.jsx(Mi,{children:f.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No monthly subscriptions found"})}):f.map(N=>{const S=u===N.id;return o.jsxs(Un,{children:[o.jsx(Ze,{children:o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:N.user_name}),o.jsx("p",{className:"text-xs text-muted-foreground",children:N.user_email}),N.user_phone&&o.jsx("p",{className:"text-xs text-muted-foreground",children:N.user_phone})]})}),o.jsx(Ze,{children:b(N.status)}),o.jsx(Ze,{children:v(N.payment_status)}),o.jsx(Ze,{className:"text-sm",children:CP(N.start_date)}),o.jsx(Ze,{className:"text-sm",children:CP(N.end_date)}),o.jsxs(Ze,{children:["",Number(N.amount).toLocaleString(),"/mo"]}),o.jsx(Ze,{children:w(N)}),o.jsx(Ze,{children:o.jsx(nt,{variant:N.auto_renew?"default":"outline",className:`cursor-pointer ${S?"opacity-50":""}`,onClick:()=>!S&&y(N),children:N.auto_renew?"Yes":"No"})}),o.jsx(Ze,{children:o.jsxs(_a,{value:N.status,onValueChange:C=>x(N,C),disabled:S,children:[o.jsx(ha,{className:"w-[130px]",children:S?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"active",children:"Active"}),o.jsx(Nt,{value:"halted",children:"Halted"}),o.jsx(Nt,{value:"cancelled",children:"Cancelled"}),o.jsx(Nt,{value:"completed",children:"Expired"})]})]})})]},N.id)})})]})})})]}),f.some(N=>N.cancellation_reason)&&o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:"* Halted subscriptions indicate bank e-mandate failure after payment retries."})]})}const _P=e=>new Date(e).toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",day:"2-digit",month:"short",year:"numeric"});function jqe(){const{isAdmin:e,loading:t,upgradeUserPlan:n,downgradeUserPlan:r}=oo(),[a,s]=k.useState(!0),[i,l]=k.useState([]),[u,d]=k.useState(null),[c,h]=k.useState("active"),p=k.useRef(null),m=async()=>{const{data:N,error:S}=await le.from("subscriptions").select("*").eq("plan_type","annually").order("created_at",{ascending:!1});if(S){console.error("Error fetching subscriptions:",S);return}const C=await Promise.all((N||[]).map(async _=>{var j,I,D,F,P;const[T,E]=await Promise.all([le.from("profiles").select("full_name, email, phone").eq("user_id",_.user_id).maybeSingle(),le.from("cards").select("full_name, phone").eq("user_id",_.user_id).eq("is_default",!0).maybeSingle()]);return{..._,user_name:((j=T.data)==null?void 0:j.full_name)||((I=E.data)==null?void 0:I.full_name)||"Unknown",user_email:((D=T.data)==null?void 0:D.email)||"Unknown",user_phone:((F=T.data)==null?void 0:F.phone)||((P=E.data)==null?void 0:P.phone)||null}}));l(C)};k.useEffect(()=>{if(t)return;if(!e){s(!1);return}const N=async()=>{s(!0),await m(),s(!1)},S=()=>{p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(()=>{m()},300)};N();const C=le.channel("admin-orange-annually-subs-changes").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions"},S).subscribe();return()=>{p.current&&window.clearTimeout(p.current),le.removeChannel(C)}},[t,e]);const f=i.filter(N=>{if(N.payment_status==="admin")switch(c){case"active":return N.status==="active";case"halted":return N.status==="halted";case"cancelled":return N.status==="cancelled";case"completed":return N.status==="completed"||N.status==="expired";default:return!0}if((N.payment_status==="pending"||N.payment_status==="failed")&&N.status!=="active"&&N.status!=="completed"&&N.status!=="cancelled"&&N.status!=="halted")return!1;switch(c){case"active":return N.status==="active";case"halted":return N.status==="halted";case"cancelled":return N.status==="cancelled";case"completed":return N.status==="completed"||N.status==="expired";default:return!0}}),g=N=>i.filter(S=>{if(S.payment_status==="admin")switch(N){case"active":return S.status==="active";case"halted":return S.status==="halted";case"cancelled":return S.status==="cancelled";case"completed":return S.status==="completed"||S.status==="expired";default:return!0}if((S.payment_status==="pending"||S.payment_status==="failed")&&S.status!=="active"&&S.status!=="completed"&&S.status!=="cancelled"&&S.status!=="halted")return!1;switch(N){case"active":return S.status==="active";case"halted":return S.status==="halted";case"cancelled":return S.status==="cancelled";case"completed":return S.status==="completed"||S.status==="expired";default:return!0}}).length,x=async(N,S)=>{d(N.id);try{const C={status:S,updated_at:new Date().toISOString()};S==="cancelled"&&N.status!=="cancelled"&&(C.cancelled_at=new Date().toISOString(),C.auto_renew=!1),S==="halted"&&(C.auto_renew=!1,C.cancellation_reason="Bank mandate halted by admin");const{error:_}=await le.from("subscriptions").update(C).eq("id",N.id);if(_)throw _;S==="active"&&N.status!=="active"?(await n(N.user_id,"Orange"),yt.success("Subscription activated and user upgraded to Orange")):S==="completed"||S==="expired"?(await r(N.user_id),yt.success("Subscription expired and user downgraded to Free")):S==="halted"?(await r(N.user_id),yt.success("Subscription halted and user downgraded to Free")):S==="cancelled"?yt.success("Subscription cancelled. User will downgrade after end date."):yt.success("Status updated"),await m()}catch(C){console.error("Error updating status:",C),yt.error("Failed to update status")}finally{d(null)}},y=async N=>{d(N.id);try{const{error:S}=await le.from("subscriptions").update({auto_renew:!N.auto_renew,updated_at:new Date().toISOString()}).eq("id",N.id);if(S)throw S;yt.success(`Auto-renew ${N.auto_renew?"disabled":"enabled"}`),await m()}catch(S){console.error("Error toggling auto-renew:",S),yt.error("Failed to update auto-renew")}finally{d(null)}},b=N=>{switch(N){case"active":return o.jsxs(nt,{className:"bg-green-500 text-white",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Active"]});case"halted":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(uw,{className:"w-3 h-3 mr-1"}),"Halted"]});case"cancelled":return o.jsxs(nt,{variant:"outline",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Cancelled"]});case"completed":case"expired":return o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Expired"]});default:return o.jsx(nt,{variant:"outline",children:N})}},v=N=>{switch(N){case"paid":return o.jsx(nt,{className:"bg-green-500 text-white",children:"Paid"});case"admin":return o.jsx(nt,{className:"bg-purple-500 text-white",children:"Admin"});case"failed":return o.jsx(nt,{variant:"destructive",children:"Failed"});case"pending":return o.jsx(nt,{variant:"secondary",children:"Pending"});default:return o.jsx(nt,{variant:"outline",children:N})}},w=N=>N.status==="halted"?o.jsxs(nt,{variant:"destructive",children:[o.jsx(To,{className:"w-3 h-3 mr-1"}),"Halted"]}):N.mandate_created?o.jsx(nt,{className:"bg-green-500 text-white",children:"Active"}):o.jsx(nt,{variant:"outline",children:"Not Set"});return a?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(hY,{className:"h-5 w-5 text-orange-500"}),o.jsxs(nt,{className:"bg-orange-500 text-white",children:[g("all")," Annual Subscriptions"]})]}),o.jsxs(Cy,{value:c,onValueChange:h,children:[o.jsxs(nf,{className:"flex flex-wrap h-auto gap-1 bg-muted/50 p-1",children:[o.jsxs($n,{value:"active",className:"flex items-center gap-1 text-xs",children:[o.jsx(bi,{className:"w-3 h-3"}),"Active (",g("active"),")"]}),o.jsxs($n,{value:"halted",className:"flex items-center gap-1 text-xs text-destructive",children:[o.jsx(uw,{className:"w-3 h-3"}),"Halted (",g("halted"),")"]}),o.jsxs($n,{value:"cancelled",className:"flex items-center gap-1 text-xs",children:[o.jsx(ki,{className:"w-3 h-3"}),"Cancelled (",g("cancelled"),")"]}),o.jsxs($n,{value:"completed",className:"flex items-center gap-1 text-xs",children:[o.jsx(ja,{className:"w-3 h-3"}),"Expired (",g("completed"),")"]})]}),o.jsx($a,{value:c,className:"mt-4",children:o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Status"}),o.jsx(rt,{children:"Payment"}),o.jsx(rt,{children:"Start Date"}),o.jsx(rt,{children:"End Date"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"E-Mandate"}),o.jsx(rt,{children:"Auto Renew"}),o.jsx(rt,{children:"Actions"})]})}),o.jsx(Mi,{children:f.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No annual subscriptions found"})}):f.map(N=>{const S=u===N.id;return o.jsxs(Un,{children:[o.jsx(Ze,{children:o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:N.user_name}),o.jsx("p",{className:"text-xs text-muted-foreground",children:N.user_email}),N.user_phone&&o.jsx("p",{className:"text-xs text-muted-foreground",children:N.user_phone})]})}),o.jsx(Ze,{children:b(N.status)}),o.jsx(Ze,{children:v(N.payment_status)}),o.jsx(Ze,{className:"text-sm",children:_P(N.start_date)}),o.jsx(Ze,{className:"text-sm",children:_P(N.end_date)}),o.jsxs(Ze,{children:["",Number(N.amount).toLocaleString(),"/yr"]}),o.jsx(Ze,{children:w(N)}),o.jsx(Ze,{children:o.jsx(nt,{variant:N.auto_renew?"default":"outline",className:`cursor-pointer ${S?"opacity-50":""}`,onClick:()=>!S&&y(N),children:N.auto_renew?"Yes":"No"})}),o.jsx(Ze,{children:o.jsxs(_a,{value:N.status,onValueChange:C=>x(N,C),disabled:S,children:[o.jsx(ha,{className:"w-[130px]",children:S?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"active",children:"Active"}),o.jsx(Nt,{value:"halted",children:"Halted"}),o.jsx(Nt,{value:"cancelled",children:"Cancelled"}),o.jsx(Nt,{value:"completed",children:"Expired"})]})]})})]},N.id)})})]})})})]}),f.some(N=>N.cancellation_reason)&&o.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:"* Halted subscriptions indicate bank e-mandate failure after payment retries."})]})}const IP=(e,t=!1)=>{const n=new Date(e);return t?n.toLocaleString("en-IN",{timeZone:"Asia/Kolkata",day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}):n.toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",day:"2-digit",month:"short",year:"numeric"})};function Aqe(){const{isAdmin:e,loading:t,users:n,fetchUsers:r,upgradeUserPlan:a,downgradeUserPlan:s}=oo(),[i,l]=k.useState(!0),[u,d]=k.useState([]),[c,h]=k.useState(""),[p,m]=k.useState("all"),f=k.useRef(null),[g,x]=k.useState(!1),[y,b]=k.useState(!1),[v,w]=k.useState(null),[N,S]=k.useState({user_id:"",plan_type:"monthly",status:"active",amount:299,payment_status:"admin",mandate_created:!1,auto_renew:!1}),[C,_]=k.useState(!1),T=async()=>{const{data:$,error:O}=await le.from("subscriptions").select("*").order("created_at",{ascending:!1});if(O){console.error("Error fetching subscriptions:",O);return}const L=await Promise.all(($||[]).map(async q=>{var M,G,J,ve,Q;const[U,ee]=await Promise.all([le.from("profiles").select("full_name, email, phone").eq("user_id",q.user_id).maybeSingle(),le.from("cards").select("full_name, phone").eq("user_id",q.user_id).eq("is_default",!0).maybeSingle()]);return{...q,user_name:((M=U.data)==null?void 0:M.full_name)||((G=ee.data)==null?void 0:G.full_name)||"Unknown",user_email:((J=U.data)==null?void 0:J.email)||"Unknown",user_phone:((ve=U.data)==null?void 0:ve.phone)||((Q=ee.data)==null?void 0:Q.phone)||null}}));d(L)};k.useEffect(()=>{if(t)return;if(!e){l(!1);return}const $=async()=>{l(!0),await T(),l(!1)},O=()=>{f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{T()},300)};$(),r();const L=le.channel("admin-subscriptions-changes").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions"},O).subscribe();return()=>{f.current&&window.clearTimeout(f.current),le.removeChannel(L)}},[t,e,r]);const E=u.filter($=>{var L,q;if(!(((L=$.user_name)==null?void 0:L.toLowerCase().includes(c.toLowerCase()))||((q=$.user_email)==null?void 0:q.toLowerCase().includes(c.toLowerCase()))))return!1;switch(p){case"payment_pending":return $.payment_status==="pending";case"payment_failed":return $.payment_status==="failed";case"payment_paid":return $.payment_status==="paid";case"active":return $.status==="active";case"halted":return $.status==="halted";case"expired":return $.status==="expired"||$.status==="completed";case"cancelled":return $.status==="cancelled";case"monthly":return $.plan_type==="monthly";case"annually":return $.plan_type==="annually";default:return!0}}),j=$=>u.filter(O=>{switch($){case"payment_pending":return O.payment_status==="pending";case"payment_failed":return O.payment_status==="failed";case"payment_paid":return O.payment_status==="paid";case"active":return O.status==="active";case"halted":return O.status==="halted";case"expired":return O.status==="expired"||O.status==="completed";case"cancelled":return O.status==="cancelled";case"monthly":return O.plan_type==="monthly";case"annually":return O.plan_type==="annually";default:return!0}}).length,I=async()=>{if(!N.user_id){yt.error("Please select a user");return}_(!0);const $=new Date,O=N.plan_type==="monthly"?Ci($,1):i5($,1),{error:L}=await le.from("subscriptions").insert({user_id:N.user_id,plan_type:N.plan_type,status:N.status,start_date:$.toISOString(),end_date:O.toISOString(),current_period_start:$.toISOString(),current_period_end:O.toISOString(),amount:N.amount,payment_status:N.payment_status,mandate_created:N.mandate_created,auto_renew:N.auto_renew});if(L){console.error("Error creating subscription:",L),yt.error("Failed to create subscription"),_(!1);return}N.status==="active"&&(N.payment_status==="paid"||N.payment_status==="admin")&&await a(N.user_id,"Orange"),yt.success("Subscription created successfully"),x(!1),_(!1),T(),S({user_id:"",plan_type:"monthly",status:"active",amount:299,payment_status:"admin",mandate_created:!1,auto_renew:!1})},D=async()=>{if(!v)return;_(!0);const $={status:N.status,amount:N.amount,payment_status:N.payment_status,mandate_created:N.mandate_created,auto_renew:N.auto_renew,updated_at:new Date().toISOString()};N.status==="cancelled"&&v.status!=="cancelled"&&($.cancelled_at=new Date().toISOString());const{error:O}=await le.from("subscriptions").update($).eq("id",v.id);if(O){console.error("Error updating subscription:",O),yt.error("Failed to update subscription"),_(!1);return}N.status==="active"&&(N.payment_status==="paid"||N.payment_status==="admin")&&(v.status!=="active"||v.payment_status!=="paid"&&v.payment_status!=="admin")?await a(v.user_id,"Orange"):N.status==="expired"&&v.status!=="expired"&&new Date(v.end_date)<=new Date&&await s(v.user_id),yt.success("Subscription updated successfully"),b(!1),w(null),_(!1),T()},F=$=>{w($),S({user_id:$.user_id,plan_type:$.plan_type,status:$.status,amount:$.amount,payment_status:$.payment_status,mandate_created:$.mandate_created,auto_renew:$.auto_renew}),b(!0)},P=$=>{switch($){case"active":return o.jsxs(nt,{className:"bg-green-500 text-white",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Active"]});case"halted":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(To,{className:"w-3 h-3 mr-1"}),"Halted"]});case"cancelled":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Cancelled"]});case"expired":case"completed":return o.jsxs(nt,{variant:"outline",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Expired"]});case"pending":return o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Pending"]});default:return o.jsx(nt,{variant:"outline",children:$})}},V=$=>{switch($){case"paid":return o.jsxs(nt,{className:"bg-green-500 text-white",children:[o.jsx(Js,{className:"w-3 h-3 mr-1"}),"Paid"]});case"admin":return o.jsxs(nt,{className:"bg-purple-500 text-white",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Admin"]});case"failed":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(To,{className:"w-3 h-3 mr-1"}),"Failed"]});case"pending":return o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Pending"]});case"refunded":return o.jsxs(nt,{variant:"outline",children:[o.jsx(I3,{className:"w-3 h-3 mr-1"}),"Refunded"]});default:return o.jsx(nt,{variant:"outline",children:$})}};return i?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(Ru,{className:"h-5 w-5 text-orange-500"}),o.jsxs(nt,{className:"bg-orange-500 text-white",children:[u.length," Subscriptions"]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"relative",children:[o.jsx(dd,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),o.jsx(Ge,{placeholder:"Search...",value:c,onChange:$=>h($.target.value),className:"pl-10 w-48"})]}),o.jsxs(fe,{onClick:()=>x(!0),className:"bg-orange-500 hover:bg-orange-600",children:[o.jsx(qs,{className:"h-4 w-4 mr-2"}),"Create"]})]})]}),o.jsxs(Cy,{value:p,onValueChange:m,children:[o.jsxs(nf,{className:"flex flex-wrap h-auto gap-1 bg-muted/50 p-1",children:[o.jsxs($n,{value:"all",className:"text-xs",children:["All (",j("all"),")"]}),o.jsxs($n,{value:"payment_pending",className:"flex items-center gap-1 text-xs",children:[o.jsx(ja,{className:"w-3 h-3"}),"Pending (",j("payment_pending"),")"]}),o.jsxs($n,{value:"payment_failed",className:"flex items-center gap-1 text-xs text-destructive",children:[o.jsx(To,{className:"w-3 h-3"}),"Failed (",j("payment_failed"),")"]}),o.jsxs($n,{value:"payment_paid",className:"flex items-center gap-1 text-xs text-green-600",children:[o.jsx(Js,{className:"w-3 h-3"}),"Paid (",j("payment_paid"),")"]}),o.jsxs($n,{value:"active",className:"flex items-center gap-1 text-xs text-green-600",children:[o.jsx(bi,{className:"w-3 h-3"}),"Active (",j("active"),")"]}),o.jsxs($n,{value:"halted",className:"flex items-center gap-1 text-xs text-destructive",children:[o.jsx(To,{className:"w-3 h-3"}),"Halted (",j("halted"),")"]}),o.jsxs($n,{value:"expired",className:"flex items-center gap-1 text-xs",children:["Expired (",j("expired"),")"]}),o.jsxs($n,{value:"cancelled",className:"flex items-center gap-1 text-xs",children:["Cancelled (",j("cancelled"),")"]}),o.jsxs($n,{value:"monthly",className:"text-xs",children:["Monthly (",j("monthly"),")"]}),o.jsxs($n,{value:"annually",className:"text-xs",children:["Annual (",j("annually"),")"]})]}),o.jsx($a,{value:p,className:"mt-4",children:o.jsx("div",{className:"rounded-md border",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Plan"}),o.jsx(rt,{children:"Status"}),o.jsx(rt,{children:"Payment"}),o.jsx(rt,{children:"Start"}),o.jsx(rt,{children:"End"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"Auto Renew"}),o.jsx(rt,{children:"E-Mandate"}),o.jsx(rt,{children:"Actions"})]})}),o.jsx(Mi,{children:E.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:10,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})}):E.map($=>o.jsxs(Un,{children:[o.jsx(Ze,{children:o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:$.user_name}),o.jsx("p",{className:"text-xs text-muted-foreground",children:$.user_email})]})}),o.jsx(Ze,{children:o.jsx(nt,{variant:$.plan_type==="monthly"?"secondary":"default",children:$.plan_type==="monthly"?"Monthly":"Annual"})}),o.jsx(Ze,{children:P($.status)}),o.jsx(Ze,{children:V($.payment_status)}),o.jsx(Ze,{className:"text-sm",children:IP($.start_date)}),o.jsx(Ze,{className:"text-sm",children:IP($.end_date)}),o.jsxs(Ze,{children:["",Number($.amount).toLocaleString(),o.jsxs("span",{className:"text-xs text-muted-foreground",children:["/",$.plan_type==="monthly"?"mo":"yr"]})]}),o.jsx(Ze,{children:o.jsx(nt,{variant:$.auto_renew?"default":"outline",children:$.auto_renew?"Yes":"No"})}),o.jsxs(Ze,{children:[o.jsx(nt,{variant:$.mandate_created?"default":"outline",children:$.mandate_created?"Created":"No"}),$.mandate_id&&o.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-mono truncate max-w-20",children:$.mandate_id})]}),o.jsx(Ze,{children:o.jsx(fe,{size:"sm",variant:"ghost",onClick:()=>F($),children:o.jsx(Wv,{className:"h-4 w-4"})})})]},$.id))})]})})})]}),o.jsx(gn,{open:g,onOpenChange:x,children:o.jsxs(cn,{children:[o.jsxs(dn,{children:[o.jsx(hn,{children:"Create Subscription"}),o.jsx(sy,{children:"Create a new Orange subscription for a user."})]}),o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"User"}),o.jsxs(_a,{value:N.user_id,onValueChange:$=>S(O=>({...O,user_id:$})),children:[o.jsx(ha,{children:o.jsx(Ia,{placeholder:"Select a user"})}),o.jsx(pa,{className:"max-h-60",children:n.map($=>o.jsx(Nt,{value:$.user_id,children:o.jsxs("span",{className:"truncate",children:[$.full_name||"Unknown"," ",o.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",$.email,")"]})]})},$.user_id))})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Plan Type"}),o.jsxs(_a,{value:N.plan_type,onValueChange:$=>S(O=>({...O,plan_type:$,amount:$==="monthly"?299:1999})),children:[o.jsx(ha,{children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"monthly",children:"Monthly (299)"}),o.jsx(Nt,{value:"annually",children:"Annually (1999)"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Amount ()"}),o.jsx(Ge,{type:"number",value:N.amount,onChange:$=>S(O=>({...O,amount:Number($.target.value)}))})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Status"}),o.jsxs(_a,{value:N.status,onValueChange:$=>S(O=>({...O,status:$})),children:[o.jsx(ha,{children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"active",children:"Active"}),o.jsx(Nt,{value:"pending",children:"Pending"}),o.jsx(Nt,{value:"halted",children:"Halted"}),o.jsx(Nt,{value:"cancelled",children:"Cancelled"}),o.jsx(Nt,{value:"expired",children:"Expired"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Payment Status"}),o.jsxs(_a,{value:N.payment_status,onValueChange:$=>S(O=>({...O,payment_status:$})),children:[o.jsx(ha,{children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"admin",children:"Admin (Manual)"}),o.jsx(Nt,{value:"paid",children:"Paid"}),o.jsx(Nt,{value:"pending",children:"Pending"}),o.jsx(Nt,{value:"failed",children:"Failed"}),o.jsx(Nt,{value:"refunded",children:"Refunded"})]})]})]})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(vu,{checked:N.auto_renew,onCheckedChange:$=>S(O=>({...O,auto_renew:$}))}),o.jsx(We,{children:"Auto Renew"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(vu,{checked:N.mandate_created,onCheckedChange:$=>S(O=>({...O,mandate_created:$}))}),o.jsx(We,{children:"E-Mandate Created"})]})]})]}),o.jsxs(Fm,{children:[o.jsx(fe,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),o.jsxs(fe,{onClick:I,disabled:C,className:"bg-orange-500 hover:bg-orange-600",children:[C&&o.jsx(Gt,{className:"h-4 w-4 animate-spin mr-2"}),"Create"]})]})]})}),o.jsx(gn,{open:y,onOpenChange:b,children:o.jsxs(cn,{children:[o.jsxs(dn,{children:[o.jsx(hn,{children:"Edit Subscription"}),o.jsxs(sy,{children:["Update subscription for ",v==null?void 0:v.user_name]})]}),o.jsxs("div",{className:"space-y-4 py-4",children:[v&&o.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 text-sm",children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Plan:"})," ",v.plan_type==="monthly"?"Monthly":"Annual"]}),o.jsxs("p",{children:[o.jsx("strong",{children:"Start:"})," ",hr(new Date(v.start_date),"PPP")]}),o.jsxs("p",{children:[o.jsx("strong",{children:"End:"})," ",hr(new Date(v.end_date),"PPP")]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Status"}),o.jsxs(_a,{value:N.status,onValueChange:$=>S(O=>({...O,status:$})),children:[o.jsx(ha,{children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"active",children:"Active"}),o.jsx(Nt,{value:"pending",children:"Pending"}),o.jsx(Nt,{value:"halted",children:"Halted"}),o.jsx(Nt,{value:"cancelled",children:"Cancelled"}),o.jsx(Nt,{value:"expired",children:"Expired"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Payment Status"}),o.jsxs(_a,{value:N.payment_status,onValueChange:$=>S(O=>({...O,payment_status:$})),children:[o.jsx(ha,{children:o.jsx(Ia,{})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"admin",children:"Admin (Manual)"}),o.jsx(Nt,{value:"pending",children:"Pending"}),o.jsx(Nt,{value:"paid",children:"Paid"}),o.jsx(Nt,{value:"failed",children:"Failed"}),o.jsx(Nt,{value:"refunded",children:"Refunded"})]})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Amount ()"}),o.jsx(Ge,{type:"number",value:N.amount,onChange:$=>S(O=>({...O,amount:Number($.target.value)}))})]}),o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(vu,{checked:N.auto_renew,onCheckedChange:$=>S(O=>({...O,auto_renew:$}))}),o.jsx(We,{children:"Auto Renew"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(vu,{checked:N.mandate_created,onCheckedChange:$=>S(O=>({...O,mandate_created:$}))}),o.jsx(We,{children:"E-Mandate"})]})]})]}),o.jsxs(Fm,{children:[o.jsx(fe,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),o.jsxs(fe,{onClick:D,disabled:C,className:"bg-orange-500 hover:bg-orange-600",children:[C&&o.jsx(Gt,{className:"h-4 w-4 animate-spin mr-2"}),"Save Changes"]})]})]})})]})}const Rqe=(e,t="dd/MM/yyyy hh:mm a")=>(typeof e=="string"?new Date(e):e).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0});function Dqe(){const{isAdmin:e,loading:t,stats:n,fetchStats:r,users:a,orders:s}=oo(),[i,l]=k.useState(!0),[u,d]=k.useState(),[c,h]=k.useState({monthlyActive:0,monthlyRevenue:0,annualActive:0,annualRevenue:0,totalSubscriptions:0});k.useEffect(()=>{if(t)return;if(!e){l(!1);return}(async()=>{l(!0),await r(u==null?void 0:u.from,u==null?void 0:u.to);let y=le.from("subscriptions").select("*");u!=null&&u.from&&(y=y.gte("created_at",u.from.toISOString())),u!=null&&u.to&&(y=y.lte("created_at",u.to.toISOString()));const{data:b}=await y;if(b){const v=b.filter(S=>S.payment_status==="paid"),w=v.filter(S=>S.plan_type==="monthly"),N=v.filter(S=>S.plan_type==="annually");h({monthlyActive:w.filter(S=>S.status==="active").length,monthlyRevenue:w.reduce((S,C)=>S+Number(C.amount),0),annualActive:N.filter(S=>S.status==="active").length,annualRevenue:N.reduce((S,C)=>S+Number(C.amount),0),totalSubscriptions:v.length})}l(!1)})()},[t,e,r,u]);const p=()=>{const x=[["Name","Email","Mobile","Plan","Signup Date (IST)"],...a.map(w=>[w.full_name||"",w.email||"",w.phone||"",w.plan,Rqe(w.created_at)])].map(w=>w.join(",")).join(`
`),y=new Blob([x],{type:"text/csv"}),b=URL.createObjectURL(y),v=document.createElement("a");v.href=b,v.download=`synka-users-${hr(new Date,"yyyy-MM-dd")}.csv`,v.click(),URL.revokeObjectURL(b)},m=s.filter(x=>x.status==="payment_success"||x.status==="placed"||x.status==="dispatched"||x.status==="delivered"),f=m.filter(x=>x.product_type==="orange_monthly"||x.product_type==="orange_upgrade"&&x.billing_cycle==="monthly"),g=m.filter(x=>x.product_type==="orange_annually"||x.product_type==="orange_annual"||x.product_type==="orange_upgrade"&&x.billing_cycle!=="monthly");return i?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs(j2,{children:[o.jsx(A2,{asChild:!0,children:o.jsxs(fe,{variant:"outline",className:"w-[280px] justify-start text-left font-normal",children:[o.jsx(Ru,{className:"mr-2 h-4 w-4"}),u!=null&&u.from?u.to?o.jsxs(o.Fragment,{children:[hr(u.from,"LLL dd, y")," - ",hr(u.to,"LLL dd, y")]}):hr(u.from,"LLL dd, y"):o.jsx("span",{children:"All time"})]})}),o.jsx(Hw,{className:"w-auto p-0",align:"start",children:o.jsx(Kw,{initialFocus:!0,mode:"range",defaultMonth:u==null?void 0:u.from,selected:u,onSelect:d,numberOfMonths:2})})]}),o.jsxs(fe,{onClick:p,children:[o.jsx(km,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"User Statistics"}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Total Users"}),o.jsx(Cl,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold",children:n.totalUsers})})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Free Users"}),o.jsx(Cl,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold",children:n.freeUsers})})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Orange Users"}),o.jsx(Js,{className:"h-4 w-4 text-orange-500"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold text-orange-500",children:n.orangeUsers})})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Total Revenue"}),o.jsx(VN,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsxs("div",{className:"text-2xl font-bold",children:["",n.totalRevenue.toLocaleString("en-IN")]})})]})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Orange Subscription Statistics"}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[o.jsxs(xn,{className:"border-orange-200 dark:border-orange-800",children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Monthly Active"}),o.jsx(kS,{className:"h-4 w-4 text-orange-500"})]}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold text-orange-500",children:c.monthlyActive}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," paid orders"]})]})]}),o.jsxs(xn,{className:"border-orange-200 dark:border-orange-800",children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Monthly Revenue"}),o.jsx(VN,{className:"h-4 w-4 text-orange-500"})]}),o.jsxs(wn,{children:[o.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:["",c.monthlyRevenue.toLocaleString("en-IN")]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"recurring/month"})]})]}),o.jsxs(xn,{className:"border-orange-200 dark:border-orange-800",children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Annual Active"}),o.jsx(Ru,{className:"h-4 w-4 text-orange-500"})]}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold text-orange-500",children:c.annualActive}),o.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.length," paid orders"]})]})]}),o.jsxs(xn,{className:"border-orange-200 dark:border-orange-800",children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Annual Revenue"}),o.jsx(VN,{className:"h-4 w-4 text-orange-500"})]}),o.jsxs(wn,{children:[o.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:["",c.annualRevenue.toLocaleString("en-IN")]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"recurring/year"})]})]})]})]}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Card Order Statistics (Paid Only)"}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Total Paid Card Orders"}),o.jsx(Bv,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold",children:n.pvcOrders+n.metalOrders})})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"PVC Orders"}),o.jsx(Bv,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold",children:n.pvcOrders})})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[o.jsx(Pn,{className:"text-sm font-medium",children:"Metal Orders"}),o.jsx(Bv,{className:"h-4 w-4 text-muted-foreground"})]}),o.jsx(wn,{children:o.jsx("div",{className:"text-2xl font-bold",children:n.metalOrders})})]})]})]})]})}function Mqe(){const{isAdmin:e,loading:t}=oo(),[n,r]=k.useState([]),[a,s]=k.useState(!0),i=k.useRef(null);k.useEffect(()=>{if(t)return;if(!e){s(!1);return}const u=()=>{i.current&&window.clearTimeout(i.current),i.current=window.setTimeout(()=>{l()},300)};l();const d=le.channel("admin-deleted-users-changes").on("postgres_changes",{event:"*",schema:"public",table:"deleted_users"},u).subscribe();return()=>{i.current&&window.clearTimeout(i.current),le.removeChannel(d)}},[t,e]);const l=async()=>{s(!0);try{const{data:u,error:d}=await le.from("deleted_users").select("*").order("deleted_at",{ascending:!1});d?console.error("Error fetching deleted users:",d):r(u||[])}finally{s(!1)}};return a?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):o.jsxs(xn,{children:[o.jsx(Fn,{children:o.jsxs(Pn,{className:"flex items-center gap-2",children:[o.jsx(TS,{className:"h-5 w-5"}),"Deleted Users (",n.length,")"]})}),o.jsx(wn,{children:n.length===0?o.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No deleted users found."}):o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"Name"}),o.jsx(rt,{children:"Email"}),o.jsx(rt,{children:"Signup Date"}),o.jsx(rt,{children:"Deleted Date"})]})}),o.jsx(Mi,{children:n.map(u=>o.jsxs(Un,{children:[o.jsx(Ze,{className:"font-medium",children:u.name||"N/A"}),o.jsx(Ze,{children:u.email||"N/A"}),o.jsx(Ze,{children:u.created_at?hr(new Date(u.created_at),"MMM d, yyyy"):"N/A"}),o.jsx(Ze,{children:hr(new Date(u.deleted_at),"MMM d, yyyy HH:mm")})]},u.id))})]})})]})}const $qe=e=>{if(!e||e.length===0)return"No messages";const t=e.find(r=>r.role==="user");if(!t)return"No user messages";const n=t.content.slice(0,60);return n.length<t.content.length?`${n}...`:n};function Fqe(){const[e,t]=k.useState(""),[n,r]=k.useState("all"),[a,s]=k.useState("all"),[i,l]=k.useState(null),[u,d]=k.useState(!1),[c,h]=k.useState({}),p=Dy(),{data:m=[],isLoading:f,refetch:g}=qx({queryKey:["admin-chat-sessions"],queryFn:async()=>{const{data:E,error:j}=await le.from("chat_sessions").select("*").order("last_message_at",{ascending:!1});if(j)throw j;return(E||[]).map(I=>({...I,work_status:I.work_status||"open"}))},refetchInterval:1e4});k.useEffect(()=>{(async()=>{if(m.length===0)return;const j=m.map(D=>D.session_id),{data:I}=await le.from("chat_messages").select("*").in("session_id",j).order("created_at",{ascending:!0});if(I){const D={};m.forEach(F=>{const P=I.filter(V=>V.session_id===F.session_id);D[F.session_id]=$qe(P)}),h(D)}})()},[m]),k.useEffect(()=>{const E=le.channel("admin-chat-sessions-realtime").on("postgres_changes",{event:"*",schema:"public",table:"chat_sessions"},()=>{p.invalidateQueries({queryKey:["admin-chat-sessions"]})}).subscribe();return()=>{le.removeChannel(E)}},[p]);const{data:x=[],isLoading:y}=qx({queryKey:["admin-chat-messages",i==null?void 0:i.session_id],queryFn:async()=>{if(!i)return[];const{data:E,error:j}=await le.from("chat_messages").select("*").eq("session_id",i.session_id).order("created_at",{ascending:!0});if(j)throw j;return E},enabled:!!i}),b=nd({mutationFn:async({sessionId:E,workStatus:j})=>{const{error:I}=await le.from("chat_sessions").update({work_status:j}).eq("session_id",E);if(I)throw I},onSuccess:()=>{p.invalidateQueries({queryKey:["admin-chat-sessions"]}),yt.success("Work status updated")},onError:()=>{yt.error("Failed to update status")}}),v=m.filter(E=>{var F,P,V,$;const j=((F=E.name)==null?void 0:F.toLowerCase().includes(e.toLowerCase()))||((P=E.email)==null?void 0:P.toLowerCase().includes(e.toLowerCase()))||((V=E.mobile)==null?void 0:V.includes(e))||(($=c[E.session_id])==null?void 0:$.toLowerCase().includes(e.toLowerCase())),I=n==="all"||E.status===n,D=a==="all"||E.work_status===a;return j&&I&&D}),w=m.filter(E=>E.status==="active"),N=m.filter(E=>E.status==="timeout"||E.status==="ended"),S=E=>{switch(E){case"active":return o.jsxs(nt,{className:"bg-green-500/20 text-green-500 gap-1",children:[o.jsx(ja,{className:"h-3 w-3"}),"Live"]});case"timeout":return o.jsx(nt,{className:"bg-yellow-500/20 text-yellow-500",children:"Timeout"});case"ended":return o.jsx(nt,{className:"bg-gray-500/20 text-gray-500",children:"Ended"});default:return o.jsx(nt,{variant:"outline",children:E})}},C=E=>{switch(E){case"open":return o.jsx(ja,{className:"h-3 w-3"});case"assigned":return o.jsx(kR,{className:"h-3 w-3"});case"done":return o.jsx(bi,{className:"h-3 w-3"});default:return null}},_=E=>{l(E),d(!0)},T=(E,j)=>{b.mutate({sessionId:E,workStatus:j})};return f?o.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Loading sessions..."}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[o.jsxs("div",{className:"relative flex-1",children:[o.jsx(dd,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),o.jsx(Ge,{placeholder:"Search by name, email, mobile, or topic...",value:e,onChange:E=>t(E.target.value),className:"pl-9"})]}),o.jsxs(_a,{value:n,onValueChange:r,children:[o.jsx(ha,{className:"w-[130px]",children:o.jsx(Ia,{placeholder:"Status"})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"all",children:"All Status"}),o.jsx(Nt,{value:"active",children:"Live"}),o.jsx(Nt,{value:"timeout",children:"Timeout"}),o.jsx(Nt,{value:"ended",children:"Ended"})]})]}),o.jsxs(_a,{value:a,onValueChange:s,children:[o.jsx(ha,{className:"w-[130px]",children:o.jsx(Ia,{placeholder:"Work Status"})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"all",children:"All Work"}),o.jsx(Nt,{value:"open",children:"Open"}),o.jsx(Nt,{value:"assigned",children:"Assigned"}),o.jsx(Nt,{value:"done",children:"Done"})]})]}),o.jsx(fe,{variant:"outline",size:"icon",onClick:()=>g(),children:o.jsx(B0,{className:"h-4 w-4"})})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[o.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold",children:m.length}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sessions"})]}),o.jsxs("div",{className:"bg-green-500/10 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold text-green-600",children:w.length}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Live Now"})]}),o.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold",children:N.length}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Ended"})]}),o.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[o.jsx("div",{className:"text-2xl font-bold",children:m.filter(E=>E.work_status==="open").length}),o.jsx("div",{className:"text-sm text-muted-foreground",children:"Open to Work"})]})]}),o.jsx("div",{className:"border rounded-lg overflow-hidden",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User Info"}),o.jsx(rt,{children:"Summary"}),o.jsx(rt,{children:"Type"}),o.jsx(rt,{children:"Chat Status"}),o.jsx(rt,{children:"Work Status"}),o.jsx(rt,{children:"Messages"}),o.jsx(rt,{children:"Last Activity"}),o.jsx(rt,{children:"Actions"})]})}),o.jsx(Mi,{children:v.length===0?o.jsx(Un,{children:o.jsx(Ze,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No chat sessions found"})}):v.map(E=>o.jsxs(Un,{children:[o.jsx(Ze,{children:o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[E.is_user?o.jsx(bl,{className:"h-4 w-4 text-primary"}):o.jsx(TS,{className:"h-4 w-4 text-muted-foreground"}),o.jsx("span",{className:"font-medium",children:E.name||"Anonymous"})]}),E.email&&o.jsx("div",{className:"text-xs text-muted-foreground",children:E.email}),E.mobile&&o.jsx("div",{className:"text-xs text-muted-foreground",children:E.mobile})]})}),o.jsx(Ze,{children:o.jsx("div",{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:c[E.session_id]||"Loading..."})}),o.jsx(Ze,{children:E.is_user?o.jsxs(nt,{variant:"default",className:"gap-1",children:[o.jsx(bl,{className:"h-3 w-3"}),"User"]}):o.jsxs(nt,{variant:"secondary",className:"gap-1",children:[o.jsx(TS,{className:"h-3 w-3"}),"Guest"]})}),o.jsx(Ze,{children:S(E.status)}),o.jsx(Ze,{children:o.jsxs(_a,{value:E.work_status,onValueChange:j=>T(E.session_id,j),children:[o.jsx(ha,{className:"w-[110px] h-8",children:o.jsxs("div",{className:"flex items-center gap-1",children:[C(E.work_status),o.jsx(Ia,{})]})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"open",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ja,{className:"h-3 w-3"}),"Open"]})}),o.jsx(Nt,{value:"assigned",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(kR,{className:"h-3 w-3"}),"Assigned"]})}),o.jsx(Nt,{value:"done",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(bi,{className:"h-3 w-3"}),"Done"]})})]})]})}),o.jsx(Ze,{children:o.jsx(nt,{variant:"outline",children:E.message_count})}),o.jsx(Ze,{className:"text-sm text-muted-foreground",children:hr(new Date(E.last_message_at),"MMM d, HH:mm")}),o.jsx(Ze,{children:o.jsxs(fe,{variant:"ghost",size:"sm",onClick:()=>_(E),children:[o.jsx(_3,{className:"h-4 w-4 mr-1"}),"View"]})})]},E.id))})]})}),o.jsx(gn,{open:u,onOpenChange:d,children:o.jsxs(cn,{className:"max-w-2xl max-h-[80vh]",children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(Sm,{className:"h-5 w-5"}),"Chat with ",(i==null?void 0:i.name)||"Anonymous",(i==null?void 0:i.is_user)&&o.jsxs(nt,{variant:"outline",className:"ml-2",children:[o.jsx(bl,{className:"h-3 w-3 mr-1"}),"User"]}),i&&S(i.status)]})}),o.jsxs("div",{className:"text-sm text-muted-foreground mb-4 flex flex-wrap gap-4",children:[(i==null?void 0:i.email)&&o.jsxs("span",{children:[" ",i.email]}),(i==null?void 0:i.mobile)&&o.jsxs("span",{children:[" ",i.mobile]}),(i==null?void 0:i.started_at)&&o.jsxs("span",{children:[" Started: ",hr(new Date(i.started_at),"MMM d, HH:mm")]})]}),i&&o.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[o.jsx("span",{className:"text-sm font-medium",children:"Work Status:"}),o.jsxs(_a,{value:i.work_status,onValueChange:E=>{T(i.session_id,E),l({...i,work_status:E})},children:[o.jsx(ha,{className:"w-[130px]",children:o.jsxs("div",{className:"flex items-center gap-1",children:[C(i.work_status),o.jsx(Ia,{})]})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"open",children:"Open"}),o.jsx(Nt,{value:"assigned",children:"Assigned"}),o.jsx(Nt,{value:"done",children:"Done"})]})]})]}),o.jsx(Q_,{className:"h-[400px] pr-4",children:y?o.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Loading messages..."}):x.length===0?o.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No messages found"}):o.jsx("div",{className:"space-y-4",children:x.map(E=>o.jsx("div",{className:`flex ${E.role==="user"?"justify-end":"justify-start"}`,children:o.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${E.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[o.jsx("p",{className:"text-sm whitespace-pre-wrap",children:E.content}),o.jsx("p",{className:"text-xs opacity-70 mt-1",children:hr(new Date(E.created_at),"HH:mm:ss")})]})},E.id))})}),(i==null?void 0:i.timeout_reason)&&o.jsxs("div",{className:"mt-4 p-3 bg-yellow-500/10 rounded-lg text-sm",children:[o.jsx("strong",{children:"Session ended:"})," ",i.timeout_reason]})]})})]})}function Pqe(){const e=Dy(),[t,n]=k.useState(!1),[r,a]=k.useState(null),[s,i]=k.useState(null),[l,u]=k.useState(!1),[d,c]=k.useState({title:"",content:"",category:""}),{data:h,isLoading:p}=qx({queryKey:["knowledge-base"],queryFn:async()=>{const{data:w,error:N}=await le.from("knowledge_base").select("*").order("title");if(N)throw N;return w}}),m=nd({mutationFn:async w=>{const{error:N}=await le.from("knowledge_base").insert({title:w.title,content:w.content,category:w.category||null,is_active:!0});if(N)throw N},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),yt.success("Entry added - embedding will be generated"),u(!1),c({title:"",content:"",category:""})},onError:w=>yt.error(`Failed to add: ${w.message}`)}),f=nd({mutationFn:async w=>{const{error:N}=await le.from("knowledge_base").update({title:w.title,content:w.content,category:w.category,is_active:w.is_active}).eq("id",w.id);if(N)throw N},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),yt.success("Entry updated - embedding will be regenerated"),i(null)},onError:w=>yt.error(`Failed to update: ${w.message}`)}),g=nd({mutationFn:async w=>{const{error:N}=await le.from("knowledge_base").delete().eq("id",w);if(N)throw N},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),yt.success("Entry deleted")},onError:w=>yt.error(`Failed to delete: ${w.message}`)}),x=async()=>{n(!0);try{const{data:w,error:N}=await le.functions.invoke("generate-embeddings",{body:{regenerate_all:!0}});if(N)throw N;yt.success(`Generated ${w.successCount} embeddings (${w.errorCount} errors)`),e.invalidateQueries({queryKey:["knowledge-base"]})}catch(w){const N=w instanceof Error?w.message:"Unknown error";yt.error(`Failed to regenerate: ${N}`)}finally{n(!1)}},y=async w=>{a(w);try{const{data:N,error:S}=await le.functions.invoke("generate-embeddings",{body:{record_id:w}});if(S)throw S;N.successCount>0?yt.success("Embedding generated successfully"):yt.error("Failed to generate embedding"),e.invalidateQueries({queryKey:["knowledge-base"]})}catch(N){const S=N instanceof Error?N.message:"Unknown error";yt.error(`Failed to regenerate: ${S}`)}finally{a(null)}},b=(h==null?void 0:h.filter(w=>w.embedding!==null).length)||0,v=(h==null?void 0:h.length)||0;return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[o.jsxs(xn,{children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(yY,{className:"h-4 w-4"}),"Knowledge Entries"]})}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold",children:v}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Total active entries"})]})]}),o.jsxs(xn,{children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(Hs,{className:"h-4 w-4"}),"Embeddings Status"]})}),o.jsxs(wn,{children:[o.jsxs("div",{className:"text-2xl font-bold",children:[b,"/",v]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:b===v?"All up to date":"Some need regeneration"})]})]}),o.jsxs(xn,{children:[o.jsx(Fn,{className:"pb-2",children:o.jsx(Pn,{className:"text-sm font-medium",children:"Actions"})}),o.jsxs(wn,{className:"flex gap-2",children:[o.jsxs(fe,{onClick:x,disabled:t,variant:"outline",size:"sm",children:[t?o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}):o.jsx(B0,{className:"h-4 w-4 mr-2"}),"Regenerate All"]}),o.jsxs(fe,{onClick:()=>u(!0),size:"sm",children:[o.jsx(qs,{className:"h-4 w-4 mr-2"}),"Add Entry"]})]})]})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{children:[o.jsx(Pn,{children:"Knowledge Base"}),o.jsx(gi,{children:"Manage bot knowledge. Changes trigger automatic embedding regeneration."})]}),o.jsx(wn,{children:p?o.jsx("div",{className:"flex justify-center py-8",children:o.jsx(Gt,{className:"h-6 w-6 animate-spin"})}):o.jsx("div",{className:"rounded-md border overflow-x-auto",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"Title"}),o.jsx(rt,{children:"Content"}),o.jsx(rt,{children:"Category"}),o.jsx(rt,{className:"text-center",children:"Embedding"}),o.jsx(rt,{className:"text-center",children:"Active"}),o.jsx(rt,{className:"text-right",children:"Actions"})]})}),o.jsx(Mi,{children:h==null?void 0:h.map(w=>o.jsxs(Un,{children:[o.jsx(Ze,{className:"font-medium max-w-[150px] truncate",children:w.title}),o.jsx(Ze,{className:"max-w-[300px] truncate text-muted-foreground",children:w.content}),o.jsx(Ze,{children:w.category&&o.jsx(nt,{variant:"secondary",children:w.category})}),o.jsx(Ze,{className:"text-center",children:w.embedding?o.jsx(an,{className:"h-4 w-4 text-green-500 mx-auto"}):r===w.id?o.jsx(Gt,{className:"h-4 w-4 animate-spin mx-auto text-muted-foreground"}):o.jsx("button",{onClick:()=>y(w.id),className:"p-1 rounded hover:bg-muted transition-colors cursor-pointer",title:"Click to generate embedding",children:o.jsx(Mo,{className:"h-4 w-4 text-red-500 mx-auto"})})}),o.jsx(Ze,{className:"text-center",children:o.jsx(nt,{variant:w.is_active?"default":"secondary",children:w.is_active?"Yes":"No"})}),o.jsx(Ze,{className:"text-right",children:o.jsxs("div",{className:"flex justify-end gap-1",children:[o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>i(w),children:o.jsx(Ay,{className:"h-4 w-4"})}),o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>{confirm("Delete this entry?")&&g.mutate(w.id)},children:o.jsx(Do,{className:"h-4 w-4 text-destructive"})})]})})]},w.id))})]})})})]}),o.jsx(gn,{open:l,onOpenChange:u,children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:"Add Knowledge Entry"})}),o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Title"}),o.jsx(Ge,{value:d.title,onChange:w=>c({...d,title:w.target.value}),placeholder:"e.g., Pricing Orange Monthly"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Content"}),o.jsx(Pa,{value:d.content,onChange:w=>c({...d,content:w.target.value}),placeholder:"The knowledge content...",rows:4})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Category (optional)"}),o.jsx(Ge,{value:d.category,onChange:w=>c({...d,category:w.target.value}),placeholder:"e.g., pricing, faq, feature"})]})]}),o.jsxs(Fm,{children:[o.jsx(fe,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),o.jsxs(fe,{onClick:()=>m.mutate(d),disabled:!d.title||!d.content||m.isPending,children:[m.isPending&&o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Entry"]})]})]})}),o.jsx(gn,{open:!!s,onOpenChange:()=>i(null),children:o.jsxs(cn,{children:[o.jsx(dn,{children:o.jsx(hn,{children:"Edit Knowledge Entry"})}),s&&o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Title"}),o.jsx(Ge,{value:s.title,onChange:w=>i({...s,title:w.target.value})})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Content"}),o.jsx(Pa,{value:s.content,onChange:w=>i({...s,content:w.target.value}),rows:4})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Category"}),o.jsx(Ge,{value:s.category||"",onChange:w=>i({...s,category:w.target.value})})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:w=>i({...s,is_active:w.target.checked})}),o.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),o.jsxs(Fm,{children:[o.jsx(fe,{variant:"outline",onClick:()=>i(null),children:"Cancel"}),o.jsxs(fe,{onClick:()=>s&&f.mutate(s),disabled:f.isPending,children:[f.isPending&&o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Save Changes"]})]})]})})]})}function Oqe(){const e=Dy(),{user:t}=ir(),[n,r]=k.useState(null),[a,s]=k.useState(!1),[i,l]=k.useState(""),[u,d]=k.useState(""),[c,h]=k.useState(""),[p,m]=k.useState(""),[f,g]=k.useState("new"),{data:x,isLoading:y}=qx({queryKey:["learning-signals",f],queryFn:async()=>{const{data:D,error:F}=await le.from("chat_learning_signals").select("*").eq("status",f).order("frequency_count",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1});if(F)throw F;return D}}),{data:b}=qx({queryKey:["learning-signals-stats"],queryFn:async()=>{const[D,F,P,V]=await Promise.all([le.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","new"),le.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","reviewed"),le.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","approved"),le.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","rejected")]);return{new:D.count||0,reviewed:F.count||0,approved:P.count||0,rejected:V.count||0}}}),v=nd({mutationFn:async({id:D,status:F,notes:P})=>{const V={status:F};P&&(V.admin_notes=P);const{error:$}=await le.from("chat_learning_signals").update(V).eq("id",D);if($)throw $},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]})}}),w=nd({mutationFn:async({signal:D,title:F,content:P,category:V})=>{const{data:$,error:O}=await le.from("knowledge_base").insert({title:F,content:P,category:V||null,is_active:!0}).select().single();if(O)throw O;const{error:L}=await le.from("chat_learning_signals").update({status:"approved",suggested_answer:P,admin_notes:u||null,approved_at:new Date().toISOString(),approved_by:t==null?void 0:t.id,created_knowledge_id:$.id}).eq("id",D.id);if(L)throw L;return await le.functions.invoke("generate-embeddings",{body:{record_id:$.id}}),$},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]}),e.invalidateQueries({queryKey:["knowledge-base"]}),yt.success("Learning signal approved and added to knowledge base"),C()},onError:D=>{yt.error(`Failed to approve: ${D.message}`)}}),N=nd({mutationFn:async({id:D,notes:F})=>{const{error:P}=await le.from("chat_learning_signals").update({status:"rejected",admin_notes:F||null}).eq("id",D);if(P)throw P},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]}),yt.success("Learning signal rejected"),C()},onError:D=>{yt.error(`Failed to reject: ${D.message}`)}}),S=D=>{r(D),l(D.suggested_answer||D.response_text||""),d(D.admin_notes||""),m(D.query_text.slice(0,100)),h("faq"),s(!1)},C=()=>{r(null),l(""),d(""),m(""),h(""),s(!1)},_=()=>{if(!n||!p.trim()||!i.trim()){yt.error("Title and answer are required");return}w.mutate({signal:n,title:p.trim(),content:i.trim(),category:c.trim()})},T=()=>{n&&N.mutate({id:n.id,notes:u})},E=()=>{n&&(v.mutate({id:n.id,status:"reviewed",notes:u}),C(),yt.success("Marked as reviewed"))},j=D=>{switch(D){case"no_match":return o.jsx(nt,{variant:"destructive",children:"No Match"});case"low_confidence":return o.jsx(nt,{variant:"secondary",children:"Low Confidence"});case"repeated_query":return o.jsx(nt,{variant:"outline",children:"Repeated"});case"user_feedback":return o.jsx(nt,{variant:"default",children:"Feedback"});default:return o.jsx(nt,{variant:"secondary",children:D})}},I=D=>new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return o.jsxs("div",{className:"space-y-6",children:[o.jsx(xn,{className:"border-primary/20 bg-primary/5",children:o.jsxs(Fn,{className:"pb-3",children:[o.jsxs(Pn,{className:"flex items-center gap-2 text-lg",children:[o.jsx(af,{className:"h-5 w-5 text-primary"}),"Controlled Learning (Admin Approved)"]}),o.jsxs(gi,{children:["Review user questions and optionally approve them as new knowledge entries.",o.jsx("strong",{className:"text-foreground",children:" Bot answers remain unchanged until you approve."})]})]})}),o.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[o.jsxs(xn,{className:`cursor-pointer transition-colors ${f==="new"?"ring-2 ring-primary":""}`,onClick:()=>g("new"),children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(_S,{className:"h-4 w-4 text-yellow-500"}),"New Signals"]})}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.new)||0}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting review"})]})]}),o.jsxs(xn,{className:`cursor-pointer transition-colors ${f==="reviewed"?"ring-2 ring-primary":""}`,onClick:()=>g("reviewed"),children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(ja,{className:"h-4 w-4 text-blue-500"}),"Reviewed"]})}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.reviewed)||0}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending decision"})]})]}),o.jsxs(xn,{className:`cursor-pointer transition-colors ${f==="approved"?"ring-2 ring-primary":""}`,onClick:()=>g("approved"),children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(an,{className:"h-4 w-4 text-green-500"}),"Approved"]})}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.approved)||0}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Added to knowledge"})]})]}),o.jsxs(xn,{className:`cursor-pointer transition-colors ${f==="rejected"?"ring-2 ring-primary":""}`,onClick:()=>g("rejected"),children:[o.jsx(Fn,{className:"pb-2",children:o.jsxs(Pn,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(Mo,{className:"h-4 w-4 text-red-500"}),"Rejected"]})}),o.jsxs(wn,{children:[o.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.rejected)||0}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Dismissed"})]})]})]}),o.jsxs(xn,{children:[o.jsxs(Fn,{children:[o.jsxs(Pn,{className:"flex items-center gap-2",children:[o.jsx(wR,{className:"h-5 w-5"}),"Learning Signals - ",f.charAt(0).toUpperCase()+f.slice(1)]}),o.jsxs(gi,{children:[f==="new"&&"Questions that need your review. Click to review and approve/reject.",f==="reviewed"&&"Signals you've reviewed but not yet decided on.",f==="approved"&&"Approved signals that have been added to knowledge base.",f==="rejected"&&"Rejected signals that won't be added."]})]}),o.jsx(wn,{children:y?o.jsx("div",{className:"flex justify-center py-8",children:o.jsx(Gt,{className:"h-6 w-6 animate-spin"})}):(x==null?void 0:x.length)===0?o.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No ",f," signals found"]}):o.jsx("div",{className:"rounded-md border overflow-x-auto",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User Question"}),o.jsx(rt,{children:"Current Answer"}),o.jsx(rt,{className:"text-center",children:"Type"}),o.jsxs(rt,{className:"text-center",children:[o.jsx(O3,{className:"h-4 w-4 inline mr-1"}),"Freq"]}),o.jsx(rt,{className:"text-center",children:"Confidence"}),o.jsx(rt,{children:"Date"}),o.jsx(rt,{className:"text-right",children:"Action"})]})}),o.jsx(Mi,{children:x==null?void 0:x.map(D=>o.jsxs(Un,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>S(D),children:[o.jsx(Ze,{className:"font-medium max-w-[200px]",children:o.jsx("div",{className:"truncate",title:D.query_text,children:D.query_text})}),o.jsx(Ze,{className:"max-w-[250px] text-muted-foreground",children:o.jsx("div",{className:"truncate",title:D.response_text||"",children:D.response_text||o.jsx("span",{className:"italic",children:"No response"})})}),o.jsx(Ze,{className:"text-center",children:j(D.signal_type)}),o.jsx(Ze,{className:"text-center",children:o.jsxs(nt,{variant:"outline",children:[D.frequency_count||1,""]})}),o.jsx(Ze,{className:"text-center",children:D.similarity_score?o.jsxs("span",{className:D.similarity_score<.5?"text-destructive":"text-muted-foreground",children:[(D.similarity_score*100).toFixed(0),"%"]}):o.jsx("span",{className:"text-muted-foreground",children:""})}),o.jsx(Ze,{className:"text-sm text-muted-foreground",children:I(D.created_at)}),o.jsx(Ze,{className:"text-right",children:o.jsx(fe,{variant:"ghost",size:"sm",onClick:F=>{F.stopPropagation(),S(D)},children:"Review"})})]},D.id))})]})})})]}),o.jsx(gn,{open:!!n,onOpenChange:()=>C(),children:o.jsxs(cn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[o.jsxs(dn,{children:[o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(_S,{className:"h-5 w-5"}),"Review Learning Signal"]}),o.jsx(sy,{children:"Review this user question and decide whether to add it to the knowledge base."})]}),n&&o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(wR,{className:"h-4 w-4"}),"User Question"]}),o.jsx("div",{className:"p-3 bg-muted rounded-md text-sm",children:n.query_text})]}),o.jsxs("div",{className:"flex gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",j(n.signal_type)]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-muted-foreground",children:"Asked:"})," ",o.jsxs(nt,{variant:"outline",children:[n.frequency_count||1," times"]})]}),n.similarity_score&&o.jsxs("div",{children:[o.jsx("span",{className:"text-muted-foreground",children:"Match:"})," ",o.jsxs("span",{className:n.similarity_score<.5?"text-destructive":"",children:[(n.similarity_score*100).toFixed(0),"%"]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("label",{className:"text-sm font-medium",children:"Current Bot Response"}),o.jsx("div",{className:"p-3 bg-muted/50 rounded-md text-sm text-muted-foreground max-h-32 overflow-y-auto",children:n.response_text||"No response recorded"})]}),(n.status==="new"||n.status==="reviewed")&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"border-t pt-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsx("h4",{className:"font-medium",children:"Create Knowledge Entry"}),o.jsxs(fe,{variant:"outline",size:"sm",onClick:()=>s(!a),children:[o.jsx(Ay,{className:"h-4 w-4 mr-1"}),a?"Preview":"Edit"]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Knowledge Title"}),o.jsx(Ge,{value:p,onChange:D=>m(D.target.value),placeholder:"Brief title for this knowledge entry",disabled:!a})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Answer / Content"}),o.jsx(Pa,{value:i,onChange:D=>l(D.target.value),placeholder:"The answer that will be added to knowledge base...",rows:4,disabled:!a})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Category"}),o.jsx(Ge,{value:c,onChange:D=>h(D.target.value),placeholder:"e.g., faq, pricing, feature",disabled:!a})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-sm font-medium",children:"Admin Notes (internal)"}),o.jsx(Pa,{value:u,onChange:D=>d(D.target.value),placeholder:"Optional notes about this decision...",rows:2})]})]})]}),o.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:[o.jsx(To,{className:"h-5 w-5 text-yellow-600 shrink-0 mt-0.5"}),o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Approval creates a new knowledge entry."})," The bot will use this answer for similar questions after embedding generation completes."]})]})]}),n.status==="approved"&&o.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-md",children:[o.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[o.jsx(an,{className:"h-4 w-4"}),o.jsx("span",{className:"font-medium",children:"Approved"}),n.approved_at&&o.jsxs("span",{className:"text-sm text-muted-foreground",children:["on ",I(n.approved_at)]})]}),n.admin_notes&&o.jsx("p",{className:"text-sm mt-2 text-muted-foreground",children:n.admin_notes})]}),n.status==="rejected"&&o.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[o.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[o.jsx(Mo,{className:"h-4 w-4"}),o.jsx("span",{className:"font-medium",children:"Rejected"})]}),n.admin_notes&&o.jsx("p",{className:"text-sm mt-2 text-muted-foreground",children:n.admin_notes})]})]}),o.jsxs(Fm,{className:"gap-2 sm:gap-0",children:[(n==null?void 0:n.status)==="new"&&o.jsx(fe,{variant:"outline",onClick:E,disabled:v.isPending,children:"Mark as Reviewed"}),((n==null?void 0:n.status)==="new"||(n==null?void 0:n.status)==="reviewed")&&o.jsxs(o.Fragment,{children:[o.jsxs(fe,{variant:"destructive",onClick:T,disabled:N.isPending,children:[N.isPending&&o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),o.jsx(Mo,{className:"h-4 w-4 mr-1"}),"Reject"]}),o.jsxs(fe,{onClick:_,disabled:w.isPending||!p.trim()||!i.trim(),children:[w.isPending&&o.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),o.jsx(an,{className:"h-4 w-4 mr-1"}),"Approve & Add to Knowledge"]})]}),((n==null?void 0:n.status)==="approved"||(n==null?void 0:n.status)==="rejected")&&o.jsx(fe,{variant:"outline",onClick:C,children:"Close"})]})]})})]})}function Lqe(){const[e,t]=k.useState(!1),[n,r]=k.useState(!1),[a,s]=k.useState(""),[i,l]=k.useState(!1),[u,d]=k.useState([]),[c,h]=k.useState(!1),[p,m]=k.useState(""),[f,g]=k.useState(""),[x,y]=k.useState(""),[b,v]=k.useState(""),[w,N]=k.useState(""),[S,C]=k.useState(""),_=iR(),T=()=>{m(""),g(""),y(""),v(""),N(""),C(""),s(""),d([]),h(!1)},E=()=>{T(),t(!0)},j=async()=>{const F=a.trim();if(!F||F.length<2){yt.error("Please enter at least 2 characters to search");return}l(!0),h(!0);try{const{data:P,error:V}=await le.from("profiles").select("user_id, full_name, email, phone, company, designation, slug").or(`full_name.ilike.%${F}%,email.ilike.%${F}%`).limit(10);if(V)throw V;d(P||[]),(!P||P.length===0)&&yt.info("No users found matching your search")}catch(P){console.error("Search error:",P),yt.error("Failed to search users"),d([])}finally{l(!1)}},I=F=>{m(F.slug||""),g(F.full_name||""),y(F.company||""),v(F.designation||""),N(F.phone||""),C(F.email||""),h(!1),s(""),yt.success(`Selected: ${F.full_name||F.email}`)},D=async()=>{if(!p.trim()){yt.error("Please enter a slug/link");return}r(!0);try{const P=`https://synka.in/u/${p.trim().replace(/^\/+/,"").replace(/^u\//,"")}`,V=sqe({name:f.trim()||void 0,company:x.trim()||void 0,designation:b.trim()||void 0,phone:w.trim()||void 0,email:S.trim()||void 0,url:P});yt.info("Hold NFC tag near your device...");const $=await aqe(P,V);$.success?(yt.success("NFC tag written successfully!"),t(!1),T()):yt.error($.error||"Failed to write NFC tag")}catch(F){console.error("NFC write error:",F),yt.error((F==null?void 0:F.message)||"Failed to write NFC tag")}finally{r(!1)}};return o.jsxs("div",{className:"space-y-6",children:[o.jsxs(xn,{children:[o.jsxs(Fn,{children:[o.jsxs(Pn,{className:"flex items-center gap-2",children:[o.jsx(IS,{className:"h-5 w-5"}),"Admin NFC Writer"]}),o.jsx(gi,{children:"Write any custom slug and contact details to NFC cards. This allows you to program NFC cards for any user."})]}),o.jsxs(wn,{className:"space-y-4",children:[!_.isSupported&&o.jsxs("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20 flex items-start gap-3",children:[o.jsx(To,{className:"h-5 w-5 text-amber-500 mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-amber-600 dark:text-amber-400",children:"NFC Not Available"}),o.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:Yt.isNativePlatform()?"NFC writing requires Chrome browser on Android. Please open synka.in in Chrome to write NFC tags.":"NFC is not supported on this device/browser. Please use Chrome on Android with NFC enabled."})]})]}),_.isSupported&&o.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-500/20 flex items-start gap-3",children:[o.jsx(k3,{className:"h-5 w-5 text-green-500 mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:"NFC Available"}),o.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Your device supports NFC writing. Click the button below to program an NFC card."})]})]}),o.jsxs(fe,{onClick:E,className:"w-full sm:w-auto",disabled:!_.isSupported,children:[o.jsx(_Y,{className:"h-4 w-4 mr-2"}),"Write NFC Card"]})]})]}),o.jsx(gn,{open:e,onOpenChange:t,children:o.jsxs(cn,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[o.jsx(dn,{children:o.jsxs(hn,{className:"flex items-center gap-2",children:[o.jsx(IS,{className:"h-5 w-5"}),"Write Custom NFC Card"]})}),o.jsxs("div",{className:"space-y-4 py-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{className:"flex items-center gap-1",children:[o.jsx(dd,{className:"h-4 w-4"}),"Search User"]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Ge,{value:a,onChange:F=>s(F.target.value),placeholder:"Search by name or email...",className:"flex-1",onKeyDown:F=>F.key==="Enter"&&j()}),o.jsx(fe,{variant:"outline",size:"icon",onClick:j,disabled:i,children:i?o.jsx(Gt,{className:"h-4 w-4 animate-spin"}):o.jsx(dd,{className:"h-4 w-4"})})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Find a user to auto-fill their details"}),c&&o.jsx("div",{className:"border rounded-lg divide-y max-h-48 overflow-y-auto",children:i?o.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[o.jsx(Gt,{className:"h-4 w-4 animate-spin mx-auto mb-2"}),"Searching..."]}):u.length>0?u.map(F=>o.jsxs("button",{onClick:()=>I(F),className:"w-full p-3 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[o.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:o.jsx(bl,{className:"h-4 w-4 text-primary"})}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsx("p",{className:"font-medium text-sm truncate",children:F.full_name||"No name"}),o.jsx("p",{className:"text-xs text-muted-foreground truncate",children:F.email||"No email"}),F.slug&&o.jsxs("p",{className:"text-xs text-primary truncate",children:["/",F.slug]})]})]},F.user_id)):o.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"No users found"})})]}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute inset-0 flex items-center",children:o.jsx("span",{className:"w-full border-t"})}),o.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:o.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"or enter manually"})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(We,{className:"flex items-center gap-1",children:["Slug / Link ",o.jsx("span",{className:"text-destructive",children:"*"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"synka.in/u/"}),o.jsx(Ge,{value:p,onChange:F=>m(F.target.value),placeholder:"john-doe",className:"flex-1"})]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the user's profile slug (e.g., john-doe)"})]}),o.jsxs("div",{className:"border-t pt-4 space-y-4",children:[o.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Optional Offline Details (vCard)"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Name"}),o.jsx(Ge,{value:f,onChange:F=>g(F.target.value),placeholder:"John Doe"})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Company"}),o.jsx(Ge,{value:x,onChange:F=>y(F.target.value),placeholder:"Acme Inc"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Designation"}),o.jsx(Ge,{value:b,onChange:F=>v(F.target.value),placeholder:"CEO"})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Phone"}),o.jsx(Ge,{value:w,onChange:F=>N(F.target.value),placeholder:"+91 98765 43210"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Email"}),o.jsx(Ge,{value:S,onChange:F=>C(F.target.value),placeholder:"john@example.com"})]})]})]}),o.jsxs("div",{className:"flex gap-3 pt-2",children:[o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>t(!1),disabled:n,children:"Cancel"}),o.jsx(fe,{variant:"default",className:"flex-1",onClick:D,disabled:n||!p.trim(),children:n?"Waiting for tag...":"Write to NFC"})]})]})]})})]})}function zqe(){const[e,t]=k.useState([]),[n,r]=k.useState(!0),[a,s]=k.useState(""),[i,l]=k.useState("all");k.useEffect(()=>{u();const h=le.channel("admin-payments").on("postgres_changes",{event:"*",schema:"public",table:"payments"},()=>u()).subscribe();return()=>{le.removeChannel(h)}},[]);const u=async()=>{r(!0);try{const{data:h,error:p}=await le.from("payments").select("*").order("created_at",{ascending:!1});if(p)throw p;const m=[...new Set((h==null?void 0:h.map(y=>y.user_id))||[])],{data:f}=await le.from("profiles").select("user_id, full_name, email").in("user_id",m),g=new Map(f==null?void 0:f.map(y=>[y.user_id,{name:y.full_name,email:y.email}])),x=(h==null?void 0:h.map(y=>{var b,v;return{...y,user_name:((b=g.get(y.user_id))==null?void 0:b.name)||"Unknown",user_email:((v=g.get(y.user_id))==null?void 0:v.email)||""}}))||[];t(x)}catch(h){console.error("Error fetching payments:",h)}finally{r(!1)}},d=h=>{switch(h){case"captured":return o.jsxs(nt,{className:"bg-green-500/10 text-green-600 border-green-500/20",children:[o.jsx(bi,{className:"w-3 h-3 mr-1"}),"Captured"]});case"failed":return o.jsxs(nt,{variant:"destructive",children:[o.jsx(ki,{className:"w-3 h-3 mr-1"}),"Failed"]});case"created":return o.jsxs(nt,{variant:"secondary",children:[o.jsx(ja,{className:"w-3 h-3 mr-1"}),"Created"]});default:return o.jsx(nt,{variant:"outline",children:h})}},c=e.filter(h=>{var f,g,x,y;const p=((f=h.user_name)==null?void 0:f.toLowerCase().includes(a.toLowerCase()))||((g=h.user_email)==null?void 0:g.toLowerCase().includes(a.toLowerCase()))||((x=h.razorpay_payment_id)==null?void 0:x.toLowerCase().includes(a.toLowerCase()))||((y=h.razorpay_order_id)==null?void 0:y.toLowerCase().includes(a.toLowerCase())),m=i==="all"||h.status===i;return p&&m});return n?o.jsx("div",{className:"flex items-center justify-center py-12",children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[o.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[o.jsx(Js,{className:"w-5 h-5"}),"Payments (",c.length,")"]}),o.jsxs("div",{className:"flex gap-2 flex-wrap",children:[o.jsxs("div",{className:"relative",children:[o.jsx(dd,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),o.jsx(Ge,{placeholder:"Search payments...",value:a,onChange:h=>s(h.target.value),className:"pl-9 w-64"})]}),o.jsxs(_a,{value:i,onValueChange:l,children:[o.jsx(ha,{className:"w-32",children:o.jsx(Ia,{placeholder:"Status"})}),o.jsxs(pa,{children:[o.jsx(Nt,{value:"all",children:"All"}),o.jsx(Nt,{value:"captured",children:"Captured"}),o.jsx(Nt,{value:"failed",children:"Failed"}),o.jsx(Nt,{value:"created",children:"Created"})]})]})]})]}),o.jsx("div",{className:"border rounded-lg overflow-hidden",children:o.jsxs(Ri,{children:[o.jsx(Di,{children:o.jsxs(Un,{children:[o.jsx(rt,{children:"User"}),o.jsx(rt,{children:"Payment ID"}),o.jsx(rt,{children:"Amount"}),o.jsx(rt,{children:"Method"}),o.jsx(rt,{children:"Status"}),o.jsx(rt,{children:"Date"})]})}),o.jsxs(Mi,{children:[c.map(h=>o.jsxs(Un,{children:[o.jsx(Ze,{children:o.jsxs("div",{children:[o.jsx("p",{className:"font-medium",children:h.user_name}),o.jsx("p",{className:"text-xs text-muted-foreground",children:h.user_email})]})}),o.jsx(Ze,{children:o.jsxs("div",{children:[o.jsx("p",{className:"font-mono text-xs",children:h.razorpay_payment_id||"-"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:h.razorpay_order_id})]})}),o.jsx(Ze,{children:o.jsxs("span",{className:"font-medium",children:["",h.amount]})}),o.jsx(Ze,{children:o.jsx(nt,{variant:"outline",className:"capitalize",children:h.method||"N/A"})}),o.jsx(Ze,{children:d(h.status)}),o.jsxs(Ze,{children:[o.jsx("span",{className:"text-sm",children:hr(new Date(h.created_at),"dd MMM yyyy")}),o.jsx("br",{}),o.jsx("span",{className:"text-xs text-muted-foreground",children:hr(new Date(h.created_at),"HH:mm")})]})]},h.id)),c.length===0&&o.jsx(Un,{children:o.jsx(Ze,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No payments found"})})]})]})})]})}function Bqe(){const{user:e,loading:t}=ir(),{isAdmin:n,loading:r}=oo(),a=za(),[s,i]=k.useState("users"),[l,u]=k.useState("all-users"),[d,c]=k.useState("pvc");return k.useEffect(()=>{if(!t&&!e){a("/login");return}!t&&!r&&!n&&a("/dashboard")},[e,t,n,r,a]),t||r?o.jsx("div",{className:"flex items-center justify-center min-h-screen",children:o.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):n?o.jsxs("div",{className:"w-full py-4 sm:py-8 px-3 sm:px-4 md:px-6 max-w-7xl mx-auto",children:[o.jsxs("div",{className:"flex items-center justify-between mb-6",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(af,{className:"h-8 w-8 text-primary"}),o.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Admin Panel"})]}),o.jsxs("div",{className:"flex items-center gap-2 bg-muted p-1 rounded-lg",children:[o.jsxs("button",{onClick:()=>i("users"),className:Ie("flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors",s==="users"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[o.jsx(Cl,{className:"h-4 w-4"}),"Users"]}),o.jsxs("button",{onClick:()=>i("orders"),className:Ie("flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-colors",s==="orders"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[o.jsx(EY,{className:"h-4 w-4"}),"Orders"]})]})]}),s==="users"&&o.jsxs(Cy,{value:l,onValueChange:u,className:"w-full",children:[o.jsx("div",{className:"overflow-x-auto mb-6 -mx-4 px-4",children:o.jsxs(nf,{className:"inline-flex w-auto min-w-full sm:w-auto gap-1",children:[o.jsx($n,{value:"all-users",className:"whitespace-nowrap",children:"All Users"}),o.jsx($n,{value:"chats",className:"whitespace-nowrap",children:"Chat Sessions"}),o.jsx($n,{value:"learning",className:"whitespace-nowrap",children:"Controlled Learning"}),o.jsx($n,{value:"bot",className:"whitespace-nowrap",children:"Bot Settings"}),o.jsx($n,{value:"nfc",className:"whitespace-nowrap",children:"NFC Writer"}),o.jsx($n,{value:"deleted",className:"whitespace-nowrap",children:"Deleted Users"})]})}),o.jsx($a,{value:"all-users",children:o.jsx(Nqe,{})}),o.jsx($a,{value:"chats",children:o.jsx(Fqe,{})}),o.jsx($a,{value:"learning",children:o.jsx(Oqe,{})}),o.jsx($a,{value:"bot",children:o.jsx(Pqe,{})}),o.jsx($a,{value:"nfc",children:o.jsx(Lqe,{})}),o.jsx($a,{value:"deleted",children:o.jsx(Mqe,{})})]}),s==="orders"&&o.jsxs(Cy,{value:d,onValueChange:c,className:"w-full",children:[o.jsx("div",{className:"overflow-x-auto mb-6 -mx-4 px-4",children:o.jsxs(nf,{className:"inline-flex w-auto min-w-full sm:w-auto gap-1",children:[o.jsx($n,{value:"pvc",className:"whitespace-nowrap",children:"PVC Cards"}),o.jsx($n,{value:"metal",className:"whitespace-nowrap",children:"Metal Cards"}),o.jsx($n,{value:"subscriptions",className:"whitespace-nowrap",children:"Subscriptions"}),o.jsx($n,{value:"payments",className:"whitespace-nowrap",children:"Payments"}),o.jsx($n,{value:"orange-monthly",className:"whitespace-nowrap",children:"Orange Monthly"}),o.jsx($n,{value:"orange-annually",className:"whitespace-nowrap",children:"Orange Annually"}),o.jsx($n,{value:"reports",className:"whitespace-nowrap",children:"Reports"})]})}),o.jsx($a,{value:"pvc",children:o.jsx(Cqe,{})}),o.jsx($a,{value:"metal",children:o.jsx(Tqe,{})}),o.jsx($a,{value:"subscriptions",children:o.jsx(Aqe,{})}),o.jsx($a,{value:"payments",children:o.jsx(zqe,{})}),o.jsx($a,{value:"orange-monthly",children:o.jsx(Eqe,{})}),o.jsx($a,{value:"orange-annually",children:o.jsx(jqe,{})}),o.jsx($a,{value:"reports",children:o.jsx(Dqe,{})})]})]}):null}const Wqe=[{text:"1 Digital Business Card",included:!0},{text:"Standard QR Code",included:!0},{text:"Share Digital Card via link",included:!0},{text:"Save up to 100 Contacts",included:!0},{text:"Manual Follow-ups",included:!0},{text:"Basic Analytics (Views & Clicks)",included:!0},{text:"Basic Contact Save",included:!0},{text:"Multiple Digital Cards",included:!1},{text:"Custom Domain",included:!1},{text:"Email Signature",included:!1},{text:"WhatsApp / Email Templates",included:!1},{text:"Event Scheduling",included:!1},{text:"Import & Export",included:!1},{text:"NFC Writing",included:!1},{text:"Advanced Reports",included:!1}],Op={core:{title:" Core Features",items:[{text:"Multiple Digital Business Cards",included:!0},{text:'One-Click "Make Default" Card',included:!0},{text:"Unified Sharing & QR",included:!0,sub:"Same QR & link always point to default card"},{text:"Custom Domain",included:!0},{text:"Lifetime Free PVC NFC Card*",included:!0}]},communication:{title:" Communication & Growth",items:[{text:"Email Signature",included:!0,sub:"Create using AI  Unlimited generations"},{text:"Prefilled WhatsApp & Email Templates",included:!0,sub:"One-click touchbase"},{text:"Unlimited Contacts",included:!0},{text:"Unlimited Follow-ups",included:!0},{text:"Import & Export Contacts",included:!0}]},automation:{title:" Automation & Intelligence",items:[{text:"Event Scheduling & Auto Tagging",included:!0},{text:"Advanced Analytics & Reports",included:!0},{text:"Follow-up Automation",comingSoon:!0},{text:"AI Auto Meeting Scheduling",comingSoon:!0},{text:"Record Meetings & Get Instant MOM",comingSoon:!0,sub:"Email / WhatsApp delivery"},{text:"Auto Smart Location Tagging",comingSoon:!0}]}},Vqe=()=>{var D;const{profile:e,loading:t,refetch:n}=Ko(),{user:r}=ir(),a=za(),{initiateSubscription:s}=gK(),[i,l]=k.useState("none"),[u,d]=k.useState(!0),[c,h]=k.useState(!1),[p,m]=k.useState(!0),[f,g]=k.useState(!1),[x,y]=k.useState(null),[b,v]=k.useState(!1),w=k.useRef(!1),S=(((D=e==null?void 0:e.plan)==null?void 0:D.toLowerCase())||"free")==="orange",C={annually:{displayPrice:"166.58",totalPrice:1999,originalPrice:3999,period:"month",billingNote:"1,999/year"},monthly:{displayPrice:"299",totalPrice:299,originalPrice:599,period:"month",billingNote:null}},_=p?C.annually:C.monthly;k.useEffect(()=>{if(!r||w.current){r||d(!1);return}(async()=>{var $;w.current=!0;const{data:P,error:V}=await le.from("orders").select("status").eq("user_id",r.id).eq("product_type","orange_upgrade").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(V)console.error("Error fetching orange order:",V),l("none");else if(P){const O=($=P.status)==null?void 0:$.toLowerCase();l(O==="requested"?"requested":O==="approved"?"approved":"none")}else l("none");d(!1)})()},[r]),k.useEffect(()=>{if(!r)return;const F=le.channel("upgrade-order-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`user_id=eq.${r.id}`},P=>{if(P.new&&P.new.product_type==="orange_upgrade"){const V=(P.new.status||"").toLowerCase();V==="approved"?(l("approved"),n()):V==="rejected"?l("none"):V==="requested"&&l("requested")}}).subscribe();return()=>{le.removeChannel(F)}},[r,n]);const T=async()=>{if(!r){yt.error("Please log in to upgrade");return}h(!0),g(!1),y(null),s({plan_type:p?"annually":"monthly",onSuccess:P=>{l("approved"),v(!0),n(),h(!1)},onFailure:P=>{console.error("Payment failed:",P),g(!0),y((P==null?void 0:P.message)||"Payment could not be processed. Please try again."),h(!1)}})},E=()=>{g(!1),y(null)};if(t||u)return o.jsx("div",{className:"min-h-screen flex items-center justify-center",children:o.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-orange-plan border-t-transparent rounded-full"})});if(f)return o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:o.jsx("div",{className:"max-w-md w-full",children:o.jsxs("div",{className:"bg-card rounded-2xl border border-destructive/20 p-8 text-center space-y-6 shadow-lg",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-destructive/10 flex items-center justify-center",children:o.jsx(ki,{className:"h-10 w-10 text-destructive"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Payment Failed"}),o.jsx("p",{className:"text-muted-foreground text-sm",children:x||"Your payment could not be processed. Please try again."})]}),o.jsxs("div",{className:"bg-muted/50 rounded-xl p-4 text-left space-y-2",children:[o.jsx("h3",{className:"font-semibold text-foreground text-sm",children:"What you can do:"}),o.jsxs("ul",{className:"space-y-1.5 text-xs text-muted-foreground",children:[o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-500"}),"Check your payment details and try again"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-500"}),"Ensure sufficient balance"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-500"}),"Try a different payment method"]})]})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsxs(fe,{className:"w-full bg-orange-plan hover:bg-orange-plan/90",onClick:E,children:[o.jsx(B0,{className:"h-4 w-4 mr-2"}),"Try Again"]}),o.jsx(fe,{variant:"outline",className:"w-full",onClick:()=>a("/settings"),children:"Back to Settings"})]})]})})});if(b)return o.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:o.jsx("div",{className:"max-w-md w-full",children:o.jsxs("div",{className:"bg-card rounded-2xl border border-orange-plan/30 p-8 text-center space-y-6 shadow-lg",children:[o.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-orange-plan/10 flex items-center justify-center",children:o.jsx(R3,{className:"h-10 w-10 text-orange-plan"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:" Welcome to Orange!"}),o.jsx("p",{className:"text-muted-foreground text-sm",children:"Your subscription is now active. Enjoy all premium features!"})]}),o.jsxs("div",{className:"bg-orange-plan/10 rounded-xl p-4 text-left space-y-3",children:[o.jsxs("h3",{className:"font-semibold text-foreground text-sm flex items-center gap-2",children:[o.jsx(cw,{className:"h-4 w-4 text-orange-plan"}),"What's included:"]}),o.jsxs("ul",{className:"space-y-1.5 text-xs text-muted-foreground",children:[o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-plan"}),"Multiple Digital Business Cards"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-plan"}),"Lifetime Free PVC NFC Card"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-plan"}),"Email Signatures & Templates"]}),o.jsxs("li",{className:"flex items-center gap-2",children:[o.jsx(an,{className:"h-3 w-3 text-orange-plan"}),"Advanced Analytics & More"]})]})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx(fe,{className:"w-full bg-orange-plan hover:bg-orange-plan/90",onClick:()=>a("/my-card"),children:"Go to My Card"}),o.jsx(fe,{variant:"outline",className:"w-full",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})]})]})})});const I=S?{text:"Current Plan",disabled:!0,variant:"secondary"}:i==="requested"?{text:"Requested",disabled:!0,variant:"outline"}:{text:"Upgrade to Orange",disabled:!1,variant:"default"};return o.jsx("div",{className:"min-h-screen bg-background",children:o.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[o.jsxs("div",{className:"mb-8",children:[o.jsxs(fe,{variant:"ghost",size:"sm",onClick:()=>a("/settings"),className:"mb-4 -ml-2",children:[o.jsx(td,{className:"w-4 h-4 mr-2"}),"Back to Settings"]}),o.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Choose Your Plan"}),o.jsx("p",{className:"text-muted-foreground mt-2",children:"Unlock powerful features to grow your network"})]}),o.jsxs("div",{className:"grid md:grid-cols-2 gap-6 lg:gap-8",children:[o.jsxs("div",{className:"relative rounded-2xl border border-border bg-card p-6 lg:p-8 shadow-sm",children:[o.jsxs("div",{className:"mb-6",children:[o.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"FREE"}),o.jsx("p",{className:"text-muted-foreground mt-1",children:"Get started with the basics"})]}),o.jsx("div",{className:"space-y-3 mb-8",children:Wqe.map((F,P)=>o.jsxs("div",{className:"flex items-start gap-3",children:[F.included?o.jsx(an,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}):o.jsx(Mo,{className:"w-5 h-5 text-muted-foreground/50 mt-0.5 flex-shrink-0"}),o.jsx("span",{className:F.included?"text-foreground":"text-muted-foreground/50 line-through",children:F.text})]},P))}),o.jsx(fe,{className:"w-full",variant:!S&&i!=="approved"?"secondary":"outline",disabled:!S&&i!=="approved",children:!S&&i!=="approved"?"Current Plan":"Free Plan"})]}),o.jsxs("div",{className:"relative rounded-2xl border-2 border-orange-plan bg-card p-6 lg:p-8 shadow-lg shadow-orange-plan/10",children:[o.jsx("div",{className:"absolute -top-4 left-6 bg-orange-plan text-white px-4 py-1.5 rounded-full text-sm font-semibold shadow-md",children:"ORANGE"}),o.jsxs("div",{className:"mb-6 mt-2",children:[o.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ORANGE"}),o.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 p-3 bg-muted/50 rounded-lg",children:[o.jsx("span",{className:`text-sm font-medium ${p?"text-muted-foreground":"text-foreground"}`,children:"Monthly"}),o.jsx(vu,{checked:p,onCheckedChange:m,className:"data-[state=checked]:bg-orange-plan"}),o.jsx("span",{className:`text-sm font-medium ${p?"text-foreground":"text-muted-foreground"}`,children:"Annually"}),p&&o.jsx("span",{className:"text-xs bg-green-500/20 text-green-600 px-2 py-0.5 rounded-full font-medium",children:"Save 50%"})]}),o.jsxs("div",{className:"mt-4 text-center",children:[o.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[o.jsxs("span",{className:"text-4xl font-bold text-orange-plan",children:["",_.displayPrice]}),o.jsxs("span",{className:"text-muted-foreground",children:["/",_.period]})]}),p?o.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:_.billingNote}):null,o.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2",children:[o.jsxs("span",{className:"text-muted-foreground line-through text-lg",children:["",_.originalPrice]}),o.jsx("span",{className:"text-xs bg-red-500/20 text-red-600 px-2 py-1 rounded-full font-semibold animate-pulse",children:"Limited Period Offer!"})]})]})]}),o.jsxs("div",{className:"mb-5",children:[o.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:Op.core.title}),o.jsx("div",{className:"space-y-2.5",children:Op.core.items.map((F,P)=>o.jsx(wS,{feature:F},P))})]}),o.jsxs("div",{className:"mb-5",children:[o.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:Op.communication.title}),o.jsx("div",{className:"space-y-2.5",children:Op.communication.items.map((F,P)=>o.jsx(wS,{feature:F},P))})]}),o.jsxs("div",{className:"mb-8",children:[o.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:Op.automation.title}),o.jsx("div",{className:"space-y-2.5",children:Op.automation.items.map((F,P)=>o.jsx(wS,{feature:F},P))})]}),!S&&i!=="requested"&&o.jsx("div",{className:"mb-4 p-4 bg-orange-plan/10 rounded-lg border border-orange-plan/20",children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-sm text-muted-foreground",children:"Total to pay"}),o.jsxs("div",{className:"text-right",children:[o.jsxs("span",{className:"text-2xl font-bold text-orange-plan",children:["",_.totalPrice]}),o.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:p?"/year":"/month"})]})]})}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(fe,{className:I.variant==="default"?"w-full bg-orange-plan hover:bg-orange-plan/90 text-white":"w-full",variant:I.variant,disabled:I.disabled||c,onClick:I.disabled?void 0:T,children:c?o.jsxs(o.Fragment,{children:[o.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):I.text}),i==="requested"&&o.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Request under review"})]})]})]}),o.jsx("p",{className:"text-xs text-muted-foreground mt-8 text-center",children:"* Lifetime Free PVC NFC Card available with Orange plan activation. Terms apply."})]})})},wS=({feature:e})=>{const t=e.comingSoon;return o.jsxs("div",{className:"flex items-start gap-3",children:[t?o.jsx(ja,{className:"w-4 h-4 text-muted-foreground/60 mt-0.5 flex-shrink-0"}):o.jsx(an,{className:"w-4 h-4 text-orange-plan mt-0.5 flex-shrink-0"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("span",{className:t?"text-muted-foreground/60 text-sm":"text-foreground text-sm",children:[e.text,t&&o.jsx("span",{className:"ml-2 text-xs bg-muted px-2 py-0.5 rounded-full",children:"Coming Soon"})]}),e.sub&&o.jsx("p",{className:`text-xs mt-0.5 ${t?"text-muted-foreground/40":"text-muted-foreground"}`,children:e.sub})]})]})};function Uqe(){var ve;const e=za(),{profile:t,updateProfile:n,loading:r}=Ko(),{user:a,verifyPin:s,setPin:i}=ir(),[l,u]=k.useState(""),[d,c]=k.useState(!1),[h,p]=k.useState(!1),[m,f]=k.useState(""),[g,x]=k.useState(""),[y,b]=k.useState(""),[v,w]=k.useState(!1),[N,S]=k.useState("old"),[C,_]=k.useState(!1),[T,E]=k.useState(!1),[j,I]=k.useState(null),[D,F]=k.useState(!0);k.useEffect(()=>{t&&u(t.full_name||"")},[t]),k.useEffect(()=>{(async()=>{if(!(a!=null&&a.id))return;F(!0);const{data:se,error:_e}=await le.from("subscriptions").select("id, plan_type, end_date, auto_renew, cancelled_at").eq("user_id",a.id).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();!_e&&se&&I(se),F(!1)})()},[a==null?void 0:a.id]);const P=async()=>{if(!l.trim()){oe({title:"Name required",description:"Please enter your full name.",variant:"destructive"});return}c(!0);const{error:Q}=await n({full_name:l.trim()});c(!1),oe(Q?{title:"Error",description:"Failed to update name.",variant:"destructive"}:{title:"Saved",description:"Your name has been updated."})},V=()=>{f(""),x(""),b(""),S("old"),p(!0)},$=async()=>{if(m.length!==4)return;w(!0);const Q=(t==null?void 0:t.email)||(a==null?void 0:a.email);if(!Q){w(!1),oe({title:"Error",description:"Could not find your email.",variant:"destructive"});return}const{error:se,locked:_e}=await s(Q,m);if(w(!1),se){_e?(oe({title:"Account Locked",description:se.message,variant:"destructive"}),p(!1)):(oe({title:"Invalid PIN",description:se.message,variant:"destructive"}),f(""));return}S("new")},O=async()=>{if(g.length!==4){oe({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(y.length!==4){oe({title:"Confirm PIN",description:"Please confirm your new PIN.",variant:"destructive"});return}if(g!==y){oe({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"}),b(""),S("confirm");return}w(!0);const Q=a==null?void 0:a.id;if(!Q){w(!1),oe({title:"Error",description:"Could not find your user ID.",variant:"destructive"});return}const{error:se}=await i(Q,g);if(w(!1),se){oe({title:"Error",description:"Failed to change PIN. Please try again.",variant:"destructive"});return}oe({title:"PIN Changed",description:"Your PIN has been updated successfully."}),p(!1)},L=()=>{N==="old"?$():N==="new"?g.length===4&&S("confirm"):N==="confirm"&&O()},q=()=>{switch(N){case"old":return"Enter Current PIN";case"new":return"Enter New PIN";case"confirm":return"Confirm New PIN"}},U=()=>{switch(N){case"old":return m;case"new":return g;case"confirm":return y}},ee=Q=>{switch(N){case"old":f(Q);break;case"new":x(Q);break;case"confirm":b(Q);break}},M=async()=>{if(j){E(!0);try{const{data:{session:Q}}=await le.auth.getSession();if(!Q){oe({title:"Error",description:"Please log in again.",variant:"destructive"});return}const se=await le.functions.invoke("cancel-subscription",{headers:{Authorization:`Bearer ${Q.access_token}`}});if(se.error)throw new Error(se.error.message||"Failed to cancel subscription");const _e=se.data;if(_e.success)oe({title:"Subscription Cancelled",description:_e.message}),I(Le=>Le?{...Le,auto_renew:!1,cancelled_at:new Date().toISOString()}:null),_(!1);else throw new Error(_e.error||"Failed to cancel subscription")}catch(Q){console.error("Cancel subscription error:",Q),oe({title:"Error",description:Q.message||"Failed to cancel subscription. Please try again.",variant:"destructive"})}finally{E(!1)}}},G=Q=>new Date(Q).toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",day:"numeric",month:"long",year:"numeric"}),J=((ve=t==null?void 0:t.plan)==null?void 0:ve.toLowerCase())==="orange";return r?o.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 flex items-center justify-center min-h-[60vh] max-w-2xl mx-auto",children:o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):o.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-4 sm:space-y-6 animate-fade-up max-w-2xl mx-auto",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>e("/settings"),className:"shrink-0",children:o.jsx(td,{className:"h-5 w-5"})}),o.jsx("div",{children:o.jsx(us,{size:"sm"})})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Profile"}),o.jsx("p",{className:"text-muted-foreground",children:"Manage your account details"})]}),o.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(bl,{className:"h-5 w-5 text-primary"}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Full Name"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{htmlFor:"fullName",children:"Your display name"}),o.jsx(Ge,{id:"fullName",value:l,onChange:Q=>u(Q.target.value),placeholder:"Enter your full name",className:"h-12"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"This name is shown on the login screen and settings"})]}),o.jsxs(fe,{onClick:P,disabled:d||l===(t==null?void 0:t.full_name),className:"w-full",children:[d?"Saving...":"Save Name",o.jsx(pw,{className:"h-4 w-4 ml-2"})]})]}),o.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(xi,{className:"h-5 w-5 text-primary"}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Email"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx(We,{children:"Your login email"}),o.jsx(Ge,{value:(t==null?void 0:t.email)||(a==null?void 0:a.email)||"",disabled:!0,className:"h-12 bg-muted/50"}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed as it's used for login"})]})]}),o.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(CS,{className:"h-5 w-5 text-primary"}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Security"})]}),o.jsx("p",{className:"text-sm text-muted-foreground",children:"Change your 4-digit PIN for secure login"}),o.jsxs(fe,{variant:"outline",onClick:V,className:"w-full",children:["Change PIN",o.jsx(CS,{className:"h-4 w-4 ml-2"})]})]}),J&&o.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-destructive/30 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(cw,{className:"h-5 w-5 text-[#F26B4F]"}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Orange Plan"})]}),D?o.jsx("div",{className:"h-10 w-full bg-muted rounded animate-pulse"}):j?o.jsx(o.Fragment,{children:j.cancelled_at?o.jsxs("div",{className:"space-y-2",children:[o.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your subscription has been cancelled. You will continue to have access to premium features until ",o.jsx("span",{className:"font-semibold text-foreground",children:G(j.end_date)}),"."]}),o.jsx("p",{className:"text-xs text-muted-foreground",children:"After this date, your account will be downgraded to the Free plan."})]}):o.jsxs(o.Fragment,{children:[o.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your ",j.plan_type," subscription ",j.auto_renew?"renews":"is active until"," on ",o.jsx("span",{className:"font-semibold text-foreground",children:G(j.end_date)}),"."]}),o.jsxs(fe,{variant:"outline",onClick:()=>_(!0),className:"w-full border-destructive/50 text-destructive hover:bg-destructive/10",children:["Cancel Subscription",o.jsx(To,{className:"h-4 w-4 ml-2"})]})]})}):o.jsx("p",{className:"text-sm text-muted-foreground",children:"You're on the Orange plan. No active subscription found."})]}),o.jsx(gn,{open:h,onOpenChange:p,children:o.jsxs(cn,{className:"max-w-sm",children:[o.jsx(dn,{children:o.jsx(hn,{children:q()})}),o.jsxs("div",{className:"space-y-6 py-4",children:[o.jsx("div",{className:"flex justify-center",children:o.jsx(Xi,{maxLength:4,value:U(),onChange:ee,children:o.jsxs(Zi,{children:[o.jsx(Jt,{index:0}),o.jsx(Jt,{index:1}),o.jsx(Jt,{index:2}),o.jsx(Jt,{index:3})]})})}),N==="new"&&o.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Choose a 4-digit PIN you'll remember"}),N==="confirm"&&o.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Re-enter your new PIN to confirm"}),o.jsxs("div",{className:"flex gap-3",children:[N!=="old"&&o.jsx(fe,{variant:"outline",className:"flex-1",onClick:()=>{N==="new"?(S("old"),x("")):N==="confirm"&&(S("new"),b(""))},disabled:v,children:"Back"}),o.jsx(fe,{variant:"gradient",className:"flex-1",onClick:L,disabled:v||U().length!==4,children:v?"Please wait...":N==="confirm"?"Change PIN":"Continue"})]})]})]})}),o.jsx(_m,{open:C,onOpenChange:_,children:o.jsxs(md,{children:[o.jsxs(fd,{children:[o.jsxs(xd,{className:"flex items-center gap-2",children:[o.jsx(To,{className:"h-5 w-5 text-destructive"}),"Cancel Orange Plan?"]}),o.jsxs(yd,{className:"space-y-3",children:[o.jsx("p",{children:"Are you sure you want to cancel your Orange subscription? You will lose access to premium features including:"}),o.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1",children:[o.jsx("li",{children:"Unlimited digital cards"}),o.jsx("li",{children:"Premium card layouts"}),o.jsx("li",{children:"Advanced CRM features"}),o.jsx("li",{children:"Priority support"})]}),j&&o.jsxs("p",{className:"font-medium text-foreground pt-2",children:["Your plan will remain active until ",G(j.end_date),"."]})]})]}),o.jsxs(gd,{children:[o.jsx(vd,{disabled:T,children:"Keep Subscription"}),o.jsx(bd,{onClick:Q=>{Q.preventDefault(),M()},disabled:T,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:T?"Cancelling...":"Yes, Cancel"})]})]})})]})}const Hqe=()=>{const e=Rl();return k.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),o.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),o.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),o.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})};function Gqe(){return o.jsx("div",{className:"min-h-screen bg-background",children:o.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[o.jsx("div",{className:"flex items-center justify-center mb-8",children:o.jsx(us,{size:"lg",asLink:!0})}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:" TERMS"}),o.jsx("p",{className:"text-xl text-muted-foreground",children:"Welcome to SYNKA"}),o.jsx("p",{className:"text-muted-foreground",children:"By using SYNKA, you agree to the following terms."})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"1. Service Overview"}),o.jsx("p",{className:"text-muted-foreground",children:"SYNKA provides digital business cards, CRM tools, NFC card services, analytics, and sharing features."})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"2. User Accounts"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"You are responsible for maintaining the confidentiality of your account."}),o.jsx("li",{children:"All information provided must be accurate."})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"3. Free & Orange Plans"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Free plan includes limited features."}),o.jsx("li",{children:"Orange plan unlocks premium features including multiple cards, analytics, downloads, and documents."}),o.jsx("li",{children:"Pricing and features may change with prior notice."})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"4. NFC Cards"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Physical cards are non-refundable once written or customized."}),o.jsx("li",{children:"SYNKA is not responsible for device NFC limitations."})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"5. Acceptable Use"}),o.jsx("p",{className:"text-muted-foreground",children:"You agree not to:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Misuse the platform"}),o.jsx("li",{children:"Share illegal, harmful, or misleading content"}),o.jsx("li",{children:"Attempt to hack or disrupt the service"})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"6. Termination"}),o.jsx("p",{className:"text-muted-foreground",children:"We reserve the right to suspend or terminate accounts violating these terms."})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"7. Updates"}),o.jsx("p",{className:"text-muted-foreground",children:"Terms may be updated from time to time. Continued use means acceptance."})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"8. Free Replacement Policy"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:"PVC NFC Cards"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"One free replacement is provided within 6 months of delivery if the card is lost or misplaced."}),o.jsx("li",{children:"Replacement is limited to one time per card."}),o.jsx("li",{children:"Courier / shipping charges must be borne by the customer."}),o.jsx("li",{children:"Damage due to misuse, bending, or intentional harm is not covered."})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Metal NFC Cards"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Metal cards are built for lifetime durability."}),o.jsx("li",{children:"One free replacement is available within 6 months of delivery in case of loss or manufacturing defects."}),o.jsx("li",{children:"Courier charges apply."}),o.jsx("li",{children:"Cosmetic wear over time (scratches, patina) is normal and not considered a defect."})]})]}),o.jsxs("div",{className:"space-y-3 p-4 rounded-xl bg-primary/10 border border-primary/20",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Orange Plan  NFC Card Free Forever"}),o.jsx("p",{className:"text-muted-foreground",children:"For Orange plan users, we go further:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"NFC card is free for life as long as the user remains on the Orange plan."}),o.jsx("li",{children:"Includes free replacement or reprint every 6 months."}),o.jsx("li",{children:"Covers: Lost card, Reprint due to design update, Wear & tear"}),o.jsx("li",{children:"Courier charges apply for each dispatch."}),o.jsx("li",{children:"Replacement eligibility resets every 6 months."}),o.jsx("li",{children:"Benefits stop if the Orange plan is cancelled or downgraded."})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Important Notes"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Replacement requests must be raised from the registered account."}),o.jsx("li",{children:"Design approval is mandatory before reprint."}),o.jsx("li",{children:"Synka reserves the right to verify eligibility before processing replacement."})]})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"9. Cancellation & Refund Policy"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Order Cancellation"}),o.jsx("p",{className:"text-muted-foreground",children:"Because all NFC cards are custom-made, cancellations depend on the order stage."}),o.jsxs("div",{className:"pl-4 space-y-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-foreground",children:"Before Design Approval"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Orders can be cancelled within 24 hours of placing the order or before design approval, whichever is earlier."}),o.jsx("li",{children:"A full refund will be issued (excluding payment gateway charges, if applicable)."})]})]}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-foreground",children:"After Design Approval"}),o.jsx("p",{className:"text-muted-foreground",children:"Once the design is approved and production has started:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:" Order cannot be cancelled"}),o.jsx("li",{children:" No refunds will be provided"})]}),o.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"This applies to both PVC and Metal NFC cards."})]})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Design Approval Responsibility"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Designs are shared via WhatsApp / Email / Dashboard for approval."}),o.jsx("li",{children:"Once approved by the customer, all responsibility for design accuracy rests with the customer."}),o.jsx("li",{children:"Minor color or engraving variations may occur due to material or production processes."})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Shipping & Delivery"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Orders already shipped cannot be cancelled or refunded."}),o.jsx("li",{children:"Delivery timelines are estimates and may vary due to logistics or external factors."}),o.jsx("li",{children:"Shipping delays do not qualify for refunds."})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Replacement vs Refund"}),o.jsx("p",{className:"text-muted-foreground",children:"Replacement policies apply instead of refunds for:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Lost cards"}),o.jsx("li",{children:"Misplacement"}),o.jsx("li",{children:"Wear & tear"})]}),o.jsx("p",{className:"text-muted-foreground text-sm",children:"Please refer to the Replacement Policy for eligibility."})]}),o.jsxs("div",{className:"space-y-3 p-4 rounded-xl bg-primary/10 border border-primary/20",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Orange Plan  Subscription Policy"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"font-medium text-foreground",children:"Subscription Cancellation"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Orange plan can be cancelled anytime from account settings."}),o.jsx("li",{children:"Cancellation stops future billing only."}),o.jsx("li",{children:"Already paid subscription periods are non-refundable."})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"font-medium text-foreground",children:"Orange Plan Refunds"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:" No refunds for partially used subscription periods."}),o.jsx("li",{children:" No refunds for benefits already availed (including free NFC cards, reprints, or replacements)."})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"font-medium text-foreground",children:"If Orange Plan Is Cancelled"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Free NFC card and replacement benefits are discontinued."}),o.jsx("li",{children:"Previously issued cards remain active."})]})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Non-Refundable Cases"}),o.jsx("p",{className:"text-muted-foreground",children:"Refunds will not be issued for:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Change of mind"}),o.jsx("li",{children:"Incorrect details shared by the customer"}),o.jsx("li",{children:"Design approved by customer"}),o.jsx("li",{children:"Color variation due to material differences"}),o.jsx("li",{children:"NFC compatibility issues caused by unsupported devices"})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Refund Processing Timeline"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Approved refunds (if applicable) are processed within 57 business days."}),o.jsx("li",{children:"Refunds are credited to the original payment method."})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("h3",{className:"text-lg font-medium text-foreground",children:" Support & Escalation"}),o.jsx("p",{className:"text-muted-foreground",children:"For cancellation or refund requests:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-1",children:[o.jsx("li",{children:"Contact us at support@synka.in"}),o.jsx("li",{children:"Or raise a request from your dashboard"})]}),o.jsx("p",{className:"text-muted-foreground text-sm",children:"All requests are reviewed on a case-by-case basis."})]})]})]})]})})}function qqe(){return o.jsx("div",{className:"min-h-screen bg-background",children:o.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[o.jsx("div",{className:"flex items-center justify-center mb-8",children:o.jsx(us,{size:"lg",asLink:!0})}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:" PRIVACY POLICY"}),o.jsx("p",{className:"text-xl text-muted-foreground",children:"Your Privacy Matters"}),o.jsx("p",{className:"text-muted-foreground",children:"SYNKA is built with privacy by design."})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"1. Information We Collect"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Name, email, phone number"}),o.jsx("li",{children:"Card and profile data"}),o.jsx("li",{children:"CRM contacts added by you"}),o.jsx("li",{children:"Analytics and usage data"})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"2. How We Use Your Data"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"To provide and improve our services"}),o.jsx("li",{children:"To sync and share your digital card"}),o.jsx("li",{children:"To generate analytics and reports"}),o.jsx("li",{children:"To provide support"})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"3. Data Sharing"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"We do not sell your data"}),o.jsxs("li",{children:["Data is shared only when:",o.jsxs("ul",{className:"list-disc list-inside ml-4 mt-2",children:[o.jsx("li",{children:"You choose to share your card"}),o.jsx("li",{children:"Required by law"})]})]})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"4. Data Security"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Industry-standard encryption"}),o.jsx("li",{children:"Secure servers"}),o.jsx("li",{children:"Controlled access"})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"5. Your Control"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"You can edit or delete your data anytime"}),o.jsx("li",{children:"You control what card is public"}),o.jsx("li",{children:"You control who gets your information"})]})]}),o.jsxs("section",{className:"space-y-4",children:[o.jsx("h2",{className:"text-xl font-semibold text-foreground",children:"6. Cookies"}),o.jsx("p",{className:"text-muted-foreground",children:"We use minimal cookies for:"}),o.jsxs("ul",{className:"list-disc list-inside text-muted-foreground space-y-2",children:[o.jsx("li",{children:"Authentication"}),o.jsx("li",{children:"Performance"}),o.jsx("li",{children:"Analytics"})]})]})]})]})})}function Kqe(){return o.jsx("div",{className:"min-h-screen bg-background",children:o.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[o.jsx("div",{className:"flex items-center justify-center mb-8",children:o.jsx(us,{size:"lg",asLink:!0})}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:" CONTACT US"}),o.jsx("p",{className:"text-xl text-muted-foreground",children:"We'd love to hear from you."})]}),o.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[o.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(xi,{className:"w-5 h-5 text-primary"})}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Email"})]}),o.jsxs("div",{className:"space-y-2 text-muted-foreground",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Support:"})," ",o.jsx("a",{href:"mailto:support@synka.in",className:"text-primary hover:underline",children:"support@synka.in"})]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Sales & Orders:"})," ",o.jsx("a",{href:"mailto:orders@synka.in",className:"text-primary hover:underline",children:"orders@synka.in"})]})]})]}),o.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(dY,{className:"w-5 h-5 text-primary"})}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Business Name"})]}),o.jsxs("div",{className:"text-muted-foreground",children:[o.jsx("p",{children:"SYNKA Technologies Pvt Ltd,"}),o.jsx("p",{children:"India"})]})]}),o.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(z0,{className:"w-5 h-5 text-primary"})}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Website"})]}),o.jsx("div",{className:"text-muted-foreground",children:o.jsx("a",{href:"https://synka.in",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"https://synka.in"})})]}),o.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:o.jsx(ja,{className:"w-5 h-5 text-primary"})}),o.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Support Hours"})]}),o.jsxs("div",{className:"text-muted-foreground",children:[o.jsx("p",{children:"Monday  Saturday"}),o.jsx("p",{children:"09:00 AM  7:00 PM IST"})]})]})]})]})]})})}var FN="Collapsible",[Yqe,xK]=qo(FN),[Xqe,lR]=Yqe(FN),yK=k.forwardRef((e,t)=>{const{__scopeCollapsible:n,open:r,defaultOpen:a,disabled:s,onOpenChange:i,...l}=e,[u,d]=Sl({prop:r,defaultProp:a??!1,onChange:i,caller:FN});return o.jsx(Xqe,{scope:n,disabled:s,contentId:rf(),open:u,onOpenToggle:k.useCallback(()=>d(c=>!c),[d]),children:o.jsx(An.div,{"data-state":cR(u),"data-disabled":s?"":void 0,...l,ref:t})})});yK.displayName=FN;var bK="CollapsibleTrigger",vK=k.forwardRef((e,t)=>{const{__scopeCollapsible:n,...r}=e,a=lR(bK,n);return o.jsx(An.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":cR(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:yn(e.onClick,a.onOpenToggle)})});vK.displayName=bK;var uR="CollapsibleContent",wK=k.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=lR(uR,e.__scopeCollapsible);return o.jsx(Al,{present:n||a.open,children:({present:s})=>o.jsx(Zqe,{...r,ref:t,present:s})})});wK.displayName=uR;var Zqe=k.forwardRef((e,t)=>{const{__scopeCollapsible:n,present:r,children:a,...s}=e,i=lR(uR,n),[l,u]=k.useState(r),d=k.useRef(null),c=sr(t,d),h=k.useRef(0),p=h.current,m=k.useRef(0),f=m.current,g=i.open||l,x=k.useRef(g),y=k.useRef(void 0);return k.useEffect(()=>{const b=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(b)},[]),Bo(()=>{const b=d.current;if(b){y.current=y.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const v=b.getBoundingClientRect();h.current=v.height,m.current=v.width,x.current||(b.style.transitionDuration=y.current.transitionDuration,b.style.animationName=y.current.animationName),u(r)}},[i.open,r]),o.jsx(An.div,{"data-state":cR(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!g,...s,ref:c,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...e.style},children:g&&a})});function cR(e){return e?"open":"closed"}var Qqe=yK,Jqe=vK,eKe=wK,co="Accordion",tKe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[dR,nKe,rKe]=h3(co),[PN]=qo(co,[rKe,xK]),hR=xK(),NK=ge.forwardRef((e,t)=>{const{type:n,...r}=e,a=r,s=r;return o.jsx(dR.Provider,{scope:e.__scopeAccordion,children:n==="multiple"?o.jsx(oKe,{...s,ref:t}):o.jsx(iKe,{...a,ref:t})})});NK.displayName=co;var[kK,aKe]=PN(co),[SK,sKe]=PN(co,{collapsible:!1}),iKe=ge.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},collapsible:s=!1,...i}=e,[l,u]=Sl({prop:n,defaultProp:r??"",onChange:a,caller:co});return o.jsx(kK,{scope:e.__scopeAccordion,value:ge.useMemo(()=>l?[l]:[],[l]),onItemOpen:u,onItemClose:ge.useCallback(()=>s&&u(""),[s,u]),children:o.jsx(SK,{scope:e.__scopeAccordion,collapsible:s,children:o.jsx(CK,{...i,ref:t})})})}),oKe=ge.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...s}=e,[i,l]=Sl({prop:n,defaultProp:r??[],onChange:a,caller:co}),u=ge.useCallback(c=>l((h=[])=>[...h,c]),[l]),d=ge.useCallback(c=>l((h=[])=>h.filter(p=>p!==c)),[l]);return o.jsx(kK,{scope:e.__scopeAccordion,value:i,onItemOpen:u,onItemClose:d,children:o.jsx(SK,{scope:e.__scopeAccordion,collapsible:!0,children:o.jsx(CK,{...s,ref:t})})})}),[lKe,ON]=PN(co),CK=ge.forwardRef((e,t)=>{const{__scopeAccordion:n,disabled:r,dir:a,orientation:s="vertical",...i}=e,l=ge.useRef(null),u=sr(l,t),d=nKe(n),h=F0(a)==="ltr",p=yn(e.onKeyDown,m=>{var _;if(!tKe.includes(m.key))return;const f=m.target,g=d().filter(T=>{var E;return!((E=T.ref.current)!=null&&E.disabled)}),x=g.findIndex(T=>T.ref.current===f),y=g.length;if(x===-1)return;m.preventDefault();let b=x;const v=0,w=y-1,N=()=>{b=x+1,b>w&&(b=v)},S=()=>{b=x-1,b<v&&(b=w)};switch(m.key){case"Home":b=v;break;case"End":b=w;break;case"ArrowRight":s==="horizontal"&&(h?N():S());break;case"ArrowDown":s==="vertical"&&N();break;case"ArrowLeft":s==="horizontal"&&(h?S():N());break;case"ArrowUp":s==="vertical"&&S();break}const C=b%y;(_=g[C].ref.current)==null||_.focus()});return o.jsx(lKe,{scope:n,disabled:r,direction:a,orientation:s,children:o.jsx(dR.Slot,{scope:n,children:o.jsx(An.div,{...i,"data-orientation":s,ref:u,onKeyDown:r?void 0:p})})})}),A0="AccordionItem",[uKe,pR]=PN(A0),_K=ge.forwardRef((e,t)=>{const{__scopeAccordion:n,value:r,...a}=e,s=ON(A0,n),i=aKe(A0,n),l=hR(n),u=rf(),d=r&&i.value.includes(r)||!1,c=s.disabled||e.disabled;return o.jsx(uKe,{scope:n,open:d,disabled:c,triggerId:u,children:o.jsx(Qqe,{"data-orientation":s.orientation,"data-state":RK(d),...l,...a,ref:t,disabled:c,open:d,onOpenChange:h=>{h?i.onItemOpen(r):i.onItemClose(r)}})})});_K.displayName=A0;var IK="AccordionHeader",TK=ge.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=ON(co,n),s=pR(IK,n);return o.jsx(An.h3,{"data-orientation":a.orientation,"data-state":RK(s.open),"data-disabled":s.disabled?"":void 0,...r,ref:t})});TK.displayName=IK;var ZC="AccordionTrigger",EK=ge.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=ON(co,n),s=pR(ZC,n),i=sKe(ZC,n),l=hR(n);return o.jsx(dR.ItemSlot,{scope:n,children:o.jsx(Jqe,{"aria-disabled":s.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:s.triggerId,...l,...r,ref:t})})});EK.displayName=ZC;var jK="AccordionContent",AK=ge.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=ON(co,n),s=pR(jK,n),i=hR(n);return o.jsx(eKe,{role:"region","aria-labelledby":s.triggerId,"data-orientation":a.orientation,...i,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});AK.displayName=jK;function RK(e){return e?"open":"closed"}var cKe=NK,dKe=_K,hKe=TK,DK=EK,MK=AK;const TP=cKe,Rr=k.forwardRef(({className:e,...t},n)=>o.jsx(dKe,{ref:n,className:Ie("border-b",e),...t}));Rr.displayName="AccordionItem";const Dr=k.forwardRef(({className:e,children:t,...n},r)=>o.jsx(hKe,{className:"flex",children:o.jsxs(DK,{ref:r,className:Ie("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,o.jsx(Ux,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Dr.displayName=DK.displayName;const Mr=k.forwardRef(({className:e,children:t,...n},r)=>o.jsx(MK,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:o.jsx("div",{className:Ie("pb-4 pt-0",e),children:t})}));Mr.displayName=MK.displayName;function pKe(){return o.jsx("div",{className:"min-h-screen bg-background",children:o.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[o.jsx("div",{className:"flex items-center justify-center mb-8",children:o.jsx(us,{size:"lg",asLink:!0})}),o.jsxs("div",{className:"text-center mb-12",children:[o.jsx("p",{className:"text-lg text-muted-foreground",children:"Smart Digital Business Cards  CRM  NFC  Analytics"}),o.jsx("p",{className:"text-primary font-medium mt-2",children:" One Card. Infinite Possibilities."})]}),o.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 mb-8",children:[o.jsx("p",{className:"text-muted-foreground",children:"With SYNKA, your QR, Link, and Physical NFC Card always remain the same, but what you share can change anytime."}),o.jsxs("ul",{className:"mt-4 space-y-2 text-muted-foreground",children:[o.jsx("li",{children:" One QR"}),o.jsx("li",{children:" One Link"}),o.jsx("li",{children:" One Physical Card"}),o.jsx("li",{children:" Multiple digital cards inside"})]}),o.jsx("p",{className:"mt-4 text-foreground font-medium",children:" Your default card is what opens when:"}),o.jsxs("ul",{className:"mt-2 space-y-1 text-muted-foreground",children:[o.jsx("li",{children:" Someone scans your QR"}),o.jsx("li",{children:" Someone taps your NFC card"}),o.jsx("li",{children:" Someone opens your link"})]}),o.jsx("p",{className:"mt-4 text-primary",children:"You can change the default card anytime  without changing your QR or physical card."})]}),o.jsxs("div",{className:"space-y-8",children:[o.jsx("h2",{className:"text-2xl font-bold text-foreground",children:" Getting Started (Basics)"}),o.jsxs(TP,{type:"single",collapsible:!0,className:"space-y-4",children:[o.jsxs(Rr,{value:"what-is-card",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:"What is a Card?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{children:"A Card is your digital identity:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[o.jsx("li",{children:"Name"}),o.jsx("li",{children:"Company"}),o.jsx("li",{children:"Role"}),o.jsx("li",{children:"Contact details"}),o.jsx("li",{children:"Social links"}),o.jsx("li",{children:"Files (Orange)"}),o.jsx("li",{children:"Analytics & CRM tracking"})]}),o.jsx("p",{className:"mt-3",children:"You can create:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"1 card (Free)"}),o.jsx("li",{children:"Multiple cards (Orange)"})]})]})]}),o.jsxs(Rr,{value:"sharing",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" How Sharing Works (Very Important)"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full mt-2",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"border-b border-border",children:[o.jsx("th",{className:"text-left py-2 font-medium",children:"Method"}),o.jsx("th",{className:"text-left py-2 font-medium",children:"What Opens"})]})}),o.jsxs("tbody",{children:[o.jsxs("tr",{className:"border-b border-border/50",children:[o.jsx("td",{className:"py-2",children:"QR Scan"}),o.jsx("td",{children:"Default Card"})]}),o.jsxs("tr",{className:"border-b border-border/50",children:[o.jsx("td",{className:"py-2",children:"Link Click"}),o.jsx("td",{children:"Default Card"})]}),o.jsxs("tr",{className:"border-b border-border/50",children:[o.jsx("td",{className:"py-2",children:"NFC Tap"}),o.jsx("td",{children:"Default Card"})]}),o.jsxs("tr",{children:[o.jsx("td",{className:"py-2",children:"Physical Card"}),o.jsx("td",{children:"Same Default Card"})]})]})]})}),o.jsx("p",{className:"mt-4 text-primary font-medium",children:" Change the default card  everything updates automatically"})]})]}),o.jsxs(Rr,{value:"orange",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Orange Upgrade (Pro Experience)"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{children:"Upgrade to Orange from Settings to unlock:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[o.jsx("li",{children:"Multiple cards"}),o.jsx("li",{children:"File uploads (pitch, catalogue, docs)"}),o.jsx("li",{children:"Advanced analytics"}),o.jsx("li",{children:"One-click templates"}),o.jsx("li",{children:"NFC writer"}),o.jsx("li",{children:"CRM automation"}),o.jsx("li",{children:"Email signature"}),o.jsx("li",{children:"Premium share & download designs"}),o.jsx("li",{children:"Physical card ordering"})]})]})]}),o.jsxs(Rr,{value:"my-card",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" MY CARD  How to Use"}),o.jsxs(Mr,{className:"text-muted-foreground space-y-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Switching Cards"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Tap My Card in the header"}),o.jsx("li",{children:"Single tap on any card  view that card"}),o.jsx("li",{children:"Star   makes that card default"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Editing Card Name"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Double-tap card name  rename"}),o.jsx("li",{children:"Auto-saved"}),o.jsx("li",{children:"No popup if name is unchanged"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Upload Photo / Logo"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Tap Edit on My Card"}),o.jsx("li",{children:"Add: Profile photo, Company logo"})]})]})]})]}),o.jsxs(Rr,{value:"files",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Files on Card (Orange Only)"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{children:"You can upload:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2",children:[o.jsx("li",{children:"Pitch deck"}),o.jsx("li",{children:"Catalogue"}),o.jsx("li",{children:"PDF"}),o.jsx("li",{children:"Documents"})]}),o.jsx("p",{className:"mt-3",children:"When someone opens your card:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Files are instantly downloadable"}),o.jsx("li",{children:"Each download is tracked in analytics"})]})]})]}),o.jsxs(Rr,{value:"share-download",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Share & Download Card"}),o.jsxs(Mr,{className:"text-muted-foreground space-y-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Share Options"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"WhatsApp"}),o.jsx("li",{children:"LinkedIn"}),o.jsx("li",{children:"Copy link"}),o.jsx("li",{children:"Download Card Image"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Download Card Image"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Generates a beautiful image in real time"}),o.jsx("li",{children:"Includes: Name, QR, Clickable link"})]}),o.jsx("p",{className:"mt-2",children:"Perfect for:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"WhatsApp status"}),o.jsx("li",{children:"LinkedIn posts"}),o.jsx("li",{children:"Offline sharing"})]})]})]})]}),o.jsxs(Rr,{value:"nfc-cards",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Physical NFC Cards"}),o.jsxs(Mr,{className:"text-muted-foreground space-y-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Available Materials"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"PVC White"}),o.jsx("li",{children:"PVC Black"}),o.jsx("li",{children:"PVC Black Matte"}),o.jsx("li",{children:"Metal Gold"}),o.jsx("li",{children:"Metal Silver"}),o.jsx("li",{children:"Metal Black"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Customisation"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"PVC White  any color or design"}),o.jsx("li",{children:"PVC Black / Matte  photo designs supported"}),o.jsx("li",{children:"Metal cards: Name, Role, Company logo (Fully engraved)"})]}),o.jsx("p",{className:"mt-2",children:"Choose from:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"In-house designer templates"}),o.jsx("li",{children:"Or share your own idea"})]})]})]})]}),o.jsxs(Rr,{value:"nfc-how",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" How NFC Works"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsxs("ul",{className:"space-y-2",children:[o.jsxs("li",{children:[o.jsx("span",{className:"font-medium",children:"Android:"})," Tap card on back of phone"]}),o.jsxs("li",{children:[o.jsx("span",{className:"font-medium",children:"iPhone:"})," Tap card on front / top"]})]}),o.jsx("p",{className:"mt-3 text-primary",children:" Screen must be ON"})]})]}),o.jsxs(Rr,{value:"nfc-writer",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" NFC Writer (Orange)"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[o.jsx("li",{children:"Go to Settings  NFC Writer"}),o.jsx("li",{children:"Tap Write"}),o.jsx("li",{children:"Place card: Android  back, iPhone  front"}),o.jsx("li",{children:"Get confirmation  Card written"})]}),o.jsx("p",{className:"mt-3 text-primary",children:"Now your physical card opens your default digital card."})]})]}),o.jsxs(Rr,{value:"crm",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" CRM  Contacts & Notes"}),o.jsxs(Mr,{className:"text-muted-foreground space-y-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"How Contacts Are Captured"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Someone scans your card"}),o.jsx("li",{children:"Someone taps your NFC"}),o.jsx("li",{children:"Someone submits their details"}),o.jsx("li",{children:"You scan their physical card"}),o.jsx("li",{children:"Manual entry"})]}),o.jsx("p",{className:"mt-2",children:"All contacts go directly into CRM."})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:" Notes & History (Powerful Feature)"}),o.jsx("p",{className:"mt-1",children:"You can instantly log:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:" Calls"}),o.jsx("li",{children:" Emails"}),o.jsx("li",{children:" WhatsApp"}),o.jsx("li",{children:" Manual notes"})]}),o.jsx("p",{className:"mt-2",children:"One-tap capture  stored against contact."})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:" Auto Tags & Events"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Auto-tag contacts by: Event, Source, Card used"}),o.jsx("li",{children:"Schedule events"}),o.jsx("li",{children:"View performance per event"})]})]})]})]}),o.jsxs(Rr,{value:"analytics",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Analytics & Reports"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"font-medium text-foreground",children:"Track:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Card views"}),o.jsx("li",{children:"QR scans"}),o.jsx("li",{children:"NFC taps"}),o.jsx("li",{children:"Calls"}),o.jsx("li",{children:"Emails"}),o.jsx("li",{children:"WhatsApp clicks"}),o.jsx("li",{children:"File downloads"})]}),o.jsx("p",{className:"font-medium text-foreground mt-4",children:"Advanced Reports"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Interaction-based analytics"}),o.jsx("li",{children:"Event-wise analytics"}),o.jsx("li",{children:"Touch-base reports"})]})]})]}),o.jsxs(Rr,{value:"email-signature",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Email Signature"}),o.jsxs(Mr,{className:"text-muted-foreground space-y-4",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Available Formats"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"HTML Signature"}),o.jsx("li",{children:"Image Signature"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Supported By"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Gmail"}),o.jsx("li",{children:"Outlook"}),o.jsx("li",{children:"Apple Mail"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Create Signature"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Choose from templates"}),o.jsx("li",{children:'Or ask AI: "Create a minimal blue email signature with logo on right"'})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-foreground",children:"Custom Controls"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Photo on/off"}),o.jsx("li",{children:"Logo on/off"}),o.jsx("li",{children:"Text alignment"}),o.jsx("li",{children:"Colors"})]})]}),o.jsx("p",{className:"text-primary mt-2",children:" HTML signatures must be set on laptop/PC (Mobile email apps don't support HTML signatures)"})]})]}),o.jsxs(Rr,{value:"templates",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" One-Click Templates & AI"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"font-medium text-foreground",children:"What You Can Do"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"One-click WhatsApp / Email templates"}),o.jsx("li",{children:"Auto-fill: Contact name, Company, Your name"}),o.jsx("li",{children:"Generate messages with AI"}),o.jsx("li",{children:"Edit or reuse templates anytime"})]})]})]}),o.jsxs(Rr,{value:"crm-filters",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" CRM Filters"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{children:"Filter contacts by:"}),o.jsxs("ul",{className:"list-disc list-inside mt-1",children:[o.jsx("li",{children:"Name"}),o.jsx("li",{children:"Date added"}),o.jsx("li",{children:"Last interaction (call / note / WhatsApp / email)"})]})]})]}),o.jsxs(Rr,{value:"ordering",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-semibold",children:" Ordering Physical Cards"}),o.jsx(Mr,{className:"text-muted-foreground",children:o.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[o.jsx("li",{children:"Go to Settings"}),o.jsx("li",{children:"Choose card type"}),o.jsx("li",{children:"Select design or share your idea"}),o.jsx("li",{children:"Place order"})]})})]})]}),o.jsx("h2",{className:"text-2xl font-bold text-foreground mt-12",children:" FREQUENTLY ASKED QUESTIONS (FAQ)"}),o.jsxs(TP,{type:"single",collapsible:!0,className:"space-y-4",children:[o.jsxs(Rr,{value:"faq-1",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Will my QR or physical card change if I change cards?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"text-primary font-medium",children:"No."}),o.jsx("p",{children:"Your QR, link, and physical card always stay the same."})]})]}),o.jsxs(Rr,{value:"faq-2",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Can I choose what card opens when scanned?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"text-primary font-medium",children:"Yes."}),o.jsx("p",{children:"Just change the default card."})]})]}),o.jsxs(Rr,{value:"faq-3",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Can I have multiple cards for different purposes?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"text-primary font-medium",children:"Yes (Orange)."}),o.jsx("p",{children:"Work, Personal, Event, Product, etc."})]})]}),o.jsxs(Rr,{value:"faq-4",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Does SYNKA work without internet?"}),o.jsx(Mr,{className:"text-muted-foreground",children:o.jsxs("ul",{className:"list-disc list-inside",children:[o.jsx("li",{children:"NFC tap opens link"}),o.jsx("li",{children:"Internet needed to load card"})]})})]}),o.jsxs(Rr,{value:"faq-5",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Can others send me their details?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"text-primary font-medium",children:"Yes."}),o.jsx("p",{children:"Via your public card or physical card scan."})]})]}),o.jsxs(Rr,{value:"faq-6",className:"bg-card border border-border rounded-xl px-4",children:[o.jsx(Dr,{className:"text-foreground font-medium",children:"Q. Is my data secure?"}),o.jsxs(Mr,{className:"text-muted-foreground",children:[o.jsx("p",{className:"text-primary font-medium",children:"Yes."}),o.jsx("p",{children:"Enterprise-grade security with full control."})]})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 rounded-xl p-6 mt-12",children:[o.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:" Why SYNKA is Different"}),o.jsxs("ul",{className:"space-y-2 text-muted-foreground",children:[o.jsx("li",{children:" One card, infinite flexibility"}),o.jsx("li",{children:" India's first dynamic NFC ecosystem"}),o.jsx("li",{children:" CRM + Analytics + NFC + AI in one app"}),o.jsx("li",{children:" Built for founders, sales teams, professionals"})]})]})]})]})})}const mKe=new yZ({defaultOptions:{queries:{staleTime:10*60*1e3,gcTime:60*60*1e3,refetchOnWindowFocus:!1,retry:1,refetchOnMount:!1}}}),$K=k.createContext(null),FK=()=>k.useContext($K);function fKe({children:e}){const t=rse();return o.jsx($K.Provider,{value:t,children:e})}function gKe({children:e}){const t=FK(),n=Rl();return t!=null&&t.isLocked&&n.pathname!=="/login"?o.jsx(Ov,{to:"/login",state:{appLockMode:!0,returnTo:n.pathname},replace:!0}):o.jsx(o.Fragment,{children:e})}function xKe(){const{loading:e}=ir();return tse(),e?o.jsx("div",{className:"min-h-dvh w-full flex items-center justify-center bg-background",children:o.jsx("div",{className:"flex flex-col items-center gap-3",children:o.jsx("img",{src:"/logos/synka-logo.png",alt:"Synka",className:"w-12 h-12 animate-pulse"})})}):o.jsxs(eY,{children:[o.jsx(sa,{path:"/",element:o.jsx(ase,{})}),o.jsx(sa,{path:"/login",element:o.jsx(Hse,{})}),o.jsx(sa,{path:"/signup",element:o.jsx(eoe,{})}),o.jsx(sa,{path:"/u/:slug",element:o.jsx(Jie,{})}),o.jsxs(sa,{element:o.jsx(Xae,{}),children:[o.jsx(sa,{path:"/index",element:o.jsx(Lse,{})}),o.jsx(sa,{path:"/dashboard",element:o.jsx(Nhe,{})}),o.jsx(sa,{path:"/crm",element:o.jsx(Phe,{})}),o.jsx(sa,{path:"/my-card",element:o.jsx(rqe,{})}),o.jsx(sa,{path:"/settings",element:o.jsx(oqe,{})}),o.jsx(sa,{path:"/settings/profile",element:o.jsx(Uqe,{})}),o.jsx(sa,{path:"/settings/upgrade",element:o.jsx(Vqe,{})}),o.jsx(sa,{path:"/order-nfc-card",element:o.jsx(bqe,{})}),o.jsx(sa,{path:"/admin",element:o.jsx(Bqe,{})}),o.jsx(sa,{path:"/terms",element:o.jsx(Gqe,{})}),o.jsx(sa,{path:"/privacy",element:o.jsx(qqe,{})}),o.jsx(sa,{path:"/contact",element:o.jsx(Kqe,{})}),o.jsx(sa,{path:"/support",element:o.jsx(pKe,{})}),o.jsx(sa,{path:"*",element:o.jsx(Hqe,{})})]})]})}function yKe(){return o.jsx(bZ,{client:mKe,children:o.jsx(VZ,{children:o.jsx(XZ,{children:o.jsx(AZ,{children:o.jsxs(X3,{children:[o.jsx(gX,{}),o.jsx(KX,{}),o.jsx(JK,{children:o.jsx(Jae,{children:o.jsx(fKe,{children:o.jsx(gKe,{children:o.jsx(xKe,{})})})})})]})})})})})}HZ();GZ(()=>{console.log("[App] Back online - syncing data"),KZ()},()=>{console.log("[App] Went offline")});y3(document.getElementById("root")).render(o.jsx(ge.StrictMode,{children:o.jsx(yKe,{})}));export{qN as C,I$ as E,bw as I,vw as N,cO as W,Yt as a,BZ as b,TKe as c,lf as r};
