import{W as y,C as p,r as P,a as u}from"./index-B1H4kQqX.js";import"./ui-C2Y9OZbz.js";import"./vendor-CwMlj7fn.js";import"./supabase-Co96GwBN.js";var m;(function(i){i.Prompt="PROMPT",i.Camera="CAMERA",i.Photos="PHOTOS"})(m||(m={}));var d;(function(i){i.Rear="REAR",i.Front="FRONT"})(d||(d={}));var f;(function(i){i.Uri="uri",i.Base64="base64",i.DataUrl="dataUrl"})(f||(f={}));class b extends y{async getPhoto(a){return new Promise(async(t,r)=>{if(a.webUseInput||a.source===m.Photos)this.fileInputExperience(a,t,r);else if(a.source===m.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=a.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",async n=>{n.detail===0?this.fileInputExperience(a,t,r):this.cameraExperience(a,t,r)})}else this.cameraExperience(a,t,r)})}async pickImages(a){return new Promise(async(t,r)=>{this.multipleFileInputExperience(t,r)})}async cameraExperience(a,t,r){if(customElements.get("pwa-camera-modal")){const e=document.createElement("pwa-camera-modal");e.facingMode=a.direction===d.Front?"user":"environment",document.body.appendChild(e);try{await e.componentOnReady(),e.addEventListener("onPhoto",async n=>{const s=n.detail;s===null?r(new p("User cancelled photos app")):s instanceof Error?r(s):t(await this._getCameraPhoto(s,a)),e.dismiss(),document.body.removeChild(e)}),e.present()}catch{this.fileInputExperience(a,t,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(a,t,r)}fileInputExperience(a,t,r){let e=document.querySelector("#_capacitor-camera-input");const n=()=>{var s;(s=e.parentNode)===null||s===void 0||s.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",s=>{const c=e.files[0];let o="jpeg";if(c.type==="image/png"?o="png":c.type==="image/gif"&&(o="gif"),a.resultType==="dataUrl"||a.resultType==="base64"){const l=new FileReader;l.addEventListener("load",()=>{if(a.resultType==="dataUrl")t({dataUrl:l.result,format:o});else if(a.resultType==="base64"){const g=l.result.split(",")[1];t({base64String:g,format:o})}n()}),l.readAsDataURL(c)}else t({webPath:URL.createObjectURL(c),format:o}),n()}),e.addEventListener("cancel",s=>{r(new p("User cancelled photos app")),n()})),e.accept="image/*",e.capture=!0,a.source===m.Photos||a.source===m.Prompt?e.removeAttribute("capture"):a.direction===d.Front?e.capture="user":a.direction===d.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(a,t){let r=document.querySelector("#_capacitor-camera-input-multiple");const e=()=>{var n;(n=r.parentNode)===null||n===void 0||n.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",n=>{const s=[];for(let c=0;c<r.files.length;c++){const o=r.files[c];let l="jpeg";o.type==="image/png"?l="png":o.type==="image/gif"&&(l="gif"),s.push({webPath:URL.createObjectURL(o),format:l})}a({photos:s}),e()}),r.addEventListener("cancel",n=>{t(new p("User cancelled photos app")),e()})),r.accept="image/*",r.click()}_getCameraPhoto(a,t){return new Promise((r,e)=>{const n=new FileReader,s=a.type.split("/")[1];t.resultType==="uri"?r({webPath:URL.createObjectURL(a),format:s,saved:!1}):(n.readAsDataURL(a),n.onloadend=()=>{const c=n.result;t.resultType==="dataUrl"?r({dataUrl:c,format:s,saved:!1}):r({base64String:c.split(",")[1],format:s,saved:!1})},n.onerror=c=>{e(c)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const h=P("Camera",{web:()=>new b});async function w(){if(!u.isNativePlatform())return{camera:"granted",photos:"granted"};try{const i=await h.checkPermissions();return{camera:i.camera,photos:i.photos}}catch(i){return console.error("Camera permission check failed:",i),{camera:"denied",photos:"denied"}}}async function v(){if(!u.isNativePlatform())return!0;try{return(await h.requestPermissions({permissions:["camera","photos"]})).camera==="granted"}catch(i){return console.error("Camera permission request failed:",i),!1}}async function R(){var i,a;try{if(u.isNativePlatform()&&(await w()).camera!=="granted"&&!await v())return{success:!1,error:"Camera permission denied. Please allow camera access in your device settings."};const t=await h.getPhoto({quality:90,allowEditing:!1,resultType:f.Base64,source:m.Camera,correctOrientation:!0,width:1920,height:1920});return t.base64String?{success:!0,base64:t.base64String,webPath:t.webPath}:{success:!1,error:"No image captured"}}catch(t){return console.error("Camera capture failed:",t),(i=t==null?void 0:t.message)!=null&&i.includes("cancelled")||(a=t==null?void 0:t.message)!=null&&a.includes("cancel")?{success:!1,error:"cancelled"}:{success:!1,error:(t==null?void 0:t.message)||"Failed to capture photo. Please try again."}}}function _(){return u.isNativePlatform()}export{w as checkCameraPermissions,v as requestCameraPermissions,_ as shouldUseNativeCamera,R as takePhoto};
