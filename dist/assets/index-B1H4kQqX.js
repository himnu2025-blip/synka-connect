const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-CshHWvjz.js","assets/ui-C2Y9OZbz.js","assets/vendor-CwMlj7fn.js","assets/supabase-Co96GwBN.js","assets/web-DGDHb2zM.js","assets/web-DuvxJIk-.js","assets/web-D15kiAaf.js","assets/index-BrBMbTJs.js","assets/web-Dq4vDNC8.js","assets/nativeCamera-CBMP6As-.js"])))=>i.map(i=>d[i]);
var iD=e=>{throw TypeError(e)};var bk=(e,t,n)=>t.has(e)||iD("Cannot "+n);var he=(e,t,n)=>(bk(e,t,"read from private field"),n?n.call(e):t.get(e)),Pt=(e,t,n)=>t.has(e)?iD("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),ht=(e,t,n,r)=>(bk(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Cn=(e,t,n)=>(bk(e,t,"access private method"),n);var jv=(e,t,n,r)=>({set _(a){ht(e,t,a,n)},get _(){return he(e,t,r)}});import{a as wh,r as N,j as i,V as RP,b as DP,A as MP,C as $P,T as FP,D as PP,P as UY,c as Ne,v as VY,d as OP,e as HY,f as GY,g as qY,S as KY,h as LP,i as zP,k as YY,l as BP,I as WP,m as UP,n as VP,o as HP,L as GP,p as qP,q as XY,s as ZY,O as h1,t as O_,u as gr,W as QY,w as p1,x as Mn,y as m1,z as f1,B as L_,E as KP,F as JY,G as dl,H as z_,J as eX,K as g1,M as Gn,N as Yl,Q as Sc,U as nl,X as sb,Y as zl,Z as B_,_ as YP,$ as XP,a0 as ZP,a1 as x1,a2 as QP,a3 as JP,a4 as eO,a5 as tO,a6 as nO,a7 as If,a8 as W_,a9 as rO,aa as aO,ab as tX,ac as nX,ad as rX,ae as sO,af as iO,ag as oO,ah as lO,ai as aX}from"./ui-C2Y9OZbz.js";import{u as Xl,N as s2,a as Pa,L as Bs,O as vk,b as fw,c as cO,d as sX,B as iX,R as oX,e as aa}from"./vendor-CwMlj7fn.js";import{c as lX}from"./supabase-Co96GwBN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();var uO,oD=wh;uO=oD.createRoot,oD.hydrateRoot;const cX=1,uX=1e6;let wk=0;function dX(){return wk=(wk+1)%Number.MAX_SAFE_INTEGER,wk.toString()}const Nk=new Map,lD=e=>{if(Nk.has(e))return;const t=setTimeout(()=>{Nk.delete(e),ey({type:"REMOVE_TOAST",toastId:e})},uX);Nk.set(e,t)},hX=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,cX)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(n=>n.id===t.toast.id?{...n,...t.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=t;return n?lD(n):e.toasts.forEach(r=>{lD(r.id)}),{...e,toasts:e.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(n=>n.id!==t.toastId)}}},gw=[];let xw={toasts:[]};function ey(e){xw=hX(xw,e),gw.forEach(t=>{t(xw)})}function ie({...e}){const t=dX(),n=a=>ey({type:"UPDATE_TOAST",toast:{...a,id:t}}),r=()=>ey({type:"DISMISS_TOAST",toastId:t});return ey({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:a=>{a||r()}}}),{id:t,dismiss:r,update:n}}function pX(){const[e,t]=N.useState(xw);return N.useEffect(()=>(gw.push(t),()=>{const n=gw.indexOf(t);n>-1&&gw.splice(n,1)}),[e]),{...e,toast:ie,dismiss:n=>ey({type:"DISMISS_TOAST",toastId:n})}}function dO(e){var t,n,r="";if(typeof e=="string"||typeof e=="number")r+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(n=dO(e[t]))&&(r&&(r+=" "),r+=n)}else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function hO(){for(var e,t,n=0,r="",a=arguments.length;n<a;n++)(e=arguments[n])&&(t=dO(e))&&(r&&(r+=" "),r+=t);return r}const cD=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,uD=hO,y1=(e,t)=>n=>{var r;if((t==null?void 0:t.variants)==null)return uD(e,n==null?void 0:n.class,n==null?void 0:n.className);const{variants:a,defaultVariants:s}=t,o=Object.keys(a).map(d=>{const u=n==null?void 0:n[d],h=s==null?void 0:s[d];if(u===null)return null;const p=cD(u)||cD(h);return a[d][p]}),l=n&&Object.entries(n).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((d,u)=>{let{class:h,className:p,...m}=u;return Object.entries(m).every(f=>{let[g,x]=f;return Array.isArray(x)?x.includes({...s,...l}[g]):{...s,...l}[g]===x})?[...d,h,p]:d},[]);return uD(e,o,c,n==null?void 0:n.class,n==null?void 0:n.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mX=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pO=(...e)=>e.filter((t,n,r)=>!!t&&t.trim()!==""&&r.indexOf(t)===n).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var fX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gX=N.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:s,iconNode:o,...l},c)=>N.createElement("svg",{ref:c,...fX,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:pO("lucide",a),...l},[...o.map(([d,u])=>N.createElement(d,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=(e,t)=>{const n=N.forwardRef(({className:r,...a},s)=>N.createElement(gX,{ref:s,iconNode:t,className:pO(`lucide-${mX(e)}`,r),...a}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ed=qe("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ni=qe("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xX=qe("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yX=qe("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i2=qe("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bl=qe("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ty=qe("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U_=qe("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=qe("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vy=qe("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mO=qe("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wy=qe("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bX=qe("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vX=qe("CircleArrowDown",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wX=qe("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ho=qe("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fO=qe("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NX=qe("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kX=qe("CirclePlay",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dl=qe("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gO=qe("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=qe("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o2=qe("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=qe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lw=qe("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SX=qe("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CX=qe("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=qe("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dD=qe("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _X=qe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xm=qe("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jX=qe("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IX=qe("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TX=qe("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zw=qe("Fingerprint",[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EX=qe("Focus",[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ny=qe("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ny=qe("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AX=qe("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kk=qe("IndianRupee",[["path",{d:"M6 3h12",key:"ggurg9"}],["path",{d:"M6 8h12",key:"6g4wlu"}],["path",{d:"m6 13 8.5 8",key:"u1kupk"}],["path",{d:"M6 13h3",key:"wdp6ag"}],["path",{d:"M9 13c6.667 0 6.667-10 0-10",key:"1nkvk2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iv=qe("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l2=qe("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xO=qe("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RX=qe("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c2=qe("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DX=qe("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bw=qe("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=qe("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=qe("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yO=qe("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=qe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zm=qe("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hD=qe("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bO=qe("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=qe("Nfc",[["path",{d:"M6 8.32a7.43 7.43 0 0 1 0 7.36",key:"9iaqei"}],["path",{d:"M9.46 6.21a11.76 11.76 0 0 1 0 11.58",key:"1yha7l"}],["path",{d:"M12.91 4.1a15.91 15.91 0 0 1 .01 15.8",key:"4iu2gk"}],["path",{d:"M16.37 2a20.16 20.16 0 0 1 0 20",key:"sap9u2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ry=qe("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vO=qe("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wO=qe("PartyPopper",[["path",{d:"M5.8 11.3 2 22l10.7-3.79",key:"gwxi1d"}],["path",{d:"M4 3h.01",key:"1vcuye"}],["path",{d:"M22 8h.01",key:"1mrtc2"}],["path",{d:"M15 2h.01",key:"1cjtqr"}],["path",{d:"M22 20h.01",key:"1mrys2"}],["path",{d:"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10",key:"hbicv8"}],["path",{d:"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17",key:"1i94pl"}],["path",{d:"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7",key:"1cofks"}],["path",{d:"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z",key:"4kbmks"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const am=qe("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ib=qe("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ky=qe("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=qe("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MX=qe("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nh=qe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $X=qe("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ww=qe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uw=qe("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NO=qe("ScanFace",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["path",{d:"M9 9h.01",key:"1q5me6"}],["path",{d:"M15 9h.01",key:"x1ddxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=qe("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pD=qe("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jc=qe("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=qe("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SO=qe("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CO=qe("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FX=qe("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tf=qe("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=qe("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ay=qe("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sk=qe("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _O=qe("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PX=qe("Tags",[["path",{d:"m15 5 6.3 6.3a2.4 2.4 0 0 1 0 3.4L17 19",key:"1cbfv1"}],["path",{d:"M9.586 5.586A2 2 0 0 0 8.172 5H3a1 1 0 0 0-1 1v5.172a2 2 0 0 0 .586 1.414L8.29 18.29a2.426 2.426 0 0 0 3.42 0l3.58-3.58a2.426 2.426 0 0 0 0-3.42z",key:"135mg7"}],["circle",{cx:"6.5",cy:"9.5",r:".5",fill:"currentColor",key:"5pm5xn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=qe("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jO=qe("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=qe("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=qe("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fo=qe("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mD=qe("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OX=qe("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h2=qe("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ad=qe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eu=qe("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=qe("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IO=qe("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),H_="-",LX=e=>{const t=BX(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:o=>{const l=o.split(H_);return l[0]===""&&l.length!==1&&l.shift(),TO(l,t)||zX(o)},getConflictingClassGroupIds:(o,l)=>{const c=n[o]||[];return l&&r[o]?[...c,...r[o]]:c}}},TO=(e,t)=>{var o;if(e.length===0)return t.classGroupId;const n=e[0],r=t.nextPart.get(n),a=r?TO(e.slice(1),r):void 0;if(a)return a;if(t.validators.length===0)return;const s=e.join(H_);return(o=t.validators.find(({validator:l})=>l(s)))==null?void 0:o.classGroupId},fD=/^\[(.+)\]$/,zX=e=>{if(fD.test(e)){const t=fD.exec(e)[1],n=t==null?void 0:t.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}},BX=e=>{const{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return UX(Object.entries(e.classGroups),n).forEach(([s,o])=>{p2(o,r,s,t)}),r},p2=(e,t,n,r)=>{e.forEach(a=>{if(typeof a=="string"){const s=a===""?t:gD(t,a);s.classGroupId=n;return}if(typeof a=="function"){if(WX(a)){p2(a(r),t,n,r);return}t.validators.push({validator:a,classGroupId:n});return}Object.entries(a).forEach(([s,o])=>{p2(o,gD(t,s),n,r)})})},gD=(e,t)=>{let n=e;return t.split(H_).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},WX=e=>e.isThemeGetter,UX=(e,t)=>t?e.map(([n,r])=>{const a=r.map(s=>typeof s=="string"?t+s:typeof s=="object"?Object.fromEntries(Object.entries(s).map(([o,l])=>[t+o,l])):s);return[n,a]}):e,VX=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,n=new Map,r=new Map;const a=(s,o)=>{n.set(s,o),t++,t>e&&(t=0,r=n,n=new Map)};return{get(s){let o=n.get(s);if(o!==void 0)return o;if((o=r.get(s))!==void 0)return a(s,o),o},set(s,o){n.has(s)?n.set(s,o):a(s,o)}}},EO="!",HX=e=>{const{separator:t,experimentalParseClassName:n}=e,r=t.length===1,a=t[0],s=t.length,o=l=>{const c=[];let d=0,u=0,h;for(let x=0;x<l.length;x++){let y=l[x];if(d===0){if(y===a&&(r||l.slice(x,x+s)===t)){c.push(l.slice(u,x)),u=x+s;continue}if(y==="/"){h=x;continue}}y==="["?d++:y==="]"&&d--}const p=c.length===0?l:l.substring(u),m=p.startsWith(EO),f=m?p.substring(1):p,g=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:f,maybePostfixModifierPosition:g}};return n?l=>n({className:l,parseClassName:o}):o},GX=e=>{if(e.length<=1)return e;const t=[];let n=[];return e.forEach(r=>{r[0]==="["?(t.push(...n.sort(),r),n=[]):n.push(r)}),t.push(...n.sort()),t},qX=e=>({cache:VX(e.cacheSize),parseClassName:HX(e),...LX(e)}),KX=/\s+/,YX=(e,t)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a}=t,s=[],o=e.trim().split(KX);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:m}=n(d);let f=!!m,g=r(f?p.substring(0,m):p);if(!g){if(!f){l=d+(l.length>0?" "+l:l);continue}if(g=r(p),!g){l=d+(l.length>0?" "+l:l);continue}f=!1}const x=GX(u).join(":"),y=h?x+EO:x,b=y+g;if(s.includes(b))continue;s.push(b);const v=a(g,f);for(let w=0;w<v.length;++w){const k=v[w];s.push(y+k)}l=d+(l.length>0?" "+l:l)}return l};function XX(){let e=0,t,n,r="";for(;e<arguments.length;)(t=arguments[e++])&&(n=AO(t))&&(r&&(r+=" "),r+=n);return r}const AO=e=>{if(typeof e=="string")return e;let t,n="";for(let r=0;r<e.length;r++)e[r]&&(t=AO(e[r]))&&(n&&(n+=" "),n+=t);return n};function ZX(e,...t){let n,r,a,s=o;function o(c){const d=t.reduce((u,h)=>h(u),e());return n=qX(d),r=n.cache.get,a=n.cache.set,s=l,l(c)}function l(c){const d=r(c);if(d)return d;const u=YX(c,n);return a(c,u),u}return function(){return s(XX.apply(null,arguments))}}const Er=e=>{const t=n=>n[e]||[];return t.isThemeGetter=!0,t},RO=/^\[(?:([a-z-]+):)?(.+)\]$/i,QX=/^\d+\/\d+$/,JX=new Set(["px","full","screen"]),eZ=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,tZ=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,nZ=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,rZ=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,aZ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Nl=e=>_m(e)||JX.has(e)||QX.test(e),cc=e=>Ef(e,"length",hZ),_m=e=>!!e&&!Number.isNaN(Number(e)),Ck=e=>Ef(e,"number",_m),dx=e=>!!e&&Number.isInteger(Number(e)),sZ=e=>e.endsWith("%")&&_m(e.slice(0,-1)),gn=e=>RO.test(e),uc=e=>eZ.test(e),iZ=new Set(["length","size","percentage"]),oZ=e=>Ef(e,iZ,DO),lZ=e=>Ef(e,"position",DO),cZ=new Set(["image","url"]),uZ=e=>Ef(e,cZ,mZ),dZ=e=>Ef(e,"",pZ),hx=()=>!0,Ef=(e,t,n)=>{const r=RO.exec(e);return r?r[1]?typeof t=="string"?r[1]===t:t.has(r[1]):n(r[2]):!1},hZ=e=>tZ.test(e)&&!nZ.test(e),DO=()=>!1,pZ=e=>rZ.test(e),mZ=e=>aZ.test(e),fZ=()=>{const e=Er("colors"),t=Er("spacing"),n=Er("blur"),r=Er("brightness"),a=Er("borderColor"),s=Er("borderRadius"),o=Er("borderSpacing"),l=Er("borderWidth"),c=Er("contrast"),d=Er("grayscale"),u=Er("hueRotate"),h=Er("invert"),p=Er("gap"),m=Er("gradientColorStops"),f=Er("gradientColorStopPositions"),g=Er("inset"),x=Er("margin"),y=Er("opacity"),b=Er("padding"),v=Er("saturate"),w=Er("scale"),k=Er("sepia"),C=Er("skew"),S=Er("space"),_=Er("translate"),I=()=>["auto","contain","none"],T=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto",gn,t],j=()=>[gn,t],D=()=>["",Nl,cc],F=()=>["auto",_m,gn],B=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],q=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],L=()=>["start","end","center","between","around","evenly","stretch"],M=()=>["","0",gn],X=()=>["auto","avoid","all","avoid-page","page","left","right","column"],G=()=>[_m,gn];return{cacheSize:500,separator:":",theme:{colors:[hx],spacing:[Nl,cc],blur:["none","",uc,gn],brightness:G(),borderColor:[e],borderRadius:["none","","full",uc,gn],borderSpacing:j(),borderWidth:D(),contrast:G(),grayscale:M(),hueRotate:G(),invert:M(),gap:j(),gradientColorStops:[e],gradientColorStopPositions:[sZ,cc],inset:A(),margin:A(),opacity:G(),padding:j(),saturate:G(),scale:G(),sepia:M(),skew:G(),space:j(),translate:j()},classGroups:{aspect:[{aspect:["auto","square","video",gn]}],container:["container"],columns:[{columns:[uc]}],"break-after":[{"break-after":X()}],"break-before":[{"break-before":X()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...B(),gn]}],overflow:[{overflow:T()}],"overflow-x":[{"overflow-x":T()}],"overflow-y":[{"overflow-y":T()}],overscroll:[{overscroll:I()}],"overscroll-x":[{"overscroll-x":I()}],"overscroll-y":[{"overscroll-y":I()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",dx,gn]}],basis:[{basis:A()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",gn]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:["first","last","none",dx,gn]}],"grid-cols":[{"grid-cols":[hx]}],"col-start-end":[{col:["auto",{span:["full",dx,gn]},gn]}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":[hx]}],"row-start-end":[{row:["auto",{span:[dx,gn]},gn]}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",gn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",gn]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...L()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...L(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...L(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[x]}],mx:[{mx:[x]}],my:[{my:[x]}],ms:[{ms:[x]}],me:[{me:[x]}],mt:[{mt:[x]}],mr:[{mr:[x]}],mb:[{mb:[x]}],ml:[{ml:[x]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",gn,t]}],"min-w":[{"min-w":[gn,t,"min","max","fit"]}],"max-w":[{"max-w":[gn,t,"none","full","min","max","fit","prose",{screen:[uc]},uc]}],h:[{h:[gn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[gn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[gn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[gn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",uc,cc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ck]}],"font-family":[{font:[hx]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",gn]}],"line-clamp":[{"line-clamp":["none",_m,Ck]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Nl,gn]}],"list-image":[{"list-image":["none",gn]}],"list-style-type":[{list:["none","disc","decimal",gn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[y]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[y]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...q(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Nl,cc]}],"underline-offset":[{"underline-offset":["auto",Nl,gn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:j()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",gn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",gn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[y]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...B(),lZ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",oZ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},uZ]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[f]}],"gradient-via-pos":[{via:[f]}],"gradient-to-pos":[{to:[f]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[y]}],"border-style":[{border:[...q(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[y]}],"divide-style":[{divide:q()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...q()]}],"outline-offset":[{"outline-offset":[Nl,gn]}],"outline-w":[{outline:[Nl,cc]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:D()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[y]}],"ring-offset-w":[{"ring-offset":[Nl,cc]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",uc,dZ]}],"shadow-color":[{shadow:[hx]}],opacity:[{opacity:[y]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",uc,gn]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[v]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[y]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",gn]}],duration:[{duration:G()}],ease:[{ease:["linear","in","out","in-out",gn]}],delay:[{delay:G()}],animate:[{animate:["none","spin","ping","pulse","bounce",gn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[w]}],"scale-x":[{"scale-x":[w]}],"scale-y":[{"scale-y":[w]}],rotate:[{rotate:[dx,gn]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",gn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",gn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":j()}],"scroll-mx":[{"scroll-mx":j()}],"scroll-my":[{"scroll-my":j()}],"scroll-ms":[{"scroll-ms":j()}],"scroll-me":[{"scroll-me":j()}],"scroll-mt":[{"scroll-mt":j()}],"scroll-mr":[{"scroll-mr":j()}],"scroll-mb":[{"scroll-mb":j()}],"scroll-ml":[{"scroll-ml":j()}],"scroll-p":[{"scroll-p":j()}],"scroll-px":[{"scroll-px":j()}],"scroll-py":[{"scroll-py":j()}],"scroll-ps":[{"scroll-ps":j()}],"scroll-pe":[{"scroll-pe":j()}],"scroll-pt":[{"scroll-pt":j()}],"scroll-pr":[{"scroll-pr":j()}],"scroll-pb":[{"scroll-pb":j()}],"scroll-pl":[{"scroll-pl":j()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",gn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Nl,cc,Ck]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},gZ=ZX(fZ);function Ie(...e){return gZ(hO(e))}function xZ(e){if(!e)return"";const t=new Date(e),n=String(t.getDate()).padStart(2,"0"),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],s=t.getFullYear(),o=t.getHours(),l=String(t.getMinutes()).padStart(2,"0"),c=o>=12?"PM":"AM",d=o%12||12;return`${n} ${a} ${s}, ${String(d).padStart(2,"0")}:${l} ${c}`}const Tv=xZ;function yZ(e){if(!e)return"";const t=new Date(e),n=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return`${n}-${r}-${a}T${s}:${o}`}const xD=yZ,bZ=UY,MO=N.forwardRef(({className:e,...t},n)=>i.jsx(RP,{ref:n,className:Ie("fixed top-0 z-[3000] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));MO.displayName=RP.displayName;const vZ=y1("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$O=N.forwardRef(({className:e,variant:t,...n},r)=>i.jsx(DP,{ref:r,className:Ie(vZ({variant:t}),e),...n}));$O.displayName=DP.displayName;const wZ=N.forwardRef(({className:e,...t},n)=>i.jsx(MP,{ref:n,className:Ie("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));wZ.displayName=MP.displayName;const FO=N.forwardRef(({className:e,...t},n)=>i.jsx($P,{ref:n,className:Ie("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:i.jsx(ui,{className:"h-4 w-4"})}));FO.displayName=$P.displayName;const PO=N.forwardRef(({className:e,...t},n)=>i.jsx(FP,{ref:n,className:Ie("text-sm font-semibold",e),...t}));PO.displayName=FP.displayName;const OO=N.forwardRef(({className:e,...t},n)=>i.jsx(PP,{ref:n,className:Ie("text-sm opacity-90",e),...t}));OO.displayName=PP.displayName;function NZ(){const{toasts:e}=pX();return i.jsxs(bZ,{children:[e.map(function({id:t,title:n,description:r,action:a,...s}){return i.jsxs($O,{...s,children:[i.jsxs("div",{className:"grid gap-1",children:[n&&i.jsx(PO,{children:n}),r&&i.jsx(OO,{children:r})]}),a,i.jsx(FO,{})]},t)}),i.jsx(MO,{})]})}var yD=["light","dark"],kZ="(prefers-color-scheme: dark)",SZ=N.createContext(void 0),CZ={setTheme:e=>{},themes:[]},_Z=()=>{var e;return(e=N.useContext(SZ))!=null?e:CZ};N.memo(({forcedTheme:e,storageKey:t,attribute:n,enableSystem:r,enableColorScheme:a,defaultTheme:s,value:o,attrs:l,nonce:c})=>{let d=s==="system",u=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${l.map(f=>`'${f}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,h=a?yD.includes(s)&&s?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${s}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",p=(f,g=!1,x=!0)=>{let y=o?o[f]:f,b=g?f+"|| ''":`'${y}'`,v="";return a&&x&&!g&&yD.includes(f)&&(v+=`d.style.colorScheme = '${f}';`),n==="class"?g||y?v+=`c.add(${b})`:v+="null":y&&(v+=`d[s](n,${b})`),v},m=e?`!function(){${u}${p(e)}}()`:r?`!function(){try{${u}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${d})){var t='${kZ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${p("dark")}}else{${p("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}${d?"":"else{"+p(s,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${u}var e=localStorage.getItem('${t}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${p(o?"x[e]":"e",!0)}}else{${p(s,!1,!1)};}${h}}catch(t){}}();`;return N.createElement("script",{nonce:c,dangerouslySetInnerHTML:{__html:m}})});var jZ=e=>{switch(e){case"success":return EZ;case"info":return RZ;case"warning":return AZ;case"error":return DZ;default:return null}},IZ=Array(12).fill(0),TZ=({visible:e,className:t})=>Ne.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},Ne.createElement("div",{className:"sonner-spinner"},IZ.map((n,r)=>Ne.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),EZ=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),AZ=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),RZ=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),DZ=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ne.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),MZ=Ne.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ne.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ne.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),$Z=()=>{let[e,t]=Ne.useState(document.hidden);return Ne.useEffect(()=>{let n=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),e},m2=1,FZ=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let n=this.subscribers.indexOf(t);this.subscribers.splice(n,1)}),this.publish=t=>{this.subscribers.forEach(n=>n(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var n;let{message:r,...a}=t,s=typeof(t==null?void 0:t.id)=="number"||((n=t.id)==null?void 0:n.length)>0?t.id:m2++,o=this.toasts.find(c=>c.id===s),l=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),o?this.toasts=this.toasts.map(c=>c.id===s?(this.publish({...c,...t,id:s,title:r}),{...c,...t,id:s,dismissible:l,title:r}):c):this.addToast({title:r,...a,dismissible:l,id:s}),s},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(n=>{this.subscribers.forEach(r=>r({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:t,dismiss:!0})),t),this.message=(t,n)=>this.create({...n,message:t}),this.error=(t,n)=>this.create({...n,message:t,type:"error"}),this.success=(t,n)=>this.create({...n,type:"success",message:t}),this.info=(t,n)=>this.create({...n,type:"info",message:t}),this.warning=(t,n)=>this.create({...n,type:"warning",message:t}),this.loading=(t,n)=>this.create({...n,type:"loading",message:t}),this.promise=(t,n)=>{if(!n)return;let r;n.loading!==void 0&&(r=this.create({...n,promise:t,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let a=t instanceof Promise?t:t(),s=r!==void 0,o,l=a.then(async d=>{if(o=["resolve",d],Ne.isValidElement(d))s=!1,this.create({id:r,type:"default",message:d});else if(OZ(d)&&!d.ok){s=!1;let u=typeof n.error=="function"?await n.error(`HTTP error! status: ${d.status}`):n.error,h=typeof n.description=="function"?await n.description(`HTTP error! status: ${d.status}`):n.description;this.create({id:r,type:"error",message:u,description:h})}else if(n.success!==void 0){s=!1;let u=typeof n.success=="function"?await n.success(d):n.success,h=typeof n.description=="function"?await n.description(d):n.description;this.create({id:r,type:"success",message:u,description:h})}}).catch(async d=>{if(o=["reject",d],n.error!==void 0){s=!1;let u=typeof n.error=="function"?await n.error(d):n.error,h=typeof n.description=="function"?await n.description(d):n.description;this.create({id:r,type:"error",message:u,description:h})}}).finally(()=>{var d;s&&(this.dismiss(r),r=void 0),(d=n.finally)==null||d.call(n)}),c=()=>new Promise((d,u)=>l.then(()=>o[0]==="reject"?u(o[1]):d(o[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:c}:Object.assign(r,{unwrap:c})},this.custom=(t,n)=>{let r=(n==null?void 0:n.id)||m2++;return this.create({jsx:t(r),id:r,...n}),r},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},$s=new FZ,PZ=(e,t)=>{let n=(t==null?void 0:t.id)||m2++;return $s.addToast({title:e,...t,id:n}),n},OZ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",LZ=PZ,zZ=()=>$s.toasts,BZ=()=>$s.getActiveToasts(),It=Object.assign(LZ,{success:$s.success,info:$s.info,warning:$s.warning,error:$s.error,custom:$s.custom,message:$s.message,promise:$s.promise,dismiss:$s.dismiss,loading:$s.loading},{getHistory:zZ,getToasts:BZ});function WZ(e,{insertAt:t}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",t==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}WZ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Ev(e){return e.label!==void 0}var UZ=3,VZ="32px",HZ="16px",bD=4e3,GZ=356,qZ=14,KZ=20,YZ=200;function Zi(...e){return e.filter(Boolean).join(" ")}function XZ(e){let[t,n]=e.split("-"),r=[];return t&&r.push(t),n&&r.push(n),r}var ZZ=e=>{var t,n,r,a,s,o,l,c,d,u,h;let{invert:p,toast:m,unstyled:f,interacting:g,setHeights:x,visibleToasts:y,heights:b,index:v,toasts:w,expanded:k,removeToast:C,defaultRichColors:S,closeButton:_,style:I,cancelButtonStyle:T,actionButtonStyle:A,className:j="",descriptionClassName:D="",duration:F,position:B,gap:q,loadingIcon:$,expandByDefault:L,classNames:M,icons:X,closeButtonAriaLabel:G="Close toast",pauseWhenPageIsHidden:W}=e,[O,U]=Ne.useState(null),[K,ce]=Ne.useState(null),[ne,te]=Ne.useState(!1),[Te,Ae]=Ne.useState(!1),[Se,we]=Ne.useState(!1),[Fe,Q]=Ne.useState(!1),[$e,Le]=Ne.useState(!1),[Xe,Ye]=Ne.useState(0),[Je,le]=Ne.useState(0),V=Ne.useRef(m.duration||F||bD),ee=Ne.useRef(null),ve=Ne.useRef(null),ke=v===0,Ce=v+1<=y,be=m.type,Ee=m.dismissible!==!1,Ue=m.className||"",Qe=m.descriptionClassName||"",_t=Ne.useMemo(()=>b.findIndex(it=>it.toastId===m.id)||0,[b,m.id]),$t=Ne.useMemo(()=>{var it;return(it=m.closeButton)!=null?it:_},[m.closeButton,_]),Ve=Ne.useMemo(()=>m.duration||F||bD,[m.duration,F]),tt=Ne.useRef(0),yt=Ne.useRef(0),ut=Ne.useRef(0),qt=Ne.useRef(null),[an,lt]=B.split("-"),wt=Ne.useMemo(()=>b.reduce((it,ge,De)=>De>=_t?it:it+ge.height,0),[b,_t]),Nt=$Z(),Kt=m.invert||p,jt=be==="loading";yt.current=Ne.useMemo(()=>_t*q+wt,[_t,wt]),Ne.useEffect(()=>{V.current=Ve},[Ve]),Ne.useEffect(()=>{te(!0)},[]),Ne.useEffect(()=>{let it=ve.current;if(it){let ge=it.getBoundingClientRect().height;return le(ge),x(De=>[{toastId:m.id,height:ge,position:m.position},...De]),()=>x(De=>De.filter(Ke=>Ke.toastId!==m.id))}},[x,m.id]),Ne.useLayoutEffect(()=>{if(!ne)return;let it=ve.current,ge=it.style.height;it.style.height="auto";let De=it.getBoundingClientRect().height;it.style.height=ge,le(De),x(Ke=>Ke.find(ze=>ze.toastId===m.id)?Ke.map(ze=>ze.toastId===m.id?{...ze,height:De}:ze):[{toastId:m.id,height:De,position:m.position},...Ke])},[ne,m.title,m.description,x,m.id]);let Zt=Ne.useCallback(()=>{Ae(!0),Ye(yt.current),x(it=>it.filter(ge=>ge.toastId!==m.id)),setTimeout(()=>{C(m)},YZ)},[m,C,x,yt]);Ne.useEffect(()=>{if(m.promise&&be==="loading"||m.duration===1/0||m.type==="loading")return;let it;return k||g||W&&Nt?(()=>{if(ut.current<tt.current){let ge=new Date().getTime()-tt.current;V.current=V.current-ge}ut.current=new Date().getTime()})():V.current!==1/0&&(tt.current=new Date().getTime(),it=setTimeout(()=>{var ge;(ge=m.onAutoClose)==null||ge.call(m,m),Zt()},V.current)),()=>clearTimeout(it)},[k,g,m,be,W,Nt,Zt]),Ne.useEffect(()=>{m.delete&&Zt()},[Zt,m.delete]);function An(){var it,ge,De;return X!=null&&X.loading?Ne.createElement("div",{className:Zi(M==null?void 0:M.loader,(it=m==null?void 0:m.classNames)==null?void 0:it.loader,"sonner-loader"),"data-visible":be==="loading"},X.loading):$?Ne.createElement("div",{className:Zi(M==null?void 0:M.loader,(ge=m==null?void 0:m.classNames)==null?void 0:ge.loader,"sonner-loader"),"data-visible":be==="loading"},$):Ne.createElement(TZ,{className:Zi(M==null?void 0:M.loader,(De=m==null?void 0:m.classNames)==null?void 0:De.loader),visible:be==="loading"})}return Ne.createElement("li",{tabIndex:0,ref:ve,className:Zi(j,Ue,M==null?void 0:M.toast,(t=m==null?void 0:m.classNames)==null?void 0:t.toast,M==null?void 0:M.default,M==null?void 0:M[be],(n=m==null?void 0:m.classNames)==null?void 0:n[be]),"data-sonner-toast":"","data-rich-colors":(r=m.richColors)!=null?r:S,"data-styled":!(m.jsx||m.unstyled||f),"data-mounted":ne,"data-promise":!!m.promise,"data-swiped":$e,"data-removed":Te,"data-visible":Ce,"data-y-position":an,"data-x-position":lt,"data-index":v,"data-front":ke,"data-swiping":Se,"data-dismissible":Ee,"data-type":be,"data-invert":Kt,"data-swipe-out":Fe,"data-swipe-direction":K,"data-expanded":!!(k||L&&ne),style:{"--index":v,"--toasts-before":v,"--z-index":w.length-v,"--offset":`${Te?Xe:yt.current}px`,"--initial-height":L?"auto":`${Je}px`,...I,...m.style},onDragEnd:()=>{we(!1),U(null),qt.current=null},onPointerDown:it=>{jt||!Ee||(ee.current=new Date,Ye(yt.current),it.target.setPointerCapture(it.pointerId),it.target.tagName!=="BUTTON"&&(we(!0),qt.current={x:it.clientX,y:it.clientY}))},onPointerUp:()=>{var it,ge,De,Ke;if(Fe||!Ee)return;qt.current=null;let ze=Number(((it=ve.current)==null?void 0:it.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Bt=Number(((ge=ve.current)==null?void 0:ge.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Qt=new Date().getTime()-((De=ee.current)==null?void 0:De.getTime()),rt=O==="x"?ze:Bt,gt=Math.abs(rt)/Qt;if(Math.abs(rt)>=KZ||gt>.11){Ye(yt.current),(Ke=m.onDismiss)==null||Ke.call(m,m),ce(O==="x"?ze>0?"right":"left":Bt>0?"down":"up"),Zt(),Q(!0),Le(!1);return}we(!1),U(null)},onPointerMove:it=>{var ge,De,Ke,ze;if(!qt.current||!Ee||((ge=window.getSelection())==null?void 0:ge.toString().length)>0)return;let Bt=it.clientY-qt.current.y,Qt=it.clientX-qt.current.x,rt=(De=e.swipeDirections)!=null?De:XZ(B);!O&&(Math.abs(Qt)>1||Math.abs(Bt)>1)&&U(Math.abs(Qt)>Math.abs(Bt)?"x":"y");let gt={x:0,y:0};O==="y"?(rt.includes("top")||rt.includes("bottom"))&&(rt.includes("top")&&Bt<0||rt.includes("bottom")&&Bt>0)&&(gt.y=Bt):O==="x"&&(rt.includes("left")||rt.includes("right"))&&(rt.includes("left")&&Qt<0||rt.includes("right")&&Qt>0)&&(gt.x=Qt),(Math.abs(gt.x)>0||Math.abs(gt.y)>0)&&Le(!0),(Ke=ve.current)==null||Ke.style.setProperty("--swipe-amount-x",`${gt.x}px`),(ze=ve.current)==null||ze.style.setProperty("--swipe-amount-y",`${gt.y}px`)}},$t&&!m.jsx?Ne.createElement("button",{"aria-label":G,"data-disabled":jt,"data-close-button":!0,onClick:jt||!Ee?()=>{}:()=>{var it;Zt(),(it=m.onDismiss)==null||it.call(m,m)},className:Zi(M==null?void 0:M.closeButton,(a=m==null?void 0:m.classNames)==null?void 0:a.closeButton)},(s=X==null?void 0:X.close)!=null?s:MZ):null,m.jsx||N.isValidElement(m.title)?m.jsx?m.jsx:typeof m.title=="function"?m.title():m.title:Ne.createElement(Ne.Fragment,null,be||m.icon||m.promise?Ne.createElement("div",{"data-icon":"",className:Zi(M==null?void 0:M.icon,(o=m==null?void 0:m.classNames)==null?void 0:o.icon)},m.promise||m.type==="loading"&&!m.icon?m.icon||An():null,m.type!=="loading"?m.icon||(X==null?void 0:X[be])||jZ(be):null):null,Ne.createElement("div",{"data-content":"",className:Zi(M==null?void 0:M.content,(l=m==null?void 0:m.classNames)==null?void 0:l.content)},Ne.createElement("div",{"data-title":"",className:Zi(M==null?void 0:M.title,(c=m==null?void 0:m.classNames)==null?void 0:c.title)},typeof m.title=="function"?m.title():m.title),m.description?Ne.createElement("div",{"data-description":"",className:Zi(D,Qe,M==null?void 0:M.description,(d=m==null?void 0:m.classNames)==null?void 0:d.description)},typeof m.description=="function"?m.description():m.description):null),N.isValidElement(m.cancel)?m.cancel:m.cancel&&Ev(m.cancel)?Ne.createElement("button",{"data-button":!0,"data-cancel":!0,style:m.cancelButtonStyle||T,onClick:it=>{var ge,De;Ev(m.cancel)&&Ee&&((De=(ge=m.cancel).onClick)==null||De.call(ge,it),Zt())},className:Zi(M==null?void 0:M.cancelButton,(u=m==null?void 0:m.classNames)==null?void 0:u.cancelButton)},m.cancel.label):null,N.isValidElement(m.action)?m.action:m.action&&Ev(m.action)?Ne.createElement("button",{"data-button":!0,"data-action":!0,style:m.actionButtonStyle||A,onClick:it=>{var ge,De;Ev(m.action)&&((De=(ge=m.action).onClick)==null||De.call(ge,it),!it.defaultPrevented&&Zt())},className:Zi(M==null?void 0:M.actionButton,(h=m==null?void 0:m.classNames)==null?void 0:h.actionButton)},m.action.label):null))};function vD(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function QZ(e,t){let n={};return[e,t].forEach((r,a)=>{let s=a===1,o=s?"--mobile-offset":"--offset",l=s?HZ:VZ;function c(d){["top","right","bottom","left"].forEach(u=>{n[`${o}-${u}`]=typeof d=="number"?`${d}px`:d})}typeof r=="number"||typeof r=="string"?c(r):typeof r=="object"?["top","right","bottom","left"].forEach(d=>{r[d]===void 0?n[`${o}-${d}`]=l:n[`${o}-${d}`]=typeof r[d]=="number"?`${r[d]}px`:r[d]}):c(l)}),n}var JZ=N.forwardRef(function(e,t){let{invert:n,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:s,closeButton:o,className:l,offset:c,mobileOffset:d,theme:u="light",richColors:h,duration:p,style:m,visibleToasts:f=UZ,toastOptions:g,dir:x=vD(),gap:y=qZ,loadingIcon:b,icons:v,containerAriaLabel:w="Notifications",pauseWhenPageIsHidden:k}=e,[C,S]=Ne.useState([]),_=Ne.useMemo(()=>Array.from(new Set([r].concat(C.filter(W=>W.position).map(W=>W.position)))),[C,r]),[I,T]=Ne.useState([]),[A,j]=Ne.useState(!1),[D,F]=Ne.useState(!1),[B,q]=Ne.useState(u!=="system"?u:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),$=Ne.useRef(null),L=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),M=Ne.useRef(null),X=Ne.useRef(!1),G=Ne.useCallback(W=>{S(O=>{var U;return(U=O.find(K=>K.id===W.id))!=null&&U.delete||$s.dismiss(W.id),O.filter(({id:K})=>K!==W.id)})},[]);return Ne.useEffect(()=>$s.subscribe(W=>{if(W.dismiss){S(O=>O.map(U=>U.id===W.id?{...U,delete:!0}:U));return}setTimeout(()=>{VY.flushSync(()=>{S(O=>{let U=O.findIndex(K=>K.id===W.id);return U!==-1?[...O.slice(0,U),{...O[U],...W},...O.slice(U+1)]:[W,...O]})})})}),[]),Ne.useEffect(()=>{if(u!=="system"){q(u);return}if(u==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?q("dark"):q("light")),typeof window>"u")return;let W=window.matchMedia("(prefers-color-scheme: dark)");try{W.addEventListener("change",({matches:O})=>{q(O?"dark":"light")})}catch{W.addListener(({matches:U})=>{try{q(U?"dark":"light")}catch(K){console.error(K)}})}},[u]),Ne.useEffect(()=>{C.length<=1&&j(!1)},[C]),Ne.useEffect(()=>{let W=O=>{var U,K;a.every(ce=>O[ce]||O.code===ce)&&(j(!0),(U=$.current)==null||U.focus()),O.code==="Escape"&&(document.activeElement===$.current||(K=$.current)!=null&&K.contains(document.activeElement))&&j(!1)};return document.addEventListener("keydown",W),()=>document.removeEventListener("keydown",W)},[a]),Ne.useEffect(()=>{if($.current)return()=>{M.current&&(M.current.focus({preventScroll:!0}),M.current=null,X.current=!1)}},[$.current]),Ne.createElement("section",{ref:t,"aria-label":`${w} ${L}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},_.map((W,O)=>{var U;let[K,ce]=W.split("-");return C.length?Ne.createElement("ol",{key:W,dir:x==="auto"?vD():x,tabIndex:-1,ref:$,className:l,"data-sonner-toaster":!0,"data-theme":B,"data-y-position":K,"data-lifted":A&&C.length>1&&!s,"data-x-position":ce,style:{"--front-toast-height":`${((U=I[0])==null?void 0:U.height)||0}px`,"--width":`${GZ}px`,"--gap":`${y}px`,...m,...QZ(c,d)},onBlur:ne=>{X.current&&!ne.currentTarget.contains(ne.relatedTarget)&&(X.current=!1,M.current&&(M.current.focus({preventScroll:!0}),M.current=null))},onFocus:ne=>{ne.target instanceof HTMLElement&&ne.target.dataset.dismissible==="false"||X.current||(X.current=!0,M.current=ne.relatedTarget)},onMouseEnter:()=>j(!0),onMouseMove:()=>j(!0),onMouseLeave:()=>{D||j(!1)},onDragEnd:()=>j(!1),onPointerDown:ne=>{ne.target instanceof HTMLElement&&ne.target.dataset.dismissible==="false"||F(!0)},onPointerUp:()=>F(!1)},C.filter(ne=>!ne.position&&O===0||ne.position===W).map((ne,te)=>{var Te,Ae;return Ne.createElement(ZZ,{key:ne.id,icons:v,index:te,toast:ne,defaultRichColors:h,duration:(Te=g==null?void 0:g.duration)!=null?Te:p,className:g==null?void 0:g.className,descriptionClassName:g==null?void 0:g.descriptionClassName,invert:n,visibleToasts:f,closeButton:(Ae=g==null?void 0:g.closeButton)!=null?Ae:o,interacting:D,position:W,style:g==null?void 0:g.style,unstyled:g==null?void 0:g.unstyled,classNames:g==null?void 0:g.classNames,cancelButtonStyle:g==null?void 0:g.cancelButtonStyle,actionButtonStyle:g==null?void 0:g.actionButtonStyle,removeToast:G,toasts:C.filter(Se=>Se.position==ne.position),heights:I.filter(Se=>Se.position==ne.position),setHeights:T,expandByDefault:s,gap:y,loadingIcon:b,expanded:A,pauseWhenPageIsHidden:k,swipeDirections:e.swipeDirections})})):null}))});const eQ=({...e})=>{const{theme:t="system"}=_Z();return i.jsx(JZ,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},LO=HY,Av=GY,Rv=qY,Fx=N.forwardRef(({className:e,sideOffset:t=4,...n},r)=>i.jsx(OP,{ref:r,sideOffset:t,className:Ie("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));Fx.displayName=OP.displayName;var Af=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},tQ={setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e),setInterval:(e,t)=>setInterval(e,t),clearInterval:e=>clearInterval(e)},Ic,P_,wP,nQ=(wP=class{constructor(){Pt(this,Ic,tQ);Pt(this,P_,!1)}setTimeoutProvider(e){ht(this,Ic,e)}setTimeout(e,t){return he(this,Ic).setTimeout(e,t)}clearTimeout(e){he(this,Ic).clearTimeout(e)}setInterval(e,t){return he(this,Ic).setInterval(e,t)}clearInterval(e){he(this,Ic).clearInterval(e)}},Ic=new WeakMap,P_=new WeakMap,wP),pd=new nQ;function rQ(e){setTimeout(e,0)}var zd=typeof window>"u"||"Deno"in globalThis;function ps(){}function aQ(e,t){return typeof e=="function"?e(t):e}function f2(e){return typeof e=="number"&&e>=0&&e!==1/0}function zO(e,t){return Math.max(e+(t||0)-Date.now(),0)}function Uc(e,t){return typeof e=="function"?e(t):e}function Ai(e,t){return typeof e=="function"?e(t):e}function wD(e,t){const{type:n="all",exact:r,fetchStatus:a,predicate:s,queryKey:o,stale:l}=e;if(o){if(r){if(t.queryHash!==G_(o,t.options))return!1}else if(!Sy(t.queryKey,o))return!1}if(n!=="all"){const c=t.isActive();if(n==="active"&&!c||n==="inactive"&&c)return!1}return!(typeof l=="boolean"&&t.isStale()!==l||a&&a!==t.state.fetchStatus||s&&!s(t))}function ND(e,t){const{exact:n,status:r,predicate:a,mutationKey:s}=e;if(s){if(!t.options.mutationKey)return!1;if(n){if(Bd(t.options.mutationKey)!==Bd(s))return!1}else if(!Sy(t.options.mutationKey,s))return!1}return!(r&&t.state.status!==r||a&&!a(t))}function G_(e,t){return((t==null?void 0:t.queryKeyHashFn)||Bd)(e)}function Bd(e){return JSON.stringify(e,(t,n)=>g2(n)?Object.keys(n).sort().reduce((r,a)=>(r[a]=n[a],r),{}):n)}function Sy(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(n=>Sy(e[n],t[n])):!1}var sQ=Object.prototype.hasOwnProperty;function BO(e,t,n=0){if(e===t)return e;if(n>500)return t;const r=kD(e)&&kD(t);if(!r&&!(g2(e)&&g2(t)))return t;const s=(r?e:Object.keys(e)).length,o=r?t:Object.keys(t),l=o.length,c=r?new Array(l):{};let d=0;for(let u=0;u<l;u++){const h=r?u:o[u],p=e[h],m=t[h];if(p===m){c[h]=p,(r?u<s:sQ.call(e,h))&&d++;continue}if(p===null||m===null||typeof p!="object"||typeof m!="object"){c[h]=m;continue}const f=BO(p,m,n+1);c[h]=f,f===p&&d++}return s===l&&d===s?e:c}function Vw(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}function kD(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function g2(e){if(!SD(e))return!1;const t=e.constructor;if(t===void 0)return!0;const n=t.prototype;return!(!SD(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function SD(e){return Object.prototype.toString.call(e)==="[object Object]"}function iQ(e){return new Promise(t=>{pd.setTimeout(t,e)})}function x2(e,t,n){return typeof n.structuralSharing=="function"?n.structuralSharing(e,t):n.structuralSharing!==!1?BO(e,t):t}function oQ(e,t,n=0){const r=[...e,t];return n&&r.length>n?r.slice(1):r}function lQ(e,t,n=0){const r=[t,...e];return n&&r.length>n?r.slice(0,-1):r}var q_=Symbol();function WO(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===q_?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function K_(e,t){return typeof e=="function"?e(...t):!!e}function cQ(e,t,n){let r=!1,a;return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(a??(a=t()),r||(r=!0,a.aborted?n():a.addEventListener("abort",n,{once:!0})),a)}),e}var wd,Tc,Om,NP,uQ=(NP=class extends Af{constructor(){super();Pt(this,wd);Pt(this,Tc);Pt(this,Om);ht(this,Om,t=>{if(!zd&&window.addEventListener){const n=()=>t();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){he(this,Tc)||this.setEventListener(he(this,Om))}onUnsubscribe(){var t;this.hasListeners()||((t=he(this,Tc))==null||t.call(this),ht(this,Tc,void 0))}setEventListener(t){var n;ht(this,Om,t),(n=he(this,Tc))==null||n.call(this),ht(this,Tc,t(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(t){he(this,wd)!==t&&(ht(this,wd,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(n=>{n(t)})}isFocused(){var t;return typeof he(this,wd)=="boolean"?he(this,wd):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},wd=new WeakMap,Tc=new WeakMap,Om=new WeakMap,NP),Y_=new uQ;function y2(){let e,t;const n=new Promise((a,s)=>{e=a,t=s});n.status="pending",n.catch(()=>{});function r(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{r({status:"fulfilled",value:a}),e(a)},n.reject=a=>{r({status:"rejected",reason:a}),t(a)},n}var dQ=rQ;function hQ(){let e=[],t=0,n=l=>{l()},r=l=>{l()},a=dQ;const s=l=>{t?e.push(l):a(()=>{n(l)})},o=()=>{const l=e;e=[],l.length&&a(()=>{r(()=>{l.forEach(c=>{n(c)})})})};return{batch:l=>{let c;t++;try{c=l()}finally{t--,t||o()}return c},batchCalls:l=>(...c)=>{s(()=>{l(...c)})},schedule:s,setNotifyFunction:l=>{n=l},setBatchNotifyFunction:l=>{r=l},setScheduler:l=>{a=l}}}var Na=hQ(),Lm,Ec,zm,kP,pQ=(kP=class extends Af{constructor(){super();Pt(this,Lm,!0);Pt(this,Ec);Pt(this,zm);ht(this,zm,t=>{if(!zd&&window.addEventListener){const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){he(this,Ec)||this.setEventListener(he(this,zm))}onUnsubscribe(){var t;this.hasListeners()||((t=he(this,Ec))==null||t.call(this),ht(this,Ec,void 0))}setEventListener(t){var n;ht(this,zm,t),(n=he(this,Ec))==null||n.call(this),ht(this,Ec,t(this.setOnline.bind(this)))}setOnline(t){he(this,Lm)!==t&&(ht(this,Lm,t),this.listeners.forEach(r=>{r(t)}))}isOnline(){return he(this,Lm)}},Lm=new WeakMap,Ec=new WeakMap,zm=new WeakMap,kP),Hw=new pQ;function mQ(e){return Math.min(1e3*2**e,3e4)}function UO(e){return(e??"online")==="online"?Hw.isOnline():!0}var b2=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function VO(e){let t=!1,n=0,r;const a=y2(),s=()=>a.status!=="pending",o=g=>{var x;if(!s()){const y=new b2(g);p(y),(x=e.onCancel)==null||x.call(e,y)}},l=()=>{t=!0},c=()=>{t=!1},d=()=>Y_.isFocused()&&(e.networkMode==="always"||Hw.isOnline())&&e.canRun(),u=()=>UO(e.networkMode)&&e.canRun(),h=g=>{s()||(r==null||r(),a.resolve(g))},p=g=>{s()||(r==null||r(),a.reject(g))},m=()=>new Promise(g=>{var x;r=y=>{(s()||d())&&g(y)},(x=e.onPause)==null||x.call(e)}).then(()=>{var g;r=void 0,s()||(g=e.onContinue)==null||g.call(e)}),f=()=>{if(s())return;let g;const x=n===0?e.initialPromise:void 0;try{g=x??e.fn()}catch(y){g=Promise.reject(y)}Promise.resolve(g).then(h).catch(y=>{var C;if(s())return;const b=e.retry??(zd?0:3),v=e.retryDelay??mQ,w=typeof v=="function"?v(n,y):v,k=b===!0||typeof b=="number"&&n<b||typeof b=="function"&&b(n,y);if(t||!k){p(y);return}n++,(C=e.onFail)==null||C.call(e,n,y),iQ(w).then(()=>d()?void 0:m()).then(()=>{t?p(y):f()})})};return{promise:a,status:()=>a.status,cancel:o,continue:()=>(r==null||r(),a),cancelRetry:l,continueRetry:c,canStart:u,start:()=>(u()?f():m().then(f),a)}}var Nd,SP,HO=(SP=class{constructor(){Pt(this,Nd)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),f2(this.gcTime)&&ht(this,Nd,pd.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(zd?1/0:5*60*1e3))}clearGcTimeout(){he(this,Nd)&&(pd.clearTimeout(he(this,Nd)),ht(this,Nd,void 0))}},Nd=new WeakMap,SP),kd,Bm,Ii,Sd,Da,eb,Cd,io,Cl,CP,fQ=(CP=class extends HO{constructor(t){super();Pt(this,io);Pt(this,kd);Pt(this,Bm);Pt(this,Ii);Pt(this,Sd);Pt(this,Da);Pt(this,eb);Pt(this,Cd);ht(this,Cd,!1),ht(this,eb,t.defaultOptions),this.setOptions(t.options),this.observers=[],ht(this,Sd,t.client),ht(this,Ii,he(this,Sd).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,ht(this,kd,_D(this.options)),this.state=t.state??he(this,kd),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=he(this,Da))==null?void 0:t.promise}setOptions(t){if(this.options={...he(this,eb),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=_D(this.options);n.data!==void 0&&(this.setState(CD(n.data,n.dataUpdatedAt)),ht(this,kd,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&he(this,Ii).remove(this)}setData(t,n){const r=x2(this.state.data,t,this.options);return Cn(this,io,Cl).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(t,n){Cn(this,io,Cl).call(this,{type:"setState",state:t,setStateOptions:n})}cancel(t){var r,a;const n=(r=he(this,Da))==null?void 0:r.promise;return(a=he(this,Da))==null||a.cancel(t),n?n.then(ps).catch(ps):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(he(this,kd))}isActive(){return this.observers.some(t=>Ai(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===q_||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>Uc(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!zO(this.state.dataUpdatedAt,t)}onFocus(){var n;const t=this.observers.find(r=>r.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(n=he(this,Da))==null||n.continue()}onOnline(){var n;const t=this.observers.find(r=>r.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(n=he(this,Da))==null||n.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),he(this,Ii).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(n=>n!==t),this.observers.length||(he(this,Da)&&(he(this,Cd)?he(this,Da).cancel({revert:!0}):he(this,Da).cancelRetry()),this.scheduleGc()),he(this,Ii).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Cn(this,io,Cl).call(this,{type:"invalidate"})}async fetch(t,n){var c,d,u,h,p,m,f,g,x,y,b,v;if(this.state.fetchStatus!=="idle"&&((c=he(this,Da))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(he(this,Da))return he(this,Da).continueRetry(),he(this,Da).promise}if(t&&this.setOptions(t),!this.options.queryFn){const w=this.observers.find(k=>k.options.queryFn);w&&this.setOptions(w.options)}const r=new AbortController,a=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(ht(this,Cd,!0),r.signal)})},s=()=>{const w=WO(this.options,n),C=(()=>{const S={client:he(this,Sd),queryKey:this.queryKey,meta:this.meta};return a(S),S})();return ht(this,Cd,!1),this.options.persister?this.options.persister(w,C,this):w(C)},l=(()=>{const w={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:he(this,Sd),state:this.state,fetchFn:s};return a(w),w})();(d=this.options.behavior)==null||d.onFetch(l,this),ht(this,Bm,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=l.fetchOptions)==null?void 0:u.meta))&&Cn(this,io,Cl).call(this,{type:"fetch",meta:(h=l.fetchOptions)==null?void 0:h.meta}),ht(this,Da,VO({initialPromise:n==null?void 0:n.initialPromise,fn:l.fetchFn,onCancel:w=>{w instanceof b2&&w.revert&&this.setState({...he(this,Bm),fetchStatus:"idle"}),r.abort()},onFail:(w,k)=>{Cn(this,io,Cl).call(this,{type:"failed",failureCount:w,error:k})},onPause:()=>{Cn(this,io,Cl).call(this,{type:"pause"})},onContinue:()=>{Cn(this,io,Cl).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const w=await he(this,Da).start();if(w===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(w),(m=(p=he(this,Ii).config).onSuccess)==null||m.call(p,w,this),(g=(f=he(this,Ii).config).onSettled)==null||g.call(f,w,this.state.error,this),w}catch(w){if(w instanceof b2){if(w.silent)return he(this,Da).promise;if(w.revert){if(this.state.data===void 0)throw w;return this.state.data}}throw Cn(this,io,Cl).call(this,{type:"error",error:w}),(y=(x=he(this,Ii).config).onError)==null||y.call(x,w,this),(v=(b=he(this,Ii).config).onSettled)==null||v.call(b,this.state.data,w,this),w}finally{this.scheduleGc()}}},kd=new WeakMap,Bm=new WeakMap,Ii=new WeakMap,Sd=new WeakMap,Da=new WeakMap,eb=new WeakMap,Cd=new WeakMap,io=new WeakSet,Cl=function(t){const n=r=>{switch(t.type){case"failed":return{...r,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...GO(r.data,this.options),fetchMeta:t.meta??null};case"success":const a={...r,...CD(t.data,t.dataUpdatedAt),dataUpdateCount:r.dataUpdateCount+1,...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return ht(this,Bm,t.manual?a:void 0),a;case"error":const s=t.error;return{...r,error:s,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:s,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...t.state}}};this.state=n(this.state),Na.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),he(this,Ii).notify({query:this,type:"updated",action:t})})},CP);function GO(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:UO(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function CD(e,t){return{data:e,dataUpdatedAt:t??Date.now(),error:null,isInvalidated:!1,status:"success"}}function _D(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,n=t!==void 0,r=n?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var Rs,zn,tb,ds,_d,Wm,Tl,Ac,nb,Um,Vm,jd,Id,Rc,Hm,sr,Px,v2,w2,N2,k2,S2,C2,_2,qO,_P,gQ=(_P=class extends Af{constructor(t,n){super();Pt(this,sr);Pt(this,Rs);Pt(this,zn);Pt(this,tb);Pt(this,ds);Pt(this,_d);Pt(this,Wm);Pt(this,Tl);Pt(this,Ac);Pt(this,nb);Pt(this,Um);Pt(this,Vm);Pt(this,jd);Pt(this,Id);Pt(this,Rc);Pt(this,Hm,new Set);this.options=n,ht(this,Rs,t),ht(this,Ac,null),ht(this,Tl,y2()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(he(this,zn).addObserver(this),jD(he(this,zn),this.options)?Cn(this,sr,Px).call(this):this.updateResult(),Cn(this,sr,k2).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return j2(he(this,zn),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return j2(he(this,zn),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Cn(this,sr,S2).call(this),Cn(this,sr,C2).call(this),he(this,zn).removeObserver(this)}setOptions(t){const n=this.options,r=he(this,zn);if(this.options=he(this,Rs).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Ai(this.options.enabled,he(this,zn))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Cn(this,sr,_2).call(this),he(this,zn).setOptions(this.options),n._defaulted&&!Vw(this.options,n)&&he(this,Rs).getQueryCache().notify({type:"observerOptionsUpdated",query:he(this,zn),observer:this});const a=this.hasListeners();a&&ID(he(this,zn),r,this.options,n)&&Cn(this,sr,Px).call(this),this.updateResult(),a&&(he(this,zn)!==r||Ai(this.options.enabled,he(this,zn))!==Ai(n.enabled,he(this,zn))||Uc(this.options.staleTime,he(this,zn))!==Uc(n.staleTime,he(this,zn)))&&Cn(this,sr,v2).call(this);const s=Cn(this,sr,w2).call(this);a&&(he(this,zn)!==r||Ai(this.options.enabled,he(this,zn))!==Ai(n.enabled,he(this,zn))||s!==he(this,Rc))&&Cn(this,sr,N2).call(this,s)}getOptimisticResult(t){const n=he(this,Rs).getQueryCache().build(he(this,Rs),t),r=this.createResult(n,t);return yQ(this,r)&&(ht(this,ds,r),ht(this,Wm,this.options),ht(this,_d,he(this,zn).state)),r}getCurrentResult(){return he(this,ds)}trackResult(t,n){return new Proxy(t,{get:(r,a)=>(this.trackProp(a),n==null||n(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&he(this,Tl).status==="pending"&&he(this,Tl).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(r,a))})}trackProp(t){he(this,Hm).add(t)}getCurrentQuery(){return he(this,zn)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const n=he(this,Rs).defaultQueryOptions(t),r=he(this,Rs).getQueryCache().build(he(this,Rs),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(t){return Cn(this,sr,Px).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),he(this,ds)))}createResult(t,n){var I;const r=he(this,zn),a=this.options,s=he(this,ds),o=he(this,_d),l=he(this,Wm),d=t!==r?t.state:he(this,tb),{state:u}=t;let h={...u},p=!1,m;if(n._optimisticResults){const T=this.hasListeners(),A=!T&&jD(t,n),j=T&&ID(t,r,n,a);(A||j)&&(h={...h,...GO(u.data,t.options)}),n._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:f,errorUpdatedAt:g,status:x}=h;m=h.data;let y=!1;if(n.placeholderData!==void 0&&m===void 0&&x==="pending"){let T;s!=null&&s.isPlaceholderData&&n.placeholderData===(l==null?void 0:l.placeholderData)?(T=s.data,y=!0):T=typeof n.placeholderData=="function"?n.placeholderData((I=he(this,Vm))==null?void 0:I.state.data,he(this,Vm)):n.placeholderData,T!==void 0&&(x="success",m=x2(s==null?void 0:s.data,T,n),p=!0)}if(n.select&&m!==void 0&&!y)if(s&&m===(o==null?void 0:o.data)&&n.select===he(this,nb))m=he(this,Um);else try{ht(this,nb,n.select),m=n.select(m),m=x2(s==null?void 0:s.data,m,n),ht(this,Um,m),ht(this,Ac,null)}catch(T){ht(this,Ac,T)}he(this,Ac)&&(f=he(this,Ac),m=he(this,Um),g=Date.now(),x="error");const b=h.fetchStatus==="fetching",v=x==="pending",w=x==="error",k=v&&b,C=m!==void 0,_={status:x,fetchStatus:h.fetchStatus,isPending:v,isSuccess:x==="success",isError:w,isInitialLoading:k,isLoading:k,data:m,dataUpdatedAt:h.dataUpdatedAt,error:f,errorUpdatedAt:g,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>d.dataUpdateCount||h.errorUpdateCount>d.errorUpdateCount,isFetching:b,isRefetching:b&&!v,isLoadingError:w&&!C,isPaused:h.fetchStatus==="paused",isPlaceholderData:p,isRefetchError:w&&C,isStale:X_(t,n),refetch:this.refetch,promise:he(this,Tl),isEnabled:Ai(n.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const T=_.data!==void 0,A=_.status==="error"&&!T,j=B=>{A?B.reject(_.error):T&&B.resolve(_.data)},D=()=>{const B=ht(this,Tl,_.promise=y2());j(B)},F=he(this,Tl);switch(F.status){case"pending":t.queryHash===r.queryHash&&j(F);break;case"fulfilled":(A||_.data!==F.value)&&D();break;case"rejected":(!A||_.error!==F.reason)&&D();break}}return _}updateResult(){const t=he(this,ds),n=this.createResult(he(this,zn),this.options);if(ht(this,_d,he(this,zn).state),ht(this,Wm,this.options),he(this,_d).data!==void 0&&ht(this,Vm,he(this,zn)),Vw(n,t))return;ht(this,ds,n);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,s=typeof a=="function"?a():a;if(s==="all"||!s&&!he(this,Hm).size)return!0;const o=new Set(s??he(this,Hm));return this.options.throwOnError&&o.add("error"),Object.keys(he(this,ds)).some(l=>{const c=l;return he(this,ds)[c]!==t[c]&&o.has(c)})};Cn(this,sr,qO).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Cn(this,sr,k2).call(this)}},Rs=new WeakMap,zn=new WeakMap,tb=new WeakMap,ds=new WeakMap,_d=new WeakMap,Wm=new WeakMap,Tl=new WeakMap,Ac=new WeakMap,nb=new WeakMap,Um=new WeakMap,Vm=new WeakMap,jd=new WeakMap,Id=new WeakMap,Rc=new WeakMap,Hm=new WeakMap,sr=new WeakSet,Px=function(t){Cn(this,sr,_2).call(this);let n=he(this,zn).fetch(this.options,t);return t!=null&&t.throwOnError||(n=n.catch(ps)),n},v2=function(){Cn(this,sr,S2).call(this);const t=Uc(this.options.staleTime,he(this,zn));if(zd||he(this,ds).isStale||!f2(t))return;const r=zO(he(this,ds).dataUpdatedAt,t)+1;ht(this,jd,pd.setTimeout(()=>{he(this,ds).isStale||this.updateResult()},r))},w2=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(he(this,zn)):this.options.refetchInterval)??!1},N2=function(t){Cn(this,sr,C2).call(this),ht(this,Rc,t),!(zd||Ai(this.options.enabled,he(this,zn))===!1||!f2(he(this,Rc))||he(this,Rc)===0)&&ht(this,Id,pd.setInterval(()=>{(this.options.refetchIntervalInBackground||Y_.isFocused())&&Cn(this,sr,Px).call(this)},he(this,Rc)))},k2=function(){Cn(this,sr,v2).call(this),Cn(this,sr,N2).call(this,Cn(this,sr,w2).call(this))},S2=function(){he(this,jd)&&(pd.clearTimeout(he(this,jd)),ht(this,jd,void 0))},C2=function(){he(this,Id)&&(pd.clearInterval(he(this,Id)),ht(this,Id,void 0))},_2=function(){const t=he(this,Rs).getQueryCache().build(he(this,Rs),this.options);if(t===he(this,zn))return;const n=he(this,zn);ht(this,zn,t),ht(this,tb,t.state),this.hasListeners()&&(n==null||n.removeObserver(this),t.addObserver(this))},qO=function(t){Na.batch(()=>{t.listeners&&this.listeners.forEach(n=>{n(he(this,ds))}),he(this,Rs).getQueryCache().notify({query:he(this,zn),type:"observerResultsUpdated"})})},_P);function xQ(e,t){return Ai(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function jD(e,t){return xQ(e,t)||e.state.data!==void 0&&j2(e,t,t.refetchOnMount)}function j2(e,t,n){if(Ai(t.enabled,e)!==!1&&Uc(t.staleTime,e)!=="static"){const r=typeof n=="function"?n(e):n;return r==="always"||r!==!1&&X_(e,t)}return!1}function ID(e,t,n,r){return(e!==t||Ai(r.enabled,e)===!1)&&(!n.suspense||e.state.status!=="error")&&X_(e,n)}function X_(e,t){return Ai(t.enabled,e)!==!1&&e.isStaleByTime(Uc(t.staleTime,e))}function yQ(e,t){return!Vw(e.getCurrentResult(),t)}function TD(e){return{onFetch:(t,n)=>{var u,h,p,m,f;const r=t.options,a=(p=(h=(u=t.fetchOptions)==null?void 0:u.meta)==null?void 0:h.fetchMore)==null?void 0:p.direction,s=((m=t.state.data)==null?void 0:m.pages)||[],o=((f=t.state.data)==null?void 0:f.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const d=async()=>{let g=!1;const x=v=>{cQ(v,()=>t.signal,()=>g=!0)},y=WO(t.options,t.fetchOptions),b=async(v,w,k)=>{if(g)return Promise.reject();if(w==null&&v.pages.length)return Promise.resolve(v);const S=(()=>{const A={client:t.client,queryKey:t.queryKey,pageParam:w,direction:k?"backward":"forward",meta:t.options.meta};return x(A),A})(),_=await y(S),{maxPages:I}=t.options,T=k?lQ:oQ;return{pages:T(v.pages,_,I),pageParams:T(v.pageParams,w,I)}};if(a&&s.length){const v=a==="backward",w=v?bQ:ED,k={pages:s,pageParams:o},C=w(r,k);l=await b(k,C,v)}else{const v=e??s.length;do{const w=c===0?o[0]??r.initialPageParam:ED(r,l);if(c>0&&w==null)break;l=await b(l,w),c++}while(c<v)}return l};t.options.persister?t.fetchFn=()=>{var g,x;return(x=(g=t.options).persister)==null?void 0:x.call(g,d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},n)}:t.fetchFn=d}}}function ED(e,{pages:t,pageParams:n}){const r=t.length-1;return t.length>0?e.getNextPageParam(t[r],t,n[r],n):void 0}function bQ(e,{pages:t,pageParams:n}){var r;return t.length>0?(r=e.getPreviousPageParam)==null?void 0:r.call(e,t[0],t,n[0],n):void 0}var rb,Lo,Ga,Td,zo,mc,jP,vQ=(jP=class extends HO{constructor(t){super();Pt(this,zo);Pt(this,rb);Pt(this,Lo);Pt(this,Ga);Pt(this,Td);ht(this,rb,t.client),this.mutationId=t.mutationId,ht(this,Ga,t.mutationCache),ht(this,Lo,[]),this.state=t.state||KO(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){he(this,Lo).includes(t)||(he(this,Lo).push(t),this.clearGcTimeout(),he(this,Ga).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){ht(this,Lo,he(this,Lo).filter(n=>n!==t)),this.scheduleGc(),he(this,Ga).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){he(this,Lo).length||(this.state.status==="pending"?this.scheduleGc():he(this,Ga).remove(this))}continue(){var t;return((t=he(this,Td))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var o,l,c,d,u,h,p,m,f,g,x,y,b,v,w,k,C,S;const n=()=>{Cn(this,zo,mc).call(this,{type:"continue"})},r={client:he(this,rb),meta:this.options.meta,mutationKey:this.options.mutationKey};ht(this,Td,VO({fn:()=>this.options.mutationFn?this.options.mutationFn(t,r):Promise.reject(new Error("No mutationFn found")),onFail:(_,I)=>{Cn(this,zo,mc).call(this,{type:"failed",failureCount:_,error:I})},onPause:()=>{Cn(this,zo,mc).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>he(this,Ga).canRun(this)}));const a=this.state.status==="pending",s=!he(this,Td).canStart();try{if(a)n();else{Cn(this,zo,mc).call(this,{type:"pending",variables:t,isPaused:s}),he(this,Ga).config.onMutate&&await he(this,Ga).config.onMutate(t,this,r);const I=await((l=(o=this.options).onMutate)==null?void 0:l.call(o,t,r));I!==this.state.context&&Cn(this,zo,mc).call(this,{type:"pending",context:I,variables:t,isPaused:s})}const _=await he(this,Td).start();return await((d=(c=he(this,Ga).config).onSuccess)==null?void 0:d.call(c,_,t,this.state.context,this,r)),await((h=(u=this.options).onSuccess)==null?void 0:h.call(u,_,t,this.state.context,r)),await((m=(p=he(this,Ga).config).onSettled)==null?void 0:m.call(p,_,null,this.state.variables,this.state.context,this,r)),await((g=(f=this.options).onSettled)==null?void 0:g.call(f,_,null,t,this.state.context,r)),Cn(this,zo,mc).call(this,{type:"success",data:_}),_}catch(_){try{await((y=(x=he(this,Ga).config).onError)==null?void 0:y.call(x,_,t,this.state.context,this,r))}catch(I){Promise.reject(I)}try{await((v=(b=this.options).onError)==null?void 0:v.call(b,_,t,this.state.context,r))}catch(I){Promise.reject(I)}try{await((k=(w=he(this,Ga).config).onSettled)==null?void 0:k.call(w,void 0,_,this.state.variables,this.state.context,this,r))}catch(I){Promise.reject(I)}try{await((S=(C=this.options).onSettled)==null?void 0:S.call(C,void 0,_,t,this.state.context,r))}catch(I){Promise.reject(I)}throw Cn(this,zo,mc).call(this,{type:"error",error:_}),_}finally{he(this,Ga).runNext(this)}}},rb=new WeakMap,Lo=new WeakMap,Ga=new WeakMap,Td=new WeakMap,zo=new WeakSet,mc=function(t){const n=r=>{switch(t.type){case"failed":return{...r,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...r,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:t.error,failureCount:r.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=n(this.state),Na.batch(()=>{he(this,Lo).forEach(r=>{r.onMutationUpdate(t)}),he(this,Ga).notify({mutation:this,type:"updated",action:t})})},jP);function KO(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var El,oo,ab,IP,wQ=(IP=class extends Af{constructor(t={}){super();Pt(this,El);Pt(this,oo);Pt(this,ab);this.config=t,ht(this,El,new Set),ht(this,oo,new Map),ht(this,ab,0)}build(t,n,r){const a=new vQ({client:t,mutationCache:this,mutationId:++jv(this,ab)._,options:t.defaultMutationOptions(n),state:r});return this.add(a),a}add(t){he(this,El).add(t);const n=Dv(t);if(typeof n=="string"){const r=he(this,oo).get(n);r?r.push(t):he(this,oo).set(n,[t])}this.notify({type:"added",mutation:t})}remove(t){if(he(this,El).delete(t)){const n=Dv(t);if(typeof n=="string"){const r=he(this,oo).get(n);if(r)if(r.length>1){const a=r.indexOf(t);a!==-1&&r.splice(a,1)}else r[0]===t&&he(this,oo).delete(n)}}this.notify({type:"removed",mutation:t})}canRun(t){const n=Dv(t);if(typeof n=="string"){const r=he(this,oo).get(n),a=r==null?void 0:r.find(s=>s.state.status==="pending");return!a||a===t}else return!0}runNext(t){var r;const n=Dv(t);if(typeof n=="string"){const a=(r=he(this,oo).get(n))==null?void 0:r.find(s=>s!==t&&s.state.isPaused);return(a==null?void 0:a.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Na.batch(()=>{he(this,El).forEach(t=>{this.notify({type:"removed",mutation:t})}),he(this,El).clear(),he(this,oo).clear()})}getAll(){return Array.from(he(this,El))}find(t){const n={exact:!0,...t};return this.getAll().find(r=>ND(n,r))}findAll(t={}){return this.getAll().filter(n=>ND(t,n))}notify(t){Na.batch(()=>{this.listeners.forEach(n=>{n(t)})})}resumePausedMutations(){const t=this.getAll().filter(n=>n.state.isPaused);return Na.batch(()=>Promise.all(t.map(n=>n.continue().catch(ps))))}},El=new WeakMap,oo=new WeakMap,ab=new WeakMap,IP);function Dv(e){var t;return(t=e.options.scope)==null?void 0:t.id}var Al,Dc,Ds,Rl,Ll,yw,I2,TP,NQ=(TP=class extends Af{constructor(n,r){super();Pt(this,Ll);Pt(this,Al);Pt(this,Dc);Pt(this,Ds);Pt(this,Rl);ht(this,Al,n),this.setOptions(r),this.bindMethods(),Cn(this,Ll,yw).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var a;const r=this.options;this.options=he(this,Al).defaultMutationOptions(n),Vw(this.options,r)||he(this,Al).getMutationCache().notify({type:"observerOptionsUpdated",mutation:he(this,Ds),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&Bd(r.mutationKey)!==Bd(this.options.mutationKey)?this.reset():((a=he(this,Ds))==null?void 0:a.state.status)==="pending"&&he(this,Ds).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=he(this,Ds))==null||n.removeObserver(this)}onMutationUpdate(n){Cn(this,Ll,yw).call(this),Cn(this,Ll,I2).call(this,n)}getCurrentResult(){return he(this,Dc)}reset(){var n;(n=he(this,Ds))==null||n.removeObserver(this),ht(this,Ds,void 0),Cn(this,Ll,yw).call(this),Cn(this,Ll,I2).call(this)}mutate(n,r){var a;return ht(this,Rl,r),(a=he(this,Ds))==null||a.removeObserver(this),ht(this,Ds,he(this,Al).getMutationCache().build(he(this,Al),this.options)),he(this,Ds).addObserver(this),he(this,Ds).execute(n)}},Al=new WeakMap,Dc=new WeakMap,Ds=new WeakMap,Rl=new WeakMap,Ll=new WeakSet,yw=function(){var r;const n=((r=he(this,Ds))==null?void 0:r.state)??KO();ht(this,Dc,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},I2=function(n){Na.batch(()=>{var r,a,s,o,l,c,d,u;if(he(this,Rl)&&this.hasListeners()){const h=he(this,Dc).variables,p=he(this,Dc).context,m={client:he(this,Al),meta:this.options.meta,mutationKey:this.options.mutationKey};if((n==null?void 0:n.type)==="success"){try{(a=(r=he(this,Rl)).onSuccess)==null||a.call(r,n.data,h,p,m)}catch(f){Promise.reject(f)}try{(o=(s=he(this,Rl)).onSettled)==null||o.call(s,n.data,null,h,p,m)}catch(f){Promise.reject(f)}}else if((n==null?void 0:n.type)==="error"){try{(c=(l=he(this,Rl)).onError)==null||c.call(l,n.error,h,p,m)}catch(f){Promise.reject(f)}try{(u=(d=he(this,Rl)).onSettled)==null||u.call(d,void 0,n.error,h,p,m)}catch(f){Promise.reject(f)}}}this.listeners.forEach(h=>{h(he(this,Dc))})})},TP),Bo,EP,kQ=(EP=class extends Af{constructor(t={}){super();Pt(this,Bo);this.config=t,ht(this,Bo,new Map)}build(t,n,r){const a=n.queryKey,s=n.queryHash??G_(a,n);let o=this.get(s);return o||(o=new fQ({client:t,queryKey:a,queryHash:s,options:t.defaultQueryOptions(n),state:r,defaultOptions:t.getQueryDefaults(a)}),this.add(o)),o}add(t){he(this,Bo).has(t.queryHash)||(he(this,Bo).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const n=he(this,Bo).get(t.queryHash);n&&(t.destroy(),n===t&&he(this,Bo).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Na.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return he(this,Bo).get(t)}getAll(){return[...he(this,Bo).values()]}find(t){const n={exact:!0,...t};return this.getAll().find(r=>wD(n,r))}findAll(t={}){const n=this.getAll();return Object.keys(t).length>0?n.filter(r=>wD(t,r)):n}notify(t){Na.batch(()=>{this.listeners.forEach(n=>{n(t)})})}onFocus(){Na.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Na.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Bo=new WeakMap,EP),Hr,Mc,$c,Gm,qm,Fc,Km,Ym,AP,SQ=(AP=class{constructor(e={}){Pt(this,Hr);Pt(this,Mc);Pt(this,$c);Pt(this,Gm);Pt(this,qm);Pt(this,Fc);Pt(this,Km);Pt(this,Ym);ht(this,Hr,e.queryCache||new kQ),ht(this,Mc,e.mutationCache||new wQ),ht(this,$c,e.defaultOptions||{}),ht(this,Gm,new Map),ht(this,qm,new Map),ht(this,Fc,0)}mount(){jv(this,Fc)._++,he(this,Fc)===1&&(ht(this,Km,Y_.subscribe(async e=>{e&&(await this.resumePausedMutations(),he(this,Hr).onFocus())})),ht(this,Ym,Hw.subscribe(async e=>{e&&(await this.resumePausedMutations(),he(this,Hr).onOnline())})))}unmount(){var e,t;jv(this,Fc)._--,he(this,Fc)===0&&((e=he(this,Km))==null||e.call(this),ht(this,Km,void 0),(t=he(this,Ym))==null||t.call(this),ht(this,Ym,void 0))}isFetching(e){return he(this,Hr).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return he(this,Mc).findAll({...e,status:"pending"}).length}getQueryData(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=he(this,Hr).get(t.queryHash))==null?void 0:n.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=he(this,Hr).build(this,t),r=n.state.data;return r===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Uc(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(r))}getQueriesData(e){return he(this,Hr).findAll(e).map(({queryKey:t,state:n})=>{const r=n.data;return[t,r]})}setQueryData(e,t,n){const r=this.defaultQueryOptions({queryKey:e}),a=he(this,Hr).get(r.queryHash),s=a==null?void 0:a.state.data,o=aQ(t,s);if(o!==void 0)return he(this,Hr).build(this,r).setData(o,{...n,manual:!0})}setQueriesData(e,t,n){return Na.batch(()=>he(this,Hr).findAll(e).map(({queryKey:r})=>[r,this.setQueryData(r,t,n)]))}getQueryState(e){var n;const t=this.defaultQueryOptions({queryKey:e});return(n=he(this,Hr).get(t.queryHash))==null?void 0:n.state}removeQueries(e){const t=he(this,Hr);Na.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=he(this,Hr);return Na.batch(()=>(n.findAll(e).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},r=Na.batch(()=>he(this,Hr).findAll(e).map(a=>a.cancel(n)));return Promise.all(r).then(ps).catch(ps)}invalidateQueries(e,t={}){return Na.batch(()=>(he(this,Hr).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},r=Na.batch(()=>he(this,Hr).findAll(e).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let s=a.fetch(void 0,n);return n.throwOnError||(s=s.catch(ps)),a.state.fetchStatus==="paused"?Promise.resolve():s}));return Promise.all(r).then(ps)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=he(this,Hr).build(this,t);return n.isStaleByTime(Uc(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(ps).catch(ps)}fetchInfiniteQuery(e){return e.behavior=TD(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(ps).catch(ps)}ensureInfiniteQueryData(e){return e.behavior=TD(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Hw.isOnline()?he(this,Mc).resumePausedMutations():Promise.resolve()}getQueryCache(){return he(this,Hr)}getMutationCache(){return he(this,Mc)}getDefaultOptions(){return he(this,$c)}setDefaultOptions(e){ht(this,$c,e)}setQueryDefaults(e,t){he(this,Gm).set(Bd(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...he(this,Gm).values()],n={};return t.forEach(r=>{Sy(e,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(e,t){he(this,qm).set(Bd(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...he(this,qm).values()],n={};return t.forEach(r=>{Sy(e,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...he(this,$c).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=G_(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===q_&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...he(this,$c).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){he(this,Hr).clear(),he(this,Mc).clear()}},Hr=new WeakMap,Mc=new WeakMap,$c=new WeakMap,Gm=new WeakMap,qm=new WeakMap,Fc=new WeakMap,Km=new WeakMap,Ym=new WeakMap,AP),YO=N.createContext(void 0),Rf=e=>{const t=N.useContext(YO);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},CQ=({client:e,children:t})=>(N.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),i.jsx(YO.Provider,{value:e,children:t})),XO=N.createContext(!1),_Q=()=>N.useContext(XO);XO.Provider;function jQ(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var IQ=N.createContext(jQ()),TQ=()=>N.useContext(IQ),EQ=(e,t,n)=>{const r=n!=null&&n.state.error&&typeof e.throwOnError=="function"?K_(e.throwOnError,[n.state.error,n]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||r)&&(t.isReset()||(e.retryOnMount=!1))},AQ=e=>{N.useEffect(()=>{e.clearReset()},[e])},RQ=({result:e,errorResetBoundary:t,throwOnError:n,query:r,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(a&&e.data===void 0||K_(n,[e.error,r])),DQ=e=>{if(e.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...a)=>n(r(...a)):n(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},MQ=(e,t)=>e.isLoading&&e.isFetching&&!t,$Q=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,AD=(e,t,n)=>t.fetchOptimistic(e).catch(()=>{n.clearReset()});function FQ(e,t,n){var p,m,f,g;const r=_Q(),a=TQ(),s=Rf(),o=s.defaultQueryOptions(e);(m=(p=s.getDefaultOptions().queries)==null?void 0:p._experimental_beforeQuery)==null||m.call(p,o);const l=s.getQueryCache().get(o.queryHash);o._optimisticResults=r?"isRestoring":"optimistic",DQ(o),EQ(o,a,l),AQ(a);const c=!s.getQueryCache().get(o.queryHash),[d]=N.useState(()=>new t(s,o)),u=d.getOptimisticResult(o),h=!r&&e.subscribed!==!1;if(N.useSyncExternalStore(N.useCallback(x=>{const y=h?d.subscribe(Na.batchCalls(x)):ps;return d.updateResult(),y},[d,h]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),N.useEffect(()=>{d.setOptions(o)},[o,d]),$Q(o,u))throw AD(o,d,a);if(RQ({result:u,errorResetBoundary:a,throwOnError:o.throwOnError,query:l,suspense:o.suspense}))throw u.error;if((g=(f=s.getDefaultOptions().queries)==null?void 0:f._experimental_afterQuery)==null||g.call(f,o,u),o.experimental_prefetchInRender&&!zd&&MQ(u,r)){const x=c?AD(o,d,a):l==null?void 0:l.promise;x==null||x.catch(ps).finally(()=>{d.updateResult()})}return o.notifyOnChangeProps?u:d.trackResult(u)}function al(e,t){return FQ(e,gQ)}function Rd(e,t){const n=Rf(),[r]=N.useState(()=>new NQ(n,e));N.useEffect(()=>{r.setOptions(e)},[r,e]);const a=N.useSyncExternalStore(N.useCallback(o=>r.subscribe(Na.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),s=N.useCallback((o,l)=>{r.mutate(o,l).catch(ps)},[r]);if(a.error&&K_(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:s,mutateAsync:a.mutate}}const ZO=N.createContext(void 0);function PQ({children:e}){const[t,n]=N.useState(()=>typeof window<"u"&&localStorage.getItem("synka-theme")||"light");N.useEffect(()=>{const s=window.document.documentElement;s.classList.remove("light","dark"),s.classList.add(t),localStorage.setItem("synka-theme",t)},[t]);const r=()=>{n(s=>s==="light"?"dark":"light")},a=s=>{n(s)};return i.jsx(ZO.Provider,{value:{theme:t,toggleTheme:r,setTheme:a},children:e})}function QO(){const e=N.useContext(ZO);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}const OQ="https://qlrnewbkolxjdtfffuml.supabase.co",LQ="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk",ue=lX(OQ,LQ,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}});/*! Capacitor: https://capacitorjs.com/ - MIT License */var Qm;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(Qm||(Qm={}));let _k=class extends Error{constructor(t,n,r){super(t),this.message=t,this.code=n,this.data=r}};const zQ=e=>{var t,n;return e!=null&&e.androidBridge?"android":!((n=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},BQ=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},r=n.Plugins=n.Plugins||{},a=()=>t!==null?t.name:zQ(e),s=()=>a()!=="web",o=h=>{const p=d.get(h);return!!(p!=null&&p.platforms.has(a())||l(h))},l=h=>{var p;return(p=n.PluginHeaders)===null||p===void 0?void 0:p.find(m=>m.name===h)},c=h=>e.console.error(h),d=new Map,u=(h,p={})=>{const m=d.get(h);if(m)return console.warn(`Capacitor plugin "${h}" already registered. Cannot register plugins twice.`),m.proxy;const f=a(),g=l(h);let x;const y=async()=>(!x&&f in p?x=typeof p[f]=="function"?x=await p[f]():x=p[f]:t!==null&&!x&&"web"in p&&(x=typeof p.web=="function"?x=await p.web():x=p.web),x),b=(_,I)=>{var T,A;if(g){const j=g==null?void 0:g.methods.find(D=>I===D.name);if(j)return j.rtype==="promise"?D=>n.nativePromise(h,I.toString(),D):(D,F)=>n.nativeCallback(h,I.toString(),D,F);if(_)return(T=_[I])===null||T===void 0?void 0:T.bind(_)}else{if(_)return(A=_[I])===null||A===void 0?void 0:A.bind(_);throw new _k(`"${h}" plugin is not implemented on ${f}`,Qm.Unimplemented)}},v=_=>{let I;const T=(...A)=>{const j=y().then(D=>{const F=b(D,_);if(F){const B=F(...A);return I=B==null?void 0:B.remove,B}else throw new _k(`"${h}.${_}()" is not implemented on ${f}`,Qm.Unimplemented)});return _==="addListener"&&(j.remove=async()=>I()),j};return T.toString=()=>`${_.toString()}() { [capacitor code] }`,Object.defineProperty(T,"name",{value:_,writable:!1,configurable:!1}),T},w=v("addListener"),k=v("removeListener"),C=(_,I)=>{const T=w({eventName:_},I),A=async()=>{const D=await T;k({eventName:_,callbackId:D},I)},j=new Promise(D=>T.then(()=>D({remove:A})));return j.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await A()},j},S=new Proxy({},{get(_,I){switch(I){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return g?C:w;case"removeListener":return k;default:return v(I)}}});return r[h]=S,d.set(h,{name:h,proxy:S,platforms:new Set([...Object.keys(p),...g?[f]:[]])}),S};return n.convertFileSrc||(n.convertFileSrc=h=>h),n.getPlatform=a,n.handleError=c,n.isNativePlatform=s,n.isPluginAvailable=o,n.registerPlugin=u,n.Exception=_k,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},WQ=e=>e.Capacitor=BQ(e),Xt=WQ(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),kh=Xt.registerPlugin;let JO=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let r=!1;this.listeners[t]||(this.listeners[t]=[],r=!0),this.listeners[t].push(n);const s=this.windowListeners[t];s&&!s.registered&&this.addWindowListener(s),r&&this.sendRetainedArgumentsForEvent(t);const o=async()=>this.removeListener(t,n);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,r){const a=this.listeners[t];if(!a){if(r){let s=this.retainedEventArguments[t];s||(s=[]),s.push(n),this.retainedEventArguments[t]=s}return}a.forEach(s=>s(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(t="not implemented"){return new Xt.Exception(t,Qm.Unimplemented)}unavailable(t="not available"){return new Xt.Exception(t,Qm.Unavailable)}async removeListener(t,n){const r=this.listeners[t];if(!r)return;const a=r.indexOf(n);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(r=>{this.notifyListeners(t,r)}))}};const RD=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),DD=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class UQ extends JO{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(r=>{if(r.length<=0)return;let[a,s]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");a=DD(a).trim(),s=DD(s).trim(),n[a]=s}),n}async setCookie(t){try{const n=RD(t.key),r=RD(t.value),a=`; expires=${(t.expires||"").replace("expires=","")}`,s=(t.path||"/").replace("path=",""),o=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${r||""}${a}; path=${s}; ${o};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}kh("CapacitorCookies",{web:()=>new UQ});const VQ=async e=>new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{const a=r.result;t(a.indexOf(",")>=0?a.split(",")[1]:a)},r.onerror=a=>n(a),r.readAsDataURL(e)}),HQ=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(a=>a.toLocaleLowerCase()).reduce((a,s,o)=>(a[s]=e[t[o]],a),{})},GQ=(e,t=!0)=>e?Object.entries(e).reduce((r,a)=>{const[s,o]=a;let l,c;return Array.isArray(o)?(c="",o.forEach(d=>{l=t?encodeURIComponent(d):d,c+=`${s}=${l}&`}),c.slice(0,-1)):(l=t?encodeURIComponent(o):o,c=`${s}=${l}`),`${r}&${c}`},"").substr(1):null,qQ=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),a=HQ(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(a.includes("application/x-www-form-urlencoded")){const s=new URLSearchParams;for(const[o,l]of Object.entries(e.data||{}))s.set(o,l);n.body=s.toString()}else if(a.includes("multipart/form-data")||e.data instanceof FormData){const s=new FormData;if(e.data instanceof FormData)e.data.forEach((l,c)=>{s.append(c,l)});else for(const l of Object.keys(e.data))s.append(l,e.data[l]);n.body=s;const o=new Headers(n.headers);o.delete("content-type"),n.headers=o}else(a.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class KQ extends JO{async request(t){const n=qQ(t,t.webFetchExtra),r=GQ(t.params,t.shouldEncodeUrlParams),a=r?`${t.url}?${r}`:t.url,s=await fetch(a,n),o=s.headers.get("content-type")||"";let{responseType:l="text"}=s.ok?t:{};o.includes("application/json")&&(l="json");let c,d;switch(l){case"arraybuffer":case"blob":d=await s.blob(),c=await VQ(d);break;case"json":c=await s.json();break;case"document":case"text":default:c=await s.text()}const u={};return s.headers.forEach((h,p)=>{u[p]=h}),{data:c,headers:u,status:s.status,url:s.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}kh("CapacitorHttp",{web:()=>new KQ});const e4=N.createContext(void 0);function YQ({children:e}){const[t,n]=N.useState(null),[r,a]=N.useState(null),[s,o]=N.useState(!0),l=async v=>{var I,T,A;const w=((I=v.user_metadata)==null?void 0:I.name)||((T=v.user_metadata)==null?void 0:T.full_name)||"",k=((A=v.user_metadata)==null?void 0:A.phone)||"",C=v.email||"",{data:S}=await ue.from("profiles").select("id, slug").eq("user_id",v.id).maybeSingle();if(!S){const D=`${C.split("@")[0].toLowerCase().replace(/[^a-z0-9]/g,"")||"user"}-${v.id.slice(0,6)}`;await ue.from("profiles").insert({user_id:v.id,email:C,slug:D,full_name:w,phone:k})}const{data:_}=await ue.from("cards").select("id, name, full_name, email, phone").eq("user_id",v.id).eq("is_default",!0).maybeSingle();if(!_)await ue.from("cards").insert({user_id:v.id,name:"My Card",is_default:!0,layout:"dark-professional",full_name:w,email:C,phone:k,whatsapp:k});else{const j=(_.name??"").trim().toLowerCase()==="personal";(j||!_.full_name&&w||!_.email&&C||!_.phone&&k)&&await ue.from("cards").update({name:j?"My Card":_.name||"My Card",full_name:_.full_name||w,email:_.email||C,phone:_.phone||k,whatsapp:_.phone||k||null}).eq("id",_.id)}await ue.from("cards").select("id").eq("user_id",v.id).eq("is_default",!0).single()};N.useEffect(()=>{const v=async()=>{if(!Xt.isNativePlatform()){const C=sessionStorage.getItem("synka_session_temp"),S=localStorage.getItem("synka_remember_me");if(C==="true"&&S==="false")return await ue.auth.signOut(),sessionStorage.removeItem("synka_session_temp"),o(!1),!0;sessionStorage.removeItem("synka_session_temp")}return!1},k=(async()=>{if(await v())return;const{data:{subscription:S}}=ue.auth.onAuthStateChange((_,I)=>{a(I),n((I==null?void 0:I.user)??null),o(!1),I!=null&&I.user&&setTimeout(()=>l(I.user),0)});return ue.auth.getSession().then(({data:{session:_}})=>{a(_),n((_==null?void 0:_.user)??null),o(!1),_!=null&&_.user&&setTimeout(()=>l(_.user),0)}),()=>S.unsubscribe()})();return()=>{k.then(C=>C==null?void 0:C())}},[]);const c=async v=>{const{error:w}=await ue.auth.signInWithOtp({email:v.toLowerCase().trim(),options:{shouldCreateUser:!0}});return{error:w}},d=async(v,w)=>{const{error:k}=await ue.auth.verifyOtp({email:v.toLowerCase().trim(),token:w,type:"email"});return{error:k}},u=async v=>{const{error:w}=await ue.auth.signInWithOtp({email:v.toLowerCase().trim(),options:{shouldCreateUser:!1}});return{error:w}},h=async(v,w)=>{var k;try{const C=await ue.functions.invoke("pin-auth",{body:{action:"SET_PIN",user_id:v,pin:w}});return C.error?{error:new Error(C.error.message||"Failed to set PIN")}:(k=C.data)!=null&&k.error?{error:new Error(C.data.error)}:{error:null}}catch(C){return{error:C}}},p=async(v,w)=>{var k,C,S,_,I;try{const T=await ue.functions.invoke("pin-auth",{body:{action:"VERIFY_PIN",email:v,pin:w}});if(T.error){const A=T.error.context;if(A)try{const j=await A.json();return{error:new Error(j.error||"Failed to verify PIN"),locked:j.locked,needs_pin_setup:j.needs_pin_setup,attempts_left:j.attempts_left}}catch{}return{error:new Error(T.error.message||"Failed to verify PIN")}}return(k=T.data)!=null&&k.success?{error:null,user_id:T.data.user_id}:{error:new Error(((C=T.data)==null?void 0:C.error)||"Failed to verify PIN"),locked:(S=T.data)==null?void 0:S.locked,needs_pin_setup:(_=T.data)==null?void 0:_.needs_pin_setup,attempts_left:(I=T.data)==null?void 0:I.attempts_left}}catch(T){return{error:T}}},m=async v=>{var w;try{const k=await ue.functions.invoke("pin-auth",{body:{action:"CHECK_PIN_EXISTS",email:v}});return k.error||(w=k.data)!=null&&w.error?{exists:!1,has_pin:!1}:{exists:k.data.exists,has_pin:k.data.has_pin,user_id:k.data.user_id,full_name:k.data.full_name||null}}catch{return{exists:!1,has_pin:!1}}},f=async(v,w)=>{var k,C;try{const S=await ue.functions.invoke("pin-auth",{body:{action:"CREATE_SESSION",email:v,user_id:w}});if(console.log("CREATE_SESSION response:",S),S.error)return console.error("Edge function error:",S.error),{error:new Error(S.error.message||"Failed to create session")};if((k=S.data)!=null&&k.error)return console.error("Response data error:",S.data.error),{error:new Error(S.data.error)};if((C=S.data)!=null&&C.token_hash){console.log("Verifying token_hash...");const{data:_,error:I}=await ue.auth.verifyOtp({token_hash:S.data.token_hash,type:"magiclink"});return console.log("verifyOtp result:",{data:_,error:I}),{error:I}}return{error:new Error("No session token received")}}catch(S){return console.error("loginWithPinOnly exception:",S),{error:S}}},g=()=>Xt.isNativePlatform()?"synka://auth/callback":"https://synka.in/my-card",x=async()=>{const v=g(),{error:w}=await ue.auth.signInWithOAuth({provider:"google",options:{redirectTo:v}});return{error:w}},y=async()=>{const{error:v}=await ue.auth.signInWithOAuth({provider:"linkedin_oidc",options:{redirectTo:`${window.location.origin}/my-card`}});return{error:v}},b=async()=>{await ue.auth.signOut()};return i.jsx(e4.Provider,{value:{user:t,session:r,loading:s,sendOtp:c,verifyOtp:d,setPin:h,verifyPin:p,checkPinExists:m,loginWithPinOnly:f,signInWithGoogle:x,signInWithLinkedIn:y,signOut:b,createSessionWithOtp:u},children:e})}function or(){const e=N.useContext(e4);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}const XQ=7*24*60*60*1e3,t4=()=>navigator.onLine;async function ZQ(){if(!("serviceWorker"in navigator))return console.log("[SW] Service workers not supported"),null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return console.log("[SW] Service worker registered"),e}catch(e){return console.error("[SW] Registration failed:",e),null}}function QQ(e,t){return window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}}function Z_(e,t){try{localStorage.setItem(`offline_${e}`,JSON.stringify({data:t,timestamp:Date.now(),expiry:Date.now()+XQ}))}catch(n){console.warn("[Offline] Failed to persist data:",n),JQ()}}function Q_(e){try{const t=localStorage.getItem(`offline_${e}`);if(!t)return null;const n=JSON.parse(t);return!t4()||Date.now()<=n.expiry?n.data:(localStorage.removeItem(`offline_${e}`),null)}catch{return null}}function JQ(){try{const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(n!=null&&n.startsWith("offline_")){const r=localStorage.getItem(n);if(r)try{const a=JSON.parse(r);Date.now()>a.expiry&&e.push(n)}catch{e.push(n)}}}e.forEach(t=>localStorage.removeItem(t))}catch{}}async function eJ(){if(t4())try{const e=JSON.parse(localStorage.getItem("offline_sync_queue")||"[]");if(e.length===0)return;console.log(`[Offline] Processing ${e.length} queued changes`),localStorage.removeItem("offline_sync_queue"),window.dispatchEvent(new CustomEvent("synka:data-sync"))}catch(e){console.error("[Offline] Failed to process queue:",e)}}const n4=N.createContext(null),r4="synka_cards_cache",a4="cards",tJ=60*60*1e3,Mv=e=>{try{const t=localStorage.getItem(`${r4}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<tJ)return r}const n=Q_(`${a4}_${e}`);if(n)return n}catch{}return{cards:[],activeCard:null}},$v=(e,t,n)=>{const r={cards:t,activeCard:n};try{localStorage.setItem(`${r4}_${e}`,JSON.stringify({data:r,timestamp:Date.now()})),Z_(`${a4}_${e}`,r)}catch{}};function nJ({children:e}){const{user:t}=or(),[n,r]=N.useState(()=>t?Mv(t.id).cards:[]),[a,s]=N.useState(()=>t?Mv(t.id).activeCard:null),[o,l]=N.useState(()=>t?Mv(t.id).cards.length===0:!1),c=N.useRef(!1),d=N.useRef(0),u=N.useRef(null),h=N.useCallback(()=>{d.current=0,u.current&&(clearTimeout(u.current),u.current=null)},[]),p=N.useCallback(async()=>{if(!t){h(),r([]),s(null),l(!1),c.current=!1;return}c.current||l(!0);const{data:b,error:v}=await ue.from("cards").select("*").eq("user_id",t.id).order("created_at",{ascending:!0});if(v){console.error("Error fetching cards:",v),l(!1),c.current=!0,h();return}const w=b??[],k=w.find(I=>I.is_default)??null,C=t.email||"",S=k&&(k.email===C||k.full_name&&k.full_name.length>0),_=!c.current&&!S;if(r(w),s(_?null:k),!_&&k&&$v(t.id,w,k),_&&d.current<10){d.current+=1,u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{p()},250);return}l(!1),c.current=!0,h()},[t,h]);N.useEffect(()=>{if(h(),!t){c.current=!1;return}const b=Mv(t.id);b.cards.length>0&&b.activeCard&&(r(b.cards),s(b.activeCard),l(!1)),p();const v=()=>{console.log("[Cards] Data sync triggered - refetching"),p()};return window.addEventListener("synka:data-sync",v),()=>{h(),window.removeEventListener("synka:data-sync",v)}},[t==null?void 0:t.id,p,h]);const m=async b=>{if(!t)return{error:"Not authenticated"};if(n.some(A=>A.name.toLowerCase().trim()===b.toLowerCase().trim()))return{error:"A card with this name already exists"};const w=n.find(A=>A.is_default),C=(w==null?void 0:w.photo_url)||n.some(A=>A.photo_url)?"photo-logo":"color",S=(w==null?void 0:w.photo_url)||null,{data:_,error:I}=await ue.from("cards").insert({user_id:t.id,name:b.trim(),is_default:!1,layout:C,photo_url:S,full_name:(w==null?void 0:w.full_name)||null,email:(w==null?void 0:w.email)||t.email||null,phone:(w==null?void 0:w.phone)||null}).select().single();if(I)return{error:I.message};const T=_;return r(A=>[...A,T]),s(T),{data:T}},f=async(b,v)=>{if(!t)return{error:"Not authenticated"};const{data:w,error:k}=await ue.from("cards").update(v).eq("id",b).eq("user_id",t.id).select().single();if(k)return{error:k.message};const C=w,S=n.map(_=>_.id===b?C:_);return r(S),(a==null?void 0:a.id)===b&&s(C),(a==null?void 0:a.id)===b?$v(t.id,S,C):$v(t.id,S,a),{data:C}},g=async b=>{if(!t)return{error:"Not authenticated"};if(n.length<=1)return{error:"Cannot delete the only card"};const v=n.find(C=>C.id===b),{error:w}=await ue.from("cards").delete().eq("id",b).eq("user_id",t.id);if(w)return{error:w.message};const k=n.filter(C=>C.id!==b);return r(k),v!=null&&v.is_default&&k.length>0?(await x(k[0].id),s(k[0])):(a==null?void 0:a.id)===b&&s(k[0]||null),{success:!0}},x=async b=>{if(!t)return{error:"Not authenticated"};await ue.from("cards").update({is_default:!1}).eq("user_id",t.id);const{data:v,error:w}=await ue.from("cards").update({is_default:!0}).eq("id",b).eq("user_id",t.id).select().single();if(w||!v)return{error:w==null?void 0:w.message};const k=v,C=n.map(S=>({...S,is_default:S.id===b}));return r(C),s(k),$v(t.id,C,k),{data:k}},y=async b=>{const v=n.find(w=>w.id===b)??null;return v?(s(v),v):null};return i.jsx(n4.Provider,{value:{cards:n,activeCard:a,loading:o,createCard:m,updateCard:f,deleteCard:g,setDefaultCard:x,selectCard:y,refetch:p},children:e})}function Df(){const e=N.useContext(n4);if(!e)throw new Error("useCards must be used within a CardsProvider");return e}async function rJ(e){const{data:t,error:n}=await ue.from("profiles").select("*").eq("slug",e).maybeSingle();if(n||!t)return{profile:null,card:null};const r={...t,name:t.full_name||"",designation:t.designation||t.title||"",company:t.company||"",phone:t.phone||"",email:t.email||"",website:t.website||"",whatsapp:t.whatsapp||"",linkedin:t.linkedin||"",about:t.about||"",photo_url:t.photo_url||"",logo_url:t.logo_url||"",card_design:t.card_design||"minimal",public_slug:t.slug||""},{data:a}=await ue.from("cards").select("*").eq("user_id",t.user_id).eq("is_default",!0).maybeSingle();return{profile:r,card:a}}function J_(){const{user:e}=or(),[t,n]=N.useState(!1),[r,a]=N.useState(!0),[s,o]=N.useState([]),[l,c]=N.useState([]),[d,u]=N.useState({totalUsers:0,freeUsers:0,orangeUsers:0,totalOrders:0,pvcOrders:0,metalOrders:0,totalRevenue:0});N.useEffect(()=>{(async()=>{if(!e){n(!1),a(!1);return}const{data:b,error:v}=await ue.from("user_roles").select("role").eq("user_id",e.id).eq("role","admin").maybeSingle();n(!!b&&!v),a(!1)})()},[e]);const h=N.useCallback(async()=>{if(!t)return;const{data:y,error:b}=await ue.from("profiles").select("id, user_id, full_name, email, phone, plan, created_at").order("created_at",{ascending:!1});if(b){console.error("Error fetching users:",b);return}const v=await Promise.all((y||[]).map(async w=>{var S,_;const[k,C]=await Promise.all([ue.from("user_roles").select("role").eq("user_id",w.user_id).limit(1).maybeSingle(),w.full_name?Promise.resolve({data:null}):ue.from("cards").select("full_name").eq("user_id",w.user_id).eq("is_default",!0).limit(1).maybeSingle()]);return{...w,full_name:w.full_name||((S=C.data)==null?void 0:S.full_name)||null,role:((_=k.data)==null?void 0:_.role)||"free"}}));o(v)},[t]),p=N.useCallback(async()=>{if(!t)return;const{data:y,error:b}=await ue.from("orders").select("*").order("created_at",{ascending:!1});if(b){console.error("Error fetching orders:",b);return}const v=await Promise.all((y||[]).map(async w=>{const[k,C]=await Promise.all([ue.from("profiles").select("full_name, email, phone").eq("user_id",w.user_id).maybeSingle(),ue.from("cards").select("full_name, phone").eq("user_id",w.user_id).eq("is_default",!0).maybeSingle()]),S=k.data,_=C.data;return{...w,user_name:(S==null?void 0:S.full_name)||(_==null?void 0:_.full_name)||"Unknown",user_email:(S==null?void 0:S.email)||"Unknown",user_phone:(S==null?void 0:S.phone)||(_==null?void 0:_.phone)||null}}));c(v)},[t]),m=N.useCallback(async(y,b)=>{if(!t)return;let v=ue.from("profiles").select("plan, created_at"),w=ue.from("orders").select("product_type, amount, status, created_at");y&&(v=v.gte("created_at",y.toISOString()),w=w.gte("created_at",y.toISOString())),b&&(v=v.lte("created_at",b.toISOString()),w=w.lte("created_at",b.toISOString()));const[k,C]=await Promise.all([v,w]),S=k.data||[],I=(C.data||[]).filter(T=>T.status==="payment_success"||T.status==="placed"||T.status==="dispatched"||T.status==="delivered");u({totalUsers:S.length,freeUsers:S.filter(T=>T.plan==="Free").length,orangeUsers:S.filter(T=>T.plan==="Orange").length,totalOrders:I.length,pvcOrders:I.filter(T=>T.product_type==="pvc").length,metalOrders:I.filter(T=>T.product_type==="metal").length,totalRevenue:I.reduce((T,A)=>T+Number(A.amount),0)})},[t]),f=N.useCallback(async(y,b)=>{const{error:v}=await ue.rpc("upgrade_user_plan",{_user_id:y,_new_plan:b});if(v)throw console.error("Error upgrading user:",v),v;await h()},[h]),g=N.useCallback(async y=>{const{error:b}=await ue.from("profiles").update({plan:"Free",updated_at:new Date().toISOString()}).eq("user_id",y);if(b)throw console.error("Error downgrading user:",b),b;const{error:v}=await ue.from("user_roles").update({role:"free"}).eq("user_id",y).eq("role","orange");v&&console.error("Error updating role:",v);const{error:w}=await ue.from("plan_history").insert({user_id:y,old_plan:"Orange",new_plan:"Free",changed_by:e==null?void 0:e.id});w&&console.error("Error logging plan change:",w),await h()},[h,e==null?void 0:e.id]),x=N.useCallback(async(y,b)=>{const{error:v}=await ue.from("orders").update({status:b}).eq("id",y);if(v)throw console.error("Error updating order:",v),v;await p()},[p]);return{isAdmin:t,loading:r,users:s,orders:l,stats:d,fetchUsers:h,fetchOrders:p,fetchStats:m,upgradeUserPlan:f,downgradeUserPlan:g,updateOrderStatus:x}}const MD=[{to:"/dashboard",icon:xO,label:"Dashboard"},{to:"/crm",icon:eu,label:"CRM"},{to:"/my-card",icon:rl,label:"My Card"},{to:"/settings",icon:SO,label:"Settings"}];function aJ(){const e=Xl(),{user:t,loading:n}=or(),{isAdmin:r}=J_(),a=e.pathname==="/",s=!n&&!!t,o=r?[...MD,{to:"/admin",icon:Tf,label:"Admin"}]:MD;return!s&&a||!s?null:i.jsx("nav",{className:"fixed bottom-0 left-0 right-0 z-50 bg-background/80 backdrop-blur-xl border-t border-border/30 md:hidden pb-[env(safe-area-inset-bottom)]",children:i.jsx("div",{className:"flex items-center justify-around py-2 px-1 sm:px-2",children:o.map(l=>i.jsx(s2,{to:l.to,className:({isActive:c})=>Ie("flex flex-col items-center justify-center py-2 px-2 sm:px-3 rounded-xl transition-all duration-200 min-w-0 flex-1 max-w-[72px]",c?"text-primary":"text-muted-foreground/70 hover:text-foreground"),children:({isActive:c})=>i.jsxs(i.Fragment,{children:[i.jsx(l.icon,{className:Ie("h-5 w-5 mb-1 transition-transform duration-200 flex-shrink-0",c&&"scale-105")}),i.jsx("span",{className:"text-[10px] font-medium truncate",children:l.label})]})},l.to))})})}const Cy=y1("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-medium hover:-translate-y-0.5",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-soft",outline:"border border-border bg-card text-foreground hover:bg-secondary hover:text-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-soft",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"btn-gradient text-primary-foreground hover:-translate-y-0.5",glass:"glass hover:bg-card/80 hover:-translate-y-0.5 shadow-soft",premium:"bg-foreground text-background hover:bg-foreground/90 shadow-medium hover:shadow-large hover:-translate-y-0.5"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-lg px-3",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-2xl px-10 text-lg font-semibold",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),de=N.forwardRef(({className:e,variant:t,size:n,asChild:r=!1,...a},s)=>{const o=r?KY:"button";return i.jsx(o,{className:Ie(Cy({variant:t,size:n,className:e})),ref:s,...a})});de.displayName="Button";function sy(){const{theme:e,toggleTheme:t}=QO();return i.jsxs(de,{variant:"ghost",size:"icon",onClick:t,className:"relative overflow-hidden rounded-full",children:[i.jsx(_O,{className:`h-5 w-5 transition-all duration-300 ${e==="dark"?"rotate-90 scale-0":"rotate-0 scale-100"}`}),i.jsx(bO,{className:`absolute h-5 w-5 transition-all duration-300 ${e==="dark"?"rotate-0 scale-100":"-rotate-90 scale-0"}`}),i.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}const sJ=kh("WidgetBridge"),jk=async e=>{if(!(!Xt.isNativePlatform()||!e))try{await sJ.updateWidget({profileSlug:e}),console.log("[Profile] Widget synced with slug:",e)}catch(t){console.log("[Profile] Widget sync skipped:",t)}},s4="synka_profile_cache",i4="profile",iJ=60*60*1e3,Ik=e=>{try{const t=localStorage.getItem(`${s4}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<iJ)return r}const n=Q_(`${i4}_${e}`);if(n)return n}catch{}return null},Tk=(e,t)=>{try{localStorage.setItem(`${s4}_${e}`,JSON.stringify({data:t,timestamp:Date.now()})),Z_(`${i4}_${e}`,t)}catch{}};function hl(){const{user:e}=or(),[t,n]=N.useState(()=>e?Ik(e.id):null),[r,a]=N.useState(()=>e?Ik(e.id)===null:!1),[s,o]=N.useState(!1);N.useEffect(()=>{if(e){const u=Ik(e.id);u?(n(u),a(!1),o(!0),c().finally(()=>o(!1))):(a(!0),c());const h=()=>{console.log("[Profile] Data sync triggered - refetching"),c()};return window.addEventListener("synka:data-sync",h),()=>window.removeEventListener("synka:data-sync",h)}else n(null),a(!1)},[e]);const l=u=>({...u,name:u.full_name||"",designation:u.designation||u.title||"",company:u.company||"",phone:u.phone||"",email:u.email||"",website:u.website||"",whatsapp:u.whatsapp||"",linkedin:u.linkedin||"",about:u.about||"",photo_url:u.photo_url||"",logo_url:u.logo_url||"",card_design:u.card_design||"minimal",public_slug:u.slug||""}),c=async()=>{var u,h,p,m,f;if(e){a(!0);try{const{data:g,error:x}=await ue.from("profiles").select("*").eq("user_id",e.id).maybeSingle();if(x){console.error("Error fetching profile:",x),n(null),a(!1);return}if(g){const S=l(g);n(S),Tk(e.id,S),jk(g.slug),a(!1);return}const b=`${((h=(u=e.email)==null?void 0:u.split("@")[0])==null?void 0:h.toLowerCase().replace(/[^a-z0-9]/g,""))||`user${Date.now()}`}${Math.floor(Math.random()*1e3)}`,v=((p=e.user_metadata)==null?void 0:p.name)||((m=e.user_metadata)==null?void 0:m.full_name)||"",w=((f=e.user_metadata)==null?void 0:f.phone)||"",{data:k,error:C}=await ue.from("profiles").insert({user_id:e.id,email:e.email,full_name:v,phone:w,slug:b}).select().single();if(C){console.error("Error creating profile:",C);const{data:S}=await ue.from("profiles").select("*").eq("user_id",e.id).maybeSingle();if(S){const _=l(S);n(_),Tk(e.id,_),jk(S.slug)}else n(null)}else if(k){const S=l(k);n(S),Tk(e.id,S),jk(k.slug)}}catch(g){console.error("Unexpected error in fetchProfile:",g),n(null)}finally{a(!1)}}};return{profile:t,loading:r,updateProfile:async u=>{if(!e)return{error:new Error("Not authenticated")};const h={};"name"in u&&(h.full_name=u.name),"full_name"in u&&(h.full_name=u.full_name),"designation"in u&&(h.designation=u.designation),"title"in u&&(h.title=u.title),"company"in u&&(h.company=u.company),"phone"in u&&(h.phone=u.phone),"email"in u&&(h.email=u.email),"website"in u&&(h.website=u.website),"whatsapp"in u&&(h.whatsapp=u.whatsapp),"linkedin"in u&&(h.linkedin=u.linkedin),"about"in u&&(h.about=u.about),"photo_url"in u&&(h.photo_url=u.photo_url),"logo_url"in u&&(h.logo_url=u.logo_url),"card_design"in u&&(h.card_design=u.card_design),"card_name"in u&&(h.card_name=u.card_name),"layout"in u&&(h.layout=u.layout),"slug"in u&&(h.slug=u.slug),"public_slug"in u&&(h.slug=u.public_slug);const{error:p}=await ue.from("profiles").update(h).eq("user_id",e.id);return p||n(m=>m?{...m,...u,...h}:null),{error:p}},refetch:c}}const At=N.forwardRef(({className:e,type:t,...n},r)=>i.jsx("input",{type:t,className:Ie("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...n}));At.displayName="Input";const Gw=XY,qw=ZY,oJ=N.forwardRef(({className:e,inset:t,children:n,...r},a)=>i.jsxs(LP,{ref:a,className:Ie("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...r,children:[n,i.jsx(wy,{className:"ml-auto h-4 w-4"})]}));oJ.displayName=LP.displayName;const lJ=N.forwardRef(({className:e,...t},n)=>i.jsx(zP,{ref:n,className:Ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));lJ.displayName=zP.displayName;const _y=N.forwardRef(({className:e,sideOffset:t=4,...n},r)=>i.jsx(YY,{children:i.jsx(BP,{ref:r,sideOffset:t,className:Ie("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));_y.displayName=BP.displayName;const fc=N.forwardRef(({className:e,inset:t,...n},r)=>i.jsx(WP,{ref:r,className:Ie("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...n}));fc.displayName=WP.displayName;const cJ=N.forwardRef(({className:e,children:t,checked:n,...r},a)=>i.jsxs(UP,{ref:a,className:Ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:n,...r,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(VP,{children:i.jsx(dn,{className:"h-4 w-4"})})}),t]}));cJ.displayName=UP.displayName;const uJ=N.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(HP,{ref:r,className:Ie("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(VP,{children:i.jsx(gO,{className:"h-2 w-2 fill-current"})})}),t]}));uJ.displayName=HP.displayName;const bw=N.forwardRef(({className:e,inset:t,...n},r)=>i.jsx(GP,{ref:r,className:Ie("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...n}));bw.displayName=GP.displayName;const jm=N.forwardRef(({className:e,...t},n)=>i.jsx(qP,{ref:n,className:Ie("-mx-1 my-1 h-px bg-muted",e),...t}));jm.displayName=qP.displayName;var o4="AlertDialog",[dJ]=dl(o4,[KP]),Zl=KP(),l4=e=>{const{__scopeAlertDialog:t,...n}=e,r=Zl(t);return i.jsx(z_,{...r,...n,modal:!0})};l4.displayName=o4;var hJ="AlertDialogTrigger",pJ=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Zl(n);return i.jsx(eX,{...a,...r,ref:t})});pJ.displayName=hJ;var mJ="AlertDialogPortal",c4=e=>{const{__scopeAlertDialog:t,...n}=e,r=Zl(t);return i.jsx(O_,{...r,...n})};c4.displayName=mJ;var fJ="AlertDialogOverlay",u4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Zl(n);return i.jsx(h1,{...a,...r,ref:t})});u4.displayName=fJ;var Im="AlertDialogContent",[gJ,xJ]=dJ(Im),yJ=JY("AlertDialogContent"),d4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,children:r,...a}=e,s=Zl(n),o=N.useRef(null),l=gr(t,o),c=N.useRef(null);return i.jsx(QY,{contentName:Im,titleName:h4,docsSlug:"alert-dialog",children:i.jsx(gJ,{scope:n,cancelRef:c,children:i.jsxs(p1,{role:"alertdialog",...s,...a,ref:l,onOpenAutoFocus:Mn(a.onOpenAutoFocus,d=>{var u;d.preventDefault(),(u=c.current)==null||u.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[i.jsx(yJ,{children:r}),i.jsx(vJ,{contentRef:o})]})})})});d4.displayName=Im;var h4="AlertDialogTitle",p4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Zl(n);return i.jsx(m1,{...a,...r,ref:t})});p4.displayName=h4;var m4="AlertDialogDescription",f4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Zl(n);return i.jsx(f1,{...a,...r,ref:t})});f4.displayName=m4;var bJ="AlertDialogAction",g4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,a=Zl(n);return i.jsx(L_,{...a,...r,ref:t})});g4.displayName=bJ;var x4="AlertDialogCancel",y4=N.forwardRef((e,t)=>{const{__scopeAlertDialog:n,...r}=e,{cancelRef:a}=xJ(x4,n),s=Zl(n),o=gr(t,a);return i.jsx(L_,{...s,...r,ref:o})});y4.displayName=x4;var vJ=({contentRef:e})=>{const t=`\`${Im}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Im}\` by passing a \`${m4}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Im}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return N.useEffect(()=>{var r;document.getElementById((r=e.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},wJ=l4,NJ=c4,b4=u4,v4=d4,w4=g4,N4=y4,k4=p4,S4=f4;const Jm=wJ,kJ=NJ,C4=N.forwardRef(({className:e,...t},n)=>i.jsx(b4,{className:Ie("fixed inset-0 z-[3000] bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:n}));C4.displayName=b4.displayName;const Wd=N.forwardRef(({className:e,...t},n)=>i.jsxs(kJ,{children:[i.jsx(C4,{}),i.jsx(v4,{ref:n,className:Ie("fixed left-[50%] top-[50%] z-[3001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Wd.displayName=v4.displayName;const Ud=({className:e,...t})=>i.jsx("div",{className:Ie("flex flex-col space-y-2 text-center sm:text-left",e),...t});Ud.displayName="AlertDialogHeader";const Vd=({className:e,...t})=>i.jsx("div",{className:Ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Vd.displayName="AlertDialogFooter";const Hd=N.forwardRef(({className:e,...t},n)=>i.jsx(k4,{ref:n,className:Ie("text-lg font-semibold",e),...t}));Hd.displayName=k4.displayName;const Gd=N.forwardRef(({className:e,...t},n)=>i.jsx(S4,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));Gd.displayName=S4.displayName;const qd=N.forwardRef(({className:e,...t},n)=>i.jsx(w4,{ref:n,className:Ie(Cy(),e),...t}));qd.displayName=w4.displayName;const Kd=N.forwardRef(({className:e,...t},n)=>i.jsx(N4,{ref:n,className:Ie(Cy({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Kd.displayName=N4.displayName;const SJ="modulepreload",CJ=function(e){return"/"+e},$D={},bo=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(n.map(c=>{if(c=CJ(c),c in $D)return;$D[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":SJ,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,m)=>{h.addEventListener("load",p),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})};var Kw;(function(e){e.Heavy="HEAVY",e.Medium="MEDIUM",e.Light="LIGHT"})(Kw||(Kw={}));var Yw;(function(e){e.Success="SUCCESS",e.Warning="WARNING",e.Error="ERROR"})(Yw||(Yw={}));const Fv=kh("Haptics",{web:()=>bo(()=>import("./web-CshHWvjz.js"),__vite__mapDeps([0,1,2,3])).then(e=>new e.HapticsWeb)}),Zn={light:async()=>{Xt.isNativePlatform()?await Fv.impact({style:Kw.Light}):"vibrate"in navigator&&navigator.vibrate(8)},medium:async()=>{Xt.isNativePlatform()?await Fv.impact({style:Kw.Medium}):"vibrate"in navigator&&navigator.vibrate(12)},success:async()=>{Xt.isNativePlatform()?await Fv.notification({type:Yw.Success}):"vibrate"in navigator&&navigator.vibrate([20,20,20])},error:async()=>{Xt.isNativePlatform()?await Fv.notification({type:Yw.Error}):"vibrate"in navigator&&navigator.vibrate([60,30,60])}};function _4({cards:e,activeCard:t,onSelect:n,onSetDefault:r,onAdd:a,onDelete:s,onEditCard:o,onUpdateCardName:l,variant:c="desktop",isOrangePlan:d=!1}){var W,O;const u=Pa(),[h,p]=N.useState(null),[m,f]=N.useState(""),[g,x]=N.useState(!1),[y,b]=N.useState(""),[v,w]=N.useState(null),[k,C]=N.useState(!1),S=N.useRef(null),_=N.useRef(null),I=N.useRef(0);N.useEffect(()=>{h&&S.current&&(S.current.focus(),S.current.select())},[h]),N.useEffect(()=>()=>{_.current&&clearTimeout(_.current)},[]);const T=U=>{f(U.name),p(U.id)},A=async U=>{const K=e.find(te=>te.id===U),ce=m.trim();if(!ce){p(null);return}if(K&&ce===K.name){p(null);return}if(e.some(te=>te.id!==U&&te.name.toLowerCase().trim()===ce.toLowerCase())){ie({title:"Error",description:"A card with this name already exists",variant:"destructive"}),p(null);return}l&&(await l(U,ce),Zn.light()),p(null)},j=(U,K)=>{U.key==="Enter"?A(K):U.key==="Escape"&&p(null)},D=()=>{C(!1),u("/settings/upgrade")},F=async(U,K)=>{K.stopPropagation();const ce=e.find(ne=>ne.id===U);ce!=null&&ce.is_default||(await r(U),C(!1),Zn.medium(),ie({title:"Default card updated",description:"QR & link now point to this card"}))},B=N.useCallback((U,K)=>{K.stopPropagation(),I.current+=1,I.current===1?_.current=setTimeout(()=>{I.current===1&&(n(U.id),C(!1),Zn.light()),I.current=0},250):I.current===2&&(_.current&&clearTimeout(_.current),I.current=0,T(U),Zn.light())},[n]),q=(U,K)=>{K.stopPropagation(),n(U),C(!1),o==null||o(U)},$=async()=>{if(!y.trim()){ie({title:"Error",description:"Please enter a card name",variant:"destructive"});return}const U=await a(y.trim());U.error?ie({title:"Error",description:U.error,variant:"destructive"}):(ie({title:"Card created",description:`"${y.trim()}" has been created`}),b(""),x(!1),Zn.medium())},L=async()=>{if(!v)return;const U=e.find(ce=>ce.id===v);if(e.length<=1){ie({title:"Cannot delete",description:"You must have at least one card",variant:"destructive"}),w(null);return}const K=await s(v);K.error?ie({title:"Error",description:K.error,variant:"destructive"}):(ie({title:"Card deleted",description:`"${U==null?void 0:U.name}" has been deleted`}),Zn.medium()),w(null)},M=d,X=U=>!(e.length<=1||U.is_default),G=({card:U})=>{const K=h===U.id,ce=U.is_default,ne=(t==null?void 0:t.id)===U.id,te=X(U);return i.jsxs("div",{className:Ie("flex items-center gap-2 px-2 py-2.5 rounded-lg cursor-pointer transition-all duration-200","hover:bg-muted/60",ne&&"bg-primary/5 ring-1 ring-primary/20"),children:[i.jsx("button",{onClick:Te=>F(U.id,Te),className:Ie("flex-shrink-0 p-1 rounded-full transition-all duration-200 active:scale-90",ce?"text-orange-500 cursor-default":"text-muted-foreground/30 hover:text-orange-400 hover:bg-orange-500/10"),disabled:ce,title:ce?"Default card":"Set as default",children:i.jsx(Sk,{className:Ie("h-4 w-4 transition-all duration-300",ce&&"fill-orange-500 drop-shadow-sm")})}),i.jsx("div",{className:"flex-1 min-w-0",children:K?i.jsx(At,{ref:S,value:m,onChange:Te=>f(Te.target.value),onKeyDown:Te=>j(Te,U.id),onBlur:()=>A(U.id),className:"h-7 text-sm bg-background",onClick:Te=>Te.stopPropagation()}):i.jsxs("div",{onClick:Te=>B(U,Te),className:Ie("text-sm text-left truncate w-full py-0.5 px-1 -mx-1 rounded select-none","transition-colors duration-150","hover:text-foreground",ne?"text-foreground font-medium":"text-foreground/80"),title:"Tap to switch  Double-tap to rename",children:[i.jsx("span",{className:"truncate",children:U.name}),ce&&i.jsx("span",{className:"text-orange-500/70 text-xs ml-1.5 font-normal",children:"(Default)"})]})}),i.jsxs("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[i.jsx("button",{onClick:Te=>q(U.id,Te),className:Ie("p-1.5 rounded-md transition-all duration-150 active:scale-90","text-muted-foreground/50 hover:text-foreground hover:bg-muted"),title:"Edit card details",children:i.jsx(ib,{className:"h-3.5 w-3.5"})}),te&&i.jsx("button",{onClick:Te=>{Te.stopPropagation(),w(U.id)},className:Ie("p-1.5 rounded-md transition-all duration-150 active:scale-90","text-muted-foreground/50 hover:text-destructive hover:bg-destructive/10"),title:"Delete card",children:i.jsx(ti,{className:"h-3.5 w-3.5"})})]})]})};return c==="mobile"?i.jsxs(i.Fragment,{children:[i.jsxs(Gw,{open:k,onOpenChange:C,children:[i.jsx(qw,{asChild:!0,children:i.jsxs("button",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-background border border-border/60 shadow-sm active:scale-95 transition-transform",children:[(t==null?void 0:t.is_default)&&i.jsx(Sk,{className:"h-3 w-3 text-orange-500 fill-orange-500"}),i.jsx("span",{className:"truncate max-w-[100px]",children:(t==null?void 0:t.name)||"My Card"}),i.jsx(vy,{className:"h-3 w-3 text-muted-foreground"})]})}),i.jsxs(_y,{align:"start",className:"w-64 bg-background z-50 p-2 shadow-lg border",children:[i.jsx("div",{className:"space-y-0.5",children:e.map(U=>i.jsx(G,{card:U},U.id))}),i.jsx(jm,{className:"my-2"}),M?i.jsxs("button",{onClick:()=>{C(!1),x(!0)},className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-muted transition-colors text-primary font-medium",children:[i.jsx(fo,{className:"h-4 w-4"}),"Create New Card"]}):i.jsxs("div",{children:[i.jsxs("button",{onClick:D,className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-orange-500/10 transition-colors text-orange-500 font-medium",children:[i.jsx(Lw,{className:"h-4 w-4"}),"Upgrade to Orange"]}),i.jsx("p",{className:"px-2 pb-2 text-xs text-muted-foreground leading-snug",children:"Add multiple cards"})]})]})]}),i.jsx(Jm,{open:!!v,onOpenChange:()=>w(null),children:i.jsxs(Wd,{children:[i.jsxs(Ud,{children:[i.jsx(Hd,{children:"Delete Card"}),i.jsxs(Gd,{children:['Are you sure you want to delete "',(W=e.find(U=>U.id===v))==null?void 0:W.name,'"? This action cannot be undone.']})]}),i.jsxs(Vd,{children:[i.jsx(Kd,{children:"Cancel"}),i.jsx(qd,{onClick:L,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),g&&i.jsx("div",{className:"fixed inset-0 bg-black/50 z-[2000] flex justify-center px-4",onClick:()=>x(!1),children:i.jsxs("div",{className:"absolute left-4 right-4 max-w-72 mx-auto bg-background p-4 rounded-xl shadow-lg animate-scale-in",style:{top:"calc(env(safe-area-inset-top) + 12px)"},onClick:U=>U.stopPropagation(),children:[i.jsx("h3",{className:"text-sm font-semibold mb-3",children:"Create New Card"}),i.jsx(At,{value:y,onChange:U=>b(U.target.value),placeholder:"Card name (e.g. Work, Personal)",className:"mb-3",autoFocus:!0,onKeyDown:U=>U.key==="Enter"&&$()}),i.jsxs("div",{className:"flex gap-2 justify-end",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>x(!1),children:"Cancel"}),i.jsx(de,{size:"sm",onClick:$,children:"Create"})]})]})})]}):i.jsxs(i.Fragment,{children:[i.jsxs(Gw,{open:k,onOpenChange:C,children:[i.jsx(qw,{asChild:!0,children:i.jsxs(de,{variant:"ghost",className:"gap-2 hover:bg-muted/60",children:[(t==null?void 0:t.is_default)&&i.jsx(Sk,{className:"h-4 w-4 text-orange-500 fill-orange-500"}),i.jsx("span",{children:(t==null?void 0:t.name)||"My Card"}),i.jsx(vy,{className:"h-4 w-4 text-muted-foreground"})]})}),i.jsxs(_y,{align:"end",className:"w-72 bg-background z-50 p-2 shadow-lg border",children:[i.jsx("div",{className:"space-y-0.5",children:e.map(U=>i.jsx(G,{card:U},U.id))}),i.jsx(jm,{className:"my-2"}),M?i.jsxs("button",{onClick:()=>{C(!1),x(!0)},className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-muted transition-colors text-primary font-medium",children:[i.jsx(fo,{className:"h-4 w-4"}),"Create New Card"]}):i.jsxs("div",{children:[i.jsxs("button",{onClick:D,className:"flex items-center gap-2 w-full px-2 py-2.5 text-sm rounded-lg hover:bg-orange-500/10 transition-colors text-orange-500 font-medium",children:[i.jsx(Lw,{className:"h-4 w-4"}),"Upgrade to Orange"]}),i.jsx("p",{className:"px-2 pb-2 text-xs text-muted-foreground leading-snug",children:"Add multiple cards"})]})]})]}),i.jsx(Jm,{open:!!v,onOpenChange:()=>w(null),children:i.jsxs(Wd,{children:[i.jsxs(Ud,{children:[i.jsx(Hd,{children:"Delete Card"}),i.jsxs(Gd,{children:['Are you sure you want to delete "',(O=e.find(U=>U.id===v))==null?void 0:O.name,'"? This action cannot be undone.']})]}),i.jsxs(Vd,{children:[i.jsx(Kd,{children:"Cancel"}),i.jsx(qd,{onClick:L,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),g&&i.jsx("div",{className:"fixed inset-0 bg-black/50 z-[2000] flex justify-center",onClick:()=>x(!1),children:i.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 bg-background p-6 rounded-xl shadow-lg w-80 animate-scale-in mx-4",style:{top:"calc(env(safe-area-inset-top) + 12px)"},onClick:U=>U.stopPropagation(),children:[i.jsx("h3",{className:"text-base font-semibold mb-4",children:"Create New Card"}),i.jsx(At,{value:y,onChange:U=>b(U.target.value),placeholder:"Card name (e.g. Work, Personal)",className:"mb-4",autoFocus:!0,onKeyDown:U=>U.key==="Enter"&&$()}),i.jsxs("div",{className:"flex gap-2 justify-end",children:[i.jsx(de,{variant:"ghost",onClick:()=>x(!1),children:"Cancel"}),i.jsx(de,{onClick:$,children:"Create"})]})]})})]})}const _J={sm:{logo:"h-5",text:"text-lg",gap:"gap-2"},md:{logo:"h-5",text:"text-xl",gap:"gap-2"},lg:{logo:"h-6",text:"text-2xl",gap:"gap-2"}};function Xa({size:e="md",asLink:t=!0,className:n}){const{logo:r,text:a,gap:s}=_J[e],o=i.jsxs("div",{className:Ie("flex items-center",s,n),children:[i.jsx("img",{src:"/logos/synka-logo.png",alt:"SYNKA",className:Ie(r,"w-auto object-contain"),loading:"eager",decoding:"async"}),i.jsxs("span",{className:Ie("font-anta font-bold gradient-text",a),children:["SYNKA",i.jsx("sup",{className:"text-[0.5em] ml-0.5 opacity-70",children:""})]})]});return t?i.jsx(Bs,{to:"/",children:o}):o}const jJ=[{to:"/dashboard",icon:xO,label:"Dashboard"},{to:"/crm",icon:eu,label:"CRM"},{to:"/my-card",icon:rl,label:"My Card"},{to:"/settings",icon:SO,label:"Settings"}];function IJ(){return i.jsx("span",{className:`
        inline-flex items-center
        px-3 py-1
        rounded-full
        text-xs font-semibold
        bg-orange-plan
        text-white
        tracking-wide
      `,children:"ORANGE"})}function TJ(){var k;const e=Pa(),t=Xl(),{user:n,loading:r,signOut:a}=or(),{cards:s,activeCard:o,loading:l,createCard:c,deleteCard:d,setDefaultCard:u,selectCard:h,updateCard:p}=Df(),{isAdmin:m}=J_(),{profile:f}=hl(),g=((k=f==null?void 0:f.plan)==null?void 0:k.toLowerCase())==="orange",x=!r&&!!n,y=t.pathname==="/"||t.pathname==="/index",b=t.pathname==="/my-card"||t.pathname==="/card",v=async(C,S)=>{await p(C,{name:S})},w=()=>{e("/my-card?edit=true")};return!x&&y?i.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:i.jsxs("div",{className:"w-full max-w-7xl mx-auto flex items-center justify-between h-14 md:h-16 px-3 sm:px-4 md:px-6",children:[i.jsx(Xa,{size:"sm",className:"md:hidden"}),i.jsx(Xa,{size:"md",className:"hidden md:flex"}),i.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[i.jsx(sy,{}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>e("/login"),children:"Login"}),i.jsx(de,{variant:"gradient",size:"sm",onClick:()=>e("/signup"),children:"Sign up"})]})]})}):i.jsx("header",{className:"hidden md:block fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:i.jsxs("div",{className:"w-full max-w-7xl mx-auto px-3 md:px-4 lg:px-6 xl:px-10 flex items-center justify-between h-14 lg:h-16",children:[i.jsxs("div",{className:"flex items-center gap-3 lg:gap-6",children:[i.jsx(Xa,{size:"sm",className:"lg:hidden"}),i.jsx(Xa,{size:"md",className:"hidden lg:flex"}),x&&i.jsxs("nav",{className:"flex items-center gap-1 overflow-x-auto",children:[jJ.map(C=>i.jsxs(s2,{to:C.to,className:({isActive:S})=>Ie("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition",S?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[i.jsx(C.icon,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:C.label})]},C.to)),m&&i.jsxs(s2,{to:"/admin",className:({isActive:C})=>Ie("flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition",C?"text-primary bg-primary/10":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:[i.jsx(Tf,{className:"h-4 w-4"}),i.jsx("span",{className:"hidden xl:inline",children:"Admin"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[x&&g&&i.jsx(IJ,{}),x&&b&&!l&&o&&i.jsx(_4,{cards:s,activeCard:o,onSelect:h,onSetDefault:u,onAdd:c,onDelete:d,onEditCard:w,onUpdateCardName:v,variant:"desktop",isOrangePlan:g}),i.jsx(sy,{}),x?i.jsx(de,{variant:"ghost",size:"sm",onClick:a,children:"Sign out"}):i.jsxs(i.Fragment,{children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>e("/login"),children:"Login"}),i.jsx(de,{variant:"gradient",size:"sm",onClick:()=>e("/signup"),children:"Sign up"})]})]})]})})}const EJ=y1("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function rn({className:e,variant:t,...n}){return i.jsx("div",{className:Ie(EJ({variant:t}),e),...n})}const j4=N.createContext({});function AJ(e){const t=N.useRef(null);return t.current===null&&(t.current=e()),t.current}const I4=typeof window<"u",RJ=I4?N.useLayoutEffect:N.useEffect,ej=N.createContext(null);function tj(e,t){e.indexOf(t)===-1&&e.push(t)}function nj(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const sl=(e,t,n)=>n>t?t:n<e?e:n;let rj=()=>{};const Wl={},T4=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function E4(e){return typeof e=="object"&&e!==null}const A4=e=>/^0[^.\s]+$/u.test(e);function aj(e){let t;return()=>(t===void 0&&(t=e()),t)}const Oi=e=>e,DJ=(e,t)=>n=>t(e(n)),ob=(...e)=>e.reduce(DJ),jy=(e,t,n)=>{const r=t-e;return r===0?1:(n-e)/r};class sj{constructor(){this.subscriptions=[]}add(t){return tj(this.subscriptions,t),()=>nj(this.subscriptions,t)}notify(t,n,r){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,r);else for(let s=0;s<a;s++){const o=this.subscriptions[s];o&&o(t,n,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const $l=e=>e*1e3,Mi=e=>e/1e3;function R4(e,t){return t?e*(1e3/t):0}const D4=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,MJ=1e-7,$J=12;function FJ(e,t,n,r,a){let s,o,l=0;do o=t+(n-t)/2,s=D4(o,r,a)-e,s>0?n=o:t=o;while(Math.abs(s)>MJ&&++l<$J);return o}function lb(e,t,n,r){if(e===t&&n===r)return Oi;const a=s=>FJ(s,0,1,e,n);return s=>s===0||s===1?s:D4(a(s),t,r)}const M4=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,$4=e=>t=>1-e(1-t),F4=lb(.33,1.53,.69,.99),ij=$4(F4),P4=M4(ij),O4=e=>(e*=2)<1?.5*ij(e):.5*(2-Math.pow(2,-10*(e-1))),oj=e=>1-Math.sin(Math.acos(e)),L4=$4(oj),z4=M4(oj),PJ=lb(.42,0,1,1),OJ=lb(0,0,.58,1),B4=lb(.42,0,.58,1),LJ=e=>Array.isArray(e)&&typeof e[0]!="number",W4=e=>Array.isArray(e)&&typeof e[0]=="number",zJ={linear:Oi,easeIn:PJ,easeInOut:B4,easeOut:OJ,circIn:oj,circInOut:z4,circOut:L4,backIn:ij,backInOut:P4,backOut:F4,anticipate:O4},BJ=e=>typeof e=="string",FD=e=>{if(W4(e)){rj(e.length===4);const[t,n,r,a]=e;return lb(t,n,r,a)}else if(BJ(e))return zJ[e];return e},Pv=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function WJ(e,t){let n=new Set,r=new Set,a=!1,s=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),e()),u(l)}const d={schedule:(u,h=!1,p=!1)=>{const f=p&&a?n:r;return h&&o.add(u),f.has(u)||f.add(u),u},cancel:u=>{r.delete(u),o.delete(u)},process:u=>{if(l=u,a){s=!0;return}a=!0,[n,r]=[r,n],n.forEach(c),n.clear(),a=!1,s&&(s=!1,d.process(u))}};return d}const UJ=40;function U4(e,t){let n=!1,r=!0;const a={delta:0,timestamp:0,isProcessing:!1},s=()=>n=!0,o=Pv.reduce((v,w)=>(v[w]=WJ(s),v),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:f}=o,g=()=>{const v=Wl.useManualTiming?a.timestamp:performance.now();n=!1,Wl.useManualTiming||(a.delta=r?1e3/60:Math.max(Math.min(v-a.timestamp,UJ),1)),a.timestamp=v,a.isProcessing=!0,l.process(a),c.process(a),d.process(a),u.process(a),h.process(a),p.process(a),m.process(a),f.process(a),a.isProcessing=!1,n&&t&&(r=!1,e(g))},x=()=>{n=!0,r=!0,a.isProcessing||e(g)};return{schedule:Pv.reduce((v,w)=>{const k=o[w];return v[w]=(C,S=!1,_=!1)=>(n||x(),k.schedule(C,S,_)),v},{}),cancel:v=>{for(let w=0;w<Pv.length;w++)o[Pv[w]].cancel(v)},state:a,steps:o}}const{schedule:Ar,cancel:tu,state:Ba,steps:Ek}=U4(typeof requestAnimationFrame<"u"?requestAnimationFrame:Oi,!0);let vw;function VJ(){vw=void 0}const gs={now:()=>(vw===void 0&&gs.set(Ba.isProcessing||Wl.useManualTiming?Ba.timestamp:performance.now()),vw),set:e=>{vw=e,queueMicrotask(VJ)}},V4=e=>t=>typeof t=="string"&&t.startsWith(e),H4=V4("--"),HJ=V4("var(--"),lj=e=>HJ(e)?GJ.test(e.split("/*")[0].trim()):!1,GJ=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function PD(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const Mf={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Iy={...Mf,transform:e=>sl(0,1,e)},Ov={...Mf,default:1},iy=e=>Math.round(e*1e5)/1e5,cj=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function qJ(e){return e==null}const KJ=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,uj=(e,t)=>n=>!!(typeof n=="string"&&KJ.test(n)&&n.startsWith(e)||t&&!qJ(n)&&Object.prototype.hasOwnProperty.call(n,t)),G4=(e,t,n)=>r=>{if(typeof r!="string")return r;const[a,s,o,l]=r.match(cj);return{[e]:parseFloat(a),[t]:parseFloat(s),[n]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},YJ=e=>sl(0,255,e),Ak={...Mf,transform:e=>Math.round(YJ(e))},md={test:uj("rgb","red"),parse:G4("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:r=1})=>"rgba("+Ak.transform(e)+", "+Ak.transform(t)+", "+Ak.transform(n)+", "+iy(Iy.transform(r))+")"};function XJ(e){let t="",n="",r="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),r=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),r=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,r+=r,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:a?parseInt(a,16)/255:1}}const T2={test:uj("#"),parse:XJ,transform:md.transform},cb=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),gc=cb("deg"),Zo=cb("%"),St=cb("px"),ZJ=cb("vh"),QJ=cb("vw"),OD={...Zo,parse:e=>Zo.parse(e)/100,transform:e=>Zo.transform(e*100)},ym={test:uj("hsl","hue"),parse:G4("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:r=1})=>"hsla("+Math.round(e)+", "+Zo.transform(iy(t))+", "+Zo.transform(iy(n))+", "+iy(Iy.transform(r))+")"},ia={test:e=>md.test(e)||T2.test(e)||ym.test(e),parse:e=>md.test(e)?md.parse(e):ym.test(e)?ym.parse(e):T2.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?md.transform(e):ym.transform(e),getAnimatableNone:e=>{const t=ia.parse(e);return t.alpha=0,ia.transform(t)}},JJ=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function eee(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(cj))==null?void 0:t.length)||0)+(((n=e.match(JJ))==null?void 0:n.length)||0)>0}const q4="number",K4="color",tee="var",nee="var(",LD="${}",ree=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ty(e){const t=e.toString(),n=[],r={color:[],number:[],var:[]},a=[];let s=0;const l=t.replace(ree,c=>(ia.test(c)?(r.color.push(s),a.push(K4),n.push(ia.parse(c))):c.startsWith(nee)?(r.var.push(s),a.push(tee),n.push(c)):(r.number.push(s),a.push(q4),n.push(parseFloat(c))),++s,LD)).split(LD);return{values:n,split:l,indexes:r,types:a}}function Y4(e){return Ty(e).values}function X4(e){const{split:t,types:n}=Ty(e),r=t.length;return a=>{let s="";for(let o=0;o<r;o++)if(s+=t[o],a[o]!==void 0){const l=n[o];l===q4?s+=iy(a[o]):l===K4?s+=ia.transform(a[o]):s+=a[o]}return s}}const aee=e=>typeof e=="number"?0:ia.test(e)?ia.getAnimatableNone(e):e;function see(e){const t=Y4(e);return X4(e)(t.map(aee))}const nu={test:eee,parse:Y4,createTransformer:X4,getAnimatableNone:see};function Rk(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function iee({hue:e,saturation:t,lightness:n,alpha:r}){e/=360,t/=100,n/=100;let a=0,s=0,o=0;if(!t)a=s=o=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;a=Rk(c,l,e+1/3),s=Rk(c,l,e),o=Rk(c,l,e-1/3)}return{red:Math.round(a*255),green:Math.round(s*255),blue:Math.round(o*255),alpha:r}}function Xw(e,t){return n=>n>0?t:e}const Wr=(e,t,n)=>e+(t-e)*n,Dk=(e,t,n)=>{const r=e*e,a=n*(t*t-r)+r;return a<0?0:Math.sqrt(a)},oee=[T2,md,ym],lee=e=>oee.find(t=>t.test(e));function zD(e){const t=lee(e);if(!t)return!1;let n=t.parse(e);return t===ym&&(n=iee(n)),n}const BD=(e,t)=>{const n=zD(e),r=zD(t);if(!n||!r)return Xw(e,t);const a={...n};return s=>(a.red=Dk(n.red,r.red,s),a.green=Dk(n.green,r.green,s),a.blue=Dk(n.blue,r.blue,s),a.alpha=Wr(n.alpha,r.alpha,s),md.transform(a))},E2=new Set(["none","hidden"]);function cee(e,t){return E2.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function uee(e,t){return n=>Wr(e,t,n)}function dj(e){return typeof e=="number"?uee:typeof e=="string"?lj(e)?Xw:ia.test(e)?BD:pee:Array.isArray(e)?Z4:typeof e=="object"?ia.test(e)?BD:dee:Xw}function Z4(e,t){const n=[...e],r=n.length,a=e.map((s,o)=>dj(s)(s,t[o]));return s=>{for(let o=0;o<r;o++)n[o]=a[o](s);return n}}function dee(e,t){const n={...e,...t},r={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(r[a]=dj(e[a])(e[a],t[a]));return a=>{for(const s in r)n[s]=r[s](a);return n}}function hee(e,t){const n=[],r={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const s=t.types[a],o=e.indexes[s][r[s]],l=e.values[o]??0;n[a]=l,r[s]++}return n}const pee=(e,t)=>{const n=nu.createTransformer(t),r=Ty(e),a=Ty(t);return r.indexes.var.length===a.indexes.var.length&&r.indexes.color.length===a.indexes.color.length&&r.indexes.number.length>=a.indexes.number.length?E2.has(e)&&!a.values.length||E2.has(t)&&!r.values.length?cee(e,t):ob(Z4(hee(r,a),a.values),n):Xw(e,t)};function Q4(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Wr(e,t,n):dj(e)(e,t)}const mee=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>Ar.update(t,n),stop:()=>tu(t),now:()=>Ba.isProcessing?Ba.timestamp:gs.now()}},J4=(e,t,n=10)=>{let r="";const a=Math.max(Math.round(t/n),2);for(let s=0;s<a;s++)r+=Math.round(e(s/(a-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},Zw=2e4;function hj(e){let t=0;const n=50;let r=e.next(t);for(;!r.done&&t<Zw;)t+=n,r=e.next(t);return t>=Zw?1/0:t}function fee(e,t=100,n){const r=n({...e,keyframes:[0,t]}),a=Math.min(hj(r),Zw);return{type:"keyframes",ease:s=>r.next(a*s).value/t,duration:Mi(a)}}const gee=5;function eL(e,t,n){const r=Math.max(t-gee,0);return R4(n-e(r),t-r)}const Gr={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Mk=.001;function xee({duration:e=Gr.duration,bounce:t=Gr.bounce,velocity:n=Gr.velocity,mass:r=Gr.mass}){let a,s,o=1-t;o=sl(Gr.minDamping,Gr.maxDamping,o),e=sl(Gr.minDuration,Gr.maxDuration,Mi(e)),o<1?(a=d=>{const u=d*o,h=u*e,p=u-n,m=A2(d,o),f=Math.exp(-h);return Mk-p/m*f},s=d=>{const h=d*o*e,p=h*n+n,m=Math.pow(o,2)*Math.pow(d,2)*e,f=Math.exp(-h),g=A2(Math.pow(d,2),o);return(-a(d)+Mk>0?-1:1)*((p-m)*f)/g}):(a=d=>{const u=Math.exp(-d*e),h=(d-n)*e+1;return-Mk+u*h},s=d=>{const u=Math.exp(-d*e),h=(n-d)*(e*e);return u*h});const l=5/e,c=bee(a,s,l);if(e=$l(e),isNaN(c))return{stiffness:Gr.stiffness,damping:Gr.damping,duration:e};{const d=Math.pow(c,2)*r;return{stiffness:d,damping:o*2*Math.sqrt(r*d),duration:e}}}const yee=12;function bee(e,t,n){let r=n;for(let a=1;a<yee;a++)r=r-e(r)/t(r);return r}function A2(e,t){return e*Math.sqrt(1-t*t)}const vee=["duration","bounce"],wee=["stiffness","damping","mass"];function WD(e,t){return t.some(n=>e[n]!==void 0)}function Nee(e){let t={velocity:Gr.velocity,stiffness:Gr.stiffness,damping:Gr.damping,mass:Gr.mass,isResolvedFromDuration:!1,...e};if(!WD(e,wee)&&WD(e,vee))if(e.visualDuration){const n=e.visualDuration,r=2*Math.PI/(n*1.2),a=r*r,s=2*sl(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Gr.mass,stiffness:a,damping:s}}else{const n=xee(e);t={...t,...n,mass:Gr.mass},t.isResolvedFromDuration=!0}return t}function Qw(e=Gr.visualDuration,t=Gr.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:r,restDelta:a}=n;const s=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],l={done:!1,value:s},{stiffness:c,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=Nee({...n,velocity:-Mi(n.velocity||0)}),f=p||0,g=d/(2*Math.sqrt(c*u)),x=o-s,y=Mi(Math.sqrt(c/u)),b=Math.abs(x)<5;r||(r=b?Gr.restSpeed.granular:Gr.restSpeed.default),a||(a=b?Gr.restDelta.granular:Gr.restDelta.default);let v;if(g<1){const k=A2(y,g);v=C=>{const S=Math.exp(-g*y*C);return o-S*((f+g*y*x)/k*Math.sin(k*C)+x*Math.cos(k*C))}}else if(g===1)v=k=>o-Math.exp(-y*k)*(x+(f+y*x)*k);else{const k=y*Math.sqrt(g*g-1);v=C=>{const S=Math.exp(-g*y*C),_=Math.min(k*C,300);return o-S*((f+g*y*x)*Math.sinh(_)+k*x*Math.cosh(_))/k}}const w={calculatedDuration:m&&h||null,next:k=>{const C=v(k);if(m)l.done=k>=h;else{let S=k===0?f:0;g<1&&(S=k===0?$l(f):eL(v,k,C));const _=Math.abs(S)<=r,I=Math.abs(o-C)<=a;l.done=_&&I}return l.value=l.done?o:C,l},toString:()=>{const k=Math.min(hj(w),Zw),C=J4(S=>w.next(k*S).value,k,30);return k+"ms "+C},toTransition:()=>{}};return w}Qw.applyToOptions=e=>{const t=fee(e,100,Qw);return e.ease=t.ease,e.duration=$l(t.duration),e.type="keyframes",e};function R2({keyframes:e,velocity:t=0,power:n=.8,timeConstant:r=325,bounceDamping:a=10,bounceStiffness:s=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=e[0],p={done:!1,value:h},m=_=>l!==void 0&&_<l||c!==void 0&&_>c,f=_=>l===void 0?c:c===void 0||Math.abs(l-_)<Math.abs(c-_)?l:c;let g=n*t;const x=h+g,y=o===void 0?x:o(x);y!==x&&(g=y-h);const b=_=>-g*Math.exp(-_/r),v=_=>y+b(_),w=_=>{const I=b(_),T=v(_);p.done=Math.abs(I)<=d,p.value=p.done?y:T};let k,C;const S=_=>{m(p.value)&&(k=_,C=Qw({keyframes:[p.value,f(p.value)],velocity:eL(v,_,p.value),damping:a,stiffness:s,restDelta:d,restSpeed:u}))};return S(0),{calculatedDuration:null,next:_=>{let I=!1;return!C&&k===void 0&&(I=!0,w(_),S(_)),k!==void 0&&_>=k?C.next(_-k):(!I&&w(_),p)}}}function kee(e,t,n){const r=[],a=n||Wl.mix||Q4,s=e.length-1;for(let o=0;o<s;o++){let l=a(e[o],e[o+1]);if(t){const c=Array.isArray(t)?t[o]||Oi:t;l=ob(c,l)}r.push(l)}return r}function See(e,t,{clamp:n=!0,ease:r,mixer:a}={}){const s=e.length;if(rj(s===t.length),s===1)return()=>t[0];if(s===2&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[s-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=kee(t,r,a),c=l.length,d=u=>{if(o&&u<e[0])return t[0];let h=0;if(c>1)for(;h<e.length-2&&!(u<e[h+1]);h++);const p=jy(e[h],e[h+1],u);return l[h](p)};return n?u=>d(sl(e[0],e[s-1],u)):d}function Cee(e,t){const n=e[e.length-1];for(let r=1;r<=t;r++){const a=jy(0,t,r);e.push(Wr(n,1,a))}}function _ee(e){const t=[0];return Cee(t,e.length-1),t}function jee(e,t){return e.map(n=>n*t)}function Iee(e,t){return e.map(()=>t||B4).splice(0,e.length-1)}function oy({duration:e=300,keyframes:t,times:n,ease:r="easeInOut"}){const a=LJ(r)?r.map(FD):FD(r),s={done:!1,value:t[0]},o=jee(n&&n.length===t.length?n:_ee(t),e),l=See(o,t,{ease:Array.isArray(a)?a:Iee(t,a)});return{calculatedDuration:e,next:c=>(s.value=l(c),s.done=c>=e,s)}}const Tee=e=>e!==null;function pj(e,{repeat:t,repeatType:n="loop"},r,a=1){const s=e.filter(Tee),l=a<0||t&&n!=="loop"&&t%2===1?0:s.length-1;return!l||r===void 0?s[l]:r}const Eee={decay:R2,inertia:R2,tween:oy,keyframes:oy,spring:Qw};function tL(e){typeof e.type=="string"&&(e.type=Eee[e.type])}class mj{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const Aee=e=>e/100;class fj extends mj{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,a;const{motionValue:n}=this.options;n&&n.updatedAt!==gs.now()&&this.tick(gs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(r=this.options).onStop)==null||a.call(r))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;tL(t);const{type:n=oy,repeat:r=0,repeatDelay:a=0,repeatType:s,velocity:o=0}=t;let{keyframes:l}=t;const c=n||oy;c!==oy&&typeof l[0]!="number"&&(this.mixKeyframes=ob(Aee,Q4(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});s==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=hj(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+a,this.totalDuration=this.resolvedDuration*(r+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:r,totalDuration:a,mixKeyframes:s,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return r.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:f,onUpdate:g,finalKeyframe:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const y=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?y<0:y>a;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let v=this.currentTime,w=r;if(h){const _=Math.min(this.currentTime,a)/l;let I=Math.floor(_),T=_%1;!T&&_>=1&&(T=1),T===1&&I--,I=Math.min(I,h+1),!!(I%2)&&(p==="reverse"?(T=1-T,m&&(T-=m/l)):p==="mirror"&&(w=o)),v=sl(0,1,T)*l}const k=b?{done:!1,value:u[0]}:w.next(v);s&&(k.value=s(k.value));let{done:C}=k;!b&&c!==null&&(C=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const S=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&C);return S&&f!==R2&&(k.value=pj(u,this.options,x,this.speed)),g&&g(k.value),S&&this.finish(),k}then(t,n){return this.finished.then(t,n)}get duration(){return Mi(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Mi(t)}get time(){return Mi(this.currentTime)}set time(t){var n;t=$l(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(gs.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Mi(this.currentTime))}play(){var a,s;if(this.isStopped)return;const{driver:t=mee,startTime:n}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),(s=(a=this.options).onPlay)==null||s.call(a);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=n??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(gs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function Ree(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const fd=e=>e*180/Math.PI,D2=e=>{const t=fd(Math.atan2(e[1],e[0]));return M2(t)},Dee={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:D2,rotateZ:D2,skewX:e=>fd(Math.atan(e[1])),skewY:e=>fd(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},M2=e=>(e=e%360,e<0&&(e+=360),e),UD=D2,VD=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),HD=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Mee={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:VD,scaleY:HD,scale:e=>(VD(e)+HD(e))/2,rotateX:e=>M2(fd(Math.atan2(e[6],e[5]))),rotateY:e=>M2(fd(Math.atan2(-e[2],e[0]))),rotateZ:UD,rotate:UD,skewX:e=>fd(Math.atan(e[4])),skewY:e=>fd(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function $2(e){return e.includes("scale")?1:0}function F2(e,t){if(!e||e==="none")return $2(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,a;if(n)r=Mee,a=n;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=Dee,a=l}if(!a)return $2(t);const s=r[t],o=a[1].split(",").map(Fee);return typeof s=="function"?s(o):o[s]}const $ee=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return F2(n,t)};function Fee(e){return parseFloat(e.trim())}const $f=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Ff=new Set($f),GD=e=>e===Mf||e===St,Pee=new Set(["x","y","z"]),Oee=$f.filter(e=>!Pee.has(e));function Lee(e){const t=[];return Oee.forEach(n=>{const r=e.getValue(n);r!==void 0&&(t.push([n,r.get()]),r.set(n.startsWith("scale")?1:0))}),t}const Pc={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>F2(t,"x"),y:(e,{transform:t})=>F2(t,"y")};Pc.translateX=Pc.x;Pc.translateY=Pc.y;const Dd=new Set;let P2=!1,O2=!1,L2=!1;function nL(){if(O2){const e=Array.from(Dd).filter(r=>r.needsMeasurement),t=new Set(e.map(r=>r.element)),n=new Map;t.forEach(r=>{const a=Lee(r);a.length&&(n.set(r,a),r.render())}),e.forEach(r=>r.measureInitialState()),t.forEach(r=>{r.render();const a=n.get(r);a&&a.forEach(([s,o])=>{var l;(l=r.getValue(s))==null||l.set(o)})}),e.forEach(r=>r.measureEndState()),e.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}O2=!1,P2=!1,Dd.forEach(e=>e.complete(L2)),Dd.clear()}function rL(){Dd.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(O2=!0)})}function zee(){L2=!0,rL(),nL(),L2=!1}class gj{constructor(t,n,r,a,s,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=r,this.motionValue=a,this.element=s,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Dd.add(this),P2||(P2=!0,Ar.read(rL),Ar.resolveKeyframes(nL))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:r,motionValue:a}=this;if(t[0]===null){const s=a==null?void 0:a.get(),o=t[t.length-1];if(s!==void 0)t[0]=s;else if(r&&n){const l=r.readValue(n,o);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=o),a&&s===void 0&&a.set(t[0])}Ree(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Dd.delete(this)}cancel(){this.state==="scheduled"&&(Dd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Bee=e=>e.startsWith("--");function Wee(e,t,n){Bee(t)?e.style.setProperty(t,n):e.style[t]=n}const Uee=aj(()=>window.ScrollTimeline!==void 0),Vee={};function Hee(e,t){const n=aj(e);return()=>Vee[t]??n()}const aL=Hee(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Ox=([e,t,n,r])=>`cubic-bezier(${e}, ${t}, ${n}, ${r})`,qD={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Ox([0,.65,.55,1]),circOut:Ox([.55,0,1,.45]),backIn:Ox([.31,.01,.66,-.59]),backOut:Ox([.33,1.53,.69,.99])};function sL(e,t){if(e)return typeof e=="function"?aL()?J4(e,t):"ease-out":W4(e)?Ox(e):Array.isArray(e)?e.map(n=>sL(n,t)||qD.easeOut):qD[e]}function Gee(e,t,n,{delay:r=0,duration:a=300,repeat:s=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[t]:n};c&&(u.offset=c);const h=sL(l,a);Array.isArray(h)&&(u.easing=h);const p={delay:r,duration:a,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:o==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),e.animate(u,p)}function iL(e){return typeof e=="function"&&"applyToOptions"in e}function qee({type:e,...t}){return iL(e)&&aL()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Kee extends mj{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:n,name:r,keyframes:a,pseudoElement:s,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!s,this.allowFlatten=o,this.options=t,rj(typeof t.type!="string");const d=qee(t);this.animation=Gee(n,r,a,d,s),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const u=pj(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):Wee(n,r,u),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,n;this.isPseudoElement||(n=(t=this.animation).commitStyles)==null||n.call(t)}get duration(){var n,r;const t=((r=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:r.call(n).duration)||0;return Mi(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+Mi(t)}get time(){return Mi(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=$l(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&Uee()?(this.animation.timeline=t,Oi):n(this)}}const oL={anticipate:O4,backInOut:P4,circInOut:z4};function Yee(e){return e in oL}function Xee(e){typeof e.ease=="string"&&Yee(e.ease)&&(e.ease=oL[e.ease])}const $k=10;class Zee extends Kee{constructor(t){Xee(t),tL(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:r,onComplete:a,element:s,...o}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const l=new fj({...o,autoplay:!1}),c=Math.max($k,gs.now()-this.startTime),d=sl(0,$k,c-$k);n.setWithVelocity(l.sample(Math.max(0,c-d)).value,l.sample(c).value,d),l.stop()}}const KD=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(nu.test(e)||e==="0")&&!e.startsWith("url("));function Qee(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function Jee(e,t,n,r){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const s=e[e.length-1],o=KD(a,t),l=KD(s,t);return!o||!l?!1:Qee(e)||(n==="spring"||iL(n))&&r}function z2(e){e.duration=0,e.type="keyframes"}const ete=new Set(["opacity","clipPath","filter","transform"]),tte=aj(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function nte(e){var u;const{motionValue:t,name:n,repeatDelay:r,repeatType:a,damping:s,type:o}=e;if(!(((u=t==null?void 0:t.owner)==null?void 0:u.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return tte()&&n&&ete.has(n)&&(n!=="transform"||!d)&&!c&&!r&&a!=="mirror"&&s!==0&&o!=="inertia"}const rte=40;class ate extends mj{constructor({autoplay:t=!0,delay:n=0,type:r="keyframes",repeat:a=0,repeatDelay:s=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...h}){var f;super(),this.stop=()=>{var g,x;this._animation&&(this._animation.stop(),(g=this.stopTimeline)==null||g.call(this)),(x=this.keyframeResolver)==null||x.cancel()},this.createdAt=gs.now();const p={autoplay:t,delay:n,type:r,repeat:a,repeatDelay:s,repeatType:o,name:c,motionValue:d,element:u,...h},m=(u==null?void 0:u.KeyframeResolver)||gj;this.keyframeResolver=new m(l,(g,x,y)=>this.onKeyframesResolved(g,x,p,!y),c,d,u),(f=this.keyframeResolver)==null||f.scheduleResolve()}onKeyframesResolved(t,n,r,a){var x,y;this.keyframeResolver=void 0;const{name:s,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=r;this.resolvedAt=gs.now(),Jee(t,s,o,l)||((Wl.instantAnimations||!c)&&(u==null||u(pj(t,r,n))),t[0]=t[t.length-1],z2(r),r.repeat=0);const p={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>rte?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...r,keyframes:t},m=!d&&nte(p),f=(y=(x=p.motionValue)==null?void 0:x.owner)==null?void 0:y.current,g=m?new Zee({...p,element:f}):new fj(p);g.finished.then(()=>{this.notifyFinished()}).catch(Oi),this.pendingTimeline&&(this.stopTimeline=g.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=g}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),zee()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function lL(e,t,n,r=0,a=1){const s=Array.from(e).sort((d,u)=>d.sortNodePosition(u)).indexOf(t),o=e.size,l=(o-1)*r;return typeof n=="function"?n(s,o):a===1?s*r:l-s*r}const ste=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function ite(e){const t=ste.exec(e);if(!t)return[,];const[,n,r,a]=t;return[`--${n??r}`,a]}function cL(e,t,n=1){const[r,a]=ite(e);if(!r)return;const s=window.getComputedStyle(t).getPropertyValue(r);if(s){const o=s.trim();return T4(o)?parseFloat(o):o}return lj(a)?cL(a,t,n+1):a}const ote={type:"spring",stiffness:500,damping:25,restSpeed:10},lte=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),cte={type:"keyframes",duration:.8},ute={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},dte=(e,{keyframes:t})=>t.length>2?cte:Ff.has(e)?e.startsWith("scale")?lte(t[1]):ote:ute,hte=e=>e!==null;function pte(e,{repeat:t,repeatType:n="loop"},r){const a=e.filter(hte),s=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[s]}function xj(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}function mte({when:e,delay:t,delayChildren:n,staggerChildren:r,staggerDirection:a,repeat:s,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const yj=(e,t,n,r={},a,s)=>o=>{const l=xj(r,e)||{},c=l.delay||r.delay||0;let{elapsed:d=0}=r;d=d-$l(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:p=>{t.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:s?void 0:a};mte(l)||Object.assign(u,dte(e,u)),u.duration&&(u.duration=$l(u.duration)),u.repeatDelay&&(u.repeatDelay=$l(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(z2(u),u.delay===0&&(h=!0)),(Wl.instantAnimations||Wl.skipAnimations)&&(h=!0,z2(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,h&&!s&&t.get()!==void 0){const p=pte(u.keyframes,l);if(p!==void 0){Ar.update(()=>{u.onUpdate(p),u.onComplete()});return}}return l.isSync?new fj(u):new ate(u)};function YD(e){const t=[{},{}];return e==null||e.values.forEach((n,r)=>{t[0][r]=n.get(),t[1][r]=n.getVelocity()}),t}function bj(e,t,n,r){if(typeof t=="function"){const[a,s]=YD(r);t=t(n!==void 0?n:e.custom,a,s)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,s]=YD(r);t=t(n!==void 0?n:e.custom,a,s)}return t}function Tm(e,t,n){const r=e.getProps();return bj(r,t,n!==void 0?n:r.custom,e)}const uL=new Set(["width","height","top","left","right","bottom",...$f]),XD=30,fte=e=>!isNaN(parseFloat(e));class gte{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var s;const a=gs.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((s=this.events.change)==null||s.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=gs.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=fte(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new sj);const r=this.events[t].add(n);return t==="change"?()=>{r(),Ar.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,r){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-r}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=gs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>XD)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,XD);return R4(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ef(e,t){return new gte(e,t)}const B2=e=>Array.isArray(e);function xte(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,ef(n))}function yte(e){return B2(e)?e[e.length-1]||0:e}function bte(e,t){const n=Tm(e,t);let{transitionEnd:r={},transition:a={},...s}=n||{};s={...s,...r};for(const o in s){const l=yte(s[o]);xte(e,o,l)}}const Za=e=>!!(e&&e.getVelocity);function vte(e){return!!(Za(e)&&e.add)}function W2(e,t){const n=e.getValue("willChange");if(vte(n))return n.add(t);if(!n&&Wl.WillChange){const r=new Wl.WillChange("auto");e.addValue("willChange",r),r.add(t)}}function vj(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const wte="framerAppearId",dL="data-"+vj(wte);function hL(e){return e.props[dL]}function Nte({protectedKeys:e,needsAnimating:t},n){const r=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,r}function pL(e,t,{delay:n=0,transitionOverride:r,type:a}={}){let{transition:s=e.getDefaultTransition(),transitionEnd:o,...l}=t;r&&(s=r);const c=[],d=a&&e.animationState&&e.animationState.getState()[a];for(const u in l){const h=e.getValue(u,e.latestValues[u]??null),p=l[u];if(p===void 0||d&&Nte(d,u))continue;const m={delay:n,...xj(s||{},u)},f=h.get();if(f!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===f&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const y=hL(e);if(y){const b=window.MotionHandoffAnimation(y,u,Ar);b!==null&&(m.startTime=b,g=!0)}}W2(e,u),h.start(yj(u,h,p,e.shouldReduceMotion&&uL.has(u)?{type:!1}:m,e,g));const x=h.animation;x&&c.push(x)}return o&&Promise.all(c).then(()=>{Ar.update(()=>{o&&bte(e,o)})}),c}function U2(e,t,n={}){var c;const r=Tm(e,t,n.type==="exit"?(c=e.presenceContext)==null?void 0:c.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=r||{};n.transitionOverride&&(a=n.transitionOverride);const s=r?()=>Promise.all(pL(e,r,n)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:h,staggerDirection:p}=a;return kte(e,t,d,u,h,p,n)}:()=>Promise.resolve(),{when:l}=a;if(l){const[d,u]=l==="beforeChildren"?[s,o]:[o,s];return d().then(()=>u())}else return Promise.all([s(),o(n.delay)])}function kte(e,t,n=0,r=0,a=0,s=1,o){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(U2(c,t,{...o,delay:n+(typeof r=="function"?0:r)+lL(e.variantChildren,c,r,a,s)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function Ste(e,t,n={}){e.notify("AnimationStart",t);let r;if(Array.isArray(t)){const a=t.map(s=>U2(e,s,n));r=Promise.all(a)}else if(typeof t=="string")r=U2(e,t,n);else{const a=typeof t=="function"?Tm(e,t,n.custom):t;r=Promise.all(pL(e,a,n))}return r.then(()=>{e.notify("AnimationComplete",t)})}const Cte={test:e=>e==="auto",parse:e=>e},mL=e=>t=>t.test(e),fL=[Mf,St,Zo,gc,QJ,ZJ,Cte],ZD=e=>fL.find(mL(e));function _te(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||A4(e):!0}const jte=new Set(["brightness","contrast","saturate","opacity"]);function Ite(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[r]=n.match(cj)||[];if(!r)return e;const a=n.replace(r,"");let s=jte.has(t)?1:0;return r!==n&&(s*=100),t+"("+s+a+")"}const Tte=/\b([a-z-]*)\(.*?\)/gu,V2={...nu,getAnimatableNone:e=>{const t=e.match(Tte);return t?t.map(Ite).join(" "):e}},QD={...Mf,transform:Math.round},Ete={rotate:gc,rotateX:gc,rotateY:gc,rotateZ:gc,scale:Ov,scaleX:Ov,scaleY:Ov,scaleZ:Ov,skew:gc,skewX:gc,skewY:gc,distance:St,translateX:St,translateY:St,translateZ:St,x:St,y:St,z:St,perspective:St,transformPerspective:St,opacity:Iy,originX:OD,originY:OD,originZ:St},wj={borderWidth:St,borderTopWidth:St,borderRightWidth:St,borderBottomWidth:St,borderLeftWidth:St,borderRadius:St,borderTopLeftRadius:St,borderTopRightRadius:St,borderBottomRightRadius:St,borderBottomLeftRadius:St,width:St,maxWidth:St,height:St,maxHeight:St,top:St,right:St,bottom:St,left:St,inset:St,insetBlock:St,insetBlockStart:St,insetBlockEnd:St,insetInline:St,insetInlineStart:St,insetInlineEnd:St,padding:St,paddingTop:St,paddingRight:St,paddingBottom:St,paddingLeft:St,paddingBlock:St,paddingBlockStart:St,paddingBlockEnd:St,paddingInline:St,paddingInlineStart:St,paddingInlineEnd:St,margin:St,marginTop:St,marginRight:St,marginBottom:St,marginLeft:St,marginBlock:St,marginBlockStart:St,marginBlockEnd:St,marginInline:St,marginInlineStart:St,marginInlineEnd:St,fontSize:St,backgroundPositionX:St,backgroundPositionY:St,...Ete,zIndex:QD,fillOpacity:Iy,strokeOpacity:Iy,numOctaves:QD},Ate={...wj,color:ia,backgroundColor:ia,outlineColor:ia,fill:ia,stroke:ia,borderColor:ia,borderTopColor:ia,borderRightColor:ia,borderBottomColor:ia,borderLeftColor:ia,filter:V2,WebkitFilter:V2},gL=e=>Ate[e];function xL(e,t){let n=gL(e);return n!==V2&&(n=nu),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Rte=new Set(["auto","none","0"]);function Dte(e,t,n){let r=0,a;for(;r<e.length&&!a;){const s=e[r];typeof s=="string"&&!Rte.has(s)&&Ty(s).values.length&&(a=e[r]),r++}if(a&&n)for(const s of t)e[s]=xL(n,a)}class Mte extends gj{constructor(t,n,r,a,s){super(t,n,r,a,s,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:r}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let h=t[u];if(typeof h=="string"&&(h=h.trim(),lj(h))){const p=cL(h,n.current);p!==void 0&&(t[u]=p),u===t.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!uL.has(r)||t.length!==2)return;const[a,s]=t,o=ZD(a),l=ZD(s),c=PD(a),d=PD(s);if(c!==d&&Pc[r]){this.needsMeasurement=!0;return}if(o!==l)if(GD(o)&&GD(l))for(let u=0;u<t.length;u++){const h=t[u];typeof h=="string"&&(t[u]=parseFloat(h))}else Pc[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,r=[];for(let a=0;a<t.length;a++)(t[a]===null||_te(t[a]))&&r.push(a);r.length&&Dte(t,r,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:r}=this;if(!t||!t.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pc[r](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(r,a).jump(a,!1)}measureEndState(){var l;const{element:t,name:n,unresolvedKeyframes:r}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const s=r.length-1,o=r[s];r[s]=Pc[n](t.measureViewportBox(),window.getComputedStyle(t.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,d])=>{t.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function $te(e,t,n){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let r=document;const a=(n==null?void 0:n[e])??r.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e).filter(r=>r!=null)}const yL=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function Fte(e){return E4(e)&&"offsetHeight"in e}const{schedule:Nj}=U4(queueMicrotask,!1),ro={x:!1,y:!1};function bL(){return ro.x||ro.y}function Pte(e){return e==="x"||e==="y"?ro[e]?null:(ro[e]=!0,()=>{ro[e]=!1}):ro.x||ro.y?null:(ro.x=ro.y=!0,()=>{ro.x=ro.y=!1})}function vL(e,t){const n=$te(e),r=new AbortController,a={passive:!0,...t,signal:r.signal};return[n,a,()=>r.abort()]}function JD(e){return!(e.pointerType==="touch"||bL())}function Ote(e,t,n={}){const[r,a,s]=vL(e,n),o=l=>{if(!JD(l))return;const{target:c}=l,d=t(c,l);if(typeof d!="function"||!c)return;const u=h=>{JD(h)&&(d(h),c.removeEventListener("pointerleave",u))};c.addEventListener("pointerleave",u,a)};return r.forEach(l=>{l.addEventListener("pointerenter",o,a)}),s}const wL=(e,t)=>t?e===t?!0:wL(e,t.parentElement):!1,kj=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Lte=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function NL(e){return Lte.has(e.tagName)||e.isContentEditable===!0}const ww=new WeakSet;function eM(e){return t=>{t.key==="Enter"&&e(t)}}function Fk(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const zte=(e,t)=>{const n=e.currentTarget;if(!n)return;const r=eM(()=>{if(ww.has(n))return;Fk(n,"down");const a=eM(()=>{Fk(n,"up")}),s=()=>Fk(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",s,t)});n.addEventListener("keydown",r,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",r),t)};function tM(e){return kj(e)&&!bL()}function Bte(e,t,n={}){const[r,a,s]=vL(e,n),o=l=>{const c=l.currentTarget;if(!tM(l))return;ww.add(c);const d=t(c,l),u=(m,f)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),ww.has(c)&&ww.delete(c),tM(m)&&typeof d=="function"&&d(m,{success:f})},h=m=>{u(m,c===window||c===document||n.useGlobalTarget||wL(c,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",p,a)};return r.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",o,a),Fte(l)&&(l.addEventListener("focus",d=>zte(d,a)),!NL(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),s}function kL(e){return E4(e)&&"ownerSVGElement"in e}function Wte(e){return kL(e)&&e.tagName==="svg"}const Ute=[...fL,ia,nu],Vte=e=>Ute.find(mL(e)),nM=()=>({translate:0,scale:1,origin:0,originPoint:0}),bm=()=>({x:nM(),y:nM()}),rM=()=>({min:0,max:0}),ya=()=>({x:rM(),y:rM()}),H2={current:null},SL={current:!1},Hte=typeof window<"u";function Gte(){if(SL.current=!0,!!Hte)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>H2.current=e.matches;e.addEventListener("change",t),t()}else H2.current=!1}const qte=new WeakMap;function b1(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Ey(e){return typeof e=="string"||Array.isArray(e)}const Sj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Cj=["initial",...Sj];function v1(e){return b1(e.animate)||Cj.some(t=>Ey(e[t]))}function CL(e){return!!(v1(e)||e.variants)}function Kte(e,t,n){for(const r in t){const a=t[r],s=n[r];if(Za(a))e.addValue(r,a);else if(Za(s))e.addValue(r,ef(a,{owner:e}));else if(s!==a)if(e.hasValue(r)){const o=e.getValue(r);o.liveStyle===!0?o.jump(a):o.hasAnimated||o.set(a)}else{const o=e.getStaticValue(r);e.addValue(r,ef(o!==void 0?o:a,{owner:e}))}}for(const r in n)t[r]===void 0&&e.removeValue(r);return t}const aM=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let Jw={};function _L(e){Jw=e}function Yte(){return Jw}class Xte{scrapeMotionValuesFromProps(t,n,r){return{}}constructor({parent:t,props:n,presenceContext:r,reducedMotionConfig:a,blockInitialAnimation:s,visualState:o},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=gj,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=gs.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Ar.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=o;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=r,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.options=l,this.blockInitialAnimation=!!s,this.isControllingVariants=v1(n),this.isVariantNode=CL(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in h){const m=h[p];c[p]!==void 0&&Za(m)&&m.set(c[p])}}mount(t){var n;this.current=t,qte.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,a)=>this.bindToMotionValue(a,r)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(SL.current||Gte(),this.shouldReduceMotion=H2.current),(n=this.parent)==null||n.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var t;this.projection&&this.projection.unmount(),tu(this.notifyUpdate),tu(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const r=this.features[n];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const r=Ff.has(t);r&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&Ar.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;typeof window<"u"&&window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),s&&s(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in Jw){const n=Jw[t];if(!n)continue;const{isEnabled:r,Feature:a}=n;if(!this.features[t]&&a&&r(this.props)&&(this.features[t]=new a(this)),this.features[t]){const s=this.features[t];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ya()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let r=0;r<aM.length;r++){const a=aM[r];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const s="on"+a,o=t[s];o&&(this.propEventSubscriptions[a]=this.on(a,o))}this.prevMotionValues=Kte(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const r=this.values.get(t);n!==r&&(r&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let r=this.values.get(t);return r===void 0&&n!==void 0&&(r=ef(n===null?void 0:n,{owner:this}),this.addValue(t,r)),r}readValue(t,n){let r=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return r!=null&&(typeof r=="string"&&(T4(r)||A4(r))?r=parseFloat(r):!Vte(r)&&nu.test(n)&&(r=xL(t,n)),this.setBaseTarget(t,Za(r)?r.get():r)),Za(r)?r.get():r}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var s;const{initial:n}=this.props;let r;if(typeof n=="string"||typeof n=="object"){const o=bj(this.props,n,(s=this.presenceContext)==null?void 0:s.custom);o&&(r=o[t])}if(n&&r!==void 0)return r;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!Za(a)?a:this.initialValues[t]!==void 0&&r===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new sj),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){Nj.render(this.render)}}class jL extends Xte{constructor(){super(...arguments),this.KeyframeResolver=Mte}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){const r=t.style;return r?r[n]:void 0}removeValueFromRenderState(t,{vars:n,style:r}){delete n[t],delete r[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Za(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class wu{constructor(t){this.isMounted=!1,this.node=t}update(){}}function IL({top:e,left:t,right:n,bottom:r}){return{x:{min:t,max:n},y:{min:e,max:r}}}function Zte({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Qte(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),r=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:r.y,right:r.x}}function Pk(e){return e===void 0||e===1}function G2({scale:e,scaleX:t,scaleY:n}){return!Pk(e)||!Pk(t)||!Pk(n)}function nd(e){return G2(e)||TL(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function TL(e){return sM(e.x)||sM(e.y)}function sM(e){return e&&e!=="0%"}function e0(e,t,n){const r=e-n,a=t*r;return n+a}function iM(e,t,n,r,a){return a!==void 0&&(e=e0(e,a,r)),e0(e,n,r)+t}function q2(e,t=0,n=1,r,a){e.min=iM(e.min,t,n,r,a),e.max=iM(e.max,t,n,r,a)}function EL(e,{x:t,y:n}){q2(e.x,t.translate,t.scale,t.originPoint),q2(e.y,n.translate,n.scale,n.originPoint)}const oM=.999999999999,lM=1.0000000000001;function Jte(e,t,n,r=!1){const a=n.length;if(!a)return;t.x=t.y=1;let s,o;for(let l=0;l<a;l++){s=n[l],o=s.projectionDelta;const{visualElement:c}=s.options;c&&c.props.style&&c.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&wm(e,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,EL(e,o)),r&&nd(s.latestValues)&&wm(e,s.latestValues))}t.x<lM&&t.x>oM&&(t.x=1),t.y<lM&&t.y>oM&&(t.y=1)}function vm(e,t){e.min=e.min+t,e.max=e.max+t}function cM(e,t,n,r,a=.5){const s=Wr(e.min,e.max,a);q2(e,t,n,s,r)}function wm(e,t){cM(e.x,t.x,t.scaleX,t.scale,t.originX),cM(e.y,t.y,t.scaleY,t.scale,t.originY)}function AL(e,t){return IL(Qte(e.getBoundingClientRect(),t))}function ene(e,t,n){const r=AL(e,n),{scroll:a}=t;return a&&(vm(r.x,a.offset.x),vm(r.y,a.offset.y)),r}const tne={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},nne=$f.length;function rne(e,t,n){let r="",a=!0;for(let s=0;s<nne;s++){const o=$f[s],l=e[o];if(l===void 0)continue;let c=!0;if(typeof l=="number")c=l===(o.startsWith("scale")?1:0);else{const d=parseFloat(l);c=o.startsWith("scale")?d===1:d===0}if(!c||n){const d=yL(l,wj[o]);if(!c){a=!1;const u=tne[o]||o;r+=`${u}(${d}) `}n&&(t[o]=d)}}return r=r.trim(),n?r=n(t,a?"":r):a&&(r="none"),r}function _j(e,t,n){const{style:r,vars:a,transformOrigin:s}=e;let o=!1,l=!1;for(const c in t){const d=t[c];if(Ff.has(c)){o=!0;continue}else if(H4(c)){a[c]=d;continue}else{const u=yL(d,wj[c]);c.startsWith("origin")?(l=!0,s[c]=u):r[c]=u}}if(t.transform||(o||n?r.transform=rne(t,e.transform,n):r.transform&&(r.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=s;r.transformOrigin=`${c} ${d} ${u}`}}function RL(e,{style:t,vars:n},r,a){const s=e.style;let o;for(o in t)s[o]=t[o];a==null||a.applyProjectionStyles(s,r);for(o in n)s.setProperty(o,n[o])}function uM(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const px={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(St.test(e))e=parseFloat(e);else return e;const n=uM(e,t.target.x),r=uM(e,t.target.y);return`${n}% ${r}%`}},ane={correct:(e,{treeScale:t,projectionDelta:n})=>{const r=e,a=nu.parse(e);if(a.length>5)return r;const s=nu.createTransformer(e),o=typeof a[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;a[0+o]/=l,a[1+o]/=c;const d=Wr(l,c,.5);return typeof a[2+o]=="number"&&(a[2+o]/=d),typeof a[3+o]=="number"&&(a[3+o]/=d),s(a)}},K2={borderRadius:{...px,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomLeftRadius:px,borderBottomRightRadius:px,boxShadow:ane};function DL(e,{layout:t,layoutId:n}){return Ff.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!K2[e]||e==="opacity")}function jj(e,t,n){var o;const r=e.style,a=t==null?void 0:t.style,s={};if(!r)return s;for(const l in r)(Za(r[l])||a&&Za(a[l])||DL(l,e)||((o=n==null?void 0:n.getValue(l))==null?void 0:o.liveStyle)!==void 0)&&(s[l]=r[l]);return s}function sne(e){return window.getComputedStyle(e)}class ine extends jL{constructor(){super(...arguments),this.type="html",this.renderInstance=RL}readValueFromInstance(t,n){var r;if(Ff.has(n))return(r=this.projection)!=null&&r.isProjecting?$2(n):$ee(t,n);{const a=sne(t),s=(H4(n)?a.getPropertyValue(n):a[n])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(t,{transformPagePoint:n}){return AL(t,n)}build(t,n,r){_j(t,n,r.transformTemplate)}scrapeMotionValuesFromProps(t,n,r){return jj(t,n,r)}}const one={offset:"stroke-dashoffset",array:"stroke-dasharray"},lne={offset:"strokeDashoffset",array:"strokeDasharray"};function cne(e,t,n=1,r=0,a=!0){e.pathLength=1;const s=a?one:lne;e[s.offset]=`${-r}`,e[s.array]=`${t} ${n}`}const une=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function ML(e,{attrX:t,attrY:n,attrScale:r,pathLength:a,pathSpacing:s=1,pathOffset:o=0,...l},c,d,u){if(_j(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:h,style:p}=e;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete h.transformBox);for(const m of une)h[m]!==void 0&&(p[m]=h[m],delete h[m]);t!==void 0&&(h.x=t),n!==void 0&&(h.y=n),r!==void 0&&(h.scale=r),a!==void 0&&cne(h,a,s,o,!1)}const $L=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),FL=e=>typeof e=="string"&&e.toLowerCase()==="svg";function dne(e,t,n,r){RL(e,t,void 0,r);for(const a in t.attrs)e.setAttribute($L.has(a)?a:vj(a),t.attrs[a])}function PL(e,t,n){const r=jj(e,t,n);for(const a in e)if(Za(e[a])||Za(t[a])){const s=$f.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;r[s]=e[a]}return r}class hne extends jL{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ya}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(Ff.has(n)){const r=gL(n);return r&&r.default||0}return n=$L.has(n)?n:vj(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,r){return PL(t,n,r)}build(t,n,r){ML(t,n,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(t,n,r,a){dne(t,n,r,a)}mount(t){this.isSVGTag=FL(t.tagName),super.mount(t)}}const pne=Cj.length;function OL(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?OL(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<pne;n++){const r=Cj[n],a=e.props[r];(Ey(a)||a===!1)&&(t[r]=a)}return t}function LL(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}const mne=[...Sj].reverse(),fne=Sj.length;function gne(e){return t=>Promise.all(t.map(({animation:n,options:r})=>Ste(e,n,r)))}function xne(e){let t=gne(e),n=dM(),r=!0;const a=c=>(d,u)=>{var p;const h=Tm(e,u,c==="exit"?(p=e.presenceContext)==null?void 0:p.custom:void 0);if(h){const{transition:m,transitionEnd:f,...g}=h;d={...d,...g,...f}}return d};function s(c){t=c(e)}function o(c){const{props:d}=e,u=OL(e.parent)||{},h=[],p=new Set;let m={},f=1/0;for(let x=0;x<fne;x++){const y=mne[x],b=n[y],v=d[y]!==void 0?d[y]:u[y],w=Ey(v),k=y===c?b.isActive:null;k===!1&&(f=x);let C=v===u[y]&&v!==d[y]&&w;if(C&&r&&e.manuallyAnimateOnMount&&(C=!1),b.protectedKeys={...m},!b.isActive&&k===null||!v&&!b.prevProp||b1(v)||typeof v=="boolean")continue;const S=yne(b.prevProp,v);let _=S||y===c&&b.isActive&&!C&&w||x>f&&w,I=!1;const T=Array.isArray(v)?v:[v];let A=T.reduce(a(y),{});k===!1&&(A={});const{prevResolvedValues:j={}}=b,D={...j,...A},F=$=>{_=!0,p.has($)&&(I=!0,p.delete($)),b.needsAnimating[$]=!0;const L=e.getValue($);L&&(L.liveStyle=!1)};for(const $ in D){const L=A[$],M=j[$];if(m.hasOwnProperty($))continue;let X=!1;B2(L)&&B2(M)?X=!LL(L,M):X=L!==M,X?L!=null?F($):p.add($):L!==void 0&&p.has($)?F($):b.protectedKeys[$]=!0}b.prevProp=v,b.prevResolvedValues=A,b.isActive&&(m={...m,...A}),r&&e.blockInitialAnimation&&(_=!1);const B=C&&S;_&&(!B||I)&&h.push(...T.map($=>{const L={type:y};if(typeof $=="string"&&r&&!B&&e.manuallyAnimateOnMount&&e.parent){const{parent:M}=e,X=Tm(M,$);if(M.enteringChildren&&X){const{delayChildren:G}=X.transition||{};L.delay=lL(M.enteringChildren,e,G)}}return{animation:$,options:L}}))}if(p.size){const x={};if(typeof d.initial!="boolean"){const y=Tm(e,Array.isArray(d.initial)?d.initial[0]:d.initial);y&&y.transition&&(x.transition=y.transition)}p.forEach(y=>{const b=e.getBaseTarget(y),v=e.getValue(y);v&&(v.liveStyle=!0),x[y]=b??null}),h.push({animation:x})}let g=!!h.length;return r&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(g=!1),r=!1,g?t(h):Promise.resolve()}function l(c,d){var h;if(n[c].isActive===d)return Promise.resolve();(h=e.variantChildren)==null||h.forEach(p=>{var m;return(m=p.animationState)==null?void 0:m.setActive(c,d)}),n[c].isActive=d;const u=o(c);for(const p in n)n[p].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:s,getState:()=>n,reset:()=>{n=dM()}}}function yne(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!LL(t,e):!1}function Zu(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function dM(){return{animate:Zu(!0),whileInView:Zu(),whileHover:Zu(),whileTap:Zu(),whileDrag:Zu(),whileFocus:Zu(),exit:Zu()}}function hM(e,t){e.min=t.min,e.max=t.max}function Qi(e,t){hM(e.x,t.x),hM(e.y,t.y)}function pM(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const zL=1e-4,bne=1-zL,vne=1+zL,BL=.01,wne=0-BL,Nne=0+BL;function xs(e){return e.max-e.min}function kne(e,t,n){return Math.abs(e-t)<=n}function mM(e,t,n,r=.5){e.origin=r,e.originPoint=Wr(t.min,t.max,e.origin),e.scale=xs(n)/xs(t),e.translate=Wr(n.min,n.max,e.origin)-e.originPoint,(e.scale>=bne&&e.scale<=vne||isNaN(e.scale))&&(e.scale=1),(e.translate>=wne&&e.translate<=Nne||isNaN(e.translate))&&(e.translate=0)}function ly(e,t,n,r){mM(e.x,t.x,n.x,r?r.originX:void 0),mM(e.y,t.y,n.y,r?r.originY:void 0)}function fM(e,t,n){e.min=n.min+t.min,e.max=e.min+xs(t)}function Sne(e,t,n){fM(e.x,t.x,n.x),fM(e.y,t.y,n.y)}function gM(e,t,n){e.min=t.min-n.min,e.max=e.min+xs(t)}function t0(e,t,n){gM(e.x,t.x,n.x),gM(e.y,t.y,n.y)}function xM(e,t,n,r,a){return e-=t,e=e0(e,1/n,r),a!==void 0&&(e=e0(e,1/a,r)),e}function Cne(e,t=0,n=1,r=.5,a,s=e,o=e){if(Zo.test(t)&&(t=parseFloat(t),t=Wr(o.min,o.max,t/100)-o.min),typeof t!="number")return;let l=Wr(s.min,s.max,r);e===s&&(l-=t),e.min=xM(e.min,t,n,l,a),e.max=xM(e.max,t,n,l,a)}function yM(e,t,[n,r,a],s,o){Cne(e,t[n],t[r],t[a],t.scale,s,o)}const _ne=["x","scaleX","originX"],jne=["y","scaleY","originY"];function bM(e,t,n,r){yM(e.x,t,_ne,n?n.x:void 0,r?r.x:void 0),yM(e.y,t,jne,n?n.y:void 0,r?r.y:void 0)}function vM(e){return e.translate===0&&e.scale===1}function WL(e){return vM(e.x)&&vM(e.y)}function wM(e,t){return e.min===t.min&&e.max===t.max}function Ine(e,t){return wM(e.x,t.x)&&wM(e.y,t.y)}function NM(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function UL(e,t){return NM(e.x,t.x)&&NM(e.y,t.y)}function kM(e){return xs(e.x)/xs(e.y)}function SM(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function Ci(e){return[e("x"),e("y")]}function Tne(e,t,n){let r="";const a=e.x.translate/t.x,s=e.y.translate/t.y,o=(n==null?void 0:n.z)||0;if((a||s||o)&&(r=`translate3d(${a}px, ${s}px, ${o}px) `),(t.x!==1||t.y!==1)&&(r+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:f}=n;d&&(r=`perspective(${d}px) ${r}`),u&&(r+=`rotate(${u}deg) `),h&&(r+=`rotateX(${h}deg) `),p&&(r+=`rotateY(${p}deg) `),m&&(r+=`skewX(${m}deg) `),f&&(r+=`skewY(${f}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(r+=`scale(${l}, ${c})`),r||"none"}const VL=["TopLeft","TopRight","BottomLeft","BottomRight"],Ene=VL.length,CM=e=>typeof e=="string"?parseFloat(e):e,_M=e=>typeof e=="number"||St.test(e);function Ane(e,t,n,r,a,s){a?(e.opacity=Wr(0,n.opacity??1,Rne(r)),e.opacityExit=Wr(t.opacity??1,0,Dne(r))):s&&(e.opacity=Wr(t.opacity??1,n.opacity??1,r));for(let o=0;o<Ene;o++){const l=`border${VL[o]}Radius`;let c=jM(t,l),d=jM(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||_M(c)===_M(d)?(e[l]=Math.max(Wr(CM(c),CM(d),r),0),(Zo.test(d)||Zo.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=Wr(t.rotate||0,n.rotate||0,r))}function jM(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Rne=HL(0,.5,L4),Dne=HL(.5,.95,Oi);function HL(e,t,n){return r=>r<e?0:r>t?1:n(jy(e,t,r))}function Mne(e,t,n){const r=Za(e)?e:ef(e);return r.start(yj("",r,t,n)),r.animation}function Ay(e,t,n,r={passive:!0}){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n)}const $ne=(e,t)=>e.depth-t.depth;class Fne{constructor(){this.children=[],this.isDirty=!1}add(t){tj(this.children,t),this.isDirty=!0}remove(t){nj(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort($ne),this.isDirty=!1,this.children.forEach(t)}}function Pne(e,t){const n=gs.now(),r=({timestamp:a})=>{const s=a-n;s>=t&&(tu(r),e(s-t))};return Ar.setup(r,!0),()=>tu(r)}function Nw(e){return Za(e)?e.get():e}class One{constructor(){this.members=[]}add(t){tj(this.members,t),t.scheduleRender()}remove(t){if(nj(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let r;for(let a=n;a>=0;a--){const s=this.members[a];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(t,n){const r=this.lead;if(t!==r&&(this.prevLead=r,this.lead=t,t.show(),r)){r.instance&&r.scheduleRender(),t.scheduleRender();const a=r.options.layoutDependency,s=t.options.layoutDependency;a!==void 0&&s!==void 0&&a===s||(t.resumeFrom=r,n&&(t.resumeFrom.preserveOpacity=!0),r.snapshot&&(t.snapshot=r.snapshot,t.snapshot.latestValues=r.animationValues||r.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0));const{crossfade:l}=t.options;l===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:r}=t;n.onExitComplete&&n.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const kw={hasAnimatedSinceResize:!0,hasEverUpdated:!1},Ok=["","X","Y","Z"],Lne=1e3;let zne=0;function Lk(e,t,n,r){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),r&&(r[e]=0))}function GL(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=hL(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:s}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Ar,!(a||s))}const{parent:r}=e;r&&!r.hasCheckedOptimisedAppear&&GL(r)}function qL({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:r,resetTransform:a}){return class{constructor(o={},l=t==null?void 0:t()){this.id=zne++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Une),this.nodes.forEach(qne),this.nodes.forEach(Kne),this.nodes.forEach(Vne)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Fne)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new sj),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=kL(o)&&!Wte(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;Ar.read(()=>{h=window.innerWidth}),e(o,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=Pne(p,250),kw.hasAnimatedSinceResize&&(kw.hasAnimatedSinceResize=!1,this.nodes.forEach(EM)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const f=this.options.transition||d.getDefaultTransition()||Jne,{onLayoutAnimationStart:g,onLayoutAnimationComplete:x}=d.getProps(),y=!this.targetLayout||!UL(this.targetLayout,m),b=!h&&p;if(this.options.layoutRoot||this.resumeFrom||b||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const v={...xj(f,"layout"),onPlay:g,onComplete:x};(d.shouldReduceMotion||this.options.layoutRoot)&&(v.delay=0,v.type=!1),this.startAnimation(v),this.setAnimationOrigin(u,b)}else h||EM(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),tu(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Yne),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&GL(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(IM);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(TM);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Gne),this.nodes.forEach(Bne),this.nodes.forEach(Wne)):this.nodes.forEach(TM),this.clearAllSnapshots();const l=gs.now();Ba.delta=sl(0,1e3/60,l-Ba.timestamp),Ba.timestamp=l,Ba.isProcessing=!0,Ek.update.process(Ba),Ek.preRender.process(Ba),Ek.render.process(Ba),Ba.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Nj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Hne),this.sharedNodes.forEach(Xne)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ar.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ar.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!xs(this.snapshot.measuredBox.x)&&!xs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ya(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=r(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!a)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!WL(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||nd(this.latestValues)||u)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),ere(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:o}=this.options;if(!o)return ya();const l=o.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(tre))){const{scroll:u}=this.root;u&&(vm(l.x,u.offset.x),vm(l.y,u.offset.y))}return l}removeElementScroll(o){var c;const l=ya();if(Qi(l,o),(c=this.scroll)!=null&&c.wasRoot)return l;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:h,options:p}=u;u!==this.root&&h&&p.layoutScroll&&(h.wasRoot&&Qi(l,o),vm(l.x,h.offset.x),vm(l.y,h.offset.y))}return l}applyTransform(o,l=!1){const c=ya();Qi(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&wm(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),nd(u.latestValues)&&wm(c,u.latestValues)}return nd(this.latestValues)&&wm(c,this.latestValues),c}removeTransform(o){const l=ya();Qi(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!nd(d.latestValues))continue;G2(d.latestValues)&&d.updateSnapshot();const u=ya(),h=d.measurePageBox();Qi(u,h),bM(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return nd(this.latestValues)&&bM(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ba.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var m;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Ba.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ya(),this.targetWithTransforms=ya()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Sne(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Qi(this.target,this.layout.layoutBox),EL(this.target,this.targetDelta)):Qi(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||G2(this.parent.latestValues)||TL(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,l,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ya(),this.relativeTargetOrigin=ya(),t0(this.relativeTargetOrigin,l,c),Qi(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var f;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===Ba.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Qi(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;Jte(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=ya());const{target:m}=o;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(pM(this.prevProjectionDelta.x,this.projectionDelta.x),pM(this.prevProjectionDelta.y,this.projectionDelta.y)),ly(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!SM(this.projectionDelta.x,this.prevProjectionDelta.x)||!SM(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=bm(),this.projectionDelta=bm(),this.projectionDeltaWithTransform=bm()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=bm();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=ya(),m=c?c.source:void 0,f=this.layout?this.layout.source:void 0,g=m!==f,x=this.getStack(),y=!x||x.members.length<=1,b=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(Qne));this.animationProgress=0;let v;this.mixTargetDelta=w=>{const k=w/1e3;AM(h.x,o.x,k),AM(h.y,o.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(t0(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Zne(this.relativeTarget,this.relativeTargetOrigin,p,k),v&&Ine(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=ya()),Qi(v,this.relativeTarget)),g&&(this.animationValues=u,Ane(u,d,this.latestValues,k,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var l,c,d;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(d=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||d.stop(),this.pendingAnimation&&(tu(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ar.update(()=>{kw.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ef(0)),this.currentAnimation=Mne(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),o.onUpdate&&o.onUpdate(u)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Lne),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&KL(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ya();const h=xs(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+h;const p=xs(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+p}Qi(l,c),wm(l,u),ly(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new One),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var l;const{layoutId:o}=this.options;return o?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:o}=this.options;return o?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Lk("z",o,d,this.animationValues);for(let u=0;u<Ok.length;u++)Lk(`rotate${Ok[u]}`,o,d,this.animationValues),Lk(`skew${Ok[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=Nw(l==null?void 0:l.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=Nw(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!nd(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=Tne(this.projectionDeltaWithTransform,this.treeScale,u);c&&(h=c(u,h)),o.transform=h;const{x:p,y:m}=this.projectionDelta;o.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const f in K2){if(u[f]===void 0)continue;const{correct:g,applyTo:x,isCSSVariable:y}=K2[f],b=h==="none"?u[f]:g(u[f],d);if(x){const v=x.length;for(let w=0;w<v;w++)o[x[w]]=b}else y?this.options.visualElement.renderState.vars[f]=b:o[f]=b}this.options.layoutId&&(o.pointerEvents=d===this?Nw(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(IM),this.root.sharedNodes.clear()}}}function Bne(e){e.updateLayout()}function Wne(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:a}=e.layout,{animationType:s}=e.options,o=t.source!==e.layout.source;s==="size"?Ci(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],m=xs(p);p.min=r[h].min,p.max=p.min+m}):KL(s,t.layoutBox,r)&&Ci(h=>{const p=o?t.measuredBox[h]:t.layoutBox[h],m=xs(r[h]);p.max=p.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+m)});const l=bm();ly(l,r,t.layoutBox);const c=bm();o?ly(c,e.applyTransform(a,!0),t.measuredBox):ly(c,r,t.layoutBox);const d=!WL(l);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:p,layout:m}=h;if(p&&m){const f=ya();t0(f,t.layoutBox,p.layoutBox);const g=ya();t0(g,r,m.layoutBox),UL(f,g)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=g,e.relativeTargetOrigin=f,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:r,snapshot:t,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:r}=e.options;r&&r()}e.options.transition=void 0}function Une(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Vne(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Hne(e){e.clearSnapshot()}function IM(e){e.clearMeasurements()}function TM(e){e.isLayoutDirty=!1}function Gne(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function EM(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function qne(e){e.resolveTargetDelta()}function Kne(e){e.calcProjection()}function Yne(e){e.resetSkewAndRotation()}function Xne(e){e.removeLeadSnapshot()}function AM(e,t,n){e.translate=Wr(t.translate,0,n),e.scale=Wr(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function RM(e,t,n,r){e.min=Wr(t.min,n.min,r),e.max=Wr(t.max,n.max,r)}function Zne(e,t,n,r){RM(e.x,t.x,n.x,r),RM(e.y,t.y,n.y,r)}function Qne(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Jne={duration:.45,ease:[.4,0,.1,1]},DM=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),MM=DM("applewebkit/")&&!DM("chrome/")?Math.round:Oi;function $M(e){e.min=MM(e.min),e.max=MM(e.max)}function ere(e){$M(e.x),$M(e.y)}function KL(e,t,n){return e==="position"||e==="preserve-aspect"&&!kne(kM(t),kM(n),.2)}function tre(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const nre=qL({attachResizeListener:(e,t)=>Ay(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),zk={current:void 0},YL=qL({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!zk.current){const e=new nre({});e.mount(window),e.setOptions({layoutScroll:!0}),zk.current=e}return zk.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),XL=N.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function rre(e=!0){const t=N.useContext(ej);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:a}=t,s=N.useId();N.useEffect(()=>{if(e)return a(s)},[e]);const o=N.useCallback(()=>e&&r&&r(s),[s,r,e]);return!n&&r?[!1,o]:[!0]}const ZL=N.createContext({strict:!1}),FM={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let PM=!1;function are(){if(PM)return;const e={};for(const t in FM)e[t]={isEnabled:n=>FM[t].some(r=>!!n[r])};_L(e),PM=!0}function QL(){return are(),Yte()}function sre(e){const t=QL();for(const n in e)t[n]={...t[n],...e[n]};_L(t)}const ire=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function n0(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||ire.has(e)}let JL=e=>!n0(e);function ore(e){typeof e=="function"&&(JL=t=>t.startsWith("on")?!n0(t):e(t))}try{ore(require("@emotion/is-prop-valid").default)}catch{}function lre(e,t,n){const r={};for(const a in e)a==="values"&&typeof e.values=="object"||(JL(a)||n===!0&&n0(a)||!t&&!n0(a)||e.draggable&&a.startsWith("onDrag"))&&(r[a]=e[a]);return r}const w1=N.createContext({});function cre(e,t){if(v1(e)){const{initial:n,animate:r}=e;return{initial:n===!1||Ey(n)?n:void 0,animate:Ey(r)?r:void 0}}return e.inherit!==!1?t:{}}function ure(e){const{initial:t,animate:n}=cre(e,N.useContext(w1));return N.useMemo(()=>({initial:t,animate:n}),[OM(t),OM(n)])}function OM(e){return Array.isArray(e)?e.join(" "):e}const Ij=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function e5(e,t,n){for(const r in t)!Za(t[r])&&!DL(r,n)&&(e[r]=t[r])}function dre({transformTemplate:e},t){return N.useMemo(()=>{const n=Ij();return _j(n,t,e),Object.assign({},n.vars,n.style)},[t])}function hre(e,t){const n=e.style||{},r={};return e5(r,n,e),Object.assign(r,dre(e,t)),r}function pre(e,t){const n={},r=hre(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=r,n}const t5=()=>({...Ij(),attrs:{}});function mre(e,t,n,r){const a=N.useMemo(()=>{const s=t5();return ML(s,t,FL(r),e.transformTemplate,e.style),{...s.attrs,style:{...s.style}}},[t]);if(e.style){const s={};e5(s,e.style,e),a.style={...s,...a.style}}return a}const fre=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Tj(e){return typeof e!="string"||e.includes("-")?!1:!!(fre.indexOf(e)>-1||/[A-Z]/u.test(e))}function gre(e,t,n,{latestValues:r},a,s=!1,o){const c=(o??Tj(e)?mre:pre)(t,r,a,e),d=lre(t,typeof e=="string",s),u=e!==N.Fragment?{...d,...c,ref:n}:{},{children:h}=t,p=N.useMemo(()=>Za(h)?h.get():h,[h]);return N.createElement(e,{...u,children:p})}function xre({scrapeMotionValuesFromProps:e,createRenderState:t},n,r,a){return{latestValues:yre(n,r,a,e),renderState:t()}}function yre(e,t,n,r){const a={},s=r(e,{});for(const p in s)a[p]=Nw(s[p]);let{initial:o,animate:l}=e;const c=v1(e),d=CL(e);t&&d&&!c&&e.inherit!==!1&&(o===void 0&&(o=t.initial),l===void 0&&(l=t.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const h=u?l:o;if(h&&typeof h!="boolean"&&!b1(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const f=bj(e,p[m]);if(f){const{transitionEnd:g,transition:x,...y}=f;for(const b in y){let v=y[b];if(Array.isArray(v)){const w=u?v.length-1:0;v=v[w]}v!==null&&(a[b]=v)}for(const b in g)a[b]=g[b]}}}return a}const n5=e=>(t,n)=>{const r=N.useContext(w1),a=N.useContext(ej),s=()=>xre(e,t,r,a);return n?s():AJ(s)},bre=n5({scrapeMotionValuesFromProps:jj,createRenderState:Ij}),vre=n5({scrapeMotionValuesFromProps:PL,createRenderState:t5}),wre=Symbol.for("motionComponentSymbol");function Nre(e,t,n){const r=N.useRef(n);N.useInsertionEffect(()=>{r.current=n});const a=N.useRef(null);return N.useCallback(s=>{var l;s&&((l=e.onMount)==null||l.call(e,s)),t&&(s?t.mount(s):t.unmount());const o=r.current;if(typeof o=="function")if(s){const c=o(s);typeof c=="function"&&(a.current=c)}else a.current?(a.current(),a.current=null):o(s);else o&&(o.current=s)},[t])}const r5=N.createContext({});function Lx(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function kre(e,t,n,r,a,s){var y,b;const{visualElement:o}=N.useContext(w1),l=N.useContext(ZL),c=N.useContext(ej),d=N.useContext(XL).reducedMotion,u=N.useRef(null),h=N.useRef(!1);r=r||l.renderer,!u.current&&r&&(u.current=r(e,{visualState:t,parent:o,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d,isSVG:s}),h.current&&u.current&&(u.current.manuallyAnimateOnMount=!0));const p=u.current,m=N.useContext(r5);p&&!p.projection&&a&&(p.type==="html"||p.type==="svg")&&Sre(u.current,n,a,m);const f=N.useRef(!1);N.useInsertionEffect(()=>{p&&f.current&&p.update(n,c)});const g=n[dL],x=N.useRef(!!g&&!((y=window.MotionHandoffIsComplete)!=null&&y.call(window,g))&&((b=window.MotionHasOptimisedAnimation)==null?void 0:b.call(window,g)));return RJ(()=>{h.current=!0,p&&(f.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),p.scheduleRenderMicrotask(),x.current&&p.animationState&&p.animationState.animateChanges())}),N.useEffect(()=>{p&&(!x.current&&p.animationState&&p.animationState.animateChanges(),x.current&&(queueMicrotask(()=>{var v;(v=window.MotionHandoffMarkAsComplete)==null||v.call(window,g)}),x.current=!1),p.enteringChildren=void 0)}),p}function Sre(e,t,n,r){const{layoutId:a,layout:s,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:a5(e.parent)),e.projection.setOptions({layoutId:a,layout:s,alwaysMeasureLayout:!!o||l&&Lx(l),visualElement:e,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:c,layoutRoot:d})}function a5(e){if(e)return e.options.allowProjection!==!1?e.projection:a5(e.parent)}function Bk(e,{forwardMotionProps:t=!1,type:n}={},r,a){r&&sre(r);const s=n?n==="svg":Tj(e),o=s?vre:bre;function l(d,u){let h;const p={...N.useContext(XL),...d,layoutId:Cre(d)},{isStatic:m}=p,f=ure(d),g=o(d,m);if(!m&&I4){_re();const x=jre(p);h=x.MeasureLayout,f.visualElement=kre(e,g,p,a,x.ProjectionNode,s)}return i.jsxs(w1.Provider,{value:f,children:[h&&f.visualElement?i.jsx(h,{visualElement:f.visualElement,...p}):null,gre(e,d,Nre(g,f.visualElement,u),g,m,t,s)]})}l.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const c=N.forwardRef(l);return c[wre]=e,c}function Cre({layoutId:e}){const t=N.useContext(j4).id;return t&&e!==void 0?t+"-"+e:e}function _re(e,t){N.useContext(ZL).strict}function jre(e){const t=QL(),{drag:n,layout:r}=t;if(!n&&!r)return{};const a={...n,...r};return{MeasureLayout:n!=null&&n.isEnabled(e)||r!=null&&r.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function Ire(e,t){if(typeof Proxy>"u")return Bk;const n=new Map,r=(s,o)=>Bk(s,o,e,t),a=(s,o)=>r(s,o);return new Proxy(a,{get:(s,o)=>o==="create"?r:(n.has(o)||n.set(o,Bk(o,void 0,e,t)),n.get(o))})}const Tre=(e,t)=>t.isSVG??Tj(e)?new hne(t):new ine(t,{allowProjection:e!==N.Fragment});class Ere extends wu{constructor(t){super(t),t.animationState||(t.animationState=xne(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();b1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let Are=0;class Rre extends wu{constructor(){super(...arguments),this.id=Are++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===r)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Dre={animation:{Feature:Ere},exit:{Feature:Rre}};function ub(e){return{point:{x:e.pageX,y:e.pageY}}}const Mre=e=>t=>kj(t)&&e(t,ub(t));function cy(e,t,n,r){return Ay(e,t,Mre(n),r)}const s5=({current:e})=>e?e.ownerDocument.defaultView:null,LM=(e,t)=>Math.abs(e-t);function $re(e,t){const n=LM(e.x,t.x),r=LM(e.y,t.y);return Math.sqrt(n**2+r**2)}const zM=new Set(["auto","scroll"]);class i5{constructor(t,n,{transformPagePoint:r,contextWindow:a=window,dragSnapToOrigin:s=!1,distanceThreshold:o=3,element:l}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=m=>{this.handleScroll(m.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=Uk(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,g=$re(m.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!g)return;const{point:x}=m,{timestamp:y}=Ba;this.history.push({...x,timestamp:y});const{onStart:b,onMove:v}=this.handlers;f||(b&&b(this.lastMoveEvent,m),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,m)},this.handlePointerMove=(m,f)=>{this.lastMoveEvent=m,this.lastMoveEventInfo=Wk(f,this.transformPagePoint),Ar.update(this.updatePoint,!0)},this.handlePointerUp=(m,f)=>{this.end();const{onEnd:g,onSessionEnd:x,resumeAnimation:y}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=Uk(m.type==="pointercancel"?this.lastMoveEventInfo:Wk(f,this.transformPagePoint),this.history);this.startEvent&&g&&g(m,b),x&&x(m,b)},!kj(t))return;this.dragSnapToOrigin=s,this.handlers=n,this.transformPagePoint=r,this.distanceThreshold=o,this.contextWindow=a||window;const c=ub(t),d=Wk(c,this.transformPagePoint),{point:u}=d,{timestamp:h}=Ba;this.history=[{...u,timestamp:h}];const{onSessionStart:p}=n;p&&p(t,Uk(d,this.history)),this.removeListeners=ob(cy(this.contextWindow,"pointermove",this.handlePointerMove),cy(this.contextWindow,"pointerup",this.handlePointerUp),cy(this.contextWindow,"pointercancel",this.handlePointerUp)),l&&this.startScrollTracking(l)}startScrollTracking(t){let n=t.parentElement;for(;n;){const r=getComputedStyle(n);(zM.has(r.overflowX)||zM.has(r.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const n=this.scrollPositions.get(t);if(!n)return;const r=t===window,a=r?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},s={x:a.x-n.x,y:a.y-n.y};s.x===0&&s.y===0||(r?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=s.x,this.lastMoveEventInfo.point.y+=s.y):this.history.length>0&&(this.history[0].x-=s.x,this.history[0].y-=s.y),this.scrollPositions.set(t,a),Ar.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),tu(this.updatePoint)}}function Wk(e,t){return t?{point:t(e.point)}:e}function BM(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Uk({point:e},t){return{point:e,delta:BM(e,o5(t)),offset:BM(e,Fre(t)),velocity:Pre(t,.1)}}function Fre(e){return e[0]}function o5(e){return e[e.length-1]}function Pre(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,r=null;const a=o5(e);for(;n>=0&&(r=e[n],!(a.timestamp-r.timestamp>$l(t)));)n--;if(!r)return{x:0,y:0};const s=Mi(a.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const o={x:(a.x-r.x)/s,y:(a.y-r.y)/s};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Ore(e,{min:t,max:n},r){return t!==void 0&&e<t?e=r?Wr(t,e,r.min):Math.max(e,t):n!==void 0&&e>n&&(e=r?Wr(n,e,r.max):Math.min(e,n)),e}function WM(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Lre(e,{top:t,left:n,bottom:r,right:a}){return{x:WM(e.x,n,a),y:WM(e.y,t,r)}}function UM(e,t){let n=t.min-e.min,r=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,r]=[r,n]),{min:n,max:r}}function zre(e,t){return{x:UM(e.x,t.x),y:UM(e.y,t.y)}}function Bre(e,t){let n=.5;const r=xs(e),a=xs(t);return a>r?n=jy(t.min,t.max-r,e.min):r>a&&(n=jy(e.min,e.max-a,t.min)),sl(0,1,n)}function Wre(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const Y2=.35;function Ure(e=Y2){return e===!1?e=0:e===!0&&(e=Y2),{x:VM(e,"left","right"),y:VM(e,"top","bottom")}}function VM(e,t,n){return{min:HM(e,t),max:HM(e,n)}}function HM(e,t){return typeof e=="number"?e:e[t]||0}const Vre=new WeakMap;class Hre{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ya(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:r}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const s=h=>{n?(this.stopAnimation(),this.snapToCursor(ub(h).point)):this.pauseAnimation()},o=(h,p)=>{this.stopAnimation();const{drag:m,dragPropagation:f,onDragStart:g}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Pte(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ci(y=>{let b=this.getAxisMotionValue(y).get()||0;if(Zo.test(b)){const{projection:v}=this.visualElement;if(v&&v.layout){const w=v.layout.layoutBox[y];w&&(b=xs(w)*(parseFloat(b)/100))}}this.originPoint[y]=b}),g&&Ar.postRender(()=>g(h,p)),W2(this.visualElement,"transform");const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:g,onDrag:x}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:y}=p;if(f&&this.currentDirection===null){this.currentDirection=Gre(y),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,y),this.updateAxis("y",p.point,y),this.visualElement.render(),x&&x(h,p)},c=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Ci(h=>{var p;return this.getAnimationState(h)==="paused"&&((p=this.getAxisMotionValue(h).animation)==null?void 0:p.play())}),{dragSnapToOrigin:u}=this.getProps();this.panSession=new i5(t,{onSessionStart:s,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:r,contextWindow:s5(this.visualElement),element:this.visualElement.current})}stop(t,n){const r=t||this.latestPointerEvent,a=n||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!a||!r)return;const{velocity:o}=a;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&Ar.postRender(()=>l(r,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,n,r){const{drag:a}=this.getProps();if(!r||!Lv(t,a,this.currentDirection))return;const s=this.getAxisMotionValue(t);let o=this.originPoint[t]+r[t];this.constraints&&this.constraints[t]&&(o=Ore(o,this.constraints[t],this.elastic[t])),s.set(o)}resolveConstraints(){var s;const{dragConstraints:t,dragElastic:n}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(s=this.visualElement.projection)==null?void 0:s.layout,a=this.constraints;t&&Lx(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&r?this.constraints=Lre(r.layoutBox,t):this.constraints=!1,this.elastic=Ure(n),a!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ci(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=Wre(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!Lx(t))return!1;const r=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const s=ene(r,a.root,this.visualElement.getTransformPagePoint());let o=zre(a.layout.layoutBox,s);if(n){const l=n(Zte(o));this.hasMutatedConstraints=!!l,l&&(o=IL(l))}return o}startAnimation(t){const{drag:n,dragMomentum:r,dragElastic:a,dragTransition:s,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Ci(u=>{if(!Lv(u,n,this.currentDirection))return;let h=c&&c[u]||{};o&&(h={min:0,max:0});const p=a?200:1e6,m=a?40:1e7,f={type:"inertia",velocity:r?t[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,f)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const r=this.getAxisMotionValue(t);return W2(this.visualElement,t),r.start(yj(t,r,0,n,this.visualElement,!1))}stopAnimation(){Ci(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Ci(t=>{var n;return(n=this.getAxisMotionValue(t).animation)==null?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)==null?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,r=this.visualElement.getProps(),a=r[n];return a||this.visualElement.getValue(t,(r.initial?r.initial[t]:void 0)||0)}snapToCursor(t){Ci(n=>{const{drag:r}=this.getProps();if(!Lv(n,r,this.currentDirection))return;const{projection:a}=this.visualElement,s=this.getAxisMotionValue(n);if(a&&a.layout){const{min:o,max:l}=a.layout.layoutBox[n],c=s.get()||0;s.set(t[n]-Wr(o,l,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:r}=this.visualElement;if(!Lx(n)||!r||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ci(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();a[o]=Bre({min:c,max:c},this.constraints[o])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ci(o=>{if(!Lv(o,t,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(Wr(c,d,a[o]))})}addListeners(){if(!this.visualElement.current)return;Vre.set(this.visualElement,this);const t=this.visualElement.current,n=cy(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps(),h=c.target,p=h!==t&&NL(h);d&&u&&!p&&this.start(c)}),r=()=>{const{dragConstraints:c}=this.getProps();Lx(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:a}=this.visualElement,s=a.addEventListener("measure",r);a&&!a.layout&&(a.root&&a.root.updateScroll(),a.updateLayout()),Ar.read(r);const o=Ay(window,"resize",()=>this.scalePositionWithinConstraints()),l=a.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Ci(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())});return()=>{o(),n(),s(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:r=!1,dragPropagation:a=!1,dragConstraints:s=!1,dragElastic:o=Y2,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:r,dragPropagation:a,dragConstraints:s,dragElastic:o,dragMomentum:l}}}function Lv(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Gre(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class qre extends wu{constructor(t){super(t),this.removeGroupControls=Oi,this.removeListeners=Oi,this.controls=new Hre(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Oi}update(){const{dragControls:t}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};t!==n&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const GM=e=>(t,n)=>{e&&Ar.postRender(()=>e(t,n))};class Kre extends wu{constructor(){super(...arguments),this.removePointerDownListener=Oi}onPointerDown(t){this.session=new i5(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:s5(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:r,onPanEnd:a}=this.node.getProps();return{onSessionStart:GM(t),onStart:GM(n),onMove:r,onEnd:(s,o)=>{delete this.session,a&&Ar.postRender(()=>a(s,o))}}}mount(){this.removePointerDownListener=cy(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Vk=!1;class Yre extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r,layoutId:a}=this.props,{projection:s}=t;s&&(n.group&&n.group.add(s),r&&r.register&&a&&r.register(s),Vk&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),kw.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:r,drag:a,isPresent:s}=this.props,{projection:o}=r;return o&&(o.isPresent=s,t.layoutDependency!==n&&o.setOptions({...o.options,layoutDependency:n}),Vk=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==s?o.willUpdate():this.safeToRemove(),t.isPresent!==s&&(s?o.promote():o.relegate()||Ar.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Nj.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:r}=this.props,{projection:a}=t;Vk=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),r&&r.deregister&&r.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function l5(e){const[t,n]=rre(),r=N.useContext(j4);return i.jsx(Yre,{...e,layoutGroup:r,switchLayoutGroup:N.useContext(r5),isPresent:t,safeToRemove:n})}const Xre={pan:{Feature:Kre},drag:{Feature:qre,ProjectionNode:YL,MeasureLayout:l5}};function qM(e,t,n){const{props:r}=e;e.animationState&&r.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,s=r[a];s&&Ar.postRender(()=>s(t,ub(t)))}class Zre extends wu{mount(){const{current:t}=this.node;t&&(this.unmount=Ote(t,(n,r)=>(qM(this.node,r,"Start"),a=>qM(this.node,a,"End"))))}unmount(){}}class Qre extends wu{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ob(Ay(this.node.current,"focus",()=>this.onFocus()),Ay(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function KM(e,t,n){const{props:r}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&r.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),s=r[a];s&&Ar.postRender(()=>s(t,ub(t)))}class Jre extends wu{mount(){const{current:t}=this.node;t&&(this.unmount=Bte(t,(n,r)=>(KM(this.node,r,"Start"),(a,{success:s})=>KM(this.node,a,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const X2=new WeakMap,Hk=new WeakMap,eae=e=>{const t=X2.get(e.target);t&&t(e)},tae=e=>{e.forEach(eae)};function nae({root:e,...t}){const n=e||document;Hk.has(n)||Hk.set(n,{});const r=Hk.get(n),a=JSON.stringify(t);return r[a]||(r[a]=new IntersectionObserver(tae,{root:e,...t})),r[a]}function rae(e,t,n){const r=nae(t);return X2.set(e,n),r.observe(e),()=>{X2.delete(e),r.unobserve(e)}}const aae={some:0,all:1};class sae extends wu{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:r,amount:a="some",once:s}=t,o={root:n?n.current:void 0,rootMargin:r,threshold:typeof a=="number"?a:aae[a]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,s&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(c)};return rae(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(iae(t,n))&&this.startObserver()}unmount(){}}function iae({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const oae={inView:{Feature:sae},tap:{Feature:Jre},focus:{Feature:Qre},hover:{Feature:Zre}},lae={layout:{ProjectionNode:YL,MeasureLayout:l5}},cae={...Dre,...oae,...Xre,...lae},Gk=Ire(cae,Tre),qk=[{icon:rl,title:"NFC & QR Sharing",color:"from-blue-500 to-cyan-500"},{icon:V_,title:"Auto Lead Capture",color:"from-purple-500 to-pink-500"},{icon:Zm,title:"One-Click Follow-up",color:"from-green-500 to-emerald-500"},{icon:Bl,title:"Event Tagging",color:"from-orange-500 to-amber-500"},{icon:eu,title:"Built-in CRM",color:"from-indigo-500 to-violet-500"},{icon:U_,title:"Analytics",color:"from-rose-500 to-red-500"},{icon:IO,title:"AI Templates",color:"from-yellow-500 to-orange-500"},{icon:Tf,title:"Secure",color:"from-teal-500 to-cyan-500"}];function uae(){const e=N.useRef(null),t=N.useRef(!1),n=N.useRef(0),r=N.useRef(0),a=N.useRef(0),s=N.useRef(0),o=N.useRef(),l=1,c=.95,d=()=>{if(!e.current||t.current){o.current=requestAnimationFrame(d);return}e.current.scrollLeft+=l,e.current.scrollLeft>=e.current.scrollWidth/2&&(e.current.scrollLeft=0),o.current=requestAnimationFrame(d)},u=()=>{e.current&&(a.current*=c,e.current.scrollLeft+=a.current,Math.abs(a.current)>.1&&requestAnimationFrame(u))};N.useEffect(()=>(o.current=requestAnimationFrame(d),()=>o.current&&cancelAnimationFrame(o.current)),[]);const h=f=>{e.current&&(t.current=!0,e.current.setPointerCapture(f.pointerId),n.current=f.clientX,s.current=f.clientX,r.current=e.current.scrollLeft,a.current=0)},p=f=>{if(!t.current||!e.current)return;const g=f.clientX,x=n.current-g;e.current.scrollLeft=r.current+x,a.current=s.current-g,s.current=g},m=f=>{e.current&&(t.current=!1,e.current.releasePointerCapture(f.pointerId),u())};return i.jsxs("div",{className:"relative overflow-hidden py-2 select-none",children:[i.jsx("div",{className:"absolute inset-y-0 left-0 w-8 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{className:"absolute inset-y-0 right-0 w-8 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{ref:e,className:"flex gap-3 px-4 overflow-hidden cursor-grab active:cursor-grabbing",onPointerDown:h,onPointerMove:p,onPointerUp:m,onPointerLeave:m,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"pan-y"},children:[...qk,...qk,...qk].map((f,g)=>i.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 px-3 py-2 rounded-full bg-card border border-border/50 shadow-sm",children:[i.jsx("div",{className:`w-7 h-7 rounded-lg bg-gradient-to-br ${f.color} flex items-center justify-center`,children:i.jsx(f.icon,{className:"h-3.5 w-3.5 text-white"})}),i.jsx("span",{className:"text-xs font-medium text-foreground whitespace-nowrap",children:f.title})]},g))})]})}function Z2(e,[t,n]){return Math.min(n,Math.max(t,e))}function dae(e,t){return N.useReducer((n,r)=>t[n][r]??n,e)}var Ej="ScrollArea",[c5]=dl(Ej),[hae,Ui]=c5(Ej),u5=N.forwardRef((e,t)=>{const{__scopeScrollArea:n,type:r="hover",dir:a,scrollHideDelay:s=600,...o}=e,[l,c]=N.useState(null),[d,u]=N.useState(null),[h,p]=N.useState(null),[m,f]=N.useState(null),[g,x]=N.useState(null),[y,b]=N.useState(0),[v,w]=N.useState(0),[k,C]=N.useState(!1),[S,_]=N.useState(!1),I=gr(t,A=>c(A)),T=g1(a);return i.jsx(hae,{scope:n,type:r,dir:T,scrollHideDelay:s,scrollArea:l,viewport:d,onViewportChange:u,content:h,onContentChange:p,scrollbarX:m,onScrollbarXChange:f,scrollbarXEnabled:k,onScrollbarXEnabledChange:C,scrollbarY:g,onScrollbarYChange:x,scrollbarYEnabled:S,onScrollbarYEnabledChange:_,onCornerWidthChange:b,onCornerHeightChange:w,children:i.jsx(Gn.div,{dir:T,...o,ref:I,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})});u5.displayName=Ej;var d5="ScrollAreaViewport",h5=N.forwardRef((e,t)=>{const{__scopeScrollArea:n,children:r,nonce:a,...s}=e,o=Ui(d5,n),l=N.useRef(null),c=gr(t,l,o.onViewportChange);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),i.jsx(Gn.div,{"data-radix-scroll-area-viewport":"",...s,ref:c,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...e.style},children:i.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});h5.displayName=d5;var pl="ScrollAreaScrollbar",Aj=N.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ui(pl,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:o}=a,l=e.orientation==="horizontal";return N.useEffect(()=>(l?s(!0):o(!0),()=>{l?s(!1):o(!1)}),[l,s,o]),a.type==="hover"?i.jsx(pae,{...r,ref:t,forceMount:n}):a.type==="scroll"?i.jsx(mae,{...r,ref:t,forceMount:n}):a.type==="auto"?i.jsx(p5,{...r,ref:t,forceMount:n}):a.type==="always"?i.jsx(Rj,{...r,ref:t}):null});Aj.displayName=pl;var pae=N.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ui(pl,e.__scopeScrollArea),[s,o]=N.useState(!1);return N.useEffect(()=>{const l=a.scrollArea;let c=0;if(l){const d=()=>{window.clearTimeout(c),o(!0)},u=()=>{c=window.setTimeout(()=>o(!1),a.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",u),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",u)}}},[a.scrollArea,a.scrollHideDelay]),i.jsx(Yl,{present:n||s,children:i.jsx(p5,{"data-state":s?"visible":"hidden",...r,ref:t})})}),mae=N.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=Ui(pl,e.__scopeScrollArea),s=e.orientation==="horizontal",o=k1(()=>c("SCROLL_END"),100),[l,c]=dae("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return N.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>c("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,a.scrollHideDelay,c]),N.useEffect(()=>{const d=a.viewport,u=s?"scrollLeft":"scrollTop";if(d){let h=d[u];const p=()=>{const m=d[u];h!==m&&(c("SCROLL"),o()),h=m};return d.addEventListener("scroll",p),()=>d.removeEventListener("scroll",p)}},[a.viewport,s,c,o]),i.jsx(Yl,{present:n||l!=="hidden",children:i.jsx(Rj,{"data-state":l==="hidden"?"hidden":"visible",...r,ref:t,onPointerEnter:Mn(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:Mn(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),p5=N.forwardRef((e,t)=>{const n=Ui(pl,e.__scopeScrollArea),{forceMount:r,...a}=e,[s,o]=N.useState(!1),l=e.orientation==="horizontal",c=k1(()=>{if(n.viewport){const d=n.viewport.offsetWidth<n.viewport.scrollWidth,u=n.viewport.offsetHeight<n.viewport.scrollHeight;o(l?d:u)}},10);return tf(n.viewport,c),tf(n.content,c),i.jsx(Yl,{present:r||s,children:i.jsx(Rj,{"data-state":s?"visible":"hidden",...a,ref:t})})}),Rj=N.forwardRef((e,t)=>{const{orientation:n="vertical",...r}=e,a=Ui(pl,e.__scopeScrollArea),s=N.useRef(null),o=N.useRef(0),[l,c]=N.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=y5(l.viewport,l.content),u={...r,sizes:l,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:p=>s.current=p,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:p=>o.current=p};function h(p,m){return vae(p,o.current,l,m)}return n==="horizontal"?i.jsx(fae,{...u,ref:t,onThumbPositionChange:()=>{if(a.viewport&&s.current){const p=a.viewport.scrollLeft,m=YM(p,l,a.dir);s.current.style.transform=`translate3d(${m}px, 0, 0)`}},onWheelScroll:p=>{a.viewport&&(a.viewport.scrollLeft=p)},onDragScroll:p=>{a.viewport&&(a.viewport.scrollLeft=h(p,a.dir))}}):n==="vertical"?i.jsx(gae,{...u,ref:t,onThumbPositionChange:()=>{if(a.viewport&&s.current){const p=a.viewport.scrollTop,m=YM(p,l);s.current.style.transform=`translate3d(0, ${m}px, 0)`}},onWheelScroll:p=>{a.viewport&&(a.viewport.scrollTop=p)},onDragScroll:p=>{a.viewport&&(a.viewport.scrollTop=h(p))}}):null}),fae=N.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...a}=e,s=Ui(pl,e.__scopeScrollArea),[o,l]=N.useState(),c=N.useRef(null),d=gr(t,c,s.onScrollbarXChange);return N.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(f5,{"data-orientation":"horizontal",...a,ref:d,sizes:n,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":N1(n)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.x),onDragScroll:u=>e.onDragScroll(u.x),onWheelScroll:(u,h)=>{if(s.viewport){const p=s.viewport.scrollLeft+u.deltaX;e.onWheelScroll(p),v5(p,h)&&u.preventDefault()}},onResize:()=>{c.current&&s.viewport&&o&&r({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:a0(o.paddingLeft),paddingEnd:a0(o.paddingRight)}})}})}),gae=N.forwardRef((e,t)=>{const{sizes:n,onSizesChange:r,...a}=e,s=Ui(pl,e.__scopeScrollArea),[o,l]=N.useState(),c=N.useRef(null),d=gr(t,c,s.onScrollbarYChange);return N.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),i.jsx(f5,{"data-orientation":"vertical",...a,ref:d,sizes:n,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":N1(n)+"px",...e.style},onThumbPointerDown:u=>e.onThumbPointerDown(u.y),onDragScroll:u=>e.onDragScroll(u.y),onWheelScroll:(u,h)=>{if(s.viewport){const p=s.viewport.scrollTop+u.deltaY;e.onWheelScroll(p),v5(p,h)&&u.preventDefault()}},onResize:()=>{c.current&&s.viewport&&o&&r({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:a0(o.paddingTop),paddingEnd:a0(o.paddingBottom)}})}})}),[xae,m5]=c5(pl),f5=N.forwardRef((e,t)=>{const{__scopeScrollArea:n,sizes:r,hasThumb:a,onThumbChange:s,onThumbPointerUp:o,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:u,onResize:h,...p}=e,m=Ui(pl,n),[f,g]=N.useState(null),x=gr(t,I=>g(I)),y=N.useRef(null),b=N.useRef(""),v=m.viewport,w=r.content-r.viewport,k=Sc(u),C=Sc(c),S=k1(h,10);function _(I){if(y.current){const T=I.clientX-y.current.left,A=I.clientY-y.current.top;d({x:T,y:A})}}return N.useEffect(()=>{const I=T=>{const A=T.target;(f==null?void 0:f.contains(A))&&k(T,w)};return document.addEventListener("wheel",I,{passive:!1}),()=>document.removeEventListener("wheel",I,{passive:!1})},[v,f,w,k]),N.useEffect(C,[r,C]),tf(f,S),tf(m.content,S),i.jsx(xae,{scope:n,scrollbar:f,hasThumb:a,onThumbChange:Sc(s),onThumbPointerUp:Sc(o),onThumbPositionChange:C,onThumbPointerDown:Sc(l),children:i.jsx(Gn.div,{...p,ref:x,style:{position:"absolute",...p.style},onPointerDown:Mn(e.onPointerDown,I=>{I.button===0&&(I.target.setPointerCapture(I.pointerId),y.current=f.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",m.viewport&&(m.viewport.style.scrollBehavior="auto"),_(I))}),onPointerMove:Mn(e.onPointerMove,_),onPointerUp:Mn(e.onPointerUp,I=>{const T=I.target;T.hasPointerCapture(I.pointerId)&&T.releasePointerCapture(I.pointerId),document.body.style.webkitUserSelect=b.current,m.viewport&&(m.viewport.style.scrollBehavior=""),y.current=null})})})}),r0="ScrollAreaThumb",g5=N.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=m5(r0,e.__scopeScrollArea);return i.jsx(Yl,{present:n||a.hasThumb,children:i.jsx(yae,{ref:t,...r})})}),yae=N.forwardRef((e,t)=>{const{__scopeScrollArea:n,style:r,...a}=e,s=Ui(r0,n),o=m5(r0,n),{onThumbPositionChange:l}=o,c=gr(t,h=>o.onThumbChange(h)),d=N.useRef(void 0),u=k1(()=>{d.current&&(d.current(),d.current=void 0)},100);return N.useEffect(()=>{const h=s.viewport;if(h){const p=()=>{if(u(),!d.current){const m=wae(h,l);d.current=m,l()}};return l(),h.addEventListener("scroll",p),()=>h.removeEventListener("scroll",p)}},[s.viewport,u,l]),i.jsx(Gn.div,{"data-state":o.hasThumb?"visible":"hidden",...a,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:Mn(e.onPointerDownCapture,h=>{const m=h.target.getBoundingClientRect(),f=h.clientX-m.left,g=h.clientY-m.top;o.onThumbPointerDown({x:f,y:g})}),onPointerUp:Mn(e.onPointerUp,o.onThumbPointerUp)})});g5.displayName=r0;var Dj="ScrollAreaCorner",x5=N.forwardRef((e,t)=>{const n=Ui(Dj,e.__scopeScrollArea),r=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&r?i.jsx(bae,{...e,ref:t}):null});x5.displayName=Dj;var bae=N.forwardRef((e,t)=>{const{__scopeScrollArea:n,...r}=e,a=Ui(Dj,n),[s,o]=N.useState(0),[l,c]=N.useState(0),d=!!(s&&l);return tf(a.scrollbarX,()=>{var h;const u=((h=a.scrollbarX)==null?void 0:h.offsetHeight)||0;a.onCornerHeightChange(u),c(u)}),tf(a.scrollbarY,()=>{var h;const u=((h=a.scrollbarY)==null?void 0:h.offsetWidth)||0;a.onCornerWidthChange(u),o(u)}),d?i.jsx(Gn.div,{...r,ref:t,style:{width:s,height:l,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function a0(e){return e?parseInt(e,10):0}function y5(e,t){const n=e/t;return isNaN(n)?0:n}function N1(e){const t=y5(e.viewport,e.content),n=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,r=(e.scrollbar.size-n)*t;return Math.max(r,18)}function vae(e,t,n,r="ltr"){const a=N1(n),s=a/2,o=t||s,l=a-o,c=n.scrollbar.paddingStart+o,d=n.scrollbar.size-n.scrollbar.paddingEnd-l,u=n.content-n.viewport,h=r==="ltr"?[0,u]:[u*-1,0];return b5([c,d],h)(e)}function YM(e,t,n="ltr"){const r=N1(t),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-a,o=t.content-t.viewport,l=s-r,c=n==="ltr"?[0,o]:[o*-1,0],d=Z2(e,c);return b5([0,o],[0,l])(d)}function b5(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function v5(e,t){return e>0&&e<t}var wae=(e,t=()=>{})=>{let n={left:e.scrollLeft,top:e.scrollTop},r=0;return function a(){const s={left:e.scrollLeft,top:e.scrollTop},o=n.left!==s.left,l=n.top!==s.top;(o||l)&&t(),n=s,r=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(r)};function k1(e,t){const n=Sc(e),r=N.useRef(0);return N.useEffect(()=>()=>window.clearTimeout(r.current),[]),N.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(n,t)},[n,t])}function tf(e,t){const n=Sc(t);nl(()=>{let r=0;if(e){const a=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return a.observe(e),()=>{window.cancelAnimationFrame(r),a.unobserve(e)}}},[e,n])}var w5=u5,Nae=h5,kae=x5;const Mj=N.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(w5,{ref:r,className:Ie("relative overflow-hidden",e),...n,children:[i.jsx(Nae,{className:"h-full w-full rounded-[inherit]",children:t}),i.jsx(N5,{}),i.jsx(kae,{})]}));Mj.displayName=w5.displayName;const N5=N.forwardRef(({className:e,orientation:t="vertical",...n},r)=>i.jsx(Aj,{ref:r,orientation:t,className:Ie("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...n,children:i.jsx(g5,{className:"relative flex-1 rounded-full bg-border"})}));N5.displayName=Aj.displayName;var Xn;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function n(a){throw new Error}e.assertNever=n,e.arrayToEnum=a=>{const s={};for(const o of a)s[o]=o;return s},e.getValidEnumValues=a=>{const s=e.objectKeys(a).filter(l=>typeof a[a[l]]!="number"),o={};for(const l of s)o[l]=a[l];return e.objectValues(o)},e.objectValues=a=>e.objectKeys(a).map(function(s){return a[s]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const s=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&s.push(o);return s},e.find=(a,s)=>{for(const o of a)if(s(o))return o},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,s=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(s)}e.joinValues=r,e.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(Xn||(Xn={}));var XM;(function(e){e.mergeShapes=(t,n)=>({...t,...n})})(XM||(XM={}));const Tt=Xn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),vc=e=>{switch(typeof e){case"undefined":return Tt.undefined;case"string":return Tt.string;case"number":return Number.isNaN(e)?Tt.nan:Tt.number;case"boolean":return Tt.boolean;case"function":return Tt.function;case"bigint":return Tt.bigint;case"symbol":return Tt.symbol;case"object":return Array.isArray(e)?Tt.array:e===null?Tt.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Tt.promise:typeof Map<"u"&&e instanceof Map?Tt.map:typeof Set<"u"&&e instanceof Set?Tt.set:typeof Date<"u"&&e instanceof Date?Tt.date:Tt.object;default:return Tt.unknown}},Ze=Xn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ul extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=t}format(t){const n=t||function(s){return s.message},r={_errors:[]},a=s=>{for(const o of s.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)r._errors.push(n(o));else{let l=r,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(n(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return a(this),r}static assert(t){if(!(t instanceof Ul))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Xn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=n=>n.message){const n={},r=[];for(const a of this.issues)if(a.path.length>0){const s=a.path[0];n[s]=n[s]||[],n[s].push(t(a))}else r.push(t(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Ul.create=e=>new Ul(e);const Q2=(e,t)=>{let n;switch(e.code){case Ze.invalid_type:e.received===Tt.undefined?n="Required":n=`Expected ${e.expected}, received ${e.received}`;break;case Ze.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Xn.jsonStringifyReplacer)}`;break;case Ze.unrecognized_keys:n=`Unrecognized key(s) in object: ${Xn.joinValues(e.keys,", ")}`;break;case Ze.invalid_union:n="Invalid input";break;case Ze.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Xn.joinValues(e.options)}`;break;case Ze.invalid_enum_value:n=`Invalid enum value. Expected ${Xn.joinValues(e.options)}, received '${e.received}'`;break;case Ze.invalid_arguments:n="Invalid function arguments";break;case Ze.invalid_return_type:n="Invalid function return type";break;case Ze.invalid_date:n="Invalid date";break;case Ze.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Xn.assertNever(e.validation):e.validation!=="regex"?n=`Invalid ${e.validation}`:n="Invalid";break;case Ze.too_small:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?n=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:n="Invalid input";break;case Ze.too_big:e.type==="array"?n=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?n=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?n=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?n=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?n=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:n="Invalid input";break;case Ze.custom:n="Invalid input";break;case Ze.invalid_intersection_types:n="Intersection results could not be merged";break;case Ze.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Ze.not_finite:n="Number must be finite";break;default:n=t.defaultError,Xn.assertNever(e)}return{message:n}};let Sae=Q2;function Cae(){return Sae}const _ae=e=>{const{data:t,path:n,errorMaps:r,issueData:a}=e,s=[...n,...a.path||[]],o={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let l="";const c=r.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:t,defaultError:l}).message;return{...a,path:s,message:l}};function mt(e,t){const n=Cae(),r=_ae({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Q2?void 0:Q2].filter(a=>!!a)});e.common.issues.push(r)}class hi{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,n){const r=[];for(const a of n){if(a.status==="aborted")return sn;a.status==="dirty"&&t.dirty(),r.push(a.value)}return{status:t.value,value:r}}static async mergeObjectAsync(t,n){const r=[];for(const a of n){const s=await a.key,o=await a.value;r.push({key:s,value:o})}return hi.mergeObjectSync(t,r)}static mergeObjectSync(t,n){const r={};for(const a of n){const{key:s,value:o}=a;if(s.status==="aborted"||o.status==="aborted")return sn;s.status==="dirty"&&t.dirty(),o.status==="dirty"&&t.dirty(),s.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(r[s.value]=o.value)}return{status:t.value,value:r}}}const sn=Object.freeze({status:"aborted"}),zx=e=>({status:"dirty",value:e}),Vi=e=>({status:"valid",value:e}),ZM=e=>e.status==="aborted",QM=e=>e.status==="dirty",nf=e=>e.status==="valid",s0=e=>typeof Promise<"u"&&e instanceof Promise;var Dt;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Dt||(Dt={}));class ru{constructor(t,n,r,a){this._cachedPath=[],this.parent=t,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const JM=(e,t)=>{if(nf(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Ul(e.common.issues);return this._error=n,this._error}}};function $n(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:a}=e;if(t&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:a}:{errorMap:(o,l)=>{const{message:c}=e;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??r??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??n??l.defaultError}},description:a}}class Yn{get description(){return this._def.description}_getType(t){return vc(t.data)}_getOrReturnCtx(t,n){return n||{common:t.parent.common,data:t.data,parsedType:vc(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new hi,ctx:{common:t.parent.common,data:t.data,parsedType:vc(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const n=this._parse(t);if(s0(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(t){const n=this._parse(t);return Promise.resolve(n)}parse(t,n){const r=this.safeParse(t,n);if(r.success)return r.data;throw r.error}safeParse(t,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vc(t)},a=this._parseSync({data:t,path:r.path,parent:r});return JM(r,a)}"~validate"(t){var r,a;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vc(t)};if(!this["~standard"].async)try{const s=this._parseSync({data:t,path:[],parent:n});return nf(s)?{value:s.value}:{issues:n.common.issues}}catch(s){(a=(r=s==null?void 0:s.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:n}).then(s=>nf(s)?{value:s.value}:{issues:n.common.issues})}async parseAsync(t,n){const r=await this.safeParseAsync(t,n);if(r.success)return r.data;throw r.error}async safeParseAsync(t,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:vc(t)},a=this._parse({data:t,path:r.path,parent:r}),s=await(s0(a)?a:Promise.resolve(a));return JM(r,s)}refine(t,n){const r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,s)=>{const o=t(a),l=()=>s.addIssue({code:Ze.custom,...r(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(t,n){return this._refinement((r,a)=>t(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(t){return new af({schema:this,typeName:ln.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return Vc.create(this,this._def)}nullable(){return sf.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Qo.create(this)}promise(){return c0.create(this,this._def)}or(t){return o0.create([this,t],this._def)}and(t){return l0.create(this,t,this._def)}transform(t){return new af({...$n(this._def),schema:this,typeName:ln.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const n=typeof t=="function"?t:()=>t;return new tC({...$n(this._def),innerType:this,defaultValue:n,typeName:ln.ZodDefault})}brand(){return new Yae({typeName:ln.ZodBranded,type:this,...$n(this._def)})}catch(t){const n=typeof t=="function"?t:()=>t;return new nC({...$n(this._def),innerType:this,catchValue:n,typeName:ln.ZodCatch})}describe(t){const n=this.constructor;return new n({...this._def,description:t})}pipe(t){return $j.create(this,t)}readonly(){return rC.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const jae=/^c[^\s-]{8,}$/i,Iae=/^[0-9a-z]+$/,Tae=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Eae=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Aae=/^[a-z0-9_-]{21}$/i,Rae=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Dae=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Mae=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,$ae="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Kk;const Fae=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Pae=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Oae=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Lae=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,zae=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Bae=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,k5="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Wae=new RegExp(`^${k5}$`);function S5(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const n=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${n}`}function Uae(e){return new RegExp(`^${S5(e)}$`)}function Vae(e){let t=`${k5}T${S5(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function Hae(e,t){return!!((t==="v4"||!t)&&Fae.test(e)||(t==="v6"||!t)&&Oae.test(e))}function Gae(e,t){if(!Rae.test(e))return!1;try{const[n]=e.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||t&&a.alg!==t)}catch{return!1}}function qae(e,t){return!!((t==="v4"||!t)&&Pae.test(e)||(t==="v6"||!t)&&Lae.test(e))}class Oc extends Yn{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Tt.string){const s=this._getOrReturnCtx(t);return mt(s,{code:Ze.invalid_type,expected:Tt.string,received:s.parsedType}),sn}const r=new hi;let a;for(const s of this._def.checks)if(s.kind==="min")t.data.length<s.value&&(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")t.data.length>s.value&&(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const o=t.data.length>s.value,l=t.data.length<s.value;(o||l)&&(a=this._getOrReturnCtx(t,a),o?mt(a,{code:Ze.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):l&&mt(a,{code:Ze.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")Mae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"email",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")Kk||(Kk=new RegExp($ae,"u")),Kk.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"emoji",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")Eae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"uuid",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")Aae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"nanoid",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")jae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"cuid",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")Iae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"cuid2",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")Tae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"ulid",code:Ze.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(t.data)}catch{a=this._getOrReturnCtx(t,a),mt(a,{validation:"url",code:Ze.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"regex",code:Ze.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?t.data=t.data.trim():s.kind==="includes"?t.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?t.data=t.data.toLowerCase():s.kind==="toUpperCase"?t.data=t.data.toUpperCase():s.kind==="startsWith"?t.data.startsWith(s.value)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?t.data.endsWith(s.value)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?Vae(s).test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?Wae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?Uae(s).test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?Dae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"duration",code:Ze.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?Hae(t.data,s.version)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"ip",code:Ze.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?Gae(t.data,s.alg)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"jwt",code:Ze.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?qae(t.data,s.version)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"cidr",code:Ze.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?zae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"base64",code:Ze.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?Bae.test(t.data)||(a=this._getOrReturnCtx(t,a),mt(a,{validation:"base64url",code:Ze.invalid_string,message:s.message}),r.dirty()):Xn.assertNever(s);return{status:r.value,value:t.data}}_regex(t,n,r){return this.refinement(a=>t.test(a),{validation:n,code:Ze.invalid_string,...Dt.errToObj(r)})}_addCheck(t){return new Oc({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Dt.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Dt.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Dt.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Dt.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Dt.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Dt.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Dt.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Dt.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Dt.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Dt.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Dt.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Dt.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Dt.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Dt.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Dt.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Dt.errToObj(t)})}regex(t,n){return this._addCheck({kind:"regex",regex:t,...Dt.errToObj(n)})}includes(t,n){return this._addCheck({kind:"includes",value:t,position:n==null?void 0:n.position,...Dt.errToObj(n==null?void 0:n.message)})}startsWith(t,n){return this._addCheck({kind:"startsWith",value:t,...Dt.errToObj(n)})}endsWith(t,n){return this._addCheck({kind:"endsWith",value:t,...Dt.errToObj(n)})}min(t,n){return this._addCheck({kind:"min",value:t,...Dt.errToObj(n)})}max(t,n){return this._addCheck({kind:"max",value:t,...Dt.errToObj(n)})}length(t,n){return this._addCheck({kind:"length",value:t,...Dt.errToObj(n)})}nonempty(t){return this.min(1,Dt.errToObj(t))}trim(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Oc({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxLength(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Oc.create=e=>new Oc({checks:[],typeName:ln.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...$n(e)});function Kae(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,a=n>r?n:r,s=Number.parseInt(e.toFixed(a).replace(".","")),o=Number.parseInt(t.toFixed(a).replace(".",""));return s%o/10**a}class Ry extends Yn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Tt.number){const s=this._getOrReturnCtx(t);return mt(s,{code:Ze.invalid_type,expected:Tt.number,received:s.parsedType}),sn}let r;const a=new hi;for(const s of this._def.checks)s.kind==="int"?Xn.isInteger(t.data)||(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?Kae(t.data,s.value)!==0&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(t.data)||(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.not_finite,message:s.message}),a.dirty()):Xn.assertNever(s);return{status:a.value,value:t.data}}gte(t,n){return this.setLimit("min",t,!0,Dt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Dt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Dt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Dt.toString(n))}setLimit(t,n,r,a){return new Ry({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Dt.toString(a)}]})}_addCheck(t){return new Ry({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Dt.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Dt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Dt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Dt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Dt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Dt.toString(n)})}finite(t){return this._addCheck({kind:"finite",message:Dt.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Dt.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Dt.toString(t)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Xn.isInteger(t.value))}get isFinite(){let t=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(t===null||r.value<t)&&(t=r.value)}return Number.isFinite(n)&&Number.isFinite(t)}}Ry.create=e=>new Ry({checks:[],typeName:ln.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...$n(e)});class Dy extends Yn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Tt.bigint)return this._getInvalidInput(t);let r;const a=new hi;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?t.data<s.value:t.data<=s.value)&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?t.data>s.value:t.data>=s.value)&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?t.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(t,r),mt(r,{code:Ze.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):Xn.assertNever(s);return{status:a.value,value:t.data}}_getInvalidInput(t){const n=this._getOrReturnCtx(t);return mt(n,{code:Ze.invalid_type,expected:Tt.bigint,received:n.parsedType}),sn}gte(t,n){return this.setLimit("min",t,!0,Dt.toString(n))}gt(t,n){return this.setLimit("min",t,!1,Dt.toString(n))}lte(t,n){return this.setLimit("max",t,!0,Dt.toString(n))}lt(t,n){return this.setLimit("max",t,!1,Dt.toString(n))}setLimit(t,n,r,a){return new Dy({...this._def,checks:[...this._def.checks,{kind:t,value:n,inclusive:r,message:Dt.toString(a)}]})}_addCheck(t){return new Dy({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Dt.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Dt.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Dt.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Dt.toString(t)})}multipleOf(t,n){return this._addCheck({kind:"multipleOf",value:t,message:Dt.toString(n)})}get minValue(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t}get maxValue(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t}}Dy.create=e=>new Dy({checks:[],typeName:ln.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...$n(e)});class e$ extends Yn{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Tt.boolean){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.boolean,received:r.parsedType}),sn}return Vi(t.data)}}e$.create=e=>new e$({typeName:ln.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...$n(e)});class i0 extends Yn{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Tt.date){const s=this._getOrReturnCtx(t);return mt(s,{code:Ze.invalid_type,expected:Tt.date,received:s.parsedType}),sn}if(Number.isNaN(t.data.getTime())){const s=this._getOrReturnCtx(t);return mt(s,{code:Ze.invalid_date}),sn}const r=new hi;let a;for(const s of this._def.checks)s.kind==="min"?t.data.getTime()<s.value&&(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?t.data.getTime()>s.value&&(a=this._getOrReturnCtx(t,a),mt(a,{code:Ze.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Xn.assertNever(s);return{status:r.value,value:new Date(t.data.getTime())}}_addCheck(t){return new i0({...this._def,checks:[...this._def.checks,t]})}min(t,n){return this._addCheck({kind:"min",value:t.getTime(),message:Dt.toString(n)})}max(t,n){return this._addCheck({kind:"max",value:t.getTime(),message:Dt.toString(n)})}get minDate(){let t=null;for(const n of this._def.checks)n.kind==="min"&&(t===null||n.value>t)&&(t=n.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const n of this._def.checks)n.kind==="max"&&(t===null||n.value<t)&&(t=n.value);return t!=null?new Date(t):null}}i0.create=e=>new i0({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:ln.ZodDate,...$n(e)});class t$ extends Yn{_parse(t){if(this._getType(t)!==Tt.symbol){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.symbol,received:r.parsedType}),sn}return Vi(t.data)}}t$.create=e=>new t$({typeName:ln.ZodSymbol,...$n(e)});class n$ extends Yn{_parse(t){if(this._getType(t)!==Tt.undefined){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.undefined,received:r.parsedType}),sn}return Vi(t.data)}}n$.create=e=>new n$({typeName:ln.ZodUndefined,...$n(e)});class r$ extends Yn{_parse(t){if(this._getType(t)!==Tt.null){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.null,received:r.parsedType}),sn}return Vi(t.data)}}r$.create=e=>new r$({typeName:ln.ZodNull,...$n(e)});class a$ extends Yn{constructor(){super(...arguments),this._any=!0}_parse(t){return Vi(t.data)}}a$.create=e=>new a$({typeName:ln.ZodAny,...$n(e)});class s$ extends Yn{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Vi(t.data)}}s$.create=e=>new s$({typeName:ln.ZodUnknown,...$n(e)});class au extends Yn{_parse(t){const n=this._getOrReturnCtx(t);return mt(n,{code:Ze.invalid_type,expected:Tt.never,received:n.parsedType}),sn}}au.create=e=>new au({typeName:ln.ZodNever,...$n(e)});class i$ extends Yn{_parse(t){if(this._getType(t)!==Tt.undefined){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.void,received:r.parsedType}),sn}return Vi(t.data)}}i$.create=e=>new i$({typeName:ln.ZodVoid,...$n(e)});class Qo extends Yn{_parse(t){const{ctx:n,status:r}=this._processInputParams(t),a=this._def;if(n.parsedType!==Tt.array)return mt(n,{code:Ze.invalid_type,expected:Tt.array,received:n.parsedType}),sn;if(a.exactLength!==null){const o=n.data.length>a.exactLength.value,l=n.data.length<a.exactLength.value;(o||l)&&(mt(n,{code:o?Ze.too_big:Ze.too_small,minimum:l?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(mt(n,{code:Ze.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(mt(n,{code:Ze.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((o,l)=>a.type._parseAsync(new ru(n,o,n.path,l)))).then(o=>hi.mergeArray(r,o));const s=[...n.data].map((o,l)=>a.type._parseSync(new ru(n,o,n.path,l)));return hi.mergeArray(r,s)}get element(){return this._def.type}min(t,n){return new Qo({...this._def,minLength:{value:t,message:Dt.toString(n)}})}max(t,n){return new Qo({...this._def,maxLength:{value:t,message:Dt.toString(n)}})}length(t,n){return new Qo({...this._def,exactLength:{value:t,message:Dt.toString(n)}})}nonempty(t){return this.min(1,t)}}Qo.create=(e,t)=>new Qo({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ln.ZodArray,...$n(t)});function pm(e){if(e instanceof oa){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Vc.create(pm(r))}return new oa({...e._def,shape:()=>t})}else return e instanceof Qo?new Qo({...e._def,type:pm(e.element)}):e instanceof Vc?Vc.create(pm(e.unwrap())):e instanceof sf?sf.create(pm(e.unwrap())):e instanceof Yd?Yd.create(e.items.map(t=>pm(t))):e}class oa extends Yn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),n=Xn.objectKeys(t);return this._cached={shape:t,keys:n},this._cached}_parse(t){if(this._getType(t)!==Tt.object){const d=this._getOrReturnCtx(t);return mt(d,{code:Ze.invalid_type,expected:Tt.object,received:d.parsedType}),sn}const{status:r,ctx:a}=this._processInputParams(t),{shape:s,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof au&&this._def.unknownKeys==="strip"))for(const d in a.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const u=s[d],h=a.data[d];c.push({key:{status:"valid",value:d},value:u._parse(new ru(a,h,a.path,d)),alwaysSet:d in a.data})}if(this._def.catchall instanceof au){const d=this._def.unknownKeys;if(d==="passthrough")for(const u of l)c.push({key:{status:"valid",value:u},value:{status:"valid",value:a.data[u]}});else if(d==="strict")l.length>0&&(mt(a,{code:Ze.unrecognized_keys,keys:l}),r.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const u of l){const h=a.data[u];c.push({key:{status:"valid",value:u},value:d._parse(new ru(a,h,a.path,u)),alwaysSet:u in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const d=[];for(const u of c){const h=await u.key,p=await u.value;d.push({key:h,value:p,alwaysSet:u.alwaysSet})}return d}).then(d=>hi.mergeObjectSync(r,d)):hi.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(t){return Dt.errToObj,new oa({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(n,r)=>{var s,o;const a=((o=(s=this._def).errorMap)==null?void 0:o.call(s,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:Dt.errToObj(t).message??a}:{message:a}}}:{}})}strip(){return new oa({...this._def,unknownKeys:"strip"})}passthrough(){return new oa({...this._def,unknownKeys:"passthrough"})}extend(t){return new oa({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new oa({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:ln.ZodObject})}setKey(t,n){return this.augment({[t]:n})}catchall(t){return new oa({...this._def,catchall:t})}pick(t){const n={};for(const r of Xn.objectKeys(t))t[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new oa({...this._def,shape:()=>n})}omit(t){const n={};for(const r of Xn.objectKeys(this.shape))t[r]||(n[r]=this.shape[r]);return new oa({...this._def,shape:()=>n})}deepPartial(){return pm(this)}partial(t){const n={};for(const r of Xn.objectKeys(this.shape)){const a=this.shape[r];t&&!t[r]?n[r]=a:n[r]=a.optional()}return new oa({...this._def,shape:()=>n})}required(t){const n={};for(const r of Xn.objectKeys(this.shape))if(t&&!t[r])n[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Vc;)s=s._def.innerType;n[r]=s}return new oa({...this._def,shape:()=>n})}keyof(){return C5(Xn.objectKeys(this.shape))}}oa.create=(e,t)=>new oa({shape:()=>e,unknownKeys:"strip",catchall:au.create(),typeName:ln.ZodObject,...$n(t)});oa.strictCreate=(e,t)=>new oa({shape:()=>e,unknownKeys:"strict",catchall:au.create(),typeName:ln.ZodObject,...$n(t)});oa.lazycreate=(e,t)=>new oa({shape:e,unknownKeys:"strip",catchall:au.create(),typeName:ln.ZodObject,...$n(t)});class o0 extends Yn{_parse(t){const{ctx:n}=this._processInputParams(t),r=this._def.options;function a(s){for(const l of s)if(l.result.status==="valid")return l.result;for(const l of s)if(l.result.status==="dirty")return n.common.issues.push(...l.ctx.common.issues),l.result;const o=s.map(l=>new Ul(l.ctx.common.issues));return mt(n,{code:Ze.invalid_union,unionErrors:o}),sn}if(n.common.async)return Promise.all(r.map(async s=>{const o={...n,common:{...n.common,issues:[]},parent:null};return{result:await s._parseAsync({data:n.data,path:n.path,parent:o}),ctx:o}})).then(a);{let s;const o=[];for(const c of r){const d={...n,common:{...n.common,issues:[]},parent:null},u=c._parseSync({data:n.data,path:n.path,parent:d});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(s)return n.common.issues.push(...s.ctx.common.issues),s.result;const l=o.map(c=>new Ul(c));return mt(n,{code:Ze.invalid_union,unionErrors:l}),sn}}get options(){return this._def.options}}o0.create=(e,t)=>new o0({options:e,typeName:ln.ZodUnion,...$n(t)});function J2(e,t){const n=vc(e),r=vc(t);if(e===t)return{valid:!0,data:e};if(n===Tt.object&&r===Tt.object){const a=Xn.objectKeys(t),s=Xn.objectKeys(e).filter(l=>a.indexOf(l)!==-1),o={...e,...t};for(const l of s){const c=J2(e[l],t[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(n===Tt.array&&r===Tt.array){if(e.length!==t.length)return{valid:!1};const a=[];for(let s=0;s<e.length;s++){const o=e[s],l=t[s],c=J2(o,l);if(!c.valid)return{valid:!1};a.push(c.data)}return{valid:!0,data:a}}else return n===Tt.date&&r===Tt.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class l0 extends Yn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=(s,o)=>{if(ZM(s)||ZM(o))return sn;const l=J2(s.value,o.value);return l.valid?((QM(s)||QM(o))&&n.dirty(),{status:n.value,value:l.data}):(mt(r,{code:Ze.invalid_intersection_types}),sn)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,o])=>a(s,o)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}l0.create=(e,t,n)=>new l0({left:e,right:t,typeName:ln.ZodIntersection,...$n(n)});class Yd extends Yn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.array)return mt(r,{code:Ze.invalid_type,expected:Tt.array,received:r.parsedType}),sn;if(r.data.length<this._def.items.length)return mt(r,{code:Ze.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),sn;!this._def.rest&&r.data.length>this._def.items.length&&(mt(r,{code:Ze.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const s=[...r.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new ru(r,o,r.path,l)):null}).filter(o=>!!o);return r.common.async?Promise.all(s).then(o=>hi.mergeArray(n,o)):hi.mergeArray(n,s)}get items(){return this._def.items}rest(t){return new Yd({...this._def,rest:t})}}Yd.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Yd({items:e,typeName:ln.ZodTuple,rest:null,...$n(t)})};class o$ extends Yn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.map)return mt(r,{code:Ze.invalid_type,expected:Tt.map,received:r.parsedType}),sn;const a=this._def.keyType,s=this._def.valueType,o=[...r.data.entries()].map(([l,c],d)=>({key:a._parse(new ru(r,l,r.path,[d,"key"])),value:s._parse(new ru(r,c,r.path,[d,"value"]))}));if(r.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,u=await c.value;if(d.status==="aborted"||u.status==="aborted")return sn;(d.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(d.value,u.value)}return{status:n.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,u=c.value;if(d.status==="aborted"||u.status==="aborted")return sn;(d.status==="dirty"||u.status==="dirty")&&n.dirty(),l.set(d.value,u.value)}return{status:n.value,value:l}}}}o$.create=(e,t,n)=>new o$({valueType:t,keyType:e,typeName:ln.ZodMap,...$n(n)});class My extends Yn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.parsedType!==Tt.set)return mt(r,{code:Ze.invalid_type,expected:Tt.set,received:r.parsedType}),sn;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(mt(r,{code:Ze.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(mt(r,{code:Ze.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());const s=this._def.valueType;function o(c){const d=new Set;for(const u of c){if(u.status==="aborted")return sn;u.status==="dirty"&&n.dirty(),d.add(u.value)}return{status:n.value,value:d}}const l=[...r.data.values()].map((c,d)=>s._parse(new ru(r,c,r.path,d)));return r.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(t,n){return new My({...this._def,minSize:{value:t,message:Dt.toString(n)}})}max(t,n){return new My({...this._def,maxSize:{value:t,message:Dt.toString(n)}})}size(t,n){return this.min(t,n).max(t,n)}nonempty(t){return this.min(1,t)}}My.create=(e,t)=>new My({valueType:e,minSize:null,maxSize:null,typeName:ln.ZodSet,...$n(t)});class l$ extends Yn{get schema(){return this._def.getter()}_parse(t){const{ctx:n}=this._processInputParams(t);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}l$.create=(e,t)=>new l$({getter:e,typeName:ln.ZodLazy,...$n(t)});class eC extends Yn{_parse(t){if(t.data!==this._def.value){const n=this._getOrReturnCtx(t);return mt(n,{received:n.data,code:Ze.invalid_literal,expected:this._def.value}),sn}return{status:"valid",value:t.data}}get value(){return this._def.value}}eC.create=(e,t)=>new eC({value:e,typeName:ln.ZodLiteral,...$n(t)});function C5(e,t){return new rf({values:e,typeName:ln.ZodEnum,...$n(t)})}class rf extends Yn{_parse(t){if(typeof t.data!="string"){const n=this._getOrReturnCtx(t),r=this._def.values;return mt(n,{expected:Xn.joinValues(r),received:n.parsedType,code:Ze.invalid_type}),sn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const n=this._getOrReturnCtx(t),r=this._def.values;return mt(n,{received:n.data,code:Ze.invalid_enum_value,options:r}),sn}return Vi(t.data)}get options(){return this._def.values}get enum(){const t={};for(const n of this._def.values)t[n]=n;return t}get Values(){const t={};for(const n of this._def.values)t[n]=n;return t}get Enum(){const t={};for(const n of this._def.values)t[n]=n;return t}extract(t,n=this._def){return rf.create(t,{...this._def,...n})}exclude(t,n=this._def){return rf.create(this.options.filter(r=>!t.includes(r)),{...this._def,...n})}}rf.create=C5;class c$ extends Yn{_parse(t){const n=Xn.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(t);if(r.parsedType!==Tt.string&&r.parsedType!==Tt.number){const a=Xn.objectValues(n);return mt(r,{expected:Xn.joinValues(a),received:r.parsedType,code:Ze.invalid_type}),sn}if(this._cache||(this._cache=new Set(Xn.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const a=Xn.objectValues(n);return mt(r,{received:r.data,code:Ze.invalid_enum_value,options:a}),sn}return Vi(t.data)}get enum(){return this._def.values}}c$.create=(e,t)=>new c$({values:e,typeName:ln.ZodNativeEnum,...$n(t)});class c0 extends Yn{unwrap(){return this._def.type}_parse(t){const{ctx:n}=this._processInputParams(t);if(n.parsedType!==Tt.promise&&n.common.async===!1)return mt(n,{code:Ze.invalid_type,expected:Tt.promise,received:n.parsedType}),sn;const r=n.parsedType===Tt.promise?n.data:Promise.resolve(n.data);return Vi(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}}c0.create=(e,t)=>new c0({type:e,typeName:ln.ZodPromise,...$n(t)});class af extends Yn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ln.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:n,ctx:r}=this._processInputParams(t),a=this._def.effect||null,s={addIssue:o=>{mt(r,o),o.fatal?n.abort():n.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){const o=a.transform(r.data,s);if(r.common.async)return Promise.resolve(o).then(async l=>{if(n.value==="aborted")return sn;const c=await this._def.schema._parseAsync({data:l,path:r.path,parent:r});return c.status==="aborted"?sn:c.status==="dirty"||n.value==="dirty"?zx(c.value):c});{if(n.value==="aborted")return sn;const l=this._def.schema._parseSync({data:o,path:r.path,parent:r});return l.status==="aborted"?sn:l.status==="dirty"||n.value==="dirty"?zx(l.value):l}}if(a.type==="refinement"){const o=l=>{const c=a.refinement(l,s);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(r.common.async===!1){const l=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return l.status==="aborted"?sn:(l.status==="dirty"&&n.dirty(),o(l.value),{status:n.value,value:l.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(l=>l.status==="aborted"?sn:(l.status==="dirty"&&n.dirty(),o(l.value).then(()=>({status:n.value,value:l.value}))))}if(a.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!nf(o))return sn;const l=a.transform(o.value,s);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:l}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>nf(o)?Promise.resolve(a.transform(o.value,s)).then(l=>({status:n.value,value:l})):sn);Xn.assertNever(a)}}af.create=(e,t,n)=>new af({schema:e,typeName:ln.ZodEffects,effect:t,...$n(n)});af.createWithPreprocess=(e,t,n)=>new af({schema:t,effect:{type:"preprocess",transform:e},typeName:ln.ZodEffects,...$n(n)});class Vc extends Yn{_parse(t){return this._getType(t)===Tt.undefined?Vi(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Vc.create=(e,t)=>new Vc({innerType:e,typeName:ln.ZodOptional,...$n(t)});class sf extends Yn{_parse(t){return this._getType(t)===Tt.null?Vi(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}sf.create=(e,t)=>new sf({innerType:e,typeName:ln.ZodNullable,...$n(t)});class tC extends Yn{_parse(t){const{ctx:n}=this._processInputParams(t);let r=n.data;return n.parsedType===Tt.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}tC.create=(e,t)=>new tC({innerType:e,typeName:ln.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...$n(t)});class nC extends Yn{_parse(t){const{ctx:n}=this._processInputParams(t),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return s0(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ul(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ul(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}nC.create=(e,t)=>new nC({innerType:e,typeName:ln.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...$n(t)});class u$ extends Yn{_parse(t){if(this._getType(t)!==Tt.nan){const r=this._getOrReturnCtx(t);return mt(r,{code:Ze.invalid_type,expected:Tt.nan,received:r.parsedType}),sn}return{status:"valid",value:t.data}}}u$.create=e=>new u$({typeName:ln.ZodNaN,...$n(e)});class Yae extends Yn{_parse(t){const{ctx:n}=this._processInputParams(t),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class $j extends Yn{_parse(t){const{status:n,ctx:r}=this._processInputParams(t);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?sn:s.status==="dirty"?(n.dirty(),zx(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?sn:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(t,n){return new $j({in:t,out:n,typeName:ln.ZodPipeline})}}class rC extends Yn{_parse(t){const n=this._def.innerType._parse(t),r=a=>(nf(a)&&(a.value=Object.freeze(a.value)),a);return s0(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}}rC.create=(e,t)=>new rC({innerType:e,typeName:ln.ZodReadonly,...$n(t)});var ln;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(ln||(ln={}));const Yk=Oc.create;au.create;Qo.create;const Xae=oa.create;o0.create;l0.create;Yd.create;const d$=eC.create;rf.create;c0.create;Vc.create;sf.create;var db=e=>e.type==="checkbox",gd=e=>e instanceof Date,Os=e=>e==null;const _5=e=>typeof e=="object";var ua=e=>!Os(e)&&!Array.isArray(e)&&_5(e)&&!gd(e),Zae=e=>ua(e)&&e.target?db(e.target)?e.target.checked:e.target.value:e,Qae=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,Jae=(e,t)=>e.has(Qae(t)),ese=e=>{const t=e.constructor&&e.constructor.prototype;return ua(t)&&t.hasOwnProperty("isPrototypeOf")},Fj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ga(e){if(e instanceof Date)return new Date(e);const t=typeof FileList<"u"&&e instanceof FileList;if(Fj&&(e instanceof Blob||t))return e;const n=Array.isArray(e);if(!n&&!(ua(e)&&ese(e)))return e;const r=n?[]:Object.create(Object.getPrototypeOf(e));for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(r[a]=ga(e[a]));return r}var S1=e=>/^\w*$/.test(e),zr=e=>e===void 0,Pj=e=>Array.isArray(e)?e.filter(Boolean):[],Oj=e=>Pj(e.replace(/["|']|\]/g,"").split(/\.|\[/)),kt=(e,t,n)=>{if(!t||!ua(e))return n;const r=(S1(t)?[t]:Oj(t)).reduce((a,s)=>Os(a)?a:a[s],e);return zr(r)||r===e?zr(e[t])?n:e[t]:r},Oo=e=>typeof e=="boolean",co=e=>typeof e=="function",Nr=(e,t,n)=>{let r=-1;const a=S1(t)?[t]:Oj(t),s=a.length,o=s-1;for(;++r<s;){const l=a[r];let c=n;if(r!==o){const d=e[l];c=ua(d)||Array.isArray(d)?d:isNaN(+a[r+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;e[l]=c,e=e[l]}};const h$={BLUR:"blur",FOCUS_OUT:"focusout"},uo={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},kl={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},tse=Ne.createContext(null);tse.displayName="HookFormControlContext";var nse=(e,t,n,r=!0)=>{const a={defaultValues:t._defaultValues};for(const s in e)Object.defineProperty(a,s,{get:()=>{const o=s;return t._proxyFormState[o]!==uo.all&&(t._proxyFormState[o]=!r||uo.all),e[o]}});return a};const rse=typeof window<"u"?Ne.useLayoutEffect:Ne.useEffect;var ri=e=>typeof e=="string",ase=(e,t,n,r,a)=>ri(e)?(r&&t.watch.add(e),kt(n,e,a)):Array.isArray(e)?e.map(s=>(r&&t.watch.add(s),kt(n,s))):(r&&(t.watchAll=!0),n),aC=e=>Os(e)||!_5(e);function Cc(e,t,n=new WeakSet){if(aC(e)||aC(t))return Object.is(e,t);if(gd(e)&&gd(t))return Object.is(e.getTime(),t.getTime());const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;if(n.has(e)||n.has(t))return!0;n.add(e),n.add(t);for(const s of r){const o=e[s];if(!a.includes(s))return!1;if(s!=="ref"){const l=t[s];if(gd(o)&&gd(l)||ua(o)&&ua(l)||Array.isArray(o)&&Array.isArray(l)?!Cc(o,l,n):!Object.is(o,l))return!1}}return!0}const sse=Ne.createContext(null);sse.displayName="HookFormContext";var j5=(e,t,n,r,a)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[r]:a||!0}}:{},uy=e=>Array.isArray(e)?e:[e],p$=()=>{let e=[];return{get observers(){return e},next:a=>{for(const s of e)s.next&&s.next(a)},subscribe:a=>(e.push(a),{unsubscribe:()=>{e=e.filter(s=>s!==a)}}),unsubscribe:()=>{e=[]}}};function I5(e,t){const n={};for(const r in e)if(e.hasOwnProperty(r)){const a=e[r],s=t[r];if(a&&ua(a)&&s){const o=I5(a,s);ua(o)&&(n[r]=o)}else e[r]&&(n[r]=s)}return n}var hs=e=>ua(e)&&!Object.keys(e).length,Lj=e=>e.type==="file",u0=e=>{if(!Fj)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},T5=e=>e.type==="select-multiple",zj=e=>e.type==="radio",ise=e=>zj(e)||db(e),Xk=e=>u0(e)&&e.isConnected;function ose(e,t){const n=t.slice(0,-1).length;let r=0;for(;r<n;)e=zr(e)?r++:e[t[r++]];return e}function lse(e){for(const t in e)if(e.hasOwnProperty(t)&&!zr(e[t]))return!1;return!0}function sa(e,t){const n=Array.isArray(t)?t:S1(t)?[t]:Oj(t),r=n.length===1?e:ose(e,n),a=n.length-1,s=n[a];return r&&delete r[s],a!==0&&(ua(r)&&hs(r)||Array.isArray(r)&&lse(r))&&sa(e,n.slice(0,-1)),e}var cse=e=>{for(const t in e)if(co(e[t]))return!0;return!1};function E5(e){return Array.isArray(e)||ua(e)&&!cse(e)}function sC(e,t={}){for(const n in e){const r=e[n];E5(r)?(t[n]=Array.isArray(r)?[]:{},sC(r,t[n])):zr(r)||(t[n]=!0)}return t}function mm(e,t,n){n||(n=sC(t));for(const r in e){const a=e[r];if(E5(a))zr(t)||aC(n[r])?n[r]=sC(a,Array.isArray(a)?[]:{}):mm(a,Os(t)?{}:t[r],n[r]);else{const s=t[r];n[r]=!Cc(a,s)}}return n}const m$={value:!1,isValid:!1},f$={value:!0,isValid:!0};var A5=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!zr(e[0].attributes.value)?zr(e[0].value)||e[0].value===""?f$:{value:e[0].value,isValid:!0}:f$:m$}return m$},R5=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:r})=>zr(e)?e:t?e===""?NaN:e&&+e:n&&ri(e)?new Date(e):r?r(e):e;const g$={isValid:!1,value:null};var D5=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,g$):g$;function x$(e){const t=e.ref;return Lj(t)?t.files:zj(t)?D5(e.refs).value:T5(t)?[...t.selectedOptions].map(({value:n})=>n):db(t)?A5(e.refs).value:R5(zr(t.value)?e.ref.value:t.value,e)}var use=(e,t,n,r)=>{const a={};for(const s of e){const o=kt(t,s);o&&Nr(a,s,o._f)}return{criteriaMode:n,names:[...e],fields:a,shouldUseNativeValidation:r}},d0=e=>e instanceof RegExp,mx=e=>zr(e)?e:d0(e)?e.source:ua(e)?d0(e.value)?e.value.source:e.value:e,y$=e=>({isOnSubmit:!e||e===uo.onSubmit,isOnBlur:e===uo.onBlur,isOnChange:e===uo.onChange,isOnAll:e===uo.all,isOnTouch:e===uo.onTouched});const b$="AsyncFunction";var dse=e=>!!e&&!!e.validate&&!!(co(e.validate)&&e.validate.constructor.name===b$||ua(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===b$)),hse=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),v$=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(r=>e.startsWith(r)&&/^\.\w+/.test(e.slice(r.length))));const dy=(e,t,n,r)=>{for(const a of n||Object.keys(e)){const s=kt(e,a);if(s){const{_f:o,...l}=s;if(o){if(o.refs&&o.refs[0]&&t(o.refs[0],a)&&!r)return!0;if(o.ref&&t(o.ref,o.name)&&!r)return!0;if(dy(l,t))break}else if(ua(l)&&dy(l,t))break}}};function w$(e,t,n){const r=kt(e,n);if(r||S1(n))return{error:r,name:n};const a=n.split(".");for(;a.length;){const s=a.join("."),o=kt(t,s),l=kt(e,s);if(o&&!Array.isArray(o)&&n!==s)return{name:n};if(l&&l.type)return{name:s,error:l};if(l&&l.root&&l.root.type)return{name:`${s}.root`,error:l.root};a.pop()}return{name:n}}var pse=(e,t,n,r)=>{n(e);const{name:a,...s}=e;return hs(s)||Object.keys(s).length>=Object.keys(t).length||Object.keys(s).find(o=>t[o]===(!r||uo.all))},mse=(e,t,n)=>!e||!t||e===t||uy(e).some(r=>r&&(n?r===t:r.startsWith(t)||t.startsWith(r))),fse=(e,t,n,r,a)=>a.isOnAll?!1:!n&&a.isOnTouch?!(t||e):(n?r.isOnBlur:a.isOnBlur)?!e:(n?r.isOnChange:a.isOnChange)?e:!0,gse=(e,t)=>!Pj(kt(e,t)).length&&sa(e,t),xse=(e,t,n)=>{const r=uy(kt(e,n));return Nr(r,"root",t[n]),Nr(e,n,r),e};function N$(e,t,n="validate"){if(ri(e)||Array.isArray(e)&&e.every(ri)||Oo(e)&&!e)return{type:n,message:ri(e)?e:"",ref:t}}var sm=e=>ua(e)&&!d0(e)?e:{value:e,message:""},k$=async(e,t,n,r,a,s)=>{const{ref:o,refs:l,required:c,maxLength:d,minLength:u,min:h,max:p,pattern:m,validate:f,name:g,valueAsNumber:x,mount:y}=e._f,b=kt(n,g);if(!y||t.has(g))return{};const v=l?l[0]:o,w=j=>{a&&v.reportValidity&&(v.setCustomValidity(Oo(j)?"":j||""),v.reportValidity())},k={},C=zj(o),S=db(o),_=C||S,I=(x||Lj(o))&&zr(o.value)&&zr(b)||u0(o)&&o.value===""||b===""||Array.isArray(b)&&!b.length,T=j5.bind(null,g,r,k),A=(j,D,F,B=kl.maxLength,q=kl.minLength)=>{const $=j?D:F;k[g]={type:j?B:q,message:$,ref:o,...T(j?B:q,$)}};if(s?!Array.isArray(b)||!b.length:c&&(!_&&(I||Os(b))||Oo(b)&&!b||S&&!A5(l).isValid||C&&!D5(l).isValid)){const{value:j,message:D}=ri(c)?{value:!!c,message:c}:sm(c);if(j&&(k[g]={type:kl.required,message:D,ref:v,...T(kl.required,D)},!r))return w(D),k}if(!I&&(!Os(h)||!Os(p))){let j,D;const F=sm(p),B=sm(h);if(!Os(b)&&!isNaN(b)){const q=o.valueAsNumber||b&&+b;Os(F.value)||(j=q>F.value),Os(B.value)||(D=q<B.value)}else{const q=o.valueAsDate||new Date(b),$=X=>new Date(new Date().toDateString()+" "+X),L=o.type=="time",M=o.type=="week";ri(F.value)&&b&&(j=L?$(b)>$(F.value):M?b>F.value:q>new Date(F.value)),ri(B.value)&&b&&(D=L?$(b)<$(B.value):M?b<B.value:q<new Date(B.value))}if((j||D)&&(A(!!j,F.message,B.message,kl.max,kl.min),!r))return w(k[g].message),k}if((d||u)&&!I&&(ri(b)||s&&Array.isArray(b))){const j=sm(d),D=sm(u),F=!Os(j.value)&&b.length>+j.value,B=!Os(D.value)&&b.length<+D.value;if((F||B)&&(A(F,j.message,D.message),!r))return w(k[g].message),k}if(m&&!I&&ri(b)){const{value:j,message:D}=sm(m);if(d0(j)&&!b.match(j)&&(k[g]={type:kl.pattern,message:D,ref:o,...T(kl.pattern,D)},!r))return w(D),k}if(f){if(co(f)){const j=await f(b,n),D=N$(j,v);if(D&&(k[g]={...D,...T(kl.validate,D.message)},!r))return w(D.message),k}else if(ua(f)){let j={};for(const D in f){if(!hs(j)&&!r)break;const F=N$(await f[D](b,n),v,D);F&&(j={...F,...T(D,F.message)},w(F.message),r&&(k[g]=j))}if(!hs(j)&&(k[g]={ref:v,...j},!r))return k}}return w(!0),k};const yse={mode:uo.onSubmit,reValidateMode:uo.onChange,shouldFocusError:!0};function bse(e={}){let t={...yse,...e},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:co(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},r={},a=ua(t.defaultValues)||ua(t.values)?ga(t.defaultValues||t.values)||{}:{},s=t.shouldUnregister?{}:ga(a),o={action:!1,mount:!1,watch:!1,keepIsValid:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},h={...u};let p={...h};const m={array:p$(),state:p$()},f=t.criteriaMode===uo.all,g=V=>ee=>{clearTimeout(d),d=setTimeout(V,ee)},x=async V=>{if(!o.keepIsValid&&!t.disabled&&(h.isValid||p.isValid||V)){let ee;t.resolver?(ee=hs((await _()).errors),y()):ee=await T(r,!0),ee!==n.isValid&&m.state.next({isValid:ee})}},y=(V,ee)=>{!t.disabled&&(h.isValidating||h.validatingFields||p.isValidating||p.validatingFields)&&((V||Array.from(l.mount)).forEach(ve=>{ve&&(ee?Nr(n.validatingFields,ve,ee):sa(n.validatingFields,ve))}),m.state.next({validatingFields:n.validatingFields,isValidating:!hs(n.validatingFields)}))},b=(V,ee=[],ve,ke,Ce=!0,be=!0)=>{if(ke&&ve&&!t.disabled){if(o.action=!0,be&&Array.isArray(kt(r,V))){const Ee=ve(kt(r,V),ke.argA,ke.argB);Ce&&Nr(r,V,Ee)}if(be&&Array.isArray(kt(n.errors,V))){const Ee=ve(kt(n.errors,V),ke.argA,ke.argB);Ce&&Nr(n.errors,V,Ee),gse(n.errors,V)}if((h.touchedFields||p.touchedFields)&&be&&Array.isArray(kt(n.touchedFields,V))){const Ee=ve(kt(n.touchedFields,V),ke.argA,ke.argB);Ce&&Nr(n.touchedFields,V,Ee)}(h.dirtyFields||p.dirtyFields)&&(n.dirtyFields=mm(a,s)),m.state.next({name:V,isDirty:j(V,ee),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Nr(s,V,ee)},v=(V,ee)=>{Nr(n.errors,V,ee),m.state.next({errors:n.errors})},w=V=>{n.errors=V,m.state.next({errors:n.errors,isValid:!1})},k=(V,ee,ve,ke)=>{const Ce=kt(r,V);if(Ce){const be=kt(s,V,zr(ve)?kt(a,V):ve);zr(be)||ke&&ke.defaultChecked||ee?Nr(s,V,ee?be:x$(Ce._f)):B(V,be),o.mount&&!o.action&&x()}},C=(V,ee,ve,ke,Ce)=>{let be=!1,Ee=!1;const Ue={name:V};if(!t.disabled){if(!ve||ke){(h.isDirty||p.isDirty)&&(Ee=n.isDirty,n.isDirty=Ue.isDirty=j(),be=Ee!==Ue.isDirty);const Qe=Cc(kt(a,V),ee);Ee=!!kt(n.dirtyFields,V),Qe?sa(n.dirtyFields,V):Nr(n.dirtyFields,V,!0),Ue.dirtyFields=n.dirtyFields,be=be||(h.dirtyFields||p.dirtyFields)&&Ee!==!Qe}if(ve){const Qe=kt(n.touchedFields,V);Qe||(Nr(n.touchedFields,V,ve),Ue.touchedFields=n.touchedFields,be=be||(h.touchedFields||p.touchedFields)&&Qe!==ve)}be&&Ce&&m.state.next(Ue)}return be?Ue:{}},S=(V,ee,ve,ke)=>{const Ce=kt(n.errors,V),be=(h.isValid||p.isValid)&&Oo(ee)&&n.isValid!==ee;if(t.delayError&&ve?(c=g(()=>v(V,ve)),c(t.delayError)):(clearTimeout(d),c=null,ve?Nr(n.errors,V,ve):sa(n.errors,V)),(ve?!Cc(Ce,ve):Ce)||!hs(ke)||be){const Ee={...ke,...be&&Oo(ee)?{isValid:ee}:{},errors:n.errors,name:V};n={...n,...Ee},m.state.next(Ee)}},_=async V=>(y(V,!0),await t.resolver(s,t.context,use(V||l.mount,r,t.criteriaMode,t.shouldUseNativeValidation))),I=async V=>{const{errors:ee}=await _(V);if(y(V),V)for(const ve of V){const ke=kt(ee,ve);ke?Nr(n.errors,ve,ke):sa(n.errors,ve)}else n.errors=ee;return ee},T=async(V,ee,ve={valid:!0})=>{for(const ke in V){const Ce=V[ke];if(Ce){const{_f:be,...Ee}=Ce;if(be){const Ue=l.array.has(be.name),Qe=Ce._f&&dse(Ce._f);Qe&&h.validatingFields&&y([be.name],!0);const _t=await k$(Ce,l.disabled,s,f,t.shouldUseNativeValidation&&!ee,Ue);if(Qe&&h.validatingFields&&y([be.name]),_t[be.name]&&(ve.valid=!1,ee||e.shouldUseNativeValidation))break;!ee&&(kt(_t,be.name)?Ue?xse(n.errors,_t,be.name):Nr(n.errors,be.name,_t[be.name]):sa(n.errors,be.name))}!hs(Ee)&&await T(Ee,ee,ve)}}return ve.valid},A=()=>{for(const V of l.unMount){const ee=kt(r,V);ee&&(ee._f.refs?ee._f.refs.every(ve=>!Xk(ve)):!Xk(ee._f.ref))&&te(V)}l.unMount=new Set},j=(V,ee)=>!t.disabled&&(V&&ee&&Nr(s,V,ee),!Cc(G(),a)),D=(V,ee,ve)=>ase(V,l,{...o.mount?s:zr(ee)?a:ri(V)?{[V]:ee}:ee},ve,ee),F=V=>Pj(kt(o.mount?s:a,V,t.shouldUnregister?kt(a,V,[]):[])),B=(V,ee,ve={})=>{const ke=kt(r,V);let Ce=ee;if(ke){const be=ke._f;be&&(!be.disabled&&Nr(s,V,R5(ee,be)),Ce=u0(be.ref)&&Os(ee)?"":ee,T5(be.ref)?[...be.ref.options].forEach(Ee=>Ee.selected=Ce.includes(Ee.value)):be.refs?db(be.ref)?be.refs.forEach(Ee=>{(!Ee.defaultChecked||!Ee.disabled)&&(Array.isArray(Ce)?Ee.checked=!!Ce.find(Ue=>Ue===Ee.value):Ee.checked=Ce===Ee.value||!!Ce)}):be.refs.forEach(Ee=>Ee.checked=Ee.value===Ce):Lj(be.ref)?be.ref.value="":(be.ref.value=Ce,be.ref.type||m.state.next({name:V,values:ga(s)})))}(ve.shouldDirty||ve.shouldTouch)&&C(V,Ce,ve.shouldTouch,ve.shouldDirty,!0),ve.shouldValidate&&X(V)},q=(V,ee,ve)=>{for(const ke in ee){if(!ee.hasOwnProperty(ke))return;const Ce=ee[ke],be=V+"."+ke,Ee=kt(r,be);(l.array.has(V)||ua(Ce)||Ee&&!Ee._f)&&!gd(Ce)?q(be,Ce,ve):B(be,Ce,ve)}},$=(V,ee,ve={})=>{const ke=kt(r,V),Ce=l.array.has(V),be=ga(ee);Nr(s,V,be),Ce?(m.array.next({name:V,values:ga(s)}),(h.isDirty||h.dirtyFields||p.isDirty||p.dirtyFields)&&ve.shouldDirty&&m.state.next({name:V,dirtyFields:mm(a,s),isDirty:j(V,be)})):ke&&!ke._f&&!Os(be)?q(V,be,ve):B(V,be,ve),v$(V,l)?m.state.next({...n,name:V,values:ga(s)}):m.state.next({name:o.mount?V:void 0,values:ga(s)})},L=async V=>{o.mount=!0;const ee=V.target;let ve=ee.name,ke=!0;const Ce=kt(r,ve),be=Qe=>{ke=Number.isNaN(Qe)||gd(Qe)&&isNaN(Qe.getTime())||Cc(Qe,kt(s,ve,Qe))},Ee=y$(t.mode),Ue=y$(t.reValidateMode);if(Ce){let Qe,_t;const $t=ee.type?x$(Ce._f):Zae(V),Ve=V.type===h$.BLUR||V.type===h$.FOCUS_OUT,tt=!hse(Ce._f)&&!t.resolver&&!kt(n.errors,ve)&&!Ce._f.deps||fse(Ve,kt(n.touchedFields,ve),n.isSubmitted,Ue,Ee),yt=v$(ve,l,Ve);Nr(s,ve,$t),Ve?(!ee||!ee.readOnly)&&(Ce._f.onBlur&&Ce._f.onBlur(V),c&&c(0)):Ce._f.onChange&&Ce._f.onChange(V);const ut=C(ve,$t,Ve),qt=!hs(ut)||yt;if(!Ve&&m.state.next({name:ve,type:V.type,values:ga(s)}),tt)return(h.isValid||p.isValid)&&(t.mode==="onBlur"?Ve&&x():Ve||x()),qt&&m.state.next({name:ve,...yt?{}:ut});if(!Ve&&yt&&m.state.next({...n}),t.resolver){const{errors:an}=await _([ve]);if(y([ve]),be($t),ke){const lt=w$(n.errors,r,ve),wt=w$(an,r,lt.name||ve);Qe=wt.error,ve=wt.name,_t=hs(an)}}else y([ve],!0),Qe=(await k$(Ce,l.disabled,s,f,t.shouldUseNativeValidation))[ve],y([ve]),be($t),ke&&(Qe?_t=!1:(h.isValid||p.isValid)&&(_t=await T(r,!0)));ke&&(Ce._f.deps&&(!Array.isArray(Ce._f.deps)||Ce._f.deps.length>0)&&X(Ce._f.deps),S(ve,_t,Qe,ut))}},M=(V,ee)=>{if(kt(n.errors,ee)&&V.focus)return V.focus(),1},X=async(V,ee={})=>{let ve,ke;const Ce=uy(V);if(t.resolver){const be=await I(zr(V)?V:Ce);ve=hs(be),ke=V?!Ce.some(Ee=>kt(be,Ee)):ve}else V?(ke=(await Promise.all(Ce.map(async be=>{const Ee=kt(r,be);return await T(Ee&&Ee._f?{[be]:Ee}:Ee)}))).every(Boolean),!(!ke&&!n.isValid)&&x()):ke=ve=await T(r);return m.state.next({...!ri(V)||(h.isValid||p.isValid)&&ve!==n.isValid?{}:{name:V},...t.resolver||!V?{isValid:ve}:{},errors:n.errors}),ee.shouldFocus&&!ke&&dy(r,M,V?Ce:l.mount),ke},G=(V,ee)=>{let ve={...o.mount?s:a};return ee&&(ve=I5(ee.dirtyFields?n.dirtyFields:n.touchedFields,ve)),zr(V)?ve:ri(V)?kt(ve,V):V.map(ke=>kt(ve,ke))},W=(V,ee)=>({invalid:!!kt((ee||n).errors,V),isDirty:!!kt((ee||n).dirtyFields,V),error:kt((ee||n).errors,V),isValidating:!!kt(n.validatingFields,V),isTouched:!!kt((ee||n).touchedFields,V)}),O=V=>{V&&uy(V).forEach(ee=>sa(n.errors,ee)),m.state.next({errors:V?n.errors:{}})},U=(V,ee,ve)=>{const ke=(kt(r,V,{_f:{}})._f||{}).ref,Ce=kt(n.errors,V)||{},{ref:be,message:Ee,type:Ue,...Qe}=Ce;Nr(n.errors,V,{...Qe,...ee,ref:ke}),m.state.next({name:V,errors:n.errors,isValid:!1}),ve&&ve.shouldFocus&&ke&&ke.focus&&ke.focus()},K=(V,ee)=>co(V)?m.state.subscribe({next:ve=>"values"in ve&&V(D(void 0,ee),ve)}):D(V,ee,!0),ce=V=>m.state.subscribe({next:ee=>{mse(V.name,ee.name,V.exact)&&pse(ee,V.formState||h,Ye,V.reRenderRoot)&&V.callback({values:{...s},...n,...ee,defaultValues:a})}}).unsubscribe,ne=V=>(o.mount=!0,p={...p,...V.formState},ce({...V,formState:{...u,...V.formState}})),te=(V,ee={})=>{for(const ve of V?uy(V):l.mount)l.mount.delete(ve),l.array.delete(ve),ee.keepValue||(sa(r,ve),sa(s,ve)),!ee.keepError&&sa(n.errors,ve),!ee.keepDirty&&sa(n.dirtyFields,ve),!ee.keepTouched&&sa(n.touchedFields,ve),!ee.keepIsValidating&&sa(n.validatingFields,ve),!t.shouldUnregister&&!ee.keepDefaultValue&&sa(a,ve);m.state.next({values:ga(s)}),m.state.next({...n,...ee.keepDirty?{isDirty:j()}:{}}),!ee.keepIsValid&&x()},Te=({disabled:V,name:ee})=>{if(Oo(V)&&o.mount||V||l.disabled.has(ee)){const Ce=l.disabled.has(ee)!==!!V;V?l.disabled.add(ee):l.disabled.delete(ee),Ce&&o.mount&&!o.action&&x()}},Ae=(V,ee={})=>{let ve=kt(r,V);const ke=Oo(ee.disabled)||Oo(t.disabled);return Nr(r,V,{...ve||{},_f:{...ve&&ve._f?ve._f:{ref:{name:V}},name:V,mount:!0,...ee}}),l.mount.add(V),ve?Te({disabled:Oo(ee.disabled)?ee.disabled:t.disabled,name:V}):k(V,!0,ee.value),{...ke?{disabled:ee.disabled||t.disabled}:{},...t.progressive?{required:!!ee.required,min:mx(ee.min),max:mx(ee.max),minLength:mx(ee.minLength),maxLength:mx(ee.maxLength),pattern:mx(ee.pattern)}:{},name:V,onChange:L,onBlur:L,ref:Ce=>{if(Ce){Ae(V,ee),ve=kt(r,V);const be=zr(Ce.value)&&Ce.querySelectorAll&&Ce.querySelectorAll("input,select,textarea")[0]||Ce,Ee=ise(be),Ue=ve._f.refs||[];if(Ee?Ue.find(Qe=>Qe===be):be===ve._f.ref)return;Nr(r,V,{_f:{...ve._f,...Ee?{refs:[...Ue.filter(Xk),be,...Array.isArray(kt(a,V))?[{}]:[]],ref:{type:be.type,name:V}}:{ref:be}}}),k(V,!1,void 0,be)}else ve=kt(r,V,{}),ve._f&&(ve._f.mount=!1),(t.shouldUnregister||ee.shouldUnregister)&&!(Jae(l.array,V)&&o.action)&&l.unMount.add(V)}}},Se=()=>t.shouldFocusError&&dy(r,M,l.mount),we=V=>{Oo(V)&&(m.state.next({disabled:V}),dy(r,(ee,ve)=>{const ke=kt(r,ve);ke&&(ee.disabled=ke._f.disabled||V,Array.isArray(ke._f.refs)&&ke._f.refs.forEach(Ce=>{Ce.disabled=ke._f.disabled||V}))},0,!1))},Fe=(V,ee)=>async ve=>{let ke;ve&&(ve.preventDefault&&ve.preventDefault(),ve.persist&&ve.persist());let Ce=ga(s);if(m.state.next({isSubmitting:!0}),t.resolver){const{errors:be,values:Ee}=await _();y(),n.errors=be,Ce=ga(Ee)}else await T(r);if(l.disabled.size)for(const be of l.disabled)sa(Ce,be);if(sa(n.errors,"root"),hs(n.errors)){m.state.next({errors:{}});try{await V(Ce,ve)}catch(be){ke=be}}else ee&&await ee({...n.errors},ve),Se(),setTimeout(Se);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:hs(n.errors)&&!ke,submitCount:n.submitCount+1,errors:n.errors}),ke)throw ke},Q=(V,ee={})=>{kt(r,V)&&(zr(ee.defaultValue)?$(V,ga(kt(a,V))):($(V,ee.defaultValue),Nr(a,V,ga(ee.defaultValue))),ee.keepTouched||sa(n.touchedFields,V),ee.keepDirty||(sa(n.dirtyFields,V),n.isDirty=ee.defaultValue?j(V,ga(kt(a,V))):j()),ee.keepError||(sa(n.errors,V),h.isValid&&x()),m.state.next({...n}))},$e=(V,ee={})=>{const ve=V?ga(V):a,ke=ga(ve),Ce=hs(V),be=Ce?a:ke;if(ee.keepDefaultValues||(a=ve),!ee.keepValues){if(ee.keepDirtyValues){const Ee=new Set([...l.mount,...Object.keys(mm(a,s))]);for(const Ue of Array.from(Ee)){const Qe=kt(n.dirtyFields,Ue),_t=kt(s,Ue),$t=kt(be,Ue);Qe&&!zr(_t)?Nr(be,Ue,_t):!Qe&&!zr($t)&&$(Ue,$t)}}else{if(Fj&&zr(V))for(const Ee of l.mount){const Ue=kt(r,Ee);if(Ue&&Ue._f){const Qe=Array.isArray(Ue._f.refs)?Ue._f.refs[0]:Ue._f.ref;if(u0(Qe)){const _t=Qe.closest("form");if(_t){_t.reset();break}}}}if(ee.keepFieldsRef)for(const Ee of l.mount)$(Ee,kt(be,Ee));else r={}}s=t.shouldUnregister?ee.keepDefaultValues?ga(a):{}:ga(be),m.array.next({values:{...be}}),m.state.next({values:{...be}})}l={mount:ee.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!h.isValid||!!ee.keepIsValid||!!ee.keepDirtyValues||!t.shouldUnregister&&!hs(be),o.watch=!!t.shouldUnregister,o.keepIsValid=!!ee.keepIsValid,o.action=!1,ee.keepErrors||(n.errors={}),m.state.next({submitCount:ee.keepSubmitCount?n.submitCount:0,isDirty:Ce?!1:ee.keepDirty?n.isDirty:!!(ee.keepDefaultValues&&!Cc(V,a)),isSubmitted:ee.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:Ce?{}:ee.keepDirtyValues?ee.keepDefaultValues&&s?mm(a,s):n.dirtyFields:ee.keepDefaultValues&&V?mm(a,V):ee.keepDirty?n.dirtyFields:{},touchedFields:ee.keepTouched?n.touchedFields:{},errors:ee.keepErrors?n.errors:{},isSubmitSuccessful:ee.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:a})},Le=(V,ee)=>$e(co(V)?V(s):V,{...t.resetOptions,...ee}),Xe=(V,ee={})=>{const ve=kt(r,V),ke=ve&&ve._f;if(ke){const Ce=ke.refs?ke.refs[0]:ke.ref;Ce.focus&&setTimeout(()=>{Ce.focus(),ee.shouldSelect&&co(Ce.select)&&Ce.select()})}},Ye=V=>{n={...n,...V}},le={control:{register:Ae,unregister:te,getFieldState:W,handleSubmit:Fe,setError:U,_subscribe:ce,_runSchema:_,_updateIsValidating:y,_focusError:Se,_getWatch:D,_getDirty:j,_setValid:x,_setFieldArray:b,_setDisabledField:Te,_setErrors:w,_getFieldArray:F,_reset:$e,_resetDefaultValues:()=>co(t.defaultValues)&&t.defaultValues().then(V=>{Le(V,t.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:A,_disableForm:we,_subjects:m,_proxyFormState:h,get _fields(){return r},get _formValues(){return s},get _state(){return o},set _state(V){o=V},get _defaultValues(){return a},get _names(){return l},set _names(V){l=V},get _formState(){return n},get _options(){return t},set _options(V){t={...t,...V}}},subscribe:ne,trigger:X,register:Ae,handleSubmit:Fe,watch:K,setValue:$,getValues:G,reset:Le,resetField:Q,clearErrors:O,unregister:te,setError:U,setFocus:Xe,getFieldState:W};return{...le,formControl:le}}function vse(e={}){const t=Ne.useRef(void 0),n=Ne.useRef(void 0),[r,a]=Ne.useState({isDirty:!1,isValidating:!1,isLoading:co(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:co(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:r},e.defaultValues&&!co(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:o,...l}=bse(e);t.current={...l,formState:r}}const s=t.current.control;return s._options=e,rse(()=>{const o=s._subscribe({formState:s._proxyFormState,callback:()=>a({...s._formState}),reRenderRoot:!0});return a(l=>({...l,isReady:!0})),s._formState.isReady=!0,o},[s]),Ne.useEffect(()=>s._disableForm(e.disabled),[s,e.disabled]),Ne.useEffect(()=>{e.mode&&(s._options.mode=e.mode),e.reValidateMode&&(s._options.reValidateMode=e.reValidateMode)},[s,e.mode,e.reValidateMode]),Ne.useEffect(()=>{e.errors&&(s._setErrors(e.errors),s._focusError())},[s,e.errors]),Ne.useEffect(()=>{e.shouldUnregister&&s._subjects.state.next({values:s._getWatch()})},[s,e.shouldUnregister]),Ne.useEffect(()=>{if(s._proxyFormState.isDirty){const o=s._getDirty();o!==r.isDirty&&s._subjects.state.next({isDirty:o})}},[s,r.isDirty]),Ne.useEffect(()=>{var o;e.values&&!Cc(e.values,n.current)?(s._reset(e.values,{keepFieldsRef:!0,...s._options.resetOptions}),!((o=s._options.resetOptions)===null||o===void 0)&&o.keepIsValid||s._setValid(),n.current=e.values,a(l=>({...l}))):s._resetDefaultValues()},[s,e.values]),Ne.useEffect(()=>{s._state.mount||(s._setValid(),s._state.mount=!0),s._state.watch&&(s._state.watch=!1,s._subjects.state.next({...s._formState})),s._removeUnmounted()}),t.current.formState=Ne.useMemo(()=>nse(r,s),[s,r]),t.current}const S$=(e,t,n)=>{if(e&&"reportValidity"in e){const r=kt(n,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},M5=(e,t)=>{for(const n in t.fields){const r=t.fields[n];r&&r.ref&&"reportValidity"in r.ref?S$(r.ref,n,e):r.refs&&r.refs.forEach(a=>S$(a,n,e))}},wse=(e,t)=>{t.shouldUseNativeValidation&&M5(e,t);const n={};for(const r in e){const a=kt(t.fields,r),s=Object.assign(e[r]||{},{ref:a&&a.ref});if(Nse(t.names||Object.keys(e),r)){const o=Object.assign({},kt(n,r));Nr(o,"root",s),Nr(n,r,o)}else Nr(n,r,s)}return n},Nse=(e,t)=>e.some(n=>n.startsWith(t+"."));var kse=function(e,t){for(var n={};e.length;){var r=e[0],a=r.code,s=r.message,o=r.path.join(".");if(!n[o])if("unionErrors"in r){var l=r.unionErrors[0].errors[0];n[o]={message:l.message,type:l.code}}else n[o]={message:s,type:a};if("unionErrors"in r&&r.unionErrors.forEach(function(u){return u.errors.forEach(function(h){return e.push(h)})}),t){var c=n[o].types,d=c&&c[r.code];n[o]=j5(o,t,n,a,d?[].concat(d,r.message):r.message)}e.shift()}return n},Sse=function(e,t,n){return n===void 0&&(n={}),function(r,a,s){try{return Promise.resolve(function(o,l){try{var c=Promise.resolve(e[n.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(d){return s.shouldUseNativeValidation&&M5({},s),{errors:{},values:n.raw?r:d}})}catch(d){return l(d)}return c&&c.then?c.then(void 0,l):c}(0,function(o){if(function(l){return Array.isArray(l==null?void 0:l.errors)}(o))return{values:{},errors:wse(kse(o.errors,!s.shouldUseNativeValidation&&s.criteriaMode==="all"),s)};throw o}))}catch(o){return Promise.reject(o)}}};const Bj="synka_chat_session",Wj="synka_chat_messages",Uj="synka_chat_last_activity",Vj="synka_chat_session_created",hy="synka_chat_goodbye_sent",Sw="synka_chat_show_form",$5="synka_bot_messages",Cse=6e4,C$=12e4,_se=1e4,_$="https://qlrnewbkolxjdtfffuml.supabase.co/functions/v1/saira-chat",zv="https://qlrnewbkolxjdtfffuml.supabase.co/functions/v1/saira-session",jse=Xae({name:Yk().min(1,"Name is required"),email:Yk().email("Invalid email").optional().or(d$("")),mobile:Yk().optional().or(d$(""))}).refine(e=>e.email||e.mobile,{message:"Email or mobile is required",path:["email"]}),Ise=()=>localStorage.getItem(hy)==="true",Tse=e=>e?e.split(" ")[0]:"",j$=()=>{try{const e=localStorage.getItem($5);if(e)return JSON.parse(e)}catch{}return null},Ese=e=>{try{localStorage.setItem($5,JSON.stringify(e))}catch{}},I$=()=>{try{const e=localStorage.getItem(Bj);if(e)return JSON.parse(e)}catch{}return null},Ase=()=>{try{const e=localStorage.getItem(Wj);if(e)return JSON.parse(e).map(n=>({...n,timestamp:new Date(n.timestamp)}))}catch{}return[]},Zk=e=>{try{localStorage.setItem(Bj,JSON.stringify(e))}catch{}},Bv=e=>{try{localStorage.setItem(Wj,JSON.stringify(e))}catch{}},Rse=()=>{try{localStorage.setItem(Uj,Date.now().toString())}catch{}},Qk=()=>{try{const e=localStorage.getItem(Uj);if(e)return parseInt(e,10)}catch{}return Date.now()},Jk=()=>{try{return localStorage.getItem(Vj)==="true"}catch{return!1}},Dse=()=>{try{localStorage.setItem(Vj,"true")}catch{}},Hj="synka_chat_session_ended",eS=()=>{try{localStorage.removeItem(Bj),localStorage.removeItem(Wj),localStorage.removeItem(Uj),localStorage.removeItem(Vj),localStorage.removeItem(hy),localStorage.removeItem(Hj),localStorage.removeItem(Sw)}catch{}},T$=()=>{try{localStorage.setItem(Hj,"true")}catch{}},E$=()=>{try{return localStorage.getItem(Hj)==="true"}catch{return!1}};function F5(){var ve;const[e,t]=N.useState(!1),[n,r]=N.useState([]),[a,s]=N.useState(""),[o,l]=N.useState(!1),[c,d]=N.useState(!1),[u,h]=N.useState(()=>E$()),[p,m]=N.useState(!1),[f,g]=N.useState(!1),[x,y]=N.useState(!1),[b,v]=N.useState(!1),[w,k]=N.useState(()=>j$()!==null),C=N.useRef(j$()),[S,_]=N.useState(()=>{const ke=I$();return ke||{sessionId:crypto.randomUUID(),userInfo:{name:"",email:"",mobile:"",isExistingUser:!1},detailsCaptured:!1}});N.useEffect(()=>{(async()=>{try{const be=await(await fetch(zv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"get_messages"})})).json();be.success&&be.messages?(C.current=be.messages,Ese(be.messages),k(!0)):console.error("Failed to load bot messages from backend")}catch(Ce){console.error("Failed to fetch bot messages:",Ce)}})()},[]);const{register:I,handleSubmit:T,formState:{errors:A},reset:j,setValue:D}=vse({resolver:Sse(jse),defaultValues:{name:"",email:"",mobile:""}}),F=N.useRef(Qk()),B=N.useRef(!1),q=N.useRef(null),$=N.useRef(null),L=N.useRef(!1),M=N.useRef(!1),X=N.useRef(Jk()),G=N.useRef(null),W=N.useRef(null),O=N.useRef(null),U=async(ke,Ce)=>{if(X.current)return{isExistingUser:Ce.isExistingUser};try{const Ee=await(await fetch(zv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",sessionId:ke.sessionId,userInfo:{name:Ce.name,email:Ce.email,mobile:Ce.mobile}})})).json();return Ee.success?(X.current=!0,Dse(),{isExistingUser:Ee.isExistingUser,existingUserName:Ee.existingUserName,greetingMessage:Ee.greetingMessage}):(console.error("Session create error:",Ee.error),{isExistingUser:!1})}catch(be){return console.error("Error creating session:",be),{isExistingUser:!1}}},K=async(ke,Ce)=>{try{await fetch(zv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"end",sessionId:ke,reason:Ce}),keepalive:!0})}catch(be){console.error("Error ending session:",be)}},ce=async(ke,Ce,be)=>{if(X.current)try{await ue.from("chat_messages").insert({session_id:ke,role:Ce,content:be})}catch(Ee){console.error("Error saving message:",Ee)}},ne=N.useCallback(()=>{q.current&&(clearInterval(q.current),q.current=null)},[]),te=N.useCallback(()=>{$.current&&(clearInterval($.current),$.current=null)},[]),Te=N.useCallback(async()=>{if(!(L.current||!S.detailsCaptured||!X.current))try{const Ce=await(await fetch(_$,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk"},body:JSON.stringify({action:"idle_check",sessionId:S.sessionId})})).json();if(Ce.send&&Ce.message){console.log(`Received delayed follow-up for intent: ${Ce.intent}`);const be={id:crypto.randomUUID(),role:"assistant",content:Ce.message,timestamp:new Date};r(Ee=>[...Ee,be]),await ce(S.sessionId,"assistant",Ce.message)}}catch(ke){console.error("Idle check error:",ke)}},[S.sessionId,S.detailsCaptured]),Ae=N.useCallback(()=>{te(),$.current=setInterval(Te,_se)},[Te,te]),Se=N.useCallback(async(ke,Ce,be=!0)=>{if(!L.current){if(L.current=!0,ne(),te(),be&&!M.current&&!Ise()){M.current=!0,localStorage.setItem(hy,"true");try{const Qe=(await(await fetch(zv,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"end",sessionId:Ce.sessionId,userInfo:Ce.userInfo,reason:ke})})).json()).goodbyeMessage;if(Qe||console.error("Backend did not return goodbye message"),Qe){const _t={id:crypto.randomUUID(),role:"assistant",content:Qe,timestamp:new Date};r($t=>[...$t,_t]),await ce(Ce.sessionId,"assistant",Qe)}}catch(Ee){console.error("Error ending session:",Ee)}}else await K(Ce.sessionId,ke);h(!0),T$()}},[ne,te]),we=N.useCallback(()=>{var Ce;eS(),L.current=!1,M.current=!1,B.current=!1,X.current=!1,j();const ke={sessionId:crypto.randomUUID(),userInfo:{name:"",email:"",mobile:"",isExistingUser:!1},detailsCaptured:!1};_(ke),h(!1),g(!1),y(!1),v(!1),(Ce=C.current)!=null&&Ce.welcome?r([{id:crypto.randomUUID(),role:"assistant",content:C.current.welcome,timestamp:new Date}]):r([])},[j]),Fe=N.useCallback(()=>{var ke;if(!((ke=C.current)!=null&&ke.form_intro)){console.error("Bot messages not loaded");return}g(!0),localStorage.setItem(Sw,"true"),r(Ce=>[...Ce,{id:crypto.randomUUID(),role:"assistant",content:C.current.form_intro,timestamp:new Date}])},[]),Q=N.useCallback(async ke=>{var Ee;if(B.current||L.current||M.current)return;if(!((Ee=C.current)!=null&&Ee.warning)){console.error("Warning message not loaded from backend");return}B.current=!0;const Ce=C.current.warning,be={id:crypto.randomUUID(),role:"assistant",content:Ce,timestamp:new Date};r(Ue=>[...Ue,be]),await ce(ke.sessionId,"assistant",Ce)},[]),$e=N.useCallback(async()=>{if(L.current||!S.detailsCaptured||!x)return;const Ce=Date.now()-F.current,be={...S};if(Ce>=C$){await Se("No response after warning",be);return}Ce>=Cse&&!B.current&&Q(be)},[S,Se,Q,x]);N.useEffect(()=>{if(!S.detailsCaptured||L.current){ne(),te();return}const ke=Qk();if(Date.now()-ke>=C$){const be={...S};(async()=>await Se("Session timeout while inactive",be))();return}return ne(),q.current=setInterval($e,5e3),Ae(),()=>{ne(),te()}},[S,$e,Se,ne,te,Ae]),N.useEffect(()=>{const ke=()=>{S.sessionId&&(Zk(S),n.length>0&&Bv(n))};return window.addEventListener("beforeunload",ke),()=>window.removeEventListener("beforeunload",ke)},[S,n]),N.useEffect(()=>{(async()=>{var _t,$t;if(c)return;if(d(!0),E$()){eS(),L.current=!1,h(!1),g(!1),y(!1),v(!1),(_t=C.current)!=null&&_t.welcome&&r([{id:crypto.randomUUID(),role:"assistant",content:C.current.welcome,timestamp:new Date}]);return}const be=I$(),Ee=Ase(),Ue=localStorage.getItem(hy)==="true",Qe=localStorage.getItem(Sw)==="true";if(M.current=Ue,be&&(_(be),X.current=Jk(),L.current=!1,be.detailsCaptured||(g(Qe),be.userInfo&&(D("name",be.userInfo.name||""),D("email",be.userInfo.email||""),D("mobile",be.userInfo.mobile||"")))),Ee.length>0){r(Ee),Ee.some(tt=>tt.role==="user")&&(F.current=Qk(),y(!0));return}if(be!=null&&be.sessionId&&Jk()){const{data:Ve}=await ue.from("chat_messages").select("*").eq("session_id",be.sessionId).order("created_at",{ascending:!0});if(Ve&&Ve.length>0){const tt=Ve.map(ut=>({id:ut.id,role:ut.role,content:ut.content,timestamp:new Date(ut.created_at)}));r(tt),Bv(tt),tt.some(ut=>ut.role==="user")&&y(!0);return}}($t=C.current)!=null&&$t.welcome&&r([{id:crypto.randomUUID(),role:"assistant",content:C.current.welcome,timestamp:new Date}])})()},[c,D]),N.useEffect(()=>{e&&Zk(S)},[e,S]),N.useEffect(()=>{W.current&&W.current.scrollIntoView({behavior:"smooth"}),n.length>0&&Bv(n)},[n]),N.useEffect(()=>{e&&O.current&&S.detailsCaptured&&!u&&setTimeout(()=>{var ke;return(ke=O.current)==null?void 0:ke.focus()},100)},[e,S.detailsCaptured,u]);const Le=async(ke,Ce,be,Ee)=>{var lt,wt,Nt,Kt;const Ue=n.filter(jt=>jt.role!=="assistant"||!jt.content.includes("I'm Saira")).concat({id:"",role:"user",content:ke,timestamp:new Date}).map(jt=>({role:jt.role,content:jt.content})),Qe=await fetch(_$,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFscm5ld2Jrb2x4amR0ZmZmdW1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNjAzMDMsImV4cCI6MjA4MDkzNjMwM30.3oTFUgh8RdxzRu69FHPd5bjzYSwbQhGesdi6ynopQMk"},body:JSON.stringify({messages:Ue,sessionId:be,awaitingClosureConfirmation:Ee,userInfo:{...Ce,firstName:Tse(Ce.name)}})});if(!Qe.ok||!Qe.body){const jt=await Qe.json().catch(()=>({}));throw new Error(jt.error||"Failed to get response")}if((Qe.headers.get("content-type")||"").includes("application/json")){const jt=await Qe.json();return{content:jt.reply||"",sessionEnded:jt.sessionEnded||!1}}const $t=Qe.body.getReader(),Ve=new TextDecoder;let tt="",yt="",ut;const qt="streaming-"+crypto.randomUUID();for(G.current=qt,r(jt=>[...jt,{id:qt,role:"assistant",content:"",timestamp:new Date}]);;){const{done:jt,value:Zt}=await $t.read();if(jt)break;yt+=Ve.decode(Zt,{stream:!0});let An;for(;(An=yt.indexOf(`
`))!==-1;){let it=yt.slice(0,An);if(yt=yt.slice(An+1),it.endsWith("\r")&&(it=it.slice(0,-1)),it.trim()===""||!it.startsWith("data: "))continue;const ge=it.slice(6).trim();if(ge==="[DONE]")break;try{const De=JSON.parse(ge);if((lt=De.synka_meta)!=null&&lt.followUp){ut=De.synka_meta.followUp;continue}const Ke=(Kt=(Nt=(wt=De.choices)==null?void 0:wt[0])==null?void 0:Nt.delta)==null?void 0:Kt.content;Ke&&(tt+=Ke,r(ze=>ze.map(Bt=>Bt.id===qt?{...Bt,content:tt}:Bt)))}catch{yt=it+`
`+yt;break}}}const an=crypto.randomUUID();return r(jt=>jt.map(Zt=>Zt.id===qt?{...Zt,id:an}:Zt)),G.current=null,{content:tt,followUp:ut}},Xe=N.useCallback(async()=>{var Qe;if(!a.trim()||o||!S.detailsCaptured)return;if(L.current){we();return}const ke=a.trim();s(""),l(!0);const Ce=b;v(!1);const be={...S},Ee=be.sessionId,Ue={id:crypto.randomUUID(),role:"user",content:ke,timestamp:new Date};r(_t=>[..._t,Ue]),F.current=Date.now(),Rse(),B.current=!1,y(!0),await ce(Ee,"user",ke);try{const _t=await Le(ke,be.userInfo,Ee,Ce);if(_t.sessionEnded){if(_t.content){const $t={id:crypto.randomUUID(),role:"assistant",content:_t.content,timestamp:new Date};r(Ve=>[...Ve,$t]),await ce(Ee,"assistant",_t.content)}L.current=!0,M.current=!0,localStorage.setItem(hy,"true"),h(!0),T$(),ne(),l(!1);return}if(_t.followUp){v(!0);const $t={id:crypto.randomUUID(),role:"assistant",content:_t.followUp,timestamp:new Date};r(Ve=>[...Ve,$t]),await ce(Ee,"assistant",_t.followUp)}_t.content&&await ce(Ee,"assistant",_t.content)}catch(_t){console.error("Chat error:",_t);const $t=(Qe=C.current)==null?void 0:Qe.error;if($t){const Ve={id:crypto.randomUUID(),role:"assistant",content:$t,timestamp:new Date};r(tt=>[...tt,Ve]),await ce(Ee,"assistant",$t)}v(!1)}finally{l(!1)}},[a,o,n,S,we,b,ne]),Ye=async ke=>{m(!0);const Ce={...S};try{const be={name:ke.name,email:ke.email||"",mobile:ke.mobile||"",isExistingUser:!1},Ee=await U(Ce,be);be.isExistingUser=Ee.isExistingUser,Ee.existingUserName&&!be.name&&(be.name=Ee.existingUserName);const Ue={...Ce,userInfo:be,detailsCaptured:!0};_(Ue),Zk(Ue),g(!1),localStorage.removeItem(Sw),v(!1);const Qe=Ee.greetingMessage;if(Qe||console.error("Backend did not return greeting message"),Qe){const _t={id:crypto.randomUUID(),role:"assistant",content:Qe,timestamp:new Date};r([_t]),Bv([_t]),await ce(Ce.sessionId,"assistant",Qe)}}catch(be){console.error("Error in form submission:",be)}finally{m(!1)}},Je=ke=>{ke.key==="Enter"&&!ke.shiftKey&&S.detailsCaptured&&(ke.preventDefault(),Xe())},le=N.useCallback(()=>{t(!1),u&&setTimeout(()=>{eS(),we()},300)},[u,we]),V=f&&!S.detailsCaptured&&!u,ee=!f&&!S.detailsCaptured&&!u&&w;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:Ie("fixed right-6 z-50 flex flex-col items-center gap-2 bottom-[calc(1.5rem+env(safe-area-inset-bottom))]","transition-all duration-300 ease-out",e&&"scale-0 opacity-0 pointer-events-none"),children:[i.jsx("button",{onClick:()=>t(!e),className:Ie("w-14 h-14 rounded-full","bg-primary shadow-lg overflow-hidden","flex items-center justify-center","transition-all duration-300 ease-out","hover:scale-110 hover:shadow-xl"),"aria-label":"Open chat",children:i.jsx("img",{src:"/images/ai/ai-assistant-for-nfc-digital-business-cards.jpg",alt:"AI assistant for NFC digital business cards helping users share contact details",className:"w-full h-full object-cover"})}),i.jsx("div",{className:Ie("bg-background border border-border rounded-full px-3 py-1.5 shadow-lg","animate-[bounce_2s_ease-in-out_infinite]"),children:i.jsx("span",{className:"text-xs font-medium text-foreground whitespace-nowrap",children:"Hi  I'm here to help"})})]}),i.jsxs("div",{className:Ie("fixed right-6 z-50 bottom-[calc(1.5rem+env(safe-area-inset-bottom))]","w-[380px] max-w-[calc(100vw-48px)] h-[600px] max-h-[calc(100vh-100px)]","bg-background border border-border rounded-2xl shadow-2xl","flex flex-col overflow-hidden","transition-all duration-300 ease-out origin-bottom-right",e?"scale-100 opacity-100":"scale-0 opacity-0 pointer-events-none"),children:[i.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border bg-primary/5",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden",children:i.jsx("img",{src:"/images/ai/ai-assistant-for-nfc-digital-business-cards.jpg",alt:"AI assistant for NFC digital business cards helping users share contact details",className:"w-full h-full object-cover"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-foreground",children:"Saira"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Synka AI Assistant"})]})]}),i.jsx("button",{onClick:le,className:"p-2 rounded-full hover:bg-muted transition-colors","aria-label":"Close chat",children:i.jsx(ui,{className:"w-5 h-5 text-muted-foreground"})})]}),i.jsx(Mj,{className:"flex-1 p-4",children:i.jsxs("div",{className:"space-y-4",children:[!w&&n.length===0&&i.jsx("div",{className:"flex justify-center py-8",children:i.jsx(Gt,{className:"w-6 h-6 animate-spin text-muted-foreground"})}),n.map(ke=>i.jsx("div",{className:Ie("flex",ke.role==="user"?"justify-end":"justify-start"),children:i.jsx("div",{className:Ie("max-w-[85%] rounded-2xl px-4 py-2.5",ke.role==="user"?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md"),children:i.jsx("p",{className:"text-sm whitespace-pre-wrap",children:ke.content})})},ke.id)),V&&i.jsx("div",{className:"flex justify-start",children:i.jsx("div",{className:"max-w-[85%] bg-muted rounded-2xl rounded-bl-md p-4",children:i.jsxs("form",{onSubmit:T(Ye),className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Name *"}),i.jsxs("div",{className:"relative",children:[i.jsx(Ad,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx("input",{...I("name"),inputMode:"text",className:"w-full pl-10 pr-3 py-3 text-base bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Your name",disabled:p,style:{fontSize:"16px"}})]}),A.name&&i.jsx("p",{className:"text-xs text-red-500 mt-1",children:A.name.message})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Email"}),i.jsxs("div",{className:"relative",children:[i.jsx(Di,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx("input",{...I("email"),type:"email",inputMode:"email",className:"w-full pl-10 pr-3 py-3 text-base bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"your@email.com",disabled:p,style:{fontSize:"16px"}})]}),A.email&&i.jsx("p",{className:"text-xs text-red-500 mt-1",children:A.email.message})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:"Mobile"}),i.jsxs("div",{className:"relative",children:[i.jsx(ky,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx("input",{...I("mobile"),type:"tel",inputMode:"tel",className:"w-full pl-10 pr-3 py-3 text-base bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Mobile number",disabled:p,style:{fontSize:"16px"}})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"* Email or Mobile required"})]}),i.jsx(de,{type:"submit",disabled:p,className:"w-full rounded-full mt-2",children:p?i.jsx(Gt,{className:"w-4 h-4 animate-spin"}):"Start Chat"})]})})}),o&&!G.current&&((ve=n[n.length-1])==null?void 0:ve.role)==="user"&&i.jsx("div",{className:"flex justify-start",children:i.jsx("div",{className:"bg-muted rounded-2xl rounded-bl-md px-4 py-3",children:i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),i.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),i.jsx("span",{className:"w-2 h-2 bg-muted-foreground/50 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),i.jsx("div",{ref:W})]})}),i.jsx("div",{className:"p-4 border-t border-border",children:u?i.jsxs(de,{onClick:we,className:"w-full rounded-full gap-2",children:[i.jsx(Ww,{className:"w-4 h-4"}),"Start New Chat"]}):ee?i.jsx(de,{onClick:Fe,className:"w-full rounded-full",children:"Start Chat"}):V?i.jsx("div",{className:"text-center text-sm text-muted-foreground py-2",children:"Please complete the form above to start chatting"}):w?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(At,{ref:O,value:a,onChange:ke=>s(ke.target.value),onKeyDown:Je,placeholder:"Type your message...",disabled:o,className:"flex-1 rounded-full"}),i.jsx(de,{onClick:Xe,disabled:!a.trim()||o,size:"icon",className:"rounded-full shrink-0",children:o?i.jsx(Gt,{className:"w-4 h-4 animate-spin"}):i.jsx(kO,{className:"w-4 h-4"})})]}):i.jsx("div",{className:"flex justify-center py-2",children:i.jsx(Gt,{className:"w-5 h-5 animate-spin text-muted-foreground"})})})]})]})}const Mse=["1-tap digital business card exchange (NFC + QR)","Automatic lead capture","Smart follow-ups & reminders","Real-time analytics"],$se=["Built-in CRM for contacts & notes","Team & employee card tracking","Founder & manager dashboards","AI-designed digital cards & templates"];function Fse({onBiometricLogin:e,biometricInfo:t,isBiometricLoading:n}){const r=Pa(),a=N.useRef(null),[s,o]=N.useState(0);N.useEffect(()=>{const d=setInterval(()=>{o(u=>u===0?1:0)},3e3);return()=>clearInterval(d)},[]);const l=d=>{Zn.light(),r(d)},c=s===0?Mse:$se;return i.jsxs("div",{ref:a,className:"relative min-h-dvh w-full flex flex-col bg-background",children:[i.jsx("div",{className:"absolute inset-0 -z-10 bg-center bg-cover opacity-[0.05] blur-2xl scale-110",style:{backgroundImage:"url('/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg')"}}),i.jsx("div",{className:"absolute inset-0 -z-10 bg-gradient-to-b from-background via-background/90 to-background"}),i.jsxs("header",{className:"flex items-center justify-between px-4 py-3 pt-[calc(0.75rem+env(safe-area-inset-top))]",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("img",{src:"/logos/synka-logo.png",alt:"Synka",className:"w-8 h-8 object-contain"}),i.jsxs("span",{className:"text-lg font-anta font-bold tracking-tight gradient-text",children:["SYNKA",i.jsx("sup",{className:"text-[0.5em] ml-0.5 opacity-70",children:""})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>l("/login"),className:"text-sm px-3",children:"Login"}),i.jsx(de,{size:"sm",onClick:()=>l("/signup"),className:"text-sm px-4 rounded-full bg-primary text-primary-foreground",children:"Sign up"})]})]}),i.jsxs("main",{className:"px-4 text-center pt-4",children:[i.jsx("div",{className:"inline-flex items-center px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium mb-4",children:"SYNKA  Simply Connected"}),i.jsxs("h1",{className:"text-[1.6rem] font-bold leading-tight tracking-tight",children:["Indias most powerful"," ",i.jsx("span",{className:"gradient-text",children:"digital business card"})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-3 max-w-[22rem] mx-auto",children:"Smart NFC & QR business cards that share instantly and capture leads. AI-designed cards with built-in CRM and real-time analytics."}),i.jsx("div",{className:"relative mt-6 h-[110px] sm:h-[96px] overflow-hidden",children:i.jsx(Gk.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.4},className:"grid grid-cols-1 gap-3 text-left max-w-sm mx-auto",children:c.map(d=>i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-primary mt-1 flex-shrink-0"}),i.jsx("span",{className:"text-sm text-muted-foreground",children:d})]},d))},s)}),i.jsxs(de,{size:"lg",onClick:()=>l("/signup"),className:"w-full mt-6 py-5 text-base rounded-full bg-primary text-primary-foreground shadow-lg active:scale-[0.98] transition-transform",children:["Create your free card",i.jsx(ni,{className:"h-5 w-5 ml-2"})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Free forever digital business card  Lifetime free NFC card on Orange plan"})]}),i.jsx(Gk.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.45,delay:.25},className:"mt-3",children:i.jsx(uae,{})}),i.jsx(Gk.div,{initial:{opacity:0,y:16},animate:{opacity:1,y:0},transition:{duration:.4,delay:.35},className:"px-4 py-6",children:i.jsxs("button",{onClick:()=>l("/order-nfc-card"),className:"w-full overflow-hidden rounded-2xl shadow-lg active:scale-[0.98] transition-transform",children:[i.jsx("img",{src:"/images/card/metal-nfc-business-cards.webp",alt:"Order premium metal NFC business cards",className:"w-full h-auto object-cover"}),i.jsx("div",{className:"bg-gradient-to-r from-primary to-primary/80 py-3 px-4 text-center",children:i.jsx("span",{className:"text-primary-foreground font-semibold text-sm",children:"Order NFC Card "})})]})}),i.jsxs("div",{className:"flex flex-col items-center gap-4 px-4 pb-[calc(1.5rem+env(safe-area-inset-bottom))]",children:[i.jsxs("div",{className:"flex justify-center gap-6",children:[i.jsx("button",{onClick:()=>l("/support"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Support"}),i.jsx("button",{onClick:()=>l("/privacy"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Privacy"}),i.jsx("button",{onClick:()=>l("/terms"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Terms"}),i.jsx("button",{onClick:()=>l("/contact"),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Contact"})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[" ",new Date().getFullYear()," Synka. All rights reserved."]})]}),i.jsx(F5,{})]})}/*! Capacitor: https://capacitorjs.com/ - MIT License */const Pse=e=>{const t=new Map;t.set("web",{name:"web"});const n=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},r=(s,o)=>{n.platforms.set(s,o)},a=s=>{n.platforms.has(s)&&(n.currentPlatform=n.platforms.get(s))};return n.addPlatform=r,n.setPlatform=a,n},Ose=e=>e.CapacitorPlatforms=Pse(e),P5=Ose(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});P5.addPlatform;P5.setPlatform;var of;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(of||(of={}));class tS extends Error{constructor(t,n){super(t),this.message=t,this.code=n}}const Lse=e=>{var t,n;return e!=null&&e.androidBridge?"android":!((n=(t=e==null?void 0:e.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},zse=e=>{var t,n,r,a,s;const o=e.CapacitorCustomPlatform||null,l=e.Capacitor||{},c=l.Plugins=l.Plugins||{},d=e.CapacitorPlatforms,u=()=>o!==null?o.name:Lse(e),h=((t=d==null?void 0:d.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||u,p=()=>h()!=="web",m=((n=d==null?void 0:d.currentPlatform)===null||n===void 0?void 0:n.isNativePlatform)||p,f=S=>{const _=w.get(S);return!!(_!=null&&_.platforms.has(h())||y(S))},g=((r=d==null?void 0:d.currentPlatform)===null||r===void 0?void 0:r.isPluginAvailable)||f,x=S=>{var _;return(_=l.PluginHeaders)===null||_===void 0?void 0:_.find(I=>I.name===S)},y=((a=d==null?void 0:d.currentPlatform)===null||a===void 0?void 0:a.getPluginHeader)||x,b=S=>e.console.error(S),v=(S,_,I)=>Promise.reject(`${I} does not have an implementation of "${_}".`),w=new Map,k=(S,_={})=>{const I=w.get(S);if(I)return console.warn(`Capacitor plugin "${S}" already registered. Cannot register plugins twice.`),I.proxy;const T=h(),A=y(S);let j;const D=async()=>(!j&&T in _?j=typeof _[T]=="function"?j=await _[T]():j=_[T]:o!==null&&!j&&"web"in _&&(j=typeof _.web=="function"?j=await _.web():j=_.web),j),F=(X,G)=>{var W,O;if(A){const U=A==null?void 0:A.methods.find(K=>G===K.name);if(U)return U.rtype==="promise"?K=>l.nativePromise(S,G.toString(),K):(K,ce)=>l.nativeCallback(S,G.toString(),K,ce);if(X)return(W=X[G])===null||W===void 0?void 0:W.bind(X)}else{if(X)return(O=X[G])===null||O===void 0?void 0:O.bind(X);throw new tS(`"${S}" plugin is not implemented on ${T}`,of.Unimplemented)}},B=X=>{let G;const W=(...O)=>{const U=D().then(K=>{const ce=F(K,X);if(ce){const ne=ce(...O);return G=ne==null?void 0:ne.remove,ne}else throw new tS(`"${S}.${X}()" is not implemented on ${T}`,of.Unimplemented)});return X==="addListener"&&(U.remove=async()=>G()),U};return W.toString=()=>`${X.toString()}() { [capacitor code] }`,Object.defineProperty(W,"name",{value:X,writable:!1,configurable:!1}),W},q=B("addListener"),$=B("removeListener"),L=(X,G)=>{const W=q({eventName:X},G),O=async()=>{const K=await W;$({eventName:X,callbackId:K},G)},U=new Promise(K=>W.then(()=>K({remove:O})));return U.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await O()},U},M=new Proxy({},{get(X,G){switch(G){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return A?L:q;case"removeListener":return $;default:return B(G)}}});return c[S]=M,w.set(S,{name:S,proxy:M,platforms:new Set([...Object.keys(_),...A?[T]:[]])}),M},C=((s=d==null?void 0:d.currentPlatform)===null||s===void 0?void 0:s.registerPlugin)||k;return l.convertFileSrc||(l.convertFileSrc=S=>S),l.getPlatform=h,l.handleError=b,l.isNativePlatform=m,l.isPluginAvailable=g,l.pluginMethodNoop=v,l.registerPlugin=C,l.Exception=tS,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},Bse=e=>e.Capacitor=zse(e),h0=Bse(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Wse=h0.registerPlugin;h0.Plugins;class BYe{constructor(t){this.listeners={},this.windowListeners={},t&&(console.warn(`Capacitor WebPlugin "${t.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=t)}addListener(t,n){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(n);const a=this.windowListeners[t];a&&!a.registered&&this.addWindowListener(a);const s=async()=>this.removeListener(t,n),o=Promise.resolve({remove:s});return Object.defineProperty(o,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await s()}}),o}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n){const r=this.listeners[t];r&&r.forEach(a=>a(n))}hasListeners(t){return!!this.listeners[t].length}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:r=>{this.notifyListeners(n,r)}}}unimplemented(t="not implemented"){return new h0.Exception(t,of.Unimplemented)}unavailable(t="not available"){return new h0.Exception(t,of.Unavailable)}async removeListener(t,n){const r=this.listeners[t];if(!r)return;const a=r.indexOf(n);this.listeners[t].splice(a,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}}var wc;(function(e){e[e.NONE=0]="NONE",e[e.TOUCH_ID=1]="TOUCH_ID",e[e.FACE_ID=2]="FACE_ID",e[e.FINGERPRINT=3]="FINGERPRINT",e[e.FACE_AUTHENTICATION=4]="FACE_AUTHENTICATION",e[e.IRIS_AUTHENTICATION=5]="IRIS_AUTHENTICATION",e[e.MULTIPLE=6]="MULTIPLE"})(wc||(wc={}));var A$;(function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BIOMETRICS_UNAVAILABLE=1]="BIOMETRICS_UNAVAILABLE",e[e.USER_LOCKOUT=2]="USER_LOCKOUT",e[e.BIOMETRICS_NOT_ENROLLED=3]="BIOMETRICS_NOT_ENROLLED",e[e.USER_TEMPORARY_LOCKOUT=4]="USER_TEMPORARY_LOCKOUT",e[e.AUTHENTICATION_FAILED=10]="AUTHENTICATION_FAILED",e[e.APP_CANCEL=11]="APP_CANCEL",e[e.INVALID_CONTEXT=12]="INVALID_CONTEXT",e[e.NOT_INTERACTIVE=13]="NOT_INTERACTIVE",e[e.PASSCODE_NOT_SET=14]="PASSCODE_NOT_SET",e[e.SYSTEM_CANCEL=15]="SYSTEM_CANCEL",e[e.USER_CANCEL=16]="USER_CANCEL",e[e.USER_FALLBACK=17]="USER_FALLBACK"})(A$||(A$={}));const lf=Wse("NativeBiometric",{web:()=>bo(()=>import("./web-DGDHb2zM.js"),__vite__mapDeps([4,1,2,3])).then(e=>new e.NativeBiometricWeb)}),iC="com.synka.app",O5="synka_biometric_credentials_stored";function Use(){try{return localStorage.getItem(O5)==="true"}catch{return!1}}function p0(e){try{localStorage.setItem(O5,e?"true":"false")}catch{}}async function Em(){if(!Xt.isNativePlatform())return{available:!1,biometryType:"none",hasCredentials:!1};try{const e=await lf.isAvailable();let t="none";switch(e.biometryType){case wc.FINGERPRINT:case wc.TOUCH_ID:t="fingerprint";break;case wc.FACE_ID:case wc.FACE_AUTHENTICATION:t="face";break;case wc.IRIS_AUTHENTICATION:t="iris";break;case wc.MULTIPLE:t="multiple";break;default:t="none"}const n=e.isAvailable?Use():!1;return{available:e.isAvailable,biometryType:t,hasCredentials:n}}catch(e){return console.error("Biometric availability check failed:",e),{available:!1,biometryType:"none",hasCredentials:!1}}}async function m0(e,t){if(!Xt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{try{await lf.deleteCredentials({server:iC})}catch{}return await lf.setCredentials({username:e,password:t,server:iC}),p0(!0),{success:!0}}catch(n){return p0(!1),console.error("Failed to store biometric credentials:",n),{success:!1,error:(n==null?void 0:n.message)||"Failed to store credentials"}}}function L5(e){const t=String((e==null?void 0:e.message)||e||"").toLowerCase(),n=String((e==null?void 0:e.code)||"").toLowerCase();return n.includes("cancel")||t.includes("cancel")||n.includes("user_cancel")||t.includes("user cancel")?{success:!1,error:"cancelled"}:n.includes("lock")||t.includes("lock")||n.includes("too many")||t.includes("too many")?{success:!1,error:"lockout"}:n.includes("fail")||t.includes("fail")||n.includes("not recognized")||t.includes("not recognized")?{success:!1,error:"authentication_failed"}:n.includes("not_available")||t.includes("not available")||n.includes("no biometric")?{success:!1,error:"not_available"}:{success:!1,error:"authentication_failed"}}async function z5(){if(!Xt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{await lf.verifyIdentity({reason:"Continue in Synka",title:"Access Synka",subtitle:"Use biometrics to continue",description:"Confirm your identity to access your account",useFallback:!0});const e=await lf.getCredentials({server:iC});return e!=null&&e.username&&(e!=null&&e.password)?{success:!0,email:e.username,userId:e.password}:(p0(!1),{success:!1,error:"no_credentials"})}catch(e){console.error("Biometric authentication failed:",e);const t=L5(e);return(t.error==="authentication_failed"||t.error==="not_available")&&p0(!1),{success:!1,error:t.error}}}async function Vse(){if(!Xt.isNativePlatform())return{success:!1,error:"Not on native platform"};try{return await lf.verifyIdentity({reason:"Verify your identity",title:"Biometric Verification",subtitle:"Use biometrics to verify",description:"Confirm your identity",useFallback:!0}),{success:!0}}catch(e){return console.error("Biometric verification failed:",e),L5(e)}}function f0(e){switch(e){case"fingerprint":return"Fingerprint";case"face":return"Face ID";case"iris":return"Iris";case"multiple":return"Biometric";default:return"Biometric"}}function B5({open:e,onOpenChange:t,onEnable:n,onSkip:r,biometricInfo:a}){const s=(a==null?void 0:a.biometryType)==="face",o=a?f0(a.biometryType):"Biometric";return i.jsx(Jm,{open:e,onOpenChange:t,children:i.jsxs(Wd,{className:"max-w-sm mx-4",children:[i.jsxs(Ud,{className:"items-center text-center",children:[i.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mb-2",children:s?i.jsx(NO,{className:"w-8 h-8 text-primary"}):i.jsx(zw,{className:"w-8 h-8 text-primary"})}),i.jsx(Hd,{className:"text-xl",children:"Enable biometric login?"}),i.jsxs(Gd,{className:"text-center",children:["Log in faster using ",o.toLowerCase()==="biometric"?"fingerprint or Face ID":o,"."]})]}),i.jsxs(Vd,{className:"flex-col gap-2 sm:flex-col",children:[i.jsx(qd,{onClick:n,className:"w-full py-5 text-base rounded-full",children:"Enable"}),i.jsx(Kd,{onClick:r,className:"w-full py-5 text-base rounded-full border-0 bg-transparent hover:bg-muted",children:"Not now"})]})]})})}function nr({className:e,...t}){return i.jsx("div",{className:Ie("animate-pulse rounded-md bg-muted",e),...t})}function Hse({variant:e="dashboard",className:t}){return e==="card"?i.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-6 animate-fade-in",t),children:[i.jsx(nr,{className:"w-full aspect-[3/2] rounded-2xl"}),i.jsxs("div",{className:"space-y-2 px-2",children:[i.jsx(nr,{className:"h-7 w-48"}),i.jsx(nr,{className:"h-4 w-32"})]}),i.jsx("div",{className:"space-y-1",children:[1,2,3,4].map(n=>i.jsxs("div",{className:"flex items-center gap-4 px-4 py-3",children:[i.jsx(nr,{className:"w-10 h-10 rounded-full"}),i.jsx(nr,{className:"h-4 flex-1"})]},n))}),i.jsx(nr,{className:"h-12 w-full rounded-xl"})]}):e==="crm"?i.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-4 animate-fade-in",t),children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(nr,{className:"h-8 w-24"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(nr,{className:"h-10 w-10 rounded-full"}),i.jsx(nr,{className:"h-10 w-10 rounded-full"})]})]}),i.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[1,2,3,4].map(n=>i.jsx(nr,{className:"h-8 w-20 rounded-full shrink-0"},n))}),i.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(n=>i.jsx("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(nr,{className:"w-12 h-12 rounded-full"}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx(nr,{className:"h-4 w-32"}),i.jsx(nr,{className:"h-3 w-24"})]}),i.jsx(nr,{className:"h-8 w-8 rounded-lg"})]})},n))})]}):e==="settings"?i.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-4 animate-fade-in",t),children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(nr,{className:"h-8 w-28"}),i.jsx(nr,{className:"h-4 w-48"})]}),i.jsx("div",{className:"p-6 rounded-2xl bg-card border border-border/50",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(nr,{className:"w-16 h-16 rounded-2xl"}),i.jsxs("div",{className:"flex-1 space-y-2",children:[i.jsx(nr,{className:"h-5 w-32"}),i.jsx(nr,{className:"h-4 w-24"})]})]})}),i.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(n=>i.jsxs("div",{className:"p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4",children:[i.jsx(nr,{className:"w-10 h-10 rounded-xl"}),i.jsxs("div",{className:"flex-1 space-y-1",children:[i.jsx(nr,{className:"h-4 w-24"}),i.jsx(nr,{className:"h-3 w-32"})]})]},n))})]}):i.jsxs("div",{className:Ie("w-full py-4 px-3 space-y-6 animate-fade-in",t),children:[i.jsx("div",{className:"grid grid-cols-2 gap-3",children:[1,2,3,4].map(n=>i.jsxs("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:[i.jsx(nr,{className:"h-4 w-20 mb-2"}),i.jsx(nr,{className:"h-8 w-16"})]},n))}),i.jsxs("div",{className:"p-4 rounded-xl bg-card border border-border/50",children:[i.jsx(nr,{className:"h-4 w-24 mb-4"}),i.jsx(nr,{className:"h-40 w-full rounded-lg"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(nr,{className:"h-5 w-28"}),[1,2,3].map(n=>i.jsxs("div",{className:"p-3 rounded-lg bg-card border border-border/50 flex items-center gap-3",children:[i.jsx(nr,{className:"w-10 h-10 rounded-lg"}),i.jsxs("div",{className:"flex-1 space-y-1",children:[i.jsx(nr,{className:"h-4 w-32"}),i.jsx(nr,{className:"h-3 w-24"})]})]},n))]})]})}const oC=kh("App",{web:()=>bo(()=>import("./web-DuvxJIk-.js"),__vite__mapDeps([5,1,2,3])).then(e=>new e.AppWeb)}),W5="synka_app_lock_enabled",U5="synka_biometric_enabled",V5="synka_cached_user_name",H5="synka_cached_user_email",py=()=>localStorage.getItem(W5)==="true",Gse=e=>{localStorage.setItem(W5,e?"true":"false"),e||qse()},my=()=>localStorage.getItem(U5)==="true",qse=e=>{localStorage.setItem(U5,"false")},g0=()=>localStorage.getItem(V5),Nm=e=>{e&&localStorage.setItem(V5,e)},Gj=()=>localStorage.getItem(H5),od=e=>{e&&localStorage.setItem(H5,e)},nS="synka_biometric_enabled",R$="synka_biometric_consent_asked";function Kse(){const e=Pa(),{user:t,loading:n,loginWithPinOnly:r}=or(),[a,s]=N.useState(null),[o,l]=N.useState(!1),[c,d]=N.useState(!1),[u,h]=N.useState(!1),[p,m]=N.useState(null),f=N.useRef(!1),g=()=>localStorage.getItem(nS)==="true",x=()=>localStorage.getItem(R$)==="true",y=()=>{localStorage.setItem(R$,"true")},b=()=>{localStorage.setItem(nS,"true")},v=()=>{localStorage.setItem(nS,"false")};N.useEffect(()=>{Xt.isNativePlatform()&&Em().then(s)},[]),N.useEffect(()=>{if(!Xt.isNativePlatform()||n||t||f.current||u)return;if(!py()){h(!0);return}(async()=>{f.current=!0,h(!0);const I=await Em();s(I),I.available&&I.hasCredentials&&g()&&await w()})()},[n,t,u]);const w=N.useCallback(async()=>{if(Xt.isNativePlatform()){l(!0);try{const _=await z5();if(!_.success){if(l(!1),_.error==="cancelled")return;ie({title:"Biometric failed",description:"Please log in with your PIN.",variant:"destructive"});return}const{error:I}=await r(_.email,_.userId);if(I){l(!1),ie({title:"Login failed",description:"Please log in with your PIN.",variant:"destructive"}),e("/login");return}l(!1),ie({title:"Welcome back!",description:"Logged in with biometrics."}),e("/my-card")}catch(_){l(!1),console.error("Biometric auto-login error:",_)}}},[r,e]),k=N.useCallback(async(_,I)=>{if(!Xt.isNativePlatform())return;const T=await Em();s(T),T.available&&!x()?(m({email:_,userId:I}),d(!0)):T.available&&g()&&await m0(_,I)},[]),C=N.useCallback(async()=>{if(!p)return;y(),b();const{success:_}=await m0(p.email,p.userId);_&&ie({title:"Biometric enabled!",description:"You can now log in faster next time."}),d(!1),m(null)},[p]),S=N.useCallback(()=>{y(),v(),d(!1),m(null)},[]);return{biometricInfo:a,isBiometricLoading:o,showConsentDialog:c,setShowConsentDialog:d,triggerBiometricLogin:w,handleLoginSuccess:k,handleConsentEnable:C,handleConsentSkip:S,isBiometricEnabled:g(),isNative:Xt.isNativePlatform()}}const Yse=e=>e.includes("/my-card")||e.includes("/card")?"card":e.includes("/crm")?"crm":e.includes("/settings")?"settings":"dashboard";function Xse(){var q;const e=Xl(),t=Pa(),{user:n,loading:r}=or(),{profile:a}=hl(),s=((q=a==null?void 0:a.plan)==null?void 0:q.toLowerCase())==="orange",o=Xt.isNativePlatform(),{biometricInfo:l,isBiometricLoading:c,showConsentDialog:d,setShowConsentDialog:u,triggerBiometricLogin:h,handleConsentEnable:p,handleConsentSkip:m}=Kse(),{cards:f,activeCard:g,loading:x,createCard:y,deleteCard:b,setDefaultCard:v,selectCard:w,updateCard:k}=Df(),C=N.useCallback(async($,L)=>{await k($,{name:L})},[k]),S=e.pathname==="/login"||e.pathname==="/signup",_=e.pathname==="/"||e.pathname==="/index",I=e.pathname==="/my-card"||e.pathname.startsWith("/card"),T=!r&&!!n,A=N.useCallback(async $=>{$&&(await w($),I||t("/my-card"))},[w,t,I]),j=N.useCallback(()=>{t("/my-card?edit=true")},[t]),D=N.useCallback(async $=>{const L=await y($);return L.data&&(await w(L.data.id),t("/my-card?edit=true")),L},[y,w,t]),B=["/dashboard","/crm","/my-card","/card","/settings"].some($=>e.pathname.startsWith($));return N.useEffect(()=>{!r&&!n&&B&&t("/login")},[r,n,B,t]),S?i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[i.jsx("div",{className:"fixed top-[max(1rem,env(safe-area-inset-top))] right-[max(1rem,env(safe-area-inset-right))] z-50",children:i.jsx(sy,{})}),i.jsx(vk,{})]}):!T&&_&&o?i.jsxs(i.Fragment,{children:[i.jsx(Fse,{onBiometricLogin:h,biometricInfo:l,isBiometricLoading:c}),i.jsx(B5,{open:d,onOpenChange:u,onEnable:p,onSkip:m,biometricInfo:l})]}):!T&&_?i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[i.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:i.jsxs("div",{className:"px-4 sm:px-6 md:px-10 flex items-center justify-between h-14 md:h-16",children:[i.jsx(Xa,{size:"md"}),i.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[i.jsx(de,{variant:"ghost",size:"sm",className:"px-2 sm:px-3 text-sm",onClick:()=>t("/login"),children:"Login"}),i.jsx(de,{variant:"gradient",size:"sm",className:"px-3 sm:px-4 text-sm",onClick:()=>t("/signup"),children:"Sign up"}),i.jsx("div",{className:"ml-1 sm:ml-3",children:i.jsx(sy,{})})]})]})}),i.jsx("main",{className:"pt-[calc(3.5rem+env(safe-area-inset-top))] md:pt-[calc(4rem+env(safe-area-inset-top))] w-full",children:i.jsx(vk,{})})]}):i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background",children:[i.jsx(TJ,{}),i.jsx("header",{className:"md:hidden fixed top-0 left-0 right-0 z-50 glass border-b border-border/50 pt-[env(safe-area-inset-top)]",children:i.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 h-14",children:[i.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[i.jsx(Xa,{size:"sm"}),I&&!x&&g&&Array.isArray(f)&&i.jsx("div",{className:"ml-2 sm:ml-3 min-w-0 flex-1",children:i.jsx(_4,{cards:f,activeCard:g,onSelect:A,onSetDefault:v,onAdd:D,onDelete:b,onEditCard:j,onUpdateCardName:C,variant:"mobile",isOrangePlan:s})})]}),i.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s&&i.jsx(rn,{className:"bg-orange-plan text-white font-semibold text-xs px-2 py-0.5 shadow-sm",children:"ORANGE"}),i.jsx(sy,{})]})]})}),i.jsx("main",{className:"pt-[calc(3.5rem+env(safe-area-inset-top))] md:pt-16 pb-[calc(5rem+env(safe-area-inset-bottom))] md:pb-8 w-full",children:i.jsx(N.Suspense,{fallback:i.jsx(Hse,{variant:Yse(e.pathname)}),children:i.jsx("div",{className:"animate-fade-in",children:i.jsx(vk,{})})})}),i.jsx(aJ,{})]})}const G5="https://synka.in";function Zse(){return G5}function q5(e){return`${G5}/u/${e}`}function Qse(){const e=Pa(),t=Xl(),n=N.useCallback(a=>{try{if(a.startsWith("synka://")){const d=a.replace("synka://","/");return d.startsWith("/")?d:`/${d}`}const s=new URL(a),o=s.hostname.toLowerCase();return["synka.in","www.synka.in","lovableproject.com","f179cf0b-9d7d-4683-9a9f-315f6ad3e5bb.lovableproject.com"].some(d=>o===d||o.endsWith(`.${d}`))?s.pathname+s.search:(console.log("[DeepLink] Invalid domain:",o),null)}catch(s){return console.error("[DeepLink] Failed to parse URL:",a,s),null}},[]),r=N.useCallback(a=>{console.log("[DeepLink] Received:",a);const s=n(a);if(!s)return;if(t.pathname+t.search===s){console.log("[DeepLink] Already on this URL");return}console.log("[DeepLink] Navigating to:",s),setTimeout(()=>{e(s,{replace:!0})},0)},[e,t.pathname,t.search,n]);N.useEffect(()=>{if(!Xt.isNativePlatform())return;console.log("[DeepLink] Setting up native deep link listeners");const s=(async()=>{try{const o=await oC.getLaunchUrl();o!=null&&o.url&&(console.log("[DeepLink] App launched with URL:",o.url),r(o.url));const l=await oC.addListener("appUrlOpen",c=>{console.log("[DeepLink] App URL opened:",c.url),r(c.url)});return()=>l.remove()}catch(o){console.error("[DeepLink] Failed to set up listeners:",o)}})();return()=>{s.then(o=>o==null?void 0:o())}},[r])}function Jse({children:e}){return Qse(),i.jsx(i.Fragment,{children:e})}function eie(){N.useEffect(()=>{if(!(window.matchMedia("(display-mode: standalone)").matches||navigator.standalone===!0))return;localStorage.setItem("synka_pwa_installed","true");const t=localStorage.getItem("synka_deep_link_path");t&&(localStorage.removeItem("synka_deep_link_path"),window.location.pathname!==t&&(window.location.href=t))},[])}const tie=3e4;function nie(){const[e,t]=N.useState(!1),[n,r]=N.useState(null),[a,s]=N.useState(!1),o=N.useRef(null),l=N.useRef(!1);N.useEffect(()=>{Xt.isNativePlatform()&&(Em().then(r),s(my()))},[]),N.useEffect(()=>{Xt.isNativePlatform()&&(l.current||(l.current=!0,py()&&t(!0)))},[]),N.useEffect(()=>{if(!Xt.isNativePlatform())return;const h=m=>{if(!py()){t(!1);return}if(!m.isActive){o.current=Date.now();return}if(o.current){const f=Date.now()-o.current;o.current=null,f>=tie&&(t(!0),s(my()))}},p=oC.addListener("appStateChange",h);return()=>{p.then(m=>m.remove())}},[]);const c=N.useCallback(async()=>(t(!1),o.current=null,!0),[]),d=N.useCallback(()=>{t(!1),o.current=null},[]),u=N.useCallback(()=>{py()&&t(!0)},[]);return{isLocked:e,isAuthenticating:!1,biometricInfo:n,biometricEnabled:a,unlock:c,unlockWithPin:d,lockNow:u}}function rie(){const{user:e}=or(),t=Gj(),n=g0(),r=!!t||!!n;return e?i.jsx(fw,{to:"/my-card",replace:!0}):r?i.jsx(fw,{to:"/login",replace:!0}):i.jsx(fw,{to:"/index",replace:!0})}const D$=[{icon:rl,title:"One-tap card exchange",description:"Instant sharing via NFC or QR. No apps needed.",color:"from-blue-500 to-cyan-500"},{icon:V_,title:"Every share becomes a lead",description:"Contacts captured automatically, even if they dont save.",color:"from-purple-500 to-pink-500"},{icon:Zm,title:"Follow-ups made effortless",description:"WhatsApp & email follow-ups in one tap.",color:"from-green-500 to-emerald-500"},{icon:eu,title:"Built for teams & founders",description:"Track employee cards, leads & activity centrally.",color:"from-indigo-500 to-violet-500"},{icon:U_,title:"See what works",description:"Real-time views & engagement analytics.",color:"from-rose-500 to-red-500"},{icon:IO,title:"AI-powered design",description:"Cards & messages designed for your personality.",color:"from-yellow-500 to-orange-500"},{icon:Tf,title:"Secure by design",description:"Enterprise-grade security & encryption.",color:"from-teal-500 to-cyan-500"}];function aie(){const e=N.useRef(null),t=N.useRef(!1),n=N.useRef(0),r=N.useRef(0),a=N.useRef(0),s=N.useRef(0),o=N.useRef(),l=1.25,c=.95,d=()=>{if(!e.current||t.current){o.current=requestAnimationFrame(d);return}e.current.scrollLeft+=l,e.current.scrollLeft>=e.current.scrollWidth/2&&(e.current.scrollLeft=0),o.current=requestAnimationFrame(d)},u=()=>{e.current&&(a.current*=c,e.current.scrollLeft+=a.current,Math.abs(a.current)>.1&&requestAnimationFrame(u))};N.useEffect(()=>(o.current=requestAnimationFrame(d),()=>o.current&&cancelAnimationFrame(o.current)),[]);const h=f=>{t.current=!0,e.current.setPointerCapture(f.pointerId),n.current=f.clientX,s.current=f.clientX,r.current=e.current.scrollLeft,a.current=0},p=f=>{if(!t.current||!e.current)return;const g=f.clientX,x=n.current-g;e.current.scrollLeft=r.current+x,a.current=s.current-g,s.current=g},m=f=>{t.current=!1,e.current.releasePointerCapture(f.pointerId),u()};return i.jsx("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-b from-muted/30 to-background overflow-hidden w-full",children:i.jsxs("div",{className:"container px-4 sm:px-6",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("h2",{className:"text-3xl md:text-4xl font-semibold",children:["Everything you need to"," ",i.jsx("span",{className:"gradient-text",children:"network smarter"})]}),i.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto mt-4",children:"From sharing to follow-up, Synka handles the entire workflow automatically."})]}),i.jsxs("div",{className:"relative select-none",children:[i.jsx("div",{className:"hidden sm:block absolute left-0 top-0 bottom-0 w-32 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{className:"hidden sm:block absolute right-0 top-0 bottom-0 w-32 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{ref:e,className:"flex gap-6 overflow-hidden py-4 cursor-grab active:cursor-grabbing",onPointerDown:h,onPointerMove:p,onPointerUp:m,onPointerLeave:m,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"pan-y"},children:[...D$,...D$].map((f,g)=>i.jsxs("div",{className:"flex-shrink-0 w-64 p-6 rounded-2xl bg-card border border-border/50 shadow-premium card-hover",children:[i.jsx("div",{className:`w-12 h-12 rounded-xl bg-gradient-to-br ${f.color} flex items-center justify-center mb-4`,children:i.jsx(f.icon,{className:"h-6 w-6 text-white"})}),i.jsx("h3",{className:"font-semibold mb-1",children:f.title}),i.jsx("p",{className:"text-sm text-muted-foreground",children:f.description})]},g))})]})]})})}const sie=[{icon:rl,title:"Automatic lead capture",description:"When someone shares their details, Synka saves them directly to your CRM."},{icon:V_,title:"Scan or add contacts",description:"Scan physical cards or add contacts manually. Data is structured instantly."},{icon:Zm,title:"One-click follow-ups",description:"Send WhatsApp or email with prefilled names, company, and signature."},{icon:Bl,title:"Events & auto tagging",description:"Schedule events and group leads captured during that time automatically."},{icon:eu,title:"Built-in CRM",description:"Contacts, notes, tags, and timelines  all in one place."},{icon:U_,title:"Analytics & reports",description:"Track views, saves, connections, and engagement over time."}];function iie(){return i.jsx("section",{className:"py-16 sm:py-24 px-4 w-full overflow-hidden",children:i.jsxs("div",{className:"container px-4 sm:px-6",children:[i.jsxs("div",{className:"text-center mb-14",children:[i.jsx("h2",{className:"text-3xl md:text-4xl font-semibold",children:"What happens after you share your card"}),i.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto mt-3",children:"Synka quietly handles everything in the background so you never miss an opportunity."})]}),i.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:sie.map(e=>i.jsxs("div",{className:"p-6 rounded-2xl bg-card border",children:[i.jsx(e.icon,{className:"h-6 w-6 text-primary mb-3"}),i.jsx("h3",{className:"font-semibold mb-1",children:e.title}),i.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]},e.title))}),i.jsx("p",{className:"text-xs text-muted-foreground text-center mt-10",children:"Secure by design. All data is encrypted and visible only to authorized users."})]})})}const oie=[{icon:$X,title:"Startup Founders",avatar:"SF",points:["Make memorable first impressions at events","Track every potential investor contact","AI-powered follow-up templates"]},{icon:jO,title:"Sales Professionals",avatar:"SP",points:["Never lose a lead with smart CRM","Instant contact sharing via NFC","Analytics on card engagement"]},{icon:c2,title:"Consultants & Coaches",avatar:"CC",points:["Professional brand presence","Easy client management","Custom email signatures"]},{icon:ty,title:"Creators & Freelancers",avatar:"CF",points:["Showcase your portfolio links","Stand out with premium designs","Track who viewed your card"]}];function lie(){return i.jsx("section",{className:"py-16 sm:py-20 px-4 gradient-subtle w-full overflow-hidden",children:i.jsxs("div",{className:"container px-4 sm:px-6",children:[i.jsxs("div",{className:"text-center mb-16",children:[i.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-foreground mb-4",children:["Built for ",i.jsx("span",{className:"gradient-text",children:"professionals"})]}),i.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Whether you're closing deals or building connections, Synka adapts to your workflow."})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:oie.map((e,t)=>i.jsx(cie,{...e,index:t},e.title))})]})})}function cie({icon:e,title:t,avatar:n,points:r,index:a}){return i.jsxs("div",{className:Ie("group p-6 rounded-2xl bg-card border border-border/50 card-hover opacity-0 animate-fade-up"),style:{animationDelay:`${a*150}ms`,animationFillMode:"forwards"},children:[i.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[i.jsx("div",{className:"w-14 h-14 rounded-2xl gradient-bg flex items-center justify-center shadow-glow",children:i.jsx("span",{className:"text-lg font-bold text-primary-foreground",children:n})}),i.jsxs("div",{children:[i.jsx(e,{className:"h-4 w-4 text-primary mb-1"}),i.jsx("h3",{className:"font-semibold text-foreground",children:t})]})]}),i.jsx("ul",{className:"space-y-3",children:r.map((s,o)=>i.jsxs("li",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary mt-2 flex-shrink-0"}),s]},o))})]})}const vn=z_,uie=O_,K5=N.forwardRef(({className:e,...t},n)=>i.jsx(h1,{ref:n,className:Ie("fixed inset-0 z-[2000] bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));K5.displayName=h1.displayName;const mn=N.forwardRef(({className:e,children:t,hideCloseButton:n=!1,...r},a)=>i.jsxs(uie,{children:[i.jsx(K5,{}),i.jsxs(p1,{ref:a,className:Ie("fixed left-[50%] top-[50%] z-[2001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,!n&&i.jsxs(L_,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[i.jsx(ui,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));mn.displayName=p1.displayName;const wn=({className:e,...t})=>i.jsx("div",{className:Ie("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});wn.displayName="DialogHeader";const su=({className:e,...t})=>i.jsx("div",{className:Ie("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});su.displayName="DialogFooter";const Nn=N.forwardRef(({className:e,...t},n)=>i.jsx(m1,{ref:n,className:Ie("text-lg font-semibold leading-none tracking-tight",e),...t}));Nn.displayName=m1.displayName;const Xd=N.forwardRef(({className:e,...t},n)=>i.jsx(f1,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));Xd.displayName=f1.displayName;var die=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],hie=die.reduce((e,t)=>{const n=sb(`Primitive.${t}`),r=N.forwardRef((a,s)=>{const{asChild:o,...l}=a,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),pie="Label",Y5=N.forwardRef((e,t)=>i.jsx(hie.label,{...e,ref:t,onMouseDown:n=>{var a;n.target.closest("button, input, select, textarea")||((a=e.onMouseDown)==null||a.call(e,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Y5.displayName=pie;var X5=Y5;const mie=y1("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),We=N.forwardRef(({className:e,...t},n)=>i.jsx(X5,{ref:n,className:Ie(mie(),e),...t}));We.displayName=X5.displayName;var fie=Object.defineProperty,gie=Object.defineProperties,xie=Object.getOwnPropertyDescriptors,x0=Object.getOwnPropertySymbols,Z5=Object.prototype.hasOwnProperty,Q5=Object.prototype.propertyIsEnumerable,M$=(e,t,n)=>t in e?fie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yie=(e,t)=>{for(var n in t||(t={}))Z5.call(t,n)&&M$(e,n,t[n]);if(x0)for(var n of x0(t))Q5.call(t,n)&&M$(e,n,t[n]);return e},bie=(e,t)=>gie(e,xie(t)),vie=(e,t)=>{var n={};for(var r in e)Z5.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&x0)for(var r of x0(e))t.indexOf(r)<0&&Q5.call(e,r)&&(n[r]=e[r]);return n};function wie(e){let t=setTimeout(e,0),n=setTimeout(e,10),r=setTimeout(e,50);return[t,n,r]}function Nie(e){let t=N.useRef();return N.useEffect(()=>{t.current=e}),t.current}var kie=18,J5=40,Sie=`${J5}px`,Cie=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function _ie({containerRef:e,inputRef:t,pushPasswordManagerStrategy:n,isFocused:r}){let[a,s]=N.useState(!1),[o,l]=N.useState(!1),[c,d]=N.useState(!1),u=N.useMemo(()=>n==="none"?!1:(n==="increase-width"||n==="experimental-no-flickering")&&a&&o,[a,o,n]),h=N.useCallback(()=>{let p=e.current,m=t.current;if(!p||!m||c||n==="none")return;let f=p,g=f.getBoundingClientRect().left+f.offsetWidth,x=f.getBoundingClientRect().top+f.offsetHeight/2,y=g-kie,b=x;document.querySelectorAll(Cie).length===0&&document.elementFromPoint(y,b)===p||(s(!0),d(!0))},[e,t,c,n]);return N.useEffect(()=>{let p=e.current;if(!p||n==="none")return;function m(){let g=window.innerWidth-p.getBoundingClientRect().right;l(g>=J5)}m();let f=setInterval(m,1e3);return()=>{clearInterval(f)}},[e,n]),N.useEffect(()=>{let p=r||document.activeElement===t.current;if(n==="none"||!p)return;let m=setTimeout(h,0),f=setTimeout(h,2e3),g=setTimeout(h,5e3),x=setTimeout(()=>{d(!0)},6e3);return()=>{clearTimeout(m),clearTimeout(f),clearTimeout(g),clearTimeout(x)}},[t,r,n,h]),{hasPWMBadge:a,willPushPWMBadge:u,PWM_BADGE_SPACE_WIDTH:Sie}}var ez=N.createContext({}),tz=N.forwardRef((e,t)=>{var n=e,{value:r,onChange:a,maxLength:s,textAlign:o="left",pattern:l,placeholder:c,inputMode:d="numeric",onComplete:u,pushPasswordManagerStrategy:h="increase-width",pasteTransformer:p,containerClassName:m,noScriptCSSFallback:f=jie,render:g,children:x}=n,y=vie(n,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),b,v,w,k,C;let[S,_]=N.useState(typeof y.defaultValue=="string"?y.defaultValue:""),I=r??S,T=Nie(I),A=N.useCallback(Q=>{a==null||a(Q),_(Q)},[a]),j=N.useMemo(()=>l?typeof l=="string"?new RegExp(l):l:null,[l]),D=N.useRef(null),F=N.useRef(null),B=N.useRef({value:I,onChange:A,isIOS:typeof window<"u"&&((v=(b=window==null?void 0:window.CSS)==null?void 0:b.supports)==null?void 0:v.call(b,"-webkit-touch-callout","none"))}),q=N.useRef({prev:[(w=D.current)==null?void 0:w.selectionStart,(k=D.current)==null?void 0:k.selectionEnd,(C=D.current)==null?void 0:C.selectionDirection]});N.useImperativeHandle(t,()=>D.current,[]),N.useEffect(()=>{let Q=D.current,$e=F.current;if(!Q||!$e)return;B.current.value!==Q.value&&B.current.onChange(Q.value),q.current.prev=[Q.selectionStart,Q.selectionEnd,Q.selectionDirection];function Le(){if(document.activeElement!==Q){W(null),U(null);return}let Je=Q.selectionStart,le=Q.selectionEnd,V=Q.selectionDirection,ee=Q.maxLength,ve=Q.value,ke=q.current.prev,Ce=-1,be=-1,Ee;if(ve.length!==0&&Je!==null&&le!==null){let $t=Je===le,Ve=Je===ve.length&&ve.length<ee;if($t&&!Ve){let tt=Je;if(tt===0)Ce=0,be=1,Ee="forward";else if(tt===ee)Ce=tt-1,be=tt,Ee="backward";else if(ee>1&&ve.length>1){let yt=0;if(ke[0]!==null&&ke[1]!==null){Ee=tt<ke[1]?"backward":"forward";let ut=ke[0]===ke[1]&&ke[0]<ee;Ee==="backward"&&!ut&&(yt=-1)}Ce=yt+tt,be=yt+tt+1}}Ce!==-1&&be!==-1&&Ce!==be&&D.current.setSelectionRange(Ce,be,Ee)}let Ue=Ce!==-1?Ce:Je,Qe=be!==-1?be:le,_t=Ee??V;W(Ue),U(Qe),q.current.prev=[Ue,Qe,_t]}if(document.addEventListener("selectionchange",Le,{capture:!0}),Le(),document.activeElement===Q&&X(!0),!document.getElementById("input-otp-style")){let Je=document.createElement("style");if(Je.id="input-otp-style",document.head.appendChild(Je),Je.sheet){let le="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";fx(Je.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),fx(Je.sheet,`[data-input-otp]:autofill { ${le} }`),fx(Je.sheet,`[data-input-otp]:-webkit-autofill { ${le} }`),fx(Je.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),fx(Je.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Xe=()=>{$e&&$e.style.setProperty("--root-height",`${Q.clientHeight}px`)};Xe();let Ye=new ResizeObserver(Xe);return Ye.observe(Q),()=>{document.removeEventListener("selectionchange",Le,{capture:!0}),Ye.disconnect()}},[]);let[$,L]=N.useState(!1),[M,X]=N.useState(!1),[G,W]=N.useState(null),[O,U]=N.useState(null);N.useEffect(()=>{wie(()=>{var Q,$e,Le,Xe;(Q=D.current)==null||Q.dispatchEvent(new Event("input"));let Ye=($e=D.current)==null?void 0:$e.selectionStart,Je=(Le=D.current)==null?void 0:Le.selectionEnd,le=(Xe=D.current)==null?void 0:Xe.selectionDirection;Ye!==null&&Je!==null&&(W(Ye),U(Je),q.current.prev=[Ye,Je,le])})},[I,M]),N.useEffect(()=>{T!==void 0&&I!==T&&T.length<s&&I.length===s&&(u==null||u(I))},[s,u,T,I]);let K=_ie({containerRef:F,inputRef:D,pushPasswordManagerStrategy:h,isFocused:M}),ce=N.useCallback(Q=>{let $e=Q.currentTarget.value.slice(0,s);if($e.length>0&&j&&!j.test($e)){Q.preventDefault();return}typeof T=="string"&&$e.length<T.length&&document.dispatchEvent(new Event("selectionchange")),A($e)},[s,A,T,j]),ne=N.useCallback(()=>{var Q;if(D.current){let $e=Math.min(D.current.value.length,s-1),Le=D.current.value.length;(Q=D.current)==null||Q.setSelectionRange($e,Le),W($e),U(Le)}X(!0)},[s]),te=N.useCallback(Q=>{var $e,Le;let Xe=D.current;if(!p&&(!B.current.isIOS||!Q.clipboardData||!Xe))return;let Ye=Q.clipboardData.getData("text/plain"),Je=p?p(Ye):Ye;Q.preventDefault();let le=($e=D.current)==null?void 0:$e.selectionStart,V=(Le=D.current)==null?void 0:Le.selectionEnd,ee=(le!==V?I.slice(0,le)+Je+I.slice(V):I.slice(0,le)+Je+I.slice(le)).slice(0,s);if(ee.length>0&&j&&!j.test(ee))return;Xe.value=ee,A(ee);let ve=Math.min(ee.length,s-1),ke=ee.length;Xe.setSelectionRange(ve,ke),W(ve),U(ke)},[s,A,j,I]),Te=N.useMemo(()=>({position:"relative",cursor:y.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[y.disabled]),Ae=N.useMemo(()=>({position:"absolute",inset:0,width:K.willPushPWMBadge?`calc(100% + ${K.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:K.willPushPWMBadge?`inset(0 ${K.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:o,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[K.PWM_BADGE_SPACE_WIDTH,K.willPushPWMBadge,o]),Se=N.useMemo(()=>N.createElement("input",bie(yie({autoComplete:y.autoComplete||"one-time-code"},y),{"data-input-otp":!0,"data-input-otp-placeholder-shown":I.length===0||void 0,"data-input-otp-mss":G,"data-input-otp-mse":O,inputMode:d,pattern:j==null?void 0:j.source,"aria-placeholder":c,style:Ae,maxLength:s,value:I,ref:D,onPaste:Q=>{var $e;te(Q),($e=y.onPaste)==null||$e.call(y,Q)},onChange:ce,onMouseOver:Q=>{var $e;L(!0),($e=y.onMouseOver)==null||$e.call(y,Q)},onMouseLeave:Q=>{var $e;L(!1),($e=y.onMouseLeave)==null||$e.call(y,Q)},onFocus:Q=>{var $e;ne(),($e=y.onFocus)==null||$e.call(y,Q)},onBlur:Q=>{var $e;X(!1),($e=y.onBlur)==null||$e.call(y,Q)}})),[ce,ne,te,d,Ae,s,O,G,y,j==null?void 0:j.source,I]),we=N.useMemo(()=>({slots:Array.from({length:s}).map((Q,$e)=>{var Le;let Xe=M&&G!==null&&O!==null&&(G===O&&$e===G||$e>=G&&$e<O),Ye=I[$e]!==void 0?I[$e]:null,Je=I[0]!==void 0?null:(Le=c==null?void 0:c[$e])!=null?Le:null;return{char:Ye,placeholderChar:Je,isActive:Xe,hasFakeCaret:Xe&&Ye===null}}),isFocused:M,isHovering:!y.disabled&&$}),[M,$,s,O,G,y.disabled,I]),Fe=N.useMemo(()=>g?g(we):N.createElement(ez.Provider,{value:we},x),[x,we,g]);return N.createElement(N.Fragment,null,f!==null&&N.createElement("noscript",null,N.createElement("style",null,f)),N.createElement("div",{ref:F,"data-input-otp-container":!0,style:Te,className:m},Fe,N.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Se)))});tz.displayName="Input";function fx(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var jie=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const ho=N.forwardRef(({className:e,containerClassName:t,...n},r)=>i.jsx(tz,{ref:r,containerClassName:Ie("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:Ie("disabled:cursor-not-allowed",e),...n}));ho.displayName="InputOTP";const po=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ie("flex items-center",e),...t}));po.displayName="InputOTPGroup";const cn=N.forwardRef(({index:e,className:t,...n},r)=>{const a=N.useContext(ez),{char:s,hasFakeCaret:o,isActive:l}=a.slots[e];return i.jsxs("div",{ref:r,className:Ie("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",l&&"z-10 ring-2 ring-ring ring-offset-background",t),...n,children:[s,o&&i.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:i.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});cn.displayName="InputOTPSlot";const Iie=N.forwardRef(({...e},t)=>i.jsx("div",{ref:t,role:"separator",...e,children:i.jsx(CX,{})}));Iie.displayName="InputOTPSeparator";const rS=[{id:1,image:"/images/card/metal-nfc-card-gold.webp",name:"Metal Gold"},{id:2,image:"/images/card/metal-nfc-business-card-silver.webp",name:"Metal Silver"},{id:3,image:"/images/card/metal-nfc-business-card-black.webp",name:"Metal Black"},{id:4,image:"/images/card/metal-nfc-card-rose-gold.webp",name:"Metal Rose Gold"},{id:5,image:"/images/card/Pvc-nfc-business-card.webp",name:"NFC Card Designs"},{id:6,image:"/images/card/Pvc-nfc-business-card-black.webp",name:"Black"},{id:7,image:"/images/card/Pvc-nfc-business-card-orange.webp",name:"Orange"},{id:8,image:"/images/card/metal-nfc-business-cards.webp",name:"Collection"}];function Tie(){const e=Pa(),t=N.useRef(null),{sendOtp:n,verifyOtp:r,loginWithPinOnly:a}=or(),[s,o]=N.useState(!1),[l,c]=N.useState("form"),[d,u]=N.useState(!1),[h,p]=N.useState({name:"",email:"",pin:"",address:"",city:"",state:"",pincode:"",phone:""}),[m,f]=N.useState(!1),[g,x]=N.useState(""),y=N.useRef(!1),b=N.useRef(0),v=N.useRef(0),w=N.useRef(0),k=N.useRef(0),C=N.useRef(),S=N.useRef(0),_=1,I=.94,T=1e3,A=()=>{if(!t.current||y.current){C.current=requestAnimationFrame(A);return}if(Date.now()<S.current){C.current=requestAnimationFrame(A);return}t.current.scrollLeft+=_,t.current.scrollLeft>=t.current.scrollWidth/2&&(t.current.scrollLeft=0),C.current=requestAnimationFrame(A)},j=()=>{S.current=Date.now()+T},D=()=>{t.current&&(w.current*=I,t.current.scrollLeft+=w.current,Math.abs(w.current)>.1&&requestAnimationFrame(D))};N.useEffect(()=>(C.current=requestAnimationFrame(A),()=>{C.current&&cancelAnimationFrame(C.current)}),[]);const F=G=>{y.current=!0,j(),t.current.setPointerCapture(G.pointerId),b.current=G.clientX,k.current=G.clientX,v.current=t.current.scrollLeft,w.current=0},B=G=>{if(!y.current||!t.current)return;const W=G.clientX,O=b.current-W;t.current.scrollLeft=v.current+O,w.current=k.current-W,k.current=W},q=G=>{y.current=!1,t.current.releasePointerCapture(G.pointerId),j(),D()},$=()=>{c("form"),p({name:"",email:"",pin:"",address:"",city:"",state:"",pincode:"",phone:""}),f(!1),x("")},L=()=>{o(!1),$(),e("/order-nfc-card")},M=async G=>{var W,O,U;if(G.preventDefault(),!h.name||!h.email||!h.pin||h.pin.length!==4){ie({title:"Missing information",description:"Please fill in name, email, and 4-digit PIN.",variant:"destructive"});return}if(!h.address||!h.city||!h.state||!h.pincode||!h.phone){ie({title:"Missing address",description:"Please fill in complete shipping address.",variant:"destructive"});return}u(!0);try{const K=await ue.functions.invoke("pin-auth",{body:{action:"CHECK_PIN_EXISTS",email:h.email}});if((W=K.data)!=null&&W.exists)if(f(!1),K.data.has_pin){const ce=await ue.functions.invoke("pin-auth",{body:{action:"VERIFY_PIN",email:h.email,pin:h.pin}});(O=ce.data)!=null&&O.success?(await a(h.email,ce.data.user_id),ie({title:"Welcome back!",description:"Select your NFC card type."}),L()):ie({title:"Invalid PIN",description:((U=ce.data)==null?void 0:U.error)||"The PIN you entered is incorrect.",variant:"destructive"})}else{const{error:ce}=await n(h.email);ce?ie({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(c("otp_verify"),ie({title:"Verification needed",description:"We sent a code to your email to verify your account."}))}else{f(!0);const{error:ce}=await n(h.email);ce?ie({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(c("otp_verify"),ie({title:"Verification code sent",description:"Check your email for the verification code."}))}}catch(K){console.error("Error in form submit:",K),ie({title:"Error",description:"Something went wrong. Please try again.",variant:"destructive"})}finally{u(!1)}},X=async()=>{if(g.length===6){u(!0);try{const{error:G}=await r(h.email,g);if(G){ie({title:"Invalid code",description:"The verification code is incorrect or expired.",variant:"destructive"}),u(!1);return}const{data:{session:W}}=await ue.auth.getSession();W!=null&&W.user&&(await ue.functions.invoke("pin-auth",{body:{action:"SET_PIN",user_id:W.user.id,pin:h.pin}}),await ue.from("profiles").update({full_name:h.name}).eq("user_id",W.user.id)),ie({title:"Account verified!",description:"Now select your NFC card type."}),L()}catch(G){console.error("OTP verification error:",G),ie({title:"Error",description:"Verification failed. Please try again.",variant:"destructive"})}finally{u(!1)}}};return i.jsxs("section",{className:"py-16 sm:py-24 px-4 w-full overflow-hidden",children:[i.jsxs("div",{className:"container px-4 sm:px-6",children:[i.jsxs("div",{className:"text-center max-w-3xl mx-auto mb-8 sm:mb-12",children:[i.jsx("div",{className:"flex justify-center mb-4 animate-fade-up",children:i.jsxs("div",{className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-medium text-orange-600 border border-orange-500/30 bg-orange-500/10 backdrop-blur-sm",children:[i.jsx("span",{className:"absolute inset-0 rounded-full bg-orange-500/20 blur-md opacity-30"}),i.jsxs("span",{className:"relative flex h-2 w-2",children:[i.jsx("span",{className:"absolute inline-flex h-full w-full rounded-full bg-orange-500 opacity-75 animate-ping"}),i.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-orange-600"})]}),i.jsx(Ls,{className:"h-3.5 w-3.5 relative animate-pulse"}),i.jsx("span",{className:"relative",children:"Introducing AI-Designed Cards"})]})}),i.jsxs("h2",{className:"text-[22px] sm:text-3xl md:text-4xl font-semibold leading-tight sm:leading-snug text-center px-4 max-w-[22rem] sm:max-w-none mx-auto",children:["Get your"," ",i.jsx("span",{className:"gradient-text block sm:inline",children:"AI-designed NFC business card"}),i.jsx("span",{className:"block mt-2 sm:mt-1 font-medium",children:"built to make every introduction unforgettable"})]}),i.jsxs("p",{className:"text-sm sm:text-lg text-muted-foreground leading-relaxed text-center px-6 max-w-md mx-auto mt-4",children:["AI designs a card that reflects who you are.",i.jsx("br",{className:"hidden sm:block"}),"You tap once  and people remember you forever."]})]}),i.jsxs("div",{className:"relative select-none",children:[i.jsx("div",{className:"hidden sm:block absolute left-0 top-0 bottom-0 w-32 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{className:"hidden sm:block absolute right-0 top-0 bottom-0 w-32 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),i.jsx("div",{ref:t,className:"flex gap-4 sm:gap-6 overflow-x-hidden py-4 cursor-grab active:cursor-grabbing -mx-4 px-4 sm:mx-0 sm:px-0",onPointerDown:F,onPointerMove:B,onPointerUp:q,onPointerLeave:q,style:{userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",touchAction:"pan-y"},children:[...rS,...rS].map((G,W)=>i.jsxs("div",{className:"flex-shrink-0 w-[200px] sm:w-[240px] md:w-[280px] opacity-0 animate-fade-up",style:{animationDelay:`${W%rS.length*80}ms`,animationFillMode:"forwards"},children:[i.jsx("div",{className:"aspect-[1.6/1] rounded-2xl overflow-hidden shadow-premium card-hover",children:i.jsx("img",{src:G.image,alt:G.name,className:"w-full h-full object-cover",loading:"lazy"})}),i.jsx("p",{className:"text-center text-sm font-medium text-muted-foreground mt-3",children:G.name})]},`${G.id}-${W}`))})]}),i.jsx("ul",{className:"mt-10 space-y-2 text-muted-foreground text-sm sm:text-base max-w-xl mx-auto",children:["Premium metal & PVC cards that stand out instantly","One-tap sharing via NFC & QR  no app needed","AI-designed to match your role, brand & personality","Update anytime  no reprints, no extra cost"].map((G,W)=>i.jsx("li",{className:"flex justify-center",children:i.jsxs("span",{className:"text-left flex gap-2",children:[i.jsx("span",{children:""}),i.jsx("span",{children:G})]})},W))}),i.jsx("div",{className:"flex justify-center mt-8",children:i.jsxs(de,{size:"lg",onClick:()=>o(!0),children:["Get your NFC Card",i.jsx(ni,{className:"h-4 w-4 ml-2"})]})}),i.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground text-center mt-4 animate-fade-up",children:["Includes complimentary replacement.",i.jsx("br",{}),"Lifetime NFC card included with ",i.jsx("span",{className:"font-medium",children:"Orange (Pro) plan"}),"."]})]}),i.jsx(vn,{open:s,onOpenChange:G=>{G||$(),o(G)},children:i.jsxs(mn,{className:"sm:max-w-lg max-h-[90vh] overflow-y-auto",children:[i.jsxs(wn,{children:[i.jsxs(Nn,{children:[l==="form"&&"Get Your NFC Card",l==="otp_verify"&&"Verify Your Email"]}),i.jsxs(Xd,{children:[l==="form"&&"Fill in your details to order your premium NFC business card.",l==="otp_verify"&&"Enter the 6-digit code sent to your email."]})]}),l==="form"&&i.jsxs("form",{onSubmit:M,className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"name",children:"Full Name"}),i.jsx(At,{id:"name",placeholder:"John Doe",value:h.name,onChange:G=>p({...h,name:G.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"email",children:"Email"}),i.jsx(At,{id:"email",type:"email",placeholder:"john@example.com",value:h.email,onChange:G=>p({...h,email:G.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"pin",children:"4-Digit PIN"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"This PIN will be used for quick login"}),i.jsx(ho,{maxLength:4,value:h.pin,onChange:G=>p({...h,pin:G}),children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"phone",children:"Phone Number"}),i.jsx(At,{id:"phone",type:"tel",placeholder:"+91 98765 43210",value:h.phone,onChange:G=>p({...h,phone:G.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"address",children:"Address"}),i.jsx(At,{id:"address",placeholder:"House/Flat No., Street, Locality",value:h.address,onChange:G=>p({...h,address:G.target.value}),required:!0})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"city",children:"City"}),i.jsx(At,{id:"city",value:h.city,onChange:G=>p({...h,city:G.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"state",children:"State"}),i.jsx(At,{id:"state",value:h.state,onChange:G=>p({...h,state:G.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"pincode",children:"Pincode"}),i.jsx(At,{id:"pincode",value:h.pincode,onChange:G=>p({...h,pincode:G.target.value}),required:!0})]})]}),i.jsx(de,{type:"submit",className:"w-full",disabled:d,children:d?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):i.jsxs(i.Fragment,{children:["Continue",i.jsx(ni,{className:"h-4 w-4 ml-2"})]})})]}),l==="otp_verify"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center",children:[i.jsxs("p",{className:"text-sm text-muted-foreground mb-4",children:["Enter the 6-digit code sent to ",i.jsx("strong",{children:h.email})]}),i.jsx(ho,{maxLength:6,value:g,onChange:x,className:"justify-center",children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3}),i.jsx(cn,{index:4}),i.jsx(cn,{index:5})]})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(de,{variant:"outline",onClick:()=>c("form"),className:"flex-1",children:[i.jsx(Ed,{className:"h-4 w-4 mr-2"}),"Back"]}),i.jsx(de,{onClick:X,disabled:g.length!==6||d,className:"flex-1",children:d?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Verify"})]})]})]})})]})}function Eie(){return i.jsx("footer",{className:"py-8 sm:py-12 px-4 border-t border-border/50 w-full overflow-hidden",children:i.jsx("div",{className:"container px-4 sm:px-6",children:i.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4 sm:gap-6",children:[i.jsx(Xa,{size:"md"}),i.jsxs("nav",{className:"flex flex-wrap justify-center gap-6 text-sm text-muted-foreground",children:[i.jsx(Bs,{to:"/support",className:"hover:text-foreground transition-colors",children:"Support"}),i.jsx(Bs,{to:"/terms",className:"hover:text-foreground transition-colors",children:"Terms"}),i.jsx(Bs,{to:"/privacy",className:"hover:text-foreground transition-colors",children:"Privacy"}),i.jsx(Bs,{to:"/contact",className:"hover:text-foreground transition-colors",children:"Contact"})]}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",new Date().getFullYear()," Synka. All rights reserved."]})]})})})}function Aie(){return i.jsx("section",{className:"py-16 sm:py-28 px-4 bg-muted/30 w-full overflow-hidden",children:i.jsxs("div",{className:"container max-w-6xl px-4 sm:px-6",children:[i.jsxs("div",{className:"text-center mb-16",children:[i.jsx("h2",{className:"text-3xl md:text-4xl font-semibold",children:"Built to scale with your team"}),i.jsx("p",{className:"text-muted-foreground mt-3",children:"From solo professionals to startups and enterprises."})]}),i.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-16",children:[i.jsx(aS,{title:"Team",text:"Managers get visibility into contacts and activity across members."}),i.jsx(aS,{title:"Startup",text:"Shared events, workflows, and a unified CRM for growth."}),i.jsx(aS,{title:"Enterprise",text:"Custom solutions, permissions, and workflows tailored to you."})]}),i.jsxs("div",{className:"text-center max-w-2xl mx-auto",children:[i.jsx("h3",{className:"text-2xl font-semibold mb-3",children:"Lets build the right solution together"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"We design custom workflows and enterprise-grade solutions so your team can focus on products and customers  while we handle the rest."}),i.jsx("button",{className:"px-8 py-4 rounded-xl bg-primary text-primary-foreground",children:"Contact us for custom solutions"}),i.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Secure  Encrypted  Enterprise-ready"})]})]})})}function aS({title:e,text:t}){return i.jsxs("div",{className:"p-6 rounded-2xl bg-card border",children:[i.jsx("h4",{className:"font-semibold mb-2",children:e}),i.jsx("p",{className:"text-sm text-muted-foreground",children:t})]})}const $$=new Set,Rie=e=>$$.has(e)?Promise.resolve():new Promise(t=>{const n=new Image;n.onload=()=>{$$.add(e),t()},n.onerror=()=>t(),n.src=e}),Die=e=>Promise.all(e.map(Rie)),Mie=e=>{N.useEffect(()=>{const t=setTimeout(()=>{Die(e)},100);return()=>clearTimeout(t)},[e])},$ie=["/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg","/images/ai/cofounder-primary.webp"],Fie=["1-tap digital business card exchange (NFC + QR)","Automatic lead capture","Smart follow-ups & reminders","Real-time analytics"],Pie=["Built-in CRM for contacts & notes","Team & employee card tracking","Founder & manager dashboards","AI-designed digital cards & templates"];function Oie(){const e=Pa(),[t,n]=N.useState(0);Mie($ie),N.useEffect(()=>{const a=setInterval(()=>{n(s=>s===0?1:0)},3500);return()=>clearInterval(a)},[]);const r=t===0?Fie:Pie;return i.jsxs("div",{className:"min-h-dvh w-full overflow-x-hidden bg-background",children:[i.jsx("section",{className:"relative bg-gradient-to-b from-primary/5 via-background to-background",children:i.jsx("div",{className:"max-w-7xl mx-auto py-10 md:py-16 px-3 sm:px-6",children:i.jsxs("div",{className:"grid lg:grid-cols-2 gap-10 items-center",children:[i.jsxs("div",{className:"space-y-6 text-center lg:text-left",children:[i.jsx("div",{className:"inline-flex items-center px-4 py-1.5 rounded-full bg-primary/10 text-primary text-sm font-medium",children:"SYNKA  Simply Connected"}),i.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-bold leading-tight",children:["Indias most powerful"," ",i.jsx("span",{className:"gradient-text",children:"digital business card"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("p",{className:"text-lg sm:text-xl font-medium text-foreground",children:"Smart NFC & QR business cards that share instantly and capture leads."}),i.jsx("p",{className:"text-base sm:text-lg text-muted-foreground",children:"AI-designed cards with built-in CRM and real-time analytics  all in one platform."})]}),i.jsx("div",{className:"relative h-28 max-w-xl mx-auto lg:mx-0",children:i.jsx("div",{className:"absolute inset-0 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-3 animate-fade",children:r.map(a=>i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-primary mt-1 flex-shrink-0"}),i.jsx("span",{className:"text-sm sm:text-base text-muted-foreground",children:a})]},a))},t)}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-4 justify-center lg:justify-start",children:[i.jsxs(de,{size:"lg",onClick:()=>e("/signup"),className:"group bg-primary text-primary-foreground px-8 py-6 rounded-full shadow-lg",children:["Create your free card",i.jsx(ni,{className:"h-5 w-5 ml-2 group-hover:translate-x-1 transition-transform"})]}),i.jsx(de,{variant:"outline",size:"lg",onClick:()=>e("/contact"),className:"px-8 py-6 rounded-full",children:"Talk to us"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Free forever digital business card  Lifetime free NFC visiting card on Orange (Pro) plan"})]}),i.jsx("div",{className:"relative flex justify-center lg:justify-end",children:i.jsx("div",{className:"relative w-full max-w-sm md:max-w-md",children:i.jsx("img",{src:"/images/ai/ai-digital-nfc-business-visiting-card-synka.jpg",alt:"Synka NFC digital business card",className:"w-full rounded-3xl shadow-2xl"})})})]})})}),i.jsx(aie,{}),i.jsx(iie,{}),i.jsx(lie,{}),i.jsx(Aie,{}),i.jsx("section",{className:"py-16 bg-muted/30 text-center",children:i.jsxs("div",{className:"container max-w-4xl space-y-6",children:[i.jsx("img",{src:"/images/ai/cofounder-primary.webp",alt:"AI designed digital business card",className:"mx-auto w-36 h-36 rounded-full shadow-lg"}),i.jsx("h2",{className:"text-3xl font-bold",children:"Designed by AI. Powered by intelligence."}),i.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Indias first AI-designed digital business card  tailored to your business, role, and personality."})]})}),i.jsx(Tie,{}),i.jsx("section",{className:"py-20",children:i.jsx("div",{className:"container",children:i.jsxs("div",{className:"gradient-bg rounded-3xl p-12 text-center",children:[i.jsx("h2",{className:"text-4xl font-bold text-primary-foreground",children:"Create your digital business card in minutes"}),i.jsx("p",{className:"text-primary-foreground/80 mt-3",children:"Replace paper visiting cards forever with NFC-powered networking."}),i.jsx(de,{size:"lg",onClick:()=>e("/signup"),className:"mt-6 bg-background text-foreground px-10 py-6 rounded-full",children:"Get started for free"})]})})}),i.jsx(Eie,{}),i.jsx(F5,{}),i.jsx("style",{children:`
        .animate-fade {
          animation: fadeUp 0.6s ease both;
        }
        @keyframes fadeUp {
          from {
            opacity: 0;
            transform: translateY(6px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}const qj=[{code:"+91"},{code:"+1"},{code:"+44"},{code:"+61"},{code:"+971"},{code:"+966"},{code:"+65"},{code:"+81"},{code:"+86"},{code:"+49"},{code:"+33"},{code:"+39"},{code:"+34"},{code:"+7"},{code:"+55"},{code:"+52"},{code:"+27"},{code:"+82"},{code:"+60"},{code:"+66"},{code:"+84"},{code:"+62"},{code:"+63"},{code:"+92"},{code:"+880"},{code:"+94"},{code:"+977"},{code:"+64"},{code:"+41"},{code:"+31"},{code:"+46"},{code:"+47"},{code:"+45"},{code:"+358"},{code:"+48"},{code:"+43"},{code:"+32"},{code:"+353"},{code:"+351"},{code:"+30"},{code:"+852"},{code:"+886"},{code:"+90"},{code:"+972"},{code:"+974"},{code:"+968"},{code:"+973"},{code:"+965"}],In=({label:e,value:t,onChange:n,type:r="text",inputMode:a,disabled:s,className:o,inputRef:l,onFocus:c,onBlur:d})=>i.jsxs("div",{className:Ie("relative h-14",o),children:[i.jsx("input",{ref:l,type:r,inputMode:a,value:t,onChange:n,onFocus:c,onBlur:d,placeholder:" ",disabled:s,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"data-form-type":"other",className:"peer w-full h-full px-4 text-base bg-transparent outline-none rounded-xl border border-border focus:border-foreground disabled:opacity-50",style:{fontSize:"16px"}}),i.jsx("label",{className:`absolute left-4 text-muted-foreground pointer-events-none
          top-0 -translate-y-1/2 text-xs bg-background px-1
          peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-base peer-placeholder-shown:bg-transparent peer-placeholder-shown:px-0
          peer-focus:top-0 peer-focus:text-xs peer-focus:bg-background peer-focus:px-1`,children:e})]}),Bx=e=>{const n=(e||"").trim().split(/\s+/);return n.length===0?{firstName:"",lastName:""}:n.length===1?{firstName:n[0],lastName:""}:{firstName:n[0],lastName:n.slice(1).join(" ")}},Hc=(e,t)=>{const n=(e||"").trim(),r=(t||"").trim();return[n,r].filter(Boolean).join(" ")},_c=({firstName:e,lastName:t,onFirstNameChange:n,onLastNameChange:r,disabled:a,className:s,firstNameRequired:o=!0})=>i.jsxs("div",{className:Ie("grid grid-cols-2 gap-3",s),children:[i.jsx(In,{label:o?"First Name *":"First Name",value:e,onChange:l=>n(l.target.value),disabled:a}),i.jsx(In,{label:"Last Name",value:t,onChange:l=>r(l.target.value),disabled:a})]}),Fs=({label:e,value:t,onChange:n,countryCode:r,onCountryCodeChange:a,disabled:s,className:o,onFocus:l,onBlur:c})=>i.jsxs("div",{className:Ie("relative h-14",o),children:[i.jsxs("div",{className:"peer w-full h-full rounded-xl border border-border focus-within:border-foreground flex items-center",children:[i.jsx("div",{className:"flex items-center justify-center pl-3 pr-1 shrink-0 border-r border-border/50 h-full",children:i.jsx("select",{value:r,onChange:d=>a(d.target.value),disabled:s,autoComplete:"off",className:"bg-transparent text-sm outline-none cursor-pointer disabled:opacity-50 appearance-none font-medium",style:{fontSize:"14px"},children:qj.map(({code:d})=>i.jsx("option",{value:d,className:"bg-background text-foreground",children:d},d))})}),i.jsx("input",{type:"text",inputMode:"numeric",name:`phone-${Date.now()}`,value:t,onChange:n,onFocus:l,onBlur:c,placeholder:" ",disabled:s,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1,"data-form-type":"other","data-lpignore":"true",className:"peer-phone flex-1 min-w-0 h-full px-3 text-base bg-transparent outline-none disabled:opacity-50",style:{fontSize:"16px"}})]}),i.jsx("label",{className:`absolute left-16 text-muted-foreground pointer-events-none
          top-0 -translate-y-1/2 text-xs bg-background px-1
          peer-focus-within:top-0 peer-focus-within:text-xs peer-focus-within:bg-background peer-focus-within:px-1
          peer-has-[:placeholder-shown]:peer-has-[input:not(:focus)]:top-1/2 
          peer-has-[:placeholder-shown]:peer-has-[input:not(:focus)]:text-base 
          peer-has-[:placeholder-shown]:peer-has-[input:not(:focus)]:bg-transparent 
          peer-has-[:placeholder-shown]:peer-has-[input:not(:focus)]:px-0`,children:e})]}),Ir=e=>{if(!e)return"";const t=qj.find(n=>e.startsWith(n.code));return t?e.slice(t.code.length):e},kr=e=>{if(!e)return"+91";const t=qj.find(n=>e.startsWith(n.code));return(t==null?void 0:t.code)||"+91"};function C1(e){const t=N.useRef({value:e,previous:e});return N.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var _1="Checkbox",[Lie]=dl(_1),[zie,Kj]=Lie(_1);function Bie(e){const{__scopeCheckbox:t,checked:n,children:r,defaultChecked:a,disabled:s,form:o,name:l,onCheckedChange:c,required:d,value:u="on",internal_do_not_use_render:h}=e,[p,m]=zl({prop:n,defaultProp:a??!1,onChange:c,caller:_1}),[f,g]=N.useState(null),[x,y]=N.useState(null),b=N.useRef(!1),v=f?!!o||!!f.closest("form"):!0,w={checked:p,disabled:s,setChecked:m,control:f,setControl:g,name:l,form:o,value:u,hasConsumerStoppedPropagationRef:b,required:d,defaultChecked:Gc(a)?!1:a,isFormControl:v,bubbleInput:x,setBubbleInput:y};return i.jsx(zie,{scope:t,...w,children:Wie(h)?h(w):r})}var nz="CheckboxTrigger",rz=N.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:n,...r},a)=>{const{control:s,value:o,disabled:l,checked:c,required:d,setControl:u,setChecked:h,hasConsumerStoppedPropagationRef:p,isFormControl:m,bubbleInput:f}=Kj(nz,e),g=gr(a,u),x=N.useRef(c);return N.useEffect(()=>{const y=s==null?void 0:s.form;if(y){const b=()=>h(x.current);return y.addEventListener("reset",b),()=>y.removeEventListener("reset",b)}},[s,h]),i.jsx(Gn.button,{type:"button",role:"checkbox","aria-checked":Gc(c)?"mixed":c,"aria-required":d,"data-state":lz(c),"data-disabled":l?"":void 0,disabled:l,value:o,...r,ref:g,onKeyDown:Mn(t,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:Mn(n,y=>{h(b=>Gc(b)?!0:!b),f&&m&&(p.current=y.isPropagationStopped(),p.current||y.stopPropagation())})})});rz.displayName=nz;var Yj=N.forwardRef((e,t)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:s,required:o,disabled:l,value:c,onCheckedChange:d,form:u,...h}=e;return i.jsx(Bie,{__scopeCheckbox:n,checked:a,defaultChecked:s,disabled:l,required:o,onCheckedChange:d,name:r,form:u,value:c,internal_do_not_use_render:({isFormControl:p})=>i.jsxs(i.Fragment,{children:[i.jsx(rz,{...h,ref:t,__scopeCheckbox:n}),p&&i.jsx(oz,{__scopeCheckbox:n})]})})});Yj.displayName=_1;var az="CheckboxIndicator",sz=N.forwardRef((e,t)=>{const{__scopeCheckbox:n,forceMount:r,...a}=e,s=Kj(az,n);return i.jsx(Yl,{present:r||Gc(s.checked)||s.checked===!0,children:i.jsx(Gn.span,{"data-state":lz(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});sz.displayName=az;var iz="CheckboxBubbleInput",oz=N.forwardRef(({__scopeCheckbox:e,...t},n)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:s,defaultChecked:o,required:l,disabled:c,name:d,value:u,form:h,bubbleInput:p,setBubbleInput:m}=Kj(iz,e),f=gr(n,m),g=C1(s),x=B_(r);N.useEffect(()=>{const b=p;if(!b)return;const v=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(v,"checked").set,C=!a.current;if(g!==s&&k){const S=new Event("click",{bubbles:C});b.indeterminate=Gc(s),k.call(b,Gc(s)?!1:s),b.dispatchEvent(S)}},[p,g,s,a]);const y=N.useRef(Gc(s)?!1:s);return i.jsx(Gn.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??y.current,required:l,disabled:c,name:d,value:u,form:h,...t,tabIndex:-1,ref:f,style:{...t.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});oz.displayName=iz;function Wie(e){return typeof e=="function"}function Gc(e){return e==="indeterminate"}function lz(e){return Gc(e)?"indeterminate":e?"checked":"unchecked"}const cz=N.forwardRef(({className:e,...t},n)=>i.jsx(Yj,{ref:n,className:Ie("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:i.jsx(sz,{className:Ie("flex items-center justify-center text-current"),children:i.jsx(dn,{className:"h-4 w-4"})})}));cz.displayName=Yj.displayName;const sS="synka_biometric_enabled",iS="synka_biometric_consent_asked",Uie=()=>{const e=document.createElement("canvas"),t=e.getContext("2d");t&&(t.textBaseline="top",t.font="14px Arial",t.fillText("fingerprint",2,2));const n=[navigator.userAgent,navigator.language,screen.width+"x"+screen.height,new Date().getTimezoneOffset(),e.toDataURL()].join("|");let r=0;for(let a=0;a<n.length;a++){const s=n.charCodeAt(a);r=(r<<5)-r+s,r=r&r}return r.toString(36)},Wv="synka_cached_email",F$="synka_known_devices",oS="synka_remember_me";function Vie(){const e=Pa(),n=Xl().state,r=PY(),a=(n==null?void 0:n.appLockMode)===!0,s=(n==null?void 0:n.returnTo)||"/my-card",{user:o,sendOtp:l,verifyOtp:c,verifyPin:d,checkPinExists:u,setPin:h,signInWithGoogle:p,signInWithLinkedIn:m,loginWithPinOnly:f}=or(),[g,x]=N.useState(!1),[y,b]=N.useState(null),[v,w]=N.useState(""),[k,C]=N.useState(""),[S,_]=N.useState(""),[I,T]=N.useState(""),[A,j]=N.useState(""),[D,F]=N.useState("email"),[B,q]=N.useState(null),[$,L]=N.useState(null),[M,X]=N.useState(()=>g0()),[G,W]=N.useState(!1),[O,U]=N.useState(null),[K,ce]=N.useState(!1),[ne,te]=N.useState(!1),[Te,Ae]=N.useState(null),[Se,we]=N.useState(!1),Fe=N.useRef(!1),[Q,$e]=N.useState(()=>{if(Xt.isNativePlatform())return!0;const Ve=localStorage.getItem(oS);return Ve===null?!0:Ve==="true"}),Le=async()=>{Te&&(localStorage.setItem(iS,"true"),localStorage.setItem(sS,"true"),await m0(Te.email,Te.userId),ie({title:"Biometric enabled!",description:"You can now log in faster next time."}),te(!1),e("/my-card"))},Xe=()=>{localStorage.setItem(iS,"true"),localStorage.setItem(sS,"false"),te(!1),e("/my-card")};N.useEffect(()=>{Em().then(U)},[]),N.useEffect(()=>{if(Xt.isNativePlatform())return;const Ve=localStorage.getItem(oS),tt=()=>{Ve==="false"&&sessionStorage.setItem("synka_session_temp","true")};return window.addEventListener("beforeunload",tt),()=>window.removeEventListener("beforeunload",tt)},[]),N.useEffect(()=>{const Ve=localStorage.getItem(Wv),tt=g0(),yt=n==null?void 0:n.email;if(tt&&X(tt),a){const ut=Gj()||Ve;ut&&(L(ut),w(ut),F("pin")),we(!0);return}yt?(w(yt),we(!0)):Ve?(L(Ve),w(Ve),u(Ve).then(({exists:ut,has_pin:qt,full_name:an})=>{ut&&qt&&(an&&(X(an),Nm(an)),F("pin")),we(!0)})):we(!0)},[n==null?void 0:n.email,a]),N.useEffect(()=>{if(!a||!Se||Fe.current||D!=="pin"||K||!my())return;Fe.current=!0;const tt=setTimeout(()=>{Ye()},300);return()=>clearTimeout(tt)},[a,Se,D,K]);const Ye=async()=>{if(r){ce(!0);try{if(!(await Vse()).success){ce(!1);return}r.unlockWithPin(),ce(!1),setTimeout(()=>{e(s,{replace:!0})},50)}catch(Ve){console.error("App lock biometric error:",Ve),ce(!1)}}},Je=Ve=>{const tt=Uie(),yt=JSON.parse(localStorage.getItem(F$)||"{}");yt[Ve]||(yt[Ve]=[]),yt[Ve].includes(tt)||yt[Ve].push(tt),localStorage.setItem(F$,JSON.stringify(yt))},le=()=>{L(null),w(""),C(""),F("email")},V=async()=>{b("google");const{error:Ve}=await p();Ve&&(b(null),ie({title:"Error",description:Ve.message||"Failed to sign in with Google.",variant:"destructive"}))},ee=async()=>{b("linkedin");const{error:Ve}=await m();Ve&&(b(null),ie({title:"Error",description:Ve.message||"Failed to sign in with LinkedIn.",variant:"destructive"}))};N.useEffect(()=>{o&&!a&&e("/my-card")},[o,e,a]);const ve=async Ve=>{if(Ve.preventDefault(),!v)return;x(!0);const{exists:tt,has_pin:yt,user_id:ut,full_name:qt}=await u(v);if(!tt){x(!1),ie({title:"Welcome to Synka!",description:"Your journey starts here  let's create something amazing."}),e("/signup",{state:{email:v.trim()}});return}if(ut&&q(ut),qt&&X(qt),yt)F("pin"),x(!1);else{const{error:an}=await l(v);x(!1),an?ie({title:"Error",description:an.message||"Failed to send verification code.",variant:"destructive"}):(F("set_pin"),ie({title:"Verification code sent!",description:"Enter the code from your email to set up your PIN."}))}},ke=async Ve=>{if(Ve.preventDefault(),k.length!==4)return;if(x(!0),a&&r){const{error:Nt,locked:Kt}=await d(v,k);if(Nt){x(!1),Kt?ie({title:"Account Locked",description:Nt.message,variant:"destructive"}):(ie({title:"Invalid PIN",description:Nt.message,variant:"destructive"}),C(""));return}r.unlockWithPin(),x(!1),e(s,{replace:!0});return}const{error:tt,locked:yt,needs_pin_setup:ut,user_id:qt}=await d(v,k);if(tt){if(x(!1),yt)ie({title:"Account Locked",description:tt.message,variant:"destructive"});else if(ut){const{error:Nt}=await l(v);Nt?ie({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(F("set_pin"),ie({title:"Set up your PIN",description:"Enter the verification code to set your PIN."}))}else ie({title:"Invalid PIN",description:tt.message,variant:"destructive"}),C("");return}const{error:an}=await f(v,qt);if(an){x(!1),ie({title:"Error",description:an.message||"Failed to create session.",variant:"destructive"});return}Je(v),localStorage.setItem(Wv,v),M&&Nm(M),od(v),Xt.isNativePlatform()||localStorage.setItem(oS,Q?"true":"false");const lt=localStorage.getItem(iS)==="true",wt=localStorage.getItem(sS)==="true";if(Xt.isNativePlatform()&&(O!=null&&O.available)&&qt)if(lt)wt&&await m0(v,qt);else{Ae({email:v,userId:qt}),x(!1),ie({title:"Welcome back!",description:"You have successfully logged in."}),te(!0);return}x(!1),ie({title:"Welcome back!",description:"You have successfully logged in."}),e("/my-card")},Ce=async()=>{ce(!0);const Ve=await z5();if(!Ve.success){if(ce(!1),Ve.error==="cancelled")return;ie({title:"Biometric failed",description:Ve.error||"Please try again or use your PIN.",variant:"destructive"});return}const{error:tt}=await f(Ve.email,Ve.userId);if(tt){ce(!1),ie({title:"Login failed",description:"Please use your PIN to log in.",variant:"destructive"});return}localStorage.setItem(Wv,Ve.email),Ve.userId&&od(Ve.email),ce(!1),ie({title:"Welcome back!",description:"Logged in with biometrics."}),e("/my-card")},be=async Ve=>{if(Ve.preventDefault(),S.length!==6)return;x(!0);const{error:tt}=await c(v,S);x(!1),tt?ie({title:"Error",description:tt.message||"Invalid verification code.",variant:"destructive"}):(Je(v),localStorage.setItem(Wv,v),od(v),ie({title:"Welcome back!",description:"You have successfully logged in."}),e("/my-card"))},Ee=async Ve=>{if(Ve.preventDefault(),S.length!==6){ie({title:"Enter verification code",description:"Please enter the 6-digit code from your email.",variant:"destructive"});return}if(I.length!==4||A.length!==4){ie({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(I!==A){ie({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}x(!0);const{error:tt}=await c(v,S);if(tt){x(!1),ie({title:"Error",description:"Invalid verification code.",variant:"destructive"});return}const{exists:yt,user_id:ut}=await u(v);if(!yt||!ut){x(!1),ie({title:"Error",description:"Could not find your account.",variant:"destructive"});return}const{error:qt}=await h(ut,I);if(x(!1),qt){ie({title:"Error",description:"Failed to set PIN. Please try again.",variant:"destructive"});return}ie({title:"PIN set successfully!",description:"Welcome to Synka."}),M&&Nm(M),od(v),e("/my-card")},Ue=async()=>{x(!0);const{error:Ve}=await l(v);x(!1),Ve?ie({title:"Error",description:"Failed to send verification code.",variant:"destructive"}):(F("forgot_pin_otp"),_(""),T(""),j(""),ie({title:"Verification code sent!",description:"Enter the code to reset your PIN."}))},Qe=async Ve=>{if(Ve.preventDefault(),S.length!==6){ie({title:"Enter verification code",description:"Please enter the 6-digit code from your email.",variant:"destructive"});return}if(I.length!==4||A.length!==4){ie({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(I!==A){ie({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}x(!0);const{error:tt}=await c(v,S);if(tt){x(!1),ie({title:"Error",description:"Invalid verification code.",variant:"destructive"});return}const{exists:yt,user_id:ut}=await u(v);if(!yt||!ut){x(!1),ie({title:"Error",description:"Could not find your account.",variant:"destructive"});return}const{error:qt}=await h(ut,I);if(x(!1),qt){ie({title:"Error",description:"Failed to reset PIN. Please try again.",variant:"destructive"});return}ie({title:"PIN reset successfully!",description:"Welcome back to Synka."}),M&&Nm(M),od(v),e("/my-card")},_t=()=>{if(a&&D==="pin")return"Welcome Back";switch(D){case"email":return"Welcome back";case"pin":return"Enter your PIN";case"otp":return"Verify your identity";case"set_pin":return"Set up your PIN";case"forgot_pin_otp":return"Reset your PIN";default:return"Welcome back"}},$t=()=>{if(a&&D==="pin")return"Continue to your Synka";switch(D){case"email":return"Sign in to your account to continue";case"pin":return"";case"otp":return"Enter the verification code sent to your email";case"set_pin":return"Create a 4-digit PIN for quick access";case"forgot_pin_otp":return"Enter the code and create a new PIN";default:return""}};return Se?i.jsxs(i.Fragment,{children:[i.jsx(B5,{open:ne,onOpenChange:te,onEnable:Le,onSkip:Xe,biometricInfo:O}),i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden flex flex-col lg:flex-row",children:[i.jsx("div",{className:"flex-1 flex items-center justify-center p-4 sm:p-6 md:p-12 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:i.jsxs("div",{className:"w-full max-w-md space-y-6 sm:space-y-8 animate-fade-up",children:[!a&&i.jsx("div",{className:"mb-4",children:i.jsx(Bs,{to:"/index",className:"inline-flex items-center text-sm font-medium text-muted-foreground hover:text-foreground",children:" Back to Home"})}),i.jsxs("div",{className:"text-center lg:text-left",children:[i.jsx("div",{className:"mb-8",children:i.jsx(Xa,{size:"lg"})}),i.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:_t()}),i.jsx("p",{className:"text-muted-foreground",children:$t()})]}),D==="email"&&i.jsxs("form",{onSubmit:ve,className:"space-y-6",children:[i.jsx(In,{label:"Email",value:v,onChange:Ve=>w(Ve.target.value),type:"email",inputMode:"email"}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Please wait...":"Continue",i.jsx(ni,{className:"h-5 w-5"})]})]}),D==="pin"&&i.jsxs("form",{onSubmit:ke,className:"space-y-6",children:[M&&i.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border border-border",children:[i.jsx("p",{className:"font-medium text-foreground text-lg",children:M}),G?i.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["(",v||$,")"]}):i.jsx("button",{type:"button",onClick:()=>W(!0),className:"text-xs text-primary/70 hover:text-primary mt-1",children:"view email"})]}),(a&&my()||(O==null?void 0:O.available)&&O.hasCredentials)&&i.jsxs(de,{type:"button",variant:"outline",size:"xl",className:"w-full gap-3",onClick:a?Ye:Ce,disabled:K,children:[K?i.jsx("span",{className:"animate-spin",children:""}):(O==null?void 0:O.biometryType)==="face"?i.jsx(NO,{className:"h-6 w-6"}):i.jsx(zw,{className:"h-6 w-6"}),K?"Authenticating...":a?`Unlock with ${f0(O==null?void 0:O.biometryType)}`:`Sign in with ${f0(O==null?void 0:O.biometryType)}`]}),(a&&my()||(O==null?void 0:O.available)&&O.hasCredentials)&&i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("span",{className:"w-full border-t border-border"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or enter PIN"})})]}),i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"4-Digit PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:k,onChange:C,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]})}),!Xt.isNativePlatform()&&i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(cz,{id:"remember-me",checked:Q,onCheckedChange:Ve=>$e(Ve===!0)}),i.jsx(We,{htmlFor:"remember-me",className:"text-sm text-muted-foreground cursor-pointer",children:"Remember me"})]}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g||k.length!==4,children:[g?"Verifying...":a?"Unlock":"Sign In",i.jsx(ni,{className:"h-5 w-5"})]}),!a&&i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs(de,{type:"button",variant:"ghost",size:"sm",onClick:le,className:"text-muted-foreground",children:[i.jsx(yO,{className:"h-4 w-4 mr-1"}),"Different account"]}),i.jsx(de,{type:"button",variant:"link",onClick:Ue,disabled:g,children:"Forgot PIN?"})]})]}),D==="otp"&&i.jsxs("form",{onSubmit:be,className:"space-y-6",children:[i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"otp",children:"Verification Code"}),i.jsx(At,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:S,onChange:Ve=>_(Ve.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]})}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g||S.length!==6,children:[g?"Verifying...":"Complete Login",i.jsx(ni,{className:"h-5 w-5"})]}),i.jsx(de,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("pin"),_("")},children:"Back"})]}),D==="set_pin"&&i.jsxs("form",{onSubmit:Ee,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"setup-otp",children:"Verification Code"}),i.jsx(At,{id:"setup-otp",type:"text",placeholder:"Enter 6-digit code",value:S,onChange:Ve=>_(Ve.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Create 4-Digit PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:I,onChange:T,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Confirm PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:A,onChange:j,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]})]}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Setting up...":"Set PIN & Continue",i.jsx(ni,{className:"h-5 w-5"})]}),i.jsx(de,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("email"),_(""),T(""),j("")},children:"Back"})]}),D==="forgot_pin_otp"&&i.jsxs("form",{onSubmit:Qe,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"reset-otp",children:"Verification Code"}),i.jsx(At,{id:"reset-otp",type:"text",placeholder:"Enter 6-digit code",value:S,onChange:Ve=>_(Ve.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"New 4-Digit PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:I,onChange:T,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Confirm New PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:A,onChange:j,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]})]}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:g,children:[g?"Resetting...":"Reset PIN & Sign In",i.jsx(ni,{className:"h-5 w-5"})]}),i.jsx(de,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("pin"),_(""),T(""),j("")},children:"Back"})]}),D==="email"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("span",{className:"w-full border-t border-border"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs(de,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:V,disabled:y!==null,children:[y==="google"?i.jsx("span",{className:"animate-spin mr-2",children:""}):i.jsxs("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:[i.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),i.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),i.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),i.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]}),i.jsxs(de,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:ee,disabled:y!==null,children:[y==="linkedin"?i.jsx("span",{className:"animate-spin mr-2",children:""}):i.jsx("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"#0A66C2",children:i.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]})]}),!a&&i.jsxs("p",{className:"text-center text-muted-foreground",children:["Don't have an account?"," ",i.jsx(Bs,{to:"/signup",className:"text-primary font-medium hover:underline",children:"Sign up"})]})]})}),i.jsx("div",{className:"hidden lg:flex flex-1 gradient-bg items-center justify-center p-12",children:i.jsxs("div",{className:"max-w-md text-center space-y-6",children:[i.jsx("div",{className:"w-32 h-32 mx-auto rounded-3xl glass flex items-center justify-center animate-float",children:D==="pin"&&(O!=null&&O.available)?i.jsx(zw,{className:"w-16 h-16 text-primary-foreground/80"}):i.jsx(l2,{className:"w-16 h-16 text-primary-foreground/80"})}),i.jsx("h2",{className:"text-3xl font-bold text-primary-foreground",children:D==="pin"&&(O!=null&&O.available)?"Secure Biometric Login":"Secure PIN Login"}),i.jsx("p",{className:"text-primary-foreground/80",children:D==="pin"&&(O!=null&&O.available)?"Use your fingerprint or face to log in instantly. Or enter your 4-digit PIN.":"Quick and secure access with your 4-digit PIN. No passwords to remember."})]})})]})]}):i.jsx("div",{className:"min-h-dvh flex items-center justify-center",children:i.jsx(Xa,{})})}var uz={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},P$=Ne.createContext&&Ne.createContext(uz),Hie=["attr","size","title"];function Gie(e,t){if(e==null)return{};var n=qie(e,t),r,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function qie(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function y0(){return y0=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y0.apply(this,arguments)}function O$(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function b0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?O$(Object(n),!0).forEach(function(r){Kie(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O$(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Kie(e,t,n){return t=Yie(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yie(e){var t=Xie(e,"string");return typeof t=="symbol"?t:t+""}function Xie(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dz(e){return e&&e.map((t,n)=>Ne.createElement(t.tag,b0({key:n},t.attr),dz(t.child)))}function Zie(e){return t=>Ne.createElement(Qie,y0({attr:b0({},e.attr)},t),dz(e.child))}function Qie(e){var t=n=>{var{attr:r,size:a,title:s}=e,o=Gie(e,Hie),l=a||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),Ne.createElement("svg",y0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,o,{className:c,style:b0(b0({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&Ne.createElement("title",null,s),e.children)};return P$!==void 0?Ne.createElement(P$.Consumer,null,n=>t(n)):t(uz)}function v0(e){return Zie({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(e)}const qc=kh("Share",{web:()=>bo(()=>import("./web-D15kiAaf.js"),__vite__mapDeps([6,1,2,3])).then(e=>new e.ShareWeb)}),Jie=Object.freeze(Object.defineProperty({__proto__:null,Share:qc},Symbol.toStringTag,{value:"Module"})),hb=e=>e?e.trim().replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\s+/g,"").replace(/^@/,"").replace(/\/+$/,""):"",L$=["CEO","CFO","CTO","COO","CMO","CIO","CHRO","CLO","CPO","CSO","VP","SVP","EVP","AVP","MD","GM","ED","HR","IT","AI","ML","UI","UX","QA","PR","IR","BD","B2B","B2C","D2C","SaaS","PaaS","IaaS","USA","UK","UAE","EU","APAC","EMEA","LATAM","MBA","PhD","CPA","CFA","PMP","LLC","LLP","PLC","INC","LTD","PVT","CORP","R&D","M&A","P&L","SEO","SEM","SMM","CRM","ERP","HRM","API","SDK","SLA","KPI","ROI","OKR","AWS","GCP","IBM","SAP","HP","HCL","TCS","KPMG","PWC","EY"],Xj=e=>{if(!e||!e.trim())return"";const t=e.trim().replace(/\s+/g," "),n=["van","de","der","von","la","le","du","da","di","del","dos","das"];return t.split(" ").map((r,a)=>{const s=r.toUpperCase();return L$.includes(s)?s:r.includes("-")?r.split("-").map((o,l)=>{const c=o.toUpperCase();return L$.includes(c)?c:l>0&&n.includes(o.toLowerCase())?o.toLowerCase():o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}).join("-"):a>0&&n.includes(r.toLowerCase())?r.toLowerCase():r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()}).join(" ")},eoe=e=>Xj(e),toe=e=>Xj(e),noe=e=>Xj(e),roe=e=>!e||!e.trim()?!0:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim()),hz=e=>(e==null?void 0:e.trim().toLowerCase())||"",w0=e=>{if(!e)return"";let t=e.trim();const n=t.startsWith("+");return t=t.replace(/\D/g,""),t?t.length===10?`+91${t}`:t.startsWith("91")&&t.length===12?`+${t}`:t.startsWith("0")&&t.length===11?`+91${t.slice(1)}`:t.length>=11?n||t.startsWith("91")?`+${t.replace(/^\+/,"")}`:`+${t}`:n?`+${t}`:t:""},aoe=e=>{if(!e||!e.trim())return!0;const t=e.replace(/\D/g,"");return t.length>=10&&t.length<=15},Zj=e=>{if(!e||!e.trim())return"";let t=e.trim();if(t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\s+/g,""),!t.match(/^https?:\/\//i)){if(t.includes("@"))return t;t=`https://${t}`}return t=t.replace(/^https?:\/+/i,n=>n.toLowerCase().includes("https")?"https://":"http://"),t=t.replace(/\/+$/,""),t},soe=e=>{if(!e||!e.trim())return!0;try{const t=Zj(e);return new URL(t),!0}catch{return!1}},pz=e=>{if(!e||!e.trim())return{type:"unknown",username:"",fullUrl:""};let t=e.trim();t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/\s+/g,""),t=t.replace(/\/+$/,"");const n=t.match(/(?:https?:\/\/)?(?:www\.)?linkedin\.com\/(in|company)\/([^\/\?#]+)/i);if(n){const s=n[1].toLowerCase()==="company"?"company":"personal",o=n[2];return{type:s,username:o,fullUrl:`https://www.linkedin.com/${s==="company"?"company":"in"}/${o}`}}const r=t.match(/^(in|company)\/([^\/\?#]+)/i);if(r){const s=r[1].toLowerCase()==="company"?"company":"personal",o=r[2];return{type:s,username:o,fullUrl:`https://www.linkedin.com/${s==="company"?"company":"in"}/${o}`}}const a=t.replace(/^.*linkedin\.com\/?(in|company)?\/?/i,"").replace(/[\/\?#].*$/,"");return a?{type:"personal",username:a,fullUrl:`https://www.linkedin.com/in/${a}`}:{type:"unknown",username:"",fullUrl:""}},mz=e=>pz(e).username,ioe=e=>!e||!e.trim()?!0:pz(e).username.length>0,ooe=e=>{const t=hb(e);if(!t)return"";const n=t.match(/(?:https?:\/\/)?(?:www\.)?instagram\.com\/([^\/\?#]+)/i);return n?n[1]:t},loe=e=>{const t=hb(e);if(!t)return"";const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:twitter\.com|x\.com)\/([^\/\?#]+)/i);return n?n[1]:t},coe=e=>{const t=hb(e);if(!t)return"";const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:facebook\.com|fb\.com)\/([^\/\?#]+)/i);return n?n[1]:t},uoe=e=>{const t=hb(e);if(!t)return"";const n=t.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/(@[^\/\?#]+)/i);if(n)return n[1];const r=t.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/channel\/([^\/\?#]+)/i);return r?`channel/${r[1]}`:t.startsWith("@")||e.trim().startsWith("@")?t.startsWith("@")?t:`@${t}`:`@${t}`},doe=e=>{const t=hb(e);if(!t)return"";const n=t.match(/(?:https?:\/\/)?(?:www\.)?calendly\.com\/([^#]+)/i);return n?`https://calendly.com/${n[1]}`:`https://calendly.com/${t}`},Cw=e=>e.email&&!roe(e.email)?{isValid:!1,field:"email",message:"Invalid email address"}:e.phone&&!aoe(e.phone)?{isValid:!1,field:"phone",message:"Invalid phone number"}:e.website&&!soe(e.website)?{isValid:!1,field:"website",message:"Invalid website URL"}:e.linkedin&&!ioe(e.linkedin)?{isValid:!1,field:"linkedin",message:"Invalid LinkedIn profile"}:null,_w=e=>({...e,email:e.email?hz(e.email):e.email,phone:e.phone?w0(e.phone):e.phone,whatsapp:e.whatsapp?w0(e.whatsapp):e.whatsapp,website:e.website?Zj(e.website):e.website,linkedin:e.linkedin?mz(e.linkedin):e.linkedin}),hoe=e=>({instagram:e.instagram?ooe(e.instagram):"",twitter:e.twitter?loe(e.twitter):"",facebook:e.facebook?coe(e.facebook):"",youtube:e.youtube?uoe(e.youtube):"",calendly:e.calendly?doe(e.calendly):""}),Wx=e=>({...e,name:e.name?eoe(e.name):e.name,company:e.company?toe(e.company):e.company,designation:e.designation?noe(e.designation):e.designation,email:e.email?hz(e.email):e.email,phone:e.phone?w0(e.phone):e.phone,whatsapp:e.whatsapp?w0(e.whatsapp):e.whatsapp,website:e.website?Zj(e.website):e.website,linkedin:e.linkedin?mz(e.linkedin):e.linkedin}),fz="synka_contacts_cache",gz="contacts",poe=60*60*1e3,lS=e=>{try{const t=localStorage.getItem(`${fz}_${e}`);if(t){const{data:r,timestamp:a}=JSON.parse(t);if(Date.now()-a<poe)return r}const n=Q_(`${gz}_${e}`);if(n)return n}catch{}return[]},cS=(e,t)=>{try{localStorage.setItem(`${fz}_${e}`,JSON.stringify({data:t,timestamp:Date.now()})),Z_(`${gz}_${e}`,t)}catch{}};function moe(){const{user:e}=or(),[t,n]=N.useState(()=>e?lS(e.id):[]),[r,a]=N.useState(()=>e?lS(e.id).length===0:!1),[s,o]=N.useState(!1),[l,c]=N.useState(!1);N.useEffect(()=>{if(e){const y=lS(e.id);y.length>0?(n(y),a(!1),c(!0),d().finally(()=>c(!1))):d();const b=()=>{console.log("[Contacts] Data sync triggered - refetching"),d()};return window.addEventListener("synka:data-sync",b),()=>window.removeEventListener("synka:data-sync",b)}else n([]),a(!1),o(!1)},[e]);const d=async()=>{if(!e)return;s||a(!0);const{data:y,error:b}=await ue.from("contacts").select("*").eq("owner_id",e.id).order("created_at",{ascending:!1});if(b){console.error("Error fetching contacts:",b),n([]),a(!1),o(!0);return}const v=(y||[]).map(w=>w.id);if(v.length>0){const{data:w}=await ue.from("contact_tags").select("contact_id, tag_id, tags(id, name, color)").in("contact_id",v),{data:k}=await ue.from("contact_events").select("contact_id, event_id, events(id, title, start_time, end_time)").in("contact_id",v),C={},S={};(w||[]).forEach(I=>{C[I.contact_id]||(C[I.contact_id]=[]),I.tags&&C[I.contact_id].push(I.tags)}),(k||[]).forEach(I=>{S[I.contact_id]||(S[I.contact_id]=[]),I.events&&S[I.contact_id].push(I.events)});const _=(y||[]).map(I=>({...I,tags:C[I.id]||[],events:S[I.id]||[]}));n(_),e&&cS(e.id,_)}else n([]),e&&cS(e.id,[]);a(!1),o(!0)};return{contacts:t,loading:r,createContact:async(y,b)=>{if(!e)return{error:new Error("Not authenticated"),data:null};const v=Wx({name:y.name,company:y.company||void 0,designation:y.designation||void 0,email:y.email||void 0,phone:y.phone||void 0,whatsapp:y.whatsapp||void 0,linkedin:y.linkedin||void 0,website:y.website||void 0}),w=y.notes?[{text:y.notes,timestamp:new Date().toISOString()}]:[],{data:k,error:C}=await ue.from("contacts").insert({owner_id:e.id,name:v.name||"",company:v.company||null,designation:v.designation||null,email:v.email||null,phone:v.phone||null,whatsapp:v.whatsapp||null,linkedin:v.linkedin||null,website:v.website||null,notes_history:w,source:y.source||"manual"}).select().single();if(!C&&k){if(b&&b.length>0){const S=b.map(_=>({contact_id:k.id,event_id:_}));await ue.from("contact_events").insert(S)}await d()}return{data:k,error:C}},updateContact:async(y,b)=>{const{notes:v,tags:w,events:k,...C}=b,S={...C,...C.name!==void 0&&{name:Wx({name:C.name}).name},...C.company!==void 0&&{company:Wx({company:C.company}).company},...C.designation!==void 0&&{designation:Wx({designation:C.designation}).designation}},{error:_}=await ue.from("contacts").update(S).eq("id",y);return _||n(I=>I.map(T=>T.id===y?{...T,...S}:T)),{error:_}},deleteContact:async y=>{const{error:b}=await ue.from("contacts").delete().eq("id",y);if(!b){const v=t.filter(w=>w.id!==y);n(v),e&&cS(e.id,v)}return{error:b}},addTagToContact:async(y,b)=>{const{error:v}=await ue.from("contact_tags").insert({contact_id:y,tag_id:b});return{error:v}},removeTagFromContact:async(y,b)=>{const{error:v}=await ue.from("contact_tags").delete().eq("contact_id",y).eq("tag_id",b);return{error:v}},addEventToContact:async(y,b)=>{const{error:v}=await ue.from("contact_events").insert({contact_id:y,event_id:b});return{error:v}},removeEventFromContact:async(y,b)=>{const{error:v}=await ue.from("contact_events").delete().eq("contact_id",y).eq("event_id",b);return{error:v}},refetch:d}}async function foe(e,t){const n=Wx({name:t.name,company:t.company,designation:t.designation,email:t.email,phone:t.phone,whatsapp:t.whatsapp,linkedin:t.linkedin}),r=n.phone||n.whatsapp||null,a=n.whatsapp||n.phone||null,s=[],{data:o,error:l}=await ue.from("contacts").insert({owner_id:e,name:n.name,company:n.company||null,designation:n.designation||null,email:n.email||null,phone:r,whatsapp:a,linkedin:n.linkedin||null,notes_history:s,source:"public_form"}).select().single();if(l)return console.error("Error creating contact:",l),{error:l};if(o){const c=new Date,{data:d}=await ue.from("events").select("*").eq("user_id",e);if(d&&d.length>0){const u=d.filter(h=>{const p=new Date(h.start_time),m=h.end_time?new Date(h.end_time):p;return c>=p&&c<=m});if(u.length>0){const h=u.map(p=>({contact_id:o.id,event_id:p.id}));await ue.from("contact_events").insert(h)}}}return{data:o,error:null}}function xz(){const e=navigator.userAgent,t=`${window.screen.width}x${window.screen.height}`,n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=navigator.language,a=`${e}|${t}|${n}|${r}`;let s=0;for(let o=0;o<a.length;o++){const l=a.charCodeAt(o);s=(s<<5)-s+l,s=s&s}return Math.abs(s).toString(36)}async function goe(e,t,n="qr",r){const a=xz();await ue.from("scan_events").insert({user_id:e,card_id:t,event_id:r,source:n,device_hash:a,user_agent:navigator.userAgent})}async function z$(e,t){const n=xz();await ue.from("contact_saves").insert({user_id:e,card_id:t,device_hash:n})}function xoe(){const{user:e}=or(),[t,n]=N.useState(null),[r,a]=N.useState(!0),s=N.useCallback(async(l,c)=>{if(!e){n(null),a(!1);return}a(!0);try{const{data:d,error:u}=await ue.rpc("get_dashboard_analytics",{p_user_id:e.id,p_start_date:(l==null?void 0:l.toISOString())||null,p_end_date:(c==null?void 0:c.toISOString())||null});if(u)console.error("Error fetching analytics:",u),n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0});else if(d){const h=d;n({card_views:h.card_views??0,contact_saves:h.contact_saves??0,connections_added:h.connections_added??0,attended_events:h.attended_events??0,views_in_attended_events:h.views_in_attended_events??0})}else n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0})}catch(d){console.error("Error fetching analytics:",d),n({card_views:0,contact_saves:0,connections_added:0,attended_events:0,views_in_attended_events:0})}a(!1)},[e]),o=N.useCallback(async(l,c)=>{if(!e)return[];try{const{data:d,error:u}=await ue.rpc("get_attended_events_list",{p_user_id:e.id,p_start_date:(l==null?void 0:l.toISOString())||null,p_end_date:(c==null?void 0:c.toISOString())||null});return u?(console.error("Error fetching attended events:",u),[]):d||[]}catch(d){return console.error("Error fetching attended events:",d),[]}},[e]);return N.useEffect(()=>{s()},[s]),{analytics:t,loading:r,refetch:s,fetchAttendedEvents:o}}function yoe({slug:e}){const t=cO(),n=e||t.slug;return N.useEffect(()=>{if(Xt.isNativePlatform())return;if(!document.querySelector('meta[name="apple-itunes-app"]')){const a=document.createElement("meta");a.name="apple-itunes-app";const s=n?`synka://u/${n}`:"synka://";return a.content=`app-id=YOUR_APP_STORE_ID, app-argument=${s}`,document.head.appendChild(a),()=>{a.remove()}}},[n]),null}const boe={"#6366f1":{text:"#ffffff"},"#10b981":{text:"#ffffff"},"#f43f5e":{text:"#ffffff"},"#f59e0b":{text:"#1f2937"},"#06b6d4":{text:"#ffffff"},"#8b5cf6":{text:"#ffffff"},"#475569":{text:"#ffffff"},"#1e3a5f":{text:"#ffffff"}},B$=(e,t,n)=>Math.min(Math.max(e,t),n),voe=(e,t,n)=>{let r=e??50,a=t??38;return t!=null&&(t<25||t>65)&&(a=38),r=B$(r,35,65),a=B$(a,28,55),n&&(a=Math.min(a+8,60)),`${r}% ${a}%`},woe=["photo-logo","wave-split","minimal-circle","logo-photo","dark-professional","photo-only","logo-only","color"];function Qj({layout:e,photoUrl:t,logoUrl:n,name:r,designation:a,company:s,themeColor:o,faceX:l,faceY:c,logoX:d,logoY:u,className:h,isPhotoLoaded:p=!0}){var _;const m=woe.includes(e)?e:"photo-logo",[f,g]=N.useState(!1),[x,y]=N.useState(!1),b=p!==void 0?p:x;N.useEffect(()=>{if(!t){g(!1),y(!0);return}y(!1),g(!1);const I=new Image;I.onload=()=>{y(!0);const A=I.height/I.width;g(A>1.1)},I.onerror=()=>{y(!0)},I.src=t;const T=setTimeout(()=>{I.complete||y(!0)},3e3);return()=>clearTimeout(T)},[t]);const v=I=>I.split(" ").filter(Boolean).map(T=>T[0]).join("").toUpperCase().slice(0,2)||"U",w=o&&((_=boe[o])==null?void 0:_.text)||"#ffffff",k=()=>`${d??50}% ${u??50}%`,C=voe(l,c,f),S=k();return m==="photo-logo"?i.jsx("div",{className:Ie("w-full overflow-hidden rounded-3xl",h),children:i.jsx("div",{className:"w-full h-80 md:h-96 relative overflow-hidden bg-muted",children:t?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-2xl scale-125 opacity-50 transition-opacity duration-300",!b&&"opacity-0")}),i.jsx("img",{src:t,alt:r,className:Ie("relative z-10 w-full h-full object-cover transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{b||y(!0)}})]}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-6xl font-bold text-muted-foreground/40",children:v(r)})})})}):m==="wave-split"?i.jsxs("div",{className:Ie("relative w-full",h),children:[i.jsx("div",{className:"w-full h-80 md:h-96 overflow-hidden relative bg-muted",children:t?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-2xl scale-125 opacity-50 transition-opacity duration-300",!b&&"opacity-0")}),i.jsx("img",{src:t,alt:r,className:Ie("relative z-10 w-full h-full object-cover transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{b||y(!0)}})]}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-6xl font-bold text-muted-foreground/40",children:v(r)})})}),i.jsx("svg",{className:"absolute bottom-[-1px] left-0 w-full z-20",viewBox:"0 0 400 50",preserveAspectRatio:"none",children:i.jsx("path",{d:"M0,25 Q100,50 200,25 T400,25 L400,50 L0,50 Z",className:"fill-background"})})]}):m==="minimal-circle"?i.jsx("div",{className:Ie("flex justify-center pt-4",h),children:i.jsx("div",{className:"w-28 h-28 rounded-full overflow-hidden border-4 border-primary/20 shadow-lg bg-primary/10",children:t?i.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{b||y(!0)}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-3xl font-bold text-primary",children:v(r)})})})}):m==="logo-photo"?i.jsx("div",{className:Ie("w-full flex justify-center pt-6 pb-4",h),children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"w-44 h-44 rounded-3xl overflow-hidden shadow-lg bg-muted",children:n?i.jsx("img",{src:n,alt:"Logo",className:"w-full h-full object-cover",style:{objectPosition:S}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:"LOGO"})})}),t&&i.jsx("div",{className:"absolute -bottom-3 -left-3 w-16 h-16 rounded-full overflow-hidden border-2 border-white shadow-lg bg-white",children:i.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{b||y(!0)}})})]})}):m==="dark-professional"?i.jsxs("div",{className:Ie("relative w-full h-72 rounded-3xl bg-muted",h),children:[i.jsx("div",{className:`
            absolute inset-0
            overflow-hidden
            rounded-3xl

            md:left-12
            md:right-12
          `,children:t&&i.jsx("img",{src:t,"aria-hidden":!0,className:Ie("absolute inset-0 w-full h-full object-cover blur-xl scale-110 opacity-70 transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C}})}),i.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 z-10",children:t?i.jsx("img",{src:t,alt:r,className:Ie("max-h-full max-w-full object-contain rounded-2xl shadow-xl transition-opacity duration-300",!b&&"opacity-0"),onLoad:()=>{b||y(!0)}}):i.jsx("div",{className:"w-32 h-32 rounded-2xl bg-muted-foreground/20 flex items-center justify-center",children:i.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:v(r)})})}),n&&i.jsx("div",{className:`
              absolute bottom-4 right-4
              md:right-16
              w-12 h-12
              rounded-full overflow-hidden
              shadow-lg z-20
              bg-black/20 backdrop-blur-md
            `,children:i.jsx("img",{src:n,alt:"Logo",className:"w-full h-full object-contain"})})]}):m==="photo-only"?i.jsx("div",{className:Ie("relative w-full rounded-3xl overflow-hidden",h),children:t?i.jsxs(i.Fragment,{children:[i.jsx("img",{src:t,"aria-hidden":!0,className:"absolute inset-0 w-full h-full object-cover blur-3xl scale-125 opacity-60",style:{objectPosition:C}}),i.jsx("div",{className:"relative z-10 p-6",children:i.jsx("img",{src:t,alt:r,className:"w-full h-auto object-contain rounded-2xl shadow-2xl"})}),i.jsxs("div",{className:"absolute bottom-4 left-0 right-0 px-6 text-center z-20 pointer-events-none",children:[i.jsx("h2",{className:"text-xl font-semibold text-white drop-shadow-md",children:r}),(a||s)&&i.jsxs("p",{className:"text-sm text-white/90 mt-1 drop-shadow-sm",children:[a,a&&s&&i.jsx("span",{className:"mx-1 opacity-70",children:""}),s]})]})]}):i.jsx("div",{className:"w-full h-80 flex items-center justify-center bg-muted",children:i.jsx("span",{className:"text-4xl font-bold text-muted-foreground",children:v(r)})})}):m==="logo-only"?i.jsx("div",{className:Ie("w-full rounded-3xl overflow-hidden bg-transparent flex justify-center pt-6 pb-4",h),children:t?i.jsx("div",{className:"w-36 h-36 rounded-3xl overflow-hidden shadow-lg bg-muted",children:i.jsx("img",{src:t,alt:r,className:Ie("w-full h-full object-cover transition-opacity duration-300",!b&&"opacity-0"),style:{objectPosition:C,transition:"object-position 0.4s ease-out, opacity 0.3s ease-in"},onLoad:()=>{b||y(!0)}})}):i.jsx("div",{className:"w-36 h-36 rounded-3xl bg-muted flex items-center justify-center",children:i.jsx("span",{className:"text-3xl font-bold text-muted-foreground",children:v(r)})})}):m==="color"&&o?i.jsx("div",{className:Ie("w-full rounded-3xl overflow-hidden bg-transparent flex justify-center pt-6 pb-4",h),children:i.jsx("div",{className:"w-36 h-36 rounded-3xl flex items-center justify-center shadow-lg",style:{backgroundColor:o},children:i.jsx("span",{className:"text-3xl font-bold select-none",style:{color:w},children:v(r)})})}):null}function Noe(e,t=[]){let n=[];function r(s,o){const l=N.createContext(o);l.displayName=s+"Context";const c=n.length;n=[...n,o];const d=h=>{var y;const{scope:p,children:m,...f}=h,g=((y=p==null?void 0:p[e])==null?void 0:y[c])||l,x=N.useMemo(()=>f,Object.values(f));return i.jsx(g.Provider,{value:x,children:m})};d.displayName=s+"Provider";function u(h,p){var g;const m=((g=p==null?void 0:p[e])==null?void 0:g[c])||l,f=N.useContext(m);if(f)return f;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[d,u]}const a=()=>{const s=n.map(o=>N.createContext(o));return function(l){const c=(l==null?void 0:l[e])||s;return N.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return a.scopeName=e,[r,koe(a,...t)]}function koe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(s){const o=r.reduce((l,{useScope:c,scopeName:d})=>{const h=c(s)[`__scope${d}`];return{...l,...h}},{});return N.useMemo(()=>({[`__scope${t.scopeName}`]:o}),[o])}};return n.scopeName=t.scopeName,n}var Soe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],yz=Soe.reduce((e,t)=>{const n=sb(`Primitive.${t}`),r=N.forwardRef((a,s)=>{const{asChild:o,...l}=a,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),Jj="Progress",eI=100,[Coe]=Noe(Jj),[_oe,joe]=Coe(Jj),bz=N.forwardRef((e,t)=>{const{__scopeProgress:n,value:r=null,max:a,getValueLabel:s=Ioe,...o}=e;(a||a===0)&&!W$(a)&&console.error(Toe(`${a}`,"Progress"));const l=W$(a)?a:eI;r!==null&&!U$(r,l)&&console.error(Eoe(`${r}`,"Progress"));const c=U$(r,l)?r:null,d=N0(c)?s(c,l):void 0;return i.jsx(_oe,{scope:n,value:c,max:l,children:i.jsx(yz.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":N0(c)?c:void 0,"aria-valuetext":d,role:"progressbar","data-state":Nz(c,l),"data-value":c??void 0,"data-max":l,...o,ref:t})})});bz.displayName=Jj;var vz="ProgressIndicator",wz=N.forwardRef((e,t)=>{const{__scopeProgress:n,...r}=e,a=joe(vz,n);return i.jsx(yz.div,{"data-state":Nz(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:t})});wz.displayName=vz;function Ioe(e,t){return`${Math.round(e/t*100)}%`}function Nz(e,t){return e==null?"indeterminate":e===t?"complete":"loading"}function N0(e){return typeof e=="number"}function W$(e){return N0(e)&&!isNaN(e)&&e>0}function U$(e,t){return N0(e)&&!isNaN(e)&&e<=t&&e>=0}function Toe(e,t){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${t}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${eI}\`.`}function Eoe(e,t){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${t}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${eI} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var kz=bz,Aoe=wz;const Sz=N.forwardRef(({className:e,value:t,...n},r)=>i.jsx(kz,{ref:r,className:Ie("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...n,children:i.jsx(Aoe,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})}));Sz.displayName=kz.displayName;const Roe=5*1024*1024;function jw({documentName:e,documentUrl:t,isEditMode:n=!1,userId:r,cardId:a,isPremium:s=!1,onUpdate:o}){const[l,c]=N.useState(!1),[d,u]=N.useState(0),[h,p]=N.useState(e||""),m=N.useRef(null);N.useEffect(()=>{p(e||"")},[e]);const f=async()=>{if(!o||!s)return;const k=h.trim();k!==(e||"")&&await o({document_name:k||null})},g=k=>k.type!=="application/pdf"?"Only PDF files are allowed":k.size>Roe?"Upload a file upto 5 MB":null,x=async(k,C)=>{var I;if(u(30),t)try{const T=(I=t.split("/documents/")[1])==null?void 0:I.split("?")[0];T&&await ue.storage.from("documents").remove([T])}catch{}u(50);const{error:S}=await ue.storage.from("documents").upload(C,k,{upsert:!0,contentType:"application/pdf",cacheControl:"0"});if(S)throw new Error(S.message);u(90);const{data:_}=ue.storage.from("documents").getPublicUrl(C);return u(100),`${_.publicUrl}?t=${Date.now()}`},y=()=>{var k;if(!s){ie({title:"Upgrade to Orange",description:"Upgrade to Orange to unlock document uploads."});return}(k=m.current)==null||k.click()},b=async k=>{if(!r||!a||!o||!s)return;const C=g(k);if(C){ie({title:"Upload failed",description:C,variant:"destructive"});return}c(!0),u(0);try{const S=`${r}/${a}-document-${Date.now()}.pdf`,_=await x(k,S);await o({document_name:h.trim()||null,document_url:_}),ie({title:"Document uploaded",description:"Your document has been saved."})}catch(S){ie({title:"Upload failed",description:(S==null?void 0:S.message)||"Could not upload document.",variant:"destructive"})}finally{c(!1),u(0)}},v=async()=>{var k;if(!(!o||!s)){if(t)try{const C=(k=t.split("/documents/")[1])==null?void 0:k.split("?")[0];C&&await ue.storage.from("documents").remove([C])}catch{}await o({document_name:null,document_url:null}),p(""),m.current&&(m.current.value=""),ie({title:"Document removed"})}},w=k=>{var S;const C=(S=k.target.files)==null?void 0:S[0];C&&b(C),k.target.value=""};return!n&&!t?null:n?i.jsxs("div",{className:"space-y-4",children:[i.jsx(We,{className:"font-semibold",children:"Document"}),i.jsxs("div",{className:"flex flex-col gap-3 p-3 rounded-xl bg-muted/50",children:[i.jsx(At,{placeholder:"e.g. Pitch Deck, Catalogue, Menu...",value:h,onChange:k=>p(k.target.value),onBlur:f,disabled:!s,className:"text-sm"}),t&&s&&i.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-3 p-3 rounded-lg bg-background/60 border border-border/40",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-sm font-medium truncate",children:h||"Document"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF  Tap to view"})]}),i.jsx(_X,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs("div",{className:t?"flex items-center justify-end gap-2":"flex justify-center",children:[!t&&i.jsxs(de,{type:"button",variant:"outline",size:"sm",onClick:y,disabled:l,children:[!s&&i.jsx(mo,{className:"h-3 w-3 mr-1"}),i.jsx(Fo,{className:"h-3 w-3 mr-1"}),"Upload a PDF"]}),t&&s&&i.jsxs(i.Fragment,{children:[i.jsxs(de,{type:"button",variant:"ghost",size:"sm",onClick:y,disabled:l,children:[i.jsx(ib,{className:"h-3.5 w-3.5 mr-1"}),"Replace"]}),i.jsxs(de,{type:"button",variant:"ghost",size:"sm",onClick:v,className:"text-destructive",children:[i.jsx(ti,{className:"h-3.5 w-3.5 mr-1"}),"Remove"]})]})]}),l&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Sz,{value:d,className:"flex-1 h-2"}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:[d,"%"]})]}),i.jsx("input",{ref:m,type:"file",accept:"application/pdf",className:"hidden",onChange:w})]})]}):i.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:`group flex items-center gap-4 px-4 py-3 rounded-2xl
                 active:scale-[0.98]
                 transition-all duration-150
                 hover:bg-muted/30`,children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:i.jsx(jX,{className:"h-5 w-5 text-foreground"})}),i.jsx("p",{className:"text-[15px] font-medium text-foreground truncate",children:e||"Document"})]})}const Doe={instagram:()=>i.jsxs("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5"}),i.jsx("circle",{cx:"12",cy:"12",r:"4"}),i.jsx("circle",{cx:"17.5",cy:"6.5",r:"1.5",fill:"currentColor",stroke:"none"})]}),youtube:()=>i.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),twitter:()=>i.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),facebook:()=>i.jsx("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),calendly:()=>i.jsxs("svg",{className:"h-[18px] w-[18px]",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M19.655 14.262c-.124.209-.258.41-.402.603a6.642 6.642 0 0 1-2.126 1.876c-.259.153-.53.29-.81.41-.592.255-1.23.427-1.89.51a6.6 6.6 0 0 1-2.088-.067 6.672 6.672 0 0 1-4.808-3.803 6.636 6.636 0 0 1-.507-1.795 6.596 6.596 0 0 1 .142-2.347 6.65 6.65 0 0 1 1.338-2.645 6.674 6.674 0 0 1 2.081-1.673c.262-.135.533-.253.812-.354a6.598 6.598 0 0 1 2.976-.4c.68.07 1.335.24 1.95.5.288.122.567.262.836.42a6.664 6.664 0 0 1 2.094 1.872c.145.195.28.398.404.609l2.407-1.39a9.322 9.322 0 0 0-1.28-1.727 9.419 9.419 0 0 0-2.623-2.006 9.294 9.294 0 0 0-1.596-.695 9.353 9.353 0 0 0-5.848-.02 9.32 9.32 0 0 0-3.096 1.673 9.387 9.387 0 0 0-2.317 2.755 9.344 9.344 0 0 0-1.053 3.164 9.324 9.324 0 0 0 .088 3.293 9.342 9.342 0 0 0 1.059 2.81 9.39 9.39 0 0 0 1.885 2.297 9.41 9.41 0 0 0 2.508 1.652 9.303 9.303 0 0 0 2.9.786 9.346 9.346 0 0 0 2.948-.096 9.306 9.306 0 0 0 2.679-.923 9.388 9.388 0 0 0 2.996-2.617 9.326 9.326 0 0 0 1.29-1.993l-2.404-1.389z"}),i.jsx("path",{d:"M14.07 10.312a2.362 2.362 0 0 0-2.058-1.2 2.367 2.367 0 0 0-2.059 1.2 2.362 2.362 0 0 0 0 2.376 2.367 2.367 0 0 0 2.059 1.2 2.362 2.362 0 0 0 2.058-1.2 2.36 2.36 0 0 0 0-2.376z"})]})},Moe={instagram:"Instagram",youtube:"YouTube",twitter:"Twitter",facebook:"Facebook",calendly:"Book a meeting"},$oe=(e,t)=>{if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;switch(e){case"instagram":return`https://www.instagram.com/${t}`;case"twitter":return`https://x.com/${t}`;case"facebook":return`https://www.facebook.com/${t}`;case"youtube":return t.startsWith("@")||t.startsWith("channel/")?`https://www.youtube.com/${t}`:`https://www.youtube.com/@${t}`;case"calendly":return`https://calendly.com/${t}`;default:return t}};function Go({platform:e,url:t,className:n}){if(!t)return null;const r=Doe[e],a=Moe[e],s=$oe(e,t);return i.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"group block",children:[i.jsxs("div",{className:Ie("flex items-center gap-4 px-4 py-3",n),children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:i.jsx(r,{})}),i.jsx("p",{className:"text-[15px] font-medium text-foreground truncate flex-1",children:a})]}),i.jsx("div",{className:"ml-[72px] h-px bg-border/40 group-last:hidden"})]})}function Cz(e){const t=["BEGIN:VCARD","VERSION:3.0"];if(e.name&&t.push(`FN:${e.name}`),e.name){const n=e.name.trim().split(/\s+/),r=n.length>1?n.pop():"",a=n.join(" ")||e.name;t.push(`N:${r};${a};;;`)}if(e.company&&t.push(`ORG:${e.company}`),e.designation&&t.push(`TITLE:${e.designation}`),e.phone&&t.push(`TEL;TYPE=CELL,VOICE:${e.phone}`),e.whatsapp&&e.whatsapp!==e.phone&&t.push(`TEL;TYPE=CELL:${e.whatsapp}`),e.email&&t.push(`EMAIL;TYPE=INTERNET,WORK:${e.email}`),e.website){const n=e.website.startsWith("http")?e.website:`https://${e.website}`;t.push(`URL:${n}`)}if(e.about){const n=e.about.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n");t.push(`NOTE:${n}`)}return e.photo_url&&t.push(`PHOTO;VALUE=URI:${e.photo_url}`),t.push("END:VCARD"),t.join(`\r
`)}async function Foe(e){try{const{Contacts:t,PhoneType:n,EmailType:r}=await bo(async()=>{const{Contacts:p,PhoneType:m,EmailType:f}=await import("./index-BrBMbTJs.js");return{Contacts:p,PhoneType:m,EmailType:f}},__vite__mapDeps([7,1,2,3])),a=await t.requestPermissions();if(console.log("Contact permission status:",a),a.contacts!=="granted")return console.log("Contact permission not granted"),!1;const s=e.name.trim().split(/\s+/),o=s.length>1?s.pop():"",l=s.join(" ")||e.name,c=[];e.phone&&c.push({type:n.Mobile,number:e.phone}),e.whatsapp&&e.whatsapp!==e.phone&&c.push({type:n.Mobile,number:e.whatsapp});const d=[];e.email&&d.push({type:r.Work,address:e.email});const u=[];e.website&&u.push(e.website.startsWith("http")?e.website:`https://${e.website}`),console.log("Creating contact:",{givenName:l,familyName:o,company:e.company});const h=await t.createContact({contact:{name:{given:l,family:o||""},organization:e.company?{company:e.company,jobTitle:e.designation||void 0}:void 0,phones:c.length>0?c:void 0,emails:d.length>0?d:void 0,urls:u.length>0?u:void 0,note:e.about||void 0}});return console.log("Contact created successfully:",h),await Zn.success(),!0}catch(t){return console.error("Native contact save error:",t),!1}}async function Poe(e){try{const{Share:t}=await bo(async()=>{const{Share:l}=await Promise.resolve().then(()=>Jie);return{Share:l}},void 0),{Filesystem:n,Directory:r}=await bo(async()=>{const{Filesystem:l,Directory:c}=await Promise.resolve().then(()=>xhe);return{Filesystem:l,Directory:c}},void 0),a=Cz(e),s=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}.vcf`,o=await n.writeFile({path:s,data:btoa(unescape(encodeURIComponent(a))),directory:r.Cache});return console.log("vCard written to:",o.uri),await t.share({title:`${e.name} Contact`,files:[o.uri],dialogTitle:"Save Contact"}),await Zn.light(),!0}catch(t){return console.error("Share API vCard error:",t),!1}}function V$(e){return new Promise((t,n)=>{try{const r=Cz(e),a=/iPad|iPhone|iPod/.test(navigator.userAgent),s=/Android/.test(navigator.userAgent),o=`${e.name.replace(/[^a-zA-Z0-9]/g,"_")}.vcf`,l=new Blob([r],{type:"text/vcard;charset=utf-8"});if(a){const c=new FileReader;c.onload=()=>{const d=c.result,u=document.createElement("a");u.href=d,u.download=o,u.style.display="none",document.body.appendChild(u),u.click(),setTimeout(()=>{document.body.removeChild(u),t()},100)},c.onerror=()=>n(new Error("Failed to read vCard")),c.readAsDataURL(l)}else if(s){const c=URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=o,d.style.display="none",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),URL.revokeObjectURL(c),t()},100)}else{const c=URL.createObjectURL(l),d=document.createElement("a");d.href=c,d.download=o,d.click(),URL.revokeObjectURL(c),t()}}catch(r){n(r)}})}async function Ooe(e){if(console.log("saveContactToPhone called, isNative:",Xt.isNativePlatform()),Xt.isNativePlatform()){const t=await Foe(e);if(console.log("Native contact save result:",t),t)return{success:!0,method:"native"};console.log("Native save failed, trying Share API vCard");const n=await Poe(e);if(console.log("Share API vCard result:",n),n)return{success:!0,method:"share"};console.log("Share API failed, using web vCard download");try{return await V$(e),{success:!0,method:"vcard"}}catch(r){return console.error("vCard download failed:",r),{success:!1,method:"vcard"}}}try{return await V$(e),{success:!0,method:"vcard"}}catch(t){return console.error("vCard download failed:",t),{success:!1,method:"vcard"}}}const uS=768;function tI(){const[e,t]=N.useState(void 0);return N.useEffect(()=>{const n=window.matchMedia(`(max-width: ${uS-1}px)`),r=()=>{t(window.innerWidth<uS)};return n.addEventListener("change",r),t(window.innerWidth<uS),()=>n.removeEventListener("change",r)},[]),!!e}const dS=({label:e,value:t,onChange:n,type:r="text",inputMode:a,autoComplete:s})=>i.jsxs("div",{className:"relative h-14",children:[i.jsx("input",{name:`field-${e.replace(/\s/g,"").toLowerCase()}`,type:r,inputMode:a,autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,"data-form-type":"other",enterKeyHint:"next",value:t,onChange:n,placeholder:" ",className:"peer absolute inset-0 w-full h-full px-4 pt-4 pb-2 text-base bg-transparent outline-none rounded-xl border border-border focus:border-foreground",style:{fontSize:"16px"}}),i.jsx("label",{className:`absolute left-4 text-muted-foreground pointer-events-none
          top-0 -translate-y-1/2 text-xs bg-background
          peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-base peer-placeholder-shown:bg-transparent
          peer-focus:top-0 peer-focus:text-xs peer-focus:bg-background`,children:e})]}),H$=({label:e,value:t,onChange:n})=>i.jsxs("div",{className:"relative h-10",children:[i.jsx("input",{name:`pill-${e.replace(/\s/g,"").toLowerCase()}`,autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,"data-form-type":"other",enterKeyHint:"next",value:t,onChange:n,placeholder:" ",className:"peer w-full h-full rounded-full border border-border px-4 text-sm outline-none bg-transparent focus:border-foreground",style:{fontSize:"16px"}}),i.jsx("label",{className:`absolute left-4 text-muted-foreground pointer-events-none
          top-0 -translate-y-1/2 text-[10px] bg-background
          peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-sm peer-placeholder-shown:bg-transparent
          peer-focus:top-0 peer-focus:text-[10px] peer-focus:bg-background`,children:e})]}),_z=[{code:"+91",country:"India"},{code:"+1",country:"United States"},{code:"+44",country:"United Kingdom"},{code:"+61",country:"Australia"},{code:"+971",country:"UAE"},{code:"+966",country:"Saudi Arabia"},{code:"+65",country:"Singapore"},{code:"+81",country:"Japan"},{code:"+86",country:"China"},{code:"+82",country:"South Korea"},{code:"+49",country:"Germany"},{code:"+33",country:"France"},{code:"+39",country:"Italy"},{code:"+34",country:"Spain"},{code:"+31",country:"Netherlands"},{code:"+41",country:"Switzerland"},{code:"+46",country:"Sweden"},{code:"+47",country:"Norway"},{code:"+45",country:"Denmark"},{code:"+358",country:"Finland"},{code:"+43",country:"Austria"},{code:"+32",country:"Belgium"},{code:"+48",country:"Poland"},{code:"+420",country:"Czech Republic"},{code:"+36",country:"Hungary"},{code:"+351",country:"Portugal"},{code:"+30",country:"Greece"},{code:"+353",country:"Ireland"},{code:"+7",country:"Russia"},{code:"+380",country:"Ukraine"},{code:"+90",country:"Turkey"},{code:"+972",country:"Israel"},{code:"+20",country:"Egypt"},{code:"+27",country:"South Africa"},{code:"+234",country:"Nigeria"},{code:"+254",country:"Kenya"},{code:"+55",country:"Brazil"},{code:"+52",country:"Mexico"},{code:"+54",country:"Argentina"},{code:"+57",country:"Colombia"},{code:"+56",country:"Chile"},{code:"+51",country:"Peru"},{code:"+58",country:"Venezuela"},{code:"+60",country:"Malaysia"},{code:"+62",country:"Indonesia"},{code:"+63",country:"Philippines"},{code:"+66",country:"Thailand"},{code:"+84",country:"Vietnam"},{code:"+92",country:"Pakistan"},{code:"+880",country:"Bangladesh"},{code:"+94",country:"Sri Lanka"},{code:"+977",country:"Nepal"},{code:"+64",country:"New Zealand"},{code:"+974",country:"Qatar"},{code:"+968",country:"Oman"},{code:"+973",country:"Bahrain"},{code:"+965",country:"Kuwait"}];function Loe(e){if(!e)return null;const t=e.replace(/[\s\-()]/g,"");if(!t)return null;const n=[..._z].sort((a,s)=>s.code.length-a.code.length),r=t.startsWith("+")?t:"+"+t;for(const{code:a}of n)if(r.startsWith(a)){const s=r.slice(a.length).replace(/\D/g,"");if(s.length>0)return{code:a,number:s}}return{code:"",number:t.replace(/\D/g,"")}}function zoe({open:e,onOpenChange:t,ownerName:n,ownerPhotoUrl:r,onSubmit:a,onSkip:s}){const o=tI(),l=N.useRef(null),[c,d]=N.useState(!1),[u,h]=N.useState(!1);N.useEffect(()=>{if(e)h(!0),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden";else{const _=setTimeout(()=>h(!1),300);return document.body.style.overflow="",document.documentElement.style.overflow="",()=>clearTimeout(_)}return()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}},[e]);const[p,m]=N.useState("idle"),[f,g]=N.useState("+91"),[x,y]=N.useState({firstName:"",lastName:"",email:"",phone:"",designation:"",company:"",linkedin:""}),b=async()=>{if(!x.firstName.trim()){ie({title:"First name is required",variant:"destructive"});return}d(!0);try{const _=x.phone.trim()?`${f}${x.phone.trim()}`:"";await a({...x,phone:_}),t(!1),y({firstName:"",lastName:"",email:"",phone:"",designation:"",company:"",linkedin:""})}catch(_){console.error("Submit error:",_)}finally{d(!1)}},v=()=>{s(),t(!1)},w=()=>{var _;(_=l.current)==null||_.click()},k=async _=>{var T;const I=(T=_.target.files)==null?void 0:T[0];if(I){m("uploading");try{const[{fileToOptimizedBase64:A}]=await Promise.all([bo(()=>Promise.resolve().then(()=>iKe),void 0)]);m("processing");const j=await A(I),{data:D,error:F}=await ue.functions.invoke("scan-business-card",{body:{image:j}});if(F)throw F;if(D!=null&&D.success&&(D!=null&&D.contact)){const B=D.contact,q=(B.name||"").split(" "),$=q[0]||"",L=q.slice(1).join(" ")||"";if(m("success"),B.phone){const M=Loe(B.phone);M&&(M.code&&g(M.code),y(X=>({...X,phone:M.number})))}y(M=>({...M,firstName:$||M.firstName,lastName:L||M.lastName,email:B.email||M.email,designation:B.designation||M.designation,company:B.company||M.company})),ie({title:"Card scanned!",description:"Details filled in. Please review."}),setTimeout(()=>m("idle"),2e3)}else m("failed"),ie({title:"Couldn't read card",description:"Please enter details manually.",variant:"destructive"}),setTimeout(()=>m("idle"),2e3)}catch(A){console.error("Scan error:",A),m("failed"),ie({title:"Scan failed",description:"Please enter details manually.",variant:"destructive"}),setTimeout(()=>m("idle"),2e3)}_.target.value=""}},C=()=>i.jsx(i.Fragment,{children:i.jsxs("div",{className:"px-4 pt-5 pb-4",style:{transform:"translateY(calc(var(--scrollY, 0px) * -0.2))"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-5",children:[i.jsxs("button",{onClick:w,disabled:p==="uploading"||p==="processing",className:"flex items-center gap-1.5 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[i.jsx(ty,{className:"w-4 h-4"}),i.jsx("span",{className:"font-medium",children:"Scan"})]}),i.jsx("button",{onClick:v,className:"text-sm font-semibold text-foreground hover:text-muted-foreground transition-colors",children:"Skip"})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsxs("div",{className:"relative flex-shrink-0",children:[r?i.jsx("img",{src:r,alt:n,className:"w-16 h-16 rounded-2xl object-cover border-2 border-background shadow-sm"}):i.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center border-2 border-background shadow-sm",children:i.jsx("span",{className:"text-xl font-semibold text-primary",children:n.charAt(0).toUpperCase()})}),i.jsx("div",{className:"absolute -bottom-1 -right-1 w-7 h-7 bg-background rounded-full shadow-md flex items-center justify-center border border-border",children:i.jsx(kO,{className:"w-3.5 h-3.5 text-destructive"})})]}),i.jsx("div",{className:"flex-1 min-w-0",children:i.jsxs("h2",{className:"text-[18px] font-bold text-foreground leading-tight -mt-0.5 break-words",children:["Share your contact information with ",n]})})]})]})}),S=i.jsxs(i.Fragment,{children:[i.jsx("input",{ref:l,type:"file",accept:"image/*",capture:"environment",onChange:k,className:"hidden"}),i.jsxs("div",{className:"space-y-4 px-4 pb-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(dS,{label:"First name",value:x.firstName,onChange:_=>y(I=>({...I,firstName:_.target.value}))}),i.jsx(dS,{label:"Last name",value:x.lastName,onChange:_=>y(I=>({...I,lastName:_.target.value}))})]}),i.jsx("div",{className:"grid grid-cols-1",children:i.jsx(dS,{label:"Email",value:x.email,onChange:_=>y(I=>({...I,email:_.target.value}))})}),i.jsxs("div",{className:"relative h-14 rounded-xl border border-border focus-within:border-foreground flex items-center",children:[i.jsx("div",{className:"flex items-center justify-center pl-3 pr-1 shrink-0 border-r border-border/50 h-full",children:i.jsx("select",{name:"field-country",value:f,onChange:_=>g(_.target.value),autoComplete:"off","data-form-type":"other",className:"bg-transparent text-sm font-medium outline-none appearance-none cursor-pointer",style:{fontSize:"14px"},children:_z.map(({code:_})=>i.jsx("option",{value:_,className:"bg-background text-foreground",children:_},_))})}),i.jsx("input",{name:"field-phone",type:"tel",inputMode:"numeric",autoComplete:"off",autoCorrect:"off",autoCapitalize:"none",spellCheck:!1,"data-form-type":"other",enterKeyHint:"done",value:x.phone,onChange:_=>y(I=>({...I,phone:_.target.value.replace(/\D/g,"")})),placeholder:" ",className:"peer flex-1 min-w-0 h-full px-3 pt-4 pb-2 text-base bg-transparent outline-none",style:{fontSize:"16px",scrollMarginTop:16}}),i.jsx("label",{className:`absolute left-[72px] text-muted-foreground pointer-events-none
      top-0 -translate-y-1/2 text-xs bg-background px-1
      peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-base peer-placeholder-shown:bg-transparent peer-placeholder-shown:px-0
      peer-focus:top-0 peer-focus:text-xs peer-focus:bg-background peer-focus:px-1`,children:"Phone number"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsx(H$,{label:"Role",value:x.designation,onChange:_=>y(I=>({...I,designation:_.target.value}))}),i.jsx(H$,{label:"Company Name",value:x.company,onChange:_=>y(I=>({...I,company:_.target.value}))})]})]})]});return o&&u?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`fixed inset-0 z-40 transition-opacity duration-300 ${e?"bg-black/30 opacity-100":"bg-black/0 opacity-0"}`,onClick:()=>t(!1)}),i.jsx("div",{className:"fixed inset-x-0 bottom-0 z-50 flex justify-center pointer-events-none",children:i.jsxs("div",{className:`w-full max-w-md bg-background rounded-t-3xl shadow-2xl pointer-events-auto overflow-hidden
              transform transition-all duration-300 ease-[cubic-bezier(0.22,1,0.36,1)]
              ${e?"translate-y-0 opacity-100":"translate-y-full opacity-0"}
            `,children:[i.jsxs("div",{className:`overflow-y-auto transition-all duration-500 delay-100
                ${e?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}
              `,style:{WebkitOverflowScrolling:"touch",maxHeight:"calc(85dvh - 120px)"},onScroll:_=>{const I=_.currentTarget.scrollTop;_.currentTarget.style.setProperty("--scrollY",`${Math.min(I,20)}px`)},children:[i.jsx(C,{}),S]}),i.jsxs("div",{className:"px-4 pt-5 border-t bg-background",style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 12px)"},children:[i.jsx(de,{onClick:b,disabled:c,variant:"gradient",className:"w-full h-14 rounded-xl text-white text-base font-medium active:scale-[0.98] transition-transform",children:c?"Sending...":"Send"}),i.jsx("p",{className:"text-[11px] text-center text-muted-foreground/70 mt-3",children:"We don't sell your contact details"})]})]})})]}):i.jsx(vn,{open:e,onOpenChange:t,children:i.jsxs(mn,{className:"sm:max-w-md p-0 overflow-hidden",hideCloseButton:!0,children:[i.jsx(C,{}),S]})})}function Boe({open:e,onOpenChange:t,ownerName:n,ownerPhotoUrl:r,sharedBack:a}){const[s,o]=N.useState(!1),[l,c]=N.useState(!1);N.useEffect(()=>{if(e){o(!0),c(!1);const u=setTimeout(()=>{d()},4e3);return()=>clearTimeout(u)}},[e]);const d=()=>{c(!0),setTimeout(()=>{o(!1),t(!1)},300)};return s?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:Ie("fixed inset-0 z-50 bg-black/20 backdrop-blur-[2px] transition-opacity duration-300",l?"opacity-0":"opacity-100"),onClick:d}),i.jsx("div",{className:Ie("fixed bottom-0 left-0 right-0 z-50 mx-auto max-w-lg px-4 pb-[calc(1rem+env(safe-area-inset-bottom))] transition-all duration-300 ease-out",l?"translate-y-full opacity-0":"translate-y-0 opacity-100"),children:i.jsxs("div",{className:"bg-card/98 backdrop-blur-xl rounded-2xl border border-border/40 shadow-[0_-10px_40px_rgba(0,0,0,0.12)] overflow-hidden",children:[i.jsx("div",{className:"p-5",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"relative flex-shrink-0",children:r?i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:r,alt:n,className:"w-14 h-14 rounded-full object-cover border-2 border-primary/20"}),i.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full bg-primary flex items-center justify-center shadow-lg",children:i.jsx(dn,{className:"h-3.5 w-3.5 text-primary-foreground",strokeWidth:3})})]}):i.jsx("div",{className:"w-14 h-14 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(dn,{className:"h-7 w-7 text-primary"})})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-base font-semibold text-foreground",children:"Connected on Synka"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:"Contact saved to your CRM"}),a&&i.jsx("p",{className:"text-xs text-primary/80 mt-1",children:" Your card was shared back"})]}),i.jsx(Bs,{to:"/crm",onClick:d,className:"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-full bg-muted/50 hover:bg-muted transition-colors",children:i.jsx(ni,{className:"h-4 w-4 text-foreground/70"})})]})}),i.jsx("div",{className:"h-1 bg-muted/30 overflow-hidden",children:i.jsx("div",{className:Ie("h-full bg-primary/40 transition-all ease-linear",l?"":"animate-progress-shrink"),style:{animation:l?"none":"progressShrink 4s linear forwards"}})})]})}),i.jsx("style",{children:`
        @keyframes progressShrink {
          from { width: 100%; }
          to { width: 0%; }
        }
      `})]}):null}const Woe={"+91":e=>e.length===10?`${e.slice(0,5)} ${e.slice(5)}`:Yr(e,[5,5]),"+1":e=>e.length===10?`${e.slice(0,3)} ${e.slice(3,6)} ${e.slice(6)}`:Yr(e,[3,3,4]),"+44":e=>e.length===10?`${e.slice(0,4)} ${e.slice(4,7)} ${e.slice(7)}`:Yr(e,[4,3,3]),"+971":e=>e.length>=9?`${e.slice(0,2)} ${e.slice(2,5)} ${e.slice(5)}`:Yr(e,[2,3,4]),"+61":e=>e.length===9?`${e.slice(0,1)} ${e.slice(1,5)} ${e.slice(5)}`:Yr(e,[1,4,4]),"+966":e=>e.length>=9?`${e.slice(0,2)} ${e.slice(2,5)} ${e.slice(5)}`:Yr(e,[2,3,4]),"+65":e=>e.length===8?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,4]),"+49":e=>e.length>=10?`${e.slice(0,3)} ${e.slice(3,7)} ${e.slice(7)}`:Yr(e,[3,4,4]),"+33":e=>e.length===9?`${e.slice(0,1)} ${e.slice(1,3)} ${e.slice(3,5)} ${e.slice(5,7)} ${e.slice(7)}`:Yr(e,[1,2,2,2,2]),"+86":e=>e.length===11?`${e.slice(0,3)} ${e.slice(3,7)} ${e.slice(7)}`:Yr(e,[3,4,4]),"+81":e=>e.length===10?`${e.slice(0,2)} ${e.slice(2,6)} ${e.slice(6)}`:Yr(e,[2,4,4]),"+82":e=>e.length>=9?`${e.slice(0,2)} ${e.slice(2,6)} ${e.slice(6)}`:Yr(e,[2,4,4]),"+55":e=>e.length>=10?`${e.slice(0,2)} ${e.slice(2,7)} ${e.slice(7)}`:Yr(e,[2,5,4]),"+7":e=>e.length===10?`${e.slice(0,3)} ${e.slice(3,6)} ${e.slice(6,8)} ${e.slice(8)}`:Yr(e,[3,3,2,2]),"+974":e=>e.length===8?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,4]),"+965":e=>e.length===8?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,4]),"+973":e=>e.length===8?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,4]),"+968":e=>e.length===8?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,4]),"+92":e=>e.length===10?`${e.slice(0,3)} ${e.slice(3)}`:Yr(e,[3,7]),"+880":e=>e.length===10?`${e.slice(0,4)} ${e.slice(4)}`:Yr(e,[4,6])};function Yr(e,t){const n=[];let r=0;for(const a of t){if(r>=e.length)break;n.push(e.slice(r,r+a)),r+=a}return r<e.length&&n.push(e.slice(r)),n.join(" ")}function Uoe(e){return e.length<=4?e:e.length<=7?`${e.slice(0,3)} ${e.slice(3)}`:Yr(e,[3,3,4])}function k0(e,t){if(!e)return"";e.startsWith("+");const n=e.replace(/\D/g,"");if(!n)return"";const r=kr(e),a=r.replace(/\D/g,"");let s=n;if(n.startsWith(a)&&(s=n.slice(a.length)),!s)return e;const l=(Woe[r]||Uoe)(s);return`${r} ${l}`}function jz(e){return e?e.replace(/\D/g,""):""}const Voe=e=>`https://wa.me/${jz(e)}`,gx=({icon:e,label:t,value:n,href:r,iconClass:a})=>i.jsxs("a",{href:r,target:r.startsWith("http")?"_blank":void 0,rel:r.startsWith("http")?"noopener noreferrer":void 0,className:"group flex items-center gap-3 p-3 rounded-xl hover:bg-muted/50 transition-colors",children:[i.jsx("div",{className:Ie("w-10 h-10 rounded-full bg-muted flex items-center justify-center transition-colors",a),children:i.jsx(e,{className:"h-5 w-5 text-foreground/70 group-hover:text-foreground transition-colors"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("p",{className:"text-xs text-muted-foreground",children:t}),i.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:n})]})]});function Hoe(){const{slug:e}=cO(),[t]=sX(),{user:n,loading:r}=or(),[a,s]=N.useState(null),[o,l]=N.useState(null),[c,d]=N.useState(null),[u,h]=N.useState(null),[p,m]=N.useState(!0),[f,g]=N.useState(!1),[x,y]=N.useState(!1),[b,v]=N.useState(!1),[w,k]=N.useState(!1),[C,S]=N.useState(!1),[_,I]=N.useState(!1),[T,A]=N.useState(!1),[j,D]=N.useState(!1),F=!!n&&!r,B=n&&a&&n.id===a.user_id;N.useEffect(()=>{e&&q()},[e]),N.useEffect(()=>{n&&!c&&(async()=>{if(!n){d(null);return}try{const{data:ce,error:ne}=await ue.from("cards").select("*").eq("user_id",n.id).eq("is_default",!0).maybeSingle();if(ne){console.error("Failed to load viewer card:",ne);return}d(ce)}catch(ce){console.error("Failed to load viewer card:",ce)}})()},[n]),N.useEffect(()=>{if(!a||f)return;(async()=>{const ce=t.get("src")==="nfc"?"nfc":"qr",ne=new Date,{data:te}=await ue.from("events").select("id, start_time, end_time").eq("user_id",a.user_id);let Te=null;if(te&&te.length>0){const Ae=te.filter(Se=>{const we=new Date(Se.start_time),Fe=Se.end_time?new Date(Se.end_time):we;return ne>=we&&ne<=Fe});Te=Ae.length>0?Ae[0].id:null}h(Te),goe(a.user_id,(o==null?void 0:o.id)||null,ce,Te),g(!0)})()},[a,o,f,t]);const q=async()=>{if(!e)return;m(!0);const{profile:K,card:ce}=await rJ(e);s(K),l(ce),m(!1)},$=o?{name:o.full_name||(a==null?void 0:a.name)||"",designation:o.designation||(a==null?void 0:a.designation)||"",company:o.company||(a==null?void 0:a.company)||"",phone:o.phone||(a==null?void 0:a.phone)||"",email:o.email||(a==null?void 0:a.email)||"",website:o.website||(a==null?void 0:a.website)||"",whatsapp:o.whatsapp||(a==null?void 0:a.whatsapp)||"",linkedin:(o==null?void 0:o.linkedin)||"",about:o.about||(a==null?void 0:a.about)||"",photo_url:o.photo_url||(a==null?void 0:a.photo_url)||"",logo_url:o.logo_url||(a==null?void 0:a.logo_url)||""}:a?{name:a.name||"",designation:a.designation||"",company:a.company||"",phone:a.phone||"",email:a.email||"",website:a.website||"",whatsapp:a.whatsapp||"",linkedin:a.linkedin||"",about:a.about||"",photo_url:a.photo_url||"",logo_url:a.logo_url||""}:null,L=async()=>{var ce,ne,te,Te,Ae,Se,we;if(!n||!a||!o){ie({title:"Unable to save",description:"Please sign in to save this contact.",variant:"destructive"});return}if(B){ie({title:"That's your own card!",description:"You cannot exchange with yourself."});return}const K={name:(c==null?void 0:c.full_name)||((ce=n.user_metadata)==null?void 0:ce.name)||((ne=n.email)==null?void 0:ne.split("@")[0])||"Synka User",email:(c==null?void 0:c.email)||n.email,phone:(c==null?void 0:c.phone)||((te=n.user_metadata)==null?void 0:te.phone)||"",whatsapp:(c==null?void 0:c.whatsapp)||(c==null?void 0:c.phone)||((Te=n.user_metadata)==null?void 0:Te.phone)||"",company:(c==null?void 0:c.company)||((Ae=n.user_metadata)==null?void 0:Ae.company)||"",designation:(c==null?void 0:c.designation)||((Se=n.user_metadata)==null?void 0:Se.designation)||"",linkedin:(c==null?void 0:c.linkedin)||"",website:(c==null?void 0:c.website)||"",about:(c==null?void 0:c.about)||"",photo_url:(c==null?void 0:c.photo_url)||"",logo_url:(c==null?void 0:c.logo_url)||""};y(!0),(we=navigator.vibrate)==null||we.call(navigator,[10,50,10]);try{const Q=await(async Je=>{const{data:le}=await ue.from("tags").select("id").eq("user_id",Je).eq("name","Synka Exchange").maybeSingle();if(le)return le.id;const{data:V}=await ue.from("tags").insert({user_id:Je,name:"Synka Exchange",color:"#10B981"}).select("id").single();return V==null?void 0:V.id})(n.id),{data:$e}=await ue.from("contacts").select("id, notes_history").eq("owner_id",n.id).eq("email",o.email).maybeSingle();let Le=$e==null?void 0:$e.id;if($e){const{data:Je}=await ue.from("contacts").update({name:o.full_name||($==null?void 0:$.name)||"Unknown",company:o.company,designation:o.designation,phone:o.phone,whatsapp:o.whatsapp,linkedin:o.linkedin,website:o.website,photo_url:o.photo_url||($==null?void 0:$.photo_url)||null,about:o.about||($==null?void 0:$.about)||null,synka_user_id:a.user_id,shared_card_id:o.id,source:"synka_exchange",updated_at:new Date().toISOString(),notes_history:[...$e.notes_history||[],{text:"Updated via Synka Exchange",timestamp:new Date().toISOString()}]}).eq("id",$e.id).select("id").single();Le=Je==null?void 0:Je.id}else{const{data:Je}=await ue.from("contacts").insert({owner_id:n.id,email:o.email,name:o.full_name||($==null?void 0:$.name)||"Unknown",company:o.company,designation:o.designation,phone:o.phone,whatsapp:o.whatsapp,linkedin:o.linkedin,website:o.website,photo_url:o.photo_url||($==null?void 0:$.photo_url)||null,about:o.about||($==null?void 0:$.about)||null,synka_user_id:a.user_id,shared_card_id:o.id,source:"synka_exchange",notes_history:[{text:"Connected via Synka Exchange",timestamp:new Date().toISOString()}]}).select("id").single();Le=Je==null?void 0:Je.id}Le&&Q&&await ue.from("contact_tags").upsert({contact_id:Le,tag_id:Q},{onConflict:"contact_id,tag_id"});const{data:Xe,error:Ye}=await ue.rpc("mutual_exchange_contact",{p_owner_id:a.user_id,p_viewer_id:n.id,p_viewer_email:K.email,p_viewer_name:K.name,p_viewer_phone:K.phone||null,p_viewer_whatsapp:K.whatsapp||null,p_viewer_company:K.company||null,p_viewer_designation:K.designation||null,p_viewer_linkedin:K.linkedin||null,p_viewer_website:K.website||null,p_viewer_photo_url:K.photo_url||null,p_viewer_about:K.about||null,p_viewer_synka_user_id:n.id,p_viewer_shared_card_id:(c==null?void 0:c.id)||null});if(Ye)throw console.error("Mutual exchange error:",Ye),new Error("Failed to save your contact to owner's CRM");console.log("Mutual exchange result:",Xe),v(!0),await z$(a.user_id,(o==null?void 0:o.id)||null),await Zn.success(),S(!0),k(!0)}catch(Fe){console.error("Exchange error:",Fe),ie({title:"Save failed",description:"Something went wrong. Please try again.",variant:"destructive"})}finally{y(!1)}},M=async K=>{if(!a)return;const ce={name:`${K.firstName} ${K.lastName}`.trim(),company:K.company,designation:K.designation,email:K.email,phone:K.phone,whatsapp:K.phone,linkedin:K.linkedin||""},{error:ne}=await foe(a.user_id,ce);if(ne)throw ie({title:"Error",description:"Failed to submit your contact. Please try again.",variant:"destructive"}),ne;A(!0),G(),ie({title:"Contact shared!",description:`Your contact has been sent to ${$==null?void 0:$.name}.`})},X=()=>{G()},G=()=>{D(!0)},W=async()=>{if(!$||!a)return;await Zn.light();const K=await Ooe({name:$.name,company:$.company,designation:$.designation,phone:$.phone,email:$.email,website:$.website,whatsapp:$.whatsapp,about:$.about,photo_url:$.photo_url});if(K.success){await z$(a.user_id,(o==null?void 0:o.id)||null);const ce=$.name.split(" ")[0];K.method==="vcard"?ie({title:`${ce}'s contact ready`,description:"Open the downloaded file to save to contacts.",duration:2e3}):K.method==="native"&&ie({title:"Contact saved",description:`${ce} added to your contacts.`,duration:2e3});const ne=K.method==="vcard"?800:300;setTimeout(()=>{I(!0)},ne)}else ie({title:"Could not save contact",description:"Please try again.",variant:"destructive"})},O=async()=>{var ce;if((ce=navigator.vibrate)==null||ce.call(navigator,10),!$||!e)return;const K=q5(e);if(Xt.isNativePlatform())try{await qc.share({url:K});return}catch(ne){console.error("Native share error:",ne)}if(navigator.share)try{await navigator.share({url:K});return}catch(ne){ne instanceof Error&&ne.name!=="AbortError"&&console.log("Share failed:",ne)}try{await navigator.clipboard.writeText(K),ie({title:"Link copied!",description:"Card link copied to clipboard."})}catch{ie({title:"Share this link:",description:K,variant:"default"})}};if(p)return i.jsx("div",{className:"min-h-dvh w-full flex items-center justify-center bg-background pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:i.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})});if(!$||!$.name)return i.jsxs("div",{className:"min-h-dvh w-full flex flex-col items-center justify-center bg-background p-4 sm:p-6 pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)]",children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Card not found"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"This card doesn't exist or has been removed."}),i.jsx(Bs,{to:"/",children:i.jsx(de,{variant:"gradient",children:"Go to Synka"})})]});const U=$.name.split(" ")[0];return i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background pt-[env(safe-area-inset-top)] pb-[calc(5rem+env(safe-area-inset-bottom))]",children:[i.jsx(yoe,{slug:e}),i.jsx(zoe,{open:_,onOpenChange:I,ownerName:U,ownerPhotoUrl:$.photo_url,onSubmit:M,onSkip:X}),i.jsx(Boe,{open:w,onOpenChange:k,ownerName:$.name,ownerPhotoUrl:$.photo_url,sharedBack:b}),i.jsxs("div",{className:"w-full max-w-lg mx-auto py-4 sm:py-6 px-3 sm:px-4 space-y-4 sm:space-y-6 animate-fade-up",children:[i.jsxs("div",{className:"bg-card/95 backdrop-blur-xl rounded-3xl border border-border/40 shadow-[0_20px_40px_rgba(0,0,0,0.06)] overflow-hidden",children:[i.jsxs("div",{className:"relative pb-4 flex flex-col items-center",children:[i.jsx(Qj,{layout:(o==null?void 0:o.layout)||"photo-logo",photoUrl:$.photo_url,logoUrl:$.logo_url,name:$.name,designation:$.designation,company:$.company,themeColor:o==null?void 0:o.card_design,faceX:o==null?void 0:o.face_x,faceY:o==null?void 0:o.face_y,logoX:o==null?void 0:o.logo_x,logoY:o==null?void 0:o.logo_y}),(o==null?void 0:o.layout)!=="photo-only"&&i.jsxs("div",{className:"text-center mt-4 space-y-1",children:[i.jsx("h2",{className:"text-[22px] font-semibold tracking-tight text-foreground",children:$.name}),($.designation||$.company)&&i.jsxs("p",{className:"text-[14px] text-muted-foreground leading-tight",children:[$.designation,$.designation&&$.company&&i.jsx("span",{className:"mx-1 opacity-60",children:""}),$.company]})]})]}),i.jsx("div",{className:"mx-6 h-px bg-gradient-to-r from-transparent via-border/40 to-transparent"}),i.jsxs("div",{className:"p-6 space-y-2",children:[$.phone&&i.jsx(gx,{icon:ky,label:"Mobile",value:k0($.phone),href:`tel:${$.phone}`}),$.email&&i.jsx(gx,{icon:Di,label:"Email",value:$.email,href:`mailto:${$.email}`}),$.website&&i.jsx(gx,{icon:Ny,label:"Website",value:"Visit Website",href:$.website}),$.whatsapp&&i.jsx(gx,{icon:v0,label:"WhatsApp",value:"Connect on WhatsApp",href:Voe($.whatsapp),iconClass:"text-foreground/80 group-hover:text-[#25D366]"}),i.jsx(jw,{documentName:(o==null?void 0:o.document_name)||null,documentUrl:(o==null?void 0:o.document_url)||null}),$.linkedin&&i.jsx(gx,{icon:Bw,label:"LinkedIn",value:"Connect on LinkedIn",href:$.linkedin.startsWith("http")?$.linkedin:`https://www.linkedin.com/in/${$.linkedin}`,iconClass:"text-foreground/80 group-hover:text-blue-600"}),(o==null?void 0:o.instagram)&&i.jsx(Go,{platform:"instagram",url:o.instagram}),(o==null?void 0:o.youtube)&&i.jsx(Go,{platform:"youtube",url:o.youtube}),(o==null?void 0:o.twitter)&&i.jsx(Go,{platform:"twitter",url:o.twitter}),(o==null?void 0:o.facebook)&&i.jsx(Go,{platform:"facebook",url:o.facebook}),(o==null?void 0:o.calendly)&&i.jsx(Go,{platform:"calendly",url:o.calendly})]}),i.jsxs("div",{className:"px-6 pb-6",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[F&&!B?i.jsx(de,{variant:C?"outline":"gradient",className:Ie("flex-1 h-12 font-medium tracking-tight transition-all",C&&"border-primary/40 bg-primary/5"),onClick:L,disabled:x||C,children:x?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"w-4 h-4 border-2 border-primary-foreground border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):C?i.jsxs(i.Fragment,{children:[i.jsx(dn,{className:"h-4 w-4 mr-2 text-primary"}),i.jsx("span",{className:"text-primary",children:"Saved"})]}):i.jsxs(i.Fragment,{children:[i.jsx(OX,{className:"h-4 w-4 mr-2"}),"Save to My Synka"]})}):B?i.jsxs(de,{variant:"gradient",className:"flex-1 h-12 font-medium tracking-tight",onClick:W,children:[i.jsx(Od,{className:"h-4 w-4 mr-2"}),"Save Contact"]}):i.jsxs(de,{variant:"gradient",className:"flex-1 h-12 font-medium tracking-tight",onClick:W,children:[i.jsx(Od,{className:"h-4 w-4 mr-2"}),"Save Contact"]}),i.jsx("button",{onClick:O,className:"h-12 w-12 flex-shrink-0 rounded-full border border-border/60 bg-background hover:bg-muted/50 flex items-center justify-center transition-all active:scale-95","aria-label":"Share card",children:i.jsx(CO,{className:"h-5 w-5 text-foreground/70"})})]}),F&&!B&&!C&&i.jsx("p",{className:"text-[11px] text-muted-foreground text-center mt-2",children:"Saves to your CRM and shares your card back"})]})]}),$.about&&i.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40",children:[i.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"About"}),i.jsx("p",{className:"text-muted-foreground text-sm whitespace-pre-line",children:$.about})]}),j&&!F&&i.jsx("div",{className:"text-center py-3",children:i.jsxs(Bs,{to:"/signup",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[i.jsx(Ls,{className:"h-4 w-4 animate-pulse text-primary/70"}),"Create your free Synka card"]})}),B&&i.jsx("div",{className:"text-center py-4",children:i.jsx(Bs,{to:"/my-card",children:i.jsx(de,{variant:"outline",className:"w-full active:scale-[0.97] transition-transform",children:"Edit My Card"})})})]})]})}function Goe(){const e=Pa(),n=Xl().state,{sendOtp:r,verifyOtp:a,setPin:s,checkPinExists:o,signInWithGoogle:l,signInWithLinkedIn:c}=or(),[d,u]=N.useState(!1),[h,p]=N.useState(null),[m,f]=N.useState(""),[g,x]=N.useState(""),[y,b]=N.useState(""),[v,w]=N.useState("+91"),[k,C]=N.useState((n==null?void 0:n.email)||""),[S,_]=N.useState(""),[I,T]=N.useState(""),[A,j]=N.useState(""),[D,F]=N.useState("details"),B=async()=>{p("google");const{error:O}=await l();O&&(p(null),ie({title:"Error",description:O.message||"Failed to sign up with Google.",variant:"destructive"}))},q=async()=>{p("linkedin");const{error:O}=await c();O&&(p(null),ie({title:"Error",description:O.message||"Failed to sign up with LinkedIn.",variant:"destructive"}))},$=async O=>{const{data:U,error:K}=await ue.from("profiles").select("email").eq("email",O.toLowerCase().trim()).maybeSingle();return!K&&U!==null},L=O=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(O.trim()),M=(O,U)=>{const K=O.trim().replace(/\D/g,"");return K&&K.length>=6&&K.length<=15?`${U}${K}`:null},X=async O=>{O.preventDefault(),Hc(m,g);const U=k.trim().toLowerCase(),K=y.trim();if(!m.trim()){ie({title:"First name required",description:"Please enter your first name.",variant:"destructive"});return}if(!U){ie({title:"Email required",description:"Please enter your email address.",variant:"destructive"});return}if(!L(U)){ie({title:"Invalid email",description:"Please enter a valid email address.",variant:"destructive"});return}if(!K){ie({title:"Mobile required",description:"Please enter your mobile number.",variant:"destructive"});return}if(!M(K,v)){ie({title:"Invalid mobile number",description:"Please enter a valid phone number.",variant:"destructive"});return}if(u(!0),await $(U)){u(!1),ie({title:"Account already exists",description:"This email is already registered. Redirecting to login...",variant:"destructive"}),setTimeout(()=>{e("/login",{state:{email:U}})},1500);return}const{error:te}=await r(U);u(!1),te?ie({title:"Error",description:te.message||"Failed to send verification code.",variant:"destructive"}):(F("otp"),ie({title:"Verification code sent!",description:"Check your email for the OTP to verify your account."}))},G=async O=>{if(O.preventDefault(),S.length!==6){ie({title:"Invalid code",description:"Please enter the 6-digit verification code.",variant:"destructive"});return}u(!0);const{error:U}=await a(k,S);if(u(!1),U)ie({title:"Error",description:U.message||"Invalid OTP. Please try again.",variant:"destructive"});else{const{data:{user:K}}=await ue.auth.getUser();if(K){const ce=Hc(m,g),ne=y.trim()?`${v}${y.trim().replace(/\D/g,"")}`:"";await ue.auth.updateUser({data:{name:ce,phone:ne}}),await ue.from("profiles").update({full_name:ce,phone:ne}).eq("user_id",K.id);const{data:te}=await ue.from("cards").select("id, name").eq("user_id",K.id).eq("is_default",!0).maybeSingle();te?await ue.from("cards").update({name:"My Card",full_name:ce,email:k.trim().toLowerCase(),phone:ne,whatsapp:ne}).eq("id",te.id):await ue.from("cards").insert({user_id:K.id,name:"My Card",is_default:!0,layout:"dark-professional",full_name:ce,email:k.trim().toLowerCase(),phone:ne,whatsapp:ne});try{await ue.auth.refreshSession()}catch{}}F("set_pin"),ie({title:"Email verified!",description:"Now set up your 4-digit PIN for quick login."})}},W=async O=>{if(O.preventDefault(),I.length!==4||A.length!==4){ie({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(I!==A){ie({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"});return}u(!0);const{data:{user:U}}=await ue.auth.getUser();if(!U){u(!1),ie({title:"Error",description:"Session expired. Please try again.",variant:"destructive"}),F("details");return}const{error:K}=await s(U.id,I);u(!1),K?ie({title:"Error",description:"Failed to set PIN. Please try again.",variant:"destructive"}):(ue.functions.invoke("welcome-email",{body:{email:k.trim().toLowerCase(),name:Hc(m,g)}}).catch(ce=>{console.error("Welcome email error:",ce)}),ie({title:"Welcome to Synka!",description:"Your account is ready. Enjoy!"}),e("/my-card",{replace:!0}))};return i.jsxs("div",{className:"min-h-dvh flex",children:[i.jsx("div",{className:"hidden lg:flex flex-1 gradient-bg items-center justify-center p-12",children:i.jsxs("div",{className:"max-w-md text-center space-y-6",children:[i.jsx("div",{className:"grid grid-cols-2 gap-4 max-w-xs mx-auto",children:[0,1,2,3].map(O=>i.jsx("div",{className:"aspect-[1.6/1] rounded-xl glass animate-float",style:{animationDelay:`${O*200}ms`}},O))}),i.jsx("h2",{className:"text-3xl font-bold text-primary-foreground",children:"Create your card in seconds"}),i.jsx("p",{className:"text-primary-foreground/80",children:"Join thousands of professionals who've elevated their networking game."})]})}),i.jsx("div",{className:"flex-1 min-h-dvh overflow-y-auto",children:i.jsx("div",{className:"min-h-full flex items-center justify-center p-4 py-8 md:p-12 pb-safe",children:i.jsxs("div",{className:"w-full max-w-md space-y-6 animate-fade-up",children:[i.jsxs("div",{className:"text-center lg:text-left",children:[i.jsx("div",{className:"mb-6",children:i.jsx(Xa,{size:"lg"})}),i.jsxs("h1",{className:"text-3xl font-bold text-foreground mb-2",children:[D==="details"&&"Create your account",D==="otp"&&"Verify your email",D==="set_pin"&&"Set up your PIN"]}),i.jsxs("p",{className:"text-muted-foreground",children:[D==="details"&&"Start networking smarter today",D==="otp"&&"Enter the code sent to your email",D==="set_pin"&&"Create a 4-digit PIN for quick login"]})]}),D==="details"&&i.jsxs("form",{onSubmit:X,className:"space-y-5",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:m,lastName:g,onFirstNameChange:f,onLastNameChange:x}),i.jsx(Fs,{label:"Phone Number *",value:y,onChange:O=>b(O.target.value.replace(/[^\d\s]/g,"")),countryCode:v,onCountryCodeChange:w}),i.jsx(In,{label:"Email *",value:k,onChange:O=>C(O.target.value),type:"email",inputMode:"email"})]}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["By signing up, you agree to our"," ",i.jsx(Bs,{to:"/terms",className:"text-primary hover:underline",children:"Terms"})," ","and"," ",i.jsx(Bs,{to:"/privacy",className:"text-primary hover:underline",children:"Privacy Policy"})]}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d,children:[d?"Sending code...":"Continue",i.jsx(ni,{className:"h-5 w-5"})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("span",{className:"w-full border-t border-border"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsxs(de,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:B,disabled:h!==null,children:[h==="google"?i.jsx("span",{className:"animate-spin mr-2",children:""}):i.jsxs("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",children:[i.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),i.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),i.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),i.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]}),i.jsxs(de,{type:"button",variant:"outline",size:"lg",className:"w-full",onClick:q,disabled:h!==null,children:[h==="linkedin"?i.jsx("span",{className:"animate-spin mr-2",children:""}):i.jsx("svg",{className:"mr-2 h-5 w-5",viewBox:"0 0 24 24",fill:"#0A66C2",children:i.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),"LinkedIn"]})]})]}),D==="otp"&&i.jsxs("form",{onSubmit:G,className:"space-y-6",children:[i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"otp",children:"Verification Code"}),i.jsx(At,{id:"otp",type:"text",placeholder:"Enter 6-digit code",value:S,onChange:O=>_(O.target.value),className:"h-12 text-center text-2xl tracking-widest",maxLength:6,required:!0})]})}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d||S.length!==6,children:[d?"Verifying...":"Verify & Continue",i.jsx(ni,{className:"h-5 w-5"})]}),i.jsx(de,{type:"button",variant:"ghost",className:"w-full",onClick:()=>{F("details"),_("")},children:"Back to signup"})]}),D==="set_pin"&&i.jsxs("form",{onSubmit:W,className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Create 4-Digit PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:I,onChange:T,inputMode:"numeric",pattern:"[0-9]*",children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Confirm PIN"}),i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:A,onChange:j,inputMode:"numeric",pattern:"[0-9]*",children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})})]})]}),i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:d||I.length!==4||A.length!==4,children:[d?"Setting up...":"Complete Setup",i.jsx(ni,{className:"h-5 w-5"})]})]}),i.jsxs("p",{className:"text-center text-muted-foreground",children:["Already have an account?"," ",i.jsx(Bs,{to:"/login",className:"text-primary font-medium hover:underline",children:"Sign in"})]})]})})})]})}/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Iz,setPrototypeOf:G$,isFrozen:qoe,getPrototypeOf:Koe,getOwnPropertyDescriptor:Yoe}=Object;let{freeze:ws,seal:Bi,create:lC}=Object,{apply:cC,construct:uC}=typeof Reflect<"u"&&Reflect;ws||(ws=function(t){return t});Bi||(Bi=function(t){return t});cC||(cC=function(t,n){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return t.apply(n,a)});uC||(uC=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return new t(...r)});const Uv=Ns(Array.prototype.forEach),Xoe=Ns(Array.prototype.lastIndexOf),q$=Ns(Array.prototype.pop),xx=Ns(Array.prototype.push),Zoe=Ns(Array.prototype.splice),Iw=Ns(String.prototype.toLowerCase),hS=Ns(String.prototype.toString),pS=Ns(String.prototype.match),yx=Ns(String.prototype.replace),Qoe=Ns(String.prototype.indexOf),Joe=Ns(String.prototype.trim),ao=Ns(Object.prototype.hasOwnProperty),us=Ns(RegExp.prototype.test),bx=ele(TypeError);function Ns(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return cC(e,t,r)}}function ele(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return uC(e,n)}}function Rn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Iw;G$&&G$(e,null);let r=t.length;for(;r--;){let a=t[r];if(typeof a=="string"){const s=n(a);s!==a&&(qoe(t)||(t[r]=s),a=s)}e[a]=!0}return e}function tle(e){for(let t=0;t<e.length;t++)ao(e,t)||(e[t]=null);return e}function Do(e){const t=lC(null);for(const[n,r]of Iz(e))ao(e,n)&&(Array.isArray(r)?t[n]=tle(r):r&&typeof r=="object"&&r.constructor===Object?t[n]=Do(r):t[n]=r);return t}function vx(e,t){for(;e!==null;){const r=Yoe(e,t);if(r){if(r.get)return Ns(r.get);if(typeof r.value=="function")return Ns(r.value)}e=Koe(e)}function n(){return null}return n}const K$=ws(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),mS=ws(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),fS=ws(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),nle=ws(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),gS=ws(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),rle=ws(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Y$=ws(["#text"]),X$=ws(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),xS=ws(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Z$=ws(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Vv=ws(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ale=Bi(/\{\{[\w\W]*|[\w\W]*\}\}/gm),sle=Bi(/<%[\w\W]*|[\w\W]*%>/gm),ile=Bi(/\$\{[\w\W]*/gm),ole=Bi(/^data-[\-\w.\u00B7-\uFFFF]+$/),lle=Bi(/^aria-[\-\w]+$/),Tz=Bi(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),cle=Bi(/^(?:\w+script|data):/i),ule=Bi(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ez=Bi(/^html$/i),dle=Bi(/^[a-z][.\w]*(-[.\w]+)+$/i);var Q$=Object.freeze({__proto__:null,ARIA_ATTR:lle,ATTR_WHITESPACE:ule,CUSTOM_ELEMENT:dle,DATA_ATTR:ole,DOCTYPE_NAME:Ez,ERB_EXPR:sle,IS_ALLOWED_URI:Tz,IS_SCRIPT_OR_DATA:cle,MUSTACHE_EXPR:ale,TMPLIT_EXPR:ile});const wx={element:1,text:3,progressingInstruction:7,comment:8,document:9},hle=function(){return typeof window>"u"?null:window},ple=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const s="dompurify"+(r?"#"+r:"");try{return t.createPolicy(s,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},J$=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Az(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hle();const t=ft=>Az(ft);if(t.version="3.3.1",t.removed=[],!e||!e.document||e.document.nodeType!==wx.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const r=n,a=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:o,Node:l,Element:c,NodeFilter:d,NamedNodeMap:u=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:h,DOMParser:p,trustedTypes:m}=e,f=c.prototype,g=vx(f,"cloneNode"),x=vx(f,"remove"),y=vx(f,"nextSibling"),b=vx(f,"childNodes"),v=vx(f,"parentNode");if(typeof o=="function"){const ft=n.createElement("template");ft.content&&ft.content.ownerDocument&&(n=ft.content.ownerDocument)}let w,k="";const{implementation:C,createNodeIterator:S,createDocumentFragment:_,getElementsByTagName:I}=n,{importNode:T}=r;let A=J$();t.isSupported=typeof Iz=="function"&&typeof v=="function"&&C&&C.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:j,ERB_EXPR:D,TMPLIT_EXPR:F,DATA_ATTR:B,ARIA_ATTR:q,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:L,CUSTOM_ELEMENT:M}=Q$;let{IS_ALLOWED_URI:X}=Q$,G=null;const W=Rn({},[...K$,...mS,...fS,...gS,...Y$]);let O=null;const U=Rn({},[...X$,...xS,...Z$,...Vv]);let K=Object.seal(lC(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ce=null,ne=null;const te=Object.seal(lC(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Te=!0,Ae=!0,Se=!1,we=!0,Fe=!1,Q=!0,$e=!1,Le=!1,Xe=!1,Ye=!1,Je=!1,le=!1,V=!0,ee=!1;const ve="user-content-";let ke=!0,Ce=!1,be={},Ee=null;const Ue=Rn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Qe=null;const _t=Rn({},["audio","video","img","source","image","track"]);let $t=null;const Ve=Rn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),tt="http://www.w3.org/1998/Math/MathML",yt="http://www.w3.org/2000/svg",ut="http://www.w3.org/1999/xhtml";let qt=ut,an=!1,lt=null;const wt=Rn({},[tt,yt,ut],hS);let Nt=Rn({},["mi","mo","mn","ms","mtext"]),Kt=Rn({},["annotation-xml"]);const jt=Rn({},["title","style","font","a","script"]);let Zt=null;const An=["application/xhtml+xml","text/html"],it="text/html";let ge=null,De=null;const Ke=n.createElement("form"),ze=function(pe){return pe instanceof RegExp||pe instanceof Function},Bt=function(){let pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(De&&De===pe)){if((!pe||typeof pe!="object")&&(pe={}),pe=Do(pe),Zt=An.indexOf(pe.PARSER_MEDIA_TYPE)===-1?it:pe.PARSER_MEDIA_TYPE,ge=Zt==="application/xhtml+xml"?hS:Iw,G=ao(pe,"ALLOWED_TAGS")?Rn({},pe.ALLOWED_TAGS,ge):W,O=ao(pe,"ALLOWED_ATTR")?Rn({},pe.ALLOWED_ATTR,ge):U,lt=ao(pe,"ALLOWED_NAMESPACES")?Rn({},pe.ALLOWED_NAMESPACES,hS):wt,$t=ao(pe,"ADD_URI_SAFE_ATTR")?Rn(Do(Ve),pe.ADD_URI_SAFE_ATTR,ge):Ve,Qe=ao(pe,"ADD_DATA_URI_TAGS")?Rn(Do(_t),pe.ADD_DATA_URI_TAGS,ge):_t,Ee=ao(pe,"FORBID_CONTENTS")?Rn({},pe.FORBID_CONTENTS,ge):Ue,ce=ao(pe,"FORBID_TAGS")?Rn({},pe.FORBID_TAGS,ge):Do({}),ne=ao(pe,"FORBID_ATTR")?Rn({},pe.FORBID_ATTR,ge):Do({}),be=ao(pe,"USE_PROFILES")?pe.USE_PROFILES:!1,Te=pe.ALLOW_ARIA_ATTR!==!1,Ae=pe.ALLOW_DATA_ATTR!==!1,Se=pe.ALLOW_UNKNOWN_PROTOCOLS||!1,we=pe.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Fe=pe.SAFE_FOR_TEMPLATES||!1,Q=pe.SAFE_FOR_XML!==!1,$e=pe.WHOLE_DOCUMENT||!1,Ye=pe.RETURN_DOM||!1,Je=pe.RETURN_DOM_FRAGMENT||!1,le=pe.RETURN_TRUSTED_TYPE||!1,Xe=pe.FORCE_BODY||!1,V=pe.SANITIZE_DOM!==!1,ee=pe.SANITIZE_NAMED_PROPS||!1,ke=pe.KEEP_CONTENT!==!1,Ce=pe.IN_PLACE||!1,X=pe.ALLOWED_URI_REGEXP||Tz,qt=pe.NAMESPACE||ut,Nt=pe.MATHML_TEXT_INTEGRATION_POINTS||Nt,Kt=pe.HTML_INTEGRATION_POINTS||Kt,K=pe.CUSTOM_ELEMENT_HANDLING||{},pe.CUSTOM_ELEMENT_HANDLING&&ze(pe.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(K.tagNameCheck=pe.CUSTOM_ELEMENT_HANDLING.tagNameCheck),pe.CUSTOM_ELEMENT_HANDLING&&ze(pe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(K.attributeNameCheck=pe.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),pe.CUSTOM_ELEMENT_HANDLING&&typeof pe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(K.allowCustomizedBuiltInElements=pe.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Fe&&(Ae=!1),Je&&(Ye=!0),be&&(G=Rn({},Y$),O=[],be.html===!0&&(Rn(G,K$),Rn(O,X$)),be.svg===!0&&(Rn(G,mS),Rn(O,xS),Rn(O,Vv)),be.svgFilters===!0&&(Rn(G,fS),Rn(O,xS),Rn(O,Vv)),be.mathMl===!0&&(Rn(G,gS),Rn(O,Z$),Rn(O,Vv))),pe.ADD_TAGS&&(typeof pe.ADD_TAGS=="function"?te.tagCheck=pe.ADD_TAGS:(G===W&&(G=Do(G)),Rn(G,pe.ADD_TAGS,ge))),pe.ADD_ATTR&&(typeof pe.ADD_ATTR=="function"?te.attributeCheck=pe.ADD_ATTR:(O===U&&(O=Do(O)),Rn(O,pe.ADD_ATTR,ge))),pe.ADD_URI_SAFE_ATTR&&Rn($t,pe.ADD_URI_SAFE_ATTR,ge),pe.FORBID_CONTENTS&&(Ee===Ue&&(Ee=Do(Ee)),Rn(Ee,pe.FORBID_CONTENTS,ge)),pe.ADD_FORBID_CONTENTS&&(Ee===Ue&&(Ee=Do(Ee)),Rn(Ee,pe.ADD_FORBID_CONTENTS,ge)),ke&&(G["#text"]=!0),$e&&Rn(G,["html","head","body"]),G.table&&(Rn(G,["tbody"]),delete ce.tbody),pe.TRUSTED_TYPES_POLICY){if(typeof pe.TRUSTED_TYPES_POLICY.createHTML!="function")throw bx('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof pe.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw bx('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=pe.TRUSTED_TYPES_POLICY,k=w.createHTML("")}else w===void 0&&(w=ple(m,a)),w!==null&&typeof k=="string"&&(k=w.createHTML(""));ws&&ws(pe),De=pe}},Qt=Rn({},[...mS,...fS,...nle]),rt=Rn({},[...gS,...rle]),gt=function(pe){let Pe=v(pe);(!Pe||!Pe.tagName)&&(Pe={namespaceURI:qt,tagName:"template"});const dt=Iw(pe.tagName),On=Iw(Pe.tagName);return lt[pe.namespaceURI]?pe.namespaceURI===yt?Pe.namespaceURI===ut?dt==="svg":Pe.namespaceURI===tt?dt==="svg"&&(On==="annotation-xml"||Nt[On]):!!Qt[dt]:pe.namespaceURI===tt?Pe.namespaceURI===ut?dt==="math":Pe.namespaceURI===yt?dt==="math"&&Kt[On]:!!rt[dt]:pe.namespaceURI===ut?Pe.namespaceURI===yt&&!Kt[On]||Pe.namespaceURI===tt&&!Nt[On]?!1:!rt[dt]&&(jt[dt]||!Qt[dt]):!!(Zt==="application/xhtml+xml"&&lt[pe.namespaceURI]):!1},en=function(pe){xx(t.removed,{element:pe});try{v(pe).removeChild(pe)}catch{x(pe)}},br=function(pe,Pe){try{xx(t.removed,{attribute:Pe.getAttributeNode(pe),from:Pe})}catch{xx(t.removed,{attribute:null,from:Pe})}if(Pe.removeAttribute(pe),pe==="is")if(Ye||Je)try{en(Pe)}catch{}else try{Pe.setAttribute(pe,"")}catch{}},vr=function(pe){let Pe=null,dt=null;if(Xe)pe="<remove></remove>"+pe;else{const Wn=pS(pe,/^[\r\n\t ]+/);dt=Wn&&Wn[0]}Zt==="application/xhtml+xml"&&qt===ut&&(pe='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+pe+"</body></html>");const On=w?w.createHTML(pe):pe;if(qt===ut)try{Pe=new p().parseFromString(On,Zt)}catch{}if(!Pe||!Pe.documentElement){Pe=C.createDocument(qt,"template",null);try{Pe.documentElement.innerHTML=an?k:On}catch{}}const cr=Pe.body||Pe.documentElement;return pe&&dt&&cr.insertBefore(n.createTextNode(dt),cr.childNodes[0]||null),qt===ut?I.call(Pe,$e?"html":"body")[0]:$e?Pe.documentElement:cr},js=function(pe){return S.call(pe.ownerDocument||pe,pe,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Mr=function(pe){return pe instanceof h&&(typeof pe.nodeName!="string"||typeof pe.textContent!="string"||typeof pe.removeChild!="function"||!(pe.attributes instanceof u)||typeof pe.removeAttribute!="function"||typeof pe.setAttribute!="function"||typeof pe.namespaceURI!="string"||typeof pe.insertBefore!="function"||typeof pe.hasChildNodes!="function")},La=function(pe){return typeof l=="function"&&pe instanceof l};function qn(ft,pe,Pe){Uv(ft,dt=>{dt.call(t,pe,Pe,De)})}const fa=function(pe){let Pe=null;if(qn(A.beforeSanitizeElements,pe,null),Mr(pe))return en(pe),!0;const dt=ge(pe.nodeName);if(qn(A.uponSanitizeElement,pe,{tagName:dt,allowedTags:G}),Q&&pe.hasChildNodes()&&!La(pe.firstElementChild)&&us(/<[/\w!]/g,pe.innerHTML)&&us(/<[/\w!]/g,pe.textContent)||pe.nodeType===wx.progressingInstruction||Q&&pe.nodeType===wx.comment&&us(/<[/\w]/g,pe.data))return en(pe),!0;if(!(te.tagCheck instanceof Function&&te.tagCheck(dt))&&(!G[dt]||ce[dt])){if(!ce[dt]&&Ki(dt)&&(K.tagNameCheck instanceof RegExp&&us(K.tagNameCheck,dt)||K.tagNameCheck instanceof Function&&K.tagNameCheck(dt)))return!1;if(ke&&!Ee[dt]){const On=v(pe)||pe.parentNode,cr=b(pe)||pe.childNodes;if(cr&&On){const Wn=cr.length;for(let wr=Wn-1;wr>=0;--wr){const za=g(cr[wr],!0);za.__removalCount=(pe.__removalCount||0)+1,On.insertBefore(za,y(pe))}}}return en(pe),!0}return pe instanceof c&&!gt(pe)||(dt==="noscript"||dt==="noembed"||dt==="noframes")&&us(/<\/no(script|embed|frames)/i,pe.innerHTML)?(en(pe),!0):(Fe&&pe.nodeType===wx.text&&(Pe=pe.textContent,Uv([j,D,F],On=>{Pe=yx(Pe,On," ")}),pe.textContent!==Pe&&(xx(t.removed,{element:pe.cloneNode()}),pe.textContent=Pe)),qn(A.afterSanitizeElements,pe,null),!1)},xr=function(pe,Pe,dt){if(V&&(Pe==="id"||Pe==="name")&&(dt in n||dt in Ke))return!1;if(!(Ae&&!ne[Pe]&&us(B,Pe))){if(!(Te&&us(q,Pe))){if(!(te.attributeCheck instanceof Function&&te.attributeCheck(Pe,pe))){if(!O[Pe]||ne[Pe]){if(!(Ki(pe)&&(K.tagNameCheck instanceof RegExp&&us(K.tagNameCheck,pe)||K.tagNameCheck instanceof Function&&K.tagNameCheck(pe))&&(K.attributeNameCheck instanceof RegExp&&us(K.attributeNameCheck,Pe)||K.attributeNameCheck instanceof Function&&K.attributeNameCheck(Pe,pe))||Pe==="is"&&K.allowCustomizedBuiltInElements&&(K.tagNameCheck instanceof RegExp&&us(K.tagNameCheck,dt)||K.tagNameCheck instanceof Function&&K.tagNameCheck(dt))))return!1}else if(!$t[Pe]){if(!us(X,yx(dt,L,""))){if(!((Pe==="src"||Pe==="xlink:href"||Pe==="href")&&pe!=="script"&&Qoe(dt,"data:")===0&&Qe[pe])){if(!(Se&&!us($,yx(dt,L,"")))){if(dt)return!1}}}}}}}return!0},Ki=function(pe){return pe!=="annotation-xml"&&pS(pe,M)},is=function(pe){qn(A.beforeSanitizeAttributes,pe,null);const{attributes:Pe}=pe;if(!Pe||Mr(pe))return;const dt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:O,forceKeepAttr:void 0};let On=Pe.length;for(;On--;){const cr=Pe[On],{name:Wn,namespaceURI:wr,value:za}=cr,Is=ge(Wn),_n=za;let fn=Wn==="value"?_n:Joe(_n);if(dt.attrName=Is,dt.attrValue=fn,dt.keepAttr=!0,dt.forceKeepAttr=void 0,qn(A.uponSanitizeAttribute,pe,dt),fn=dt.attrValue,ee&&(Is==="id"||Is==="name")&&(br(Wn,pe),fn=ve+fn),Q&&us(/((--!?|])>)|<\/(style|title|textarea)/i,fn)){br(Wn,pe);continue}if(Is==="attributename"&&pS(fn,"href")){br(Wn,pe);continue}if(dt.forceKeepAttr)continue;if(!dt.keepAttr){br(Wn,pe);continue}if(!we&&us(/\/>/i,fn)){br(Wn,pe);continue}Fe&&Uv([j,D,F],bi=>{fn=yx(fn,bi," ")});const Ts=ge(pe.nodeName);if(!xr(Ts,Is,fn)){br(Wn,pe);continue}if(w&&typeof m=="object"&&typeof m.getAttributeType=="function"&&!wr)switch(m.getAttributeType(Ts,Is)){case"TrustedHTML":{fn=w.createHTML(fn);break}case"TrustedScriptURL":{fn=w.createScriptURL(fn);break}}if(fn!==_n)try{wr?pe.setAttributeNS(wr,Wn,fn):pe.setAttribute(Wn,fn),Mr(pe)?en(pe):q$(t.removed)}catch{br(Wn,pe)}}qn(A.afterSanitizeAttributes,pe,null)},yi=function ft(pe){let Pe=null;const dt=js(pe);for(qn(A.beforeSanitizeShadowDOM,pe,null);Pe=dt.nextNode();)qn(A.uponSanitizeShadowNode,Pe,null),fa(Pe),is(Pe),Pe.content instanceof s&&ft(Pe.content);qn(A.afterSanitizeShadowDOM,pe,null)};return t.sanitize=function(ft){let pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Pe=null,dt=null,On=null,cr=null;if(an=!ft,an&&(ft="<!-->"),typeof ft!="string"&&!La(ft))if(typeof ft.toString=="function"){if(ft=ft.toString(),typeof ft!="string")throw bx("dirty is not a string, aborting")}else throw bx("toString is not a function");if(!t.isSupported)return ft;if(Le||Bt(pe),t.removed=[],typeof ft=="string"&&(Ce=!1),Ce){if(ft.nodeName){const za=ge(ft.nodeName);if(!G[za]||ce[za])throw bx("root node is forbidden and cannot be sanitized in-place")}}else if(ft instanceof l)Pe=vr("<!---->"),dt=Pe.ownerDocument.importNode(ft,!0),dt.nodeType===wx.element&&dt.nodeName==="BODY"||dt.nodeName==="HTML"?Pe=dt:Pe.appendChild(dt);else{if(!Ye&&!Fe&&!$e&&ft.indexOf("<")===-1)return w&&le?w.createHTML(ft):ft;if(Pe=vr(ft),!Pe)return Ye?null:le?k:""}Pe&&Xe&&en(Pe.firstChild);const Wn=js(Ce?ft:Pe);for(;On=Wn.nextNode();)fa(On),is(On),On.content instanceof s&&yi(On.content);if(Ce)return ft;if(Ye){if(Je)for(cr=_.call(Pe.ownerDocument);Pe.firstChild;)cr.appendChild(Pe.firstChild);else cr=Pe;return(O.shadowroot||O.shadowrootmode)&&(cr=T.call(r,cr,!0)),cr}let wr=$e?Pe.outerHTML:Pe.innerHTML;return $e&&G["!doctype"]&&Pe.ownerDocument&&Pe.ownerDocument.doctype&&Pe.ownerDocument.doctype.name&&us(Ez,Pe.ownerDocument.doctype.name)&&(wr="<!DOCTYPE "+Pe.ownerDocument.doctype.name+`>
`+wr),Fe&&Uv([j,D,F],za=>{wr=yx(wr,za," ")}),w&&le?w.createHTML(wr):wr},t.setConfig=function(){let ft=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Bt(ft),Le=!0},t.clearConfig=function(){De=null,Le=!1},t.isValidAttribute=function(ft,pe,Pe){De||Bt({});const dt=ge(ft),On=ge(pe);return xr(dt,On,Pe)},t.addHook=function(ft,pe){typeof pe=="function"&&xx(A[ft],pe)},t.removeHook=function(ft,pe){if(pe!==void 0){const Pe=Xoe(A[ft],pe);return Pe===-1?void 0:Zoe(A[ft],Pe,1)[0]}return q$(A[ft])},t.removeHooks=function(ft){A[ft]=[]},t.removeAllHooks=function(){A=J$()},t}var xd=Az();const Tn=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ie("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Tn.displayName="Card";const Qn=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ie("flex flex-col space-y-1.5 p-6",e),...t}));Qn.displayName="CardHeader";const Jn=N.forwardRef(({className:e,...t},n)=>i.jsx("h3",{ref:n,className:Ie("text-2xl font-semibold leading-none tracking-tight",e),...t}));Jn.displayName="CardTitle";const Ri=N.forwardRef(({className:e,...t},n)=>i.jsx("p",{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));Ri.displayName="CardDescription";const Dn=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ie("p-6 pt-0",e),...t}));Dn.displayName="CardContent";const mle=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{ref:n,className:Ie("flex items-center p-6 pt-0",e),...t}));mle.displayName="CardFooter";const ka=N.forwardRef(({className:e,...t},n)=>i.jsx("textarea",{className:Ie("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,autoComplete:"off",autoCorrect:"off",spellCheck:!1,"data-form-type":"other",...t}));ka.displayName="Textarea";function Rz({open:e,onOpenChange:t,title:n,description:r,confirmText:a="Delete",cancelText:s="Cancel",onConfirm:o,variant:l="destructive"}){return i.jsx(Jm,{open:e,onOpenChange:t,children:i.jsxs(Wd,{children:[i.jsxs(Ud,{children:[i.jsx(Hd,{children:n}),i.jsx(Gd,{children:r})]}),i.jsxs(Vd,{children:[i.jsx(Kd,{children:s}),i.jsx(qd,{onClick:o,className:l==="destructive"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"",children:a})]})]})})}var j1="Popover",[Dz]=dl(j1,[x1]),pb=x1(),[fle,Nu]=Dz(j1),Mz=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:a,onOpenChange:s,modal:o=!1}=e,l=pb(t),c=N.useRef(null),[d,u]=N.useState(!1),[h,p]=zl({prop:r,defaultProp:a??!1,onChange:s,caller:j1});return i.jsx(nO,{...l,children:i.jsx(fle,{scope:t,contentId:If(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:N.useCallback(()=>p(m=>!m),[p]),hasCustomAnchor:d,onCustomAnchorAdd:N.useCallback(()=>u(!0),[]),onCustomAnchorRemove:N.useCallback(()=>u(!1),[]),modal:o,children:n})})};Mz.displayName=j1;var $z="PopoverAnchor",gle=N.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Nu($z,n),s=pb(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=a;return N.useEffect(()=>(o(),()=>l()),[o,l]),i.jsx(W_,{...s,...r,ref:t})});gle.displayName=$z;var Fz="PopoverTrigger",Pz=N.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Nu(Fz,n),s=pb(n),o=gr(t,a.triggerRef),l=i.jsx(Gn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":Wz(a.open),...r,ref:o,onClick:Mn(e.onClick,a.onOpenToggle)});return a.hasCustomAnchor?l:i.jsx(W_,{asChild:!0,...s,children:l})});Pz.displayName=Fz;var nI="PopoverPortal",[xle,yle]=Dz(nI,{forceMount:void 0}),Oz=e=>{const{__scopePopover:t,forceMount:n,children:r,container:a}=e,s=Nu(nI,t);return i.jsx(xle,{scope:t,forceMount:n,children:i.jsx(Yl,{present:n||s.open,children:i.jsx(YP,{asChild:!0,container:a,children:r})})})};Oz.displayName=nI;var cf="PopoverContent",Lz=N.forwardRef((e,t)=>{const n=yle(cf,e.__scopePopover),{forceMount:r=n.forceMount,...a}=e,s=Nu(cf,e.__scopePopover);return i.jsx(Yl,{present:r||s.open,children:s.modal?i.jsx(vle,{...a,ref:t}):i.jsx(wle,{...a,ref:t})})});Lz.displayName=cf;var ble=sb("PopoverContent.RemoveScroll"),vle=N.forwardRef((e,t)=>{const n=Nu(cf,e.__scopePopover),r=N.useRef(null),a=gr(t,r),s=N.useRef(!1);return N.useEffect(()=>{const o=r.current;if(o)return XP(o)},[]),i.jsx(ZP,{as:ble,allowPinchZoom:!0,children:i.jsx(zz,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Mn(e.onCloseAutoFocus,o=>{var l;o.preventDefault(),s.current||(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:Mn(e.onPointerDownOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;s.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:Mn(e.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),wle=N.forwardRef((e,t)=>{const n=Nu(cf,e.__scopePopover),r=N.useRef(!1),a=N.useRef(!1);return i.jsx(zz,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,l;(o=e.onCloseAutoFocus)==null||o.call(e,s),s.defaultPrevented||(r.current||(l=n.triggerRef.current)==null||l.focus(),s.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:s=>{var c,d;(c=e.onInteractOutside)==null||c.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const o=s.target;((d=n.triggerRef.current)==null?void 0:d.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&a.current&&s.preventDefault()}})}),zz=N.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...h}=e,p=Nu(cf,n),m=pb(n);return QP(),i.jsx(JP,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:s,children:i.jsx(eO,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:i.jsx(tO,{"data-state":Wz(p.open),role:"dialog",id:p.contentId,...m,...h,ref:t,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Bz="PopoverClose",Nle=N.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=Nu(Bz,n);return i.jsx(Gn.button,{type:"button",...r,ref:t,onClick:Mn(e.onClick,()=>a.onOpenChange(!1))})});Nle.displayName=Bz;var kle="PopoverArrow",Sle=N.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,a=pb(n);return i.jsx(rO,{...a,...r,ref:t})});Sle.displayName=kle;function Wz(e){return e?"open":"closed"}var Cle=Mz,_le=Pz,jle=Oz,Uz=Lz;const dC=Cle,hC=_le,S0=N.forwardRef(({className:e,align:t="center",sideOffset:n=4,...r},a)=>i.jsx(jle,{children:i.jsx(Uz,{ref:a,align:t,sideOffset:n,className:Ie("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));S0.displayName=Uz.displayName;function Un(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function pi(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function ms(e,t){const n=Un(e);return isNaN(t)?pi(e,NaN):(t&&n.setDate(n.getDate()+t),n)}function vo(e,t){const n=Un(e);if(isNaN(t))return pi(e,NaN);if(!t)return n;const r=n.getDate(),a=pi(e,n.getTime());a.setMonth(n.getMonth()+t+1,0);const s=a.getDate();return r>=s?a:(n.setFullYear(a.getFullYear(),a.getMonth(),r),n)}const rI=6048e5,Ile=864e5;let Tle={};function mb(){return Tle}function il(e,t){var l,c,d,u;const n=mb(),r=(t==null?void 0:t.weekStartsOn)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((u=(d=n.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,a=Un(e),s=a.getDay(),o=(s<r?7:0)+s-r;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}function Zd(e){return il(e,{weekStartsOn:1})}function Vz(e){const t=Un(e),n=t.getFullYear(),r=pi(e,0);r.setFullYear(n+1,0,4),r.setHours(0,0,0,0);const a=Zd(r),s=pi(e,0);s.setFullYear(n,0,4),s.setHours(0,0,0,0);const o=Zd(s);return t.getTime()>=a.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function qo(e){const t=Un(e);return t.setHours(0,0,0,0),t}function C0(e){const t=Un(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function Ko(e,t){const n=qo(e),r=qo(t),a=+n-C0(n),s=+r-C0(r);return Math.round((a-s)/Ile)}function Ele(e){const t=Vz(e),n=pi(e,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),Zd(n)}function pC(e,t){const n=t*7;return ms(e,n)}function Ale(e,t){return vo(e,t*12)}function Rle(e){let t;return e.forEach(function(n){const r=Un(n);(t===void 0||t<r||isNaN(Number(r)))&&(t=r)}),t||new Date(NaN)}function Dle(e){let t;return e.forEach(n=>{const r=Un(n);(!t||t>r||isNaN(+r))&&(t=r)}),t||new Date(NaN)}function Ws(e,t){const n=qo(e),r=qo(t);return+n==+r}function aI(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Mle(e){if(!aI(e)&&typeof e!="number")return!1;const t=Un(e);return!isNaN(Number(t))}function $y(e,t){const n=Un(e),r=Un(t),a=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return a*12+s}function $le(e,t,n){const r=il(e,n),a=il(t,n),s=+r-C0(r),o=+a-C0(a);return Math.round((s-o)/rI)}function Hv(e){const t=Un(e);return t.setHours(23,59,59,999),t}function sI(e){const t=Un(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function Vs(e){const t=Un(e);return t.setDate(1),t.setHours(0,0,0,0),t}function Hz(e){const t=Un(e),n=pi(e,0);return n.setFullYear(t.getFullYear(),0,1),n.setHours(0,0,0,0),n}function iI(e,t){var l,c,d,u;const n=mb(),r=(t==null?void 0:t.weekStartsOn)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??n.weekStartsOn??((u=(d=n.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,a=Un(e),s=a.getDay(),o=(s<r?-7:0)+6-(s-r);return a.setDate(a.getDate()+o),a.setHours(23,59,59,999),a}function Gz(e){return iI(e,{weekStartsOn:1})}const Fle={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ple=(e,t,n)=>{let r;const a=Fle[e];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function yS(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const Ole={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Lle={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},zle={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ble={date:yS({formats:Ole,defaultWidth:"full"}),time:yS({formats:Lle,defaultWidth:"full"}),dateTime:yS({formats:zle,defaultWidth:"full"})},Wle={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ule=(e,t,n,r)=>Wle[e];function Nx(e){return(t,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let a;if(r==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,l=n!=null&&n.width?String(n.width):o;a=e.formattingValues[l]||e.formattingValues[o]}else{const o=e.defaultWidth,l=n!=null&&n.width?String(n.width):e.defaultWidth;a=e.values[l]||e.values[o]}const s=e.argumentCallback?e.argumentCallback(t):t;return a[s]}}const Vle={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Hle={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Gle={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},qle={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Kle={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Yle={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Xle=(e,t)=>{const n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Zle={ordinalNumber:Xle,era:Nx({values:Vle,defaultWidth:"wide"}),quarter:Nx({values:Hle,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Nx({values:Gle,defaultWidth:"wide"}),day:Nx({values:qle,defaultWidth:"wide"}),dayPeriod:Nx({values:Kle,defaultWidth:"wide",formattingValues:Yle,defaultFormattingWidth:"wide"})};function kx(e){return(t,n={})=>{const r=n.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],s=t.match(a);if(!s)return null;const o=s[0],l=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?Jle(l,h=>h.test(o)):Qle(l,h=>h.test(o));let d;d=e.valueCallback?e.valueCallback(c):c,d=n.valueCallback?n.valueCallback(d):d;const u=t.slice(o.length);return{value:d,rest:u}}}function Qle(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n}function Jle(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n}function ece(e){return(t,n={})=>{const r=t.match(e.matchPattern);if(!r)return null;const a=r[0],s=t.match(e.parsePattern);if(!s)return null;let o=e.valueCallback?e.valueCallback(s[0]):s[0];o=n.valueCallback?n.valueCallback(o):o;const l=t.slice(a.length);return{value:o,rest:l}}}const tce=/^(\d+)(th|st|nd|rd)?/i,nce=/\d+/i,rce={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ace={any:[/^b/i,/^(a|c)/i]},sce={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ice={any:[/1/i,/2/i,/3/i,/4/i]},oce={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},lce={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},cce={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},uce={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},dce={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},hce={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},pce={ordinalNumber:ece({matchPattern:tce,parsePattern:nce,valueCallback:e=>parseInt(e,10)}),era:kx({matchPatterns:rce,defaultMatchWidth:"wide",parsePatterns:ace,defaultParseWidth:"any"}),quarter:kx({matchPatterns:sce,defaultMatchWidth:"wide",parsePatterns:ice,defaultParseWidth:"any",valueCallback:e=>e+1}),month:kx({matchPatterns:oce,defaultMatchWidth:"wide",parsePatterns:lce,defaultParseWidth:"any"}),day:kx({matchPatterns:cce,defaultMatchWidth:"wide",parsePatterns:uce,defaultParseWidth:"any"}),dayPeriod:kx({matchPatterns:dce,defaultMatchWidth:"any",parsePatterns:hce,defaultParseWidth:"any"})},qz={code:"en-US",formatDistance:Ple,formatLong:Ble,formatRelative:Ule,localize:Zle,match:pce,options:{weekStartsOn:0,firstWeekContainsDate:1}};function mce(e){const t=Un(e);return Ko(t,Hz(t))+1}function Kz(e){const t=Un(e),n=+Zd(t)-+Ele(t);return Math.round(n/rI)+1}function Yz(e,t){var u,h,p,m;const n=Un(e),r=n.getFullYear(),a=mb(),s=(t==null?void 0:t.firstWeekContainsDate)??((h=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??a.firstWeekContainsDate??((m=(p=a.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)??1,o=pi(e,0);o.setFullYear(r+1,0,s),o.setHours(0,0,0,0);const l=il(o,t),c=pi(e,0);c.setFullYear(r,0,s),c.setHours(0,0,0,0);const d=il(c,t);return n.getTime()>=l.getTime()?r+1:n.getTime()>=d.getTime()?r:r-1}function fce(e,t){var l,c,d,u;const n=mb(),r=(t==null?void 0:t.firstWeekContainsDate)??((c=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??n.firstWeekContainsDate??((u=(d=n.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,a=Yz(e,t),s=pi(e,0);return s.setFullYear(a,0,r),s.setHours(0,0,0,0),il(s,t)}function Xz(e,t){const n=Un(e),r=+il(n,t)-+fce(n,t);return Math.round(r/rI)+1}function ur(e,t){const n=e<0?"-":"",r=Math.abs(e).toString().padStart(t,"0");return n+r}const dc={y(e,t){const n=e.getFullYear(),r=n>0?n:1-n;return ur(t==="yy"?r%100:r,t.length)},M(e,t){const n=e.getMonth();return t==="M"?String(n+1):ur(n+1,2)},d(e,t){return ur(e.getDate(),t.length)},a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h(e,t){return ur(e.getHours()%12||12,t.length)},H(e,t){return ur(e.getHours(),t.length)},m(e,t){return ur(e.getMinutes(),t.length)},s(e,t){return ur(e.getSeconds(),t.length)},S(e,t){const n=t.length,r=e.getMilliseconds(),a=Math.trunc(r*Math.pow(10,n-3));return ur(a,t.length)}},im={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},e3={G:function(e,t,n){const r=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){const r=e.getFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return dc.y(e,t)},Y:function(e,t,n,r){const a=Yz(e,r),s=a>0?a:1-a;if(t==="YY"){const o=s%100;return ur(o,2)}return t==="Yo"?n.ordinalNumber(s,{unit:"year"}):ur(s,t.length)},R:function(e,t){const n=Vz(e);return ur(n,t.length)},u:function(e,t){const n=e.getFullYear();return ur(n,t.length)},Q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return ur(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){const r=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return ur(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){const r=e.getMonth();switch(t){case"M":case"MM":return dc.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){const r=e.getMonth();switch(t){case"L":return String(r+1);case"LL":return ur(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){const a=Xz(e,r);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):ur(a,t.length)},I:function(e,t,n){const r=Kz(e);return t==="Io"?n.ordinalNumber(r,{unit:"week"}):ur(r,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getDate(),{unit:"date"}):dc.d(e,t)},D:function(e,t,n){const r=mce(e);return t==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):ur(r,t.length)},E:function(e,t,n){const r=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){const a=e.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(s);case"ee":return ur(s,2);case"eo":return n.ordinalNumber(s,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){const a=e.getDay(),s=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(s);case"cc":return ur(s,t.length);case"co":return n.ordinalNumber(s,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){const r=e.getDay(),a=r===0?7:r;switch(t){case"i":return String(a);case"ii":return ur(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const r=e.getHours();let a;switch(r===12?a=im.noon:r===0?a=im.midnight:a=r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){const r=e.getHours();let a;switch(r>=17?a=im.evening:r>=12?a=im.afternoon:r>=4?a=im.morning:a=im.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){let r=e.getHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return dc.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getHours(),{unit:"hour"}):dc.H(e,t)},K:function(e,t,n){const r=e.getHours()%12;return t==="Ko"?n.ordinalNumber(r,{unit:"hour"}):ur(r,t.length)},k:function(e,t,n){let r=e.getHours();return r===0&&(r=24),t==="ko"?n.ordinalNumber(r,{unit:"hour"}):ur(r,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):dc.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getSeconds(),{unit:"second"}):dc.s(e,t)},S:function(e,t){return dc.S(e,t)},X:function(e,t,n){const r=e.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return n3(r);case"XXXX":case"XX":return rd(r);case"XXXXX":case"XXX":default:return rd(r,":")}},x:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"x":return n3(r);case"xxxx":case"xx":return rd(r);case"xxxxx":case"xxx":default:return rd(r,":")}},O:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+t3(r,":");case"OOOO":default:return"GMT"+rd(r,":")}},z:function(e,t,n){const r=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+t3(r,":");case"zzzz":default:return"GMT"+rd(r,":")}},t:function(e,t,n){const r=Math.trunc(e.getTime()/1e3);return ur(r,t.length)},T:function(e,t,n){const r=e.getTime();return ur(r,t.length)}};function t3(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),s=r%60;return s===0?n+String(a):n+String(a)+t+ur(s,2)}function n3(e,t){return e%60===0?(e>0?"-":"+")+ur(Math.abs(e)/60,2):rd(e,t)}function rd(e,t=""){const n=e>0?"-":"+",r=Math.abs(e),a=ur(Math.trunc(r/60),2),s=ur(r%60,2);return n+a+t+s}const r3=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Zz=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},gce=(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],r=n[1],a=n[2];if(!a)return r3(e,t);let s;switch(r){case"P":s=t.dateTime({width:"short"});break;case"PP":s=t.dateTime({width:"medium"});break;case"PPP":s=t.dateTime({width:"long"});break;case"PPPP":default:s=t.dateTime({width:"full"});break}return s.replace("{{date}}",r3(r,t)).replace("{{time}}",Zz(a,t))},xce={p:Zz,P:gce},yce=/^D+$/,bce=/^Y+$/,vce=["D","DD","YY","YYYY"];function wce(e){return yce.test(e)}function Nce(e){return bce.test(e)}function kce(e,t,n){const r=Sce(e,t,n);if(console.warn(r),vce.includes(e))throw new RangeError(r)}function Sce(e,t,n){const r=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${r} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Cce=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_ce=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,jce=/^'([^]*?)'?$/,Ice=/''/g,Tce=/[a-zA-Z]/;function Ht(e,t,n){var u,h,p,m,f,g,x,y;const r=mb(),a=(n==null?void 0:n.locale)??r.locale??qz,s=(n==null?void 0:n.firstWeekContainsDate)??((h=(u=n==null?void 0:n.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??r.firstWeekContainsDate??((m=(p=r.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)??1,o=(n==null?void 0:n.weekStartsOn)??((g=(f=n==null?void 0:n.locale)==null?void 0:f.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((y=(x=r.locale)==null?void 0:x.options)==null?void 0:y.weekStartsOn)??0,l=Un(e);if(!Mle(l))throw new RangeError("Invalid time value");let c=t.match(_ce).map(b=>{const v=b[0];if(v==="p"||v==="P"){const w=xce[v];return w(b,a.formatLong)}return b}).join("").match(Cce).map(b=>{if(b==="''")return{isToken:!1,value:"'"};const v=b[0];if(v==="'")return{isToken:!1,value:Ece(b)};if(e3[v])return{isToken:!0,value:b};if(v.match(Tce))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:b}});a.localize.preprocessor&&(c=a.localize.preprocessor(l,c));const d={firstWeekContainsDate:s,weekStartsOn:o,locale:a};return c.map(b=>{if(!b.isToken)return b.value;const v=b.value;(!(n!=null&&n.useAdditionalWeekYearTokens)&&Nce(v)||!(n!=null&&n.useAdditionalDayOfYearTokens)&&wce(v))&&kce(v,t,String(e));const w=e3[v[0]];return w(l,v,a.localize,d)}).join("")}function Ece(e){const t=e.match(jce);return t?t[1].replace(Ice,"'"):e}function Ace(e){const t=Un(e),n=t.getFullYear(),r=t.getMonth(),a=pi(e,0);return a.setFullYear(n,r+1,0),a.setHours(0,0,0,0),a.getDate()}function Rce(e){return Math.trunc(+Un(e)/1e3)}function Dce(e){const t=Un(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(0,0,0,0),t}function Mce(e,t){return $le(Dce(e),Vs(e),t)+1}function mC(e,t){const n=Un(e),r=Un(t);return n.getTime()>r.getTime()}function Qz(e,t){const n=Un(e),r=Un(t);return+n<+r}function oI(e,t){const n=Un(e),r=Un(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()}function $ce(e,t){const n=Un(e),r=Un(t);return n.getFullYear()===r.getFullYear()}function Am(e,t){return ms(e,-t)}function bS(e,t){const n=Un(e),r=n.getFullYear(),a=n.getDate(),s=pi(e,0);s.setFullYear(r,t,15),s.setHours(0,0,0,0);const o=Ace(s);return n.setMonth(t,Math.min(a,o)),n}function a3(e,t){const n=Un(e);return isNaN(+n)?pi(e,NaN):(n.setFullYear(t),n)}var Yt=function(){return Yt=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Yt.apply(this,arguments)};function Fce(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function Jz(e,t,n){for(var r=0,a=t.length,s;r<a;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function fb(e){return e.mode==="multiple"}function gb(e){return e.mode==="range"}function I1(e){return e.mode==="single"}var Pce={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Oce(e,t){return Ht(e,"LLLL y",t)}function Lce(e,t){return Ht(e,"d",t)}function zce(e,t){return Ht(e,"LLLL",t)}function Bce(e){return"".concat(e)}function Wce(e,t){return Ht(e,"cccccc",t)}function Uce(e,t){return Ht(e,"yyyy",t)}var Vce=Object.freeze({__proto__:null,formatCaption:Oce,formatDay:Lce,formatMonthCaption:zce,formatWeekNumber:Bce,formatWeekdayName:Wce,formatYearCaption:Uce}),Hce=function(e,t,n){return Ht(e,"do MMMM (EEEE)",n)},Gce=function(){return"Month: "},qce=function(){return"Go to next month"},Kce=function(){return"Go to previous month"},Yce=function(e,t){return Ht(e,"cccc",t)},Xce=function(e){return"Week n. ".concat(e)},Zce=function(){return"Year: "},Qce=Object.freeze({__proto__:null,labelDay:Hce,labelMonthDropdown:Gce,labelNext:qce,labelPrevious:Kce,labelWeekNumber:Xce,labelWeekday:Yce,labelYearDropdown:Zce});function Jce(){var e="buttons",t=Pce,n=qz,r={},a={},s=1,o={},l=new Date;return{captionLayout:e,classNames:t,formatters:Vce,labels:Qce,locale:n,modifiersClassNames:r,modifiers:a,numberOfMonths:s,styles:o,today:l,mode:"default"}}function eue(e){var t=e.fromYear,n=e.toYear,r=e.fromMonth,a=e.toMonth,s=e.fromDate,o=e.toDate;return r?s=Vs(r):t&&(s=new Date(t,0,1)),a?o=sI(a):n&&(o=new Date(n,11,31)),{fromDate:s?qo(s):void 0,toDate:o?qo(o):void 0}}var eB=N.createContext(void 0);function tue(e){var t,n=e.initialProps,r=Jce(),a=eue(n),s=a.fromDate,o=a.toDate,l=(t=n.captionLayout)!==null&&t!==void 0?t:r.captionLayout;l!=="buttons"&&(!s||!o)&&(l="buttons");var c;(I1(n)||fb(n)||gb(n))&&(c=n.onSelect);var d=Yt(Yt(Yt({},r),n),{captionLayout:l,classNames:Yt(Yt({},r.classNames),n.classNames),components:Yt({},n.components),formatters:Yt(Yt({},r.formatters),n.formatters),fromDate:s,labels:Yt(Yt({},r.labels),n.labels),mode:n.mode||r.mode,modifiers:Yt(Yt({},r.modifiers),n.modifiers),modifiersClassNames:Yt(Yt({},r.modifiersClassNames),n.modifiersClassNames),onSelect:c,styles:Yt(Yt({},r.styles),n.styles),toDate:o});return i.jsx(eB.Provider,{value:d,children:e.children})}function Tr(){var e=N.useContext(eB);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function tB(e){var t=Tr(),n=t.locale,r=t.classNames,a=t.styles,s=t.formatters.formatCaption;return i.jsx("div",{className:r.caption_label,style:a.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:s(e.displayMonth,{locale:n})})}function nue(e){return i.jsx("svg",Yt({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:i.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function nB(e){var t,n,r=e.onChange,a=e.value,s=e.children,o=e.caption,l=e.className,c=e.style,d=Tr(),u=(n=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&n!==void 0?n:nue;return i.jsxs("div",{className:l,style:c,children:[i.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),i.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:a,onChange:r,children:s}),i.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[o,i.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function rue(e){var t,n=Tr(),r=n.fromDate,a=n.toDate,s=n.styles,o=n.locale,l=n.formatters.formatMonthCaption,c=n.classNames,d=n.components,u=n.labels.labelMonthDropdown;if(!r)return i.jsx(i.Fragment,{});if(!a)return i.jsx(i.Fragment,{});var h=[];if($ce(r,a))for(var p=Vs(r),m=r.getMonth();m<=a.getMonth();m++)h.push(bS(p,m));else for(var p=Vs(new Date),m=0;m<=11;m++)h.push(bS(p,m));var f=function(x){var y=Number(x.target.value),b=bS(Vs(e.displayMonth),y);e.onChange(b)},g=(t=d==null?void 0:d.Dropdown)!==null&&t!==void 0?t:nB;return i.jsx(g,{name:"months","aria-label":u(),className:c.dropdown_month,style:s.dropdown_month,onChange:f,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:o}),children:h.map(function(x){return i.jsx("option",{value:x.getMonth(),children:l(x,{locale:o})},x.getMonth())})})}function aue(e){var t,n=e.displayMonth,r=Tr(),a=r.fromDate,s=r.toDate,o=r.locale,l=r.styles,c=r.classNames,d=r.components,u=r.formatters.formatYearCaption,h=r.labels.labelYearDropdown,p=[];if(!a)return i.jsx(i.Fragment,{});if(!s)return i.jsx(i.Fragment,{});for(var m=a.getFullYear(),f=s.getFullYear(),g=m;g<=f;g++)p.push(a3(Hz(new Date),g));var x=function(b){var v=a3(Vs(n),Number(b.target.value));e.onChange(v)},y=(t=d==null?void 0:d.Dropdown)!==null&&t!==void 0?t:nB;return i.jsx(y,{name:"years","aria-label":h(),className:c.dropdown_year,style:l.dropdown_year,onChange:x,value:n.getFullYear(),caption:u(n,{locale:o}),children:p.map(function(b){return i.jsx("option",{value:b.getFullYear(),children:u(b,{locale:o})},b.getFullYear())})})}function sue(e,t){var n=N.useState(e),r=n[0],a=n[1],s=t===void 0?r:t;return[s,a]}function iue(e){var t=e.month,n=e.defaultMonth,r=e.today,a=t||n||r||new Date,s=e.toDate,o=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(s&&$y(s,a)<0){var d=-1*(c-1);a=vo(s,d)}return o&&$y(a,o)<0&&(a=o),Vs(a)}function oue(){var e=Tr(),t=iue(e),n=sue(t,e.month),r=n[0],a=n[1],s=function(o){var l;if(!e.disableNavigation){var c=Vs(o);a(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[r,s]}function lue(e,t){for(var n=t.reverseMonths,r=t.numberOfMonths,a=Vs(e),s=Vs(vo(a,r)),o=$y(s,a),l=[],c=0;c<o;c++){var d=vo(a,c);l.push(d)}return n&&(l=l.reverse()),l}function cue(e,t){if(!t.disableNavigation){var n=t.toDate,r=t.pagedNavigation,a=t.numberOfMonths,s=a===void 0?1:a,o=r?s:1,l=Vs(e);if(!n)return vo(l,o);var c=$y(n,e);if(!(c<s))return vo(l,o)}}function uue(e,t){if(!t.disableNavigation){var n=t.fromDate,r=t.pagedNavigation,a=t.numberOfMonths,s=a===void 0?1:a,o=r?s:1,l=Vs(e);if(!n)return vo(l,-o);var c=$y(l,n);if(!(c<=0))return vo(l,-o)}}var rB=N.createContext(void 0);function due(e){var t=Tr(),n=oue(),r=n[0],a=n[1],s=lue(r,t),o=cue(r,t),l=uue(r,t),c=function(h){return s.some(function(p){return oI(h,p)})},d=function(h,p){c(h)||(p&&Qz(h,p)?a(vo(h,1+t.numberOfMonths*-1)):a(h))},u={currentMonth:r,displayMonths:s,goToMonth:a,goToDate:d,previousMonth:l,nextMonth:o,isDateDisplayed:c};return i.jsx(rB.Provider,{value:u,children:e.children})}function xb(){var e=N.useContext(rB);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function s3(e){var t,n=Tr(),r=n.classNames,a=n.styles,s=n.components,o=xb().goToMonth,l=function(u){o(vo(u,e.displayIndex?-e.displayIndex:0))},c=(t=s==null?void 0:s.CaptionLabel)!==null&&t!==void 0?t:tB,d=i.jsx(c,{id:e.id,displayMonth:e.displayMonth});return i.jsxs("div",{className:r.caption_dropdowns,style:a.caption_dropdowns,children:[i.jsx("div",{className:r.vhidden,children:d}),i.jsx(rue,{onChange:l,displayMonth:e.displayMonth}),i.jsx(aue,{onChange:l,displayMonth:e.displayMonth})]})}function hue(e){return i.jsx("svg",Yt({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:i.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function pue(e){return i.jsx("svg",Yt({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:i.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var _0=N.forwardRef(function(e,t){var n=Tr(),r=n.classNames,a=n.styles,s=[r.button_reset,r.button];e.className&&s.push(e.className);var o=s.join(" "),l=Yt(Yt({},a.button_reset),a.button);return e.style&&Object.assign(l,e.style),i.jsx("button",Yt({},e,{ref:t,type:"button",className:o,style:l}))});function mue(e){var t,n,r=Tr(),a=r.dir,s=r.locale,o=r.classNames,l=r.styles,c=r.labels,d=c.labelPrevious,u=c.labelNext,h=r.components;if(!e.nextMonth&&!e.previousMonth)return i.jsx(i.Fragment,{});var p=d(e.previousMonth,{locale:s}),m=[o.nav_button,o.nav_button_previous].join(" "),f=u(e.nextMonth,{locale:s}),g=[o.nav_button,o.nav_button_next].join(" "),x=(t=h==null?void 0:h.IconRight)!==null&&t!==void 0?t:pue,y=(n=h==null?void 0:h.IconLeft)!==null&&n!==void 0?n:hue;return i.jsxs("div",{className:o.nav,style:l.nav,children:[!e.hidePrevious&&i.jsx(_0,{name:"previous-month","aria-label":p,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:a==="rtl"?i.jsx(x,{className:o.nav_icon,style:l.nav_icon}):i.jsx(y,{className:o.nav_icon,style:l.nav_icon})}),!e.hideNext&&i.jsx(_0,{name:"next-month","aria-label":f,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:a==="rtl"?i.jsx(y,{className:o.nav_icon,style:l.nav_icon}):i.jsx(x,{className:o.nav_icon,style:l.nav_icon})})]})}function i3(e){var t=Tr().numberOfMonths,n=xb(),r=n.previousMonth,a=n.nextMonth,s=n.goToMonth,o=n.displayMonths,l=o.findIndex(function(f){return oI(e.displayMonth,f)}),c=l===0,d=l===o.length-1,u=t>1&&(c||!d),h=t>1&&(d||!c),p=function(){r&&s(r)},m=function(){a&&s(a)};return i.jsx(mue,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:h,nextMonth:a,previousMonth:r,onPreviousClick:p,onNextClick:m})}function fue(e){var t,n=Tr(),r=n.classNames,a=n.disableNavigation,s=n.styles,o=n.captionLayout,l=n.components,c=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:tB,d;return a?d=i.jsx(c,{id:e.id,displayMonth:e.displayMonth}):o==="dropdown"?d=i.jsx(s3,{displayMonth:e.displayMonth,id:e.id}):o==="dropdown-buttons"?d=i.jsxs(i.Fragment,{children:[i.jsx(s3,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),i.jsx(i3,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=i.jsxs(i.Fragment,{children:[i.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),i.jsx(i3,{displayMonth:e.displayMonth,id:e.id})]}),i.jsx("div",{className:r.caption,style:s.caption,children:d})}function gue(e){var t=Tr(),n=t.footer,r=t.styles,a=t.classNames.tfoot;return n?i.jsx("tfoot",{className:a,style:r.tfoot,children:i.jsx("tr",{children:i.jsx("td",{colSpan:8,children:n})})}):i.jsx(i.Fragment,{})}function xue(e,t,n){for(var r=n?Zd(new Date):il(new Date,{locale:e,weekStartsOn:t}),a=[],s=0;s<7;s++){var o=ms(r,s);a.push(o)}return a}function yue(){var e=Tr(),t=e.classNames,n=e.styles,r=e.showWeekNumber,a=e.locale,s=e.weekStartsOn,o=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=xue(a,s,o);return i.jsxs("tr",{style:n.head_row,className:t.head_row,children:[r&&i.jsx("td",{style:n.head_cell,className:t.head_cell}),d.map(function(u,h){return i.jsx("th",{scope:"col",className:t.head_cell,style:n.head_cell,"aria-label":c(u,{locale:a}),children:l(u,{locale:a})},h)})]})}function bue(){var e,t=Tr(),n=t.classNames,r=t.styles,a=t.components,s=(e=a==null?void 0:a.HeadRow)!==null&&e!==void 0?e:yue;return i.jsx("thead",{style:r.head,className:n.head,children:i.jsx(s,{})})}function vue(e){var t=Tr(),n=t.locale,r=t.formatters.formatDay;return i.jsx(i.Fragment,{children:r(e.date,{locale:n})})}var lI=N.createContext(void 0);function wue(e){if(!fb(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return i.jsx(lI.Provider,{value:t,children:e.children})}return i.jsx(Nue,{initialProps:e.initialProps,children:e.children})}function Nue(e){var t=e.initialProps,n=e.children,r=t.selected,a=t.min,s=t.max,o=function(d,u,h){var p,m;(p=t.onDayClick)===null||p===void 0||p.call(t,d,u,h);var f=!!(u.selected&&a&&(r==null?void 0:r.length)===a);if(!f){var g=!!(!u.selected&&s&&(r==null?void 0:r.length)===s);if(!g){var x=r?Jz([],r):[];if(u.selected){var y=x.findIndex(function(b){return Ws(d,b)});x.splice(y,1)}else x.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,x,d,u,h)}}},l={disabled:[]};r&&l.disabled.push(function(d){var u=s&&r.length>s-1,h=r.some(function(p){return Ws(p,d)});return!!(u&&!h)});var c={selected:r,onDayClick:o,modifiers:l};return i.jsx(lI.Provider,{value:c,children:n})}function cI(){var e=N.useContext(lI);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function kue(e,t){var n=t||{},r=n.from,a=n.to;return r&&a?Ws(a,e)&&Ws(r,e)?void 0:Ws(a,e)?{from:a,to:void 0}:Ws(r,e)?void 0:mC(r,e)?{from:e,to:a}:{from:r,to:e}:a?mC(e,a)?{from:a,to:e}:{from:e,to:a}:r?Qz(e,r)?{from:e,to:r}:{from:r,to:e}:{from:e,to:void 0}}var uI=N.createContext(void 0);function Sue(e){if(!gb(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return i.jsx(uI.Provider,{value:t,children:e.children})}return i.jsx(Cue,{initialProps:e.initialProps,children:e.children})}function Cue(e){var t=e.initialProps,n=e.children,r=t.selected,a=r||{},s=a.from,o=a.to,l=t.min,c=t.max,d=function(m,f,g){var x,y;(x=t.onDayClick)===null||x===void 0||x.call(t,m,f,g);var b=kue(m,r);(y=t.onSelect)===null||y===void 0||y.call(t,b,m,f,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(s?(u.range_start=[s],o?(u.range_end=[o],Ws(s,o)||(u.range_middle=[{after:s,before:o}])):u.range_end=[s]):o&&(u.range_start=[o],u.range_end=[o]),l&&(s&&!o&&u.disabled.push({after:Am(s,l-1),before:ms(s,l-1)}),s&&o&&u.disabled.push({after:s,before:ms(s,l-1)}),!s&&o&&u.disabled.push({after:Am(o,l-1),before:ms(o,l-1)})),c){if(s&&!o&&(u.disabled.push({before:ms(s,-c+1)}),u.disabled.push({after:ms(s,c-1)})),s&&o){var h=Ko(o,s)+1,p=c-h;u.disabled.push({before:Am(s,p)}),u.disabled.push({after:ms(o,p)})}!s&&o&&(u.disabled.push({before:ms(o,-c+1)}),u.disabled.push({after:ms(o,c-1)}))}return i.jsx(uI.Provider,{value:{selected:r,onDayClick:d,modifiers:u},children:n})}function dI(){var e=N.useContext(uI);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Tw(e){return Array.isArray(e)?Jz([],e):e!==void 0?[e]:[]}function _ue(e){var t={};return Object.entries(e).forEach(function(n){var r=n[0],a=n[1];t[r]=Tw(a)}),t}var wo;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(wo||(wo={}));var jue=wo.Selected,Sl=wo.Disabled,Iue=wo.Hidden,Tue=wo.Today,vS=wo.RangeEnd,wS=wo.RangeMiddle,NS=wo.RangeStart,Eue=wo.Outside;function Aue(e,t,n){var r,a=(r={},r[jue]=Tw(e.selected),r[Sl]=Tw(e.disabled),r[Iue]=Tw(e.hidden),r[Tue]=[e.today],r[vS]=[],r[wS]=[],r[NS]=[],r[Eue]=[],r);return e.fromDate&&a[Sl].push({before:e.fromDate}),e.toDate&&a[Sl].push({after:e.toDate}),fb(e)?a[Sl]=a[Sl].concat(t.modifiers[Sl]):gb(e)&&(a[Sl]=a[Sl].concat(n.modifiers[Sl]),a[NS]=n.modifiers[NS],a[wS]=n.modifiers[wS],a[vS]=n.modifiers[vS]),a}var aB=N.createContext(void 0);function Rue(e){var t=Tr(),n=cI(),r=dI(),a=Aue(t,n,r),s=_ue(t.modifiers),o=Yt(Yt({},a),s);return i.jsx(aB.Provider,{value:o,children:e.children})}function sB(){var e=N.useContext(aB);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Due(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Mue(e){return!!(e&&typeof e=="object"&&"from"in e)}function $ue(e){return!!(e&&typeof e=="object"&&"after"in e)}function Fue(e){return!!(e&&typeof e=="object"&&"before"in e)}function Pue(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Oue(e,t){var n,r=t.from,a=t.to;if(r&&a){var s=Ko(a,r)<0;s&&(n=[a,r],r=n[0],a=n[1]);var o=Ko(e,r)>=0&&Ko(a,e)>=0;return o}return a?Ws(a,e):r?Ws(r,e):!1}function Lue(e){return aI(e)}function zue(e){return Array.isArray(e)&&e.every(aI)}function Bue(e,t){return t.some(function(n){if(typeof n=="boolean")return n;if(Lue(n))return Ws(e,n);if(zue(n))return n.includes(e);if(Mue(n))return Oue(e,n);if(Pue(n))return n.dayOfWeek.includes(e.getDay());if(Due(n)){var r=Ko(n.before,e),a=Ko(n.after,e),s=r>0,o=a<0,l=mC(n.before,n.after);return l?o&&s:s||o}return $ue(n)?Ko(e,n.after)>0:Fue(n)?Ko(n.before,e)>0:typeof n=="function"?n(e):!1})}function hI(e,t,n){var r=Object.keys(t).reduce(function(s,o){var l=t[o];return Bue(e,l)&&s.push(o),s},[]),a={};return r.forEach(function(s){return a[s]=!0}),n&&!oI(e,n)&&(a.outside=!0),a}function Wue(e,t){for(var n=Vs(e[0]),r=sI(e[e.length-1]),a,s,o=n;o<=r;){var l=hI(o,t),c=!l.disabled&&!l.hidden;if(!c){o=ms(o,1);continue}if(l.selected)return o;l.today&&!s&&(s=o),a||(a=o),o=ms(o,1)}return s||a}var Uue=365;function iB(e,t){var n=t.moveBy,r=t.direction,a=t.context,s=t.modifiers,o=t.retry,l=o===void 0?{count:0,lastFocused:e}:o,c=a.weekStartsOn,d=a.fromDate,u=a.toDate,h=a.locale,p={day:ms,week:pC,month:vo,year:Ale,startOfWeek:function(x){return a.ISOWeek?Zd(x):il(x,{locale:h,weekStartsOn:c})},endOfWeek:function(x){return a.ISOWeek?Gz(x):iI(x,{locale:h,weekStartsOn:c})}},m=p[n](e,r==="after"?1:-1);r==="before"&&d?m=Rle([d,m]):r==="after"&&u&&(m=Dle([u,m]));var f=!0;if(s){var g=hI(m,s);f=!g.disabled&&!g.hidden}return f?m:l.count>Uue?l.lastFocused:iB(m,{moveBy:n,direction:r,context:a,modifiers:s,retry:Yt(Yt({},l),{count:l.count+1})})}var oB=N.createContext(void 0);function Vue(e){var t=xb(),n=sB(),r=N.useState(),a=r[0],s=r[1],o=N.useState(),l=o[0],c=o[1],d=Wue(t.displayMonths,n),u=a??(l&&t.isDateDisplayed(l))?l:d,h=function(){c(a),s(void 0)},p=function(x){s(x)},m=Tr(),f=function(x,y){if(a){var b=iB(a,{moveBy:x,direction:y,context:m,modifiers:n});Ws(a,b)||(t.goToDate(b,a),p(b))}},g={focusedDay:a,focusTarget:u,blur:h,focus:p,focusDayAfter:function(){return f("day","after")},focusDayBefore:function(){return f("day","before")},focusWeekAfter:function(){return f("week","after")},focusWeekBefore:function(){return f("week","before")},focusMonthBefore:function(){return f("month","before")},focusMonthAfter:function(){return f("month","after")},focusYearBefore:function(){return f("year","before")},focusYearAfter:function(){return f("year","after")},focusStartOfWeek:function(){return f("startOfWeek","before")},focusEndOfWeek:function(){return f("endOfWeek","after")}};return i.jsx(oB.Provider,{value:g,children:e.children})}function pI(){var e=N.useContext(oB);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function Hue(e,t){var n=sB(),r=hI(e,n,t);return r}var mI=N.createContext(void 0);function Gue(e){if(!I1(e.initialProps)){var t={selected:void 0};return i.jsx(mI.Provider,{value:t,children:e.children})}return i.jsx(que,{initialProps:e.initialProps,children:e.children})}function que(e){var t=e.initialProps,n=e.children,r=function(s,o,l){var c,d,u;if((c=t.onDayClick)===null||c===void 0||c.call(t,s,o,l),o.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,s,o,l);return}(u=t.onSelect)===null||u===void 0||u.call(t,s,s,o,l)},a={selected:t.selected,onDayClick:r};return i.jsx(mI.Provider,{value:a,children:n})}function lB(){var e=N.useContext(mI);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Kue(e,t){var n=Tr(),r=lB(),a=cI(),s=dI(),o=pI(),l=o.focusDayAfter,c=o.focusDayBefore,d=o.focusWeekAfter,u=o.focusWeekBefore,h=o.blur,p=o.focus,m=o.focusMonthBefore,f=o.focusMonthAfter,g=o.focusYearBefore,x=o.focusYearAfter,y=o.focusStartOfWeek,b=o.focusEndOfWeek,v=function($){var L,M,X,G;I1(n)?(L=r.onDayClick)===null||L===void 0||L.call(r,e,t,$):fb(n)?(M=a.onDayClick)===null||M===void 0||M.call(a,e,t,$):gb(n)?(X=s.onDayClick)===null||X===void 0||X.call(s,e,t,$):(G=n.onDayClick)===null||G===void 0||G.call(n,e,t,$)},w=function($){var L;p(e),(L=n.onDayFocus)===null||L===void 0||L.call(n,e,t,$)},k=function($){var L;h(),(L=n.onDayBlur)===null||L===void 0||L.call(n,e,t,$)},C=function($){var L;(L=n.onDayMouseEnter)===null||L===void 0||L.call(n,e,t,$)},S=function($){var L;(L=n.onDayMouseLeave)===null||L===void 0||L.call(n,e,t,$)},_=function($){var L;(L=n.onDayPointerEnter)===null||L===void 0||L.call(n,e,t,$)},I=function($){var L;(L=n.onDayPointerLeave)===null||L===void 0||L.call(n,e,t,$)},T=function($){var L;(L=n.onDayTouchCancel)===null||L===void 0||L.call(n,e,t,$)},A=function($){var L;(L=n.onDayTouchEnd)===null||L===void 0||L.call(n,e,t,$)},j=function($){var L;(L=n.onDayTouchMove)===null||L===void 0||L.call(n,e,t,$)},D=function($){var L;(L=n.onDayTouchStart)===null||L===void 0||L.call(n,e,t,$)},F=function($){var L;(L=n.onDayKeyUp)===null||L===void 0||L.call(n,e,t,$)},B=function($){var L;switch($.key){case"ArrowLeft":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?l():c();break;case"ArrowRight":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?c():l();break;case"ArrowDown":$.preventDefault(),$.stopPropagation(),d();break;case"ArrowUp":$.preventDefault(),$.stopPropagation(),u();break;case"PageUp":$.preventDefault(),$.stopPropagation(),$.shiftKey?g():m();break;case"PageDown":$.preventDefault(),$.stopPropagation(),$.shiftKey?x():f();break;case"Home":$.preventDefault(),$.stopPropagation(),y();break;case"End":$.preventDefault(),$.stopPropagation(),b();break}(L=n.onDayKeyDown)===null||L===void 0||L.call(n,e,t,$)},q={onClick:v,onFocus:w,onBlur:k,onKeyDown:B,onKeyUp:F,onMouseEnter:C,onMouseLeave:S,onPointerEnter:_,onPointerLeave:I,onTouchCancel:T,onTouchEnd:A,onTouchMove:j,onTouchStart:D};return q}function Yue(){var e=Tr(),t=lB(),n=cI(),r=dI(),a=I1(e)?t.selected:fb(e)?n.selected:gb(e)?r.selected:void 0;return a}function Xue(e){return Object.values(wo).includes(e)}function Zue(e,t){var n=[e.classNames.day];return Object.keys(t).forEach(function(r){var a=e.modifiersClassNames[r];if(a)n.push(a);else if(Xue(r)){var s=e.classNames["day_".concat(r)];s&&n.push(s)}}),n}function Que(e,t){var n=Yt({},e.styles.day);return Object.keys(t).forEach(function(r){var a;n=Yt(Yt({},n),(a=e.modifiersStyles)===null||a===void 0?void 0:a[r])}),n}function Jue(e,t,n){var r,a,s,o=Tr(),l=pI(),c=Hue(e,t),d=Kue(e,c),u=Yue(),h=!!(o.onDayClick||o.mode!=="default");N.useEffect(function(){var C;c.outside||l.focusedDay&&h&&Ws(l.focusedDay,e)&&((C=n.current)===null||C===void 0||C.focus())},[l.focusedDay,e,n,h,c.outside]);var p=Zue(o,c).join(" "),m=Que(o,c),f=!!(c.outside&&!o.showOutsideDays||c.hidden),g=(s=(a=o.components)===null||a===void 0?void 0:a.DayContent)!==null&&s!==void 0?s:vue,x=i.jsx(g,{date:e,displayMonth:t,activeModifiers:c}),y={style:m,className:p,children:x,role:"gridcell"},b=l.focusTarget&&Ws(l.focusTarget,e)&&!c.outside,v=l.focusedDay&&Ws(l.focusedDay,e),w=Yt(Yt(Yt({},y),(r={disabled:c.disabled,role:"gridcell"},r["aria-selected"]=c.selected,r.tabIndex=v||b?0:-1,r)),d),k={isButton:h,isHidden:f,activeModifiers:c,selectedDays:u,buttonProps:w,divProps:y};return k}function ede(e){var t=N.useRef(null),n=Jue(e.date,e.displayMonth,t);return n.isHidden?i.jsx("div",{role:"gridcell"}):n.isButton?i.jsx(_0,Yt({name:"day",ref:t},n.buttonProps)):i.jsx("div",Yt({},n.divProps))}function tde(e){var t=e.number,n=e.dates,r=Tr(),a=r.onWeekNumberClick,s=r.styles,o=r.classNames,l=r.locale,c=r.labels.labelWeekNumber,d=r.formatters.formatWeekNumber,u=d(Number(t),{locale:l});if(!a)return i.jsx("span",{className:o.weeknumber,style:s.weeknumber,children:u});var h=c(Number(t),{locale:l}),p=function(m){a(t,n,m)};return i.jsx(_0,{name:"week-number","aria-label":h,className:o.weeknumber,style:s.weeknumber,onClick:p,children:u})}function nde(e){var t,n,r=Tr(),a=r.styles,s=r.classNames,o=r.showWeekNumber,l=r.components,c=(t=l==null?void 0:l.Day)!==null&&t!==void 0?t:ede,d=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:tde,u;return o&&(u=i.jsx("td",{className:s.cell,style:a.cell,children:i.jsx(d,{number:e.weekNumber,dates:e.dates})})),i.jsxs("tr",{className:s.row,style:a.row,children:[u,e.dates.map(function(h){return i.jsx("td",{className:s.cell,style:a.cell,role:"presentation",children:i.jsx(c,{displayMonth:e.displayMonth,date:h})},Rce(h))})]})}function o3(e,t,n){for(var r=n!=null&&n.ISOWeek?Gz(t):iI(t,n),a=n!=null&&n.ISOWeek?Zd(e):il(e,n),s=Ko(r,a),o=[],l=0;l<=s;l++)o.push(ms(a,l));var c=o.reduce(function(d,u){var h=n!=null&&n.ISOWeek?Kz(u):Xz(u,n),p=d.find(function(m){return m.weekNumber===h});return p?(p.dates.push(u),d):(d.push({weekNumber:h,dates:[u]}),d)},[]);return c}function rde(e,t){var n=o3(Vs(e),sI(e),t);if(t!=null&&t.useFixedWeeks){var r=Mce(e,t);if(r<6){var a=n[n.length-1],s=a.dates[a.dates.length-1],o=pC(s,6-r),l=o3(pC(s,1),o,t);n.push.apply(n,l)}}return n}function ade(e){var t,n,r,a=Tr(),s=a.locale,o=a.classNames,l=a.styles,c=a.hideHead,d=a.fixedWeeks,u=a.components,h=a.weekStartsOn,p=a.firstWeekContainsDate,m=a.ISOWeek,f=rde(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:s,weekStartsOn:h,firstWeekContainsDate:p}),g=(t=u==null?void 0:u.Head)!==null&&t!==void 0?t:bue,x=(n=u==null?void 0:u.Row)!==null&&n!==void 0?n:nde,y=(r=u==null?void 0:u.Footer)!==null&&r!==void 0?r:gue;return i.jsxs("table",{id:e.id,className:o.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&i.jsx(g,{}),i.jsx("tbody",{className:o.tbody,style:l.tbody,children:f.map(function(b){return i.jsx(x,{displayMonth:e.displayMonth,dates:b.dates,weekNumber:b.weekNumber},b.weekNumber)})}),i.jsx(y,{displayMonth:e.displayMonth})]})}function sde(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var ide=sde()?N.useLayoutEffect:N.useEffect,kS=!1,ode=0;function l3(){return"react-day-picker-".concat(++ode)}function lde(e){var t,n=e??(kS?l3():null),r=N.useState(n),a=r[0],s=r[1];return ide(function(){a===null&&s(l3())},[]),N.useEffect(function(){kS===!1&&(kS=!0)},[]),(t=e??a)!==null&&t!==void 0?t:void 0}function cde(e){var t,n,r=Tr(),a=r.dir,s=r.classNames,o=r.styles,l=r.components,c=xb().displayMonths,d=lde(r.id?"".concat(r.id,"-").concat(e.displayIndex):void 0),u=r.id?"".concat(r.id,"-grid-").concat(e.displayIndex):void 0,h=[s.month],p=o.month,m=e.displayIndex===0,f=e.displayIndex===c.length-1,g=!m&&!f;a==="rtl"&&(t=[m,f],f=t[0],m=t[1]),m&&(h.push(s.caption_start),p=Yt(Yt({},p),o.caption_start)),f&&(h.push(s.caption_end),p=Yt(Yt({},p),o.caption_end)),g&&(h.push(s.caption_between),p=Yt(Yt({},p),o.caption_between));var x=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:fue;return i.jsxs("div",{className:h.join(" "),style:p,children:[i.jsx(x,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),i.jsx(ade,{id:u,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function ude(e){var t=Tr(),n=t.classNames,r=t.styles;return i.jsx("div",{className:n.months,style:r.months,children:e.children})}function dde(e){var t,n,r=e.initialProps,a=Tr(),s=pI(),o=xb(),l=N.useState(!1),c=l[0],d=l[1];N.useEffect(function(){a.initialFocus&&s.focusTarget&&(c||(s.focus(s.focusTarget),d(!0)))},[a.initialFocus,c,s.focus,s.focusTarget,s]);var u=[a.classNames.root,a.className];a.numberOfMonths>1&&u.push(a.classNames.multiple_months),a.showWeekNumber&&u.push(a.classNames.with_weeknumber);var h=Yt(Yt({},a.styles.root),a.style),p=Object.keys(r).filter(function(f){return f.startsWith("data-")}).reduce(function(f,g){var x;return Yt(Yt({},f),(x={},x[g]=r[g],x))},{}),m=(n=(t=r.components)===null||t===void 0?void 0:t.Months)!==null&&n!==void 0?n:ude;return i.jsx("div",Yt({className:u.join(" "),style:h,dir:a.dir,id:a.id,nonce:r.nonce,title:r.title,lang:r.lang},p,{children:i.jsx(m,{children:o.displayMonths.map(function(f,g){return i.jsx(cde,{displayIndex:g,displayMonth:f},g)})})}))}function hde(e){var t=e.children,n=Fce(e,["children"]);return i.jsx(tue,{initialProps:n,children:i.jsx(due,{children:i.jsx(Gue,{initialProps:n,children:i.jsx(wue,{initialProps:n,children:i.jsx(Sue,{initialProps:n,children:i.jsx(Rue,{children:i.jsx(Vue,{children:t})})})})})})})}function pde(e){return i.jsx(hde,Yt({},e,{children:i.jsx(dde,{initialProps:e})}))}function j0({className:e,classNames:t,showOutsideDays:n=!0,...r}){return i.jsx(pde,{showOutsideDays:n,className:Ie("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Ie(Cy({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Ie(Cy({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...a})=>i.jsx(mO,{className:"h-4 w-4"}),IconRight:({...a})=>i.jsx(wy,{className:"h-4 w-4"})},...r})}j0.displayName="Calendar";const mde=[{name:"Hot",color:"#ef4444"},{name:"Warm",color:"#f97316"},{name:"Cold",color:"#3b82f6"},{name:"Client",color:"#22c55e"},{name:"Follow-up",color:"#a855f7"}];let SS=!1;const cB="synka_tags_cache",CS=e=>{try{const t=localStorage.getItem(`${cB}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},fde=(e,t)=>{try{localStorage.setItem(`${cB}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function uB(){const{user:e}=or(),[t,n]=N.useState(()=>e?CS(e.id):[]),[r,a]=N.useState(()=>e?CS(e.id).length===0:!1);N.useEffect(()=>{if(e){const u=CS(e.id);u.length>0&&t.length===0&&(n(u),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:u,error:h}=await ue.from("tags").select("*").eq("user_id",e.id).order("created_at",{ascending:!0});h?(console.error("Error fetching tags:",h),n([])):u&&u.length===0?SS||(SS=!0,await o(),SS=!1):(n(u),e&&fde(e.id,u)),a(!1)},o=async()=>{if(!e)return;const u=mde.map(m=>({...m,user_id:e.id})),{data:h,error:p}=await ue.from("tags").insert(u).select();p?console.error("Error seeding tags:",p):n(h)};return{tags:t,loading:r,createTag:async(u,h)=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await ue.from("tags").insert({user_id:e.id,name:u,color:h||"#6366f1"}).select().single();return!m&&p&&n(f=>[...f,p]),{data:p,error:m}},deleteTag:async u=>{const{error:h}=await ue.from("tags").delete().eq("id",u);return h||n(p=>p.filter(m=>m.id!==u)),{error:h}},updateTag:async(u,h)=>{const{error:p}=await ue.from("tags").update(h).eq("id",u);return p||n(m=>m.map(f=>f.id===u?{...f,...h}:f)),{error:p}},refetch:s}}const gde=()=>{const e=new Date("2026-01-01T10:00:00+05:30"),t=new Date("2026-01-01T17:00:00+05:30");return[{title:"Networking Meetup",description:"Local business networking event",start_time:e.toISOString(),end_time:t.toISOString()}]};let _S=!1;const dB="synka_events_cache",jS=e=>{try{const t=localStorage.getItem(`${dB}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},xde=(e,t)=>{try{localStorage.setItem(`${dB}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function fI(){const{user:e}=or(),[t,n]=N.useState(()=>e?jS(e.id):[]),[r,a]=N.useState(()=>e?jS(e.id).length===0:!1);N.useEffect(()=>{if(e){const h=jS(e.id);h.length>0&&t.length===0&&(n(h),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:h,error:p}=await ue.from("events").select("*").eq("user_id",e.id).order("start_time",{ascending:!1});p?(console.error("Error fetching events:",p),n([])):h&&h.length===0?_S||(_S=!0,await o(),_S=!1):(n(h),e&&xde(e.id,h)),a(!1)},o=async()=>{if(!e)return;const h=gde().map(f=>({...f,user_id:e.id})),{data:p,error:m}=await ue.from("events").insert(h).select();m?console.error("Error seeding events:",m):n(p)};return{events:t,loading:r,addEvent:async h=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await ue.from("events").insert({...h,user_id:e.id,start_time:h.start_time||new Date().toISOString()}).select().single();return!m&&p&&n(f=>[p,...f]),{data:p,error:m}},updateEvent:async(h,p)=>{const{error:m}=await ue.from("events").update(p).eq("id",h);return m||n(f=>f.map(g=>g.id===h?{...g,...p}:g)),{error:m}},deleteEvent:async h=>{const{error:p}=await ue.from("events").delete().eq("id",h);return p||n(m=>m.filter(f=>f.id!==h)),{error:p}},getActiveEventsForDate:h=>t.filter(p=>{const m=new Date(p.start_time),f=p.end_time?new Date(p.end_time):m;return h>=m&&h<=f}),refetch:s}}const yde=Object.freeze(Object.defineProperty({__proto__:null,useEvents:fI},Symbol.toStringTag,{value:"Module"})),bde=[{name:"Introduction",channel:"whatsapp",subject:null,body:`Hi {{name}}, It was nice connecting with you.
Sharing my details here: My Digital Card {{myCardLink}}
Happy to stay in touch.

{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Follow-up",channel:"whatsapp",subject:null,body:`Hello {{name}}, I hope you are keeping well.
Would be glad to connect at a time convenient for you.

{{myName}}
My Digital Card {{myCardLink}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Introduction",channel:"email",subject:"Connecting after our introduction",body:`Hello {{name}},

It was a pleasure connecting with you.

Please find my contact details below.
My Digital Card {{myCardLink}}

I look forward to continuing the conversation.

Warm regards,
{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1},{name:"Follow-up",channel:"email",subject:"Connecting further",body:`Hello {{name}},

I hope you are keeping well.
I thought this might be a good moment to reconnect.
Would be glad to connect at a time convenient for you.

My Digital Card {{myCardLink}}

Kind regards,
{{myName}}
{{myCompany}}`,is_selected_for_email:!1,is_selected_for_whatsapp:!1}],c3=e=>{const t=[{regex:/\b(their|the|recipient's?)\s*(name|first\s*name)\b/gi,placeholder:"{{name}}"},{regex:/\b(their|the|recipient's?)\s*(company|organization|firm)\b/gi,placeholder:"{{company}}"},{regex:/\b(their|the|recipient's?)\s*(title|designation|role|position)\b/gi,placeholder:"{{designation}}"},{regex:/\b(my|your|sender's?)\s*(name|first\s*name)\b/gi,placeholder:"{{myName}}"},{regex:/\b(my|your|sender's?)\s*(company|organization|firm)\b/gi,placeholder:"{{myCompany}}"}];let n=e;return t.forEach(({regex:r,placeholder:a})=>{n=n.replace(r,a)}),n};let IS=!1;const hB="synka_templates_cache",TS=e=>{try{const t=localStorage.getItem(`${hB}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},vde=(e,t)=>{try{localStorage.setItem(`${hB}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function pB(){const{user:e}=or(),[t,n]=N.useState(()=>e?TS(e.id):[]),[r,a]=N.useState(()=>e?TS(e.id).length===0:!1);N.useEffect(()=>{if(e){const f=TS(e.id);f.length>0&&t.length===0&&(n(f),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:f,error:g}=await ue.from("contact_templates").select("*").eq("user_id",e.id).order("created_at",{ascending:!0});g?(console.error("Error fetching templates:",g),n([])):f&&f.length===0?IS||(IS=!0,await o(),IS=!1):(n(f),e&&vde(e.id,f)),a(!1)},o=async()=>{if(!e)return;const f=bde.map(y=>({...y,user_id:e.id})),{data:g,error:x}=await ue.from("contact_templates").insert(f).select();x?console.error("Error seeding templates:",x):n(g)};return{templates:t,loading:r,addTemplate:async f=>{if(!e)return{error:new Error("Not authenticated")};const g={...f,body:c3(f.body),subject:f.subject?c3(f.subject):null},{data:x,error:y}=await ue.from("contact_templates").insert({...g,user_id:e.id}).select().single();return!y&&x&&n(b=>[...b,x]),{data:x,error:y}},updateTemplate:async(f,g)=>{const{error:x}=await ue.from("contact_templates").update(g).eq("id",f);return x||n(y=>y.map(b=>b.id===f?{...b,...g}:b)),{error:x}},deleteTemplate:async f=>{const{error:g}=await ue.from("contact_templates").delete().eq("id",f);return g||n(x=>x.filter(y=>y.id!==f)),{error:g}},getEmailTemplates:()=>t.filter(f=>f.channel==="email"||f.channel==="both"),getWhatsappTemplates:()=>t.filter(f=>f.channel==="whatsapp"||f.channel==="both"),getSelectedEmailTemplate:()=>t.find(f=>f.is_selected_for_email),getSelectedWhatsappTemplate:()=>t.find(f=>f.is_selected_for_whatsapp),refetch:s}}const mB="synka_signatures_cache",ES=e=>{try{const t=localStorage.getItem(`${mB}_${e}`);if(t){const{data:n,timestamp:r}=JSON.parse(t);if(Date.now()-r<30*60*1e3)return n}}catch{}return[]},wde=(e,t)=>{try{localStorage.setItem(`${mB}_${e}`,JSON.stringify({data:t,timestamp:Date.now()}))}catch{}};function fB(){const{user:e}=or(),[t,n]=N.useState(()=>e?ES(e.id):[]),[r,a]=N.useState(()=>e?ES(e.id).length===0:!1);N.useEffect(()=>{if(e){const h=ES(e.id);h.length>0&&t.length===0&&(n(h),a(!1)),s()}else n([]),a(!1)},[e]);const s=async()=>{if(!e)return;a(!0);const{data:h,error:p}=await ue.from("email_signatures").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});p?(console.error("Error fetching signatures:",p),n([])):(n(h),e&&wde(e.id,h)),a(!1)};return{signatures:t,loading:r,addSignature:async h=>{if(!e)return{error:new Error("Not authenticated")};const{data:p,error:m}=await ue.from("email_signatures").insert({...h,user_id:e.id}).select().single();return!m&&p&&n(f=>[p,...f]),{data:p,error:m}},updateSignature:async(h,p)=>{const{error:m}=await ue.from("email_signatures").update(p).eq("id",h);return m||n(f=>f.map(g=>g.id===h?{...g,...p}:g)),{error:m}},deleteSignature:async h=>{const{error:p}=await ue.from("email_signatures").delete().eq("id",h);return p||n(m=>m.filter(f=>f.id!==h)),{error:p}},selectSignature:async h=>{if(!e)return{error:new Error("Not authenticated")};await ue.from("email_signatures").update({is_selected:!1}).eq("user_id",e.id);const{error:p}=await ue.from("email_signatures").update({is_selected:!0}).eq("id",h);return p||n(m=>m.map(f=>({...f,is_selected:f.id===h}))),{error:p}},getSelectedSignature:()=>t.find(h=>h.is_selected),refetch:s}}function Nde(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const n=document.implementation.createHTMLDocument(),r=n.createElement("base"),a=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(a),t&&(r.href=t),a.href=e,a.href}const kde=(()=>{let e=0;const t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function Kc(e){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n]);return t}let om=null;function gB(e={}){return om||(e.includeStyleProperties?(om=e.includeStyleProperties,om):(om=Kc(window.getComputedStyle(document.documentElement)),om))}function I0(e,t){const r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function Sde(e){const t=I0(e,"border-left-width"),n=I0(e,"border-right-width");return e.clientWidth+t+n}function Cde(e){const t=I0(e,"border-top-width"),n=I0(e,"border-bottom-width");return e.clientHeight+t+n}function xB(e,t={}){const n=t.width||Sde(e),r=t.height||Cde(e);return{width:n,height:r}}function _de(){let e,t;try{t=process}catch{}const n=t&&t.env?t.env.devicePixelRatio:null;return n&&(e=parseInt(n,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}const ei=16384;function jde(e){(e.width>ei||e.height>ei)&&(e.width>ei&&e.height>ei?e.width>e.height?(e.height*=ei/e.width,e.width=ei):(e.width*=ei/e.height,e.height=ei):e.width>ei?(e.height*=ei/e.width,e.width=ei):(e.width*=ei/e.height,e.height=ei))}function T0(e){return new Promise((t,n)=>{const r=new Image;r.onload=()=>{r.decode().then(()=>{requestAnimationFrame(()=>t(r))})},r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=e})}async function Ide(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function Tde(e,t,n){const r="http://www.w3.org/2000/svg",a=document.createElementNS(r,"svg"),s=document.createElementNS(r,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${n}`),a.setAttribute("viewBox",`0 0 ${t} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),a.appendChild(s),s.appendChild(e),Ide(a)}const Hs=(e,t)=>{if(e instanceof t)return!0;const n=Object.getPrototypeOf(e);return n===null?!1:n.constructor.name===t.name||Hs(n,t)};function Ede(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function Ade(e,t){return gB(t).map(n=>{const r=e.getPropertyValue(n),a=e.getPropertyPriority(n);return`${n}: ${r}${a?" !important":""};`}).join(" ")}function Rde(e,t,n,r){const a=`.${e}:${t}`,s=n.cssText?Ede(n):Ade(n,r);return document.createTextNode(`${a}{${s}}`)}function u3(e,t,n,r){const a=window.getComputedStyle(e,n),s=a.getPropertyValue("content");if(s===""||s==="none")return;const o=kde();try{t.className=`${t.className} ${o}`}catch{return}const l=document.createElement("style");l.appendChild(Rde(o,n,a,r)),t.appendChild(l)}function Dde(e,t,n){u3(e,t,":before",n),u3(e,t,":after",n)}const d3="application/font-woff",h3="image/jpeg",Mde={woff:d3,woff2:d3,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:h3,jpeg:h3,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function $de(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function gI(e){const t=$de(e).toLowerCase();return Mde[t]||""}function Fde(e){return e.split(/,/)[1]}function fC(e){return e.search(/^(data:)/)!==-1}function Pde(e,t){return`data:${t};base64,${e}`}async function yB(e,t,n){const r=await fetch(e,t);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const a=await r.blob();return new Promise((s,o)=>{const l=new FileReader;l.onerror=o,l.onloadend=()=>{try{s(n({res:r,result:l.result}))}catch(c){o(c)}},l.readAsDataURL(a)})}const AS={};function Ode(e,t,n){let r=e.replace(/\?.*/,"");return n&&(r=e),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),t?`[${t}]${r}`:r}async function xI(e,t,n){const r=Ode(e,t,n.includeQueryParams);if(AS[r]!=null)return AS[r];n.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{const s=await yB(e,n.fetchRequestInit,({res:o,result:l})=>(t||(t=o.headers.get("Content-Type")||""),Fde(l)));a=Pde(s,t)}catch(s){a=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return AS[r]=a,a}async function Lde(e){const t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):T0(t)}async function zde(e,t){if(e.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=e.clientWidth,s.height=e.clientHeight,o==null||o.drawImage(e,0,0,s.width,s.height);const l=s.toDataURL();return T0(l)}const n=e.poster,r=gI(n),a=await xI(n,r,t);return T0(a)}async function Bde(e,t){var n;try{if(!((n=e==null?void 0:e.contentDocument)===null||n===void 0)&&n.body)return await T1(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function Wde(e,t){return Hs(e,HTMLCanvasElement)?Lde(e):Hs(e,HTMLVideoElement)?zde(e,t):Hs(e,HTMLIFrameElement)?Bde(e,t):e.cloneNode(bB(e))}const Ude=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",bB=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function Vde(e,t,n){var r,a;if(bB(t))return t;let s=[];return Ude(e)&&e.assignedNodes?s=Kc(e.assignedNodes()):Hs(e,HTMLIFrameElement)&&(!((r=e.contentDocument)===null||r===void 0)&&r.body)?s=Kc(e.contentDocument.body.childNodes):s=Kc(((a=e.shadowRoot)!==null&&a!==void 0?a:e).childNodes),s.length===0||Hs(e,HTMLVideoElement)||await s.reduce((o,l)=>o.then(()=>T1(l,n)).then(c=>{c&&t.appendChild(c)}),Promise.resolve()),t}function Hde(e,t,n){const r=t.style;if(!r)return;const a=window.getComputedStyle(e);a.cssText?(r.cssText=a.cssText,r.transformOrigin=a.transformOrigin):gB(n).forEach(s=>{let o=a.getPropertyValue(s);s==="font-size"&&o.endsWith("px")&&(o=`${Math.floor(parseFloat(o.substring(0,o.length-2)))-.1}px`),Hs(e,HTMLIFrameElement)&&s==="display"&&o==="inline"&&(o="block"),s==="d"&&t.getAttribute("d")&&(o=`path(${t.getAttribute("d")})`),r.setProperty(s,o,a.getPropertyPriority(s))})}function Gde(e,t){Hs(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),Hs(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function qde(e,t){if(Hs(e,HTMLSelectElement)){const n=t,r=Array.from(n.children).find(a=>e.value===a.getAttribute("value"));r&&r.setAttribute("selected","")}}function Kde(e,t,n){return Hs(t,Element)&&(Hde(e,t,n),Dde(e,t,n),Gde(e,t),qde(e,t)),t}async function Yde(e,t){const n=e.querySelectorAll?e.querySelectorAll("use"):[];if(n.length===0)return e;const r={};for(let s=0;s<n.length;s++){const l=n[s].getAttribute("xlink:href");if(l){const c=e.querySelector(l),d=document.querySelector(l);!c&&d&&!r[l]&&(r[l]=await T1(d,t,!0))}}const a=Object.values(r);if(a.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const l=document.createElementNS(s,"defs");o.appendChild(l);for(let c=0;c<a.length;c++)l.appendChild(a[c]);e.appendChild(o)}return e}async function T1(e,t,n){return!n&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(r=>Wde(r,t)).then(r=>Vde(e,r,t)).then(r=>Kde(e,r,t)).then(r=>Yde(r,t))}const vB=/url\((['"]?)([^'"]+?)\1\)/g,Xde=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Zde=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Qde(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Jde(e){const t=[];return e.replace(vB,(n,r,a)=>(t.push(a),n)),t.filter(n=>!fC(n))}async function ehe(e,t,n,r,a){try{const s=n?Nde(t,n):t,o=gI(t);let l;return a||(l=await xI(s,o,r)),e.replace(Qde(t),`$1${l}$3`)}catch{}return e}function the(e,{preferredFontFormat:t}){return t?e.replace(Zde,n=>{for(;;){const[r,,a]=Xde.exec(n)||[];if(!a)return"";if(a===t)return`src: ${r};`}}):e}function wB(e){return e.search(vB)!==-1}async function NB(e,t,n){if(!wB(e))return e;const r=the(e,n);return Jde(r).reduce((s,o)=>s.then(l=>ehe(l,o,t,n)),Promise.resolve(r))}async function lm(e,t,n){var r;const a=(r=t.style)===null||r===void 0?void 0:r.getPropertyValue(e);if(a){const s=await NB(a,null,n);return t.style.setProperty(e,s,t.style.getPropertyPriority(e)),!0}return!1}async function nhe(e,t){await lm("background",e,t)||await lm("background-image",e,t),await lm("mask",e,t)||await lm("-webkit-mask",e,t)||await lm("mask-image",e,t)||await lm("-webkit-mask-image",e,t)}async function rhe(e,t){const n=Hs(e,HTMLImageElement);if(!(n&&!fC(e.src))&&!(Hs(e,SVGImageElement)&&!fC(e.href.baseVal)))return;const r=n?e.src:e.href.baseVal,a=await xI(r,gI(r),t);await new Promise((s,o)=>{e.onload=s,e.onerror=t.onImageErrorHandler?(...c)=>{try{s(t.onImageErrorHandler(...c))}catch(d){o(d)}}:o;const l=e;l.decode&&(l.decode=s),l.loading==="lazy"&&(l.loading="eager"),n?(e.srcset="",e.src=a):e.href.baseVal=a})}async function ahe(e,t){const r=Kc(e.childNodes).map(a=>kB(a,t));await Promise.all(r).then(()=>e)}async function kB(e,t){Hs(e,Element)&&(await nhe(e,t),await rhe(e,t),await ahe(e,t))}function she(e,t){const{style:n}=e;t.backgroundColor&&(n.backgroundColor=t.backgroundColor),t.width&&(n.width=`${t.width}px`),t.height&&(n.height=`${t.height}px`);const r=t.style;return r!=null&&Object.keys(r).forEach(a=>{n[a]=r[a]}),e}const p3={};async function m3(e){let t=p3[e];if(t!=null)return t;const r=await(await fetch(e)).text();return t={url:e,cssText:r},p3[e]=t,t}async function f3(e,t){let n=e.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,s=(n.match(/url\([^)]+\)/g)||[]).map(async o=>{let l=o.replace(r,"$1");return l.startsWith("https://")||(l=new URL(l,e.url).href),yB(l,t.fetchRequestInit,({result:c})=>(n=n.replace(o,`url(${c})`),[o,c]))});return Promise.all(s).then(()=>n)}function g3(e){if(e==null)return[];const t=[],n=/(\/\*[\s\S]*?\*\/)/gi;let r=e.replace(n,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const c=a.exec(r);if(c===null)break;t.push(c[0])}r=r.replace(a,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",l=new RegExp(o,"gi");for(;;){let c=s.exec(r);if(c===null){if(c=l.exec(r),c===null)break;s.lastIndex=l.lastIndex}else l.lastIndex=s.lastIndex;t.push(c[0])}return t}async function ihe(e,t){const n=[],r=[];return e.forEach(a=>{if("cssRules"in a)try{Kc(a.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let l=o+1;const c=s.href,d=m3(c).then(u=>f3(u,t)).then(u=>g3(u).forEach(h=>{try{a.insertRule(h,h.startsWith("@import")?l+=1:a.cssRules.length)}catch(p){console.error("Error inserting rule from remote css",{rule:h,error:p})}})).catch(u=>{console.error("Error loading remote css",u.toString())});r.push(d)}})}catch(s){const o=e.find(l=>l.href==null)||document.styleSheets[0];a.href!=null&&r.push(m3(a.href).then(l=>f3(l,t)).then(l=>g3(l).forEach(c=>{o.insertRule(c,o.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",s)}}),Promise.all(r).then(()=>(e.forEach(a=>{if("cssRules"in a)try{Kc(a.cssRules||[]).forEach(s=>{n.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${a.href}`,s)}}),n))}function ohe(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>wB(t.style.getPropertyValue("src")))}async function lhe(e,t){if(e.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=Kc(e.ownerDocument.styleSheets),r=await ihe(n,t);return ohe(r)}function SB(e){return e.trim().replace(/["']/g,"")}function che(e){const t=new Set;function n(r){(r.style.fontFamily||getComputedStyle(r).fontFamily).split(",").forEach(s=>{t.add(SB(s))}),Array.from(r.children).forEach(s=>{s instanceof HTMLElement&&n(s)})}return n(e),t}async function uhe(e,t){const n=await lhe(e,t),r=che(e);return(await Promise.all(n.filter(s=>r.has(SB(s.style.fontFamily))).map(s=>{const o=s.parentStyleSheet?s.parentStyleSheet.href:null;return NB(s.cssText,o,t)}))).join(`
`)}async function dhe(e,t){const n=t.fontEmbedCSS!=null?t.fontEmbedCSS:t.skipFonts?null:await uhe(e,t);if(n){const r=document.createElement("style"),a=document.createTextNode(n);r.appendChild(a),e.firstChild?e.insertBefore(r,e.firstChild):e.appendChild(r)}}async function hhe(e,t={}){const{width:n,height:r}=xB(e,t),a=await T1(e,t,!0);return await dhe(a,t),await kB(a,t),she(a,t),await Tde(a,n,r)}async function phe(e,t={}){const{width:n,height:r}=xB(e,t),a=await hhe(e,t),s=await T0(a),o=document.createElement("canvas"),l=o.getContext("2d"),c=t.pixelRatio||_de(),d=t.canvasWidth||n,u=t.canvasHeight||r;return o.width=d*c,o.height=u*c,t.skipAutoScale||jde(o),o.style.width=`${d}`,o.style.height=`${u}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,o.width,o.height)),l.drawImage(s,0,0,o.width,o.height),o}async function gC(e,t={}){return(await phe(e,t)).toDataURL()}function mhe(e){e.CapacitorUtils.Synapse=new Proxy({},{get(t,n){return new Proxy({},{get(r,a){return(s,o,l)=>{const c=e.Capacitor.Plugins[n];if(c===void 0){l(new Error(`Capacitor plugin ${n} not found`));return}if(typeof c[a]!="function"){l(new Error(`Method ${a} not found in Capacitor plugin ${n}`));return}(async()=>{try{const d=await c[a](s);o(d)}catch(d){l(d)}})()}}})}})}function fhe(e){e.CapacitorUtils.Synapse=new Proxy({},{get(t,n){return e.cordova.plugins[n]}})}function ghe(e=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!e?mhe(window):window.cordova!==void 0&&fhe(window))}var Yc;(function(e){e.Documents="DOCUMENTS",e.Data="DATA",e.Library="LIBRARY",e.Cache="CACHE",e.External="EXTERNAL",e.ExternalStorage="EXTERNAL_STORAGE",e.ExternalCache="EXTERNAL_CACHE",e.LibraryNoCloud="LIBRARY_NO_CLOUD",e.Temporary="TEMPORARY"})(Yc||(Yc={}));var xC;(function(e){e.UTF8="utf8",e.ASCII="ascii",e.UTF16="utf16"})(xC||(xC={}));const Rm=kh("Filesystem",{web:()=>bo(()=>import("./web-Dq4vDNC8.js"),__vite__mapDeps([8,1,2,3])).then(e=>new e.FilesystemWeb)});ghe();const xhe=Object.freeze(Object.defineProperty({__proto__:null,get Directory(){return Yc},get Encoding(){return xC},Filesystem:Rm},Symbol.toStringTag,{value:"Module"}));var E1="Switch",[yhe]=dl(E1),[bhe,vhe]=yhe(E1),CB=N.forwardRef((e,t)=>{const{__scopeSwitch:n,name:r,checked:a,defaultChecked:s,required:o,disabled:l,value:c="on",onCheckedChange:d,form:u,...h}=e,[p,m]=N.useState(null),f=gr(t,v=>m(v)),g=N.useRef(!1),x=p?u||!!p.closest("form"):!0,[y,b]=zl({prop:a,defaultProp:s??!1,onChange:d,caller:E1});return i.jsxs(bhe,{scope:n,checked:y,disabled:l,children:[i.jsx(Gn.button,{type:"button",role:"switch","aria-checked":y,"aria-required":o,"data-state":TB(y),"data-disabled":l?"":void 0,disabled:l,value:c,...h,ref:f,onClick:Mn(e.onClick,v=>{b(w=>!w),x&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})}),x&&i.jsx(IB,{control:p,bubbles:!g.current,name:r,value:c,checked:y,required:o,disabled:l,form:u,style:{transform:"translateX(-100%)"}})]})});CB.displayName=E1;var _B="SwitchThumb",jB=N.forwardRef((e,t)=>{const{__scopeSwitch:n,...r}=e,a=vhe(_B,n);return i.jsx(Gn.span,{"data-state":TB(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:t})});jB.displayName=_B;var whe="SwitchBubbleInput",IB=N.forwardRef(({__scopeSwitch:e,control:t,checked:n,bubbles:r=!0,...a},s)=>{const o=N.useRef(null),l=gr(o,s),c=C1(n),d=B_(t);return N.useEffect(()=>{const u=o.current;if(!u)return;const h=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==n&&m){const f=new Event("click",{bubbles:r});m.call(u,n),u.dispatchEvent(f)}},[c,n,r]),i.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:l,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});IB.displayName=whe;function TB(e){return e?"checked":"unchecked"}var EB=CB,Nhe=jB;const E0=N.forwardRef(({className:e,...t},n)=>i.jsx(EB,{className:Ie("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:n,children:i.jsx(Nhe,{className:Ie("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));E0.displayName=EB.displayName;var khe=[" ","Enter","ArrowUp","ArrowDown"],She=[" ","Enter"],Qd="Select",[A1,R1,Che]=aO(Qd),[Pf]=dl(Qd,[Che,x1]),D1=x1(),[_he,ku]=Pf(Qd),[jhe,Ihe]=Pf(Qd),AB=e=>{const{__scopeSelect:t,children:n,open:r,defaultOpen:a,onOpenChange:s,value:o,defaultValue:l,onValueChange:c,dir:d,name:u,autoComplete:h,disabled:p,required:m,form:f}=e,g=D1(t),[x,y]=N.useState(null),[b,v]=N.useState(null),[w,k]=N.useState(!1),C=g1(d),[S,_]=zl({prop:r,defaultProp:a??!1,onChange:s,caller:Qd}),[I,T]=zl({prop:o,defaultProp:l,onChange:c,caller:Qd}),A=N.useRef(null),j=x?f||!!x.closest("form"):!0,[D,F]=N.useState(new Set),B=Array.from(D).map(q=>q.props.value).join(";");return i.jsx(nO,{...g,children:i.jsxs(_he,{required:m,scope:t,trigger:x,onTriggerChange:y,valueNode:b,onValueNodeChange:v,valueNodeHasChildren:w,onValueNodeHasChildrenChange:k,contentId:If(),value:I,onValueChange:T,open:S,onOpenChange:_,dir:C,triggerPointerDownPosRef:A,disabled:p,children:[i.jsx(A1.Provider,{scope:t,children:i.jsx(jhe,{scope:e.__scopeSelect,onNativeOptionAdd:N.useCallback(q=>{F($=>new Set($).add(q))},[]),onNativeOptionRemove:N.useCallback(q=>{F($=>{const L=new Set($);return L.delete(q),L})},[]),children:n})}),j?i.jsxs(t6,{"aria-hidden":!0,required:m,tabIndex:-1,name:u,autoComplete:h,value:I,onChange:q=>T(q.target.value),disabled:p,form:f,children:[I===void 0?i.jsx("option",{value:""}):null,Array.from(D)]},B):null]})})};AB.displayName=Qd;var RB="SelectTrigger",DB=N.forwardRef((e,t)=>{const{__scopeSelect:n,disabled:r=!1,...a}=e,s=D1(n),o=ku(RB,n),l=o.disabled||r,c=gr(t,o.onTriggerChange),d=R1(n),u=N.useRef("touch"),[h,p,m]=r6(g=>{const x=d().filter(v=>!v.disabled),y=x.find(v=>v.value===o.value),b=a6(x,g,y);b!==void 0&&o.onValueChange(b.value)}),f=g=>{l||(o.onOpenChange(!0),m()),g&&(o.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return i.jsx(W_,{asChild:!0,...s,children:i.jsx(Gn.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":n6(o.value)?"":void 0,...a,ref:c,onClick:Mn(a.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&f(g)}),onPointerDown:Mn(a.onPointerDown,g=>{u.current=g.pointerType;const x=g.target;x.hasPointerCapture(g.pointerId)&&x.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(f(g),g.preventDefault())}),onKeyDown:Mn(a.onKeyDown,g=>{const x=h.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&p(g.key),!(x&&g.key===" ")&&khe.includes(g.key)&&(f(),g.preventDefault())})})})});DB.displayName=RB;var MB="SelectValue",$B=N.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,children:s,placeholder:o="",...l}=e,c=ku(MB,n),{onValueNodeHasChildrenChange:d}=c,u=s!==void 0,h=gr(t,c.onValueNodeChange);return nl(()=>{d(u)},[d,u]),i.jsx(Gn.span,{...l,ref:h,style:{pointerEvents:"none"},children:n6(c.value)?i.jsx(i.Fragment,{children:o}):s})});$B.displayName=MB;var The="SelectIcon",FB=N.forwardRef((e,t)=>{const{__scopeSelect:n,children:r,...a}=e;return i.jsx(Gn.span,{"aria-hidden":!0,...a,ref:t,children:r||""})});FB.displayName=The;var Ehe="SelectPortal",PB=e=>i.jsx(YP,{asChild:!0,...e});PB.displayName=Ehe;var Jd="SelectContent",OB=N.forwardRef((e,t)=>{const n=ku(Jd,e.__scopeSelect),[r,a]=N.useState();if(nl(()=>{a(new DocumentFragment)},[]),!n.open){const s=r;return s?wh.createPortal(i.jsx(LB,{scope:e.__scopeSelect,children:i.jsx(A1.Slot,{scope:e.__scopeSelect,children:i.jsx("div",{children:e.children})})}),s):null}return i.jsx(zB,{...e,ref:t})});OB.displayName=Jd;var so=10,[LB,Su]=Pf(Jd),Ahe="SelectContentImpl",Rhe=sb("SelectContent.RemoveScroll"),zB=N.forwardRef((e,t)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:s,onPointerDownOutside:o,side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:h,collisionBoundary:p,collisionPadding:m,sticky:f,hideWhenDetached:g,avoidCollisions:x,...y}=e,b=ku(Jd,n),[v,w]=N.useState(null),[k,C]=N.useState(null),S=gr(t,ne=>w(ne)),[_,I]=N.useState(null),[T,A]=N.useState(null),j=R1(n),[D,F]=N.useState(!1),B=N.useRef(!1);N.useEffect(()=>{if(v)return XP(v)},[v]),QP();const q=N.useCallback(ne=>{const[te,...Te]=j().map(we=>we.ref.current),[Ae]=Te.slice(-1),Se=document.activeElement;for(const we of ne)if(we===Se||(we==null||we.scrollIntoView({block:"nearest"}),we===te&&k&&(k.scrollTop=0),we===Ae&&k&&(k.scrollTop=k.scrollHeight),we==null||we.focus(),document.activeElement!==Se))return},[j,k]),$=N.useCallback(()=>q([_,v]),[q,_,v]);N.useEffect(()=>{D&&$()},[D,$]);const{onOpenChange:L,triggerPointerDownPosRef:M}=b;N.useEffect(()=>{if(v){let ne={x:0,y:0};const te=Ae=>{var Se,we;ne={x:Math.abs(Math.round(Ae.pageX)-(((Se=M.current)==null?void 0:Se.x)??0)),y:Math.abs(Math.round(Ae.pageY)-(((we=M.current)==null?void 0:we.y)??0))}},Te=Ae=>{ne.x<=10&&ne.y<=10?Ae.preventDefault():v.contains(Ae.target)||L(!1),document.removeEventListener("pointermove",te),M.current=null};return M.current!==null&&(document.addEventListener("pointermove",te),document.addEventListener("pointerup",Te,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",te),document.removeEventListener("pointerup",Te,{capture:!0})}}},[v,L,M]),N.useEffect(()=>{const ne=()=>L(!1);return window.addEventListener("blur",ne),window.addEventListener("resize",ne),()=>{window.removeEventListener("blur",ne),window.removeEventListener("resize",ne)}},[L]);const[X,G]=r6(ne=>{const te=j().filter(Se=>!Se.disabled),Te=te.find(Se=>Se.ref.current===document.activeElement),Ae=a6(te,ne,Te);Ae&&setTimeout(()=>Ae.ref.current.focus())}),W=N.useCallback((ne,te,Te)=>{const Ae=!B.current&&!Te;(b.value!==void 0&&b.value===te||Ae)&&(I(ne),Ae&&(B.current=!0))},[b.value]),O=N.useCallback(()=>v==null?void 0:v.focus(),[v]),U=N.useCallback((ne,te,Te)=>{const Ae=!B.current&&!Te;(b.value!==void 0&&b.value===te||Ae)&&A(ne)},[b.value]),K=r==="popper"?yC:BB,ce=K===yC?{side:l,sideOffset:c,align:d,alignOffset:u,arrowPadding:h,collisionBoundary:p,collisionPadding:m,sticky:f,hideWhenDetached:g,avoidCollisions:x}:{};return i.jsx(LB,{scope:n,content:v,viewport:k,onViewportChange:C,itemRefCallback:W,selectedItem:_,onItemLeave:O,itemTextRefCallback:U,focusSelectedItem:$,selectedItemText:T,position:r,isPositioned:D,searchRef:X,children:i.jsx(ZP,{as:Rhe,allowPinchZoom:!0,children:i.jsx(JP,{asChild:!0,trapped:b.open,onMountAutoFocus:ne=>{ne.preventDefault()},onUnmountAutoFocus:Mn(a,ne=>{var te;(te=b.trigger)==null||te.focus({preventScroll:!0}),ne.preventDefault()}),children:i.jsx(eO,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:ne=>ne.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:i.jsx(K,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:ne=>ne.preventDefault(),...y,...ce,onPlaced:()=>F(!0),ref:S,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:Mn(y.onKeyDown,ne=>{const te=ne.ctrlKey||ne.altKey||ne.metaKey;if(ne.key==="Tab"&&ne.preventDefault(),!te&&ne.key.length===1&&G(ne.key),["ArrowUp","ArrowDown","Home","End"].includes(ne.key)){let Ae=j().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);if(["ArrowUp","End"].includes(ne.key)&&(Ae=Ae.slice().reverse()),["ArrowUp","ArrowDown"].includes(ne.key)){const Se=ne.target,we=Ae.indexOf(Se);Ae=Ae.slice(we+1)}setTimeout(()=>q(Ae)),ne.preventDefault()}})})})})})})});zB.displayName=Ahe;var Dhe="SelectItemAlignedPosition",BB=N.forwardRef((e,t)=>{const{__scopeSelect:n,onPlaced:r,...a}=e,s=ku(Jd,n),o=Su(Jd,n),[l,c]=N.useState(null),[d,u]=N.useState(null),h=gr(t,S=>u(S)),p=R1(n),m=N.useRef(!1),f=N.useRef(!0),{viewport:g,selectedItem:x,selectedItemText:y,focusSelectedItem:b}=o,v=N.useCallback(()=>{if(s.trigger&&s.valueNode&&l&&d&&g&&x&&y){const S=s.trigger.getBoundingClientRect(),_=d.getBoundingClientRect(),I=s.valueNode.getBoundingClientRect(),T=y.getBoundingClientRect();if(s.dir!=="rtl"){const Se=T.left-_.left,we=I.left-Se,Fe=S.left-we,Q=S.width+Fe,$e=Math.max(Q,_.width),Le=window.innerWidth-so,Xe=Z2(we,[so,Math.max(so,Le-$e)]);l.style.minWidth=Q+"px",l.style.left=Xe+"px"}else{const Se=_.right-T.right,we=window.innerWidth-I.right-Se,Fe=window.innerWidth-S.right-we,Q=S.width+Fe,$e=Math.max(Q,_.width),Le=window.innerWidth-so,Xe=Z2(we,[so,Math.max(so,Le-$e)]);l.style.minWidth=Q+"px",l.style.right=Xe+"px"}const A=p(),j=window.innerHeight-so*2,D=g.scrollHeight,F=window.getComputedStyle(d),B=parseInt(F.borderTopWidth,10),q=parseInt(F.paddingTop,10),$=parseInt(F.borderBottomWidth,10),L=parseInt(F.paddingBottom,10),M=B+q+D+L+$,X=Math.min(x.offsetHeight*5,M),G=window.getComputedStyle(g),W=parseInt(G.paddingTop,10),O=parseInt(G.paddingBottom,10),U=S.top+S.height/2-so,K=j-U,ce=x.offsetHeight/2,ne=x.offsetTop+ce,te=B+q+ne,Te=M-te;if(te<=U){const Se=A.length>0&&x===A[A.length-1].ref.current;l.style.bottom="0px";const we=d.clientHeight-g.offsetTop-g.offsetHeight,Fe=Math.max(K,ce+(Se?O:0)+we+$),Q=te+Fe;l.style.height=Q+"px"}else{const Se=A.length>0&&x===A[0].ref.current;l.style.top="0px";const Fe=Math.max(U,B+g.offsetTop+(Se?W:0)+ce)+Te;l.style.height=Fe+"px",g.scrollTop=te-U+g.offsetTop}l.style.margin=`${so}px 0`,l.style.minHeight=X+"px",l.style.maxHeight=j+"px",r==null||r(),requestAnimationFrame(()=>m.current=!0)}},[p,s.trigger,s.valueNode,l,d,g,x,y,s.dir,r]);nl(()=>v(),[v]);const[w,k]=N.useState();nl(()=>{d&&k(window.getComputedStyle(d).zIndex)},[d]);const C=N.useCallback(S=>{S&&f.current===!0&&(v(),b==null||b(),f.current=!1)},[v,b]);return i.jsx($he,{scope:n,contentWrapper:l,shouldExpandOnScrollRef:m,onScrollButtonChange:C,children:i.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:w},children:i.jsx(Gn.div,{...a,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});BB.displayName=Dhe;var Mhe="SelectPopperPosition",yC=N.forwardRef((e,t)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=so,...s}=e,o=D1(n);return i.jsx(tO,{...o,...s,ref:t,align:r,collisionPadding:a,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});yC.displayName=Mhe;var[$he,yI]=Pf(Jd,{}),bC="SelectViewport",WB=N.forwardRef((e,t)=>{const{__scopeSelect:n,nonce:r,...a}=e,s=Su(bC,n),o=yI(bC,n),l=gr(t,s.onViewportChange),c=N.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),i.jsx(A1.Slot,{scope:n,children:i.jsx(Gn.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:Mn(a.onScroll,d=>{const u=d.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:p}=o;if(p!=null&&p.current&&h){const m=Math.abs(c.current-u.scrollTop);if(m>0){const f=window.innerHeight-so*2,g=parseFloat(h.style.minHeight),x=parseFloat(h.style.height),y=Math.max(g,x);if(y<f){const b=y+m,v=Math.min(f,b),w=b-v;h.style.height=v+"px",h.style.bottom==="0px"&&(u.scrollTop=w>0?w:0,h.style.justifyContent="flex-end")}}}c.current=u.scrollTop})})})]})});WB.displayName=bC;var UB="SelectGroup",[Fhe,Phe]=Pf(UB),Ohe=N.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=If();return i.jsx(Fhe,{scope:n,id:a,children:i.jsx(Gn.div,{role:"group","aria-labelledby":a,...r,ref:t})})});Ohe.displayName=UB;var VB="SelectLabel",HB=N.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=Phe(VB,n);return i.jsx(Gn.div,{id:a.id,...r,ref:t})});HB.displayName=VB;var A0="SelectItem",[Lhe,GB]=Pf(A0),qB=N.forwardRef((e,t)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:s,...o}=e,l=ku(A0,n),c=Su(A0,n),d=l.value===r,[u,h]=N.useState(s??""),[p,m]=N.useState(!1),f=gr(t,b=>{var v;return(v=c.itemRefCallback)==null?void 0:v.call(c,b,r,a)}),g=If(),x=N.useRef("touch"),y=()=>{a||(l.onValueChange(r),l.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(Lhe,{scope:n,value:r,disabled:a,textId:g,isSelected:d,onItemTextChange:N.useCallback(b=>{h(v=>v||((b==null?void 0:b.textContent)??"").trim())},[]),children:i.jsx(A1.ItemSlot,{scope:n,value:r,disabled:a,textValue:u,children:i.jsx(Gn.div,{role:"option","aria-labelledby":g,"data-highlighted":p?"":void 0,"aria-selected":d&&p,"data-state":d?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...o,ref:f,onFocus:Mn(o.onFocus,()=>m(!0)),onBlur:Mn(o.onBlur,()=>m(!1)),onClick:Mn(o.onClick,()=>{x.current!=="mouse"&&y()}),onPointerUp:Mn(o.onPointerUp,()=>{x.current==="mouse"&&y()}),onPointerDown:Mn(o.onPointerDown,b=>{x.current=b.pointerType}),onPointerMove:Mn(o.onPointerMove,b=>{var v;x.current=b.pointerType,a?(v=c.onItemLeave)==null||v.call(c):x.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Mn(o.onPointerLeave,b=>{var v;b.currentTarget===document.activeElement&&((v=c.onItemLeave)==null||v.call(c))}),onKeyDown:Mn(o.onKeyDown,b=>{var w;((w=c.searchRef)==null?void 0:w.current)!==""&&b.key===" "||(She.includes(b.key)&&y(),b.key===" "&&b.preventDefault())})})})})});qB.displayName=A0;var Ux="SelectItemText",KB=N.forwardRef((e,t)=>{const{__scopeSelect:n,className:r,style:a,...s}=e,o=ku(Ux,n),l=Su(Ux,n),c=GB(Ux,n),d=Ihe(Ux,n),[u,h]=N.useState(null),p=gr(t,y=>h(y),c.onItemTextChange,y=>{var b;return(b=l.itemTextRefCallback)==null?void 0:b.call(l,y,c.value,c.disabled)}),m=u==null?void 0:u.textContent,f=N.useMemo(()=>i.jsx("option",{value:c.value,disabled:c.disabled,children:m},c.value),[c.disabled,c.value,m]),{onNativeOptionAdd:g,onNativeOptionRemove:x}=d;return nl(()=>(g(f),()=>x(f)),[g,x,f]),i.jsxs(i.Fragment,{children:[i.jsx(Gn.span,{id:c.textId,...s,ref:p}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?wh.createPortal(s.children,o.valueNode):null]})});KB.displayName=Ux;var YB="SelectItemIndicator",XB=N.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return GB(YB,n).isSelected?i.jsx(Gn.span,{"aria-hidden":!0,...r,ref:t}):null});XB.displayName=YB;var vC="SelectScrollUpButton",ZB=N.forwardRef((e,t)=>{const n=Su(vC,e.__scopeSelect),r=yI(vC,e.__scopeSelect),[a,s]=N.useState(!1),o=gr(t,r.onScrollButtonChange);return nl(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=c.scrollTop>0;s(d)};const c=n.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),a?i.jsx(JB,{...e,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=n;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});ZB.displayName=vC;var wC="SelectScrollDownButton",QB=N.forwardRef((e,t)=>{const n=Su(wC,e.__scopeSelect),r=yI(wC,e.__scopeSelect),[a,s]=N.useState(!1),o=gr(t,r.onScrollButtonChange);return nl(()=>{if(n.viewport&&n.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,u=Math.ceil(c.scrollTop)<d;s(u)};const c=n.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[n.viewport,n.isPositioned]),a?i.jsx(JB,{...e,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=n;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});QB.displayName=wC;var JB=N.forwardRef((e,t)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=e,s=Su("SelectScrollButton",n),o=N.useRef(null),l=R1(n),c=N.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return N.useEffect(()=>()=>c(),[c]),nl(()=>{var u;const d=l().find(h=>h.ref.current===document.activeElement);(u=d==null?void 0:d.ref.current)==null||u.scrollIntoView({block:"nearest"})},[l]),i.jsx(Gn.div,{"aria-hidden":!0,...a,ref:t,style:{flexShrink:0,...a.style},onPointerDown:Mn(a.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(r,50))}),onPointerMove:Mn(a.onPointerMove,()=>{var d;(d=s.onItemLeave)==null||d.call(s),o.current===null&&(o.current=window.setInterval(r,50))}),onPointerLeave:Mn(a.onPointerLeave,()=>{c()})})}),zhe="SelectSeparator",e6=N.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e;return i.jsx(Gn.div,{"aria-hidden":!0,...r,ref:t})});e6.displayName=zhe;var NC="SelectArrow",Bhe=N.forwardRef((e,t)=>{const{__scopeSelect:n,...r}=e,a=D1(n),s=ku(NC,n),o=Su(NC,n);return s.open&&o.position==="popper"?i.jsx(rO,{...a,...r,ref:t}):null});Bhe.displayName=NC;var Whe="SelectBubbleInput",t6=N.forwardRef(({__scopeSelect:e,value:t,...n},r)=>{const a=N.useRef(null),s=gr(r,a),o=C1(t);return N.useEffect(()=>{const l=a.current;if(!l)return;const c=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==t&&u){const h=new Event("change",{bubbles:!0});u.call(l,t),l.dispatchEvent(h)}},[o,t]),i.jsx(Gn.select,{...n,style:{...tX,...n.style},ref:s,defaultValue:t})});t6.displayName=Whe;function n6(e){return e===""||e===void 0}function r6(e){const t=Sc(e),n=N.useRef(""),r=N.useRef(0),a=N.useCallback(o=>{const l=n.current+o;t(l),function c(d){n.current=d,window.clearTimeout(r.current),d!==""&&(r.current=window.setTimeout(()=>c(""),1e3))}(l)},[t]),s=N.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return N.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,s]}function a6(e,t,n){const a=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let o=Uhe(e,Math.max(s,0));a.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.textValue.toLowerCase().startsWith(a.toLowerCase()));return c!==n?c:void 0}function Uhe(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var Vhe=AB,s6=DB,Hhe=$B,Ghe=FB,qhe=PB,i6=OB,Khe=WB,o6=HB,l6=qB,Yhe=KB,Xhe=XB,c6=ZB,u6=QB,d6=e6;const $i=Vhe,Fi=Hhe,ai=N.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(s6,{ref:r,className:Ie("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...n,children:[t,i.jsx(Ghe,{asChild:!0,children:i.jsx(vy,{className:"h-4 w-4 opacity-50"})})]}));ai.displayName=s6.displayName;const h6=N.forwardRef(({className:e,...t},n)=>i.jsx(c6,{ref:n,className:Ie("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(bX,{className:"h-4 w-4"})}));h6.displayName=c6.displayName;const p6=N.forwardRef(({className:e,...t},n)=>i.jsx(u6,{ref:n,className:Ie("flex cursor-default items-center justify-center py-1",e),...t,children:i.jsx(vy,{className:"h-4 w-4"})}));p6.displayName=u6.displayName;const si=N.forwardRef(({className:e,children:t,position:n="popper",...r},a)=>i.jsx(qhe,{children:i.jsxs(i6,{ref:a,className:Ie("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:n,...r,children:[i.jsx(h6,{}),i.jsx(Khe,{className:Ie("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),i.jsx(p6,{})]})}));si.displayName=i6.displayName;const Zhe=N.forwardRef(({className:e,...t},n)=>i.jsx(o6,{ref:n,className:Ie("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));Zhe.displayName=o6.displayName;const Ut=N.forwardRef(({className:e,children:t,...n},r)=>i.jsxs(l6,{ref:r,className:Ie("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Xhe,{children:i.jsx(dn,{className:"h-4 w-4"})})}),i.jsx(Yhe,{children:t})]}));Ut.displayName=l6.displayName;const Qhe=N.forwardRef(({className:e,...t},n)=>i.jsx(d6,{ref:n,className:Ie("-mx-1 my-1 h-px bg-muted",e),...t}));Qhe.displayName=d6.displayName;const Jhe="https://synka.in",Ni=(e,t,n,r,a)=>{const o={compact:"8px",normal:"12px",relaxed:"16px"}[t.spacing],l=t.alignment,c=r&&e.photo_url?`<td style="padding-right: 15px; vertical-align: top;">
        <img src="${e.photo_url}" alt="${e.name}" width="80" height="80" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; display: block;" />
       </td>`:"",d=a&&e.logo_url?`<img src="${e.logo_url}" alt="${e.company}" height="28" style="height: 28px; max-width: 120px; margin-top: ${o}; display: block;${l==="center"?" margin-left: auto; margin-right: auto;":""}" />`:"",u=e.website?`<tr><td style="padding-top: 4px; text-align: ${l};"><a href="${e.website.startsWith("http")?e.website:"https://"+e.website}" style="color: #4F46E5; text-decoration: none; font-size: 12px;">${e.website.replace(/^https?:\/\//,"")}</a></td></tr>`:"",h=e.linkedin?`<tr><td style="padding-top: 4px; text-align: ${l};"><a href="${e.linkedin.startsWith("http")?e.linkedin:"https://linkedin.com/in/"+e.linkedin}" style="color: #0077B5; text-decoration: none; font-size: 12px;">LinkedIn</a></td></tr>`:"";switch(n){case"executive":return{name:r&&a?"Executive Pro":r?"Executive":a?"Executive Brand":"Executive Minimal",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 14px; color: #333333;">
  <tr>
    ${c}
    <td style="border-left: 3px solid #4F46E5; padding-left: 15px; vertical-align: top;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 18px; font-weight: bold; color: #1a1a1a; padding-bottom: 4px; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 13px; color: #666666; padding-bottom: ${o}; text-align: ${l};">${e.designation}${e.company?` | ${e.company}`:""}</td></tr>
        <tr><td style="font-size: 12px; color: #333333; text-align: ${l};">${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}</td></tr>
        <tr><td style="font-size: 12px; color: #333333; padding-top: 2px; text-align: ${l};">${e.phone||""}</td></tr>
        ${u}
        ${h}
        ${d?`<tr><td style="padding-top: ${o};">${d}</td></tr>`:""}
      </table>
    </td>
  </tr>
</table>`};case"modern":return{name:r&&a?"Modern Complete":r?"Modern":a?"Modern Brand":"Modern Clean",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif;">
  <tr>
    <td style="padding: ${o}; background-color: #f8f9fa; border-radius: 8px;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          ${r&&e.photo_url?`<td style="vertical-align: top; padding-right: 15px;">
            <img src="${e.photo_url}" alt="${e.name}" width="70" height="70" style="width: 70px; height: 70px; border-radius: 12px; object-fit: cover; display: block;" />
          </td>`:""}
          <td style="vertical-align: top;">
            <table cellpadding="0" cellspacing="0" border="0">
              <tr><td style="font-size: 16px; font-weight: bold; color: #1a1a1a;">${e.name}</td></tr>
              <tr><td style="font-size: 12px; color: #6366F1; text-transform: uppercase; letter-spacing: 0.5px; padding-top: 2px;">${e.designation}</td></tr>
              <tr><td style="font-size: 12px; color: #666666; padding-top: 2px;">${e.company}</td></tr>
              <tr><td style="padding-top: ${o}; font-size: 12px;">
                ${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
                ${e.phone?`<span style="color: #999;"> | </span><span style="color: #333;">${e.phone}</span>`:""}
              </td></tr>
              ${a&&e.logo_url?`<tr><td style="padding-top: ${o};">${d}</td></tr>`:""}
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>`};case"minimal":return{name:"Minimal",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; color: #333333; border-top: 2px solid #4F46E5; padding-top: ${o};">
  <tr>
    <td style="padding-top: 10px;">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 15px; font-weight: 600; color: #1a1a1a; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.designation}${e.company?` &middot; ${e.company}`:""}</td></tr>
        <tr><td style="padding-top: ${o}; font-size: 12px; text-align: ${l};">
          ${e.email?`<a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
          ${e.phone?` &middot; ${e.phone}`:""}
        </td></tr>
        ${e.website?`<tr><td style="font-size: 12px; padding-top: 2px; text-align: ${l};"><a href="${e.website.startsWith("http")?e.website:"https://"+e.website}" style="color: #4F46E5; text-decoration: none;">${e.website.replace(/^https?:\/\//,"")}</a></td></tr>`:""}
      </table>
    </td>
  </tr>
</table>`};case"corporate":return{name:a?"Corporate":"Professional",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Arial, Helvetica, sans-serif; font-size: 13px; color: #333333;">
  <tr>
    <td style="vertical-align: top;">
      ${a&&e.logo_url?`<img src="${e.logo_url}" alt="${e.company}" height="40" style="height: 40px; max-width: 150px; display: block; margin-bottom: ${o};" />`:""}
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 14px; font-weight: bold; color: #1a1a1a; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #4F46E5; padding-top: 2px; text-align: ${l};">${e.designation}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.company}</td></tr>
        <tr><td style="border-top: 1px solid #e5e7eb; margin-top: 10px; padding-top: ${o}; font-size: 12px; text-align: ${l};">
          ${e.email?`<span style="color: #333;">E: </span><a href="mailto:${e.email}" style="color: #4F46E5; text-decoration: none;">${e.email}</a>`:""}
          ${e.phone?`<br/><span style="color: #333;">P: </span>${e.phone}`:""}
        </td></tr>
      </table>
    </td>
  </tr>
</table>`};case"classic":default:return{name:"Classic",html:`<table cellpadding="0" cellspacing="0" border="0" style="font-family: Georgia, serif; font-size: 13px; color: #333333;">
  <tr>
    <td>
      <table cellpadding="0" cellspacing="0" border="0">
        <tr><td style="font-size: 16px; font-weight: 400; color: #1a1a1a; letter-spacing: 0.5px; text-align: ${l};">${e.name}</td></tr>
        <tr><td style="font-size: 12px; color: #888888; font-style: italic; padding-top: 4px; text-align: ${l};">${e.designation}</td></tr>
        <tr><td style="font-size: 12px; color: #666666; padding-top: 2px; text-align: ${l};">${e.company}</td></tr>
        <tr><td style="padding-top: ${o}; border-top: 1px solid #e5e7eb; margin-top: ${o};">
          <table cellpadding="0" cellspacing="0" border="0" style="margin-top: ${o};">
            <tr><td style="font-size: 12px; text-align: ${l};">${e.email?`<a href="mailto:${e.email}" style="color: #666666; text-decoration: none;">${e.email}</a>`:""}</td></tr>
            <tr><td style="font-size: 12px; text-align: ${l};">${e.phone||""}</td></tr>
          </table>
        </td></tr>
      </table>
    </td>
  </tr>
</table>`}}},epe=e=>{const t=!!e.photo_url,n=!!e.logo_url,r={spacing:"normal",alignment:"left"},a=[];return t&&n?(a.push(Ni(e,r,"minimal",!1,!1)),a.push(Ni(e,r,"corporate",!1,!0)),a.push(Ni(e,r,"executive",!0,!0))):t?(a.push(Ni(e,r,"minimal",!1,!1)),a.push(Ni(e,r,"executive",!0,!1)),a.push(Ni(e,r,"modern",!0,!1))):n?(a.push(Ni(e,r,"minimal",!1,!1)),a.push(Ni(e,r,"corporate",!1,!0)),a.push(Ni(e,r,"modern",!1,!0))):(a.push(Ni(e,r,"minimal",!1,!1)),a.push(Ni(e,r,"corporate",!1,!1)),a.push(Ni(e,r,"classic",!1,!1))),a},tpe=e=>{const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""};function npe({activeCard:e}){var Te,Ae;const{user:t}=or(),{profile:n}=hl(),[r,a]=N.useState(null),[s,o]=N.useState(""),[l,c]=N.useState(!1),[d,u]=N.useState([]),[h,p]=N.useState(null),[m,f]=N.useState(null),[g,x]=N.useState(!1),[y,b]=N.useState(!1),[v,w]=N.useState(!1),[k,C]=N.useState(null),S=N.useRef(null),[_,I]=N.useState(!1),[T,A]=N.useState(0),[j,D]=N.useState(0),[F,B]=N.useState({showPhoto:!0,showLogo:!0,spacing:"normal",alignment:"left"}),q=N.useMemo(()=>({name:(e==null?void 0:e.full_name)||"Your Name",designation:(e==null?void 0:e.designation)||"",company:(e==null?void 0:e.company)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||"",website:(e==null?void 0:e.website)||"",linkedin:(e==null?void 0:e.linkedin)||"",photo_url:(e==null?void 0:e.photo_url)||"",logo_url:(e==null?void 0:e.logo_url)||""}),[e]),$=N.useMemo(()=>epe(q),[q]);N.useEffect(()=>{(async()=>{if(!t||_)return;const{data:we,error:Fe}=await ue.from("email_signatures").select("*").eq("user_id",t.id).eq("is_selected",!0).maybeSingle();!Fe&&we?p({name:we.name,html:we.html}):$.length>0&&p($[0]),I(!0)})()},[t,$,_]),N.useEffect(()=>{_&&!h&&$.length>0&&p($[0])},[_,h,$]);const L=(Se,we,Fe)=>{let Q=Se;if(!Fe.showPhoto&&we.photo_url){const Xe=we.photo_url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");Q=Q.replace(new RegExp(`<img[^>]*src=["']${Xe}["'][^>]*>`,"gi"),""),Q=Q.replace(/<img[^>]*border-radius[^>]*50%[^>]*>/gi,""),Q=Q.replace(/<td[^>]*>\s*<\/td>/gi,"")}if(!Fe.showLogo&&we.logo_url){const Xe=we.logo_url.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");Q=Q.replace(new RegExp(`<img[^>]*src=["']${Xe}["'][^>]*>`,"gi"),""),Q=Q.replace(/<img[^>]*alt=["'][^"']*logo[^"']*["'][^>]*>/gi,""),Q=Q.replace(/<tr>\s*<td[^>]*>\s*<\/td>\s*<\/tr>/gi,"")}const Le={compact:"8px",normal:"12px",relaxed:"16px"}[Fe.spacing];return Q=Q.replace(/padding(-top|-bottom)?:\s*\d+px/gi,(Xe,Ye)=>`padding${Ye||""}: ${Le}`),Q=Q.replace(/text-align:\s*(left|center|right)/gi,`text-align: ${Fe.alignment}`),Q},M=N.useMemo(()=>{if(!h)return null;const Se=L(h.html,q,F);return{name:h.name,html:Se}},[h,q,F]),X=Se=>{r===Se?a(null):(a(Se),Se==="ai"&&A(0),Se==="select"&&D(0))},G=async()=>{if(!s.trim()){ie({title:"Please describe your signature style",variant:"destructive"});return}c(!0);try{const{data:Se,error:we}=await ue.functions.invoke("generate-signatures",{body:{name:q.name,company:q.company,designation:q.designation,email:q.email,phone:q.phone,website:q.website,linkedin:q.linkedin,photo_url:q.photo_url,logo_url:q.logo_url,prompt:s}});if(we)throw we;if(Se!=null&&Se.signatures&&Array.isArray(Se.signatures))u(Se.signatures.slice(0,3)),A(0),ie({title:"Signatures generated!",description:"Select your preferred style."});else throw new Error("No signatures returned")}catch(Se){console.error("Error generating signatures:",Se),ie({title:"AI generation unavailable",description:"Try the Select tab for premium templates.",variant:"destructive"})}finally{c(!1)}},W=async Se=>{p(Se),a(null),u([]),o(""),t&&t&&await ue.from("email_signatures").upsert({user_id:t.id,name:Se.name,html:Se.html,is_selected:!0,updated_at:new Date().toISOString()},{onConflict:"user_id"}),ie({title:`"${Se.name}" selected`})},O=async()=>{if(h){try{const Se=h.html,we=new Blob([Se],{type:"text/html"}),Fe=new Blob([tpe(Se)],{type:"text/plain"});await navigator.clipboard.write([new ClipboardItem({"text/html":we,"text/plain":Fe})]),f("signature"),b(!0),ie({title:"Signature copied!",description:"Paste into Gmail or Outlook.",duration:3e3})}catch(Se){console.error("Clipboard API failed, trying fallback:",Se);try{const we=window.getSelection(),Fe=document.createRange();S.current&&(Fe.selectNodeContents(S.current),we==null||we.removeAllRanges(),we==null||we.addRange(Fe),document.execCommand("copy"),we==null||we.removeAllRanges()),f("signature"),b(!0),ie({title:"Signature copied!",description:"Paste into Gmail or Outlook.",duration:3e3})}catch(we){console.error("Failed to copy signature:",we),ie({title:"Copy failed",description:"Please try again.",variant:"destructive"})}}setTimeout(()=>f(null),2500)}},U=async()=>{if(S.current){x(!0);try{const Se=await gC(S.current,{pixelRatio:2,backgroundColor:"#ffffff",style:{maxWidth:"600px"}});if(C(Se),/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1||Xt.isNativePlatform()){if(Xt.isNativePlatform()){const $e=Se.split(",")[1],Le=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Xe=await Rm.writeFile({path:Le,data:$e,directory:Yc.Cache});await qc.share({title:"Email Signature",text:"My Synka email signature",files:[Xe.uri],dialogTitle:"Save or share signature"}),ie({title:"Signature ready to share!"})}else{const $e=document.createElement("a");$e.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,$e.href=Se,$e.click(),ie({title:"Image downloaded!",description:"Check your Downloads folder.",duration:3e3})}f("image"),w(!0);return}const Q=await(await fetch(Se)).blob();await navigator.clipboard.write([new ClipboardItem({"image/png":Q})]),f("image"),w(!0),ie({title:"Image copied to clipboard!",description:"Paste anywhere to use your signature as an image.",duration:3e3})}catch(Se){if(console.error("Failed to copy image:",Se),k){const we=document.createElement("a");we.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,we.href=k,we.click(),ie({title:"Image downloaded!",description:"Clipboard not supported, image was downloaded instead.",duration:3e3}),f("image"),w(!0)}else ie({title:"Image copy failed",description:"Your browser may not support image clipboard.",variant:"destructive"})}finally{x(!1),setTimeout(()=>f(null),2500)}}},K=async()=>{if(!k)return;if(Xt.isNativePlatform()){try{const we=k.split(",")[1],Fe=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Q=await Rm.writeFile({path:Fe,data:we,directory:Yc.Cache});await qc.share({title:"Email Signature",text:"My Synka email signature",files:[Q.uri],dialogTitle:"Save or share signature"}),ie({title:"Signature ready to share!"})}catch(we){console.error("Share error:",we),ie({title:"Could not share signature",variant:"destructive"})}return}const Se=document.createElement("a");Se.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,Se.href=k,Se.click(),ie({title:"Image downloaded!"})},ce=(n==null?void 0:n.slug)||(t==null?void 0:t.id)||"user",ne=`${Jhe}/u/${ce}`,te=r===null;return i.jsxs("div",{className:"space-y-4 relative overflow-visible",children:[i.jsxs("div",{className:"grid w-full grid-cols-3 gap-1 p-1 rounded-lg bg-muted",children:[i.jsxs("button",{onClick:()=>X("ai"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="ai"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[i.jsx(Ls,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"AI"]}),i.jsxs("button",{onClick:()=>X("select"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="select"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[i.jsx(RX,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Select"]}),i.jsxs("button",{onClick:()=>X("edit"),className:Ie("flex items-center justify-center gap-2 text-xs sm:text-sm py-2 px-3 rounded-md transition-all",r==="edit"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[i.jsx(ib,{className:"h-3 w-3 sm:h-4 sm:w-4"}),"Edit"]})]}),r==="ai"&&i.jsxs("div",{className:"space-y-4 mt-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:i.jsx(Ed,{className:"h-4 w-4"})}),i.jsx("span",{className:"text-sm font-medium",children:"AI Signature Generator"})]}),d.length===0?i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{className:"text-sm",children:"Describe how you want your email signature to look..."}),i.jsx(ka,{value:s,onChange:Se=>o(Se.target.value),placeholder:"e.g., minimal, bold & premium, with photo, startup style, formal corporate...",rows:2,className:"resize-none text-sm"})]}),i.jsx(de,{onClick:G,className:"w-full",size:"sm",disabled:l||!s.trim(),children:l?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Generate 3 Signatures"]})})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex gap-1 p-1 rounded-md bg-muted/50",children:d.map((Se,we)=>i.jsx("button",{onClick:()=>A(we),className:Ie("flex-1 px-3 py-1.5 text-xs font-medium rounded transition-all",T===we?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:Se.name},we))}),i.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:i.jsx("div",{dangerouslySetInnerHTML:{__html:xd.sanitize(((Te=d[T])==null?void 0:Te.html)||"")}})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{onClick:()=>W(d[T]),className:"flex-1",size:"sm",children:"Select This Signature"}),i.jsx(de,{onClick:()=>{u([]),o("")},variant:"outline",size:"sm",children:"Regenerate"})]})]})]}),r==="select"&&i.jsxs("div",{className:"space-y-4 mt-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:i.jsx(Ed,{className:"h-4 w-4"})}),i.jsx("span",{className:"text-sm font-medium",children:"Select Template"})]}),i.jsx("div",{className:"flex gap-1 p-1 rounded-md bg-muted/50",children:$.map((Se,we)=>i.jsx("button",{onClick:()=>D(we),className:Ie("flex-1 px-3 py-1.5 text-xs font-medium rounded transition-all",j===we?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:Se.name},we))}),i.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:i.jsx("div",{dangerouslySetInnerHTML:{__html:xd.sanitize(((Ae=$[j])==null?void 0:Ae.html)||"")}})}),i.jsx(de,{onClick:()=>W($[j]),className:"w-full",size:"sm",children:"Select This Signature"})]}),r==="edit"&&i.jsxs("div",{className:"space-y-4 mt-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>a(null),className:"p-1.5 rounded-md hover:bg-muted transition-colors",title:"Back",children:i.jsx(Ed,{className:"h-4 w-4"})}),i.jsx("span",{className:"text-sm font-medium",children:"Edit Settings"})]}),i.jsxs("div",{className:"space-y-4 p-3 rounded-lg border border-border bg-muted/30",children:[q.photo_url&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{className:"text-sm",children:"Show Photo"}),i.jsx(E0,{checked:F.showPhoto,onCheckedChange:Se=>B(we=>({...we,showPhoto:Se}))})]}),q.logo_url&&i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{className:"text-sm",children:"Show Logo"}),i.jsx(E0,{checked:F.showLogo,onCheckedChange:Se=>B(we=>({...we,showLogo:Se}))})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{className:"text-sm",children:"Spacing"}),i.jsxs($i,{value:F.spacing,onValueChange:Se=>B(we=>({...we,spacing:Se})),children:[i.jsx(ai,{className:"w-28 h-8 text-xs",children:i.jsx(Fi,{})}),i.jsxs(si,{className:"z-[200]",children:[i.jsx(Ut,{value:"compact",children:"Compact"}),i.jsx(Ut,{value:"normal",children:"Normal"}),i.jsx(Ut,{value:"relaxed",children:"Relaxed"})]})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{className:"text-sm",children:"Alignment"}),i.jsxs($i,{value:F.alignment,onValueChange:Se=>B(we=>({...we,alignment:Se})),children:[i.jsx(ai,{className:"w-28 h-8 text-xs",children:i.jsx(Fi,{})}),i.jsxs(si,{className:"z-[200]",children:[i.jsx(Ut,{value:"left",children:"Left"}),i.jsx(Ut,{value:"center",children:"Center"}),i.jsx(Ut,{value:"right",children:"Right"})]})]})]})]}),M&&i.jsx("div",{className:"p-4 rounded-lg border border-border bg-white overflow-auto",children:i.jsx("div",{dangerouslySetInnerHTML:{__html:xd.sanitize(M.html)}})}),i.jsxs(de,{onClick:()=>{M&&W(M)},className:"w-full",size:"sm",disabled:!M,children:[i.jsx(Uw,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]}),te&&h&&i.jsxs("div",{className:"space-y-3 pt-3 border-t border-border",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:["Selected: ",h.name]})}),i.jsx("div",{className:"rounded-lg border border-border bg-white overflow-auto",children:i.jsx("div",{ref:S,className:"p-4",style:{padding:"14px 18px"},dangerouslySetInnerHTML:{__html:xd.sanitize(h.html)}})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{onClick:O,className:"flex-1",size:"sm",variant:m==="signature"?"secondary":"default",children:m==="signature"?i.jsxs(i.Fragment,{children:[i.jsx(dn,{className:"h-4 w-4 mr-2"}),"Copied!"]}):i.jsxs(i.Fragment,{children:[i.jsx(o2,{className:"h-4 w-4 mr-2"}),"Copy"]})}),i.jsx(de,{onClick:U,className:"flex-1",size:"sm",variant:m==="image"?"secondary":"outline",disabled:g,children:g?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"..."]}):m==="image"?i.jsxs(i.Fragment,{children:[i.jsx(dn,{className:"h-4 w-4 mr-2"}),"Copied!"]}):i.jsxs(i.Fragment,{children:[i.jsx(AX,{className:"h-4 w-4 mr-2"}),"Image"]})}),i.jsxs(de,{onClick:async()=>{if(S.current){x(!0);try{const Se=await gC(S.current,{pixelRatio:2,backgroundColor:"#ffffff",style:{maxWidth:"600px"}});if(Xt.isNativePlatform()){const we=Se.split(",")[1],Fe=`signature-${(n==null?void 0:n.slug)||"email"}-${Date.now()}.png`,Q=await Rm.writeFile({path:Fe,data:we,directory:Yc.Cache});await qc.share({title:"Email Signature",text:"My Synka email signature",files:[Q.uri],dialogTitle:"Save or share signature"}),ie({title:"Signature ready to share!"})}else{const we=document.createElement("a");we.download=`signature-${(n==null?void 0:n.slug)||"email"}.png`,we.href=Se,we.click(),ie({title:"Image downloaded!"})}}catch(Se){console.error("Failed to generate/download image:",Se),ie({title:"Download failed",variant:"destructive"})}finally{x(!1)}}},className:"flex-1",size:"sm",variant:"outline",disabled:g,children:[i.jsx(Od,{className:"h-4 w-4 mr-2"}),"Save"]})]})]}),i.jsx(vn,{open:y,onOpenChange:b,children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{className:"text-xl font-semibold",children:"Make this signature yours"})}),i.jsx("div",{className:"space-y-4 py-2",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"1"}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Open email settings on desktop ",i.jsx("span",{className:"text-xs",children:"(HTML signatures do not work on mobile apps)"})]})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"2"}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Gmail:"})," Settings > See all settings > Signature"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Apple Mail:"})," Settings > Signatures"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Outlook:"})," Settings > Mail > Signatures"]})]})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"3"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the copied signature"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"4"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Apply and save - you are Synka ready with signatures!"})]})]})}),i.jsx(de,{onClick:()=>b(!1),className:"w-full",children:"Got it!"})]})}),i.jsx(vn,{open:v,onOpenChange:w,children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{className:"text-xl font-semibold",children:"Use this image as your email signature"})}),i.jsxs("div",{className:"space-y-4 py-2",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"1"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Open email signature settings in your email client"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Paste the image into the signature area"})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-medium",children:"3"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Works where HTML is not supported"})]})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Image links to: ",i.jsx("a",{href:ne,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:ne})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(de,{onClick:K,variant:"outline",className:"flex-1",children:[i.jsx(Od,{className:"h-4 w-4 mr-2"}),"Download Image"]}),i.jsx(de,{onClick:()=>w(!1),className:"flex-1",children:"Got it!"})]})]})})]})}function x3(e,t=80,n=50){t/=100,n/=100;const r=u=>(u+e/30)%12,a=t*Math.min(n,1-n),s=u=>n-a*Math.max(-1,Math.min(r(u)-3,Math.min(9-r(u),1))),o=Math.round(255*s(0)),l=Math.round(255*s(8)),c=Math.round(255*s(4)),d=u=>u.toString(16).padStart(2,"0");return`#${d(o)}${d(l)}${d(c)}`.toUpperCase()}function y3(e){if(!e)return null;const t=c=>String(c).padStart(2,"0"),n=e.getFullYear(),r=t(e.getMonth()+1),a=t(e.getDate()),s=t(e.getHours()),o=t(e.getMinutes()),l=t(e.getSeconds());return`${n}-${r}-${a}T${s}:${o}:${l}+05:30`}function b3(e){const t=e.replace("#","");if(t.length!==6)return 0;const n=parseInt(t.substring(0,2),16)/255,r=parseInt(t.substring(2,4),16)/255,a=parseInt(t.substring(4,6),16)/255,s=Math.max(n,r,a),o=Math.min(n,r,a);let l=0;if(s!==o){const c=s-o;switch(s){case n:l=(r-a)/c+(r<a?6:0);break;case r:l=(a-n)/c+2;break;case a:l=(n-r)/c+4;break}l=Math.round(l*60)}return Math.round(l||0)}const rpe=["All","7 days","15 days","30 days","Custom"];function ape(){var Ao,os,bl,vl;const{profile:e}=hl(),{user:t}=or(),{cards:n,activeCard:r}=Df(),{tags:a,createTag:s,deleteTag:o}=uB(),{events:l,addEvent:c,deleteEvent:d}=fI(),{addTemplate:u,updateTemplate:h,deleteTemplate:p,getEmailTemplates:m,getWhatsappTemplates:f}=pB(),{addSignature:g,getSelectedSignature:x}=fB(),{analytics:y,loading:b,refetch:v}=xoe(),w=((Ao=e==null?void 0:e.plan)==null?void 0:Ao.toLowerCase())==="orange",k=()=>{ie({title:"Orange Feature",description:"Upgrade to Orange & unlock this premium feature",action:i.jsx(de,{variant:"outline",size:"sm",onClick:()=>window.location.href="/settings/upgrade",className:"border-orange-500 text-orange-600 hover:bg-orange-50",children:"Upgrade"})})},[C,S]=N.useState("All"),[_,I]=N.useState({from:void 0,to:void 0}),[T,A]=N.useState(!1),[j,D]=N.useState(!1),[F,B]=N.useState([]),[q,$]=N.useState(0),[L,M]=N.useState(0),[X,G]=N.useState(!1),W=()=>{let re,Be;return C==="7 days"?(re=qo(Am(new Date,7)),Be=Hv(new Date)):C==="15 days"?(re=qo(Am(new Date,15)),Be=Hv(new Date)):C==="30 days"?(re=qo(Am(new Date,30)),Be=Hv(new Date)):C.startsWith("Custom:")&&_.from&&_.to&&(re=qo(_.from),Be=Hv(_.to)),{startDate:re,endDate:Be}},O=async()=>{G(!0);try{const{startDate:re,endDate:Be}=W(),jn=y3(re),Kn=y3(Be),{data:J,error:je}=await ue.rpc("get_attended_events_list",{p_user_id:(t==null?void 0:t.id)||null,p_start_date:jn,p_end_date:Kn});if(je){console.error("RPC get_attended_events error",je),ie({title:"Failed to fetch attended events",variant:"destructive"}),B([]),$(0),M(0);return}const Wt=(Array.isArray(J)?J:[]).map(et=>({id:String(et.id),title:et.title||et.name||`Event ${et.id}`,views:Number(et.unique_views??0),start_time:et.start_time||null,end_time:et.end_time||null})).filter(et=>Number(et.views)>0),Jt=Wt.reduce((et,bt)=>et+(bt.views||0),0);B(Wt),$(Wt.length),M(Jt)}catch(re){console.error("updateEventMetrics error",re),ie({title:"Failed to update event metrics",variant:"destructive"}),B([]),$(0),M(0)}finally{G(!1)}};N.useEffect(()=>{const{startDate:re,endDate:Be}=W();v(re,Be),O()},[C,_,v]);const U=async()=>{D(!0),G(!0),await O(),G(!1)},[K,ce]=N.useState(null),[ne,te]=N.useState({name:"",subject:"",body:""}),[Te,Ae]=N.useState(null),[Se,we]=N.useState(!1),[Fe,Q]=N.useState(!1),[$e,Le]=N.useState(""),[Xe,Ye]=N.useState(!1),[Je,le]=N.useState(!1),[V,ee]=N.useState({name:"",title:"",company:"",email:"",phone:""}),[ve,ke]=N.useState(!1),[Ce,be]=N.useState(!1),[Ee,Ue]=N.useState(!1),[Qe,_t]=N.useState(""),[$t,Ve]=N.useState([]),[tt,yt]=N.useState(0),[ut,qt]=N.useState(!1),[an,lt]=N.useState(!1),[wt,Nt]=N.useState(""),Kt=async()=>{wt.trim()&&(await s(wt.trim()),Nt(""))},[jt,Zt]=N.useState([{id:"expo",name:"Expo",color:void 0},{id:"tradefare",name:"Tradefare",color:void 0}]),[An,it]=N.useState(""),[ge,De]=N.useState([]),[Ke,ze]=N.useState([]),[Bt,Qt]=N.useState(!1),[rt,gt]=N.useState(null),[en,br]=N.useState(200),[vr,js]=N.useState(!1),[Mr,La]=N.useState(null),[qn,fa]=N.useState(0),[xr,Ki]=N.useState(!1),[is,yi]=N.useState(null),[ft,pe]=N.useState({open:!1,title:"",description:"",onConfirm:()=>{}}),[Pe,dt]=N.useState({title:"",start_time:"",end_time:"",description:""}),[On,cr]=N.useState(!1),[Wn,wr]=N.useState(null),za=N.useRef(null),Is=N.useRef(null);N.useEffect(()=>De(a||[]),[a]),N.useEffect(()=>ze(l||[]),[l]);const _n=re=>{re==="Custom"?A(!0):(S(re),I({from:void 0,to:void 0}))},fn=()=>{_.from&&_.to&&(S(`Custom: ${Ht(_.from,"dd MMM")}  ${Ht(_.to,"dd MMM")}`),A(!1))},Ts=re=>{Zt(Be=>Be.filter(jn=>jn.id!==re&&jn.name!==re))},bi=re=>{gt(re);const Be=(re==null?void 0:re.color)||(re==null?void 0:re.colorHex)||(re==null?void 0:re.color_hex)||void 0,jn=Be?b3(Be):200;br(jn),Qt(!0)},tm=async re=>{if(br(re),!rt)return;const Be=x3(re,80,50),jn=Ke.find(Kn=>String(Kn.id)===String(rt.id));jn?(ze(Kn=>Kn.map(J=>J.id===jn.id?{...J,color:Be}:J)),gt(Kn=>Kn&&{...Kn,color:Be})):(Zt(Kn=>Kn.map(J=>J.id===rt.id?{...J,color:Be}:J)),gt(Kn=>Kn&&{...Kn,color:Be}))},Uu=async()=>{if(!rt)return;const re=Ke.find(Be=>String(Be.id)===String(rt.id));re?pe({open:!0,title:`Delete ${re.title}`,description:"This action cannot be undone.",onConfirm:async()=>{await d(re.id),Qt(!1),gt(null),pe(Be=>({...Be,open:!1})),ie({title:"Event deleted"})}}):(Ts(rt.id),Qt(!1),gt(null),ie({title:"Event removed"}))},Yi=re=>{La(re);const Be=re!=null&&re.color?b3(re.color):200;fa(Be),js(!0)},oc=async()=>{if(!Mr)return;const re=Mr.id;pe({open:!0,title:`Delete ${Mr.name}`,description:"This action cannot be undone.",onConfirm:async()=>{await o(re),js(!1),La(null),pe(Be=>({...Be,open:!1})),ie({title:"Tag deleted"})}})},Vu=re=>{yi(re),Ki(!0)},Hu=async()=>{if(!is)return;const re=is.id;pe({open:!0,title:`Delete ${is.title}`,description:"This action cannot be undone.",onConfirm:async()=>{await d(re),Ki(!1),yi(null),pe(Be=>({...Be,open:!1})),ie({title:"Event deleted"})}})};function Qs(re){if(!re)return null;const Be=re.length===16?`${re}:00`:re,jn=-new Date().getTimezoneOffset(),Kn=jn>=0?"+":"-",J=Math.abs(jn),je=String(Math.floor(J/60)).padStart(2,"0"),Ge=String(J%60).padStart(2,"0");return`${Be}${Kn}${je}:${Ge}`}const Gu=async()=>{if(!Pe.title){ie({title:"Please provide event name",variant:"destructive"});return}try{let re=null,Be=null;if(Pe.start_time&&Pe.end_time)re=Qs(Pe.start_time),Be=Qs(Pe.end_time);else if(Pe.start_time&&!Pe.end_time){re=Qs(Pe.start_time);const jn=Pe.start_time.split("T")[0];Be=Qs(`${jn}T23:59`)}else if(!Pe.start_time&&Pe.end_time){const jn=Pe.end_time.split("T")[0];re=Qs(`${jn}T00:00`),Be=Qs(Pe.end_time)}if(Wn){const{updateEvent:jn}=await bo(async()=>{const{updateEvent:Kn}=await Promise.resolve().then(()=>yde);return{updateEvent:Kn}},void 0).then(Kn=>({updateEvent:Kn.useEvents}));await ue.from("events").update({title:Pe.title,start_time:re,end_time:Be,description:Pe.description||null}).eq("id",Wn),ze(Kn=>Kn.map(J=>J.id===Wn?{...J,title:Pe.title,start_time:re,end_time:Be,description:Pe.description||null}:J)),ie({title:"Event updated!"})}else await c({title:Pe.title,start_time:re,end_time:Be,description:Pe.description||null}),ie({title:"Event created!"});dt({title:"",start_time:"",end_time:"",description:""}),wr(null),cr(!1)}catch(re){console.error("create/update event failed",re),ie({title:"Failed to save event",variant:"destructive"})}},qu=re=>{wr(re.id),dt({title:re.title||"",start_time:re.start_time?xD(re.start_time):"",end_time:re.end_time?xD(re.end_time):"",description:re.description||""}),cr(!0)},Ku=async re=>{if(!$e.trim()){ie({title:"Please describe your template",variant:"destructive"});return}Ye(!0);try{const{data:Be,error:jn}=await ue.functions.invoke("generate-template",{body:{prompt:$e,channel:re}});if(jn)throw jn;Be!=null&&Be.template?(vi(re),te({name:`AI: ${$e.slice(0,30)}...`,subject:Be.subject||"",body:Be.template}),ie({title:"Template generated!",description:"Review and save your template."})):ie({title:"No template returned",variant:"destructive"})}catch(Be){console.error(Be),ie({title:"Generation failed",variant:"destructive"})}finally{Ye(!1),Le(""),we(!1),Q(!1)}},vi=(re,Be)=>{ce(re),Be?(Ae(Be.id),te({name:Be.name||"",subject:Be.subject||"",body:Be.body||""})):(Ae(null),te({name:"",subject:"",body:""}))},nm=()=>{ce(null),Ae(null),te({name:"",subject:"",body:""})},lc=async()=>{if(!K)return ie({title:"Invalid mode",variant:"destructive"});if(!ne.name||!ne.body)return ie({title:"Name and body required",variant:"destructive"});Te?(await h(Te,{name:ne.name,subject:K==="email"&&ne.subject||null,body:ne.body,channel:K}),ie({title:"Template updated"})):(await u({name:ne.name,subject:K==="email"&&ne.subject||null,body:ne.body,channel:K,is_selected_for_email:!1,is_selected_for_whatsapp:!1}),ie({title:"Template created"})),nm()},Js=()=>({name:(r==null?void 0:r.full_name)||(e==null?void 0:e.full_name)||(e==null?void 0:e.name)||"Your Name",title:(r==null?void 0:r.designation)||(e==null?void 0:e.designation)||"Your Title",company:(r==null?void 0:r.company)||(e==null?void 0:e.company)||"Your Company",email:(r==null?void 0:r.email)||(e==null?void 0:e.email)||"",phone:(r==null?void 0:r.phone)||(e==null?void 0:e.phone)||"",website:(r==null?void 0:r.website)||(e==null?void 0:e.website)||"",linkedin:(r==null?void 0:r.linkedin)||(e==null?void 0:e.linkedin)||"",photo_url:(r==null?void 0:r.photo_url)||(e==null?void 0:e.photo_url)||"",logo_url:(r==null?void 0:r.logo_url)||(e==null?void 0:e.logo_url)||""}),wi=re=>{const Be=Js();return`
<table style="font-family: Arial, sans-serif; font-size: 14px; color: #333;">
  <tr>
    <td style="padding-right: 15px; border-right: 2px solid #4F46E5;">
      ${Be.photo_url?`<img src="${Be.photo_url}" alt="${re.name}" style="width: 80px; height: 80px; border-radius: 8px; object-fit: cover;">`:""}
    </td>
    <td style="padding-left: 15px;">
      <strong style="font-size: 16px; color: #1a1a1a;">${re.name||"Your Name"}</strong><br>
      <span style="color: #666;">${re.title||"Your Title"} | ${re.company||"Your Company"}</span><br>
      <span style="color: #4F46E5;">${re.email||""}</span><br>
      <span>${re.phone||""}</span>
    </td>
  </tr>
</table>`},yl=async()=>{const re=wi(V);await g({name:V.name||"Custom Signature",html:re,is_selected:!0}),le(!1),ie({title:"Signature saved!"})},Eo=()=>{const re=Js(),Be=re.photo_url?`<img src="${re.photo_url}" alt="${re.name}" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 10px;">`:"",jn=re.logo_url?`<img src="${re.logo_url}" alt="${re.company}" style="height: 30px; max-width: 100px; object-fit: contain;">`:"",Kn=[{name:"Minimal",html:`<div style="font-family: Arial, sans-serif; font-size: 13px;">${Be}<strong>${re.name}</strong><br><span style="color: #666;">${re.title} | ${re.company}</span><br><a href="mailto:${re.email}" style="color: #4F46E5;">${re.email}</a> | ${re.phone}</div>`},{name:"Professional",html:`<table style="font-family: 'Segoe UI', Arial, sans-serif;"><tr>${re.photo_url?`<td style="padding-right: 12px;"><img src="${re.photo_url}" alt="${re.name}" style="width: 70px; height: 70px; border-radius: 8px; object-fit: cover;"></td>`:""}<td style="padding-right: 12px; border-right: 3px solid #4F46E5;"><strong style="font-size: 15px; color: #1a1a1a;">${re.name}</strong><br><em style="color: #666; font-size: 13px;">${re.title}</em></td><td style="padding-left: 12px; font-size: 12px;"><strong>${re.company}</strong>${jn?`<br>${jn}`:""}<br>${re.email}<br>${re.phone}</td></tr></table>`},{name:"Creative",html:`<div style="font-family: Georgia, serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 15px; border-radius: 8px;">${re.photo_url?`<img src="${re.photo_url}" alt="${re.name}" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; float: left; margin-right: 12px;">`:""}<strong style="font-size: 16px; color: #2d3748;">${re.name}</strong><br><span style="color: #718096; font-style: italic;">${re.title} @ ${re.company}</span><br><a href="mailto:${re.email}" style="color: #4F46E5; text-decoration: none;">${re.email}</a>${jn?`<br>${jn}`:""}</div>`},{name:"Elegant",html:`<table style="font-family: 'Helvetica Neue', Arial, sans-serif; border-top: 2px solid #e2e8f0; padding-top: 10px;"><tr>${re.photo_url?`<td style="padding-right: 15px;"><img src="${re.photo_url}" alt="${re.name}" style="width: 80px; height: 80px; border-radius: 10px; object-fit: cover;"></td>`:""}<td><span style="font-size: 15px; font-weight: 600; color: #1a202c;">${re.name}</span><br><span style="font-size: 12px; color: #718096; text-transform: uppercase; letter-spacing: 1px;">${re.title}</span><br><span style="font-size: 12px; color: #4a5568;">${re.company}</span>${jn?`<br>${jn}`:""}<br><span style="font-size: 12px; color: #4F46E5;">${re.email}</span></td></tr></table>`}];Ve(Kn),yt(0)},ra=async()=>{lt(!0),be(!1),ke(!0);const re=Js();try{const{data:Be,error:jn}=await ue.functions.invoke("generate-signatures",{body:{name:re.name,company:re.company,designation:re.title,email:re.email,phone:re.phone,website:re.website,linkedin:re.linkedin,photo_url:re.photo_url,logo_url:re.logo_url,prompt:Qe||"Premium professional signature"}});if(jn)throw jn;Be!=null&&Be.signatures&&Array.isArray(Be.signatures)?(Ve(Be.signatures),yt(0)):Eo()}catch(Be){console.error("Error generating signatures:",Be),Eo(),ie({title:"Using default signatures",description:"AI generation failed, showing defaults."})}finally{lt(!1)}},Lt=()=>{const re=$t[tt];re&&(navigator.clipboard.writeText(re.html),qt(!0),setTimeout(()=>qt(!1),2e3),ie({title:"Signature HTML copied!",description:"Paste this into your email settings."}))},tr=async()=>{const re=$t[tt];re&&(await g({name:re.name,html:re.html,is_selected:!0}),ie({title:"Signature saved!"}))},Yu=()=>{const re=$t[tt];if(re){const Be=re.html.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(div|p|td|tr|table)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/\n\s*\n/g,`

`).trim();window.location.href=`mailto:?body=${encodeURIComponent(`

---
`+Be)}`}};return i.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-6 sm:space-y-8 animate-fade-up max-w-7xl mx-auto overflow-x-hidden",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Dashboard"}),i.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground",children:["Welcome back",e!=null&&e.name?`, ${e.name.split(" ")[0]}`:"","! Here's your networking overview."]})]}),i.jsxs("div",{className:"flex gap-1.5 sm:gap-2 flex-wrap items-center",children:[rpe.map(re=>i.jsx(de,{variant:C===re||re==="Custom"&&C.startsWith("Custom:")?"default":"outline",size:"sm",className:"text-xs sm:text-sm px-2 sm:px-3",onClick:()=>_n(re),children:re},re)),C.startsWith("Custom:")&&i.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground ml-1 sm:ml-2 break-all",children:C})]}),i.jsx(vn,{open:T,onOpenChange:A,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Select Date Range"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex gap-4",children:[i.jsxs(dC,{children:[i.jsx(hC,{asChild:!0,children:i.jsxs(de,{variant:"outline",className:"w-full justify-start text-left",children:[i.jsx(i2,{className:"mr-2 h-4 w-4"}),_.from?Ht(_.from,"PPP"):"From date"]})}),i.jsx(S0,{className:"w-auto p-0",align:"start",children:i.jsx(j0,{mode:"single",selected:_.from,onSelect:re=>I(Be=>({...Be,from:re}))})})]}),i.jsxs(dC,{children:[i.jsx(hC,{asChild:!0,children:i.jsxs(de,{variant:"outline",className:"w-full justify-start text-left",children:[i.jsx(i2,{className:"mr-2 h-4 w-4"}),_.to?Ht(_.to,"PPP"):"To date"]})}),i.jsx(S0,{className:"w-auto p-0",align:"start",children:i.jsx(j0,{mode:"single",selected:_.to,onSelect:re=>I(Be=>({...Be,to:re}))})})]})]}),i.jsx(de,{onClick:fn,className:"w-full",disabled:!_.from||!_.to,children:"Apply Range"})]})]})}),i.jsx(LO,{children:i.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx(Tn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"0ms",animationFillMode:"forwards"},children:i.jsxs(Dn,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:i.jsx(Xm,{className:"h-5 w-5 text-primary"})}),i.jsxs(Av,{children:[i.jsx(Rv,{asChild:!0,children:i.jsx(Iv,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),i.jsx(Fx,{children:i.jsx("p",{children:"Unique QR scans and NFC taps."})})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.card_views)??0).toLocaleString()}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Card Views"})]})]})}),i.jsx(Tn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"100ms",animationFillMode:"forwards"},children:i.jsxs(Dn,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:i.jsx(eu,{className:"h-5 w-5 text-primary"})}),i.jsxs(Av,{children:[i.jsx(Rv,{asChild:!0,children:i.jsx(Iv,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),i.jsx(Fx,{children:i.jsx("p",{children:"People who saved your contact to their device."})})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.contact_saves)??0).toLocaleString()}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact Saves"})]})]})}),i.jsx(Tn,{className:"card-hover opacity-0 animate-fade-up",style:{animationDelay:"200ms",animationFillMode:"forwards"},children:i.jsxs(Dn,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:i.jsx(DX,{className:"h-5 w-5 text-primary"})}),i.jsxs(Av,{children:[i.jsx(Rv,{asChild:!0,children:i.jsx(Iv,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),i.jsx(Fx,{children:i.jsx("p",{children:"Contacts you added to your CRM (manual, scanned, auto-captured)."})})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":((y==null?void 0:y.connections_added)??0).toLocaleString()}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Connections Added"})]})]})}),i.jsx(Tn,{className:"card-hover opacity-0 animate-fade-up cursor-pointer",style:{animationDelay:"300ms",animationFillMode:"forwards"},onClick:U,children:i.jsxs(Dn,{className:"pt-6",children:[i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center",children:i.jsx(Bl,{className:"h-5 w-5 text-primary"})}),i.jsxs(Av,{children:[i.jsx(Rv,{asChild:!0,children:i.jsx(Iv,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),i.jsx(Fx,{children:i.jsx("p",{children:"Attended events / unique card views across attended events. Click to view event-level breakdown."})})]})]}),i.jsxs("div",{className:"mt-4",children:[i.jsx("p",{className:"text-2xl font-bold text-foreground",children:b?"...":`${q} / ${L}`}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Events"})]})]})})]})}),i.jsx(vn,{open:j,onOpenChange:D,children:i.jsxs(mn,{className:"sm:max-w-lg",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Attended Events"})}),i.jsx("div",{className:"space-y-4",children:X?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx(Gt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):F.length===0?i.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No attended events in this period."}):i.jsx("div",{className:"space-y-3",children:F.map(re=>i.jsx("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-sm",children:re.title}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[re.start_time?Tv(re.start_time):"",re.end_time&&` - ${Tv(re.end_time).split(", ")[1]}`]})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-lg font-bold text-primary",children:re.views}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"unique views"})]})]})},re.id))})})]})}),i.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[i.jsxs(Tn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"200ms",animationFillMode:"forwards"},onClick:w?void 0:k,children:[!w&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),i.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:i.jsx(mo,{className:"h-4 w-4 text-white"})})})]}),i.jsx(Qn,{className:"pt-3",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary/10 flex items-center justify-center shrink-0",children:i.jsx(Di,{className:"h-5 w-5 text-primary"})}),i.jsxs("div",{className:"min-w-0",children:[i.jsx(Jn,{className:"text-lg truncate",children:"Email Templates"}),i.jsx(Ri,{className:"truncate",children:"Quick templates for emails"})]})]}),i.jsxs("div",{className:"flex gap-1 shrink-0",children:[i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>we(!0),disabled:!w,children:[i.jsx(Ls,{className:"h-4 w-4 mr-1"})," AI"]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>vi("email"),disabled:!w,children:[i.jsx(fo,{className:"h-4 w-4 mr-1"})," Add"]})]})]})}),i.jsxs(Dn,{className:"space-y-3",children:[m().map(re=>i.jsxs("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("span",{className:"font-medium text-sm",children:re.name}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(de,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>vi("email",re),disabled:!w,children:i.jsx(ay,{className:"h-4 w-4"})}),i.jsx(de,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(re.id),disabled:!w,children:i.jsx(ti,{className:"h-4 w-4 text-destructive"})})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:re.body})]},re.id)),m().length===0&&i.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No email templates yet"})]})]}),i.jsxs(Tn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"300ms",animationFillMode:"forwards"},onClick:w?void 0:k,children:[!w&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),i.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:i.jsx(mo,{className:"h-4 w-4 text-white"})})})]}),i.jsx(Qn,{className:"pt-3",children:i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-emerald-500/10 flex items-center justify-center shrink-0",children:i.jsx(Zm,{className:"h-5 w-5 text-emerald-500"})}),i.jsxs("div",{className:"min-w-0",children:[i.jsx(Jn,{className:"text-lg truncate",children:"WhatsApp Templates"}),i.jsx(Ri,{className:"truncate",children:"Quick messages for WhatsApp"})]})]}),i.jsxs("div",{className:"flex gap-1 shrink-0",children:[i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>Q(!0),disabled:!w,children:[i.jsx(Ls,{className:"h-4 w-4 mr-1"})," AI"]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>vi("whatsapp"),disabled:!w,children:[i.jsx(fo,{className:"h-4 w-4 mr-1"})," Add"]})]})]})}),i.jsxs(Dn,{className:"space-y-3",children:[f().map(re=>i.jsxs("div",{className:"p-3 rounded-lg border border-border/50 bg-muted/30",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("span",{className:"font-medium text-sm",children:re.name}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(de,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>vi("whatsapp",re),disabled:!w,children:i.jsx(ay,{className:"h-4 w-4"})}),i.jsx(de,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p(re.id),disabled:!w,children:i.jsx(ti,{className:"h-4 w-4 text-destructive"})})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:re.body})]},re.id)),f().length===0&&i.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No WhatsApp templates yet"})]})]}),i.jsxs(Tn,{className:Ie("opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"400ms",animationFillMode:"forwards"},onClick:w?void 0:k,children:[!w&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),i.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:i.jsx(mo,{className:"h-4 w-4 text-white"})})})]}),i.jsx(Qn,{children:i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-violet-500/10 flex items-center justify-center",children:i.jsx(Di,{className:"h-5 w-5 text-violet-500"})}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs("div",{children:[i.jsx(Jn,{className:"text-lg",children:"Email Signature"}),i.jsx(Ri,{children:"AI-powered & premium templates synced with your card"})]})})]})})}),i.jsx(Dn,{children:w?i.jsx(npe,{activeCard:r}):i.jsx("div",{className:"py-4 text-center text-muted-foreground text-sm",children:"Upgrade to access email signatures"})})]}),i.jsxs(Tn,{className:"opacity-0 animate-fade-up",style:{animationDelay:"500ms",animationFillMode:"forwards"},children:[i.jsx(Qn,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center",children:i.jsx(PX,{className:"h-5 w-5 text-blue-500"})}),i.jsxs("div",{children:[i.jsx(Jn,{className:"text-lg",children:"Tags"}),i.jsx(Ri,{children:"Tap a tag to delete it."})]})]})}),i.jsxs(Dn,{children:[i.jsx("div",{ref:za,className:"flex flex-wrap gap-2",children:ge.map(re=>i.jsx("button",{onClick:()=>Yi(re),className:Ie("inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm select-none cursor-pointer border"),style:{backgroundColor:"#F9FAFB",borderColor:"#111827",color:"#111827"},children:i.jsx("span",{children:re.name})},re.id))}),i.jsxs("div",{className:"flex gap-2 mt-4",children:[i.jsx(At,{placeholder:"New tag...",value:wt,onChange:re=>Nt(re.target.value),onKeyDown:re=>re.key==="Enter"&&Kt()}),i.jsx(de,{variant:"outline",size:"icon",onClick:Kt,children:i.jsx(fo,{className:"h-4 w-4"})})]})]})]}),i.jsxs(Tn,{className:Ie("lg:col-span-2 opacity-0 animate-fade-up relative",!w&&"opacity-80 cursor-pointer"),style:{animationDelay:"600ms",animationFillMode:"forwards"},onClick:w?void 0:k,children:[!w&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute inset-0 bg-muted/40 backdrop-blur-[1px] rounded-lg z-10 pointer-events-none"}),i.jsx("div",{className:"absolute top-3 right-3 z-20 pointer-events-none",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500/90 flex items-center justify-center shadow-lg",children:i.jsx(mo,{className:"h-4 w-4 text-white"})})})]}),i.jsx(Qn,{children:i.jsxs("div",{className:"w-full",children:[i.jsx("div",{className:"flex items-center justify-between",children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center",children:i.jsx(Bl,{className:"h-5 w-5 text-amber-500"})}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs("div",{children:[i.jsx(Jn,{className:"text-lg",children:"Events"}),i.jsx(Ri,{children:"Schedule an event."})]})})]})}),i.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 items-center",children:[Ke.filter(re=>!re.start_time&&!re.end_time).map(re=>i.jsx("button",{onClick:()=>w&&bi(re),className:"inline-flex items-center px-3 py-1 rounded-full text-sm cursor-pointer",style:{backgroundColor:re.color?`${re.color}20`:"#f3f4f6",border:`1px solid ${re.color?`${re.color}40`:"#e5e7eb"}`,color:re.color||void 0},disabled:!w,children:re.title},re.id)),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>{wr(null),dt({title:"",start_time:"",end_time:"",description:""}),cr(!0)},disabled:!w,children:[i.jsx(fo,{className:"h-4 w-4 mr-1"})," Add Event"]})]})]})}),i.jsxs(Dn,{children:[Ke.filter(re=>re.start_time||re.end_time).length>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Scheduled Events"}),i.jsx("div",{ref:Is,className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Ke.filter(re=>re.start_time||re.end_time).map(re=>i.jsxs("div",{className:"p-4 rounded-xl border border-border/50 bg-muted/30",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("span",{className:"font-medium",children:re.title}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:()=>w&&qu(re),className:"p-1 hover:bg-muted rounded",disabled:!w,children:i.jsx(ay,{className:"h-4 w-4 text-muted-foreground"})}),i.jsx("button",{onClick:()=>w&&Vu(re),className:"p-1 hover:bg-destructive/10 rounded",disabled:!w,children:i.jsx(ti,{className:"h-4 w-4 text-destructive"})})]})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[re.start_time?Tv(re.start_time):"No start time",re.end_time&&`  ${Tv(re.end_time)}`]})]},re.id))})]}),Ke.length===0&&i.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No events yet. Add events to auto-tag contacts created during event times."})]})]})]}),i.jsx(vn,{open:Bt,onOpenChange:re=>{re||(Qt(!1),gt(null))},children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsx(Nn,{className:"flex items-center justify-between",children:i.jsx("span",{children:"Event options"})})}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{children:i.jsx("p",{className:"font-medium text-lg",children:(rt==null?void 0:rt.name)||(rt==null?void 0:rt.title)})}),i.jsxs("div",{children:[i.jsx(We,{children:"Change color"}),i.jsxs("div",{className:"mt-2",children:[i.jsx("div",{className:"rounded-md overflow-hidden",style:{boxShadow:"inset 0 1px 0 rgba(255,255,255,0.3)"},children:i.jsx("input",{type:"range",min:0,max:360,value:en,onChange:re=>tm(Number(re.target.value)),className:"w-full h-6 appearance-none",style:{background:"linear-gradient(90deg, #ff0000 0%, #ff9900 12.5%, #ffff00 25%, #00ff00 37.5%, #00ffff 50%, #0066ff 62.5%, #7a00ff 75%, #ff00ff 87.5%, #ff0000 100%)",outline:"none"}})}),i.jsxs("div",{className:"flex items-center justify-between mt-2",children:[i.jsxs("div",{className:"inline-flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-md border",style:{background:x3(en,80,50)}}),i.jsx("div",{className:"text-sm",children:i.jsx("div",{className:"font-medium",children:(rt==null?void 0:rt.name)||(rt==null?void 0:rt.title)})})]}),i.jsx("div",{className:"text-xs text-muted-foreground",children:"Color saved automatically"})]})]})]}),i.jsx("div",{className:"mt-2",children:i.jsx(de,{variant:"destructive",className:"w-full",onClick:Uu,children:"Delete event"})})]})]})}),i.jsx(vn,{open:vr,onOpenChange:re=>{re||(js(!1),La(null))},children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsx(Nn,{className:"flex items-center justify-between",children:i.jsx("span",{children:"Tag options"})})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{children:i.jsx("p",{className:"font-medium text-lg",children:Mr==null?void 0:Mr.name})}),i.jsx(de,{variant:"destructive",className:"w-full",onClick:oc,children:"Delete tag"})]})]})}),i.jsx(vn,{open:xr,onOpenChange:re=>{re||(Ki(!1),yi(null))},children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsxs(Nn,{children:["Delete ",is==null?void 0:is.title]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone."}),i.jsx("div",{className:"mt-4",children:i.jsx(de,{variant:"destructive",className:"w-full",onClick:Hu,children:"Delete"})})]})]})}),i.jsx(vn,{open:On,onOpenChange:re=>{re?cr(!0):(cr(!1),wr(null),dt({title:"",start_time:"",end_time:"",description:""}))},children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:Wn?"Edit Event":"Add Event"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Event Name"}),i.jsx(At,{value:Pe.title,onChange:re=>dt(Be=>({...Be,title:re.target.value})),placeholder:"e.g., Tech Summit 2025"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs(We,{children:["Start Date & Time ",i.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),i.jsx(At,{type:"datetime-local",value:Pe.start_time,onChange:re=>dt(Be=>({...Be,start_time:re.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(We,{children:["End Date & Time ",i.jsx("span",{className:"text-muted-foreground text-xs",children:"(optional)"})]}),i.jsx(At,{type:"datetime-local",value:Pe.end_time,onChange:re=>dt(Be=>({...Be,end_time:re.target.value}))})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Leave dates empty to create an event chip only. If only start is set, end defaults to 11:59 PM same day."}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Description (optional)"}),i.jsx(ka,{value:Pe.description,onChange:re=>dt(Be=>({...Be,description:re.target.value})),rows:2})]}),i.jsx(de,{onClick:Gu,className:"w-full",children:Wn?"Save Changes":"Create Event"})]})]})}),i.jsx(vn,{open:Se,onOpenChange:we,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(Di,{className:"h-5 w-5 text-primary"}),"Create Email Template with AI"]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Describe your email template"}),i.jsx(ka,{value:$e,onChange:re=>Le(re.target.value),placeholder:"e.g., A professional follow-up email after meeting at a conference, asking to schedule a call...",rows:4}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"AI will generate a professional email with subject line and body."})]}),i.jsx(de,{onClick:()=>Ku("email"),className:"w-full",disabled:Xe||!$e.trim(),children:Xe?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Generate Email Template"]})})]})]})}),i.jsx(vn,{open:Fe,onOpenChange:Q,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(Zm,{className:"h-5 w-5 text-emerald-500"}),"Create WhatsApp Template with AI"]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Describe your message"}),i.jsx(ka,{value:$e,onChange:re=>Le(re.target.value),placeholder:"e.g., A quick follow-up message after meeting someone, casual and friendly...",rows:3}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"AI will generate a short, casual WhatsApp message."})]}),i.jsx(de,{onClick:()=>Ku("whatsapp"),className:"w-full",disabled:Xe||!$e.trim(),children:Xe?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Generate WhatsApp Template"]})})]})]})}),i.jsx(vn,{open:Ce,onOpenChange:be,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(Ls,{className:"h-5 w-5 text-primary"}),"Generate Email Signature"]})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Design Style (optional)"}),i.jsx(ka,{value:Qe,onChange:re=>_t(re.target.value),placeholder:"e.g., Minimal with accent color, creative gradient style, corporate blue theme... Leave blank for random professional design",rows:3}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Describe your preferred style or leave blank for AI to choose."})]}),i.jsxs(de,{onClick:ra,className:"w-full",children:[i.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Generate Signatures"]})]})]})}),i.jsx(vn,{open:ve,onOpenChange:ke,children:i.jsxs(mn,{className:"max-w-2xl",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Select Your Signature"})}),i.jsx("div",{className:"space-y-4",children:an?i.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"Generating signatures with AI..."})]}):$t.length>0?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide",children:$t.map((re,Be)=>i.jsx("button",{onClick:()=>yt(Be),className:Ie("flex-shrink-0 px-4 py-2 rounded-lg border transition-all",tt===Be?"border-primary bg-primary/10 text-primary":"border-border hover:border-primary/50"),children:re.name},Be))}),i.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",children:i.jsx("div",{dangerouslySetInnerHTML:{__html:xd.sanitize(((os=$t[tt])==null?void 0:os.html)||"")}})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(de,{onClick:Lt,className:"flex-1",children:[ut?i.jsx(dn,{className:"h-4 w-4 mr-2"}):i.jsx(o2,{className:"h-4 w-4 mr-2"}),ut?"Copied!":"Copy HTML"]}),i.jsx(de,{onClick:tr,variant:"outline",className:"flex-1",children:"Save Signature"})]})]}):null})]})}),i.jsx(vn,{open:Ee,onOpenChange:Ue,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Export Signature"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",children:i.jsx("div",{dangerouslySetInnerHTML:{__html:xd.sanitize(((bl=$t[tt])==null?void 0:bl.html)||((vl=x())==null?void 0:vl.html)||wi({name:(e==null?void 0:e.name)||"",title:(e==null?void 0:e.designation)||"",company:(e==null?void 0:e.company)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""}))}})}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs(de,{onClick:Lt,className:"w-full",children:[ut?i.jsx(dn,{className:"h-4 w-4 mr-2"}):i.jsx(o2,{className:"h-4 w-4 mr-2"}),ut?"Copied!":"Copy HTML"]}),i.jsxs(de,{onClick:Yu,variant:"outline",className:"w-full",children:[i.jsx(Di,{className:"h-4 w-4 mr-2"}),"Open Email with Signature"]})]})]})]})}),i.jsx(vn,{open:Je,onOpenChange:le,children:i.jsxs(mn,{className:"max-w-2xl",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Edit Signature"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Name"}),i.jsx(At,{value:V.name,onChange:re=>ee(Be=>({...Be,name:re.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Title"}),i.jsx(At,{value:V.title,onChange:re=>ee(Be=>({...Be,title:re.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Company"}),i.jsx(At,{value:V.company,onChange:re=>ee(Be=>({...Be,company:re.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Email"}),i.jsx(At,{value:V.email,onChange:re=>ee(Be=>({...Be,email:re.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Phone"}),i.jsx(At,{value:V.phone,onChange:re=>ee(Be=>({...Be,phone:re.target.value}))})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Preview"}),i.jsx("div",{className:"p-4 rounded-lg border border-border bg-card",dangerouslySetInnerHTML:{__html:xd.sanitize(wi(V))}})]}),i.jsx(de,{onClick:yl,className:"w-full",children:"Save Signature"})]})]})}),i.jsx(vn,{open:!!K,onOpenChange:re=>{re||nm()},children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:Te?"Edit Template":"Add Template"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Template Name"}),i.jsx(At,{value:ne.name,onChange:re=>te(Be=>({...Be,name:re.target.value})),placeholder:"e.g., Follow-up"})]}),K==="email"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Subject (for email)"}),i.jsx(At,{value:ne.subject,onChange:re=>te(Be=>({...Be,subject:re.target.value})),placeholder:"e.g., Great meeting you, {{name}}!"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Body"}),i.jsx(ka,{value:ne.body,onChange:re=>te(Be=>({...Be,body:re.target.value})),rows:5,placeholder:K==="email"?"Hi {{name}}, ...":"Hey {{name}}, ..."}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Placeholders: ","{{name}}",", ","{{company}}",", ","{{designation}}",", ","{{myName}}",", ","{{myCompany}}"]})]}),i.jsx(de,{onClick:lc,className:"w-full",children:Te?"Save Changes":"Save Template"})]})]})}),i.jsx(Rz,{open:ft.open,onOpenChange:re=>pe(Be=>({...Be,open:re})),title:ft.title,description:ft.description,onConfirm:ft.onConfirm})]})}function spe(e){if(typeof document>"u")return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}const m6=Ne.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),yb=()=>{const e=Ne.useContext(m6);if(!e)throw new Error("useDrawerContext must be used within a Drawer.Root");return e};spe(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const ipe=24,ope=typeof window<"u"?N.useLayoutEffect:N.useEffect;function v3(...e){return(...t)=>{for(let n of e)typeof n=="function"&&n(...t)}}function lpe(){return bI(/^Mac/)}function cpe(){return bI(/^iPhone/)}function w3(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function upe(){return bI(/^iPad/)||lpe()&&navigator.maxTouchPoints>1}function f6(){return cpe()||upe()}function bI(e){return typeof window<"u"&&window.navigator!=null?e.test(window.navigator.platform):void 0}const RS=typeof document<"u"&&window.visualViewport;function N3(e){let t=window.getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowX+t.overflowY)}function g6(e){for(N3(e)&&(e=e.parentElement);e&&!N3(e);)e=e.parentElement;return e||document.scrollingElement||document.documentElement}const dpe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Gv=0,DS;function hpe(e={}){let{isDisabled:t}=e;ope(()=>{if(!t)return Gv++,Gv===1&&f6()&&(DS=ppe()),()=>{Gv--,Gv===0&&(DS==null||DS())}},[t])}function ppe(){let e,t=0,n=h=>{e=g6(h.target),!(e===document.documentElement&&e===document.body)&&(t=h.changedTouches[0].pageY)},r=h=>{if(!e||e===document.documentElement||e===document.body){h.preventDefault();return}let p=h.changedTouches[0].pageY,m=e.scrollTop,f=e.scrollHeight-e.clientHeight;f!==0&&((m<=0&&p>t||m>=f&&p<t)&&h.preventDefault(),t=p)},a=h=>{let p=h.target;kC(p)&&p!==document.activeElement&&(h.preventDefault(),p.style.transform="translateY(-2000px)",p.focus(),requestAnimationFrame(()=>{p.style.transform=""}))},s=h=>{let p=h.target;kC(p)&&(p.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{p.style.transform="",RS&&(RS.height<window.innerHeight?requestAnimationFrame(()=>{k3(p)}):RS.addEventListener("resize",()=>k3(p),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},l=window.pageXOffset,c=window.pageYOffset,d=v3(mpe(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let u=v3(Sx(document,"touchstart",n,{passive:!1,capture:!0}),Sx(document,"touchmove",r,{passive:!1,capture:!0}),Sx(document,"touchend",a,{passive:!1,capture:!0}),Sx(document,"focus",s,!0),Sx(window,"scroll",o));return()=>{d(),u(),window.scrollTo(l,c)}}function mpe(e,t,n){let r=e.style[t];return e.style[t]=n,()=>{e.style[t]=r}}function Sx(e,t,n,r){return e.addEventListener(t,n,r),()=>{e.removeEventListener(t,n,r)}}function k3(e){let t=document.scrollingElement||document.documentElement;for(;e&&e!==t;){let n=g6(e);if(n!==document.documentElement&&n!==document.body&&n!==e){let r=n.getBoundingClientRect().top,a=e.getBoundingClientRect().top,s=e.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+ipe;s>o&&(n.scrollTop+=a-r)}e=n.parentElement}}function kC(e){return e instanceof HTMLInputElement&&!dpe.has(e.type)||e instanceof HTMLTextAreaElement||e instanceof HTMLElement&&e.isContentEditable}function fpe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function gpe(...e){return t=>e.forEach(n=>fpe(n,t))}function x6(...e){return N.useCallback(gpe(...e),e)}const y6=new WeakMap;function ba(e,t,n=!1){if(!e||!(e instanceof HTMLElement))return;let r={};Object.entries(t).forEach(([a,s])=>{if(a.startsWith("--")){e.style.setProperty(a,s);return}r[a]=e.style[a],e.style[a]=s}),!n&&y6.set(e,r)}function xpe(e,t){if(!e||!(e instanceof HTMLElement))return;let n=y6.get(e);n&&(e.style[t]=n[t])}const wa=e=>{switch(e){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return e}};function qv(e,t){if(!e)return null;const n=window.getComputedStyle(e),r=n.transform||n.webkitTransform||n.mozTransform;let a=r.match(/^matrix3d\((.+)\)$/);return a?parseFloat(a[1].split(", ")[wa(t)?13:12]):(a=r.match(/^matrix\((.+)\)$/),a?parseFloat(a[1].split(", ")[wa(t)?5:4]):null)}function ype(e){return 8*(Math.log(e+1)-2)}function MS(e,t){if(!e)return()=>{};const n=e.style.cssText;return Object.assign(e.style,t),()=>{e.style.cssText=n}}function bpe(...e){return(...t)=>{for(const n of e)typeof n=="function"&&n(...t)}}const Lr={DURATION:.5,EASE:[.32,.72,0,1]},b6=.4,vpe=.25,wpe=100,v6=8,Qu=16,SC=26,$S="vaul-dragging";function w6(e){const t=Ne.useRef(e);return Ne.useEffect(()=>{t.current=e}),Ne.useMemo(()=>(...n)=>t.current==null?void 0:t.current.call(t,...n),[])}function Npe({defaultProp:e,onChange:t}){const n=Ne.useState(e),[r]=n,a=Ne.useRef(r),s=w6(t);return Ne.useEffect(()=>{a.current!==r&&(s(r),a.current=r)},[r,a,s]),n}function N6({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,a]=Npe({defaultProp:t,onChange:n}),s=e!==void 0,o=s?e:r,l=w6(n),c=Ne.useCallback(d=>{if(s){const h=typeof d=="function"?d(e):d;h!==e&&l(h)}else a(d)},[s,e,a,l]);return[o,c]}function kpe({activeSnapPointProp:e,setActiveSnapPointProp:t,snapPoints:n,drawerRef:r,overlayRef:a,fadeFromIndex:s,onSnapPointChange:o,direction:l="bottom",container:c,snapToSequentialPoint:d}){const[u,h]=N6({prop:e,defaultProp:n==null?void 0:n[0],onChange:t}),[p,m]=Ne.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Ne.useEffect(()=>{function S(){m({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]);const f=Ne.useMemo(()=>u===(n==null?void 0:n[n.length-1])||null,[n,u]),g=Ne.useMemo(()=>n==null?void 0:n.findIndex(S=>S===u),[n,u]),x=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===u||!n,y=Ne.useMemo(()=>{const S=c?{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var _;return(_=n==null?void 0:n.map(I=>{const T=typeof I=="string";let A=0;if(T&&(A=parseInt(I,10)),wa(l)){const D=T?A:p?I*S.height:0;return p?l==="bottom"?S.height-D:-S.height+D:D}const j=T?A:p?I*S.width:0;return p?l==="right"?S.width-j:-S.width+j:j}))!=null?_:[]},[n,p,c]),b=Ne.useMemo(()=>g!==null?y==null?void 0:y[g]:null,[y,g]),v=Ne.useCallback(S=>{var _;const I=(_=y==null?void 0:y.findIndex(T=>T===S))!=null?_:null;o(I),ba(r.current,{transition:`transform ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,transform:wa(l)?`translate3d(0, ${S}px, 0)`:`translate3d(${S}px, 0, 0)`}),y&&I!==y.length-1&&I!==s&&I<s?ba(a.current,{transition:`opacity ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,opacity:"0"}):ba(a.current,{transition:`opacity ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,opacity:"1"}),h(n==null?void 0:n[Math.max(I,0)])},[r.current,n,y,s,a,h]);Ne.useEffect(()=>{if(u||e){var S;const _=(S=n==null?void 0:n.findIndex(I=>I===e||I===u))!=null?S:-1;y&&_!==-1&&typeof y[_]=="number"&&v(y[_])}},[u,e,n,y,v]);function w({draggedDistance:S,closeDrawer:_,velocity:I,dismissible:T}){if(s===void 0)return;const A=l==="bottom"||l==="right"?(b??0)-S:(b??0)+S,j=g===s-1,D=g===0,F=S>0;if(j&&ba(a.current,{transition:`opacity ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`}),!d&&I>2&&!F){T?_():v(y[0]);return}if(!d&&I>2&&F&&y&&n){v(y[n.length-1]);return}const B=y==null?void 0:y.reduce(($,L)=>typeof $!="number"||typeof L!="number"?$:Math.abs(L-A)<Math.abs($-A)?L:$),q=wa(l)?window.innerHeight:window.innerWidth;if(I>b6&&Math.abs(S)<q*.4){const $=F?1:-1;if($>0&&f){v(y[n.length-1]);return}if(D&&$<0&&T&&_(),g===null)return;v(y[g+$]);return}v(B)}function k({draggedDistance:S}){if(b===null)return;const _=l==="bottom"||l==="right"?b-S:b+S;(l==="bottom"||l==="right")&&_<y[y.length-1]||(l==="top"||l==="left")&&_>y[y.length-1]||ba(r.current,{transform:wa(l)?`translate3d(0, ${_}px, 0)`:`translate3d(${_}px, 0, 0)`})}function C(S,_){if(!n||typeof g!="number"||!y||s===void 0)return null;const I=g===s-1;if(g>=s&&_)return 0;if(I&&!_)return 1;if(!x&&!I)return null;const A=I?g+1:g-1,j=I?y[A]-y[A-1]:y[A+1]-y[A],D=S/Math.abs(j);return I?1-D:D}return{isLastSnapPoint:f,activeSnapPoint:u,shouldFade:x,getPercentageDragged:C,setActiveSnapPoint:h,activeSnapPointIndex:g,onRelease:w,onDrag:k,snapPointsOffset:y}}const Spe=()=>()=>{};function Cpe(){const{direction:e,isOpen:t,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:a}=yb(),s=Ne.useRef(null),o=N.useMemo(()=>document.body.style.backgroundColor,[]);function l(){return(window.innerWidth-SC)/window.innerWidth}Ne.useEffect(()=>{if(t&&n){s.current&&clearTimeout(s.current);const c=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!c)return;bpe(r&&!a?MS(document.body,{background:"black"}):Spe,MS(c,{transformOrigin:wa(e)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Lr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Lr.EASE.join(",")})`}));const d=MS(c,{borderRadius:`${v6}px`,overflow:"hidden",...wa(e)?{transform:`scale(${l()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${l()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{d(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},Lr.DURATION*1e3)}}},[t,n,o])}let Cx=null;function _pe({isOpen:e,modal:t,nested:n,hasBeenOpened:r,preventScrollRestoration:a,noBodyStyles:s}){const[o,l]=Ne.useState(()=>typeof window<"u"?window.location.href:""),c=Ne.useRef(0),d=Ne.useCallback(()=>{if(w3()&&Cx===null&&e&&!s){Cx={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:h,innerHeight:p}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-h}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const m=p-window.innerHeight;m&&c.current>=p&&(document.body.style.top=`${-(c.current+m)}px`)}),300)}},[e]),u=Ne.useCallback(()=>{if(w3()&&Cx!==null&&!s){const h=-parseInt(document.body.style.top,10),p=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Cx),window.requestAnimationFrame(()=>{if(a&&o!==window.location.href){l(window.location.href);return}window.scrollTo(p,h)}),Cx=null}},[o]);return Ne.useEffect(()=>{function h(){c.current=window.scrollY}return h(),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[]),Ne.useEffect(()=>{n||!r||(e?(!window.matchMedia("(display-mode: standalone)").matches&&d(),t||window.setTimeout(()=>{u()},500)):u())},[e,r,o,t,n,d,u]),{restorePositionSetting:u}}function jpe({open:e,onOpenChange:t,children:n,onDrag:r,onRelease:a,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:l=!0,closeThreshold:c=vpe,scrollLockTimeout:d=wpe,dismissible:u=!0,handleOnly:h=!1,fadeFromIndex:p=s&&s.length-1,activeSnapPoint:m,setActiveSnapPoint:f,fixed:g,modal:x=!0,onClose:y,nested:b,noBodyStyles:v,direction:w="bottom",defaultOpen:k=!1,disablePreventScroll:C=!0,snapToSequentialPoint:S=!1,preventScrollRestoration:_=!1,repositionInputs:I=!0,onAnimationEnd:T,container:A,autoFocus:j=!1}){var D,F;const[B=!1,q]=N6({defaultProp:k,prop:e,onChange:lt=>{t==null||t(lt),!lt&&!b&&be(),setTimeout(()=>{T==null||T(lt)},Lr.DURATION*1e3),lt&&!x&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),lt||(document.body.style.pointerEvents="auto")}}),[$,L]=Ne.useState(!1),[M,X]=Ne.useState(!1),[G,W]=Ne.useState(!1),O=Ne.useRef(null),U=Ne.useRef(null),K=Ne.useRef(null),ce=Ne.useRef(null),ne=Ne.useRef(null),te=Ne.useRef(!1),Te=Ne.useRef(null),Ae=Ne.useRef(0),Se=Ne.useRef(!1),we=Ne.useRef(0),Fe=Ne.useRef(null),Q=Ne.useRef(((D=Fe.current)==null?void 0:D.getBoundingClientRect().height)||0),$e=Ne.useRef(((F=Fe.current)==null?void 0:F.getBoundingClientRect().width)||0),Le=Ne.useRef(0),Xe=Ne.useCallback(lt=>{s&&lt===ee.length-1&&(U.current=new Date)},[]),{activeSnapPoint:Ye,activeSnapPointIndex:Je,setActiveSnapPoint:le,onRelease:V,snapPointsOffset:ee,onDrag:ve,shouldFade:ke,getPercentageDragged:Ce}=kpe({snapPoints:s,activeSnapPointProp:m,setActiveSnapPointProp:f,drawerRef:Fe,fadeFromIndex:p,overlayRef:O,onSnapPointChange:Xe,direction:w,container:A,snapToSequentialPoint:S});hpe({isDisabled:!B||M||!x||G||!$||!I||!C});const{restorePositionSetting:be}=_pe({isOpen:B,modal:x,nested:b,hasBeenOpened:$,preventScrollRestoration:_,noBodyStyles:v});function Ee(){return(window.innerWidth-SC)/window.innerWidth}function Ue(lt){var wt,Nt;!u&&!s||Fe.current&&!Fe.current.contains(lt.target)||(Q.current=((wt=Fe.current)==null?void 0:wt.getBoundingClientRect().height)||0,$e.current=((Nt=Fe.current)==null?void 0:Nt.getBoundingClientRect().width)||0,X(!0),K.current=new Date,f6()&&window.addEventListener("touchend",()=>te.current=!1,{once:!0}),lt.target.setPointerCapture(lt.pointerId),Ae.current=wa(w)?lt.pageY:lt.pageX)}function Qe(lt,wt){var Nt,Kt;let jt=lt;const Zt=(Nt=window.getSelection())==null?void 0:Nt.toString(),An=Fe.current?qv(Fe.current,w):null,it=new Date;if(jt.hasAttribute("data-vaul-no-drag")||jt.closest("[data-vaul-no-drag]"))return!1;if(w==="right"||w==="left")return!0;if(U.current&&it.getTime()-U.current.getTime()<500)return!1;if(An!==null&&(w==="bottom"?An>0:An<0))return!0;if(Zt&&Zt.length>0)return!1;if(it.getTime()-((Kt=ne.current)==null?void 0:Kt.getTime())<d&&An===0||wt)return ne.current=it,!1;for(;jt;){if(jt.scrollHeight>jt.clientHeight){if(jt.scrollTop!==0)return ne.current=new Date,!1;if(jt.getAttribute("role")==="dialog")return!0}jt=jt.parentNode}return!0}function _t(lt){if(Fe.current&&M){const wt=w==="bottom"||w==="right"?1:-1,Nt=(Ae.current-(wa(w)?lt.pageY:lt.pageX))*wt,Kt=Nt>0,jt=s&&!u&&!Kt;if(jt&&Je===0)return;const Zt=Math.abs(Nt),An=document.querySelector("[data-vaul-drawer-wrapper]"),it=w==="bottom"||w==="top"?Q.current:$e.current;let ge=Zt/it;const De=Ce(Zt,Kt);if(De!==null&&(ge=De),jt&&ge>=1||!te.current&&!Qe(lt.target,Kt))return;if(Fe.current.classList.add($S),te.current=!0,ba(Fe.current,{transition:"none"}),ba(O.current,{transition:"none"}),s&&ve({draggedDistance:Nt}),Kt&&!s){const ze=ype(Nt),Bt=Math.min(ze*-1,0)*wt;ba(Fe.current,{transform:wa(w)?`translate3d(0, ${Bt}px, 0)`:`translate3d(${Bt}px, 0, 0)`});return}const Ke=1-ge;if((ke||p&&Je===p-1)&&(r==null||r(lt,ge),ba(O.current,{opacity:`${Ke}`,transition:"none"},!0)),An&&O.current&&o){const ze=Math.min(Ee()+ge*(1-Ee()),1),Bt=8-ge*8,Qt=Math.max(0,14-ge*14);ba(An,{borderRadius:`${Bt}px`,transform:wa(w)?`scale(${ze}) translate3d(0, ${Qt}px, 0)`:`scale(${ze}) translate3d(${Qt}px, 0, 0)`,transition:"none"},!0)}if(!s){const ze=Zt*wt;ba(Fe.current,{transform:wa(w)?`translate3d(0, ${ze}px, 0)`:`translate3d(${ze}px, 0, 0)`})}}}Ne.useEffect(()=>{var lt;function wt(){if(!Fe.current||!I)return;const Nt=document.activeElement;if(kC(Nt)||Se.current){var Kt;const jt=((Kt=window.visualViewport)==null?void 0:Kt.height)||0,Zt=window.innerHeight;let An=Zt-jt;const it=Fe.current.getBoundingClientRect().height||0,ge=it>Zt*.8;Le.current||(Le.current=it);const De=Fe.current.getBoundingClientRect().top;if(Math.abs(we.current-An)>60&&(Se.current=!Se.current),s&&s.length>0&&ee&&Je){const Ke=ee[Je]||0;An+=Ke}if(we.current=An,it>jt||Se.current){const Ke=Fe.current.getBoundingClientRect().height;let ze=Ke;Ke>jt&&(ze=jt-(ge?De:SC)),g?Fe.current.style.height=`${Ke-Math.max(An,0)}px`:Fe.current.style.height=`${Math.max(ze,jt-De)}px`}else Fe.current.style.height=`${Le.current}px`;s&&s.length>0&&!Se.current?Fe.current.style.bottom="0px":Fe.current.style.bottom=`${Math.max(An,0)}px`}}return(lt=window.visualViewport)==null||lt.addEventListener("resize",wt),()=>{var Nt;return(Nt=window.visualViewport)==null?void 0:Nt.removeEventListener("resize",wt)}},[Je,s,ee]);function $t(lt){tt(),y==null||y(),lt||q(!1),setTimeout(()=>{s&&le(s[0])},Lr.DURATION*1e3)}function Ve(){if(!Fe.current)return;const lt=document.querySelector("[data-vaul-drawer-wrapper]"),wt=qv(Fe.current,w);ba(Fe.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`}),ba(O.current,{transition:`opacity ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,opacity:"1"}),o&&wt&&wt>0&&B&&ba(lt,{borderRadius:`${v6}px`,overflow:"hidden",...wa(w)?{transform:`scale(${Ee()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ee()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Lr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Lr.EASE.join(",")})`},!0)}function tt(){!M||!Fe.current||(Fe.current.classList.remove($S),te.current=!1,X(!1),ce.current=new Date)}function yt(lt){if(!M||!Fe.current)return;Fe.current.classList.remove($S),te.current=!1,X(!1),ce.current=new Date;const wt=qv(Fe.current,w);if(!Qe(lt.target,!1)||!wt||Number.isNaN(wt)||K.current===null)return;const Nt=ce.current.getTime()-K.current.getTime(),Kt=Ae.current-(wa(w)?lt.pageY:lt.pageX),jt=Math.abs(Kt)/Nt;if(jt>.05&&(W(!0),setTimeout(()=>{W(!1)},200)),s){V({draggedDistance:Kt*(w==="bottom"||w==="right"?1:-1),closeDrawer:$t,velocity:jt,dismissible:u}),a==null||a(lt,!0);return}if(w==="bottom"||w==="right"?Kt>0:Kt<0){Ve(),a==null||a(lt,!0);return}if(jt>b6){$t(),a==null||a(lt,!1);return}var Zt;const An=Math.min((Zt=Fe.current.getBoundingClientRect().height)!=null?Zt:0,window.innerHeight);var it;const ge=Math.min((it=Fe.current.getBoundingClientRect().width)!=null?it:0,window.innerWidth),De=w==="left"||w==="right";if(Math.abs(wt)>=(De?ge:An)*c){$t(),a==null||a(lt,!1);return}a==null||a(lt,!0),Ve()}Ne.useEffect(()=>(B&&(ba(document.documentElement,{scrollBehavior:"auto"}),U.current=new Date),()=>{xpe(document.documentElement,"scrollBehavior")}),[B]);function ut(lt){const wt=lt?(window.innerWidth-Qu)/window.innerWidth:1,Nt=lt?-Qu:0;Te.current&&window.clearTimeout(Te.current),ba(Fe.current,{transition:`transform ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,transform:`scale(${wt}) translate3d(0, ${Nt}px, 0)`}),!lt&&Fe.current&&(Te.current=setTimeout(()=>{const Kt=qv(Fe.current,w);ba(Fe.current,{transition:"none",transform:wa(w)?`translate3d(0, ${Kt}px, 0)`:`translate3d(${Kt}px, 0, 0)`})},500))}function qt(lt,wt){if(wt<0)return;const Nt=(window.innerWidth-Qu)/window.innerWidth,Kt=Nt+wt*(1-Nt),jt=-Qu+wt*Qu;ba(Fe.current,{transform:wa(w)?`scale(${Kt}) translate3d(0, ${jt}px, 0)`:`scale(${Kt}) translate3d(${jt}px, 0, 0)`,transition:"none"})}function an(lt,wt){const Nt=wa(w)?window.innerHeight:window.innerWidth,Kt=wt?(Nt-Qu)/Nt:1,jt=wt?-Qu:0;wt&&ba(Fe.current,{transition:`transform ${Lr.DURATION}s cubic-bezier(${Lr.EASE.join(",")})`,transform:wa(w)?`scale(${Kt}) translate3d(0, ${jt}px, 0)`:`scale(${Kt}) translate3d(${jt}px, 0, 0)`})}return Ne.createElement(z_,{defaultOpen:k,onOpenChange:lt=>{!u&&!lt||(lt?L(!0):$t(!0),q(lt))},open:B},Ne.createElement(m6.Provider,{value:{activeSnapPoint:Ye,snapPoints:s,setActiveSnapPoint:le,drawerRef:Fe,overlayRef:O,onOpenChange:t,onPress:Ue,onRelease:yt,onDrag:_t,dismissible:u,handleOnly:h,isOpen:B,isDragging:M,shouldFade:ke,closeDrawer:$t,onNestedDrag:qt,onNestedOpenChange:ut,onNestedRelease:an,keyboardIsOpen:Se,modal:x,snapPointsOffset:ee,direction:w,shouldScaleBackground:o,setBackgroundColorOnScale:l,noBodyStyles:v,container:A,autoFocus:j}},n))}const k6=Ne.forwardRef(function({...e},t){const{overlayRef:n,snapPoints:r,onRelease:a,shouldFade:s,isOpen:o,modal:l}=yb(),c=x6(t,n),d=r&&r.length>0;return l?Ne.createElement(h1,{onMouseUp:a,ref:c,"data-vaul-overlay":"","data-vaul-snap-points":o&&d?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false",...e}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});k6.displayName="Drawer.Overlay";const S6=Ne.forwardRef(function({onPointerDownOutside:e,style:t,onOpenAutoFocus:n,...r},a){const{drawerRef:s,onPress:o,onRelease:l,onDrag:c,keyboardIsOpen:d,snapPointsOffset:u,modal:h,isOpen:p,direction:m,snapPoints:f,container:g,handleOnly:x,autoFocus:y}=yb(),[b,v]=Ne.useState(!1),w=x6(a,s),k=Ne.useRef(null),C=Ne.useRef(null),S=Ne.useRef(!1),_=f&&f.length>0;Cpe();const I=(A,j,D=0)=>{if(S.current)return!0;const F=Math.abs(A.y),B=Math.abs(A.x),q=B>F,$=["bottom","right"].includes(j)?1:-1;if(j==="left"||j==="right"){if(!(A.x*$<0)&&B>=0&&B<=D)return q}else if(!(A.y*$<0)&&F>=0&&F<=D)return!q;return S.current=!0,!0};Ne.useEffect(()=>{_&&window.requestAnimationFrame(()=>{v(!0)})},[]);function T(A){k.current=null,S.current=!1,l(A)}return Ne.createElement(p1,{"data-vaul-drawer-direction":m,"data-vaul-drawer":"","data-vaul-delayed-snap-points":b?"true":"false","data-vaul-snap-points":p&&_?"true":"false","data-vaul-custom-container":g?"true":"false",...r,ref:w,style:u&&u.length>0?{"--snap-point-height":`${u[0]}px`,...t}:t,onPointerDown:A=>{x||(r.onPointerDown==null||r.onPointerDown.call(r,A),k.current={x:A.pageX,y:A.pageY},o(A))},onOpenAutoFocus:A=>{n==null||n(A),y||A.preventDefault()},onPointerDownOutside:A=>{if(e==null||e(A),!h||A.defaultPrevented){A.preventDefault();return}d.current&&(d.current=!1)},onFocusOutside:A=>{if(!h){A.preventDefault();return}},onPointerMove:A=>{if(C.current=A,x||(r.onPointerMove==null||r.onPointerMove.call(r,A),!k.current))return;const j=A.pageY-k.current.y,D=A.pageX-k.current.x,F=A.pointerType==="touch"?10:2;I({x:D,y:j},m,F)?c(A):(Math.abs(D)>F||Math.abs(j)>F)&&(k.current=null)},onPointerUp:A=>{r.onPointerUp==null||r.onPointerUp.call(r,A),k.current=null,S.current=!1,l(A)},onPointerOut:A=>{r.onPointerOut==null||r.onPointerOut.call(r,A),T(C.current)},onContextMenu:A=>{r.onContextMenu==null||r.onContextMenu.call(r,A),T(C.current)}})});S6.displayName="Drawer.Content";const Ipe=250,Tpe=120,Epe=Ne.forwardRef(function({preventCycle:e=!1,children:t,...n},r){const{closeDrawer:a,isDragging:s,snapPoints:o,activeSnapPoint:l,setActiveSnapPoint:c,dismissible:d,handleOnly:u,isOpen:h,onPress:p,onDrag:m}=yb(),f=Ne.useRef(null),g=Ne.useRef(!1);function x(){if(g.current){v();return}window.setTimeout(()=>{y()},Tpe)}function y(){if(s||e||g.current){v();return}if(v(),(!o||o.length===0)&&d){a();return}if(l===o[o.length-1]&&d){a();return}const k=o.findIndex(S=>S===l);if(k===-1)return;const C=o[k+1];c(C)}function b(){f.current=window.setTimeout(()=>{g.current=!0},Ipe)}function v(){window.clearTimeout(f.current),g.current=!1}return Ne.createElement("div",{onClick:x,onPointerCancel:v,onPointerDown:w=>{u&&p(w),b()},onPointerMove:w=>{u&&m(w)},ref:r,"data-vaul-drawer-visible":h?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},Ne.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},t))});Epe.displayName="Drawer.Handle";function Ape(e){const t=yb(),{container:n=t.container,...r}=e;return Ne.createElement(O_,{container:n,...r})}const Ql={Root:jpe,Content:S6,Overlay:k6,Portal:Ape,Title:m1,Description:f1},C6=({shouldScaleBackground:e=!0,...t})=>i.jsx(Ql.Root,{shouldScaleBackground:e,...t});C6.displayName="Drawer";const Rpe=Ql.Portal,_6=N.forwardRef(({className:e,...t},n)=>i.jsx(Ql.Overlay,{ref:n,className:Ie("fixed inset-0 z-50 bg-black/80",e),...t}));_6.displayName=Ql.Overlay.displayName;const j6=N.forwardRef(({className:e,children:t,hideHandle:n,...r},a)=>i.jsxs(Rpe,{children:[i.jsx(_6,{}),i.jsxs(Ql.Content,{ref:a,className:Ie("fixed inset-x-0 bottom-0 z-50 flex flex-col rounded-t-[10px] border bg-background","max-h-[90dvh]",e),style:{paddingBottom:"env(safe-area-inset-bottom)"},...r,children:[!n&&i.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),t]})]}));j6.displayName="DrawerContent";const I6=({className:e,...t})=>i.jsx("div",{className:Ie("grid gap-1.5 p-4 text-center sm:text-left",e),...t});I6.displayName="DrawerHeader";const T6=N.forwardRef(({className:e,...t},n)=>i.jsx(Ql.Title,{ref:n,className:Ie("text-lg font-semibold leading-none tracking-tight",e),...t}));T6.displayName=Ql.Title.displayName;const Dpe=N.forwardRef(({className:e,...t},n)=>i.jsx(Ql.Description,{ref:n,className:Ie("text-sm text-muted-foreground",e),...t}));Dpe.displayName=Ql.Description.displayName;const Mpe="#6366f1",$pe=500;function Fpe({open:e,onOpenChange:t,contactId:n,tags:r,events:a,localContactTags:s,localContactEvents:o,onTagToggle:l,onEventToggle:c,onTagCreated:d,onTagUpdated:u,onTagDeleted:h}){const[p,m]=N.useState(!1),[f,g]=N.useState(""),[x,y]=N.useState(!1),[b,v]=N.useState(null),[w,k]=N.useState(""),[C,S]=N.useState(!1),[_,I]=N.useState(!1),T=N.useRef(null),A=N.useRef(!1),j=async()=>{if(!f.trim()){ie({title:"Tag name required",variant:"destructive"});return}if(r.find(M=>M.name.toLowerCase()===f.trim().toLowerCase())){ie({title:"Tag already exists",variant:"destructive"});return}y(!0);try{const M=await(d==null?void 0:d(f.trim(),Mpe));M&&(ie({title:"Tag created"}),n&&l(n,M.id),g(""),m(!1))}catch(M){ie({title:"Failed to create tag",description:M==null?void 0:M.message,variant:"destructive"})}finally{y(!1)}},D=L=>{A.current=!1,T.current=setTimeout(()=>{A.current=!0,v(L),k(L.name)},$pe)},F=()=>{T.current&&(clearTimeout(T.current),T.current=null)},B=L=>{!A.current&&n&&l(n,L.id),A.current=!1},q=async()=>{if(!b||!w.trim()){ie({title:"Tag name required",variant:"destructive"});return}if(r.find(M=>M.id!==b.id&&M.name.toLowerCase()===w.trim().toLowerCase())){ie({title:"Tag already exists",variant:"destructive"});return}S(!0);try{await(u==null?void 0:u(b.id,w.trim())),ie({title:"Tag updated"}),v(null),k("")}catch(M){ie({title:"Failed to update tag",description:M==null?void 0:M.message,variant:"destructive"})}finally{S(!1)}},$=async()=>{if(b){I(!0);try{await(h==null?void 0:h(b.id)),ie({title:"Tag deleted"}),v(null),k("")}catch(L){ie({title:"Failed to delete tag",description:L==null?void 0:L.message,variant:"destructive"})}finally{I(!1)}}};return i.jsxs(i.Fragment,{children:[i.jsx(vn,{open:e,onOpenChange:t,children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Manage Tags & Events"})}),n&&i.jsxs("div",{className:"space-y-5",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("p",{className:"text-sm font-medium",children:["Tags ",i.jsx("span",{className:"text-xs text-muted-foreground font-normal",children:"(long press to edit)"})]}),!p&&i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>m(!0),className:"h-7 text-xs",children:[i.jsx(fo,{className:"h-3.5 w-3.5 mr-1"}),"Add Tag"]})]}),p&&i.jsxs("div",{className:"mb-3 p-3 rounded-lg border border-border bg-muted/30 space-y-3",children:[i.jsx(At,{placeholder:"Tag name...",value:f,onChange:L=>g(L.target.value),className:"h-9",autoFocus:!0,onKeyDown:L=>{L.key==="Enter"&&j(),L.key==="Escape"&&(m(!1),g(""))}}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{variant:"outline",size:"sm",onClick:()=>{m(!1),g("")},disabled:x,className:"flex-1",children:"Cancel"}),i.jsx(de,{size:"sm",onClick:j,disabled:x||!f.trim(),className:"flex-1",children:x?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Create"})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.map(L=>{const M=s.includes(L.id);return i.jsx("button",{onClick:()=>B(L),onMouseDown:()=>D(L),onMouseUp:F,onMouseLeave:F,onTouchStart:()=>D(L),onTouchEnd:F,onTouchCancel:F,className:Ie("px-3 py-1.5 rounded-full text-sm border transition-all select-none",M?"bg-blue-50 dark:bg-blue-950/40 border-blue-200 dark:border-blue-800 underline underline-offset-2 decoration-blue-500":"border-border hover:border-primary/50 bg-background"),children:L.name},L.id)}),r.length===0&&!p&&i.jsx("p",{className:"text-sm text-muted-foreground",children:"No tags yet"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-medium mb-2",children:"Events"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.map(L=>{const M=o.includes(L.id);return i.jsx("button",{onClick:()=>c(n,L.id),className:Ie("px-3 py-1.5 rounded-full text-sm border transition-all",M?"bg-blue-50 dark:bg-blue-950/40 border-blue-200 dark:border-blue-800 underline underline-offset-2 decoration-blue-500":"border-border hover:border-accent/50 bg-background"),children:L.title},L.id)}),a.length===0&&i.jsx("p",{className:"text-sm text-muted-foreground",children:"No events created"})]})]})]})]})}),i.jsx(vn,{open:!!b,onOpenChange:L=>!L&&v(null),children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Edit Tag"})}),i.jsxs("div",{className:"space-y-4 py-2",children:[i.jsx(At,{placeholder:"Tag name...",value:w,onChange:L=>k(L.target.value),className:"h-10",autoFocus:!0,onKeyDown:L=>{L.key==="Enter"&&q(),L.key==="Escape"&&v(null)}}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{variant:"destructive",size:"sm",onClick:$,disabled:C||_,className:"flex-1",children:_?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(ti,{className:"h-4 w-4 mr-1.5"}),"Delete"]})}),i.jsx(de,{size:"sm",onClick:q,disabled:C||_||!w.trim(),className:"flex-1",children:C?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):"Save"})]})]})]})})]})}const Ppe=(e,t)=>{const[n,r]=N.useState(t??null);return N.useEffect(()=>{if(!e)return;let a=!1;(async()=>{const{data:l}=await ue.from("cards").select("photo_url").eq("id",e).maybeSingle();!a&&(l==null?void 0:l.photo_url)!==n&&r((l==null?void 0:l.photo_url)??null)})();const o=ue.channel(`card-avatar-${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"cards",filter:`id=eq.${e}`},l=>{var c;r(((c=l.new)==null?void 0:c.photo_url)??null)}).subscribe();return()=>{a=!0,ue.removeChannel(o)}},[e]),n},Ope=e=>{if(!e)return"?";const t=e.trim().split(/\s+/);return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():e.substring(0,2).toUpperCase()},S3={sm:"w-10 h-10 text-sm",md:"w-16 h-16 text-lg",lg:"w-24 h-24 text-2xl"},Lpe="bg-[#F2F2F7]",zpe="text-[#1C1C1E]",Kv=N.memo(function({name:t,photoUrl:n,sharedCardId:r,size:a="sm",className:s}){const[o,l]=N.useState(!1),c=Ppe(r,n),d=r?c??n:n;N.useEffect(()=>{l(!1)},[d]);const u=Ope(t);return!d||o?i.jsx("div",{className:Ie("rounded-full flex items-center justify-center font-medium flex-shrink-0",Lpe,zpe,S3[a],s),children:u}):i.jsx("img",{src:d,alt:t,className:Ie("rounded-full object-cover flex-shrink-0",S3[a],s),onError:()=>l(!0)})});function FS({open:e,onClose:t,title:n,children:r,className:a,showCloseButton:s=!0,maxHeight:o="88dvh"}){return typeof document>"u"?null:wh.createPortal(i.jsxs(i.Fragment,{children:[i.jsx("div",{className:Ie("fixed inset-0 z-[1000] bg-black/30 transition-opacity duration-300",e?"opacity-100":"opacity-0 pointer-events-none"),onClick:t,onTouchMove:l=>l.preventDefault(),style:{touchAction:"none"}}),i.jsx("div",{className:Ie("fixed inset-x-0 bottom-0 z-[1001] flex justify-center pointer-events-none"),children:i.jsxs("div",{className:Ie("w-full max-w-md bg-background rounded-t-3xl shadow-2xl pointer-events-auto overflow-hidden","transform transition-all duration-300 ease-[cubic-bezier(0.22,1,0.36,1)]",e?"translate-y-0 opacity-100":"translate-y-full opacity-0",a),style:{maxHeight:o},children:[i.jsx("div",{className:"flex justify-center py-3",children:i.jsx("div",{className:"h-1.5 w-12 rounded-full bg-muted-foreground/30"})}),(n||s)&&i.jsxs("div",{className:"flex items-center justify-between px-6 pb-3",children:[n&&i.jsx("h2",{className:"text-xl font-semibold",children:n}),s&&i.jsx("button",{onClick:t,className:"h-8 w-8 rounded-full bg-muted flex items-center justify-center active:scale-95",children:i.jsx(ui,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"overflow-y-auto px-6 pb-6",style:{WebkitOverflowScrolling:"touch",maxHeight:`calc(${o} - 80px)`,paddingBottom:"env(safe-area-inset-bottom)"},children:r})]})})]}),document.body)}const C3=["name","company","designation","email","phone","whatsapp","linkedin","website","about","source","created_at"];function Bpe(e){const t=C3.join(","),n=e.map(r=>C3.map(a=>{const s=r[a];if(s==null)return"";const o=String(s);return o.includes(",")||o.includes('"')||o.includes(`
`)?`"${o.replace(/"/g,'""')}"`:o}).join(","));return[t,...n].join(`
`)}function Wpe(e,t="contacts.csv"){try{const n=Bpe(e),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),s=document.createElement("a");return s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),!0}catch(n){return console.error("CSV download failed:",n),!1}}function Upe(e){const t=e.split(/\r?\n/).filter(l=>l.trim());if(t.length<2)return[];const n=t[0],r=_3(n).map(l=>l.toLowerCase().trim()),a={name:"name","full name":"name",fullname:"name","contact name":"name",company:"company","company name":"company",organization:"company",designation:"designation",title:"designation","job title":"designation",role:"designation",position:"designation",email:"email","email address":"email","e-mail":"email",phone:"phone","phone number":"phone",mobile:"phone","mobile number":"phone",telephone:"phone",whatsapp:"whatsapp","whatsapp number":"whatsapp",linkedin:"linkedin","linkedin url":"linkedin",website:"website",web:"website",url:"website"},s=[];r.forEach((l,c)=>{const d=a[l];d&&s.push({index:c,field:d})});const o=[];for(let l=1;l<t.length;l++){const c=_3(t[l]),d={};s.forEach(({index:u,field:h})=>{c[u]&&(d[h]=c[u].trim())}),d.name&&o.push(d)}return o}function _3(e){const t=[];let n="",r=!1;for(let a=0;a<e.length;a++){const s=e[a],o=e[a+1];r?s==='"'&&o==='"'?(n+='"',a++):s==='"'?r=!1:n+=s:s==='"'?r=!0:s===","?(t.push(n),n=""):n+=s}return t.push(n),t}function Vpe(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>n(new Error("Failed to read file")),r.readAsText(e)})}function Hpe(){const n=`name,company,designation,email,phone,whatsapp,linkedin,website
John Doe,Acme Inc,CEO,john@acme.com,+919876543210,+919876543210,johndoe,www.acme.com`,r=new Blob([n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download="contacts_template.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}const Gpe="https://synka.in",Ju="pending_crm_interaction",_x="crm_returning_from_interaction";function qpe(){var tD,nD,rD,aD,sD;const e=Pa(),t=tI(),{user:n,loading:r}=or(),{profile:a}=hl(),{contacts:s,loading:o,createContact:l,updateContact:c,deleteContact:d,addTagToContact:u,removeTagFromContact:h,addEventToContact:p,refetch:m}=moe(),[f,g]=N.useState(s),{tags:x,createTag:y,updateTag:b,deleteTag:v}=uB(),{events:w,getActiveEventsForDate:k}=fI(),{getEmailTemplates:C,getWhatsappTemplates:S}=pB(),{getSelectedSignature:_}=fB(),[I,T]=N.useState(!1),A=N.useRef(null),j=N.useRef(0),D=N.useRef(0),[F,B]=N.useState(0),[q,$]=N.useState(!1),[L,M]=N.useState(""),[X,G]=N.useState(!1),[W,O]=N.useState(!1),[U,K]=N.useState(!1),[ce,ne]=N.useState("All"),[te,Te]=N.useState([]),[Ae,Se]=N.useState([]),[we,Fe]=N.useState(()=>localStorage.getItem("crm_sort_by")||"date"),[Q,$e]=N.useState(null),[Le,Xe]=N.useState(!1),[Ye,Je]=N.useState(!1),[le,V]=N.useState({firstName:"",lastName:"",company:"",designation:"",phone:"",email:"",whatsapp:"",linkedin:"",website:"",notes:"",tags:[]}),[ee,ve]=N.useState(null),[ke,Ce]=N.useState(!1),be=N.useRef(!1),Ee=N.useRef(null);N.useEffect(()=>{var P;if(Q&&!Ye){const{firstName:Z,lastName:xe}=Bx(Q.name||"");V({firstName:Z,lastName:xe,company:Q.company||"",designation:Q.designation||"",phone:Q.phone||"",email:Q.email||"",whatsapp:Q.whatsapp||"",linkedin:Q.linkedin||"",website:Q.website||"",notes:"",tags:((P=Q.tags)==null?void 0:P.map(at=>at.id))||[]})}},[Q,Ye]);function Ue(P,Z){V(xe=>({...xe,[P]:Z}))}async function Qe(){var Z;if(!(Q!=null&&Q.id))return;if(!((Z=le.firstName)!=null&&Z.trim())){ve("First name is required");return}const P=Cw({email:le.email,phone:le.phone,website:le.website,linkedin:le.linkedin});if(P){ie({title:P.message,variant:"destructive"});return}Ce(!0),ve(null);try{const xe=_w({email:le.email,phone:le.phone,whatsapp:le.whatsapp,website:le.website,linkedin:le.linkedin}),at={name:Hc(le.firstName,le.lastName),company:le.company||null,designation:le.designation||null,phone:xe.phone||null,email:xe.email||null,whatsapp:xe.whatsapp||null,linkedin:xe.linkedin||null,website:xe.website||null},{error:ct}=await c(Q.id,at);if(ct)throw ct;$e(Mt=>Mt?{...Mt,...at}:null),g(Mt=>Mt.map(Ft=>Ft.id===Q.id?{...Ft,...at}:Ft)),Je(!1),ie({title:"Contact updated"})}catch(xe){console.error("Update error",xe),ve((xe==null?void 0:xe.message)||"Update failed")}finally{Ce(!1)}}const _t=P=>{Ye||(j.current=P.touches[0].clientY,$(!0))},$t=P=>{if(!q||Ye)return;D.current=P.touches[0].clientY;const Z=D.current-j.current;Z>0&&B(Z)},Ve=()=>{q&&($(!1),F>120&&(Xe(!1),Je(!1)),B(0))},[tt,yt]=N.useState(!1),[ut,qt]=N.useState(""),[an,lt]=N.useState([]),[wt,Nt]=N.useState({open:!1,index:-1,systemText:"",userText:""}),Kt=["WhatsApp Sent","Email Sent","Call Made"],jt=P=>{for(const Z of Kt)if(P.startsWith(Z)){const xe=P.slice(Z.length);return xe.startsWith(" - ")?{systemText:Z,userText:xe.slice(3)}:{systemText:Z,userText:""}}return{systemText:"",userText:P}};N.useEffect(()=>{Q!=null&&Q.notes_history?lt(Q.notes_history):lt([])},[Q]);const Zt=async()=>{if(!ut.trim()){ie({title:"Note cannot be empty",variant:"destructive"});return}if(!(Q!=null&&Q.id))return;const Z=[{text:ut,timestamp:new Date().toISOString()},...an],{error:xe}=await c(Q.id,{notes_history:Z});xe||(lt(Z),qt(""),yt(!1),ie({title:"Note added"}))},[An,it]=N.useState(!1),[ge,De]=N.useState(!1),[Ke,ze]=N.useState(!1),[Bt,Qt]=N.useState(null),[rt,gt]=N.useState(!1),[en,br]=N.useState("email"),[vr,js]=N.useState(null),[Mr,La]=N.useState([]),[qn,fa]=N.useState([]),[xr,Ki]=N.useState(null),[is,yi]=N.useState(!1),[ft,pe]=N.useState(""),[Pe,dt]=N.useState(!1),[On,cr]=N.useState(!1),[Wn,wr]=N.useState("");N.useEffect(()=>{var P,Z;Q&&Ke&&(La(((P=Q.tags)==null?void 0:P.map(xe=>xe.id))||[]),fa(((Z=Q.events)==null?void 0:Z.map(xe=>xe.id))||[]))},[Q,Ke]);const[za,Is]=N.useState(!1),[_n,fn]=N.useState(null),[Ts,bi]=N.useState(null),[tm,Uu]=N.useState(!1),Yi=N.useRef(null),oc=N.useRef(null),Vu=N.useRef(null),Hu=N.useRef(null),Qs=N.useRef(null),Gu=typeof navigator<"u"&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&!Xt.isNativePlatform(),qu=N.useRef(null),[Ku,vi]=N.useState(!1),[nm,lc]=N.useState(!1),[Js,wi]=N.useState([]),yl=((tD=a==null?void 0:a.plan)==null?void 0:tD.toLowerCase())==="orange",[Eo,ra]=N.useState({open:!1,title:"",description:"",onConfirm:()=>{}}),[Lt,tr]=N.useState({firstName:"",lastName:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:"",notes:""});N.useEffect(()=>{!r&&!n&&e("/login")},[n,r,e]),N.useEffect(()=>{const P=An||ge||rt||tt||Le;if(P&&t)T(!0),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden";else if(!P){document.body.style.overflow="",document.documentElement.style.overflow="";const Z=setTimeout(()=>T(!1),300);return()=>clearTimeout(Z)}return()=>{P||(document.body.style.overflow="",document.documentElement.style.overflow="")}},[An,ge,rt,tt,Le,t]),N.useEffect(()=>{if(localStorage.getItem(_x)){localStorage.removeItem(_x);return}s!==f&&g(s)},[s]);const Yu=N.useCallback(()=>{try{const P=localStorage.getItem(Ju);if(!P)return;const Z=JSON.parse(P);Date.now()-new Date(Z.timestamp).getTime()<24*60*60*1e3?(Ki(Z),yi(!0)):localStorage.removeItem(Ju)}catch{localStorage.removeItem(Ju)}},[]);N.useEffect(()=>{const P=()=>{if(!be.current){be.current=!0;return}Yu()};return window.addEventListener("focus",P),()=>{window.removeEventListener("focus",P)}},[Yu]);const Ao=(P,Z)=>{const xe={contactId:P.id,contactName:P.name,interactionType:Z,timestamp:new Date().toISOString()};localStorage.setItem(Ju,JSON.stringify(xe))},os=()=>{localStorage.removeItem(Ju),Ki(null),yi(!1),dt(!1),pe(""),cr(!1),wr("")},bl=async()=>{if(localStorage.removeItem(Ju),!xr)return;const P=f.find(Ft=>Ft.id===xr.contactId);if(!P){os();return}const Z=xr.interactionType==="whatsapp"?"WhatsApp Sent":xr.interactionType==="email"?"Email Sent":"Call Made",xe={text:Z,timestamp:new Date().toISOString()},at=P.notes_history||[],ct=[xe,...at],{error:Mt}=await c(P.id,{notes_history:ct});Mt?(ie({title:"Failed to save note",variant:"destructive"}),os()):(lt(ct),$e(Ft=>Ft&&Ft.id===P.id?{...Ft,notes_history:ct}:Ft),g(Ft=>Ft.map(Ra=>Ra.id===P.id?{...Ra,notes_history:ct,updated_at:new Date().toISOString()}:Ra)),cr(!0),wr(Z),pe(""),dt(!0),yi(!1))},vl=()=>{localStorage.removeItem(Ju),cr(!1),wr(""),pe(""),dt(!0),yi(!1)},re=async()=>{if(!xr){os();return}const P=f.find(Z=>Z.id===xr.contactId);if(!P){os();return}if(On&&Wn){const Z=P.notes_history||[];if(Z.length>0){const xe=[...Z],at=ft.trim()?`${Wn} - ${ft.trim()}`:Wn;xe[0]={...xe[0],text:at};const{error:ct}=await c(P.id,{notes_history:xe});ct||(g(Mt=>Mt.map(Ft=>Ft.id===P.id?{...Ft,notes_history:xe}:Ft)),lt(xe),$e(Mt=>Mt&&Mt.id===P.id?{...Mt,notes_history:xe}:Mt),ft.trim()&&ie({title:"Note updated"}))}}else if(!On&&ft.trim()){const Z={text:ft.trim(),timestamp:new Date().toISOString()},xe=P.notes_history||[],at=[Z,...xe],{error:ct}=await c(P.id,{notes_history:at});ct||(g(Mt=>Mt.map(Ft=>Ft.id===P.id?{...Ft,notes_history:at,updated_at:new Date().toISOString()}:Ft)),ie({title:"Note added"}))}os()},Be=()=>{os()},jn=P=>{var ct;const Z=P.notes_history,xe=(ct=Z==null?void 0:Z[0])!=null&&ct.timestamp?new Date(Z[0].timestamp):null,at=new Date(P.updated_at);return xe&&xe>at?xe:at},Kn=f.filter(P=>{var Mt,Ft,Ra,rm;const Z=P.name.toLowerCase().includes(L.toLowerCase())||((Mt=P.company)==null?void 0:Mt.toLowerCase().includes(L.toLowerCase()))||((Ft=P.email)==null?void 0:Ft.toLowerCase().includes(L.toLowerCase())),xe=te.length===0||((Ra=P.tags)==null?void 0:Ra.some(ux=>te.includes(ux.id))),at=Ae.length===0||((rm=P.events)==null?void 0:rm.some(ux=>Ae.includes(ux.id)));let ct=!0;if(ce!=="All"){const ux=parseInt(ce),yk=new Date;yk.setDate(yk.getDate()-ux),ct=new Date(P.created_at)>=yk}return Z&&xe&&at&&ct}).sort((P,Z)=>{switch(we){case"name":return P.name.localeCompare(Z.name);case"date":return new Date(Z.created_at).getTime()-new Date(P.created_at).getTime();case"last_interaction":return jn(Z).getTime()-jn(P).getTime();default:return 0}}),J=P=>{const Z=new Date(P),xe=new Date,at=Z.getDate()===xe.getDate()&&Z.getMonth()===xe.getMonth()&&Z.getFullYear()===xe.getFullYear(),ct=new Date;ct.setDate(xe.getDate()-1);const Mt=Z.getDate()===ct.getDate()&&Z.getMonth()===ct.getMonth()&&Z.getFullYear()===ct.getFullYear(),Ft=Z.toLocaleString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!0});return at?`Today, ${Ft}`:Mt?`Yesterday, ${Ft}`:Z.getFullYear()===xe.getFullYear()?Z.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",hour12:!0}):Z.toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})},je=P=>{const Z=new Date(P),xe=new Date,at=Z.getDate()===xe.getDate()&&Z.getMonth()===xe.getMonth()&&Z.getFullYear()===xe.getFullYear(),ct=new Date;ct.setDate(xe.getDate()-1);const Mt=Z.getDate()===ct.getDate()&&Z.getMonth()===ct.getMonth()&&Z.getFullYear()===ct.getFullYear();return at?"Today":Mt?"Yesterday":Z.getFullYear()===xe.getFullYear()?Z.toLocaleDateString("en-IN",{day:"2-digit",month:"short"}):Z.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})},Ge=P=>{const Z=new Date(P),xe=new Date,at=new Date(xe.getFullYear(),xe.getMonth(),xe.getDate()),ct=new Date(at);ct.setDate(ct.getDate()-1);const Mt=new Date(at);Mt.setDate(at.getDate()-at.getDay());const Ft=new Date(Mt);Ft.setDate(Ft.getDate()-7);const Ra=new Date(xe.getFullYear(),xe.getMonth(),1);return Z>=at?"TODAY":Z>=ct?"YESTERDAY":Z>=Mt?"THIS WEEK":Z>=Ft?"LAST WEEK":Z>=Ra?"THIS MONTH":"OLDER"},zt=["TODAY","YESTERDAY","THIS WEEK","LAST WEEK","THIS MONTH","OLDER"],Wt=async()=>{if(!Lt.firstName.trim()){ie({title:"First name is required",variant:"destructive"});return}const P=Cw({email:Lt.email,phone:Lt.phone,website:Lt.website,linkedin:Lt.linkedin});if(P){ie({title:P.message,variant:"destructive"});return}const Z=_w({email:Lt.email,phone:Lt.phone,whatsapp:Lt.whatsapp,website:Lt.website,linkedin:Lt.linkedin}),at=k(new Date).map(Mt=>Mt.id),{error:ct}=await l({name:Hc(Lt.firstName,Lt.lastName),company:Lt.company,designation:Lt.designation,notes:Lt.notes,...Z,phone:Z.phone||Z.whatsapp||null,whatsapp:Z.whatsapp||Z.phone||null},at);ct?ie({title:"Error creating contact",variant:"destructive"}):(it(!1),tr({firstName:"",lastName:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:"",notes:""}),ie({title:"Contact added!"}))},Jt=N.useCallback(async()=>{const{shouldUseNativeCamera:P,takePhoto:Z}=await bo(async()=>{const{shouldUseNativeCamera:xe,takePhoto:at}=await import("./nativeCamera-CBMP6As-.js");return{shouldUseNativeCamera:xe,takePhoto:at}},__vite__mapDeps([9,1,2,3]));if(P()){const xe=await Z();if(xe.error==="cancelled")return;if(!xe.success){ie({title:"Camera error",description:xe.error||"Could not capture image.",variant:"destructive"});return}xe.base64&&bi(`data:image/jpeg;base64,${xe.base64}`);return}if(Gu&&Hu.current){Hu.current.click();return}try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){ie({title:"Camera not supported",description:"Your browser does not support camera access.",variant:"destructive"});return}const xe=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});Qs.current=xe,Uu(!0),await new Promise(ct=>{const Mt=()=>{Yi.current?ct():requestAnimationFrame(Mt)};Mt()}),Yi.current&&(Yi.current.srcObject=xe,await Yi.current.play())}catch(xe){console.error("Camera access error:",xe),Uu(!1),xe.name==="NotAllowedError"?ie({title:"Camera access denied",description:"Please allow camera access in your browser settings.",variant:"destructive"}):xe.name==="NotFoundError"?ie({title:"No camera found",description:"Please connect a camera and try again.",variant:"destructive"}):ie({title:"Camera error",description:xe.message||"Could not access camera.",variant:"destructive"})}},[Gu]),et=P=>{var xe;const Z=(xe=P.target.files)==null?void 0:xe[0];if(Z){const at=new FileReader;at.onload=ct=>{var Ft;const Mt=(Ft=ct.target)==null?void 0:Ft.result;bi(Mt)},at.readAsDataURL(Z)}P.target.value=""},bt=N.useCallback(()=>{Qs.current&&(Qs.current.getTracks().forEach(P=>P.stop()),Qs.current=null),Uu(!1)},[]),jr=N.useCallback(()=>{if(Yi.current&&oc.current){const P=Yi.current,Z=oc.current;Z.width=P.videoWidth,Z.height=P.videoHeight;const xe=Z.getContext("2d");if(xe){xe.drawImage(P,0,0);const at=Z.toDataURL("image/jpeg",.8);bi(at),bt()}}},[bt]),ls=P=>{var xe;const Z=(xe=P.target.files)==null?void 0:xe[0];if(Z){const at=new FileReader;at.onload=ct=>{var Ft;const Mt=(Ft=ct.target)==null?void 0:Ft.result;bi(Mt),bt()},at.readAsDataURL(Z)}},Xi=async()=>{if(Ts){Is(!0);try{const{data:P,error:Z}=await ue.functions.invoke("scan-business-card",{body:{image:Ts}});if(Z)throw console.error("AI scan error:",Z),Z;if(P!=null&&P.success&&(P!=null&&P.contact)){const xe=P.contact;if(Object.entries(xe).filter(([ct])=>ct!=="source").some(([,ct])=>ct!=null&&ct!=="")){const{firstName:ct,lastName:Mt}=Bx(xe.name||"");fn({...xe,firstName:ct,lastName:Mt});const Ft=xe.source==="qr"?" (from QR)":xe.source==="mixed"?" (QR + text)":"";ie({title:"Card scanned!"+Ft,description:"Review the extracted information."})}else fn({firstName:"",lastName:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),ie({title:"Couldn't read this card clearly",description:"Please fill in the details manually.",variant:"destructive"})}else fn({firstName:"",lastName:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),ie({title:"Couldn't read this card",description:"Please fill in manually.",variant:"destructive"})}catch(P){console.error("Scan error:",P),fn({firstName:"",lastName:"",company:"",designation:"",email:"",phone:"",whatsapp:"",linkedin:"",website:""}),ie({title:"Couldn't read this card",description:"Please fill in manually.",variant:"destructive"})}finally{Is(!1)}}},Xu=()=>{bi(null),fn(null),Is(!1)},lx=async()=>{var Ft;if(!((Ft=_n==null?void 0:_n.firstName)!=null&&Ft.trim())){ie({title:"First name is required",variant:"destructive"});return}const P=Hc(_n.firstName||"",_n.lastName||""),Z=Cw({email:_n.email,phone:_n.phone,website:_n.website,linkedin:_n.linkedin});if(Z){ie({title:Z.message,variant:"destructive"});return}const xe=_w({email:_n.email,phone:_n.phone,whatsapp:_n.whatsapp||_n.phone,website:_n.website,linkedin:_n.linkedin}),ct=k(new Date).map(Ra=>Ra.id),{error:Mt}=await l({name:P,company:_n.company||null,designation:_n.designation||null,email:xe.email||null,phone:xe.phone||null,whatsapp:xe.whatsapp||xe.phone||null,linkedin:xe.linkedin||null,website:xe.website||null,notes:_n.notes||null},ct);Mt?ie({title:"Error saving contact",variant:"destructive"}):(De(!1),Xu(),ie({title:"Contact saved!"}))};N.useEffect(()=>{ge||(bt(),Xu())},[ge,bt]);const gk=async(P,Z)=>{const xe=Mr.includes(Z),at=Mr,ct=xe?Mr.filter(Mt=>Mt!==Z):[...Mr,Z];La(ct);try{if(xe?await h(P,Z):await u(P,Z),(Q==null?void 0:Q.id)===P){const Mt=ct.map(Ft=>x.find(Ra=>Ra.id===Ft)).filter(Boolean);$e(Ft=>({...Ft,tags:Mt}))}g(Mt=>Mt.map(Ft=>Ft.id===P?{...Ft,tags:ct.map(Ra=>x.find(rm=>rm.id===Ra)).filter(Boolean)}:Ft))}catch{La(at),ie({title:"Failed to update tag",variant:"destructive"})}},cs=async(P,Z)=>{const xe=qn.includes(Z),at=qn,ct=xe?qn.filter(Mt=>Mt!==Z):[...qn,Z];fa(ct);try{if(xe?await ue.from("contact_events").delete().eq("contact_id",P).eq("event_id",Z):await p(P,Z),(Q==null?void 0:Q.id)===P){const Mt=ct.map(Ft=>w.find(Ra=>Ra.id===Ft)).filter(Boolean);$e(Ft=>({...Ft,events:Mt}))}g(Mt=>Mt.map(Ft=>Ft.id===P?{...Ft,events:ct.map(Ra=>w.find(rm=>rm.id===Ra)).filter(Boolean)}:Ft))}catch{fa(at),ie({title:"Failed to update event",variant:"destructive"})}},wl=(P,Z)=>{const xe=a!=null&&a.public_slug?`${Gpe}/u/${a.public_slug}`:"",at=ct=>{let Mt=ct.replace(/{{name}}/g,Z.name||"").replace(/{{company}}/g,Z.company||"").replace(/{{designation}}/g,Z.designation||"").replace(/{{myName}}/g,(a==null?void 0:a.name)||"").replace(/{{myCompany}}/g,(a==null?void 0:a.company)||"").replace(/{{myCardLink}}/g,xe);return Mt=Mt.replace(/\n{3,}/g,`

`),Mt};return{body:at(P.body),subject:P.subject?at(P.subject):`Hello ${Z.name}`}},cx=P=>{br("email"),js(P),gt(!0)},ZR=P=>{br("whatsapp"),js(P),gt(!0)},Cv=(P,Z)=>{if(!P.email){ie({title:"No email address",variant:"destructive"});return}const xe=Z?wl(Z,P):{body:"",subject:`Hello ${P.name}`},at=_();let ct=xe.body;if(at!=null&&at.html){const Mt=at.html.replace(/<br\s*\/?>/gi,`
`).replace(/<\/?(div|p|td|tr|table)[^>]*>/gi,`
`).replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").replace(/\n\s*\n/g,`

`).trim();ct=`${ct}

---
${Mt}`}Ao(P,"email"),localStorage.setItem(_x,"1"),window.location.href=`mailto:${P.email}?subject=${encodeURIComponent(xe.subject)}&body=${encodeURIComponent(ct)}`,gt(!1)},OY=(P,Z)=>{const xe=P.replace(/\D/g,""),ct=`https://api.whatsapp.com/send?phone=${xe.length===10?`91${xe}`:xe}`;return Z?`${ct}&text=${encodeURIComponent(Z)}`:ct},_v=(P,Z)=>{const xe=P.whatsapp||P.phone;if(!xe){ie({title:"No WhatsApp number",variant:"destructive"});return}const at=Z?wl(Z,P):{body:""};Ao(P,"whatsapp"),localStorage.setItem(_x,"1"),window.open(OY(xe,at.body),"_blank"),gt(!1)},QR=P=>{if(!P.phone){ie({title:"No phone number",variant:"destructive"});return}Ao(P,"call"),localStorage.setItem(_x,"1"),window.location.href=`tel:${P.phone}`},JR=N.useMemo(()=>{if(we==="name")return null;const P={TODAY:[],YESTERDAY:[],"THIS WEEK":[],"LAST WEEK":[],"THIS MONTH":[],OLDER:[]};return Kn.forEach(Z=>{const xe=we==="last_interaction"?jn(Z).toISOString():Z.created_at,at=Ge(xe);P[at].push(Z)}),P},[Kn,we]);if(r||!s&&o)return null;const eD=P=>{Zn.light(),$e(P),Xe(!0),Je(!1)},xk=P=>{Zn.light(),Fe(P),localStorage.setItem("crm_sort_by",P)},LY=()=>{if(!yl){Zn.light(),e("/settings/upgrade");return}Zn.light();const P=`synka_contacts_${new Date().toISOString().split("T")[0]}.csv`,Z=Wpe(f,P);ie(Z?{title:`Exported ${f.length} contacts`}:{title:"Export failed",variant:"destructive"})},zY=()=>{var P;if(!yl){Zn.light(),e("/settings/upgrade");return}Zn.light(),(P=qu.current)==null||P.click()},BY=async P=>{var xe;const Z=(xe=P.target.files)==null?void 0:xe[0];if(Z){P.target.value="";try{vi(!0);const at=await Vpe(Z),ct=Upe(at);if(ct.length===0){ie({title:"No valid contacts found",description:'Make sure your CSV has a "name" column',variant:"destructive"});return}wi(ct),lc(!0)}catch{ie({title:"Failed to read file",variant:"destructive"})}finally{vi(!1)}}},WY=async()=>{vi(!0);let P=0,Z=0;for(const xe of Js){const{error:at}=await l({name:xe.name||"",company:xe.company||null,designation:xe.designation||null,email:xe.email||null,phone:xe.phone||null,whatsapp:xe.whatsapp||xe.phone||null,linkedin:xe.linkedin||null,website:xe.website||null,source:"csv_import"});at?Z++:P++}vi(!1),lc(!1),wi([]),m(),P>0&&Z===0?ie({title:`Imported ${P} contacts successfully`}):P>0&&Z>0?ie({title:`Imported ${P}, Failed ${Z}`,variant:"destructive"}):ie({title:"Import failed",variant:"destructive"})};return i.jsxs("div",{className:"min-h-dvh w-full max-w-full overflow-x-hidden bg-background font-inter",children:[i.jsx("div",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur-xl border-b border-border/30",children:i.jsxs("div",{className:"w-full py-3 sm:py-4 px-3 sm:px-4 md:px-6 max-w-7xl mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h1",{className:"text-[20px] font-semibold text-foreground tracking-tight font-inter",children:"Contacts"}),i.jsxs("div",{className:"flex gap-1.5",children:[i.jsx(de,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-muted-foreground hover:text-foreground",onClick:()=>{Zn.light(),De(!0)},"aria-label":"Scan business card",children:i.jsx(pD,{className:"h-[18px] w-[18px]",strokeWidth:1.5})}),i.jsx(de,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full text-primary",onClick:()=>{Zn.light(),it(!0)},"aria-label":"Add contact",children:i.jsx(fo,{className:"h-5 w-5",strokeWidth:2})})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/60"}),i.jsx(At,{placeholder:"Search",value:L,onChange:P=>M(P.target.value),className:"pl-9 pr-20 h-9 bg-secondary/50 border-0 rounded-xl text-[15px] placeholder:text-muted-foreground/50 focus-visible:ring-1 focus-visible:ring-border"})]}),i.jsxs(Gw,{children:[i.jsx(qw,{asChild:!0,children:i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>Zn.light(),className:"h-9 w-9 rounded-xl text-muted-foreground hover:text-foreground",children:i.jsx(xX,{className:"h-4 w-4",strokeWidth:1.5})})}),i.jsxs(_y,{align:"end",className:"w-52",children:[i.jsxs(fc,{onClick:()=>xk("name"),children:["Sort by Name",we==="name"&&i.jsx(dn,{className:"ml-auto h-4 w-4 text-primary"})]}),i.jsxs(fc,{onClick:()=>xk("date"),children:["Date Added",we==="date"&&i.jsx(dn,{className:"ml-auto h-4 w-4 text-primary"})]}),i.jsxs(fc,{onClick:()=>xk("last_interaction"),children:["Last Interaction",we==="last_interaction"&&i.jsx(dn,{className:"ml-auto h-4 w-4 text-primary"})]}),i.jsx(jm,{}),i.jsxs(fc,{onClick:zY,className:"gap-2",children:[i.jsx(IX,{className:"h-4 w-4"}),"Import Contacts",!yl&&i.jsx(mo,{className:"ml-auto h-3.5 w-3.5 text-muted-foreground"})]}),i.jsxs(fc,{onClick:LY,className:"gap-2",children:[i.jsx(Od,{className:"h-4 w-4"}),"Export Contacts",!yl&&i.jsx(mo,{className:"ml-auto h-3.5 w-3.5 text-muted-foreground"})]})]})]}),i.jsxs(Gw,{open:U,onOpenChange:K,children:[i.jsx(qw,{asChild:!0,children:i.jsxs("div",{className:"relative",children:[i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>Zn.light(),className:Ie("h-9 w-9 rounded-xl",te.length>0||Ae.length>0?"text-primary":"text-muted-foreground hover:text-foreground"),children:i.jsx(TX,{className:"h-4 w-4",strokeWidth:1.5})}),(te.length>0||Ae.length>0)&&i.jsx("span",{className:"absolute top-2 right-2 h-1.5 w-1.5 rounded-full bg-primary"})]})}),i.jsxs(_y,{align:"end",className:"w-56",children:[i.jsxs("div",{className:"flex items-center justify-between px-2 py-1.5",children:[i.jsx(bw,{className:"p-0",children:"Filters"}),(te.length>0||Ae.length>0)&&i.jsx(de,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-destructive hover:text-destructive",onClick:P=>{P.preventDefault(),P.stopPropagation(),Te([]),Se([]),K(!1)},children:"Clear"})]}),i.jsx(jm,{}),i.jsx(bw,{className:"text-xs text-muted-foreground",children:"Tags"}),x==null?void 0:x.map(P=>i.jsxs(fc,{onClick:()=>{Te(Z=>Z.includes(P.id)?Z.filter(xe=>xe!==P.id):[...Z,P.id])},children:[i.jsx("span",{className:"w-2 h-2 rounded-full mr-2",style:{backgroundColor:P.color||"#888"}}),P.name,te.includes(P.id)&&i.jsx(dn,{className:"ml-auto h-4 w-4 text-primary"})]},P.id)),i.jsx(jm,{}),i.jsx(bw,{className:"text-xs text-muted-foreground",children:"Events"}),w==null?void 0:w.map(P=>i.jsxs(fc,{onClick:()=>{Se(Z=>Z.includes(P.id)?Z.filter(xe=>xe!==P.id):[...Z,P.id])},children:[P.title,Ae.includes(P.id)&&i.jsx(dn,{className:"ml-auto h-4 w-4 text-primary"})]},P.id))]})]})]})]})}),i.jsxs("div",{className:"w-full px-3 sm:px-4 md:px-6 pb-24 max-w-7xl mx-auto",children:[we==="name"||!JR?i.jsx("div",{className:"divide-y divide-border/30",children:Kn.map((P,Z)=>i.jsxs("div",{className:"group cursor-pointer transition-all duration-[120ms] active:bg-muted/40 active:scale-[0.985]",onClick:()=>eD(P),children:[i.jsxs("div",{className:"flex items-center gap-3.5 px-4 py-3",children:[i.jsx(Kv,{name:P.name,photoUrl:P.photo_url,sharedCardId:P.shared_card_id,size:"sm"}),i.jsxs("div",{className:"flex-1 min-w-0 flex items-center",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-[16.5px] font-medium leading-tight text-foreground truncate font-inter",children:P.name}),(P.company||P.designation)&&i.jsx("p",{className:"text-[13px] font-normal text-muted-foreground truncate mt-0.5 leading-tight font-inter",children:P.company&&P.designation?`${P.company}  ${P.designation}`:P.company||P.designation})]}),i.jsx(dD,{className:"h-4 w-4 text-muted-foreground/40 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 ml-2"})]})]}),Z<Kn.length-1&&i.jsx("div",{className:"ml-[56px] border-b border-border/30"})]},P.id))}):i.jsx("div",{children:zt.map(P=>{const Z=JR[P];return Z.length===0?null:i.jsxs("div",{children:[i.jsx("div",{className:"sticky top-[96px] z-[5] bg-background/90 backdrop-blur-sm px-4 py-1",children:i.jsx("span",{className:"text-[10.5px] font-semibold text-muted-foreground uppercase tracking-[0.12em]",children:P.replace("_"," ")})}),i.jsx("div",{className:"divide-y divide-border/30",children:Z.map((xe,at)=>i.jsxs("div",{className:"group cursor-pointer transition-all duration-[120ms] active:bg-muted/40 active:scale-[0.985]",onClick:()=>eD(xe),children:[i.jsxs("div",{className:"flex items-center gap-3.5 px-4 py-3",children:[i.jsx(Kv,{name:xe.name,photoUrl:xe.photo_url,sharedCardId:xe.shared_card_id,size:"sm"}),i.jsxs("div",{className:"flex-1 min-w-0 flex items-center",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h3",{className:"text-[16.5px] font-medium leading-tight text-foreground truncate font-inter",children:xe.name}),(xe.company||xe.designation)&&i.jsx("p",{className:"text-[13px] font-normal text-muted-foreground truncate mt-0.5 leading-tight font-inter",children:xe.company&&xe.designation?`${xe.company}  ${xe.designation}`:xe.company||xe.designation})]}),i.jsx(dD,{className:"h-4 w-4 text-muted-foreground/40 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0 ml-2"})]})]}),at<Z.length-1&&i.jsx("div",{className:"ml-[56px] border-b border-border/30"})]},xe.id))})]},P)})}),Kn.length===0&&!o&&i.jsxs("div",{className:"text-center py-16",children:[i.jsx("p",{className:"text-muted-foreground text-[15px]",children:"No contacts found"}),i.jsxs(de,{variant:"ghost",className:"mt-3 text-primary font-medium",onClick:()=>{Zn.light(),it(!0)},children:[i.jsx(fo,{className:"h-4 w-4 mr-1.5"})," Add your first contact"]})]})]}),t&&I&&An&&i.jsx(FS,{open:An,onClose:()=>it(!1),title:"Add Contact",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:Lt.firstName,lastName:Lt.lastName,onFirstNameChange:P=>tr(Z=>({...Z,firstName:P})),onLastNameChange:P=>tr(Z=>({...Z,lastName:P}))}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(In,{label:"Company Name",value:Lt.company,onChange:P=>tr(Z=>({...Z,company:P.target.value}))}),i.jsx(In,{label:"Role",value:Lt.designation,onChange:P=>tr(Z=>({...Z,designation:P.target.value}))})]}),i.jsx(In,{label:"Email",type:"email",inputMode:"email",value:Lt.email,onChange:P=>tr(Z=>({...Z,email:P.target.value}))}),i.jsx(Fs,{label:"Phone Number",value:Ir(Lt.phone),onChange:P=>{const Z=kr(Lt.phone);tr(xe=>({...xe,phone:Z+P.target.value}))},countryCode:kr(Lt.phone),onCountryCodeChange:P=>{const Z=Ir(Lt.phone);tr(xe=>({...xe,phone:P+Z}))}}),i.jsx(Fs,{label:"WhatsApp",value:Ir(Lt.whatsapp),onChange:P=>{const Z=kr(Lt.whatsapp);tr(xe=>({...xe,whatsapp:Z+P.target.value}))},countryCode:kr(Lt.whatsapp),onCountryCodeChange:P=>{const Z=Ir(Lt.whatsapp);tr(xe=>({...xe,whatsapp:P+Z}))}}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(In,{label:"LinkedIn",value:Lt.linkedin,onChange:P=>tr(Z=>({...Z,linkedin:P.target.value}))}),i.jsx(In,{label:"Website",inputMode:"url",value:Lt.website,onChange:P=>tr(Z=>({...Z,website:P.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{className:"text-sm text-muted-foreground",children:"Notes"}),i.jsx(ka,{value:Lt.notes,onChange:P=>tr(Z=>({...Z,notes:P.target.value})),placeholder:"Any notes...",rows:3})]}),i.jsx(de,{variant:"gradient",className:"w-full",onClick:Wt,children:"Save Contact"})]})}),!t&&i.jsx(vn,{open:An,onOpenChange:it,children:i.jsxs(mn,{className:"max-h-safe scroll-keyboard-safe",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Add Contact"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:Lt.firstName,lastName:Lt.lastName,onFirstNameChange:P=>tr(Z=>({...Z,firstName:P})),onLastNameChange:P=>tr(Z=>({...Z,lastName:P}))}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(In,{label:"Company Name",value:Lt.company,onChange:P=>tr(Z=>({...Z,company:P.target.value}))}),i.jsx(In,{label:"Role",value:Lt.designation,onChange:P=>tr(Z=>({...Z,designation:P.target.value}))})]}),i.jsx(In,{label:"Email",type:"email",inputMode:"email",value:Lt.email,onChange:P=>tr(Z=>({...Z,email:P.target.value}))}),i.jsx(Fs,{label:"Phone Number",value:Ir(Lt.phone),onChange:P=>{const Z=kr(Lt.phone);tr(xe=>({...xe,phone:Z+P.target.value}))},countryCode:kr(Lt.phone),onCountryCodeChange:P=>{const Z=Ir(Lt.phone);tr(xe=>({...xe,phone:P+Z}))}}),i.jsx(Fs,{label:"WhatsApp",value:Ir(Lt.whatsapp),onChange:P=>{const Z=kr(Lt.whatsapp);tr(xe=>({...xe,whatsapp:Z+P.target.value}))},countryCode:kr(Lt.whatsapp),onCountryCodeChange:P=>{const Z=Ir(Lt.whatsapp);tr(xe=>({...xe,whatsapp:P+Z}))}}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(In,{label:"LinkedIn",value:Lt.linkedin,onChange:P=>tr(Z=>({...Z,linkedin:P.target.value}))}),i.jsx(In,{label:"Website",inputMode:"url",value:Lt.website,onChange:P=>tr(Z=>({...Z,website:P.target.value}))})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{className:"text-sm text-muted-foreground",children:"Notes"}),i.jsx(ka,{value:Lt.notes,onChange:P=>tr(Z=>({...Z,notes:P.target.value})),placeholder:"Any notes...",rows:3})]}),i.jsx(de,{variant:"gradient",className:"w-full",onClick:Wt,children:"Save Contact"})]})]})}),i.jsx(vn,{open:ge,onOpenChange:De,children:i.jsxs(mn,{className:"max-w-lg",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Scan Business Card"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("canvas",{ref:oc,className:"hidden"}),i.jsx("input",{ref:Vu,type:"file",accept:"image/*",className:"hidden",onChange:ls}),i.jsx("input",{ref:Hu,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:et}),!_n&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"aspect-video bg-muted rounded-lg overflow-hidden relative",children:[tm?i.jsx("video",{ref:Yi,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}):Ts?i.jsx("img",{src:Ts,alt:"Captured card",className:"w-full h-full object-cover"}):i.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[i.jsx(ty,{className:"h-12 w-12 text-muted-foreground mb-2"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Capture or upload a business card"})]}),za&&i.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Extracting contact info..."})]})})]}),i.jsx("div",{className:"flex gap-2",children:Ts?i.jsxs(i.Fragment,{children:[i.jsxs(de,{variant:"outline",className:"flex-1",onClick:Xu,children:[i.jsx(Ww,{className:"h-4 w-4 mr-2"}),"Retake"]}),i.jsx(de,{variant:"gradient",className:"flex-1",onClick:Xi,disabled:za,children:za?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Scanning..."]}):i.jsxs(i.Fragment,{children:[i.jsx(pD,{className:"h-4 w-4 mr-2"}),"Extract Info"]})})]}):i.jsxs(i.Fragment,{children:[i.jsxs(de,{variant:"outline",className:"flex-1",onClick:()=>{var P;return(P=Vu.current)==null?void 0:P.click()},children:[i.jsx(Fo,{className:"h-4 w-4 mr-2"}),"Upload"]}),tm?i.jsxs(de,{variant:"gradient",className:"flex-1",onClick:jr,children:[i.jsx(ty,{className:"h-4 w-4 mr-2"}),"Capture"]}):i.jsxs(de,{variant:"gradient",className:"flex-1",onClick:Jt,children:[i.jsx(ty,{className:"h-4 w-4 mr-2"}),"Open Camera"]})]})})]}),_n&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 border border-border",children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Review extracted information:"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:_n.firstName||"",lastName:_n.lastName||"",onFirstNameChange:P=>fn(Z=>({...Z,firstName:P})),onLastNameChange:P=>fn(Z=>({...Z,lastName:P}))}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(In,{label:"Company Name",value:_n.company||"",onChange:P=>fn(Z=>({...Z,company:P.target.value}))}),i.jsx(In,{label:"Role",value:_n.designation||"",onChange:P=>fn(Z=>({...Z,designation:P.target.value}))})]}),i.jsx(In,{label:"Email",type:"email",inputMode:"email",value:_n.email||"",onChange:P=>fn(Z=>({...Z,email:P.target.value}))}),i.jsx(Fs,{label:"Phone Number",value:Ir(_n.phone),onChange:P=>{const Z=kr(_n.phone);fn(xe=>({...xe,phone:Z+P.target.value}))},countryCode:kr(_n.phone),onCountryCodeChange:P=>{const Z=Ir(_n.phone);fn(xe=>({...xe,phone:P+Z}))}}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(In,{label:"Website",inputMode:"url",value:_n.website||"",onChange:P=>fn(Z=>({...Z,website:P.target.value}))}),i.jsx(In,{label:"LinkedIn",value:_n.linkedin||"",onChange:P=>fn(Z=>({...Z,linkedin:P.target.value}))})]})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(de,{variant:"outline",className:"flex-1",onClick:Xu,children:[i.jsx(Ww,{className:"h-4 w-4 mr-2"}),"Scan Again"]}),i.jsx(de,{variant:"gradient",className:"flex-1",onClick:lx,children:"Save Contact"})]})]})]})]})}),i.jsx(Fpe,{open:Ke,onOpenChange:ze,contactId:Bt,tags:x,events:w,localContactTags:Mr,localContactEvents:qn,onTagToggle:gk,onEventToggle:cs,onTagCreated:async(P,Z)=>{const{data:xe,error:at}=await y(P,Z);return at||!xe?null:xe},onTagUpdated:async(P,Z)=>{await b(P,{name:Z})},onTagDeleted:async P=>{await v(P)}}),t&&I&&rt&&i.jsx(FS,{open:rt,onClose:()=>gt(!1),title:"Choose Template",maxHeight:"70dvh",children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("button",{onClick:()=>{vr&&(en==="email"?Cv(vr,null):_v(vr,null))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all bg-muted/30 active:scale-[0.98]",children:[i.jsx("p",{className:"font-medium",children:"No Template"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Send without using a template"})]}),(en==="email"?C():S()).map(P=>i.jsxs("button",{onClick:()=>{vr&&(en==="email"?Cv(vr,P):_v(vr,P))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all active:scale-[0.98]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("p",{className:"font-medium",children:P.name}),(en==="email"?P.is_selected_for_email:P.is_selected_for_whatsapp)&&i.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:"Default"})]}),en==="email"&&P.subject&&i.jsxs("p",{className:"text-xs text-muted-foreground mb-1",children:["Subject: ",P.subject]}),i.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:P.body})]},P.id))]})}),!t&&i.jsx(vn,{open:rt,onOpenChange:gt,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Choose Template"})}),i.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto",children:[i.jsxs("button",{onClick:()=>{vr&&(en==="email"?Cv(vr,null):_v(vr,null))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all bg-muted/30",children:[i.jsx("p",{className:"font-medium",children:"No Template"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Send without using a template"})]}),(en==="email"?C():S()).map(P=>i.jsxs("button",{onClick:()=>{vr&&(en==="email"?Cv(vr,P):_v(vr,P))},className:"w-full p-3 rounded-lg border border-border hover:border-primary/50 text-left transition-all",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("p",{className:"font-medium",children:P.name}),(en==="email"?P.is_selected_for_email:P.is_selected_for_whatsapp)&&i.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-primary/10 text-primary",children:"Default"})]}),en==="email"&&P.subject&&i.jsxs("p",{className:"text-xs text-muted-foreground mb-1",children:["Subject: ",P.subject]}),i.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:P.body})]},P.id))]})]})}),t&&I&&Le&&Q&&wh.createPortal(i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`fixed inset-0 z-[1000] bg-black/30 transition-opacity duration-300 ${Le?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>{Ye||(Xe(!1),Je(!1))},onTouchMove:P=>P.preventDefault(),style:{touchAction:"none"}}),i.jsx("div",{className:"fixed inset-x-0 bottom-0 z-[1001] flex justify-center pointer-events-none",children:i.jsxs("div",{ref:A,onTouchStart:_t,onTouchMove:$t,onTouchEnd:Ve,className:`w-full max-w-md bg-background rounded-t-3xl shadow-2xl pointer-events-auto overflow-hidden
                ${q?"":"transition-all duration-300 ease-[cubic-bezier(0.22,1,0.36,1)]"}
                ${Le?"opacity-100":"translate-y-full opacity-0"}
              `,style:{marginBottom:F>0?`-${F}px`:void 0,maxHeight:Ye?"95dvh":"90dvh"},children:[i.jsx("div",{className:"flex justify-center py-3",children:i.jsx("div",{className:"h-1.5 w-12 rounded-full bg-muted-foreground/30"})}),i.jsxs("div",{className:"overflow-y-auto px-4 pb-6 space-y-6",style:{WebkitOverflowScrolling:"touch",maxHeight:Ye?"calc(95dvh - 60px)":"calc(90dvh - 60px)",paddingBottom:"env(safe-area-inset-bottom)"},children:[i.jsxs("div",{className:"text-center relative pt-2",children:[Ye&&i.jsx("button",{onClick:()=>{if(Je(!1),Q){const{firstName:P,lastName:Z}=Bx(Q.name||"");V({firstName:P,lastName:Z,company:Q.company||"",designation:Q.designation||"",phone:Q.phone||"",email:Q.email||"",whatsapp:Q.whatsapp||"",linkedin:Q.linkedin||"",website:Q.website||"",notes:"",tags:Mr})}},className:"absolute left-0 top-0 h-10 w-10 rounded-full bg-muted flex items-center justify-center active:scale-95 transition-transform",disabled:ke,children:i.jsx(ui,{className:"w-5 h-5"})}),Ye&&i.jsx("button",{onClick:Qe,disabled:ke,className:"absolute right-0 top-0 px-4 h-10 rounded-full bg-primary text-primary-foreground text-[15px] font-medium active:scale-95 transition-transform disabled:opacity-50",children:ke?i.jsx(Gt,{className:"w-4 h-4 animate-spin"}):"Save"}),i.jsx(Kv,{name:Q.name,photoUrl:Q.photo_url,sharedCardId:Q.shared_card_id,size:"lg",className:"mx-auto mb-2"}),i.jsx("h2",{className:"text-[22px] font-semibold tracking-tight mt-1",children:Q.name}),(Q.company||Q.designation)&&i.jsx("p",{className:"text-[14px] text-muted-foreground mt-0.5",children:Q.company&&Q.designation?`${Q.company}  ${Q.designation}`:Q.company||Q.designation}),Q.about&&!Ye&&i.jsx("p",{className:"text-[13px] text-muted-foreground mt-2 max-w-md mx-auto leading-relaxed",children:Q.about}),!Ye&&i.jsx("button",{onClick:P=>{P.stopPropagation(),Je(!0)},className:"absolute right-0 top-0 h-9 w-9 rounded-full bg-background/80 backdrop-blur border border-border/40 flex items-center justify-center active:scale-95",children:i.jsx(am,{className:"w-5 h-5"})})]}),Ye?i.jsxs("div",{className:"space-y-4 pb-6",children:[i.jsx(_c,{firstName:le.firstName,lastName:le.lastName,onFirstNameChange:P=>Ue("firstName",P),onLastNameChange:P=>Ue("lastName",P)}),i.jsx(In,{label:"Company Name",value:le.company,onChange:P=>Ue("company",P.target.value)}),i.jsx(In,{label:"Role",value:le.designation,onChange:P=>Ue("designation",P.target.value)}),i.jsx(Fs,{label:"Phone Number",value:Ir(le.phone),onChange:P=>{const Z=kr(le.phone);Ue("phone",Z+P.target.value)},countryCode:kr(le.phone),onCountryCodeChange:P=>{const Z=Ir(le.phone);Ue("phone",P+Z)}}),i.jsx(Fs,{label:"WhatsApp",value:Ir(le.whatsapp),onChange:P=>{const Z=kr(le.whatsapp);Ue("whatsapp",Z+P.target.value)},countryCode:kr(le.whatsapp),onCountryCodeChange:P=>{const Z=Ir(le.whatsapp);Ue("whatsapp",P+Z)}}),i.jsx(In,{label:"Email",value:le.email,onChange:P=>Ue("email",P.target.value),inputMode:"email"}),i.jsx(In,{label:"LinkedIn",value:le.linkedin,onChange:P=>Ue("linkedin",P.target.value)}),i.jsx(In,{label:"Website",value:le.website,onChange:P=>Ue("website",P.target.value),inputMode:"url"}),ee&&i.jsx("div",{className:"text-sm text-destructive",children:ee}),i.jsxs("div",{className:"pt-6 mt-6 border-t border-border/30",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-3 uppercase tracking-wider",children:"Danger Zone"}),i.jsxs(de,{variant:"destructive",className:"w-full",onClick:()=>{ra({open:!0,title:`Delete ${Q.name}`,description:"This action cannot be undone.",onConfirm:async()=>{const{error:P}=await d(Q.id);P?(ra(Z=>({...Z,open:!1})),ie({title:"Failed to delete contact",variant:"destructive"})):(Xe(!1),$e(null),Je(!1),ra(Z=>({...Z,open:!1})),ie({title:"Contact deleted"}))}})},disabled:ke,children:[i.jsx(ti,{className:"w-4 h-4 mr-2"}),"Delete Contact"]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[i.jsx("button",{onClick:()=>{var P,Z;Qt(Q.id),La(((P=Q.tags)==null?void 0:P.map(xe=>xe.id))||[]),fa(((Z=Q.events)==null?void 0:Z.map(xe=>xe.id))||[]),ze(!0)},className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Tag"}),i.jsx("button",{onClick:()=>yt(!0),className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Notes"})]}),(Q.tags&&Q.tags.length>0||Q.events&&Q.events.length>0)&&i.jsxs("div",{className:"flex flex-wrap justify-center gap-1.5 mt-3",children:[(nD=Q.tags)==null?void 0:nD.map(P=>i.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-primary/10 text-primary",children:P.name},P.id)),(rD=Q.events)==null?void 0:rD.map(P=>i.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-muted text-muted-foreground",children:P.title},P.id))]}),i.jsxs("div",{className:"space-y-3",children:[Q.phone&&i.jsxs("button",{onClick:()=>QR(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(ky,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:k0(Q.phone)})]}),Q.email&&i.jsxs("button",{onClick:()=>cx(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(Di,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:Q.email})]}),(Q.whatsapp||Q.phone)&&i.jsxs("button",{onClick:()=>ZR(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(v0,{className:"h-5 w-5 text-foreground/70"}),i.jsx("span",{className:"text-foreground",children:"Connect on WhatsApp"})]}),Q.linkedin&&i.jsxs("a",{href:`https://linkedin.com/in/${Q.linkedin}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[i.jsx(Bw,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:"Connect on LinkedIn"})]}),Q.website&&i.jsxs("a",{href:`https://${Q.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[i.jsx(Ny,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:"Visit Website"})]})]}),i.jsxs("div",{className:"text-center text-[10.5px] text-muted-foreground tracking-widest mt-4",children:[i.jsx("span",{className:"uppercase tracking-wider",children:"Contact Added"}),i.jsx("span",{children:"  "}),i.jsx("span",{children:je(Q.created_at)})]}),an.length>0&&i.jsxs("div",{className:"mx-2 mt-3 p-4 rounded-3xl bg-muted space-y-2",children:[i.jsx("p",{className:"text-[11px] tracking-wider text-muted-foreground mb-3",children:"NOTES"}),an.map((P,Z)=>i.jsxs("div",{className:"flex items-start justify-between gap-2 border-b pb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-[15px] leading-relaxed text-foreground",children:P.text}),i.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:J(P.timestamp)})]}),i.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[i.jsx("button",{onClick:()=>{const xe=jt(P.text);Nt({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:i.jsx(am,{className:"w-3.5 h-3.5 text-muted-foreground"})}),i.jsx("button",{onClick:()=>{ra({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const xe=an.filter((at,ct)=>ct!==Z);c(Q.id,{notes_history:xe}),lt(xe),ra(at=>({...at,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:i.jsx(ti,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]})]})]})})]}),document.body),!t&&i.jsx(C6,{open:Le,handleOnly:Ye,shouldScaleBackground:!1,onOpenChange:P=>{var Z;Xe(P),P||(Je(!1),(Z=Ee.current)==null||Z.blur())},children:i.jsxs(j6,{hideHandle:!0,className:"max-h-safe rounded-t-3xl border-0 shadow-none bg-background flex flex-col",children:[i.jsx("div",{className:"flex justify-center py-3",children:i.jsx("div",{className:"h-1.5 w-12 rounded-full bg-muted-foreground/30"})}),Q&&i.jsxs("div",{className:"px-4 pb-6 space-y-6 overflow-y-auto scroll-keyboard-safe flex-1",children:[i.jsxs(I6,{className:"text-center relative p-0 pt-2",children:[Ye&&i.jsx("button",{onClick:()=>{if(Je(!1),Q){const{firstName:P,lastName:Z}=Bx(Q.name||"");V({firstName:P,lastName:Z,company:Q.company||"",designation:Q.designation||"",phone:Q.phone||"",email:Q.email||"",whatsapp:Q.whatsapp||"",linkedin:Q.linkedin||"",website:Q.website||"",notes:"",tags:Mr})}},className:"absolute left-0 top-0 h-10 w-10 rounded-full bg-muted flex items-center justify-center active:scale-95 transition-transform",disabled:ke,children:i.jsx(ui,{className:"w-5 h-5"})}),Ye&&i.jsx("button",{onClick:Qe,disabled:ke,className:"absolute right-0 top-0 px-4 h-10 rounded-full bg-primary text-primary-foreground text-[15px] font-medium active:scale-95 transition-transform disabled:opacity-50",children:ke?i.jsx(Gt,{className:"w-4 h-4 animate-spin"}):"Save"}),i.jsx(Kv,{name:Q.name,photoUrl:Q.photo_url,sharedCardId:Q.shared_card_id,size:"lg",className:"mx-auto mb-2"}),i.jsx(T6,{className:"text-[22px] font-semibold tracking-tight mt-1",children:Q.name}),(Q.company||Q.designation)&&i.jsx("p",{className:"text-[14px] text-muted-foreground mt-0.5",children:Q.company&&Q.designation?`${Q.company}  ${Q.designation}`:Q.company||Q.designation}),Q.about&&!Ye&&i.jsx("p",{className:"text-[13px] text-muted-foreground mt-2 max-w-md mx-auto leading-relaxed",children:Q.about}),!Ye&&i.jsx("button",{onClick:P=>{P.stopPropagation(),Je(!0)},className:"absolute right-0 top-0 h-9 w-9 rounded-full bg-background/80 backdrop-blur border border-border/40 flex items-center justify-center active:scale-95",children:i.jsx(am,{className:"w-5 h-5"})})]}),Ye?i.jsxs("div",{className:"space-y-4 pb-6",children:[i.jsx(_c,{firstName:le.firstName,lastName:le.lastName,onFirstNameChange:P=>Ue("firstName",P),onLastNameChange:P=>Ue("lastName",P)}),i.jsx(In,{label:"Company Name",value:le.company,onChange:P=>Ue("company",P.target.value)}),i.jsx(In,{label:"Role",value:le.designation,onChange:P=>Ue("designation",P.target.value)}),i.jsx(Fs,{label:"Phone Number",value:Ir(le.phone),onChange:P=>{const Z=kr(le.phone);Ue("phone",Z+P.target.value)},countryCode:kr(le.phone),onCountryCodeChange:P=>{const Z=Ir(le.phone);Ue("phone",P+Z)}}),i.jsx(Fs,{label:"WhatsApp",value:Ir(le.whatsapp),onChange:P=>{const Z=kr(le.whatsapp);Ue("whatsapp",Z+P.target.value)},countryCode:kr(le.whatsapp),onCountryCodeChange:P=>{const Z=Ir(le.whatsapp);Ue("whatsapp",P+Z)}}),i.jsx(In,{label:"Email",value:le.email,onChange:P=>Ue("email",P.target.value),inputMode:"email"}),i.jsx(In,{label:"LinkedIn",value:le.linkedin,onChange:P=>Ue("linkedin",P.target.value)}),i.jsx(In,{label:"Website",value:le.website,onChange:P=>Ue("website",P.target.value),inputMode:"url"}),ee&&i.jsx("div",{className:"text-sm text-destructive",children:ee}),i.jsxs("div",{className:"pt-6 mt-6 border-t border-border/30",children:[i.jsx("p",{className:"text-xs text-muted-foreground mb-3 uppercase tracking-wider",children:"Danger Zone"}),i.jsxs(de,{variant:"destructive",className:"w-full",onClick:()=>{ra({open:!0,title:`Delete ${Q.name}`,description:"This action cannot be undone.",onConfirm:async()=>{const{error:P}=await d(Q.id);P?(ra(Z=>({...Z,open:!1})),ie({title:"Failed to delete contact",variant:"destructive"})):(Xe(!1),$e(null),Je(!1),ra(Z=>({...Z,open:!1})),ie({title:"Contact deleted"}))}})},disabled:ke,children:[i.jsx(ti,{className:"w-4 h-4 mr-2"}),"Delete Contact"]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex justify-center gap-2 mt-4",children:[i.jsx("button",{onClick:()=>{var P,Z;Qt(Q.id),La(((P=Q.tags)==null?void 0:P.map(xe=>xe.id))||[]),fa(((Z=Q.events)==null?void 0:Z.map(xe=>xe.id))||[]),ze(!0)},className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Tag"}),i.jsx("button",{onClick:()=>yt(!0),className:"px-5 py-2 rounded-full bg-white text-black text-[14px] font-medium active:scale-95 transition-transform border border-border/50",children:"+Notes"})]}),(Q.tags&&Q.tags.length>0||Q.events&&Q.events.length>0)&&i.jsxs("div",{className:"flex flex-wrap justify-center gap-1.5 mt-3",children:[(aD=Q.tags)==null?void 0:aD.map(P=>i.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-primary/10 text-primary",children:P.name},P.id)),(sD=Q.events)==null?void 0:sD.map(P=>i.jsx("span",{className:"px-3 py-1 rounded-full text-[11px] font-medium bg-muted text-muted-foreground",children:P.title},P.id))]}),i.jsxs("div",{className:"space-y-3",children:[Q.phone&&i.jsxs("button",{onClick:()=>QR(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(ky,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:k0(Q.phone)})]}),Q.email&&i.jsxs("button",{onClick:()=>cx(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(Di,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:Q.email})]}),(Q.whatsapp||Q.phone)&&i.jsxs("button",{onClick:()=>ZR(Q),className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform w-full text-left",children:[i.jsx(v0,{className:"h-5 w-5 text-foreground/70"}),i.jsx("span",{className:"text-foreground",children:"Connect on WhatsApp"})]}),Q.linkedin&&i.jsxs("a",{href:`https://linkedin.com/in/${Q.linkedin}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[i.jsx(Bw,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:"Connect on LinkedIn"})]}),Q.website&&i.jsxs("a",{href:`https://${Q.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-3 p-4 rounded-3xl bg-muted active:scale-[0.98] transition-transform",children:[i.jsx(Ny,{className:"h-5 w-5 text-foreground/70",strokeWidth:1.3}),i.jsx("span",{className:"text-foreground",children:"Visit Website"})]})]}),i.jsxs("div",{className:"text-center text-[10.5px] text-muted-foreground tracking-widest mt-4",children:[i.jsx("span",{className:"uppercase tracking-wider",children:"Contact Added"}),i.jsx("span",{children:"  "}),i.jsx("span",{children:je(Q.created_at)})]}),an.length>0&&i.jsxs("div",{className:"mx-2 mt-3 p-4 rounded-3xl bg-muted space-y-2",children:[i.jsx("p",{className:"text-[11px] tracking-wider text-muted-foreground mb-3",children:"NOTES"}),an.map((P,Z)=>i.jsxs("div",{className:"flex items-start justify-between gap-2 border-b pb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-[15px] leading-relaxed text-foreground",children:P.text}),i.jsx("p",{className:"text-[11px] text-muted-foreground mt-1",children:J(P.timestamp)})]}),i.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[i.jsx("button",{onClick:()=>{const xe=jt(P.text);Nt({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:i.jsx(am,{className:"w-3.5 h-3.5 text-muted-foreground"})}),i.jsx("button",{onClick:()=>{ra({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const xe=an.filter((at,ct)=>ct!==Z);c(Q.id,{notes_history:xe}),lt(xe),ra(at=>({...at,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:i.jsx(ti,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]})]}),i.jsx(vn,{open:tt,onOpenChange:yt,children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Notes"})}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(ka,{value:ut,onChange:P=>qt(P.target.value),placeholder:"Write a note...",className:"flex-1"}),i.jsx(de,{variant:"gradient",onClick:Zt,children:i.jsx(Uw,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"mt-4 space-y-3 max-h-[200px] overflow-y-auto",children:[an.length===0&&i.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No notes yet"}),an.map((P,Z)=>i.jsxs("div",{className:"p-3 rounded-lg bg-muted/40 border flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-[15px] leading-relaxed",children:P.text}),i.jsx("p",{className:"text-[10px] text-muted-foreground",children:J(P.timestamp)})]}),i.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[i.jsx("button",{onClick:()=>{const xe=jt(P.text);Nt({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:i.jsx(am,{className:"w-3.5 h-3.5 text-muted-foreground"})}),i.jsx("button",{onClick:()=>{ra({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const xe=an.filter((at,ct)=>ct!==Z);c(Q.id,{notes_history:xe}),lt(xe),ra(at=>({...at,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:i.jsx(ti,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]})})]})}),t&&I&&tt&&i.jsxs(FS,{open:tt,onClose:()=>yt(!1),title:"Notes",maxHeight:"70dvh",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsx(ka,{value:ut,onChange:P=>qt(P.target.value),placeholder:"Write a note...",className:"flex-1"}),i.jsx(de,{variant:"gradient",onClick:Zt,children:i.jsx(Uw,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"mt-4 space-y-3 max-h-[200px] overflow-y-auto",children:[an.length===0&&i.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No notes yet"}),an.map((P,Z)=>i.jsxs("div",{className:"p-3 rounded-lg bg-muted/40 border flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-[15px] leading-relaxed",children:P.text}),i.jsx("p",{className:"text-[10px] text-muted-foreground",children:J(P.timestamp)})]}),i.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[i.jsx("button",{onClick:()=>{const xe=jt(P.text);Nt({open:!0,index:Z,systemText:xe.systemText,userText:xe.userText})},className:"p-1 rounded hover:bg-muted",title:"Edit note",children:i.jsx(am,{className:"w-3.5 h-3.5 text-muted-foreground"})}),i.jsx("button",{onClick:()=>{ra({open:!0,title:"Delete Note",description:"This action cannot be undone.",onConfirm:()=>{const xe=an.filter((at,ct)=>ct!==Z);c(Q.id,{notes_history:xe}),lt(xe),ra(at=>({...at,open:!1}))}})},className:"p-1 rounded hover:bg-muted",title:"Delete note",children:i.jsx(ti,{className:"w-3.5 h-3.5 text-muted-foreground"})})]})]},Z))]})]}),i.jsx(Rz,{open:Eo.open,onOpenChange:P=>ra(Z=>({...Z,open:P})),title:Eo.title,description:Eo.description,onConfirm:Eo.onConfirm}),i.jsx(vn,{open:wt.open,onOpenChange:P=>Nt(Z=>({...Z,open:P})),children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Edit Note"})}),i.jsxs("div",{className:"space-y-3",children:[wt.systemText&&i.jsx("div",{className:"inline-flex items-center px-3 py-1.5 bg-primary/10 text-primary rounded-full text-sm font-medium",children:wt.systemText}),i.jsx(ka,{value:wt.userText,onChange:P=>Nt(Z=>({...Z,userText:P.target.value})),placeholder:wt.systemText?"Add additional notes...":"Edit note...",rows:4,autoFocus:!0})]}),i.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[i.jsx(de,{variant:"outline",onClick:()=>Nt({open:!1,index:-1,systemText:"",userText:""}),children:"Cancel"}),i.jsx(de,{variant:"gradient",onClick:()=>{if(Q){const P=[...an];let Z=wt.systemText;wt.userText.trim()&&(Z=wt.systemText?`${wt.systemText} - ${wt.userText.trim()}`:wt.userText.trim()),Z&&(P[wt.index]={...P[wt.index],text:Z},c(Q.id,{notes_history:P}),lt(P)),Nt({open:!1,index:-1,systemText:"",userText:""})}},children:"Save"})]})]})}),i.jsx(vn,{open:is,onOpenChange:P=>!P&&os(),children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"text-center text-lg",children:[(xr==null?void 0:xr.interactionType)==="whatsapp"&&"WhatsApp sent to",(xr==null?void 0:xr.interactionType)==="email"&&"Email sent to",(xr==null?void 0:xr.interactionType)==="call"&&"Call made to"," ",xr==null?void 0:xr.contactName,"?"]})}),i.jsxs("div",{className:"flex justify-center gap-4 pt-4",children:[i.jsx(de,{variant:"outline",onClick:vl,className:"min-w-[80px]",children:"No"}),i.jsx(de,{variant:"gradient",onClick:bl,className:"min-w-[80px]",children:"Yes"})]})]})}),i.jsx(vn,{open:Pe,onOpenChange:P=>!P&&Be(),children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{children:On?"Add Details":"Add Note (Optional)"})}),On&&Wn&&i.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[i.jsx("span",{className:"inline-flex items-center px-3 py-1.5 rounded-md bg-primary/10 text-primary text-sm font-medium",children:Wn}),i.jsx("span",{className:"text-xs text-muted-foreground",children:"(auto-logged)"})]}),i.jsx(ka,{value:ft,onChange:P=>pe(P.target.value),placeholder:On?"Add additional notes...":"Add a note about this interaction...",rows:4,autoFocus:!0}),i.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[i.jsx(de,{variant:"outline",onClick:Be,children:On?"Done":"Skip"}),i.jsx(de,{variant:"gradient",onClick:re,children:On?"Save":"Save Note"})]})]})}),i.jsx("input",{ref:qu,type:"file",accept:".csv,text/csv",className:"hidden",onChange:BY}),i.jsx(vn,{open:nm,onOpenChange:lc,children:i.jsxs(mn,{className:"max-w-lg max-h-[80vh] flex flex-col",children:[i.jsx(wn,{children:i.jsxs(Nn,{children:["Import ",Js.length," Contacts"]})}),i.jsxs("div",{className:"flex-1 overflow-auto space-y-2 my-4",children:[Js.slice(0,10).map((P,Z)=>i.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border border-border/50",children:[i.jsx("p",{className:"font-medium text-sm",children:P.name}),i.jsxs("div",{className:"text-xs text-muted-foreground space-y-0.5 mt-1",children:[P.company&&i.jsx("p",{children:P.company}),P.email&&i.jsx("p",{children:P.email}),P.phone&&i.jsx("p",{children:P.phone})]})]},Z)),Js.length>10&&i.jsxs("p",{className:"text-sm text-muted-foreground text-center py-2",children:["+ ",Js.length-10," more contacts"]})]}),i.jsxs("div",{className:"flex justify-between gap-2 pt-2 border-t",children:[i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>Hpe(),children:"Download Template"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(de,{variant:"outline",onClick:()=>{lc(!1),wi([])},children:"Cancel"}),i.jsx(de,{variant:"gradient",onClick:WY,disabled:Ku,children:Ku?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):`Import ${Js.length} Contacts`})]})]})]})})]})}var Kpe=Object.defineProperty,R0=Object.getOwnPropertySymbols,E6=Object.prototype.hasOwnProperty,A6=Object.prototype.propertyIsEnumerable,j3=(e,t,n)=>t in e?Kpe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,CC=(e,t)=>{for(var n in t||(t={}))E6.call(t,n)&&j3(e,n,t[n]);if(R0)for(var n of R0(t))A6.call(t,n)&&j3(e,n,t[n]);return e},_C=(e,t)=>{var n={};for(var r in e)E6.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&R0)for(var r of R0(e))t.indexOf(r)<0&&A6.call(e,r)&&(n[r]=e[r]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var eh;(e=>{const t=class Fn{constructor(c,d,u,h){if(this.version=c,this.errorCorrectionLevel=d,this.modules=[],this.isFunction=[],c<Fn.MIN_VERSION||c>Fn.MAX_VERSION)throw new RangeError("Version value out of range");if(h<-1||h>7)throw new RangeError("Mask value out of range");this.size=c*4+17;let p=[];for(let f=0;f<this.size;f++)p.push(!1);for(let f=0;f<this.size;f++)this.modules.push(p.slice()),this.isFunction.push(p.slice());this.drawFunctionPatterns();const m=this.addEccAndInterleave(u);if(this.drawCodewords(m),h==-1){let f=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const x=this.getPenaltyScore();x<f&&(h=g,f=x),this.applyMask(g)}}a(0<=h&&h<=7),this.mask=h,this.applyMask(h),this.drawFormatBits(h),this.isFunction=[]}static encodeText(c,d){const u=e.QrSegment.makeSegments(c);return Fn.encodeSegments(u,d)}static encodeBinary(c,d){const u=e.QrSegment.makeBytes(c);return Fn.encodeSegments([u],d)}static encodeSegments(c,d,u=1,h=40,p=-1,m=!0){if(!(Fn.MIN_VERSION<=u&&u<=h&&h<=Fn.MAX_VERSION)||p<-1||p>7)throw new RangeError("Invalid value");let f,g;for(f=u;;f++){const v=Fn.getNumDataCodewords(f,d)*8,w=o.getTotalBits(c,f);if(w<=v){g=w;break}if(f>=h)throw new RangeError("Data too long")}for(const v of[Fn.Ecc.MEDIUM,Fn.Ecc.QUARTILE,Fn.Ecc.HIGH])m&&g<=Fn.getNumDataCodewords(f,v)*8&&(d=v);let x=[];for(const v of c){n(v.mode.modeBits,4,x),n(v.numChars,v.mode.numCharCountBits(f),x);for(const w of v.getData())x.push(w)}a(x.length==g);const y=Fn.getNumDataCodewords(f,d)*8;a(x.length<=y),n(0,Math.min(4,y-x.length),x),n(0,(8-x.length%8)%8,x),a(x.length%8==0);for(let v=236;x.length<y;v^=253)n(v,8,x);let b=[];for(;b.length*8<x.length;)b.push(0);return x.forEach((v,w)=>b[w>>>3]|=v<<7-(w&7)),new Fn(f,d,b,p)}getModule(c,d){return 0<=c&&c<this.size&&0<=d&&d<this.size&&this.modules[d][c]}getModules(){return this.modules}drawFunctionPatterns(){for(let u=0;u<this.size;u++)this.setFunctionModule(6,u,u%2==0),this.setFunctionModule(u,6,u%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const c=this.getAlignmentPatternPositions(),d=c.length;for(let u=0;u<d;u++)for(let h=0;h<d;h++)u==0&&h==0||u==0&&h==d-1||u==d-1&&h==0||this.drawAlignmentPattern(c[u],c[h]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(c){const d=this.errorCorrectionLevel.formatBits<<3|c;let u=d;for(let p=0;p<10;p++)u=u<<1^(u>>>9)*1335;const h=(d<<10|u)^21522;a(h>>>15==0);for(let p=0;p<=5;p++)this.setFunctionModule(8,p,r(h,p));this.setFunctionModule(8,7,r(h,6)),this.setFunctionModule(8,8,r(h,7)),this.setFunctionModule(7,8,r(h,8));for(let p=9;p<15;p++)this.setFunctionModule(14-p,8,r(h,p));for(let p=0;p<8;p++)this.setFunctionModule(this.size-1-p,8,r(h,p));for(let p=8;p<15;p++)this.setFunctionModule(8,this.size-15+p,r(h,p));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let c=this.version;for(let u=0;u<12;u++)c=c<<1^(c>>>11)*7973;const d=this.version<<12|c;a(d>>>18==0);for(let u=0;u<18;u++){const h=r(d,u),p=this.size-11+u%3,m=Math.floor(u/3);this.setFunctionModule(p,m,h),this.setFunctionModule(m,p,h)}}drawFinderPattern(c,d){for(let u=-4;u<=4;u++)for(let h=-4;h<=4;h++){const p=Math.max(Math.abs(h),Math.abs(u)),m=c+h,f=d+u;0<=m&&m<this.size&&0<=f&&f<this.size&&this.setFunctionModule(m,f,p!=2&&p!=4)}}drawAlignmentPattern(c,d){for(let u=-2;u<=2;u++)for(let h=-2;h<=2;h++)this.setFunctionModule(c+h,d+u,Math.max(Math.abs(h),Math.abs(u))!=1)}setFunctionModule(c,d,u){this.modules[d][c]=u,this.isFunction[d][c]=!0}addEccAndInterleave(c){const d=this.version,u=this.errorCorrectionLevel;if(c.length!=Fn.getNumDataCodewords(d,u))throw new RangeError("Invalid argument");const h=Fn.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][d],p=Fn.ECC_CODEWORDS_PER_BLOCK[u.ordinal][d],m=Math.floor(Fn.getNumRawDataModules(d)/8),f=h-m%h,g=Math.floor(m/h);let x=[];const y=Fn.reedSolomonComputeDivisor(p);for(let v=0,w=0;v<h;v++){let k=c.slice(w,w+g-p+(v<f?0:1));w+=k.length;const C=Fn.reedSolomonComputeRemainder(k,y);v<f&&k.push(0),x.push(k.concat(C))}let b=[];for(let v=0;v<x[0].length;v++)x.forEach((w,k)=>{(v!=g-p||k>=f)&&b.push(w[v])});return a(b.length==m),b}drawCodewords(c){if(c.length!=Math.floor(Fn.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let d=0;for(let u=this.size-1;u>=1;u-=2){u==6&&(u=5);for(let h=0;h<this.size;h++)for(let p=0;p<2;p++){const m=u-p,g=(u+1&2)==0?this.size-1-h:h;!this.isFunction[g][m]&&d<c.length*8&&(this.modules[g][m]=r(c[d>>>3],7-(d&7)),d++)}}a(d==c.length*8)}applyMask(c){if(c<0||c>7)throw new RangeError("Mask value out of range");for(let d=0;d<this.size;d++)for(let u=0;u<this.size;u++){let h;switch(c){case 0:h=(u+d)%2==0;break;case 1:h=d%2==0;break;case 2:h=u%3==0;break;case 3:h=(u+d)%3==0;break;case 4:h=(Math.floor(u/3)+Math.floor(d/2))%2==0;break;case 5:h=u*d%2+u*d%3==0;break;case 6:h=(u*d%2+u*d%3)%2==0;break;case 7:h=((u+d)%2+u*d%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[d][u]&&h&&(this.modules[d][u]=!this.modules[d][u])}}getPenaltyScore(){let c=0;for(let p=0;p<this.size;p++){let m=!1,f=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[p][x]==m?(f++,f==5?c+=Fn.PENALTY_N1:f>5&&c++):(this.finderPenaltyAddHistory(f,g),m||(c+=this.finderPenaltyCountPatterns(g)*Fn.PENALTY_N3),m=this.modules[p][x],f=1);c+=this.finderPenaltyTerminateAndCount(m,f,g)*Fn.PENALTY_N3}for(let p=0;p<this.size;p++){let m=!1,f=0,g=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[x][p]==m?(f++,f==5?c+=Fn.PENALTY_N1:f>5&&c++):(this.finderPenaltyAddHistory(f,g),m||(c+=this.finderPenaltyCountPatterns(g)*Fn.PENALTY_N3),m=this.modules[x][p],f=1);c+=this.finderPenaltyTerminateAndCount(m,f,g)*Fn.PENALTY_N3}for(let p=0;p<this.size-1;p++)for(let m=0;m<this.size-1;m++){const f=this.modules[p][m];f==this.modules[p][m+1]&&f==this.modules[p+1][m]&&f==this.modules[p+1][m+1]&&(c+=Fn.PENALTY_N2)}let d=0;for(const p of this.modules)d=p.reduce((m,f)=>m+(f?1:0),d);const u=this.size*this.size,h=Math.ceil(Math.abs(d*20-u*10)/u)-1;return a(0<=h&&h<=9),c+=h*Fn.PENALTY_N4,a(0<=c&&c<=2568888),c}getAlignmentPatternPositions(){if(this.version==1)return[];{const c=Math.floor(this.version/7)+2,d=this.version==32?26:Math.ceil((this.version*4+4)/(c*2-2))*2;let u=[6];for(let h=this.size-7;u.length<c;h-=d)u.splice(1,0,h);return u}}static getNumRawDataModules(c){if(c<Fn.MIN_VERSION||c>Fn.MAX_VERSION)throw new RangeError("Version number out of range");let d=(16*c+128)*c+64;if(c>=2){const u=Math.floor(c/7)+2;d-=(25*u-10)*u-55,c>=7&&(d-=36)}return a(208<=d&&d<=29648),d}static getNumDataCodewords(c,d){return Math.floor(Fn.getNumRawDataModules(c)/8)-Fn.ECC_CODEWORDS_PER_BLOCK[d.ordinal][c]*Fn.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][c]}static reedSolomonComputeDivisor(c){if(c<1||c>255)throw new RangeError("Degree out of range");let d=[];for(let h=0;h<c-1;h++)d.push(0);d.push(1);let u=1;for(let h=0;h<c;h++){for(let p=0;p<d.length;p++)d[p]=Fn.reedSolomonMultiply(d[p],u),p+1<d.length&&(d[p]^=d[p+1]);u=Fn.reedSolomonMultiply(u,2)}return d}static reedSolomonComputeRemainder(c,d){let u=d.map(h=>0);for(const h of c){const p=h^u.shift();u.push(0),d.forEach((m,f)=>u[f]^=Fn.reedSolomonMultiply(m,p))}return u}static reedSolomonMultiply(c,d){if(c>>>8||d>>>8)throw new RangeError("Byte out of range");let u=0;for(let h=7;h>=0;h--)u=u<<1^(u>>>7)*285,u^=(d>>>h&1)*c;return a(u>>>8==0),u}finderPenaltyCountPatterns(c){const d=c[1];a(d<=this.size*3);const u=d>0&&c[2]==d&&c[3]==d*3&&c[4]==d&&c[5]==d;return(u&&c[0]>=d*4&&c[6]>=d?1:0)+(u&&c[6]>=d*4&&c[0]>=d?1:0)}finderPenaltyTerminateAndCount(c,d,u){return c&&(this.finderPenaltyAddHistory(d,u),d=0),d+=this.size,this.finderPenaltyAddHistory(d,u),this.finderPenaltyCountPatterns(u)}finderPenaltyAddHistory(c,d){d[0]==0&&(c+=this.size),d.pop(),d.unshift(c)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=t;function n(l,c,d){if(c<0||c>31||l>>>c)throw new RangeError("Value out of range");for(let u=c-1;u>=0;u--)d.push(l>>>u&1)}function r(l,c){return(l>>>c&1)!=0}function a(l){if(!l)throw new Error("Assertion error")}const s=class Vr{constructor(c,d,u){if(this.mode=c,this.numChars=d,this.bitData=u,d<0)throw new RangeError("Invalid argument");this.bitData=u.slice()}static makeBytes(c){let d=[];for(const u of c)n(u,8,d);return new Vr(Vr.Mode.BYTE,c.length,d)}static makeNumeric(c){if(!Vr.isNumeric(c))throw new RangeError("String contains non-numeric characters");let d=[];for(let u=0;u<c.length;){const h=Math.min(c.length-u,3);n(parseInt(c.substring(u,u+h),10),h*3+1,d),u+=h}return new Vr(Vr.Mode.NUMERIC,c.length,d)}static makeAlphanumeric(c){if(!Vr.isAlphanumeric(c))throw new RangeError("String contains unencodable characters in alphanumeric mode");let d=[],u;for(u=0;u+2<=c.length;u+=2){let h=Vr.ALPHANUMERIC_CHARSET.indexOf(c.charAt(u))*45;h+=Vr.ALPHANUMERIC_CHARSET.indexOf(c.charAt(u+1)),n(h,11,d)}return u<c.length&&n(Vr.ALPHANUMERIC_CHARSET.indexOf(c.charAt(u)),6,d),new Vr(Vr.Mode.ALPHANUMERIC,c.length,d)}static makeSegments(c){return c==""?[]:Vr.isNumeric(c)?[Vr.makeNumeric(c)]:Vr.isAlphanumeric(c)?[Vr.makeAlphanumeric(c)]:[Vr.makeBytes(Vr.toUtf8ByteArray(c))]}static makeEci(c){let d=[];if(c<0)throw new RangeError("ECI assignment value out of range");if(c<128)n(c,8,d);else if(c<16384)n(2,2,d),n(c,14,d);else if(c<1e6)n(6,3,d),n(c,21,d);else throw new RangeError("ECI assignment value out of range");return new Vr(Vr.Mode.ECI,0,d)}static isNumeric(c){return Vr.NUMERIC_REGEX.test(c)}static isAlphanumeric(c){return Vr.ALPHANUMERIC_REGEX.test(c)}getData(){return this.bitData.slice()}static getTotalBits(c,d){let u=0;for(const h of c){const p=h.mode.numCharCountBits(d);if(h.numChars>=1<<p)return 1/0;u+=4+p+h.bitData.length}return u}static toUtf8ByteArray(c){c=encodeURI(c);let d=[];for(let u=0;u<c.length;u++)c.charAt(u)!="%"?d.push(c.charCodeAt(u)):(d.push(parseInt(c.substring(u+1,u+3),16)),u+=2);return d}};s.NUMERIC_REGEX=/^[0-9]*$/,s.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,s.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let o=s;e.QrSegment=s})(eh||(eh={}));(e=>{(t=>{const n=class{constructor(a,s){this.ordinal=a,this.formatBits=s}};n.LOW=new n(0,1),n.MEDIUM=new n(1,0),n.QUARTILE=new n(2,3),n.HIGH=new n(3,2),t.Ecc=n})(e.QrCode||(e.QrCode={}))})(eh||(eh={}));(e=>{(t=>{const n=class{constructor(a,s){this.modeBits=a,this.numBitsCharCount=s}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};n.NUMERIC=new n(1,[10,12,14]),n.ALPHANUMERIC=new n(2,[9,11,13]),n.BYTE=new n(4,[8,16,16]),n.KANJI=new n(8,[8,10,12]),n.ECI=new n(7,[0,0,0]),t.Mode=n})(e.QrSegment||(e.QrSegment={}))})(eh||(eh={}));var km=eh;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Ype={L:km.QrCode.Ecc.LOW,M:km.QrCode.Ecc.MEDIUM,Q:km.QrCode.Ecc.QUARTILE,H:km.QrCode.Ecc.HIGH},R6=128,D6="L",M6="#FFFFFF",$6="#000000",F6=!1,P6=1,Xpe=4,Zpe=0,Qpe=.1;function O6(e,t=0){const n=[];return e.forEach(function(r,a){let s=null;r.forEach(function(o,l){if(!o&&s!==null){n.push(`M${s+t} ${a+t}h${l-s}v1H${s+t}z`),s=null;return}if(l===r.length-1){if(!o)return;s===null?n.push(`M${l+t},${a+t} h1v1H${l+t}z`):n.push(`M${s+t},${a+t} h${l+1-s}v1H${s+t}z`);return}o&&s===null&&(s=l)})}),n.join("")}function L6(e,t){return e.slice().map((n,r)=>r<t.y||r>=t.y+t.h?n:n.map((a,s)=>s<t.x||s>=t.x+t.w?a:!1))}function Jpe(e,t,n,r){if(r==null)return null;const a=e.length+n*2,s=Math.floor(t*Qpe),o=a/t,l=(r.width||s)*o,c=(r.height||s)*o,d=r.x==null?e.length/2-l/2:r.x*o,u=r.y==null?e.length/2-c/2:r.y*o,h=r.opacity==null?1:r.opacity;let p=null;if(r.excavate){let f=Math.floor(d),g=Math.floor(u),x=Math.ceil(l+d-f),y=Math.ceil(c+u-g);p={x:f,y:g,w:x,h:y}}const m=r.crossOrigin;return{x:d,y:u,h:c,w:l,excavation:p,opacity:h,crossOrigin:m}}function eme(e,t){return t!=null?Math.max(Math.floor(t),0):e?Xpe:Zpe}function z6({value:e,level:t,minVersion:n,includeMargin:r,marginSize:a,imageSettings:s,size:o,boostLevel:l}){let c=Ne.useMemo(()=>{const f=(Array.isArray(e)?e:[e]).reduce((g,x)=>(g.push(...km.QrSegment.makeSegments(x)),g),[]);return km.QrCode.encodeSegments(f,Ype[t],n,void 0,void 0,l)},[e,t,n,l]);const{cells:d,margin:u,numCells:h,calculatedImageSettings:p}=Ne.useMemo(()=>{let m=c.getModules();const f=eme(r,a),g=m.length+f*2,x=Jpe(m,o,f,s);return{cells:m,margin:f,numCells:g,calculatedImageSettings:x}},[c,o,s,r,a]);return{qrcode:c,margin:u,cells:d,numCells:h,calculatedImageSettings:p}}var tme=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),nme=Ne.forwardRef(function(t,n){const r=t,{value:a,size:s=R6,level:o=D6,bgColor:l=M6,fgColor:c=$6,includeMargin:d=F6,minVersion:u=P6,boostLevel:h,marginSize:p,imageSettings:m}=r,g=_C(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:x}=g,y=_C(g,["style"]),b=m==null?void 0:m.src,v=Ne.useRef(null),w=Ne.useRef(null),k=Ne.useCallback(F=>{v.current=F,typeof n=="function"?n(F):n&&(n.current=F)},[n]),[C,S]=Ne.useState(!1),{margin:_,cells:I,numCells:T,calculatedImageSettings:A}=z6({value:a,level:o,minVersion:u,boostLevel:h,includeMargin:d,marginSize:p,imageSettings:m,size:s});Ne.useEffect(()=>{if(v.current!=null){const F=v.current,B=F.getContext("2d");if(!B)return;let q=I;const $=w.current,L=A!=null&&$!==null&&$.complete&&$.naturalHeight!==0&&$.naturalWidth!==0;L&&A.excavation!=null&&(q=L6(I,A.excavation));const M=window.devicePixelRatio||1;F.height=F.width=s*M;const X=s/T*M;B.scale(X,X),B.fillStyle=l,B.fillRect(0,0,T,T),B.fillStyle=c,tme?B.fill(new Path2D(O6(q,_))):I.forEach(function(G,W){G.forEach(function(O,U){O&&B.fillRect(U+_,W+_,1,1)})}),A&&(B.globalAlpha=A.opacity),L&&B.drawImage($,A.x+_,A.y+_,A.w,A.h)}}),Ne.useEffect(()=>{S(!1)},[b]);const j=CC({height:s,width:s},x);let D=null;return b!=null&&(D=Ne.createElement("img",{src:b,key:b,style:{display:"none"},onLoad:()=>{S(!0)},ref:w,crossOrigin:A==null?void 0:A.crossOrigin})),Ne.createElement(Ne.Fragment,null,Ne.createElement("canvas",CC({style:j,height:s,width:s,ref:k,role:"img"},y)),D)});nme.displayName="QRCodeCanvas";var vI=Ne.forwardRef(function(t,n){const r=t,{value:a,size:s=R6,level:o=D6,bgColor:l=M6,fgColor:c=$6,includeMargin:d=F6,minVersion:u=P6,boostLevel:h,title:p,marginSize:m,imageSettings:f}=r,g=_C(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:x,cells:y,numCells:b,calculatedImageSettings:v}=z6({value:a,level:o,minVersion:u,boostLevel:h,includeMargin:d,marginSize:m,imageSettings:f,size:s});let w=y,k=null;f!=null&&v!=null&&(v.excavation!=null&&(w=L6(y,v.excavation)),k=Ne.createElement("image",{href:f.src,height:v.h,width:v.w,x:v.x+x,y:v.y+x,preserveAspectRatio:"none",opacity:v.opacity,crossOrigin:v.crossOrigin}));const C=O6(w,x);return Ne.createElement("svg",CC({height:s,width:s,viewBox:`0 0 ${b} ${b}`,ref:n,role:"img"},g),!!p&&Ne.createElement("title",null,p),Ne.createElement("path",{fill:l,d:`M0,0 h${b}v${b}H0z`,shapeRendering:"crispEdges"}),Ne.createElement("path",{fill:c,d:C,shapeRendering:"crispEdges"}),k)});vI.displayName="QRCodeSVG";const Yv=[{id:"photo-logo",name:"Classic Pro"},{id:"wave-split",name:"Wave Split"},{id:"minimal-circle",name:"Minimal Circle"},{id:"logo-photo",name:"Brand First"},{id:"dark-professional",name:"Dark Executive"},{id:"photo-only",name:"Portrait"},{id:"logo-only",name:"Corporate"},{id:"color",name:"Solid Color"}],PS=[{value:"#6366f1",text:"#ffffff"},{value:"#10b981",text:"#ffffff"},{value:"#f43f5e",text:"#ffffff"},{value:"#f59e0b",text:"#1f2937"},{value:"#06b6d4",text:"#ffffff"},{value:"#8b5cf6",text:"#ffffff"},{value:"#475569",text:"#ffffff"},{value:"#1e3a5f",text:"#ffffff"}],Xv=260,rme=360,OS=20;function ame({open:e,currentLayout:t,currentColor:n,photoUrl:r,logoUrl:a,name:s,designation:o,company:l,onClose:c,onSelect:d}){const u=N.useRef(null),[h,p]=N.useState(Math.max(0,Yv.findIndex(y=>y.id===t))),[m,f]=N.useState(n||PS[0].value),g=Yv[h],x=g.id==="color";return N.useEffect(()=>{var y;(y=u.current)==null||y.scrollTo({left:h*(Xv+OS),behavior:"instant"})},[e]),N.useEffect(()=>{if(e){const y=Yv.findIndex(b=>b.id===t);p(y>=0?y:0),f(n||PS[0].value)}},[e,t,n]),e?wh.createPortal(i.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-xl",onClick:c,children:i.jsxs("div",{onClick:y=>y.stopPropagation(),className:"w-full max-w-md mx-4 h-[85vh] rounded-3xl bg-white/85 dark:bg-black/85 backdrop-blur-2xl shadow-2xl overflow-hidden flex flex-col",children:[i.jsxs("div",{className:"relative flex items-center justify-center px-5 pt-3 pb-2 shrink-0",children:[i.jsx("h2",{className:"font-semibold text-foreground",children:g.name}),i.jsx("button",{onClick:c,className:"absolute right-4 w-9 h-9 rounded-full bg-muted/40 hover:bg-muted flex items-center justify-center transition-colors",children:i.jsx(ui,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"relative flex-1 overflow-hidden flex items-center",children:[i.jsx("button",{onClick:()=>{var y;return(y=u.current)==null?void 0:y.scrollBy({left:-280,behavior:"smooth"})},className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-background/80 hover:bg-background flex items-center justify-center shadow-lg",children:i.jsx(mO,{className:"w-5 h-5"})}),i.jsx("div",{ref:u,onScroll:()=>{var y;return p(Math.round((((y=u.current)==null?void 0:y.scrollLeft)||0)/(Xv+OS)))},className:"flex gap-5 overflow-x-auto px-12 py-2 snap-x snap-mandatory scrollbar-hide h-full items-center",children:Yv.map((y,b)=>i.jsx("div",{className:Ie("snap-center shrink-0 relative transition-all duration-500 rounded-3xl overflow-hidden bg-card border border-border/40",b===h?"scale-100 shadow-xl":"scale-[0.88] opacity-40"),style:{width:Xv,height:rme},children:i.jsx(Qj,{layout:y.id,photoUrl:r,logoUrl:a,name:s,designation:o,company:l,themeColor:y.id==="color"?m:n,className:"w-full"})},y.id))}),i.jsx("button",{onClick:()=>{var y;return(y=u.current)==null?void 0:y.scrollBy({left:Xv+OS,behavior:"smooth"})},className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 w-10 h-10 rounded-full bg-background/80 hover:bg-background flex items-center justify-center shadow-lg",children:i.jsx(wy,{className:"w-5 h-5"})})]}),x&&i.jsx("div",{className:"flex justify-center gap-3 px-4 pt-2 pb-1 shrink-0",children:PS.map(y=>i.jsx("button",{onClick:()=>f(y.value),className:Ie("w-8 h-8 rounded-full transition-all duration-200 border-2",m===y.value?"border-foreground scale-110 shadow-lg":"border-transparent hover:scale-105"),style:{backgroundColor:y.value},children:m===y.value&&i.jsx(dn,{className:"w-4 h-4 mx-auto",style:{color:y.text}})},y.value))}),i.jsx("div",{className:"px-4 pt-2 pb-3 shrink-0",children:i.jsxs(de,{type:"button",variant:"gradient",size:"xl",className:"w-full",onClick:y=>{y.stopPropagation(),d(g.id,x?m:n),c()},children:[i.jsx(dn,{className:"w-5 h-5 mr-2"}),"Apply"]})})]})}),document.body):null}const bb=e=>e?e.trim().replace(/[\u200B-\u200D\uFEFF]/g,"").replace(/\s+/g,"").replace(/^@/,""):"",sme=e=>{const t=bb(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?instagram\.com\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://www.instagram.com/${a}`,displayValue:`@${a}`,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://www.instagram.com/${r}`,displayValue:`@${r}`,isValid:r.length>0}},ime=e=>{const t=bb(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:twitter\.com|x\.com)\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://x.com/${a}`,displayValue:`@${a}`,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://x.com/${r}`,displayValue:`@${r}`,isValid:r.length>0}},ome=e=>{const t=bb(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?(?:facebook\.com|fb\.com)\/([^\/\?#]+)/i);if(n){const a=n[1];return{url:`https://www.facebook.com/${a}`,displayValue:a,isValid:!0}}const r=t.replace(/\/$/,"");return{url:`https://www.facebook.com/${r}`,displayValue:r,isValid:r.length>0}},lme=e=>{const t=bb(e);if(!t)return{url:"",displayValue:"",isValid:!0};if(t.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)/i)){let n=t;n.match(/^https?:\/\//i)||(n=`https://${n}`);const r=n.match(/@([^\/\?#]+)/),a=n.match(/\/channel\/([^\/\?#]+)/),s=r?`@${r[1]}`:a?"Channel":"YouTube";return{url:n,displayValue:s,isValid:!0}}if(t.startsWith("@")||e.trim().startsWith("@")){const n=t.replace(/^@/,"");return{url:`https://www.youtube.com/@${n}`,displayValue:`@${n}`,isValid:n.length>0}}return{url:`https://www.youtube.com/@${t}`,displayValue:`@${t}`,isValid:t.length>0}},cme=e=>{const t=bb(e);if(!t)return{url:"",displayValue:"",isValid:!0};const n=t.match(/(?:https?:\/\/)?(?:www\.)?calendly\.com\/([^#]+)/i);if(n)return{url:`https://calendly.com/${n[1].replace(/\/$/,"")}`,displayValue:"Book a meeting",isValid:!0};const r=t.replace(/\/$/,"");return{url:`https://calendly.com/${r}`,displayValue:"Book a meeting",isValid:r.length>0}},I3=(e,t)=>{switch(e){case"instagram":return sme(t);case"twitter":return ime(t);case"facebook":return ome(t);case"youtube":return lme(t);case"calendly":return cme(t);default:return{url:t,displayValue:t,isValid:!0}}},ume=e=>{switch(e){case"instagram":return"Username or full URL";case"twitter":return"Username or full URL";case"facebook":return"Page name or full URL";case"youtube":return"@handle or channel URL";case"calendly":return"Username or booking URL";default:return"Enter link"}},dme=e=>{switch(e){case"instagram":return"Instagram";case"twitter":return"Twitter / X";case"facebook":return"Facebook";case"youtube":return"YouTube";case"calendly":return"Calendly";default:return e}},hme={instagram:()=>i.jsxs("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5"}),i.jsx("circle",{cx:"12",cy:"12",r:"4"}),i.jsx("circle",{cx:"17.5",cy:"6.5",r:"1.5",fill:"currentColor",stroke:"none"})]}),youtube:()=>i.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})}),twitter:()=>i.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),facebook:()=>i.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:i.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),calendly:()=>i.jsxs("svg",{className:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M19.655 14.262c-.124.209-.258.41-.402.603a6.642 6.642 0 0 1-2.126 1.876c-.259.153-.53.29-.81.41-.592.255-1.23.427-1.89.51a6.6 6.6 0 0 1-2.088-.067 6.672 6.672 0 0 1-4.808-3.803 6.636 6.636 0 0 1-.507-1.795 6.596 6.596 0 0 1 .142-2.347 6.65 6.65 0 0 1 1.338-2.645 6.674 6.674 0 0 1 2.081-1.673c.262-.135.533-.253.812-.354a6.598 6.598 0 0 1 2.976-.4c.68.07 1.335.24 1.95.5.288.122.567.262.836.42a6.664 6.664 0 0 1 2.094 1.872c.145.195.28.398.404.609l2.407-1.39a9.322 9.322 0 0 0-1.28-1.727 9.419 9.419 0 0 0-2.623-2.006 9.294 9.294 0 0 0-1.596-.695 9.353 9.353 0 0 0-5.848-.02 9.32 9.32 0 0 0-3.096 1.673 9.387 9.387 0 0 0-2.317 2.755 9.344 9.344 0 0 0-1.053 3.164 9.324 9.324 0 0 0 .088 3.293 9.342 9.342 0 0 0 1.059 2.81 9.39 9.39 0 0 0 1.885 2.297 9.41 9.41 0 0 0 2.508 1.652 9.303 9.303 0 0 0 2.9.786 9.346 9.346 0 0 0 2.948-.096 9.306 9.306 0 0 0 2.679-.923 9.388 9.388 0 0 0 2.996-2.617 9.326 9.326 0 0 0 1.29-1.993l-2.404-1.389z"}),i.jsx("path",{d:"M14.07 10.312a2.362 2.362 0 0 0-2.058-1.2 2.367 2.367 0 0 0-2.059 1.2 2.362 2.362 0 0 0 0 2.376 2.367 2.367 0 0 0 2.059 1.2 2.362 2.362 0 0 0 2.058-1.2 2.36 2.36 0 0 0 0-2.376z"})]})},pme=["instagram","youtube","twitter","facebook","calendly"];function T3({values:e,onChange:t,disabled:n}){const[r,a]=N.useState(null),[s,o]=N.useState(""),l=u=>{r===u?(a(null),o("")):(a(u),o(e[u]||""))},c=()=>{if(!r)return;const u=I3(r,s);t(r,u.url),a(null),o("")},d=()=>{r&&(t(r,""),a(null),o(""))};return i.jsxs("div",{className:"space-y-3",children:[i.jsx("div",{className:"flex items-center justify-between gap-2 p-2 rounded-xl bg-muted/30",children:pme.map(u=>{const h=hme[u],p=!!e[u],m=r===u;return i.jsxs("button",{type:"button",onClick:()=>l(u),disabled:n,className:Ie("flex flex-col items-center gap-1 p-2 rounded-lg transition-all flex-1",m&&"bg-muted/50 ring-1 ring-border/50","text-muted-foreground hover:text-foreground",n&&"opacity-50 cursor-not-allowed"),children:[i.jsx(h,{}),!p&&i.jsxs("span",{className:"text-[9px] flex items-center gap-0.5 text-muted-foreground",children:[i.jsx(fo,{className:"h-2 w-2"}),"Add"]}),p&&i.jsx(dn,{className:"h-3 w-3 text-green-500"})]},u)})}),r&&i.jsxs("div",{className:"space-y-2 p-3 rounded-xl bg-muted/20 border border-border/40 animate-fade-up",children:[i.jsx("label",{className:"text-sm font-medium text-foreground",children:dme(r)}),i.jsx(At,{value:s,onChange:u=>o(u.target.value),placeholder:ume(r),disabled:n,className:"bg-background"}),s&&i.jsx("p",{className:"text-xs text-muted-foreground truncate",children:I3(r,s).url||"Enter a valid link"}),i.jsx("p",{className:"text-xs text-muted-foreground/70",children:"Make sure this link is correct"}),i.jsxs("div",{className:"flex gap-2 pt-1",children:[i.jsx(de,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:n,className:"flex-1",children:"Clear"}),i.jsxs(de,{type:"button",variant:"default",size:"sm",onClick:c,disabled:n,className:"flex-1",children:[i.jsx(dn,{className:"h-4 w-4 mr-1"}),"Save"]})]})]})]})}var mme=Object.defineProperty,fme=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),wI=(e,t)=>{for(var n in t)mme(e,n,{get:t[n],enumerable:!0})},gme={};wI(gme,{Abs:()=>Lf,Acos:()=>Ch,Acosh:()=>_h,AdadeltaOptimizer:()=>BT,AdagradOptimizer:()=>WT,AdamOptimizer:()=>UT,AdamaxOptimizer:()=>VT,Add:()=>_u,AddN:()=>jh,All:()=>zf,Any:()=>Bf,ArgMax:()=>Wf,ArgMin:()=>Uf,Asin:()=>Ih,Asinh:()=>Th,Atan:()=>Eh,Atan2:()=>Rh,Atanh:()=>Ah,AvgPool:()=>Dh,AvgPool3D:()=>Vf,AvgPool3DGrad:()=>kb,AvgPoolGrad:()=>Nb,BackendWasm:()=>Yq,BatchMatMul:()=>Mh,BatchToSpaceND:()=>Hf,Bincount:()=>Gf,BitwiseAnd:()=>qf,BroadcastArgs:()=>Sb,BroadcastTo:()=>tW,Callback:()=>K8,CallbackList:()=>BV,Cast:()=>$h,Ceil:()=>Fh,ClipByValue:()=>ju,Complex:()=>O1,ComplexAbs:()=>Cb,Concat:()=>Kf,Conv2D:()=>Ph,Conv2DBackpropFilter:()=>L1,Conv2DBackpropInput:()=>Oh,Conv3D:()=>Lh,Conv3DBackpropFilterV2:()=>Yf,Conv3DBackpropInputV2:()=>Xf,Cos:()=>zh,Cosh:()=>Bh,CropAndResize:()=>Qf,Cumprod:()=>Zf,Cumsum:()=>Wh,CustomCallback:()=>UV,DataStorage:()=>$1,DenseBincount:()=>_b,DepthToSpace:()=>Jf,DepthwiseConv2dNative:()=>Uh,DepthwiseConv2dNativeBackpropFilter:()=>z1,DepthwiseConv2dNativeBackpropInput:()=>B1,Diag:()=>jb,Dilation2D:()=>Vh,Dilation2DBackpropFilter:()=>hf,Dilation2DBackpropInput:()=>df,Draw:()=>W1,ENV:()=>_I,EarlyStopping:()=>Y8,Einsum:()=>U1,Elu:()=>Gh,EluGrad:()=>eg,Environment:()=>J6,Equal:()=>tg,Erf:()=>qh,Exp:()=>Kh,ExpandDims:()=>ng,Expm1:()=>Yh,FFT:()=>V1,Fill:()=>Ib,FlipLeftRight:()=>rg,Floor:()=>Xh,FloorDiv:()=>Zh,FromPixels:()=>F0,FusedBatchNorm:()=>Qh,FusedConv2D:()=>nh,FusedDepthwiseConv2D:()=>rh,GPGPUContext:()=>Pw,GatherNd:()=>sg,GatherV2:()=>ag,GraphModel:()=>EA,Greater:()=>ig,GreaterEqual:()=>Jh,History:()=>WV,IFFT:()=>H1,Identity:()=>ep,Imag:()=>G1,InputSpec:()=>Zr,IsFinite:()=>tp,IsInf:()=>np,IsNan:()=>rp,KernelBackend:()=>vb,LRN:()=>op,LRNGrad:()=>pg,LayerVariable:()=>DV,LayersModel:()=>Pl,LeakyRelu:()=>ap,Less:()=>og,LessEqual:()=>lg,LinSpace:()=>cg,Log:()=>sp,Log1p:()=>ip,LogSoftmax:()=>rW,LogicalAnd:()=>ug,LogicalNot:()=>dg,LogicalOr:()=>hg,LogicalXor:()=>nW,LowerBound:()=>ofe,MathBackendCPU:()=>DA,MathBackendWebGL:()=>oR,MatrixBandPart:()=>lfe,Max:()=>lp,MaxPool:()=>up,MaxPool3D:()=>mg,MaxPool3DGrad:()=>Eb,MaxPoolGrad:()=>Tb,MaxPoolWithArgmax:()=>Ab,Maximum:()=>cp,Mean:()=>dp,Min:()=>hp,Minimum:()=>pp,MirrorPad:()=>mp,Mod:()=>fp,MomentumOptimizer:()=>HT,Multinomial:()=>fg,Multiply:()=>gp,Neg:()=>gg,NonMaxSuppressionV3:()=>yg,NonMaxSuppressionV4:()=>bg,NonMaxSuppressionV5:()=>vg,NotEqual:()=>xg,OP_SCOPE_SUFFIX:()=>AI,OneHot:()=>xp,OnesLike:()=>wg,Optimizer:()=>ac,OptimizerConstructors:()=>hV,Pack:()=>Ng,PadV2:()=>yp,Pool:()=>cfe,Pow:()=>bp,Prelu:()=>vp,Prod:()=>wp,RMSPropOptimizer:()=>GT,RNN:()=>sc,RaggedGather:()=>q1,RaggedRange:()=>K1,RaggedTensorToTensor:()=>Y1,Range:()=>Rb,Rank:()=>TC,Real:()=>X1,RealDiv:()=>Hh,Reciprocal:()=>Np,Reduction:()=>Ka,Relu:()=>kp,Relu6:()=>_p,Reshape:()=>kg,ResizeBilinear:()=>Cp,ResizeBilinearGrad:()=>Cg,ResizeNearestNeighbor:()=>Sp,ResizeNearestNeighborGrad:()=>Sg,Reverse:()=>jp,RotateWithOffset:()=>zg,Round:()=>Ip,Rsqrt:()=>Tp,SGDOptimizer:()=>RN,ScatterNd:()=>_g,SearchSorted:()=>Ig,Select:()=>Tg,Selu:()=>Ep,Sequential:()=>HN,Sigmoid:()=>Mp,Sign:()=>Dp,Sin:()=>Ap,Sinh:()=>Rp,Slice:()=>Eg,Softmax:()=>Op,Softplus:()=>$p,SpaceToBatchND:()=>Ag,SparseFillEmptyRows:()=>Db,SparseReshape:()=>Dg,SparseSegmentMean:()=>Mb,SparseSegmentSum:()=>$b,SparseToDense:()=>Mg,SplitV:()=>Rg,Sqrt:()=>Fp,Square:()=>Fb,SquaredDifference:()=>Lp,StaticRegexReplace:()=>Pb,Step:()=>Tu,StridedSlice:()=>$g,StringNGrams:()=>Ob,StringSplit:()=>Lb,StringToHashBucketFast:()=>zb,Sub:()=>zp,Sum:()=>Pp,SymbolicTensor:()=>So,Tan:()=>Bp,Tanh:()=>Wp,Tensor:()=>on,TensorBuffer:()=>Qr,TensorScatterUpdate:()=>jg,Tile:()=>Iu,TopK:()=>Fg,Transform:()=>Pg,Transpose:()=>Fl,Unique:()=>Bb,Unpack:()=>Og,UnsortedSegmentSum:()=>Wb,UpperBound:()=>ufe,Variable:()=>ah,ZerosLike:()=>Lg,_FusedMatMul:()=>th,abs:()=>Xr,acos:()=>FI,acosh:()=>PI,add:()=>Re,addN:()=>AW,all:()=>tN,any:()=>By,argMax:()=>lh,argMin:()=>OI,asin:()=>LI,asinh:()=>zI,atan:()=>BI,atan2:()=>WI,atanh:()=>UI,avgPool:()=>tc,avgPool3d:()=>HI,backend:()=>RI,backend_util:()=>z,basicLSTMCell:()=>$W,batchNorm:()=>Up,batchNorm2d:()=>GI,batchNorm3d:()=>qI,batchNorm4d:()=>KI,batchToSpaceND:()=>Yb,bincount:()=>YI,bitwiseAnd:()=>FW,booleanMaskAsync:()=>CU,broadcastArgs:()=>PW,broadcastTo:()=>Md,broadcast_util:()=>Bg,browser:()=>lv,buffer:()=>pn,callbacks:()=>sje,cast:()=>He,ceil:()=>XI,clipByValue:()=>Wa,clone:()=>Jo,complex:()=>Vl,concat:()=>pr,concat1d:()=>ZI,concat2d:()=>QI,concat3d:()=>JI,concat4d:()=>eT,constraints:()=>PV,conv1d:()=>nN,conv2d:()=>Ja,conv2dTranspose:()=>rN,conv3d:()=>nT,conv3dTranspose:()=>rT,copyRegisteredKernels:()=>mfe,cos:()=>Xb,cosh:()=>aN,cosineWindow:()=>jN,cumprod:()=>Vy,cumsum:()=>sN,customGrad:()=>cl,data:()=>bH,denseBincount:()=>L0,deprecationWarn:()=>xW,depthToSpace:()=>aT,depthwiseConv2d:()=>Vp,deregisterOp:()=>lje,device_util:()=>Gb,diag:()=>LW,dilation2d:()=>sT,disableDeprecationWarnings:()=>Vfe,dispose:()=>tn,disposeVariables:()=>Hfe,div:()=>pt,divNoNan:()=>iT,dot:()=>oT,dropout:()=>FT,einsum:()=>cd,elu:()=>Wg,enableDebugMode:()=>Ufe,enableProdMode:()=>Wfe,enclosingPowerOfTwo:()=>PT,engine:()=>Ti,ensureShape:()=>BW,env:()=>_e,equal:()=>qs,erf:()=>iN,euclideanNorm:()=>uT,exp:()=>Ua,expandDims:()=>_a,expm1:()=>dT,eye:()=>oN,fft:()=>iv,fill:()=>Gs,findBackend:()=>Zfe,findBackendFactory:()=>Qfe,floor:()=>Vg,floorDiv:()=>eN,forceHalfFloat:()=>U9,fused:()=>vf,gather:()=>Hg,gatherND:()=>TU,gather_util:()=>YT,getBackend:()=>yW,getGradient:()=>jC,getKernel:()=>Oy,getKernelsForBackend:()=>P0,getThreadsCount:()=>h7e,gpgpu_util:()=>v9,grad:()=>Eye,grads:()=>Aye,greater:()=>as,greaterEqual:()=>nc,ifft:()=>bf,imag:()=>Zb,image:()=>ii,inTopKAsync:()=>EU,initializers:()=>OV,input:()=>r8,io:()=>Fa,irfft:()=>vN,isFinite:()=>hT,isInf:()=>pT,isNaN:()=>mT,keep:()=>la,kernel_impls:()=>gl,layers:()=>LV,leakyRelu:()=>Qb,less:()=>ff,lessEqual:()=>Au,linalg:()=>zT,linspace:()=>GW,loadGraphModel:()=>mIe,loadGraphModelSync:()=>fIe,loadLayersModel:()=>eCe,localResponseNormalization:()=>fT,log:()=>Ks,log1p:()=>Jb,logSigmoid:()=>gT,logSoftmax:()=>cN,logSumExp:()=>ev,logicalAnd:()=>Wi,logicalNot:()=>tv,logicalOr:()=>uN,logicalXor:()=>xT,losses:()=>WU,lowerBound:()=>KW,matMul:()=>un,math:()=>JU,max:()=>di,maxPool:()=>va,maxPool3d:()=>yT,maxPoolWithArgmax:()=>YW,maximum:()=>fl,mean:()=>$r,memory:()=>FC,meshgrid:()=>XW,metrics:()=>H8,min:()=>mf,minimum:()=>hu,mirrorPad:()=>bT,mod:()=>vT,model:()=>rCe,models:()=>G8,moments:()=>nv,movingAverage:()=>_U,mul:()=>oe,multiRNNCell:()=>ZW,multinomial:()=>QW,neg:()=>Cr,nextFrame:()=>XT,norm:()=>Ug,notEqual:()=>dh,oneHot:()=>gf,ones:()=>ys,onesLike:()=>Ys,op:()=>se,outerProduct:()=>JW,pad:()=>jo,pad1d:()=>eU,pad2d:()=>tU,pad3d:()=>nU,pad4d:()=>rU,pool:()=>wT,pow:()=>ll,prelu:()=>av,print:()=>$I,prod:()=>NT,profile:()=>Gfe,raggedGather:()=>aU,raggedRange:()=>sU,raggedTensorToTensor:()=>iU,rand:()=>oU,randomGamma:()=>dU,randomNormal:()=>hN,randomStandardNormal:()=>hU,randomUniform:()=>Ru,randomUniformInt:()=>pU,range:()=>hh,ready:()=>Yfe,real:()=>xf,reciprocal:()=>jT,registerBackend:()=>J1,registerCallbackConstructor:()=>sCe,registerGradient:()=>aW,registerKernel:()=>Ub,registerOp:()=>oje,regularizers:()=>q8,relu:()=>ar,relu6:()=>pN,removeBackend:()=>Xfe,reshape:()=>me,reverse:()=>gi,reverse1d:()=>mU,reverse2d:()=>fU,reverse3d:()=>gU,reverse4d:()=>xU,rfft:()=>ov,round:()=>mN,rsqrt:()=>fN,scalar:()=>Rt,scatterND:()=>jU,scatter_util:()=>kN,searchSorted:()=>dN,selu:()=>gN,separableConv2d:()=>Gg,sequential:()=>aCe,serialization:()=>Oe,setBackend:()=>Kfe,setPlatform:()=>Jfe,setThreadsCount:()=>d7e,setWasmPath:()=>c7e,setWasmPaths:()=>u7e,setWebGLContext:()=>VG,setdiff1dAsync:()=>yU,shared:()=>MA,sigmoid:()=>Li,sign:()=>IT,signal:()=>BU,sin:()=>xN,sinh:()=>yN,slice:()=>En,slice1d:()=>sv,slice2d:()=>bN,slice3d:()=>qg,slice4d:()=>yf,slice_util:()=>da,softmax:()=>Du,softplus:()=>Hp,spaceToBatchND:()=>rv,sparse:()=>UU,sparseToDense:()=>IU,spectral:()=>zU,split:()=>bs,sqrt:()=>Ta,square:()=>hr,squaredDifference:()=>wN,squeeze:()=>Mu,stack:()=>Jr,step:()=>Gp,stridedSlice:()=>TT,string:()=>VU,sub:()=>ot,sum:()=>xt,sumOutType:()=>Q1,tan:()=>ET,tanh:()=>du,tensor:()=>Qa,tensor1d:()=>er,tensor2d:()=>el,tensor3d:()=>NN,tensor4d:()=>pu,tensor5d:()=>bU,tensor6d:()=>vU,tensorScatterUpdate:()=>NU,tensor_util:()=>go,test_util:()=>lU,tidy:()=>fe,tile:()=>Us,time:()=>qfe,topk:()=>RT,train:()=>sd,transpose:()=>hn,truncatedNormal:()=>CN,unique:()=>DT,unregisterGradient:()=>pfe,unregisterKernel:()=>hfe,unsortedSegmentSum:()=>_N,unstack:()=>Ur,upcastType:()=>mi,upperBound:()=>kU,util:()=>E,valueAndGrad:()=>Rye,valueAndGrads:()=>Dye,variable:()=>MT,variableGrads:()=>qW,version:()=>b7e,version_converter:()=>xIe,version_core:()=>r1e,version_cpu:()=>yEe,version_layers:()=>bE,version_wasm:()=>p7e,version_webgl:()=>oPe,webgl:()=>lPe,webgl_util:()=>UG,where:()=>Ia,whereAsync:()=>$T,zeros:()=>Fr,zerosLike:()=>Pn});var xme=Object.create,NI=Object.defineProperty,yme=Object.getOwnPropertyDescriptor,bme=Object.getOwnPropertyNames,vme=Object.getPrototypeOf,wme=Object.prototype.hasOwnProperty,ta=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nn=(e,t)=>{for(var n in t)NI(e,n,{get:t[n],enumerable:!0})},Nme=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of bme(t))!wme.call(e,a)&&a!==n&&NI(e,a,{get:()=>t[a],enumerable:!(r=yme(t,a))||r.enumerable});return e},Cu=(e,t,n)=>(n=e!=null?xme(vme(e)):{},Nme(!e||!e.__esModule?NI(n,"default",{value:e,enumerable:!0}):n,e)),kme=ta((e,t)=>{t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(j,D,F){this.low=j|0,this.high=D|0,this.unsigned=!!F}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0});function a(j){return(j&&j.__isLong__)===!0}r.isLong=a;var s={},o={};function l(j,D){var F,B,q;return D?(j>>>=0,(q=0<=j&&j<256)&&(B=o[j],B)?B:(F=d(j,(j|0)<0?-1:0,!0),q&&(o[j]=F),F)):(j|=0,(q=-128<=j&&j<128)&&(B=s[j],B)?B:(F=d(j,j<0?-1:0,!1),q&&(s[j]=F),F))}r.fromInt=l;function c(j,D){if(isNaN(j))return D?w:v;if(D){if(j<0)return w;if(j>=x)return I}else{if(j<=-y)return T;if(j+1>=y)return _}return j<0?c(-j,D).neg():d(j%g|0,j/g|0,D)}r.fromNumber=c;function d(j,D,F){return new r(j,D,F)}r.fromBits=d;var u=Math.pow;function h(j,D,F){if(j.length===0)throw Error("empty string");if(j==="NaN"||j==="Infinity"||j==="+Infinity"||j==="-Infinity")return v;if(typeof D=="number"?(F=D,D=!1):D=!!D,F=F||10,F<2||36<F)throw RangeError("radix");var B;if((B=j.indexOf("-"))>0)throw Error("interior hyphen");if(B===0)return h(j.substring(1),D,F).neg();for(var q=c(u(F,8)),$=v,L=0;L<j.length;L+=8){var M=Math.min(8,j.length-L),X=parseInt(j.substring(L,L+M),F);if(M<8){var G=c(u(F,M));$=$.mul(G).add(c(X))}else $=$.mul(q),$=$.add(c(X))}return $.unsigned=D,$}r.fromString=h;function p(j,D){return typeof j=="number"?c(j,D):typeof j=="string"?h(j,D):d(j.low,j.high,typeof D=="boolean"?D:j.unsigned)}r.fromValue=p;var m=65536,f=1<<24,g=m*m,x=g*g,y=x/2,b=l(f),v=l(0);r.ZERO=v;var w=l(0,!0);r.UZERO=w;var k=l(1);r.ONE=k;var C=l(1,!0);r.UONE=C;var S=l(-1);r.NEG_ONE=S;var _=d(-1,2147483647,!1);r.MAX_VALUE=_;var I=d(-1,-1,!0);r.MAX_UNSIGNED_VALUE=I;var T=d(0,-2147483648,!1);r.MIN_VALUE=T;var A=r.prototype;A.toInt=function(){return this.unsigned?this.low>>>0:this.low},A.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},A.toString=function(j){if(j=j||10,j<2||36<j)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(T)){var D=c(j),F=this.div(D),B=F.mul(D).sub(this);return F.toString(j)+B.toInt().toString(j)}else return"-"+this.neg().toString(j);for(var q=c(u(j,6),this.unsigned),$=this,L="";;){var M=$.div(q),X=$.sub(M.mul(q)).toInt()>>>0,G=X.toString(j);if($=M,$.isZero())return G+L;for(;G.length<6;)G="0"+G;L=""+G+L}},A.getHighBits=function(){return this.high},A.getHighBitsUnsigned=function(){return this.high>>>0},A.getLowBits=function(){return this.low},A.getLowBitsUnsigned=function(){return this.low>>>0},A.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var j=this.high!=0?this.high:this.low,D=31;D>0&&!(j&1<<D);D--);return this.high!=0?D+33:D+1},A.isZero=function(){return this.high===0&&this.low===0},A.eqz=A.isZero,A.isNegative=function(){return!this.unsigned&&this.high<0},A.isPositive=function(){return this.unsigned||this.high>=0},A.isOdd=function(){return(this.low&1)===1},A.isEven=function(){return(this.low&1)===0},A.equals=function(j){return a(j)||(j=p(j)),this.unsigned!==j.unsigned&&this.high>>>31===1&&j.high>>>31===1?!1:this.high===j.high&&this.low===j.low},A.eq=A.equals,A.notEquals=function(j){return!this.eq(j)},A.neq=A.notEquals,A.ne=A.notEquals,A.lessThan=function(j){return this.comp(j)<0},A.lt=A.lessThan,A.lessThanOrEqual=function(j){return this.comp(j)<=0},A.lte=A.lessThanOrEqual,A.le=A.lessThanOrEqual,A.greaterThan=function(j){return this.comp(j)>0},A.gt=A.greaterThan,A.greaterThanOrEqual=function(j){return this.comp(j)>=0},A.gte=A.greaterThanOrEqual,A.ge=A.greaterThanOrEqual,A.compare=function(j){if(a(j)||(j=p(j)),this.eq(j))return 0;var D=this.isNegative(),F=j.isNegative();return D&&!F?-1:!D&&F?1:this.unsigned?j.high>>>0>this.high>>>0||j.high===this.high&&j.low>>>0>this.low>>>0?-1:1:this.sub(j).isNegative()?-1:1},A.comp=A.compare,A.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(k)},A.neg=A.negate,A.add=function(j){a(j)||(j=p(j));var D=this.high>>>16,F=this.high&65535,B=this.low>>>16,q=this.low&65535,$=j.high>>>16,L=j.high&65535,M=j.low>>>16,X=j.low&65535,G=0,W=0,O=0,U=0;return U+=q+X,O+=U>>>16,U&=65535,O+=B+M,W+=O>>>16,O&=65535,W+=F+L,G+=W>>>16,W&=65535,G+=D+$,G&=65535,d(O<<16|U,G<<16|W,this.unsigned)},A.subtract=function(j){return a(j)||(j=p(j)),this.add(j.neg())},A.sub=A.subtract,A.multiply=function(j){if(this.isZero())return v;if(a(j)||(j=p(j)),n){var D=n.mul(this.low,this.high,j.low,j.high);return d(D,n.get_high(),this.unsigned)}if(j.isZero())return v;if(this.eq(T))return j.isOdd()?T:v;if(j.eq(T))return this.isOdd()?T:v;if(this.isNegative())return j.isNegative()?this.neg().mul(j.neg()):this.neg().mul(j).neg();if(j.isNegative())return this.mul(j.neg()).neg();if(this.lt(b)&&j.lt(b))return c(this.toNumber()*j.toNumber(),this.unsigned);var F=this.high>>>16,B=this.high&65535,q=this.low>>>16,$=this.low&65535,L=j.high>>>16,M=j.high&65535,X=j.low>>>16,G=j.low&65535,W=0,O=0,U=0,K=0;return K+=$*G,U+=K>>>16,K&=65535,U+=q*G,O+=U>>>16,U&=65535,U+=$*X,O+=U>>>16,U&=65535,O+=B*G,W+=O>>>16,O&=65535,O+=q*X,W+=O>>>16,O&=65535,O+=$*M,W+=O>>>16,O&=65535,W+=F*G+B*X+q*M+$*L,W&=65535,d(U<<16|K,W<<16|O,this.unsigned)},A.mul=A.multiply,A.divide=function(j){if(a(j)||(j=p(j)),j.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&j.low===-1&&j.high===-1)return this;var D=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,j.low,j.high);return d(D,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?w:v;var F,B,q;if(this.unsigned){if(j.unsigned||(j=j.toUnsigned()),j.gt(this))return w;if(j.gt(this.shru(1)))return C;q=w}else{if(this.eq(T)){if(j.eq(k)||j.eq(S))return T;if(j.eq(T))return k;var $=this.shr(1);return F=$.div(j).shl(1),F.eq(v)?j.isNegative()?k:S:(B=this.sub(j.mul(F)),q=F.add(B.div(j)),q)}else if(j.eq(T))return this.unsigned?w:v;if(this.isNegative())return j.isNegative()?this.neg().div(j.neg()):this.neg().div(j).neg();if(j.isNegative())return this.div(j.neg()).neg();q=v}for(B=this;B.gte(j);){F=Math.max(1,Math.floor(B.toNumber()/j.toNumber()));for(var L=Math.ceil(Math.log(F)/Math.LN2),M=L<=48?1:u(2,L-48),X=c(F),G=X.mul(j);G.isNegative()||G.gt(B);)F-=M,X=c(F,this.unsigned),G=X.mul(j);X.isZero()&&(X=k),q=q.add(X),B=B.sub(G)}return q},A.div=A.divide,A.modulo=function(j){if(a(j)||(j=p(j)),n){var D=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,j.low,j.high);return d(D,n.get_high(),this.unsigned)}return this.sub(this.div(j).mul(j))},A.mod=A.modulo,A.rem=A.modulo,A.not=function(){return d(~this.low,~this.high,this.unsigned)},A.and=function(j){return a(j)||(j=p(j)),d(this.low&j.low,this.high&j.high,this.unsigned)},A.or=function(j){return a(j)||(j=p(j)),d(this.low|j.low,this.high|j.high,this.unsigned)},A.xor=function(j){return a(j)||(j=p(j)),d(this.low^j.low,this.high^j.high,this.unsigned)},A.shiftLeft=function(j){return a(j)&&(j=j.toInt()),(j&=63)===0?this:j<32?d(this.low<<j,this.high<<j|this.low>>>32-j,this.unsigned):d(0,this.low<<j-32,this.unsigned)},A.shl=A.shiftLeft,A.shiftRight=function(j){return a(j)&&(j=j.toInt()),(j&=63)===0?this:j<32?d(this.low>>>j|this.high<<32-j,this.high>>j,this.unsigned):d(this.high>>j-32,this.high>=0?0:-1,this.unsigned)},A.shr=A.shiftRight,A.shiftRightUnsigned=function(j){if(a(j)&&(j=j.toInt()),j&=63,j===0)return this;var D=this.high;if(j<32){var F=this.low;return d(F>>>j|D<<32-j,D>>>j,this.unsigned)}else return j===32?d(D,0,this.unsigned):d(D>>>j-32,0,this.unsigned)},A.shru=A.shiftRightUnsigned,A.shr_u=A.shiftRightUnsigned,A.toSigned=function(){return this.unsigned?d(this.low,this.high,!1):this},A.toUnsigned=function(){return this.unsigned?this:d(this.low,this.high,!0)},A.toBytes=function(j){return j?this.toBytesLE():this.toBytesBE()},A.toBytesLE=function(){var j=this.high,D=this.low;return[D&255,D>>>8&255,D>>>16&255,D>>>24,j&255,j>>>8&255,j>>>16&255,j>>>24]},A.toBytesBE=function(){var j=this.high,D=this.low;return[j>>>24,j>>>16&255,j>>>8&255,j&255,D>>>24,D>>>16&255,D>>>8&255,D&255]},r.fromBytes=function(j,D,F){return F?r.fromBytesLE(j,D):r.fromBytesBE(j,D)},r.fromBytesLE=function(j,D){return new r(j[0]|j[1]<<8|j[2]<<16|j[3]<<24,j[4]|j[5]<<8|j[6]<<16|j[7]<<24,D)},r.fromBytesBE=function(j,D){return new r(j[4]<<24|j[5]<<16|j[6]<<8|j[7],j[0]<<24|j[1]<<16|j[2]<<8|j[3],D)}}),Sme=ta(()=>{}),Cme=ta(()=>{}),_me=ta((e,t)=>{(function(n,r,a){function s(d){var u=this,h=c();u.next=function(){var p=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=p-(u.c=p|0)},u.c=1,u.s0=h(" "),u.s1=h(" "),u.s2=h(" "),u.s0-=h(d),u.s0<0&&(u.s0+=1),u.s1-=h(d),u.s1<0&&(u.s1+=1),u.s2-=h(d),u.s2<0&&(u.s2+=1),h=null}function o(d,u){return u.c=d.c,u.s0=d.s0,u.s1=d.s1,u.s2=d.s2,u}function l(d,u){var h=new s(d),p=u&&u.state,m=h.next;return m.int32=function(){return h.next()*4294967296|0},m.double=function(){return m()+(m()*2097152|0)*11102230246251565e-32},m.quick=m,p&&(typeof p=="object"&&o(p,h),m.state=function(){return o(h,{})}),m}function c(){var d=4022871197,u=function(h){h=String(h);for(var p=0;p<h.length;p++){d+=h.charCodeAt(p);var m=.02519603282416938*d;d=m>>>0,m-=d,m*=d,d=m>>>0,m-=d,d+=m*4294967296}return(d>>>0)*23283064365386963e-26};return u}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.alea=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),jme=ta((e,t)=>{(function(n,r,a){function s(c){var d=this,u="";d.x=0,d.y=0,d.z=0,d.w=0,d.next=function(){var p=d.x^d.x<<11;return d.x=d.y,d.y=d.z,d.z=d.w,d.w^=d.w>>>19^p^p>>>8},c===(c|0)?d.x=c:u+=c;for(var h=0;h<u.length+64;h++)d.x^=u.charCodeAt(h)|0,d.next()}function o(c,d){return d.x=c.x,d.y=c.y,d.z=c.z,d.w=c.w,d}function l(c,d){var u=new s(c),h=d&&d.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,f=(u.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=u.next,p.quick=p,h&&(typeof h=="object"&&o(h,u),p.state=function(){return o(u,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xor128=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Ime=ta((e,t)=>{(function(n,r,a){function s(c){var d=this,u="";d.next=function(){var p=d.x^d.x>>>2;return d.x=d.y,d.y=d.z,d.z=d.w,d.w=d.v,(d.d=d.d+362437|0)+(d.v=d.v^d.v<<4^(p^p<<1))|0},d.x=0,d.y=0,d.z=0,d.w=0,d.v=0,c===(c|0)?d.x=c:u+=c;for(var h=0;h<u.length+64;h++)d.x^=u.charCodeAt(h)|0,h==u.length&&(d.d=d.x<<10^d.x>>>4),d.next()}function o(c,d){return d.x=c.x,d.y=c.y,d.z=c.z,d.w=c.w,d.v=c.v,d.d=c.d,d}function l(c,d){var u=new s(c),h=d&&d.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,f=(u.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=u.next,p.quick=p,h&&(typeof h=="object"&&o(h,u),p.state=function(){return o(u,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xorwow=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Tme=ta((e,t)=>{(function(n,r,a){function s(c){var d=this;d.next=function(){var h=d.x,p=d.i,m,f;return m=h[p],m^=m>>>7,f=m^m<<24,m=h[p+1&7],f^=m^m>>>10,m=h[p+3&7],f^=m^m>>>3,m=h[p+4&7],f^=m^m<<7,m=h[p+7&7],m=m^m<<13,f^=m^m<<9,h[p]=f,d.i=p+1&7,f};function u(h,p){var m,f=[];if(p===(p|0))f[0]=p;else for(p=""+p,m=0;m<p.length;++m)f[m&7]=f[m&7]<<15^p.charCodeAt(m)+f[m+1&7]<<13;for(;f.length<8;)f.push(0);for(m=0;m<8&&f[m]===0;++m);for(m==8?f[7]=-1:f[m],h.x=f,h.i=0,m=256;m>0;--m)h.next()}u(d,c)}function o(c,d){return d.x=c.x.slice(),d.i=c.i,d}function l(c,d){c==null&&(c=+new Date);var u=new s(c),h=d&&d.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,f=(u.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=u.next,p.quick=p,h&&(h.x&&o(h,u),p.state=function(){return o(u,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xorshift7=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Eme=ta((e,t)=>{(function(n,r,a){function s(c){var d=this;d.next=function(){var h=d.w,p=d.X,m=d.i,f,g;return d.w=h=h+1640531527|0,g=p[m+34&127],f=p[m=m+1&127],g^=g<<13,f^=f<<17,g^=g>>>15,f^=f>>>12,g=p[m]=g^f,d.i=m,g+(h^h>>>16)|0};function u(h,p){var m,f,g,x,y,b=[],v=128;for(p===(p|0)?(f=p,p=null):(p=p+"\0",f=0,v=Math.max(v,p.length)),g=0,x=-32;x<v;++x)p&&(f^=p.charCodeAt((x+32)%p.length)),x===0&&(y=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,x>=0&&(y=y+1640531527|0,m=b[x&127]^=f+y,g=m==0?g+1:0);for(g>=128&&(b[(p&&p.length||0)&127]=-1),g=127,x=4*128;x>0;--x)f=b[g+34&127],m=b[g=g+1&127],f^=f<<13,m^=m<<17,f^=f>>>15,m^=m>>>12,b[g]=f^m;h.w=y,h.X=b,h.i=g}u(d,c)}function o(c,d){return d.i=c.i,d.w=c.w,d.X=c.X.slice(),d}function l(c,d){c==null&&(c=+new Date);var u=new s(c),h=d&&d.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,f=(u.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=u.next,p.quick=p,h&&(h.X&&o(h,u),p.state=function(){return o(u,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.xor4096=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Ame=ta((e,t)=>{(function(n,r,a){function s(c){var d=this,u="";d.next=function(){var p=d.b,m=d.c,f=d.d,g=d.a;return p=p<<25^p>>>7^m,m=m-f|0,f=f<<24^f>>>8^g,g=g-p|0,d.b=p=p<<20^p>>>12^m,d.c=m=m-f|0,d.d=f<<16^m>>>16^g,d.a=g-p|0},d.a=0,d.b=0,d.c=-1640531527,d.d=1367130551,c===Math.floor(c)?(d.a=c/4294967296|0,d.b=c|0):u+=c;for(var h=0;h<u.length+20;h++)d.b^=u.charCodeAt(h)|0,d.next()}function o(c,d){return d.a=c.a,d.b=c.b,d.c=c.c,d.d=c.d,d}function l(c,d){var u=new s(c),h=d&&d.state,p=function(){return(u.next()>>>0)/4294967296};return p.double=function(){do var m=u.next()>>>11,f=(u.next()>>>0)/4294967296,g=(m+f)/(1<<21);while(g===0);return g},p.int32=u.next,p.quick=p,h&&(typeof h=="object"&&o(h,u),p.state=function(){return o(u,{})}),p}r&&r.exports?r.exports=l:a&&a.amd?a(function(){return l}):this.tychei=l})(e,typeof t=="object"&&t,typeof define=="function"&&define)}),Rme=ta(()=>{}),Dme=ta((e,t)=>{(function(n,r,a){var s=256,o=6,l=52,c="random",d=a.pow(s,o),u=a.pow(2,l),h=u*2,p=s-1,m;function f(k,C,S){var _=[];C=C==!0?{entropy:!0}:C||{};var I=b(y(C.entropy?[k,w(r)]:k??v(),3),_),T=new g(_),A=function(){for(var j=T.g(o),D=d,F=0;j<u;)j=(j+F)*s,D*=s,F=T.g(1);for(;j>=h;)j/=2,D/=2,F>>>=1;return(j+F)/D};return A.int32=function(){return T.g(4)|0},A.quick=function(){return T.g(4)/4294967296},A.double=A,b(w(T.S),r),(C.pass||S||function(j,D,F,B){return B&&(B.S&&x(B,T),j.state=function(){return x(T,{})}),F?(a[c]=j,D):j})(A,I,"global"in C?C.global:this==a,C.state)}function g(k){var C,S=k.length,_=this,I=0,T=_.i=_.j=0,A=_.S=[];for(S||(k=[S++]);I<s;)A[I]=I++;for(I=0;I<s;I++)A[I]=A[T=p&T+k[I%S]+(C=A[I])],A[T]=C;(_.g=function(j){for(var D,F=0,B=_.i,q=_.j,$=_.S;j--;)D=$[B=p&B+1],F=F*s+$[p&($[B]=$[q=p&q+D])+($[q]=D)];return _.i=B,_.j=q,F})(s)}function x(k,C){return C.i=k.i,C.j=k.j,C.S=k.S.slice(),C}function y(k,C){var S=[],_=typeof k,I;if(C&&_=="object")for(I in k)try{S.push(y(k[I],C-1))}catch{}return S.length?S:_=="string"?k:k+"\0"}function b(k,C){for(var S=k+"",_,I=0;I<S.length;)C[p&I]=p&(_^=C[p&I]*19)+S.charCodeAt(I++);return w(C)}function v(){try{var k;return m&&(k=m.randomBytes)?k=k(s):(k=new Uint8Array(s),(n.crypto||n.msCrypto).getRandomValues(k)),w(k)}catch{var C=n.navigator,S=C&&C.plugins;return[+new Date,n,S,n.screen,w(r)]}}function w(k){return String.fromCharCode.apply(0,k)}if(b(a.random(),r),typeof t=="object"&&t.exports){t.exports=f;try{m=Rme()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):a["seed"+c]=f})(typeof self<"u"?self:e,[],Math)}),M1=ta((e,t)=>{var n=_me(),r=jme(),a=Ime(),s=Tme(),o=Eme(),l=Ame(),c=Dme();c.alea=n,c.xor128=r,c.xorwow=a,c.xorshift7=s,c.xor4096=o,c.tychei=l,t.exports=c}),B6=ta(()=>{}),kI=ta(()=>{}),W6=ta(()=>{}),Mme=ta(()=>{}),$me=ta(()=>{}),Fme=ta(()=>{}),Pme=ta((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};function s(){return L.buffer!=te&&Q(L.buffer),Te}function o(){return L.buffer!=te&&Q(L.buffer),Ae}function l(){return L.buffer!=te&&Q(L.buffer),Se}function c(){return L.buffer!=te&&Q(L.buffer),we}function d(){return L.buffer!=te&&Q(L.buffer),Fe}var u=typeof a<"u"?a:{},h,p;u.ready=new Promise(function(J,je){h=J,p=je});var m;typeof process<"u"&&process.listeners&&(m={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var f=Object.assign({},u),g=(J,je)=>{throw je},x=typeof window=="object",y=typeof importScripts=="function",b=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",v=u.ENVIRONMENT_IS_PTHREAD||!1,w="";function k(J){return u.locateFile?u.locateFile(J,w):w+J}var C,S,_;function I(J){J instanceof Nt||B("exiting due to exception: "+J)}if(b){var T=kI(),A=W6();y?w=A.dirname(w)+"/":w=__dirname+"/",C=(je,Ge)=>(je=yt(je)?new URL(je):A.normalize(je),T.readFileSync(je,Ge?void 0:"utf8")),_=je=>{var Ge=C(je,!0);return Ge.buffer||(Ge=new Uint8Array(Ge)),Ge},S=(je,Ge,zt)=>{je=yt(je)?new URL(je):A.normalize(je),T.readFile(je,function(Wt,Jt){Wt?zt(Wt):Ge(Jt.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(je){if(!(je instanceof Nt))throw je}),process.on("unhandledRejection",function(je){throw je}),g=(je,Ge)=>{if(le())throw process.exitCode=je,Ge;I(Ge),process.exit(je)},u.inspect=function(){return"[Emscripten Module object]"};let J;try{J=Mme()}catch(je){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),je}global.Worker=J.Worker}else(x||y)&&(y?w=self.location.href:typeof document<"u"&&document.currentScript&&(w=document.currentScript.src),typeof r<"u"&&r&&(w=r),w.indexOf("blob:")!==0?w=w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):w="",b||(C=J=>{var je=new XMLHttpRequest;return je.open("GET",J,!1),je.send(null),je.responseText},y&&(_=J=>{var je=new XMLHttpRequest;return je.open("GET",J,!1),je.responseType="arraybuffer",je.send(null),new Uint8Array(je.response)}),S=(J,je,Ge)=>{var zt=new XMLHttpRequest;zt.open("GET",J,!0),zt.responseType="arraybuffer",zt.onload=()=>{if(zt.status==200||zt.status==0&&zt.response){je(zt.response);return}Ge()},zt.onerror=Ge,zt.send(null)}));b&&typeof performance>"u"&&(global.performance=$me().performance);var j=console.log.bind(console),D=console.warn.bind(console);b&&(j=J=>T.writeSync(1,J+`
`),D=J=>T.writeSync(2,J+`
`));var F=u.print||j,B=u.printErr||D;Object.assign(u,f),f=null,u.arguments&&u.arguments,u.thisProgram&&u.thisProgram,u.quit&&(g=u.quit);var q;u.wasmBinary&&(q=u.wasmBinary);var $=u.noExitRuntime||!0;typeof WebAssembly!="object"&&$t("no native wasm support detected");var L,M,X=!1,G;function W(J,je){J||$t(je)}var O=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function U(J,je,Ge){je>>>=0;for(var zt=je+Ge,Wt=je;J[Wt]&&!(Wt>=zt);)++Wt;if(Wt-je>16&&J.buffer&&O)return O.decode(J.buffer instanceof SharedArrayBuffer?J.slice(je,Wt):J.subarray(je,Wt));for(var Jt="";je<Wt;){var et=J[je++];if(!(et&128)){Jt+=String.fromCharCode(et);continue}var bt=J[je++]&63;if((et&224)==192){Jt+=String.fromCharCode((et&31)<<6|bt);continue}var jr=J[je++]&63;if((et&240)==224?et=(et&15)<<12|bt<<6|jr:et=(et&7)<<18|bt<<12|jr<<6|J[je++]&63,et<65536)Jt+=String.fromCharCode(et);else{var ls=et-65536;Jt+=String.fromCharCode(55296|ls>>10,56320|ls&1023)}}return Jt}function K(J,je){return J>>>=0,J?U(o(),J,je):""}function ce(J,je,Ge,zt){if(Ge>>>=0,!(zt>0))return 0;for(var Wt=Ge,Jt=Ge+zt-1,et=0;et<J.length;++et){var bt=J.charCodeAt(et);if(bt>=55296&&bt<=57343){var jr=J.charCodeAt(++et);bt=65536+((bt&1023)<<10)|jr&1023}if(bt<=127){if(Ge>=Jt)break;je[Ge++>>>0]=bt}else if(bt<=2047){if(Ge+1>=Jt)break;je[Ge++>>>0]=192|bt>>6,je[Ge++>>>0]=128|bt&63}else if(bt<=65535){if(Ge+2>=Jt)break;je[Ge++>>>0]=224|bt>>12,je[Ge++>>>0]=128|bt>>6&63,je[Ge++>>>0]=128|bt&63}else{if(Ge+3>=Jt)break;je[Ge++>>>0]=240|bt>>18,je[Ge++>>>0]=128|bt>>12&63,je[Ge++>>>0]=128|bt>>6&63,je[Ge++>>>0]=128|bt&63}}return je[Ge>>>0]=0,Ge-Wt}function ne(J,je,Ge){return ce(J,o(),je,Ge)}var te,Te,Ae,Se,we,Fe;v&&(te=u.buffer);function Q(J){te=J,u.HEAP8=Te=new Int8Array(J),u.HEAP16=new Int16Array(J),u.HEAP32=Se=new Int32Array(J),u.HEAPU8=Ae=new Uint8Array(J),u.HEAPU16=new Uint16Array(J),u.HEAPU32=we=new Uint32Array(J),u.HEAPF32=new Float32Array(J),u.HEAPF64=Fe=new Float64Array(J)}var $e=u.INITIAL_MEMORY||16777216;if(v)L=u.wasmMemory,te=u.buffer;else if(u.wasmMemory)L=u.wasmMemory;else if(L=new WebAssembly.Memory({initial:$e/65536,maximum:65536,shared:!0}),!(L.buffer instanceof SharedArrayBuffer))throw B("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),b&&B("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");L&&(te=L.buffer),$e=te.byteLength,Q(te);var Le,Xe=[],Ye=[],Je=[];function le(){return $}function V(){if(u.preRun)for(typeof u.preRun=="function"&&(u.preRun=[u.preRun]);u.preRun.length;)ke(u.preRun.shift());Bt(Xe)}function ee(){!v&&Bt(Ye)}function ve(){if(!v){if(u.postRun)for(typeof u.postRun=="function"&&(u.postRun=[u.postRun]);u.postRun.length;)be(u.postRun.shift());Bt(Je)}}function ke(J){Xe.unshift(J)}function Ce(J){Ye.unshift(J)}function be(J){Je.unshift(J)}var Ee=0,Ue=null;function Qe(J){Ee++,u.monitorRunDependencies&&u.monitorRunDependencies(Ee)}function _t(J){if(Ee--,u.monitorRunDependencies&&u.monitorRunDependencies(Ee),Ee==0&&Ue){var je=Ue;Ue=null,je()}}function $t(J){u.onAbort&&u.onAbort(J),J="Aborted("+J+")",B(J),X=!0,G=1,J+=". Build with -sASSERTIONS for more info.";var je=new WebAssembly.RuntimeError(J);throw p(je),je}var Ve="data:application/octet-stream;base64,";function tt(J){return J.startsWith(Ve)}function yt(J){return J.startsWith("file://")}var ut;ut="tfjs-backend-wasm-threaded-simd.wasm",tt(ut)||(ut=k(ut));function qt(J){try{if(J==ut&&q)return new Uint8Array(q);if(_)return _(J);throw"both async and sync fetching of the wasm failed"}catch(je){$t(je)}}function an(){if(!q&&(x||y)){if(typeof fetch=="function"&&!yt(ut))return fetch(ut,{credentials:"same-origin"}).then(function(J){if(!J.ok)throw"failed to load wasm binary file at '"+ut+"'";return J.arrayBuffer()}).catch(function(){return qt(ut)});if(S)return new Promise(function(J,je){S(ut,function(Ge){J(new Uint8Array(Ge))},je)})}return Promise.resolve().then(function(){return qt(ut)})}function lt(){var J={env:Js,wasi_snapshot_preview1:Js};function je(et,bt){var jr=et.exports;if(u.asm=jr,vr(u.asm._emscripten_tls_init),Le=u.asm.__indirect_function_table,Ce(u.asm.__wasm_call_ctors),M=bt,!v){var ls=ze.unusedWorkers.length;ze.unusedWorkers.forEach(function(Xi){ze.loadWasmModuleToWorker(Xi,function(){--ls||_t()})})}}v||Qe();function Ge(et){je(et.instance,et.module)}function zt(et){return an().then(function(bt){return WebAssembly.instantiate(bt,J)}).then(function(bt){return bt}).then(et,function(bt){B("failed to asynchronously prepare wasm: "+bt),$t(bt)})}function Wt(){return!q&&typeof WebAssembly.instantiateStreaming=="function"&&!tt(ut)&&!yt(ut)&&!b&&typeof fetch=="function"?fetch(ut,{credentials:"same-origin"}).then(function(et){var bt=WebAssembly.instantiateStreaming(et,J);return bt.then(Ge,function(jr){return B("wasm streaming compile failed: "+jr),B("falling back to ArrayBuffer instantiation"),zt(Ge)})}):zt(Ge)}if(u.instantiateWasm)try{var Jt=u.instantiateWasm(J,je);return Jt}catch(et){B("Module.instantiateWasm callback failed with error: "+et),p(et)}return Wt().catch(p),{}}var wt={};function Nt(J){this.name="ExitStatus",this.message="Program terminated with exit("+J+")",this.status=J}function Kt(J){var je=ze.pthreads[J];delete ze.pthreads[J],je.terminate(),Lt(J),ze.runningWorkers.splice(ze.runningWorkers.indexOf(je),1),je.pthread_ptr=0}function jt(J){var je=ze.pthreads[J];je.postMessage({cmd:"cancel"})}function Zt(J){var je=ze.pthreads[J];W(je),ze.returnWorkerToPool(je)}function An(J){var je=ze.getNewWorker();if(!je)return 6;ze.runningWorkers.push(je),ze.pthreads[J.pthread_ptr]=je,je.pthread_ptr=J.pthread_ptr;var Ge={cmd:"run",start_routine:J.startRoutine,arg:J.arg,pthread_ptr:J.pthread_ptr};return je.runPthread=()=>{b&&je.ref(),je.postMessage(Ge,J.transferList),delete je.runPthread},je.loaded&&je.runPthread(),0}function it(J){if(v)return fn(1,1,J);G=J,le()||(ze.terminateAllThreads(),u.onExit&&u.onExit(J),X=!0),g(J,new Nt(J))}function ge(J,je){if(G=J,!je&&v)throw rt(J),"unwind";it(J)}var De=ge;function Ke(J){if(J instanceof Nt||J=="unwind")return G;g(1,J)}var ze={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){v?ze.initWorker():ze.initMainThread()},initMainThread:function(){for(var J=8;J--;)ze.allocateUnusedWorker()},initWorker:function(){$=!1},setExitStatus:function(J){G=J},terminateAllThreads:function(){for(var J of Object.values(ze.pthreads))ze.returnWorkerToPool(J);for(var J of ze.unusedWorkers)J.terminate();ze.unusedWorkers=[]},returnWorkerToPool:function(J){var je=J.pthread_ptr;delete ze.pthreads[je],ze.unusedWorkers.push(J),ze.runningWorkers.splice(ze.runningWorkers.indexOf(J),1),J.pthread_ptr=0,b&&J.unref(),Lt(je)},receiveObjectTransfer:function(J){},threadInitTLS:function(){ze.tlsInitFunctions.forEach(J=>J())},loadWasmModuleToWorker:function(J,je){J.onmessage=Jt=>{var et=Jt.data,bt=et.cmd;if(J.pthread_ptr&&(ze.currentProxiedOperationCallerThread=J.pthread_ptr),et.targetThread&&et.targetThread!=wi()){var jr=ze.pthreads[et.targetThread];jr?jr.postMessage(et,et.transferList):B('Internal error! Worker sent a message "'+bt+'" to target pthread '+et.targetThread+", but that thread no longer exists!"),ze.currentProxiedOperationCallerThread=void 0;return}bt==="processProxyingQueue"?is(et.queue):bt==="spawnThread"?An(et):bt==="cleanupThread"?Zt(et.thread):bt==="killThread"?Kt(et.thread):bt==="cancelThread"?jt(et.thread):bt==="loaded"?(J.loaded=!0,b&&J.unref(),je&&je(J),J.runPthread&&J.runPthread()):bt==="print"?F("Thread "+et.threadId+": "+et.text):bt==="printErr"?B("Thread "+et.threadId+": "+et.text):bt==="alert"?alert("Thread "+et.threadId+": "+et.text):et.target==="setimmediate"?J.postMessage(et):bt==="callHandler"?u[et.handler](...et.args):bt&&B("worker sent an unknown command "+bt),ze.currentProxiedOperationCallerThread=void 0},J.onerror=Jt=>{var et="worker sent an error!";throw B(et+" "+Jt.filename+":"+Jt.lineno+": "+Jt.message),Jt},b&&(J.on("message",function(Jt){J.onmessage({data:Jt})}),J.on("error",function(Jt){J.onerror(Jt)}),J.on("detachedExit",function(){}));var Ge=[],zt=["onExit","onAbort","print","printErr"];for(var Wt of zt)u.hasOwnProperty(Wt)&&Ge.push(Wt);J.postMessage({cmd:"load",handlers:Ge,urlOrBlob:u.mainScriptUrlOrBlob||r,wasmMemory:L,wasmModule:M})},allocateUnusedWorker:function(){var J,je=k("tfjs-backend-wasm-threaded-simd.worker.js");J=new Worker(je),ze.unusedWorkers.push(J)},getNewWorker:function(){return ze.unusedWorkers.length==0&&(ze.allocateUnusedWorker(),ze.loadWasmModuleToWorker(ze.unusedWorkers[0])),ze.unusedWorkers.pop()}};u.PThread=ze;function Bt(J){for(;J.length>0;)J.shift()(u)}function Qt(){var J=wi(),je=l()[J+52>>>2],Ge=l()[J+56>>>2],zt=je-Ge;Yu(je,zt),os(je)}u.establishStackSpace=Qt;function rt(J){if(v)return fn(2,0,J);try{De(J)}catch(je){Ke(je)}}var gt=[];function en(J){var je=gt[J];return je||(J>=gt.length&&(gt.length=J+1),gt[J]=je=Le.get(J)),je}function br(J,je){var Ge=en(J)(je);le()?ze.setExitStatus(Ge):tr(Ge)}u.invokeEntryPoint=br;function vr(J){ze.tlsInitFunctions.push(J)}function js(J){yl(J,!y,1,!x),ze.threadInitTLS()}function Mr(J){v?postMessage({cmd:"cleanupThread",thread:J}):Zt(J)}function La(J,je,Ge,zt){return v?fn(3,1,J,je,Ge,zt):qn(J,je,Ge,zt)}function qn(J,je,Ge,zt){if(typeof SharedArrayBuffer>"u")return B("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var Wt=[],Jt=0;if(v&&(Wt.length===0||Jt))return La(J,je,Ge,zt);var et={startRoutine:Ge,pthread_ptr:J,arg:zt,transferList:Wt};return v?(et.cmd="spawnThread",postMessage(et,Wt),0):An(et)}function fa(){return 65536}var xr=!0;function Ki(){return xr}function is(J){Atomics.store(l(),J>>2,1),wi()&&ra(J),Atomics.compareExchange(l(),J>>2,1,0)}u.executeNotifiedProxyingQueue=is;function yi(J,je,Ge,zt){if(J==je)setTimeout(()=>is(zt));else if(v)postMessage({targetThread:J,cmd:"processProxyingQueue",queue:zt});else{var Wt=ze.pthreads[J];if(!Wt)return;Wt.postMessage({cmd:"processProxyingQueue",queue:zt})}return 1}function ft(J,je,Ge){return-1}function pe(){$t("")}function Pe(J){Pe.shown||(Pe.shown={}),Pe.shown[J]||(Pe.shown[J]=1,b&&(J="warning: "+J),B(J))}function dt(){b||y||Pe("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")}function On(){return Date.now()}function cr(){return 4294901760}function Wn(){return cr()}var wr;b?wr=()=>{var J=process.hrtime();return J[0]*1e3+J[1]/1e6}:wr=()=>performance.timeOrigin+performance.now();function za(J,je,Ge){o().copyWithin(J>>>0,je>>>0,je+Ge>>>0)}function Is(){return b?Fme().cpus().length:navigator.hardwareConcurrency}function _n(J){var je=Ao(),Ge=J();return os(je),Ge}function fn(J,je){var Ge=arguments.length-2,zt=arguments;return _n(()=>{for(var Wt=Ge,Jt=bl(Wt*8),et=Jt>>3,bt=0;bt<Ge;bt++){var jr=zt[2+bt];d()[et+bt>>>0]=jr}return Eo(J,Wt,Jt,je)})}var Ts=[];function bi(J,je,Ge){Ts.length=je;for(var zt=Ge>>3,Wt=0;Wt<je;Wt++)Ts[Wt]=d()[zt+Wt>>>0];var Jt=J<0,et=Jt?wt[-J-1]:lc[J];return et.apply(null,Ts)}function tm(J){try{return L.grow(J-te.byteLength+65535>>>16),Q(L.buffer),1}catch{}}function Uu(J){var je=o().length;if(J=J>>>0,J<=je)return!1;var Ge=cr();if(J>Ge)return!1;let zt=(jr,ls)=>jr+(ls-jr%ls)%ls;for(var Wt=1;Wt<=4;Wt*=2){var Jt=je*(1+.2/Wt);Jt=Math.min(Jt,J+100663296);var et=Math.min(Ge,zt(Math.max(J,Jt),65536)),bt=tm(et);if(bt)return!0}return!1}function Yi(){throw"unwind"}function oc(J){return v?fn(4,1,J):52}function Vu(J,je,Ge,zt,Wt){return v?fn(5,1,J,je,Ge,zt,Wt):70}var Hu=[null,[],[]];function Qs(J,je){var Ge=Hu[J];je===0||je===10?((J===1?F:B)(U(Ge,0)),Ge.length=0):Ge.push(je)}function Gu(J,je,Ge,zt){if(v)return fn(6,1,J,je,Ge,zt);for(var Wt=0,Jt=0;Jt<Ge;Jt++){var et=c()[je>>>2],bt=c()[je+4>>>2];je+=8;for(var jr=0;jr<bt;jr++)Qs(J,o()[et+jr>>>0]);Wt+=bt}return c()[zt>>>2]=Wt,0}function qu(J){var je=u["_"+J];return je}function Ku(J,je){s().set(J,je>>>0)}function vi(J,je,Ge,zt,Wt){var Jt={string:cs=>{var wl=0;if(cs!=null&&cs!==0){var cx=(cs.length<<2)+1;wl=bl(cx),ne(cs,wl,cx)}return wl},array:cs=>{var wl=bl(cs.length);return Ku(cs,wl),wl}};function et(cs){return je==="string"?K(cs):je==="boolean"?!!cs:cs}var bt=qu(J),jr=[],ls=0;if(zt)for(var Xi=0;Xi<zt.length;Xi++){var Xu=Jt[Ge[Xi]];Xu?(ls===0&&(ls=Ao()),jr[Xi]=Xu(zt[Xi])):jr[Xi]=zt[Xi]}var lx=bt.apply(null,jr);function gk(cs){return ls!==0&&os(ls),et(cs)}return lx=gk(lx),lx}function nm(J,je,Ge,zt){Ge=Ge||[];var Wt=Ge.every(et=>et==="number"||et==="boolean"),Jt=je!=="string";return Jt&&Wt&&!zt?qu(J):function(){return vi(J,je,Ge,arguments)}}ze.init();var lc=[null,it,rt,La,oc,Vu,Gu],Js={__emscripten_init_main_thread_js:js,__emscripten_thread_cleanup:Mr,__pthread_create_js:qn,_emscripten_default_pthread_stack_size:fa,_emscripten_get_now_is_monotonic:Ki,_emscripten_notify_task_queue:yi,_emscripten_set_offscreencanvas_size:ft,abort:pe,emscripten_check_blocking_allowed:dt,emscripten_date_now:On,emscripten_get_heap_max:Wn,emscripten_get_now:wr,emscripten_memcpy_big:za,emscripten_num_logical_cores:Is,emscripten_receive_on_main_thread_js:bi,emscripten_resize_heap:Uu,emscripten_unwind_to_js_event_loop:Yi,exit:De,fd_close:oc,fd_seek:Vu,fd_write:Gu,memory:L||u.wasmMemory};lt(),u.___wasm_call_ctors=function(){return(u.___wasm_call_ctors=u.asm.__wasm_call_ctors).apply(null,arguments)},u._init=function(){return(u._init=u.asm.init).apply(null,arguments)},u._init_with_threads_count=function(){return(u._init_with_threads_count=u.asm.init_with_threads_count).apply(null,arguments)},u._get_threads_count=function(){return(u._get_threads_count=u.asm.get_threads_count).apply(null,arguments)},u._register_tensor=function(){return(u._register_tensor=u.asm.register_tensor).apply(null,arguments)},u._dispose_data=function(){return(u._dispose_data=u.asm.dispose_data).apply(null,arguments)},u._dispose=function(){return(u._dispose=u.asm.dispose).apply(null,arguments)},u._Abs=function(){return(u._Abs=u.asm.Abs).apply(null,arguments)},u._Acos=function(){return(u._Acos=u.asm.Acos).apply(null,arguments)},u._Acosh=function(){return(u._Acosh=u.asm.Acosh).apply(null,arguments)},u._Add=function(){return(u._Add=u.asm.Add).apply(null,arguments)},u._AddN=function(){return(u._AddN=u.asm.AddN).apply(null,arguments)},u._All=function(){return(u._All=u.asm.All).apply(null,arguments)},u._Any=function(){return(u._Any=u.asm.Any).apply(null,arguments)},u._ArgMax=function(){return(u._ArgMax=u.asm.ArgMax).apply(null,arguments)},u._ArgMin=function(){return(u._ArgMin=u.asm.ArgMin).apply(null,arguments)},u._Asin=function(){return(u._Asin=u.asm.Asin).apply(null,arguments)},u._Asinh=function(){return(u._Asinh=u.asm.Asinh).apply(null,arguments)},u._Atan=function(){return(u._Atan=u.asm.Atan).apply(null,arguments)},u._Atan2=function(){return(u._Atan2=u.asm.Atan2).apply(null,arguments)},u._Atanh=function(){return(u._Atanh=u.asm.Atanh).apply(null,arguments)},u._AvgPool=function(){return(u._AvgPool=u.asm.AvgPool).apply(null,arguments)},u._AvgPool3D=function(){return(u._AvgPool3D=u.asm.AvgPool3D).apply(null,arguments)},u._AvgPool3DGrad=function(){return(u._AvgPool3DGrad=u.asm.AvgPool3DGrad).apply(null,arguments)},u._AvgPoolGrad=function(){return(u._AvgPoolGrad=u.asm.AvgPoolGrad).apply(null,arguments)},u._BatchMatMul=function(){return(u._BatchMatMul=u.asm.BatchMatMul).apply(null,arguments)},u._Bincount=function(){return(u._Bincount=u.asm.Bincount).apply(null,arguments)},u._BitwiseAnd=function(){return(u._BitwiseAnd=u.asm.BitwiseAnd).apply(null,arguments)},u._Ceil=function(){return(u._Ceil=u.asm.Ceil).apply(null,arguments)},u._ClipByValue=function(){return(u._ClipByValue=u.asm.ClipByValue).apply(null,arguments)},u._Conv2D=function(){return(u._Conv2D=u.asm.Conv2D).apply(null,arguments)},u._Conv2DBackpropInput=function(){return(u._Conv2DBackpropInput=u.asm.Conv2DBackpropInput).apply(null,arguments)},u._Conv3D=function(){return(u._Conv3D=u.asm.Conv3D).apply(null,arguments)},u._Conv3DBackpropFilterV2=function(){return(u._Conv3DBackpropFilterV2=u.asm.Conv3DBackpropFilterV2).apply(null,arguments)},u._Conv3DBackpropInputV2=function(){return(u._Conv3DBackpropInputV2=u.asm.Conv3DBackpropInputV2).apply(null,arguments)},u._Cos=function(){return(u._Cos=u.asm.Cos).apply(null,arguments)},u._Cosh=function(){return(u._Cosh=u.asm.Cosh).apply(null,arguments)},u._CropAndResize=function(){return(u._CropAndResize=u.asm.CropAndResize).apply(null,arguments)},u._Cumprod=function(){return(u._Cumprod=u.asm.Cumprod).apply(null,arguments)},u._Cumsum=function(){return(u._Cumsum=u.asm.Cumsum).apply(null,arguments)},u._DenseBincount=function(){return(u._DenseBincount=u.asm.DenseBincount).apply(null,arguments)},u._DepthToSpace=function(){return(u._DepthToSpace=u.asm.DepthToSpace).apply(null,arguments)},u._DepthwiseConv2dNative=function(){return(u._DepthwiseConv2dNative=u.asm.DepthwiseConv2dNative).apply(null,arguments)},u._Diag=function(){return(u._Diag=u.asm.Diag).apply(null,arguments)},u._Dilation2D=function(){return(u._Dilation2D=u.asm.Dilation2D).apply(null,arguments)},u._Dilation2DBackpropFilter=function(){return(u._Dilation2DBackpropFilter=u.asm.Dilation2DBackpropFilter).apply(null,arguments)},u._Dilation2DBackpropInput=function(){return(u._Dilation2DBackpropInput=u.asm.Dilation2DBackpropInput).apply(null,arguments)},u._Elu=function(){return(u._Elu=u.asm.Elu).apply(null,arguments)},u._EluGrad=function(){return(u._EluGrad=u.asm.EluGrad).apply(null,arguments)},u._Equal=function(){return(u._Equal=u.asm.Equal).apply(null,arguments)},u._Erf=function(){return(u._Erf=u.asm.Erf).apply(null,arguments)},u._Exp=function(){return(u._Exp=u.asm.Exp).apply(null,arguments)},u._Expm1=function(){return(u._Expm1=u.asm.Expm1).apply(null,arguments)},u._FlipLeftRight=function(){return(u._FlipLeftRight=u.asm.FlipLeftRight).apply(null,arguments)},u._Floor=function(){return(u._Floor=u.asm.Floor).apply(null,arguments)},u._FloorDiv=function(){return(u._FloorDiv=u.asm.FloorDiv).apply(null,arguments)},u._FusedBatchNorm=function(){return(u._FusedBatchNorm=u.asm.FusedBatchNorm).apply(null,arguments)},u._FusedConv2D=function(){return(u._FusedConv2D=u.asm.FusedConv2D).apply(null,arguments)},u._FusedDepthwiseConv2D=function(){return(u._FusedDepthwiseConv2D=u.asm.FusedDepthwiseConv2D).apply(null,arguments)},u._Gather=function(){return(u._Gather=u.asm.Gather).apply(null,arguments)},u._GatherNd=function(){return(u._GatherNd=u.asm.GatherNd).apply(null,arguments)},u._Greater=function(){return(u._Greater=u.asm.Greater).apply(null,arguments)},u._GreaterEqual=function(){return(u._GreaterEqual=u.asm.GreaterEqual).apply(null,arguments)},u._IsFinite=function(){return(u._IsFinite=u.asm.IsFinite).apply(null,arguments)},u._IsInf=function(){return(u._IsInf=u.asm.IsInf).apply(null,arguments)},u._IsNan=function(){return(u._IsNan=u.asm.IsNan).apply(null,arguments)},u._LRN=function(){return(u._LRN=u.asm.LRN).apply(null,arguments)},u._LRNGrad=function(){return(u._LRNGrad=u.asm.LRNGrad).apply(null,arguments)},u._LeakyRelu=function(){return(u._LeakyRelu=u.asm.LeakyRelu).apply(null,arguments)},u._Less=function(){return(u._Less=u.asm.Less).apply(null,arguments)},u._LessEqual=function(){return(u._LessEqual=u.asm.LessEqual).apply(null,arguments)},u._LinSpace=function(){return(u._LinSpace=u.asm.LinSpace).apply(null,arguments)},u._Log=function(){return(u._Log=u.asm.Log).apply(null,arguments)},u._Log1p=function(){return(u._Log1p=u.asm.Log1p).apply(null,arguments)},u._LogicalAnd=function(){return(u._LogicalAnd=u.asm.LogicalAnd).apply(null,arguments)},u._LogicalNot=function(){return(u._LogicalNot=u.asm.LogicalNot).apply(null,arguments)},u._LogicalOr=function(){return(u._LogicalOr=u.asm.LogicalOr).apply(null,arguments)},u._LogicalXor=function(){return(u._LogicalXor=u.asm.LogicalXor).apply(null,arguments)},u._Max=function(){return(u._Max=u.asm.Max).apply(null,arguments)},u._MaxPool=function(){return(u._MaxPool=u.asm.MaxPool).apply(null,arguments)},u._MaxPool3D=function(){return(u._MaxPool3D=u.asm.MaxPool3D).apply(null,arguments)},u._MaxPool3DGrad=function(){return(u._MaxPool3DGrad=u.asm.MaxPool3DGrad).apply(null,arguments)},u._MaxPoolGrad=function(){return(u._MaxPoolGrad=u.asm.MaxPoolGrad).apply(null,arguments)},u._MaxPoolWithArgmax=function(){return(u._MaxPoolWithArgmax=u.asm.MaxPoolWithArgmax).apply(null,arguments)},u._Maximum=function(){return(u._Maximum=u.asm.Maximum).apply(null,arguments)},u._Mean=function(){return(u._Mean=u.asm.Mean).apply(null,arguments)},u._Min=function(){return(u._Min=u.asm.Min).apply(null,arguments)},u._Minimum=function(){return(u._Minimum=u.asm.Minimum).apply(null,arguments)},u._MirrorPad=function(){return(u._MirrorPad=u.asm.MirrorPad).apply(null,arguments)},u._Mod=function(){return(u._Mod=u.asm.Mod).apply(null,arguments)},u._Multinomial=function(){return(u._Multinomial=u.asm.Multinomial).apply(null,arguments)},u._Multiply=function(){return(u._Multiply=u.asm.Multiply).apply(null,arguments)},u._Neg=function(){return(u._Neg=u.asm.Neg).apply(null,arguments)},u._NonMaxSuppressionV3=function(){return(u._NonMaxSuppressionV3=u.asm.NonMaxSuppressionV3).apply(null,arguments)},u._NonMaxSuppressionV4=function(){return(u._NonMaxSuppressionV4=u.asm.NonMaxSuppressionV4).apply(null,arguments)},u._NonMaxSuppressionV5=function(){return(u._NonMaxSuppressionV5=u.asm.NonMaxSuppressionV5).apply(null,arguments)},u._NotEqual=function(){return(u._NotEqual=u.asm.NotEqual).apply(null,arguments)},u._OneHot=function(){return(u._OneHot=u.asm.OneHot).apply(null,arguments)},u._PadV2=function(){return(u._PadV2=u.asm.PadV2).apply(null,arguments)},u._Pow=function(){return(u._Pow=u.asm.Pow).apply(null,arguments)},u._Prelu=function(){return(u._Prelu=u.asm.Prelu).apply(null,arguments)},u._Prod=function(){return(u._Prod=u.asm.Prod).apply(null,arguments)},u._RealDiv=function(){return(u._RealDiv=u.asm.RealDiv).apply(null,arguments)},u._Reciprocal=function(){return(u._Reciprocal=u.asm.Reciprocal).apply(null,arguments)},u._Relu=function(){return(u._Relu=u.asm.Relu).apply(null,arguments)},u._Relu6=function(){return(u._Relu6=u.asm.Relu6).apply(null,arguments)},u._ResizeBilinear=function(){return(u._ResizeBilinear=u.asm.ResizeBilinear).apply(null,arguments)},u._ResizeBilinearGrad=function(){return(u._ResizeBilinearGrad=u.asm.ResizeBilinearGrad).apply(null,arguments)},u._ResizeNearestNeighbor=function(){return(u._ResizeNearestNeighbor=u.asm.ResizeNearestNeighbor).apply(null,arguments)},u._ResizeNearestNeighborGrad=function(){return(u._ResizeNearestNeighborGrad=u.asm.ResizeNearestNeighborGrad).apply(null,arguments)},u._Reverse=function(){return(u._Reverse=u.asm.Reverse).apply(null,arguments)},u._RotateWithOffset=function(){return(u._RotateWithOffset=u.asm.RotateWithOffset).apply(null,arguments)},u._Round=function(){return(u._Round=u.asm.Round).apply(null,arguments)},u._Rsqrt=function(){return(u._Rsqrt=u.asm.Rsqrt).apply(null,arguments)},u._ScatterNd=function(){return(u._ScatterNd=u.asm.ScatterNd).apply(null,arguments)},u._SearchSorted=function(){return(u._SearchSorted=u.asm.SearchSorted).apply(null,arguments)},u._SelectV2=function(){return(u._SelectV2=u.asm.SelectV2).apply(null,arguments)},u._Selu=function(){return(u._Selu=u.asm.Selu).apply(null,arguments)},u._Sigmoid=function(){return(u._Sigmoid=u.asm.Sigmoid).apply(null,arguments)},u._Sign=function(){return(u._Sign=u.asm.Sign).apply(null,arguments)},u._Sin=function(){return(u._Sin=u.asm.Sin).apply(null,arguments)},u._Sinh=function(){return(u._Sinh=u.asm.Sinh).apply(null,arguments)},u._Softmax=function(){return(u._Softmax=u.asm.Softmax).apply(null,arguments)},u._Softplus=function(){return(u._Softplus=u.asm.Softplus).apply(null,arguments)},u._SparseFillEmptyRows=function(){return(u._SparseFillEmptyRows=u.asm.SparseFillEmptyRows).apply(null,arguments)},u._SparseReshape=function(){return(u._SparseReshape=u.asm.SparseReshape).apply(null,arguments)},u._SparseSegmentReduction=function(){return(u._SparseSegmentReduction=u.asm.SparseSegmentReduction).apply(null,arguments)},u._SparseToDense=function(){return(u._SparseToDense=u.asm.SparseToDense).apply(null,arguments)},u._Sqrt=function(){return(u._Sqrt=u.asm.Sqrt).apply(null,arguments)},u._Square=function(){return(u._Square=u.asm.Square).apply(null,arguments)},u._SquaredDifference=function(){return(u._SquaredDifference=u.asm.SquaredDifference).apply(null,arguments)},u._Step=function(){return(u._Step=u.asm.Step).apply(null,arguments)},u._StridedSlice=function(){return(u._StridedSlice=u.asm.StridedSlice).apply(null,arguments)},u._Sub=function(){return(u._Sub=u.asm.Sub).apply(null,arguments)},u._Sum=function(){return(u._Sum=u.asm.Sum).apply(null,arguments)},u._Tan=function(){return(u._Tan=u.asm.Tan).apply(null,arguments)},u._Tanh=function(){return(u._Tanh=u.asm.Tanh).apply(null,arguments)},u._TensorScatterUpdate=function(){return(u._TensorScatterUpdate=u.asm.TensorScatterUpdate).apply(null,arguments)},u._Tile=function(){return(u._Tile=u.asm.Tile).apply(null,arguments)},u._TopK=function(){return(u._TopK=u.asm.TopK).apply(null,arguments)},u._Transform=function(){return(u._Transform=u.asm.Transform).apply(null,arguments)},u._Transpose=function(){return(u._Transpose=u.asm.Transpose).apply(null,arguments)},u.__FusedMatMul=function(){return(u.__FusedMatMul=u.asm._FusedMatMul).apply(null,arguments)},u._malloc=function(){return(u._malloc=u.asm.malloc).apply(null,arguments)},u._free=function(){return(u._free=u.asm.free).apply(null,arguments)},u.__emscripten_tls_init=function(){return(u.__emscripten_tls_init=u.asm._emscripten_tls_init).apply(null,arguments)};var wi=u._pthread_self=function(){return(wi=u._pthread_self=u.asm.pthread_self).apply(null,arguments)};u.___errno_location=function(){return(u.___errno_location=u.asm.__errno_location).apply(null,arguments)};var yl=u.__emscripten_thread_init=function(){return(yl=u.__emscripten_thread_init=u.asm._emscripten_thread_init).apply(null,arguments)};u.__emscripten_thread_crashed=function(){return(u.__emscripten_thread_crashed=u.asm._emscripten_thread_crashed).apply(null,arguments)},u._emscripten_main_thread_process_queued_calls=function(){return(u._emscripten_main_thread_process_queued_calls=u.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},u._emscripten_main_browser_thread_id=function(){return(u._emscripten_main_browser_thread_id=u.asm.emscripten_main_browser_thread_id).apply(null,arguments)};var Eo=u._emscripten_run_in_main_runtime_thread_js=function(){return(Eo=u._emscripten_run_in_main_runtime_thread_js=u.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)};u._emscripten_dispatch_to_thread_=function(){return(u._emscripten_dispatch_to_thread_=u.asm.emscripten_dispatch_to_thread_).apply(null,arguments)};var ra=u.__emscripten_proxy_execute_task_queue=function(){return(ra=u.__emscripten_proxy_execute_task_queue=u.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)},Lt=u.__emscripten_thread_free_data=function(){return(Lt=u.__emscripten_thread_free_data=u.asm._emscripten_thread_free_data).apply(null,arguments)},tr=u.__emscripten_thread_exit=function(){return(tr=u.__emscripten_thread_exit=u.asm._emscripten_thread_exit).apply(null,arguments)},Yu=u._emscripten_stack_set_limits=function(){return(Yu=u._emscripten_stack_set_limits=u.asm.emscripten_stack_set_limits).apply(null,arguments)},Ao=u.stackSave=function(){return(Ao=u.stackSave=u.asm.stackSave).apply(null,arguments)},os=u.stackRestore=function(){return(os=u.stackRestore=u.asm.stackRestore).apply(null,arguments)},bl=u.stackAlloc=function(){return(bl=u.stackAlloc=u.asm.stackAlloc).apply(null,arguments)};u.dynCall_iijjiiii=function(){return(u.dynCall_iijjiiii=u.asm.dynCall_iijjiiii).apply(null,arguments)},u.dynCall_jiji=function(){return(u.dynCall_jiji=u.asm.dynCall_jiji).apply(null,arguments)},u.keepRuntimeAlive=le,u.wasmMemory=L,u.cwrap=nm,u.ExitStatus=Nt,u.PThread=ze;var vl;Ue=function J(){vl||re(),vl||(Ue=J)};function re(J){if(Ee>0)return;if(v){h(u),ee(),startWorker(u);return}if(V(),Ee>0)return;function je(){vl||(vl=!0,u.calledRun=!0,!X&&(ee(),h(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),ve()))}u.setStatus?(u.setStatus("Running..."),setTimeout(function(){setTimeout(function(){u.setStatus("")},1),je()},1)):je()}if(u.preInit)for(typeof u.preInit=="function"&&(u.preInit=[u.preInit]);u.preInit.length>0;)u.preInit.pop()();re();var Be;m&&(Be={uncaughtException:process.listeners("uncaughtException").filter(function(J){return!m.uncaughtException.indexOf(J)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(J){return!m.unhandledRejection.indexOf(J)>-1})});var jn;if(typeof WasmBackendModule<"u")jn=WasmBackendModule;else if(typeof a<"u")jn=a;else throw new Error("Could not find wasm module in post.js");if(Be){var Kn=jn._dispose;jn._dispose=function(){Kn(),Be.uncaughtException.forEach(function(J){process.removeListener("uncaughtException",J)}),Be.unhandledRejection.forEach(function(J){process.removeListener("unhandledRejection",J)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModuleThreadedSimd=n)}),Ome=ta((e,t)=>{t.exports.wasmWorkerContents=`"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"
");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};`}),Lme=ta((e,t)=>{var n=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(a){a=a||{};var s=typeof a<"u"?a:{},o,l;s.ready=new Promise(function(ge,De){o=ge,l=De});var c;typeof process<"u"&&process.listeners&&(c={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var d=Object.assign({},s),u=typeof window=="object",h=typeof importScripts=="function",p=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",m="";function f(ge){return s.locateFile?s.locateFile(ge,m):m+ge}var g,x,y;if(p){var b=kI(),v=W6();h?m=v.dirname(m)+"/":m=__dirname+"/",g=(ge,De)=>(ge=$e(ge)?new URL(ge):v.normalize(ge),b.readFileSync(ge,De?void 0:"utf8")),y=ge=>{var De=g(ge,!0);return De.buffer||(De=new Uint8Array(De)),De},x=(ge,De,Ke)=>{ge=$e(ge)?new URL(ge):v.normalize(ge),b.readFile(ge,function(ze,Bt){ze?Ke(ze):De(Bt.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(ge){if(!(ge instanceof le))throw ge}),process.on("unhandledRejection",function(ge){throw ge}),s.inspect=function(){return"[Emscripten Module object]"}}else(u||h)&&(h?m=self.location.href:typeof document<"u"&&document.currentScript&&(m=document.currentScript.src),r&&(m=r),m.indexOf("blob:")!==0?m=m.substr(0,m.replace(/[?#].*/,"").lastIndexOf("/")+1):m="",g=ge=>{var De=new XMLHttpRequest;return De.open("GET",ge,!1),De.send(null),De.responseText},h&&(y=ge=>{var De=new XMLHttpRequest;return De.open("GET",ge,!1),De.responseType="arraybuffer",De.send(null),new Uint8Array(De.response)}),x=(ge,De,Ke)=>{var ze=new XMLHttpRequest;ze.open("GET",ge,!0),ze.responseType="arraybuffer",ze.onload=()=>{if(ze.status==200||ze.status==0&&ze.response){De(ze.response);return}Ke()},ze.onerror=Ke,ze.send(null)});var w=s.print||console.log.bind(console),k=s.printErr||console.warn.bind(console);Object.assign(s,d),d=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&s.quit;var C;s.wasmBinary&&(C=s.wasmBinary),s.noExitRuntime,typeof WebAssembly!="object"&&we("no native wasm support detected");var S,_=!1,I=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function T(ge,De,Ke){De>>>=0;for(var ze=De+Ke,Bt=De;ge[Bt]&&!(Bt>=ze);)++Bt;if(Bt-De>16&&ge.buffer&&I)return I.decode(ge.subarray(De,Bt));for(var Qt="";De<Bt;){var rt=ge[De++];if(!(rt&128)){Qt+=String.fromCharCode(rt);continue}var gt=ge[De++]&63;if((rt&224)==192){Qt+=String.fromCharCode((rt&31)<<6|gt);continue}var en=ge[De++]&63;if((rt&240)==224?rt=(rt&15)<<12|gt<<6|en:rt=(rt&7)<<18|gt<<12|en<<6|ge[De++]&63,rt<65536)Qt+=String.fromCharCode(rt);else{var br=rt-65536;Qt+=String.fromCharCode(55296|br>>10,56320|br&1023)}}return Qt}function A(ge,De){return ge>>>=0,ge?T(q,ge,De):""}function j(ge,De,Ke,ze){if(Ke>>>=0,!(ze>0))return 0;for(var Bt=Ke,Qt=Ke+ze-1,rt=0;rt<ge.length;++rt){var gt=ge.charCodeAt(rt);if(gt>=55296&&gt<=57343){var en=ge.charCodeAt(++rt);gt=65536+((gt&1023)<<10)|en&1023}if(gt<=127){if(Ke>=Qt)break;De[Ke++>>>0]=gt}else if(gt<=2047){if(Ke+1>=Qt)break;De[Ke++>>>0]=192|gt>>6,De[Ke++>>>0]=128|gt&63}else if(gt<=65535){if(Ke+2>=Qt)break;De[Ke++>>>0]=224|gt>>12,De[Ke++>>>0]=128|gt>>6&63,De[Ke++>>>0]=128|gt&63}else{if(Ke+3>=Qt)break;De[Ke++>>>0]=240|gt>>18,De[Ke++>>>0]=128|gt>>12&63,De[Ke++>>>0]=128|gt>>6&63,De[Ke++>>>0]=128|gt&63}}return De[Ke>>>0]=0,Ke-Bt}function D(ge,De,Ke){return j(ge,q,De,Ke)}var F,B,q,$;function L(ge){F=ge,s.HEAP8=B=new Int8Array(ge),s.HEAP16=new Int16Array(ge),s.HEAP32=new Int32Array(ge),s.HEAPU8=q=new Uint8Array(ge),s.HEAPU16=new Uint16Array(ge),s.HEAPU32=$=new Uint32Array(ge),s.HEAPF32=new Float32Array(ge),s.HEAPF64=new Float64Array(ge)}s.INITIAL_MEMORY;var M=[],X=[],G=[];function W(){if(s.preRun)for(typeof s.preRun=="function"&&(s.preRun=[s.preRun]);s.preRun.length;)K(s.preRun.shift());V(M)}function O(){V(X)}function U(){if(s.postRun)for(typeof s.postRun=="function"&&(s.postRun=[s.postRun]);s.postRun.length;)ne(s.postRun.shift());V(G)}function K(ge){M.unshift(ge)}function ce(ge){X.unshift(ge)}function ne(ge){G.unshift(ge)}var te=0,Te=null;function Ae(ge){te++,s.monitorRunDependencies&&s.monitorRunDependencies(te)}function Se(ge){if(te--,s.monitorRunDependencies&&s.monitorRunDependencies(te),te==0&&Te){var De=Te;Te=null,De()}}function we(ge){s.onAbort&&s.onAbort(ge),ge="Aborted("+ge+")",k(ge),_=!0,ge+=". Build with -sASSERTIONS for more info.";var De=new WebAssembly.RuntimeError(ge);throw l(De),De}var Fe="data:application/octet-stream;base64,";function Q(ge){return ge.startsWith(Fe)}function $e(ge){return ge.startsWith("file://")}var Le;Le="tfjs-backend-wasm.wasm",Q(Le)||(Le=f(Le));function Xe(ge){try{if(ge==Le&&C)return new Uint8Array(C);if(y)return y(ge);throw"both async and sync fetching of the wasm failed"}catch(De){we(De)}}function Ye(){if(!C&&(u||h)){if(typeof fetch=="function"&&!$e(Le))return fetch(Le,{credentials:"same-origin"}).then(function(ge){if(!ge.ok)throw"failed to load wasm binary file at '"+Le+"'";return ge.arrayBuffer()}).catch(function(){return Xe(Le)});if(x)return new Promise(function(ge,De){x(Le,function(Ke){ge(new Uint8Array(Ke))},De)})}return Promise.resolve().then(function(){return Xe(Le)})}function Je(){var ge={env:an,wasi_snapshot_preview1:an};function De(rt,gt){var en=rt.exports;s.asm=en,S=s.asm.memory,L(S.buffer),s.asm.__indirect_function_table,ce(s.asm.__wasm_call_ctors),Se()}Ae();function Ke(rt){De(rt.instance)}function ze(rt){return Ye().then(function(gt){return WebAssembly.instantiate(gt,ge)}).then(function(gt){return gt}).then(rt,function(gt){k("failed to asynchronously prepare wasm: "+gt),we(gt)})}function Bt(){return!C&&typeof WebAssembly.instantiateStreaming=="function"&&!Q(Le)&&!$e(Le)&&!p&&typeof fetch=="function"?fetch(Le,{credentials:"same-origin"}).then(function(rt){var gt=WebAssembly.instantiateStreaming(rt,ge);return gt.then(Ke,function(en){return k("wasm streaming compile failed: "+en),k("falling back to ArrayBuffer instantiation"),ze(Ke)})}):ze(Ke)}if(s.instantiateWasm)try{var Qt=s.instantiateWasm(ge,De);return Qt}catch(rt){k("Module.instantiateWasm callback failed with error: "+rt),l(rt)}return Bt().catch(l),{}}function le(ge){this.name="ExitStatus",this.message="Program terminated with exit("+ge+")",this.status=ge}function V(ge){for(;ge.length>0;)ge.shift()(s)}function ee(){we("")}function ve(){return 4294901760}function ke(){return ve()}function Ce(ge,De,Ke){q.copyWithin(ge>>>0,De>>>0,De+Ke>>>0)}function be(ge){try{return S.grow(ge-F.byteLength+65535>>>16),L(S.buffer),1}catch{}}function Ee(ge){var De=q.length;ge=ge>>>0;var Ke=ve();if(ge>Ke)return!1;let ze=(en,br)=>en+(br-en%br)%br;for(var Bt=1;Bt<=4;Bt*=2){var Qt=De*(1+.2/Bt);Qt=Math.min(Qt,ge+100663296);var rt=Math.min(Ke,ze(Math.max(ge,Qt),65536)),gt=be(rt);if(gt)return!0}return!1}function Ue(ge){return 52}function Qe(ge,De,Ke,ze,Bt){return 70}var _t=[null,[],[]];function $t(ge,De){var Ke=_t[ge];De===0||De===10?((ge===1?w:k)(T(Ke,0)),Ke.length=0):Ke.push(De)}function Ve(ge,De,Ke,ze){for(var Bt=0,Qt=0;Qt<Ke;Qt++){var rt=$[De>>>2],gt=$[De+4>>>2];De+=8;for(var en=0;en<gt;en++)$t(ge,q[rt+en>>>0]);Bt+=gt}return $[ze>>>2]=Bt,0}function tt(ge){var De=s["_"+ge];return De}function yt(ge,De){B.set(ge,De>>>0)}function ut(ge,De,Ke,ze,Bt){var Qt={string:qn=>{var fa=0;if(qn!=null&&qn!==0){var xr=(qn.length<<2)+1;fa=Nt(xr),D(qn,fa,xr)}return fa},array:qn=>{var fa=Nt(qn.length);return yt(qn,fa),fa}};function rt(qn){return De==="string"?A(qn):De==="boolean"?!!qn:qn}var gt=tt(ge),en=[],br=0;if(ze)for(var vr=0;vr<ze.length;vr++){var js=Qt[Ke[vr]];js?(br===0&&(br=lt()),en[vr]=js(ze[vr])):en[vr]=ze[vr]}var Mr=gt.apply(null,en);function La(qn){return br!==0&&wt(br),rt(qn)}return Mr=La(Mr),Mr}function qt(ge,De,Ke,ze){Ke=Ke||[];var Bt=Ke.every(rt=>rt==="number"||rt==="boolean"),Qt=De!=="string";return Qt&&Bt&&!ze?tt(ge):function(){return ut(ge,De,Ke,arguments)}}var an={abort:ee,emscripten_get_heap_max:ke,emscripten_memcpy_big:Ce,emscripten_resize_heap:Ee,fd_close:Ue,fd_seek:Qe,fd_write:Ve};Je(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.__wasm_call_ctors).apply(null,arguments)},s._init=function(){return(s._init=s.asm.init).apply(null,arguments)},s._init_with_threads_count=function(){return(s._init_with_threads_count=s.asm.init_with_threads_count).apply(null,arguments)},s._get_threads_count=function(){return(s._get_threads_count=s.asm.get_threads_count).apply(null,arguments)},s._register_tensor=function(){return(s._register_tensor=s.asm.register_tensor).apply(null,arguments)},s._dispose_data=function(){return(s._dispose_data=s.asm.dispose_data).apply(null,arguments)},s._dispose=function(){return(s._dispose=s.asm.dispose).apply(null,arguments)},s._Abs=function(){return(s._Abs=s.asm.Abs).apply(null,arguments)},s._Acos=function(){return(s._Acos=s.asm.Acos).apply(null,arguments)},s._Acosh=function(){return(s._Acosh=s.asm.Acosh).apply(null,arguments)},s._Add=function(){return(s._Add=s.asm.Add).apply(null,arguments)},s._AddN=function(){return(s._AddN=s.asm.AddN).apply(null,arguments)},s._All=function(){return(s._All=s.asm.All).apply(null,arguments)},s._Any=function(){return(s._Any=s.asm.Any).apply(null,arguments)},s._ArgMax=function(){return(s._ArgMax=s.asm.ArgMax).apply(null,arguments)},s._ArgMin=function(){return(s._ArgMin=s.asm.ArgMin).apply(null,arguments)},s._Asin=function(){return(s._Asin=s.asm.Asin).apply(null,arguments)},s._Asinh=function(){return(s._Asinh=s.asm.Asinh).apply(null,arguments)},s._Atan=function(){return(s._Atan=s.asm.Atan).apply(null,arguments)},s._Atan2=function(){return(s._Atan2=s.asm.Atan2).apply(null,arguments)},s._Atanh=function(){return(s._Atanh=s.asm.Atanh).apply(null,arguments)},s._AvgPool=function(){return(s._AvgPool=s.asm.AvgPool).apply(null,arguments)},s._AvgPool3D=function(){return(s._AvgPool3D=s.asm.AvgPool3D).apply(null,arguments)},s._AvgPool3DGrad=function(){return(s._AvgPool3DGrad=s.asm.AvgPool3DGrad).apply(null,arguments)},s._AvgPoolGrad=function(){return(s._AvgPoolGrad=s.asm.AvgPoolGrad).apply(null,arguments)},s._BatchMatMul=function(){return(s._BatchMatMul=s.asm.BatchMatMul).apply(null,arguments)},s._Bincount=function(){return(s._Bincount=s.asm.Bincount).apply(null,arguments)},s._BitwiseAnd=function(){return(s._BitwiseAnd=s.asm.BitwiseAnd).apply(null,arguments)},s._Ceil=function(){return(s._Ceil=s.asm.Ceil).apply(null,arguments)},s._ClipByValue=function(){return(s._ClipByValue=s.asm.ClipByValue).apply(null,arguments)},s._Conv2D=function(){return(s._Conv2D=s.asm.Conv2D).apply(null,arguments)},s._Conv2DBackpropInput=function(){return(s._Conv2DBackpropInput=s.asm.Conv2DBackpropInput).apply(null,arguments)},s._Conv3D=function(){return(s._Conv3D=s.asm.Conv3D).apply(null,arguments)},s._Conv3DBackpropFilterV2=function(){return(s._Conv3DBackpropFilterV2=s.asm.Conv3DBackpropFilterV2).apply(null,arguments)},s._Conv3DBackpropInputV2=function(){return(s._Conv3DBackpropInputV2=s.asm.Conv3DBackpropInputV2).apply(null,arguments)},s._Cos=function(){return(s._Cos=s.asm.Cos).apply(null,arguments)},s._Cosh=function(){return(s._Cosh=s.asm.Cosh).apply(null,arguments)},s._CropAndResize=function(){return(s._CropAndResize=s.asm.CropAndResize).apply(null,arguments)},s._Cumprod=function(){return(s._Cumprod=s.asm.Cumprod).apply(null,arguments)},s._Cumsum=function(){return(s._Cumsum=s.asm.Cumsum).apply(null,arguments)},s._DenseBincount=function(){return(s._DenseBincount=s.asm.DenseBincount).apply(null,arguments)},s._DepthToSpace=function(){return(s._DepthToSpace=s.asm.DepthToSpace).apply(null,arguments)},s._DepthwiseConv2dNative=function(){return(s._DepthwiseConv2dNative=s.asm.DepthwiseConv2dNative).apply(null,arguments)},s._Diag=function(){return(s._Diag=s.asm.Diag).apply(null,arguments)},s._Dilation2D=function(){return(s._Dilation2D=s.asm.Dilation2D).apply(null,arguments)},s._Dilation2DBackpropFilter=function(){return(s._Dilation2DBackpropFilter=s.asm.Dilation2DBackpropFilter).apply(null,arguments)},s._Dilation2DBackpropInput=function(){return(s._Dilation2DBackpropInput=s.asm.Dilation2DBackpropInput).apply(null,arguments)},s._Elu=function(){return(s._Elu=s.asm.Elu).apply(null,arguments)},s._EluGrad=function(){return(s._EluGrad=s.asm.EluGrad).apply(null,arguments)},s._Equal=function(){return(s._Equal=s.asm.Equal).apply(null,arguments)},s._Erf=function(){return(s._Erf=s.asm.Erf).apply(null,arguments)},s._Exp=function(){return(s._Exp=s.asm.Exp).apply(null,arguments)},s._Expm1=function(){return(s._Expm1=s.asm.Expm1).apply(null,arguments)},s._FlipLeftRight=function(){return(s._FlipLeftRight=s.asm.FlipLeftRight).apply(null,arguments)},s._Floor=function(){return(s._Floor=s.asm.Floor).apply(null,arguments)},s._FloorDiv=function(){return(s._FloorDiv=s.asm.FloorDiv).apply(null,arguments)},s._FusedBatchNorm=function(){return(s._FusedBatchNorm=s.asm.FusedBatchNorm).apply(null,arguments)},s._FusedConv2D=function(){return(s._FusedConv2D=s.asm.FusedConv2D).apply(null,arguments)},s._FusedDepthwiseConv2D=function(){return(s._FusedDepthwiseConv2D=s.asm.FusedDepthwiseConv2D).apply(null,arguments)},s._Gather=function(){return(s._Gather=s.asm.Gather).apply(null,arguments)},s._GatherNd=function(){return(s._GatherNd=s.asm.GatherNd).apply(null,arguments)},s._Greater=function(){return(s._Greater=s.asm.Greater).apply(null,arguments)},s._GreaterEqual=function(){return(s._GreaterEqual=s.asm.GreaterEqual).apply(null,arguments)},s._IsFinite=function(){return(s._IsFinite=s.asm.IsFinite).apply(null,arguments)},s._IsInf=function(){return(s._IsInf=s.asm.IsInf).apply(null,arguments)},s._IsNan=function(){return(s._IsNan=s.asm.IsNan).apply(null,arguments)},s._LRN=function(){return(s._LRN=s.asm.LRN).apply(null,arguments)},s._LRNGrad=function(){return(s._LRNGrad=s.asm.LRNGrad).apply(null,arguments)},s._LeakyRelu=function(){return(s._LeakyRelu=s.asm.LeakyRelu).apply(null,arguments)},s._Less=function(){return(s._Less=s.asm.Less).apply(null,arguments)},s._LessEqual=function(){return(s._LessEqual=s.asm.LessEqual).apply(null,arguments)},s._LinSpace=function(){return(s._LinSpace=s.asm.LinSpace).apply(null,arguments)},s._Log=function(){return(s._Log=s.asm.Log).apply(null,arguments)},s._Log1p=function(){return(s._Log1p=s.asm.Log1p).apply(null,arguments)},s._LogicalAnd=function(){return(s._LogicalAnd=s.asm.LogicalAnd).apply(null,arguments)},s._LogicalNot=function(){return(s._LogicalNot=s.asm.LogicalNot).apply(null,arguments)},s._LogicalOr=function(){return(s._LogicalOr=s.asm.LogicalOr).apply(null,arguments)},s._LogicalXor=function(){return(s._LogicalXor=s.asm.LogicalXor).apply(null,arguments)},s._Max=function(){return(s._Max=s.asm.Max).apply(null,arguments)},s._MaxPool=function(){return(s._MaxPool=s.asm.MaxPool).apply(null,arguments)},s._MaxPool3D=function(){return(s._MaxPool3D=s.asm.MaxPool3D).apply(null,arguments)},s._MaxPool3DGrad=function(){return(s._MaxPool3DGrad=s.asm.MaxPool3DGrad).apply(null,arguments)},s._MaxPoolGrad=function(){return(s._MaxPoolGrad=s.asm.MaxPoolGrad).apply(null,arguments)},s._MaxPoolWithArgmax=function(){return(s._MaxPoolWithArgmax=s.asm.MaxPoolWithArgmax).apply(null,arguments)},s._Maximum=function(){return(s._Maximum=s.asm.Maximum).apply(null,arguments)},s._Mean=function(){return(s._Mean=s.asm.Mean).apply(null,arguments)},s._Min=function(){return(s._Min=s.asm.Min).apply(null,arguments)},s._Minimum=function(){return(s._Minimum=s.asm.Minimum).apply(null,arguments)},s._MirrorPad=function(){return(s._MirrorPad=s.asm.MirrorPad).apply(null,arguments)},s._Mod=function(){return(s._Mod=s.asm.Mod).apply(null,arguments)},s._Multinomial=function(){return(s._Multinomial=s.asm.Multinomial).apply(null,arguments)},s._Multiply=function(){return(s._Multiply=s.asm.Multiply).apply(null,arguments)},s._Neg=function(){return(s._Neg=s.asm.Neg).apply(null,arguments)},s._NonMaxSuppressionV3=function(){return(s._NonMaxSuppressionV3=s.asm.NonMaxSuppressionV3).apply(null,arguments)},s._NonMaxSuppressionV4=function(){return(s._NonMaxSuppressionV4=s.asm.NonMaxSuppressionV4).apply(null,arguments)},s._NonMaxSuppressionV5=function(){return(s._NonMaxSuppressionV5=s.asm.NonMaxSuppressionV5).apply(null,arguments)},s._NotEqual=function(){return(s._NotEqual=s.asm.NotEqual).apply(null,arguments)},s._OneHot=function(){return(s._OneHot=s.asm.OneHot).apply(null,arguments)},s._PadV2=function(){return(s._PadV2=s.asm.PadV2).apply(null,arguments)},s._Pow=function(){return(s._Pow=s.asm.Pow).apply(null,arguments)},s._Prelu=function(){return(s._Prelu=s.asm.Prelu).apply(null,arguments)},s._Prod=function(){return(s._Prod=s.asm.Prod).apply(null,arguments)},s._RealDiv=function(){return(s._RealDiv=s.asm.RealDiv).apply(null,arguments)},s._Reciprocal=function(){return(s._Reciprocal=s.asm.Reciprocal).apply(null,arguments)},s._Relu=function(){return(s._Relu=s.asm.Relu).apply(null,arguments)},s._Relu6=function(){return(s._Relu6=s.asm.Relu6).apply(null,arguments)},s._ResizeBilinear=function(){return(s._ResizeBilinear=s.asm.ResizeBilinear).apply(null,arguments)},s._ResizeBilinearGrad=function(){return(s._ResizeBilinearGrad=s.asm.ResizeBilinearGrad).apply(null,arguments)},s._ResizeNearestNeighbor=function(){return(s._ResizeNearestNeighbor=s.asm.ResizeNearestNeighbor).apply(null,arguments)},s._ResizeNearestNeighborGrad=function(){return(s._ResizeNearestNeighborGrad=s.asm.ResizeNearestNeighborGrad).apply(null,arguments)},s._Reverse=function(){return(s._Reverse=s.asm.Reverse).apply(null,arguments)},s._RotateWithOffset=function(){return(s._RotateWithOffset=s.asm.RotateWithOffset).apply(null,arguments)},s._Round=function(){return(s._Round=s.asm.Round).apply(null,arguments)},s._Rsqrt=function(){return(s._Rsqrt=s.asm.Rsqrt).apply(null,arguments)},s._ScatterNd=function(){return(s._ScatterNd=s.asm.ScatterNd).apply(null,arguments)},s._SearchSorted=function(){return(s._SearchSorted=s.asm.SearchSorted).apply(null,arguments)},s._SelectV2=function(){return(s._SelectV2=s.asm.SelectV2).apply(null,arguments)},s._Selu=function(){return(s._Selu=s.asm.Selu).apply(null,arguments)},s._Sigmoid=function(){return(s._Sigmoid=s.asm.Sigmoid).apply(null,arguments)},s._Sign=function(){return(s._Sign=s.asm.Sign).apply(null,arguments)},s._Sin=function(){return(s._Sin=s.asm.Sin).apply(null,arguments)},s._Sinh=function(){return(s._Sinh=s.asm.Sinh).apply(null,arguments)},s._Softmax=function(){return(s._Softmax=s.asm.Softmax).apply(null,arguments)},s._Softplus=function(){return(s._Softplus=s.asm.Softplus).apply(null,arguments)},s._SparseFillEmptyRows=function(){return(s._SparseFillEmptyRows=s.asm.SparseFillEmptyRows).apply(null,arguments)},s._SparseReshape=function(){return(s._SparseReshape=s.asm.SparseReshape).apply(null,arguments)},s._SparseSegmentReduction=function(){return(s._SparseSegmentReduction=s.asm.SparseSegmentReduction).apply(null,arguments)},s._SparseToDense=function(){return(s._SparseToDense=s.asm.SparseToDense).apply(null,arguments)},s._Sqrt=function(){return(s._Sqrt=s.asm.Sqrt).apply(null,arguments)},s._Square=function(){return(s._Square=s.asm.Square).apply(null,arguments)},s._SquaredDifference=function(){return(s._SquaredDifference=s.asm.SquaredDifference).apply(null,arguments)},s._Step=function(){return(s._Step=s.asm.Step).apply(null,arguments)},s._StridedSlice=function(){return(s._StridedSlice=s.asm.StridedSlice).apply(null,arguments)},s._Sub=function(){return(s._Sub=s.asm.Sub).apply(null,arguments)},s._Sum=function(){return(s._Sum=s.asm.Sum).apply(null,arguments)},s._Tan=function(){return(s._Tan=s.asm.Tan).apply(null,arguments)},s._Tanh=function(){return(s._Tanh=s.asm.Tanh).apply(null,arguments)},s._TensorScatterUpdate=function(){return(s._TensorScatterUpdate=s.asm.TensorScatterUpdate).apply(null,arguments)},s._Tile=function(){return(s._Tile=s.asm.Tile).apply(null,arguments)},s._TopK=function(){return(s._TopK=s.asm.TopK).apply(null,arguments)},s._Transform=function(){return(s._Transform=s.asm.Transform).apply(null,arguments)},s._Transpose=function(){return(s._Transpose=s.asm.Transpose).apply(null,arguments)},s.__FusedMatMul=function(){return(s.__FusedMatMul=s.asm._FusedMatMul).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.malloc).apply(null,arguments)},s._free=function(){return(s._free=s.asm.free).apply(null,arguments)},s.___errno_location=function(){return(s.___errno_location=s.asm.__errno_location).apply(null,arguments)};var lt=s.stackSave=function(){return(lt=s.stackSave=s.asm.stackSave).apply(null,arguments)},wt=s.stackRestore=function(){return(wt=s.stackRestore=s.asm.stackRestore).apply(null,arguments)},Nt=s.stackAlloc=function(){return(Nt=s.stackAlloc=s.asm.stackAlloc).apply(null,arguments)};s.dynCall_iijjiiii=function(){return(s.dynCall_iijjiiii=s.asm.dynCall_iijjiiii).apply(null,arguments)},s.dynCall_jiji=function(){return(s.dynCall_jiji=s.asm.dynCall_jiji).apply(null,arguments)},s.cwrap=qt;var Kt;Te=function ge(){Kt||jt(),Kt||(Te=ge)};function jt(ge){if(te>0||(W(),te>0))return;function De(){Kt||(Kt=!0,s.calledRun=!0,!_&&(O(),o(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),U()))}s.setStatus?(s.setStatus("Running..."),setTimeout(function(){setTimeout(function(){s.setStatus("")},1),De()},1)):De()}if(s.preInit)for(typeof s.preInit=="function"&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();jt();var Zt;c&&(Zt={uncaughtException:process.listeners("uncaughtException").filter(function(ge){return!c.uncaughtException.indexOf(ge)>-1}),unhandledRejection:process.listeners("unhandledRejection").filter(function(ge){return!c.unhandledRejection.indexOf(ge)>-1})});var An;if(typeof a<"u")An=a;else if(typeof WasmBackendModuleThreadedSimd<"u")An=WasmBackendModuleThreadedSimd;else throw new Error("Could not find wasm module in post.js");if(Zt){var it=An._dispose;An._dispose=function(){it(),Zt.uncaughtException.forEach(function(ge){process.removeListener("uncaughtException",ge)}),Zt.unhandledRejection.forEach(function(ge){process.removeListener("unhandledRejection",ge)})}}return a.ready}})();typeof e=="object"&&typeof t=="object"?t.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof e=="object"&&(e.WasmBackendModule=n)}),$1=class{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},vb=class{refCount(e){return Es("refCount")}incRef(e){return Es("incRef")}timerAvailable(){return!0}time(e){return Es("time")}read(e){return Es("read")}readSync(e){return Es("readSync")}readToGPU(e,t){return Es("readToGPU")}numDataIds(){return Es("numDataIds")}disposeData(e,t){return Es("disposeData")}write(e,t,n){return Es("write")}move(e,t,n,r,a){return Es("move")}createTensorFromGPUData(e,t,n){return Es("createTensorFromGPUData")}memory(){return Es("memory")}floatPrecision(){return Es("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Es("dispose")}};function Es(e){throw new Error(`'${e}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function U6(e){let t=e.length,n=0;for(;t>0;)n=Math.random()*t|0,t--,D0(e,t,n)}function zme(e,t){if(e.length!==t.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${e.length}Second array length was ${t.length}`);let n=e.length,r=0;for(;n>0;)r=Math.random()*n|0,n--,D0(e,n,r),D0(t,n,r)}function Fy(e,t,n){return Math.max(e,Math.min(t,n))}function Bme(e){return e%2===0?e:e+1}function D0(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function Wme(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t}function Ume(e,t){let n=Math.random();return t*n+(1-n)*e}function Vme(e,t){let n=0;for(let r=0;r<e.length;r++){let a=Number(e[r])-Number(t[r]);n+=a*a}return n}function Y(e,t){if(!e)throw new Error(typeof t=="string"?t:t())}function ns(e,t,n=""){Y(Jl(e,t),()=>n+` Shapes ${e} and ${t} must match`)}function Sh(e){Y(e!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ir(e){if(e.length===0)return 1;let t=e[0];for(let n=1;n<e.length;n++)t*=e[n];return t}function Hme(e){return e.length===0}function V6(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==null&&t[n]!==null&&e[n]!==t[n])return!1;return!0}function Jl(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function uf(e){return e%1===0}function Gme(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;{let t=Math.exp(2*e);return(t-1)/(t+1)}}function qme(e){let t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Kme(e){let t=new Uint32Array(e);for(let n=0;n<e;++n)t[n]=n;return U6(t),t}function fy(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Yme(e,t=a=>0,n,r){return new Promise((a,s)=>{let o=0,l=()=>{if(e()){a();return}o++;let c=t(o);if(n!=null&&o>=n){s();return}r!=null?r(l,c):setTimeout(l,c)};l()})}function Xme(e,t){let n=1,r=-1;for(let s=0;s<e.length;++s)if(e[s]>=0)n*=e[s];else if(e[s]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${s}`);r=s}else if(e[s]<0)throw Error(`Shapes can not be < 0. Found ${e[s]} at dim ${s}`);if(r===-1){if(t>0&&t!==n)throw Error(`Size(${t}) must match the product of shape ${e}`);return e}if(n===0)throw Error(`Cannot infer the missing size in [${e}] when there are 0 elements`);if(t%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${t} / ${n}`);let a=e.slice();return a[r]=t/n,a}function Hi(e,t){let n=t.length;return e=e==null?t.map((r,a)=>a):[].concat(e),Y(e.every(r=>r>=-n&&r<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${e}`),Y(e.every(r=>uf(r)),()=>`All values in axis param must be integers but got axis ${e}`),e.map(r=>r<0?n+r:r)}function H6(e,t){let n=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,s=t==null||a?null:Hi(t,e).sort(),o=0;for(let l=0;l<e.length;++l){if(s!=null){if(s[o]===l&&e[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${e[l]}' is not 1`);(s[o]==null||s[o]>l)&&e[l]===1&&(n.push(e[l]),r.push(l)),s[o]<=l&&o++}e[l]!==1&&(n.push(e[l]),r.push(l))}return{newShape:n,keptDims:r}}function G6(e,t){return SI(e,t)}function SI(e,t){let n=null;if(e==null||e==="float32")n=new Float32Array(t);else if(e==="int32")n=new Int32Array(t);else if(e==="bool")n=new Uint8Array(t);else if(e==="string")n=new Array(t);else throw new Error(`Unknown data type ${e}`);return n}function q6(e,t){for(let n=0;n<e.length;n++){let r=e[n];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${t} being uploaded contains ${r}.`)}}function K6(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function Zme(e,t){return!(t==="complex64"||t==="float32"&&e!=="complex64"||t==="int32"&&e!=="float32"&&e!=="complex64"||t==="bool"&&e==="bool")}function M0(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error(`Unknown dtype ${e}`)}function Y6(e){if(e==null)return 0;let t=0;return e.forEach(n=>t+=n.length),t}function Lc(e){return typeof e=="string"||e instanceof String}function X6(e){return typeof e=="boolean"}function Z6(e){return typeof e=="number"}function wb(e){return Array.isArray(e)?wb(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Z6(e)?"float32":Lc(e)?"string":X6(e)?"bool":"float32"}function iu(e){return!!(e&&e.constructor&&e.call&&e.apply)}function $0(e,t){for(let n=t;n<e;++n)if(e%n===0)return n;return e}function Of(e){let t=e.length;if(t<2)return[];let n=new Array(t-1);n[t-2]=e[t-1];for(let r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Q6(e,t,n,r=!1){let a=new Array;if(t.length===1){let s=t[0]*(r?2:1);for(let o=0;o<s;o++)a[o]=n[e+o]}else{let s=t[0],o=t.slice(1),l=o.reduce((c,d)=>c*d)*(r?2:1);for(let c=0;c<s;c++)a[c]=Q6(e+c*l,o,n,r)}return a}function Dm(e,t,n=!1){if(e.length===0)return t[0];let r=e.reduce((a,s)=>a*s)*(n?2:1);if(r===0)return[];if(r!==t.length)throw new Error(`[${e}] does not match the input size ${t.length}${n?" for a complex tensor":""}.`);return Q6(0,e,t,n)}function Qme(e,t){if(Array.isArray(e))return e;if(t==="float32")return e instanceof Float32Array?e:new Float32Array(e);if(t==="int32")return e instanceof Int32Array?e:new Int32Array(e);if(t==="bool"||t==="string")return Uint8Array.from(new Int32Array(e));throw new Error(`Unknown dtype ${t}`)}function CI(e,t){let n=F1(e,t);for(let r=0;r<n.length;r++)n[r]=1;return n}function F1(e,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool")return new Uint8Array(e);throw new Error(`Unknown data type ${t}`)}function Jme(e,t){let n=e.reduce((r,a)=>r*a,1);if(t==null||t==="float32")return Dm(e,new Float32Array(n));if(t==="int32")return Dm(e,new Int32Array(n));if(t==="bool")return Dm(e,new Uint8Array(n));throw new Error(`Unknown data type ${t}`)}function Zs(e){e.forEach(t=>{Y(Number.isInteger(t)&&t>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${e}].`)})}function efe(e,t,n){if(t===0)return 0;if(t===1)return e[0];let r=e[e.length-1];for(let a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function tfe(e,t,n){if(t===0)return[];if(t===1)return[e];let r=new Array(t);for(let a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function P1(e){return e&&e.then&&typeof e.then=="function"}var E3="tfjsflags",J6=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=nfe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(_e().getBool("IS_TEST")||_e().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let r=this.urlFlags[e];_e().getBool("IS_TEST")||_e().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(P1(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);E3 in e&&e[E3].split(",").forEach(t=>{let[n,r]=t.split(":");this.urlFlags[n]=afe(n,r)})}};function nfe(e){let t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...r)=>(rfe(t,r[0],r[1]),r.join("="))),t}function rfe(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function afe(e,t){let n=t.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:t}function _e(){return _I}var _I=null;function sfe(e){_I=e}var LS;function eW(){if(LS==null){let e;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else if(typeof self<"u")e=self;else throw new Error("Could not find a global object");LS=e}return LS}function ife(){let e=eW();return e._tfGlobals==null&&(e._tfGlobals=new Map),e._tfGlobals}function jI(e,t){let n=ife();if(n.has(e))return n.get(e);{let r=t();return n.set(e,r),n.get(e)}}var Lf="Abs",Ch="Acos",_h="Acosh",_u="Add",jh="AddN",zf="All",Bf="Any",Wf="ArgMax",Uf="ArgMin",Ih="Asin",Th="Asinh",Eh="Atan",Ah="Atanh",Rh="Atan2",Dh="AvgPool",Nb="AvgPoolGrad",Vf="AvgPool3D",kb="AvgPool3DGrad",Mh="BatchMatMul",Hf="BatchToSpaceND",Gf="Bincount",qf="BitwiseAnd",tW="BroadcastTo",Sb="BroadcastArgs",$h="Cast",Fh="Ceil",ju="ClipByValue",O1="Complex",Cb="ComplexAbs",Kf="Concat",Ph="Conv2D",L1="Conv2DBackpropFilter",Oh="Conv2DBackpropInput",Lh="Conv3D",Yf="Conv3DBackpropFilterV2",Xf="Conv3DBackpropInputV2",zh="Cos",Bh="Cosh",Zf="Cumprod",Wh="Cumsum",Qf="CropAndResize",_b="DenseBincount",Jf="DepthToSpace",Uh="DepthwiseConv2dNative",z1="DepthwiseConv2dNativeBackpropFilter",B1="DepthwiseConv2dNativeBackpropInput",jb="Diag",Vh="Dilation2D",df="Dilation2DBackpropInput",hf="Dilation2DBackpropFilter",W1="Draw",Hh="RealDiv",U1="Einsum",Gh="Elu",eg="EluGrad",qh="Erf",tg="Equal",Kh="Exp",ng="ExpandDims",Yh="Expm1",V1="FFT",Ib="Fill",rg="FlipLeftRight",Xh="Floor",Zh="FloorDiv",Qh="FusedBatchNorm",ag="GatherV2",sg="GatherNd",ig="Greater",Jh="GreaterEqual",ep="Identity",H1="IFFT",G1="Imag",tp="IsFinite",np="IsInf",rp="IsNan",ap="LeakyRelu",og="Less",lg="LessEqual",cg="LinSpace",sp="Log",ip="Log1p",ug="LogicalAnd",dg="LogicalNot",hg="LogicalOr",nW="LogicalXor",rW="LogSoftmax",ofe="LowerBound",op="LRN",pg="LRNGrad",lfe="MatrixBandPart",lp="Max",cp="Maximum",up="MaxPool",Tb="MaxPoolGrad",mg="MaxPool3D",Eb="MaxPool3DGrad",Ab="MaxPoolWithArgmax",dp="Mean",hp="Min",pp="Minimum",mp="MirrorPad",fp="Mod",fg="Multinomial",gp="Multiply",gg="Neg",xg="NotEqual",yg="NonMaxSuppressionV3",bg="NonMaxSuppressionV4",vg="NonMaxSuppressionV5",wg="OnesLike",xp="OneHot",Ng="Pack",yp="PadV2",cfe="Pool",bp="Pow",vp="Prelu",wp="Prod",q1="RaggedGather",K1="RaggedRange",Y1="RaggedTensorToTensor",Rb="Range",X1="Real",Np="Reciprocal",kp="Relu",kg="Reshape",Sp="ResizeNearestNeighbor",Sg="ResizeNearestNeighborGrad",Cp="ResizeBilinear",Cg="ResizeBilinearGrad",_p="Relu6",jp="Reverse",Ip="Round",Tp="Rsqrt",_g="ScatterNd",jg="TensorScatterUpdate",Ig="SearchSorted",Tg="Select",Ep="Selu",Eg="Slice",Ap="Sin",Rp="Sinh",Dp="Sign",Mp="Sigmoid",$p="Softplus",Fp="Sqrt",Pp="Sum",Ag="SpaceToBatchND",Rg="SplitV",Op="Softmax",Db="SparseFillEmptyRows",Dg="SparseReshape",Mb="SparseSegmentMean",$b="SparseSegmentSum",Mg="SparseToDense",Lp="SquaredDifference",Fb="Square",Pb="StaticRegexReplace",$g="StridedSlice",Ob="StringNGrams",Lb="StringSplit",zb="StringToHashBucketFast",zp="Sub",Bp="Tan",Wp="Tanh",Iu="Tile",Fg="TopK",Pg="Transform",Fl="Transpose",Bb="Unique",Og="Unpack",Wb="UnsortedSegmentSum",ufe="UpperBound",Lg="ZerosLike",Tu="Step",F0="FromPixels",zg="RotateWithOffset",th="_FusedMatMul",nh="FusedConv2D",rh="FusedDepthwiseConv2D";function jc(...e){_e().getBool("IS_TEST")||_e().getBool("PROD")||console.warn(...e)}function dfe(...e){_e().getBool("IS_TEST")||_e().getBool("PROD")||console.log(...e)}var pf=jI("kernelRegistry",()=>new Map),Py=jI("gradRegistry",()=>new Map);function Oy(e,t){let n=II(e,t);return pf.get(n)}function jC(e){return Py.get(e)}function P0(e){let t=pf.entries(),n=[];for(;;){let{done:r,value:a}=t.next();if(r)break;let[s,o]=a,[l]=s.split("_");l===e&&n.push(o)}return n}function Ub(e){let{kernelName:t,backendName:n}=e,r=II(t,n);pf.has(r)&&jc(`The kernel '${t}' for backend '${n}' is already registered`),pf.set(r,e)}function aW(e){let{kernelName:t}=e;Py.has(t)&&_e().getBool("DEBUG")&&jc(`Overriding the gradient for '${t}'`),Py.set(t,e)}function hfe(e,t){let n=II(e,t);if(!pf.has(n))throw new Error(`The kernel '${e}' for backend '${t}' is not registered`);pf.delete(n)}function pfe(e){if(!Py.has(e))throw new Error(`The gradient '${e}' for backend is not registered`);Py.delete(e)}function mfe(e,t){P0(e).forEach(n=>{let r=Object.assign({},n,{backendName:t});Ub(r)})}function II(e,t){return`${t}_${e}`}var E={};nn(E,{arraysEqual:()=>Jl,arraysEqualWithNull:()=>V6,assert:()=>Y,assertNonNegativeIntegerDimensions:()=>Zs,assertNonNull:()=>Sh,assertShapesMatch:()=>ns,bytesFromStringArray:()=>Y6,bytesPerElement:()=>M0,checkConversionForErrors:()=>q6,clamp:()=>Fy,computeStrides:()=>Of,convertBackendValuesAndArrayBuffer:()=>Qme,createScalarValue:()=>vfe,createShuffledIndices:()=>Kme,decodeString:()=>O0,distSquared:()=>Vme,encodeString:()=>Hb,fetch:()=>Nfe,fingerPrint64:()=>bfe,flatten:()=>ou,getArrayFromDType:()=>SI,getTypedArrayFromDType:()=>G6,hasEncodingLoss:()=>Zme,hexToLong:()=>Vb,indexToLoc:()=>tfe,inferDtype:()=>wb,inferFromImplicitShape:()=>Xme,isBoolean:()=>X6,isFunction:()=>iu,isInt:()=>uf,isNumber:()=>Z6,isPromise:()=>P1,isScalarShape:()=>Hme,isString:()=>Lc,isTypedArray:()=>Ca,isValidDtype:()=>K6,locToIndex:()=>efe,makeOnesTypedArray:()=>CI,makeZerosNestedTypedArray:()=>Jme,makeZerosTypedArray:()=>F1,nearestDivisor:()=>$0,nearestLargerEven:()=>Bme,now:()=>Ly,parseAxisParam:()=>Hi,randUniform:()=>Ume,repeatedTry:()=>Yme,rightPad:()=>fy,shuffle:()=>U6,shuffleCombo:()=>zme,sizeFromShape:()=>ir,sizeToSquarishShape:()=>qme,squeezeShape:()=>H6,sum:()=>Wme,swap:()=>D0,tanh:()=>Gme,toNestedArray:()=>Dm,toTypedArray:()=>Z1});function sW(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}var A3=Cu(kme()),ld=A3.default||A3;function Vb(e){return ld.fromString(e,!0,16)}var iW=Vb("c3a5c85c97cb3127"),ad=Vb("b492b66fbe98f273"),qa=Vb("9ae16a3b2f90404f");function IC(e){return e.xor(e.shru(47))}function oW(e,t,n){let r=e.slice(t,t+n);return ld.fromBytes(Array.from(r),!0,!0)}function Sr(e,t){return oW(e,t,8)}function R3(e,t){return oW(e,t,4)}function Sa(e,t){return t===0?e:e.shru(t).or(e.shl(64-t))}function Xc(e,t,n=Vb("9ddfea08eb382d69")){let r=e.xor(t).mul(n);r=r.xor(r.shru(47));let a=t.xor(r).mul(n);return a=a.xor(a.shru(47)),a=a.mul(n),a}function ffe(e,t,n,r,a,s){a=a.add(e),s=Sa(s.add(a).add(r),21);let o=a;return a=a.add(t),a=a.add(n),s=s.add(Sa(a,44)),[a.add(r),s.add(o)]}function Zv(e,t,n,r){return ffe(Sr(e,t),Sr(e,t+8),Sr(e,t+16),Sr(e,t+24),n,r)}function gfe(e,t=e.length){if(t>=8){let n=qa.add(t*2),r=Sr(e,0).add(qa),a=Sr(e,t-8),s=Sa(a,37).mul(n).add(r),o=Sa(r,25).add(a).mul(n);return Xc(s,o,n)}if(t>=4){let n=qa.add(t*2),r=R3(e,0);return Xc(r.shl(3).add(t),R3(e,t-4),n)}if(t>0){let n=e[0],r=e[t>>1],a=e[t-1],s=n+(r<<8),o=t+(a<<2);return IC(qa.mul(s).xor(iW.mul(o))).mul(qa)}return qa}function xfe(e,t=e.length){let n=qa.add(t*2),r=Sr(e,0).mul(ad),a=Sr(e,8),s=Sr(e,t-8).mul(n),o=Sr(e,t-16).mul(qa);return Xc(Sa(r.add(a),43).add(Sa(s,30)).add(o),r.add(Sa(a.add(qa),18)).add(s),n)}function yfe(e,t=e.length){let n=qa.add(t*2),r=Sr(e,0).mul(qa),a=Sr(e,8),s=Sr(e,t-8).mul(n),o=Sr(e,t-16).mul(qa),l=Sa(r.add(a),43).add(Sa(s,30)).add(o),c=Xc(l,r.add(Sa(a.add(qa),18)).add(s),n),d=Sr(e,16).mul(n),u=Sr(e,24),h=l.add(Sr(e,t-32)).mul(n),p=c.add(Sr(e,t-24)).mul(n);return Xc(Sa(d.add(u),43).add(Sa(h,30)).add(p),d.add(Sa(u.add(r),18)).add(h),n)}function bfe(e,t=e.length){let n=ld.fromNumber(81,!0);if(t<=32)return t<=16?gfe(e,t):xfe(e,t);if(t<=64)return yfe(e,t);let r=n,a=n.mul(ad).add(113),s=IC(a.mul(qa).add(113)).mul(qa),o=[ld.UZERO,ld.UZERO],l=[ld.UZERO,ld.UZERO];r=r.mul(qa).add(Sr(e,0));let c=0,d=(t-1>>6)*64,u=d+(t-1&63)-63;do r=Sa(r.add(a).add(o[0]).add(Sr(e,c+8)),37).mul(ad),a=Sa(a.add(o[1]).add(Sr(e,c+48)),42).mul(ad),r=r.xor(l[1]),a=a.add(o[0]).add(Sr(e,c+40)),s=Sa(s.add(l[0]),33).mul(ad),o=Zv(e,c,o[1].mul(ad),r.add(l[0])),l=Zv(e,c+32,s.add(l[1]),a.add(Sr(e,c+16))),[s,r]=[r,s],c+=64;while(c!==d);let h=ad.add(s.and(255).shl(1));return c=u,l[0]=l[0].add(t-1&63),o[0]=o[0].add(l[0]),l[0]=l[0].add(o[0]),r=Sa(r.add(a).add(o[0]).add(Sr(e,c+8)),37).mul(h),a=Sa(a.add(o[1]).add(Sr(e,c+48)),42).mul(h),r=r.xor(l[1].mul(9)),a=a.add(o[0].mul(9).add(Sr(e,c+40))),s=Sa(s.add(l[0]),33).mul(h),o=Zv(e,c,o[1].mul(h),r.add(l[0])),l=Zv(e,c+32,s.add(l[1]),a.add(Sr(e,c+16))),[s,r]=[r,s],Xc(Xc(o[0],l[0],h).add(IC(a).mul(iW)).add(s),Xc(o[1],l[1],h).add(r),h)}function vfe(e,t){return t==="string"?Hb(e):Z1([e],t)}function wfe(e,t){return e instanceof Float32Array&&t==="float32"||e instanceof Int32Array&&t==="int32"||e instanceof Uint8Array&&t==="bool"}function Z1(e,t){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ou(e)),_e().getBool("DEBUG")&&q6(e,t),wfe(e,t))return e;if(t==null||t==="float32"||t==="complex64")return new Float32Array(e);if(t==="int32")return new Int32Array(e);if(t==="bool"){let n=new Uint8Array(e.length);for(let r=0;r<n.length;++r)Math.round(e[r])!==0&&(n[r]=1);return n}else throw new Error(`Unknown data type ${t}`)}function Ly(){return _e().platform.now()}function Nfe(e,t){return _e().platform.fetch(e,t)}function Hb(e,t="utf-8"){return t=t||"utf-8",_e().platform.encode(e,t)}function O0(e,t="utf-8"){return t=t||"utf-8",_e().platform.decode(e,t)}function Ca(e){return _e().platform.isTypedArray!=null?_e().platform.isTypedArray(e):sW(e)}function ou(e,t=[],n=!1){if(t==null&&(t=[]),typeof e=="boolean"||typeof e=="number"||typeof e=="string"||P1(e)||e==null||Ca(e)&&n)t.push(e);else if(Array.isArray(e)||Ca(e))for(let r=0;r<e.length;++r)ou(e[r],t,n);else{let r=-1;for(let a of Object.keys(e))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)ou(e[a],t,n)}return t}var kfe=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Cfe)}profileKernel(e,t,n){let r,a=()=>{r=n()},s,o=Ly();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(a);else{a();for(let l of r)l.dataSync();s=Promise.resolve({kernelMs:Ly()-o})}if(_e().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<r.length;l++){let c=r[l];c.data().then(d=>{Sfe(d,c.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:s.then(l=>l.kernelMs),extraInfo:s.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:r,inputs:a,extraInfo:s}=e;n.forEach(o=>{Promise.all([o.data(),r,s]).then(l=>{this.logger.logKernelProfile(t,o,l[0],l[1],a,l[2])})})}};function Sfe(e,t,n){if(t!=="float32")return!1;for(let r=0;r<e.length;r++){let a=e[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${n}'`),!0}return!1}var Cfe=class{logKernelProfile(e,t,n,r,a,s){let o=typeof r=="number"?fy(`${r}ms`,9):r.error,l=fy(e,25),c=t.rank,d=t.size,u=fy(t.shape.toString(),14),h="";for(let p in a){let m=a[p];if(m!=null){let f=m.shape||t.shape,g=f.length;h+=`${p}: ${g}D ${g>0?f:""} `}}console.log(`%c${l}	%c${o}	%c${c}D ${u}	%c${d}	%c${h}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function _fe(e,t,n){let r={},a={};for(let c=0;c<t.length;c++)r[t[c].id]=!0;for(let c=0;c<e.length;c++){let d=e[c],u=d.inputs;for(let h in u){let p=u[h],m=!1;for(let f=0;f<t.length;f++)if(r[p.id]){d.outputs.forEach(g=>r[g.id]=!0),m=!0,a[d.id]=!0;break}if(m)break}}let s={};s[n.id]=!0;let o={};for(let c=e.length-1;c>=0;c--){let d=e[c],u=d.inputs;for(let h=0;h<d.outputs.length;h++)if(s[d.outputs[h].id]){for(let p in u)s[u[p].id]=!0,o[d.id]=!0;break}}let l=[];for(let c=0;c<e.length;c++){let d=e[c];if(a[d.id]&&o[d.id]){let u={};for(let p in d.inputs){let m=d.inputs[p];r[m.id]&&(u[p]=m)}let h=Object.assign({},d);h.inputs=u,h.outputs=d.outputs,l.push(h)}}return l}function jfe(e,t,n,r){for(let a=t.length-1;a>=0;a--){let s=t[a],o=[];if(s.outputs.forEach(c=>{let d=e[c.id];d!=null?o.push(d):o.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let l=s.gradient(o);for(let c in s.inputs){if(!(c in l))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(l)}.`);let d=n(()=>l[c]());if(d.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${d.dtype}'`);let u=s.inputs[c];if(!Jl(d.shape,u.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${c}' has shape '${d.shape}', which does not match the shape of the input '${u.shape}'`);if(e[u.id]==null)e[u.id]=d;else{let h=e[u.id];e[u.id]=r(h,d),h.dispose()}}}}var D3=20,jx=3,zS=7;function Ife(e,t,n,r){let a=Of(t),s=Tfe(e,t,n,a),o=t.length,l=Ew(e,t,n,a,s),c=["Tensor"];return r&&(c.push(`  dtype: ${n}`),c.push(`  rank: ${o}`),c.push(`  shape: [${t}]`),c.push("  values:")),c.push(l.map(d=>"    "+d).join(`
`)),c.join(`
`)}function Tfe(e,t,n,r){let a=ir(t),s=r[r.length-1],o=new Array(s).fill(0),l=t.length,c=n==="complex64"?Hx(e):e;if(l>1)for(let d=0;d<a/s;d++){let u=d*s;for(let h=0;h<s;h++)o[h]=Math.max(o[h],Vx(c[u+h],0,n).length)}return o}function Vx(e,t,n){let r;return Array.isArray(e)?r=`${parseFloat(e[0].toFixed(zS))} + ${parseFloat(e[1].toFixed(zS))}j`:Lc(e)?r=`'${e}'`:n==="bool"?r=lW(e):r=parseFloat(e.toFixed(zS)).toString(),fy(r,t)}function lW(e){return e===0?"false":"true"}function Ew(e,t,n,r,a,s=!0){let o=n==="complex64"?2:1,l=t[0],c=t.length;if(c===0){if(n==="complex64"){let g=Hx(e);return[Vx(g[0],0,n)]}return n==="bool"?[lW(e[0])]:[e[0].toString()]}if(c===1){if(l>D3){let g=jx*o,x=Array.from(e.slice(0,g)),y=Array.from(e.slice((l-jx)*o,l*o));return n==="complex64"&&(x=Hx(x),y=Hx(y)),["["+x.map((b,v)=>Vx(b,a[v],n)).join(", ")+", ..., "+y.map((b,v)=>Vx(b,a[l-jx+v],n)).join(", ")+"]"]}return["["+(n==="complex64"?Hx(e):Array.from(e)).map((g,x)=>Vx(g,a[x],n)).join(", ")+"]"]}let d=t.slice(1),u=r.slice(1),h=r[0]*o,p=[];if(l>D3){for(let g=0;g<jx;g++){let x=g*h,y=x+h;p.push(...Ew(e.slice(x,y),d,n,u,a,!1))}p.push("...");for(let g=l-jx;g<l;g++){let x=g*h,y=x+h;p.push(...Ew(e.slice(x,y),d,n,u,a,g===l-1))}}else for(let g=0;g<l;g++){let x=g*h,y=x+h;p.push(...Ew(e.slice(x,y),d,n,u,a,g===l-1))}let m=c===2?",":"";p[0]="["+(l>0?p[0]+m:"");for(let g=1;g<p.length-1;g++)p[g]=" "+p[g]+m;let f=`,
`;for(let g=2;g<c;g++)f+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(s?"":f),p}function Hx(e){let t=[];for(let n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var Qr=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=ir(e),n!=null){let r=n.length;Y(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||SI(t,this.size),this.strides=Of(e)}set(e,...t){t.length===0&&(t=[0]),Y(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let r of e){if(r<0||r>=this.shape[t]){let a=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(a)}t++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return lo().makeTensor(this.values,this.shape,this.dtype)}},lo=null,fm=null;function Efe(e){lo=e}function Afe(e){fm=e}var on=class{constructor(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ir(e),this.strides=Of(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return fm.buffer(this.shape,this.dtype,e)}bufferSync(){return fm.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Dm(this.shape,e,this.dtype==="complex64")}arraySync(){return Dm(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=lo().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>O0(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),lo().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=lo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>O0(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await lo().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),lo().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return fm.print(this,e)}clone(){return this.throwIfDisposed(),fm.clone(this)}toString(e=!1){let t=this.dataSync();return Ife(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),fm.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),lo().makeVariable(this,e,t,n)}};Object.defineProperty(on,Symbol.hasInstance,{value:e=>!!e&&e.data!=null&&e.dataSync!=null&&e.throwIfDisposed!=null});function Me(){return jI("Tensor",()=>on)}Me();var ah=class extends on{constructor(e,t,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Jl(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);lo().disposeTensor(this),this.dataId=e.dataId,lo().incRef(this,null)}dispose(){lo().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(ah,Symbol.hasInstance,{value:e=>e instanceof on&&e.assign!=null&&e.assign instanceof Function});var go={};nn(go,{assertTypesMatch:()=>dW,getTensorsInContainer:()=>TI,isTensorInList:()=>Dfe,makeTypesMatch:()=>Or});var TC;(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(TC||(TC={}));var EC;(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(EC||(EC={}));var AC;(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(AC||(AC={}));var RC;(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(RC||(RC={}));var DC;(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(DC||(DC={}));var Rfe={float32:RC,int32:EC,bool:AC,complex64:DC};function mi(e,t){if(e==="string"||t==="string"){if(e==="string"&&t==="string")return"string";throw new Error(`Can not upcast ${e} with ${t}`)}return Rfe[e][t]}function Q1(e){return mi(e,"int32")}function cW(e){return e!=null&&typeof e=="object"&&"texture"in e&&e.texture instanceof WebGLTexture}function uW(e){return typeof GPUBuffer<"u"&&e!=null&&typeof e=="object"&&"buffer"in e&&e.buffer instanceof GPUBuffer}function Or(e,t){if(e.dtype===t.dtype)return[e,t];let n=mi(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function dW(e,t){Y(e.dtype===t.dtype,()=>`The dtypes of the first(${e.dtype}) and second(${t.dtype}) input must match`)}function Dfe(e,t){return t.some(n=>n.id===e.id)}function TI(e){let t=[];return hW(e,t,new Set),t}function hW(e,t,n){if(e==null)return;if(e instanceof on){t.push(e);return}if(!Mfe(e))return;let r=e;for(let a in r){let s=r[a];n.has(s)||(n.add(s),hW(s,t,n))}}function Mfe(e){return Array.isArray(e)||typeof e=="object"}function BS(e){return e.kernelName!=null}var M3=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},EI=class MC{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new M3}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:t,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry))if(t in this.registryFactory){let{asyncInit:n}=this.initializeBackend(t);if(n)return null}else return null;return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,n,r=1){return t in this.registryFactory?(jc(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:n,priority:r},!0)}async setBackend(t){if(this.registryFactory[t]==null)throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,this.registry[t]==null){this.backendInstance=null;let{success:n,asyncInit:r}=this.initializeBackend(t);if(!(r?await n:n))return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new kfe(this.backendInstance),!0}setupRegisteredKernels(){P0(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(t){P0(t).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[t])})}initializeBackend(t){let n=this.registryFactory[t];if(n==null)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{let r=n.factory();if(r&&!(r instanceof vb)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,s=r.then(o=>a<this.pendingBackendInitId?!1:(this.registry[t]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,jc(`Initialization of backend ${t} failed`),jc(o.stack||o.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(r){return jc(`Initialization of backend ${t} failed`),jc(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((t,n)=>this.registryFactory[n].priority-this.registryFactory[t].priority)}initializeBackendsAndReturnBest(){let t=this.getSortedBackends();for(let n=0;n<t.length;n++){let r=t[n],{success:a,asyncInit:s}=this.initializeBackend(r);if(s||a)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,n){let r=this.state.tensorInfo.get(n),a=r.backend,s=this.readSync(n),o=a.refCount(n);a.disposeData(n,!0),r.backend=t,t.move(n,s,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,n){let r=null;if(n==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");n=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=t}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=n(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(t,n,r){t();try{let a=r();return n(),a}catch(a){throw n(),a}}nextTensorId(){return MC.nextTensorId++}nextVariableId(){return MC.nextVariableId++}clone(t){let n=ae.runKernel(ep,{x:t}),r={x:t},a=o=>({x:()=>{let l="float32",c={x:o},d={dtype:l};return ae.runKernel($h,c,d)}}),s=[];return this.addTapeNode(this.state.activeScope.name,r,[n],a,s,{}),n}runKernel(t,n,r){if(this.backendName==null&&this.backend,Oy(t,this.backendName)==null)throw new Error(`Kernel '${t}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:t,inputs:n,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,n,r){let a=this.backend.numDataIds(),s=0;r.forEach(c=>{s+=c.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=a-n-s-o;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${t}'`)}runKernelFunc(t){let n,r=[],a=this.isTapeOn(),s=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,d=BS(t)?t.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(BS(t)){let{kernelName:f,inputs:g,attrs:x}=t;this.backendName==null&&this.backend;let y=Oy(f,this.backendName);Y(y!=null,()=>`Cannot find registered kernel '${f}' for backend '${this.backendName}'`),l=()=>{let b=this.backend.numDataIds();c=y.kernelFunc({inputs:g,attrs:x,backend:this.backend});let v=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,b,v);let w=v.map(k=>k.rank!=null?k:this.makeTensorFromTensorInfo(k));if(a){let k=this.getTensorsForGradient(f,g,w);r=this.saveTensorsForBackwardMode(k)}return w}}else{let{forwardFunc:f}=t,g=x=>{a&&(r=x.map(y=>this.keep(this.clone(y))))};l=()=>{let x=this.backend.numDataIds();c=this.tidy(()=>f(this.backend,g));let y=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,x,y),y}}let{inputs:u,attrs:h}=t,p=BS(t)?null:t.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=l():(m=this.profiler.profileKernel(d,u,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),n=m.outputs)}),a&&this.addTapeNode(d,u,n,p,r,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(f=>u[f]!=null?u[f].shape:null),outputShapes:n.map(f=>f.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?n:n[0]}saveTensorsForBackwardMode(t){return t.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(t,n,r){let a=jC(t);if(a!=null){let s=a.inputsToSave||[],o=a.outputsToSave||[],l;a.saveAllInputs?(Y(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(n).map(d=>n[d])):l=s.map(d=>n[d]);let c=r.filter((d,u)=>o[u]);return l.concat(c)}return[]}makeTensor(t,n,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let s=t;r==="string"&&Lc(t[0])&&(s=t.map(c=>Hb(c)));let o=a.write(s,n,r),l=new on(n,r,o,this.nextTensorId());if(this.trackTensor(l,a),r==="string"){let c=this.state.tensorInfo.get(o),d=Y6(s);this.state.numBytes+=d-c.bytes,c.bytes=d}return l}makeTensorFromDataId(t,n,r,a){r=r||"float32";let s={dataId:t,shape:n,dtype:r};return this.makeTensorFromTensorInfo(s,a)}makeTensorFromTensorInfo(t,n){let{dataId:r,shape:a,dtype:s}=t,o=new on(a,s,r,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(t,n=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.cast(a));let s=new ah(t,n,r,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(t,n){this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++;let r=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(r=t.size*M0(t.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(t.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(t.dataId,{backend:n||this.backend,dtype:t.dtype,shape:t.shape,bytes:r})),t instanceof ah||this.track(t)}incRef(t,n){this.trackTensor(t,n),this.backend.incRef(t.dataId)}removeDataId(t,n){this.state.tensorInfo.has(t)&&this.state.tensorInfo.get(t).backend===n&&(this.state.tensorInfo.delete(t),this.state.numDataBuffers--)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;let n=this.state.tensorInfo.get(t.dataId);if(this.state.numTensors--,t.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),t.dtype!=="complex64"&&t.dtype!=="string"){let r=t.size*M0(t.dtype);this.state.numBytes-=r}n.backend.disposeData(t.dataId)&&this.removeDataId(t.dataId,n.backend)}disposeVariables(){for(let t in this.state.registeredVariables){let n=this.state.registeredVariables[t];this.disposeVariable(n)}}disposeVariable(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]}memory(){let t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;let n=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(t,n,r,a,s,o){let l={id:this.state.nextTapeNodeId++,kernelName:t,inputs:n,outputs:r,saved:s},c=jC(t);c!=null&&(a=c.gradFunc),a!=null&&(l.gradient=d=>(d=d.map((u,h)=>{if(u==null){let p=r[h],m=F1(p.size,p.dtype);return this.makeTensor(m,p.shape,p.dtype)}return u}),a(d.length>1?d:d[0],s,o))),this.state.activeTape.push(l)}keep(t){return t.kept=!0,t}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){let n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(n.name=t),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(t){let n=TI(t),r=new Set(n.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let o=this.state.activeScope.track[s];!o.kept&&!r.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(s=>{!s.kept&&s.scopeId===a.id&&this.track(s)})}gradients(t,n,r,a=!1){if(Y(n.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",t));Y(s instanceof on,()=>"The result y returned by f() must be a tensor.");let o=_fe(this.state.activeTape,n,s);if(!a&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=r??$fe(s.shape),jfe(l,o,d=>this.tidy(d),Ffe);let c=n.map(d=>l[d.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(d=>{for(let u of d.saved)u.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(t){return Y(iu(t),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{Y(n.every(l=>l instanceof on),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};n.forEach((l,c)=>{a[c]=l});let s=(l,c)=>(r=t(...n,c),Y(r.value instanceof on,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),Y(iu(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(l,c)=>{let d=r.gradFunc(l,c),u=Array.isArray(d)?d:[d];Y(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),Y(u.every(p=>p instanceof on),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let h={};return u.forEach((p,m)=>{h[m]=()=>p}),h};return this.runKernelFunc({forwardFunc:s,backwardsFunc:o,inputs:a})}}readSync(t){return this.state.tensorInfo.get(t).backend.readSync(t)}read(t){return this.state.tensorInfo.get(t).backend.read(t)}readToGPU(t,n){return this.state.tensorInfo.get(t).backend.readToGPU(t,n)}async time(t){let n=Ly(),r=await this.backend.time(t);return r.wallMs=Ly()-n,r}track(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new M3;for(let t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};EI.nextTensorId=0;EI.nextVariableId=0;function $fe(e){let t=CI(ir(e),"float32");return ae.makeTensor(t,e,"float32")}function pW(){let e=eW();if(e._tfengine==null){let t=new J6(e);e._tfengine=new EI(t)}return sfe(e._tfengine.ENV),Efe(()=>e._tfengine),e._tfengine}var ae=pW();function Ffe(e,t){let n={a:e,b:t};return ae.runKernel(_u,n)}var Gb={};nn(Gb,{isBrowser:()=>mW,isMobile:()=>Lfe,mockIsMobile:()=>Ofe});function Pfe(){return typeof navigator<"u"&&navigator!=null}var $C;function Ofe(e){$C=e}function Lfe(e){if($C!==void 0)return $C;if(e||Pfe()){if(e||(e=navigator),e.product==="ReactNative")return!0;let t=e.userAgent||e.vendor||(typeof window<"u"?window.opera:"");if(!t){let n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function mW(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ks=_e();ks.registerFlag("DEBUG",()=>!1,e=>{e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ks.registerFlag("IS_BROWSER",()=>mW());ks.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ks.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ks.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ks.registerFlag("PROD",()=>!1);ks.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ks.getBool("DEBUG"));ks.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ks.registerFlag("IS_TEST",()=>!1);ks.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ks.getBool("DEBUG"));ks.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ks.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ks.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function ol(e,t){let n=e;if(Ca(e))return t==="string"?[]:[e.length];if(cW(e)){let a=e.channels||"RGBA";return[e.height,e.width*a.length]}else if(uW(e))return[e.buffer.size/(t==null?4:M0(t))];if(!Array.isArray(e))return[];let r=[];for(;Array.isArray(n)||Ca(n)&&t!=="string";)r.push(n.length),n=n[0];return Array.isArray(e)&&_e().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&fW(e,r,[]),r}function fW(e,t,n){if(n=n||[],!Array.isArray(e)&&!Ca(e)){Y(t.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${t[0]} elements`);return}Y(t.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${e.length} elements`),Y(e.length===t[0],()=>`Element arr[${n.join("][")}] should have ${t[0]} elements, but has ${e.length} elements`);let r=t.slice(1);for(let a=0;a<e.length;++a)fW(e[a],r,n.concat(a))}function $3(e,t,n,r){if(e!=="string_or_numeric"){if(e==null)throw new Error("Expected dtype cannot be null.");if(e!=="numeric"&&e!==t||e==="numeric"&&t==="string")throw new Error(`Argument '${n}' passed to '${r}' must be ${e} tensor, but got ${t} tensor`)}}function H(e,t,n,r="numeric"){if(e instanceof Me())return $3(r,e.dtype,t,n),e;let a=wb(e);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),$3(r,a,t,n),e==null||!Ca(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){let l=e==null?"null":e.constructor.name;throw new Error(`Argument '${t}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}let s=ol(e,a);!Ca(e)&&!Array.isArray(e)&&(e=[e]);let o=a!=="string"?Z1(e,a):ou(e,[],!0);return ae.makeTensor(o,s,a)}function zy(e,t,n,r="numeric"){if(!Array.isArray(e))throw new Error(`Argument ${t} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return e.map((a,s)=>H(a,`${t}[${s}]`,n,r))}var AI="__op";function se(e){let t=Object.keys(e);if(t.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${t.length} keys.`);let n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+AI;let a=(...s)=>{ae.startScope(n);try{let o=r(...s);return P1(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}function zfe(e,t){let n=H(e,"real","complex"),r=H(t,"imag","complex");ns(n.shape,r.shape,`real and imag shapes, ${n.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:n,imag:r};return ae.runKernel(O1,a)}var Vl=se({complex_:zfe});function Eu(e,t,n,r){if(r==null)r=wb(e);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(uW(e)||cW(e)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ae.backend.createTensorFromGPUData(e,t||n,r)}if(!Ca(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){Zs(t);let a=ir(t),s=ir(n);Y(a===s,()=>`Based on the provided shape, [${t}], the tensor should have ${a} values but has ${s}`);for(let o=0;o<n.length;++o){let l=n[o],c=o===n.length-1?l!==ir(t.slice(o)):!0;Y(n[o]===t[o]||!c,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${t}). `)}}return!Ca(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e=r!=="string"?Z1(e,r):ou(e,[],!0),ae.makeTensor(e,t,r)}function Qa(e,t,n){let r=ol(e,n);return Eu(e,t,r,n)}var sh={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},ec=class gW{static join(t){return new gW(t).slice()}constructor(t){if(this.shards=[],this.previousShardIndex=0,t==null||(t instanceof Array||(t=[t]),t=t.map(r=>Ca(r)?r.buffer:r),t.length===0))return;this.bufferUniformSize=t[0].byteLength;let n=0;for(let r=0;r<t.length;r++){let a=t[r];r!==t.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let s=n+a.byteLength;this.shards.push({buffer:a,start:n,end:s}),n=s}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(t=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(t=isNaN(Number(t))?0:t,n=isNaN(Number(n))?0:n,t=Math.max(0,t),n=Math.min(this.byteLength,n),n<=t)return new ArrayBuffer(0);let r=this.findShardForByte(t);if(r===-1)throw new Error(`Could not find start shard for byte ${t}`);let a=n-t,s=new ArrayBuffer(a),o=new Uint8Array(s),l=0;for(let c=r;c<this.shards.length;c++){let d=this.shards[c],u=t+l-d.start,h=l,p=Math.min(n,d.end)-d.start,m=new Uint8Array(d.buffer,u,p-u);if(o.set(m,h),l+=m.length,n<d.end)break}return s}findShardForByte(t){if(this.shards.length===0||t<0||t>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(t/this.bufferUniformSize),this.previousShardIndex;function n(a){return t<a.start?-1:t>=a.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let r=Bfe(this.shards,n);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}};function Bfe(e,t){let n=0,r=e.length;for(;n<=r;){let a=Math.floor((r-n)/2)+n,s=t(e[a]);if(s===0)return a;s<0?r=a:n=a+1}return-1}function Wfe(){_e().set("PROD",!0)}function Ufe(){_e().set("DEBUG",!0)}function Vfe(){_e().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function xW(e){_e().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Hfe(){ae.disposeVariables()}function Ti(){return ae}function FC(){return ae.memory()}function Gfe(e){return ae.profile(e)}function fe(e,t){return ae.tidy(e,t)}function tn(e){TI(e).forEach(t=>t.dispose())}function la(e){return ae.keep(e)}function qfe(e){return ae.time(e)}function Kfe(e){return ae.setBackend(e)}function Yfe(){return ae.ready()}function yW(){return ae.backendName}function Xfe(e){ae.removeBackend(e)}function Zfe(e){return ae.findBackend(e)}function Qfe(e){return ae.findBackendFactory(e)}function J1(e,t,n=1){return ae.registerBackend(e,t,n)}function RI(){return ae.backend}function Jfe(e,t){_e().setPlatform(e,t)}var lu=4;async function ege(e,t){let n=[],r=[],a=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);for(let o=0;o<a.length;++o){let l=a[o],c=Array.isArray(e)?e[o].tensor:e[l];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${c.dtype}`);let d={name:l,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){let u=new Promise(async h=>{let p=await c.bytes(),m=p.reduce((x,y)=>x+y.length,0)+lu*p.length,f=new Uint8Array(m),g=0;for(let x=0;x<p.length;x++){let y=p[x],b=new Uint8Array(new Uint32Array([y.length]).buffer);f.set(b,g),g+=lu,f.set(y,g),g+=y.length}h(f)});r.push(u)}else r.push(c.data());t!=null&&(d.group=t),n.push(d)}let s=await Promise.all(r);return{data:rge(s),specs:n}}function bW(e,t){let n=new ec(e),r={},a=0;for(let s of t){let o=tge(s,(l,c)=>n.slice(a+l,a+c));r[s.name]=vW(s,n.slice(a,a+o)),a+=o}return r}function tge(e,t){let n=ir(e.shape),r;if("quantization"in e){let a=e.quantization;r=sh[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=lu+new Uint32Array(t(a,a+lu))[0];return a}else r=sh[e.dtype];return n*r}async function nge(e,t){let n=ir(e.shape),r;if("quantization"in e){let a=e.quantization;r=sh[a.dtype]}else if(e.dtype==="string"){let a=0;for(let s=0;s<n;s++)a+=lu+new Uint32Array(await t(a,a+lu))[0];return a}else r=sh[e.dtype];return n*r}function vW(e,t){let n=e.name,r=e.dtype,a=e.shape,s=ir(a),o,l=0;if("quantization"in e){let c=e.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${e.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${e.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${e.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let d=sh[c.dtype],u=c.dtype==="uint8"?new Uint8Array(t):new Uint16Array(t);if(r==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){o=new Float32Array(u.length);for(let h=0;h<u.length;h++){let p=u[h];o[h]=p*c.scale+c.min}}else if(c.dtype==="float16")o=uge()(u);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(r==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);o=new Int32Array(u.length);for(let h=0;h<u.length;h++){let p=u[h];o[h]=Math.round(p*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);l+=s*d}else if(r==="string"){let c=ir(e.shape);o=[];for(let d=0;d<c;d++){let u=new Uint32Array(t.slice(l,l+lu))[0];l+=lu;let h=new Uint8Array(t.slice(l,l+u));o.push(h),l+=u}}else{let c=sh[r];if(r==="float32")o=new Float32Array(t);else if(r==="int32")o=new Int32Array(t);else if(r==="bool")o=new Uint8Array(t);else if(r==="complex64"){o=new Float32Array(t);let d=new Float32Array(o.length/2),u=new Float32Array(o.length/2);for(let f=0;f<d.length;f++)d[f]=o[f*2],u[f]=o[f*2+1];let h=Qa(d,a,"float32"),p=Qa(u,a,"float32"),m=Vl(h,p);return h.dispose(),p.dispose(),m}else throw new Error(`Unsupported dtype in weight '${n}': ${r}`);l+=s*c}return Qa(o,a,r)}async function F3(e,t,n){let r=new Uint8Array(t);for(;r.byteLength<n;){let{done:a,value:s}=await e.read();if(a&&s==null){let l=n-r.byteLength;throw new Error(`Reader is done but ${l} bytes are still expected`)}let o=new Uint8Array(r.length+s.byteLength);o.set(r,0),o.set(new Uint8Array(s),r.length),r=o}return r.buffer}async function wW(e,t){let n={},r=e.getReader(),a=new ArrayBuffer(0);for(let s of t){let o=await nge(s,async(d,u)=>(a=await F3(r,a,u),a.slice(d,u)));a=await F3(r,a,o);let l=a.slice(0,o);a=a.slice(o);let c=vW(s,l);if(n[s.name]=c,yW()==="webgpu"){let d=RI();"uploadToGPU"in d&&ir(c.shape)>=_e().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&d.uploadToGPU(c.dataId)}}return n}function rge(e){if(e===null)throw new Error(`Invalid input value: ${JSON.stringify(e)}`);let t=0,n=[];e.forEach(s=>{if(t+=s.byteLength,n.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let r=new Uint8Array(t),a=0;return n.forEach(s=>{r.set(new Uint8Array(s.buffer),a),a+=s.byteLength}),r.buffer}var DI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function P3(e){return DI?Buffer.byteLength(e,"utf8"):new Blob([e]).size}function age(e){if(DI)return Buffer.from(e).toString("base64");let t=new Uint8Array(e),n="";for(let r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function sge(e){if(DI){let r=Buffer.from(e,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;++r)n.set([t.charCodeAt(r)],r);return n.buffer}function ige(e){return ec.join(e)}function O3(e){let t="/";for(e=e.trim();e.endsWith(t);)e=e.slice(0,e.length-1);let n=e.split(t);return n[n.length-1]}function NW(e,t){let n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return e.signature!=null&&(n.signature=e.signature),e.userDefinedMetadata!=null&&(n.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(n.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(n.initializerSignature=e.initializerSignature),e.trainingConfig!=null&&(n.trainingConfig=e.trainingConfig),n}function kW(e,t,n){let r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(e.trainingConfig!=null&&(r.trainingConfig=e.trainingConfig),e.weightsManifest!=null){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return e.signature!=null&&(r.signature=e.signature),e.userDefinedMetadata!=null&&(r.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(r.modelInitializer=e.modelInitializer),e.initializerSignature!=null&&(r.initializerSignature=e.initializerSignature),r}async function MI(e,t){let n,r;return e.weightsManifest!=null&&([n,r]=await t(e.weightsManifest)),kW(e,n,r)}function qb(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:P3(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:P3(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:new ec(e.weightData).byteLength}}function PC(e){let t=[];for(let n of e)t.push(...n.weights);return t}function oge(){let e=n=>{let r=n<<13,a=0;for(;!(r&8388608);)a-=8388608,r<<=1;return r&=-8388609,a+=947912704,r|a},t=new Uint32Array(2048);t[0]=0;for(let n=1;n<1024;n++)t[n]=e(n);for(let n=1024;n<2048;n++)t[n]=939524096+(n-1024<<13);return t}function lge(){let e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(let t=1;t<31;t++)e[t]=t<<23;for(let t=33;t<63;t++)e[t]=2147483648+(t-32<<23);return e}function cge(){let e=new Uint32Array(64);for(let t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}function uge(){let e=oge(),t=lge(),n=cge();return r=>{let a=new ArrayBuffer(4*r.length),s=new Uint32Array(a);for(let o=0;o<r.length;o++){let l=r[o],c=e[n[l>>10]+(l&1023)]+t[l>>10];s[o]=c}return new Float32Array(a)}}var fi=class eo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return eo.instance==null&&(eo.instance=new eo),eo.instance}static registerSaveRouter(t){eo.getInstance().saveRouters.push(t)}static registerLoadRouter(t){eo.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return eo.getHandlers(t,"save")}static getLoadHandlers(t,n){return eo.getHandlers(t,"load",n)}static getHandlers(t,n,r){let a=[];return(n==="load"?eo.getInstance().loadRouters:eo.getInstance().saveRouters).forEach(s=>{let o=s(t,r);o!==null&&a.push(o)}),a}},dge=e=>fi.registerSaveRouter(e),hge=e=>fi.registerLoadRouter(e),pge=e=>fi.getSaveHandlers(e),mge=(e,t)=>fi.getLoadHandlers(e,t),OC="tensorflowjs",LC=1,yd="models_store",zc="model_info_store";function SW(){if(!_e().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let e=typeof window>"u"?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function zC(e){let t=e.result;t.createObjectStore(yd,{keyPath:"modelPath"}),t.createObjectStore(zc,{keyPath:"modelPath"})}var ih=class{constructor(e){if(this.indexedDB=SW(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,r)=>{let a=this.indexedDB.open(OC,LC);a.onupgradeneeded=()=>zC(a),a.onsuccess=()=>{let s=a.result;if(t==null){let o=s.transaction(yd,"readonly"),l=o.objectStore(yd).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return s.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(l.result.modelArtifacts)},l.onerror=c=>(s.close(),r(l.error)),o.oncomplete=()=>s.close()}else{t.weightData=ec.join(t.weightData);let o=qb(t),l=s.transaction(zc,"readwrite"),c=l.objectStore(zc),d;try{d=c.put({modelPath:this.modelPath,modelArtifactsInfo:o})}catch(h){return r(h)}let u;d.onsuccess=()=>{u=s.transaction(yd,"readwrite");let h=u.objectStore(yd),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:o})}catch(m){return r(m)}p.onsuccess=()=>n({modelArtifactsInfo:o}),p.onerror=m=>{c=l.objectStore(zc);let f=c.delete(this.modelPath);f.onsuccess=()=>(s.close(),r(p.error)),f.onerror=g=>(s.close(),r(p.error))}},d.onerror=h=>(s.close(),r(d.error)),l.oncomplete=()=>{u==null?s.close():u.oncomplete=()=>s.close()}}},a.onerror=s=>r(a.error)})}};ih.URL_SCHEME="indexeddb://";var CW=e=>_e().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ih.URL_SCHEME)?fge(e.slice(ih.URL_SCHEME.length)):null;fi.registerSaveRouter(CW);fi.registerLoadRouter(CW);function fge(e){return new ih(e)}function gge(e){return e.startsWith(ih.URL_SCHEME)?e.slice(ih.URL_SCHEME.length):e}var xge=class{constructor(){this.indexedDB=SW()}async listModels(){return new Promise((e,t)=>{let n=this.indexedDB.open(OC,LC);n.onupgradeneeded=()=>zC(n),n.onsuccess=()=>{let r=n.result,a=r.transaction(zc,"readonly"),s=a.objectStore(zc).getAll();s.onsuccess=()=>{let o={};for(let l of s.result)o[l.modelPath]=l.modelArtifactsInfo;e(o)},s.onerror=o=>(r.close(),t(s.error)),a.oncomplete=()=>r.close()},n.onerror=r=>t(n.error)})}async removeModel(e){return e=gge(e),new Promise((t,n)=>{let r=this.indexedDB.open(OC,LC);r.onupgradeneeded=()=>zC(r),r.onsuccess=()=>{let a=r.result,s=a.transaction(zc,"readwrite"),o=s.objectStore(zc),l=o.get(e),c;l.onsuccess=()=>{if(l.result==null)return a.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let d=o.delete(e),u=()=>{c=a.transaction(yd,"readwrite");let h=c.objectStore(yd).delete(e);h.onsuccess=()=>t(l.result.modelArtifactsInfo),h.onerror=p=>n(l.error)};d.onsuccess=u,d.onerror=h=>(u(),a.close(),n(l.error))}},l.onerror=d=>(a.close(),n(l.error)),s.oncomplete=()=>{c==null?a.close():c.oncomplete=()=>a.close()}},r.onerror=a=>n(r.error)})}},Ml="/",gm="tensorflowjs_models",_W="info",yge="model_topology",bge="weight_specs",vge="weight_data",wge="model_metadata";function jW(e){return{info:[gm,e,_W].join(Ml),topology:[gm,e,yge].join(Ml),weightSpecs:[gm,e,bge].join(Ml),weightData:[gm,e,vge].join(Ml),modelMetadata:[gm,e,wge].join(Ml)}}function IW(e){for(let t of Object.values(e))window.localStorage.removeItem(t)}function Nge(e){let t=e.split(Ml);if(t.length<3)throw new Error(`Invalid key format: ${e}`);return t.slice(1,t.length-1).join(Ml)}function kge(e){return e.startsWith(oh.URL_SCHEME)?e.slice(oh.URL_SCHEME.length):e}var oh=class{constructor(e){if(!_e().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=jW(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=qb(e),a=ec.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,age(a));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:r}}catch{throw IW(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;let a=this.LS.getItem(this.keys.modelMetadata);if(a!=null){let o=JSON.parse(a);t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)}let s=this.LS.getItem(this.keys.weightData);if(s==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=sge(s),t}};oh.URL_SCHEME="localstorage://";var TW=e=>_e().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(oh.URL_SCHEME)?Sge(e.slice(oh.URL_SCHEME.length)):null;fi.registerSaveRouter(TW);fi.registerLoadRouter(TW);function Sge(e){return new oh(e)}var Cge=class{constructor(){Y(_e().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),Y(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},t=gm+Ml,n=Ml+_W;for(let r=0;r<this.LS.length;++r){let a=this.LS.key(r);if(a.startsWith(t)&&a.endsWith(n)){let s=Nge(a);e[s]=JSON.parse(this.LS.getItem(a))}}return e}async removeModel(e){e=kge(e);let t=jW(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(t.info));return IW(t),n}},Mm="://",cu=class xc{constructor(){this.managers={}}static getInstance(){return xc.instance==null&&(xc.instance=new xc),xc.instance}static registerManager(t,n){Y(t!=null,()=>"scheme must not be undefined or null."),t.endsWith(Mm)&&(t=t.slice(0,t.indexOf(Mm))),Y(t.length>0,()=>"scheme must not be an empty string.");let r=xc.getInstance();Y(r.managers[t]==null,()=>`A model store manager is already registered for scheme '${t}'.`),r.managers[t]=n}static getManager(t){let n=xc.getInstance().managers[t];if(n==null)throw new Error(`Cannot find model manager for scheme '${t}'`);return n}static getSchemes(){return Object.keys(xc.getInstance().managers)}};function Aw(e){if(e.indexOf(Mm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${cu.getSchemes().join(",")}`);return{scheme:e.split(Mm)[0],path:e.split(Mm)[1]}}async function EW(e,t,n=!1){Y(e!==t,()=>`Old path and new path are the same: '${e}'`);let r=fi.getLoadHandlers(e);Y(r.length>0,()=>`Copying failed because no load handler is found for source URL ${e}.`),Y(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${e}.`);let a=r[0],s=fi.getSaveHandlers(t);Y(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${t}.`),Y(s.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${t}.`);let o=s[0],l=Aw(e).scheme,c=Aw(e).path,d=l===Aw(e).scheme,u=await a.load();n&&d&&await cu.getManager(l).removeModel(c);let h=await o.save(u);return n&&!d&&await cu.getManager(l).removeModel(c),h.modelArtifactsInfo}async function _ge(){let e=cu.getSchemes(),t={};for(let n of e){let r=await cu.getManager(n).listModels();for(let a in r){let s=n+Mm+a;t[s]=r[a]}}return t}async function jge(e){let t=Aw(e);return cu.getManager(t.scheme).removeModel(t.path)}async function Ige(e,t){return EW(e,t,!1)}async function Tge(e,t){return EW(e,t,!0)}var Ege=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!_e().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let r=this.functionRefs[n.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return sW(e)}};if(_e().get("IS_BROWSER")){_e().setPlatform("browser",new Ege);try{cu.registerManager(oh.URL_SCHEME,new Cge)}catch{}try{cu.registerManager(ih.URL_SCHEME,new xge)}catch{}}var Age={importFetch:()=>Sme()},WS,Rge=class{constructor(){this.util=Cme(),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return _e().global.fetch!=null?_e().global.fetch(e,t):(WS==null&&(WS=Age.importFetch()),WS(e,t))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}};_e().get("IS_NODE")&&!_e().get("IS_BROWSER")&&_e().setPlatform("node",new Rge);function pn(e,t="float32",n){return t=t||"float32",Zs(e),new Qr(e,t,n)}function Dge(e,t){let n=H(e,"x","cast");if(!K6(t))throw new Error(`Failed to cast to unknown dtype ${t}`);if(t==="string"&&n.dtype!=="string"||t!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:n},a={dtype:t};return ae.runKernel($h,r,a)}var He=se({cast_:Dge});function Mge(e){let t={x:H(e,"x","clone","string_or_numeric")};return ae.runKernel(ep,t)}var Jo=se({clone_:Mge});function $I(e,t=!1){console.log(e.toString(t))}pW();var $ge={buffer:pn,cast:He,clone:Jo,print:$I};Afe($ge);function Fge(e,t){let n=H(e,"a","add"),r=H(t,"b","add");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(_u,a)}var Re=se({add_:Fge});function Pge(e,t){let n=H(e,"a","floorDiv"),r=H(t,"b","floorDiv");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(Zh,a)}var eN=se({floorDiv_:Pge});function Oge(e,t){let n=H(e,"a","div"),r=H(t,"b","div");if([n,r]=Or(n,r),n.dtype==="int32"&&r.dtype==="int32")return eN(n,r);let a={a:n,b:r},s={};return ae.runKernel(Hh,a,s)}var pt=se({div_:Oge});function Lge(e,t){let n=H(e,"a","mul"),r=H(t,"b","mul");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(gp,a)}var oe=se({mul_:Lge});function zge(e){let t=H(e,"x","abs");if(t.dtype==="complex64"){let n={x:t};return ae.runKernel(Cb,n)}else{let n={x:t};return ae.runKernel(Lf,n)}}var Xr=se({abs_:zge});function Bge(e){let t={x:H(e,"x","acos")};return ae.runKernel(Ch,t)}var FI=se({acos_:Bge});function Wge(e){let t={x:H(e,"x","acosh")};return ae.runKernel(_h,t)}var PI=se({acosh_:Wge});function Uge(e){Y(Array.isArray(e),()=>"The argument passed to tf.addN() must be a list of tensors"),Y(e.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${e.length}`);let t=e.map((a,s)=>H(a,`tensors${s}`,"addN")),n=t[0];t.forEach(a=>{if(a.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(a=>{if(!Jl(a.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let r=t;return ae.runKernel(jh,r)}var AW=se({addN_:Uge});function Vge(e,t=null,n=!1){let r={x:H(e,"x","all","bool")},a={axis:t,keepDims:n};return ae.runKernel(zf,r,a)}var tN=se({all_:Vge});function Hge(e,t=null,n=!1){let r={x:H(e,"x","any","bool")},a={axis:t,keepDims:n};return ae.runKernel(Bf,r,a)}var By=se({any_:Hge});function Gge(e,t=0){let n={x:H(e,"x","argMax")},r={axis:t};return ae.runKernel(Wf,n,r)}var lh=se({argMax_:Gge});function qge(e,t=0){let n={x:H(e,"x","argMin")},r={axis:t};return ae.runKernel(Uf,n,r)}var OI=se({argMin_:qge});function Kge(e){let t={x:H(e,"x","asin")};return ae.runKernel(Ih,t)}var LI=se({asin_:Kge});function Yge(e){let t={x:H(e,"x","asinh")};return ae.runKernel(Th,t)}var zI=se({asinh_:Yge});function Xge(e){let t={x:H(e,"x","atan")};return ae.runKernel(Eh,t)}var BI=se({atan_:Xge});function Zge(e,t){let n=H(e,"a","atan2"),r=H(t,"b","atan2");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(Rh,a)}var WI=se({atan2_:Zge});function Qge(e){let t={x:H(e,"x","atanh")};return ae.runKernel(Ah,t)}var UI=se({atanh_:Qge});function Jge(e,t,n,r,a="NHWC",s){let o=e[3],l=[...t,o],c=MW(a);return Kb(e,l,n,s,r,null,null,c)}function RW(e,t,n,r,a,s,o="channelsLast"){let[l,c]=Wy(t),d;if(o==="channelsLast")d=[l,c,e[3],e[3]];else if(o==="channelsFirst")d=[l,c,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return Kb(e,d,n,r,a,s,!1,o)}function exe(e,t,n,r,a,s,o="NDHWC"){let[l,c,d]=BC(t),u,h;if(o==="NDHWC")h="channelsLast",u=[l,c,d,e[4],e[4]];else if(o==="NCDHW")h="channelsFirst",u=[l,c,d,e[1],e[1]];else throw new Error(`Unknown dataFormat ${o}`);return DW(e,u,n,r,a,!1,h,s)}function Kb(e,t,n,r,a,s,o=!1,l="channelsLast"){let[c,d,u,h]=[-1,-1,-1,-1];if(l==="channelsLast")[c,d,u,h]=e;else if(l==="channelsFirst")[c,h,d,u]=e;else throw new Error(`Unknown dataFormat ${l}`);let[p,m,,f]=t,[g,x]=Wy(n),[y,b]=Wy(r),v=$m(p,y),w=$m(m,b),{padInfo:k,outHeight:C,outWidth:S}=rxe(a,d,u,g,x,v,w,s,l),_=o?f*h:f,I;return l==="channelsFirst"?I=[c,_,C,S]:l==="channelsLast"&&(I=[c,C,S,_]),{batchSize:c,dataFormat:l,inHeight:d,inWidth:u,inChannels:h,outHeight:C,outWidth:S,outChannels:_,padInfo:k,strideHeight:g,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:e,outShape:I,filterShape:t}}function DW(e,t,n,r,a,s=!1,o="channelsLast",l){let[c,d,u,h,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[c,d,u,h,p]=e;else if(o==="channelsFirst")[c,p,d,u,h]=e;else throw new Error(`Unknown dataFormat ${o}`);let[m,f,g,,x]=t,[y,b,v]=BC(n),[w,k,C]=BC(r),S=$m(m,w),_=$m(f,k),I=$m(g,C),{padInfo:T,outDepth:A,outHeight:j,outWidth:D}=axe(a,d,u,h,y,b,v,S,_,I,l),F=s?x*p:x,B;return o==="channelsFirst"?B=[c,F,A,j,D]:o==="channelsLast"&&(B=[c,A,j,D,F]),{batchSize:c,dataFormat:o,inDepth:d,inHeight:u,inWidth:h,inChannels:p,outDepth:A,outHeight:j,outWidth:D,outChannels:F,padInfo:T,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:m,filterHeight:f,filterWidth:g,effectiveFilterDepth:S,effectiveFilterHeight:_,effectiveFilterWidth:I,dilationDepth:w,dilationHeight:k,dilationWidth:C,inShape:e,outShape:B,filterShape:t}}function txe(e,t,n,r,a){r==null&&(r=VI(e,t,n));let s=e[0],o=e[1],l=Uy((s-t+2*r)/n+1,a),c=Uy((o-t+2*r)/n+1,a);return[l,c]}function nxe(e,t,n,r,a,s){a==null&&(a=VI(e,t[0],r[0]));let o=[0,0,0,n];for(let l=0;l<3;l++)e[l]+2*a>=t[l]&&(o[l]=Uy((e[l]-t[l]+2*a)/r[l]+1,s));return o}function VI(e,t,n,r=1){let a=$m(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Wy(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function BC(e){return typeof e=="number"?[e,e,e]:e}function $m(e,t){return t<=1?e:e+(e-1)*(t-1)}function rxe(e,t,n,r,a,s,o,l,c){let d,u,h;if(typeof e=="number"){d={top:e,bottom:e,left:e,right:e,type:e===0?"VALID":"NUMBER"};let p=txe([t,n],s,r,e,l);u=p[0],h=p[1]}else if(e==="same"){u=Math.ceil(t/r),h=Math.ceil(n/a);let p=Math.max(0,(u-1)*r+s-t),m=Math.max(0,(h-1)*a+o-n),f=Math.floor(p/2),g=p-f,x=Math.floor(m/2),y=m-x;d={top:f,bottom:g,left:x,right:y,type:"SAME"}}else if(e==="valid")d={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((t-s+1)/r),h=Math.ceil((n-o+1)/a);else if(typeof e=="object"){let p=c==="channelsLast"?e[1][0]:e[2][0],m=c==="channelsLast"?e[1][1]:e[2][1],f=c==="channelsLast"?e[2][0]:e[3][0],g=c==="channelsLast"?e[2][1]:e[3][1];d={top:p,bottom:m,left:f,right:g,type:p===0&&m===0&&f===0&&g===0?"VALID":"EXPLICIT"},u=Uy((t-s+p+m)/r+1,l),h=Uy((n-o+f+g)/a+1,l)}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:d,outHeight:u,outWidth:h}}function axe(e,t,n,r,a,s,o,l,c,d,u){let h,p,m,f;if(e==="valid"&&(e=0),typeof e=="number"){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:e===0?"VALID":"NUMBER"};let g=nxe([t,n,r,1],[l,c,d],1,[a,s,o],e,u);p=g[0],m=g[1],f=g[2]}else if(e==="same"){p=Math.ceil(t/a),m=Math.ceil(n/s),f=Math.ceil(r/o);let g=(p-1)*a+l-t,x=(m-1)*s+c-n,y=(f-1)*o+d-r,b=Math.floor(g/2),v=g-b,w=Math.floor(x/2),k=x-w,C=Math.floor(y/2),S=y-C;h={top:w,bottom:k,left:C,right:S,front:b,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:h,outDepth:p,outHeight:m,outWidth:f}}function Uy(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error(`Unknown roundingMode ${t}`)}}function uu(e){let[t,n,r]=Wy(e);return t===1&&n===1&&r===1}function ml(e,t){return uu(e)||uu(t)}function ch(e){return Wy(e).every(t=>t>0)}function MW(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${e}`)}function rs(e,t,n){if(n!=null){if(typeof t=="string")throw Error(`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);if(typeof t=="number")Y(uf(t),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${t}.`);else if(typeof t=="object")t.forEach(r=>{r.forEach(a=>{Y(uf(a),()=>`Error in ${e}: pad must be an integer when using dimRoundingMode ${n} but got pad ${a}.`)})});else throw Error(`Error in ${e}: Unknown padding parameter: ${t}`)}}function sxe(e,t){let n={x:H(e,"x","reshape","string_or_numeric")},r={shape:t};return ae.runKernel(kg,n,r)}var me=se({reshape_:sxe});function ixe(e,t,n,r,a){let s=H(e,"x","avgPool","float32"),o=1;Y(ml(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let l=s,c=!1;s.rank===3&&(c=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),rs("avgPool",r,a);let d={x:l},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},h=ae.runKernel(Dh,d,u);return h=He(h,s.dtype),c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var tc=se({avgPool_:ixe});function oxe(e,t,n,r,a,s="NDHWC"){let o=H(e,"x","avgPool3d","float32"),l=o,c=!1;o.rank===4&&(c=!0,l=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),Y(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),Y(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),rs("avgPool3d",r,a);let d={x:l},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},h=ae.runKernel(Vf,d,u);return h=He(h,l.dtype),c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var HI=se({avgPool3d_:oxe});function lxe(e,t=0){Y(e.length>=1,()=>"Pass at least one tensor to concat");let n=zy(e,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),n.length===1)return Jo(n[0]);let r=n,a={axis:t};return ae.runKernel(Kf,r,a)}var pr=se({concat_:lxe});function cxe(e,t,n=!1,r=!1){let a=H(e,"a","matMul"),s=H(t,"b","matMul");[a,s]=Or(a,s);let o={a,b:s},l={transposeA:n,transposeB:r};return ae.runKernel(Mh,o,l)}var un=se({matMul_:cxe});function uxe(e){let t={x:H(e,"x","sigmoid","float32")};return ae.runKernel(Mp,t)}var Li=se({sigmoid_:uxe});function dxe(e,t,n){let r=H(e,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},s={begin:t,size:n};return ae.runKernel(Eg,a,s)}var En=se({slice_:dxe});function hxe(e){let t={x:H(e,"x","tanh","float32")};return ae.runKernel(Wp,t)}var du=se({tanh_:hxe});function pxe(e,t,n,r,a,s){let o=H(e,"forgetBias","basicLSTMCell"),l=H(t,"lstmKernel","basicLSTMCell"),c=H(n,"lstmBias","basicLSTMCell"),d=H(r,"data","basicLSTMCell"),u=H(a,"c","basicLSTMCell"),h=H(s,"h","basicLSTMCell"),p=pr([d,h],1),m=un(p,l),f=Re(m,c),g=f.shape[0],x=f.shape[1]/4,y=[g,x],b=En(f,[0,0],y),v=En(f,[0,x],y),w=En(f,[0,x*2],y),k=En(f,[0,x*3],y),C=Re(oe(Li(b),du(v)),oe(u,Li(Re(o,w)))),S=oe(du(C),Li(k));return[C,S]}var $W=se({basicLSTMCell_:pxe});function mxe(e,t,n){let r=H(e,"x","batchToSpaceND"),a=t.reduce((l,c)=>l*c);Y(r.rank>=1+t.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${t.length}`),Y(n.length===t.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${t.length}`),Y(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${t.join(" * ")} === ${a}`);let s={x:r},o={blockShape:t,crops:n};return ae.runKernel(Hf,s,o)}var Yb=se({batchToSpaceND_:mxe});function fxe(e){let t;return e.rank===0||e.rank===1?t=me(e,[1,1,1,e.size]):e.rank===2?t=me(e,[1,1,e.shape[0],e.shape[1]]):e.rank===3?t=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]):t=e,t}function gxe(e,t,n,r,a,s){s==null&&(s=.001);let o=H(e,"x","batchNorm"),l=H(t,"mean","batchNorm"),c=H(n,"variance","batchNorm"),d;a!=null&&(d=H(a,"scale","batchNorm"));let u;r!=null&&(u=H(r,"offset","batchNorm")),Y(l.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),Y(u==null||l.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),Y(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:fxe(o),scale:d,offset:u,mean:l,variance:c},p={varianceEpsilon:s},m=ae.runKernel(Qh,h,p);return me(m,o.shape)}var Up=se({batchNorm_:gxe});function xxe(e,t,n,r,a,s){let o=H(e,"x","batchNorm"),l=H(t,"mean","batchNorm"),c=H(n,"variance","batchNorm"),d;a!=null&&(d=H(a,"scale","batchNorm"));let u;return r!=null&&(u=H(r,"offset","batchNorm")),Y(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),Y(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),Y(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),d!=null&&Y(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${d.rank}.`),u!=null&&Y(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Up(o,l,c,u,d,s)}var GI=se({batchNorm2d_:xxe});function yxe(e,t,n,r,a,s){let o=H(e,"x","batchNorm"),l=H(t,"mean","batchNorm"),c=H(n,"variance","batchNorm"),d;a!=null&&(d=H(a,"scale","batchNorm"));let u;return r!=null&&(u=H(r,"offset","batchNorm")),Y(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),Y(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),Y(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),d!=null&&Y(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${d.rank}.`),u!=null&&Y(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Up(o,l,c,u,d,s)}var qI=se({batchNorm3d_:yxe});function bxe(e,t,n,r,a,s){let o=H(e,"x","batchNorm"),l=H(t,"mean","batchNorm"),c=H(n,"variance","batchNorm"),d;a!=null&&(d=H(a,"scale","batchNorm"));let u;return r!=null&&(u=H(r,"offset","batchNorm")),Y(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),Y(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),Y(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),d!=null&&Y(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${d.rank}.`),u!=null&&Y(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Up(o,l,c,u,d,s)}var KI=se({batchNorm4d_:bxe});function vxe(e,t,n){let r=H(e,"x","bincount"),a=H(t,"weights","bincount");Y(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),Y(n>=0,()=>`size must be non-negative, but got ${n}.`),Y(a.size===r.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${a.shape}.`);let s={x:r,weights:a},o={size:n};return ae.runKernel(Gf,s,o)}var YI=se({bincount_:vxe});function wxe(e,t){let n=H(e,"x","bitwiseAnd"),r=H(t,"y","bitwiseAnd");if(!Jl(n.shape,r.shape))throw new Error(`BitwiseAnd: Tensors must have the same shape. x: ${n.shape}, y: ${r.shape}`);if(n.dtype!=="int32"||r.dtype!=="int32")throw new Error(`BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ${n.dtype} and type of y: ${r.dtype}`);let a={a:n,b:r};return ae.runKernel(qf,a)}var FW=se({bitwiseAnd_:wxe});function Nxe(e,t){let n=H(e,"s0","broadcastArgs","int32"),r=H(t,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(r.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${r.rank}`);let a={s0:n,s1:r};return ae.runKernel(Sb,a)}var PW=se({broadcastArgs_:Nxe});function kxe(e,t){let n=H(e,"broadcastTo","x"),r=n.shape;if(Zs(t),t.length<n.rank)throw new Error(`broadcastTo(): shape.length=${t.length} < input.rank=${n.rank}.`);if(t.length>n.rank){let c=n.shape.slice();for(;c.length<t.length;)c.unshift(1);n=me(n,c)}let a=n.shape,s=Array.from(t);for(let c=t.length-1;c>=0;c--)if(a[c]===t[c])s[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${t}].`);if(s.map((c,d)=>c>1?d:-1).filter(c=>c>=0).length===0)return Jo(n);let o={x:n},l={reps:s};return ae.runKernel(Iu,o,l)}var Md=se({broadcastTo_:kxe});function Sxe(e){let t={x:H(e,"x","ceil","float32")};return ae.runKernel(Fh,t)}var XI=se({ceil_:Sxe});function Gs(e,t,n){Zs(e),n=n||wb(t);let r={shape:e,value:t,dtype:n};return ae.runKernel(Ib,{},r)}function Cxe(e,t,n){let r=H(e,"x","clipByValue");if(Y(t<=n,()=>`Error in clip: min (${t}) must be less than or equal to max (${n}).`),t===n)return Gs(r.shape,t,r.dtype);let a={x:r},s={clipValueMin:t,clipValueMax:n};return ae.runKernel(ju,a,s)}var Wa=se({clipByValue_:Cxe});function _xe(e){return pr(e,0)}var ZI=se({concat1d_:_xe});function jxe(e,t){return pr(e,t)}var QI=se({concat2d_:jxe});function Ixe(e,t){return pr(e,t)}var JI=se({concat3d_:Ixe});function Txe(e,t){return pr(e,t)}var eT=se({concat4d_:Txe});function Exe(e,t,n,r,a="NHWC",s=[1,1],o){let l=H(e,"x","conv2d","float32"),c=H(t,"filter","conv2d","float32"),d=l,u=!1;l.rank===3&&(u=!0,d=me(l,[1,l.shape[0],l.shape[1],l.shape[2]])),Y(d.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${d.rank}.`),Y(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),rs("conv2d",r,o);let h=a==="NHWC"?d.shape[3]:d.shape[1];Y(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),Y(ml(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Y(ch(s),()=>"Error in conv2D: Dilated rates should be larger than 0."),Y(ch(n),()=>"Error in conv2D: Strides should be larger than 0.");let p={x:d,filter:c},m={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o},f=ae.runKernel(Ph,p,m);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Ja=se({conv2d_:Exe});function Axe(e,t,n,r,a="NWC",s=1,o){let l=H(e,"x","conv1d"),c=H(t,"filter","conv1d"),d=l,u=!1;l.rank===2&&(u=!0,d=me(l,[1,l.shape[0],l.shape[1]])),Y(d.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${d.rank}.`),Y(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),rs("conv1d",r,o),Y(d.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${d.shape[2]}) must match input depth for filter ${c.shape[1]}.`),Y(ml(n,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${s}'`),Y(ch(s),()=>"Error in conv1D: Dilated rates should be larger than 0."),Y(ch(n),()=>"Error in conv1D: Stride should be larger than 0."),Y(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let h=me(c,[1,c.shape[0],c.shape[1],c.shape[2]]),p=me(d,[d.shape[0],1,d.shape[1],d.shape[2]]),m=Ja(p,h,[1,n],r,"NHWC",[1,s],o);return u?me(m,[m.shape[2],m.shape[3]]):me(m,[m.shape[0],m.shape[2],m.shape[3]])}var nN=se({conv1d_:Axe});function Rxe(e,t,n,r,a,s="NHWC",o){Y(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let l=e,c=t,d=!1;t.rank===3&&(d=!0,c=me(t,[1,t.shape[0],t.shape[1],t.shape[2]]),l=[1,e[0],e[1],e[2]]),Y(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),Y(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),Y(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);let u=s==="NHWC"?l[3]:l[1],h=s==="NHWC"?c.shape[3]:c.shape[1];Y(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),Y(h===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`),rs("conv2dDerInput",a,o);let p={dy:c,filter:n},m={strides:r,pad:a,dataFormat:s,dimRoundingMode:o,inputShape:l},f=ae.runKernel(Oh,p,m);return d?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var tT=se({conv2DBackpropInput_:Rxe});function Dxe(e,t,n,r,a,s){let o=H(e,"x","conv2dTranspose"),l=H(t,"filter","conv2dTranspose");return tT(n,o,l,r,a,"NHWC",s)}var rN=se({conv2dTranspose_:Dxe});function Mxe(e,t,n,r,a="NDHWC",s=[1,1,1]){let o=H(e,"x","conv3d"),l=H(t,"filter","conv3d"),c=o,d=!1;o.rank===4&&(d=!0,c=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),Y(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),Y(c.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${l.shape[3]}.`),Y(ml(n,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),Y(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`),Y(ch(s),()=>"Error in conv3D: Dilated rates should be larger than 0."),Y(ch(n),()=>"Error in conv3D: Strides should be larger than 0.");let u={x:c,filter:l},h={strides:n,pad:r,dataFormat:a,dilations:s},p=ae.runKernel(Lh,u,h);return d?me(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var nT=se({conv3d_:Mxe});function $xe(e,t,n,r,a){Y(e.length===t.rank,()=>`Length of inShape (${e.length}) and rank of dy (${t.rank}) must match`);let s=e,o=t,l=!1;t.rank===4&&(l=!0,o=me(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),s=[1,e[0],e[1],e[2],e[3]]);let c=s[4],d=o.shape[4];Y(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),Y(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),Y(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),Y(c===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${n.shape[3]}.`),Y(d===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[4]}.`);let u={dy:o,filter:n},h={pad:a,strides:r,inputShape:s},p=ae.runKernel(Xf,u,h);return l?me(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var OW=se({conv3DBackpropInput_:$xe});function Fxe(e,t,n,r,a){let s=H(e,"x","conv3dTranspose"),o=H(t,"filter","conv3dTranspose");return OW(n,s,o,r,a)}var rT=se({conv3dTranspose_:Fxe});function Pxe(e){let t={x:H(e,"x","cos","float32")};return ae.runKernel(zh,t)}var Xb=se({cos_:Pxe});function Oxe(e){let t={x:H(e,"x","cosh","float32")};return ae.runKernel(Bh,t)}var aN=se({cosh_:Oxe});function Lxe(e,t=0,n=!1,r=!1){let a={x:H(e,"x","cumprod")},s={axis:t,exclusive:n,reverse:r};return ae.runKernel(Zf,a,s)}var Vy=se({cumprod_:Lxe});function zxe(e,t=0,n=!1,r=!1){let a={x:H(e,"x","cumsum")},s={axis:t,exclusive:n,reverse:r};return ae.runKernel(Wh,a,s)}var sN=se({cumsum_:zxe});function Bxe(e,t,n,r=!1){let a=H(e,"x","denseBincount"),s=H(t,"weights","denseBincount");Y(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),Y(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),Y(n>=0,()=>`size must be non-negative, but got ${n}.`),Y(s.size===a.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${s.shape}.`);let o={x:a,weights:s},l={size:n,binaryOutput:r};return ae.runKernel(_b,o,l)}var L0=se({denseBincount_:Bxe});function Wxe(e,t,n="NHWC"){let r=H(e,"x","depthToSpace","float32"),a=n==="NHWC"?r.shape[1]:r.shape[2],s=n==="NHWC"?r.shape[2]:r.shape[3],o=n==="NHWC"?r.shape[3]:r.shape[1];Y(t>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${t}`),Y(a*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${t}  for depthToSpace with input shape
    ${r.shape}`),Y(s*t>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${t} for depthToSpace with input shape
        ${r.shape}`),Y(o%(t*t)===0,()=>`Dimension size must be evenly divisible by ${t*t} but is ${o} for depthToSpace with input shape ${r.shape}`);let l={x:r},c={blockSize:t,dataFormat:n};return ae.runKernel(Jf,l,c)}var aT=se({depthToSpace_:Wxe});function Uxe(e,t,n,r,a="NHWC",s=[1,1],o){let l=H(e,"x","depthwiseConv2d","float32"),c=H(t,"filter","depthwiseConv2d","float32"),d=l,u=!1;l.rank===3&&(u=!0,d=me(l,[1,l.shape[0],l.shape[1],l.shape[2]])),Y(d.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),Y(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);let h=a==="NHWC"?d.shape[3]:d.shape[1];Y(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),rs("depthwiseConv2d",r,o);let p={x:d,filter:c},m={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o},f=ae.runKernel(Uh,p,m);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Vp=se({depthwiseConv2d_:Uxe});function Vxe(e){let t={x:H(e,"x","diag")};return ae.runKernel(jb,t)}var LW=se({diag_:Vxe});function Hxe(e,t,n,r,a=[1,1],s="NHWC"){let o=H(e,"x","dilation2d"),l=H(t,"filter","dilation2d");Y(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),Y(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),Y(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let c=o,d=!1;o.rank===3&&(c=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),d=!0),Y(c.shape[3]===l.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${l.shape[2]}`);let u={x:c,filter:l},h={strides:n,pad:r,dilations:a},p=ae.runKernel(Vh,u,h);return d?me(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var sT=se({dilation2d_:Hxe}),Bg={};nn(Bg,{assertAndGetBroadcastShape:()=>mr,getBroadcastDims:()=>zW,getReductionAxes:()=>ea});function zW(e,t){let n=e.length,r=[];for(let a=0;a<n;a++){let s=n-1-a,o=e[s]||1;(t[t.length-1-a]||1)>1&&o===1&&r.unshift(s)}return r}function ea(e,t){let n=[];for(let r=0;r<t.length;r++){let a=e[e.length-r-1],s=t.length-r-1,o=t[s];(a==null||a===1&&o>1)&&n.unshift(s)}return n}function mr(e,t){let n=Math.max(e.length,t.length),r=new Array(n);for(let a=0;a<n;a++){let s=e[e.length-a-1];s==null&&(s=1);let o=t[t.length-a-1];if(o==null&&(o=1),s===1)r[n-a-1]=o;else if(o===1)r[n-a-1]=s;else if(s!==o){let l=`Operands could not be broadcast together with shapes ${e} and ${t}.`;throw Error(l)}else r[n-a-1]=s}return r}function Gxe(e,t){let n=H(e,"a","equal","string_or_numeric"),r=H(t,"b","equal","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(tg,a)}var qs=se({equal_:Gxe});function qxe(e,t,n){let r=H(t,"a","where"),a=H(n,"b","where"),s=H(e,"condition","where","bool"),o=mr(mr(s.shape,r.shape),a.shape),l=Md(s,o),c=Md(r,o),d=Md(a,o),u={condition:l,t:c,e:d};return ae.runKernel(Tg,u)}var Ia=se({where_:qxe});function Kxe(e){let t={x:H(e,"x","zerosLike")};return ae.runKernel(Lg,t)}var Pn=se({zerosLike_:Kxe});function Yxe(e,t){let n=H(e,"a","div"),r=H(t,"b","div");[n,r]=Or(n,r);let a=pt(n,r),s=Pn(a),o=qs(r,s);return Ia(o,s,a)}var iT=se({divNoNan_:Yxe});function Xxe(e,t){let n=H(e,"t1","dot"),r=H(t,"t2","dot");Y((n.rank===1||n.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${r.rank}.`);let a=n.rank===1?n.size:n.shape[1],s=r.rank===1?r.size:r.shape[0];if(Y(a===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${s}.`),n.rank===1&&r.rank===1){let o=me(n,[1,-1]),l=me(r,[-1,1]),c=un(o,l);return me(c,[])}else if(n.rank===1&&r.rank===2){let o=me(n,[1,-1]),l=me(r,[r.shape[0],r.shape[1]]),c=un(o,l);return me(c,[c.size])}else if(n.rank===2&&r.rank===1){let o=me(r,[-1,1]),l=un(n,o);return me(l,[l.size])}else{let o=me(r,[r.shape[0],r.shape[1]]);return un(n,o)}}var oT=se({dot_:Xxe});function Zxe(e,...t){let n=t.map((a,s)=>H(a,`tensors${s}`,"einsum")),r={equation:e};return ae.runKernel(U1,n,r)}var cd=se({einsum_:Zxe});function Qxe(e){let t={x:H(e,"x","elu","float32")};return ae.runKernel(Gh,t)}var Wg=se({elu_:Qxe});function Jxe(e,t){let n=H(e,"x","ensureShape","string_or_numeric");if(!V6(n.shape,t))throw new Error(`EnsureShape: Shape of tensor ${n.shape} is not compatible with expected shape ${t}`);return e}var BW=se({ensureShape_:Jxe});function eye(e){let t=H(e,"x","erf");Y(t.dtype==="int32"||t.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),t.dtype==="int32"&&(t=He(t,"float32"));let n={x:t};return ae.runKernel(qh,n)}var iN=se({erf_:eye});function lT(e,t){for(let n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function WW(e,t,n){let r=e.length+t.length,a=[],s=0,o=0;for(let l=0;l<r;l++)n.indexOf(l)===-1?a.push(e[s++]):a.push(t[o++]);return a}function UW(e,t){let n=[],r=e.length;for(let s=0;s<r;s++)t.indexOf(s)===-1&&n.push(e[s]);let a=t.map(s=>e[s]);return[n,a]}function uh(e,t){let n=t.map(r=>1);return WW(e,n,t)}function tye(e,t,n){Y(lT(t,n),()=>`${e} supports only inner-most axes for now. Got axes ${t} and rank-${n} input.`)}function VW(e,t){if(lT(e,t))return null;let n=[];for(let r=0;r<t;++r)e.indexOf(r)===-1&&n.push(r);return e.forEach(r=>n.push(r)),n}function cT(e){return e.map((t,n)=>[n,t]).sort((t,n)=>t[1]-n[1]).map(t=>t[0])}function nye(e,t){let n=[];for(let r=t-e;r<t;++r)n.push(r);return n}function rye(e,t=null,n=!1){let r={x:H(e,"x","max")},a={reductionIndices:t,keepDims:n};return ae.runKernel(lp,r,a)}var di=se({max_:rye});function aye(e,t=null,n=!1){let r={x:H(e,"x","min")},a={axis:t,keepDims:n};return ae.runKernel(hp,r,a)}var mf=se({min_:aye});function sye(e,t){let n=H(e,"base","pow"),r=H(t,"exp","pow");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(bp,a)}var ll=se({pow_:sye});function Rt(e,t){if((Ca(e)&&t!=="string"||Array.isArray(e))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Ca(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Eu(e,[],[],t)}function iye(e){let t={x:H(e,"x","sqrt","float32")};return ae.runKernel(Fp,t)}var Ta=se({sqrt_:iye});function oye(e){let t=H(e,"x","square"),n={};return ae.runKernel("Square",{x:t},n)}var hr=se({square_:oye});function lye(e,t=null,n=!1){let r=H(e,"x","sum");r.dtype==="bool"&&(r=He(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return ae.runKernel(Pp,a,s)}var xt=se({sum_:lye});function cye(e,t="euclidean",n=null,r=!1){e=H(e,"x","norm");let a=HW(e,t,n),s=a.shape;if(r){let o=Hi(n,e.shape);s=uh(a.shape,o)}return me(a,s)}function HW(e,t,n=null){if(e.rank===0)return Xr(e);if(e.rank!==1&&n===null)return HW(me(e,[-1]),t,n);if(e.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(t===1)return xt(Xr(e),n);if(t===1/0)return di(Xr(e),n);if(t===-1/0)return mf(Xr(e),n);if(t==="euclidean"||t===2)return Ta(xt(ll(Xr(e),Rt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}if(Array.isArray(n)&&n.length===2){if(t===1)return di(xt(Xr(e),n[0]),n[1]-1);if(t===1/0)return di(xt(Xr(e),n[1]),n[0]);if(t===-1/0)return mf(xt(Xr(e),n[1]),n[0]);if(t==="fro"||t==="euclidean")return Ta(xt(hr(e),n));throw new Error(`Error in norm: invalid ord value: ${t}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}var Ug=se({norm_:cye});function uye(e,t=null,n=!1){return Ug(e,"euclidean",t,n)}var uT=se({euclideanNorm_:uye});function dye(e){let t={x:H(e,"x","exp")};return ae.runKernel(Kh,t)}var Ua=se({exp_:dye});function hye(e,t=0){let n=H(e,"x","expandDims","string_or_numeric");Y(t<=n.rank,()=>"Axis must be <= rank of the tensor");let r={input:n},a={dim:t};return ae.runKernel(ng,r,a)}var _a=se({expandDims_:hye});function pye(e){let t={x:H(e,"x","expm1")};return ae.runKernel(Yh,t)}var dT=se({expm1_:pye});function mye(e,t){let n=H(e,"x","tile","string_or_numeric");Y(n.rank===t.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${t}.`);let r={x:n},a={reps:t};return ae.runKernel(Iu,r,a)}var Us=se({tile_:mye});function fye(e,t,n,r="float32"){t==null&&(t=e);let a=pn([e,t],r),s=e<=t?e:t;for(let l=0;l<s;++l)a.set(1,l,l);let o=me(a.toTensor(),[e,t]);if(n==null)return o;if(n.length===1)return Us(_a(o,0),[n[0],1,1]);if(n.length===2)return Us(_a(_a(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Us(_a(_a(_a(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}var oN=se({eye_:fye});function gye(e){let t={x:H(e,"x","floor","float32")};return ae.runKernel(Xh,t)}var Vg=se({floor_:gye});function xye(e,t,n=0,r=0){let a=H(e,"x","gather"),s=H(t,"indices","gather","int32"),o={x:a,indices:s},l={axis:n,batchDims:r};return ae.runKernel(ag,o,l)}var Hg=se({gather_:xye});function yye(e,t){let n=H(e,"a","greater","string_or_numeric"),r=H(t,"b","greater","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(ig,a)}var as=se({greater_:yye});function bye(e,t){let n=H(e,"a","greaterEqual","string_or_numeric"),r=H(t,"b","greaterEqual","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(Jh,a)}var nc=se({greaterEqual_:bye});function vye(e){let t={input:H(e,"input","imag")};return ae.runKernel(G1,t)}var Zb=se({imag_:vye});function wye(e){let t={x:H(e,"x","isFinite")};return ae.runKernel(tp,t)}var hT=se({isFinite_:wye});function Nye(e){let t={x:H(e,"x","isInf")};return ae.runKernel(np,t)}var pT=se({isInf_:Nye});function kye(e){let t={x:H(e,"x","isNaN")};return ae.runKernel(rp,t)}var mT=se({isNaN_:kye});function Sye(e,t=.2){let n={x:H(e,"x","leakyRelu")},r={alpha:t};return ae.runKernel(ap,n,r)}var Qb=se({leakyRelu_:Sye});function Cye(e,t){let n=H(e,"a","less","string_or_numeric"),r=H(t,"b","less","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(og,a)}var ff=se({less_:Cye});function _ye(e,t){let n=H(e,"a","lessEqual","string_or_numeric"),r=H(t,"b","lessEqual","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(lg,a)}var Au=se({lessEqual_:_ye});function GW(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");let r={start:e,stop:t,num:n};return ae.runKernel(cg,{},r)}function jye(e,t=5,n=1,r=1,a=.5){let s=H(e,"x","localResponseNormalization");Y(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),Y(uf(t),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${t}.`);let o=s,l=!1;s.rank===3&&(l=!0,o=me(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let c={x:o},d={depthRadius:t,bias:n,alpha:r,beta:a},u=ae.runKernel(op,c,d);return l?me(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var fT=se({localResponseNormalization_:jye});function Iye(e){let t={x:H(e,"x","log","float32")};return ae.runKernel(sp,t)}var Ks=se({log_:Iye});function Tye(e){let t={x:H(e,"x","log1p")};return ae.runKernel(ip,t)}var Jb=se({log1p_:Tye});function Eye(e){return Y(iu(e),()=>"The f passed in grad(f) must be a function"),(t,n)=>{let r=H(t,"x","tf.grad","string_or_numeric"),a=n!=null?H(n,"dy","tf.grad"):null;return ae.tidy(()=>{let{value:s,grads:o}=ae.gradients(()=>e(r),[r],a);return a!=null&&ns(s.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),lN(o),o[0]})}}function Aye(e){return Y(iu(e),()=>"The f passed in grads(f) must be a function"),(t,n)=>{Y(Array.isArray(t),()=>"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s");let r=zy(t,"args","tf.grads","string_or_numeric"),a=n!=null?H(n,"dy","tf.grads"):null;return ae.tidy(()=>{let{value:s,grads:o}=ae.gradients(()=>e(...r),r,a);return a!=null&&ns(s.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),lN(o),o})}}function Rye(e){return Y(iu(e),()=>"The f passed in valueAndGrad(f) must be a function"),(t,n)=>{Y(t instanceof on,()=>"The x passed in valueAndGrad(f)(x) must be a tensor"),Y(n==null||n instanceof on,()=>"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");let{grads:r,value:a}=ae.gradients(()=>e(t),[t],n);return lN(r),{grad:r[0],value:a}}}function Dye(e){return Y(iu(e),()=>"The f passed in valueAndGrads(f) must be a function"),(t,n)=>{Y(Array.isArray(t)&&t.every(a=>a instanceof on),()=>"The args passed in valueAndGrads(f)(args) must be array of tensors"),Y(n==null||n instanceof on,()=>"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");let r=ae.gradients(()=>e(...t),t,n);return n!=null&&ns(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),lN(r.grads),r}}function qW(e,t){Y(iu(e),()=>"The f passed in variableGrads(f) must be a function"),Y(t==null||Array.isArray(t)&&t.every(d=>d instanceof ah),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let n=t!=null;if(!n){t=[];for(let d in ae.registeredVariables)t.push(ae.registeredVariables[d])}let r=n?t.filter(d=>!d.trainable):null,a=t.length;t=t.filter(d=>d.trainable),Y(t.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let s=!0,{value:o,grads:l}=ae.gradients(e,t,null,s);Y(l.some(d=>d!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),Y(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let c={};return t.forEach((d,u)=>{l[u]!=null&&(c[d.name]=l[u])}),r!=null&&r.forEach(d=>c[d.name]=null),{value:o,grads:c}}function cl(e){return ae.customGrad(e)}function lN(e){if(e.filter(t=>t==null).length>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Mye(e){let t={x:H(e,"x","neg")};return ae.runKernel(gg,t)}var Cr=se({neg_:Mye});function $ye(e){let t={x:H(e,"x","softplus")};return ae.runKernel($p,t)}var Hp=se({softplus_:$ye});function Fye(e){let t=H(e,"x","logSigmoid");return cl(n=>({value:Cr(Hp(Cr(n))),gradFunc:r=>oe(r,Li(Cr(n)))}))(t)}var gT=se({logSigmoid_:Fye});function Pye(e,t){let n=H(e,"a","sub"),r=H(t,"b","sub");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(zp,a)}var ot=se({sub_:Pye});function Oye(e,t=-1){let n=H(e,"logits","logSoftmax");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${t}`);return cl((r,a)=>{let s=di(r,t,!0),o=ot(r,s),l=ot(He(o,"float32"),Ks(xt(Ua(o),t,!0)));return a([l]),{value:l,gradFunc:(c,d)=>{let[u]=d,h=!0,p=Ua(u);return ot(c,oe(xt(c,t,h),p))}}})(n)}var cN=se({logSoftmax_:Oye});function Lye(e,t=null,n=!1){let r=H(e,"x","logSumExp"),a=Hi(t,r.shape),s=di(r,a,!0),o=ot(r,s),l=Ua(o),c=xt(l,a),d=Ks(c),u=Re(me(s,d.shape),d);if(n){let h=uh(u.shape,a);return me(u,h)}return u}var ev=se({logSumExp_:Lye});function zye(e,t){let n=H(e,"a","logicalAnd","bool"),r=H(t,"b","logicalAnd","bool");mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(ug,a)}var Wi=se({logicalAnd_:zye});function Bye(e){let t={x:H(e,"x","logicalNot","bool")};return ae.runKernel(dg,t)}var tv=se({logicalNot_:Bye});function Wye(e,t){let n=H(e,"a","logicalOr","bool"),r=H(t,"b","logicalOr","bool");mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(hg,a)}var uN=se({logicalOr_:Wye});function Uye(e,t){let n=H(e,"a","logicalXor","bool"),r=H(t,"b","logicalXor","bool");return mr(n.shape,r.shape),Wi(uN(e,t),tv(Wi(e,t)))}var xT=se({logicalXor_:Uye}),Qv=2147483648;function Vye(e,t,n="left"){let r=H(e,"sortedSequence","searchSorted"),a=H(t,"values","searchSorted"),s=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],l=me(r,[-1,s]),c=me(a,[-1,o]);if(l.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(l.shape[0]!==c.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ir(c.shape)>=Qv)throw new Error(`values tensor size must less than ${Qv}`);if(l.shape[1]>=Qv)throw new Error(`trailing dim_size must less than ${Qv} for int32 output type, was ${l.shape[1]}`);let d={sortedSequence:l,values:c},u={side:n};return ae.runKernel(Ig,d,u)}var dN=se({searchSorted_:Vye});function KW(e,t){return dN(e,t,"left")}function Hye(e,t,n,r,a){let s=H(e,"x","maxPool"),o=1,l=s,c=!1;s.rank===3&&(c=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),Y(ml(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),rs("maxPool",r,a);let d={x:l},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a},h=ae.runKernel(up,d,u);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var va=se({maxPool_:Hye});function Gye(e,t=[1,1,1],n,r,a,s="NDHWC"){let o=H(e,"x","maxPool3d"),l=o,c=!1;o.rank===4&&(c=!0,l=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Y(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),Y(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),rs("maxPool3d",r,a);let d={x:l},u={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:s},h=ae.runKernel(mg,d,u);return c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var yT=se({maxPool3d_:Gye});function qye(e,t,n,r,a=!1){let s={x:H(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},l=ae.runKernel(Ab,s,o);return{result:l[0],indexes:l[1]}}var YW=se({maxPoolWithArgmax_:qye});function Kye(e,t){let n=H(e,"a","maximum"),r=H(t,"b","maximum");[n,r]=Or(n,r),n.dtype==="bool"&&(n=He(n,"int32"),r=He(r,"int32")),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(cp,a)}var fl=se({maximum_:Kye});function Yye(e,t=null,n=!1){let r={x:H(e,"x","mean")},a={axis:t,keepDims:n};return ae.runKernel(dp,r,a)}var $r=se({mean_:Yye});function Fr(e,t="float32"){if(Zs(e),t==="complex64"){let r=Fr(e,"float32"),a=Fr(e,"float32");return Vl(r,a)}let n=F1(ir(e),t);return ae.makeTensor(n,e,t)}function ys(e,t="float32"){if(Zs(e),t==="complex64"){let r=ys(e,"float32"),a=Fr(e,"float32");return Vl(r,a)}let n=CI(ir(e),t);return ae.makeTensor(n,e,t)}function XW(e,t,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(e===void 0)return[];let r=H(e,"x","meshgrid",e instanceof on?e.dtype:"float32");if(t===void 0)return[r];let a=H(t,"y","meshgrid",t instanceof on?t.dtype:"float32"),s=ir(r.shape),o=ir(a.shape);return n==="xy"?(r=me(r,[1,-1]),a=me(a,[-1,1]),[un(ys([o,1],r.dtype),r),un(a,ys([1,s],a.dtype))]):(r=me(r,[-1,1]),a=me(a,[1,-1]),[un(r,ys([1,o],r.dtype)),un(ys([s,1],a.dtype),a)])}function Xye(e,t){let n=H(e,"a","minimum"),r=H(t,"b","minimum");[n,r]=Or(n,r),n.dtype==="bool"&&(n=He(n,"int32"),r=He(r,"int32")),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(pp,a)}var hu=se({minimum_:Xye});function Zye(e,t,n){Y(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);let r=H(e,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Y(t.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${t.length}.`);let a=n==="reflect"?1:0;for(let l=0;l<r.rank;l++)Y(t[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Y(t[l][0]>=0&&t[l][0]<=r.shape[l]-a&&t[l][1]>=0&&t[l][1]<=r.shape[l]-a,()=>`Padding in dimension ${l} cannot be greater than or equal to ${r.shape[l]-a} or less than 0 for input of shape ${r.shape}`);let s={paddings:t,mode:n},o={x:r};return ae.runKernel(mp,o,s)}var bT=se({mirrorPad_:Zye});function Qye(e,t){let n=H(e,"a","mod"),r=H(t,"b","mod");[n,r]=Or(n,r);let a={a:n,b:r};return ae.runKernel(fp,a)}var vT=se({mod_:Qye});function Jye(e,t=null,n=!1){e=H(e,"x","moments");let r=Hi(t,e.shape),a=$r(e,r,n),s=a.shape;n||(s=uh(a.shape,r));let o=hr(ot(He(e,"float32"),me(a,s))),l=$r(o,r,n);return{mean:a,variance:l}}var nv=se({moments_:Jye});function ebe(e,t,n,r){let a=H(t,"data","multiRNNCell"),s=zy(n,"c","multiRNNCell"),o=zy(r,"h","multiRNNCell"),l=a,c=[];for(let h=0;h<e.length;h++){let p=e[h](l,s[h],o[h]);c.push(p[0]),c.push(p[1]),l=p[1]}let d=[],u=[];for(let h=0;h<c.length;h+=2)d.push(c[h]),u.push(c[h+1]);return[d,u]}var ZW=se({multiRNNCell_:ebe});function tbe(e,t,n,r=!1){let a=H(e,"logits","multinomial"),s=a.size,o=a.rank;if(s<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${s}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);n=n||Math.random();let l={logits:o===1?me(a,[1,-1]):a},c={numSamples:t,seed:n,normalized:r},d=ae.runKernel(fg,l,c);return o===1?me(d,[d.size]):d}var QW=se({multinomial_:tbe});function nbe(e,t){let n=H(e,"a","notEqual","string_or_numeric"),r=H(t,"b","notEqual","string_or_numeric");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r};return ae.runKernel(xg,a)}var dh=se({notEqual_:nbe});function rbe(e,t,n=1,r=0,a="int32"){if(t<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${t}`);let s={indices:H(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return ae.runKernel(xp,s,o)}var gf=se({oneHot_:rbe});function abe(e){let t={x:H(e,"x","onesLike")};return ae.runKernel(wg,t)}var Ys=se({onesLike_:abe});function sbe(e,t){let n=H(e,"v1","outerProduct"),r=H(t,"v2","outerProduct");Y(n.rank===1&&r.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${r.rank}.`);let a=me(n,[-1,1]),s=me(r,[1,-1]);return un(a,s)}var JW=se({outerProduct_:sbe});function ibe(e,t,n=0){let r=H(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:t,constantValue:n},s={x:r};return ae.runKernel(yp,s,a)}var jo=se({pad_:ibe});function obe(e,t,n=0){return Y(t.length===2,()=>"Invalid number of paddings. Must be length of 2."),jo(e,[t],n)}var eU=se({pad1d_:obe});function lbe(e,t,n=0){return Y(t.length===2&&t[0].length===2&&t[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),jo(e,t,n)}var tU=se({pad2d_:lbe});function cbe(e,t,n=0){return Y(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),jo(e,t,n)}var nU=se({pad3d_:cbe});function ube(e,t,n=0){return Y(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),jo(e,t,n)}var rU=se({pad4d_:ube});function dbe(e,t,n){let r=H(e,"x","spaceToBatchND");Y(r.rank>=1+t.length,()=>`input rank ${r.rank} should be > than [blockShape] ${t.length}`),Y(n.length===t.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${t.length}`),Y(r.shape.reduce((o,l,c)=>c>0&&c<=t.length?o&&(l+n[c-1][0]+n[c-1][1])%t[c-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${t.toString()}`);let a={x:r},s={blockShape:t,paddings:n};return ae.runKernel(Ag,a,s)}var rv=se({spaceToBatchND_:dbe});function hbe(e,t,n,r,a,s,o){a==null&&(a=[1,1]),s==null&&(s=1),r===0&&(r="valid");let l=H(e,"x","maxPool"),c=l,d=!1;l.rank===3&&(d=!0,c=me(l,[1,l.shape[0],l.shape[1],l.shape[2]])),Y(ml(s,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${a}'`);let u=RW(c.shape,t,s,a,r),h=[u.dilationHeight,u.dilationWidth],p;r==="same"?p=mbe([u.filterHeight,u.filterWidth],h):p=[[0,0],[0,0]];let m=h[0]===1&&h[1]===1,[f,g]=pbe([u.inHeight,u.inWidth],h,p),x=m?r:"valid",y=m?c:rv(c,h,f),b=(n==="avg"?()=>tc(y,t,s,x,o):()=>va(y,t,s,x,o))(),v=m?b:Yb(b,h,g);return d?me(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function pbe(e,t,n){let r=n.map(u=>u[0]),a=n.map(u=>u[1]),s=e.concat(r,a),o=t.map((u,h)=>(u-s[h]%u)%u),l=a.map((u,h)=>u+o[h]),c=t.map((u,h)=>[r[h],l[h]]),d=t.map((u,h)=>[0,o[h]]);return[c,d]}function mbe(e,t){let n=e.map((s,o)=>s+(s-1)*(t[o]-1)).map(s=>s-1),r=n.map(s=>Math.floor(s/2)),a=n.map((s,o)=>s-r[o]);return n.map((s,o)=>[r[o],a[o]])}var wT=se({pool_:hbe});function fbe(e,t){let n=H(e,"x","prelu"),r=H(t,"alpha","prelu"),a={x:n,alpha:r};return ae.runKernel(vp,a)}var av=se({prelu_:fbe});function gbe(e,t=null,n=!1){let r=H(e,"x","prod");r.dtype==="bool"&&(r=He(r,"int32"));let a={x:r},s={axis:t,keepDims:n};return ae.runKernel(wp,a,s)}var NT=se({prod_:gbe});function xbe(e,t,n,r){let a=e.map((u,h)=>H(u,`tensors${h}`,"raggedGather","int32")),s=H(t,"paramsDenseValues","raggedGather"),o=H(n,"indices","raggedGather","int32"),l={paramsNestedSplits:a,paramsDenseValues:s,indices:o},c={outputRaggedRank:r},d=ae.runKernel(q1,l,c);return{outputNestedSplits:d.slice(0,d.length-1),outputDenseValues:d[d.length-1]}}var aU=se({raggedGather_:xbe});function ybe(e,t,n){let r=H(e,"starts","raggedRange"),a=H(t,"limits","raggedRange",r.dtype),s=H(n,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:s},l=ae.runKernel(K1,o);return{rtNestedSplits:l[0],rtDenseValues:l[1]}}var sU=se({raggedRange_:ybe});function bbe(e,t,n,r,a){let s=H(e,"shape","raggedTensorToTensor","int32"),o=H(t,"values","raggedTensorToTensor"),l=H(n,"defaultValue","raggedTensorToTensor",o.dtype),c=r.map((h,p)=>H(h,`tensors${p}`,"raggedTensorToTensor","int32")),d={shape:s,values:o,defaultValue:l,rowPartitionTensors:c},u={rowPartitionTypes:a};return ae.runKernel(Y1,d,u)}var iU=se({raggedTensorToTensor_:bbe});function vbe(e,t,n){Zs(e);let r=ir(e),a=null;if(n==null||n==="float32")a=new Float32Array(r);else if(n==="int32")a=new Int32Array(r);else if(n==="bool")a=new Uint8Array(r);else throw new Error(`Unknown data type ${n}`);for(let s=0;s<r;s++)a[s]=t();return ae.makeTensor(a,e,n)}var oU=se({rand_:vbe}),kT=Cu(M1()),lU={};nn(lU,{TEST_EPSILON_FLOAT16:()=>cU,createVideoElement:()=>Ibe,encodeStrings:()=>uU,expectArrayBuffersEqual:()=>jbe,expectArraysClose:()=>Nbe,expectArraysEqual:()=>Sbe,expectNumbersClose:()=>Cbe,expectPromiseToFail:()=>kbe,expectValuesInRange:()=>_be,play:()=>Tbe,testEpsilon:()=>ST});var wbe=.001,cU=.1;function Nbe(e,t,n){return n==null&&(n=ST()),WC(e,t,(r,a)=>CT(r,a,n))}function ST(){return ae.backend.floatPrecision()===32?wbe:cU}function WC(e,t,n){let r=!0;if((Ca(e)||Ca(t))&&(r=!1),Ca(e)&&Ca(t)&&(r=!0),r){let o=e.constructor.name,l=t.constructor.name;if(o!==l)throw new Error(`Arrays are of different type. Actual: ${o}. Expected: ${l}`)}if(Array.isArray(e)&&Array.isArray(t)){let o=ol(e),l=ol(t);if(!Jl(o,l))throw new Error(`Arrays have different shapes. Actual: [${o}]. Expected: [${l}]`)}let a=Ca(e)?e:ou(e),s=Ca(t)?t:ou(t);if(a.length!==s.length)throw new Error(`Arrays have different lengths actual: ${a.length} vs expected: ${s.length}.
Actual:   ${a}.
Expected: ${s}.`);for(let o=0;o<s.length;++o){let l=a[o],c=s[o];if(!n(l,c))throw new Error(`Arrays differ: actual[${o}] = ${l}, expected[${o}] = ${c}.
Actual:   ${a}.
Expected: ${s}.`)}typeof expect<"u"&&expect().nothing()}function kbe(e,t){e().then(()=>t.fail(),()=>t()),typeof expect<"u"&&expect().nothing()}function Sbe(e,t){let n=typeof t=="string"||typeof t=="number"||typeof t=="boolean"?[t]:t;return Lc(e)||Lc(e[0])||Lc(t)||Lc(t[0])?WC(e,n,(r,a)=>r==a):WC(e,t,(r,a)=>CT(r,a,0))}function Cbe(e,t,n){if(n==null&&(n=ST()),!CT(e,t,n))throw new Error(`Numbers differ: actual === ${e}, expected === ${t}`);typeof expect<"u"&&expect().nothing()}function CT(e,t,n){return!isFinite(e)&&!isFinite(t)?!0:!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function _be(e,t,n){for(let r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error(`Value out of range:${e[r]} low: ${t}, high: ${n}`)}function jbe(e,t){let n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error(`Expected ArrayBuffer to be of length ${r.length}, but it was ${n.length}`);for(let a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error(`Expected ArrayBuffer value at ${a} to be ${r[a]} but got ${n[a]} instead`)}function uU(e){for(let t=0;t<e.length;t++){let n=e[t];Array.isArray(n)?uU(n):e[t]=Hb(n)}return e}function Ibe(e){let t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise(n=>{t.addEventListener("loadeddata",r=>n(t)),t.load()})}async function Tbe(e){await e.play(),"requestVideoFrameCallback"in e&&await new Promise(t=>{e.requestVideoFrameCallback(t)})}var _T=class{constructor(e,t,n,r,a){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=a||Math.random();this.random=kT.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let r=this.nextVal;return this.nextVal=NaN,r}let e,t,n=!1;for(;!n;){let r,a,s;do r=2*this.random()-1,a=2*this.random()-1,s=r*r+a*a;while(s>=1||s===0);let o=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*r*o,t=this.mean+this.stdDev*a*o,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},Ebe=class{constructor(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;let a=r||Math.random();this.randu=kT.alea(a.toString()),this.randn=new _T(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,r,a,s;for(;;){do r=this.randn.nextValue(),s=1+this.c*r;while(s<=0);if(s*=s*s,e=r*r,t=1-.331*e*e,n=.5*e+this.d*(1-s+Math.log(s)),a=this.randu(),a<t||Math.log(a)<n)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},Abe=class{constructor(e=0,t=1,n,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=kT.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Rbe(e,t,n=1,r="float32",a){if(Zs(e),n==null&&(n=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error(`Unsupported data type ${r}`);let s=new Ebe(t,n,r,a),o=pn(e,r);for(let l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}var dU=se({randomGamma_:Rbe});function Dbe(e,t=0,n=1,r,a){if(Zs(e),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let s=new _T(t,n,r,!1,a),o=pn(e,r);for(let l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}var hN=se({randomNormal_:Dbe});function Mbe(e,t,n){if(t!=null&&t==="bool")throw new Error(`Unsupported data type ${t}`);return hN(e,0,1,t,n)}var hU=se({randomStandardNormal_:Mbe});function $be(e,t=0,n=1,r="float32",a){Zs(e);let s=pn(e,r),o=new Abe(t,n,null,a);for(let l=0;l<s.values.length;l++)s.values[l]=o.nextValue();return s.toTensor()}var Ru=se({randomUniform_:$be});function Fbe(e,t,n,r){return Ru(e,t,n,"int32",r)}var pU=se({randomUniformInt_:Fbe});function hh(e,t,n=1,r="float32"){if(n===0)throw new Error("Cannot have a step of zero");let a={start:e,stop:t,step:n,dtype:r};return ae.runKernel(Rb,{},a)}function Pbe(e){let t={input:H(e,"input","real")};return ae.runKernel(X1,t)}var xf=se({real_:Pbe});function Obe(e){let t={x:H(e,"x","reciprocal")};return ae.runKernel(Np,t)}var jT=se({reciprocal_:Obe});function Lbe(e){let t={x:H(e,"x","relu")};return ae.runKernel(kp,t)}var ar=se({relu_:Lbe});function zbe(e){let t={x:H(e,"x","relu6")};return ae.runKernel(_p,t)}var pN=se({relu6_:zbe});function Bbe(e,t){let n={x:H(e,"x","reverse")},r={dims:t};return ae.runKernel(jp,n,r)}var gi=se({reverse_:Bbe});function Wbe(e){let t=H(e,"x","reverse");return Y(t.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${t.rank}.`),gi(t,0)}var mU=se({reverse1d_:Wbe});function Ube(e,t){let n=H(e,"x","reverse");return Y(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),gi(n,t)}var fU=se({reverse2d_:Ube});function Vbe(e,t){let n=H(e,"x","reverse");return Y(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),gi(n,t)}var gU=se({reverse3d_:Vbe});function Hbe(e,t){let n=H(e,"x","reverse");return Y(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),gi(n,t)}var xU=se({reverse4d_:Hbe});function Gbe(e){let t={x:H(e,"x","round")};return ae.runKernel(Ip,t)}var mN=se({round_:Gbe});function qbe(e){let t={x:H(e,"x","rsqrt","float32")};return ae.runKernel(Tp,t)}var fN=se({rsqrt_:qbe});function Kbe(e){let t={x:H(e,"x","selu")};return ae.runKernel(Ep,t)}var gN=se({selu_:Kbe});function Ybe(e,t,n,r,a,s=[1,1],o="NHWC"){let l=H(e,"x","separableConv2d"),c=H(t,"depthwiseFilter","separableConv2d"),d=H(n,"pointwiseFilter","separableConv2d"),u=l,h=!1;if(l.rank===3&&(h=!0,u=me(l,[1,l.shape[0],l.shape[1],l.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Y(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),Y(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),Y(d.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),Y(d.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${d.shape[0]}.`),Y(d.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${d.shape[1]}.`);let p=c.shape[2],m=c.shape[3];Y(d.shape[2]===p*m,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*m}, but got ${d.shape[2]}.`);let f=Vp(u,c,r,a,o,s),g=Ja(f,d,1,"valid",o);return h?me(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Gg=se({separableConv2d_:Ybe});async function Xbe(e,t){let n=H(e,"x","setdiff1d"),r=H(t,"y","setdiff1d");Y(n.dtype===r.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${r.dtype}).`),Y(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),Y(r.rank===1,()=>`y should be 1D tensor, but got y (${r.shape}).`);let a=await n.data(),s=await r.data(),o=new Set(s),l=0;for(let u=0;u<a.length;u++)o.has(a[u])||l++;let c=new Qr([l],n.dtype),d=new Qr([l],"int32");for(let u=0,h=0;u<a.length;u++)o.has(a[u])||(c.values[h]=a[u],d.values[h]=u,h++);return[c.toTensor(),d.toTensor()]}var yU=Xbe;function Zbe(e){let t={x:H(e,"x","sign")};return ae.runKernel(Dp,t)}var IT=se({sign_:Zbe});function Qbe(e){let t={x:H(e,"x","sin","float32")};return ae.runKernel(Ap,t)}var xN=se({sin_:Qbe});function Jbe(e){let t={x:H(e,"x","sinh")};return ae.runKernel(Rp,t)}var yN=se({sinh_:Jbe});function eve(e,t,n){let r=H(e,"x","slice1d");return Y(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),En(r,[t],[n])}var sv=se({slice1d_:eve});function tve(e,t,n){let r=H(e,"x","slice2d");return Y(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),En(r,t,n)}var bN=se({slice2d_:tve});function nve(e,t,n){let r=H(e,"x","slice3d");return Y(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),En(r,t,n)}var qg=se({slice3d_:nve});function rve(e,t,n){let r=H(e,"x","slice4d");return Y(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),En(r,t,n)}var yf=se({slice4d_:rve});function ave(e,t=-1){let n=H(e,"logits","softmax","float32");if(t===-1&&(t=n.rank-1),t!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${t}`);let r={logits:n},a={dim:t};return ae.runKernel(Op,r,a)}var Du=se({softmax_:ave});function sve(e){Y(e.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${e.dtype}.`);let t={input:e};return ae.runKernel(V1,t)}var iv=se({fft_:sve});function ive(e){Y(e.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${e.dtype}.`);let t={input:e};return ae.runKernel(H1,t)}var bf=se({ifft_:ive});function ove(e){let t=e.shape[e.shape.length-1],n=e.size/t,r;if(t<=2){let a=me(e,[n,t]);r=bf(a)}else{let a=[n,2*(t-1)],s=me(xf(e),[n,t]),o=me(Zb(e),[n,t]),l=gi(En(s,[0,1],[n,t-2]),1),c=oe(gi(En(o,[0,1],[n,t-2]),1),Rt(-1)),d=pr([s,l],1),u=pr([o,c],1),h=me(Vl(d,u),[a[0],a[1]]);r=bf(h)}if(r=xf(r),e.rank===3&&e.shape[0]!==0){let a=r,s=e.shape[0];r=me(r,[s,r.shape[0]/s,r.shape[1]]),a.dispose()}return r}var vN=se({irfft_:ove});function lve(e,t,n=0){let r={x:H(e,"x","split")},a={numOrSizeSplits:t,axis:n};return ae.runKernel(Rg,r,a)}var bs=se({split_:lve});function cve(e,t){Y(e.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${e.dtype}`);let n=e.shape[e.shape.length-1],r=e.size/n,a;if(t!=null&&t<n){let f=e.shape.map(x=>0),g=e.shape.map(x=>x);g[e.shape.length-1]=t,a=En(e,f,g),n=t}else if(t!=null&&t>n){let f=e.shape.map(g=>g);f[e.shape.length-1]=t-n,a=pr([e,Fr(f)],e.shape.length-1),n=t}else a=e;let s=Pn(a),o=me(Vl(a,s),[r,n]),l=iv(o),c=Math.floor(n/2)+1,d=xf(l),u=Zb(l),h=bs(d,[c,n-c],d.shape.length-1),p=bs(u,[c,n-c],u.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=c,me(Vl(h[0],p[0]),m)}var ov=se({rfft_:cve});function uve(e,t){let n=H(e,"a","squaredDifference"),r=H(t,"b","squaredDifference");[n,r]=Or(n,r),mr(n.shape,r.shape);let a={a:n,b:r},s={};return ae.runKernel(Lp,a,s)}var wN=se({squaredDifference_:uve});function dve(e,t){let n=H(e,"x","squeeze","string_or_numeric");return me(n,H6(n.shape,t).newShape)}var Mu=se({squeeze_:dve});function hve(e,t=0){let n=zy(e,"tensors","stack","string_or_numeric");Y(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&Y(t<=n[0].rank,()=>"Axis must be <= rank of the tensor");let r=n,a={axis:t};return ae.runKernel(Ng,r,a)}var Jr=se({stack_:hve});function pve(e,t=0){let n={x:H(e,"x","step")},r={alpha:t};return ae.runKernel(Tu,n,r)}var Gp=se({step_:pve});function mve(e,t,n,r,a=0,s=0,o=0,l=0,c=0){let d={x:H(e,"x","stridedSlice","string_or_numeric")},u={begin:t,end:n,strides:r,beginMask:a,endMask:s,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};return ae.runKernel($g,d,u)}var TT=se({stridedSlice_:mve});function fve(e){let t={x:H(e,"x","tan","float32")};return ae.runKernel(Bp,t)}var ET=se({tan_:fve});function er(e,t){Sh(e);let n=ol(e,t);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Eu(e,null,n,t)}function el(e,t,n){if(Sh(e),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=ol(e,n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Eu(e,t,r,n)}function NN(e,t,n){if(Sh(e),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let r=ol(e,n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Eu(e,t,r,n)}function pu(e,t,n){if(Sh(e),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");let r=ol(e,n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Eu(e,t,r,n)}function bU(e,t,n){if(Sh(e),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");let r=ol(e,n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Eu(e,t,r,n)}function vU(e,t,n){if(Sh(e),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");let r=ol(e,n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return t=t||r,Eu(e,t,r,n)}var kN={};nn(kN,{calculateShapes:()=>wU,validateInput:()=>SN,validateUpdateShape:()=>AT});function AT(e,t,n){let r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${t.shape}, shape: ${e}, sliceDim: ${r}, and batchDim: ${a}.`;if(n.rank<a)throw new Error(s+` update.rank < ${a}. `);if(e.length<r+(n.rank-a))throw new Error(s+` Output shape length < ${r+(n.rank-a)}`);if(n.rank!==a+e.length-r)throw new Error(s+` update.rank != ${a+e.length-r}`);for(let o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(s+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${t.shape[o]}).`);for(let o=0;o<n.rank-a;++o)if(n.shape[o+a]!==e[o+r])throw new Error(s+` updates.shape[${o+a}] (${n.shape[o+a]}) != shape[${o+a}] (${e[o+a]})`)}function SN(e,t,n){if(t.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${t.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(t.size===0)throw new Error(`Indices specified for empty output. indices shape: ${t.shape}`);if(e.size===0)throw new Error(`Updates specified for empty output. updates shape: ${e.shape}`)}AT(n,t,e)}function wU(e,t,n){let r=t.shape.length,a=r>1?t.shape[r-1]:1,s=n.length,o=1;for(let h=a;h<s;++h)o*=n[h];let l=a<1?1:a,c=ir(t.shape)/l,d=[...Of(n.slice(0,a)),1],u=ir(n);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:d,outputSize:u}}function gve(e,t,n){let r=H(e,"tensor","tensorScatterupdate"),a=H(t,"indices","tensorScatterupdate","int32"),s=H(n,"updates","tensorScatterupdate");if(SN(s,a,r.shape),r.dtype!==s.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${r.dtype} and ${s.dtype}.`);let o={tensor:r,indices:a,updates:s},l={};return ae.runKernel(jg,o,l)}var NU=se({tensorScatterUpdate_:gve});function xve(e,t=1,n=!0){let r=H(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(t<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${t}`);if(t>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${t}`);let s={x:r},o={k:t,sorted:n},[l,c]=ae.runKernel(Fg,s,o);return{values:l,indices:c}}var RT=se({topk_:xve});function yve(e,t=0,n=1,r,a){if(Zs(e),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new _T(t,n,r,!0,a),o=pn(e,r);for(let l=0;l<o.values.length;l++)o.values[l]=s.nextValue();return o.toTensor()}var CN=se({truncatedNormal_:yve});function bve(e,t=0){let n=H(e,"x","unique","string_or_numeric");Y(n.rank>0,()=>"The input tensor must be at least 1D");let r={x:n},a={axis:t},[s,o]=ae.runKernel(Bb,r,a);return{values:s,indices:o}}var DT=se({unique_:bve});function vve(e,t,n){let r=H(e,"x","unsortedSegmentSum"),a=H(t,"segmentIds","unsortedSegmentSum","int32");Y(uf(n),()=>"numSegments must be of dtype int");let s={x:r,segmentIds:a},o={numSegments:n};return ae.runKernel(Wb,s,o)}var _N=se({unsortedSegmentSum_:vve});function wve(e,t=0){let n=H(e,"x","unstack","string_or_numeric");Y(t>=-n.shape.length&&t<n.shape.length,()=>`Axis = ${t} is not in [-${n.shape.length}, ${n.shape.length})`);let r={value:n},a={axis:t};return ae.runKernel(Og,r,a)}var Ur=se({unstack_:wve});function kU(e,t){return dN(e,t,"right")}function MT(e,t=!0,n,r){return ae.makeVariable(e,t,n,r)}function SU(e,t){let n=[];for(let s=0;s<t.length;s++)t[s]&&n.push(s);let r=pn(e,"int32"),a=pn([n.length,e.length],"int32");for(let s=0;s<n.length;s++){let o=r.indexToLoc(n[s]),l=s*e.length;a.values.set(o,l)}return a.toTensor()}async function Nve(e){let t=H(e,"condition","whereAsync","bool"),n=await t.data(),r=SU(t.shape,n);return e!==t&&t.dispose(),r}var $T=Nve;async function kve(e,t,n){let r=H(e,"tensor","boolMask"),a=H(t,"mask","boolMask","bool"),s=n??0,o=a.rank,l=r.shape;Y(o>0,()=>"mask cannot be scalar"),ns(l.slice(s,s+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,");let c=1;for(let g=s;g<s+o;g++)c*=l[g];let d=l.slice(0,s).concat([c],l.slice(s+o)),u=me(r,d),h=me(a,[-1]),p=await $T(h),m=Mu(p,[1]),f=Hg(u,m,s);return e!==r&&r.dispose(),t!==a&&a.dispose(),m.dispose(),u.dispose(),h.dispose(),p.dispose(),f}var CU=kve;function Sve(e,t,n){let r=H(e,"x","transpose");if(t==null&&(t=r.shape.map((o,l)=>l).reverse()),Y(r.rank===t.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${t}.`),t.forEach(o=>{Y(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${t}`)}),r.rank<=1)return r.clone();let a={x:r},s={perm:t};return r.dtype==="complex64"?fe(()=>{let o=xf(r),l=Zb(r);return o=ae.runKernel(Fl,{x:o},s),l=ae.runKernel(Fl,{x:l},s),n&&(l=Cr(l)),Vl(o,l)}):ae.runKernel(Fl,a,s)}var hn=se({transpose_:Sve});function Cve(e,t,n,r,a=!0){let s=H(e,"v","movingAverage"),o=H(t,"x","movingAverage"),l=H(n,"decay","movingAverage");dW(s,o),Y(Jl(s.shape,o.shape),()=>"Shape mismatch in v and x");let c=Rt(1),d=ot(c,l),u=oe(ot(o,s),d);if(a){Y(r!=null,()=>"When using zeroDebias: true, step is required.");let h=H(r,"step","movingAverage");u=pt(u,ot(c,ll(l,h)))}return Re(s,u)}var _U=se({movingAverage_:Cve});function _ve(e,t,n){Zs(n);let r=H(e,"indices","scatterND","int32"),a=H(t,"updates","scatterND");SN(a,r,n);let s={indices:r,updates:a},o={shape:n};return ae.runKernel(_g,s,o)}var jU=se({scatterND_:_ve});function jve(e,t,n,r){if(e.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${e.shape}.`);let a=e.rank>0?e.shape[0]:1,s=e.rank>1?e.shape[1]:1;if(n.length!==s)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${s}.`);let o=t.size;if(!(t.rank===0||t.rank===1&&o===a))throw new Error(`sparseValues has incorrect shape ${t.shape}, should be [] or [${a}]`);if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Ive(e,t,n,r=0){Zs(n);let a=H(e,"sparseIndices","sparseToDense","int32"),s=H(t,"sparseValues","sparseToDense","string_or_numeric"),o=H(r,"defaultValue","sparseToDense",s.dtype);jve(a,s,n,o);let l={sparseIndices:a,sparseValues:s,defaultValue:o},c={outputShape:n};return ae.runKernel(Mg,l,c)}var IU=se({sparseToDense_:Ive});function Tve(e,t){let n=H(t,"indices","gatherND","int32"),r={params:H(e,"x","gatherND","string_or_numeric"),indices:n};return ae.runKernel(sg,r)}var TU=se({gatherND_:Tve});function Eve(e,t){if(t==null)return e.shape.slice();if(Jl(e.shape,t))return t;if(e.shape.length===t.length){let n=[];for(let r=0;r<e.shape.length;r++)t[r]==null&&e.shape[r]!=null?n.push(e.shape[r]):n.push(t[r]);return n}return t}function Ave(e,t,n,r){let a=H(e,"x","dropout");if(Y(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),Y(t>=0&&t<1,()=>`rate must be a float in the range [0, 1), but got ${t}.`),t===0)return e instanceof on?a.clone():a;let s=Eve(a,n),o=1-t,l=pt(Vg(Re(Ru(s,0,1,"float32",r),o)),o);return oe(a,l)}var FT=se({dropout_:Ave});function PT(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function jN(e,t,n){let r=1-e%2,a=new Float32Array(e);for(let s=0;s<e;++s){let o=2*Math.PI*s/(e+r-1);a[s]=t-n*Math.cos(o)}return er(a,"float32")}async function Rve(e,t,n=1){let r=H(e,"predictions","inTopK"),a=H(t,"targets","inTopK");Y(r.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${r.rank}`),Y(r.rank-1===a.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${r.rank} and targets rank ${a.rank}`),ns(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");let s=r.shape[r.shape.length-1];Y(n>0&&n<=s,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${s}), but got ${n}`);let o=await r.data(),l=await a.data(),[c,d]=[o.length/s,s],u=G6("bool",c);for(let h=0;h<c;h++){let p=h*d,m=o.subarray(p,p+d),f=[];for(let g=0;g<m.length;g++)f.push({value:m[g],index:g});f.sort((g,x)=>x.value-g.value),u[h]=0;for(let g=0;g<n;g++)if(f[g].index===l[h]){u[h]=1;break}}return e!==r&&r.dispose(),t!==a&&a.dispose(),Qa(u,a.shape,"bool")}var EU=Rve,vf={};nn(vf,{conv2d:()=>$ve,depthwiseConv2d:()=>Lve,matMul:()=>Bve});function Dve(e,t,n,r,a,s="NHWC",o){let l=e;e.rank===3&&(l=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;c.rank===3&&(c=me(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Y(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),Y(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),Y(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);let d=s==="NHWC"?l.shape[3]:l.shape[1],u=s==="NHWC"?c.shape[3]:c.shape[1];Y(d===n[2],()=>`Error in conv2dDerFilter: depth of input ${d}) must match input depth in filter (${n[2]}.`),Y(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),rs("conv2dDerFilter",a,o);let h={x:l,dy:c},p={strides:r,pad:a,dataFormat:s,dimRoundingMode:o,filterShape:n};return ae.runKernel(L1,h,p)}var OT=se({conv2DBackpropFilter_:Dve});function IN(e,t,n){if(n==null||n==="linear")return e;if(n==="relu")return oe(e,Gp(t));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function TN(e,t){let n=t,r=ea(e.shape,t.shape);return r.length>0&&(n=xt(n,r)),me(n,e.shape)}function EN(e,t,n,r){if(t==="linear")return e;if(t==="relu")return ar(e);if(t==="elu")return Wg(e);if(t==="relu6")return pN(e);if(t==="prelu")return av(e,n);if(t==="leakyrelu")return Qb(e,r);if(t==="sigmoid")return Li(e);throw new Error(`Unknown fused activation ${t}.`)}var AN=(e,t)=>!(e>0)||t==="linear";function Mve({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:d,leakyreluAlpha:u}){if(c=c||"linear",AN(ae.state.gradientDepth,c)===!1){Y(a==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=Ja(e,t,n,r,a,s,o);return l!=null&&(C=Re(C,l)),EN(C,c,d,u)}let h=H(e,"x","conv2d","float32"),p=H(t,"filter","conv2d","float32"),m=h,f=!1;h.rank===3&&(f=!0,m=me(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Y(m.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${m.rank}.`),Y(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),rs("fused conv2d",r,o);let g=a==="NHWC"?m.shape[3]:m.shape[1];Y(p.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${p.shape[2]}.`),Y(ml(n,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`);let x=Kb(m.shape,p.shape,n,s,r,o),y;l!=null&&(y=H(l,"bias","fused conv2d"),[y]=Or(y,h),a==="NHWC"?mr(x.outShape,y.shape):(Y(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),Y(y.shape.length===0||y.shape[0]===x.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let b;if(d!=null){let C=d.shape;if(Y(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)Y(C[0]===1||C[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${x.outChannels}).`);else if(C.length===3)try{mr(C,x.outShape)}catch{let _=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(_)}b=H(d,"prelu weights","fused conv2d")}let v=(C,S)=>{Y(a==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`);let[_,I,T,A]=S,j=IN(C,T,c);Y(uu(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let D=tT(I.shape,j,_,n,r),F=OT(I,j,_.shape,n,r),B=[D,F];if(A!=null){let q=TN(A,j);B.push(q)}return B},w={x:m,filter:p,bias:y,preluActivationWeights:b},k={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:u};return l==null?cl((C,S,_)=>{let I=ae.runKernel(nh,w,k);return _([S,C,I]),f&&(I=me(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:v}})(m,p):cl((C,S,_,I)=>{let T=ae.runKernel(nh,w,k);return I([S,C,T,_]),f&&(T=me(T,[T.shape[1],T.shape[2],T.shape[3]])),{value:T,gradFunc:v}})(m,p,y)}var $ve=se({fusedConv2d_:Mve});function Fve(e,t,n,r,a,s=[1,1],o){let l=e;e.rank===3&&(l=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c=t;c.rank===3&&(c=me(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={x:l,dy:c},u={strides:r,pad:a,dimRoundingMode:o,dilations:s,filterShape:n};return ae.runKernel(z1,d,u)}var AU=se({depthwiseConv2dNativeBackpropFilter_:Fve});function Pve(e,t,n,r,a,s=[1,1],o){let l=t,c=!1;t.rank===3&&(c=!0,l=me(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let d={dy:l,filter:n},u={strides:r,pad:a,dimRoundingMode:o,dilations:s,inputShape:e},h=ae.runKernel(B1,d,u);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var RU=se({depthwiseConv2dNativeBackpropInput_:Pve});function Ove({x:e,filter:t,strides:n,pad:r,dataFormat:a="NHWC",dilations:s=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:d,leakyreluAlpha:u}){if(AN(ae.state.gradientDepth,c)===!1){let k=Vp(e,t,n,r,a,s,o);return l!=null&&(k=Re(k,l)),EN(k,c,d,u)}let h=H(e,"x","depthwiseConv2d","float32"),p=H(t,"filter","depthwiseConv2d","float32"),m=h,f=!1;h.rank===3&&(f=!0,m=me(h,[1,h.shape[0],h.shape[1],h.shape[2]])),Y(m.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${m.rank}.`),Y(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),Y(m.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${m.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),s==null&&(s=[1,1]),Y(ml(n,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${s}'`),rs("fused depthwiseConv2d",r,o);let g=Kb(m.shape,p.shape,n,s,r,o,!0),x;l!=null&&(x=H(l,"bias","fused conv2d"),[x]=Or(x,h),mr(g.outShape,x.shape));let y;d!=null&&(y=H(d,"prelu weights","fused depthwiseConv2d"));let b=(k,C)=>{Y(uu(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[S,_,I,T]=C,A=IN(k,I,c),j=RU(_.shape,A,S,n,r,s,o),D=AU(_,A,S.shape,n,r,s,o);if(T!=null){let F=TN(x,A);return[j,D,F]}return[j,D]},v={x:m,filter:p,bias:x,preluActivationWeights:y},w={strides:n,pad:r,dataFormat:a,dilations:s,dimRoundingMode:o,activation:c,leakyreluAlpha:u};return l==null?cl((k,C,S)=>{let _=ae.runKernel(rh,v,w);return S([C,k,_]),f&&(_=me(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:b}})(m,p):cl((k,C,S,_)=>{let I=ae.runKernel(rh,v,w);return _([C,k,I,S]),f&&(I=me(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:b}})(m,p,x)}var Lve=se({fusedDepthwiseConv2d_:Ove});function zve({a:e,b:t,transposeA:n=!1,transposeB:r=!1,bias:a,activation:s="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}){if(AN(ae.state.gradientDepth,s)===!1){let T=un(e,t,n,r);return a!=null&&(T=Re(T,a)),EN(T,s,o,l)}let c=H(e,"a","fused matMul"),d=H(t,"b","fused matMul");[c,d]=Or(c,d);let u=n?c.shape[c.rank-2]:c.shape[c.rank-1],h=r?d.shape[d.rank-1]:d.shape[d.rank-2],p=n?c.shape[c.rank-1]:c.shape[c.rank-2],m=r?d.shape[d.rank-2]:d.shape[d.rank-1],f=c.shape.slice(0,-2),g=d.shape.slice(0,-2),x=ir(f),y=ir(g);Y(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${c.shape} and ${d.shape} and transposeA=${n} and transposeB=${r} must match.`);let b=mr(c.shape.slice(0,-2),d.shape.slice(0,-2)).concat([p,m]),v=n?me(c,[x,u,p]):me(c,[x,p,u]),w=r?me(d,[y,m,h]):me(d,[y,h,m]),k;a!=null&&(k=H(a,"bias","fused matMul"),[k]=Or(k,c),mr(b,k.shape));let C;o!=null&&(C=H(o,"prelu weights","fused matMul"));let S=(T,A)=>{let[j,D,F,B]=A,q=IN(me(T,F.shape),F,s),$,L;if(!n&&!r?($=un(q,D,!1,!0),L=un(j,q,!0,!1)):!n&&r?($=un(q,D,!1,!1),L=un(q,j,!0,!1)):n&&!r?($=un(D,q,!1,!0),L=un(j,q,!1,!1)):($=un(D,q,!0,!0),L=un(q,j,!0,!0)),a!=null){let M=TN(B,q);return[$,L,M]}else return[$,L]},_={a:v,b:w,bias:k,preluActivationWeights:C},I={transposeA:n,transposeB:r,activation:s,leakyreluAlpha:l};return a==null?cl((T,A,j)=>{let D=ae.runKernel(th,_,I);return j([T,A,D]),{value:me(D,b),gradFunc:S}})(v,w):cl((T,A,j,D)=>{let F=ae.runKernel(th,_,I);return D([T,A,F,j]),{value:me(F,b),gradFunc:S}})(v,w,k)}var Bve=se({fusedMatMul_:zve});function Wve(e){return jN(e,.54,.46)}var Uve=se({hammingWindow_:Wve});function Vve(e){return jN(e,.5,.5)}var DU=se({hannWindow_:Vve});function Hve(e,t,n,r=!1,a=0){let s=0,o=[];for(;s+t<=e.size;)o.push(En(e,s,t)),s+=n;if(r)for(;s<e.size;){let l=s+t-e.size,c=pr([En(e,s,t-l),Gs([l],a)]);o.push(c),s+=n}return o.length===0?el([],[0,t]):me(pr(o),[o.length,t])}var MU=se({frame_:Hve});function Gve(e,t,n,r,a=DU){r==null&&(r=PT(t));let s=MU(e,t,n),o=oe(s,a(t));return ov(o,r)}var qve=se({stft_:Gve});function Kve(e,t,n,r,a="bilinear",s=0){let o=H(e,"image","cropAndResize"),l=H(t,"boxes","cropAndResize","float32"),c=H(n,"boxInd","cropAndResize","int32"),d=l.shape[0];Y(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),Y(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${d},4] but had shape ${l.shape}.`),Y(c.rank===1&&c.shape[0]===d,()=>`Error in cropAndResize: boxInd must be have size [${d}] but had shape ${l.shape}.`),Y(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),Y(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),Y(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let u={image:o,boxes:l,boxInd:c},h={method:a,extrapolationValue:s,cropSize:r};return ae.runKernel(Qf,u,h)}var Yve=se({cropAndResize_:Kve});function Xve(e){let t=H(e,"image","flipLeftRight","float32");Y(t.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${t.rank}.`);let n={image:t};return ae.runKernel(rg,n,{})}var Zve=se({flipLeftRight_:Xve});function Qve(e){let t=H(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];Y(t.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${t.rank}.`),Y(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Us(t,a)}var Jve=se({grayscaleToRGB_:Qve});function ewe(e){let t=H(e,"image","RGBToGrayscale"),n=t.rank-1,r=t.shape[n];Y(t.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${t.rank}.`),Y(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);let a=t.dtype,s=He(t,"float32"),o=er([.2989,.587,.114]),l;switch(t.rank){case 2:l=cd("ij,j->i",s,o);break;case 3:l=cd("ijk,k->ij",s,o);break;case 4:l=cd("ijkl,l->ijk",s,o);break;case 5:l=cd("ijklm,m->ijkl",s,o);break;case 6:l=cd("ijklmn,n->ijklm",s,o);break;default:throw new Error("Not a valid tensor rank.")}return l=_a(l,-1),He(l,a)}var twe=se({rgbToGrayscale_:ewe});function nwe(e,t,n=0,r=.5){let a=H(e,"image","rotateWithOffset","float32");Y(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let s={image:a},o={radians:t,fillValue:n,center:r};return ae.runKernel(zg,s,o)}var rwe=se({rotateWithOffset_:nwe});function Kg(e,t,n,r,a,s){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),s==null&&(s=0);let o=e.shape[0];return n=Math.min(n,o),Y(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),Y(e.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${e.rank}'`),Y(e.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${e.shape[1]}`),Y(t.rank===1,()=>"scores must be a 1D tensor"),Y(t.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${t.shape[0]}`),Y(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s}}function awe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=H(e,"boxes","nonMaxSuppression","float32"),o=H(t,"scores","nonMaxSuppression","float32"),l=Kg(s,o,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;let c={maxOutputSize:n,iouThreshold:r,scoreThreshold:a};return ae.runKernel(yg,{boxes:s,scores:o},c)}var swe=se({nonMaxSuppression_:awe});function iwe(e,t,n){let r=owe(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function owe(e,t,n){return cwe(e,t,n||lwe)}function lwe(e,t){return e>t?1:e<t?-1:0}function cwe(e,t,n){let r=0,a=e.length,s=0,o=!1;for(;r<a;){s=r+(a-r>>>1);let l=n(t,e[s]);l>0?r=s+1:(a=s,o=!l)}return o?r:-r-1}function $U(e,t,n,r,a){return LT(e,t,n,r,a,0)}function FU(e,t,n,r,a,s){return LT(e,t,n,r,a,0,!1,s,!0)}function PU(e,t,n,r,a,s){return LT(e,t,n,r,a,s,!0)}function LT(e,t,n,r,a,s,o=!1,l=!1,c=!1){let d=[];for(let x=0;x<t.length;x++)t[x]>a&&d.push({score:t[x],boxIndex:x,suppressBeginIndex:0});d.sort(L3);let u=s>0?-.5/s:0,h=[],p=[];for(;h.length<n&&d.length>0;){let x=d.pop(),{score:y,boxIndex:b,suppressBeginIndex:v}=x;if(y<a)break;let w=!1;for(let k=h.length-1;k>=v;--k){let C=uwe(e,b,h[k]);if(C>=r){w=!0;break}if(x.score=x.score*dwe(r,u,C),x.score<=a)break}x.suppressBeginIndex=h.length,w||(x.score===y?(h.push(b),p.push(x.score)):x.score>a&&iwe(d,x,L3))}let m=h.length,f=n-m;l&&f>0&&(h.push(...new Array(f).fill(0)),p.push(...new Array(f).fill(0)));let g={selectedIndices:h};return o&&(g.selectedScores=p),c&&(g.validOutputs=m),g}function uwe(e,t,n){let r=e.subarray(t*4,t*4+4),a=e.subarray(n*4,n*4+4),s=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),l=Math.max(r[0],r[2]),c=Math.max(r[1],r[3]),d=Math.min(a[0],a[2]),u=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),p=Math.max(a[1],a[3]),m=(l-s)*(c-o),f=(h-d)*(p-u);if(m<=0||f<=0)return 0;let g=Math.max(s,d),x=Math.max(o,u),y=Math.min(l,h),b=Math.min(c,p),v=Math.max(y-g,0)*Math.max(b-x,0);return v/(m+f-v)}function dwe(e,t,n){let r=Math.exp(t*n*n);return n<=e?r:0}function L3(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}async function hwe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY){let s=H(e,"boxes","nonMaxSuppressionAsync"),o=H(t,"scores","nonMaxSuppressionAsync"),l=Kg(s,o,n,r,a);n=l.maxOutputSize,r=l.iouThreshold,a=l.scoreThreshold;let c=await Promise.all([s.data(),o.data()]),d=c[0],u=c[1],{selectedIndices:h}=$U(d,u,n,r,a);return s!==e&&s.dispose(),o!==t&&o.dispose(),er(h,"int32")}var pwe=hwe;function mwe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let o=H(e,"boxes","nonMaxSuppression"),l=H(t,"scores","nonMaxSuppression"),c=Kg(o,l,n,r,a,s);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,s=c.softNmsSigma;let d={boxes:o,scores:l},u={maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:s},h=ae.runKernel(vg,d,u);return{selectedIndices:h[0],selectedScores:h[1]}}var fwe=se({nonMaxSuppressionWithScore_:mwe});async function gwe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=0){let o=H(e,"boxes","nonMaxSuppressionAsync"),l=H(t,"scores","nonMaxSuppressionAsync"),c=Kg(o,l,n,r,a,s);n=c.maxOutputSize,r=c.iouThreshold,a=c.scoreThreshold,s=c.softNmsSigma;let d=await Promise.all([o.data(),l.data()]),u=d[0],h=d[1],{selectedIndices:p,selectedScores:m}=PU(u,h,n,r,a,s);return o!==e&&o.dispose(),l!==t&&l.dispose(),{selectedIndices:er(p,"int32"),selectedScores:er(m)}}var xwe=gwe;function ywe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let o=H(e,"boxes","nonMaxSuppression"),l=H(t,"scores","nonMaxSuppression"),c=Kg(o,l,n,r,a,null),d=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,p={boxes:o,scores:l},m={maxOutputSize:d,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:s},f=ae.runKernel(bg,p,m);return{selectedIndices:f[0],validOutputs:f[1]}}var bwe=se({nonMaxSuppressionPadded_:ywe});async function vwe(e,t,n,r=.5,a=Number.NEGATIVE_INFINITY,s=!1){let o=H(e,"boxes","nonMaxSuppressionAsync"),l=H(t,"scores","nonMaxSuppressionAsync"),c=Kg(o,l,n,r,a,null),d=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,[p,m]=await Promise.all([o.data(),l.data()]),{selectedIndices:f,validOutputs:g}=FU(p,m,d,u,h,s);return o!==e&&o.dispose(),l!==t&&l.dispose(),{selectedIndices:er(f,"int32"),validOutputs:Rt(g,"int32")}}var wwe=vwe;function Nwe(e,t,n=!1,r=!1){let a=H(e,"images","resizeBilinear");Y(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),Y(t.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${t}.`),Y(r===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=a,o=!1;a.rank===3&&(o=!0,s=me(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let l={images:s},c={alignCorners:n,halfPixelCenters:r,size:t},d=ae.runKernel(Cp,l,c);return o?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var OU=se({resizeBilinear_:Nwe});function kwe(e,t,n=!1,r=!1){let a=H(e,"images","resizeNearestNeighbor");Y(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),Y(t.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${t}.`),Y(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),Y(r===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=a,o=!1;a.rank===3&&(o=!0,s=me(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let l={images:s},c={alignCorners:n,halfPixelCenters:r,size:t},d=ae.runKernel(Sp,l,c);return o?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var LU=se({resizeNearestNeighbor_:kwe});function Swe(e,t="binary",n=!1,r=.5){let a=H(e,"image","threshold"),s=.2989,o=.587,l=.114,c=a.shape[0]*a.shape[1],d=oe(er([r]),255),u,h,p,m;if(Y(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),Y(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),Y(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),Y(t==="otsu"||t==="binary",()=>`Method must be binary or otsu, but was ${t}`),a.shape[2]===3){[u,h,p]=bs(a,[1,1,1],-1);let g=oe(u,s),x=oe(h,o),y=oe(p,l);m=Re(Re(g,x),y)}else m=e;if(t==="otsu"){let g=YI(He(mN(m),"int32"),Qa([]),256);d=Cwe(g,c)}let f=n?Au(m,d):as(m,d);return He(oe(f,255),"int32")}function Cwe(e,t){let n=er([-1]),r=er([0]),a=er([0]),s,o,l,c,d,u;for(let h=0;h<e.size-1;h++){s=En(e,0,h+1),o=En(e,h+1),d=pt(xt(s),t),u=pt(xt(o),t);let p=xt(oe(s,hh(0,s.size)));l=pt(p,xt(s));let m=Gs(o.shape,s.size),f=Re(hh(0,o.size),m),g=oe(o,f);c=pt(xt(g),xt(o));let x=ot(l,c),y=ot(l,c),b=oe(d,u);a=oe(oe(b,x),y);let v=as(a,r);r=Ia(v,a,r),n=Ia(v,er([h]),n)}return n}var _we=se({threshold_:Swe});function jwe(e,t,n="nearest",r="constant",a=0,s){let o=H(e,"image","transform","float32"),l=H(t,"transforms","transform","float32");Y(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),Y(l.rank===2&&(l.shape[0]===o.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),Y(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let c={image:o,transforms:l},d={interpolation:n,fillMode:r,fillValue:a,outputShape:s};return ae.runKernel(Pg,c,d)}var Iwe=se({transform_:jwe});function Twe(e,t,n){let r=H(e,"a","bandPart");Y(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let a=r.shape,[s,o]=r.shape.slice(-2),l,c;typeof t=="number"?(Y(t%1===0,()=>`bandPart(): numLower must be an integer, got ${t}.`),Y(t<=s,()=>`bandPart(): numLower (${t}) must not be greater than the number of rows (${s}).`),l=H(t<0?s:t,"numLower","bandPart")):(Y(t.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),l=Ia(ff(t,0),s,hu(t,s))),typeof n=="number"?(Y(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),Y(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),c=H(n<0?o:n,"numUpper","bandPart")):(Y(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=Ia(ff(n,0),o,hu(n,o)));let d=me(hh(0,s,1,"int32"),[-1,1]),u=hh(0,o,1,"int32"),h=ot(d,u),p=Wi(Au(h,l),nc(h,Cr(c))),m=Fr([s,o],r.dtype);return me(Jr(Ur(me(r,[-1,s,o])).map(f=>Ia(p,f,m))),a)}var Ewe=se({bandPart_:Twe});function Awe(e){let t;if(Array.isArray(e)){t=!1,Y(e!=null&&e.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=e[0].shape[0];for(let s=1;s<e.length;++s)Y(e[s].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${e[s].shape[0]} vs. ${a})`)}else t=!0,e=bs(e,e.shape[0],0).map(a=>Mu(a,[0]));Y(e.length<=e[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${e.length}) exceeds number of dimensions (${e[0].shape[0]}).`);let n=[],r=e;for(let a=0;a<e.length;++a)n.push(ae.tidy(()=>{let s=r[a];if(a>0)for(let o=0;o<a;++o){let l=oe(xt(oe(n[o],s)),n[o]);s=ot(s,l)}return pt(s,Ug(s,"euclidean"))}));return t?Jr(n,0):n}var Rwe=se({gramSchmidt_:Awe});function Dwe(e,t=!1){if(Y(e.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${e.rank}`),e.rank===2)return z3(e,t);{let n=e.shape.slice(0,e.shape.length-2).reduce((c,d)=>c*d),r=Ur(me(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],s=[];r.forEach(c=>{let[d,u]=z3(c,t);a.push(d),s.push(u)});let o=me(Jr(a,0),e.shape),l=me(Jr(s,0),e.shape);return[o,l]}}function z3(e,t=!1){return ae.tidy(()=>{Y(e.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${e.shape.length}D Tensor.`);let n=e.shape[0],r=e.shape[1],a=oN(n),s=Jo(e),o=el([[1]],[1,1]),l=Jo(o),c=n>=r?r:n;for(let d=0;d<c;++d){let u=s,h=l,p=a;[l,s,a]=ae.tidy(()=>{let m=En(s,[d,d],[n-d,1]),f=Ug(m),g=En(s,[d,d],[1,1]),x=Ia(as(g,0),el([[-1]]),el([[1]])),y=ot(g,oe(x,f)),b=pt(m,y);b.shape[0]===1?l=Jo(o):l=pr([o,En(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);let v=Cr(pt(un(x,y),f)),w=En(s,[d,0],[n-d,r]),k=oe(v,l),C=hn(l);if(d===0)s=ot(w,un(k,un(C,w)));else{let I=ot(w,un(k,un(C,w)));s=pr([En(s,[0,0],[d,r]),I],0)}let S=hn(k),_=En(a,[0,d],[n,a.shape[1]-d]);if(d===0)a=ot(_,un(un(_,l),S));else{let I=ot(_,un(un(_,l),S));a=pr([En(a,[0,0],[n,d]),I],1)}return[l,s,a]}),tn([u,h,p])}return!t&&n>r&&(a=En(a,[0,0],[n,r]),s=En(s,[0,0],[r,r])),[a,s]})}var Mwe=se({qr_:Dwe}),Ka;(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ka||(Ka={}));function $we(e,t,n=Ka.SUM_BY_NONZERO_WEIGHTS){let r=H(e,"losses","computeWeightedLoss"),a=null;t!=null&&(a=H(t,"weights","computeWeightedLoss"));let s=a==null?r:oe(r,a);if(n===Ka.NONE)return s;if(n===Ka.SUM)return xt(s);if(n===Ka.MEAN){if(a==null)return $r(s);{let o=r.size/a.size,l=pt(xt(s),xt(a));return o>1?pt(l,Rt(o)):l}}if(n===Ka.SUM_BY_NONZERO_WEIGHTS){if(a==null)return pt(xt(s),Rt(r.size));{let o=oe(a,ys(r.shape)),l=He(xt(dh(o,Rt(0))),"float32");return pt(xt(s),l)}}throw Error(`Unknown reduction: ${n}`)}var rc=se({computeWeightedLoss_:$we});function Fwe(e,t,n,r=Ka.SUM_BY_NONZERO_WEIGHTS){let a=H(e,"labels","absoluteDifference"),s=H(t,"predictions","absoluteDifference"),o=null;n!=null&&(o=H(n,"weights","absoluteDifference")),ns(a.shape,s.shape,"Error in absoluteDifference: ");let l=Xr(ot(a,s));return rc(l,o,r)}var Pwe=se({absoluteDifference_:Fwe});function Owe(e,t,n,r,a=Ka.SUM_BY_NONZERO_WEIGHTS){let s=H(e,"labels","cosineDistance"),o=H(t,"predictions","cosineDistance"),l=null;r!=null&&(l=H(r,"weights","cosineDistance")),ns(s.shape,o.shape,"Error in cosineDistance: ");let c=Rt(1),d=ot(c,xt(oe(s,o),n,!0));return rc(d,l,a)}var Lwe=se({cosineDistance_:Owe});function zwe(e,t,n,r=Ka.SUM_BY_NONZERO_WEIGHTS){let a=H(e,"labels","hingeLoss"),s=H(t,"predictions","hingeLoss"),o=null;n!=null&&(o=H(n,"weights","hingeLoss")),ns(a.shape,s.shape,"Error in hingeLoss: ");let l=Rt(1);a=ot(oe(Rt(2),a),l);let c=ar(ot(l,oe(a,s)));return rc(c,o,r)}var Bwe=se({hingeLoss_:zwe});function Wwe(e,t,n,r=1,a=Ka.SUM_BY_NONZERO_WEIGHTS){let s=H(e,"labels","huberLoss"),o=H(t,"predictions","huberLoss"),l=null;n!=null&&(l=H(n,"weights","huberLoss")),ns(s.shape,o.shape,"Error in huberLoss: ");let c=Rt(r),d=Xr(ot(o,s)),u=hu(d,c),h=ot(d,u),p=Re(oe(Rt(.5),hr(u)),oe(c,h));return rc(p,l,a)}var Uwe=se({huberLoss_:Wwe});function Vwe(e,t,n,r=1e-7,a=Ka.SUM_BY_NONZERO_WEIGHTS){let s=H(e,"labels","logLoss"),o=H(t,"predictions","logLoss"),l=null;n!=null&&(l=H(n,"weights","logLoss")),ns(s.shape,o.shape,"Error in logLoss: ");let c=Rt(1),d=Rt(r),u=Cr(oe(s,Ks(Re(o,d)))),h=oe(ot(c,s),Ks(Re(ot(c,o),d))),p=ot(u,h);return rc(p,l,a)}var Hwe=se({logLoss_:Vwe});function Gwe(e,t,n,r=Ka.SUM_BY_NONZERO_WEIGHTS){let a=H(e,"labels","meanSquaredError"),s=H(t,"predictions","meanSquaredError"),o=null;n!=null&&(o=H(n,"weights","meanSquaredError")),ns(a.shape,s.shape,"Error in meanSquaredError: ");let l=wN(a,s);return rc(l,o,r)}var qwe=se({meanSquaredError_:Gwe});function Kwe(e,t){let n=H(e,"labels","sigmoidCrossEntropyWithLogits"),r=H(t,"logits","sigmoidCrossEntropyWithLogits");ns(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=ar(r),s=oe(r,n),o=Jb(Ua(Cr(Xr(r))));return Re(ot(a,s),o)}function Ywe(e,t,n,r=0,a=Ka.SUM_BY_NONZERO_WEIGHTS){let s=H(e,"multiClassLabels","sigmoidCrossEntropy"),o=H(t,"logits","sigmoidCrossEntropy"),l=null;if(n!=null&&(l=H(n,"weights","sigmoidCrossEntropy")),ns(s.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){let d=Rt(r),u=Rt(1),h=Rt(.5);s=Re(oe(s,ot(u,d)),oe(h,d))}let c=Kwe(s,o);return rc(c,l,a)}var Xwe=se({sigmoidCrossEntropy_:Ywe});function Zwe(e,t,n=-1){if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${t.rank} and dim was ${n}`);return cl((r,a,s)=>{let o=ev(a,[n],!0),l=ot(He(a,"float32"),o);s([r,l]);let c=Cr(oe(l,r));return{value:xt(c,[n]),gradFunc:(d,u)=>{let[h,p]=u,m=uh(d.shape,[n]);return[oe(me(d,m),ot(He(h,"float32"),Ua(p))),oe(me(d,m),ot(Ua(p),He(h,"float32")))]}}})(e,t)}function Qwe(e,t,n,r=0,a=Ka.SUM_BY_NONZERO_WEIGHTS){let s=H(e,"onehotLabels","softmaxCrossEntropy"),o=H(t,"logits","softmaxCrossEntropy"),l=null;if(n!=null&&(l=H(n,"weights","softmaxCrossEntropy")),ns(s.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){let d=Rt(r),u=Rt(1),h=Rt(s.shape[1]);s=Re(oe(s,ot(u,d)),pt(d,h))}let c=Zwe(s,o);return rc(c,l,a)}var Jwe=se({softmaxCrossEntropy_:Qwe});function e0e(e,t,n,r){let a=H(e,"indices","sparseFillEmptyRows","int32"),s=H(t,"values","sparseFillEmptyRows"),o=H(n,"denseShape","sparseFillEmptyRows","int32"),l=H(r,"defaultValue","sparseFillEmptyRows",s.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(s.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${s.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(l.rank!==0)throw new Error(`Default value should be a scalar but received shape ${l.shape}`);let c={indices:a,values:s,denseShape:o,defaultValue:l},d=ae.runKernel(Db,c);return{outputIndices:d[0],outputValues:d[1],emptyRowIndicator:d[2],reverseIndexMap:d[3]}}var t0e=se({sparseFillEmptyRows_:e0e});function n0e(e,t,n){let r=H(e,"inputIndices","sparseReshape","int32"),a=H(t,"inputShape","sparseReshape","int32"),s=H(n,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${r.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(s.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${s.shape}`);let o={inputIndices:r,inputShape:a,newShape:s},l=ae.runKernel(Dg,o);return{outputIndices:l[0],outputShape:l[1]}}var r0e=se({sparseReshape_:n0e});function a0e(e,t,n){let r=H(e,"data","sparseSegmentMean"),a=H(t,"indices","sparseSegmentMean","int32"),s=H(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${s.shape}`);let o={data:r,indices:a,segmentIds:s};return ae.runKernel(Mb,o)}var s0e=se({sparseSegmentMean_:a0e});function i0e(e,t,n){let r=H(e,"data","sparseSegmentSum"),a=H(t,"indices","sparseSegmentSum","int32"),s=H(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(s.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${s.shape}`);let o={data:r,indices:a,segmentIds:s};return ae.runKernel($b,o)}var o0e=se({sparseSegmentSum_:i0e});function l0e(e,t,n,r,a,s,o,l){let c=H(e,"data","stringNGrams","string");if(c.dtype!=="string")throw new Error("Data must be of datatype string");if(c.shape.length!==1)throw new Error(`Data must be a vector, saw: ${c.shape}`);let d=H(t,"dataSplits","stringNGrams");if(d.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let u={separator:n,nGramWidths:r,leftPad:a,rightPad:s,padWidth:o,preserveShortSequences:l},h={data:c,dataSplits:d},p=ae.runKernel(Ob,h,u);return{nGrams:p[0],nGramsSplits:p[1]}}var c0e=se({stringNGrams_:l0e});function u0e(e,t,n=!0){let r=H(e,"input","stringSplit","string"),a=H(t,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${r.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let s={skipEmpty:n},o={input:r,delimiter:a},l=ae.runKernel(Lb,o,s);return{indices:l[0],values:l[1],shape:l[2]}}var d0e=se({stringSplit_:u0e});function h0e(e,t){let n=H(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");let a={input:n};return ae.runKernel(zb,a,r)}var p0e=se({stringToHashBucketFast_:h0e});function m0e(e,t,n,r=!0){let a=H(e,"input","staticRegexReplace","string"),s={pattern:t,rewrite:n,replaceGlobal:r};return ae.runKernel(Pb,{x:a},s)}var f0e=se({staticRegexReplace_:m0e}),zU={fft:iv,ifft:bf,rfft:ov,irfft:vN},BU={hammingWindow:Uve,hannWindow:DU,frame:MU,stft:qve},ii={flipLeftRight:Zve,grayscaleToRGB:Jve,resizeNearestNeighbor:LU,resizeBilinear:OU,rgbToGrayscale:twe,rotateWithOffset:rwe,cropAndResize:Yve,nonMaxSuppression:swe,nonMaxSuppressionAsync:pwe,nonMaxSuppressionWithScore:fwe,nonMaxSuppressionWithScoreAsync:xwe,nonMaxSuppressionPadded:bwe,nonMaxSuppressionPaddedAsync:wwe,threshold:_we,transform:Iwe},zT={bandPart:Ewe,gramSchmidt:Rwe,qr:Mwe},WU={absoluteDifference:Pwe,computeWeightedLoss:rc,cosineDistance:Lwe,hingeLoss:Bwe,huberLoss:Uwe,logLoss:Hwe,meanSquaredError:qwe,sigmoidCrossEntropy:Xwe,softmaxCrossEntropy:Jwe},UU={sparseFillEmptyRows:t0e,sparseReshape:r0e,sparseSegmentMean:s0e,sparseSegmentSum:o0e},VU={stringNGrams:c0e,stringSplit:d0e,stringToHashBucketFast:p0e,staticRegexReplace:f0e},Oe={};nn(Oe,{Serializable:()=>HU,SerializationMap:()=>GU,getRegisteredName:()=>x0e,registerClass:()=>qU});var g0e=new Map,UC=new Map,HU=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},GU=class xm{constructor(){this.classNameMap={}}static getMap(){return xm.instance==null&&(xm.instance=new xm),xm.instance}static register(t){xm.getMap().classNameMap[t.className]=[t,t.fromConfig]}};function qU(e,t,n){Y(e.className!=null,()=>"Class being registered does not have the static className property defined."),Y(typeof e.className=="string",()=>"className is required to be a string, but got type "+typeof e.className),Y(e.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof t>"u"&&(t="Custom"),typeof n>"u"&&(n=e.className);let r=n,a=t+">"+r;return GU.register(e),g0e.set(a,e),UC.set(e,a),e}function x0e(e){return UC.has(e)?UC.get(e):e.className}var ac=class extends HU{minimize(e,t=!1,n){let{value:r,grads:a}=this.computeGradients(e,n);if(n!=null){let s=n.map(o=>({name:o.name,tensor:a[o.name]}));this.applyGradients(s)}else this.applyGradients(a);return tn(a),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return qW(e,t)}dispose(){this.iterations_!=null&&tn(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Rt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(ac,Symbol.hasInstance,{value:e=>e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null});var BT=class extends ac{static get className(){return"Adadelta"}constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=ae.registeredVariables[t],a=!1;this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accum_grad`,variable:fe(()=>Pn(r).variable(a))}),this.accumulatedUpdates[n]==null&&(this.accumulatedUpdates[n]={originalName:`${t}/accum_var`,variable:fe(()=>Pn(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let o=this.accumulatedGrads[n].variable,l=this.accumulatedUpdates[n].variable;fe(()=>{let c=Re(oe(o,this.rho),oe(hr(s),1-this.rho)),d=oe(pt(Ta(Re(l,this.epsilon)),Ta(Re(o,this.epsilon))),s),u=Re(oe(l,this.rho),oe(hr(d),1-this.rho));o.assign(c),l.assign(u);let h=Re(oe(d,-this.learningRate),r);r.assign(h)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(tn(this.accumulatedGrads.map(e=>e.variable)),tn(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}},WT=class extends ac{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=ae.registeredVariables[t];this.accumulatedGrads[n]==null&&(this.accumulatedGrads[n]={originalName:`${t}/accumulator`,variable:fe(()=>Gs(r.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[n].tensor:e[t];if(a==null)return;let s=this.accumulatedGrads[n].variable;fe(()=>{let o=Re(s,hr(a));s.assign(o);let l=Re(oe(pt(a,Ta(Re(o,ae.backend.epsilon()))),-this.learningRate),r);r.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&tn(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}},UT=class extends ac{static get className(){return"Adam"}constructor(e,t,n,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],fe(()=>{this.accBeta1=Rt(t).variable(),this.accBeta2=Rt(n).variable()}),r==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);fe(()=>{let n=ot(1,this.accBeta1),r=ot(1,this.accBeta2);t.forEach((a,s)=>{let o=ae.registeredVariables[a],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:fe(()=>Pn(o).variable(l))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${a}/v`,variable:fe(()=>Pn(o).variable(l))});let c=Array.isArray(e)?e[s].tensor:e[a];if(c==null)return;let d=this.accumulatedFirstMoment[s].variable,u=this.accumulatedSecondMoment[s].variable,h=Re(oe(d,this.beta1),oe(c,1-this.beta1)),p=Re(oe(u,this.beta2),oe(hr(c),1-this.beta2)),m=pt(h,n),f=pt(p,r);d.assign(h),u.assign(p);let g=Re(oe(pt(m,Re(Ta(f),this.epsilon)),-this.learningRate),o);o.assign(g)}),this.accBeta1.assign(oe(this.accBeta1,this.beta1)),this.accBeta2.assign(oe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&tn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&tn(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),fe(()=>{this.accBeta1.assign(ll(this.beta1,this.iterations_+1)),this.accBeta2.assign(ll(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}},VT=class extends ac{static get className(){return"Adamax"}constructor(e,t,n,r=null,a=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=r,this.decay=a,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],fe(()=>{this.iteration=Rt(0).variable(),this.accBeta1=Rt(t).variable()}),r==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);fe(()=>{let n=ot(1,this.accBeta1),r=pt(-this.learningRate,Re(oe(this.iteration,this.decay),1));t.forEach((a,s)=>{let o=ae.registeredVariables[a],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${a}/m`,variable:Pn(o).variable(l)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${a}/v`,variable:Pn(o).variable(l)});let c=Array.isArray(e)?e[s].tensor:e[a];if(c==null)return;let d=this.accumulatedFirstMoment[s].variable,u=this.accumulatedWeightedInfNorm[s].variable,h=Re(oe(d,this.beta1),oe(c,1-this.beta1)),p=oe(u,this.beta2),m=Xr(c),f=fl(p,m);d.assign(h),u.assign(f);let g=Re(oe(pt(r,n),pt(h,Re(f,this.epsilon))),o);o.assign(g)}),this.iteration.assign(Re(this.iteration,1)),this.accBeta1.assign(oe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&tn(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&tn(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}},RN=class extends ac{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=Array.isArray(e)?e[n].tensor:e[t];if(r==null)return;let a=ae.registeredVariables[t];fe(()=>{let s=Re(oe(this.c,r),a);a.assign(s)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=la(Rt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}},HT=class extends RN{static get className(){return"Momentum"}constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=Rt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=ae.registeredVariables[t];this.accumulations[n]==null&&(this.accumulations[n]={originalName:`${t}/momentum`,variable:fe(()=>Pn(r).variable(!1))});let a=this.accumulations[n].variable,s=Array.isArray(e)?e[n].tensor:e[t];s!=null&&fe(()=>{let o,l=Re(oe(this.m,a),s);this.useNesterov?o=Re(oe(this.c,Re(s,oe(l,this.m))),r):o=Re(oe(this.c,l),r),a.assign(l),r.assign(o)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&tn(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}},GT=class extends ac{static get className(){return"RMSProp"}constructor(e,t=.9,n=0,r=null,a=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=a,r==null&&(this.epsilon=ae.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(t=>t.name):Object.keys(e)).forEach((t,n)=>{let r=ae.registeredVariables[t],a=!1;this.accumulatedMeanSquares[n]==null&&(this.accumulatedMeanSquares[n]={originalName:`${t}/rms`,variable:fe(()=>Pn(r).variable(a))}),this.accumulatedMoments[n]==null&&(this.accumulatedMoments[n]={originalName:`${t}/momentum`,variable:fe(()=>Pn(r).variable(a))}),this.accumulatedMeanGrads[n]==null&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${t}/mg`,variable:fe(()=>Pn(r).variable(a))});let s=Array.isArray(e)?e[n].tensor:e[t];if(s==null)return;let o=this.accumulatedMeanSquares[n].variable,l=this.accumulatedMoments[n].variable;fe(()=>{let c=Re(oe(o,this.decay),oe(hr(s),1-this.decay));if(this.centered){let d=this.accumulatedMeanGrads[n].variable,u=Re(oe(d,this.decay),oe(s,1-this.decay)),h=pt(oe(s,this.learningRate),Ta(ot(c,Re(hr(u),this.epsilon)))),p=Re(oe(l,this.momentum),h);o.assign(c),d.assign(u),l.assign(p);let m=ot(r,p);r.assign(m)}else{let d=Re(oe(o,this.decay),oe(hr(s),1-this.decay)),u=Re(oe(l,this.momentum),pt(oe(s,this.learningRate),Ta(Re(d,this.epsilon))));o.assign(d),l.assign(u);let h=ot(r,u);r.assign(h)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&tn(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&tn(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&tn(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}},y0e=[BT,WT,UT,VT,HT,GT,RN];function b0e(){for(let e of y0e)qU(e)}var Fa={};nn(Fa,{CompositeArrayBuffer:()=>ec,browserFiles:()=>_0e,browserHTTPRequest:()=>R0e,concatenateArrayBuffers:()=>ige,copyModel:()=>Ige,decodeWeights:()=>bW,decodeWeightsStream:()=>wW,encodeWeights:()=>ege,fromMemory:()=>M0e,fromMemorySync:()=>QU,getLoadHandlers:()=>mge,getModelArtifactsForJSON:()=>MI,getModelArtifactsForJSONSync:()=>kW,getModelArtifactsInfoForJSON:()=>qb,getSaveHandlers:()=>pge,getWeightSpecs:()=>PC,http:()=>KT,isHTTPScheme:()=>HC,listModels:()=>_ge,loadWeights:()=>I0e,moveModel:()=>Tge,registerLoadRouter:()=>hge,registerSaveRouter:()=>dge,removeModel:()=>jge,weightsLoaderFactory:()=>YU,withSaveHandler:()=>$0e,withSaveHandlerSync:()=>F0e});var v0e="model",w0e=".json",N0e=".weights.bin";function B3(e){return new Promise(t=>setTimeout(t)).then(e)}var z0=class VC{constructor(t){if(!_e().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(VC.URL_SCHEME)&&(t=t.slice(VC.URL_SCHEME.length)),(t==null||t.length===0)&&(t=v0e),this.modelJsonFileName=t+w0e,this.weightDataFileName=t+N0e}async save(t){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let n=ec.join(t.weightData),r=window.URL.createObjectURL(new Blob([n],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s=NW(t,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=o,await B3(()=>l.dispatchEvent(new MouseEvent("click"))),t.weightData!=null){let c=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;c.download=this.weightDataFileName,c.href=r,await B3(()=>c.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:qb(t)}}}};z0.URL_SCHEME="downloads://";var k0e=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,t)=>{let n=new FileReader;n.onload=r=>{let a=JSON.parse(r.target.result),s=a.modelTopology;if(s==null){t(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(a.weightsManifest==null){t(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:s});return}let o=MI(a,l=>this.loadWeights(l));e(o)},n.onerror=r=>t(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})}loadWeights(e){let t=[],n=[];for(let s of e)t.push(...s.weights),n.push(...s.paths);let r=this.checkManifestAndWeightFiles(e),a=n.map(s=>this.loadWeightsFile(s,r[s]));return Promise.all(a).then(s=>[t,s])}loadWeightsFile(e,t){return new Promise((n,r)=>{let a=new FileReader;a.onload=s=>{let o=s.target.result;n(o)},a.onerror=s=>r(`Failed to weights data from file of path '${e}'.`),a.readAsArrayBuffer(t)})}checkManifestAndWeightFiles(e){let t=[],n=this.weightsFiles.map(a=>O3(a.name)),r={};for(let a of e)a.paths.forEach(s=>{let o=O3(s);if(t.indexOf(o)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${o}'`);if(t.push(o),n.indexOf(o)===-1)throw new Error(`Weight file with basename '${o}' is not provided.`);r[s]=this.weightsFiles[n.indexOf(o)]});if(t.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${t.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return r}},S0e=e=>_e().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(z0.URL_SCHEME)?C0e(e.slice(z0.URL_SCHEME.length)):null;fi.registerSaveRouter(S0e);function C0e(e="model"){return new z0(e)}function _0e(e){return new k0e(e)}function W3(e,t,n,r){o(e),n=n??0,r=r??1,l(n,r);let a=0,s=c=>(c.then(d=>{let u=n+ ++a/e.length*(r-n);return t(u),d}),c);function o(c){Y(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function l(c,d){Y(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),Y(d>=0&&d<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${d}`),Y(d>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${d}`)}return Promise.all(e.map(s))}async function KU(e,t){t==null&&(t={});let n=t.fetchFunc==null?_e().platform.fetch:t.fetchFunc,r=e.map(s=>n(s,t.requestInit,{isBinary:!0})),a=(t.onProgress==null?await Promise.all(r):await W3(r,t.onProgress,0,.5)).map(s=>s.arrayBuffer());return t.onProgress==null?await Promise.all(a):await W3(a,t.onProgress,.5,1)}function j0e(e,t){var n;let r=t.fetchFunc==null?_e().platform.fetch:t.fetchFunc,a=0,s;return(n=t.onProgress)===null||n===void 0||n.call(t,0),new ReadableStream({pull:async o=>{for(var l;a<e.length;){s||(s=(await r(e[a],t.requestInit,{isBinary:!0})).body.getReader());let{done:c,value:d}=await s.read();if(c){a++,s=void 0,(l=t.onProgress)===null||l===void 0||l.call(t,a/e.length);continue}o.enqueue(d);return}o.close()}})}async function I0e(e,t="",n,r){return YU(a=>KU(a,{requestInit:r}))(e,t,n)}function YU(e){return async(t,n="",r)=>{let a=t.map(()=>!1),s={},o=r!=null?r.map(()=>!1):[],l=[];if(t.forEach((m,f)=>{let g=0;m.weights.forEach(x=>{let y="quantization"in x?x.quantization.dtype:x.dtype,b=sh[y]*ir(x.shape),v=()=>{a[f]=!0,s[f]==null&&(s[f]=[]),s[f].push({manifestEntry:x,groupOffset:g,sizeBytes:b})};r!=null?r.forEach((w,k)=>{w===x.name&&(v(),o[k]=!0)}):v(),l.push(x.name),g+=b})}),!o.every(m=>m)){let m=r.filter((f,g)=>!o[g]);throw new Error(`Could not find weights in manifest with names: ${m.join(", ")}. 
Manifest JSON has weights with names: ${l.join(", ")}.`)}let c=a.reduce((m,f,g)=>(f&&m.push(g),m),[]),d=[];c.forEach(m=>{t[m].paths.forEach(f=>{let g=n+(n.endsWith("/")?"":"/")+f;d.push(g)})});let u=await e(d),h={},p=0;return c.forEach(m=>{let f=t[m].paths.length,g=new ec(u.slice(p,p+f));s[m].forEach(x=>{let y=g.slice(x.groupOffset,x.groupOffset+x.sizeBytes),b=bW(y,[x.manifestEntry]);for(let v in b)h[v]=b[v]}),p+=f}),h}}var T0e="application/octet-stream",E0e="application/json",qT=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Y(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=_e().platform.fetch,Y(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&Y(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=NW(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:E0e}),"model.json"),e.weightData!=null){let s=ec.join(e.weightData);t.body.append("model.weights.bin",new Blob([s],{type:T0e}),"model.weights.bin")}let a=await this.fetch(this.path,t);if(a.ok)return{modelArtifactsInfo:qb(e),responses:[a]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${a.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let s=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?s+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":s+=" Please make sure the server is serving valid JSON for this request.",new Error(s)}let n=t.modelTopology,r=t.weightsManifest;if(n==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return MI(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=PC(e.weightsManifest),r=()=>j0e(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:r})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=A0e(t),a=this.weightPathPrefix||n,s=[],o=[];for(let l of e)for(let c of l.paths)this.weightUrlConverter!=null?o.push(this.weightUrlConverter(c)):s.push(a+c+r);return this.weightUrlConverter&&s.push(...await Promise.all(o)),s}async loadWeights(e){let t=await this.getWeightUrls(e),n=PC(e),r=await KU(t,this.loadOptions);return[n,r]}};qT.URL_SCHEME_REGEX=/^https?:\/\//;function A0e(e){let t=e.lastIndexOf("/"),n=e.lastIndexOf("?"),r=e.substring(0,t),a=n>t?e.substring(n):"";return[r+"/",a]}function HC(e){return e.match(qT.URL_SCHEME_REGEX)!=null}var XU=(e,t)=>{if(typeof fetch>"u"&&(t==null||t.fetchFunc==null))return null;{let n=!0;if(Array.isArray(e)?n=e.every(r=>HC(r)):n=HC(e),n)return KT(e,t)}return null};fi.registerSaveRouter(XU);fi.registerLoadRouter(XU);function KT(e,t){return new qT(e,t)}function R0e(e,t){return KT(e,t)}var US=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},ZU=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},D0e=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=t=>Promise.resolve(e.save(t)))}};function M0e(e,t,n,r){let a=arguments;return new D0e(QU(...a))}function QU(e,t,n,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new US(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new US({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new US({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function $0e(e){return new ZU(e)}function F0e(e){return new ZU(e)}var JU={};nn(JU,{confusionMatrix:()=>O0e});function P0e(e,t,n){let r=H(e,"labels","confusionMatrix"),a=H(t,"predictions","confusionMatrix");Y(n==null||n>0&&Number.isInteger(n),()=>`If provided, numClasses must be a positive integer, but got ${n}`),Y(r.rank===1,()=>`Expected the rank of labels to be 1, but got ${r.rank}`),Y(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),Y(r.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${r.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),Y(n>0&&Number.isInteger(n),()=>`numClasses is required to be a positive integer, but got ${n}`);let s=gf(He(r,"int32"),n),o=gf(He(a,"int32"),n),l=hn(s),c=un(l,o);return He(c,"int32")}var O0e=se({confusionMatrix_:P0e}),lv={};nn(lv,{draw:()=>G0e,fromPixels:()=>q0e,fromPixelsAsync:()=>U0e,toPixels:()=>H0e});var ed,U3=!1;function eV(e,t=3){if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,r=!1,a=!1,s=!1,o=!1,l=!1;if(e.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)s=!0;else if(e.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap)l=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${e.constructor.name}`);if(Oy(F0,ae.backendName)!=null){let p={pixels:e},m={numChannels:t};return ae.runKernel(F0,p,m)}let[c,d]=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],u;if(o)u=e.getContext("2d").getImageData(0,0,c,d).data;else if(r||n)u=e.data;else if(s||a||l){if(ed==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ed=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ed=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ed.canvas.width=c,ed.canvas.height=d,ed.drawImage(e,0,0,c,d),u=ed.getImageData(0,0,c,d).data}let h;if(t===4)h=new Int32Array(u);else{let p=c*d;h=new Int32Array(p*t);for(let m=0;m<p;m++)for(let f=0;f<t;++f)h[m*t+f]=u[m*4+f]}return NN(h,[d,c,t],"int32")}function L0e(e){return e!=null&&e.data instanceof Uint8Array}function z0e(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function B0e(e){return e!=null&&e.width!==0&&e.height!==0}function W0e(e){return z0e()&&!(e instanceof ImageBitmap)&&B0e(e)&&!L0e(e)}async function U0e(e,t=3){let n=null;if(_e().getBool("WRAP_TO_IMAGEBITMAP")&&W0e(e)){let r;try{r=await createImageBitmap(e,{premultiplyAlpha:"none"})}catch{r=null}r!=null&&r.width===e.width&&r.height===e.height?n=r:n=e}else n=e;return eV(n,t)}function tV(e){if(e.rank!==2&&e.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${e.rank}.`);let t=e.rank===2?1:e.shape[2];if(t>4||t===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${t}`);if(e.dtype!=="float32"&&e.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${e.dtype}. Please use float32 or int32 tensors.`)}function V0e(e){let t=(e==null?void 0:e.alpha)||1;if(t>1||t<0)throw new Error(`Alpha value ${t} is suppoed to be in range [0 - 1].`)}async function H0e(e,t){let n=H(e,"img","toPixels");if(!(e instanceof on)){let d=n;n=He(d,"int32"),d.dispose()}tV(n);let[r,a]=n.shape.slice(0,2),s=n.rank===2?1:n.shape[2],o=await n.data(),l=n.dtype==="float32"?255:1,c=new Uint8ClampedArray(a*r*4);for(let d=0;d<r*a;++d){let u=[0,0,0,255];for(let p=0;p<s;p++){let m=o[d*s+p];if(n.dtype==="float32"){if(m<0||m>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${m}.`)}else if(n.dtype==="int32"&&(m<0||m>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${m}.`);s===1?(u[0]=m*l,u[1]=m*l,u[2]=m*l):u[p]=m*l}let h=d*4;c[h+0]=Math.round(u[0]),c[h+1]=Math.round(u[1]),c[h+2]=Math.round(u[2]),c[h+3]=Math.round(u[3])}if(t!=null){U3||Oy(W1,ae.backendName)!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),U3=!0),t.width=a,t.height=r;let d=t.getContext("2d"),u=new ImageData(c,a,r);d.putImageData(u,0,0)}return n!==e&&n.dispose(),c}function G0e(e,t,n){let r=H(e,"img","draw");if(!(e instanceof on)){let o=r;r=He(o,"int32"),o.dispose()}tV(r),V0e(n==null?void 0:n.imageOptions);let a={image:r},s={canvas:t,options:n};ae.runKernel(W1,a,s)}var q0e=se({fromPixels_:eV}),YT={};nn(YT,{prepareAndValidate:()=>nV});function nV(e,t){let n=e.shape.length,r=t.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(t.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.shape[r-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${t.shape[r-1]} vs. ${n}`);if(ir(e.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${e.shape}.`);let a=t.shape,s=a[a.length-1],o=1;for(let h=0;h<a.length-1;++h)o*=a[h];let l=e.shape,c=a.slice();c.pop();let d=1;for(let h=s;h<n;++h)d*=l[h],c.push(l[h]);let u=[...Of(e.shape).map(h=>h/d),1].slice(0,s);return[c,o,d,u]}var da={};nn(da,{assertParamsValid:()=>Y0e,computeFlatOffset:()=>e1e,computeOutShape:()=>Z0e,getNormalizedAxes:()=>Q0e,isSliceContinous:()=>J0e,maskToAxes:()=>X0e,parseSliceParams:()=>dV,sliceInfo:()=>t1e,startForAxis:()=>cV,startIndicesWithElidedDims:()=>iV,stopForAxis:()=>uV,stopIndicesWithElidedDims:()=>oV,stridesForAxis:()=>lV,stridesWithElidedDims:()=>rV});var GC=-2,K0e=-1;function Y0e(e,t,n){let r=e.shape.length;Y(r===t.length,()=>`Error in slice${r}D: Length of begin ${t} must match the rank of the array (${r}).`),Y(r===n.length,()=>`Error in slice${r}D: Length of size ${n} must match the rank of the array (${r}).`);for(let a=0;a<r;++a)Y(t[a]+n[a]<=e.shape[a],()=>`Error in slice${r}D: begin[${a}] + size[${a}] (${t[a]+n[a]}) would overflow input.shape[${a}] (${e.shape[a]})`)}function X0e(e){let t=[],n=0;for(;e>0;)e&1&&t.push(n),e/=2,n++;return t}function Z0e(e,t,n){let r=[];for(let a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function rV(e,t,n,r){let a=[...e];for(let s=a.length;s<r.length;s++)a.push(1);for(let s=0;s<n;s++)s===0?a[t]=1:(a.splice(t,0,1),a.pop());return a}function aV(e,t,n){return n<=e?n:n-(t-1)}function sV(e,t){let n=[];for(let r=0;r<e;r++)n.push(t+r);return n}function Q0e(e,t,n,r,a,s,o,l,c){let d=e.length,u=new Array(d),h=new Array(d),p=new Array(d);if(t.length&&n>0){let m=t[0],f=n+1;u=iV(o,m,f,r,e),h=oV(l,m,f,a,e),p=rV(s,m,f,e)}else for(let m=0;m<d;m++)u[m]=cV(o,r,s,e,m,c),h[m]=uV(l,a,s,e,m,c),p[m]=lV(s,m,c);return{begin:u,end:h,strides:p}}function iV(e,t,n,r,a){let s=[...a],o=sV(n,t);for(let l=0;l<s.length;l++)if(o.indexOf(l)>-1)s[l]=0;else{let c=aV(t,n,l),d=r[c];e&1<<c&&(d=0),s[l]=d}return s}function oV(e,t,n,r,a){let s=[...a],o=sV(n,t);for(let l=0;l<s.length;l++)if(o.indexOf(l)>-1)s[l]=Number.MAX_SAFE_INTEGER;else{let c=aV(t,n,l),d=r[c];e&1<<c&&(d=Number.MAX_SAFE_INTEGER),s[l]=d}for(let l=0;l<s.length;l++){let c=a[l];s[l]<0&&(s[l]+=c),s[l]=Fy(0,s[l],a[l])}return s}function lV(e,t,n){let r=e[t];return(n&1<<t||r==null)&&(r=1),r}function cV(e,t,n,r,a,s){let o=t[a],l=n[a]||1;(e&1<<a||s&1<<a||o==null)&&(l>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);let c=r[a];return o<0&&(o+=c),o=Fy(0,o,c-1),o}function uV(e,t,n,r,a,s){let o=t[a],l=n[a]||1;(e&1<<a||s&1<<a||o==null)&&(l>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);let c=r[a];return o<0&&(o+=c),l>0?o=Fy(0,o,c):o=Fy(-1,o,c-1),o}function J0e(e,t,n){let r=n.length;for(let a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(let a=r+1;a<n.length;a++)if(t[a]>0||n[a]!==e[a])return!1;return!0}function e1e(e,t){let n=e.length>0?e[e.length-1]:1;for(let r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function dV(e,t,n){let r,a=e.shape.length;typeof t=="number"?r=[t,...new Array(a-1).fill(0)]:t.length<a?r=t.concat(new Array(a-t.length).fill(0)):r=t.slice(),r.forEach(o=>{Y(o!==-1,()=>"slice() does not support negative begin indexing.")});let s;return n==null?s=new Array(a).fill(-1):typeof n=="number"?s=[n,...new Array(a-1).fill(-1)]:n.length<a?s=n.concat(new Array(a-n.length).fill(-1)):s=n,s=s.map((o,l)=>o>=0?o:(Y(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${l}.`),e.shape[l]-r[l])),[r,s]}function t1e(e,t,n,r,a,s,o,l,c){let d;if(r==null?(d=new Array(t.length),d.fill(1)):d=r,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1,h={dims:d.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:d.slice(),beginMask:a,endMask:s,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};for(let b=0;b<h.dims;b++)u&&1<<b&l&&h.numAddAxisAfterEllipsis++,1<<b&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);let p={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};n1e(h,p);let m=!0,f=!0,g=!0,x=[],y=[];for(let b=0;b<e.length;++b){if(p.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let v=!!(p.shrinkAxisMask&1<<b),w=e[b];if(w===-1){x.push(v?1:-1);continue}let k=[p.beginMask&1<<b,p.endMask&1<<b],C=[p.strides[b]>0?0:-1,p.strides[b]>0?w:w-1];if(v&&p.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&p.strides[b]===1;let S=!!(p.beginMask&1<<b&&p.endMask&1<<b);if(p.beginValid&&p.endValid){if(v){let A=p.begin[b]<0?w+p.begin[b]:p.begin[b];if(p.begin[b]=A,p.end[b]=p.begin[b]+1,A<0||A>=w)throw Error(`slice index ${p.begin[b]} of dimension ${b} out of bounds.`)}else p.begin[b]=V3(p.begin[b],0,p.strides[b],w,k,C),p.end[b]=V3(p.end[b],1,p.strides[b],w,k,C);let T=p.strides[b]===1&&p.begin[b]===0&&p.end[b]===w;m=m&&T,f=f&&(b===0&&p.strides[b]===1||T)}else m=m&&p.strides[b]===1&&S,f=f&&(b===0&&p.strides[b]===1||S);let _,I=!1;if(p.beginValid&&p.endValid?(_=p.end[b]-p.begin[b],I=!0):v?(_=1,I=!0):S&&w>=0&&(p.strides[b]<0?_=-w:_=w,I=!0),I){let T;_===0||_<0!=p.strides[b]<0?T=0:T=Math.trunc(_/p.strides[b])+(_%p.strides[b]!==0?1:0),x.push(T)}else x.push(-1)}for(let b=0;b<p.finalShapeGatherIndices.length;++b){let v=p.finalShapeGatherIndices[b];v>=0?y.push(x[v]):v===GC&&y.push(1)}return{finalShapeSparse:y.filter((b,v)=>p.finalShapeGatherIndices[v]!==GC),finalShape:y,isIdentity:m,sliceDim0:f,isSimpleSlice:g,begin:p.begin,end:p.end,strides:p.strides}}function n1e(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;let n=0;t.beginValid=e.begin!=null,t.endValid=e.end!=null,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(let r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask){let a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);for(;n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r}else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(GC),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${t.dims} dims, ${t.begin.length}.`);e.begin!=null&&(t.begin[n]=e.begin[r]),e.end!=null&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(K0e),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}function V3(e,t,n,r,a,s){if(a[t])return n>0?s[t]:s[t+1&1];{let o=e<0?r+e:e;return o<s[0]?s[0]:o>s[1]?s[1]:o}}var r1e="4.22.0",hV=class{static sgd(e){return new RN(e)}static momentum(e,t,n=!1){return new HT(e,t,n)}static rmsprop(e,t=.9,n=0,r=null,a=!1){return new GT(e,t,n,r,a)}static adam(e=.001,t=.9,n=.999,r=null){return new UT(e,t,n,r)}static adadelta(e=.001,t=.95,n=null){return new BT(e,t,n)}static adamax(e=.002,t=.9,n=.999,r=null,a=0){return new VT(e,t,n,r,a)}static adagrad(e,t=.1){return new WT(e,t)}},sd=hV,a1e=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:e=>e();function XT(){return new Promise(e=>a1e(()=>e()))}var z={};nn(z,{ERF_A1:()=>b1e,ERF_A2:()=>v1e,ERF_A3:()=>w1e,ERF_A4:()=>N1e,ERF_A5:()=>k1e,ERF_P:()=>y1e,PARALLELIZE_THRESHOLD:()=>ZT,RowPartitionType:()=>Wo,SELU_SCALE:()=>mV,SELU_SCALEALPHA:()=>pV,applyActivation:()=>EN,assertAndGetBroadcastShape:()=>mr,assertAxesAreInnerMostDims:()=>tye,assertParamsConsistent:()=>s1e,assignToTypedArray:()=>T1e,axesAreInnerMostDims:()=>lT,calculateShapes:()=>wU,checkEinsumDimSizes:()=>$1e,checkPadOnDimRoundingMode:()=>rs,combineLocations:()=>WW,combineRaggedTensorToTensorShapes:()=>o1e,complexWithEvenIndex:()=>_1e,complexWithOddIndex:()=>j1e,computeConv2DInfo:()=>Kb,computeConv3DInfo:()=>DW,computeDefaultPad:()=>VI,computeDilation2DInfo:()=>Jge,computeOptimalWindowSize:()=>d1e,computeOutAndReduceShapes:()=>UW,computeOutShape:()=>i1e,computePool2DInfo:()=>RW,computePool3DInfo:()=>exe,convertConv2DDataFormat:()=>MW,decodeEinsumEquation:()=>D1e,eitherStridesOrDilationsAreOne:()=>ml,expandShapeToKeepDim:()=>uh,exponent:()=>A1e,exponents:()=>E1e,fromStringArrayToUint8:()=>nNe,fromUint8ToStringArray:()=>tNe,getAxesPermutation:()=>VW,getBroadcastDims:()=>zW,getComplexWithIndex:()=>I1e,getEinsumComputePath:()=>F1e,getEinsumPermutation:()=>M1e,getFusedBiasGradient:()=>TN,getFusedDyActivation:()=>IN,getImageCenter:()=>h1e,getInnerMostAxes:()=>nye,getPermuted:()=>m1e,getRaggedRank:()=>c1e,getReductionAxes:()=>ea,getReshaped:()=>p1e,getReshapedPermuted:()=>f1e,getRowPartitionTypesHelper:()=>l1e,getSliceBeginCoords:()=>g1e,getSliceSize:()=>x1e,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>z1e,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>B1e,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>W1e,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>H1e,getSparseReshapeInputOutputMismatchErrorMessage:()=>q1e,getSparseReshapeInputOutputMultipleErrorMessage:()=>G1e,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>U1e,getSparseReshapeNegativeOutputDimErrorMessage:()=>V1e,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>Z1e,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>K1e,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Y1e,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>X1e,getUndoAxesPermutation:()=>cT,isIdentityPermutation:()=>P1e,log:()=>dfe,mergeRealAndImagArrays:()=>S1e,prepareAndValidate:()=>nV,prepareSplitSize:()=>L1e,segment_util:()=>fV,shouldFuse:()=>AN,slice_util:()=>da,splitRealAndImagArrays:()=>C1e,stridesOrDilationsArePositive:()=>ch,tupleValuesAreOne:()=>uu,upcastType:()=>mi,validateDefaultValueShape:()=>u1e,validateInput:()=>SN,validateUpdateShape:()=>AT,warn:()=>jc});function s1e(e,t){let n=e[0].length;e.forEach((a,s)=>{Y(a.length===n,()=>`Error in concat${n}D: rank of tensors[${s}] must be the same as the rank of the rest (${n})`)}),Y(t>=0&&t<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);let r=e[0];e.forEach((a,s)=>{for(let o=0;o<n;o++)Y(o===t||a[o]===r[o],()=>`Error in concat${n}D: Shape of tensors[${s}] (${a}) does not match the shape of the rest (${r}) along the non-concatenated axis ${s}.`)})}function i1e(e,t){let n=e[0].slice();for(let r=1;r<e.length;r++)n[t]+=e[r][t];return n}var Wo;(function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"})(Wo||(Wo={}));function o1e(e,t,n){let r=new Array;if(n==null&&t==null)return r;if(t==null)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(n==null)return r;if(e+n.length!==r.length)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.rank = ${e+n.length}, but shape.rank = ${r.length}`);for(let a=1;a<n.length;++a){let s=n[a],o=r[r.length-n.length+a],l=r[o];if(s>=0)if(l>=0){if(l!==s)throw new Error(`rt input.shape and shape=${t} are incompatible: rt input.shape[${a+e}] = ${s} but shape[${a+e}] = ${l}`)}else r[o]=s}return r}function l1e(e){let t={FIRST_DIM_SIZE:Wo.FIRST_DIM_SIZE,VALUE_ROWIDS:Wo.VALUE_ROWIDS,ROW_LENGTHS:Wo.ROW_LENGTHS,ROW_SPLITS:Wo.ROW_SPLITS,ROW_LIMITS:Wo.ROW_LIMITS,ROW_STARTS:Wo.ROW_STARTS},n=[];for(let r of e)if(r in t)n.push(t[r]);else break;return n}function c1e(e){return e.length===0?0:e[0]===Wo.FIRST_DIM_SIZE?e.length-1:e.length}function u1e(e,t){if(e==null||t==null)return;let n=e.length,r=t.length;if(n>=r)throw new Error(`defaultValue.shape=${e} and ragged tensor flatValues.shape=${t}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${r})`);for(let a=0;a<Math.min(n,r-1);++a){let s=e[a],o=t[a+1];if(s>=0&&o>=0&&s!==1&&s!==o)throw new Error(`defaultValue.shape=${e}, and ragged tensor input flatValues.shape=${t} are incompatible: defaultValue.shape[${a-e.length}] = ${s} but ragged tensor input.flatValues.shape[${a-e.length}] = ${o}`)}}var ZT=30;function d1e(e){return e<=ZT?e:$0(e,Math.floor(Math.sqrt(e)))}function h1e(e,t,n){let r=n*(typeof e=="number"?e:e[0]),a=t*(typeof e=="number"?e:e[1]);return[r,a]}function p1e(e,t,n,r=!0){let a=[];if(r)a=a.concat(t.slice(0)),a.push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);let s=t.length;for(let o=0;o<s;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(s+1))}return a}function m1e(e,t,n=!0){let r=[];if(n){r.push(t);for(let a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{let a=[],s=[];for(let o=1;o<e;++o)o>=t*2+1||o%2===1?s.push(o):a.push(o);r.push(...a),r.push(0),r.push(...s)}return r}function f1e(e,t,n,r=!0){let a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(let s=1;s<e.length;++s)s<=t.length?r?a.push(t[s-1]*e[s]):a.push(e[s]/t[s-1]):a.push(e[s]);return a}function g1e(e,t){let n=[0];for(let r=0;r<t;++r)n.push(e[r][0]);return n}function x1e(e,t,n){let r=e.slice(0,1);for(let a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var pV=1.7580993408473768,mV=1.0507009873554805,y1e=.3275911,b1e=.254829592,v1e=-.284496736,w1e=1.421413741,N1e=-1.453152027,k1e=1.061405429;function S1e(e,t){if(e.length!==t.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${e.length}, imag: ${t.length}.`);let n=new Float32Array(e.length*2);for(let r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function C1e(e){let t=new Float32Array(e.length/2),n=new Float32Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function _1e(e){let t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function j1e(e){let t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t);for(let a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function I1e(e,t){let n=e[t*2],r=e[t*2+1];return{real:n,imag:r}}function T1e(e,t,n,r){e[r*2]=t,e[r*2+1]=n}function E1e(e,t){let n=new Float32Array(e/2),r=new Float32Array(e/2);for(let a=0;a<Math.ceil(e/2);a++){let s=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(s),r[a]=Math.sin(s)}return{real:n,imag:r}}function A1e(e,t,n){let r=(n?2:-2)*Math.PI*(e/t),a=Math.cos(r),s=Math.sin(r);return{real:a,imag:s}}var VS="->",R1e=/->/g,H3=",",G3="...";function D1e(e,t){e=e.replace(/\s/g,"");let n=(e.length-e.replace(R1e,"").length)/VS.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${VS}").`);let[r,a]=e.split(VS);Y(r.indexOf(G3)===-1,()=>`The ellipsis notation ("${G3}") is not supported yet.`);let s=r.split(H3),o=s.length;if(t!==o)throw new Error(`Expected ${o} input tensors, received ${t}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let l=[];for(let p=0;p<a.length;++p){let m=a[p];if(!s.some(f=>f.indexOf(m)!==-1))throw new Error(`Output subscripts contain the label ${m} not present in the input subscripts.`);l.indexOf(m)===-1&&l.push(m)}for(let p=0;p<r.length;++p){let m=r[p];l.indexOf(m)===-1&&m!==H3&&l.push(m)}let c=new Array(s.length);for(let p=0;p<o;++p){if(new Set(s[p].split("")).size!==s[p].length)throw new Error(`Found duplicate axes in input component ${s[p]}. Support for duplicate axes in input is not implemented yet.`);c[p]=[];for(let m=0;m<s[p].length;++m)c[p].push(l.indexOf(s[p][m]))}let d=l.length,u=a.length,h=[];for(let p=u;p<d;++p)h.push(p);return{allDims:l,summedDims:h,idDims:c}}function M1e(e,t){let n=new Array(e);n.fill(-1);for(let a=0;a<t.length;++a)n[t[a]]=a;let r=[];for(let a=0;a<e;++a)n[a]===-1&&r.push(a);return n=n.filter(a=>a!==-1),{permutationIndices:n,expandDims:r}}function $1e(e,t,n){let r=new Array(e);for(let a=0;a<n.length;++a){let s=n[a].shape;for(let o=0;o<t[a].length;++o)r[t[a][o]]===void 0?r[t[a][o]]=s[o]:Y(r[t[a][o]]===s[o],()=>`Expected dimension ${r[t[a][o]]} at axis ${o} of input shaped ${JSON.stringify(s)}, but got dimension ${s[o]}`)}}function F1e(e,t){let n=e,r=[],a=0;e.length===0&&n.push(-1),a=e.length+1;for(let o=0;o<a;++o)r.push([]);let s=[];for(let o=0;o<n.length;++o){let l=n[o],c=O1e(t,l);for(let d of c)s.indexOf(d)===-1&&(r[o].push(d),s.push(d))}return{path:n,steps:r}}function P1e(e){return e.every((t,n)=>t===n)}function O1e(e,t){let n=[];for(let r=0;r<e.length;++r)(e[r].length===0||e[r].indexOf(t)!==-1||t===-1)&&n.push(r);return n}function L1e(e,t,n=0){let r=[];if(typeof t=="number")Y(e.shape[n]%t===0,()=>"Number of splits must evenly divide the axis."),r=new Array(t).fill(e.shape[n]/t);else{let a=t.reduce((o,l)=>(l===-1&&(o+=1),o),0);Y(a<=1,()=>"There should be only one negative value in split array.");let s=t.indexOf(-1);if(s!==-1){let o=t.reduce((l,c)=>c>0?l+c:l);t[s]=e.shape[n]-o}Y(e.shape[n]===t.reduce((o,l)=>o+l),()=>"The sum of sizes must match the size of the axis dimension."),r=t}return r}function z1e(e){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${e}`}function B1e(e,t){return`indices(${e}, 0) is invalid: ${t} < 0`}function W1e(e,t,n){return`indices(${e}, 0) is invalid: ${t} >= ${n}`}function U1e(e,t){return`only one output dimension may be -1, not both ${e} and ${t}`}function V1e(e,t){return`size ${e} must be non-negative, not ${t}`}function H1e(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function G1e(e,t){let n=ir(e),r=ir(t);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${e} outputShape= ${t}`}function q1e(e,t){let n=ir(e),r=ir(t);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${r}. inputShape=${e} outputShape=${t}`}function K1e(){return"segment ids must be >= 0"}function Y1e(){return"segment ids are not increasing"}function X1e(e,t){return`Segment id ${e} out of range [0, ${t}), possibly because segmentIds input is not sorted.`}function Z1e(e,t,n){return`Bad: indices[${e}] == ${t} out of range [0, ${n})`}var fV={};nn(fV,{collectGatherOpShapeInfo:()=>eNe,computeOutShape:()=>J1e,segOpComputeOptimalWindowSize:()=>Q1e});function Q1e(e,t){let n=!1,r;for(e<=ZT?(r=e,n=!0):r=$0(e,Math.floor(Math.sqrt(e)));!n;)r>t||r===e?n=!0:r=$0(e,r+1);return r}function J1e(e,t,n){let r=[],a=e.length;for(let s=0;s<a;s++)s!==t?r.push(e[s]):r.push(n);return r}function eNe(e,t,n,r){let a=t.shape.length,s=e.shape.length;if(r!==0&&(r<-a||r>a))throw new Error(`Expect batchDims in the range of [-${a}, ${a}], but got ${r}`);if(r<0&&(r+=a),r>s)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${s}).`);if(n<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${n}).`);for(let h=0;h<r;++h)if(e.shape[h]!==t.shape[h])throw new Error(`x.shape[${h}]: ${e.shape[h]} should be equal to indices.shape[${h}]: ${t.shape[h]}.`);let o=e.shape[n],l=[],c=1,d=1,u=1;for(let h=0;h<r;++h)l.push(e.shape[h]),c*=e.shape[h];for(let h=r;h<n;h++)l.push(e.shape[h]),d*=e.shape[h];for(let h=r;h<a;h++)l.push(t.shape[h]);for(let h=n+1;h<s;h++)l.push(e.shape[h]),u*=e.shape[h];return{batchSize:c,sliceSize:u,outerSize:d,dimSize:o,outputShape:l}}function tNe(e){try{return e.map(t=>O0(t))}catch(t){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${t}`)}}function nNe(e){return e.map(t=>Hb(t))}var gl={};nn(gl,{nonMaxSuppressionV3Impl:()=>$U,nonMaxSuppressionV4Impl:()=>FU,nonMaxSuppressionV5Impl:()=>PU,whereImpl:()=>SU});b0e();var gV={kernelName:Lf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,Gp(He(n,"float32"),-1))}}},rNe={kernelName:Ch,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=hr(He(n,"float32")),a=Ta(ot(Rt(1),r));return Cr(pt(e,a))}}}},aNe={kernelName:_h,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=Ta(ot(hr(He(n,"float32")),1));return pt(e,r)}}}},sNe={kernelName:_u,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=e,o=ea(n.shape,a);return o.length>0&&(s=xt(s,o)),me(s,n.shape)},b:()=>{let s=e,o=ea(r.shape,a);return o.length>0&&(s=xt(s,o)),me(s,r.shape)}}}},iNe={kernelName:jh,saveAllInputs:!0,gradFunc:(e,t)=>{let n={};return t.forEach((r,a)=>{n[a]=()=>e.clone()}),n}},oNe={kernelName:Wf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Pn(n)}}},lNe={kernelName:Uf,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Pn(n)}}},cNe={kernelName:Ih,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,Ta(ot(Rt(1),hr(He(n,"float32")))))}}},uNe={kernelName:Th,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=Ta(Re(Rt(1),hr(He(n,"float32"))));return pt(e,r)}}}},dNe={kernelName:Rh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=Re(hr(n),hr(r)),o=oe(e,pt(r,s)),l=ea(n.shape,a);return l.length>0&&(o=xt(o,l)),me(o,n.shape)},b:()=>{let s=Re(hr(n),hr(r)),o=Cr(oe(e,pt(n,s))),l=ea(r.shape,a);return l.length>0&&(o=xt(o,l)),me(o,r.shape)}}}},hNe={kernelName:Eh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,Re(hr(He(n,"float32")),1))}}},pNe={kernelName:Ah,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,ot(Rt(1),hr(He(n,"float32"))))}}};function mNe(e,t,n,r,a,s){let o=H(e,"dy","avgPool3dGrad"),l=H(t,"input","avgPool3dGrad"),c=o,d=l,u=!1;l.rank===4&&(u=!0,c=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),d=me(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),Y(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),Y(d.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),rs("avgPool3dGrad",a,s);let h={dy:c,input:d},p={filterSize:n,strides:r,pad:a,dimRoundingMode:s},m=ae.runKernel(kb,h,p);return u?me(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var fNe=se({avgPool3dGrad_:mNe}),gNe={kernelName:Vf,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:o,dimRoundingMode:l}=n;return{x:()=>fNe(e,r,a,s,o,l)}}};function xNe(e,t,n,r,a){let s=H(e,"dy","avgPoolGrad"),o=H(t,"input","avgPoolGrad");Y(o.rank===s.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${s.rank})`);let l=o,c=s,d=!1;o.rank===3&&(d=!0,l=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Y(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),Y(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);let u={dy:c,input:l},h={filterSize:n,strides:r,pad:a},p=ae.runKernel(Nb,u,h);return d?me(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var yNe=se({avgPoolGrad_:xNe}),bNe={kernelName:Dh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{filterSize:a,strides:s,pad:o}=n;return{x:()=>yNe(e,r,a,s,o)}}},vNe={kernelName:Mh,inputsToSave:["a","b"],gradFunc:(e,t,n)=>{let[r,a]=t,{transposeA:s,transposeB:o}=n;return!s&&!o?{a:()=>un(e,a,!1,!0),b:()=>un(r,e,!0,!1)}:!s&&o?{a:()=>un(e,a,!1,!1),b:()=>un(e,r,!0,!1)}:s&&!o?{a:()=>un(a,e,!1,!0),b:()=>un(r,e,!1,!1)}:{a:()=>un(a,e,!0,!0),b:()=>un(e,r,!0,!0)}}},wNe={kernelName:Hf,gradFunc:(e,t,n)=>{let{blockShape:r,crops:a}=n;return{x:()=>rv(e,r,a)}}},NNe={kernelName:tW,gradFunc:(e,t,n)=>{let r=n,a=r.inputShape,s=r.shape,o=Array.from(s);for(let c=a.length-1;c>=0;c--)if(a[c]===s[c])o[c]=1;else if(a[c]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${s}].`);let l=[];for(let c=0;c<o.length;c++)o[c]>1&&l.push(c);return{x:()=>xt(e,l,!0)}}},kNe={kernelName:$h,gradFunc:e=>({x:()=>e.clone()})},SNe={kernelName:Fh,gradFunc:e=>({x:()=>Pn(e)})},CNe={kernelName:ju,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{clipValueMin:a,clipValueMax:s}=n;return{x:()=>Ia(Wi(nc(r,a),Au(r,s)),e,Pn(e))}}},_Ne={kernelName:Cb,inputsToSave:["x"],gradFunc:gV.gradFunc},jNe={kernelName:Kf,saveAllInputs:!0,gradFunc:(e,t,n)=>{let r=t.map(l=>l.shape),{axis:a}=n,s=Hi(a,t[0].shape)[0],o=r.map(l=>l[s]);return bs(e,o,s).map(l=>()=>l)}},INe={kernelName:Ph,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{dilations:s,strides:o,pad:l,dataFormat:c}=n;return Y(uu(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>tT(r.shape,e,a,o,l,c),filter:()=>OT(r,e,a.shape,o,l,c)}}},TNe={kernelName:Oh,inputsToSave:["dy","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,{strides:s,pad:o,dataFormat:l,dimRoundingMode:c}=n;return{dy:()=>Ja(e,a,s,o,l,1,c),filter:()=>OT(e,r,a.shape,s,o,l,c)}}};function ENe(e,t,n,r,a){let s=e;e.rank===4&&(s=me(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));let o=t;o.rank===4&&(o=me(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Y(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),Y(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),Y(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),Y(s.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${n[3]}.`),Y(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);let l={x:s,dy:o},c={strides:r,pad:a,filterShape:n};return ae.runKernel(Yf,l,c)}var ANe=se({conv3DBackpropFilter_:ENe}),RNe={kernelName:Lh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s}=n;Y(uu(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[o,l]=t;return{x:()=>OW(o.shape,e,l,a,s),filter:()=>ANe(o,e,l.shape,a,s)}}},DNe={kernelName:zh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(Cr(xN(He(n,"float32"))),e)}}},MNe={kernelName:Bh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(yN(He(n,"float32")),e)}}},$Ne={kernelName:Wh,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a,exclusive:s,reverse:o}=n;return{x:()=>{let l=VW([a],r.rank),c=sN(e,a,s,!o);return l!=null&&(c=hn(c,l)),c}}}},FNe={kernelName:Uh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let{dilations:r,strides:a,pad:s,dimRoundingMode:o}=n,l=r??[1,1];Y(uu(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);let[c,d]=t;return Y(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),Y(d.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${d.rank}.`),Y(c.shape[3]===d.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),Y(ml(a,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${l}'.`),rs("depthwiseConv2d",s,o),{x:()=>RU(c.shape,e,d,a,s,l,o),filter:()=>AU(c,e,d.shape,a,s,l,o)}}},PNe={kernelName:Vh,inputsToSave:["x","filter"],gradFunc:(e,t,n)=>{let[r,a]=t,s={x:r,filter:a,dy:e},o={x:r,filter:a,dy:e};return{x:()=>ae.runKernel(df,s,n),filter:()=>ae.runKernel(hf,o,n)}}},ONe={kernelName:Gh,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t,r={dy:e,y:n};return{x:()=>ae.runKernel(eg,r)}}},LNe={kernelName:qh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=oe(Ua(Cr(hr(n))),2/Math.sqrt(Math.PI));return{x:()=>oe(e,r)}}},zNe={kernelName:Kh,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,n)}}},BNe={kernelName:ng,inputsToSave:["input"],gradFunc:(e,t)=>{let[n]=t;return{input:()=>me(e,n.shape)}}},WNe={kernelName:Yh,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,Ua(n))}}},UNe={kernelName:Xh,gradFunc:e=>({x:()=>Pn(e)})},VNe={kernelName:Zh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=pt(e,He(r,"float32")),o=ea(n.shape,a);return o.length>0?me(xt(s,o),n.shape):s},b:()=>{let s=oe(e,He(n,"float32")),o=ea(r.shape,a);o.length>0&&(s=me(xt(s,o),r.shape));let l=hr(r);return Cr(pt(s,He(l,"float32")))}}}},HNe={kernelName:Qh,inputsToSave:["x","mean","variance","scale"],gradFunc:(e,t,n)=>{let{varianceEpsilon:r}=n,[a,s,o,l]=t,c=l??Rt(1),d=ea(s.shape,a.shape),u=[];if(s.rank===1){for(let g=0;g<a.shape.length-1;++g)u.push(a.shape[g]);u.push(1)}let h=ot(a,s),p=oe(e,c),m=fN(Re(o,Rt(r))),f=oe(oe(oe(m,m),m),Rt(-.5));return{x:()=>s.rank===1?me(oe(oe(e,Us(me(m,[1,1,1,s.shape[0]]),u)),c),a.shape):me(oe(oe(e,m),c),a.shape),mean:()=>{let g=oe(oe(m,Rt(-1)),p);return s.rank===1&&(g=xt(g,d)),me(g,s.shape)},variance:()=>{let g=oe(oe(f,h),p);return s.rank===1&&(g=xt(g,d)),me(g,s.shape)},scale:()=>{let g=oe(h,m),x=oe(e,g);return s.rank===1&&(x=xt(x,d)),me(x,s.shape)},offset:()=>{let g=e;return s.rank===1&&(g=xt(g,d)),me(g,s.shape)}}}},GNe={kernelName:ag,inputsToSave:["x","indices"],gradFunc:(e,t,n)=>{let[r,a]=t,{axis:s,batchDims:o}=n,l=Hi(s,r.shape)[0],c=(d,u,h)=>()=>{let p=d.shape,m=u.size,f=p.slice(0,l),g=f.length,x=p.slice(s,p.length).slice(1),y=x.length,b=q3(0,g),v=q3(g+1,g+1+y),w=K3([f,[m],x]),k=me(h,w),C=me(u,[m]),S=K3([[g],b,v]),_=hn(k,S),I=_N(_,C,d.shape[l]),T=cT(S);return I=hn(I,T),I};if(o===1){let d=r.shape[0],u=r.split(d,0);return{x:()=>Jr(u.map((h,p)=>c(h,a.slice(p,1),e.slice(p,1))())).reshape(r.shape),indices:()=>a}}else return{x:c(r,a,e),indices:()=>a}}};function q3(e,t){let n=[];for(let r=e;r<t;++r)n.push(r);return n}function K3(e){let t=[];for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var qNe={kernelName:Jh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>Pn(n),b:()=>Pn(r)}}},KNe={kernelName:ep,gradFunc:e=>({x:()=>He(e,"float32")})},YNe={kernelName:tp,gradFunc:e=>({x:()=>Pn(e)})},XNe={kernelName:np,gradFunc:e=>({x:()=>Pn(e)})},ZNe={kernelName:rp,gradFunc:e=>({x:()=>Pn(e)})},QNe={kernelName:ap,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{alpha:a}=n,s=as(r,0);return{x:()=>Ia(s,e,oe(e,a))}}},JNe={kernelName:ip,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,Re(n,1))}}},eke={kernelName:sp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,He(n,"float32"))}}},tke={kernelName:rW,inputsToSave:[],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n;return{logits:()=>{let s=Ua(r);return ot(e,oe(xt(e,a,!0),s))}}}};function nke(e,t,n,r=5,a=1,s=1,o=.5){let l={x:e,y:t,dy:n},c={depthRadius:r,bias:a,alpha:s,beta:o};return ae.runKernel(pg,l,c)}var rke=se({localResponseNormalizationBackprop_:nke}),ake={kernelName:op,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{depthRadius:s,bias:o,alpha:l,beta:c}=n;return{x:()=>rke(r,a,e,s,o,l,c)}}};function xV(e,t,n,r){return t.rank<n.rank&&(t=me(t,uh(t.shape,r))),e.rank<n.rank&&(e=me(e,uh(e.shape,r))),{x:()=>oe(e,He(qs(n,t),e.dtype))}}var Y3={kernelName:lp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{reductionIndices:a}=r,s=t[0],o=t[1],l=Hi(a,s.shape),c=xV(e,o,s,l);return{x:()=>c.x()}}},ske={kernelName:cp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>oe(e,He(nc(n,r),"float32")),b:()=>oe(e,He(ff(n,r),"float32"))}}};function ike(e,t,n,r,a,s,o){let l=H(e,"dy","maxPool3dGrad"),c=H(t,"input","maxPool3dGrad"),d=H(n,"output","maxPool3dGrad"),u=l,h=c,p=d,m=!1;c.rank===4&&(m=!0,u=me(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=me(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),p=me(d,[1,d.shape[0],d.shape[1],d.shape[2],d.shape[3]])),Y(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),Y(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),Y(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),rs("maxPool3dGrad",s,o);let f={dy:u,input:h,output:p},g={filterSize:r,strides:a,pad:s,dimRoundingMode:o},x=ae.runKernel(Eb,f,g);return m?me(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}var oke=se({maxPool3dGrad_:ike}),lke={kernelName:mg,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=n;return{x:()=>oke(e,r,a,s,o,l,c)}}};function cke(e,t,n,r,a,s,o){let l=H(e,"dy","maxPoolGrad"),c=H(t,"input","maxPoolGrad"),d=H(n,"output","maxPoolGrad");Y(c.rank===l.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${l.rank})`),Y(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),Y(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),rs("maxPoolGrad",s,o);let u={dy:l,input:c,output:d},h={filterSize:r,strides:a,pad:s,dimRoundingMode:o};return ae.runKernel(Tb,u,h)}var uke=se({maxPoolGrad_:cke}),dke={kernelName:up,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r,a]=t,{filterSize:s,strides:o,pad:l}=n;return{x:()=>uke(e,r,a,s,o,l)}}},hke={kernelName:dp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=Hi(a,r.shape),o=UW(r.shape,s)[1],l=ir(o);return{x:()=>{let c=r.shape.slice();s.forEach(u=>{c[u]=1});let d=me(e,c);return pt(oe(d,ys(r.shape,"float32")),l)}}}},pke={kernelName:hp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(e,t,n)=>{let r=n,{axis:a}=r,[s,o]=t,l=Hi(a,s.shape),c=xV(e,o,s,l);return{x:()=>c.x()}}},mke={kernelName:pp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t;return{a:()=>oe(e,He(Au(n,r),"float32")),b:()=>oe(e,He(as(n,r),"float32"))}}},fke={kernelName:mp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(o=>o[0]);return{x:()=>En(e,s,r.shape)}}},gke={kernelName:fp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=ea(n.shape,a);return s.length>0?me(xt(e,s),n.shape):e},b:()=>{let s=oe(e,Cr(Vg(pt(n,r)))),o=ea(r.shape,a);return o.length>0?me(xt(s,o),r.shape):s}}}},xke={kernelName:gp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=oe(e,He(r,"float32")),o=ea(n.shape,a);return o.length>0?me(xt(s,o),n.shape):s},b:()=>{let s=oe(e,He(n,"float32")),o=ea(r.shape,a);return o.length>0?me(xt(s,o),r.shape):s}}}},yke={kernelName:gg,gradFunc:e=>({x:()=>Cr(e)})},bke={kernelName:xp,inputsToSave:["indices"],gradFunc:(e,t)=>{let n=t[0];return{indices:()=>Fr(n.shape,"float32")}}},vke={kernelName:wg,gradFunc:e=>({x:()=>Pn(e)})},wke={kernelName:Ng,saveAllInputs:!0,gradFunc:(e,t,n)=>{let{axis:r}=n;return Ur(e,r).map(a=>()=>a)}},X3={kernelName:yp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let r=t[0],{paddings:a}=n,s=a.map(o=>o[0]);return{x:()=>En(e,s,r.shape)}}},Nke={kernelName:bp,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(e,t)=>{let[n,r,a]=t,s=n,o=r,l=mr(s.shape,o.shape);return{a:()=>{let c=He(o,"float32"),d=oe(e,oe(c,ll(s,ot(c,Rt(1))))),u=ea(s.shape,l);return u.length>0&&(d=xt(d,u)),me(d,s.shape)},b:()=>{let c=as(s,0),d=Ia(c,Ks(s),Pn(s)),u=oe(e,oe(a,d)),h=ea(o.shape,l);return h.length>0&&(u=xt(u,h)),me(u,o.shape)}}}},kke={kernelName:vp,inputsToSave:["x","alpha"],gradFunc:(e,t)=>{let[n,r]=t,a=as(n,0);return{x:()=>Ia(a,e,oe(e,r)),alpha:()=>{let s=Ia(a,Pn(e),oe(e,n)),o=ea(r.shape,e.shape);return o.length>0&&(s=xt(s,o)),me(s,r.shape)}}}};function Ske(e,t,n){let r=e.shape.slice();r[n]=1;let a=me(t,r),s=Vy(e,n,!0,!1),o=Vy(e,n,!0,!0),l=oe(s,o);return oe(a,l)}function Cke(e,t,n){let r=e.shape.length,a=r-n.length,s=z.getAxesPermutation(n,r),o=e;s!=null&&(o=hn(e,s));let l=o.shape.slice(),c=l.splice(r-n.length,n.length).reduce((h,p)=>h*p,1);l.push(c);let d=o.reshape(l),u=Ske(d,t,a);if(u=u.reshape(o.shape),s!=null){let h=z.getUndoAxesPermutation(s);u=hn(u,h)}return u}var _ke={kernelName:wp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{axis:a}=n,s=[];return a==null?s=r.shape.map((o,l)=>l):typeof a=="number"?s=[a]:s=a,{x:()=>Cke(r,e,s)}}},jke={kernelName:Hh,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=pt(e,He(r,"float32")),o=ea(n.shape,a);return o.length>0?me(xt(s,o),n.shape):s},b:()=>{let s=oe(e,He(n,"float32")),o=ea(r.shape,a);o.length>0&&(s=me(xt(s,o),r.shape));let l=hr(r);return Cr(pt(s,He(l,"float32")))}}}},Ike={kernelName:Np,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,Cr(hr(n)))}}},Tke={kernelName:_p,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t,r=oe(Au(n,6),Gp(n));return{x:()=>oe(e,He(r,"float32"))}}},Eke={kernelName:kp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,He(Gp(n),"float32"))}}},Ake={kernelName:kg,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>me(e,n.shape)}}},Rke={kernelName:Cp,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>ae.runKernel(Cg,a,n)}}},Dke={kernelName:Sp,inputsToSave:["images"],gradFunc:(e,t,n)=>{let[r]=t,a={dy:e,images:r};return{images:()=>ae.runKernel(Sg,a,n)}}},Mke={kernelName:jp,gradFunc:(e,t,n)=>{let{dims:r}=n,a=Hi(r,e.shape);return{x:()=>gi(e,a)}}},$ke={kernelName:Ip,gradFunc:e=>({x:()=>Pn(e)})},Fke={kernelName:Tp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>Cr(pt(e,oe(ll(n,1.5),2)))}}},Pke={kernelName:Tg,inputsToSave:["condition"],gradFunc:(e,t)=>{let[n]=t;return{condition:()=>He(Pn(n),"float32"),t:()=>oe(e,He(n,e.dtype)),e:()=>oe(e,He(tv(n),e.dtype))}}},Oke={kernelName:Ep,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>{let r=as(n,Rt(0)),a=Rt(pV),s=Rt(mV),o=oe(e,s),l=oe(oe(e,a),Ua(He(n,"float32")));return Ia(r,o,l)}}}},Lke={kernelName:Mp,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,oe(n,ot(Rt(1),n)))}}},zke={kernelName:Dp,gradFunc:e=>({x:()=>Pn(e)})},Bke={kernelName:Ap,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(Xb(He(n,"float32")),e)}}},Wke={kernelName:Rp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(aN(He(n,"float32")),e)}}},Uke={kernelName:Eg,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{begin:a,size:s}=n,o=r.shape,[l,c]=dV(r,a,s),d=[];for(let u=0;u<e.rank;u++)d.push([l[u],o[u]-l[u]-c[u]]);return{x:()=>jo(e,d)}}},Vke={kernelName:Op,outputsToSave:[!0],gradFunc:(e,t,n)=>{let[r]=t,{dim:a}=n,s=!0,o=oe(e,r);return{logits:()=>ot(o,oe(xt(o,[a],s),r))}}},Hke={kernelName:$p,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,Li(n))}}},Z3={kernelName:Ag,gradFunc:(e,t,n)=>{let{blockShape:r,paddings:a}=n;return{x:()=>Yb(e,r,a)}}},Q3={kernelName:Rg,gradFunc:(e,t,n)=>{let{axis:r}=n;return{x:()=>pr(e,r)}}},Gke={kernelName:Fp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,oe(Ta(He(n,"float32")),2))}}},qke={kernelName:Fb,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(e,oe(He(n,"float32"),2))}}},Kke={kernelName:Lp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=Rt(2);return{a:()=>oe(e,oe(a,ot(n,r))),b:()=>oe(e,oe(a,ot(r,n)))}}},Yke={kernelName:Tu,gradFunc:e=>({x:()=>Pn(e)})},Xke={kernelName:zp,inputsToSave:["a","b"],gradFunc:(e,t)=>{let[n,r]=t,a=mr(n.shape,r.shape);return{a:()=>{let s=e,o=ea(n.shape,a);return o.length>0&&(s=xt(s,o)),me(s,n.shape)},b:()=>{let s=e,o=ea(r.shape,a);return o.length>0&&(s=xt(s,o)),me(Cr(s),r.shape)}}}},Zke={kernelName:Pp,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,a=r.shape.slice(),{axis:s}=n;Hi(s,r.shape).forEach(c=>{a[c]=1});let o=me(e,a),l=oe(o,ys(r.shape,"float32"));return{x:()=>l}}},Qke={kernelName:Bp,inputsToSave:["x"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>pt(e,hr(Xb(n)))}}},Jke={kernelName:Wp,outputsToSave:[!0],gradFunc:(e,t)=>{let[n]=t;return{x:()=>oe(ot(Rt(1),hr(n)),e)}}},eSe={kernelName:Iu,inputsToSave:["x"],gradFunc:(e,t,n)=>{let[r]=t,{reps:a}=n;return{x:()=>{let s=Pn(r);if(r.rank===1)for(let o=0;o<a[0];++o)s=Re(s,En(e,[o*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let o=0;o<a[0];++o)for(let l=0;l<a[1];++l)s=Re(s,En(e,[o*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let o=0;o<a[0];++o)for(let l=0;l<a[1];++l)for(let c=0;c<a[2];++c)s=Re(s,En(e,[o*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let o=0;o<a[0];++o)for(let l=0;l<a[1];++l)for(let c=0;c<a[2];++c)for(let d=0;d<a[3];++d)s=Re(s,En(e,[o*r.shape[0],l*r.shape[1],c*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}},tSe={kernelName:Fl,gradFunc:(e,t,n)=>{let r=n,{perm:a}=r,s=cT(a);return{x:()=>hn(e,s)}}},nSe={kernelName:Og,gradFunc:(e,t,n)=>{let r=n,{axis:a}=r;return{value:()=>Jr(e,a)}}},rSe={kernelName:Wb,inputsToSave:["segmentIds"],gradFunc:(e,t)=>{let[n]=t;return{x:()=>aSe(e,n)}}};function aSe(e,t){let n=fl(t,Pn(t)),r=Hg(e,n),a=nc(t,Rt(0,"int32")),s=r.rank-a.rank;for(let l=0;l<s;++l)a=_a(a,l+1);a=Wi(a,ys(r.shape,"bool"));let o=Pn(r);return Ia(a,r,o)}var sSe={kernelName:Lg,gradFunc:e=>({x:()=>Pn(e)})},iSe=[gV,rNe,aNe,sNe,iNe,oNe,lNe,cNe,uNe,dNe,hNe,pNe,gNe,bNe,vNe,wNe,NNe,kNe,SNe,CNe,_Ne,jNe,TNe,INe,RNe,DNe,MNe,$Ne,FNe,PNe,jke,ONe,LNe,zNe,BNe,WNe,VNe,UNe,HNe,GNe,qNe,KNe,YNe,XNe,ZNe,QNe,JNe,eke,tke,ake,Y3,Y3,ske,lke,dke,hke,pke,mke,fke,gke,xke,yke,bke,vke,wke,X3,X3,Nke,kke,_ke,Ike,Tke,Eke,Ake,Rke,Dke,Mke,$ke,Fke,Pke,Oke,Lke,zke,Bke,Wke,Uke,Vke,Hke,Z3,Z3,Q3,Q3,Gke,Kke,qke,Yke,Xke,Zke,Qke,Jke,eSe,tSe,nSe,rSe,sSe];for(let e of iSe)aW(e);Me().prototype.abs=function(){return this.throwIfDisposed(),Xr(this)};Me().prototype.acos=function(){return this.throwIfDisposed(),FI(this)};Me().prototype.acosh=function(){return this.throwIfDisposed(),PI(this)};Me().prototype.add=function(e){return this.throwIfDisposed(),Re(this,e)};Me().prototype.all=function(e,t){return this.throwIfDisposed(),tN(this,e,t)};Me().prototype.any=function(e,t){return this.throwIfDisposed(),By(this,e,t)};Me().prototype.argMax=function(e){return this.throwIfDisposed(),lh(this,e)};Me().prototype.argMin=function(e){return this.throwIfDisposed(),OI(this,e)};Me().prototype.asScalar=function(){return this.throwIfDisposed(),Y(this.size===1,()=>"The array must have only 1 element."),me(this,[])};Me().prototype.asType=function(e){return this.throwIfDisposed(),He(this,e)};Me().prototype.as1D=function(){return this.throwIfDisposed(),me(this,[this.size])};Me().prototype.as2D=function(e,t){return this.throwIfDisposed(),me(this,[e,t])};Me().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),me(this,[e,t,n])};Me().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),me(this,[e,t,n,r])};Me().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),me(this,[e,t,n,r,a])};Me().prototype.asin=function(){return this.throwIfDisposed(),LI(this)};Me().prototype.asinh=function(){return this.throwIfDisposed(),zI(this)};Me().prototype.atan=function(){return this.throwIfDisposed(),BI(this)};Me().prototype.atan2=function(e){return this.throwIfDisposed(),WI(this,e)};Me().prototype.atanh=function(){return this.throwIfDisposed(),UI(this)};Me().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),tc(this,e,t,n,r)};Me().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Yb(this,e,t)};Me().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Up(this,e,t,n,r,a)};Me().prototype.broadcastTo=function(e){return this.throwIfDisposed(),Md(this,e)};Me().prototype.cast=function(e){return this.throwIfDisposed(),He(this,e)};Me().prototype.ceil=function(){return this.throwIfDisposed(),XI(this)};Me().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Wa(this,e,t)};Me().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof on&&(e=[e]),pr([this,...e],t)};Me().prototype.conv1d=function(e,t,n,r,a,s){return this.throwIfDisposed(),nN(this,e,t,n,r,a,s)};Me().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),rN(this,e,t,n,r,a)};Me().prototype.conv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Ja(this,e,t,n,r,a,s)};Me().prototype.cos=function(){return this.throwIfDisposed(),Xb(this)};Me().prototype.cosh=function(){return this.throwIfDisposed(),aN(this)};Me().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),Vy(this,e,t,n)};Me().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),sN(this,e,t,n)};Me().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),aT(this,e,t)};Me().prototype.depthwiseConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Vp(this,e,t,n,r,a,s)};Me().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),sT(this,e,t,n,r,a)};Me().prototype.divNoNan=function(e){return this.throwIfDisposed(),iT(this,e)};Me().prototype.div=function(e){return this.throwIfDisposed(),pt(this,e)};Me().prototype.dot=function(e){return this.throwIfDisposed(),oT(this,e)};Me().prototype.elu=function(){return this.throwIfDisposed(),Wg(this)};Me().prototype.equal=function(e){return this.throwIfDisposed(),qs(this,e)};Me().prototype.erf=function(){return this.throwIfDisposed(),iN(this)};Me().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),uT(this,e,t)};Me().prototype.exp=function(){return this.throwIfDisposed(),Ua(this)};Me().prototype.expandDims=function(e){return this.throwIfDisposed(),_a(this,e)};Me().prototype.expm1=function(){return this.throwIfDisposed(),dT(this)};Me().prototype.fft=function(){return this.throwIfDisposed(),iv(this)};Me().prototype.flatten=function(){return this.throwIfDisposed(),me(this,[this.size])};Me().prototype.floor=function(){return this.throwIfDisposed(),Vg(this)};Me().prototype.floorDiv=function(e){return this.throwIfDisposed(),eN(this,e)};Me().prototype.gather=function(e,t,n){return this.throwIfDisposed(),Hg(this,e,t,n)};Me().prototype.greaterEqual=function(e){return this.throwIfDisposed(),nc(this,e)};Me().prototype.greater=function(e){return this.throwIfDisposed(),as(this,e)};Me().prototype.ifft=function(){return this.throwIfDisposed(),bf(this)};Me().prototype.irfft=function(){return this.throwIfDisposed(),vN(this)};Me().prototype.isFinite=function(){return this.throwIfDisposed(),hT(this)};Me().prototype.isInf=function(){return this.throwIfDisposed(),pT(this)};Me().prototype.isNaN=function(){return this.throwIfDisposed(),mT(this)};Me().prototype.leakyRelu=function(e){return this.throwIfDisposed(),Qb(this,e)};Me().prototype.lessEqual=function(e){return this.throwIfDisposed(),Au(this,e)};Me().prototype.less=function(e){return this.throwIfDisposed(),ff(this,e)};Me().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),fT(this,e,t,n,r)};Me().prototype.logSigmoid=function(){return this.throwIfDisposed(),gT(this)};Me().prototype.logSoftmax=function(e){return this.throwIfDisposed(),cN(this,e)};Me().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),ev(this,e,t)};Me().prototype.log=function(){return this.throwIfDisposed(),Ks(this)};Me().prototype.log1p=function(){return this.throwIfDisposed(),Jb(this)};Me().prototype.logicalAnd=function(e){return this.throwIfDisposed(),Wi(this,e)};Me().prototype.logicalNot=function(){return this.throwIfDisposed(),tv(this)};Me().prototype.logicalOr=function(e){return this.throwIfDisposed(),uN(this,e)};Me().prototype.logicalXor=function(e){return this.throwIfDisposed(),xT(this,e)};Me().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),un(this,e,t,n)};Me().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),va(this,e,t,n,r)};Me().prototype.max=function(e,t){return this.throwIfDisposed(),di(this,e,t)};Me().prototype.maximum=function(e){return this.throwIfDisposed(),fl(this,e)};Me().prototype.mean=function(e,t){return this.throwIfDisposed(),$r(this,e,t)};Me().prototype.min=function(e,t){return this.throwIfDisposed(),mf(this,e,t)};Me().prototype.minimum=function(e){return this.throwIfDisposed(),hu(this,e)};Me().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),bT(this,e,t)};Me().prototype.mod=function(e){return this.throwIfDisposed(),vT(this,e)};Me().prototype.mul=function(e){return this.throwIfDisposed(),oe(this,e)};Me().prototype.neg=function(){return this.throwIfDisposed(),Cr(this)};Me().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Ug(this,e,t,n)};Me().prototype.notEqual=function(e){return this.throwIfDisposed(),dh(this,e)};Me().prototype.oneHot=function(e,t=1,n=0){return this.throwIfDisposed(),gf(this,e,t,n)};Me().prototype.onesLike=function(){return this.throwIfDisposed(),Ys(this)};Me().prototype.pad=function(e,t){return this.throwIfDisposed(),jo(this,e,t)};Me().prototype.pool=function(e,t,n,r,a,s){return this.throwIfDisposed(),wT(this,e,t,n,r,a,s)};Me().prototype.pow=function(e){return this.throwIfDisposed(),ll(this,e)};Me().prototype.prelu=function(e){return this.throwIfDisposed(),av(this,e)};Me().prototype.prod=function(e,t){return this.throwIfDisposed(),NT(this,e,t)};Me().prototype.reciprocal=function(){return this.throwIfDisposed(),jT(this)};Me().prototype.relu=function(){return this.throwIfDisposed(),ar(this)};Me().prototype.relu6=function(){return this.throwIfDisposed(),pN(this)};Me().prototype.reshapeAs=function(e){return this.throwIfDisposed(),me(this,e.shape)};Me().prototype.reshape=function(e){return this.throwIfDisposed(),me(this,e)};Me().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),OU(this,e,t,n)};Me().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),LU(this,e,t,n)};Me().prototype.reverse=function(e){return this.throwIfDisposed(),gi(this,e)};Me().prototype.rfft=function(){return this.throwIfDisposed(),ov(this)};Me().prototype.round=function(){return this.throwIfDisposed(),mN(this)};Me().prototype.rsqrt=function(){return this.throwIfDisposed(),fN(this)};Me().prototype.selu=function(){return this.throwIfDisposed(),gN(this)};Me().prototype.separableConv2d=function(e,t,n,r,a,s){return this.throwIfDisposed(),Gg(this,e,t,n,r,a,s)};Me().prototype.sigmoid=function(){return this.throwIfDisposed(),Li(this)};Me().prototype.sign=function(){return this.throwIfDisposed(),IT(this)};Me().prototype.sin=function(){return this.throwIfDisposed(),xN(this)};Me().prototype.sinh=function(){return this.throwIfDisposed(),yN(this)};Me().prototype.slice=function(e,t){return this.throwIfDisposed(),En(this,e,t)};Me().prototype.softmax=function(e){return this.throwIfDisposed(),Du(this,e)};Me().prototype.softplus=function(){return this.throwIfDisposed(),Hp(this)};Me().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),rv(this,e,t)};Me().prototype.split=function(e,t){return this.throwIfDisposed(),bs(this,e,t)};Me().prototype.sqrt=function(){return this.throwIfDisposed(),Ta(this)};Me().prototype.square=function(){return this.throwIfDisposed(),hr(this)};Me().prototype.squaredDifference=function(e){return this.throwIfDisposed(),wN(this,e)};Me().prototype.squeeze=function(e){return this.throwIfDisposed(),Mu(this,e)};Me().prototype.stack=function(e,t){this.throwIfDisposed();let n=e instanceof on?[this,e]:[this,...e];return Jr(n,t)};Me().prototype.step=function(e){return this.throwIfDisposed(),Gp(this,e)};Me().prototype.stridedSlice=function(e,t,n,r,a,s,o,l){return this.throwIfDisposed(),TT(this,e,t,n,r,a,s,o,l)};Me().prototype.sub=function(e){return this.throwIfDisposed(),ot(this,e)};Me().prototype.sum=function(e,t){return this.throwIfDisposed(),xt(this,e,t)};Me().prototype.tan=function(){return this.throwIfDisposed(),ET(this)};Me().prototype.tanh=function(){return this.throwIfDisposed(),du(this)};Me().prototype.tile=function(e){return this.throwIfDisposed(),Us(this,e)};Me().prototype.toBool=function(){return this.throwIfDisposed(),He(this,"bool")};Me().prototype.toFloat=function(){return this.throwIfDisposed(),He(this,"float32")};Me().prototype.toInt=function(){return this.throwIfDisposed(),He(this,"int32")};Me().prototype.topk=function(e,t){return this.throwIfDisposed(),RT(this,e,t)};Me().prototype.transpose=function(e){return this.throwIfDisposed(),hn(this,e)};Me().prototype.unique=function(e){return this.throwIfDisposed(),DT(this,e)};Me().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),_N(this,e,t)};Me().prototype.unstack=function(e){return this.throwIfDisposed(),Ur(this,e)};Me().prototype.where=function(e,t){return this.throwIfDisposed(),Ia(e,this,t)};Me().prototype.zerosLike=function(){return this.throwIfDisposed(),Pn(this)};var Nc=class yV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,yV.prototype)}},Yo=class bV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,bV.prototype)}},ye=class vV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vV.prototype)}},kn=class wV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,wV.prototype)}},oSe=class NV extends Error{constructor(t){super(t),Object.setPrototypeOf(this,NV.prototype)}},kV=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function ph(e,t){if(Array.isArray(e)){let n=[];for(let r=0;r<t;r++)n=n.concat(e);return n}else{let n=new Array(t);return n.fill(e),n}}function Uo(e,t){if(!e)throw new oSe(t)}function J3(e,t){let n=0;for(let r of e)r===t&&n++;return n}function fs(e){return e.length===1?e[0]:e}function rr(e){return Array.isArray(e)?e:[e]}function _l(e){let t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function ud(e){return e.length<=1||e.indexOf("_")===-1?e:e.replace(/[_]+(\w|$)/g,(t,n)=>n.toUpperCase())}var ki={};function QT(e){if(e==null)return null;let t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function qC(e){if(!(e==null||typeof e!="object"))if(Array.isArray(e))e.forEach(t=>qC(t));else{let t=Object.keys(e);for(let n of t){let r=e[n];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?e[n]=r.value:qC(r))}}}function cv(e,t={},n={},r="object",a=!1){if(typeof e=="string"){let s=e,o;if(s in n)o=n[s];else if(s in ki)o=ki[s];else if(o=t[s],o==null)throw new ye(`Unknown ${r}: ${e}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{let s=e;if(s.className==null||s.config==null)throw new ye(`${r}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let o=s.className,l,c;if(o in n?[l,c]=n[o]:o in ki?[l,c]=ki.className:o in t&&([l,c]=t[o]),l==null)throw new ye(`Unknown ${r}: ${o}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){let d={};for(let m of Object.keys(ki))d[m]=ki[m];for(let m of Object.keys(n))d[m]=n[m];let u=s.config;u.customObjects=d;let h=Object.assign({},ki);for(let m of Object.keys(n))ki[m]=n[m];qC(s.config);let p=c(l,s.config,n,a);return ki=Object.assign({},h),p}else{let d=Object.assign({},ki);for(let h of Object.keys(n))ki[h]=n[h];let u=new l(s.config);return ki=Object.assign({},d),u}}}function lSe(e,t){return e<t?-1:e>t?1:0}function Jv(e,t){return-1*lSe(e,t)}function Zc(e){if(e==null)return e;let t=[];for(let n of e)t.indexOf(n)===-1&&t.push(n);return t}function cSe(e){if(e==null)throw new ye(`Invalid value in obj: ${JSON.stringify(e)}`);for(let t in e)if(e.hasOwnProperty(t))return!1;return!0}function qp(e,t,n){if(n!=null&&e.indexOf(n)<0)throw new ye(`${n} is not a valid ${t}.  Valid values are ${e} or null/undefined.`)}function JT(e,t,n=0,r=1/0){return Uo(n>=0),Uo(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every(a=>typeof a===t)}function ja(e,t){Array.isArray(e)?(E.assert(e.length>0,()=>`${t} is unexpectedly an empty array.`),e.forEach((n,r)=>ja(n,`element ${r+1} of ${t}`))):E.assert(Number.isInteger(e)&&e>0,()=>`Expected ${t} to be a positive integer, but got ${SV(e)}.`)}function SV(e){return e===null?"null":Array.isArray(e)?"["+e.map(t=>SV(t)).join(",")+"]":typeof e=="string"?`"${e}"`:`${e}`}function uSe(e,t,n){let r=n!=null?n():E.now(),a;return(...s)=>{let o=n!=null?n():E.now();return o-r<t||(r=o,a=e(...s)),a}}function CV(e){return e==="relu"?"relu":e==="linear"?"linear":e==="elu"?"elu":null}var dSe=0;function _V(){return dSe++}var ew={};function DN(e=""){return e in ew||(ew[e]=0),ew[e]+=1,e+ew[e].toString()}var hSe=["channelsFirst","channelsLast"],pSe=["nearest","bilinear"],mSe=["valid","same","causal"],fSe=["max","avg"],gSe=["sum","mul","concat","ave"],cm=new Map;function qr(e){qp(hSe,"DataFormat",e)}function xSe(e){qp(pSe,"InterpolationFormat",e)}function xi(e){qp(mSe,"PaddingMode",e)}function jV(e){qp(fSe,"PoolMode",e)}var gy=[],eF="/";function $d(e,t){gy.push(e);try{let n=t();return gy.pop(),n}catch(n){throw gy.pop(),n}}function ySe(){return gy.length===0?"":gy.join(eF)+eF}function IV(e){if(!EV(e))throw new Error("Not a valid tensor name: '"+e+"'");return ySe()+e}function TV(e){if(!EV(e))throw new Error("Not a valid tensor name: '"+e+"'");cm.has(e)||cm.set(e,0);let t=cm.get(e);if(cm.set(e,cm.get(e)+1),t>0){let n=`${e}_${t}`;return cm.set(n,1),n}else return e}var bSe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function EV(e){return!!e.match(bSe)}function vSe(e){return e===parseInt(e.toString(),10)}function Qc(e,t,n){t==null&&(t=0),n==null&&(n=e.length);let r=1;for(let a=t;a<n;++a)r*=e[a];return r}function wf(e){if(e.length===0)return Number.NaN;let t=Number.POSITIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r<t&&(t=r)}return t}function mu(e){if(e.length===0)return Number.NaN;let t=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){let r=e[n];r>t&&(t=r)}return t}function No(e,t){if(t<e)throw new ye(`end (${t}) < begin (${e}) is forbidden.`);let n=[];for(let r=e;r<t;++r)n.push(r);return n}var HS;function ca(){return HS==null&&(HS=RI().epsilon()),HS}function ko(){return"channelsLast"}function Hl(e,t){return He(e,t)}function uv(e,t=-1){let n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),me(e,n)}function wSe(e,t){return fe(()=>{if(e.shape.length!==2)throw new ye(`repeat() expects a rank-2 tensor, but received a rank-${e.shape.length} tensor.`);let n=uv(e,1);return KC(n,[1,t,1])})}function NSe(e){let t=[Qc(e.shape)];return me(e,t)}function kSe(e){if(e.rank<=1)throw new ye(`batchFlatten requires a minimum rank of 2. Got rank: ${e.rank}.`);let t=[e.shape[0],Qc(e.shape,1)];return me(e,t)}function Fd(e,t,n){return fe(()=>{switch(e.rank){case 1:return sv(e,t,n);case 2:return bN(e,[t,0],[n,e.shape[1]]);case 3:return qg(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return yf(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return En(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return En(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new ye(`sliceAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}})}function GS(e,t,n){return fe(()=>{switch(e.rank){case 1:return sv(e,t,n);case 2:return bN(e,[0,t],[e.shape[0],n]);case 3:return qg(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return yf(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new ye(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function tw(e,t,n,r){return fe(()=>{switch(e.rank){case 1:return sv(e,t,n);case 2:switch(r){case 1:return Fd(e,t,n);case 2:return GS(e,t,n);default:throw new ye(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Fd(e,t,n);case 2:return qg(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return GS(e,t,n);default:throw new ye(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Fd(e,t,n);case 2:return yf(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return yf(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return GS(e,t,n);default:throw new ye(`The axis is not within the rank of the tensor ${r}`)}default:throw new ye(`sliceAlongLastAxis() received an unsupported tensor rank: ${e.rank}`)}})}function eE(e,t=-1){let n;return t<0&&(n=e[0].rank,n!==0?t=n:t=0),t===e[0].rank&&(t=-1),pr(e,t)}function tF(e,t){switch(e.rank){case 1:return ZI([e,t]);case 2:return QI([e,t],0);case 3:return JI([e,t],0);case 4:return eT([e,t],0);default:throw new ye(`concatAlongFirstAxis() received an unsupported tensor rank: ${e.rank}`)}}function KC(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new ye(`The length of input n (${t.length}) does not match the number of dimensions in input x (${e.rank})`);return Us(e,t)}function MN(e,t=0,n=1,r,a){return hN(e,t,n,r,a)}function tl(e,t,n,r){if(e.rank<2||t.rank<2)throw new kn(`dot requires both inputs to be rank >= 2 but got x shape = ${e.shape} and y shape = ${t.shape}`);if(t.rank>=3){let a=e.shape.slice(-1)[0],s=t.shape.slice(-2)[0];if(a!==s)throw new kn(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${e.shape} and  y shape = ${t.shape}`)}if(e.rank===2&&t.rank===2)return vf.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?YC(e.rank,r,ko()):null,activation:n});{let a=e.shape.slice(),s=a.pop();e=me(e,[-1,s]);let o=t.shape.slice(),l=o.pop(),c=o.pop(),d=[...o,l],u=Array.from({length:t.rank},(p,m)=>m===0?t.rank-2:m<=t.rank-2?m-1:m);t=me(hn(t,u),[c,-1]);let h=[...a,...d];return me(vf.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?YC(e.rank,r,ko()):null,activation:n}),h)}}function AV(e,t,n){return fe(()=>(Array.isArray(t)?t=er(t,"int32"):t=He(t,"int32"),Hg(e,t,n)))}function dv(e){return oe(e,e)}function YC(e,t,n){let r=t.shape;if(t.rank!==1&&t.rank!==e)throw new ye(`Unexpected bias dimensions: ${t.rank}; expected it to be 1 or ${e}`);if(e===5){if(n==="channelsFirst")return r.length===1?me(t,[1,r[0],1,1,1]):me(t,[1,r[3],r[0],r[1],r[2]]);if(n==="channelsLast")return r.length===1?me(t,[1,1,1,1,r[0]]):me(t,[1].concat(r))}else if(e===4){if(n==="channelsFirst")return r.length===1?me(t,[1,r[0],1,1]):me(t,[1,r[2],r[0],r[1]]);if(n==="channelsLast")return r.length===1?me(t,[1,1,1,r[0]]):me(t,[1].concat(r))}else if(e===3){if(n==="channelsFirst")return r.length===1?me(t,[1,r[0],1]):me(t,[1,r[1],r[0]]);if(n==="channelsLast")return r.length===1?me(t,[1,1,r[0]]):me(t,[1].concat(r))}else if(e<3)return t;throw new ye(`Unsupported input rank by biasAdd: ${t.rank}`)}function Io(e,t,n){return fe(()=>(n==null&&(n=ko()),qr(n),Re(e,YC(e.rank,t,n))))}function SSe(e,t=1){if(t!==1)throw new kn(`Support for alpha values other than 1 (${t}) is not implemented yet.`);return Wg(e)}function CSe(e){return fe(()=>pt(e,Re(Xr(e),1)))}function RV(e,t,n,r){return fe(()=>FT(e,t,n,r))}function _Se(e){return fe(()=>{let t=Re(.5,oe(.2,e));return Wa(t,0,1)})}function hv(e,t,n=!1){return n?e():t()}var jSe=["fanIn","fanOut","fanAvg"],ISe=["normal","uniform","truncatedNormal"];function TSe(e){qp(jSe,"FanMode",e)}function ESe(e){qp(ISe,"Distribution",e)}var Gi=class extends Oe.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},tE=class extends Gi{apply(e,t){return Fr(e,t)}};tE.className="Zeros";Oe.registerClass(tE);var $N=class extends Gi{apply(e,t){return ys(e,t)}};$N.className="Ones";Oe.registerClass($N);var nE=class extends Gi{constructor(e){if(super(),typeof e!="object")throw new ye(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new ye(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return fe(()=>oe(Rt(this.value),ys(e,t)))}getConfig(){return{value:this.value}}};nE.className="Constant";Oe.registerClass(nE);var rE=class extends Gi{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return Ru(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}};rE.className="RandomUniform";Oe.registerClass(rE);var aE=class extends Gi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new kn(`randomNormal does not support dType ${t}.`);return MN(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};aE.className="RandomNormal";Oe.registerClass(aE);var sE=class extends Gi{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new kn(`truncatedNormal does not support dType ${t}.`);return CN(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};sE.className="TruncatedNormal";Oe.registerClass(sE);var iE=class extends Gi{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return fe(()=>{if(e.length!==2||e[0]!==e[1])throw new ye("Identity matrix initializer can only be used for 2D square matrices.");return oe(this.gain,oN(e[0]))})}getConfig(){return{gain:this.gain}}};iE.className="Identity";Oe.registerClass(iE);function ASe(e,t="channelsLast"){let n,r;if(qr(t),e.length===2)n=e[0],r=e[1];else if([3,4,5].indexOf(e.length)!==-1){if(t==="channelsFirst"){let a=Qc(e,2);n=e[1]*a,r=e[0]*a}else if(t==="channelsLast"){let a=Qc(e,0,e.length-2);n=e[e.length-2]*a,r=e[e.length-1]*a}}else{let a=Qc(e);n=Math.sqrt(a),r=Math.sqrt(a)}return[n,r]}var Ss=class extends Gi{constructor(e){if(super(),e.scale<0)throw new ye(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,TSe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,ESe(this.distribution),this.seed=e.seed}apply(e,t){let n=ASe(e),r=n[0],a=n[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,r):this.mode==="fanOut"?s/=Math.max(1,a):s/=Math.max(1,(r+a)/2),this.distribution==="normal"){let o=Math.sqrt(s);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new kn(`${this.getClassName()} does not support dType ${t}.`);return CN(e,0,o,t,this.seed)}else{let o=Math.sqrt(3*s);return Ru(e,-o,o,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}};Ss.className="VarianceScaling";Oe.registerClass(Ss);var FN=class extends Ss{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};FN.className="GlorotUniform";Oe.registerClass(FN);var PN=class extends Ss{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};PN.className="GlorotNormal";Oe.registerClass(PN);var ON=class extends Ss{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};ON.className="HeNormal";Oe.registerClass(ON);var LN=class extends Ss{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};LN.className="HeUniform";Oe.registerClass(LN);var zN=class extends Ss{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};zN.className="LeCunNormal";Oe.registerClass(zN);var BN=class extends Ss{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Ss.className}};BN.className="LeCunUniform";Oe.registerClass(BN);var oE=class extends Gi{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return fe(()=>{if(e.length<2)throw new kn("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;let n=E.sizeFromShape(e.slice(0,-1)),r=e[e.length-1],a=n*r;a>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${a}) elements: Slowness may result.`);let s=[Math.max(r,n),Math.min(r,n)],o=MN(s,0,1,t,this.seed),l=zT.qr(o,!1),c=l[0],d=l[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return c=oe(c,d.sign()),n<r&&(c=c.transpose()),oe(Rt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}};oE.className="Orthogonal";Oe.registerClass(oE);var nF={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function rF(e,t={}){return cv(e,Oe.SerializationMap.getMap().classNameMap,t,"initializer")}function Pr(e){return QT(e)}function Rr(e){if(typeof e=="string"){let t=e in nF?nF[e]:e;if(t==="GlorotNormal")return new PN;if(t==="GlorotUniform")return new FN;if(t==="HeNormal")return new ON;if(t==="HeUniform")return new LN;if(t==="LeCunNormal")return new zN;if(t==="LeCunUniform")return new BN;{let n={};return n.className=t,n.config={},rF(n)}}else return e instanceof Gi?e:rF(e)}function XC(e){return Array.isArray(e)&&Array.isArray(e[0])}function B0(e){return e.length===0?[]:Array.isArray(e[0])?e:[e]}function Vt(e){let t;if(Array.isArray(e)){if(e.length!==1)throw new ye(`Expected Tensor length to be 1; got ${e.length}`);t=e[0]}else t=e;return t}function Vn(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(e.length===1)return e=e,e[0];throw new ye(`Expected exactly 1 Shape; got ${e.length}`)}else return e}function W0(e){let t=0;for(let n of e)n.shape.length===0?t+=1:t+=n.shape.reduce((r,a)=>r*a);return t}var aF="Variable",DV=class{constructor(e,t="float32",n=aF,r=!0,a=null){this.dtype=t??"float32",this.shape=e.shape,this.id=_V(),n=n??aF,this.originalName=IV(n),this.name=TV(this.originalName),this.trainable_=r,this.constraint=a,this.val=MT(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),RSe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function RSe(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}function ZC(e){return e.map(t=>t.read())}function lE(e){e.forEach(t=>{t[0].write(t[1])})}var Zr=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},So=class{constructor(e,t,n,r,a,s,o){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=r,this.callArgs=a,this.outputTensorIndex=o,this.id=_V(),s!=null&&(this.originalName=IV(s),this.name=TV(this.originalName)),this.rank=t.length}},DSe=0,WN=class{constructor(e,t){this.callArgs=t,this.id=DSe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n!=null&&n.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},MSe=0,Sn=class extends Oe.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=MSe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){let n=this.getClassName();t=_l(n)+"_"+DN(n)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let a=null;e.batchSize!=null&&(a=e.batchSize),n=[a].concat(e.inputShape)}this.batchInputShape=n;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new Yo(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new ye(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return fs(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return fs(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Nc(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Nc(`Layer ${this.name} is not connected, no input to return.`);return fs(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Nc(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Nc(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return fs(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){let t=rr(e);if(this.inputSpec==null||this.inputSpec.length===0)return;let n=rr(this.inputSpec);if(t.length!==n.length)throw new ye(`Layer ${this.name} expects ${n.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){let a=t[r],s=n[r];if(s==null)continue;let o=a.rank;if(s.ndim!=null&&o!==s.ndim)throw new ye(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${o}`);if(s.maxNDim!=null&&o>s.maxNDim)throw new ye(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${o}`);if(s.minNDim!=null&&o<s.minNDim)throw new ye(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${o}.`);if(s.dtype!=null&&a.dtype!==s.dtype)throw new ye(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${a.dtype}.`);if(s.axes){let l=a.shape;for(let c in s.axes){let d=Number(c),u=s.axes[c],h=d>=0?l[d]:l[l.length+d];if(u!=null&&[u,null].indexOf(h)===-1)throw new ye(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${u} but got shape ${l}.`)}}if(s.shape!=null)for(let l=0;l<s.shape.length;++l){let c=s.shape[l],d=a.shape[l];if(c!=null&&d!=null&&c!==d)throw new ye(`Input ${r} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${a.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();let n=rr(e),r=PSe(e),a=OSe(e);if(r===a)throw new ye("Arguments to apply() must be all SymbolicTensors or all Tensors");return $d(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let s=[];for(let o of rr(e))s.push(o.shape);this.build(fs(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&a&&(this._refCount=1)}if(this.assertInputCompatibility(e),a){let s=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,s);let o=rr(s),l=[];for(let c of o)n.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=fs(l),this.activityRegularizer!=null)throw new kn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=$Se(e),o=this.computeOutputShape(s),l,c=FSe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?s[0]:s),o!=null&&o.length>0&&Array.isArray(o[0])?l=o.map((d,u)=>new So(c,d,this,rr(e),t,this.name,u)):l=new So(c,o,this,rr(e),t,this.name),this.addInboundNode(e,l,null,null,s,o,t),this._refCount++,this.activityRegularizer!=null)throw new kn("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((n,r)=>{n!=null&&e[r]!=null&&e[r]!==n&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Nc(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let t of this.inboundNodes){let n=JSON.stringify(t.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new Nc(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Yo(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return W0(this.weights)}build(e){this.built=!0}getWeights(e=!1){return ZC(e?this.trainableWeights:this.weights)}setWeights(e){fe(()=>{let t=this.weights;if(t.length!==e.length)throw new ye(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;let n=[],r=ZC(t);for(let a=0;a<r.length;++a){let s=r[a],o=t[a],l=e[a];if(!E.arraysEqual(s.shape,l.shape))throw new ye(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);n.push([o,l])}lE(n)})}addWeight(e,t,n,r,a,s,o,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new ye(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Rr("zeros"));let c=r.apply(t,n),d=new DV(c,n,e,s,o);return c.dispose(),a!=null&&this.addLoss(()=>a.apply(d.read())),s==null&&(s=!0),s?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=rr(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,n){if(!this.supportsMasking)return;let r=this.computeMask(e,n),a=rr(t),s=rr(r);if(a.length!==s.length)throw new Error(`${this.name} outputs ${a.length} tensors but ${a.length} masks for those tensors`);for(let o=0;o<a.length;o++)a[o].kerasMask=s[o]}addInboundNode(e,t,n,r,a,s,o=null){let l=rr(e);t=rr(t),n=rr(n),r=rr(r),a=B0(a),s=B0(s);let c=[],d=[],u=[];for(let h of l)c.push(h.sourceLayer),d.push(h.nodeIndex),u.push(h.tensorIndex);new WN({outboundLayer:this,inboundLayers:c,nodeIndices:d,tensorIndices:u,inputTensors:l,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:s},o);for(let h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function $Se(e){e=rr(e);let t=[];for(let n of e)t.push(n.shape);return fs(t)}function FSe(e){return"float32"}function MV(e,t,n){if((t==null||n!=null&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),t.inboundNodes.length===0)return[e];{let r=t.inboundNodes[n];if(r.inboundLayers.length===0)return r.inputTensors;{let a=[];for(let s=0;s<r.inboundLayers.length;s++){let o=r.inputTensors[s],l=r.inboundLayers[s],c=r.nodeIndices[s],d=MV(o,l,c);for(let u of d)a.indexOf(u)===-1&&a.push(u)}return a}}}function PSe(e){let t=!0;for(let n of rr(e))if(!(n instanceof So)){t=!1;break}return t}function OSe(e){let t=!0;for(let n of rr(e))if(n instanceof So){t=!1;break}return t}var Yg=class extends Sn{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:DN("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new ye("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new ye("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new ye("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=t,this.dtype=n,this.inputSpec=[{shape:t}];let r=new So(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new WN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new ye(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}};Yg.className="InputLayer";Oe.registerClass(Yg);function $V(e){if(e.batchShape==null&&e.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(e.batchShape!=null&&e.shape!=null)throw new ye("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let t=e.batchShape;e.shape!=null&&t==null&&(t=[null].concat(e.shape));let n=e.dtype;return n==null&&(n="float32"),new Yg({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function LSe(e,t){if(e.dtype==null||e.dtype===t.dtype)return t;try{return He(t,e.dtype)}catch{throw new ye(`The dtype of the feed (${t.dtype}) can not be cast to the dtype of the key '${e.name}' (${e.dtype}).`)}}var Sm=class FV{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof FV)for(let n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(t==null)return;for(let n of t)this.add(n.key,n.value)}}add(t,n,r){if(this.id2Value[t.id]==null)this.id2Value[t.id]=LSe(t,n),this.name2Id[t.name]=t.id,r!=null&&(this.id2Mask[t.id]=r);else throw new ye(`Duplicate key: name=${t.name}, id=${t.id}`);return this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return this.id2Value[t.id]!=null}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof So){if(this.id2Value[t.id]==null)throw new ye(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}else{let n=this.name2Id[t];if(n==null)throw new ye(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[n]}}getMask(t){if(t instanceof So){if(this.id2Value[t.id]==null)throw new ye(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}else{let n=this.name2Id[t];if(n==null)throw new ye(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&tn(this.id2Mask)}},U0=new kV,V0=new kV;function zSe(e){U0!=null&&U0.setMaxEntries(e),V0!=null&&V0.setMaxEntries(e)}function Gx(e,t,n,r){let a=n==null?!1:n.training,s=Array.isArray(e),o=s?e:[e],l=o.map(f=>f.name),c=[],d=t.names();for(let f of l)d.indexOf(f)!==-1?c.push(t.getValue(f)):c.push(null);let u=l.join(",")+"|"+t.names().sort().join(","),h=U0.get(u),p;if(h==null){let f=BSe(o,t);h=f.sorted,p=f.recipientCounts,U0.put(u,h),V0.put(u,p)}p={},a||Object.assign(p,V0.get(u));let m=new Sm(t);for(let f=0;f<h.length;++f){let g=h[f],x=g.sourceLayer;if(x instanceof Yg)continue;let y=[],b=[],v=[],w=!1;for(let I of g.inputs){let T=m.getValue(I),A=m.getMask(I);y.push(T),b.push(A),A!=null&&(w=!0),a||(p[I.name]--,p[I.name]===0&&!t.hasKey(I)&&l.indexOf(I.name)===-1&&!T.isDisposed&&I.sourceLayer.stateful!==!0&&v.push(T))}w&&(n=n||{},n.mask=b[0]);let k=rr(x.apply(y,n)),C=null;x.supportsMasking&&(C=x.computeMask(y,b));let S=USe(g),_=Array.isArray(S)?S:[S];for(let I=0;I<_.length;++I){m.hasKey(_[I])||m.add(_[I],k[I],Array.isArray(C)?C[0]:C);let T=l.indexOf(_[I].name);T!==-1&&(c[T]=k[I])}a||tn(v)}return m.disposeMasks(),s?c:c[0]}function BSe(e,t){E.assert(e!=null&&e.length>0,()=>"Expected at least one fetch, got none");let n=[],r={};if(e.length===1){let a=sF(e[0],t);n=a.sorted,r=a.recipientMap}else{let a=new Set;for(let s of e){let{sorted:o,recipientMap:l}=sF(s,t);for(let c of o)a.has(c.name)||(n.push(c),a.add(c.name));for(let c in l)r[c]==null&&(r[c]=new Set),l[c].forEach(d=>r[c].add(d))}}return{sorted:n,recipientCounts:WSe(r)}}function WSe(e){let t={};for(let n in e)t[n]=e[n].size;return t}function sF(e,t){let n=new Set,r=[],a={};for(let l of t.names())n.add(l);let s=[],o=[];for(s.push(e);s.length>0;){let l=s[s.length-1];if(n.has(l.name)){s.pop();continue}let c=o[o.length-1]===s.length-1;if(l.inputs.length===0||c)s.pop(),r.push(l),n.add(l.name),c&&o.pop();else{o.push(s.length-1);for(let d of l.inputs)a[d.name]==null&&(a[d.name]=new Set),a[d.name].add(l.name),!n.has(d.name)&&s.push(d)}}return{sorted:r,recipientMap:a}}function USe(e){let t;if(e.sourceLayer.inboundNodes.length===1)t=e.sourceLayer.output;else{let n=null;for(let r=0;r<e.sourceLayer.inboundNodes.length;++r)for(let a of e.sourceLayer.inboundNodes[r].outputTensors)if(a.id===e.id){n=r;break}t=e.sourceLayer.getOutputAt(n)}return t}var VSe=_e();VSe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,zSe);var PV={};nn(PV,{maxNorm:()=>HSe,minMaxNorm:()=>KSe,nonNeg:()=>qSe,unitNorm:()=>GSe});function cE(e,t){return fe(()=>Ta(xt(oe(e,e),t,!0)))}var pv=class extends Oe.Serializable{getConfig(){return{}}},uE=class extends pv{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return fe(()=>{let t=cE(e,this.axis),n=Wa(t,0,this.maxValue);return oe(e,pt(n,Re(ca(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}};uE.className="MaxNorm";Oe.registerClass(uE);var dE=class extends pv{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return fe(()=>pt(e,Re(ca(),cE(e,this.axis))))}getConfig(){return{axis:this.axis}}};dE.className="UnitNorm";Oe.registerClass(dE);var hE=class extends pv{apply(e){return ar(e)}};hE.className="NonNeg";Oe.registerClass(hE);var pE=class extends pv{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return fe(()=>{let t=cE(e,this.axis),n=Re(oe(this.rate,Wa(t,this.minValue,this.maxValue)),oe(1-this.rate,t));return oe(e,pt(n,Re(ca(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}};pE.className="MinMaxNorm";Oe.registerClass(pE);var iF={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ha(e){return QT(e)}function oF(e,t={}){return cv(e,Oe.SerializationMap.getMap().classNameMap,t,"constraint")}function pa(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in iF?iF[e]:e,config:{}};return oF(t)}else return e instanceof pv?e:oF(e)}function HSe(e){return new uE(e)}function GSe(e){return new dE(e)}function qSe(){return new hE}function KSe(e){return new pE(e)}var OV={};nn(OV,{constant:()=>ZSe,glorotNormal:()=>a2e,glorotUniform:()=>r2e,heNormal:()=>s2e,heUniform:()=>i2e,identity:()=>t2e,leCunNormal:()=>o2e,leCunUniform:()=>l2e,ones:()=>XSe,orthogonal:()=>c2e,randomNormal:()=>JSe,randomUniform:()=>QSe,truncatedNormal:()=>e2e,varianceScaling:()=>n2e,zeros:()=>YSe});function YSe(){return new tE}function XSe(){return new $N}function ZSe(e){return new nE(e)}function QSe(e){return new rE(e)}function JSe(e){return new aE(e)}function e2e(e){return new sE(e)}function t2e(e){return new iE(e)}function n2e(e){return new Ss(e)}function r2e(e){return new FN(e)}function a2e(e){return new PN(e)}function s2e(e){return new ON(e)}function i2e(e){return new LN(e)}function o2e(e){return new zN(e)}function l2e(e){return new BN(e)}function c2e(e){return new oE(e)}var LV={};nn(LV,{Layer:()=>Sn,RNN:()=>sc,RNNCell:()=>fv,activation:()=>zCe,add:()=>YCe,alphaDropout:()=>R_e,average:()=>XCe,averagePooling1d:()=>CA,averagePooling2d:()=>_A,averagePooling3d:()=>jA,avgPool1d:()=>s_e,avgPool2d:()=>o_e,avgPool3d:()=>c_e,avgPooling1d:()=>i_e,avgPooling2d:()=>l_e,avgPooling3d:()=>u_e,batchNormalization:()=>n_e,bidirectional:()=>S_e,categoryEncoding:()=>P_e,centerCrop:()=>$_e,concatenate:()=>ZCe,conv1d:()=>ACe,conv2d:()=>RCe,conv2dTranspose:()=>DCe,conv3d:()=>MCe,conv3dTranspose:()=>$Ce,convLstm2d:()=>v_e,convLstm2dCell:()=>w_e,cropping2D:()=>PCe,dense:()=>BCe,depthwiseConv2d:()=>LCe,dot:()=>t_e,dropout:()=>WCe,elu:()=>CCe,embedding:()=>KCe,flatten:()=>VCe,gaussianDropout:()=>A_e,gaussianNoise:()=>E_e,globalAveragePooling1d:()=>d_e,globalAveragePooling2d:()=>h_e,globalMaxPool1d:()=>__e,globalMaxPool2d:()=>j_e,globalMaxPooling1d:()=>B8,globalMaxPooling2d:()=>W8,gru:()=>m_e,gruCell:()=>f_e,input:()=>r8,inputLayer:()=>SCe,layerNormalization:()=>r_e,leakyReLU:()=>jCe,lstm:()=>g_e,lstmCell:()=>x_e,masking:()=>D_e,maxPool1d:()=>I_e,maxPool2d:()=>T_e,maxPooling1d:()=>U8,maxPooling2d:()=>V8,maxPooling3d:()=>p_e,maximum:()=>QCe,minimum:()=>JCe,multiply:()=>e_e,permute:()=>qCe,prelu:()=>ICe,randomWidth:()=>O_e,reLU:()=>_Ce,repeatVector:()=>HCe,rescaling:()=>M_e,reshape:()=>GCe,resizing:()=>F_e,rnn:()=>N_e,separableConv2d:()=>FCe,simpleRNN:()=>y_e,simpleRNNCell:()=>b_e,softmax:()=>TCe,spatialDropout1d:()=>UCe,stackedRNNCells:()=>k_e,thresholdedReLU:()=>ECe,timeDistributed:()=>C_e,upSampling2d:()=>OCe,zeroPadding2d:()=>a_e});async function yc(e){if(e==null)return;let t=[],n=[],r=[];for(let a in e){let s=e[a];if(typeof s!="number"){let o=s;t.push(o.data()),n.push(a),r.push(o)}}if(t.length>0){let a=await Promise.all(t);for(let s=0;s<a.length;++s)e[n[s]]=a[s][0];tn(r)}}function zV(e){if(e!=null)for(let t in e){let n=e[t];typeof n!="number"&&n.dispose()}}var lF;(function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"})(lF||(lF={}));var u2e=125,Nf=class{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}},BV=class{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(let t of this.callbacks)t.setParams(e)}setModel(e){for(let t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(let n of this.callbacks)await n.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(let t of this.callbacks)await t.onTrainEnd(e)}},d2e=class extends Nf{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});let n=t.size==null?0:t.size;this.seen+=n;for(let r in t){let a=t[r];if(typeof a=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+a*n;else{let s;r in this.totals?s=this.totals[r]:this.totals[r]=0;let o=fe(()=>Re(this.totals[r],oe(a,n)));this.totals[r]=o,s!=null&&s.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?t[n]=this.totals[n]/this.seen:fe(()=>{let r=oe(pt(1,this.seen),this.totals[n]);t[n]=r,this.totals[n].dispose(),la(t[n])}))}},WV=class extends Nf{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(let n in t)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(t[n])}async syncData(){let e=[],t=[],n=[];for(let a in this.history){let s=this.history[a];for(let o=0;o<s.length;++o)if(typeof s[o]!="number"){let l=s[o];e.push(l.data()),t.push(a),n.push(o)}}let r=await Promise.all(e);for(let a=0;a<r.length;++a)this.history[t[a]][n[a]].dispose(),this.history[t[a]][n[a]]=r[a][0]}},UV=class extends Nf{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||XT,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=u2e),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");E.isNumber(this.yieldEvery)&&(this.maybeWait=uSe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,n){let r=[];this.yield!=null&&(await yc(n),r.push(this.yield(e,t,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await yc(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){let n=[];this.epochEnd!=null&&(await yc(t),n.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,t){this.batchBegin!=null&&(await yc(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){let n=[];this.batchEnd!=null&&(await yc(t),n.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):E.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await yc(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await yc(e),await this.trainEnd(e))}};function VV(e,t){return e==null&&(e={}),e instanceof Nf?[e]:Array.isArray(e)&&e[0]instanceof Nf?e:rr(e).map(n=>new UV(n,t))}var mE=class Mo{constructor(){}static registerCallbackConstructor(t,n){E.assert(t>=0&&Number.isInteger(t),()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`),Mo.checkForDuplicate(n),Mo.constructors[t]==null&&(Mo.constructors[t]=[]),Mo.constructors[t].push(n)}static checkForDuplicate(t){for(let n in Mo.constructors)Mo.constructors[+n].forEach(r=>{if(r===t)throw new ye("Duplicate callback constructor.")})}static clear(){Mo.constructors={}}static createCallbacks(t){let n=[];for(let r in Mo.constructors){let a=+r;t>=a&&n.push(...Mo.constructors[a])}return n.map(r=>new r)}};mE.constructors={};function HV(e,t,n,r,a,s,o,l,c){let d=new WV,u=[new d2e,...mE.createCallbacks(t)];e!=null&&u.push(...e),u.push(d);let h=new BV(u);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:s,batchSize:o,verbose:t,doValidation:l,metrics:c}),{callbackList:h,history:d}}function xo(e,t={},n=!1){return cv(e,Oe.SerializationMap.getMap().classNameMap,t,"layer",n)}function H0(e,t){return fe(()=>{e.dtype!=="float32"&&(e=He(e,"float32"));let n=xt(dv(e),t,!0),r=Gs(n.shape,ca()),a=Ta(fl(n,r));return pt(e,a)})}function Kp(e,t){return fe(()=>$r(dv(ot(t,e)),-1))}function UN(e,t){return fe(()=>$r(Xr(ot(t,e)),-1))}function Xg(e,t){return fe(()=>{let n=ot(e,t),r=Wa(Xr(e),ca(),Number.MAX_VALUE),a=Xr(pt(n,r));return oe(100,$r(a,-1))})}function h2e(e,t){return fe(()=>{let n=Wa(t,ca(),Number.MAX_VALUE),r=Ks(Re(1,n)),a=Wa(e,ca(),Number.MAX_VALUE),s=Ks(Re(1,a));return $r(dv(ot(r,s)),-1)})}function p2e(e,t){return fe(()=>{let n=fl(0,ot(1,oe(e,t)));return $r(dv(n),-1)})}function m2e(e,t){return fe(()=>{let n=fl(0,ot(1,oe(e,t)));return $r(n,-1)})}function f2e(e,t){return fe(()=>{let n=xt(oe(e,t),-1),r=di(oe(ot(1,e),t),-1);return fl(0,Re(1,ot(r,n)))})}function g2e(e,t){return fe(()=>{let n=Math.log(2),r=ot(t,e),a=ot(Re(r,Hp(oe(-2,r))),n);return $r(a,-1)})}function Hy(e,t,n=!1){return fe(()=>{if(n)t=Du(t);else{let r=xt(t,t.shape.length-1,!0);t=pt(t,r)}return t=Wa(t,ca(),1-ca()),Cr(xt(oe(He(e,"float32"),Ks(t)),t.shape.length-1))})}function G0(e,t,n=!1){return fe(()=>{let r=He(Vg(NSe(e)),"int32");t=Wa(t,ca(),1-ca());let a=t.shape,s=me(gf(r,a[a.length-1]),a);return Hy(s,t,n)})}function x2e(e,t){if(!E.arraysEqual(e.shape,t.shape))throw new ye(`logits and labels must have the same shape, but got shapes ${JSON.stringify(e.shape)} and ${JSON.stringify(t.shape)}`);return fe(()=>{let n=ar(t),r=Cr(Xr(t));return Re(ot(n,oe(t,e)),Jb(Ua(r)))})}function VN(e,t){return fe(()=>{let n;return n=Wa(t,ca(),1-ca()),n=Ks(pt(n,ot(1,n))),$r(x2e(e,n),-1)})}function y2e(e,t){return fe(()=>{let n=Wa(e,ca(),1),r=Wa(t,ca(),1);return xt(oe(e,Ks(pt(n,r))),-1)})}function b2e(e,t){return fe(()=>{let n=Ks(Re(ca(),t));return $r(ot(t,oe(e,n)),-1)})}function fE(e,t){return fe(()=>{let n=H0(e,-1),r=H0(t,-1),a=oe(n,r);return Cr(xt(a,-1))})}var q0={meanSquaredError:Kp,meanAbsoluteError:UN,meanAbsolutePercentageError:Xg,meanSquaredLogarithmicError:h2e,squaredHinge:p2e,hinge:m2e,categoricalHinge:f2e,logcosh:g2e,categoricalCrossentropy:Hy,sparseCategoricalCrossentropy:G0,binaryCrossentropy:VN,kullbackLeiblerDivergence:y2e,poisson:b2e,cosineProximity:fE};function qS(e){if(typeof e=="string"){if(e in q0)return q0[e];let t=`Unknown loss ${e}`;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t=`Unknown loss ${e}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new ye(t)}else return e}function gE(e,t){return fe(()=>{let n=oe(.5,Ys(t)),r=Hl(as(t,n),e.dtype);return $r(qs(e,r),-1)})}function xE(e,t){return fe(()=>Hl(qs(lh(e,-1),lh(t,-1)),"float32"))}function GV(e,t){return fe(()=>He(xt(Wi(qs(e,1),qs(t,1))),"float32"))}function v2e(e,t){return fe(()=>He(xt(Wi(qs(e,1),qs(t,0))),"float32"))}function w2e(e,t){return fe(()=>He(xt(Wi(qs(e,0),qs(t,1))),"float32"))}function qV(e,t){return fe(()=>{let n=GV(e,t),r=w2e(e,t),a=Re(n,r);return He(Ia(as(a,0),pt(n,a),0),"float32")})}function N2e(e,t){return fe(()=>{let n=GV(e,t),r=v2e(e,t),a=Re(n,r);return He(Ia(as(a,0),pt(n,a),0),"float32")})}function KV(e,t){return VN(e,t)}function YV(e,t){return e.rank===t.rank&&(e=Mu(e,[e.rank-1])),t=lh(t,-1),t.dtype!==e.dtype&&(t=He(t,e.dtype)),He(qs(e,t),"float32")}function k2e(e,t){return fe(()=>{let n=e.sub(t).square().sum(),r=e.sub(e.mean()).square().sum();return Rt(1).sub(n.div(r))})}var S2e=Kp,C2e=Kp,_2e=UN,j2e=UN,I2e=Xg,T2e=Xg,yE=Hy,E2e=fE,XV=G0,K0={binaryAccuracy:gE,categoricalAccuracy:xE,precision:qV,categoricalCrossentropy:yE,sparseCategoricalCrossentropy:XV,mse:S2e,MSE:C2e,mae:_2e,MAE:j2e,mape:I2e,MAPE:T2e,cosine:E2e};function A2e(e){if(typeof e=="string"&&e in K0)return K0[e];if(typeof e!="string"&&e!=null)return e;throw new ye(`Unknown metric ${e}`)}function nw(e){if(Uo(e!==null,`Unknown LossOrMetricFn ${e}`),typeof e=="string")return e;{let t;for(let n of Object.keys(q0))if(q0[n]===e){t=n;break}if(t!==void 0)return t;for(let n of Object.keys(K0))if(K0[n]===e){t=n;break}return t!==void 0?t:e.name}}function R2e(e){let t={Adagrad:()=>sd.adagrad(.01),Adadelta:()=>sd.adadelta(1,.95,ca()),Adam:()=>sd.adam(.001,.9,.999,ca()),Adamax:()=>sd.adamax(.002,.9,.999,ca(),0),RMSProp:()=>sd.rmsprop(.001,.9,0,ca()),SGD:()=>sd.sgd(.01)};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new ye(`Unknown Optimizer ${e}`)}function cF(e,t,n=!1){if(e==null||typeof e!="object"||Object.getPrototypeOf(e)!==Object.prototype||!QC(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){let r=JSON.stringify(e);r.length>1048576&&console.warn(`User-defined metadata of model "${t}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function QC(e){if(e===null)return!0;if(typeof e=="object")if(Object.getPrototypeOf(e)===Object.prototype){let t=Object.keys(e);for(let n of t)if(typeof n!="string"||!QC(e[n]))return!1;return!0}else if(Array.isArray(e)){for(let t of e)if(!QC(t))return!1;return!0}else return!1;else{let t=typeof e;return t==="string"||t==="number"||t==="boolean"}}function D2e(e,t,n,r=console.log){let a=$2e(e),s=["Layer (type)","Input Shape","Output shape","Param #"];a?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(t*u)));let o;if(!a){s.push("Receives inputs"),o=[];for(let u in e.nodesByDepth)o.push(...e.nodesByDepth[u])}r("_".repeat(t)),Y0(s,n,r),r("=".repeat(t));let l=e.layers;for(let u=0;u<l.length;++u)a?F2e(l[u],n,r):P2e(l[u],n,o,r),r((u===l.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();let c=M2e(e),d=W0(e.nonTrainableWeights);r(`Total params: ${c+d}`),r(`Trainable params: ${c}`),r(`Non-trainable params: ${d}`),r("_".repeat(t))}function M2e(e){let t;return e.collectedTrainableWeights!=null?t=W0(e.collectedTrainableWeights):t=W0(e.trainableWeights),t}function $2e(e){let t=!0,n=[],r=[];for(let a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(let a of n){if(a.length>1||a.length===1&&a[0].inboundLayers.length>1){t=!1;break}r.push(...a)}if(t)for(let a of e.layers){let s=!1;for(let o of a.inboundNodes)if(r.indexOf(o)!==-1)if(s){t=!1;break}else s=!0;if(!t)break}return t}function Y0(e,t,n=console.log){let r="";for(let a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=e[a],r=r.slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function F2e(e,t,n){let r,a;try{a=e.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{a="multiple"}try{r=JSON.stringify(e.outputShape)}catch{r="multiple"}let s=e.name,o=e.getClassName(),l=[`${s} (${o})`,a,r,e.countParams().toString()];Y0(l,t,n)}function P2e(e,t,n,r){let a,s;try{s=e.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{s="multiple"}try{a=JSON.stringify(e.outputShape)}catch{a="multiple"}let o=[];for(let h of e.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){let m=h.inboundLayers[p].name,f=h.nodeIndices[p],g=h.tensorIndices[p];o.push(`${m}[${f}][${g}]`)}let l=e.name,c=e.getClassName(),d=o.length===0?"":o[0],u=[`${l} (${c})`,s,a,e.countParams().toString(),d];Y0(u,t,r);for(let h=1;h<o.length;++h)Y0(["","","","",o[h]],t,r)}function ZV(e,t,n){return(e==="inboundNodes"||e==="outputLayers"||e==="inputLayers")&&t===0&&typeof n=="string"}function Gy(e,t){if(e===null)return null;if(typeof e=="string")return ud(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];ZV(t,a,s)?n.push(s):n.push(Gy(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r];if(r==="name"&&typeof a=="string")n[r]=a;else{let s=ud(r);n[s]=Gy(a,s)}}return n}}function JC(e,t){if(e==null)return null;if(typeof e=="string")return _l(e);if(typeof e=="number"||typeof e=="boolean")return e;if(e instanceof Array){let n=[],r=e.length;for(let a=0;a<r;++a){let s=e[a];ZV(t,a,s)?n.push(s):n.push(JC(s,t))}return n}else{let n={};for(let r of Object.keys(e)){let a=e[r],s=_l(r);(r==="name"||r==="className")&&typeof a=="string"?n[s]=a:n[s]=JC(a,r)}return n}}var bE="4.22.0",O2e=e=>{let t=Object.keys(e);if(t.length===0)return!1;let n=t[0].split("/");return!isNaN(parseInt(n[n.length-1],10))},L2e=class $o extends Sn{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,this.name==null){let b=this.getClassName().toLowerCase();this.name=DN(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Zc(this.inputs).length!==this.inputs.length)throw new ye(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);Zc(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let b of this.outputs){let v=b.sourceLayer,w=b.nodeIndex,k=b.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(k)}for(let b of this.inputs){let v=b.sourceLayer,w=b.nodeIndex,k=b.tensorIndex;Uo(w===0,"input layer has >1 nodes"),Uo(k===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(k)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){let v=this.inputLayers[b];if(!(v instanceof Yg))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${b} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(let b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);let n={},r={},a={},s={},o={},l=[],c=(b,v,w,k,C,S)=>{(k==null||C==null||S==null)&&(k=b.sourceLayer,C=b.nodeIndex,S=b.tensorIndex);let _=k.inboundNodes[C];if(w.indexOf(_)!==-1)throw new Yo(`The tensor ${b.name} at layer "${k.name}" is part of a cycle.`);if(v.indexOf(_)!==-1)return;this.containerNodes.add($o.nodeKey(k,C)),k.id in o||(o[k.id]=Object.keys(o).length),w.indexOf(_)===-1&&w.push(_);let I=_.inboundLayers.length;for(let T=0;T<I;T++){let A=_.inputTensors[T],j=_.inboundLayers[T],D=_.nodeIndices[T],F=_.tensorIndices[T];c(A,v,w,j,D,F)}for(v.push(_);w.indexOf(_)>=0;)w.splice(w.indexOf(_),1);l.push(_)},d=[],u=[];for(let b of this.outputs)c(b,d,u);let h=l.slice().reverse();for(let b of h){r[b.id]=b,b.id in n||(n[b.id]=0);let v=n[b.id],w=a[b.outboundLayer.id]==null?0:a[b.outboundLayer.id];v=Math.max(v,w),a[b.outboundLayer.id]=v,s[b.outboundLayer.id]=b.outboundLayer,n[b.id]=v;for(let k=0;k<b.inboundLayers.length;k++){let C=b.inboundLayers[k],S=b.nodeIndices[k],_=C.inboundNodes[S],I=n[_.id]==null?0:n[_.id];n[_.id]=Math.max(v+1,I),r[_.id]=_}}let p={};for(let b in n){let v=n[b];v in p||(p[v]=[]),p[v].push(r[b])}let m={};for(let b in a){let v=a[b];v in m||(m[v]=[]),m[v].push(s[b])}let f=Object.keys(m).map(b=>parseInt(b,10)).sort(Jv);this.layers=[];for(let b of f){let v=m[b];v.sort((w,k)=>{let C=o[w.id],S=o[k.id];return C<S?-1:C>S?1:0});for(let w of v)w instanceof $o&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=m,f=Object.keys(p).map(b=>parseInt(b,10)).sort(Jv);let g=this.inputs.slice(),x=[];for(let b of f)for(let v of p[b]){let w=v.outboundLayer;if(w!=null){for(let k of v.inputTensors)if(g.indexOf(k)===-1)throw new Yo(`Graph disconnected: cannot obtain value for tensor ${k} at layer "${w.name}". The following previous layers were accessed without issue: ${x}`);for(let k of v.outputTensors)g.push(k);x.push(w.name)}}this.nodesByDepth=p;let y=this.layers.map(b=>b.name);for(let b of y){let v=y.filter(w=>w===b).length;if(v!==1)throw new Yo(`The name "${b}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new WN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let t={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let n of this.layers)t.numDisposedVariables+=n.dispose().numDisposedVariables;for(let n of this.internalContainerRefs)t.numDisposedVariables+=n.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach(n=>{n._trainableWeights.forEach(r=>r.trainable=t)}),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new ye("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(let n of this.layers)t=t.concat(n.trainableWeights);return t}get nonTrainableWeights(){let t=[];for(let n of this.layers)t.push(...n.nonTrainableWeights);if(!this.trainable){let n=[];for(let r of this.layers)n.push(...r.trainableWeights);return n.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,n=!0){let r={},a=0,s=O2e(t);s&&this.parseWeights(t);for(let l of this.layers)for(let[c,d]of l.weights.entries()){let u=s?`${d.name.split("/").slice(0,-1).join("/")+"/"}${c}`:d.originalName;if(r[u]!=null)throw new ye(`Duplicate weight name: ${u}`);r[u]=d,a++}let o=[];for(let l in t){let c=l;if(r[l]==null){let d=l.split("/");c=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(r[c]!=null)o.push([r[c],t[l]]);else if(n)throw new ye(`Provided weight data has no target variable: ${l}`);delete r[c]}if(n){let l=[];for(let c in r)l.push(c);if(l.length>0)throw new ye(`${l.length} of ${a} weights are not set: ${l}`)}lE(o)}parseWeights(t){for(let n in Object.keys(t)){let r=n.split("/"),a=["vars","layer_checkpoint_dependencies"],s=r.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!a.includes(o)).join("/");s!==n&&(t[s]=t[n],delete t[n])}}updatedConfig(){let t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion=`tfjs-layers ${bE}`,n.backend="TensorFlow.js",n}toJSON(t,n=!0){let r=JC(this.updatedConfig());return n?JSON.stringify(r):r}call(t,n){return fe(()=>{t=rr(t);let r=new Sm;for(let a=0;a<this.inputs.length;++a)r.add(this.inputs[a],t[a]);return Gx(this.outputs,r,n)})}computeMask(t,n){return fe(()=>{t=rr(t);let r;return n==null?r=ph(null,t.length):r=rr(n),this.runInternalGraph(t,r)[1]})}computeOutputShape(t){let n=B0(t);if(n.length!==this.inputLayers.length)throw new ye(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let l=0;l<n.length;l++){let c=this.inputLayers[l],d=n[l],u=c.name+"_0_0";r[u]=d}let a=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Jv);if(a.length>1)for(let l of a){let c=this.nodesByDepth[l];for(let d of c){let u=d.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(u.id)!==-1)continue;let h=[];for(let g=0;g<d.inboundLayers.length;g++){let x=d.inboundLayers[g],y=d.nodeIndices[g],b=d.tensorIndices[g],v=`${x.name}_${y}_${b}`,w=r[v];h.push(w)}let p=u.computeOutputShape(fs(h)),m=B0(p),f=u.inboundNodes.indexOf(d);for(let g=0;g<m.length;g++){let x=`${u.name}_${f}_${g}`;r[x]=m[g]}}}let s=[],o=[];for(let l=0;l<this.outputLayers.length;l++){let c=this.outputLayers[l],d=this.outputLayersNodeIndices[l],u=this.outputLayersTensorIndices[l],h=`${c.name}_${d}_${u}`;o.push(h)}for(let l=0;l<o.length;l++){let c=o[l];Uo(c in r),s.push(r[c])}return fs(s)}runInternalGraph(t,n){n==null&&(n=ph(null,t.length));let r={};for(let c=0;c<this.inputs.length;++c){let d=this.inputs[c],u=t[c],h=n[c];r[d.id]=[u,h]}let a=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(Jv);for(let c of a){let d=this.nodesByDepth[c];for(let u of d){let h=u.outboundLayer,p=u.inputTensors,m=u.outputTensors,f=new Array;for(let g of p)g.id in r&&f.push(r[g.id]);if(f.length===p.length){let g={},x,y,b,v;if(u.callArgs!=null&&(g=u.callArgs),f.length===1){let[w,k]=f[0];g.mask==null&&(g.mask=k),b=rr(h.call(w,g)),v=rr(h.computeMask(w,k)),x=[w],y=[k]}else x=f.map(w=>w[0]),y=f.map(w=>w[1]),g.mask==null&&(g.mask=y),b=rr(h.call(x,g)),v=rr(h.computeMask(x,y));if(h.activityRegularizer)throw new kn("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<m.length;++w){let k=m[w],C=b[w],S=v[w];r[k.id]=[C,S]}}}}let s=[],o=[],l=[];for(let c of this.outputs){Uo(c.id in r,`Could not compute output ${c.name} : ${c.id}`);let[d,u]=r[c.id];l.push(d.shape),s.push(d),o.push(u)}return[s,o,l]}buildNodeConversionMap(t){let n={},r;for(let a of this.layers){r=a instanceof $o?1:0;for(let s=0;s<a.inboundNodes.length;s++){let o=$o.nodeKey(a,s);this.containerNodes.has(o)&&(n[o]=r,r+=1)}}return n}getLayer(t,n){if(n!=null)return this.findLayer(n);if(t==null)throw new ye("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);for(let r of this.layers)if(r.name===t)return r;throw new ye(`No such layer: ${t}`)}findLayer(t){if(this.layers.length<=t)throw new ye(`Was asked to retrieve layer at index ${t}, but model only has ${this.layers.length} layer(s).`);return this.layers[t]}calculateLosses(){return fe(()=>{let t=[];for(let n of this.layers)for(let r=0;r<n.inboundNodes.length;++r){let a=$o.nodeKey(n,r);this.containerNodes.has(a)&&t.push(...n.calculateLosses())}return t})}getConfig(){let t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[];for(let o of this.layers){let l=o.getClassName(),c=o.getConfig(),d=[];for(let h=0;h<o.inboundNodes.length;h++){let p=o.inboundNodes[h],m=$o.nodeKey(o,h),f={};if(this.containerNodes.has(m)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),f={}}if(p.inboundLayers.length>0){let g=[];for(let x=0;x<p.inboundLayers.length;x++){let y=p.inboundLayers[x],b=p.nodeIndices[x],v=p.tensorIndices[x],w=$o.nodeKey(y,b),k=n[w];k==null&&(k=0),g.push([y.name,k,v,f])}d.push(g)}}}let u={};u.name=o.name,u.className=l,u.config=c,u.inboundNodes=d,r.push(u)}t.layers=r;let a=[];for(let o=0;o<this.inputLayers.length;o++){let l=this.inputLayers[o],c=this.inputLayersNodeIndices[o],d=$o.nodeKey(l,c);if(!this.containerNodes.has(d))continue;let u=n[d];u==null&&(u=0);let h=this.inputLayersTensorIndices[o];a.push([l.name,u,h])}t.inputLayers=a;let s=[];for(let o=0;o<this.outputLayers.length;o++){let l=this.outputLayers[o],c=this.outputLayersNodeIndices[o],d=$o.nodeKey(l,c);if(!this.containerNodes.has(d))continue;let u=n[d];u==null&&(u=0);let h=this.outputLayersTensorIndices[o];s.push([l.name,u,h])}return t.outputLayers=s,t}static fromConfig(t,n,r={},a=!1){let s={},o={};function l(x,y){x.name in o?o[x.name].push(y):o[x.name]=[y]}function c(x,y){let b=[],v;for(let w of y){let k=w[0],C=w[1],S=w[2];if(v=w[3]==null?{}:w[3],!(k in s)){l(x,y);return}let _=s[k];if(_.inboundNodes.length<=C){l(x,y);return}let I=_.inboundNodes[C];b.push(I.outputTensors[S])}b.length>0&&x.apply(fs(b),v)}function d(x){let y=x.name,b=xo(x,n.customObjects!=null?n.customObjects:{});b.setFastWeightInitDuringBuild(a),s[y]=b,x.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new ye(`Corrupted configuration, expected array for nodeData: ${v}`);l(b,v)})}let u=n.name,h=n.layers;for(let x of h)d(x);for(;!cSe(o);)for(let x of h){let y=s[x.name];if(y.name in o){let b=o[y.name];delete o[y.name];for(let v of b)c(y,v)}}let p=[],m=[],f=n.inputLayers;for(let x of f){let y=x[0],b=x[1],v=x[2];Uo(y in s);let w=s[y].inboundNodes[b].outputTensors;p.push(w[v])}let g=n.outputLayers;for(let x of g){let y=x[0],b=x[1],v=x[2];Uo(y in s);let w=s[y].inboundNodes[b].outputTensors;m.push(w[v])}return new t({inputs:p,outputs:m,name:u})}get stateful(){if(this._stateful)throw new ye("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let t of this.layers)if(t.stateful)return!0;return!1}resetStates(){fe(()=>{this.layers.forEach(t=>{t.stateful&&t.resetStates()})})}};function z2e(e,t,n){let r=t.length;if(e==null||Array.isArray(e)&&e.length===0)return t.map(a=>null);if(r===1)return Array.isArray(e)&&e.length===1?e:typeof e=="object"&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error(`Provided ${n} is an array of ${e.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return e}else if(typeof e=="object"&&Object.keys(e).length>0&&typeof e[Object.keys(e)[0]]=="object"){let a=[];return t.forEach(s=>{s in e?a.push(e[s]):a.push(null)}),a}else throw new Error(`The model has multiple (${r}) outputs, so ${n} must be either an array with ${r} elements or an object with ${t} keys. Provided ${n} not understood: ${JSON.stringify(e)}`)}function QV(e,t){return z2e(e,t,"classWeight")}async function JV(e,t,n,r){if(n!=null){let a=fe(()=>{if(e.shape.length===1)return Jo(e);if(e.shape.length===2){if(e.shape[1]>1)return lh(e,1);if(e.shape[1]===1)return me(e,[e.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${e.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${e.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await a.data());tn(a);let o=[];return s.forEach(l=>{if(n[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);o.push(n[l])}),er(o,"float32")}else return null}function B2e(e,t){return oe(e,t)}var W2e=32;function e8(e,t){let n,r,a=t;n=a.xs,r=a.ys,E.assert(n!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${t}`);let s=uF("input",e.inputNames,n),o=uF("output",e.outputNames,r),l=s[0].shape[0];E.assert(s.length===e.inputs.length,()=>`LayersModel has ${e.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(e.inputNames)})`),E.assert(o.length===e.outputs.length,()=>`LayersModel has ${e.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(e.outputNames)})`);for(let c=0;c<s.length;c++)E.assert(s[c].shape[0]===l,()=>`Batch size mismatch: input ${e.inputNames[c]} has ${s[c].shape[0]}; expected  ${l} based on input ${e.inputNames[0]}.`);for(let c=0;c<o.length;c++)E.assert(o[c].shape[0]===l,()=>`Batch size mismatch: output ${e.outputNames[c]} has ${o[c].shape[0]}; expected  ${l} based on input ${e.inputNames[0]}.`);return{xs:s,ys:o}}function uF(e,t,n){if(n instanceof on)return[n];if(Array.isArray(n))return E.assert(n.length===t.length,()=>`Received an array of ${n.length} Tensors, but expected ${t.length} to match the ${e} keys ${t}.`),n;{let r=[];for(let a of t){if(n[a]==null)throw new ye(`The feature data generated by the dataset lacks the required ${e} key '${a}'.`);r.push(n[a])}return r}}function U2e(e){if(e.length===3)throw new kn("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}async function V2e(e,t,n){let r=n.batchesPerEpoch!=null;if(E.assert(e.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),E.assert(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),E.assert(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),E.assert(!r||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),E.assert(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),e.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");e.isTraining=!0;try{let a=n.validationData!=null,s,o;if(a)if(dF(n.validationData))E.assert(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{let x=U2e(n.validationData);s=x.xs,o=x.ys}let l=e.makeTrainFunction(),c=e.getDedupedMetricsNames(),d;a?d=c.slice().concat(c.map(x=>"val_"+x)):d=c.slice();let u=VV(n.callbacks,n.yieldEvery),h=n.verbose==null?1:n.verbose,{callbackList:p,history:m}=HV(u,h,n.epochs,null,null,H2e(t,n),null,a,d);p.setModel(e),e.history=m,await p.onTrainBegin(),e.stopTraining_=!1;let f=n.initialEpoch==null?0:n.initialEpoch,g=await t.iterator();for(;f<n.epochs;){let x={};await p.onEpochBegin(f);let y=0,b=0;for(r||(g=await t.iterator());!r||y<n.batchesPerEpoch;){let v=await g.next();if(r&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){let{xs:w,ys:k}=e8(e,v.value),C={};C.batch=b,C.size=w[0].shape[0],await p.onBatchBegin(b,C);let S=[];if(n.classWeight!=null){let T=QV(n.classWeight,e.outputNames);for(let A=0;A<T.length;++A)S.push(await JV(k[A],null,T[A]))}let _=w.concat(k).concat(S),I=l(_);tn(_);for(let T=0;T<c.length;++T){let A=c[T],j=I[T];C[A]=j,la(j)}await p.onBatchEnd(b,C),zV(C),b++,y++}if(r?y>=n.batchesPerEpoch:v.done){if(a){let w;dF(n.validationData)?w=rr(await e.evaluateDataset(n.validationData,{batches:n.validationBatches})):w=rr(e.evaluate(s,o,{batchSize:n.validationBatchSize==null?W2e:n.validationBatchSize,verbose:0}));for(let k=0;k<e.metricsNames.length;++k)x[`val_${e.metricsNames[k]}`]=w[k]}break}if(e.stopTraining_)break}if(await p.onEpochEnd(f,x),f++,e.stopTraining_)break}return await p.onTrainEnd(),await e.history.syncData(),e.history}finally{e.isTraining=!1}}function H2e(e,t){let n=null;return t.batchesPerEpoch!=null?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function dF(e){return typeof e.iterator=="function"}function G2e(e){return typeof e.next=="function"}async function q2e(e,t,n){n=n||{};let r=n.batches!=null,a=e.testFunction,s=[];if(n.verbose>0)throw new kn("Verbose mode is not implemented yet.");E.assert(!r||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);let o=G2e(t)?t:await t.iterator(),l=0,c=0;for(;!r||c<n.batches;){let d=await o.next();if(s=fe(()=>{if(d.value){let{xs:u,ys:h}=e8(e,d.value),p=u.concat(h),m=fe(()=>a(p));if(tn(p),c===0)for(let g=0;g<m.length;++g)s.push(Rt(0));let f=p[0].shape[0];for(let g=0;g<m.length;++g){let x=m[g],y=s[g];s[g]=fe(()=>Re(s[g],oe(f,x))),c>0&&tn(y)}tn(m),l+=f,++c}return s}),d.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let d=0;d<s.length;++d){let u=s[d];s[d]=pt(s[d],l),tn(u)}return fs(s)}function KS(e){E.assert(e>0&&Number.isInteger(e),()=>`batchSize is required to be a positive integer, but got ${e}`)}function Ix(e,t,n){return e==null?[null]:Array.isArray(e)?e.map(r=>Fd(r,t,n-t)):Fd(e,t,n-t)}function e_(e,t){return fe(()=>e==null?null:Array.isArray(e)?e.map(n=>e_(n,t)):AV(e,t.dtype==="int32"?t:He(t,"int32")))}function YS(e,t){let n=[],r=0,a=null;for(;r<e;)a=r+t,a>=e&&(a=e),n.push([r,a]),r=a;return n}function t8(e){let t=[];e instanceof on&&(e=[e]);for(let n=0;n<e.length;++n){let r=e[n];if(r.rank===1)t.push(uv(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function Ji(e,t){if(e==null)return;let n=[];if(t instanceof on)n.push(t.id);else if(Array.isArray(t))t.forEach(a=>n.push(a.id));else if(t!=null)for(let a in t){let s=t[a];n.push(s.id)}let r=[];if(e instanceof on)n.indexOf(e.id)===-1&&r.push(e);else if(Array.isArray(e))e.forEach(a=>{n.indexOf(a.id)===-1&&r.push(a)});else if(e!=null)for(let a in e){let s=e[a];n.indexOf(s.id)===-1&&r.push(s)}r.forEach(a=>{a.isDisposed||a.dispose()})}function K2e(e){return e instanceof on}function t_(e){return Array.isArray(e)}function hF(e){return!K2e(e)&&!t_(e)}function pF(e,t,n,r=!0,a=""){if(t==null||t.length===0){if(e!=null){let o=!1;if(t_(e)&&e.length>0)o=!0;else if(hF(e)){for(let l in e)if(e.hasOwnProperty(l)){o=!0;break}}else o=!0;if(o)throw new ye(`Error when checking model ${a} expected no data, but got ${e}`)}return[]}if(e==null)return t.map(o=>null);let s;if(hF(e)){e=e,s=[];for(let o of t){if(e[o]==null)throw new ye(`No data provided for "${o}". Need data for each key in: ${t}`);s.push(e[o])}}else if(t_(e)){if(e=e,e.length!==t.length)throw new ye(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${t.length} Tensor(s), but instead got the following list of Tensor(s): ${e}`);s=e}else{if(e=e,t.length>1)throw new ye(`The model ${a} expects ${t.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${e.shape}`);s=[e]}if(s=t8(s),n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;let l=s[o];if(l.shape.length!==n[o].length)throw new ye(`Error when checking ${a}: expected ${t[o]} to have ${n[o].length} dimension(s). but got array with shape ${l.shape}`);for(let c=0;c<n[o].length;++c){if(c===0&&!r)continue;let d=l.shape[c],u=n[o][c];if(u!=null&&u>=0&&d!==u)throw new ye(`${a} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${a} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return s}function Y2e(e,t,n){let r=Zc(e.map(s=>s.shape[0]));r.sort();let a=Zc(t.map(s=>s.shape[0]));if(a.sort(),r.length>1)throw new ye(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(a.length>1)throw new ye(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(r.length>0&&a.length>0&&!E.arraysEqual(r,a))throw new ye(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${a[0]} target sample(s).`)}function X2e(e,t,n){let r=[Kp,VN,Hy];for(let a=0;a<e.length;++a){let s=e[a],o=t[a],l=n[a];if(o!=null){if(o===Hy&&s.shape[s.shape.length-1]===1)throw new ye(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(o)!==-1){let c=s.shape.slice(1),d=l.slice(1);for(let u=0;u<c.length;++u){let h=c[u],p=d[u];if(p!=null&&h!==p)throw new ye(`A target Tensor with shape ${s.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function mF(e,t,n,r=!0,a=""){let s;if(Array.isArray(e)){if(e.length!==t.length)throw new ye(`Error when checking model ${a}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${t.length} Tensor(s), but instead got ${e.length} Tensors(s).`);s=e}else{if(t.length>1)throw new ye(`The model expects ${t.length} ${a} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(e.shape)}.`);s=[e]}if(n!=null)for(let o=0;o<t.length;++o){if(n[o]==null)continue;let l=s[o];if(l.shape.length!==n[o].length)throw new ye(`Error when checking ${a}: expected ${t[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let c=0;c<n[o].length;++c){if(c===0&&!r)continue;let d=l.shape[c],u=n[o][c];if(u!=null&&u!==d)throw new ye(`Error when checking ${a}: expected ${t[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function Z2e(e,t){if(e==null||Array.isArray(e)&&e.length===0)return t.map(r=>[]);let n;if(typeof e=="string"||typeof e=="function")n=[e];else if(Array.isArray(e)||typeof e=="object")n=e;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${e}`);if(Array.isArray(n))return t.map(r=>n);{let r=[];for(let a of t){let s=n.hasOwnProperty(a)?n[a]:[];Array.isArray(s)||(s=[s]),r.push(s)}return r}}var Q2e="layers-model",Pl=class extends L2e{constructor(e){super(e),this.isTraining=!1}summary(e,t,n=console.log){if(!this.built)throw new ye("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");D2e(this,e,t,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=R2e(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ac))throw new ye("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let s in e.loss)if(this.outputNames.indexOf(s)===-1)throw new ye(`Unknown entry in loss dictionary: "${s}". Only expected the following keys: ${this.outputNames}`);for(let s of this.outputNames)e.loss[s]==null&&console.warn(`Output "${s}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${s} during training`),t.push(qS(e.loss[s]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new ye(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(s=>qS(s))}else{let s=qS(e.loss);this.outputs.forEach(o=>{t.push(s)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let s=0;s<this.outputs.length;++s){let o=this.internalOutputShapes[s],l=this.outputNames[s];this.feedOutputNames.push(l),this.feedOutputShapes.push(o),this.feedLossFns.push(this.lossFunctions[s])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],$d("loss",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let o=this.lossFunctions[s];this.outputs.length>1&&(this.metricsTensors.push([o,s]),this.metricsNames.push(this.outputNames[s]+"_loss"))}});let r=Z2e(e.metrics,this.outputNames),a=(s,o,l)=>{this.outputNames.length>1&&(o=this.outputNames[s]+"_"+o),this.metricsNames.push(o),this.metricsTensors.push([l,s])};$d("metric",()=>{for(let s=0;s<this.outputs.length;++s){if(n.indexOf(s)!==-1)continue;let o=r[s];(l=>{let c="",d,u,h;for(let p of l){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){let f=this.internalOutputShapes[s];f[f.length-1]===1||this.lossFunctions[s]===VN?["accuracy","acc"].indexOf(p)!==-1?u=gE:["crossentropy","ce"].indexOf(p)!==-1&&(u=KV):this.lossFunctions[s]===G0?["accuracy","acc"].indexOf(p)!==-1?u=YV:["crossentropy","ce"].indexOf(p)!==-1&&(u=XV):["accuracy","acc"].indexOf(p)!==-1?u=xE:["crossentropy","ce"].indexOf(p)!==-1&&(u=yE);let g;["accuracy","acc"].indexOf(p)!==-1?g="acc":["crossentropy","ce"].indexOf(p)!==-1&&(g="ce"),h=u,d=c+g}else h=A2e(p),d=c+nw(p);let m;$d(d,()=>{m=h}),a(s,d,m)}})(o)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,n={}){let r=n.batchSize==null?32:n.batchSize;KS(r);let a=this.standardizeUserDataXY(e,t,!0,r);try{let s=a[0].concat(a[1]);this.makeTestFunction();let o=this.testFunction,l=this.testLoop(o,s,r,n.verbose,n.steps);return fs(l)}finally{Ji(a[0],e),Ji(a[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),q2e(this,e,t)}checkNumSamples(e,t,n,r="steps"){let a;if(n!=null){if(a=null,t!=null)throw new ye(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?a=e[0].shape[0]:a=e.shape[0];else throw new ye(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return a}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new ye("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),s=new Sm;if(e instanceof on&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new ye(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)s.add(this.inputs[l],e[l])}else for(let l of this.inputs){let c=e[l.name];if(c==null)throw new ye(`No value is provided for the model's input ${l.name}`);s.add(l,c)}let o=Gx(a,s);return n?o:o[0]}retrieveSymbolicTensors(e){let t=ph(null,e.length),n=e.length;for(let r of this.layers){let a=Array.isArray(r.output)?r.output:[r.output],s=a.map(o=>o.name);for(let o=0;o<e.length;++o){let l=s.indexOf(e[o]);if(l!==-1&&(t[o]=a[l],n--),n===0)break}if(n===0)break}if(n>0){let r=[];throw t.forEach((a,s)=>{a==null&&r.push(e[s])}),new ye(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,n=!1){return fe(()=>{let r=this.checkNumSamples(e);if(n)throw new kn("Verbose predictLoop() is not implemented yet.");let a=YS(r,t),s=this.outputs.map(o=>[]);for(let o=0;o<a.length;++o)fe(()=>{let l=a[o][0],c=a[o][1],d=Ix(e,l,c),u=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)u.push({key:this.inputs[p],value:d[p]});else u.push({key:this.inputs[0],value:d});let h=new Sm(u);return Gx(this.outputs,h)}).forEach((l,c)=>s[c].push(l));return fs(s.map(o=>pr(o,0)))})}predict(e,t={}){let n=t8(e);mF(n,this.inputNames,this.feedInputShapes,!1);try{let r=t.batchSize==null?32:t.batchSize;return KS(r),this.predictLoop(n,r)}finally{Ji(n,e)}}predictOnBatch(e){mF(e,this.inputNames,this.feedInputShapes,!0);let t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,n=!0,r){if(this.optimizer_==null)throw new Yo("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let a=[];for(let s=0;s<this.feedOutputShapes.length;++s){let o=this.feedOutputShapes[s];this.feedLossFns[s]===G0?a.push(o.slice(0,o.length-1).concat([1])):a.push(o)}if(e=pF(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=pF(t,this.feedOutputNames,a,!1,"target"),Y2e(e,t),X2e(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new ye(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,n,r,a=!0,s){let[o,l]=this.standardizeUserDataXY(e,t,a,s);if(n!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){let d=QV(r,this.outputNames);c=[];for(let u=0;u<d.length;++u)c.push(await JV(l[u],null,d[u]))}return[o,l,c]}testLoop(e,t,n,r=0,a){return fe(()=>{let s=this.checkNumSamples(t,n,a,"steps"),o=[];if(r>0)throw new kn("Verbose mode is not implemented yet.");if(a!=null)throw new kn("steps mode in testLoop() is not implemented yet");{let l=YS(s,n),c=er(No(0,s));for(let d=0;d<l.length;++d){let u=l[d][0],h=l[d][1],p=Fd(c,u,h-u),m=e_(t,p),f=e(m);if(d===0)for(let g=0;g<f.length;++g)o.push(Rt(0));for(let g=0;g<f.length;++g){let x=f[g];o[g]=Re(o[g],oe(h-u,x))}}for(let d=0;d<o.length;++d)o[d]=pt(o[d],s)}return o})}getDedupedMetricsNames(){let e=this.metricsNames,t=[];for(let n=0;n<e.length;++n){let r=e[n],a=r;if(J3(e,r)>1){let s=J3(e.slice(0,n),r);a+=`_${s}`}t.push(a)}return t}makeTrainFunction(){return e=>{let t=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),s=[],o=()=>{let c=[];for(let p=0;p<this.inputs.length;++p)c.push({key:this.inputs[p],value:n[p]});let d=new Sm(c),u=Gx(this.outputs,d,{training:!0}),h;for(let p=0;p<this.lossFunctions.length;++p){let m=this.lossFunctions[p],f=m(r[p],u[p]);a[p]!=null&&(f=B2e(f,a[p]));let g=$r(f);t.push(g),p===0?h=f:h=Re(h,f)}for(let p=0;p<this.metricsTensors.length;++p){let m;if(this.outputs.length>1&&p<this.outputs.length)m=t[p];else{let f=this.metricsTensors[p][0],g=this.metricsTensors[p][1];m=$r(f(r[g],u[g]))}la(m),s.push(m)}return h=$r(h),this.calculateLosses().forEach(p=>{h=Re(h,p)}),h},l=this.collectedTrainableWeights.map(c=>c.read());return[this.optimizer_.minimize(o,!0,l)].concat(s)}}makeTestFunction(){this.testFunction=e=>fe(()=>{let t=[],n,r=e.slice(0,this.inputs.length),a=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=[];for(let c=0;c<this.inputs.length;++c)s.push({key:this.inputs[c],value:r[c]});let o=new Sm(s),l=Gx(this.outputs,o);for(let c=0;c<this.lossFunctions.length;++c){let d=this.lossFunctions[c],u=$r(d(a[c],l[c]));c===0?n=u:n=Re(n,u),t.push(n)}for(let c=0;c<this.metricsTensors.length;++c){let d=this.metricsTensors[c][0],u=this.metricsTensors[c][1],h=$r(d(a[u],l[u]));t.push(h)}return t})}async fit(e,t,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,a,s,o,l,c,d,u,h;try{let p=n.batchSize==null?32:n.batchSize;KS(p);let m=await this.standardizeUserData(e,t,n.sampleWeight,n.classWeight,!1,p);r=m[0],a=m[1],h=m[2];let f=!1,g;if(n.validationData!=null&&n.validationData.length>0){if(f=!0,n.validationData.length===2)l=n.validationData[0],c=n.validationData[1];else throw n.validationData.length===3?new kn("validationData including sample weights is not supported yet."):new ye(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let C=await this.standardizeUserData(l,c,null,null,!0,p);d=C[0],u=C[1],g=d.concat(u)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){f=!0;let C=Math.floor(r[0].shape[0]*(1-n.validationSplit)),S=r[0].shape[0];d=Ix(r,C,S),s=r,r=Ix(r,0,C),u=Ix(a,C,S),o=a,a=Ix(a,0,C),g=d.concat(u)}else n.validationSteps!=null&&(f=!0);let x=r.concat(a).concat(h);this.checkTrainableWeightsConsistency();let y=this.makeTrainFunction(),b=this.getDedupedMetricsNames(),v,w;f?(this.makeTestFunction(),v=this.testFunction,w=b.slice().concat(b.map(C=>"val_"+C))):(v=null,g=[],w=b.slice());let k=VV(n.callbacks,n.yieldEvery);return await this.fitLoop(y,x,b,p,n.epochs,n.verbose,k,v,g,n.shuffle,w,n.initialEpoch,null,null)}finally{this.isTraining=!1,Ji(r,e),Ji(a,t),Ji(s,e),Ji(o,t),Ji(d,l),Ji(u,c),h!=null&&tn(h)}}async fitLoop(e,t,n,r,a,s,o,l,c,d,u,h,p,m){r==null&&(r=32),a==null&&(a=1),d==null&&(d=!0),h==null&&(h=0);let f=!1;if(l!=null&&c!=null&&(f=!0),m!=null&&(f=!0,p==null))throw new ye("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=this.checkNumSamples(t,r,p,"steps_per_epoch"),x;g!=null&&(x=No(0,g)),s==null&&(s=1);let{callbackList:y,history:b}=HV(o,s,a,h,g,p,r,f,u);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<a;++v){await y.onEpochBegin(v);let w={};if(p!=null)throw new kn("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new kn("batch shuffling is not implemneted yet");d&&E.shuffle(x);let k=er(x),C=YS(g,r);for(let S=0;S<C.length;++S){let _={};if(await y.onBatchBegin(S,_),fe(()=>{let I=C[S][0],T=C[S][1],A=Fd(k,I,T-I);_.batch=S,_.size=T-I;let j=e_(t,A),D=e(j);for(let F=0;F<n.length;++F){let B=n[F],q=D[F];_[B]=q,la(q)}if(S===C.length-1&&f){let F=this.testLoop(l,c,r);for(let B=0;B<n.length;++B){let q=n[B],$=F[B];la($),w["val_"+q]=$}}}),await y.onBatchEnd(S,_),zV(_),this.stopTraining_)break}k.dispose()}if(await y.onEpochEnd(v,w),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return V2e(this,e,t)}async trainOnBatch(e,t){let n=await this.standardizeUserData(e,t),r=n[0],a=n[1],s=this.makeTrainFunction()(r.concat(a)),o=[];for(let l of s){let c=await l.data();o.push(c[0])}return tn(s),Ji(n[0],e),Ji(n[1],t),fs(o)}getNamedWeights(e){let t=[],n=e!=null&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n);for(let s=0;s<r.length;++s)n&&!r[s].trainable||t.push({name:r[s].originalName,tensor:a[s]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let t=FC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-FC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=_l(this.loss);else if(Array.isArray(this.loss)){for(let t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>_l(t))}else{let t=Object.keys(this.loss);e={};let n=this.loss;for(let r of t)if(typeof n[r]=="string")e[r]=_l(n[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[_l(nw(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>_l(nw(e)));{let e={};for(let t in this.metrics)e[t]=_l(nw(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let t=Gy(e.optimizer_config),n=xo(t),r;if(typeof e.loss=="string")r=ud(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(s=>ud(s));else if(e.loss!=null){r={};for(let s in e.loss)r[s]=ud(e.loss[s])}let a;if(Array.isArray(e.metrics))a=e.metrics.map(s=>ud(s));else if(e.metrics!=null){a={};for(let s in e.metrics)a[s]=ud(e.metrics[s])}this.compile({loss:r,metrics:a,optimizer:n})}async save(e,t){if(typeof e=="string"){let a=Fa.getSaveHandlers(e);if(a.length===0)throw new ye(`Cannot find any save handlers for URL '${e}'`);if(a.length>1)throw new ye(`Found more than one (${a.length}) save handlers for URL '${e}'`);e=a[0]}if(e.save==null)throw new ye("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await Fa.encodeWeights(this.getNamedWeights(t)),r={modelTopology:this.toJSON(null,!1),format:Q2e,generatedBy:`TensorFlow.js tfjs-layers v${bE}`,convertedBy:null};if(t!=null&&t.includeOptimizer&&this.optimizer!=null){r.trainingConfig=this.getTrainingConfig();let a="optimizer",{data:s,specs:o}=await Fa.encodeWeights(await this.optimizer.getWeights(),a);n.specs.push(...o),n.data=Fa.concatenateArrayBuffers([n.data,s])}return this.userDefinedMetadata!=null&&(cF(this.userDefinedMetadata,this.name,!0),r.userDefinedMetadata=this.userDefinedMetadata),r.weightData=n.data,r.weightSpecs=n.specs,e.save(r)}setUserDefinedMetadata(e){cF(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}};Pl.className="Model";Oe.registerClass(Pl);var n8=class extends Pl{};n8.className="Functional";Oe.registerClass(n8);async function J2e(e,t){"modelTopology"in e||(e={modelTopology:e}),e=e;let n=e.modelTopology;n.model_config!=null&&(n=n.model_config);let r=Gy(n),a=xo(r,t);if(e.weightsManifest!=null){let s=await Fa.loadWeights(e.weightsManifest,e.pathPrefix,a.weights.map(l=>l.originalName)),o={};for(let l of a.weights)o[l.originalName]=s[l.originalName];a.loadWeights(o),tn(s)}return a}async function eCe(e,t){if(t==null&&(t={}),typeof e=="string"){let n=Fa.getLoadHandlers(e,t);if(n.length===0)n.push(Fa.browserHTTPRequest(e,t));else if(n.length>1)throw new ye(`Found more than one (${n.length}) load handlers for URL '${e}'`);e=n[0]}return tCe(e,void 0,t)}async function tCe(e,t,n){if(n==null&&(n={}),e.load==null)throw new ye("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await e.load(),a=r.modelTopology;a.model_config!=null&&(a=a.model_config);let s=n.strict==null?!0:n.strict,o=r.weightData!=null&&r.weightSpecs!=null&&s,l=xo(Gy(a),t,o),c=r.trainingConfig;if(c!=null&&l.loadTrainingConfig(c),r.userDefinedMetadata!=null&&l.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new ye("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:d,optimizerWeights:u}=nCe(r.weightData,r.weightSpecs);l.loadWeights(d,s),l.optimizer!=null&&u.length>0&&await l.optimizer.setWeights(u),tn(d),tn(u.map(h=>h.tensor))}return l}function nCe(e,t){let n=Fa.decodeWeights(e,t),r={},a=[];return t.forEach(s=>{s.group==="optimizer"?a.push({name:s.name,tensor:n[s.name]}):r[s.name]=n[s.name]}),{modelWeights:r,optimizerWeights:a}}var HN=class n_ extends Pl{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=t.name!=null?t.name:DN("sequential_"),t.layers!=null)for(let n of t.layers)this.add(n)}checkShape(t){if(t.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new ye(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){let n=t instanceof n_||t instanceof Pl,r;if(n){if(r=t,r.outputs.length!==1)throw new ye("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(r.inputs.length!==1)throw new ye("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new ye("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let a=$V({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(a)}if(n)this.outputs=r.outputs,this.inputs=r.inputs;else{if(t.inboundNodes.length!==1)throw new ye(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(t.inboundNodes[0].outputTensors.length!==1)throw new ye("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=MV(this.outputs[0])}this.inboundNodes=[],new WN({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ph(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(a=>a.shape),outputShapes:this.outputs[0].shape})}else{let a=t.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,n){return this.model==null&&this.build(),this.model.call(t,n)}build(t){if(Vn(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Pl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,n,r=console.log){this.built||this.build(),super.summary(t,n,r)}setWeights(t){this.model==null&&this.build(),this.model.setWeights(t)}evaluate(t,n,r={}){if(!this.built)throw new Yo("The model needs to be compiled before being used.");return this.model.evaluate(t,n,r)}async evaluateDataset(t,n){if(!this.built)throw new Yo("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,n)}predict(t,n={}){return this.model==null&&this.build(),this.model.predict(t,n)}predictOnBatch(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,n,r={}){if(!this.built)throw new Yo("The model needs to be compiled before being used.");return this.model.fit(t,n,r)}async fitDataset(t,n){if(!this.built)throw new Yo("The model needs to be compiled before being used.");return this.model.fitDataset(t,n)}async trainOnBatch(t,n){return this.model.trainOnBatch(t,n)}static fromConfig(t,n,r={},a=!1){let s,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new ye("Legacy serialization format not supported yet.");s=n}else E.assert(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=n.layers,delete n.layers,o=n;let l=new t(o);if(!(l instanceof n_))throw new kn(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=xo(c,void 0,a);a&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(t){if(this.model==null)throw new ye("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(this.model==null)throw new ye("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let t=[];for(let n of this.layers){let r={};r.className=n.getClassName(),r.config=n.getConfig(),t.push(r)}return{name:this.name,layers:t}}};HN.className="Sequential";Oe.registerClass(HN);function rCe(e){return new Pl(e)}function aCe(e){return new HN(e)}function r8(e){return $V(e)}function sCe(e,t){mE.registerCallbackConstructor(e,t)}var Va=class extends Oe.Serializable{getConfig(){return{}}},a8=class extends Va{apply(e,t=1){return SSe(e,t)}};a8.className="elu";Oe.registerClass(a8);var s8=class extends Va{apply(e){return gN(e)}};s8.className="selu";Oe.registerClass(s8);var i8=class extends Va{apply(e){return ar(e)}};i8.className="relu";Oe.registerClass(i8);var o8=class extends Va{apply(e){return fe(()=>hu(6,ar(e)))}};o8.className="relu6";Oe.registerClass(o8);var l8=class extends Va{apply(e){return e}};l8.className="linear";Oe.registerClass(l8);var c8=class extends Va{apply(e){return Li(e)}};c8.className="sigmoid";Oe.registerClass(c8);var u8=class extends Va{apply(e){return _Se(e)}};u8.className="hardSigmoid";Oe.registerClass(u8);var d8=class extends Va{apply(e){return Hp(e)}};d8.className="softplus";Oe.registerClass(d8);var h8=class extends Va{apply(e){return CSe(e)}};h8.className="softsign";Oe.registerClass(h8);var p8=class extends Va{apply(e){return du(e)}};p8.className="tanh";Oe.registerClass(p8);var vE=class extends Va{apply(e,t=-1){return Du(e,t)}};vE.className="softmax";Oe.registerClass(vE);var m8=class extends Va{apply(e,t=-1){return cN(e,t)}};m8.className="logSoftmax";Oe.registerClass(m8);var f8=class extends Va{apply(e){return fe(()=>fe(()=>{let t=Math.sqrt(2),n=oe(.5,Re(1,iN(pt(e,t))));return oe(e,n)}))}};f8.className="gelu";Oe.registerClass(f8);var g8=class extends Va{apply(e){return fe(()=>oe(.5,oe(e,Re(1,du(oe(Ta(pt(2,Math.PI)),Re(e,oe(.044715,ll(e,3)))))))))}};g8.className="gelu_new";Oe.registerClass(g8);var x8=class extends Va{apply(e){return fe(()=>oe(e,du(Hp(e))))}};x8.className="mish";Oe.registerClass(x8);var y8=class extends Va{apply(e,t=1){return fe(()=>oe(Li(oe(e,t)),e))}};y8.className="swish";Oe.registerClass(y8);function fu(e){return e.getClassName()}function XS(e,t={}){return cv(e,Oe.SerializationMap.getMap().classNameMap,t,"activation")}function gu(e){if(e==null){let t={};return t.className="linear",t.config={},XS(t)}if(typeof e=="string"){let t={};return t.className=e,t.config={},XS(t)}else return e instanceof Va?e:XS(e)}function wE(e){if(e!=null&&typeof e!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${e}`)}var b8=class extends Oe.Serializable{},mv=class extends b8{constructor(e){super(),wE(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return fe(()=>{let t=Fr([1]);return this.hasL1&&(t=Re(t,xt(oe(this.l1,Xr(e))))),this.hasL2&&(t=Re(t,xt(oe(this.l2,dv(e))))),me(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}};mv.className="L1L2";Oe.registerClass(mv);function iCe(e){return wE(e),new mv({l1:e!=null?e.l1:null,l2:0})}function oCe(e){return wE(e),new mv({l2:e!=null?e.l2:null,l1:0})}var fF={l1l2:"L1L2"};function yr(e){return QT(e)}function gF(e,t={}){return cv(e,Oe.SerializationMap.getMap().classNameMap,t,"regularizer")}function Dr(e){if(e==null)return null;if(typeof e=="string"){let t={className:e in fF?fF[e]:e,config:{}};return gF(t)}else return e instanceof b8?e:gF(e)}var NE=class extends Sn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=Vt(e);let n=ar(e);return this.maxValue!=null&&(n=Wa(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}};NE.className="ReLU";Oe.registerClass(NE);var kE=class extends Sn{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=Vt(e);return Qb(n,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};kE.className="LeakyReLU";Oe.registerClass(kE);var SE=class extends Sn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Rr(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Dr(e.alphaRegularizer),this.alphaConstraint=pa(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new ye(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Vn(e);let t=e.slice(1);if(this.sharedAxes!=null)for(let r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new Zr({ndim:e.length,axes:n})],this.built=!0}call(e,t){return e=Vt(e),av(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Pr(this.alphaInitializer),alphaRegularizer:yr(this.alphaRegularizer),alphaConstraint:ha(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}};SE.className="PReLU";Oe.registerClass(SE);var CE=class extends Sn{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new kn(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){let n=Vt(e);return Wg(n)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};CE.className="ELU";Oe.registerClass(CE);var _E=class extends Sn{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){let n=Vt(e);return oe(n,He(as(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}};_E.className="ThresholdedReLU";Oe.registerClass(_E);var jE=class extends Sn{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new vE().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return fe(()=>{let n=Vt(e),r=t.mask;if(r!=null){let a=oe(ot(ys(n.shape),He(r,n.dtype)),Rt(-1e9));n=Re(n,a)}return this.axis instanceof Array?this.axis.length>1?Ua(ot(n,ev(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};jE.className="Softmax";Oe.registerClass(jE);function Fm(e,t,n){if(typeof e=="number")return ph(e,t);if(e.length!==t)throw new ye(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${e.length} elements.`);for(let r=0;r<t;++r){let a=e[r];if(!vSe(a))throw new ye(`The ${n} argument must be an integer or tuple of ${t} integers. Received: ${JSON.stringify(e)} including a non-integer number ${a}`)}return e}function yo(e,t,n,r,a=1){if(e==null)return e;let s=t+(t-1)*(a-1),o;return n==="same"?o=e:o=e-s+1,Math.floor((o+r-1)/r)}function Vo(e,t,n,r){if(e==null)return null;if(r==="valid")e=e*t+mu([n-t,0]);else if(r==="same")e=e*t;else throw new ye(`Unsupport padding mode: ${r}.`);return e}function IE(e,t){return fe(()=>(qr(t),t==="channelsFirst"?hn(e,[0,2,3,1]):e))}function v8(e,t){return fe(()=>(qr(t),t==="channelsFirst"?hn(e,[0,2,3,4,1]):e))}function lCe(e,t,n,r=1,a="valid",s,o=1){return fe(()=>{if(s==null&&(s=ko()),qr(s),e.shape.length!==3)throw new ye(`The input of a conv1dWithBias operation should be 3, but is ${e.shape.length} instead.`);if(t.shape.length!==3)throw new ye(`The kernel for a conv1dWithBias operation should be 3, but is ${t.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new ye(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(s==="channelsFirst"&&(e=hn(e,[0,2,1])),a==="causal")throw new kn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=nN(e,t,r,a==="same"?"same":"valid","NWC",o);return n!=null&&(l=Io(l,n)),l})}function xF(e,t,n,r=[1,1],a="valid",s,o,l=null){return fe(()=>{if(s==null&&(s=ko()),qr(s),e.rank!==3&&e.rank!==4)throw new ye(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${e.rank}.`);if(t.rank!==3&&t.rank!==4)throw new ye(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${e.rank}.`);let c=IE(e,s);if(a==="causal")throw new kn("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=vf.conv2d({x:c,filter:t,strides:r,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:l}),s==="channelsFirst"&&(c=hn(c,[0,3,1,2])),c})}function cCe(e,t,n,r=[1,1,1],a="valid",s,o){return fe(()=>{if(s==null&&(s=ko()),qr(s),e.rank!==4&&e.rank!==5)throw new ye(`conv3dWithBias expects input to be of rank 4 or 5, but received ${e.rank}.`);if(t.rank!==4&&t.rank!==5)throw new ye(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${e.rank}.`);let l=v8(e,s);if(a==="causal")throw new kn("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=nT(l,t,r,a==="same"?"same":"valid","NDHWC",o),n!=null&&(l=Io(l,n)),s==="channelsFirst"&&(l=hn(l,[0,4,1,2,3])),l})}var w8=class N8 extends Sn{constructor(t,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",N8.verifyArgs(n),this.rank=t,ja(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new kn(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Fm(n.kernelSize,t,"kernelSize"),this.strides=Fm(n.strides==null?1:n.strides,t,"strides"),this.padding=n.padding==null?"valid":n.padding,xi(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,qr(this.dataFormat),this.activation=gu(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Rr(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=pa(n.biasConstraint),this.biasRegularizer=Dr(n.biasRegularizer),this.activityRegularizer=Dr(n.activityRegularizer),this.dilationRate=Fm(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new ye(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new ye(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new ye(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(t){if(Uo("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!JT(t.kernelSize,"number",1,3))throw new ye(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){let t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fu(this.activation),useBias:this.useBias,biasInitializer:Pr(this.biasInitializer),biasRegularizer:yr(this.biasRegularizer),activityRegularizer:yr(this.activityRegularizer),biasConstraint:ha(this.biasConstraint)},n=super.getConfig();return Object.assign(t,n),t}},GN=class k8 extends w8{constructor(t,n){super(t,n),this.kernel=null,k8.verifyArgs(n),this.filters=n.filters,ja(this.filters,"filters"),this.kernelInitializer=Rr(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=pa(n.kernelConstraint),this.kernelRegularizer=Dr(n.kernelRegularizer)}build(t){t=Vn(t);let n=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[n]==null)throw new ye(`The channel dimension of the input should be defined. Found ${t[n]}`);let r=t[n],a=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:r}}],this.built=!0}call(t,n){return fe(()=>{t=Vt(t);let r,a=this.bias==null?null:this.bias.read(),s=CV(this.activation.getClassName());if(s!=null&&this.rank===2)r=xF(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)r=lCe(t,this.kernel.read(),a,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=xF(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=cCe(t,this.kernel.read(),a,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new kn("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(t){t=Vn(t);let n=[],r=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2);for(let s=0;s<r.length;++s){let o=yo(r[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);n.push(o)}let a=[t[0]];return this.dataFormat==="channelsLast"?(a=a.concat(n),a.push(this.filters)):(a.push(this.filters),a=a.concat(n)),a}getConfig(){let t={filters:this.filters,kernelInitializer:Pr(this.kernelInitializer),kernelRegularizer:yr(this.kernelRegularizer),kernelConstraint:ha(this.kernelConstraint)},n=super.getConfig();return Object.assign(t,n),t}static verifyArgs(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new ye(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}},qN=class S8 extends GN{constructor(t){super(2,t),S8.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!JT(t.kernelSize,"number",1,2))throw new ye(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}};qN.className="Conv2D";Oe.registerClass(qN);var KN=class C8 extends GN{constructor(t){super(3,t),C8.verifyArgs(t)}getConfig(){let t=super.getConfig();return delete t.rank,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new ye(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}};KN.className="Conv3D";Oe.registerClass(KN);var TE=class extends qN{constructor(e){if(super(e),this.inputSpec=[new Zr({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new ye(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vn(e),e.length!==4)throw new ye("Input should have rank 4; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ye("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Zr({ndim:4,axes:{[t]:n}})],this.built=!0}call(e,t){return fe(()=>{let n=Vt(e);if(n.shape.length!==4)throw new ye(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,o;this.dataFormat==="channelsFirst"?(s=2,o=3):(s=1,o=2);let l=r[s],c=r[o],d=this.kernelSize[0],u=this.kernelSize[1],h=this.strides[0],p=this.strides[1],m=Vo(l,h,d,this.padding),f=Vo(c,p,u,this.padding),g=[a,m,f,this.filters];this.dataFormat!=="channelsLast"&&(n=hn(n,[0,2,3,1]));let x=rN(n,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=hn(x,[0,3,1,2])),this.bias!=null&&(x=Io(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=Vn(e);let t=e.slice(),n,r,a;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3):(n=3,r=1,a=2);let s=this.kernelSize[0],o=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return t[n]=this.filters,t[r]=Vo(t[r],l,s,this.padding),t[a]=Vo(t[a],c,o,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};TE.className="Conv2DTranspose";Oe.registerClass(TE);var EE=class extends KN{constructor(e){if(super(e),this.inputSpec=[new Zr({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new ye(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Vn(e),e.length!==5)throw new ye("Input should have rank 5; Received input shape: "+JSON.stringify(e));let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new ye("The channel dimension of the inputs should be defined. Found `None`.");let n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Zr({ndim:5,axes:{[t]:n}})],this.built=!0}call(e,t){return fe(()=>{let n=Vt(e);if(n.shape.length!==5)throw new ye(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let r=n.shape,a=r[0],s,o,l;this.dataFormat==="channelsFirst"?(l=2,s=3,o=4):(l=1,s=2,o=3);let c=r[l],d=r[s],u=r[o],h=this.kernelSize[0],p=this.kernelSize[1],m=this.kernelSize[2],f=this.strides[0],g=this.strides[1],x=this.strides[2],y=Vo(c,f,h,this.padding),b=Vo(d,g,p,this.padding),v=Vo(u,x,m,this.padding),w=[a,y,b,v,this.filters];this.dataFormat!=="channelsLast"&&(n=hn(n,[0,2,3,4,1]));let k=rT(n,this.kernel.read(),w,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=hn(k,[0,4,1,2,3])),this.bias!==null&&(k=Io(k,this.bias.read(),this.dataFormat)),this.activation!==null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=Vn(e);let t=e.slice(),n,r,a,s;this.dataFormat==="channelsFirst"?(n=1,r=2,a=3,s=4):(n=4,r=1,a=2,s=3);let o=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],d=this.strides[0],u=this.strides[1],h=this.strides[2];return t[n]=this.filters,t[r]=Vo(t[r],d,o,this.padding),t[a]=Vo(t[a],u,l,this.padding),t[s]=Vo(t[s],h,c,this.padding),t}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};EE.className="Conv3DTranspose";Oe.registerClass(EE);var _8=class extends GN{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new ye("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new ye("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new ye(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=Rr(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Dr(t.depthwiseRegularizer),this.depthwiseConstraint=pa(t.depthwiseConstraint),this.pointwiseInitializer=Rr(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Dr(t.pointwiseRegularizer),this.pointwiseConstraint=pa(t.pointwiseConstraint)}build(e){if(e=Vn(e),e.length<this.rank+2)throw new ye(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new ye(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);let n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[];for(let o=0;o<this.rank;++o)a.push(1);a.push(n*this.depthMultiplier,this.filters);let s=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,s,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,s,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,s,this.biasConstraint):this.bias=null,this.inputSpec=[new Zr({ndim:this.rank+2,axes:{[t]:n}})],this.built=!0}call(e,t){return fe(()=>{e=Vt(e);let n;if(this.rank===1)throw new kn("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=hn(e,[0,2,3,1])),n=Gg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=Io(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=hn(n,[0,3,1,2])),n})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Pr(this.depthwiseInitializer),e.pointwiseInitializer=Pr(this.pointwiseInitializer),e.depthwiseRegularizer=yr(this.depthwiseRegularizer),e.pointwiseRegularizer=yr(this.pointwiseRegularizer),e.depthwiseConstraint=ha(this.depthwiseConstraint),e.pointwiseConstraint=ha(this.pointwiseConstraint),e}};_8.className="SeparableConv";var AE=class extends _8{constructor(e){super(2,e)}};AE.className="SeparableConv2D";Oe.registerClass(AE);var RE=class j8 extends GN{constructor(t){super(1,t),j8.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){let t=super.getConfig();return delete t.rank,delete t.dataFormat,t}static verifyArgs(t){if(typeof t.kernelSize!="number"&&!JT(t.kernelSize,"number",1,1))throw new ye(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}};RE.className="Conv1D";Oe.registerClass(RE);var DE=class extends Sn{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return fe(()=>{if(e=Vt(e),this.dataFormat==="channelsLast"){let n=tw(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return tw(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let n=tw(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return tw(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};DE.className="Cropping2D";Oe.registerClass(DE);var ME=class extends Sn{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qr(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,xSe(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let t=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,n]}else{let t=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],t,n,e[3]]}}call(e,t){return fe(()=>{let n=Vt(e),r=n.shape;if(this.dataFormat==="channelsFirst"){n=hn(n,[0,2,3,1]);let a=this.size[0]*r[2],s=this.size[1]*r[3],o=this.interpolation==="nearest"?ii.resizeNearestNeighbor(n,[a,s]):ii.resizeBilinear(n,[a,s]);return hn(o,[0,3,1,2])}else{let a=this.size[0]*r[1],s=this.size[1]*r[2];return this.interpolation==="nearest"?ii.resizeNearestNeighbor(n,[a,s]):ii.resizeBilinear(n,[a,s])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}};ME.className="UpSampling2D";Oe.registerClass(ME);function uCe(e,t,n=[1,1],r="valid",a,s){return fe(()=>{a==null&&(a=ko()),qr(a);let o=IE(e,a);if(e.rank!==4)throw new ye(`Input for depthwiseConv2d is required to be 4-D, but is instead ${e.rank}-D`);if(t.rank!==4)throw new ye(`depthwiseKernel is required to be 4-D, but is instead ${t.rank}-D`);return o=Vp(o,t,n,r==="same"?"same":"valid","NHWC",s),a==="channelsFirst"&&(o=hn(o,[0,3,1,2])),o})}var $E=class extends w8{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Rr(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=pa(e.depthwiseConstraint),this.depthwiseRegularizer=Dr(e.depthwiseRegularizer)}build(e){if(e=Vn(e),e.length<4)throw new ye(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new ye(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);let n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return fe(()=>{e=Vt(e);let n=uCe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=Io(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=Vn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=yo(t,this.kernelSize[0],this.padding,this.strides[0]),s=yo(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,a,s]:[e[0],a,s,r]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Pr(this.depthwiseInitializer),e.depthwiseRegularizer=yr(this.depthwiseRegularizer),e.depthwiseConstraint=ha(this.depthwiseRegularizer),e}};$E.className="DepthwiseConv2D";Oe.registerClass($E);function I8(e,t,n,r){if(Array.isArray(e)){if(t!=null||n!=null)throw new ye("When inputs is an array, neither initialState or constants should be provided");r!=null&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(s){return s==null||Array.isArray(s)?s:[s]}return t=a(t),n=a(n),{inputs:e,initialState:t,constants:n}}function T8(e,t,n,r=!1,a,s,o=!1,l=!1){return fe(()=>{let c=t.shape.length;if(c<3)throw new ye(`Input should be at least 3D, but is ${c}D.`);let d=[1,0].concat(No(2,c));t=hn(t,d),s!=null,o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=He(He(a,"bool"),"float32"),a.rank===c-1&&(a=_a(a,-1)),a=hn(a,d)),r&&(t=gi(t,0),a!=null&&(a=gi(a,0)));let u=[],h,p=n,m=t.shape[0],f=Ur(t),g;a!=null&&(g=Ur(a));for(let y=0;y<m;++y){let b=f[y],v=fe(()=>e(b,p));if(a==null)h=v[0],p=v[1];else{let w=fe(()=>{let k=g[y],C=ot(Ys(k),k),S=Re(oe(v[0],k),oe(p[0],C)),_=p.map((I,T)=>Re(oe(v[1][T],k),oe(I,C)));return{output:S,newStates:_}});h=w.output,p=w.newStates}l&&u.push(h)}let x;return l&&(x=Jr(u,1)),[h,x,p]})}var sc=class E8 extends Sn{constructor(t){super(t);let n;if(t.cell==null)throw new ye("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?n=new ZN({cells:t.cell}):n=t.cell,n.stateSize==null)throw new ye("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=t.returnSequences==null?!1:t.returnSequences,this.returnState=t.returnState==null?!1:t.returnState,this.goBackwards=t.goBackwards==null?!1:t.goBackwards,this._stateful=t.stateful==null?!1:t.stateful,this.unroll=t.unroll==null?!1:t.unroll,this.supportsMasking=!0,this.inputSpec=[new Zr({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return No(0,t).map(n=>null)}else return this.states_}setStates(t){this.states_=t}computeOutputShape(t){XC(t)&&(t=t[0]),t=t;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);let r=n[0],a;if(this.returnSequences?a=[t[0],t[1],r]:a=[t[0],r],this.returnState){let s=[];for(let o of n)s.push([t[0],o]);return[a].concat(s)}else return a}computeMask(t,n){return fe(()=>{Array.isArray(n)&&(n=n[0]);let r=this.returnSequences?n:null;if(this.returnState){let a=this.states.map(s=>null);return[r].concat(a)}else return r})}get states(){if(this.states_==null){let t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let r=0;r<t;++r)n.push(null);return n}else return this.states_}set states(t){this.states_=t}build(t){if(this.numConstants!=null)throw new kn("Constants support is not implemented in RNN yet.");XC(t)&&(t=t[0]),t=t;let n=this.stateful?t[0]:null,r=t.slice(2);this.inputSpec[0]=new Zr({shape:[n,null,...r]});let a=[t[0]].concat(t.slice(2));this.cell.build(a);let s;if(Array.isArray(this.cell.stateSize)?s=this.cell.stateSize:s=[this.cell.stateSize],this.stateSpec!=null){if(!E.arraysEqual(this.stateSpec.map(o=>o.shape[o.shape.length-1]),s))throw new ye(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=s.map(o=>new Zr({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(t,n=!1){fe(()=>{if(!this.stateful)throw new Nc("Cannot call resetStates() on an RNN Layer that is not stateful.");let r=this.inputSpec[0].shape[0];if(r==null)throw new ye("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Fr([r,a])):this.states_=[Fr([r,this.cell.stateSize])];else if(t==null)tn(this.states_),this.keptStates!=null&&(tn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(a=>Fr([r,a])):this.states_[0]=Fr([r,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new ye(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);n===!0?this.keptStates.push(this.states_.slice()):tn(this.states_);for(let a=0;a<this.states_.length;++a){let s=t[a],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[a]:this.cell.stateSize,l=[r,o];if(!E.arraysEqual(s.shape,l))throw new ye(`State ${a} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[a]=s}}this.states_=this.states_.map(a=>la(a.clone()))})}apply(t,n){let r=n==null?null:n.initialState,a=n==null?null:n.constants;n==null&&(n={});let s=I8(t,r,a,this.numConstants);t=s.inputs,r=s.initialState,a=s.constants;let o=[],l=[];if(r!=null){n.initialState=r,o=o.concat(r),this.stateSpec=[];for(let c of r)this.stateSpec.push(new Zr({shape:c.shape}));l=l.concat(this.stateSpec)}if(a!=null&&(n.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof So){let c=[t].concat(o),d=this.inputSpec.concat(l),u=this.inputSpec;this.inputSpec=d;let h=super.apply(c,n);return this.inputSpec=u,h}else return super.apply(t,n)}call(t,n){return fe(()=>{let r=n==null?null:n.mask,a=n==null?null:n.training,s=n==null?null:n.initialState;t=Vt(t),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(t));let o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==o)throw new ye(`RNN Layer has ${o} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:a},c=T8((m,f)=>{let g=this.cell.call([m].concat(f),l);return[g[0],g.slice(1)]},t,s,this.goBackwards,r,null,this.unroll,this.returnSequences),d=c[0],u=c[1],h=c[2];this.stateful&&this.resetStates(h,a);let p=this.returnSequences?u:d;return this.returnState?[p].concat(h):p})}getInitialState(t){return fe(()=>{let n=Fr(t.shape);return n=xt(n,[1,2]),n=uv(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(r=>r>1?KC(n,[1,r]):n):this.cell.stateSize>1?[KC(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){let t=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);let r=this.cell.getConfig();return this.getClassName()===E8.className&&(n.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),t),n)}static fromConfig(t,n,r={}){let a=n.cell,s=xo(a,r);return new t(Object.assign(n,{cell:s}))}};sc.className="RNN";Oe.registerClass(sc);var fv=class extends Sn{},YN=class extends fv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ja(this.units,"units"),this.activation=gu(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Dr(e.kernelRegularizer),this.recurrentRegularizer=Dr(e.recurrentRegularizer),this.biasRegularizer=Dr(e.biasRegularizer),this.kernelConstraint=pa(e.kernelConstraint),this.recurrentConstraint=pa(e.recurrentConstraint),this.biasConstraint=pa(e.biasConstraint),this.dropout=wf([1,mu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wf([1,mu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vn(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return fe(()=>{if(e=e,e.length!==2)throw new ye(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];let r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=xu({ones:()=>Ys(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=xu({ones:()=>Ys(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let a,s=this.dropoutMask,o=this.recurrentDropoutMask;s!=null?a=tl(oe(e,s),this.kernel.read()):a=tl(e,this.kernel.read()),this.bias!=null&&(a=Io(a,this.bias.read())),o!=null&&(n=oe(n,o));let l=Re(a,tl(n,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:fu(this.activation),useBias:this.useBias,kernelInitializer:Pr(this.kernelInitializer),recurrentInitializer:Pr(this.recurrentInitializer),biasInitializer:Pr(this.biasInitializer),kernelRegularizer:yr(this.kernelRegularizer),recurrentRegularizer:yr(this.recurrentRegularizer),biasRegularizer:yr(this.biasRegularizer),activityRegularizer:yr(this.activityRegularizer),kernelConstraint:ha(this.kernelConstraint),recurrentConstraint:ha(this.recurrentConstraint),biasConstraint:ha(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}};YN.className="SimpleRNNCell";Oe.registerClass(YN);var FE=class extends sc{constructor(e){e.cell=new YN(e),super(e)}call(e,t){return fe(()=>{this.cell.dropoutMask!=null&&(tn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(tn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return new e(t)}};FE.className="SimpleRNN";Oe.registerClass(FE);var XN=class extends fv{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new ye("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ja(this.units,"units"),this.activation=gu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=gu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Dr(e.kernelRegularizer),this.recurrentRegularizer=Dr(e.recurrentRegularizer),this.biasRegularizer=Dr(e.biasRegularizer),this.kernelConstraint=pa(e.kernelConstraint),this.recurrentConstraint=pa(e.recurrentConstraint),this.biasConstraint=pa(e.biasConstraint),this.dropout=wf([1,mu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wf([1,mu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Vn(e);let t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return fe(()=>{if(e=e,e.length!==2)throw new ye(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training==null?!1:t.training,r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=xu({ones:()=>Ys(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=xu({ones:()=>Ys(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,s=this.recurrentDropoutMask,o,l,c;0<this.dropout&&this.dropout<1&&(e=oe(e,a[0]));let d=tl(e,this.kernel.read());this.useBias&&(d=Io(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=oe(r,s[0]));let u=this.recurrentKernel.read(),[h,p]=bs(u,[2*this.units,this.units],u.rank-1),m=tl(r,h),[f,g,x]=bs(d,3,d.rank-1),[y,b]=bs(m,2,m.rank-1);o=this.recurrentActivation.apply(Re(f,y)),l=this.recurrentActivation.apply(Re(g,b));let v=tl(oe(l,r),p);c=this.activation.apply(Re(x,v));let w=Re(oe(o,r),oe(Re(1,Cr(o)),c));return[w,w]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:fu(this.activation),recurrentActivation:fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pr(this.kernelInitializer),recurrentInitializer:Pr(this.recurrentInitializer),biasInitializer:Pr(this.biasInitializer),kernelRegularizer:yr(this.kernelRegularizer),recurrentRegularizer:yr(this.recurrentRegularizer),biasRegularizer:yr(this.biasRegularizer),activityRegularizer:yr(this.activityRegularizer),kernelConstraint:ha(this.kernelConstraint),recurrentConstraint:ha(this.recurrentConstraint),biasConstraint:ha(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}};XN.className="GRUCell";Oe.registerClass(XN);var PE=class extends sc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new XN(e),super(e)}call(e,t){return fe(()=>{this.cell.dropoutMask!=null&&(tn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(tn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};PE.className="GRU";Oe.registerClass(PE);var gv=class extends fv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ja(this.units,"units"),this.activation=gu(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=gu(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Rr(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Dr(e.kernelRegularizer),this.recurrentRegularizer=Dr(e.recurrentRegularizer),this.biasRegularizer=Dr(e.biasRegularizer),this.kernelConstraint=pa(e.kernelConstraint),this.recurrentConstraint=pa(e.recurrentConstraint),this.biasConstraint=pa(e.biasConstraint),this.dropout=wf([1,mu([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wf([1,mu([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=Vn(e);let n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){let a=this.biasInitializer,s=this.units;r=new(t=class extends Gi{apply(o,l){let c=a.apply([s]),d=new $N().apply([s]),u=a.apply([s*2]);return tF(tF(c,d),u)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return fe(()=>{let n=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new ye(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1],a=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=xu({ones:()=>Ys(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=xu({ones:()=>Ys(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,o=this.recurrentDropoutMask,l,c,d,u;0<this.dropout&&this.dropout<1&&(e=oe(e,s[0]));let h=tl(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=oe(r,o[0])),h=Re(h,tl(r,this.recurrentKernel.read())),this.useBias&&(h=Io(h,this.bias.read()));let[p,m,f,g]=bs(h,4,h.rank-1);l=this.recurrentActivation.apply(p),c=this.recurrentActivation.apply(m),d=Re(oe(c,a),oe(l,this.activation.apply(f))),u=this.recurrentActivation.apply(g);let x=oe(u,this.activation.apply(d));return[x,x,d]})}getConfig(){let e=super.getConfig(),t={units:this.units,activation:fu(this.activation),recurrentActivation:fu(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Pr(this.kernelInitializer),recurrentInitializer:Pr(this.recurrentInitializer),biasInitializer:Pr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:yr(this.kernelRegularizer),recurrentRegularizer:yr(this.recurrentRegularizer),biasRegularizer:yr(this.biasRegularizer),activityRegularizer:yr(this.activityRegularizer),kernelConstraint:ha(this.kernelConstraint),recurrentConstraint:ha(this.recurrentConstraint),biasConstraint:ha(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}};gv.className="LSTMCell";Oe.registerClass(gv);var OE=class extends sc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new gv(e),super(e)}call(e,t){return fe(()=>{this.cell.dropoutMask!=null&&(tn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(tn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}};OE.className="LSTM";Oe.registerClass(OE);var ZN=class extends fv{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return fe(()=>{e=e;let n=e.slice(1),r=[];for(let o of this.cells.slice().reverse())Array.isArray(o.stateSize)?r.push(n.splice(0,o.stateSize.length)):r.push(n.splice(0,1));r.reverse();let a=[],s;for(let o=0;o<this.cells.length;++o){let l=this.cells[o];n=r[o],o===0?s=[e[0]].concat(n):s=[s[0]].concat(n),s=l.call(s,t),a.push(s.slice(1))}n=[];for(let o of a.slice().reverse())n.push(...o);return[s[0]].concat(n)})}build(e){XC(e)&&(e=e[0]),e=e;let t;this.cells.forEach((n,r)=>{$d(`RNNCell_${r}`,()=>{n.build(e),Array.isArray(n.stateSize)?t=n.stateSize[0]:t=n.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){let e=super.getConfig(),t=r=>({className:r.getClassName(),config:r.getConfig()}),n={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),n)}static fromConfig(e,t,n={}){let r=[];for(let a of t.cells)r.push(xo(a,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){let t=[];for(let n of this.cells)t.push(...n.trainableWeights);return t.concat(e)}return e}getWeights(){let e=[];for(let t of this.cells)e.push(...t.weights);return ZC(e)}setWeights(e){let t=[];for(let n of this.cells){let r=n.weights.length,a=e.splice(r);for(let s=0;s<n.weights.length;++s)t.push([n.weights[s],a[s]])}lE(t)}};ZN.className="StackedRNNCells";Oe.registerClass(ZN);function xu(e){let{ones:t,rate:n,training:r=!1,count:a=1,dropoutFunc:s}=e,o=()=>s!=null?s(t(),n):RV(t(),n),l=()=>hv(o,t,r);return!a||a<=1?la(l().clone()):Array(a).fill(void 0).map(l).map(c=>la(c.clone()))}var dCe=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n},A8=class extends sc{constructor(e){if(e.unroll)throw new kn("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new kn("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Zr({ndim:5})]}call(e,t){return fe(()=>{if(this.cell.dropoutMask!=null&&(tn(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(tn(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new ye("ConvRNN2D cell does not support constants");let n=t==null?null:t.mask,r=t==null?null:t.training,a=t==null?null:t.initialState;return super.call(e,{mask:n,training:r,initialState:a})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return fe(()=>{let{stateSize:t}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)],s=Fr(a);return Array.isArray(t)?Array(t.length).fill(s):[s]})}resetStates(e,t=!1){fe(()=>{if(!this.stateful)throw new Nc("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),a=[r[0],...r.slice(2)];if(n[0]==null)throw new ye("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Fr(a)):this.states_=[Fr(a)];else if(e==null)tn(this.states_),this.keptStates!=null&&(tn(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Fr(a)):this.states_[0]=Fr(a);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new ye(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):tn(this.states_);for(let s=0;s<this.states_.length;++s){let o=e[s],l=a;if(!E.arraysEqual(o.shape,l))throw new ye(`State ${s} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${o.shape}`);this.states_[s]=o}}this.states_=this.states_.map(s=>la(s.clone()))})}computeSingleOutputShape(e){let{dataFormat:t,filters:n,kernelSize:r,padding:a,strides:s,dilationRate:o}=this.cell,l=t==="channelsFirst",c=e[l?3:2],d=e[l?4:3],u=yo(c,r[0],a,s[0],o[0]),h=yo(d,r[1],a,s[1],o[1]);return[...e.slice(0,2),...l?[n,u,h]:[u,h,n]]}};A8.className="ConvRNN2D";var QN=class extends gv{constructor(e){let{filters:t,kernelSize:n,strides:r,padding:a,dataFormat:s,dilationRate:o}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,ja(this.filters,"filters"),this.kernelSize=Fm(n,2,"kernelSize"),this.kernelSize.forEach(l=>ja(l,"kernelSize")),this.strides=Fm(r||1,2,"strides"),this.strides.forEach(l=>ja(l,"strides")),this.padding=a||"valid",xi(this.padding),this.dataFormat=s||"channelsLast",qr(this.dataFormat),this.dilationRate=Fm(o||1,2,"dilationRate"),this.dilationRate.forEach(l=>ja(l,"dilationRate"))}build(e){var t;e=Vn(e);let n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new ye(`The channel dimension of the input should be defined. Found ${e[n]}`);let r=e[n],a=4,s=this.kernelSize.concat([r,this.filters*a]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let o=this.kernelSize.concat([this.filters,this.filters*a]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){let c=this.biasInitializer,d=this.filters;l=new(t=class extends Gi{apply(u,h){let p=c.apply([d]),m=ys([d]),f=c.apply([d*2]);return eE([p,m,f])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*a],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return fe(()=>{if(e.length!==3)throw new ye(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=t.training||!1,r=e[0],a=e[1],s=e[2],o=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=xu({ones:()=>Ys(r),rate:this.dropout,training:n,count:o,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,c=(M,X,G)=>!X||!X[G]?M:oe(X[G],M),d=c(r,l,0),u=c(r,l,1),h=c(r,l,2),p=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=xu({ones:()=>Ys(a),rate:this.recurrentDropout,training:n,count:o,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,f=c(a,m,0),g=c(a,m,1),x=c(a,m,2),y=c(a,m,3),b=3,[v,w,k,C]=bs(this.kernel.read(),o,b),[S,_,I,T]=this.useBias?bs(this.bias.read(),o):[null,null,null,null];d=this.inputConv(d,v,S,this.padding),u=this.inputConv(u,w,_,this.padding),h=this.inputConv(h,k,I,this.padding),p=this.inputConv(p,C,T,this.padding);let[A,j,D,F]=bs(this.recurrentKernel.read(),o,b);f=this.recurrentConv(f,A),g=this.recurrentConv(g,j),x=this.recurrentConv(x,D),y=this.recurrentConv(y,F);let B=this.recurrentActivation.apply(Re(d,f)),q=this.recurrentActivation.apply(Re(u,g)),$=Re(oe(q,s),oe(B,this.activation.apply(Re(h,x)))),L=oe(this.recurrentActivation.apply(Re(p,y)),this.activation.apply($));return[L,L,$]})}getConfig(){let e=super.getConfig(),{units:t}=e,n=dCe(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),r)}inputConv(e,t,n,r){let a=Ja(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?Io(a,n,this.dataFormat):a}recurrentConv(e,t){return Ja(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}};QN.className="ConvLSTM2DCell";Oe.registerClass(QN);var LE=class extends A8{constructor(e){let t=new QN(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}};LE.className="ConvLSTM2D";Oe.registerClass(LE);var JN=class extends Sn{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let t=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return n}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);if(0<this.rate&&this.rate<1){let r=t.training==null?!1:t.training,a=this.getNoiseShape(n);return hv(()=>RV(n,this.rate,a,this.seed),()=>n,r)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}};JN.className="Dropout";Oe.registerClass(JN);var zE=class extends JN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let t=e.shape;return[t[0],1,t[2]]}};zE.className="SpatialDropout1D";Oe.registerClass(zE);var BE=class extends Sn{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,ja(this.units,"units"),this.activation=gu(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Rr(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Rr(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=pa(e.kernelConstraint),this.biasConstraint=pa(e.biasConstraint),this.kernelRegularizer=Dr(e.kernelRegularizer),this.biasRegularizer=Dr(e.biasRegularizer),this.activityRegularizer=Dr(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Vn(e);let t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=Vn(e);let t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e),r=CV(this.activation.getClassName()),a;return r!=null?a=tl(n,this.kernel.read(),r,this.bias?this.bias.read():null):(a=tl(n,this.kernel.read()),this.bias!=null&&(a=Io(a,this.bias.read())),this.activation!=null&&(a=this.activation.apply(a))),a})}getConfig(){let e={units:this.units,activation:fu(this.activation),useBias:this.useBias,kernelInitializer:Pr(this.kernelInitializer),biasInitializer:Pr(this.biasInitializer),kernelRegularizer:yr(this.kernelRegularizer),biasRegularizer:yr(this.biasRegularizer),activityRegularizer:yr(this.activityRegularizer),kernelConstraint:ha(this.kernelConstraint),biasConstraint:ha(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}};BE.className="Dense";Oe.registerClass(BE);var WE=class extends Sn{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Vn(e);for(let t of e.slice(1))if(t==null)throw new ye(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Qc(e,1)]}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){let r=[0];for(let a=2;a<n.rank;++a)r.push(a);r.push(1),n=hn(n,r)}return kSe(n)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let t=super.getConfig();return Object.assign(e,t),e}};WE.className="Flatten";Oe.registerClass(WE);var UE=class extends Sn{constructor(e){super(e),this.supportsMasking=!0,this.activation=gu(e.activation)}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);return this.activation.apply(n)})}getConfig(){let e={activation:fu(this.activation)},t=super.getConfig();return Object.assign(e,t),e}};UE.className="Activation";Oe.registerClass(UE);var VE=class extends Sn{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return fe(()=>(e=Vt(e),wSe(e,this.n)))}getConfig(){let e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}};VE.className="RepeatVector";Oe.registerClass(VE);var HE=class extends Sn{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){let n="Total size of new array must be unchanged.",r=t.slice(),a=1,s=null;for(let l=0;l<r.length;++l){let c=r[l];if(this.isUnknown(c))if(s===null)s=l;else throw new ye("Can only specifiy one unknown dimension.");else a*=c}let o=Qc(e);if(s!==null){if(a===0||o%a!==0)throw new ye(n);r[s]=o/a}else if(o!==a)throw new ye(n);return r}computeOutputShape(e){let t=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e),r=n.shape,a=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return me(n,a)})}getConfig(){let e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}};HE.className="Reshape";Oe.registerClass(HE);var GE=class extends Sn{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let t=No(1,e.dims.length+1);if(!E.arraysEqual(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Zr({ndim:this.dims.length+1})]}computeOutputShape(e){e=Vn(e);let t=e.slice();return this.dims.forEach((n,r)=>{t[r+1]=e[n]}),t}call(e,t){return hn(Vt(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}};GE.className="Permute";Oe.registerClass(GE);var qE=class extends Sn{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){let n=Vt(e);return By(dh(n,this.maskValue),-1)}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e),r=By(dh(n,this.maskValue),-1,!0);return oe(n,He(r,n.dtype))})}};qE.className="Masking";Oe.registerClass(qE);var KE=class extends Sn{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(rr(e.inputLength))}this.inputDim=e.inputDim,ja(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ja(this.outputDim,"outputDim"),this.embeddingsInitializer=Rr(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Dr(e.embeddingsRegularizer),this.activityRegularizer=Dr(e.activityRegularizer),this.embeddingsConstraint=pa(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return fe(()=>this.maskZero?(e=Vt(e),dh(e,Pn(e))):null)}computeOutputShape(e){if(e=Vn(e),this.inputLength==null)return[...e,this.outputDim];let t=rr(this.inputLength);if(t.length!==e.length-1)throw new ye(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<t.length;++r){let a=t[r],s=e[r+1];if(a!=null&&s!=null&&a!==s)throw new ye(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);a==null&&(t[n]=s),n++}}return[e[0],...t,this.outputDim]}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);n.dtype!=="int32"&&(n=Hl(n,"int32"));let r=AV(this.embeddings.read(),me(n,[n.size]));return me(r,Vn(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Pr(this.embeddingsInitializer),embeddingsRegularizer:yr(this.embeddingsRegularizer),activityRegularizer:yr(this.activityRegularizer),embeddingsConstraint:ha(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}};KE.className="Embedding";Oe.registerClass(KE);var Yp=class extends Sn{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new kn}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;let n=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){let a=e[e.length-t.length+r],s=t[r];if(a==null||s==null||a<0||s<0)n.push(null);else if(a===1)n.push(s);else if(s===1)n.push(a);else{if(a!==s)throw new ye("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Vn(e)]),e=e,e.length<2)throw new ye(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(let a of e)a!=null&&a[0]!==null&&t.push(a[0]);if(t=Zc(t),t.length>1)throw new ye(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let a=1;a<e.length;++a){let s=e[a]==null?null:e[a].slice(1);n=this.computeElementwiseOpOutputShape(n,s)}let r=e.map(a=>a.length);e.indexOf(null)===-1&&Zc(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return fe(()=>{if(e=e,this.reshapeRequired){let n=[],r=e.map(a=>a.rank);if(r.indexOf(null)===-1){let a=mu(r);for(let s of e){let o=s.rank;for(let l=0;l<a-o;++l)s=uv(s,1);n.push(s)}return this.mergeFunction(n)}else{let a=!1;for(let l of e){let c=l.rank;if(c==null){let d=l.shape,u=d[0],h=d.slice(1).concat([u]),p=me(l,[u].concat(Qc(d.slice(1))));p=hn(p,[1,0]),p=me(p,h),n.push(p),a=!0}else if(c>1){let d=No(1,c).concat([0]);n.push(hn(l,d)),a=!0}else n.push(l)}let s=this.mergeFunction(n),o=s.rank;if(a){if(o==null){let l=s.shape,c=l.length,d=l[c-1],u=[d].concat(l.slice(0,l.length-1));s=me(hn(me(s,[-1,d]),[1,0]),u)}else if(o>1){let l=[o-1].concat(No(0,o-1));s=hn(s,l)}}return s}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){let a=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,a)}let n=[];for(let r of e)r!=null&&r[0]!==null&&n.push(r[0]);return n=Zc(n),n.length===1?t=n.concat(t):t=[null].concat(t),t}computeMask(e,t){return fe(()=>{if(t==null)return null;if(!Array.isArray(t))throw new ye("`mask` should be an Array");if(!Array.isArray(e))throw new ye("`inputs` should be an Array");if(t.length!==e.length)throw new ye(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:_a(r,0));let n=t[0];for(let r=1;r<t.length-1;++r)n=Wi(n,t[r]);return n})}},YE=class extends Yp{constructor(e){super(e)}mergeFunction(e){return fe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Re(t,e[n]);return t})}};YE.className="Add";Oe.registerClass(YE);var XE=class extends Yp{constructor(e){super(e)}mergeFunction(e){return fe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=oe(t,e[n]);return t})}};XE.className="Multiply";Oe.registerClass(XE);var ZE=class extends Yp{constructor(e){super(e)}mergeFunction(e){return fe(()=>{let t=e[0].clone();for(let n=1;n<e.length;++n)t=Re(t,e[n]);return oe(1/e.length,t)})}};ZE.className="Average";Oe.registerClass(ZE);var QE=class extends Yp{constructor(e){super(e)}mergeFunction(e){return fe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=fl(t,e[n]);return t})}};QE.className="Maximum";Oe.registerClass(QE);var JE=class extends Yp{constructor(e){super(e)}mergeFunction(e){return fe(()=>{let t=e[0];for(let n=1;n<e.length;++n)t=hu(t,e[n]);return t})}};JE.className="Minimum";Oe.registerClass(JE);var eA=class extends Yp{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new ye("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(let r of e)if(r!=null){t=!1;break}if(t)return;let n=[];for(let r=0;r<e.length;++r){let a=e[r].slice();a.splice(this.axis,1);let s=!1;for(let o of n)if(E.arraysEqual(o,a)){s=!0;break}s||n.push(a)}if(n.length>1)throw new ye("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return fe(()=>eE(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new ye("A `Concatenate` layer should be called on a list of inputs.");let t=e,n=t[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(let a of t.slice(1)){if(n[r]==null||a[r]==null){n[r]=null;break}n[r]+=a[r]}return n}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new ye("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new ye("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new ye(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return fe(()=>{let n=!0;if(t.forEach(s=>{if(s!=null){n=!1;return}}),n)return null;let r=[];for(let s=0;s<e.length;++s)t[s]==null?r.push(He(Ys(e[s]),"bool")):t[s].rank<e[s].rank?r.push(_a(t[s],-1)):r.push(t[s]);let a=pr(r,this.axis);return tN(a,-1,!1)})}getConfig(){let e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}};eA.className="Concatenate";Oe.registerClass(eA);function Tx(e,t){for(;e<0;)e+=t;return e}function hCe(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new kn("batchDot is not implemented for tensors of 4D or higher rank yet");if(E.assert(e.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${e.shape.length}`),E.assert(e.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${t.shape.length}`),typeof n=="number"&&(n=[n,n]),e.dtype==="complex64"||t.dtype==="complex64")throw new kn("batchDot is not implemented for complex64-type Tensors yet.");let r=e.shape.length,a=t.shape.length;n==null&&(n=[r-1,a-2]);let s=n;return fe(()=>{let o;if(r>a){o=r-a;let c=[];for(let d=0;d<o;++d)c.push(1);t=me(t,t.shape.concat(c))}else if(a>r){o=a-r;let c=[];for(let d=0;d<o;++d)c.push(1);e=me(e,e.shape.concat(c))}else o=0;let l;if(e.shape.length===2&&t.shape.length===2)s[0]===s[1]?l=xt(oe(e,t),s[0]):l=xt(oe(hn(e,[1,0]),t),s[1]);else{let c=s[0]!==e.shape.length-1,d=s[1]===t.shape.length-1;l=un(e,t,c,d)}if(o>0){let c;r>a?c=r+a-3:c=r-1;let d=[];for(let u=c;u<c+o;++u)d.push(u);l=Mu(l,d)}return l.shape.length===1&&(l=_a(l,1)),l})}var tA=class extends Yp{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){E.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0],n=e[1];if(t.length>3||n.length>3)throw new kn("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new ye(`Dimension incompatibility: ${t[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new ye(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],n=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((a,s)=>Tx(a,e[s].shape.length)):r=[Tx(this.axes,t.shape.length),Tx(this.axes,n.shape.length)],this.normalize&&(t=H0(t,r[0]),n=H0(n,r[1])),hCe(t,n,r)}interpretAxes(e,t){let n;return Array.isArray(this.axes)?n=this.axes:n=[Tx(this.axes,e.length),Tx(this.axes,t.length)],n}computeOutputShape(e){E.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new kn("Dot layer does not support tensors of 4D or higher rank yet.");let r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);let a=t.concat(n);return a.length===1&&a.push(1),a}computeMask(e,t){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}};tA.className="Dot";Oe.registerClass(tA);var nA=class extends Sn{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);return hv(()=>Re(MN(n.shape,0,this.stddev),n),()=>n,t.training||!1)})}};nA.className="GaussianNoise";Oe.registerClass(nA);var rA=class extends Sn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return fe(()=>{this.invokeCallHook(e,t);let n=Vt(e);return this.rate>0&&this.rate<1?hv(()=>{let r=Math.sqrt(this.rate/(1-this.rate));return oe(n,MN(n.shape,1,r))},()=>n,t.training||!1):n})}};rA.className="GaussianDropout";Oe.registerClass(rA);var aA=class extends Sn{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Vt(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return fe(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return hv(()=>{let r=Vt(e),a=-1.6732632423543772*1.0507009873554805,s=nc(Ru(n),this.rate);s=Hl(s,"float32");let o=((1-this.rate)*(1+this.rate*a**2))**-.5,l=-o*a*this.rate,c=Re(oe(r,s),oe(Re(s,-1),a));return Re(oe(c,o),l)},()=>Vt(e),t.training||!1)}return e})}};aA.className="AlphaDropout";Oe.registerClass(aA);function qy(e,t,n,r,a,s=.001){let o;if(e.rank===2)o=GI(e,t,n,r,a,s);else if(e.rank===3)o=qI(e,t,n,r,a,s);else if(e.rank===4)o=KI(e,t,n,r,a,s);else throw new kn(`batchNormalization is not implemented for array of rank ${e.rank} yet`);return o}function pCe(e,t,n,r,a=.001){return fe(()=>{let s=nv(e,r),o=s.mean,l=s.variance;return[qy(e,o,l,n,t,a),o,l]})}function mCe(e,t,n,r,a=.001){return fe(()=>{let s=nv(e,r),o=s.mean,l=s.variance,c=[];for(let m of No(0,e.rank))r.indexOf(m)!==-1?c.push(1):c.push(e.shape[m]);let d=me(o,c),u=me(l,c),h=t==null?null:me(t,c),p=n==null?null:me(n,c);return[qy(e,d,u,p,h,a),o,l]})}function fCe(e,t,n,r,a=.001){return E.arraysEqual(r.slice().sort(),No(0,e.rank-1))?pCe(e,t,n,r,a):mCe(e,t,n,r,a)}var sA=class extends Sn{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Rr(e.betaInitializer||"zeros"),this.gammaInitializer=Rr(e.gammaInitializer||"ones"),this.movingMeanInitializer=Rr(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Rr(e.movingVarianceInitializer||"ones"),this.betaConstraint=pa(e.betaConstraint),this.gammaConstraint=pa(e.gammaConstraint),this.betaRegularizer=Dr(e.betaRegularizer),this.gammaRegularizer=Dr(e.gammaRegularizer)}build(e){e=Vn(e);let t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(n==null)throw new ye(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Zr({ndim:e.length,axes:{[t]:n}})];let r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return fe(()=>{let n=t.training==null?!1:t.training,r=Vt(e),a=r.shape,s=a.length,o=No(0,s),l=this.axis>=0?this.axis:this.axis+s;o.splice(l,1);let c=ph(1,s);c[l]=a[l];let d=o.slice();d.sort();let u=!E.arraysEqual(d,No(0,s).slice(0,s-1)),h=()=>{if(u){let x=me(this.movingMean.read(),c),y=me(this.movingVariance.read(),c),b=this.center?me(this.beta.read(),c):null,v=this.scale?me(this.gamma.read(),c):null;return qy(r,x,y,b,v,this.epsilon)}else return qy(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return h();let[p,m,f]=fCe(r,this.gamma.read(),this.beta.read(),o,this.epsilon),g=(x,y,b)=>{fe(()=>{let v=1-b,w=x.read(),k=oe(ot(w,y),v);x.write(ot(w,k))})};return g(this.movingMean,m,this.momentum),g(this.movingVariance,f,this.momentum),p})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pr(this.betaInitializer),gammaInitializer:Pr(this.gammaInitializer),movingMeanInitializer:Pr(this.movingMeanInitializer),movingVarianceInitializer:Pr(this.movingVarianceInitializer),betaRegularizer:yr(this.betaRegularizer),gammaRegularizer:yr(this.gammaRegularizer),betaConstraint:ha(this.betaConstraint),gammaConstraint:ha(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}};sA.className="BatchNormalization";Oe.registerClass(sA);var iA=class extends Sn{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Rr(e.betaInitializer||"zeros"),this.gammaInitializer=Rr(e.gammaInitializer||"ones"),this.betaRegularizer=Dr(e.betaRegularizer),this.gammaRegularizer=Dr(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Vn(e);let t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let a=0;a<this.axis.length;++a)this.axis[a]<0&&(this.axis[a]+=t);for(let a of this.axis)if(a<0||a>=t)throw new Error(`Invalid axis: ${a}`);if(this.axis.length!==Zc(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(a=>e[a]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){let n=Vt(e),r=n.shape,a=r.length;return fe(()=>{let{mean:s,variance:o}=nv(n,this.axis,!0),l=ph(1,a);for(let m of this.axis)l[m]=r[m];let c=m=>m!=null&&m.shape.length!==a?me(m,l):m,d=this.scale?c(this.gamma.read()):null,u=this.center?c(this.beta.read()):null,h=[],p=[];for(let m=0;m<a;++m)this.axis.indexOf(m)!==-1?(h.push(r[m]),p.push(1)):(h.push(1),p.push(r[m]));return s=Us(s,h),o=Us(o,h),d!=null&&(d=Us(d,p)),u!=null&&(u=Us(u,p)),qy(n,s,o,u,d,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Pr(this.betaInitializer),gammaInitializer:Pr(this.gammaInitializer),betaRegularizer:yr(this.betaRegularizer),gammaRegularizer:yr(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}};iA.className="LayerNormalization";Oe.registerClass(iA);function gCe(e,t,n){return fe(()=>{if(e.rank!==4)throw new ye(`temporalPadding expects input tensor to be 4-D, but received a ${e.rank}-D tensor.`);if(t==null&&(t=[[1,1],[1,1]]),t.length!==2||t[0].length!==2||t[1].length!==2)throw new ye("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=ko()),n!=="channelsLast"&&n!=="channelsFirst")throw new ye(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return n==="channelsFirst"?r=[[0,0],[0,0],t[0],t[1]]:r=[[0,0],t[0],t[1],[0,0]],jo(e,r)})}var oA=class extends Sn{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?ko():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new ye(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,n;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new ye(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new ye(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[t,n]}this.inputSpec=[new Zr({ndim:4})]}computeOutputShape(e){e=Vn(e);let t,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],t,n]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],t,n,e[3]])}call(e,t){return fe(()=>gCe(Vt(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}};oA.className="ZeroPadding2D";Oe.registerClass(oA);function ek(e,t,n,r,a,s){return fe(()=>{qr(a),jV(s),xi(r),n==null&&(n=[1,1]),r==null&&(r="valid"),a==null&&(a=ko()),s==null&&(s="max"),e=IE(e,a);let o,l=r==="same"?"same":"valid";return s==="max"?o=va(e,t,n,l):o=tc(e,t,n,l),a==="channelsFirst"&&(o=hn(o,[0,3,1,2])),o})}function R8(e,t,n,r,a,s){return fe(()=>{qr(a),jV(s),xi(r),n==null&&(n=[1,1,1]),r==null&&(r="valid"),a==null&&(a=ko()),s==null&&(s="max"),e=v8(e,a);let o,l=r==="same"?"same":"valid";return s==="max"?o=yT(e,t,n,l):o=HI(e,t,n,l),a==="channelsFirst"&&(o=hn(o,[0,4,1,2,3])),o})}var D8=class extends Sn{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new ye(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ja(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new ye(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ja(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,xi(this.padding),this.inputSpec=[new Zr({ndim:3})]}computeOutputShape(e){e=Vn(e);let t=yo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return fe(()=>{this.invokeCallHook(e,t),e=uv(Vt(e),2);let n=this.poolingFunction(Vt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Mu(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}},lA=class extends D8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),ek(e,t,n,r,a,"max")}};lA.className="MaxPooling1D";Oe.registerClass(lA);var cA=class extends D8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),ek(e,t,n,r,a,"avg")}};cA.className="AveragePooling1D";Oe.registerClass(cA);var M8=class extends Sn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new ye(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ja(this.poolSize,"poolSize"),ja(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qr(this.dataFormat),xi(this.padding),this.inputSpec=[new Zr({ndim:4})]}computeOutputShape(e){e=Vn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=yo(t,this.poolSize[0],this.padding,this.strides[0]),n=yo(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}call(e,t){return fe(()=>(this.invokeCallHook(e,t),this.poolingFunction(Vt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},uA=class extends M8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),ek(e,t,n,r,a,"max")}};uA.className="MaxPooling2D";Oe.registerClass(uA);var dA=class extends M8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),ek(e,t,n,r,a,"avg")}};dA.className="AveragePooling2D";Oe.registerClass(dA);var $8=class extends Sn{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new ye(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ja(this.poolSize,"poolSize"),ja(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qr(this.dataFormat),xi(this.padding),this.inputSpec=[new Zr({ndim:5})]}computeOutputShape(e){e=Vn(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=yo(t,this.poolSize[0],this.padding,this.strides[0]),n=yo(n,this.poolSize[1],this.padding,this.strides[1]),r=yo(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}call(e,t){return fe(()=>(this.invokeCallHook(e,t),this.poolingFunction(Vt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},hA=class extends $8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),R8(e,t,n,r,a,"max")}};hA.className="MaxPooling3D";Oe.registerClass(hA);var pA=class extends $8{constructor(e){super(e)}poolingFunction(e,t,n,r,a){return qr(a),xi(r),R8(e,t,n,r,a,"avg")}};pA.className="AveragePooling3D";Oe.registerClass(pA);var F8=class extends Sn{constructor(e){super(e),this.inputSpec=[new Zr({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new kn}},mA=class extends F8{constructor(e){super(e||{})}call(e,t){return fe(()=>{let n=Vt(e);return $r(n,1)})}};mA.className="GlobalAveragePooling1D";Oe.registerClass(mA);var fA=class extends F8{constructor(e){super(e||{})}call(e,t){return fe(()=>{let n=Vt(e);return di(n,1)})}};fA.className="GlobalMaxPooling1D";Oe.registerClass(fA);var P8=class extends Sn{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qr(this.dataFormat),this.inputSpec=[new Zr({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new kn}getConfig(){let e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}},gA=class extends P8{call(e,t){return fe(()=>{let n=Vt(e);return this.dataFormat==="channelsLast"?$r(n,[1,2]):$r(n,[2,3])})}};gA.className="GlobalAveragePooling2D";Oe.registerClass(gA);var xA=class extends P8{call(e,t){return fe(()=>{let n=Vt(e);return this.dataFormat==="channelsLast"?di(n,[1,2]):di(n,[2,3])})}};xA.className="GlobalMaxPooling2D";Oe.registerClass(xA);var O8=class extends Sn{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,n={}){let r=t.layer,a=xo(r,n);delete t.layer;let s={layer:a};return Object.assign(s,t),new e(s)}},yA=class extends O8{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Vn(e),e.length<3)throw new ye(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Vn(e);let t=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,t){return fe(()=>(e=Vt(e),T8((n,r)=>[Vt(this.layer.call(n,t)),[]],e,[],!1,null,null,!1,!0)[1]))}};yA.className="TimeDistributed";Oe.registerClass(yA);function xCe(e){qp(gSe,"BidirectionalMergeMode",e)}var yCe="concat",bA=class extends O8{constructor(e){super(e);let t=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=t,this.forwardLayer=xo(n),t.goBackwards=t.goBackwards!==!0;let r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=xo(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?yCe:e.mergeMode,xCe(this.mergeMode),e.weights)throw new kn("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let n,r,a;return this.returnState&&(a=t.slice(1)),n=t[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,r=[n]):this.mergeMode==null?r=[n,n.slice()]:r=[n],this.returnState?this.mergeMode==null?r.concat(a).concat(a.slice()):[n].concat(a).concat(a.slice()):fs(r)}apply(e,t){let n=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});let a=I8(e,n,r,this.numConstants);if(e=a.inputs,n=a.initialState,r=a.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&r==null)return super.apply(e,t);let s=[],o=[];if(n!=null){let c=n.length;if(c%2>0)throw new ye("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=n,s.push(...n);let d=n.map(u=>new Zr({shape:u.shape}));this.forwardLayer.stateSpec=d.slice(0,c/2),this.backwardLayer.stateSpec=d.slice(c/2),o.push(...d)}if(r!=null)throw new kn("Support for constants in Bidirectional layers is not implemented yet.");let l=s[0]instanceof So;for(let c of s)if(c instanceof So!==l)throw new ye("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){let c=[e].concat(s),d=this.inputSpec.concat(o),u=this.inputSpec;this.inputSpec=d;let h=super.apply(c,t);return this.inputSpec=u,h}else return super.apply(e,t)}call(e,t){return fe(()=>{let n=t.initialState,r,a;if(n==null)r=this.forwardLayer.call(e,t),a=this.backwardLayer.call(e,t);else{let l=n.slice(0,n.length/2),c=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),a=this.backwardLayer.call(e,Object.assign(t,{initialState:c}))}let s;this.returnState&&(Array.isArray(r)&&(s=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),this.returnSequences&&(a=gi(a,1));let o;return this.mergeMode==="concat"?o=eE([r,a]):this.mergeMode==="sum"?o=Re(r,a):this.mergeMode==="ave"?o=oe(.5,Re(r,a)):this.mergeMode==="mul"?o=oe(r,a):this.mergeMode==null&&(o=[r,a]),this.returnState?this.mergeMode==null?o.concat(s):[o].concat(s):o})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){$d(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),$d(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[t,t]:n=t:this.mergeMode==null?n=[null,null]:n=null,this.returnState){let r=this.forwardLayer.states.map(a=>null);return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){let n=xo(t.layer);if(delete t.layer,t.numConstants!=null)throw new kn("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let r=t;return r.layer=n,new e(r)}};bA.className="Bidirectional";Oe.registerClass(bA);var vA=class extends Sn{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return fe(()=>(e=Vt(e),e.dtype!=="float32"&&(e=Hl(e,"float32")),Re(oe(e,this.scale),this.offset)))}};vA.className="Rescaling";Oe.registerClass(vA);var{resizeBilinear:bCe,cropAndResize:vCe}=ii,wA=class extends Sn{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,n,r,a,s,o,l){return fe(()=>{let c,d=!1,u=t/s,h=n/o,p=(r+t)/s,m=(a+n)/o,f=[u,h,p,m],g=[];e.rank===3?(d=!0,c=Jr([e])):c=e;for(let v=0;v<c.shape[0];v++)g.push(f);let x=Qa(g,[g.length,4]),y=hh(0,g.length,1,"int32"),b=vCe(c,x,y,[r,a],"nearest");return Hl(d?Vt(Ur(b)):b,l)})}upsize(e,t,n,r){return fe(()=>{let a=bCe(e,[t,n]);return Hl(a,r)})}call(e,t){return fe(()=>{let n=Vt(e),r=n.dtype,a=n.shape,s=a[a.length-3],o=a[a.length-2],l=0;s!==this.height&&(l=Math.floor((s-this.height)/2));let c=0;return o!==this.width&&(c=Math.floor((o-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(n,l,c,this.height,this.width,s,o,r):this.upsize(e,this.height,this.width,r)})}getConfig(){let e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vn(e);let t=e.length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}};wA.className="CenterCrop";Oe.registerClass(wA);function wCe(e,t,n,r){let a=Vt(e);if(a.dtype!=="int32"&&(a=Hl(a,"int32")),t==="int")return a;let s=a.shape;if(a.rank===0&&(a=_a(a,-1)),t==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=_a(a,-1)),a.rank>2)throw new ye(`When outputMode is not int, maximum output rank is 2 Received outputMode ${t} and input shape ${s} which would result in output rank ${a.rank}.`);let o=["multiHot","oneHot"].includes(t),l=a,c;if(typeof r<"u"&&t==="count"?c=L0(l,r,n,o):c=L0(l,[],n,o),t!=="tfIdf")return c;if(r)return oe(c,r);throw new ye("When outputMode is 'tfIdf', weights must be provided.")}var NA=class extends Sn{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=Vn(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return fe(()=>{e=Vt(e),e.dtype!=="int32"&&(e=Hl(e,"int32"));let n;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new ye(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);n=Vt(t.countWeights)}let r=di(e),a=mf(e),s=as(this.numTokens,r).bufferSync().get(0),o=nc(a,0).bufferSync().get(0);if(!(s&&o))throw new ye(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return wCe(e,this.outputMode,this.numTokens,n)})}};NA.className="CategoryEncoding";Oe.registerClass(NA);var NCe=["bilinear","nearest"],yF=new Set(NCe),kA=class extends Sn{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(yF.has(e.interpolation))this.interpolation=e.interpolation;else throw new ye(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Vn(e);let t=e[2];return[this.height,this.width,t]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return fe(()=>{let n=[this.height,this.width];if(this.interpolation==="bilinear")return ii.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return ii.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...yF]} are supported`)})}};kA.className="Resizing";Oe.registerClass(kA);var L8=class{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}};L8.className="RandomSeed";var z8=class extends Sn{constructor(e){super(e),this.randomGenerator=new L8(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}};z8.className="BaseRandomLayer";var kCe=["bilinear","nearest"],bF=new Set(kCe),SA=class extends z8{constructor(e){super(e);let{factor:t,interpolation:n="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new ye(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new ye(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new ye(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(n)if(bF.has(n))this.interpolation=n;else throw new ye(`Invalid interpolation parameter: ${n} is not implemented`)}getConfig(){let e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=Vn(e);let t=e[2];return[this.imgHeight,-1,t]}call(e,t){return fe(()=>{let n=Vt(e);this.imgHeight=n.shape[n.shape.length-3];let r=n.shape[n.shape.length-2];this.widthFactor=Ru([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let a=this.widthFactor.dataSync()[0]*r;a=Math.round(a);let s=[this.imgHeight,a];switch(this.interpolation){case"bilinear":return ii.resizeBilinear(e,s);case"nearest":return ii.resizeNearestNeighbor(e,s);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...bF]} are supported`)}})}};SA.className="RandomWidth";Oe.registerClass(SA);function SCe(e){return new Yg(e)}function CCe(e){return new CE(e)}function _Ce(e){return new NE(e)}function jCe(e){return new kE(e)}function ICe(e){return new SE(e)}function TCe(e){return new jE(e)}function ECe(e){return new _E(e)}function ACe(e){return new RE(e)}function RCe(e){return new qN(e)}function DCe(e){return new TE(e)}function MCe(e){return new KN(e)}function $Ce(e){return new EE(e)}function FCe(e){return new AE(e)}function PCe(e){return new DE(e)}function OCe(e){return new ME(e)}function LCe(e){return new $E(e)}function zCe(e){return new UE(e)}function BCe(e){return new BE(e)}function WCe(e){return new JN(e)}function UCe(e){return new zE(e)}function VCe(e){return new WE(e)}function HCe(e){return new VE(e)}function GCe(e){return new HE(e)}function qCe(e){return new GE(e)}function KCe(e){return new KE(e)}function YCe(e){return new YE(e)}function XCe(e){return new ZE(e)}function ZCe(e){return new eA(e)}function QCe(e){return new QE(e)}function JCe(e){return new JE(e)}function e_e(e){return new XE(e)}function t_e(e){return new tA(e)}function n_e(e){return new sA(e)}function r_e(e){return new iA(e)}function a_e(e){return new oA(e)}function CA(e){return new cA(e)}function s_e(e){return CA(e)}function i_e(e){return CA(e)}function _A(e){return new dA(e)}function o_e(e){return _A(e)}function l_e(e){return _A(e)}function jA(e){return new pA(e)}function c_e(e){return jA(e)}function u_e(e){return jA(e)}function d_e(e){return new mA(e)}function h_e(e){return new gA(e)}function B8(e){return new fA(e)}function W8(e){return new xA(e)}function U8(e){return new lA(e)}function V8(e){return new uA(e)}function p_e(e){return new hA(e)}function m_e(e){return new PE(e)}function f_e(e){return new XN(e)}function g_e(e){return new OE(e)}function x_e(e){return new gv(e)}function y_e(e){return new FE(e)}function b_e(e){return new YN(e)}function v_e(e){return new LE(e)}function w_e(e){return new QN(e)}function N_e(e){return new sc(e)}function k_e(e){return new ZN(e)}function S_e(e){return new bA(e)}function C_e(e){return new yA(e)}var __e=B8,j_e=W8,I_e=U8,T_e=V8;function E_e(e){return new nA(e)}function A_e(e){return new rA(e)}function R_e(e){return new aA(e)}function D_e(e){return new qE(e)}function M_e(e){return new vA(e)}function $_e(e){return new wA(e)}function F_e(e){return new kA(e)}function P_e(e){return new NA(e)}function O_e(e){return new SA(e)}var H8={};nn(H8,{MAPE:()=>Y_e,MSE:()=>Q_e,binaryAccuracy:()=>L_e,binaryCrossentropy:()=>z_e,categoricalAccuracy:()=>W_e,categoricalCrossentropy:()=>U_e,cosineProximity:()=>G_e,mape:()=>X_e,meanAbsoluteError:()=>q_e,meanAbsolutePercentageError:()=>K_e,meanSquaredError:()=>Z_e,mse:()=>J_e,precision:()=>V_e,r2Score:()=>eje,recall:()=>H_e,sparseCategoricalAccuracy:()=>B_e});function L_e(e,t){return gE(e,t)}function z_e(e,t){return KV(e,t)}function B_e(e,t){return YV(e,t)}function W_e(e,t){return xE(e,t)}function U_e(e,t){return yE(e,t)}function V_e(e,t){return qV(e,t)}function H_e(e,t){return N2e(e,t)}function G_e(e,t){return fE(e,t)}function q_e(e,t){return UN(e,t)}function K_e(e,t){return Xg(e,t)}function Y_e(e,t){return Xg(e,t)}function X_e(e,t){return Xg(e,t)}function Z_e(e,t){return Kp(e,t)}function Q_e(e,t){return Kp(e,t)}function J_e(e,t){return Kp(e,t)}function eje(e,t){return k2e(e,t)}var G8={};nn(G8,{modelFromJSON:()=>J2e});var q8={};nn(q8,{l1:()=>nje,l1l2:()=>tje,l2:()=>rje});function tje(e){return new mv(e)}function nje(e){return iCe(e)}function rje(e){return oCe(e)}var K8=class extends Nf{constructor(){super(...arguments),this.model=null}setModel(e){if(!(e instanceof Pl))throw new Error("model must be a LayersModel, not some other Container");this.model=e}};function rw(e,t){return e<t}function vF(e,t){return e>t}var Y8=class extends K8{constructor(e){if(super(),e==null&&(e={}),e.restoreBestWeights)throw new kn("restoreBestWeights = True is not implemented in EarlyStopping yet.");this.monitor=e.monitor||"val_loss",this.minDelta=Math.abs(e.minDelta||0),this.patience=e.patience||0,this.verbose=e.verbose||0,this.mode=e.mode||"auto",this.baseline=e.baseline,["auto","min","max"].indexOf(this.mode)===-1&&(console.warn(`EarlyStopping mode '${this.mode}' is invalid. Falling back to mode 'auto'.`),this.mode="auto"),this.mode==="min"?this.monitorFunc=rw:this.mode==="max"?this.monitorFunc=vF:this.monitor.indexOf("acc")!==-1?this.monitorFunc=vF:this.monitorFunc=rw,this.monitorFunc===rw&&(this.minDelta*=-1)}async onTrainBegin(e){this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===rw?1/0:-1/0}async onEpochEnd(e,t){await yc(t);let n=this.getMonitorValue(t);n!=null&&(this.monitorFunc(n-this.minDelta,this.best)?(this.best=n,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=e,this.model.stopTraining=!0)))}async onTrainEnd(e){this.stoppedEpoch>0&&this.verbose&&console.log(`Epoch ${this.stoppedEpoch}: early stopping.`)}getMonitorValue(e){e==null&&(e={});let t=e[this.monitor];return t==null&&console.warn(`Metric for EarlyStopping ${this.monitor} is not available. Available metrics are: ${Object.keys(e)}`),t}};function aje(e){return new Y8(e)}var sje={earlyStopping:aje},ije=_e();ije.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,e=>{e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var As;(function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"})(As||(As={}));var wF;(function(e){(function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"})(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))})(wF||(wF={}));var IA={};function oje(e,t){let n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};IA[e]=n}function X8(e){return IA[e]}function lje(e){delete IA[e]}function R(e,t,n,r,a){let s=t.inputParams[e];if(s&&s.inputIndexStart!==void 0){let l=s.inputIndexStart,c=s.inputIndexEnd===0?void 0:s.inputIndexEnd===void 0?l+1:s.inputIndexEnd,d=l<0?t.inputNames.length+l:l;if(s.type==="tensor")return Ma(t.inputNames[d],n,r,a);if(s.type==="tensors"){let p=t.inputs.slice(l,c);return t.inputNames.slice(l,c).filter((m,f)=>{var g;return((g=p[f])===null||g===void 0?void 0:g.op)!=="NoOp"}).map(m=>Ma(m,n,r,a))}let u=Ma(t.inputNames[d],n,r,a),h=u.dataSync();return s.type==="number"?h[0]:E.toNestedArray(u.shape,h)}let o=t.attrParams[e];return o&&o.value}function Ma(e,t,n,r){let[a,s]=Ps(e,n);if(r!=null){let l=r.getHashTableHandleByName(a);if(l!=null)return l}let o=n.currentContextIds.find(l=>!!t[X0(a,l)]);return o!==void 0?t[X0(a,o)][s]:void 0}function NF(e,t,n){return t[X0(e,n.currentContextId)]}function jl(e,t){let[n,r,a]=Ps(e,t);return[X0(n,t&&t.currentContextId),r,a]}function X0(e,t){return t?`${e}-${t}`:e}function Ps(e,t){if(e==="")return["",0,void 0];let n=t!=null&&t.parseNodeNameCache!=null;if(n){let s=t.parseNodeNameCache.get(e);if(s!=null)return s}let r=e.split(":"),a;if(r.length===1)a=[e,0,void 0];else{let s=r[0],o=r.length===3?r[1]:void 0,l=Number(r[r.length-1]);a=[s,l,o]}return n&&t.parseNodeNameCache.set(e,a),a}function Rw(e,t,n){let r=R("pad",e,t,n);if(r==="explicit"){r=R("explicitPaddings",e,t,n);let a=[[0,0],[0,0],[0,0],[0,0]];for(let s=0;s<4;s++)a[s][0]=r[s*2],a[s][1]=r[s*2+1];return a}return r}function Il(e){return e.kept?e:Jo(e)}var Z8={};nn(Z8,{json:()=>cje});var cje=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Q8={};nn(Q8,{json:()=>uje});var uje=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],J8={};nn(J8,{json:()=>dje});var dje=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],eH={};nn(eH,{json:()=>hje});var hje=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],tH={};nn(tH,{json:()=>pje});var pje=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],nH={};nn(nH,{json:()=>mje});var mje=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],rH={};nn(rH,{json:()=>fje});var fje=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],aH={};nn(aH,{json:()=>gje});var gje=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],sH={};nn(sH,{json:()=>xje});var xje=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],iH={};nn(iH,{json:()=>yje});var yje=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],oH={};nn(oH,{json:()=>bje});var bje=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],lH={};nn(lH,{json:()=>vje});var vje=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],cH={};nn(cH,{json:()=>wje});var wje=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],uH={};nn(uH,{json:()=>Nje});var Nje=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],dH={};nn(dH,{json:()=>kje});var kje=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],hH={};nn(hH,{json:()=>Sje});var Sje=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],pH={};nn(pH,{json:()=>Cje});var Cje=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],mH={};nn(mH,{json:()=>_je});var _je=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],fH={};nn(fH,{json:()=>jje});var jje=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],kF=class{static get Instance(){return this._instance||(this._instance=new this)}constructor(){let e=[Z8,Q8,J8,eH,tH,nH,rH,aH,sH,iH,oH,lH,cH,uH,dH,hH,pH,mH,fH],t=[].concat(...e.map(n=>n.json));this.opMappers=t.reduce((n,r)=>(n[r.tfOpName]=r,n),{})}transformGraph(e,t={}){let n=e.node,r=[],a=[],s=[],o=n.reduce((f,g)=>(f[g.name]=this.mapNode(g),g.op.startsWith("Placeholder")?r.push(f[g.name]):g.op==="Const"?a.push(f[g.name]):(g.input==null||g.input.length===0)&&s.push(f[g.name]),f),{}),l=[],c=[],d={},u={};t!=null&&(d=this.mapSignatureEntries(t.inputs),u=this.mapSignatureEntries(t.outputs));let h=Object.keys(o);h.forEach(f=>{let g=o[f];g.inputNames.forEach((x,y)=>{let[b,,v]=jl(x),w=o[b];if(w.outputs!=null){let k=w.outputs.indexOf(v);if(k!==-1){let C=`${b}:${k}`;g.inputNames[y]=C}}g.inputs.push(w),w.children.push(g)})}),Object.keys(u).length===0?h.forEach(f=>{let g=o[f];g.children.length===0&&c.push(g)}):Object.keys(u).forEach(f=>{let[g]=jl(f),x=o[g];x!=null&&(x.signatureKey=u[f],c.push(x))}),Object.keys(d).length>0?Object.keys(d).forEach(f=>{let[g]=jl(f),x=o[g];x&&(x.signatureKey=d[f],l.push(x))}):l=r;let p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce((f,g)=>(f[g.signature.name]=this.mapFunction(g),f),{}));let m={nodes:o,inputs:l,outputs:c,weights:a,placeholders:r,signature:t,functions:p};return s.length>0&&(m.initNodes=s),m}mapSignatureEntries(e){return Object.keys(e||{}).reduce((t,n)=>(t[e[n].name]=n,t),{})}mapNode(e){let t=X8(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});let n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(r=>r.startsWith("^")?r.slice(1):r),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce((r,a)=>(r[a.name]={type:a.type,inputIndexStart:a.start,inputIndexEnd:a.end},r),{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce((r,a)=>{let s=a.type,o;switch(a.type){case"string":o=r_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=r_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":o=u_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=u_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":o=s_(e.attr,a.tfName,a.defaultValue||0),o===void 0&&a.tfDeprecatedName&&(o=s_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":o=c_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=c_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":o=a_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=a_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":o=h_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=h_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":o=l_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=l_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":o=d_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=d_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":o=i_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=i_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":o=o_(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=o_(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"func":o=SF(e.attr,a.tfName,a.defaultValue),o===void 0&&a.tfDeprecatedName&&(o=SF(e.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${a.type} for op: ${e.op}`)}return r[a.name]={value:o,type:s},r},{})),n}mapFunction(e){let t=e.nodeDef,n=[],r=[],a={};t!=null&&(a=t.reduce((d,u)=>(d[u.name]=this.mapNode(u),u.op==="Const"&&r.push(d[u.name]),d),{}));let s=[],o=[];e.signature.inputArg.forEach(d=>{let[u]=jl(d.name),h={name:u,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:TA(d.type),type:"dtype"}},children:[]};h.signatureKey=d.name,s.push(h),a[u]=h}),Object.keys(a).forEach(d=>{let u=a[d];u.inputNames.forEach((h,p)=>{let[m,,f]=jl(h),g=a[m];if(g.outputs!=null){let x=g.outputs.indexOf(f);if(x!==-1){let y=`${m}:${x}`;u.inputNames[p]=y}}u.inputs.push(g),g.children.push(u)})});let l=e.ret;e.signature.outputArg.forEach(d=>{let[u,h]=jl(l[d.name]),p=a[u];p!=null&&(p.defaultOutput=h,o.push(p))});let c=this.mapArgsToSignature(e);return{nodes:a,inputs:s,outputs:o,weights:r,placeholders:n,signature:c}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n),t),{}),outputs:e.signature.outputArg.reduce((t,n)=>(t[n.name]=this.mapArgToTensorInfo(n,e.ret),t),{})}}mapArgToTensorInfo(e,t){let n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}}};function Ije(e){let t=_e().global;if(typeof t.atob<"u")return t.atob(e);if(typeof Buffer<"u")return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function gH(e,t){let n=Array.isArray(e)?String.fromCharCode.apply(null,e):Ije(e);return t?n:n.toLowerCase()}function r_(e,t,n,r=!1){let a=e[t];return a!=null?gH(a.s,r):n}function a_(e,t,n){let r=e[t];return r?r.b:n}function s_(e,t,n){let r=e[t]||{},a=r.i!=null?r.i:r.f!=null?r.f:n;return typeof a=="number"?a:parseInt(a,10)}function TA(e){switch(typeof e=="string"&&(e=As[e]),e){case As.DT_FLOAT:case As.DT_HALF:return"float32";case As.DT_INT32:case As.DT_INT64:case As.DT_INT8:case As.DT_UINT8:return"int32";case As.DT_BOOL:return"bool";case As.DT_DOUBLE:return"float32";case As.DT_STRING:return"string";case As.DT_COMPLEX64:case As.DT_COMPLEX128:return"complex64";default:return null}}function SF(e,t,n){let r=e[t];return r&&r.func?r.func.name:n}function i_(e,t,n){let r=e[t];return r&&r.type?TA(r.type):n}function o_(e,t,n){let r=e[t];return r&&r.list&&r.list.type?r.list.type.map(a=>TA(a)):n}function xH(e){if(!e.unknownRank)return e.dim!=null?e.dim.map(t=>typeof t.size=="number"?t.size:parseInt(t.size,10)):[]}function l_(e,t,n){let r=e[t];return r&&r.shape?xH(r.shape):n}function c_(e,t,n){let r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(a=>typeof a=="number"?a:parseInt(a,10)):n}function u_(e,t,n,r=!1){let a=e[t];return a&&a.list&&a.list.s?a.list.s.map(s=>gH(s,r)):n}function d_(e,t,n){let r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map(a=>xH(a)):n}function h_(e,t,n){let r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var Tje=class{constructor(e,t,n){this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(r=>this.getInput(r)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((r,a)=>(r[a]=this.getAttr(a),r),{}))}getInput(e){return Ma(e,this.tensorMap,this.context)}getAttr(e,t){let n=this.node.rawAttrs[e];if(n.tensor!=null)return Ma(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return s_(this.node.rawAttrs,e,t);if(n.s!=null)return r_(this.node.rawAttrs,e,t);if(n.b!=null)return a_(this.node.rawAttrs,e,t);if(n.shape!=null)return l_(this.node.rawAttrs,e,t);if(n.type!=null)return i_(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return c_(this.node.rawAttrs,e,t);if(n.list.s!=null)return u_(this.node.rawAttrs,e,t);if(n.list.shape!=null)return d_(this.node.rawAttrs,e,t);if(n.list.b!=null)return h_(this.node.rawAttrs,e,t);if(n.list.type!=null)return o_(this.node.rawAttrs,e,t)}return t}},Aa={};nn(Aa,{OP_SCOPE_SUFFIX:()=>AI,abs:()=>Xr,acos:()=>FI,acosh:()=>PI,add:()=>Re,addN:()=>AW,all:()=>tN,any:()=>By,argMax:()=>lh,argMin:()=>OI,asin:()=>LI,asinh:()=>zI,atan:()=>BI,atan2:()=>WI,atanh:()=>UI,avgPool:()=>tc,avgPool3d:()=>HI,basicLSTMCell:()=>$W,batchNorm:()=>Up,batchNorm2d:()=>GI,batchNorm3d:()=>qI,batchNorm4d:()=>KI,batchToSpaceND:()=>Yb,bincount:()=>YI,bitwiseAnd:()=>FW,booleanMaskAsync:()=>CU,broadcastArgs:()=>PW,broadcastTo:()=>Md,buffer:()=>pn,cast:()=>He,ceil:()=>XI,clipByValue:()=>Wa,clone:()=>Jo,complex:()=>Vl,concat:()=>pr,concat1d:()=>ZI,concat2d:()=>QI,concat3d:()=>JI,concat4d:()=>eT,conv1d:()=>nN,conv2d:()=>Ja,conv2dTranspose:()=>rN,conv3d:()=>nT,conv3dTranspose:()=>rT,cos:()=>Xb,cosh:()=>aN,cosineWindow:()=>jN,cumprod:()=>Vy,cumsum:()=>sN,denseBincount:()=>L0,depthToSpace:()=>aT,depthwiseConv2d:()=>Vp,diag:()=>LW,dilation2d:()=>sT,div:()=>pt,divNoNan:()=>iT,dot:()=>oT,dropout:()=>FT,einsum:()=>cd,elu:()=>Wg,enclosingPowerOfTwo:()=>PT,ensureShape:()=>BW,equal:()=>qs,erf:()=>iN,euclideanNorm:()=>uT,exp:()=>Ua,expandDims:()=>_a,expm1:()=>dT,eye:()=>oN,fft:()=>iv,fill:()=>Gs,floor:()=>Vg,floorDiv:()=>eN,fused:()=>vf,gather:()=>Hg,gatherND:()=>TU,greater:()=>as,greaterEqual:()=>nc,ifft:()=>bf,imag:()=>Zb,image:()=>ii,inTopKAsync:()=>EU,irfft:()=>vN,isFinite:()=>hT,isInf:()=>pT,isNaN:()=>mT,leakyRelu:()=>Qb,less:()=>ff,lessEqual:()=>Au,linalg:()=>zT,linspace:()=>GW,localResponseNormalization:()=>fT,log:()=>Ks,log1p:()=>Jb,logSigmoid:()=>gT,logSoftmax:()=>cN,logSumExp:()=>ev,logicalAnd:()=>Wi,logicalNot:()=>tv,logicalOr:()=>uN,logicalXor:()=>xT,losses:()=>WU,lowerBound:()=>KW,matMul:()=>un,max:()=>di,maxPool:()=>va,maxPool3d:()=>yT,maxPoolWithArgmax:()=>YW,maximum:()=>fl,mean:()=>$r,meshgrid:()=>XW,min:()=>mf,minimum:()=>hu,mirrorPad:()=>bT,mod:()=>vT,moments:()=>nv,movingAverage:()=>_U,mul:()=>oe,multiRNNCell:()=>ZW,multinomial:()=>QW,neg:()=>Cr,norm:()=>Ug,notEqual:()=>dh,oneHot:()=>gf,ones:()=>ys,onesLike:()=>Ys,op:()=>se,outerProduct:()=>JW,pad:()=>jo,pad1d:()=>eU,pad2d:()=>tU,pad3d:()=>nU,pad4d:()=>rU,pool:()=>wT,pow:()=>ll,prelu:()=>av,print:()=>$I,prod:()=>NT,raggedGather:()=>aU,raggedRange:()=>sU,raggedTensorToTensor:()=>iU,rand:()=>oU,randomGamma:()=>dU,randomNormal:()=>hN,randomStandardNormal:()=>hU,randomUniform:()=>Ru,randomUniformInt:()=>pU,range:()=>hh,real:()=>xf,reciprocal:()=>jT,relu:()=>ar,relu6:()=>pN,reshape:()=>me,reverse:()=>gi,reverse1d:()=>mU,reverse2d:()=>fU,reverse3d:()=>gU,reverse4d:()=>xU,rfft:()=>ov,round:()=>mN,rsqrt:()=>fN,scalar:()=>Rt,scatterND:()=>jU,searchSorted:()=>dN,selu:()=>gN,separableConv2d:()=>Gg,setdiff1dAsync:()=>yU,sigmoid:()=>Li,sign:()=>IT,signal:()=>BU,sin:()=>xN,sinh:()=>yN,slice:()=>En,slice1d:()=>sv,slice2d:()=>bN,slice3d:()=>qg,slice4d:()=>yf,softmax:()=>Du,softplus:()=>Hp,spaceToBatchND:()=>rv,sparse:()=>UU,sparseToDense:()=>IU,spectral:()=>zU,split:()=>bs,sqrt:()=>Ta,square:()=>hr,squaredDifference:()=>wN,squeeze:()=>Mu,stack:()=>Jr,step:()=>Gp,stridedSlice:()=>TT,string:()=>VU,sub:()=>ot,sum:()=>xt,tan:()=>ET,tanh:()=>du,tensor:()=>Qa,tensor1d:()=>er,tensor2d:()=>el,tensor3d:()=>NN,tensor4d:()=>pu,tensor5d:()=>bU,tensor6d:()=>vU,tensorScatterUpdate:()=>NU,tile:()=>Us,topk:()=>RT,transpose:()=>hn,truncatedNormal:()=>CN,unique:()=>DT,unsortedSegmentSum:()=>_N,unstack:()=>Ur,upperBound:()=>kU,variable:()=>MT,where:()=>Ia,whereAsync:()=>$T,zeros:()=>Fr,zerosLike:()=>Pn});var Eje=(e,t,n,r=Aa)=>{switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(R("a",e,t,n),R("b",e,t,n))];case"AddN":return[r.addN(R("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(R("a",e,t,n),R("b",e,t,n))];case"Mul":return[r.mul(R("a",e,t,n),R("b",e,t,n))];case"RealDiv":case"Div":return[r.div(R("a",e,t,n),R("b",e,t,n))];case"DivNoNan":return[r.divNoNan(R("a",e,t,n),R("b",e,t,n))];case"FloorDiv":return[r.floorDiv(R("a",e,t,n),R("b",e,t,n))];case"Sub":return[r.sub(R("a",e,t,n),R("b",e,t,n))];case"Minimum":return[r.minimum(R("a",e,t,n),R("b",e,t,n))];case"Maximum":return[r.maximum(R("a",e,t,n),R("b",e,t,n))];case"Pow":return[r.pow(R("a",e,t,n),R("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(R("a",e,t,n),R("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Aje=(e,t,n,r=Aa)=>{switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(R("x",e,t,n))];case"Acos":return[r.acos(R("x",e,t,n))];case"Acosh":return[r.acosh(R("x",e,t,n))];case"Asin":return[r.asin(R("x",e,t,n))];case"Asinh":return[r.asinh(R("x",e,t,n))];case"Atan":return[r.atan(R("x",e,t,n))];case"Atan2":return[r.atan2(R("x",e,t,n),R("y",e,t,n))];case"Atanh":return[r.atanh(R("x",e,t,n))];case"Ceil":return[r.ceil(R("x",e,t,n))];case"Complex":return[r.complex(R("real",e,t,n),R("imag",e,t,n))];case"Cos":return[r.cos(R("x",e,t,n))];case"Cosh":return[r.cosh(R("x",e,t,n))];case"Elu":return[r.elu(R("x",e,t,n))];case"Erf":return[r.erf(R("x",e,t,n))];case"Exp":return[r.exp(R("x",e,t,n))];case"Expm1":return[r.expm1(R("x",e,t,n))];case"Floor":return[r.floor(R("x",e,t,n))];case"Log":return[r.log(R("x",e,t,n))];case"Log1p":return[r.log1p(R("x",e,t,n))];case"Imag":return[r.imag(R("x",e,t,n))];case"Neg":return[r.neg(R("x",e,t,n))];case"Reciprocal":return[r.reciprocal(R("x",e,t,n))];case"Real":return[r.real(R("x",e,t,n))];case"Relu":return[r.relu(R("x",e,t,n))];case"Round":return[r.round(R("x",e,t,n))];case"Selu":return[r.selu(R("x",e,t,n))];case"Sigmoid":return[r.sigmoid(R("x",e,t,n))];case"Sin":return[r.sin(R("x",e,t,n))];case"Sign":return[r.sign(R("x",e,t,n))];case"Sinh":return[r.sinh(R("x",e,t,n))];case"Softplus":return[r.softplus(R("x",e,t,n))];case"Sqrt":return[r.sqrt(R("x",e,t,n))];case"Square":return[r.square(R("x",e,t,n))];case"Tanh":return[r.tanh(R("x",e,t,n))];case"Tan":return[r.tan(R("x",e,t,n))];case"ClipByValue":return[r.clipByValue(R("x",e,t,n),R("clipValueMin",e,t,n),R("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(R("x",e,t,n))];case"Rsqrt":return[r.rsqrt(Ma(e.inputNames[0],t,n))];case"LeakyRelu":return[r.leakyRelu(R("x",e,t,n),R("alpha",e,t,n))];case"Prelu":return[r.prelu(R("x",e,t,n),R("alpha",e,t,n))];case"IsNan":return[r.isNaN(Ma(e.inputNames[0],t,n))];case"IsInf":return[r.isInf(Ma(e.inputNames[0],t,n))];case"IsFinite":return[r.isFinite(Ma(e.inputNames[0],t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function Ei(e,t,n=""){if(!(typeof e=="number"||typeof t=="number")){E.assert(e.length===t.length,()=>n+` Shapes ${e} and ${t} must match`);for(let r=0;r<e.length;r++){let a=e[r],s=t[r];E.assert(a<0||s<0||a===s,()=>n+` Shapes ${e} and ${t} must match`)}}}function CF(e){return!(typeof e=="number"||e.some(t=>t<0))}function Ex(e,t,n){let r=p_(e,n),a=!CF(r);if(a&&t.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${r}`);if(a&&t.forEach(s=>{r=p_(s.shape,r)}),!CF(r))throw new Error(`Non-fully-defined elementShape: ${r}`);return r}function p_(e,t){if(typeof e=="number")return t;if(typeof t=="number")return e;if(e.length!==t.length)throw new Error(`Incompatible ranks during merge: ${e} vs. ${t}`);let n=[];for(let r=0;r<e.length;++r){let a=e[r],s=t[r];if(a>=0&&s>=0&&a!==s)throw new Error(`Incompatible shape during merge: ${e} vs. ${t}`);n[r]=a>=0?a:s}return n}var Rje=class{constructor(e,t,n,r,a,s,o){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=a,this.dynamicSize=s,this.clearAfterRead=o,this.tensors=[],this.closed_=!1,this.idTensor=Rt(0),la(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(t=>{(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);let t=this.tensors[e];if(t.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}readMany(e){return e.map(t=>this.read(t))}write(e,t){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);let n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${t.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Ei(this.elementShape,t.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),n.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(n.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);n.tensor=t,la(t),n.written=!0,this.tensors[e]=n}writeMany(e,t){if(e.length!==t.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${t.length}.`);e.forEach((n,r)=>this.write(n,t[r]))}gather(e,t){if(t&&t!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${t}`);if(e)e=e.slice(0,this.size());else{e=[];for(let r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Qa([],[0].concat(this.elementShape));let n=this.readMany(e);return Ei(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Jr(n,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return Qa([],[0].concat(this.elementShape));let t=[];for(let r=0;r<this.size();r++)t.push(r);let n=this.readMany(t);return Ei(this.elementShape,n[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${n[0].shape})`),pr(n,0)}scatter(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);let n=Math.max(...e);if(!this.dynamicSize&&n>=this.maxSize)throw new Error(`Max index must be < array size (${n}  vs. ${this.maxSize})`);this.writeMany(e,Ur(t,0))}split(e,t){if(t.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${t.dtype}`);let n=0,r=e.map(l=>(n+=l,n));if(n!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${n}, and tensor's shape is: ${t.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);let a=n===0?0:t.size/n,s=[];fe(()=>{t=me(t,[1,n,a]);for(let l=0;l<e.length;++l){let c=[0,l===0?0:r[l-1],0],d=[1,e[l],a];s[l]=me(En(t,c,d),this.elementShape)}return s});let o=[];for(let l=0;l<e.length;l++)o[l]=l;this.writeMany(o,s)}},tk=class m_{get id(){return this.idTensor.id}constructor(t,n,r,a=-1){this.tensors=t,this.elementShape=n,this.elementDtype=r,t!=null&&t.forEach(s=>{if(r!==s.dtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${s.dtype}`);Ei(n,s.shape,"TensorList shape mismatch: "),la(s)}),this.idTensor=Rt(0),this.maxNumElements=a,la(this.idTensor)}copy(){return new m_([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(t){this.tensors.forEach(n=>{(t==null||!t.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(t,n,r=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(r!==-1&&this.tensors.length!==r)throw new Error(`Operation expected a list with ${r} elements but got a list with ${this.tensors.length} elements.`);Ei(t,this.elementShape,"TensorList shape mismatch: ");let a=Ex(this.elementShape,this.tensors,t);return fe(()=>{let s=this.tensors.map(o=>me(o,a));return Jr(s,0)})}popBack(t,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");let r=Ex(this.elementShape,this.tensors,t),a=this.tensors.pop();return a.kept=!1,Ei(a.shape,t,"TensorList shape mismatch: "),me(a,r)}pushBack(t){if(t.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${this.elementDtype}`);if(Ei(t.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");la(t),this.tensors.push(t)}resize(t){if(t<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${t}`);if(this.maxNumElements!==-1&&t>this.maxNumElements)throw new Error(`TensorListResize input size ${t} is greater maxNumElement ${this.maxNumElements}.`);let n=new m_([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(let r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}getItem(t,n,r){if(r!==this.elementDtype)throw new Error(`Invalid data types; op elements ${r}, but list elements ${this.elementDtype}`);if(t<0||t>this.tensors.length)throw new Error(`Trying to access element ${t} in a list with ${this.tensors.length} elements.`);if(this.tensors[t]==null)throw new Error(`element at index ${t} is null.`);Ei(this.tensors[t].shape,n,"TensorList shape mismatch: ");let a=Ex(this.elementShape,this.tensors,n);return me(this.tensors[t],a)}setItem(t,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(t<0||this.maxNumElements!==-1&&t>=this.maxNumElements)throw new Error(`Trying to set element ${t} in a list with max ${this.maxNumElements} elements.`);Ei(this.elementShape,n.shape,"TensorList shape mismatch: "),la(n),this.tensors[t]!=null&&(this.tensors[t].kept=!1),this.tensors[t]=n}gather(t,n,r){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);Ei(this.elementShape,r,"TensorList shape mismatch: "),t=t.slice(0,this.size());let a=Ex(this.elementShape,this.tensors,r);return t.length===0?Qa([],[0].concat(a)):fe(()=>{let s=t.map(o=>me(this.tensors[o],a));return Jr(s,0)})}concat(t,n){if(t&&t!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${t}`);Ei(this.elementShape,n,"TensorList shape mismatch: ");let r=Ex(this.elementShape,this.tensors,n);return this.size()===0?Qa([],[0].concat(r)):fe(()=>{let a=this.tensors.map(s=>me(s,r));return pr(a,0)})}};function Dje(e,t,n){let r=e.dtype;if(e.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${e.shape}`);if(e.dtype!==n)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${n}`);let a=e.shape.slice(1);Ei(a,t,"TensorList shape mismatch: ");let s=Ur(e);return new tk(s,t,r)}function Mje(e,t,n,r){return new tk([],e,t,r)}function $je(e,t,n,r){if(t.length!==e.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${t.length} vs. ${e.shape[0]}`);let a=Math.max(...t);if(r!=null&&r!==-1&&a>=r)throw new Error(`Max index must be < array size (${a}  vs. ${r})`);let s=new tk([],n,e.dtype,r),o=Ur(e,0);return t.forEach((l,c)=>{s.setItem(l,o[c])}),s}function Fje(e,t,n){let r=0,a=t.map(u=>(r+=u,r));if(r!==e.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${r}, and tensor's shape is: ${e.shape}`);let s=e.shape.slice(1),o=p_(s,n),l=r===0?0:e.size/r,c=fe(()=>{let u=[];e=me(e,[1,r,l]);for(let h=0;h<t.length;++h){let p=[0,h===0?0:a[h-1],0],m=[1,t[h],l];u[h]=me(En(e,p,m),o)}return e.dispose(),u}),d=new tk([],n,e.dtype,t.length);for(let u=0;u<c.length;u++)d.setItem(u,c[u]);return d}var Pje=async(e,t,n)=>{switch(e.op){case"If":case"StatelessIf":{let r=R("thenBranch",e,t,n),a=R("elseBranch",e,t,n),s=R("cond",e,t,n),o=R("args",e,t,n);return(await s.data())[0]?n.functionMap[r].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap):n.functionMap[a].executeFunctionAsync(o,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{let r=R("body",e,t,n),a=R("cond",e,t,n),s=R("args",e,t,n),o=await n.functionMap[a].executeFunctionAsync(s,n.tensorArrayMap,n.tensorListMap),l=s.map(u=>u.id),c=await o[0].data();o.forEach(u=>{!u.kept&&l.indexOf(u.id)===-1&&u.dispose()});let d=s;for(;c[0];){let u=d;d=await n.functionMap[r].executeFunctionAsync(d,n.tensorArrayMap,n.tensorListMap);let h=d.map(m=>m.id);u.forEach(m=>{!m.kept&&l.indexOf(m.id)===-1&&h.indexOf(m.id)===-1&&m.dispose()});let p=await n.functionMap[a].executeFunctionAsync(d,n.tensorArrayMap,n.tensorListMap);c=await p[0].data(),p.forEach(m=>{!m.kept&&l.indexOf(m.id)===-1&&h.indexOf(m.id)===-1&&m.dispose()})}return d}case"LoopCond":{let r=R("pred",e,t,n);return[Il(r)]}case"Switch":{let r=R("pred",e,t,n),a=R("data",e,t,n);return a.kept||(a=Il(a)),(await r.data())[0]?[void 0,a]:[a,void 0]}case"Merge":{let r=e.inputNames.find(a=>Ma(a,t,n)!==void 0);if(r){let a=Ma(r,t,n);return[Il(a)]}return}case"Enter":{let r=R("frameName",e,t,n),a=R("tensor",e,t,n);return n.enterFrame(r),[Il(a)]}case"Exit":{let r=R("tensor",e,t,n);return n.exitFrame(),[Il(r)]}case"NextIteration":{let r=R("tensor",e,t,n);return n.nextIteration(),[Il(r)]}case"TensorArrayV3":{let r=R("size",e,t,n),a=R("dtype",e,t,n),s=R("elementShape",e,t,n),o=R("dynamicSize",e,t,n),l=R("clearAfterRead",e,t,n),c=R("identicalElementShapes",e,t,n),d=R("name",e,t,n),u=new Rje(d,a,r,s,c,o,l);return n.addTensorArray(u),[u.idTensor,Rt(1)]}case"TensorArrayWriteV3":{let r=R("tensorArrayId",e,t,n),a=R("index",e,t,n),s=R("tensor",e,t,n),o=n.getTensorArray(r.id);return o.write(a,s),[o.idTensor]}case"TensorArrayReadV3":{let r=R("tensorArrayId",e,t,n),a=R("index",e,t,n);return[n.getTensorArray(r.id).read(a)]}case"TensorArrayGatherV3":{let r=R("tensorArrayId",e,t,n),a=R("indices",e,t,n),s=R("dtype",e,t,n);return[n.getTensorArray(r.id).gather(a,s)]}case"TensorArrayScatterV3":{let r=R("tensorArrayId",e,t,n),a=R("indices",e,t,n),s=R("tensor",e,t,n),o=n.getTensorArray(r.id);return o.scatter(a,s),[o.idTensor]}case"TensorArrayConcatV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id),s=R("dtype",e,t,n);return[a.concat(s)]}case"TensorArraySplitV3":{let r=R("tensorArrayId",e,t,n),a=R("tensor",e,t,n),s=R("lengths",e,t,n),o=n.getTensorArray(r.id);return o.split(s,a),[o.idTensor]}case"TensorArraySizeV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return[Rt(a.size(),"int32")]}case"TensorArrayCloseV3":{let r=R("tensorArrayId",e,t,n),a=n.getTensorArray(r.id);return a.clearAndClose(),[a.idTensor]}case"TensorListSetItem":{let r=R("tensorListId",e,t,n),a=R("index",e,t,n),s=R("tensor",e,t,n),o=n.getTensorList(r.id);return o.setItem(a,s),[o.idTensor]}case"TensorListGetItem":{let r=R("tensorListId",e,t,n),a=R("index",e,t,n),s=R("elementShape",e,t,n),o=R("elementDType",e,t,n);return[n.getTensorList(r.id).getItem(a,s,o)]}case"TensorListScatterV2":case"TensorListScatter":{let r=R("indices",e,t,n),a=R("tensor",e,t,n),s=R("elementShape",e,t,n),o=R("numElements",e,t,n),l=$je(a,r,s,o);return n.addTensorList(l),[l.idTensor]}case"TensorListReserve":case"EmptyTensorList":{let r=R("elementShape",e,t,n),a=R("elementDType",e,t,n),s;e.op==="TensorListReserve"?s="numElements":s="maxNumElements";let o=R(s,e,t,n),l=e.op==="TensorListReserve"?-1:o,c=Mje(r,a,o,l);return n.addTensorList(c),[c.idTensor]}case"TensorListGather":{let r=R("tensorListId",e,t,n),a=R("indices",e,t,n),s=R("elementShape",e,t,n),o=R("elementDType",e,t,n);return[n.getTensorList(r.id).gather(a,o,s)]}case"TensorListStack":{let r=R("tensorListId",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n),o=R("numElements",e,t,n);return[n.getTensorList(r.id).stack(a,s,o)]}case"TensorListFromTensor":{let r=R("tensor",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n),o=Dje(r,a,s);return n.addTensorList(o),[o.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{let r=R("tensorListId",e,t,n),a=n.getTensorList(r.id),s=R("dtype",e,t,n),o=R("elementShape",e,t,n);return[a.concat(s,o)]}case"TensorListPushBack":{let r=R("tensorListId",e,t,n),a=R("tensor",e,t,n),s=n.getTensorList(r.id);return s.pushBack(a),[s.idTensor]}case"TensorListPopBack":{let r=R("tensorListId",e,t,n),a=R("elementShape",e,t,n),s=R("elementDType",e,t,n);return[n.getTensorList(r.id).popBack(a,s)]}case"TensorListSplit":{let r=R("tensor",e,t,n),a=R("elementShape",e,t,n),s=R("lengths",e,t,n),o=Fje(r,s,a);return n.addTensorList(o),[o.idTensor]}case"TensorListLength":{let r=R("tensorListId",e,t,n),a=n.getTensorList(r.id);return[Rt(a.size(),"int32")]}case"TensorListResize":{let r=R("tensorListId",e,t,n),a=R("size",e,t,n),s=n.getTensorList(r.id).resize(a);return n.addTensorList(s),[s.idTensor]}default:throw TypeError(`Node type ${e.op} is not implemented`)}};function _F(e,t,n){let[r,a]=R("fusedOps",e,t,n),s=r==="biasadd",o=!s,l=a==="prelu",c=r==="fusedbatchnorm",d=R("numArgs",e,t,n);if(s){if(l&&d!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&s&&d!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");let u=R("strides",e,t,n),h=Rw(e,t,n),p=R("dataFormat",e,t,n).toUpperCase(),m=R("dilations",e,t,n),[f,g]=R("args",e,t,n);o&&(g=f,f=void 0);let x=R("leakyreluAlpha",e,t,n);return{stride:u,pad:h,dataFormat:p,dilations:m,biasArg:f,preluArg:g,activationFunc:a,leakyreluAlpha:x}}var Oje=(e,t,n,r=Aa)=>{switch(e.op){case"Conv1D":{let a=R("stride",e,t,n),s=R("pad",e,t,n),o=R("dataFormat",e,t,n).toUpperCase(),l=R("dilation",e,t,n);return[r.conv1d(R("x",e,t,n),R("filter",e,t,n),a,s,o,l)]}case"Conv2D":{let a=R("strides",e,t,n),s=Rw(e,t,n),o=R("dataFormat",e,t,n).toUpperCase(),l=R("dilations",e,t,n);return[r.conv2d(R("x",e,t,n),R("filter",e,t,n),[a[1],a[2]],s,o,[l[1],l[2]])]}case"_FusedConv2D":{let{stride:a,pad:s,dataFormat:o,dilations:l,biasArg:c,preluArg:d,activationFunc:u,leakyreluAlpha:h}=_F(e,t,n);return[r.fused.conv2d({x:R("x",e,t,n),filter:R("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:o,dilations:[l[1],l[2]],bias:c,activation:u,preluActivationWeights:d,leakyreluAlpha:h})]}case"FusedDepthwiseConv2dNative":{let{stride:a,pad:s,dataFormat:o,dilations:l,biasArg:c,preluArg:d,activationFunc:u,leakyreluAlpha:h}=_F(e,t,n);return[r.fused.depthwiseConv2d({x:R("x",e,t,n),filter:R("filter",e,t,n),strides:[a[1],a[2]],pad:s,dataFormat:o,dilations:[l[1],l[2]],bias:c,activation:u,preluActivationWeights:d,leakyreluAlpha:h})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{let a=R("outputShape",e,t,n),s=R("strides",e,t,n),o=Rw(e,t,n);return[r.conv2dTranspose(R("x",e,t,n),R("filter",e,t,n),a,[s[1],s[2]],o)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{let a=R("strides",e,t,n),s=Rw(e,t,n),o=R("dilations",e,t,n),l=R("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(R("input",e,t,n),R("filter",e,t,n),[a[1],a[2]],s,l,[o[1],o[2]])]}case"Conv3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("dataFormat",e,t,n).toUpperCase(),l=R("dilations",e,t,n);return[r.conv3d(R("x",e,t,n),R("filter",e,t,n),[a[1],a[2],a[3]],s,o,[l[1],l[2],l[3]])]}case"AvgPool":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("kernelSize",e,t,n);return[r.avgPool(R("x",e,t,n),[o[1],o[2]],[a[1],a[2]],s)]}case"MaxPool":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("kernelSize",e,t,n);return[r.maxPool(R("x",e,t,n),[o[1],o[2]],[a[1],a[2]],s)]}case"MaxPoolWithArgmax":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("kernelSize",e,t,n),l=R("includeBatchInIndex",e,t,n),{result:c,indexes:d}=r.maxPoolWithArgmax(R("x",e,t,n),[o[1],o[2]],[a[1],a[2]],s,l);return[c,d]}case"AvgPool3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("kernelSize",e,t,n);return[r.avgPool3d(R("x",e,t,n),[o[1],o[2],o[3]],[a[1],a[2],a[3]],s)]}case"MaxPool3D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("kernelSize",e,t,n);return[r.maxPool3d(R("x",e,t,n),[o[1],o[2],o[3]],[a[1],a[2],a[3]],s)]}case"Dilation2D":{let a=R("strides",e,t,n),s=R("pad",e,t,n),o=R("dilations",e,t,n),l=a[1],c=a[2],d=o[1],u=o[2];return[r.dilation2d(R("x",e,t,n),R("filter",e,t,n),[l,c],s,[d,u],"NHWC")]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Lje=(e,t,n,r=Aa)=>{switch(e.op){case"Fill":{let a=R("shape",e,t,n),s=R("dtype",e,t,n),o=R("value",e,t,n);return[r.fill(a,o,s)]}case"LinSpace":{let a=R("start",e,t,n),s=R("stop",e,t,n),o=R("num",e,t,n);return[r.linspace(a,s,o)]}case"Multinomial":{let a=R("logits",e,t,n),s=R("numSamples",e,t,n),o=R("seed",e,t,n);return[r.multinomial(a,s,o)]}case"OneHot":{let a=R("indices",e,t,n),s=R("depth",e,t,n),o=R("onValue",e,t,n),l=R("offValue",e,t,n),c=R("dtype",e,t,n);return[r.oneHot(a,s,o,l,c)]}case"Ones":return[r.ones(R("shape",e,t,n),R("dtype",e,t,n))];case"OnesLike":return[r.onesLike(R("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(R("shape",e,t,n),R("dtype",e,t,n),R("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(R("shape",e,t,n),R("minval",e,t,n),R("maxval",e,t,n),R("dtype",e,t,n))];case"RandomUniformInt":return[r.randomUniformInt(R("shape",e,t,n),R("minval",e,t,n),R("maxval",e,t,n),R("seed",e,t,n))];case"Range":{let a=R("start",e,t,n),s=R("stop",e,t,n),o=R("step",e,t,n);return[r.range(a,s,o,R("dtype",e,t,n))]}case"TruncatedNormal":{let a=R("shape",e,t,n),s=R("mean",e,t,n),o=R("stdDev",e,t,n),l=R("seed",e,t,n);return[r.truncatedNormal(a,s,o,R("dtype",e,t,n),l)]}case"Zeros":return[r.zeros(R("shape",e,t,n),R("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function ZS(e,t,n){let r=R("boxes",e,t,n),a=R("scores",e,t,n),s=R("maxOutputSize",e,t,n),o=R("iouThreshold",e,t,n),l=R("scoreThreshold",e,t,n),c=R("softNmsSigma",e,t,n);return{boxes:r,scores:a,maxOutputSize:s,iouThreshold:o,scoreThreshold:l,softNmsSigma:c}}var zje=async(e,t,n,r,a=Aa)=>{switch(e.op){case"NonMaxSuppressionV5":{let{boxes:s,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:d,softNmsSigma:u}=ZS(e,t,n),h=await a.image.nonMaxSuppressionWithScoreAsync(s,o,l,c,d,u);return[h.selectedIndices,h.selectedScores]}case"NonMaxSuppressionV4":{let{boxes:s,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:d}=ZS(e,t,n),u=R("padToMaxOutputSize",e,t,n),h=await a.image.nonMaxSuppressionPaddedAsync(s,o,l,c,d,u);return[h.selectedIndices,h.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{let{boxes:s,scores:o,maxOutputSize:l,iouThreshold:c,scoreThreshold:d}=ZS(e,t,n);return[await a.image.nonMaxSuppressionAsync(s,o,l,c,d)]}case"Where":{let s=a.cast(R("condition",e,t,n),"bool"),o=[await a.whereAsync(s)];return s.dispose(),o}case"ListDiff":return a.setdiff1dAsync(R("x",e,t,n),R("y",e,t,n));default:throw TypeError(`Node type ${e.op} is not implemented`)}},Bje=(e,t,n,r=Aa)=>{switch(e.op){case"LowerBound":{let a=R("sortedSequence",e,t,n),s=R("values",e,t,n);return[r.lowerBound(a,s)]}case"TopKV2":{let a=R("x",e,t,n),s=R("k",e,t,n),o=R("sorted",e,t,n),l=r.topk(a,s,o);return[l.values,l.indices]}case"UpperBound":{let a=R("sortedSequence",e,t,n),s=R("values",e,t,n);return[r.upperBound(a,s)]}case"Unique":{let a=R("x",e,t,n),s=r.unique(a);return[s.values,s.indices]}case"UniqueV2":{let a=R("x",e,t,n),s=R("axis",e,t,n),o=r.unique(a,s);return[o.values,o.indices]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Wje=(e,t,n,r=Aa)=>{switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":let a=R("default",e,t,n);return[Ma(e.name,t,n)||a];case"Placeholder":return[Ma(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{let u=R("x",e,t,n);return[Il(u)]}case"IdentityN":return R("x",e,t,n).map(u=>Il(u));case"Snapshot":let s=R("x",e,t,n);return[Il(s)];case"Shape":return[r.tensor1d(R("x",e,t,n).shape,"int32")];case"ShapeN":return R("x",e,t,n).map(u=>r.tensor1d(u.shape));case"Size":return[r.scalar(R("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(R("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":let o=R("x",e,t,n),l=R("data",e,t,n),c=R("message",e,t,n),d=R("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(let u=0;u<l.length;u++)console.log(Array.prototype.slice.call(l[u].dataSync()).slice(0,d));return[o];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Uje=class{get id(){return this.handle.id}constructor(e,t){this.keyDType=e,this.valueDType=t,this.handle=Rt(0),this.tensorMap=new Map,la(this.handle)}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Rt(this.size(),"int32")}async import(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return this.tensorMap.forEach(r=>r.dispose()),this.tensorMap.clear(),fe(()=>{let r=Ur(t),a=n.length,s=r.length;E.assert(a===s,()=>`The number of elements doesn't match, keys has ${a} elements, the values has ${s} elements.`);for(let o=0;o<a;o++){let l=n[o],c=r[o];la(c),this.tensorMap.set(l,c)}return this.handle})}async find(e,t){this.checkKeyAndValueTensor(e,t);let n=await e.data();return fe(()=>{let r=[];for(let a=0;a<n.length;a++){let s=n[a],o=this.findWithDefault(s,t);r.push(o)}return Jr(r)})}findWithDefault(e,t){let n=this.tensorMap.get(e);return n??t}checkKeyAndValueTensor(e,t){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(t.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${t.dtype}`)}},Vje=async(e,t,n,r)=>{switch(e.op){case"HashTable":case"HashTableV2":{let a=r.getHashTableHandleByName(e.name);if(a!=null)return[a];{let s=R("keyDType",e,t,n),o=R("valueDType",e,t,n),l=new Uje(s,o);return r.addHashTable(e.name,l),[l.handle]}}case"InitializeTable":case"InitializeTableV2":case"LookupTableImport":case"LookupTableImportV2":{let a=R("tableHandle",e,t,n,r),s=R("keys",e,t,n),o=R("values",e,t,n);return[await r.getHashTableById(a.id).import(s,o)]}case"LookupTableFind":case"LookupTableFindV2":{let a=R("tableHandle",e,t,n,r),s=R("keys",e,t,n),o=R("defaultValue",e,t,n);return[await r.getHashTableById(a.id).find(s,o)]}case"LookupTableSize":case"LookupTableSizeV2":{let a=R("tableHandle",e,t,n,r);return[r.getHashTableById(a.id).tensorSize()]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Hje=(e,t,n,r=Aa)=>{switch(e.op){case"ResizeBilinear":{let a=R("images",e,t,n),s=R("size",e,t,n),o=R("alignCorners",e,t,n),l=R("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[s[0],s[1]],o,l)]}case"ResizeNearestNeighbor":{let a=R("images",e,t,n),s=R("size",e,t,n),o=R("alignCorners",e,t,n),l=R("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(a,[s[0],s[1]],o,l)]}case"CropAndResize":{let a=R("image",e,t,n),s=R("boxes",e,t,n),o=R("boxInd",e,t,n),l=R("cropSize",e,t,n),c=R("method",e,t,n),d=R("extrapolationValue",e,t,n);return[r.image.cropAndResize(a,s,o,l,c,d)]}case"ImageProjectiveTransformV3":{let a=R("images",e,t,n),s=R("transforms",e,t,n),o=R("outputShape",e,t,n),l=R("fillValue",e,t,n),c=R("interpolation",e,t,n),d=R("fillMode",e,t,n);return[r.image.transform(a,s,c.toLowerCase(),d.toLowerCase(),l,o)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Gje=(e,t,n,r=Aa)=>{switch(e.op){case"Equal":return[r.equal(R("a",e,t,n),R("b",e,t,n))];case"NotEqual":return[r.notEqual(R("a",e,t,n),R("b",e,t,n))];case"Greater":return[r.greater(R("a",e,t,n),R("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(R("a",e,t,n),R("b",e,t,n))];case"Less":return[r.less(R("a",e,t,n),R("b",e,t,n))];case"LessEqual":return[r.lessEqual(R("a",e,t,n),R("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(R("a",e,t,n),R("b",e,t,n))];case"LogicalNot":return[r.logicalNot(R("a",e,t,n))];case"LogicalOr":return[r.logicalOr(R("a",e,t,n),R("b",e,t,n))];case"Select":case"SelectV2":return[r.where(R("condition",e,t,n),R("a",e,t,n),R("b",e,t,n))];case"BitwiseAnd":return[r.bitwiseAnd(R("a",e,t,n),R("b",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},qje=(e,t,n,r=Aa)=>{switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(R("a",e,t,n),R("b",e,t,n),R("transposeA",e,t,n),R("transposeB",e,t,n))];case"Einsum":return[r.einsum(R("equation",e,t,n),...R("tensors",e,t,n))];case"Transpose":return[r.transpose(R("x",e,t,n),R("perm",e,t,n))];case"_FusedMatMul":let[a,s]=R("fusedOps",e,t,n),o=a==="biasadd",l=s==="prelu",c=R("numArgs",e,t,n),d=R("leakyreluAlpha",e,t,n);if(o){if(l&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}let[u,h]=R("args",e,t,n);return[r.fused.matMul({a:R("a",e,t,n),b:R("b",e,t,n),transposeA:R("transposeA",e,t,n),transposeB:R("transposeB",e,t,n),bias:u,activation:s,preluActivationWeights:h,leakyreluAlpha:d})];case"MatrixBandPart":return[r.linalg.bandPart(R("a",e,t,n),R("numLower",e,t,n),R("numUpper",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Kje=(e,t,n,r=Aa)=>{switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(R("x",e,t,n),R("axis",e,t,n),R("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(R("x",e,t,n),R("mean",e,t,n),R("variance",e,t,n),R("offset",e,t,n),R("scale",e,t,n),R("epsilon",e,t,n))];case"FusedBatchNormV3":return[r.batchNorm(R("x",e,t,n),R("mean",e,t,n),R("variance",e,t,n),R("offset",e,t,n),R("scale",e,t,n),R("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(R("x",e,t,n),R("radius",e,t,n),R("bias",e,t,n),R("alpha",e,t,n),R("beta",e,t,n))];case"Softmax":return[r.softmax(R("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Yje=(e,t,n,r=Aa)=>{switch(e.op){case"RaggedGather":{let{outputNestedSplits:a,outputDenseValues:s}=r.raggedGather(R("paramsNestedSplits",e,t,n),R("paramsDenseValues",e,t,n),R("indices",e,t,n),R("outputRaggedRank",e,t,n));return a.concat(s)}case"RaggedRange":{let{rtNestedSplits:a,rtDenseValues:s}=r.raggedRange(R("starts",e,t,n),R("limits",e,t,n),R("splits",e,t,n));return[a,s]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(R("shape",e,t,n),R("values",e,t,n),R("defaultValue",e,t,n),R("rowPartitionTensors",e,t,n),R("rowPartitionTypes",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Xje=(e,t,n,r=Aa)=>{switch(e.op){case"Max":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.max(R("x",e,t,n),l,c)]}case"Mean":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.mean(R("x",e,t,n),l,c)]}case"Min":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.min(R("x",e,t,n),l,c)]}case"Sum":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.sum(R("x",e,t,n),l,c)]}case"All":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.all(R("x",e,t,n),l,c)]}case"Any":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.any(R("x",e,t,n),l,c)]}case"ArgMax":{let l=R("axis",e,t,n);return[r.argMax(R("x",e,t,n),l)]}case"ArgMin":{let l=R("axis",e,t,n);return[r.argMin(R("x",e,t,n),l)]}case"Prod":{let l=R("axis",e,t,n),c=R("keepDims",e,t,n);return[r.prod(R("x",e,t,n),l,c)]}case"Cumprod":{let l=R("axis",e,t,n),c=R("exclusive",e,t,n),d=R("reverse",e,t,n);return[r.cumprod(R("x",e,t,n),l,c,d)]}case"Cumsum":{let l=R("axis",e,t,n),c=R("exclusive",e,t,n),d=R("reverse",e,t,n);return[r.cumsum(R("x",e,t,n),l,c,d)]}case"Bincount":let a=R("x",e,t,n),s=R("weights",e,t,n),o=R("size",e,t,n);return[r.bincount(a,s,o)];case"DenseBincount":{let l=R("x",e,t,n),c=R("weights",e,t,n),d=R("size",e,t,n),u=R("binaryOutput",e,t,n);return[r.denseBincount(l,c,d,u)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Zje=(e,t,n,r=Aa)=>{switch(e.op){case"ConcatV2":case"Concat":{let a=R("n",e,t,n),s=R("axis",e,t,n),o=R("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,s)]}case"Gather":{let a=R("x",e,t,n),s=R("indices",e,t,n);return[r.gather(a,r.cast(s,"int32"),0)]}case"GatherV2":{let a=R("axis",e,t,n),s=R("batchDims",e,t,n),o=R("x",e,t,n),l=R("indices",e,t,n);return[r.gather(o,r.cast(l,"int32"),a,s)]}case"Reverse":{let a=R("dims",e,t,n),s=[];for(let l=0;l<a.length;l++)a[l]&&s.push(l);let o=R("x",e,t,n);return[r.reverse(o,s)]}case"ReverseV2":{let a=R("axis",e,t,n),s=R("x",e,t,n);return[r.reverse(s,a)]}case"Slice":{let a=R("begin",e,t,n),s=R("size",e,t,n);return[r.slice(R("x",e,t,n),a,s)]}case"StridedSlice":{let a=R("begin",e,t,n),s=R("end",e,t,n),o=R("strides",e,t,n),l=R("beginMask",e,t,n),c=R("endMask",e,t,n),d=R("ellipsisMask",e,t,n),u=R("newAxisMask",e,t,n),h=R("shrinkAxisMask",e,t,n),p=R("x",e,t,n);return[r.stridedSlice(p,a,s,o,l,c,d,u,h)]}case"Pack":return fe(()=>{let a=R("axis",e,t,n),s=R("tensors",e,t,n),o=s[0].shape,l=r.squeeze(s[0]).shape,c=s.map(d=>{let u=E.arraysEqual(d.shape,o);if(!u&&!E.arraysEqual(r.squeeze(d).shape,l))throw new Error("the input tensors shape does not match");return u?d:r.reshape(d,o)});return[r.stack(c,a)]});case"Unpack":{let a=R("axis",e,t,n),s=R("tensor",e,t,n);return r.unstack(s,a)}case"Tile":{let a=R("reps",e,t,n);return[r.tile(R("x",e,t,n),a)]}case"Split":case"SplitV":{let a=R("axis",e,t,n),s=R("numOrSizeSplits",e,t,n),o=R("x",e,t,n);return r.split(o,s,a)}case"ScatterNd":{let a=R("indices",e,t,n),s=R("values",e,t,n),o=R("shape",e,t,n);return[r.scatterND(a,s,o)]}case"GatherNd":{let a=R("x",e,t,n),s=R("indices",e,t,n);return[r.gatherND(a,s)]}case"SparseToDense":{let a=R("sparseIndices",e,t,n),s=R("outputShape",e,t,n),o=R("sparseValues",e,t,n),l=R("defaultValue",e,t,n);return[r.sparseToDense(a,o,s,o.dtype===l.dtype?l:r.cast(l,o.dtype))]}case"TensorScatterUpdate":{let a=R("indices",e,t,n),s=R("values",e,t,n),o=R("tensor",e,t,n);return[r.tensorScatterUpdate(o,a,s)]}default:throw TypeError(`Node type ${e.op} is not implemented`)}},Qje=(e,t,n,r=Aa)=>{switch(e.op){case"SparseFillEmptyRows":{let{outputIndices:a,outputValues:s,emptyRowIndicator:o,reverseIndexMap:l}=r.sparse.sparseFillEmptyRows(R("indices",e,t,n),R("values",e,t,n),R("denseShape",e,t,n),R("defaultValue",e,t,n));return[a,s,o,l]}case"SparseReshape":{let{outputIndices:a,outputShape:s}=r.sparse.sparseReshape(R("inputIndices",e,t,n),R("inputShape",e,t,n),R("newShape",e,t,n));return[a,s]}case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(R("data",e,t,n),R("indices",e,t,n),R("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(R("data",e,t,n),R("indices",e,t,n),R("segmentIds",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},Jje=(e,t,n,r=Aa)=>{switch(e.op){case"FFT":return[r.fft(R("x",e,t,n))];case"IFFT":return[r.ifft(R("x",e,t,n))];case"RFFT":return[r.rfft(R("x",e,t,n))];case"IRFFT":return[r.irfft(R("x",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},eIe=(e,t,n,r=Aa)=>{switch(e.op){case"StaticRegexReplace":return[r.string.staticRegexReplace(R("input",e,t,n),R("pattern",e,t,n),R("rewrite",e,t,n),R("replaceGlobal",e,t,n))];case"StringNGrams":{let{nGrams:a,nGramsSplits:s}=r.string.stringNGrams(R("data",e,t,n),R("dataSplits",e,t,n),R("separator",e,t,n),R("nGramWidths",e,t,n),R("leftPad",e,t,n),R("rightPad",e,t,n),R("padWidth",e,t,n),R("preserveShortSequences",e,t,n));return[a,s]}case"StringSplit":{let{indices:a,values:s,shape:o}=r.string.stringSplit(R("input",e,t,n),R("delimiter",e,t,n),R("skipEmpty",e,t,n));return[a,s,o]}case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(R("input",e,t,n),R("numBuckets",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}},tIe=(e,t,n,r=Aa)=>{switch(e.op){case"Cast":return[r.cast(R("x",e,t,n),R("dtype",e,t,n))];case"ExpandDims":{let a=R("axis",e,t,n);return[r.expandDims(R("x",e,t,n),a)]}case"Squeeze":{let a=R("axis",e,t,n);return[r.squeeze(R("x",e,t,n),a)]}case"Reshape":return[r.reshape(R("x",e,t,n),R("shape",e,t,n))];case"EnsureShape":return[r.ensureShape(R("x",e,t,n),R("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(R("x",e,t,n),R("padding",e,t,n),R("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(R("x",e,t,n),R("padding",e,t,n),R("constantValue",e,t,n))];case"SpaceToBatchND":{let a=R("blockShape",e,t,n),s=R("paddings",e,t,n);return[r.spaceToBatchND(R("x",e,t,n),a,s)]}case"BatchToSpaceND":{let a=R("blockShape",e,t,n),s=R("crops",e,t,n);return[r.batchToSpaceND(R("x",e,t,n),a,s)]}case"DepthToSpace":{let a=R("blockSize",e,t,n),s=R("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(R("x",e,t,n),a,s)]}case"BroadcastTo":return[r.broadcastTo(R("x",e,t,n),R("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(R("s0",e,t,n),R("s1",e,t,n))];default:throw TypeError(`Node type ${e.op} is not implemented`)}};function jF(e,t,n,r,a=fe){let s=((o,l,c)=>{switch(o.category){case"arithmetic":return a(()=>Eje(o,l,c));case"basic_math":return a(()=>Aje(o,l,c));case"control":return Pje(o,l,c);case"convolution":return a(()=>Oje(o,l,c));case"creation":return a(()=>Lje(o,l,c));case"dynamic":return zje(o,l,c);case"evaluation":return a(()=>Bje(o,l,c));case"image":return a(()=>Hje(o,l,c));case"graph":return a(()=>Wje(o,l,c));case"logical":return a(()=>Gje(o,l,c));case"matrices":return a(()=>qje(o,l,c));case"normalization":return a(()=>Kje(o,l,c));case"ragged":return a(()=>Yje(o,l,c));case"reduction":return a(()=>Xje(o,l,c));case"slice_join":return a(()=>Zje(o,l,c));case"sparse":return a(()=>Qje(o,l,c));case"spectral":return a(()=>Jje(o,l,c));case"string":return a(()=>eIe(o,l,c));case"transformation":return a(()=>tIe(o,l,c));case"hash_table":return Vje(o,l,c,r);case"custom":let d=X8(o.op);if(d&&d.customExecutor)return d.customExecutor(new Tje(o,l,c));throw TypeError(`Custom op ${o.op} is not registered.`);default:throw TypeError(`Unknown op '${o.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(e,t,n);return E.isPromise(s)?s.then(o=>[].concat(o)):[].concat(s)}var IF=class{constructor(e={},t={},n={},r={},a){this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=r,this.parseNodeNameCache=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,t){return{id:e,frameName:t,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){let e=[];for(let t=0;t<this.contexts.length-1;t++){let n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(t=>t.id===0&&t.iterationId===0?"":`${t.frameName}-${t.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;let e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(let t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(let t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)}};function TF(e,t,n,r){let a=new Set,s=[],o=null,l=null,c=new Set,d=new Set(Object.keys(e).map(p=>Ps(p)[0]));r=r||[];let u=new Set(r.map(p=>Ps(p.name)[0])),h=[...t];for(;h.length>0;){let p=h.pop();if((dd(p)||cIe(p)||uIe(p))&&o==null&&(o=p,l=o.children.map(m=>m.name).filter(m=>a.has(m))),a.add(p.name),n[p.name]==null&&!d.has(p.name)&&!u.has(p.name)){if(p.inputs.length===0){s.push(p.name);continue}p.inputs.forEach(m=>{c.has(m.name)||(c.add(m.name),h.push(m))})}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:s,dynamicNode:o,syncInputs:l}}function nIe(e,t){let{usedNodes:n,inputs:r}=t,a=Object.keys(r).map(x=>Ps(x)[0]).map(x=>e.nodes[x]),s=e.initNodes||[],o=x=>n.has(typeof x=="string"?x:x.name);function l(x){return[...new Map(x.map(y=>[y.name,y])).values()]}let c=l([...a,...e.weights,...s]).filter(o),d=l([...c,...Object.values(e.nodes)]).filter(o),u=new Map(d.map(x=>[x.name,x])),h={};for(let x of d){h[x.name]=h[x.name]||0;for(let y of x.children)o(y)||(h[y.name]=Number.POSITIVE_INFINITY),h[y.name]=(h[y.name]||0)+1}let p=Object.entries(h).filter(([,x])=>x===0).map(([x])=>x),m=[...p];for(;p.length>0;){let x=p.pop(),y=u.get(x);for(let b of y.children.filter(o))--h[b.name]===0&&(m.push(b.name),p.push(b.name))}let f=m.map(x=>u.get(x)),g=rIe(f,c);return aIe(g,c),g}function rIe(e,t){let n=new Map(e.map(s=>[s.name,s])),r=t.map(s=>s.name),a=new Set(r);for(;r.length>0;){let s=r.pop(),o=n.get(s);for(let l of o.children)!n.has(l.name)||a.has(l.name)||(a.add(l.name),r.push(l.name))}return e.filter(s=>a.has(s.name))}var aw=class extends Error{constructor(e){super(`NodesExecutionOrderError: ${e}`)}};function aIe(e,t){let n=new Map(e.map((l,c)=>[l.name,c])),r=new Set(t.map(l=>l.name)),a=l=>r.has(typeof l=="string"?l:l.name),s=new Set(e.map(l=>l.name)),o=l=>s.has(typeof l=="string"?l:l.name);for(let l of e){for(let c of l.children.filter(o)){if(!n.has(c.name))throw new aw(`Child ${c.name} of node ${l.name} is unreachable.`);if(n.get(l.name)>n.get(c.name))throw new aw(`Node ${l.name} is scheduled to run after its child ${c.name}.`)}if(!a(l))for(let c of l.inputs){if(!n.has(c.name))throw new aw(`Input ${c.name} of node ${l.name} is unreachable.`);if(n.get(c.name)>n.get(l.name))throw new aw(`Node ${l.name} is scheduled to run before its input ${c.name}.`)}}}function sIe(e){let t=new Map(e.map((l,c)=>[l.name,c])),n=Number.MAX_SAFE_INTEGER,r=e.map((l,c)=>dd(l)?n:c),a=l=>{let c=r[t.get(l.name)];return c??-1},s=e.map((l,c)=>l.children.map(a).reduce((d,u)=>Math.max(d,u),r[c])),o=new Map;for(let l=0;l<e.length;++l){let c=s[l];if(c===n)continue;let d=e[l],u=e[c];o.has(u.name)||o.set(u.name,[]),o.get(u.name).push(d)}return o}var iIe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),oIe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),lIe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function dd(e){return iIe.has(e.op)}function cIe(e){return oIe.has(e.op)}function uIe(e){return lIe.has(e.op)}var EF=class yH{get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(t){let n=Object.keys(t).map(r=>t[r].map(a=>a.id));this._weightIds=[].concat(...n),this._weightMap=t}set resourceManager(t){this._resourceManager=t}get inputs(){return this._inputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(t=>({name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(t=>t.signatureKey||t.name)}get outputNodes(){return this._outputs.map(t=>{let n=t.signatureKey||t.name;return t.defaultOutput?`${n}:${t.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((t,n)=>(t[n]=this._functions[n].signature,t),{})}constructor(t,n){this.graph=t,this.parent=n,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,t.functions!=null&&Object.keys(t.functions).forEach(r=>{this._functionExecutorMap[r]=new yH(t.functions[r],this)})}getCompilationKey(t,n){let r=t.map(s=>s.name).sort(),a=n.map(s=>s.name).sort();return r.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)}compile(t,n){let r=TF(t,n,this.weightMap,this._initNodes),{missingInputs:a,dynamicNode:s,syncInputs:o}=r;if(s!=null)throw new Error(`This execution contains the node '${s.name}', which has the dynamic op '${s.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${o}]`);if(a.length>0){let d=n.map(h=>h.name),u=Object.keys(t);throw new Error(`Cannot compute the outputs [${d}] from the provided inputs [${u}]. Missing the following inputs: [${a}]`)}let l=nIe(this.graph,r),c=sIe(l);return{orderedNodes:l,nodeLiveUntilMap:c}}cloneAndKeepTensor(t){if(t==null)return null;let n=t.clone();return la(n),n}cloneTensorList(t){return t?t.map(n=>this.cloneAndKeepTensor(n)):null}cloneTensorMap(t){return Object.fromEntries(Object.entries(t).map(([n,r])=>[n,this.cloneTensorList(r)]))}execute(t,n){this.disposeIntermediateTensors(),t=this.mapInputs(t);let r=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n);let a=r.map(p=>this.graph.nodes[Ps(p)[0]]),s=n.map(p=>Ps(p)[0]),o=new Set(s),l=s.map(p=>this.graph.nodes[p]);l.length===0&&(l=this._outputs);let c=this.getCompilationKey(a,l),d=this.compiledMap.get(c);d==null&&(d=this.compile(t,l),this.compiledMap.set(c,d));try{this.keepIntermediateTensors=_e().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}let u={},h={};return fe(()=>{let p=new IF(this.weightMap,u,h,this.functionExecutorMap,this.parseNodeNameCache),m=Object.assign({},this.weightMap);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),Object.keys(t).forEach(y=>{let[b,v]=Ps(y,p),w=[];w[v]=t[y],m[b]=w,this.keepIntermediateTensors&&(this.clonedTensorsMap[b]=this.cloneTensorList(w))});let f=this.getFrozenTensorIds(m),{orderedNodes:g,nodeLiveUntilMap:x}=d;for(let y of g){if(m[y.name])continue;let b=jF(y,m,p,this._resourceManager);if(E.isPromise(b))throw new Error(`The execution of the op '${y.op}' returned a promise. Please use model.executeAsync() instead.`);m[y.name]=b,this.keepIntermediateTensors&&(this.clonedTensorsMap[y.name]=this.cloneTensorList(b)),this.checkTensorForDisposalWithNodeLiveUntilInfo(y,m,p,f,o,x.get(y.name))}return this.parent==null&&p.dispose(f),n.map(y=>Ma(y,m,p))})}getFrozenTensorIds(t){let n=[].concat.apply([],Object.keys(t).map(r=>t[r]).map(r=>r.map(a=>a.id)));return new Set(n)}checkTensorForDisposal(t,n,r,a,s,o,l){if(!(dd(n)||o.has(t))){for(let c of r[t])c!=null&&(l[c.id]=(l[c.id]||0)+n.children.length);for(let c of n.inputs){if(dd(c))continue;let d=NF(c.name,r,a);if(d!=null)for(let u of d){if(!u||u.kept||s.has(u.id))continue;let h=l[u.id];h===1?(u.dispose(),delete l[u.id]):h!=null&&l[u.id]--}}}}checkTensorForDisposalWithNodeLiveUntilInfo(t,n,r,a,s,o){function l(c){return dd(c)||s.has(c.name)}if(!(dd(t)||o==null))for(let c of o){if(l(c))continue;let d=NF(c.name,n,r);for(let u of d)!u||u.kept||a.has(u.id)||u.dispose()}}async executeAsync(t,n){return this._executeAsync(t,n)}disposeIntermediateTensors(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach(t=>{for(let n of t)n&&!n.isDisposed&&n.dispose()}),this.clonedTensorsMap=null)}getIntermediateTensors(){return this.clonedTensorsMap}async _executeAsync(t,n,r=!1,a={},s={}){this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=_e().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}let o=new IF(this.weightMap,a,s,this.functionExecutorMap,this.parseNodeNameCache);this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap));let l=await this.executeWithControlFlow(t,o,n,r),c=n.map(p=>Ma(p,l,o)),d=c.map(p=>p.id),u=Object.keys(t).map(p=>t[p].id),h=new Set([...d,...u,...this.weightIds]);return Object.values(l).forEach(p=>{p.forEach(m=>{m&&!m.isDisposed&&!h.has(m.id)&&m.dispose()})}),this.parent==null&&o.dispose(h),c}async executeFunctionAsync(t,n,r){let a=t.reduce((s,o,l)=>(s[this.inputs[l].name]=o,s),{});return this._executeAsync(a,this.outputNodes,!0,n,r)}async executeWithControlFlow(t,n,r,a){let s=Object.keys(t),o=s.map(w=>this.graph.nodes[Ps(w)[0]]),l=r.map(w=>Ps(w)[0]),c=new Set(l),d=l.map(w=>this.graph.nodes[w]);d.length===0&&(d=this._outputs);let{usedNodes:u,missingInputs:h,dynamicNode:p,syncInputs:m}=TF(t,d,this.weightMap,this._initNodes),f=[...o,...this.graph.weights,...this._initNodes||[]].map(w=>({node:w,contexts:n.currentContext})),g=Object.assign({},this.weightMap);Object.keys(t).forEach(w=>{let[k,C]=Ps(w),S=[];S[C]=t[w],g[k]=S});let x={},y=this.getFrozenTensorIds(g),b={};for(;f.length>0;){let w=this.processStack(o,f,n,g,b,y,c,x,u);await Promise.all(w)}p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");let v=d.filter(w=>!dd(w)&&!Ma(w.name,g,n)).map(w=>w.name);if(v.length>0){let w="";throw p!=null&&(w=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${m}]`),new Error(`Cannot compute the outputs [${v}] from the provided inputs [${s}]. Consider providing the following inputs: [${h}]. ${w}`)}return g}processStack(t,n,r,a,s,o,l,c,d){let u=[];for(;n.length>0;){let h=n.pop();r.currentContext=h.contexts;let p="";if(h.node.op==="Enter"&&R("isConstant",h.node,a,r)&&([p]=jl(h.node.name,r)),a[h.node.name]==null){let m=jF(h.node,a,r,this._resourceManager);p||([p]=jl(h.node.name,r));let f=r.currentContext;E.isPromise(m)?u.push(m.then(g=>(a[p]=g,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(g)),r.currentContext=f,this.checkTensorForDisposal(p,h.node,a,r,o,l,c),this.processChildNodes(h.node,n,r,a,s,d),g))):(a[p]=m,this.keepIntermediateTensors&&(this.clonedTensorsMap[p]=this.cloneTensorList(m)),this.checkTensorForDisposal(p,h.node,a,r,o,l,c),this.processChildNodes(h.node,n,r,a,s,d))}else this.processChildNodes(h.node,n,r,a,s,d)}return u}processChildNodes(t,n,r,a,s,o){t.children.forEach(l=>{let[c]=jl(l.name,r);s[c]||!o.has(l.name)||(l.op==="Merge"?l.inputNames.some(d=>!!Ma(d,a,r))&&(s[c]=!0,n.push({contexts:r.currentContext,node:l})):l.inputNames.every(d=>!!Ma(d,a,r))&&(s[c]=!0,n.push({contexts:r.currentContext,node:l})))})}dispose(){Object.keys(this.weightMap).forEach(t=>this.weightMap[t].forEach(n=>n.dispose()))}checkInputShapeAndType(t){Object.keys(t).forEach(n=>{let r=t[n],[a]=Ps(n),s=this.graph.nodes[a];if(s.attrParams.shape&&s.attrParams.shape.value){let o=s.attrParams.shape.value,l=o.length===r.shape.length&&r.shape.every((c,d)=>o[d]===-1||o[d]===c);E.assert(l,()=>`The shape of dict['${s.name}'] provided in model.execute(dict) must be [${o}], but was [${r.shape}]`)}s.attrParams.dtype&&s.attrParams.dtype.value&&E.assert(r.dtype===s.attrParams.dtype.value,()=>`The dtype of dict['${s.name}'] provided in model.execute(dict) must be ${s.attrParams.dtype.value}, but was ${r.dtype}`)})}mapInputs(t){var n,r;let a={};for(let s in t){let o=(r=(n=this._signature)===null||n===void 0?void 0:n.inputs)===null||r===void 0?void 0:r[s];o!=null?a[o.name]=t[s]:a[s]=t[s]}return a}checkInputs(t){let n=Object.keys(t).filter(r=>{let[a]=Ps(r);return this.graph.nodes[a]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(t){return t.map(n=>{var r,a;let s=(a=(r=this._signature)===null||r===void 0?void 0:r.outputs)===null||a===void 0?void 0:a[n];return s!=null?s.name:n},{})}checkOutputs(t){t.forEach(n=>{let[r]=Ps(n);if(!this.graph.nodes[r])throw new Error(`The output '${n}' is not found in the graph`)})}},dIe=class{constructor(e={},t={}){this.hashTableNameToHandle=e,this.hashTableMap=t}addHashTable(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(let e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(let e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}},hIe="?tfjs-format=file",pIe="model.json",EA=class{get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}constructor(e,t={},n=Fa){this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new dIe}findIOHandler(){let e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{let t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error(`Found more than one (${t.length}) load handlers for URL '${[e]}'`);this.handler=t[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let e=this.handler.load();return E.isPromise(e)?e.then(t=>t.getWeightStream==null?this.loadSync(t):this.loadStreaming(t)):this.loadSync(e)}loadSync(e){let t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)}async loadStreaming(e){if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");let t=await wW(e.getWeightStream(),e.weightSpecs);return this.loadWithWeightMap(e,t)}loadWithWeightMap(e,t){this.artifacts=e;let n=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){let a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}if(this.signature=r,this.version=`${n.versions.producer}.${n.versions.minConsumer}`,this.executor=new EF(kF.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){let a=kF.Instance.transformGraph(e.modelInitializer);this.initializer=new EF(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}async save(e,t){if(typeof e=="string"){let n=this.io.getSaveHandlers(e);if(n.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(n.length>1)throw new Error(`Found more than one (${n.length}) save handlers for URL '${e}'`);e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}addStructuredOutputNames(e){if(this.structuredOutputKeys){let t=e instanceof on?[e]:e,n={};return t.forEach((r,a)=>n[this.structuredOutputKeys[a]]=r),n}return e}predict(e,t){let n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}async predictAsync(e,t){let n=await this.executeAsync(e,this.outputNodes);return this.addStructuredOutputNames(n)}normalizeInputs(e){var t;if(!(e instanceof on)&&!Array.isArray(e)){let a=(t=this.signature)===null||t===void 0?void 0:t.inputs;if(a!=null)for(let s in a){let o=a[s];o.resourceId!=null&&(e[s]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];let n=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+n!==this.inputNodes.length)throw new Error(`Input tensor count mismatch, the graph model has ${this.inputNodes.length-n} non-resource placeholders, while there are ${e.length} input tensors provided.`);let r=0;return this.inputNodes.reduce((a,s)=>{var o,l,c;let d=(c=(l=(o=this.signature)===null||o===void 0?void 0:o.inputs)===null||l===void 0?void 0:l[s])===null||c===void 0?void 0:c.resourceId;return d!=null?a[s]=this.resourceIdToCapturedInput[d]:a[s]=e[r++],a},{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}executeInitializerGraph(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}async executeInitializerGraphAsync(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))}setResourceIdToCapturedInput(e){if(this.resourceIdToCapturedInput={},this.initializerSignature){let t=this.initializerSignature.outputs,n=Object.keys(t);for(let r=0;r<n.length;r++){let a=n[r],s=t[a];this.resourceIdToCapturedInput[s.resourceId]=e[r]}}}execute(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=this.executor.execute(e,t);return n.length>1?n:n[0]}async executeAsync(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(await this.executeInitializerGraphAsync()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);let n=await this.executor.executeAsync(e,t);return n.length>1?n:n[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((t,n)=>(t[n]=[e[n]],t),{})}dispose(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&tn(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}};async function mIe(e,t={},n=Fa){if(e==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");t==null&&(t={}),t.fromTFHub&&typeof e=="string"&&(e=gIe(e));let r=new EA(e,t,n);return await r.load(),r}function fIe(e){if(e==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");let t;if(e instanceof Array){let[r,a]=e;if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");let s=Fa.getWeightSpecs(r.weightsManifest),o=Fa.getModelArtifactsForJSONSync(r,s,a);t=Fa.fromMemorySync(o)}else if("load"in e)t=e;else if("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e)t=Fa.fromMemorySync(e);else throw new Error("Unknown model format");let n=new EA(t);return n.load(),n}function gIe(e){return e.endsWith("/")||(e=e+"/"),`${e}${pIe}${hIe}`}var xIe="4.22.0",bH={};nn(bH,{CSVDataset:()=>EH,Dataset:()=>Zg,FileDataSource:()=>PH,TextLineDataset:()=>TH,URLDataSource:()=>OH,array:()=>zIe,csv:()=>JIe,func:()=>eTe,generator:()=>tTe,microphone:()=>rTe,version_data:()=>aTe,webcam:()=>nTe,zip:()=>BIe});var yIe=Cu(M1()),bIe=Cu(M1());function vIe(e,t){return Z0(e,t)}function Z0(e,t,n=new Map,r=new Set){if(e==null)return null;if(typeof Blob=="function"&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(kf(e)){let s=Array.isArray(e)?[]:{};r.add(e);for(let o in e){let l=e[o],c=Z0(l,t,n,r);s[o]=c}return r.delete(e),e.__proto__&&(s.__proto__=e.__proto__),s}else throw new Error(`Can't recurse into non-iterable type: ${e}`);else return n.set(e,a.value),a.value}function wIe(e,t=wH){return vH(e,t)}function vH(e,t,n=new Set){let r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");let a=t(e);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(kf(r)){let s=Array.isArray(r)?[]:{};n.add(r);for(let o in r){let l=e.map(d=>d[o]),c=vH(l,t,n);s[o]=c}return n.delete(r),s}else throw new Error(`Can't recurse into non-iterable type: ${r}`);else return a.value}function wH(e){return e===null?null:kf(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}async function NH(e,t){let n=new Map;Z0(e,t,n);for(let r of Array.from(n.keys())){let a=n.get(r);if(E.isPromise(a)){let s=await a;n.set(r,s)}}return Z0(e,t,n)}function kf(e){let t=!1;if(_e().get("IS_BROWSER"))t=e instanceof TextDecoder;else{let{StringDecoder:n}=B6();t=e instanceof n}return e!=null&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||typeof e=="object"&&!(e instanceof on)&&!(e instanceof Promise)&&!t)}function NIe(e){return e==null||kIe(e)||Array.isArray(e)||typeof e=="object"&&e instanceof on||E.isTypedArray(e)}function kIe(e){return e===null||typeof e!="object"&&typeof e!="function"}function SIe(e){return vIe(e,CIe)}function CIe(e){return e instanceof on?{value:e.clone(),recurse:!1}:kf(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var kH=class{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let t of e)this.push(t)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}},SH=class CH extends kH{constructor(){super(CH.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){let t=this.capacity*2,n=new Array(t),r=this.length();for(let a=0;a<r;a++)n[a]=this.get(this.wrap(this.begin+a));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=r}};SH.INITIAL_CAPACITY=32;function _H(e){return new IIe(e)}function AA(e){return new TIe(e)}function _Ie(e,t){return new jH(e,t)}function jIe(e,t=Bc.FAIL){return new OIe(e,t)}var Ea=class{async toArray(){let e=[],t=await this.next();for(;!t.done;)e.push(t.value),t=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),t=[],n=await e.next();for(;!n.done;)t.push(n.value),n=await e.next();return t}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let t=await this.next(),n=e(t.value);for(;!t.done&&n;)t=await this.next(),n=e(t.value)}handleErrors(e){return new FIe(this,e)}filter(e){return new MIe(this,e)}map(e){return new $Ie(this,e)}mapAsync(e){return new AF(this,e)}serialMapAsync(e){return new AF(this,e).serial()}flatmap(e){return new PIe(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(t=>t===!0)}rowMajorBatch(e,t=!0){return new DIe(this,e,t)}columnMajorBatch(e,t=!0,n=wH){return this.rowMajorBatch(e,t).map(r=>wIe(r,n))}concatenate(e,t){return new jH(_H([this,e]),t)}take(e){return e<0||e==null?this:new RIe(this,e)}skip(e){return e<0||e==null?this:new AIe(this,e)}prefetch(e){return new IH(this,e)}shuffle(e,t){return new LIe(this,e,t)}serial(){return new EIe(this)}},IIe=class extends Ea{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:SIe(e),done:!1}}},TIe=class extends Ea{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}},EIe=class extends Ea{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}},AIe=class extends Ea{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;tn(e.value)}return this.upstream.next()}},RIe=class extends Ea{constructor(e,t){super(),this.upstream=e,this.maxCount=t,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}},DIe=class extends Ea{constructor(e,t,n=!0){super(),this.upstream=e,this.batchSize=t,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let t=await this.upstream.next();if(t.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(t.value)}return{value:e,done:!1}}},MIe=class extends Ea{constructor(e,t){super(),this.upstream=e,this.predicate=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;tn(e.value)}}},$Ie=class extends Ea{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=go.getTensorsInContainer(e.value),n=this.transform(e.value),r=go.getTensorsInContainer(n);for(let a of t)go.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},FIe=class extends Ea{constructor(e,t){super(),this.upstream=e,this.handler=t,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}},AF=class extends Ea{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let t=go.getTensorsInContainer(e.value),n=await this.transform(e.value),r=go.getTensorsInContainer(n);for(let a of t)go.isTensorInList(a,r)||a.dispose();return{value:n,done:!1}}},RA=class extends Ea{constructor(){super(),this.outputQueue=new SH,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}},PIe=class extends RA{constructor(e,t){super(),this.upstream=e,this.transform=t}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let t=go.getTensorsInContainer(e.value),n=this.transform(e.value),r=go.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(let a of t)go.isTensorInList(a,r)||a.dispose();return!0}},jH=class extends Ea{constructor(e,t){super(),this.baseErrorHandler=t,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){let n=await this.moreIterators.next();if(n.done)return{value:null,done:!0};this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let t=await this.iterator.next();return t.done?(this.iterator=null,this.readFromChain(e)):t}},Bc;(function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"})(Bc||(Bc={}));var OIe=class extends Ea{constructor(e,t=Bc.FAIL){super(),this.iterators=e,this.mismatchMode=t,this.count=0,this.currentPromise=null}summary(){return"{TODO: fill in upstream of zip summaries} -> Zip"}async nextState(e){await e;let t=0,n=0;function r(s){return s instanceof Ea?{value:s.next().then(o=>(t++,o.done&&n++,o.value)),recurse:!1}:{value:null,recurse:!0}}let a=await NH(this.iterators,r);if(t===n)return{value:null,done:!0};if(n>0)switch(this.mismatchMode){case Bc.FAIL:throw new Error(`Zipped streams should have the same length. Mismatched at element ${this.count}.`);case Bc.SHORTEST:return{value:null,done:!0};case Bc.LONGEST:}return this.count++,{value:a,done:!1}}async next(){return this.currentPromise=this.nextState(this.currentPromise),this.currentPromise}},IH=class extends Ea{constructor(e,t){super(),this.upstream=e,this.bufferSize=t,this.buffer=new kH(t)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}},LIe=class extends IH{constructor(e,t,n){super(e,t),this.upstream=e,this.windowSize=t,this.upstreamExhausted=!1,this.random=bIe.alea(n||E.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),t=await this.buffer.shuffleExcise(e);if(t.done)this.upstreamExhausted=!0;else return this.refill(),t}return{value:null,done:!0}}},Zg=class{constructor(){this.size=null}batch(e,t=!0){let n=this;E.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let r;return this.size===1/0||this.size==null?r=this.size:t?r=Math.ceil(this.size/e):r=Math.floor(this.size/e),Ms(async()=>(await n.iterator()).columnMajorBatch(e,t,WIe),r)}concatenate(e){let t=this,n;return this.size===1/0||e.size===1/0?n=1/0:this.size!=null&&e.size!=null?n=this.size+e.size:n=null,Ms(async()=>(await t.iterator()).concatenate(await e.iterator()),n)}filter(e){let t=this,n;return this.size===1/0?n=1/0:n=null,Ms(async()=>(await t.iterator()).filter(r=>fe(()=>e(r))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let t=this;return Ms(async()=>(await t.iterator()).map(n=>fe(()=>e(n))),this.size)}mapAsync(e){let t=this;return Ms(async()=>(await t.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let t=this;return Ms(async()=>(await t.iterator()).prefetch(e),this.size)}repeat(e){let t=this,n;return this.size!=null&&e>0?n=this.size*e:e===0?n=0:this.size!=null&&(e===void 0||e<0)?n=1/0:n=null,Ms(async()=>{let r=AA(async()=>({value:await t.iterator(),done:!1}));return _Ie(r.take(e))},n)}skip(e){let t=this,n;return this.size!=null&&e>=0&&this.size>=e?n=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?n=0:n=null,Ms(async()=>(await t.iterator()).skip(e),n)}shuffle(e,t,n=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let r=this,a=yIe.alea(t||E.now().toString());return Ms(async()=>{let s=a.int32();return n&&(s+=a.int32()),(await r.iterator()).shuffle(e,s.toString())},this.size)}take(e){let t=this,n;return this.size!=null&&this.size>e?n=e:this.size!=null&&this.size<=e?n=this.size:n=null,Ms(async()=>(await t.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}};Zg.MAX_BUFFER_SIZE=1e4;function Ms(e,t=null){return new class extends Zg{constructor(){super(...arguments),this.size=t}async iterator(){return e()}}}function zIe(e){return Ms(async()=>_H(e),e.length)}function BIe(e){if(!kf(e))throw new Error("The argument to zip() must be an object or array.");let t;if(Array.isArray(e))for(let n=0;n<e.length;n++)t=t==null?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(let n in e)t=t==null?e[n].size:Math.min(t,e[n].size);return Ms(async()=>{let n=await NH(e,r=>{if(r instanceof Zg)return{value:r.iterator(),recurse:!1};if(kf(r))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")});return jIe(n,Bc.SHORTEST)},t)}function WIe(e){if(e===null)return null;let t=e[0];return NIe(t)?{value:UIe(e),recurse:!1}:{value:null,recurse:!0}}function UIe(e){if(e.length===0)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof on?Jr(e):Qa(e)}var TH=class extends Zg{constructor(e){super(),this.input=e}async iterator(){return(await this.input.iterator()).decodeUTF8().split(`
`).map(e=>(e.endsWith("\r")&&(e=e.slice(0,-1)),e))}},sw='"',Ax=Symbol("out"),RF=Symbol("field"),iw=Symbol("quote"),QS=Symbol("quoteafterquote"),DF=Symbol("quoteinquote"),EH=class extends Zg{async columnNames(){return this.columnNamesValidated||await this.setColumnNames(),this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames}async setColumnNames(){let e=await this.maybeReadHeaderLine();if(!this.fullColumnNames&&!e)throw new Error("Column names must be provided if there is no header line.");this.fullColumnNames&&e&&E.assert(e.length===this.fullColumnNames.length,()=>"The length of provided columnNames ("+this.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+e.length.toString()+")."),this.fullColumnNames||(this.fullColumnNames=e);let t=this.fullColumnNames.reduce((r,a)=>(r[a]=r[a]+1||1,r),{}),n=Object.keys(t).filter(r=>t[r]>1);if(E.assert(n.length===0,()=>"Duplicate column names found: "+n.toString()),this.columnConfigs){for(let r of Object.keys(this.columnConfigs))if(this.fullColumnNames.indexOf(r)===-1)throw new Error('The key "'+r+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}this.columnNamesValidated=!0}async maybeReadHeaderLine(){if(this.hasHeader){let e=await(await this.base.iterator()).next();if(e.done)throw new Error("No data was found for CSV parsing.");let t=e.value;return this.parseRow(t,!1)}else return null}constructor(e,t){super(),this.input=e,this.hasHeader=!0,this.fullColumnNames=null,this.columnNamesValidated=!1,this.columnConfigs=null,this.configuredColumnsOnly=!1,this.delimiter=",",this.delimWhitespace=!1,this.base=new TH(e),t||(t={}),this.hasHeader=t.hasHeader!==!1,this.fullColumnNames=t.columnNames,this.columnConfigs=t.columnConfigs,this.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(E.assert(t.delimiter==null,()=>"Delimiter should not be provided when delimWhitespace is true."),this.delimWhitespace=!0,this.delimiter=" "):this.delimiter=t.delimiter?t.delimiter:","}async iterator(){this.columnNamesValidated||await this.setColumnNames();let e=await this.base.iterator();return this.hasHeader&&(e=e.skip(1)),e.map(t=>this.makeDataElement(t))}makeDataElement(e){let t=this.parseRow(e),n={},r={};for(let a=0;a<this.fullColumnNames.length;a++){let s=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!o)){let l=t[a],c=null;if(l==="")if(o&&o.default!==void 0)c=o.default;else{if(o&&(o.required||o.isLabel))throw new Error(`Required column ${s} is empty in this line: ${e}`);c=void 0}else{let d=Number(l);if(isNaN(d))o&&o.dtype==="bool"?c=this.getBoolean(l):c=l;else if(!o||!o.dtype)c=d;else switch(o.dtype){case"float32":c=d;break;case"int32":c=Math.floor(d);break;case"bool":c=this.getBoolean(l);break;default:c=d}}o&&o.isLabel?r[s]=c:n[s]=c}}return Object.keys(r).length===0?n:{xs:n,ys:r}}getBoolean(e){return e==="1"||e.toLowerCase()==="true"?1:0}parseRow(e,t=!0){let n=[],r=0,a=e.length,s=Ax;for(let o=0;o<a;o++)switch(s){case Ax:switch(e.charAt(o)){case sw:r=o+1,s=iw;break;case this.delimiter:if(r=o+1,this.delimiter===" "&&this.delimWhitespace)break;n.push(""),s=Ax;break;default:s=RF,r=o;break}break;case RF:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),s=Ax,r=o+1;break}break;case iw:switch(e.charAt(o)){case sw:s=QS;break}break;case QS:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),s=Ax,r=o+1;break;case sw:s=iw;break;default:s=DF;break}break;case DF:switch(e.charAt(o)){case sw:s=iw;break}break}if(s===QS?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error(`Invalid row in csv file. Should have ${this.fullColumnNames.length} elements in a row, but got ${n}`);return n}},VIe=class AH extends Ea{constructor(t){super(),this.microphoneConfig=t,this.isClosed=!1,this.fftSize=t.fftSize||1024;let n=Math.log2(this.fftSize);if(this.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error(`Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ${this.fftSize}`);if(this.numFrames=t.numFramesPerSpectrogram||43,this.sampleRateHz=t.sampleRateHz,this.columnTruncateLength=t.columnTruncateLength||this.fftSize,this.audioTrackConstraints=t.audioTrackConstraints,this.smoothingTimeConstant=t.smoothingTimeConstant||0,this.includeSpectrogram=t.includeSpectrogram!==!1,this.includeWaveform=t.includeWaveform===!0,!this.includeSpectrogram&&!this.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.")}summary(){return"microphone"}static async create(t={}){if(!_e().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");let n=new AH(t);return await n.start(),n}async start(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})}catch(r){throw new Error(`Error thrown while initializing video stream: ${r.message}`)}if(!this.stream)throw new Error("Could not obtain audio from microphone.");let t=window.AudioContext||window.webkitAudioContext;if(this.audioContext=new t,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error(`Mismatch in sampling rate: Expected: ${this.sampleRateHz}; Actual: ${this.audioContext.sampleRate}`);let n=this.audioContext.createMediaStreamSource(this.stream);this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize)}async next(){if(this.isClosed)return{value:null,done:!0};let t,n,r=await this.getAudioData();if(this.includeSpectrogram){let a=this.flattenQueue(r.freqDataQueue);t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])}if(this.includeWaveform){let a=this.flattenQueue(r.timeDataQueue);n=this.getTensorFromAudioDataArray(a,[this.numFrames*this.fftSize,1])}return{value:{spectrogram:t,waveform:n},done:!1}}async capture(){return(await this.next()).value}async getAudioData(){let t=[],n=[],r=0;return new Promise(a=>{let s=setInterval(()=>{this.includeSpectrogram&&(this.analyser.getFloatFrequencyData(this.freqData),this.freqData[0]===-1/0&&a({freqDataQueue:t,timeDataQueue:n}),t.push(this.freqData.slice(0,this.columnTruncateLength))),this.includeWaveform&&(this.analyser.getFloatTimeDomainData(this.timeData),n.push(this.timeData.slice())),++r===this.numFrames&&(clearInterval(s),a({freqDataQueue:t,timeDataQueue:n}))},this.fftSize/this.sampleRateHz*1e3)})}stop(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}toArray(){throw new Error("Can not convert infinite audio stream to array.")}getSampleRate(){return this.sampleRateHz}flattenQueue(t){let n=t[0].length,r=new Float32Array(t.length*n);return t.forEach((a,s)=>r.set(a,s*n)),r}getTensorFromAudioDataArray(t,n){let r=new Float32Array(E.sizeFromShape(n));return r.set(t,r.length-t.length),Qa(r,n)}},HIe=class RH extends Ea{constructor(t,n){if(super(),this.webcamVideoElement=t,this.webcamConfig=n,this.isClosed=!0,this.resize=!1,this.needToResize())if(this.resize=!0,this.cropSize=[this.webcamConfig.resizeHeight,this.webcamConfig.resizeWidth],this.cropBoxInd=er([0],"int32"),this.webcamConfig.centerCrop){let r=this.webcamConfig.resizeWidth*1/this.webcamVideoElement.width,a=this.webcamConfig.resizeHeight*1/this.webcamVideoElement.height,s=(1-r)/2,o=(1-a)/2,l=s+r,c=a+o;this.cropBox=el([o,s,c,l],[1,4])}else this.cropBox=el([0,0,1,1],[1,4])}summary(){return"webcam"}static async create(t,n={}){if(!_e().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}let r=new RH(t,n);return await r.start(),r}async start(){this.webcamConfig.facingMode&&E.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",()=>`Invalid webcam facing mode: ${this.webcamConfig.facingMode}. Please provide 'user' or 'environment'`);try{this.stream=await navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})}catch(t){throw t.message=`Error thrown while initializing video stream: ${t.message}`,t}if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(t){console.log(t),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,new Promise(t=>{this.webcamVideoElement.onloadedmetadata=()=>{t()}})}async next(){if(this.isClosed)return{value:null,done:!0};let t;try{t=lv.fromPixels(this.webcamVideoElement)}catch(n){throw new Error(`Error thrown converting video to pixels: ${JSON.stringify(n)}`)}if(this.resize)try{return{value:this.cropAndResizeFrame(t),done:!1}}catch(n){throw new Error(`Error thrown cropping the video: ${n.message}`)}finally{t.dispose()}else return{value:t,done:!1}}needToResize(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))}cropAndResizeFrame(t){return fe(()=>{let n=_a(He(t,"float32"),0),r;r=ii.cropAndResize(n,this.cropBox,this.cropBoxInd,this.cropSize,"bilinear");let a=r.shape;return me(r,a.slice(1))})}async capture(){return(await this.next()).value}stop(){this.stream.getTracks().forEach(t=>t.stop());try{this.webcamVideoElement.srcObject=null}catch(t){console.log(t),this.webcamVideoElement.src=null}this.isClosed=!0}toArray(){throw new Error("Can not convert infinite video stream to array.")}},DH=class{},MH=class extends Ea{split(e){return new GIe(this,e)}},GIe=class extends MH{constructor(e,t){super(),this.upstream=e,this.impl=new qIe(e,t)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},qIe=class extends RA{constructor(e,t){super(),this.upstream=e,this.separator=t,this.carryover=""}summary(){return`${this.upstream.summary()} -> Split('${this.separator}')`}async pump(){let e=await this.upstream.next();if(e.done)return this.carryover===""?!1:(this.outputQueue.push(this.carryover),this.carryover="",!0);let t=e.value.split(this.separator);t[0]=this.carryover+t[0];for(let n of t.slice(0,-1))this.outputQueue.push(n);return this.carryover=t[t.length-1],!0}},KIe=class extends Ea{decodeUTF8(){return new YIe(this)}},YIe=class extends MH{constructor(e){super(),this.upstream=e,this.impl=new XIe(e)}summary(){return this.impl.summary()}async next(){return this.impl.next()}},XIe=class extends RA{constructor(e){if(super(),this.upstream=e,_e().get("IS_BROWSER"))this.decoder=new TextDecoder("utf-8");else{let{StringDecoder:t}=B6();this.decoder=new t("utf8")}}summary(){return`${this.upstream.summary()} -> Utf8`}async pump(){let e=await this.upstream.next(),t;if(e.done)return!1;t=e.value;let n;return _e().get("IS_BROWSER")?n=this.decoder.decode(t,{stream:!0}):n=this.decoder.write(Buffer.from(t.buffer)),this.outputQueue.push(n),!0}},$H=class extends KIe{constructor(e,t={}){super(),this.file=e,this.options=t,E.assert(e instanceof Uint8Array||(_e().get("IS_BROWSER")?e instanceof File||e instanceof Blob:!1),()=>"FileChunkIterator only supports File, Blob and Uint8Array right now."),this.offset=t.offset||0,this.chunkSize=t.chunkSize||1024*1024}summary(){return`FileChunks ${this.file}`}async next(){return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?{value:null,done:!0}:{value:await new Promise((e,t)=>{let n=this.offset+this.chunkSize;if(this.file instanceof Uint8Array)e(new Uint8Array(this.file.slice(this.offset,n)));else{let r=new FileReader;r.onload=s=>{let o=r.result;if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),!(o instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(o)},r.onabort=s=>t(new Error("Aborted")),r.onerror=s=>t(new Error(s.type));let a=this.file.slice(this.offset,n);r.readAsArrayBuffer(a)}this.offset=n}),done:!1}}};async function ZIe(e,t={},n){let r,a;typeof e=="string"?r=e:(r=e.url,a=QIe(e));let s=await(0,E.fetch)(r,a);if(s.ok){let o=new Uint8Array(await s.arrayBuffer());return new $H(o,t)}else throw new Error(s.statusText)}var QIe=e=>({method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity});function FH(e){return typeof e=="string"&&e.slice(0,7)==="file://"}var PH=class extends DH{constructor(e,t={}){super(),this.input=e,this.options=t}async iterator(){if(FH(this.input)&&_e().get("IS_NODE")){let e=kI();this.input=e.readFileSync(this.input.slice(7))}return new $H(this.input,this.options)}},OH=class extends DH{constructor(e,t={}){super(),this.url=e,this.fileOptions=t}async iterator(){return FH(this.url)?new PH(this.url,this.fileOptions).iterator():ZIe(this.url,this.fileOptions)}};function JIe(e,t={}){return new EH(new OH(e),t)}function eTe(e){let t=AA(e);return Ms(async()=>t)}function tTe(e){return Ms(async()=>{let t=await e();return AA(()=>t.next())})}async function nTe(e,t){return HIe.create(e,t)}async function rTe(e){return VIe.create(e)}var aTe="4.22.0";function vt(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&E.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the CPU backend.`)})}var sTe=gl.whereImpl,DA=class LH extends vb{nextDataId(){return LH.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new $1(this,Ti())}write(t,n,r){this.firstUse&&(this.firstUse=!1,_e().get("IS_NODE")&&z.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let a={id:this.nextDataId()};return this.data.set(a,{values:t,dtype:r,refCount:1}),a}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&E.isString(r[0])){let s=r.map(o=>E.encodeString(o));a=this.write(s,t,n)}else a=this.write(r,t,n);return{dataId:a,shape:t,dtype:n}}refCount(t){return this.data.has(t)?this.data.get(t).refCount:0}incRef(t){let n=this.data.get(t);n.refCount++}decRef(t){if(this.data.has(t)){let n=this.data.get(t);n.refCount--}}move(t,n,r,a,s){this.data.set(t,{values:n,dtype:a,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){let{dtype:n,complexTensorInfos:r}=this.data.get(t);if(n==="complex64"){let a=this.readSync(r.real.dataId),s=this.readSync(r.imag.dataId);return z.mergeRealAndImagArrays(a,s)}return E.convertBackendValuesAndArrayBuffer(this.data.get(t).values,n)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>E.decodeString(a));return pn(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return pn(t.shape,t.dtype,n)}makeOutput(t,n,r){return Ti().makeTensorFromTensorInfo(this.makeTensorInfo(n,r,t),this)}disposeData(t,n=!1){if(this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;let{complexTensorInfos:r}=this.data.get(t);r!=null&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(t)}return!0}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}async time(t){let n=E.now();return t(),{kernelMs:E.now()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){vt([t],"where");let n=this.readSync(t.dataId);return sTe(t.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};DA.nextDataId=0;var MA={};nn(MA,{addImpl:()=>WH,bincountImpl:()=>FA,bincountReduceImpl:()=>UH,bitwiseAndImpl:()=>VH,castImpl:()=>BH,ceilImpl:()=>HH,concatImpl:()=>PA,equalImpl:()=>GH,expImpl:()=>KH,expm1Impl:()=>XH,floorDivImpl:()=>QH,floorImpl:()=>ZH,gatherNdImpl:()=>JH,gatherV2Impl:()=>eG,greaterEqualImpl:()=>nG,greaterImpl:()=>tG,lessEqualImpl:()=>aG,lessImpl:()=>rG,linSpaceImpl:()=>sG,logImpl:()=>iG,maxImpl:()=>oG,maximumImpl:()=>lG,minimumImpl:()=>cG,multiplyImpl:()=>OA,negImpl:()=>uG,notEqualImpl:()=>dG,prodImpl:()=>hG,raggedGatherImpl:()=>pG,raggedRangeImpl:()=>mG,raggedTensorToTensorImpl:()=>fG,rangeImpl:()=>zA,rsqrtImpl:()=>gG,scatterImpl:()=>bd,sigmoidImpl:()=>aEe,simpleAbsImpl:()=>zH,sliceImpl:()=>J0,sparseFillEmptyRowsImpl:()=>yG,sparseReshapeImpl:()=>bG,sparseSegmentReductionImpl:()=>BA,sqrtImpl:()=>oEe,squaredDifferenceImpl:()=>vG,staticRegexReplaceImpl:()=>wG,stridedSliceImpl:()=>NG,stringNGramsImpl:()=>WA,stringSplitImpl:()=>UA,stringToHashBucketFastImpl:()=>VA,subImpl:()=>kG,tileImpl:()=>SG,topKImpl:()=>_G,transposeImpl:()=>LA,uniqueImpl:()=>GA});function zH(e){let t=new Float32Array(e.length);for(let n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var iTe=e=>{let{x:t}=e.inputs,n=e.backend;vt(t,"abs");let r=new Float32Array(E.sizeFromShape(t.shape)),a=n.data.get(t.dataId).values;return r=zH(a),n.makeOutput(r,t.shape,t.dtype)},oTe={kernelName:Lf,backendName:"cpu",kernelFunc:iTe};function Kr(e){return(t,n,r,a,s)=>{let o=z.assertAndGetBroadcastShape(t,n),l=o.length,c=E.computeStrides(o),d=E.sizeFromShape(o),u=E.getTypedArrayFromDType(s,d),h=t.length,p=n.length,m=E.computeStrides(t),f=E.computeStrides(n),g=z.getBroadcastDims(t,o),x=z.getBroadcastDims(n,o);if(g.length+x.length===0)for(let y=0;y<u.length;++y)u[y]=e(r[y%r.length],a[y%a.length]);else for(let y=0;y<u.length;++y){let b=E.indexToLoc(y,l,c),v=b.slice(-h);g.forEach(S=>v[S]=0);let w=E.locToIndex(v,h,m),k=b.slice(-p);x.forEach(S=>k[S]=0);let C=E.locToIndex(k,p,f);u[y]=e(r[w],a[C])}return[u,o]}}function zs(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=n.makeTensorInfo(r.shape,"complex64"),c=n.data.get(l.dataId);return c.complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",s),imag:n.makeTensorInfo(a.shape,"float32",o)},l}var lTe={kernelName:O1,backendName:"cpu",kernelFunc:zs};function Q0(e,t,n="float32"){if(n==="complex64"){let a=Q0(e,t,"float32"),s=Q0(e,t,"float32");return zs({inputs:{real:a,imag:s},backend:e})}let r=E.makeZerosTypedArray(E.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function ul(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var cTe={kernelName:ep,backendName:"cpu",kernelFunc:ul};function mh(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.real,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var uTe={kernelName:X1,backendName:"cpu",kernelFunc:mh};function BH(e,t,n,r){if(r==="int32"){let a=Int32Array.from(e);return[t,"int32",a]}if(r==="bool"){let a=E.toTypedArray([0],n),[s,o]=Kr((l,c)=>l!==c?1:0)(t,[],e,a,"bool");return[o,"bool",s]}throw new Error(`Error in Cast: failed to cast ${n} to ${r}`)}function yu(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return ul({inputs:{x:a},backend:n});let u=Q0(n,a.shape,a.dtype),h=yu({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),p=zs({inputs:{real:h,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),p}if(a.dtype==="complex64"){let u=mh({inputs:{input:a},backend:n}),h=yu({inputs:{x:u},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(u),h}if(!E.hasEncodingLoss(a.dtype,s)){let u=ul({inputs:{x:a},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:s}}let o=n.data.get(a.dataId).values,[l,c,d]=BH(o,a.shape,a.dtype,s);return n.makeTensorInfo(l,c,d)}var dTe={kernelName:$h,backendName:"cpu",kernelFunc:yu};function ma(e,t,n,r){return n==null?({inputs:a,backend:s})=>{let{a:o,b:l}=a,c=s;vt([o,l],e);let d=c.data.get(o.dataId).values,u=c.data.get(l.dataId).values,h=o.dtype==="string"?z.fromUint8ToStringArray(d):d,p=o.dtype==="string"?z.fromUint8ToStringArray(u):u,m=r||o.dtype,[f,g]=t(o.shape,l.shape,h,p,m);return c.makeTensorInfo(g,m,f)}:({inputs:a,backend:s})=>{let{a:o,b:l}=a,c=s;if(o.dtype==="complex64"||l.dtype==="complex64"){let d=yu({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),u=c.data.get(d.dataId),h=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,m=c.data.get(h.dataId).values,f=c.data.get(p.dataId).values,g=yu({inputs:{x:l},backend:c,attrs:{dtype:"complex64"}}),x=c.data.get(g.dataId),y=x.complexTensorInfos.real,b=x.complexTensorInfos.imag,v=c.data.get(y.dataId).values,w=c.data.get(b.dataId).values,[k,C,S]=n(o.shape,l.shape,m,f,v,w),_=c.makeTensorInfo(S,"float32",k),I=c.makeTensorInfo(S,"float32",C),T=zs({inputs:{real:_,imag:I},backend:c});return c.disposeIntermediateTensorInfo(d),c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(_),c.disposeIntermediateTensorInfo(I),T}else{let d=c.data.get(o.dataId).values,u=c.data.get(l.dataId).values,h=r||o.dtype,[p,m]=t(o.shape,l.shape,d,u,h);return c.makeTensorInfo(m,h,p)}}}function $A(e){return(t,n,r,a,s,o)=>{let l=z.assertAndGetBroadcastShape(t,n),c=E.sizeFromShape(l),d=l.length,u=E.computeStrides(l),h=E.getTypedArrayFromDType("float32",c),p=E.getTypedArrayFromDType("float32",c),m=z.getBroadcastDims(t,l),f=z.getBroadcastDims(n,l),g=z.mergeRealAndImagArrays(r,a),x=z.mergeRealAndImagArrays(s,o),y=t.length,b=E.computeStrides(t),v=n.length,w=E.computeStrides(n);if(m.length+f.length===0)for(let k=0;k<h.length;k++){let C=k%g.length,S=k%x.length,_=e(g[C*2],g[C*2+1],x[S*2],x[S*2+1]);h[k]=_.real,p[k]=_.imag}else for(let k=0;k<h.length;k++){let C=E.indexToLoc(k,d,u),S=C.slice(-y);m.forEach(j=>S[j]=0);let _=E.locToIndex(S,y,b),I=C.slice(-v);f.forEach(j=>I[j]=0);let T=E.locToIndex(I,v,w),A=e(g[_*2],g[_*2+1],x[T*2],x[T*2+1]);h[k]=A.real,p[k]=A.imag}return[h,p,l]}}var WH=Kr((e,t)=>e+t),hTe=$A((e,t,n,r)=>({real:e+n,imag:t+r})),Sf=ma(_u,WH,hTe),pTe={kernelName:_u,backendName:"cpu",kernelFunc:Sf};function FA(e,t,n,r,a){let s=E.sizeFromShape(r),o=E.makeZerosTypedArray(a,n);for(let l=0;l<e.length;l++){let c=e[l];if(c<0)throw new Error("Input x must be non-negative!");c>=a||(s>0?o[c]+=t[l]:o[c]+=1)}return o}function UH(e,t,n,r=!1){let a=e.shape[0],s=e.shape[1],o=pn([a,n],t.dtype);for(let l=0;l<a;l++)for(let c=0;c<s;c++){let d=e.get(l,c);if(d<0)throw new Error("Input x must be non-negative!");d>=n||(r?o.set(1,l,d):t.size>0?o.set(o.get(l,d)+t.get(l,c),l,d):o.set(o.get(l,d)+1,l,d))}return o}var VH=Kr((e,t)=>e&t),mTe=ma(qf,VH),fTe={kernelName:qf,backendName:"cpu",kernelFunc:mTe};function xl(e){return(t,n,r)=>{let a=E.getArrayFromDType(n,t.length);for(let s=0;s<t.length;++s)a[s]=e(t[s],r);return a}}function lr(e,t,n){let r=xl(t);return $u(e,r,n)}function $u(e,t,n){return({inputs:r,attrs:a,backend:s})=>{let{x:o}=r;vt(o,e);let l=s,c=l.data.get(o.dataId).values,d;if(o.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");d=z.fromUint8ToStringArray(c)}else d=c;let u=n||o.dtype,h=t(d,u,a);return l.makeTensorInfo(o.shape,u,h)}}var HH=xl(e=>Math.ceil(e)),gTe=$u(Fh,HH),xTe={kernelName:Fh,backendName:"cpu",kernelFunc:gTe};function PA(e,t,n,r){let a=E.getArrayFromDType(n,E.sizeFromShape(t));if(r&&n!=="string"){let s=0;e.forEach(o=>{let l=E.sizeFromShape(o.shape);a.set(o.vals,s),s+=l})}else{let s=0;e.forEach(o=>{let l=n==="string"?z.fromUint8ToStringArray(o.vals):o.vals,c=0;for(let d=0;d<o.shape[0];++d){let u=d*t[1]+s;for(let h=0;h<o.shape[1];++h)a[u+h]=l[c++]}s+=o.shape[1]})}return a}var GH=Kr((e,t)=>e===t?1:0),qH=ma(tg,GH,null,"bool"),yTe={kernelName:tg,backendName:"cpu",kernelFunc:qH},KH=xl(e=>Math.exp(e)),YH=$u(Kh,KH,"float32"),bTe={kernelName:Kh,backendName:"cpu",kernelFunc:YH},XH=xl(e=>Math.expm1(e)),vTe=$u(Yh,XH),wTe={kernelName:Yh,backendName:"cpu",kernelFunc:vTe},ZH=xl(e=>Math.floor(e)),NTe=$u(Xh,ZH),kTe={kernelName:Xh,backendName:"cpu",kernelFunc:NTe},QH=Kr((e,t)=>Math.floor(e/t)),STe=ma(Zh,QH,null,"int32"),CTe={kernelName:Zh,backendName:"cpu",kernelFunc:STe};function JH(e,t,n,r,a,s,o,l,c){let d=pn([r,s],n);for(let u=0;u<r;u++){let h=[],p=0;for(let m=0;m<a;m++){let f=e[u*a+m];p+=f*o[m],h.push(f)}if(p<0||p>=c/s)throw new Error(`Invalid indices: ${h} does not index into ${l}`);for(let m=0;m<s;m++)d.values[u*s+m]=t.get(...t.indexToLoc(p*s+m))}return d}function eG(e,t,n){let r=pn(n,e.dtype);for(let a=0;a<r.size;++a){let s=r.indexToLoc(a).slice(),o=s[0],l=s[2],c=t.locToIndex([o,l]);s[2]=t.values[c];let d=e.locToIndex(s);0<=d&&d<e.values.length&&(r.values[a]=e.values[d])}return r}var tG=Kr((e,t)=>e>t?1:0),_Te=ma(ig,tG,null,"bool"),jTe={kernelName:ig,backendName:"cpu",kernelFunc:_Te},nG=Kr((e,t)=>e>=t?1:0),ITe=ma(Jh,nG,null,"bool"),TTe={kernelName:Jh,backendName:"cpu",kernelFunc:ITe},rG=Kr((e,t)=>e<t?1:0),ETe=ma(og,rG,null,"bool"),ATe={kernelName:og,backendName:"cpu",kernelFunc:ETe},aG=Kr((e,t)=>e<=t?1:0),RTe=ma(lg,aG,null,"bool"),DTe={kernelName:lg,backendName:"cpu",kernelFunc:RTe};function sG(e,t,n){let r=(t-e)/(n-1),a=E.makeZerosTypedArray(n,"float32");a[0]=e;for(let s=1;s<a.length;s++)a[s]=a[s-1]+r;return a}var iG=xl(e=>Math.log(e)),MTe=$u(sp,iG),$Te={kernelName:sp,backendName:"cpu",kernelFunc:MTe};function oG(e,t,n,r){let a=E.getTypedArrayFromDType(r,E.sizeFromShape(n));for(let s=0;s<a.length;++s){let o=s*t,l=e[o];for(let c=0;c<t;++c){let d=e[o+c];(Number.isNaN(d)||d>l)&&(l=d)}a[s]=l}return a}var lG=Kr((e,t)=>Math.max(e,t)),FTe=ma(cp,lG),PTe={kernelName:cp,backendName:"cpu",kernelFunc:FTe},cG=Kr((e,t)=>Math.min(e,t)),OTe=ma(pp,cG),LTe={kernelName:pp,backendName:"cpu",kernelFunc:OTe},OA=Kr((e,t)=>e*t),zTe=$A((e,t,n,r)=>({real:e*n-t*r,imag:e*r+t*n})),nk=ma(gp,OA,zTe),BTe={kernelName:gp,backendName:"cpu",kernelFunc:nk};function uG(e,t,n){let r=E.createScalarValue(-1,n);return OA([],t,r,e,n)}function WTe(e){let{inputs:t,backend:n}=e,{x:r}=t;vt(r,"neg");let a=n.data.get(r.dataId).values,[s,o]=uG(a,r.shape,r.dtype);return n.makeTensorInfo(o,r.dtype,s)}var UTe={kernelName:gg,backendName:"cpu",kernelFunc:WTe},dG=Kr((e,t)=>e!==t?1:0),VTe=ma(xg,dG,null,"bool"),HTe={kernelName:xg,backendName:"cpu",kernelFunc:VTe};function LA(e,t,n,r,a){let s=t.length,o=E.sizeFromShape(t),l=E.computeStrides(t),c=E.computeStrides(a),d=E.getTypedArrayFromDType(n,E.sizeFromShape(a));for(let u=0;u<o;++u){let h=E.indexToLoc(u,s,l),p=new Array(h.length);for(let f=0;f<p.length;f++)p[f]=h[r[f]];let m=E.locToIndex(p,s,c);d[m]=e[u]}return d}function Cs(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{perm:s}=n;vt(a,"transpose");let o=a.shape.length,l=new Array(o);for(let u=0;u<l.length;u++)l[u]=a.shape[s[u]];let c=r.data.get(a.dataId).values,d=LA(c,a.shape,a.dtype,s,l);return{dataId:r.write(d,l,a.dtype),shape:l,dtype:a.dtype}}var GTe={kernelName:Fl,backendName:"cpu",kernelFunc:Cs};function hG(e,t,n,r){let[a,s]=z.computeOutAndReduceShapes(e,r),o=mi(t,"int32"),l=E.makeZerosTypedArray(E.sizeFromShape(a),o),c=E.sizeFromShape(s);for(let d=0;d<l.length;++d){let u=d*c,h=1;for(let p=0;p<c;++p)h*=n[u+p];l[d]=h}return{outVals:l,outShape:a,outDtype:o}}function qTe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;vt(a,"prod");let l=a.shape.length,c=E.parseAxisParam(s,a.shape),d=z.getAxesPermutation(c,l),u=c,h=a,p=[];d!=null&&(h=Cs({inputs:{x:a},backend:n,attrs:{perm:d}}),p.push(h),u=z.getInnerMostAxes(u.length,l));let m=n.data.get(h.dataId).values,{outVals:f,outShape:g,outDtype:x}=hG(h.shape,h.dtype,m,u),y=g;return o&&(y=z.expandShapeToKeepDim(g,c)),p.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(y,x,f)}var KTe={kernelName:wp,backendName:"cpu",kernelFunc:qTe};function YTe(e,t,n){e.forEach((r,a)=>{if(r<0||r>=n){let s=E.indexToLoc(a,t.length,E.computeStrides(t)).join(",");throw new Error(`indices[${s}] = ${r} is not in [0, ${n})`)}})}function XTe(e,t){for(let n=0;n<e.length;++n){let r=e[n],a=n===e.length-1?t:e[n+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(let s=1;s<r.length;++s)if(r[s-1]>r[s])throw new Error("Ragged splits must be sorted in ascending order")}}function ZTe(e,t,n,r){let a=[],s=0,o=t.length-1+n.length,l=new Array(o).fill(null).map(()=>[0]);XTe(n,r);let c=1;for(let d=0;d<t.length-1;++d){c*=t[d];let u=t[d+1];for(let h=1;h<c+1;++h)l[d].push(h*u)}for(let d=0;d<e.length;++d){let u=e[d],h=e[d]+1;for(let p=0;p<n.length;++p){let m=n[p],f=p+t.length-1;if(f>=0){let g=l[f],x=g[g.length-1]-m[u];for(let y=u;y<h;++y)l[f].push(m[y+1]+x)}u=m[u],h=m[h]}h!==u&&(a.push([u,h]),s+=h-u)}return{outSplits:l,valueSlices:a,numValues:s}}function QTe(e){let t=[];for(let n=0;n<e.length;++n){let r=e[n].length,a=E.getArrayFromDType("int32",r);t.push(a),e[n].forEach((s,o)=>a[o]=s)}return t}function MF(e,t){let n=e.slice(0,t);for(;n.length<t;)n.push(1);for(let r=t;r<e.length;r++)n[t-1]*=e[r];return n}function JTe(e,t,n,r,a,s){let o=MF(t,2)[1],l=MF(s,2)[1],c=0;for(let d of n)for(let u=d[0];u<d[1];++u){for(let h=0;h<r;++h)a[c*l+h]=e[u*o+h];++c}}function eEe(e,t,n,r,a){let s=t.slice();s[0]=a;let o=E.getArrayFromDType(n,E.sizeFromShape(s)),l=e.length,c=l===0?0:l/t[0];return JTe(e,t,r,c,o,s),[o,s]}function pG(e,t,n,r,a,s,o,l){if(e.length===0)throw new Error("paramsNestedSplits must be non empty");if(t[0].length===0)throw new Error("Split tensors must not be scalars");let c=t[0][0]-1;if(YTe(s,o,c),r.length===0)throw new Error("params.rank must be nonzero");let d=r[0],{outSplits:u,valueSlices:h,numValues:p}=ZTe(s,o,e,d),m=QTe(u),f=eEe(n,r,a,h,p);return[m,f[0],f[1]]}var $F=2147483647;function mG(e,t,n,r,a,s,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");let l=t.length===0,c=a.length===0,d=o.length===0,u=[];l||u.push(t[0]),c||u.push(a[0]),d||u.push(o[0]);for(let x=1;x<u.length;++x)if(u[x]!==u[x-1])throw new Error("starts, limits, and deltas must have the same shape");let h=u.length===0?1:u[0],p=E.getArrayFromDType("int32",h+1);p[0]=0;for(let x=0;x<h;++x){let y=l?e[0]:e[x],b=c?r[0]:r[x],v=d?s[0]:s[x];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&b<y||v<0&&b>y)w=0;else if(w=Math.ceil(Math.abs((b-y)/v)),w>$F)throw new Error(`Requires ((limit - start) / delta) <= ${$F}`);p[x+1]=p[x]+w}let m=p[h],f=E.getArrayFromDType(n,m),g=0;for(let x=0;x<h;++x){let y=p[x+1]-p[x],b=l?e[0]:e[x],v=d?s[0]:s[x];for(let w=0;w<y;++w)f[g++]=b,b+=v}return[p,f]}var Si=z.RowPartitionType,tEe=class f_{constructor(t,n,r,a,s,o,l,c,d,u){this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=s,this.defaultValue=o,this.defaultValueShape=l,this.rowPartitionValues=c,this.rowPartitionValuesShapes=d,this.rowPartitionTypes=z.getRowPartitionTypesHelper(u),this.raggedRank=z.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(t){return this.rowPartitionTypes[0]===Si.FIRST_DIM_SIZE?this.rowPartitionTypes[t+1]:this.rowPartitionTypes[t]}getRowPartitionTensor(t){return this.rowPartitionTypes[0]===Si.FIRST_DIM_SIZE?this.rowPartitionValues[t+1]:this.rowPartitionValues[t]}getMaxWidth(t){let n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case Si.VALUE_ROWIDS:return f_.getMaxWidthValueRowID(n);case Si.ROW_SPLITS:return f_.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Si[this.getRowPartitionTypeByDimension(t-1)]}`)}}static getMaxWidthRowSplit(t){let n=t.length;if(n===0||n===1)return 0;let r=0;for(let a=0;a<n-1;++a){let s=t[a+1]-t[a];s>r&&(r=s)}return r}static getMaxWidthValueRowID(t){let n=t.length;if(n===0)return 0;let r=0,a=t[0],s=0;for(let o=1;o<n;++o){let l=t[o];l!==a&&(a=l,s=Math.max(o-r,s),r=o)}return Math.max(n-r,s)}tensorShapeFromTensor(t,n,r=!0){if(n.length===0){if(t[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return PF(t,r)}calculateOutputSize(t){let n=this.valuesShape,r=this.defaultValueShape;z.validateDefaultValueShape(r,n);let a=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=z.combineRaggedTensorToTensorShapes(this.raggedRank,a,n);s[0]<0&&(s[0]=t);for(let o=1;o<=this.raggedRank;++o)s[o]<0&&(s[o]=this.getMaxWidth(o));return s}calculateFirstParentOutputIndex(t,n,r){let a=Math.min(t,r),s=[],o=0;for(let l=0;l<a;++l,o+=n)s.push(o);for(let l=a;l<t;++l)s.push(-1);return E.assert(s.length===t,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(t,n,r,a){let s=t.length,o=[];for(let l=0;l<s-1;++l){let c=t[l+1]-t[l],d=Math.min(a,c),u=n[l];u===-1&&(d=0);for(let h=0;h<d;++h)o.push(u),u+=r;for(let h=0;h<c-d;++h)o.push(-1)}if(s>0&&o.length!==t[s-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(t,n,r,a){let s=t.length,o=[];if(s===0)return[];let l=0,c=t[0];if(c>=n.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${n.length}`);let d=n[c];o.push(d);for(let u=1;u<s;++u){let h=t[u];if(h===c)d>=0&&(++l,l<a?d+=r:d=-1);else{if(l=0,c=h,h>=n.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${n.length}`);d=n[h]}o.push(d)}if(o.length!==t.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(t,n,r,a){let s=this.getRowPartitionTensor(t),o=this.getRowPartitionTypeByDimension(t);switch(o){case Si.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,n,r,a);case Si.ROW_SPLITS:if(s.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(s,n,r,a);default:throw new Error(`Unsupported partition type: ${Si[o]}`)}}getFirstDimensionSize(){let t=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let n=this.rowPartitionTypes[0];switch(n){case Si.FIRST_DIM_SIZE:return t[0];case Si.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Si.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Si[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let o=r.length-2;o>=0;--o)r[o]=r[o+1]*n[o+1];let a=PF(n,!1),s=E.getArrayFromDType(this.valuesDType,E.sizeFromShape(a));if(r[0]*n[0]>0){let o=this.calculateFirstParentOutputIndex(t,r[0],n[0]);for(let l=1;l<=this.raggedRank;++l)o=this.calculateOutputIndex(l-1,o,r[l],n[l]);this.setOutput(this.raggedRank,o,s,a)}return[a,s]}setOutput(t,n,r,a){if(r.length===0)return;let s=this.values,o=r,l=a.slice();l=l.slice(t+1);let c=E.sizeFromShape(l),d=n.length,u=this.defaultValue;if(u.length!==c&&u.length!==1){let f=this.defaultValueShape;fe(()=>{let g=me(u,f);u=Md(g,l).dataSync()})}let h=0,p=0,m=0;for(let f=0;f<=d;++f){let g=f<d?n[f]:-1;if(g===m){++m;continue}if(p<m){let x=s.subarray(h*c),y=o.subarray(p*c),b=(m-p)*c;FF(y,x,b)}if(f>=d){let x=r.length;g=Math.floor(x/c)}if(g>m)if(this.defaultValue.length===1)o.subarray(m*c,g*c).fill(this.defaultValue[0]),m=g;else for(;g>m;){let x=o.slice(m*c);FF(x,u,c),++m}g<0?(h=f+1,p=m):(h=f,p=m,m=p+1)}}};function FF(e,t,n){for(let r=0;r<n;r++)e[r]=t[r]}function PF(e,t){let n=[];for(let r of e){if(r<0){if(!t)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}n.push(r)}return n}function fG(e,t,n,r,a,s,o,l,c,d){return new tEe(e,t,n,r,a,s,o,l,c,d).compute()}function zA(e,t,n,r){let a=e===t,s=e<t&&n<0,o=t<e&&n>1;if(a||s||o)return E.makeZerosTypedArray(0,r);let l=Math.abs(Math.ceil((t-e)/n)),c=E.makeZerosTypedArray(l,r);t<e&&n===1&&(n=-1),c[0]=e;for(let d=1;d<c.length;d++)c[d]=c[d-1]+n;return c}var gG=xl(e=>1/Math.sqrt(e)),nEe=$u(Tp,gG),rEe={kernelName:Tp,backendName:"cpu",kernelFunc:nEe};function bd(e,t,n,r,a,s,o,l,c,d){let u=[r/a,a],h=e.values,p=t.values;if(r===0)return pn(n,t.dtype);let m=c instanceof Qr?c:pn(u,t.dtype);typeof c=="string"||typeof c=="number"?m.values.fill(c):typeof c=="boolean"&&m.values.fill(+c);for(let f=0;f<s;f++){let g=[],x=0;for(let y=0;y<o;y++){let b=h[f*o+y];g.push(b),x+=b*l[y]}if(x<0||x>=r/a)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let y=0;y<a;y++)d?m.values[x*a+y]+=p[f*a+y]:m.values[x*a+y]=t.rank===0?p[0]:p[f*a+y]}return m}var aEe=xl(e=>1/(1+Math.exp(-e))),xG=lr(Mp,e=>1/(1+Math.exp(-e))),sEe={kernelName:Mp,backendName:"cpu",kernelFunc:xG};function J0(e,t,n,r,a){let s=da.isSliceContinous(r,t,n),o=E.sizeFromShape(n),l=E.computeStrides(r);if(s){let h=da.computeFlatOffset(t,l);return a==="string"?e.slice(h,h+o):e.subarray(h,h+o)}let c=a==="string"?z.fromUint8ToStringArray(e):e,d=pn(r,a,c),u=pn(n,a);for(let h=0;h<u.size;++h){let p=u.indexToLoc(h),m=p.map((f,g)=>f+t[g]);u.set(d.get(...m),...p)}return a==="string"?z.fromStringArrayToUint8(u.values):u.values}function fh(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:o}=r;vt(a,"slice");let[l,c]=da.parseSliceParams(a,s,o);da.assertParamsValid(a,l,c);let d=n.data.get(a.dataId).values,u=J0(d,l,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,u)}var iEe={kernelName:Eg,backendName:"cpu",kernelFunc:fh};function yG(e,t,n,r,a,s,o){let l=t[0],c=s[0],d=new Array(c),u=new Array(l),h=t[1];if(c===0){if(l!==0)throw new Error(z.getSparseFillEmptyRowsIndicesDenseShapeMismatch(l));let x=E.getArrayFromDType(n,0),y=E.getArrayFromDType(a,0);return[x,[0,h],y,d,u]}let p=!0,m=0,f=new Array(c).fill(0);for(let x=0;x<l;++x){let y=e[x*h];if(y<0)throw new Error(z.getSparseFillEmptyRowsNegativeIndexErrorMessage(x,y));if(y>=c)throw new Error(z.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(x,y,c));++f[y],p=p&&y>=m,m=y}let g=!0;for(let x=0;x<c;++x){let y=f[x]===0;d[x]=y,g=g&&!y,f[x]=Math.max(f[x],1),x>0&&(f[x]+=f[x-1])}if(g&&p){let x=e,y=r;for(let b=0;b<l;++b)u[b]=b;return[x,[l,h],y,d,u]}else{let x=f[c-1],y=E.getArrayFromDType(n,x*h),b=E.getArrayFromDType(a,x),v=new Array(c).fill(0);for(let w=0;w<l;++w){let k=e[w*h],C=v[k],S=(k===0?0:f[k-1])+C;v[k]++;for(let _=0;_<h;++_)y[S*h+_]=e[w*h+_];b[S]=r[w],u[w]=S}for(let w=0;w<c;++w)if(v[w]===0){let k=w===0?0:f[w-1];y[k*h+0]=w;for(let C=1;C<h;++C)y[k*h+C]=0;b[k]=o}return[y,[x,h],b,d,u]}}function bG(e,t,n,r,a){let s=E.sizeFromShape(r),o=t[0],l=a.length,c=[],d=1,u=-1;for(let g=0;g<l;++g){let x=a[g];if(x===-1){if(u!==-1)throw new Error(z.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(u,g));u=g,c.push(1)}else{if(x<0)throw new Error(z.getSparseReshapeNegativeOutputDimErrorMessage(g,x));d*=x,c.push(x)}}if(u!==-1){if(d<=0)throw new Error(z.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(s/d);if(d*g!==s)throw new Error(z.getSparseReshapeInputOutputMultipleErrorMessage(r,c));c[u]=g}if(E.sizeFromShape(c)!==s)throw new Error(z.getSparseReshapeInputOutputMismatchErrorMessage(r,c));let h=r.length,p=[];if(h>0){p[h-1]=1;for(let g=h-2;g>=0;--g)p[g]=p[g+1]*r[g+1]}let m=[];if(l>0){m[l-1]=1;for(let g=l-2;g>=0;--g)m[g]=m[g+1]*c[g+1]}let f=E.getArrayFromDType(n,o*l);for(let g=0;g<o;++g){let x=0;for(let y=0;y<h;++y)x+=e[g*h+y]*p[y];for(let y=0;y<l;++y)f[g*l+y]=Math.trunc(x/m[y]),x%=m[y]}return[f,[o,l],c]}function BA(e,t,n,r,a,s=!1,o=0){let l=r.length,c=[t[0],e.length/t[0]],d=c[1],u=l>0?a[l-1]+1:0;if(u<0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let h=t.slice();h[0]=u;let p=h.reduce((b,v)=>b*v,1),m=E.getArrayFromDType(n,p);if(l===0)return u>0&&m.fill(o),[m,h];if(u<=0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let f=0,g=1,x=0,y=a[f];for(;;){let b=0;if(g<l){if(b=a[g],y===b){++g;continue}if(y>=b)throw new Error(z.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=u)throw new Error(z.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,u));y>x&&m.fill(o,x*d,y*d);for(let v=f;v<g;++v){let w=r[v];if(w<0||w>=c[0])throw new Error(z.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(v,r[v],c[0]));for(let k=0;k<d;k++)m[y*d+k]+=e[w*d+k]}if(s)for(let v=0;v<d;v++)m[y*d+v]/=g-f;if(f=g,++g,x=y+1,y=b,g>l)break}return x<u&&m.fill(o,x*d,u*d),[m,h]}var oEe=xl(e=>Math.sqrt(e)),lEe=lr(Fp,e=>Math.sqrt(e)),cEe={kernelName:Fp,backendName:"cpu",kernelFunc:lEe},vG=Kr((e,t)=>{let n=e-t;return n*n}),uEe=ma(Lp,vG),dEe={kernelName:Lp,backendName:"cpu",kernelFunc:uEe},wG=xl((e,t)=>{let{pattern:n,replaceGlobal:r,rewrite:a}=t;return e.replace(new RegExp(n,r?"g":""),a)}),hEe=$u(Pb,wG),pEe={kernelName:Pb,backendName:"cpu",kernelFunc:hEe};function NG(e,t,n,r){let a=pn(e,t.dtype);for(let s=0;s<a.size;s++){let o=a.indexToLoc(s),l=new Array(o.length);for(let c=0;c<l.length;c++)l[c]=o[c]*n[c]+r[c];a.set(t.get(...l),...o)}return a}var mEe=class{constructor(e,t,n,r,a,s){this.separator=E.encodeString(e),this.nGramWidths=t,this.leftPad=E.encodeString(n),this.rightPad=E.encodeString(r),this.padWidth=a,this.preserveShort=s}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){let n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}createNGrams(e,t,n,r,a,s){for(let o=0;o<a;++o){let l=this.getPadWidth(s),c=Math.max(0,l-o),d=Math.max(0,l-(a-(o+1))),u=s-(c+d),h=t+(c>0?0:o-l),p=0;p+=c*this.leftPad.length;for(let y=0;y<u;++y)p+=e[h+y].length;p+=d*this.rightPad.length;let m=c+d+u-1;p+=m*this.separator.length,n[r+o]=new Uint8Array(p);let f=n[r+o],g=0,x=y=>y.forEach(b=>f[g++]=b);for(let y=0;y<c;++y)x(this.leftPad),x(this.separator);for(let y=0;y<u-1;++y)x(e[h+y]),x(this.separator);if(u>0){x(e[h+u-1]);for(let y=0;y<d;++y)x(this.separator),x(this.rightPad)}else{for(let y=0;y<d-1;++y)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,t){let n=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let d=t[c]>=l;if(d=d&&t[c]<=n,!d)throw new Error(`Invalid split value ${t[c]}, must be in [${l}, ${n}]`);l=t[c]}if(l!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${l}`)}let a=r-1,s=E.getArrayFromDType("int32",r);if(n===0||r===0){let l=new Array(n);for(let c=0;c<=a;++c)s[c]=0;return[l,s]}s[0]=0;for(let l=1;l<=a;++l){let c=t[l]-t[l-1],d=0;this.nGramWidths.forEach(u=>{d+=this.getNumNGrams(c,u)}),this.preserveShort&&c>0&&d===0&&(d=1),s[l]=s[l-1]+d}let o=new Array(s[a]);for(let l=0;l<a;++l){let c=t[l],d=s[l];if(this.nGramWidths.forEach(u=>{let h=t[l+1]-t[l],p=this.getNumNGrams(h,u);this.createNGrams(e,c,o,d,p,u),d+=p}),this.preserveShort&&d===s[l]){let u=t[l+1]-t[l];if(u===0)continue;let h=u+2*this.padWidth;this.createNGrams(e,c,o,d,1,h)}}return[o,s]}};function WA(e,t,n,r,a,s,o,l){return new mEe(n,r,a,s,o,l).compute(e,t)}function fEe(e,t,n,r){if(!e.length)return;if(t.length===0){for(let s=0;s<e.length;++s)r.push(e.subarray(s,s+1));return}if(t.length===1){let s=t[0],o=e.indexOf(s);for(;o!==-1;){let l=e.subarray(0,o);(!n||l.length!==0)&&r.push(l),e=e.subarray(o+1),o=e.indexOf(s)}(!n||e.length!==0)&&r.push(e);return}let a=0;for(let s=0;s<e.length+1;s++)if(s===e.length||t.indexOf(e[s])!==-1){let o=e.subarray(a,s);(!n||o.length!==0)&&r.push(o),a=s+1}}function UA(e,t,n){let r=e.length,a=[],s=0,o=0,l=new Array(r);for(let p=0;p<r;++p){let m=a.length;fEe(e[p],t,n,a);let f=a.length-m;l[p]=f,s+=f,o=Math.max(o,f)}let c=E.getArrayFromDType("int32",s*2),d=new Array(s),u=[r,o],h=0;for(let p=0;p<r;++p)for(let m=0;m<l[p];++m)c[h*2]=p,c[h*2+1]=m,d[h]=a[h],++h;return[c,d,u]}function VA(e,t){let n=E.getArrayFromDType("int32",e.length);for(let r=0;r<e.length;++r)n[r]=E.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var kG=Kr((e,t)=>e-t),gEe=$A((e,t,n,r)=>({real:e-n,imag:t-r})),HA=ma(zp,kG,gEe),xEe={kernelName:zp,backendName:"cpu",kernelFunc:HA};function SG(e,t){let n=new Array(e.rank);for(let a=0;a<n.length;a++)n[a]=e.shape[a]*t[a];let r=pn(n,e.dtype);for(let a=0;a<r.values.length;++a){let s=r.indexToLoc(a),o=new Array(e.rank);for(let c=0;c<o.length;c++)o[c]=s[c]%e.shape[c];let l=e.locToIndex(o);r.values[a]=e.values[l]}return r}var qx=(e,t)=>{let n=t.value-e.value;return n===0?e.index-t.index:n};function CG(e,t,n=0,r=e.length-1){for(;r>n;){if(r-n>600){let l=r-n+1,c=t-n+1,d=Math.log(l),u=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*u*(l-u)/l)*Math.sign(c-l/2),p=Math.max(n,Math.floor(t-c*u/l+h)),m=Math.min(r,Math.floor(t+(l-c)*u/l+h));CG(e,t,p,m)}let a=e[t],s=n,o=r;for(E.swap(e,n,t),qx(e[r],a)>0&&E.swap(e,n,r);s<o;){for(E.swap(e,s,o),s++,o--;qx(e[s],a)<0;)s=s+1;for(;qx(e[o],a)>0;)o=o-1}qx(e[n],a)===0?E.swap(e,n,o):(o=o+1,E.swap(e,o,r)),o<=t&&(n=o+1),t<=o&&(r=o-1)}}function _G(e,t,n,r,a){let s=t[t.length-1],[o,l]=[e.length/s,s],c=E.getTypedArrayFromDType(n,o*r),d=E.getTypedArrayFromDType("int32",o*r);for(let h=0;h<o;h++){let p=h*l,m=e.subarray(p,p+l),f=new Array(m.length);m.forEach((b,v)=>f[v]={value:b,index:v}),r<f.length&&(CG(f,r),f=f.slice(0,r)),a&&f.sort(qx);let g=h*r,x=c.subarray(g,g+r),y=d.subarray(g,g+r);for(let b=0;b<r;b++)x[b]=f[b].value,y[b]=f[b].index}let u=t.slice();return u[u.length-1]=r,[pn(u,n,c),pn(u,"int32",d)]}function GA(e,t,n,r){let a=E.parseAxisParam(t,n)[0],s=[1,n[0],1];for(let f=0;f<a;f++)s[0]*=n[f];s[1]=n[a];for(let f=a+1;f<n.length;f++)s[2]*=n[f];let o=new Map,l=new Int32Array(n[a]),c=new Qr(s,r,e),d=[],u=s[0]===1&&s[2]===1;for(let f=0;f<n[a];f++){let g;if(u)g=e[f].toString();else{let y=[];for(let b=0;b<s[0];b++)for(let v=0;v<s[2];v++)y.push(c.get(b,f,v));g=y.join(",")}let x=o.get(g);if(x!=null)l[f]=x;else{let y=o.size;o.set(g,y),l[f]=y,d.push(f)}}let h=s.slice();h[1]=o.size;let p=new Qr(h,r);d.forEach((f,g)=>{for(let x=0;x<s[0];x++)for(let y=0;y<s[2];y++)p.set(c.get(x,f,y),x,g,y)});let m=n.slice();return m[a]=h[1],{outputValues:p.values,outputShape:m,indices:l}}var yEe="4.22.0";J1("cpu",()=>new DA,1);var jG=lr(Gh,e=>e>=0?e:Math.exp(e)-1),bEe={kernelName:Gh,backendName:"cpu",kernelFunc:jG};function IG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r;vt([a],"leakyRelu");let o=E.sizeFromShape(a.shape),l=n.data.get(a.dataId).values,c=E.getTypedArrayFromDType("float32",o);for(let d=0;d<l.length;d++)c[d]=l[d]<0?s*l[d]:l[d];return n.makeTensorInfo(a.shape,"float32",c)}var vEe={kernelName:ap,backendName:"cpu",kernelFunc:IG},wEe=Kr((e,t)=>e<0?t*e:e);function TG(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t;vt([r,a],"prelu");let s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,[l,c]=wEe(r.shape,a.shape,s,o,"float32");return n.makeTensorInfo(c,"float32",l)}var NEe={kernelName:vp,backendName:"cpu",kernelFunc:TG},EG=lr(kp,e=>Math.max(0,e)),kEe={kernelName:kp,backendName:"cpu",kernelFunc:EG},AG=lr(_p,e=>Math.min(Math.max(0,e),6)),SEe={kernelName:_p,backendName:"cpu",kernelFunc:AG};function e1(e,t,n,r,a){if(n==="linear")return ul({inputs:{x:t},backend:e});if(n==="relu")return EG({inputs:{x:t},backend:e});if(n==="elu")return jG({inputs:{x:t},backend:e});if(n==="relu6")return AG({inputs:{x:t},backend:e});if(n==="prelu")return TG({inputs:{x:t,alpha:r},backend:e});if(n==="leakyrelu")return IG({inputs:{x:t},backend:e,attrs:{alpha:a}});if(n==="sigmoid")return xG({inputs:{x:t},backend:e});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}function _r(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,o=E.sizeFromShape(a.shape),l=E.inferFromImplicitShape(s,o),c=E.sizeFromShape(l);E.assert(o===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${a.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(a.dataId);let d=n.data.get(a.dataId);if(d.complexTensorInfos!=null){let u=d.complexTensorInfos.real,h=d.complexTensorInfos.imag;u.shape=l,h.shape=l}return{dataId:a.dataId,shape:l,dtype:a.dtype}}var CEe={kernelName:kg,backendName:"cpu",kernelFunc:_r};function RG(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:o,transposeB:l}=r;vt([a,s],"matMul");let c=a.shape.length,d=s.shape.length,u=o?a.shape[c-2]:a.shape[c-1],h=l?s.shape[d-1]:s.shape[d-2],p=o?a.shape[c-1]:a.shape[c-2],m=l?s.shape[d-2]:s.shape[d-1],f=a.shape.slice(0,-2),g=s.shape.slice(0,-2),x=E.sizeFromShape(f),y=E.sizeFromShape(g),b=Bg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([p,m]);E.assert(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${o} and transposeB=${l} must match.`);let v=o?[x,u,p]:[x,p,u],w=l?[y,m,h]:[y,h,m],k=_r({inputs:{x:a},backend:n,attrs:{shape:v}}),C=_r({inputs:{x:s},backend:n,attrs:{shape:w}}),S=o?k.shape[1]:k.shape[2],_=o?k.shape[2]:k.shape[1],I=l?C.shape[1]:C.shape[2],T=Math.max(x,y),A=n.data.get(k.dataId).values,j=n.data.get(C.dataId).values,D=E.computeStrides(k.shape),F=E.computeStrides(C.shape),[B,q,$]=o?[D[0],1,D[1]]:[D[0],D[1],1],[L,M,X]=l?[1,F[1],F[0]]:[F[1],1,F[0]],G=_*I,W=pn([T,_,I],k.dtype),O=W.values,U=n.blockSize;for(let K=0;K<T;K++){let ce=K%x,ne=K%y;for(let te=0;te<_;te+=U){let Te=Math.min(te+U,_);for(let Ae=0;Ae<I;Ae+=U){let Se=Math.min(Ae+U,I);for(let we=0;we<S;we+=U){let Fe=Math.min(we+U,S);for(let Q=te;Q<Te;Q++)for(let $e=Ae;$e<Se;$e++){let Le=0;for(let Xe=we;Xe<Fe;Xe++){let Ye=A[ce*B+Q*q+Xe*$],Je=j[Xe*L+$e*M+ne*X];Le+=Ye*Je}O[K*G+(Q*I+$e)]+=Le}}}}}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(C),n.makeTensorInfo(b,W.dtype,W.values)}var _Ee={kernelName:Mh,backendName:"cpu",kernelFunc:RG};function jEe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:o,preluActivationWeights:l}=t,{transposeA:c,transposeB:d,activation:u,leakyreluAlpha:h}=r,p,m,f,g=[];p=RG({inputs:{a,b:s},attrs:{transposeA:c,transposeB:d},backend:n}),o&&(m=Sf({inputs:{a:p,b:o},backend:n}),g.push(p),p=m),u&&(f=e1(n,p,u,l,h),g.push(p),p=f);for(let x of g)n.disposeIntermediateTensorInfo(x);return p}var IEe={kernelName:th,backendName:"cpu",kernelFunc:jEe},TEe=lr(Ch,e=>Math.acos(e)),EEe={kernelName:Ch,backendName:"cpu",kernelFunc:TEe},AEe=lr(_h,e=>Math.acosh(e)),REe={kernelName:_h,backendName:"cpu",kernelFunc:AEe};function DEe(e){let{inputs:t,backend:n}=e,r=t;vt(t,"addN");let a=r.map(l=>n.data.get(l.dataId).values),s=pn(r[0].shape,r[0].dtype),o=s.values;for(let l=0;l<r.length;l++){let c=a[l];for(let d=0;d<o.length;d++)o[d]+=c[d]}return n.makeTensorInfo(s.shape,s.dtype,s.values)}var MEe={kernelName:jh,backendName:"cpu",kernelFunc:DEe};function $Ee(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;vt(a,"all");let l=E.parseAxisParam(s,a.shape),c=l,d=z.getAxesPermutation(c,a.shape.length),u=a;d!=null&&(u=Cs({inputs:{x:a},backend:n,attrs:{perm:d}}),c=z.getInnerMostAxes(c.length,a.shape.length)),z.assertAxesAreInnerMostDims("all",c,u.shape.length);let[h,p]=z.computeOutAndReduceShapes(u.shape,c),m=E.sizeFromShape(p),f=E.makeZerosTypedArray(E.sizeFromShape(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let k=g[b+w];v=v&&k}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(u);let x=n.makeTensorInfo(h,u.dtype,f);if(o){let y=z.expandShapeToKeepDim(h,l),b=_r({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var FEe={kernelName:zf,backendName:"cpu",kernelFunc:$Ee};function PEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;vt(a,"any");let l=E.parseAxisParam(s,a.shape),c=l,d=z.getAxesPermutation(c,a.shape.length),u=a;d!=null&&(u=Cs({inputs:{x:a},backend:n,attrs:{perm:d}}),c=z.getInnerMostAxes(c.length,a.shape.length)),z.assertAxesAreInnerMostDims("any",c,u.shape.length);let[h,p]=z.computeOutAndReduceShapes(u.shape,c),m=E.sizeFromShape(p),f=E.makeZerosTypedArray(E.sizeFromShape(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let k=g[b+w];v=v||k}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(u);let x=n.makeTensorInfo(h,u.dtype,f);if(o){let y=z.expandShapeToKeepDim(h,l),b=_r({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var OEe={kernelName:Bf,backendName:"cpu",kernelFunc:PEe};function LEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;vt(a,"argMax");let o=E.parseAxisParam(s,a.shape),l=z.getAxesPermutation(o,a.shape.length),c=a,d=[];l!=null&&(c=Cs({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(c),o=z.getInnerMostAxes(o.length,c.shape.length)),o=[o[0]],z.assertAxesAreInnerMostDims("argMax",o,c.shape.length);let[u,h]=z.computeOutAndReduceShapes(c.shape,o),p=E.sizeFromShape(u),m=E.makeZerosTypedArray(p,"int32"),f=E.sizeFromShape(h),g=n.data.get(c.dataId).values;for(let x=0;x<m.length;++x){let y=x*f,b=g[y],v=0;for(let w=0;w<f;++w){let k=g[y+w];k>b&&(b=k,v=w)}m[x]=v}return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",m)}var zEe={kernelName:Wf,backendName:"cpu",kernelFunc:LEe};function BEe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r;vt(a,"argMin");let o=E.parseAxisParam(s,a.shape),l=z.getAxesPermutation(o,a.shape.length),c=a,d=[];l!=null&&(c=Cs({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(c),o=z.getInnerMostAxes(o.length,c.shape.length)),o=[o[0]],z.assertAxesAreInnerMostDims("argMin",o,c.shape.length);let[u,h]=z.computeOutAndReduceShapes(c.shape,o),p=E.sizeFromShape(u),m=E.makeZerosTypedArray(p,"int32"),f=E.sizeFromShape(h),g=n.data.get(c.dataId).values;for(let x=0;x<m.length;++x){let y=x*f,b=g[y],v=0;for(let w=0;w<f;++w){let k=g[y+w];k<b&&(b=k,v=w)}m[x]=v}return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",m)}var WEe={kernelName:Uf,backendName:"cpu",kernelFunc:BEe},UEe=lr(Ih,e=>Math.asin(e)),VEe={kernelName:Ih,backendName:"cpu",kernelFunc:UEe},HEe=lr(Th,e=>Math.asinh(e)),GEe={kernelName:Th,backendName:"cpu",kernelFunc:HEe},qEe=lr(Eh,e=>Math.atan(e)),KEe={kernelName:Eh,backendName:"cpu",kernelFunc:qEe},YEe=Kr((e,t)=>Math.atan2(e,t)),XEe=ma(Rh,YEe),ZEe={kernelName:Rh,backendName:"cpu",kernelFunc:XEe},QEe=lr(Ah,e=>Math.atanh(e)),JEe={kernelName:Ah,backendName:"cpu",kernelFunc:QEe};function qA(e,t,n,r,a,s){let o=a.strideHeight,l=a.strideWidth,c=a.dilationHeight,d=a.dilationWidth,u=a.effectiveFilterHeight,h=a.effectiveFilterWidth,p=a.padInfo.top,m=a.padInfo.left,f=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=pn(a.outShape,n),x=g.values,y=a.outShape[1]*a.outShape[2]*a.outShape[3],b=a.outShape[2]*a.outShape[3],v=a.outShape[3];for(let w=0;w<a.batchSize;++w){let k=w*y,C=w*r[0];for(let S=0;S<a.inChannels;++S)for(let _=0;_<a.outHeight;++_){let I=_*o-p,T=Math.max(0,I),A=Math.min(a.inHeight,u+I),j=k+_*b;for(let D=0;D<a.outWidth;++D){let F=D*l-m,B=Math.max(0,F),q=Math.min(a.inWidth,h+F),$=f,L=0,M=0;for(let G=T;G<A;G+=c){let W=C+G*r[1];for(let O=B;O<q;O+=d){let U=W+O*r[2],K=e[U+S];s==="max"&&K>$?$=K:s==="avg"&&(L+=K,M++)}if(isNaN($))break}let X=j+D*v+S;x[X]=s==="avg"?L/M:$}}}return g}function DG(e,t,n,r,a=!1,s=!1){let o=pn(r.outShape,"int32"),l=r.strideHeight,c=r.strideWidth,d=r.dilationHeight,u=r.dilationWidth,h=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.top,f=r.padInfo.left,g=pn(t,n,e);for(let x=0;x<r.batchSize;++x)for(let y=0;y<r.inChannels;++y)for(let b=0;b<r.outHeight;++b){let v=b*l-m,w=v;for(;w<0;)w+=d;let k=Math.min(r.inHeight,h+v);for(let C=0;C<r.outWidth;++C){let S=C*c-f,_=S;for(;_<0;)_+=u;let I=Math.min(r.inWidth,p+S),T=Number.NEGATIVE_INFINITY,A=-1;for(let j=w;j<k;j+=d){let D=j-v;for(let F=_;F<I;F+=u){let B=F-S,q=g.get(x,j,F,y);q>T&&(T=q,a?A=s?((x*r.inHeight+j)*r.inWidth+F)*r.inChannels+y:(j*r.inWidth+F)*r.inChannels+y:A=D*p+B)}}o.set(A,x,b,C,y)}}return o}function MG(e,t,n,r,a,s){let o=a.strideDepth,l=a.strideHeight,c=a.strideWidth,d=a.dilationDepth,u=a.dilationHeight,h=a.dilationWidth,p=a.effectiveFilterDepth,m=a.effectiveFilterHeight,f=a.effectiveFilterWidth,g=a.padInfo.front,x=a.padInfo.top,y=a.padInfo.left,b=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=pn(a.outShape,n),w=v.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],C=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],_=a.outShape[4];for(let I=0;I<a.batchSize;++I){let T=I*k,A=I*r[0];for(let j=0;j<a.inChannels;++j)for(let D=0;D<a.outDepth;++D){let F=D*o-g,B=F;for(;B<0;)B+=d;let q=Math.min(a.inDepth,p+F),$=T+D*C;for(let L=0;L<a.outHeight;++L){let M=L*l-x,X=M;for(;X<0;)X+=u;let G=Math.min(a.inHeight,m+M),W=$+L*S;for(let O=0;O<a.outWidth;++O){let U=O*c-y,K=U;for(;K<0;)K+=h;let ce=Math.min(a.inWidth,f+U),ne=W+O*_,te=b,Te=0,Ae=0;for(let we=B;we<q;we+=d){let Fe=A+we*r[1];for(let Q=X;Q<G;Q+=u){let $e=Fe+Q*r[2];for(let Le=K;Le<ce;Le+=h){let Xe=$e+Le*r[3],Ye=e[Xe+j];if(s==="max"&&Ye>te?te=Ye:s==="avg"&&(Te+=Ye,Ae++),isNaN(te))break}if(isNaN(te))break}if(isNaN(te))break}let Se=ne+j;w[Se]=s==="avg"?Te/Math.max(Ae,1):te}}}}return v}function eAe(e,t){let n=pn(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,s=t.strideWidth,o=t.dilationDepth,l=t.dilationHeight,c=t.dilationWidth,d=t.effectiveFilterDepth,u=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.front,m=t.padInfo.top,f=t.padInfo.left;for(let g=0;g<t.batchSize;++g)for(let x=0;x<t.inChannels;++x)for(let y=0;y<t.outDepth;++y){let b=y*r-p,v=b;for(;v<0;)v+=o;let w=Math.min(t.inDepth,d+b);for(let k=0;k<t.outHeight;++k){let C=k*a-m,S=C;for(;S<0;)S+=l;let _=Math.min(t.inHeight,u+C);for(let I=0;I<t.outWidth;++I){let T=I*s-f,A=T;for(;A<0;)A+=c;let j=Math.min(t.inWidth,h+T),D=Number.NEGATIVE_INFINITY,F=-1;for(let B=v;B<w;B+=o){let q=B-b;for(let $=S;$<_;$+=l){let L=$-C;for(let M=A;M<j;M+=c){let X=M-T,G=e.get(g,B,$,M,x);G>=D&&(D=G,F=q*u*h+L*u+X)}}}n.set(F,g,y,k,I,x)}}}return n}function tAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;vt(a,"avgPool");let{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r,d=1;E.assert(z.eitherStridesOrDilationsAreOne(o,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);let u=z.computePool2DInfo(a.shape,s,o,d,l,c),h;if(u.filterWidth===1&&u.filterHeight===1&&E.arraysEqual(u.inShape,u.outShape))h=ul({inputs:{x:a},backend:n});else{let p=n.data.get(a.dataId).values,m=E.computeStrides(a.shape),f=qA(p,a.shape,a.dtype,m,u,"avg");h=n.makeTensorInfo(u.outShape,a.dtype,f.values)}return h}var nAe={kernelName:Dh,backendName:"cpu",kernelFunc:tAe};function rAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=r;vt(a,"avgPool3d");let u=z.computePool3DInfo(a.shape,s,o,1,l,c,d),h=n.data.get(a.dataId).values,p=MG(h,a.shape,a.dtype,E.computeStrides(a.shape),u,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}var aAe={kernelName:Vf,backendName:"cpu",kernelFunc:rAe};function sAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=r;vt([a,s],"avgPool3DGrad");let u=z.computePool3DInfo(s.shape,o,l,1,c,d),h=u.strideDepth,p=u.strideHeight,m=u.strideWidth,f=u.filterDepth,g=u.filterHeight,x=u.filterWidth,y=u.dilationDepth,b=u.dilationHeight,v=u.dilationWidth,w=u.effectiveFilterDepth,k=u.effectiveFilterHeight,C=u.effectiveFilterWidth,S=w-1-u.padInfo.front,_=C-1-u.padInfo.left,I=k-1-u.padInfo.top,T=pn(s.shape,"float32"),A=1/(f*g*x),j=n.bufferSync(a);for(let D=0;D<u.batchSize;++D)for(let F=0;F<u.inChannels;++F)for(let B=0;B<u.inDepth;++B)for(let q=0;q<u.inHeight;++q)for(let $=0;$<u.inWidth;++$){let L=B-S,M=q-I,X=$-_,G=0;for(let W=0;W<w;W+=y){let O=(L+W)/h;if(!(O<0||O>=u.outDepth||Math.floor(O)!==O))for(let U=0;U<k;U+=b){let K=(M+U)/p;if(!(K<0||K>=u.outHeight||Math.floor(K)!==K))for(let ce=0;ce<C;ce+=v){let ne=(X+ce)/m;if(ne<0||ne>=u.outWidth||Math.floor(ne)!==ne)continue;let te=j.get(D,O,K,ne,F);G+=te}}}T.set(G*A,D,B,q,$,F)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}var iAe={kernelName:kb,backendName:"cpu",kernelFunc:sAe};function oAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,o=s;vt([a,s],"avgPoolGrad");let{filterSize:l,strides:c,pad:d}=r,u=z.computePool2DInfo(o.shape,l,c,1,d),h=u.strideHeight,p=u.strideWidth,m=u.filterHeight,f=u.filterWidth,g=u.dilationHeight,x=u.dilationWidth,y=u.effectiveFilterHeight,b=u.effectiveFilterWidth,v=b-1-u.padInfo.left,w=y-1-u.padInfo.top,k=pn(o.shape,"float32"),C=1/(m*f),S=n.data.get(a.dataId).values,_=pn(a.shape,"float32",S);for(let I=0;I<u.batchSize;++I)for(let T=0;T<u.inChannels;++T)for(let A=0;A<u.inHeight;++A)for(let j=0;j<u.inWidth;++j){let D=A-w,F=j-v,B=0;for(let q=0;q<y;q+=g){let $=(D+q)/h;if(!($<0||$>=u.outHeight||Math.floor($)!==$))for(let L=0;L<b;L+=x){let M=(F+L)/p;if(M<0||M>=u.outWidth||Math.floor(M)!==M)continue;let X=_.get(I,$,M,T);B+=X}}k.set(B*C,I,A,j,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}var lAe={kernelName:Nb,backendName:"cpu",kernelFunc:oAe};function cAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,scale:s,offset:o,mean:l,variance:c}=t;E.assert(l.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E.assert(o==null||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E.assert(s==null||l.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),vt([a,l,c,s,o],"batchNorm");let{varianceEpsilon:d}=r;d==null&&(d=.001);let u=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,p=n.data.get(c.dataId).values,m=s?n.data.get(s.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),x=f.length,y=m.length,b=p.length,v=h.length,w=0,k=0,C=0,S=0;for(let _=0;_<u.length;++_)g[_]=f[w++]+(u[_]-h[k++])*m[C++]/Math.sqrt(p[S++]+d),w>=x&&(w=0),k>=v&&(k=0),C>=y&&(C=0),S>=b&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,g)}var uAe={kernelName:Qh,backendName:"cpu",kernelFunc:cAe};function dAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:o}=r;vt([a],"batchToSpaceND");let l=s.reduce((y,b)=>y*b),c=z.getReshaped(a.shape,s,l),d=z.getPermuted(c.length,s.length),u=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(o,s.length),p=z.getSliceSize(u,o,s.length),m=_r({inputs:{x:a},backend:n,attrs:{shape:c}}),f=Cs({inputs:{x:m},backend:n,attrs:{perm:d}}),g=_r({inputs:{x:f},backend:n,attrs:{shape:u}}),x=fh({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}var hAe={kernelName:Hf,backendName:"cpu",kernelFunc:dAe};function pAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:o}=r,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,d=FA(l,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,d)}var mAe={kernelName:Gf,backendName:"cpu",kernelFunc:pAe};function fAe(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(o));return n.makeTensorInfo([l.length],"int32",Int32Array.from(l))}var gAe={kernelName:Sb,backendName:"cpu",kernelFunc:fAe},xAe=lr(ju,(e,t)=>{let n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e}),yAe={kernelName:ju,backendName:"cpu",kernelFunc:xAe},bAe=e=>{let{x:t}=e.inputs,n=e.backend,r=new Float32Array(E.sizeFromShape(t.shape)),a=n.data.get(t.dataId),s=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values;for(let d=0;d<l.length;d++){let u=l[d],h=c[d];r[d]=Math.hypot(u,h)}return n.makeOutput(r,t.shape,"float32")},vAe={kernelName:Cb,backendName:"cpu",kernelFunc:bAe};function Cf(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.data.get(r.dataId).complexTensorInfos.imag,s=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,s)}var wAe={kernelName:G1,backendName:"cpu",kernelFunc:Cf};function _f(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=E.parseAxisParam(a,t[0].shape)[0],o=t.map(g=>g.shape);z.assertParamsConsistent(o,s);let l=z.computeOutShape(t.map(g=>g.shape),s);if(E.sizeFromShape(l)===0)return n.makeTensorInfo(l,t[0].dtype,[]);let c=t.filter(g=>E.sizeFromShape(g.shape)>0);if(c.length===1)return ul({inputs:{x:c[0]},backend:n});if(c[0].dtype==="complex64"){let g=c.map(w=>mh({inputs:{input:w},backend:n})),x=c.map(w=>Cf({inputs:{input:w},backend:n})),y=_f({inputs:g,backend:n,attrs:{axis:s}}),b=_f({inputs:x,backend:n,attrs:{axis:s}}),v=zs({inputs:{real:y,imag:b},backend:n});return g.forEach(w=>n.disposeIntermediateTensorInfo(w)),x.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),v}let d=c.map(g=>{let x=[-1,E.sizeFromShape(g.shape.slice(s))];return _r({inputs:{x:g},backend:n,attrs:{shape:x}})}),u=d.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));l=z.computeOutShape(d.map(g=>g.shape),1);let h=d[0].shape[0]===1,p=PA(u,l,t[0].dtype,h),m=z.computeOutShape(c.map(g=>g.shape),s),f=n.makeTensorInfo(m,t[0].dtype,p);return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var NAe={kernelName:Kf,backendName:"cpu",kernelFunc:_f};function $G(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dataFormat:c,dilations:d,dimRoundingMode:u}=r;vt([a,s],"conv2d");let h=z.convertConv2DDataFormat(c),p=z.computeConv2DInfo(a.shape,s.shape,o,d,l,u,!1,h),m=p.filterHeight,f=p.filterWidth,g=p.dilationHeight,x=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v=p.dataFormat==="channelsLast",w=new Qr(p.outShape,a.dtype),k=E.computeStrides(a.shape),C=E.computeStrides(s.shape),S=k[0],_=v?k[1]:k[2],I=v?k[2]:1,T=v?1:k[1],A=w.strides[0],j=v?w.strides[1]:w.strides[2],D=v?w.strides[2]:1,F=v?1:w.strides[1],B=n.data.get(a.dataId).values,q=n.data.get(s.dataId).values,$=w.values;for(let L=0;L<p.batchSize;++L){let M=L*S,X=L*A;for(let G=0;G<p.outHeight;++G){let W=X+G*j,O=G*p.strideHeight-b;for(let U=0;U<m;++U){let K=O+U*g;if(K<0||K>=p.inHeight)continue;let ce=U*C[0],ne=M+K*_;for(let te=0;te<p.outWidth;++te){let Te=W+te*D,Ae=te*p.strideWidth-y;for(let Se=0;Se<f;++Se){let we=Ae+Se*x;if(we<0||we>=p.inWidth)continue;let Fe=ce+Se*C[1],Q=ne+we*I,$e=Fe;for(let Le=0;Le<p.inChannels;++Le){let Xe=B[Q+Le*T];for(let Ye=0;Ye<p.outChannels;++Ye)$[Te+Ye*F]+=Xe*q[$e+Ye];$e+=p.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,$)}var kAe={kernelName:Ph,backendName:"cpu",kernelFunc:$G};function SAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,pad:l,dataFormat:c,dimRoundingMode:d,filterShape:u}=r;vt([a,s],"conv2dBackpropFilter");let h=z.convertConv2DDataFormat(c),p=z.computeConv2DInfo(a.shape,u,o,1,l,d,!1,h),{strideHeight:m,strideWidth:f,filterHeight:g,filterWidth:x}=p,y=p.dataFormat==="channelsLast",b=new Qr(p.filterShape,"float32"),v=p.padInfo.left,w=p.padInfo.top,k=n.data.get(a.dataId).values,C=n.data.get(s.dataId).values,S=new Qr(a.shape,a.dtype,k),_=new Qr(s.shape,s.dtype,C);for(let I=0;I<g;++I){let T=Math.max(0,Math.ceil((w-I)/m)),A=Math.min(p.outHeight,(p.inHeight+w-I)/m);for(let j=0;j<x;++j){let D=Math.max(0,Math.ceil((v-j)/f)),F=Math.min(p.outWidth,(p.inWidth+v-j)/f);for(let B=0;B<p.inChannels;++B)for(let q=0;q<p.outChannels;++q){let $=0;for(let L=0;L<p.batchSize;++L)for(let M=T;M<A;++M){let X=I+M*m-w;for(let G=D;G<F;++G){let W=j+G*f-v;y?$+=S.get(L,X,W,B)*_.get(L,M,G,q):$+=S.get(L,B,X,W)*_.get(L,q,M,G)}}b.set($,I,j,B,q)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}var CAe={kernelName:L1,backendName:"cpu",kernelFunc:SAe};function _Ae(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:o,strides:l,pad:c,dataFormat:d,dimRoundingMode:u}=r;vt([a,s],"conv2dBackpropInput");let h=E.computeStrides(s.shape),p=E.computeStrides(a.shape),m=z.convertConv2DDataFormat(d),f=z.computeConv2DInfo(o,s.shape,l,1,c,u,!1,m),g=new Qr(f.inShape,"float32"),x=g.values,y=n.data.get(a.dataId).values,b=n.data.get(s.dataId).values,[v,w,k]=h,{batchSize:C,filterHeight:S,filterWidth:_,inChannels:I,inHeight:T,inWidth:A,outChannels:j,outHeight:D,outWidth:F,strideHeight:B,strideWidth:q}=f;m=f.dataFormat;let $=S-1-f.padInfo.top,L=_-1-f.padInfo.left,M=m==="channelsLast",X=g.strides[0],G=M?g.strides[1]:g.strides[2],W=M?g.strides[2]:1,O=M?1:g.strides[1],U=p[0],K=M?p[1]:p[2],ce=M?p[2]:1,ne=M?1:p[1];for(let te=0;te<C;++te)for(let Te=0;Te<I;++Te)for(let Ae=0;Ae<T;++Ae){let Se=Ae-$,we=Math.max(0,Math.ceil(Se/B)),Fe=Math.min(D,(S+Se)/B);for(let Q=0;Q<A;++Q){let $e=Q-L,Le=Math.max(0,Math.ceil($e/q)),Xe=Math.min(F,(_+$e)/q),Ye=0;for(let le=we;le<Fe;++le){let V=le*B-Se;for(let ee=Le;ee<Xe;++ee){let ve=ee*q-$e,ke=U*te+K*le+ce*ee,Ce=v*(S-1-V)+w*(_-1-ve)+k*Te;for(let be=0;be<j;++be){let Ee=y[ke+ne*be],Ue=b[Ce+be];Ye+=Ee*Ue}}}let Je=X*te+G*Ae+W*Q+O*Te;x[Je]=Ye}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}var jAe={kernelName:Oh,backendName:"cpu",kernelFunc:_Ae};function IAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c}=r;vt([a,s],"conv3d");let d=z.computeConv3DInfo(a.shape,s.shape,o,c,l),{filterDepth:u,filterHeight:h,filterWidth:p,dilationDepth:m,dilationHeight:f,dilationWidth:g,padInfo:x}=d,y=x.front,b=x.left,v=x.top,w=new Qr(d.outShape,a.dtype),k=n.data.get(a.dataId).values,C=n.data.get(s.dataId).values,S=w.values,_=E.computeStrides(a.shape),I=E.computeStrides(s.shape);for(let T=0;T<d.batchSize;++T){let A=T*_[0],j=T*w.strides[0];for(let D=0;D<d.outDepth;++D){let F=j+D*w.strides[1],B=D*d.strideDepth-y;for(let q=0;q<u;++q){let $=B+q*m;if($<0||$>=d.inDepth)continue;let L=q*I[0],M=A+$*_[1];for(let X=0;X<d.outHeight;++X){let G=F+X*w.strides[2],W=X*d.strideHeight-v;for(let O=0;O<h;++O){let U=W+O*f;if(U<0||U>=d.inHeight)continue;let K=L+O*I[1],ce=M+U*_[2];for(let ne=0;ne<d.outWidth;++ne){let te=G+ne*d.outChannels,Te=ne*d.strideWidth-b;for(let Ae=0;Ae<p;++Ae){let Se=Te+Ae*g;if(Se<0||Se>=d.inWidth)continue;let we=K+Ae*I[2],Fe=ce+Se*d.inChannels,Q=we;for(let $e=0;$e<d.inChannels;++$e){let Le=k[Fe+$e];for(let Xe=0;Xe<d.outChannels;++Xe)S[te+Xe]+=Le*C[Q+Xe];Q+=d.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var TAe={kernelName:Lh,backendName:"cpu",kernelFunc:IAe};function EAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,pad:l,filterShape:c}=r;vt([a,s],"conv3dBackpropFilterV2");let d=E.computeStrides(a.shape),u=E.computeStrides(s.shape),h=z.computeConv3DInfo(a.shape,c,o,1,l),p=h.strideDepth,m=h.strideHeight,f=h.strideWidth,g=h.filterDepth,x=h.filterHeight,y=h.filterWidth,b=new Qr(h.filterShape,"float32"),v=b.values,[w,k,C,S]=b.strides,_=n.data.get(s.dataId).values,[I,T,A,j]=u,D=n.data.get(a.dataId).values,[F,B,q,$]=d,L=h.padInfo.front,M=h.padInfo.left,X=h.padInfo.top;for(let G=0;G<g;++G){let W=Math.max(0,Math.ceil((L-G)/p)),O=Math.min(h.outDepth,(h.inDepth+L-G)/p),U=G*w;for(let K=0;K<x;++K){let ce=Math.max(0,Math.ceil((X-K)/m)),ne=Math.min(h.outHeight,(h.inHeight+X-K)/m),te=K*k+U;for(let Te=0;Te<y;++Te){let Ae=Math.max(0,Math.ceil((M-Te)/f)),Se=Math.min(h.outWidth,(h.inWidth+M-Te)/f),we=Te*C+te;for(let Fe=0;Fe<h.inChannels;++Fe){let Q=Fe*S+we;for(let $e=0;$e<h.outChannels;++$e){let Le=0;for(let Xe=0;Xe<h.batchSize;++Xe){let Ye=Xe*F,Je=Xe*I;for(let le=W;le<O;++le){let V=(G+le*p-L)*B+Ye,ee=le*T+Je;for(let ve=ce;ve<ne;++ve){let ke=(K+ve*m-X)*q+V,Ce=ve*A+ee;for(let be=Ae;be<Se;++be){let Ee=(Te+be*f-M)*$+ke,Ue=be*j+Ce;Le+=D[Ee+Fe]*_[Ue+$e]}}}}v[Q+$e]=Le}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}var AAe={kernelName:Yf,backendName:"cpu",kernelFunc:EAe};function RAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:o,strides:l,inputShape:c}=r;vt([a],"conv3dBackpropInputV2");let d=E.computeStrides(a.shape),u=E.computeStrides(s.shape),h=z.computeConv3DInfo(c,s.shape,l,1,o),p=new Qr(h.inShape,"float32"),m=p.values,[f,g,x,y]=p.strides,b=n.data.get(a.dataId).values,[v,w,k,C]=d,S=n.data.get(s.dataId).values,[_,I,T,A]=u,{batchSize:j,filterDepth:D,filterHeight:F,filterWidth:B,inChannels:q,inDepth:$,inHeight:L,inWidth:M,outChannels:X,outDepth:G,outHeight:W,outWidth:O,strideDepth:U,strideHeight:K,strideWidth:ce}=h,ne=D-1-h.padInfo.front,te=F-1-h.padInfo.top,Te=B-1-h.padInfo.left;for(let Ae=0;Ae<j;++Ae)for(let Se=0;Se<q;++Se)for(let we=0;we<$;++we){let Fe=we-ne,Q=Math.max(0,Math.ceil(Fe/U)),$e=Math.min(G,(D+Fe)/U);for(let Le=0;Le<L;++Le){let Xe=Le-te,Ye=Math.max(0,Math.ceil(Xe/K)),Je=Math.min(W,(F+Xe)/K);for(let le=0;le<M;++le){let V=le-Te,ee=Math.max(0,Math.ceil(V/ce)),ve=Math.min(O,(B+V)/ce),ke=0;for(let Ce=Q;Ce<$e;++Ce){let be=Ce*U-Fe;for(let Ee=Ye;Ee<Je;++Ee){let Ue=Ee*K-Xe;for(let Qe=ee;Qe<ve;++Qe){let _t=Qe*ce-V,$t=v*Ae+w*Ce+k*Ee+C*Qe,Ve=_*(D-1-be)+I*(F-1-Ue)+T*(B-1-_t)+A*Se;for(let tt=0;tt<X;++tt){let yt=b[$t+tt],ut=S[Ve+tt];ke+=yt*ut}}}}m[f*Ae+g*we+x*Le+y*le+Se]=ke}}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}var DAe={kernelName:Xf,backendName:"cpu",kernelFunc:RAe},MAe=lr(zh,e=>Math.cos(e)),$Ae={kernelName:zh,backendName:"cpu",kernelFunc:MAe},FAe=lr(Bh,e=>Math.cosh(e)),PAe={kernelName:Bh,backendName:"cpu",kernelFunc:FAe};function OAe(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:o}=t,{cropSize:l,method:c,extrapolationValue:d}=r,[u,h,p,m]=a.shape,f=s.shape[0],[g,x]=l,y=pn([f,g,x,m],"float32"),b=n.data.get(s.dataId).values,v=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,k=E.computeStrides(a.shape),C=E.computeStrides(y.shape);for(let S=0;S<f;S++){let _=S*4,I=b[_],T=b[_+1],A=b[_+2],j=b[_+3],D=v[S];if(D>=u)continue;let F=g>1?(A-I)*(h-1)/(g-1):0,B=x>1?(j-T)*(p-1)/(x-1):0;for(let q=0;q<g;q++){let $=g>1?I*(h-1)+q*F:.5*(I+A)*(h-1);if($<0||$>h-1){for(let L=0;L<x;L++)for(let M=0;M<m;M++){let X=M+L*C[2]+q*C[1]+S*C[0];y.values[X]=d}continue}if(c==="bilinear"){let L=Math.floor($),M=Math.ceil($),X=$-L;for(let G=0;G<x;G++){let W=x>1?T*(p-1)+G*B:.5*(T+j)*(p-1);if(W<0||W>p-1){for(let ce=0;ce<m;ce++){let ne=ce+G*C[2]+q*C[1]+S*C[0];y.values[ne]=d}continue}let O=Math.floor(W),U=Math.ceil(W),K=W-O;for(let ce=0;ce<m;ce++){let ne=ce+O*k[2]+L*k[1]+D*k[0],te=w[ne];ne=ce+U*k[2]+L*k[1]+D*k[0];let Te=w[ne];ne=ce+O*k[2]+M*k[1]+D*k[0];let Ae=w[ne];ne=ce+U*k[2]+M*k[1]+D*k[0];let Se=w[ne],we=te+(Te-te)*K,Fe=Ae+(Se-Ae)*K;ne=ce+G*C[2]+q*C[1]+S*C[0],y.values[ne]=we+(Fe-we)*X}}}else for(let L=0;L<x;++L){let M=x>1?T*(p-1)+L*B:.5*(T+j)*(p-1);if(M<0||M>p-1){for(let W=0;W<m;W++){let O=W+L*C[2]+q*C[1]+S*C[0];y.values[O]=d}continue}let X=Math.round(M),G=Math.round($);for(let W=0;W<m;W++){let O=W+X*k[2]+G*k[1]+D*k[0],U=W+L*C[2]+q*C[1]+S*C[0];y.values[U]=w[O]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}var LAe={kernelName:Qf,backendName:"cpu",kernelFunc:OAe};function zAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r;vt(a,"cumprod");let c=z.getAxesPermutation([s],a.shape.length),d=a;c!=null&&(d=Cs({inputs:{x:a},backend:n,attrs:{perm:c}}));let u=z.getInnerMostAxes(1,a.shape.length)[0];if(u!==d.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${u}`);let h=mi(d.dtype,"int32"),p=E.makeOnesTypedArray(E.sizeFromShape(d.shape),h),m=n.data.get(d.dataId).values,f=d.shape[d.shape.length-1],g=l?(y,b)=>y+f-b-1:(y,b)=>y+b;for(let y=0;y<m.length;y+=f)for(let b=0;b<f;b++){let v=g(y,b);if(b===0)p[v]=o?1:m[v];else{let w=g(y,b-1);p[v]=o?m[w]*p[w]:m[v]*p[w]}}let x=n.makeTensorInfo(d.shape,h,p);if(c!=null){let y=z.getUndoAxesPermutation(c),b=Cs({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(d),b}return x}var BAe={kernelName:Zf,backendName:"cpu",kernelFunc:zAe};function WAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r;vt(a,"cumsum");let c=z.getAxesPermutation([s],a.shape.length),d=a;c!=null&&(d=Cs({inputs:{x:a},backend:n,attrs:{perm:c}}));let u=z.getInnerMostAxes(1,a.shape.length)[0];if(u!==d.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${u}`);let h=mi(d.dtype,"int32"),p=E.makeZerosTypedArray(E.sizeFromShape(d.shape),h),m=n.data.get(d.dataId).values,f=d.shape[d.shape.length-1],g=l?(y,b)=>y+f-b-1:(y,b)=>y+b;for(let y=0;y<m.length;y+=f)for(let b=0;b<f;b++){let v=g(y,b);if(b===0)p[v]=o?0:m[v];else{let w=g(y,b-1);p[v]=o?m[w]+p[w]:m[v]+p[w]}}let x=n.makeTensorInfo(d.shape,h,p);if(c!=null){let y=z.getUndoAxesPermutation(c),b=Cs({inputs:{x},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(d),b}return x}var UAe={kernelName:Wh,backendName:"cpu",kernelFunc:WAe};function VAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:o,binaryOutput:l}=r;if(a.shape.length===1){let c=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,u=FA(c,d,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(a.shape.length===2){let c=n.bufferSync(a),d=n.bufferSync(s),u=UH(c,d,o,l);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var HAe={kernelName:_b,backendName:"cpu",kernelFunc:VAe};function GAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:o}=r;E.assert(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);let l=a.shape[0],c=a.shape[1],d=a.shape[2],u=a.shape[3],h=c*s,p=d*s,m=u/(s*s),f=n.data.get(a.dataId).values,g=new Float32Array(l*h*p*m),x=0;for(let y=0;y<l;++y)for(let b=0;b<h;++b){let v=Math.floor(b/s),w=b%s;for(let k=0;k<p;++k){let C=Math.floor(k/s),S=k%s,_=(w*s+S)*m;for(let I=0;I<m;++I){let T=I+_+u*(C+d*(v+c*y));g[x++]=f[T]}}}return n.makeTensorInfo([l,h,p,m],a.dtype,g)}var qAe={kernelName:Jf,backendName:"cpu",kernelFunc:GAe};function FG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c,dimRoundingMode:d}=r;vt([a,s],"depthwiseConv2DNative");let u=E.computeStrides(a.shape),h=E.computeStrides(s.shape),p=c;p==null&&(p=[1,1]),E.assert(z.eitherStridesOrDilationsAreOne(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);let m=z.computeConv2DInfo(a.shape,s.shape,o,p,l,d,!0),{filterHeight:f,filterWidth:g,dilationHeight:x,dilationWidth:y,padInfo:b}=m,v=b.left,w=b.top,k=m.outChannels/m.inChannels,C=new Qr(m.outShape,a.dtype),S=n.data.get(a.dataId).values,_=n.data.get(s.dataId).values,I=C.values;for(let T=0;T<m.batchSize;++T){let A=T*u[0],j=T*C.strides[0];for(let D=0;D<m.outHeight;++D){let F=j+D*C.strides[1],B=D*m.strideHeight-w;for(let q=0;q<f;++q){let $=B+q*x;if($<0||$>=m.inHeight)continue;let L=q*h[0],M=A+$*u[1];for(let X=0;X<m.outWidth;++X){let G=F+X*C.strides[2],W=X*m.strideWidth-v;for(let O=0;O<g;++O){let U=W+O*y;if(U<0||U>=m.inWidth)continue;let K=L+O*h[1],ce=M+U*m.inChannels,ne=G,te=K;for(let Te=0;Te<m.inChannels;++Te){let Ae=S[ce+Te];for(let Se=0;Se<k;++Se)I[ne+Se]+=Ae*_[te+Se];ne+=k,te+=k}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}var KAe={kernelName:Uh,backendName:"cpu",kernelFunc:FG};function YAe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,dilations:l,pad:c,dimRoundingMode:d,filterShape:u}=r;vt([a,s],"depthwiseConv2dNativeBackpropFilter");let h=z.computeConv2DInfo(a.shape,u,o,l,c,d,!0),{strideHeight:p,strideWidth:m,filterHeight:f,filterWidth:g}=h,x=new Qr(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=n.data.get(a.dataId).values,k=new Qr(a.shape,a.dtype,w),C=n.data.get(s.dataId).values,S=new Qr(s.shape,s.dtype,C);for(let _=0;_<f;++_){let I=Math.max(0,Math.ceil((b-_)/p)),T=Math.min(h.outHeight,(h.inHeight+b-_)/p);for(let A=0;A<g;++A){let j=Math.max(0,Math.ceil((y-A)/m)),D=Math.min(h.outWidth,(h.inWidth+y-A)/m);for(let F=0;F<h.outChannels;++F){let B=Math.trunc(F/v),q=F%v,$=0;for(let L=0;L<h.batchSize;++L)for(let M=I;M<T;++M){let X=_+M*p-b;for(let G=j;G<D;++G){let W=A+G*m-y;$+=k.get(L,X,W,B)*S.get(L,M,G,F)}}x.set($,_,A,B,q)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}var XAe={kernelName:z1,backendName:"cpu",kernelFunc:YAe};function ZAe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:o,dilations:l,pad:c,dimRoundingMode:d,inputShape:u}=r;vt([a,s],"depthwiseConv2DNativeBackpropInput");let h=E.computeStrides(a.shape),p=E.computeStrides(s.shape),m=z.computeConv2DInfo(u,s.shape,o,l,c,d,!0),f=new Qr(m.inShape,"float32"),g=f.values,[x,y,b]=f.strides,v=n.data.get(a.dataId).values,[w,k,C]=h,S=n.data.get(s.dataId).values,[_,I,T]=p,{batchSize:A,filterHeight:j,filterWidth:D,inChannels:F,inHeight:B,inWidth:q,outChannels:$,outHeight:L,outWidth:M,strideHeight:X,strideWidth:G}=m,W=j-1-m.padInfo.top,O=D-1-m.padInfo.left,U=$/F;for(let K=0;K<A;++K)for(let ce=0;ce<F;++ce)for(let ne=0;ne<B;++ne){let te=ne-W,Te=Math.max(0,Math.ceil(te/X)),Ae=Math.min(L,(j+te)/X);for(let Se=0;Se<q;++Se){let we=Se-O,Fe=Math.max(0,Math.ceil(we/G)),Q=Math.min(M,(D+we)/G),$e=0;for(let Le=Te;Le<Ae;++Le){let Xe=Le*X-te;for(let Ye=Fe;Ye<Q;++Ye){let Je=Ye*G-we,le=w*K+k*Le+C*Ye,V=_*(j-1-Xe)+I*(D-1-Je)+T*ce;for(let ee=0;ee<U;++ee){let ve=ce*U+ee,ke=v[le+ve],Ce=S[V+ee];$e+=ke*Ce}}}g[x*K+y*ne+b*Se+ce]=$e}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}var QAe={kernelName:B1,backendName:"cpu",kernelFunc:ZAe};function JAe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=E.sizeFromShape(r.shape),s=n.data.get(r.dataId).values,o=pn([a,a],r.dtype),l=o.values;for(let d=0;d<s.length;d++)l[d*a+d]=s[d];let c=[...r.shape,...r.shape];return n.makeTensorInfo(c,o.dtype,o.values)}var eRe={kernelName:jb,backendName:"cpu",kernelFunc:JAe},tRe={kernelName:Vh,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a}=e,{strides:s,pad:o,dilations:l}=n,c=t,d=c.data.get(r.dataId).values,u=r.shape.length,h=c.data.get(a.dataId).values,p=a.shape.length,{batchSize:m,inHeight:f,inWidth:g,inChannels:x,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:k,filterHeight:C,filterWidth:S,dilationHeight:_,dilationWidth:I,outShape:T}=z.computeDilation2DInfo(r.shape,a.shape,s,o,"NHWC",l),A=E.sizeFromShape(T),j=T.length,D=E.getArrayFromDType(r.dtype,A);for(let F=0;F<m;++F)for(let B=0;B<y;++B){let q=B*w-v.top;for(let $=0;$<b;++$){let L=$*k-v.left;for(let M=0;M<x;++M){let X=Number.MIN_SAFE_INTEGER;for(let W=0;W<C;++W){let O=q+W*_;if(O>=0&&O<f)for(let U=0;U<S;++U){let K=L+U*I;if(K>=0&&K<g){let ce=E.locToIndex([F,O,K,M],u,E.computeStrides(r.shape)),ne=E.locToIndex([W,U,M],p,E.computeStrides(a.shape)),te=d[ce]+h[ne];te>X&&(X=te)}}}let G=E.locToIndex([F,B,$,M],j,E.computeStrides(T));D[G]=X}}}return{dataId:c.write(E.toTypedArray(D,r.dtype),T,r.dtype),shape:T,dtype:r.dtype}}},nRe={kernelName:hf,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:o,pad:l,dilations:c}=n,d=t,u=E.toNestedArray(r.shape,d.data.get(r.dataId).values),h=E.toNestedArray(a.shape,d.data.get(a.dataId).values),{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:k,filterWidth:C,dilationHeight:S,dilationWidth:_,outShape:I}=z.computeDilation2DInfo(r.shape,a.shape,o,l,"NHWC",c);E.assert(s.rank===I.length,()=>`Error in ${hf}, dy must have the same rank as output ${I.length}, but got ${s.rank}`);let T=E.toNestedArray(I,d.data.get(s.dataId).values),A=E.makeZerosNestedTypedArray(a.shape,a.dtype);for(let j=0;j<p;++j)for(let D=0;D<x;++D){let F=D*v-b.top;for(let B=0;B<y;++B){let q=B*w-b.left;for(let $=0;$<g;++$){let L=Number.MIN_SAFE_INTEGER,M=0,X=0;for(let G=0;G<k;++G){let W=F+G*S;if(W>=0&&W<m)for(let O=0;O<C;++O){let U=q+O*_;if(U>=0&&U<f){let K=u[j][W][U][$]+h[G][O][$];K>L&&(L=K,M=G,X=O)}}}A[M][X][$]+=T[j][D][B][$]}}}return{dataId:d.write(E.toTypedArray(A,r.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},rRe={kernelName:df,backendName:"cpu",kernelFunc:({inputs:e,backend:t,attrs:n})=>{let{x:r,filter:a,dy:s}=e,{strides:o,pad:l,dilations:c}=n,d=t,u=E.toNestedArray(r.shape,d.data.get(r.dataId).values),h=E.toNestedArray(a.shape,d.data.get(a.dataId).values),{batchSize:p,inHeight:m,inWidth:f,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:w,filterHeight:k,filterWidth:C,dilationHeight:S,dilationWidth:_,outShape:I}=z.computeDilation2DInfo(r.shape,a.shape,o,l,"NHWC",c);E.assert(s.rank===I.length,()=>`Error in ${df}, dy must have the same rank as output ${I.length}, but got ${s.rank}`);let T=E.toNestedArray(I,d.data.get(s.dataId).values),A=E.makeZerosNestedTypedArray(r.shape,r.dtype);for(let j=0;j<p;++j)for(let D=0;D<x;++D){let F=D*v-b.top;for(let B=0;B<y;++B){let q=B*w-b.left;for(let $=0;$<g;++$){let L=Number.MIN_SAFE_INTEGER,M=F<0?0:F,X=q<0?0:q;for(let G=0;G<k;++G){let W=F+G*S;if(W>=0&&W<m)for(let O=0;O<C;++O){let U=q+O*_;if(U>=0&&U<f){let K=u[j][W][U][$]+h[G][O][$];K>L&&(L=K,M=W,X=U)}}}A[j][M][X][$]+=T[j][D][B][$]}}}return{dataId:d.write(E.toTypedArray(A,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function aRe(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{canvas:s,options:o}=r,{contextOptions:l,imageOptions:c}=o||{},d=(c==null?void 0:c.alpha)||1,u=(l==null?void 0:l.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${l.contextType} is not supported by the CPU backend.`);let h=s.getContext(u,(l==null?void 0:l.contextAttributes)||{});if(h==null)throw new Error(`Could not get the context with ${u} type.`);let[p,m]=a.shape.slice(0,2),f=a.shape.length===2?1:a.shape[2],g=n.data.get(a.dataId).values,x=a.dtype==="float32"?255:1,y=new Uint8ClampedArray(m*p*4);for(let v=0;v<p*m;++v){let w=[0,0,0,255*d];for(let C=0;C<f;C++){let S=g[v*f+C];if(a.dtype==="float32"){if(S<0||S>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${S}.`)}else if(a.dtype==="int32"&&(S<0||S>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${S}.`);f===1?(w[0]=S*x,w[1]=S*x,w[2]=S*x):w[C]=S*x}let k=v*4;y[k+0]=Math.round(w[0]),y[k+1]=Math.round(w[1]),y[k+2]=Math.round(w[2]),y[k+3]=Math.round(w[3])}s.width=m,s.height=p;let b=new ImageData(y,m,p);return h.putImageData(b,0,0),a}var sRe={kernelName:W1,backendName:"cpu",kernelFunc:aRe};function xv(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;vt(a,"sum");let l;a.dtype==="bool"?l=yu({inputs:{x:a},backend:n,attrs:{dtype:"int32"}}):l=ul({inputs:{x:a},backend:n});let c=l.shape.length,d=E.parseAxisParam(s,l.shape),u=z.getAxesPermutation(d,c),h=d,p=l;u!=null&&(p=Cs({inputs:{x:l},backend:n,attrs:{perm:u}}),h=z.getInnerMostAxes(h.length,c)),z.assertAxesAreInnerMostDims("sum",h,p.shape.length);let[m,f]=z.computeOutAndReduceShapes(p.shape,h),g=z.upcastType(p.dtype,"int32"),x=Q0(n,m,g),y=E.sizeFromShape(f),b=n.data.get(x.dataId).values,v=n.data.get(p.dataId).values;for(let w=0;w<b.length;++w){let k=w*y,C=0;for(let S=0;S<y;++S)C+=v[k+S];b[w]=C}if(o){let w=z.expandShapeToKeepDim(x.shape,d),k=x;x=_r({inputs:{x},backend:n,attrs:{shape:w}}),n.disposeIntermediateTensorInfo(k)}return n.disposeIntermediateTensorInfo(l),u!=null&&n.disposeIntermediateTensorInfo(p),x}var iRe={kernelName:Pp,backendName:"cpu",kernelFunc:xv};function oRe(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:o,summedDims:l,idDims:c}=z.decodeEinsumEquation(a,s.length);z.checkEinsumDimSizes(o.length,c,s);let{path:d,steps:u}=z.getEinsumComputePath(l,c),h=u.length,p=null,m=o.length,f=[];for(let g=0;g<h;++g){for(let x of u[g]){let{permutationIndices:y,expandDims:b}=z.getEinsumPermutation(m,c[x]),v;z.isIdentityPermutation(y)?v=s[x]:(v=Cs({inputs:{x:s[x]},backend:n,attrs:{perm:y}}),f.push(v));let w=v.shape.slice();for(let k=0;k<b.length;++k)w.splice(b[k],0,1);E.arraysEqual(v.shape,w)||(v=_r({inputs:{x:v},backend:n,attrs:{shape:w}}),f.push(v)),p===null?p=v:(p=nk({inputs:{a:v,b:p},backend:n}),f.push(p))}g<h-1&&(d[g]>=0&&(p=xv({inputs:{x:p},backend:n,attrs:{axis:d[g]-(o.length-m),keepDims:!1}}),f.push(p)),m--)}for(let g of f)g!==p&&n.disposeIntermediateTensorInfo(g);return p}var lRe={kernelName:U1,backendName:"cpu",kernelFunc:oRe};function cRe(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t;vt([r,a],"eluGrad");let s=new Float32Array(E.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,l=n.data.get(r.dataId).values;for(let c=0;c<o.length;++c){let d=o[c];d>=0?s[c]=l[c]:s[c]=l[c]*(d+1)}return n.makeTensorInfo(a.shape,"float32",s)}var uRe={kernelName:eg,backendName:"cpu",kernelFunc:cRe},dRe=z.ERF_P,hRe=z.ERF_A1,pRe=z.ERF_A2,mRe=z.ERF_A3,fRe=z.ERF_A4,gRe=z.ERF_A5,xRe=lr(qh,e=>{let t=Math.sign(e),n=Math.abs(e),r=1/(1+dRe*n);return t*(1-((((gRe*r+fRe)*r+mRe)*r+pRe)*r+hRe)*r*Math.exp(-n*n))}),yRe={kernelName:qh,backendName:"cpu",kernelFunc:xRe};function t1(e){let{inputs:t,backend:n,attrs:r}=e,{input:a}=t,{dim:s}=r,o=a.shape.length,l=a.shape.slice(),c=s;return s<0&&(E.assert(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+s+1),l.splice(c,0,1),_r({inputs:{x:a},backend:n,attrs:{shape:l}})}var bRe={kernelName:ng,backendName:"cpu",kernelFunc:t1},vRe=Kr((e,t)=>e/t),KA=ma(Hh,vRe),g_={kernelName:Hh,backendName:"cpu",kernelFunc:KA};function PG(e,t,n){let r=e.shape,a=r[0],s=r[1],o=n.data.get(e.dataId),l=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,d=[a,s],u=E.sizeFromShape(d),h=E.getTypedArrayFromDType("float32",u),p=E.getTypedArrayFromDType("float32",u);for(let x=0;x<a;x++){let y=fh({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,s]}}),b=fh({inputs:{x:c},backend:n,attrs:{begin:[x,0],size:[1,s]}}),v=zs({inputs:{real:y,imag:b},backend:n}),{real:w,imag:k}=wRe(v,t,n),C=z.mergeRealAndImagArrays(w,k);for(let S=0;S<s;S++){let _=z.getComplexWithIndex(C,S);h[x*s+S]=_.real,p[x*s+S]=_.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(v)}let m=n.makeTensorInfo(d,"float32",h),f=n.makeTensorInfo(d,"float32",p),g=zs({inputs:{real:m,imag:f},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}function wRe(e,t,n){let r=E.sizeFromShape(e.shape),a=n.data.get(e.dataId),s=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(NRe(r)){let l=x_(s,o,r,t,n),c=[e.shape[0],e.shape[1]];if(t){let d=n.makeTensorInfo(c,"float32",l.real),u=n.makeTensorInfo(c,"float32",l.imag),h=n.makeTensorInfo([],"float32",E.createScalarValue(r,"float32")),p=ul({inputs:{x:h},backend:n}),m=g_.kernelFunc({inputs:{a:d,b:h},backend:n}),f=g_.kernelFunc({inputs:{a:u,b:p},backend:n}),g=n.data.get(m.dataId).values,x=n.data.get(f.dataId).values;return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),{real:g,imag:x}}return l}else{let l=z.mergeRealAndImagArrays(s,o),c=kRe(l,r,t);return z.splitRealAndImagArrays(c)}}function NRe(e){return(e&e-1)===0}function x_(e,t,n,r,a){if(n===1)return{real:e,imag:t};let s=z.mergeRealAndImagArrays(e,t),o=n/2,l=z.complexWithEvenIndex(s),c=l.real,d=l.imag,u=[c.length],h=a.makeTensorInfo(u,"float32",c),p=a.makeTensorInfo(u,"float32",d),m=zs({inputs:{real:h,imag:p},backend:a}),f=z.complexWithOddIndex(s),g=f.real,x=f.imag,y=[g.length],b=a.makeTensorInfo(y,"float32",g),v=a.makeTensorInfo(y,"float32",x),w=zs({inputs:{real:b,imag:v},backend:a}),k=x_(c,d,o,r,a),C=k.real,S=k.imag,_=[C.length],I=a.makeTensorInfo(_,"float32",C),T=a.makeTensorInfo(_,"float32",S),A=zs({inputs:{real:I,imag:T},backend:a}),j=x_(g,x,o,r,a),D=j.real,F=j.imag,B=[D.length],q=a.makeTensorInfo(B,"float32",D),$=a.makeTensorInfo(B,"float32",F),L=zs({inputs:{real:q,imag:$},backend:a}),M=z.exponents(n,r),X=[M.real.length],G=a.makeTensorInfo(X,"float32",M.real),W=a.makeTensorInfo(X,"float32",M.imag),O=zs({inputs:{real:G,imag:W},backend:a}),U=nk({inputs:{a:O,b:L},backend:a}),K=Sf({inputs:{a:A,b:U},backend:a}),ce=HA({inputs:{a:A,b:U},backend:a}),ne=mh({inputs:{input:K},backend:a}),te=mh({inputs:{input:ce},backend:a}),Te=Cf({inputs:{input:K},backend:a}),Ae=Cf({inputs:{input:ce},backend:a}),Se=_f({inputs:[ne,te],backend:a,attrs:{axis:0}}),we=_f({inputs:[Te,Ae],backend:a,attrs:{axis:0}}),Fe=a.data.get(Se.dataId).values,Q=a.data.get(we.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(m),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(A),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo($),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(ce),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(Te),a.disposeIntermediateTensorInfo(te),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Se),a.disposeIntermediateTensorInfo(we),{real:Fe,imag:Q}}function kRe(e,t,n){let r=new Float32Array(t*2);for(let a=0;a<t;a++){let s=0,o=0;for(let l=0;l<t;l++){let c=z.exponent(a*l,t,n),d=z.getComplexWithIndex(e,l);s+=d.real*c.real-d.imag*c.imag,o+=d.real*c.imag+d.imag*c.real}n&&(s/=t,o/=t),z.assignToTypedArray(r,s,o,a)}return r}function SRe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=E.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],o=a/s,l=_r({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),c=PG(l,!1,n),d=_r({inputs:{x:c},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),d}var CRe={kernelName:V1,backendName:"cpu",kernelFunc:SRe};function YA(e){let{backend:t,attrs:n}=e,{shape:r,value:a,dtype:s}=n,o=s||E.inferDtype(a),l=E.getArrayFromDType(o,E.sizeFromShape(r));return jRe(l,a),t.makeTensorInfo(r,o,l)}var _Re={kernelName:Ib,backendName:"cpu",kernelFunc:YA};function jRe(e,t,n){e.fill(t)}var IRe={kernelName:rg,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,a=n,s=E.getTypedArrayFromDType(r.dtype,E.sizeFromShape(r.shape)),[o,l,c,d]=r.shape,u=a.data.get(r.dataId).values;for(let h=0;h<o;h++){let p=h*c*l*d;for(let m=0;m<l;m++){let f=m*(c*d);for(let g=0;g<c;g++){let x=g*d;for(let y=0;y<d;y++){let b=Math.round(c-g-1),v=p+f+x+y,w=u[v];if(b>=0&&b<c){let k=b*d,C=p+f+k+y;w=u[C]}s[v]=w}}}}return{dataId:a.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function TRe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=$G({inputs:{x:a,filter:s},backend:n,attrs:{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p}});if(o){let x=g;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){let y=_r({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});g=Sf({inputs:{a:g,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else g=Sf({inputs:{a:g,b:o},backend:n});n.disposeIntermediateTensorInfo(x)}if(m){let x=g;if(u==="NCHW"&&m==="prelu"&&l.shape.length===1&&l.shape[0]!==1){let y=_r({inputs:{x:l},backend:n,attrs:{shape:[l.shape[0],1,1]}});g=e1(n,g,m,y,f),n.disposeIntermediateTensorInfo(y)}else g=e1(n,g,m,l,f);n.disposeIntermediateTensorInfo(x)}return g}var ERe={kernelName:nh,backendName:"cpu",kernelFunc:TRe};function ARe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=FG({inputs:{x:a,filter:s},backend:n,attrs:{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p}});if(o){let x=g;g=Sf({inputs:{a:g,b:o},backend:n}),n.disposeIntermediateTensorInfo(x)}if(m){let x=g;g=e1(n,g,m,l,f),n.disposeIntermediateTensorInfo(x)}return g}var RRe={kernelName:rh,backendName:"cpu",kernelFunc:ARe};function DRe(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=E.sizeFromShape(r.shape),o=a.shape,l=o[o.length-1],[c,d,u,h]=z.prepareAndValidate(r,a);if(d===0)return n.makeTensorInfo(c,r.dtype,[]);let p=n.data.get(a.dataId).values,m=n.bufferSync(r),f=JH(p,m,r.dtype,d,l,u,h,r.shape,s);return n.makeTensorInfo(c,r.dtype,f.values)}var MRe={kernelName:sg,backendName:"cpu",kernelFunc:DRe};function $Re(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:o,batchDims:l}=r;vt([a,s],"gatherV2");let c=E.parseAxisParam(o,a.shape)[0],d=n.data.get(s.dataId).values,u=a.shape[c];for(let w=0;w<d.length;++w){let k=d[w];E.assert(k<=u-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${u-1}]`)}let h=l;l==null&&(h=0);let p=E.sizeFromShape(s.shape),m=z.segment_util.collectGatherOpShapeInfo(a,s,c,h),f=_r({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=_r({inputs:{x:s},backend:n,attrs:{shape:[m.batchSize,p/m.batchSize]}}),x=[m.batchSize,m.outerSize,p/m.batchSize,m.sliceSize],y=n.bufferSync(g),b=n.bufferSync(f),v=eG(b,y,x);return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,v.dtype,v.values)}var FRe={kernelName:ag,backendName:"cpu",kernelFunc:$Re};function PRe(e){let{inputs:t,backend:n}=e,{input:r}=t,a=E.sizeFromShape(r.shape),s=r.shape[r.shape.length-1],o=a/s,l=_r({inputs:{x:r},backend:n,attrs:{shape:[o,s]}}),c=PG(l,!0,n),d=_r({inputs:{x:c},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),d}var ORe={kernelName:H1,backendName:"cpu",kernelFunc:PRe},LRe=lr(tp,e=>Number.isFinite(e)?1:0,"bool"),zRe={kernelName:tp,backendName:"cpu",kernelFunc:LRe},BRe=lr(np,e=>Math.abs(e)===1/0?1:0,"bool"),WRe={kernelName:np,backendName:"cpu",kernelFunc:BRe},URe=lr(rp,e=>Number.isNaN(e)?1:0,"bool"),VRe={kernelName:rp,backendName:"cpu",kernelFunc:URe};function HRe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,o=sG(r,a,s);return t.makeTensorInfo([o.length],"float32",o)}var GRe={kernelName:cg,backendName:"cpu",kernelFunc:HRe},qRe=lr(ip,e=>Math.log1p(e)),KRe={kernelName:ip,backendName:"cpu",kernelFunc:qRe},YRe=Kr((e,t)=>e&&t),XRe=ma(ug,YRe,null,"bool"),ZRe={kernelName:ug,backendName:"cpu",kernelFunc:XRe},QRe=lr(dg,e=>e?0:1,"bool"),JRe={kernelName:dg,backendName:"cpu",kernelFunc:QRe},eDe=Kr((e,t)=>e||t),tDe=ma(hg,eDe,null,"bool"),nDe={kernelName:hg,backendName:"cpu",kernelFunc:tDe};function rDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:o,alpha:l,beta:c}=r;vt(a,"LRN");let d=a.shape[3],u=d-1,h=n.data.get(a.dataId).values,p=E.sizeFromShape(a.shape),m=new Float32Array(p);function f(g){let x=g%d,y=g-x+Math.max(0,x-s),b=g-x+Math.min(x+s,u),v=0;for(;y<=b;y++){let w=h[y];v+=w*w}return v}for(let g=0;g<p;g++){let x=f(g),y=h[g]*Math.pow(o+l*x,-c);m[g]=y}return n.makeTensorInfo(a.shape,a.dtype,m)}var aDe={kernelName:op,backendName:"cpu",kernelFunc:rDe};function sDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:o}=t,{depthRadius:l,bias:c,alpha:d,beta:u}=r;vt(o,"LRNGrad");let h=E.sizeFromShape(o.shape),p=o.shape[3],m=n.data.get(o.dataId).values,f=n.data.get(a.dataId).values,g=n.data.get(s.dataId).values,x=new Float32Array(h),y=h;for(let b=0;b<y;b++){let v=b%p,w=b-v+Math.max(0,v-l),k=b-v+Math.min(p,v+l+1),C=0;for(let S=w;S<k;S++)C+=Math.pow(f[S],2);C=d*C+c;for(let S=w;S<k;S++){let _=-2*d*u*f[S]*g[b]/C;b===S&&(_+=Math.pow(C,-u)),_*=m[b],x[S]+=_}}return n.makeTensorInfo(o.shape,a.dtype,x)}var iDe={kernelName:pg,backendName:"cpu",kernelFunc:sDe};function OG(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:o}=r,l=n,c=a.shape,d=c.length,u=E.parseAxisParam(s,c),h=u,p=z.getAxesPermutation(h,d),m=l.data.get(a.dataId).values;if(p!=null){let w=new Array(d);for(let k=0;k<w.length;k++)w[k]=c[p[k]];m=LA(m,c,a.dtype,p,w),h=z.getInnerMostAxes(h.length,d),c=w}vt(a,"max"),z.assertAxesAreInnerMostDims("max",h,d);let[f,g]=z.computeOutAndReduceShapes(c,h),x=E.sizeFromShape(g),y=oG(m,x,f,a.dtype),b=l.write(y,f,a.dtype),v=f;return o&&(v=z.expandShapeToKeepDim(f,u)),{dataId:b,shape:v,dtype:a.dtype}}var oDe={kernelName:lp,backendName:"cpu",kernelFunc:OG};function lDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;vt(a,"maxPool");let{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r,d=1;E.assert(z.eitherStridesOrDilationsAreOne(o,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);let u=z.computePool2DInfo(a.shape,s,o,d,l,c),h;if(u.filterWidth===1&&u.filterHeight===1&&E.arraysEqual(u.inShape,u.outShape))h=ul({inputs:{x:a},backend:n});else{let p=n.data.get(a.dataId).values,m=E.computeStrides(a.shape),f=qA(p,a.shape,a.dtype,m,u,"max");h=n.makeTensorInfo(u.outShape,a.dtype,f.values)}return h}var cDe={kernelName:up,backendName:"cpu",kernelFunc:lDe};function uDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=r;vt(a,"maxPool3d");let u=z.computePool3DInfo(a.shape,s,o,1,l,c,d),h=n.data.get(a.dataId).values,p=MG(h,a.shape,a.dtype,E.computeStrides(a.shape),u,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}var dDe={kernelName:mg,backendName:"cpu",kernelFunc:uDe};function hDe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=r;vt([a,s],"maxPool3DGrad");let u=z.computePool3DInfo(s.shape,o,l,1,c,d),h=n.bufferSync(s),p=eAe(h,u),m=u.strideDepth,f=u.strideHeight,g=u.strideWidth,x=u.dilationDepth,y=u.dilationHeight,b=u.dilationWidth,v=u.effectiveFilterDepth,w=u.effectiveFilterHeight,k=u.effectiveFilterWidth,C=v-1-u.padInfo.front,S=k-1-u.padInfo.left,_=w-1-u.padInfo.top,I=pn(s.shape,"float32"),T=n.bufferSync(a);for(let A=0;A<u.batchSize;++A)for(let j=0;j<u.inChannels;++j)for(let D=0;D<u.inDepth;++D)for(let F=0;F<u.inHeight;++F)for(let B=0;B<u.inWidth;++B){let q=D-C,$=F-_,L=B-S,M=0;for(let X=0;X<v;X+=x){let G=(q+X)/m;if(!(G<0||G>=u.outDepth||Math.floor(G)!==G))for(let W=0;W<w;W+=y){let O=($+W)/f;if(!(O<0||O>=u.outHeight||Math.floor(O)!==O))for(let U=0;U<k;U+=b){let K=(L+U)/g;if(K<0||K>=u.outWidth||Math.floor(K)!==K)continue;let ce=v*w*k-1-p.get(A,G,O,K,j),ne=X*w*k+W*k+U,te=ce===ne?1:0;if(te===0)continue;let Te=T.get(A,G,O,K,j);M+=Te*te}}}I.set(M,A,D,F,B,j)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}var pDe={kernelName:Eb,backendName:"cpu",kernelFunc:hDe};function mDe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:o}=t,l=s;vt([s,o],"maxPoolGrad");let{filterSize:c,strides:d,pad:u,dimRoundingMode:h}=r,p=z.computePool2DInfo(l.shape,c,d,1,u,h),m=n.data.get(l.dataId).values,f=pn(p.outShape,l.dtype,DG(m,l.shape,l.dtype,p).values),g=p.strideHeight,x=p.strideWidth,y=p.dilationHeight,b=p.dilationWidth,v=p.effectiveFilterHeight,w=p.effectiveFilterWidth,k=w-1-p.padInfo.left,C=v-1-p.padInfo.top,S=pn(l.shape,"float32"),_=n.data.get(a.dataId).values,I=pn(a.shape,"float32",_);for(let T=0;T<p.batchSize;++T)for(let A=0;A<p.inChannels;++A)for(let j=0;j<p.inHeight;++j)for(let D=0;D<p.inWidth;++D){let F=j-C,B=D-k,q=0;for(let $=0;$<v;$+=y){let L=(F+$)/g;if(!(L<0||L>=p.outHeight||Math.floor(L)!==L))for(let M=0;M<w;M+=b){let X=(B+M)/x;if(X<0||X>=p.outWidth||Math.floor(X)!==X)continue;let G=v*w-1-f.get(T,L,X,A),W=$*w+M,O=G===W?1:0;if(O===0)continue;let U=I.get(T,L,X,A);q+=U*O}}S.set(q,T,j,D,A)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}var fDe={kernelName:Tb,backendName:"cpu",kernelFunc:mDe};function gDe(e,t,n,r,a){let s=E.computeStrides(t),o=qA(e,t,n,s,a,"max"),l=DG(e,t,n,a,!0,r);return[o.values,l.values]}var xDe={kernelName:Ab,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:o,includeBatchInIndex:l}=t,c=n;vt(r,"MaxPoolWithArgmax");let d=c.data.get(r.dataId).values,u=z.computePool2DInfo(r.shape,a,s,[1,1],o),[h,p]=gDe(d,r.shape,r.dtype,l,u),m=c.write(h,u.outShape,r.dtype),f=c.write(p,u.outShape,r.dtype);return[{dataId:m,shape:u.outShape,dtype:r.dtype},{dataId:f,shape:u.outShape,dtype:"int32"}]}};function yDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r,l=E.parseAxisParam(s,a.shape),c=z.computeOutAndReduceShapes(a.shape,l)[1],d=E.sizeFromShape(c),u=[],h=n.makeTensorInfo([],"float32",new Float32Array([d]));u.push(h);let p=yu({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});u.push(p);let m=KA({inputs:{a:p,b:h},backend:n});u.push(m);let f=xv({inputs:{x:m},backend:n,attrs:{axis:s,keepDims:o}});return u.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var bDe={kernelName:dp,backendName:"cpu",kernelFunc:yDe};function vDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;vt(a,"min");let l=E.parseAxisParam(s,a.shape),c=l,d=z.getAxesPermutation(c,a.shape.length),u=a;d!=null&&(u=Cs({inputs:{x:a},backend:n,attrs:{perm:d}}),c=z.getInnerMostAxes(c.length,a.shape.length)),z.assertAxesAreInnerMostDims("min",c,u.shape.length);let[h,p]=z.computeOutAndReduceShapes(u.shape,c),m=E.sizeFromShape(p),f=E.makeZerosTypedArray(E.sizeFromShape(h),u.dtype),g=n.data.get(u.dataId).values;for(let y=0;y<f.length;++y){let b=y*m,v=g[b];for(let w=0;w<m;++w){let k=g[b+w];(Number.isNaN(k)||k<v)&&(v=k)}f[y]=v}d!=null&&n.disposeIntermediateTensorInfo(u);let x=n.makeTensorInfo(h,u.dtype,f);if(o){let y=z.expandShapeToKeepDim(h,l),b=_r({inputs:{x},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(x),b}return x}var wDe={kernelName:hp,backendName:"cpu",kernelFunc:vDe};function NDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,mode:o}=r;vt(a,"mirrorPad");let l=s.map((b,v)=>b[0]+a.shape[v]+b[1]),c=s.map(b=>b[0]),d=s.map((b,v)=>b[0]+a.shape[v]),u=o==="reflect"?0:1,h=n.data.get(a.dataId).values,p=a.shape.length,m=E.computeStrides(a.shape),f=E.sizeFromShape(l),g=l.length,x=E.computeStrides(l),y=E.getTypedArrayFromDType(a.dtype,f);for(let b=0;b<f;b++){let v=E.indexToLoc(b,g,x);for(let k=0;k<g;k++)v[k]<c[k]?v[k]=c[k]*2-v[k]-u:v[k]>=d[k]&&(v[k]=(d[k]-1)*2-v[k]+u);v=v.map((k,C)=>k-c[C]);let w=E.locToIndex(v,p,m);y[b]=h[w]}return{dataId:n.write(y,l,a.dtype),shape:l,dtype:a.dtype}}var kDe={kernelName:mp,backendName:"cpu",kernelFunc:NDe},SDe=Kr((e,t)=>{let n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}),CDe=ma(fp,SDe),_De={kernelName:fp,backendName:"cpu",kernelFunc:CDe},jDe=Cu(M1());function LG(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,o=a.shape.length,l=s;if(l===-1&&(l=o-1),l!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${l}`);let c=E.parseAxisParam([l],a.shape),d=OG({inputs:{x:a},backend:n,attrs:{reductionIndices:c,keepDims:!1}}),u=z.expandShapeToKeepDim(d.shape,c),h=_r({inputs:{x:d},backend:n,attrs:{shape:u}}),p=HA({inputs:{a,b:h},backend:n}),m=YH({inputs:{x:p},backend:n}),f=xv({inputs:{x:m},backend:n,attrs:{axis:c,keepDims:!1}}),g=_r({inputs:{x:f},backend:n,attrs:{shape:u}}),x=KA({inputs:{a:m,b:g},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}var IDe={kernelName:Op,backendName:"cpu",kernelFunc:LG};function TDe(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:o,normalized:l}=r;vt(a,"multinomial");let c=l?a:LG({inputs:{logits:a},backend:n,attrs:{dim:-1}}),d=c.shape[0],u=c.shape[1],h=n.data.get(c.dataId).values,p=[d,s],m=E.makeZerosTypedArray(E.sizeFromShape(p),"int32");for(let f=0;f<d;++f){let g=f*u,x=new Float32Array(u-1);x[0]=h[g];for(let v=1;v<x.length;++v)x[v]=x[v-1]+h[g+v];let y=jDe.alea(o.toString()),b=f*s;for(let v=0;v<s;++v){let w=y();m[b+v]=x.length;for(let k=0;k<x.length;k++)if(w<x[k]){m[b+v]=k;break}}}return l||n.disposeIntermediateTensorInfo(c),n.makeTensorInfo(p,"int32",m)}var EDe={kernelName:fg,backendName:"cpu",kernelFunc:TDe},ADe=gl.nonMaxSuppressionV3Impl;function RDe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=r;vt(a,"NonMaxSuppression");let d=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,{selectedIndices:h}=ADe(d,u,o,l,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}var DDe={kernelName:yg,backendName:"cpu",kernelFunc:RDe},MDe=gl.nonMaxSuppressionV4Impl;function $De(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:d}=r;vt(a,"NonMaxSuppressionPadded");let u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,{selectedIndices:p,validOutputs:m}=MDe(u,h,o,l,c,d);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}var FDe={kernelName:bg,backendName:"cpu",kernelFunc:$De},PDe=gl.nonMaxSuppressionV5Impl;function ODe(e){let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:d}=r;vt(a,"NonMaxSuppressionWithScore");let u=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,p=o,m=l,f=c,g=d,{selectedIndices:x,selectedScores:y}=PDe(u,h,p,m,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var LDe={kernelName:vg,backendName:"cpu",kernelFunc:ODe};function zDe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:o,onValue:l,offValue:c}=r;vt(a,"oneHot");let d=E.sizeFromShape(a.shape),u=new Float32Array(d*o);u.fill(c);let h=n.data.get(a.dataId).values;for(let p=0;p<d;++p)h[p]>=0&&h[p]<o&&(u[p*o+h[p]]=l);return n.makeTensorInfo([...a.shape,o],s,u)}var BDe={kernelName:xp,backendName:"cpu",kernelFunc:zDe};function n1(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let a=mh({inputs:{input:r},backend:n}),s=n1({inputs:{x:a},backend:n}),o=Cf({inputs:{input:r},backend:n}),l=n1({inputs:{x:o},backend:n}),c=zs({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}else return YA({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var WDe={kernelName:Lg,backendName:"cpu",kernelFunc:n1};function zG(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let a=mh({inputs:{input:r},backend:n}),s=zG({inputs:{x:a},backend:n}),o=Cf({inputs:{input:r},backend:n}),l=n1({inputs:{x:o},backend:n}),c=zs({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}else return YA({backend:n,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var UDe={kernelName:wg,backendName:"cpu",kernelFunc:zG};function BG(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return t1({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,o=t[0].dtype;t.forEach(u=>{E.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),E.assert(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],c=t.map(u=>{let h=t1({inputs:{input:u},backend:n,attrs:{dim:a}});return l.push(h),h}),d=_f({inputs:c,backend:n,attrs:{axis:a}});return l.forEach(u=>n.disposeIntermediateTensorInfo(u)),d}var VDe={kernelName:Ng,backendName:"cpu",kernelFunc:BG};function HDe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:o}=r;vt(a,"pad");let l=s.map((y,b)=>y[0]+a.shape[b]+y[1]),c=s.map(y=>y[0]),d=n.data.get(a.dataId).values,u=E.sizeFromShape(a.shape),h=a.shape.length,p=E.computeStrides(a.shape),m=E.sizeFromShape(l),f=l.length,g=E.computeStrides(l),x=E.getTypedArrayFromDType(a.dtype,m);o!==0&&x.fill(o);for(let y=0;y<u;y++){let b=E.indexToLoc(y,h,p).map((w,k)=>w+c[k]),v=E.locToIndex(b,f,g);x[v]=d[y]}return{dataId:n.write(x,l,a.dtype),shape:l,dtype:a.dtype}}var WG={kernelName:yp,backendName:"cpu",kernelFunc:HDe},GDe=Kr((e,t)=>Math.pow(e,t)),qDe=ma(bp,GDe),KDe={kernelName:bp,backendName:"cpu",kernelFunc:qDe};function YDe(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:o}=t,{outputRaggedRank:l}=r,c=a.map(y=>n.data.get(y.dataId).values),d=a.map(y=>y.shape),u=n.data.get(s.dataId).values,h=n.data.get(o.dataId).values,[p,m,f]=pG(c,d,u,s.shape,s.dtype,h,o.shape),g=p.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,s.dtype,m);return g.concat([x])}var XDe={kernelName:q1,backendName:"cpu",kernelFunc:YDe};function ZDe(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,[d,u]=mG(o,r.shape,r.dtype,l,a.shape,c,s.shape),h=n.makeTensorInfo([d.length],"int32",d),p=n.makeTensorInfo([u.length],r.dtype,u);return[h,p]}var QDe={kernelName:K1,backendName:"cpu",kernelFunc:ZDe};function JDe(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:o,rowPartitionTensors:l}=t,{rowPartitionTypes:c}=r,d=n.data.get(a.dataId).values,u=n.data.get(s.dataId).values,h=n.data.get(o.dataId).values,p=l.map(x=>n.data.get(x.dataId).values),m=l.map(x=>x.shape),[f,g]=fG(d,a.shape,u,s.shape,s.dtype,h,o.shape,p,m,c);return n.makeTensorInfo(f,s.dtype,g)}var eMe={kernelName:Y1,backendName:"cpu",kernelFunc:JDe};function tMe(e){let{backend:t,attrs:n}=e,{start:r,stop:a,dtype:s,step:o}=n,l=zA(r,a,o,s);return t.makeTensorInfo([l.length],s,l)}var nMe={kernelName:Rb,backendName:"cpu",kernelFunc:tMe},rMe=lr(Np,e=>1/e),aMe={kernelName:Np,backendName:"cpu",kernelFunc:rMe};function sMe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:l}=r;vt(a,"resizeBilinear");let c=E.computeStrides(a.shape),[d,u]=l,[h,p,m,f]=a.shape,g=n.data.get(a.dataId).values,x=new Float32Array(E.sizeFromShape([h,d,u,f])),y=[s&&d>1?p-1:p,s&&u>1?m-1:m],b=[s&&d>1?d-1:d,s&&u>1?u-1:u],v=0,w=y[0]/b[0],k=y[1]/b[1];for(let C=0;C<h;C++)for(let S=0;S<d;S++){let _;o?_=w*(S+.5)-.5:_=w*S;let I=Math.max(0,Math.floor(_)),T=_-I,A=Math.min(p-1,Math.ceil(_)),j=C*c[0]+I*c[1],D=C*c[0]+A*c[1];for(let F=0;F<u;F++){let B;o?B=k*(F+.5)-.5:B=k*F;let q=Math.max(0,Math.floor(B)),$=B-q,L=Math.min(m-1,Math.ceil(B)),M=j+q*c[2],X=D+q*c[2],G=j+L*c[2],W=D+L*c[2];for(let O=0;O<f;O++){let U=g[M+O],K=g[X+O],ce=g[G+O],ne=g[W+O],te=U+(ce-U)*$,Te=K+(ne-K)*$,Ae=te+(Te-te)*T;x[v++]=Ae}}}return n.makeTensorInfo([h,d,u,f],"float32",x)}var iMe={kernelName:Cp,backendName:"cpu",kernelFunc:sMe};function oMe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r;vt([s,a],"resizeBilinearGrad");let l=E.computeStrides(a.shape),[c,d,u,h]=a.shape,[,p,m]=s.shape,f=new Float32Array(c*d*u*h),g=[o&&p>1?d-1:d,o&&m>1?u-1:u],x=[o&&p>1?p-1:p,o&&m>1?m-1:m],y=g[0]/x[0],b=g[1]/x[1],v=n.data.get(s.dataId).values,w=0;for(let k=0;k<c;k++){let C=k*l[0];for(let S=0;S<p;S++){let _=S*y,I=Math.floor(_),T=Math.min(Math.ceil(_),d-1),A=C+I*l[1],j=C+T*l[1],D=_-I,F=1-D;for(let B=0;B<m;B++){let q=B*b,$=Math.floor(q),L=Math.min(Math.ceil(q),u-1),M=q-$,X=1-M,G=A+$*l[2],W=A+L*l[2],O=j+$*l[2],U=j+L*l[2],K=F*X,ce=F*M,ne=D*X,te=D*M;for(let Te=0;Te<h;Te++){let Ae=v[w++];f[G+Te]+=Ae*K,f[W+Te]+=Ae*ce,f[O+Te]+=Ae*ne,f[U+Te]+=Ae*te}}}}return n.makeTensorInfo([c,u,d,h],"float32",f)}var lMe={kernelName:Cg,backendName:"cpu",kernelFunc:oMe};function cMe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:l}=r;vt(a,"resizeNearestNeighbor");let c=E.computeStrides(a.shape),[d,u]=l,[h,p,m,f]=a.shape,g=n.data.get(a.dataId).values,x=new Float32Array(h*d*u*f),y=[s&&d>1?p-1:p,s&&u>1?m-1:m],b=[s&&d>1?d-1:d,s&&u>1?u-1:u],v=y[0]/b[0],w=y[1]/b[1],k=0;for(let C=0;C<h;C++){let S=C*c[0];for(let _=0;_<d;_++){let I=o?v*(_+.5):v*_,T=Math.min(p-1,s?Math.round(I):Math.floor(I));o&&(T=Math.max(0,T));let A=S+T*c[1];for(let j=0;j<u;j++){let D=o?w*(j+.5):w*j,F=Math.min(m-1,s?Math.round(D):Math.floor(D));o&&(F=Math.max(0,F));let B=A+F*c[2];for(let q=0;q<f;q++){let $=g[B+q];x[k++]=$}}}}return n.makeTensorInfo([h,d,u,f],a.dtype,x)}var uMe={kernelName:Sp,backendName:"cpu",kernelFunc:cMe};function dMe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r;vt([s,a],"resizeNearestNeighborGrad");let l=E.computeStrides(a.shape),c=E.computeStrides(s.shape),[d,u,h,p]=a.shape,[,m,f]=s.shape,g=new Float32Array(d*u*h*p),x=n.data.get(s.dataId).values,y=[o&&m>1?u-1:u,o&&f>1?h-1:h],b=[o&&m>1?m-1:m,o&&f>1?f-1:f],v=y[0]/b[0],w=y[1]/b[1],k=1/v,C=1/w,S=Math.ceil(k)*2+2,_=Math.ceil(C)*2+2;for(let I=0;I<d;I++){let T=I*l[0];for(let A=0;A<u;A++){let j=T+A*l[1],D=Math.floor(A*k),F=Math.floor(D-S/2);for(let B=0;B<h;B++){let q=j+B*l[2],$=Math.floor(B*C),L=Math.floor($-_/2);for(let M=0;M<p;M++){let X=0;for(let G=0;G<S;G++){let W=G+F;if(W<0||W>=m)continue;let O=T+W*c[1],U=W*v,K=Math.min(u-1,o?Math.round(U):Math.floor(U));if(A===K)for(let ce=0;ce<_;ce++){let ne=ce+L;if(ne<0||ne>=f)continue;let te=O+ne*c[2],Te=ne*w,Ae=Math.min(h-1,o?Math.round(Te):Math.floor(Te));B===Ae&&(X+=x[te+M])}}g[q+M]=X}}}}return n.makeTensorInfo(a.shape,a.dtype,g)}var hMe={kernelName:Sg,backendName:"cpu",kernelFunc:dMe};function pMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r;vt(a,"reverse");let o=a.shape.length,l=E.parseAxisParam(s,a.shape);if(o===0)return ul({inputs:{x:a},backend:n});let c=new Qr(a.shape,a.dtype),d=n.bufferSync(a);for(let u=0;u<c.size;u++){let h=c.indexToLoc(u),p=h.slice();l.forEach(m=>p[m]=a.shape[m]-1-p[m]),c.set(d.get(...p),...h)}return n.makeTensorInfo(c.shape,c.dtype,c.values)}var mMe={kernelName:jp,backendName:"cpu",kernelFunc:pMe},fMe={kernelName:zg,backendName:"cpu",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:o}=t,l=n,c=E.getTypedArrayFromDType(r.dtype,E.sizeFromShape(r.shape)),[d,u,h,p]=r.shape,[m,f]=z.getImageCenter(o,u,h),g=255,x=Math.sin(a),y=Math.cos(a),b=l.data.get(r.dataId).values;for(let v=0;v<d;v++){let w=v*h*u*p;for(let k=0;k<u;k++){let C=k*(h*p);for(let S=0;S<h;S++){let _=S*p;for(let I=0;I<p;I++){let T=[d,k,S,I],A=T[2],j=T[1],D=(A-m)*y-(j-f)*x,F=(A-m)*x+(j-f)*y;D=Math.round(D+m),F=Math.round(F+f);let B=s;if(typeof s!="number"&&(I===3?B=g:B=s[I]),D>=0&&D<h&&F>=0&&F<u){let $=F*(h*p),L=D*p,M=w+$+L+I;B=b[M]}let q=w+C+_+I;c[q]=B}}}}return{dataId:l.write(c,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},gMe=lr(Ip,e=>{let t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1}),xMe={kernelName:Ip,backendName:"cpu",kernelFunc:gMe};function yMe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=z.calculateShapes(s,a,o),p=!0,m=n.bufferSync(a),f=n.bufferSync(s),g=bd(m,f,o,h,d,c,l,u,0,p);return n.makeTensorInfo(o,g.dtype,g.values)}var bMe={kernelName:_g,backendName:"cpu",kernelFunc:yMe};function vMe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<t?n=a+1:r=a;return r}function wMe(e,t){let n=0,r=e.length,a=0;for(;n<r;)a=Math.floor((n+r)/2),e[a]<=t?n=a+1:r=a;return r}function NMe(e,t,n,r,a,s){let o=E.getArrayFromDType("int32",n*a);for(let l=0;l<n;++l){let c=e.slice(l*r,(l+1)*r),d=l*a;for(let u=0;u<a;++u)o[d+u]=s==="left"?vMe(c,t[u+d]):wMe(c,t[u+d])}return o}function kMe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:o}=r,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,d=NMe(l,c,a.shape[0],a.shape[1],s.shape[1],o);return n.makeTensorInfo(s.shape,"int32",d)}var SMe={kernelName:Ig,backendName:"cpu",kernelFunc:kMe};function CMe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t;vt([r,a,s],"select");let o=r.shape.length,l=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,u=mi(a.dtype,s.dtype),h=E.makeZerosTypedArray(E.sizeFromShape(a.shape),u),p=0,m=o===0||o>1||a.shape.length===1?1:E.sizeFromShape(a.shape.slice(1));for(let f=0;f<l.length;f++)for(let g=0;g<m;g++)l[f]===1?h[p++]=c[f]:h[p++]=d[f];return n.makeTensorInfo(a.shape,u,h)}var _Me={kernelName:Tg,backendName:"cpu",kernelFunc:CMe},jMe=z.SELU_SCALEALPHA,IMe=z.SELU_SCALE,TMe=lr(Ep,e=>e>=0?IMe*e:jMe*(Math.exp(e)-1)),EMe={kernelName:Ep,backendName:"cpu",kernelFunc:TMe},AMe=lr(Dp,e=>e<0?-1:e>0?1:0),RMe={kernelName:Dp,backendName:"cpu",kernelFunc:AMe},DMe=lr(Ap,e=>Math.sin(e)),MMe={kernelName:Ap,backendName:"cpu",kernelFunc:DMe},$Me=lr(Rp,e=>Math.sinh(e)),FMe={kernelName:Rp,backendName:"cpu",kernelFunc:$Me},PMe=11920928955078125e-23,OF=Math.log(PMe)+2,OMe=lr($p,e=>{let t=e>-OF,n=e<OF,r=Math.exp(e),a;return n?a=r:t?a=e:a=Math.log(1+r),a}),LMe={kernelName:$p,backendName:"cpu",kernelFunc:OMe};function zMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:o}=r;vt([a],"spaceToBatchND");let l=E.sizeFromShape(s),c=[[0,0]];c.push(...o);for(let x=1+s.length;x<a.shape.length;++x)c.push([0,0]);let d=WG.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),u=z.getReshaped(d.shape,s,l,!1),h=z.getPermuted(u.length,s.length,!1),p=z.getReshapedPermuted(d.shape,s,l,!1),m=_r({inputs:{x:d},backend:n,attrs:{shape:u}}),f=Cs({inputs:{x:m},backend:n,attrs:{perm:h}}),g=_r({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),g}var BMe={kernelName:Ag,backendName:"cpu",kernelFunc:zMe};function WMe(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${a.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);let l=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,d=n.data.get(s.dataId).values,u=n.data.get(o.dataId).values[0],[h,p,m,f,g]=yG(l,r.shape,r.dtype,c,a.dtype,d,u);return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([p[0]],a.dtype,m),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}var UMe={kernelName:Db,backendName:"cpu",kernelFunc:WMe};function VMe(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let o=Array.from(n.data.get(a.dataId).values),l=n.data.get(r.dataId).values,c=Array.from(n.data.get(s.dataId).values),[d,u,h]=bG(l,r.shape,r.dtype,o,c);return[n.makeTensorInfo(u,r.dtype,d),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}var HMe={kernelName:Dg,backendName:"cpu",kernelFunc:VMe};function GMe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,[d,u]=BA(o,r.shape,r.dtype,l,c,!0);return n.makeTensorInfo(u,r.dtype,d)}var qMe={kernelName:Mb,backendName:"cpu",kernelFunc:GMe};function KMe(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(a.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let o=n.data.get(r.dataId).values,l=n.data.get(a.dataId).values,c=n.data.get(s.dataId).values,[d,u]=BA(o,r.shape,r.dtype,l,c);return n.makeTensorInfo(u,r.dtype,d)}var YMe={kernelName:$b,backendName:"cpu",kernelFunc:KMe};function XMe(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:o}=t,{outputShape:l}=r,{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=z.calculateShapes(s,a,l),m=!1,f=n.bufferSync(a),g;switch(s.dtype){case"bool":{let x=n.bufferSync(s),y=!!n.data.get(o.dataId).values[0];g=bd(f,x,l,p,u,d,c,h,y,m);break}case"float32":{let x=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=bd(f,x,l,p,u,d,c,h,y,m);break}case"int32":{let x=n.bufferSync(s),y=n.data.get(o.dataId).values[0];g=bd(f,x,l,p,u,d,c,h,y,m);break}case"string":{let x=n.bufferSync(s),y=E.decodeString(n.data.get(o.dataId).values[0]);g=bd(f,x,l,p,u,d,c,h,y,m);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return n.makeTensorInfo(l,g.dtype,g.values)}var ZMe={kernelName:Mg,backendName:"cpu",kernelFunc:XMe};function QMe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:o}=r,l=E.parseAxisParam(o,a.shape)[0],c=z.prepareSplitSize(a,s,l),d=new Array(a.shape.length).fill(0),u=a.shape.slice();return c.map(h=>{let p=[...u];p[l]=h;let m=fh({inputs:{x:a},backend:n,attrs:{begin:d,size:p}});return d[l]+=h,m})}var JMe={kernelName:Rg,backendName:"cpu",kernelFunc:QMe},e$e={kernelName:Fb,backendName:"cpu",kernelFunc:({inputs:e,backend:t})=>{let{x:n}=e,r=t;vt(n,"square");let a=r.data.get(n.dataId).values,s=new Float32Array(a.length);for(let o=0;o<a.length;++o){let l=a[o];s[o]=l*l}return{dataId:r.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},t$e=lr(Tu,(e,t)=>{let n=t;return isNaN(e)?NaN:e>0?1:n.alpha}),n$e={kernelName:Tu,backendName:"cpu",kernelFunc:t$e};function r$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:o,strides:l,beginMask:c,endMask:d,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:p}=r;vt(a,"stridedSlice");let{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=da.sliceInfo(a.shape,s,o,l,c,d,u,h,p),k;if(g)k=_r({inputs:{x:a},backend:n,attrs:{shape:f}});else if(x||y){E.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let C=da.computeOutShape(b,v,w),S=fh({inputs:{x:a},backend:n,attrs:{begin:b,size:C}});k=_r({inputs:{x:S},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(S)}else{let C=n.bufferSync(a),S=NG(m,C,w,b);k=n.makeTensorInfo(f,S.dtype,S.values)}return k}var a$e={kernelName:$g,backendName:"cpu",kernelFunc:r$e};function s$e(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:d}=r,{data:u,dataSplits:h}=t,p=n.data.get(u.dataId).values,m=n.data.get(h.dataId).values,[f,g]=WA(p,m,a,s,o,l,c,d);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}var i$e={kernelName:Ob,backendName:"cpu",kernelFunc:s$e};function o$e(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);let l=n.data.get(s.dataId).values,c=n.data.get(o.dataId).values[0],[d,u,h]=UA(l,c,a),p=u.length;return[n.makeTensorInfo([p,2],"int32",d),n.makeTensorInfo([p],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}var l$e={kernelName:Lb,backendName:"cpu",kernelFunc:o$e};function c$e(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let o=n.data.get(s.dataId).values,l=VA(o,a);return n.makeTensorInfo(s.shape,"int32",l)}var u$e={kernelName:zb,backendName:"cpu",kernelFunc:c$e},d$e=lr(Bp,e=>Math.tan(e)),h$e={kernelName:Bp,backendName:"cpu",kernelFunc:d$e},p$e=lr(Wp,e=>Math.tanh(e)),m$e={kernelName:Wp,backendName:"cpu",kernelFunc:p$e};function f$e(e){let{inputs:t,backend:n}=e,{tensor:r,indices:a,updates:s}=t,{sliceRank:o,numUpdates:l,sliceSize:c,strides:d,outputSize:u}=z.calculateShapes(s,a,r.shape),h=!1,p=n.bufferSync(a),m=n.bufferSync(s),f=n.bufferSync(r),g=bd(p,m,r.shape,u,c,l,o,d,f,h);return n.makeTensorInfo(r.shape,g.dtype,g.values)}var g$e={kernelName:jg,backendName:"cpu",kernelFunc:f$e};function x$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;vt(a,"tile");let o=SG(n.bufferSync(a),s);return n.makeTensorInfo(o.shape,o.dtype,o.values)}var y$e={kernelName:Iu,backendName:"cpu",kernelFunc:x$e};function b$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:o}=r;vt(a,"topk");let l=n.data.get(a.dataId).values,[c,d]=_G(l,a.shape,a.dtype,s,o);return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(d.shape,d.dtype,d.values)]}var v$e={kernelName:Fg,backendName:"cpu",kernelFunc:b$e};function w$e(e){let{inputs:t,attrs:n,backend:r}=e,{image:a,transforms:s}=t,{interpolation:o,fillMode:l,fillValue:c,outputShape:d}=n,[u,h,p,m]=a.shape,[f,g]=d??[h,p],x=[u,f,g,m],y=E.computeStrides(a.shape),b=y[0],v=y[1],w=y[2],k=E.computeStrides(x),C=k[0],S=k[1],_=k[2],I=E.getTypedArrayFromDType(a.dtype,E.sizeFromShape(x));I.fill(c);let T=r.data.get(a.dataId).values,A=r.data.get(s.dataId).values;for(let j=0;j<u;++j){let D=s.shape[0]===1?A:A.subarray(j*8,j*8+8);for(let F=0;F<f;++F)for(let B=0;B<g;++B)for(let q=0;q<m;++q){let $,L=D[6]*B+D[7]*F+1;if(L===0)continue;let M=(D[0]*B+D[1]*F+D[2])/L,X=(D[3]*B+D[4]*F+D[5])/L,G=LF(M,p,l),W=LF(X,h,l);switch(o){case"nearest":$=j$e(T,h,p,b,v,w,j,W,G,q,c);break;case"bilinear":$=I$e(T,h,p,b,v,w,j,W,G,q,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}let O=j*C+F*S+B*_+q;I[O]=$}return r.makeTensorInfo(x,a.dtype,I)}return{dataId:r.write(I,x,a.dtype),shape:a.shape,dtype:a.dtype}}var N$e={kernelName:Pg,backendName:"cpu",kernelFunc:w$e};function LF(e,t,n){switch(n){case"reflect":return k$e(e,t);case"wrap":return S$e(e,t);case"nearest":return _$e(e,t);case"constant":default:return C$e(e)}}function k$e(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{let r=2*t;n-=r*Math.trunc(n/r),n>=t&&(n=r-n-1)}return E.clamp(0,n,t-1)}function S$e(e,t){let n=e;if(n<0)if(t<=1)n=0;else{let r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{let r=t-1;n-=t*Math.trunc(n/r)}return E.clamp(0,n,t-1)}function C$e(e,t){return e}function _$e(e,t){return E.clamp(0,e,t-1)}function Kx(e,t,n,r,a,s,o,l,c,d,u){let h=o*r+l*a+c*s+d;return 0<=l&&l<t&&0<=c&&c<n?e[h]:u}function j$e(e,t,n,r,a,s,o,l,c,d,u){let h=Math.round(l),p=Math.round(c);return Kx(e,t,n,r,a,s,o,h,p,d,u)}function I$e(e,t,n,r,a,s,o,l,c,d,u){let h=Math.floor(l),p=Math.floor(c),m=h+1,f=p+1,g=(f-c)*Kx(e,t,n,r,a,s,o,h,p,d,u)+(c-p)*Kx(e,t,n,r,a,s,o,h,f,d,u),x=(f-c)*Kx(e,t,n,r,a,s,o,m,p,d,u)+(c-p)*Kx(e,t,n,r,a,s,o,m,f,d,u);return(m-l)*g+(l-h)*x}function T$e(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;vt(s,"unique");let o=r.data.get(s.dataId).values,{outputValues:l,outputShape:c,indices:d}=GA(o,a,s.shape,s.dtype);return[r.makeTensorInfo(c,s.dtype,l),r.makeTensorInfo([d.length],"int32",d)]}var E$e={kernelName:Bb,backendName:"cpu",kernelFunc:T$e};function A$e(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let o=a.shape.length,l=a.shape[s],c=new Array(o-1),d=0;for(let m=0;m<o;m++)m!==s&&(c[d++]=a.shape[m]);let u=new Array(o).fill(0),h=a.shape.slice();h[s]=1;let p=new Array(l);for(let m=0;m<p.length;m++){u[s]=m;let f=fh({inputs:{x:a},backend:n,attrs:{begin:u,size:h}});p[m]=_r({inputs:{x:f},backend:n,attrs:{shape:c}}),n.disposeIntermediateTensorInfo(f)}return p}var R$e={kernelName:Og,backendName:"cpu",kernelFunc:A$e};function D$e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:o}=r;vt(a,"unsortedSegmentSum");let l=a.shape.length,c=s.shape.length,d=[],u=[],h=l-c,p=s;for(let f=0;f<h;++f){let g=t1({inputs:{input:p},backend:n,attrs:{dim:f+1}});p=g,u.push(g)}for(let f=0;f<o;++f){let g=E.createScalarValue(f,"int32"),x=n.makeTensorInfo([],"int32",g),y=qH({inputs:{a:x,b:p},backend:n}),b=yu({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=nk({inputs:{a:b,b:a},backend:n}),w=xv({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});d.push(w),u.push(x),u.push(y),u.push(b),u.push(v),u.push(w)}let m=BG({inputs:d,backend:n,attrs:{axis:0}});return u.forEach(f=>n.disposeIntermediateTensorInfo(f)),m}var M$e={kernelName:Wb,backendName:"cpu",kernelFunc:D$e},$$e=[IEe,oTe,EEe,REe,pTe,MEe,FEe,OEe,zEe,WEe,VEe,GEe,KEe,ZEe,JEe,nAe,aAe,iAe,lAe,_Ee,uAe,hAe,mAe,fTe,gAe,dTe,xTe,yAe,lTe,vAe,NAe,kAe,CAe,jAe,TAe,AAe,DAe,$Ae,PAe,LAe,BAe,UAe,HAe,qAe,KAe,XAe,QAe,eRe,tRe,nRe,rRe,sRe,lRe,bEe,uRe,yTe,yRe,bTe,bRe,wTe,CRe,_Re,IRe,kTe,CTe,ERe,RRe,MRe,FRe,jTe,TTe,cTe,ORe,wAe,zRe,WRe,VRe,vEe,ATe,DTe,GRe,$Te,KRe,ZRe,JRe,nDe,aDe,iDe,oDe,PTe,cDe,dDe,pDe,fDe,xDe,bDe,wDe,LTe,kDe,_De,EDe,BTe,UTe,DDe,FDe,LDe,HTe,BDe,UDe,VDe,WG,KDe,NEe,KTe,XDe,QDe,eMe,nMe,uTe,g_,aMe,kEe,SEe,CEe,iMe,lMe,uMe,hMe,mMe,fMe,xMe,rEe,bMe,SMe,_Me,EMe,sEe,RMe,MMe,FMe,iEe,IDe,LMe,BMe,UMe,HMe,qMe,YMe,ZMe,JMe,cEe,e$e,dEe,pEe,n$e,a$e,i$e,l$e,u$e,xEe,iRe,h$e,m$e,g$e,y$e,v$e,N$e,GTe,E$e,R$e,M$e,WDe];for(let e of $$e)Ub(e);var UG={};nn(UG,{assertNotComplex:()=>Jg,bindCanvasToFramebuffer:()=>G$e,bindColorTextureToFramebuffer:()=>Mw,bindTextureToProgramUniformSampler:()=>s9,bindTextureUnit:()=>n9,bindVertexBufferToProgramAttribute:()=>y_,callAndCheck:()=>st,canBeRepresented:()=>HG,createFragmentShader:()=>KG,createFramebuffer:()=>t9,createProgram:()=>YG,createStaticIndexBuffer:()=>QG,createStaticVertexBuffer:()=>ZG,createTexture:()=>JG,createVertexShader:()=>qG,getBatchDim:()=>gh,getExtensionOrThrow:()=>Yx,getFramebufferErrorMessage:()=>i9,getMaxTexturesInShader:()=>u9,getNumChannels:()=>V$e,getProgramUniformLocation:()=>a9,getProgramUniformLocationOrThrow:()=>r9,getRowsCols:()=>xh,getShapeAs3D:()=>Zx,getTextureShapeFromLogicalShape:()=>l9,getWebGLDisjointQueryTimerVersion:()=>d9,getWebGLErrorMessage:()=>GG,getWebGLMaxTextureSize:()=>c9,hasExtension:()=>li,isCapableOfRenderingToFloatTexture:()=>h9,isDownloadFloatTextureEnabled:()=>p9,isReshapeFree:()=>Yy,isWebGLFenceEnabled:()=>m9,isWebGLVersionEnabled:()=>v_,linkProgram:()=>XG,logShaderSourceAndInfoLog:()=>ZA,resetMaxTextureSize:()=>q$e,resetMaxTexturesInShader:()=>K$e,unbindColorTextureFromFramebuffer:()=>b_,unbindTextureUnit:()=>H$e,validateFramebuffer:()=>Xx,validateProgram:()=>Dw,validateTextureSize:()=>e9});var hd={},ow={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function VG(e,t){hd[e]=t}function Co(e,t){if(!(e in hd)||t!=null){let r=P$e(e,t);if(r!==null)hd[e]=r;else return console.log("Could not get context for WebGL version",e),null}let n=hd[e];return n==null||n.isContextLost()?(delete hd[e],Co(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),hd[e])}function F$e(e){if(!_e().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&e===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function P$e(e,t){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=t??F$e(e);return n.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete hd[e]},!1),_e().getBool("SOFTWARE_WEBGL_ENABLED")&&(ow.failIfMajorPerformanceCaveat=!1),e===1?n.getContext("webgl",ow)||n.getContext("experimental-webgl",ow):n.getContext("webgl2",ow)}var Ky;(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Ky||(Ky={}));var oi;(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(oi||(oi={}));var $a;(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})($a||($a={}));function yv(e,t){return[t,e]}function O$e(e,t){return e*t}function lw(e){let t=E.sizeFromShape(e),n=Math.ceil(t/4);return E.sizeToSquarishShape(n)}function Qg(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function L$e(e,t){let[n,r]=Qg(e,t);return n*r*4}function XA(e,t){let n=e,r,a,s,o,l,c,d,u,h,p;return _e().getNumber("WEBGL_VERSION")===2?(r=n.R32F,a=n.R16F,s=n.RGBA16F,o=n.RGBA32F,l=n.RED,d=4,u=1,h=n.HALF_FLOAT,p=n.FLOAT,c=n.RGBA8):(r=e.RGBA,a=e.RGBA,s=e.RGBA,o=n.RGBA,l=e.RGBA,d=4,u=4,h=t!=null?t.HALF_FLOAT_OES:null,p=e.FLOAT,c=e.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:o,textureFormatFloat:l,downloadTextureFormat:c,downloadUnpackNumChannels:d,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:p}}function st(e,t){let n=t();return _e().getBool("DEBUG")&&z$e(e),n}function z$e(e){let t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+GG(e,t))}var B$e=596e-10,W$e=65504;function HG(e){return!!(_e().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||B$e<Math.abs(e)&&Math.abs(e)<W$e)}function GG(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${t}`}}function Yx(e,t){return ic(e,()=>e.getExtension(t),'Extension "'+t+'" not supported on this browser.')}function qG(e,t){let n=ic(e,()=>e.createShader(e.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(st(e,()=>e.shaderSource(n,t)),st(e,()=>e.compileShader(n)),e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function KG(e,t){let n=ic(e,()=>e.createShader(e.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(st(e,()=>e.shaderSource(n,t)),st(e,()=>e.compileShader(n)),_e().get("ENGINE_COMPILE_ONLY"))return n;if(e.getShaderParameter(n,e.COMPILE_STATUS)===!1)throw ZA(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var U$e=/ERROR: [0-9]+:([0-9]+):/g;function ZA(e,t){let n=U$e.exec(t);if(n==null){console.log(`Couldn't parse line number in error: ${t}`),console.log(e);return}let r=+n[1],a=e.split(`
`),s=a.length.toString().length+2,o=a.map((h,p)=>E.rightPad((p+1).toString(),s)+h),l=0;for(let h=0;h<o.length;h++)l=Math.max(o[h].length,l);let c=o.slice(0,r-1),d=o.slice(r-1,r),u=o.slice(r);console.log(c.join(`
`)),console.log(t.split(`
`)[0]),console.log(`%c ${E.rightPad(d[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function YG(e){return ic(e,()=>e.createProgram(),"Unable to create WebGLProgram.")}function XG(e,t){if(st(e,()=>e.linkProgram(t)),!_e().get("ENGINE_COMPILE_ONLY")&&e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Dw(e,t){if(st(e,()=>e.validateProgram(t)),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function ZG(e,t){let n=ic(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return st(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),st(e,()=>e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function QG(e,t){let n=ic(e,()=>e.createBuffer(),"Unable to create WebGLBuffer");return st(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)),st(e,()=>e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)),n}function V$e(){return _e().getNumber("WEBGL_VERSION")===2?1:4}function JG(e){return ic(e,()=>e.createTexture(),"Unable to create WebGLTexture.")}function e9(e,t){let n=_e().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){let r=`[${e}x${t}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){let r=`[${e}x${t}]`,a=`[${n}x${n}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function t9(e){return ic(e,()=>e.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function y_(e,t,n,r,a,s,o){let l=e.getAttribLocation(t,n);return l===-1?!1:(st(e,()=>e.bindBuffer(e.ARRAY_BUFFER,r)),st(e,()=>e.vertexAttribPointer(l,a,e.FLOAT,!1,s,o)),st(e,()=>e.enableVertexAttribArray(l)),!0)}function n9(e,t,n){o9(e,n),st(e,()=>e.activeTexture(e.TEXTURE0+n)),st(e,()=>e.bindTexture(e.TEXTURE_2D,t))}function H$e(e,t){o9(e,t),st(e,()=>e.activeTexture(e.TEXTURE0+t)),st(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function r9(e,t,n){return ic(e,()=>e.getUniformLocation(t,n),'uniform "'+n+'" not present in program.')}function a9(e,t,n){return e.getUniformLocation(t,n)}function s9(e,t,n,r){st(e,()=>n9(e,t,r)),st(e,()=>e.uniform1i(n,r))}function G$e(e){st(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),st(e,()=>e.viewport(0,0,e.canvas.width,e.canvas.height)),st(e,()=>e.scissor(0,0,e.canvas.width,e.canvas.height))}function Mw(e,t,n){st(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,n)),st(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0))}function b_(e,t){st(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,t)),st(e,()=>e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0))}function Xx(e){let t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+i9(e,t))}function i9(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${t}`}}function ic(e,t,n){let r=st(e,()=>t());if(r==null)throw new Error(n);return r}function o9(e,t){let n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){let a=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${a}.`)}}function gh(e,t=2){return E.sizeFromShape(e.slice(0,e.length-t))}function xh(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Zx(e){let t=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(t=[gh(e),...xh(e)]),t}function l9(e,t=!1){let n=_e().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=_e().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&_e().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n=n*2,r=r*2,e=e.map((l,c)=>c>=e.length-2?E.nearestLargerEven(e[c]):e[c]),e.length===1&&(e=[2,e[0]])),e.length!==2&&(e=E.squeezeShape(e).newShape);let a=E.sizeFromShape(e),s=null;e.length<=1&&a<=n?s=[1,a]:e.length===2&&e[0]<=n&&e[1]<=n?s=e:e.length===3&&e[0]*e[1]<=n&&e[2]<=n?s=[e[0]*e[1],e[2]]:e.length===3&&e[0]<=n&&e[1]*e[2]<=n?s=[e[0],e[1]*e[2]]:e.length===4&&e[0]*e[1]*e[2]<=n&&e[3]<=n?s=[e[0]*e[1]*e[2],e[3]]:e.length===4&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(s=[e[0],e[1]*e[2]*e[3]]);let o=s!=null&&Math.max(...s)>r&&Math.min(...s)<=(t?2:1)&&Math.min(...s)>0;if(s==null||o)if(t){let l=gh(e),c=2,d=2;e.length&&([c,d]=xh(e)),a=l*(c/2)*(d/2),s=E.sizeToSquarishShape(a).map(u=>u*2)}else s=E.sizeToSquarishShape(a);return s}function cw(e){return e%2===0}function Yy(e,t){if(e=e.slice(-2),t=t.slice(-2),E.arraysEqual(e,t)||!e.length||!t.length||e[0]===0||e[1]===0||t[0]===0||t[1]===0)return!0;if(e.length!==t.length){let n=e[e.length-1],r=t[t.length-1];if(n===r||cw(n)&&cw(r)&&(e[0]===1||t[0]===1))return!0}return e[1]===t[1]&&cw(e[0])&&cw(t[0])}var $w,Fw;function c9(e){if($w==null){let t=Co(e);$w=t.getParameter(t.MAX_TEXTURE_SIZE)}return $w}function q$e(){$w=null}function K$e(){Fw=null}function u9(e){if(Fw==null){let t=Co(e);Fw=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Fw)}function d9(e){if(e===0)return 0;let t,n=Co(e);return li(n,"EXT_disjoint_timer_query_webgl2")&&e===2?t=2:li(n,"EXT_disjoint_timer_query")?t=1:t=0,t}function li(e,t){return e.getExtension(t)!=null}function v_(e){try{if(Co(e)!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function h9(e){if(e===0)return!1;let t=Co(e);if(e===1){if(!li(t,"OES_texture_float"))return!1}else if(!li(t,"EXT_color_buffer_float"))return!1;return w_(t)}function p9(e){if(e===0)return!1;let t=Co(e);if(e===1){if(!li(t,"OES_texture_float")||!li(t,"WEBGL_color_buffer_float"))return!1}else{if(li(t,"EXT_color_buffer_float"))return w_(t);let n="EXT_color_buffer_half_float";if(li(t,n)){let r=t.getExtension(n);return Y$e(t,r)}return!1}return w_(t)}function w_(e){let t=XA(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);let r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);let a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function Y$e(e,t){let n=XA(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);let a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);let s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),s}function m9(e){return e!==2?!1:Co(e).fenceSync!=null}function Jg(e,t){Array.isArray(e)||(e=[e]),e.forEach(n=>{n!=null&&E.assert(n.dtype!=="complex64",()=>`${t} does not support complex64 tensors in the WebGL backend.`)})}var Ct=_e();Ct.registerFlag("HAS_WEBGL",()=>Ct.getNumber("WEBGL_VERSION")>0);Ct.registerFlag("WEBGL_VERSION",()=>v_(2)?2:v_(1)?1:0);Ct.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ct.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ct.get("WEBGL_VERSION")===2);Ct.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ct.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ct.registerFlag("WEBGL_PACK",()=>Ct.getBool("HAS_WEBGL"));Ct.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_CLIP",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_REDUCE",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_CONV_IM2COL",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ct.getBool("WEBGL_PACK"));Ct.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>c9(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>u9(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let e=Ct.getNumber("WEBGL_VERSION");return e===0?0:d9(e)});Ct.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ct.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Gb.isMobile());Ct.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>h9(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ct.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ct.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ct.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>p9(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_FENCE_API_ENABLED",()=>m9(Ct.getNumber("WEBGL_VERSION")));Ct.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ct.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ct.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${e}.`)});Ct.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Gb.isMobile()?1:-1,e=>{if(typeof e!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${e}.`);if(e<0&&e!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${e}.`)});Ct.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ct.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ct.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ct.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ct.registerFlag("WEBGL_EXP_CONV",()=>!1);Ct.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ct.getBool("IS_TEST"));Ct.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ct.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ct.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ct.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function ss(){let e,t,n,r,a,s,o,l,c,d;return _e().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",t="in",n="out",r="in",a="texture",s="outputColor",o="out vec4 outputColor;",l=_e().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",d=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",t="attribute",n="varying",r="varying",a="texture2D",s="gl_FragColor",o="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,d=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:s,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:c,defineRound:d}}function Xp(e,t,n="index"){let r=E.computeStrides(t);return r.map((a,s)=>{let o=`int ${e[s]} = ${n} / ${a}`,l=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * ${a}`:`index -= ${e[s]} * ${a}`;return`${o}; ${l};`}).join("")}function rk(e,t,n="index"){let r=E.computeStrides(t);return r.map((a,s)=>{let o=`int ${e[s]} = ${n} / outShapeStrides[${s}]`,l=s===r.length-1?`int ${e[s+1]} = ${n} - ${e[s]} * outShapeStrides[${s}]`:`index -= ${e[s]} * outShapeStrides[${s}]`;return`${o}; ${l};`}).join("")}function X$e(e,t){let n=e.length,r=e.map(s=>`${t}[${s}]`),a=new Array(n-1);a[n-2]=r[n-1];for(let s=n-3;s>=0;--s)a[s]=`(${a[s+1]} * ${r[s+1]})`;return a}function Z$e(e,t,n="index"){let r=e.map((s,o)=>o),a=X$e(r,t);return a.map((s,o)=>{let l=`int ${e[o]} = ${n} / ${a[o]}`,c=o===a.length-1?`int ${e[o+1]} = ${n} - ${e[o]} * ${a[o]}`:`index -= ${e[o]} * ${a[o]}`;return`${l}; ${c};`}).join("")}function QA(e){let t=E.computeStrides(e).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${t[0]} + coords.y * ${t[1]} + coords.z;
  }
`}function JA(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var f9=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,{getBroadcastDims:g9}=z;function Q$e(e,t,n){let r=[];if(e.forEach(p=>{let m=E.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push(`uniform float ${p.name}${m>1?`[${m}]`:""};`):(r.push(`uniform sampler2D ${p.name};`),r.push(`uniform int offset${p.name};`)),n.enableShapeUniforms){let{uniformShape:f}=eR(n.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape);switch(f.length){case 1:r.push(`uniform int ${p.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${p.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${p.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${p.name}Shape;`);break}r.push(`uniform ivec2 ${p.name}TexShape;`)}}),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(p=>{r.push(`uniform ${p.type} ${p.name}${p.arrayIndex?`[${p.arrayIndex}]`:""};`)});let a=r.join(`
`),s=e.map(p=>J$e(p,t,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=t.texShape,l=ss(),c=n3e(l),d,u,h=s3e(l);return t.isPacked?(d=e3e(t.logicalShape,o,n.enableShapeUniforms),u=a3e(l)):(d=t3e(t.logicalShape,o,n.enableShapeUniforms),u=r3e(l)),n.packedInputs&&(h+=c3e),[h,c,u,a,d,s,n.userCode].join(`
`)}function ex(e,t=!1){let n=e.shapeInfo.logicalShape;switch(n.length){case 0:return w3e(e,t);case 1:return k3e(e,t);case 2:return C3e(e,t);case 3:return j3e(e,t);case 4:return T3e(e,t);case 5:return E3e(e);case 6:return A3e(e);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function x9(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return v3e(e);case 1:return N3e(e,t);case 2:return S3e(e,t);case 3:return _3e(e,t);default:return I3e(e,t)}}function J$e(e,t,n=!1,r){let a="";n?a+=x9(e,r):a+=ex(e,r);let s=e.shapeInfo.logicalShape,o=t.logicalShape;return s.length<=o.length&&(n?a+=R3e(e,t):a+=D3e(e,t)),a}function e3e(e,t,n){switch(e.length){case 0:return y9();case 1:return u3e(e,t,n);case 2:return y3e(e,t,n);case 3:return h3e(e,t,n);default:return m3e(e,t,n)}}function t3e(e,t,n){switch(e.length){case 0:return y9();case 1:return d3e(e,t,n);case 2:return b3e(e,t,n);case 3:return p3e(e,t,n);case 4:return f3e(e,t,n);case 5:return g3e(e,t);case 6:return x3e(e,t);default:throw new Error(`${e.length}-D output sampling is not yet supported`)}}function n3e(e){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${e.texture2D}(textureSampler, uv).r;
    }
  `}function r3e(e){return`
    void setOutput(float val) {
      ${e.output} = vec4(val, 0, 0, 0);
    }
  `}function a3e(e){return`
    void setOutput(vec4 val) {
      ${e.output} = val;
    }
  `}function s3e(e){return`${e.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${e.varyingFs} vec2 resultUV;
    ${e.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${e.defineSpecialNaN}
    ${e.defineSpecialInf}
    ${e.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${i3e}
    ${o3e}
    ${l3e}
  `}var i3e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,o3e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,l3e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,c3e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function y9(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function u3e(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return r[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function d3e(e,t,n){return t[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${t[1]}.0);
      }
    `:t[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${t[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      return resTexRC.x * ${t[1]} + resTexRC.y;
    }
  `}function h3e(e,t,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),s=a*Math.ceil(e[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec3(b, r, c);
    }
  `}function p3e(e,t,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${rk(["r","c","d"],e)}
    return ivec3(r, c, d);
  }
`;let r=Xp(["r","c","d"],e);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function m3e(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),s=a*Math.ceil(e[e.length-2]/2),o=s,l="",c="b, r, c";for(let d=2;d<e.length-1;d++)o*=e[e.length-d-1],l=`
      int b${d} = index / ${o};
      index -= b${d} * ${o};
    `+l,c=`b${d}, `+c;return`
    ivec${e.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${l}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec${e.length}(${c});
    }
  `}function f3e(e,t,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${rk(["r","c","d","d2"],e)}
      return ivec4(r, c, d, d2);
    }
  `;let r=Xp(["r","c","d","d2"],e);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function g3e(e,t){let n=Xp(["r","c","d","d2","d3"],e);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${t[0]},
                             ${t[1]}));

      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function x3e(e,t){let n=Xp(["r","c","d","d2","d3","d4"],e);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function y3e(e,t,n){let r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(E.arraysEqual(e,t))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let a=Math.ceil(e[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${a});
      int c = imod(index, ${a}) * 2;

      return ivec2(r, c);
    }
  `}function b3e(e,t,n){return E.arraysEqual(e,t)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${t[0]}, ${t[1]}));
      }
    `:e[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:e[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${t[0]}, ${t[1]}));
        int index = resTexRC.x * ${t[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${t[0]}, ${t[1]}));
      int index = resTexRC.x * ${t[1]} + resTexRC.y;
      int r = index / ${e[1]};
      int c = index - r * ${e[1]};
      return ivec2(r, c);
    }
  `}function Zp(e){return`offset${e}`}function v3e(e){let t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ss();return`
    vec4 ${n}() {
      return ${r.texture2D}(${t}, halfCR);
    }
  `}function w3e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`float ${r}() {return ${n};}`;let[a,s]=e.shapeInfo.texShape;if(a===1&&s===1)return`
      float ${r}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let o=Zp(n);if(t)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;let[l,c]=e.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${l}, ${c}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function N3e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,s=ss();if(t)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${n}, uv);
    }
  `;let o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${s.texture2D}(${n}, uv);
    }
  `}function k3e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${tx(e)}
      }
    `;let a=e.shapeInfo.texShape,s=a[0],o=a[1];if(o===1&&s===1)return`
      float ${r}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let l=Zp(n);return o===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${s}.0);
        return sampleTexture(${n}, uv);
      }
    `:s===1?t?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:t?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${l});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${s}, ${o}, index + ${l});
      return sampleTexture(${n}, uv);
    }
  `}function S3e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=s[0],l=s[1],c=ss();if(s!=null&&E.arraysEqual(n,s))return t?`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${c.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${o}.0);

        return ${c.texture2D}(${r}, uv);
      }
    `;if(t)return`
    vec4 ${a}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `;let d=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${a}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${d[0]}, ${d[1]}, row, col);
      return ${c.texture2D}(${r}, uv);
    }
  `}function C3e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape;if(s!=null&&E.arraysEqual(n,s)){if(t)return`
      float ${a}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let p=s[0],m=s[1];return`
    float ${a}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${m}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:o,keptDims:l}=E.squeezeShape(n),c=o;if(c.length<n.length){let p=nx(e,c),m=["row","col"];return`
      ${ex(p,t)}
      float ${a}(int row, int col) {
        return ${a}(${rx(m,l)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${tx(e)}
      }
    `;let d=s[0],u=s[1],h=Zp(r);return u===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${d}.0);
      return sampleTexture(${r}, uv);
    }
  `:d===1?t?`
      float ${a}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:t?`
      float ${a}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${a}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${h};
    vec2 uv = uvFromFlat(${d}, ${u}, index);
    return sampleTexture(${r}, uv);
  }
`}function _3e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=e.shapeInfo.texShape,o=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(n[0]===1){let p=n.slice(1),m=[1,2],f=nx(e,p),g=["b","row","col"];return`
        ${x9(f,t)}
        vec4 ${a}(int b, int row, int col) {
          return ${a}(${rx(g,m)});
        }
      `}let l=ss();if(t)return`
    vec4 ${a}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let c=o[0],d=o[1],u=Math.ceil(n[2]/2),h=u*Math.ceil(n[1]/2);return`
    vec4 ${a}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${d}, ${h}, ${u}, b, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function j3e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[1]*n[2],o=n[2],{newShape:l,keptDims:c}=E.squeezeShape(n),d=l;if(d.length<n.length){let g=nx(e,d),x=["row","col","depth"];return`
        ${ex(g,t)}
        float ${a}(int row, int col, int depth) {
          return ${a}(${rx(x,c)});
        }
      `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${o}, 1)));
        ${tx(e)}
      }
    `;let u=e.shapeInfo.texShape,h=u[0],p=u[1],m=e.shapeInfo.flatOffset;if(p===s&&m==null)return t?`
      float ${a}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${a}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(p===o&&m==null)return t?`
      float ${a}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${a}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${r}, uv);
    }
  `;let f=Zp(r);return t?`
    float ${a}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${f};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${a}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${o} + depth + ${f};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${r}, uv);
      }
  `}function I3e(e,t){let n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=ss();if(t)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${a.texture2D}(${n}, uv);
    }
  `;let s=e.shapeInfo.logicalShape,o=s.length,l=e.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],u=c[1],h=Math.ceil(s[o-1]/2),p=h*Math.ceil(s[o-2]/2),m="int b, int row, int col",f=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let g=2;g<o-1;g++)m=`int b${g}, `+m,p*=s[o-g-1],f=`b${g} * ${p} + `+f;return`
    vec4 ${r}(${m}) {
      int index = ${f};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${d});
      return ${a.texture2D}(${n}, uv);
    }
  `}function T3e(e,t){let n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),s=n[3],o=n[2]*s,l=n[1]*o,{newShape:c,keptDims:d}=E.squeezeShape(n);if(c.length<n.length){let b=nx(e,c),v=["row","col","depth","depth2"];return`
      ${ex(b,t)}
      float ${a}(int row, int col, int depth, int depth2) {
        return ${a}(${rx(v,d)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${a}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${o}, ${s}, 1)));
        ${tx(e)}
      }
    `;let u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1],f=`int stride2 = ${r}Shape[3];`,g=`int stride1 = ${r}Shape[2] * stride2;`,x=`int stride0 = ${r}Shape[1] * stride1;`;if(m===l&&u==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        ${f}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===s&&u==null)return t?`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${a}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=Zp(r);return t?`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${f}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${a}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${p}, ${m}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function E3e(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],s=t[3]*a,o=t[2]*s,l=t[1]*o,{newShape:c,keptDims:d}=E.squeezeShape(t);if(c.length<t.length){let g=nx(e,c),x=["row","col","depth","depth2","depth3"];return`
      ${ex(g)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${rx(x,d)});
      }
    `}if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${o}, ${s}, ${a})) +
          depth3;
        ${tx(e)}
      }
    `;let u=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,p=h[0],m=h[1];if(m===l&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${s}, ${a}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(m===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]},
               ${t[2]*t[3]}, ${t[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;let f=Zp(n);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} + depth * ${s} +
          depth2 * ${a} + depth3 + ${f};
      vec2 uv = uvFromFlat(${p}, ${m}, index);
      return sampleTexture(${n}, uv);
    }
  `}function A3e(e){let t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:a,keptDims:s}=E.squeezeShape(t);if(a.length<t.length){let x=nx(e,a),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${ex(x)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${rx(y,s)});
      }
    `}let o=t[5],l=t[4]*o,c=t[3]*l,d=t[2]*c,u=t[1]*d;if(e.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${d}, ${c}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${tx(e)}
      }
    `;let h=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,m=p[0],f=p[1];if(f===u&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${d}, ${c}, ${l}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===o&&h==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${t[1]*t[2]*t[3]*t[4]},
               ${t[2]*t[3]*t[4]},
               ${t[3]*t[4]},
               ${t[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${m}.0);
        return sampleTexture(${n}, uv);
      }
    `;let g=Zp(n);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${d} + depth * ${c} +
          depth2 * ${l} + depth3 * ${o} + depth4 + ${g};
      vec2 uv = uvFromFlat(${m}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function tx(e){let t=e.name,n=E.sizeFromShape(e.shapeInfo.logicalShape);return n<2?`return ${t};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${t}[i];
      }
    }
  `}function R3e(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=e.shapeInfo.logicalShape.length,o=t.logicalShape.length,l=g9(e.shapeInfo.logicalShape,t.logicalShape),c=fr(o),d=o-s,u,h=["x","y","z","w","u","v"];s===0?u="":o<2&&l.length>=1?u="coords = 0;":u=l.map(x=>`coords.${h[x+d]} = 0;`).join(`
`);let p="";o<2&&s>0?p="coords":p=e.shapeInfo.logicalShape.map((x,y)=>`coords.${h[y+d]}`).join(", ");let m="return outputValue;",f=E.sizeFromShape(e.shapeInfo.logicalShape)===1,g=E.sizeFromShape(t.logicalShape)===1;if(s===1&&!f&&!g)m=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(f&&!g)o===1?m=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:m=`
        return vec4(outputValue.x);
      `;else if(l.length){let x=s-2,y=s-1;l.indexOf(x)>-1&&l.indexOf(y)>-1?m="return vec4(outputValue.x);":l.indexOf(x)>-1?m="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(y)>-1&&(m="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${a}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${m}
    }
  `}function D3e(e,t){let n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",s=t.texShape,o=e.shapeInfo.texShape,l=e.shapeInfo.logicalShape.length,c=t.logicalShape.length;if(!e.shapeInfo.isUniform&&l===c&&e.shapeInfo.flatOffset==null&&E.arraysEqual(o,s))return`
      float ${a}() {
        return sampleTexture(${n}, resultUV);
      }
    `;let d=fr(c),u=g9(e.shapeInfo.logicalShape,t.logicalShape),h=c-l,p,m=["x","y","z","w","u","v"];l===0?p="":c<2&&u.length>=1?p="coords = 0;":p=u.map(g=>`coords.${m[g+h]} = 0;`).join(`
`);let f="";return c<2&&l>0?f="coords":f=e.shapeInfo.logicalShape.map((g,x)=>`coords.${m[x+h]}`).join(", "),`
    float ${a}() {
      ${d} coords = getOutputCoords();
      ${p}
      return get${r}(${f});
    }
  `}function fr(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error(`GPU for rank ${e} is not yet supported`)}function eR(e,t,n){let{newShape:r,keptDims:a}=E.squeezeShape(t),s=t.length,o=e&&s===3&&t[0]===1,l=o?t.slice(1):r,c=!e&&s>1&&!E.arraysEqual(t,n)&&r.length<s||o;return{useSqueezeShape:c,uniformShape:c?l:t,keptDims:a}}function nx(e,t){let n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function rx(e,t){return t.map(n=>e[n]).join(", ")}function M3e(e,t,n,r){let a=n.map((u,h)=>{let p={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(p.flatOffset=u.texData.slice.flatOffset),{name:t.variableNames[h],shapeInfo:p}}),s=a.map(u=>u.shapeInfo),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=Q$e(a,o,t),c=KG(e.gl,l),d=e.createProgram(c);return _e().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:c,source:l,webGLProgram:d,inShapeInfos:s,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(e.buildVao(d),Object.assign({program:t,fragmentShader:c,source:l,webGLProgram:d,inShapeInfos:s,outShapeInfo:o},b9(e,t,d)))}function b9(e,t,n){let r=[],a=[],s,o,l,c=null,d=null;d=e.getUniformLocation(n,"NAN",!1),_e().getNumber("WEBGL_VERSION")===1&&(c=e.getUniformLocation(n,"INFINITY",!1));let u=!1;for(let h of t.variableNames){let p={name:h,uniform:e.getUniformLocation(n,h,u),offset:e.getUniformLocation(n,`offset${h}`,u)};t.enableShapeUniforms&&(p.shape=e.getUniformLocation(n,`${h}Shape`,u),p.texShape=e.getUniformLocation(n,`${h}TexShape`,u)),r.push(p)}if(t.enableShapeUniforms&&(s=e.getUniformLocation(n,"outShape",u),l=e.getUniformLocation(n,"outShapeStrides",u),o=e.getUniformLocation(n,"outTexShape",u)),t.customUniforms)for(let h of t.customUniforms)a.push(e.getUniformLocation(n,h.name,u));return{variablesLocations:r,customUniformLocations:a,infLoc:c,nanLoc:d,outShapeLocation:s,outShapeStridesLocation:l,outTexShapeLocation:o}}function zF(e,t){if(e.length!==t.length)throw Error(`Binary was compiled with ${e.length} inputs, but was executed with ${t.length} inputs`);e.forEach((n,r)=>{let a=n.logicalShape,s=t[r],o=s.shape;if(!E.arraysEqual(a,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${a} and ${o} must match`);if(n.isUniform&&s.isUniform)return;let l=n.texShape,c=s.isUniform?null:s.texData.texShape;if(!E.arraysEqual(l,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${c} must match`)})}function $3e(e,t,n,r,a){t.program.enableShapeUniforms||(zF(t.inShapeInfos,n),zF([t.outShapeInfo],[r]));let s=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(s.texture,o[0],o[1]):e.setOutputMatrixTexture(s.texture,o[0],o[1]),e.setProgram(t.webGLProgram),e.bindVertexArray(t.webGLProgram.vao),_e().getNumber("WEBGL_VERSION")===1&&t.infLoc!==null&&e.gl.uniform1f(t.infLoc,1/0),t.nanLoc!==null&&e.gl.uniform1f(t.nanLoc,NaN);for(let c=0;c<n.length;++c){let d=n[c],{uniform:u,offset:h,shape:p,texShape:m}=t.variablesLocations[c];if(p){let{uniformShape:f}=eR(t.program.packedInputs,d.shape,d.texData.texShape);switch(f.length){case 1:e.gl.uniform1iv(p,new Int32Array(f));break;case 2:e.gl.uniform2iv(p,new Int32Array(f));break;case 3:e.gl.uniform3iv(p,new Int32Array(f));break;case 4:e.gl.uniform4iv(p,new Int32Array(f));break}}if(m&&e.gl.uniform2i(m,d.texData.texShape[0],d.texData.texShape[1]),u!=null){if(d.isUniform){if(E.sizeFromShape(d.shape)<2)e.gl.uniform1f(u,d.uniformValues[0]);else{let f=d.uniformValues;f instanceof Float32Array||(f=new Float32Array(f)),e.gl.uniform1fv(u,f)}continue}d.texData.slice!=null&&h!=null&&e.gl.uniform1i(h,d.texData.slice.flatOffset),e.setInputMatrixTexture(d.texData.texture.texture,u,c)}}let l=t.outShapeLocation;if(l)switch(r.shape.length){case 1:e.gl.uniform1iv(l,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(l,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(l,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(l,new Int32Array(r.shape));break}if(t.outShapeStridesLocation){let c=E.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(c));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(c));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(c));break}}if(t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a)for(let c=0;c<t.program.customUniforms.length;++c){let d=t.program.customUniforms[c],u=t.customUniformLocations[c],h=a[c];if(d.type==="float")e.gl.uniform1fv(u,h);else if(d.type==="vec2")e.gl.uniform2fv(u,h);else if(d.type==="vec3")e.gl.uniform3fv(u,h);else if(d.type==="vec4")e.gl.uniform4fv(u,h);else if(d.type==="int")e.gl.uniform1iv(u,h);else if(d.type==="ivec2")e.gl.uniform2iv(u,h);else if(d.type==="ivec3")e.gl.uniform3iv(u,h);else if(d.type==="ivec4")e.gl.uniform4iv(u,h);else throw Error(`uniform type ${d.type} is not supported yet.`)}e.executeProgram()}function F3e(e,t,n){let r="";t.concat(n).forEach(o=>{let l=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!o.isUniform){let c=o.texData.texShape,{useSqueezeShape:d,uniformShape:u,keptDims:h}=eR(e.packedInputs,o.shape,c),p="",m="",f="";if(u.length===1&&e.packedInputs){let k=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];p=`${k[0]>1}_${k[1]>1}`}else if(u.length===2&&!e.packedInputs)m=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!e.packedInputs){let k=E.computeStrides(u);f=`${k[0]===c[1]}_${k[k.length-1]===c[1]}`}let g=o.shape.length,x=u.length===2&&E.arraysEqual(o.shape,c),y=E.sizeFromShape(o.shape)===1,b=z.getBroadcastDims(o.shape,n.shape),v=!e.packedInputs&&g===n.shape.length&&E.arraysEqual(c,n.texData.texShape),w=e.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;r+=`${g}_${v}_${d?h:""}_${u.length}_${y}_${b}_${x}_${p}_${m}_${f}_${w}_${l}`}else{let c=o.isUniform?"uniform":o.texData.texShape;r+=`${o.shape}_${c}_${l}`}});let a=e.userCode,s=e.constructor.name;return s+="_"+r+"_"+a+`${_e().getNumber("WEBGL_VERSION")}`,s}function Ha(e){return _e().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var P3e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ky.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=ss();this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?rk(["r","c","d"],e):Xp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}},O3e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ky.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let t=ss();this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?rk(["r","c","d"],e):Xp(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}},L3e=class{constructor(e){this.variableNames=["A"],this.outTexUsage=oi.DOWNLOAD;let t=ss();this.outputShape=e,this.userCode=`
      ${f9}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}},z3e=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=oi.DOWNLOAD;let t=ss();this.outputShape=e,this.userCode=`
      ${f9}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}},B3e={R:0,G:1,B:2,A:3},BF=class{constructor(e,t=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=ss();this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length);let a="result";t&&(a="floor(result * 255. + 0.5)");let s="";for(let o=0;o<n.length;o++){let l=n[o];s+=`
          if(offset == ${o}) {
            result = values[${B3e[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?JA():QA(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${s}
        }
        ${r.output} = vec4(${a}, 0., 0., 0.);
      }
    `}},W3e=class{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=ss();this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length);let r="",a="result";t&&(a="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let o=0;o<=1;o++){let l=s*2+o;r+=`
          localCoords = coords;
          if(localCoords[2] + ${o} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${o};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?JA():QA(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${n.output} = ${a};
        }
    `}},v9={};nn(v9,{bindVertexProgramAttributeStreams:()=>T9,createBufferFromOutputTexture:()=>R9,createFloat16MatrixTexture:()=>C9,createFloat16PackedMatrixTexture:()=>I9,createFloat32MatrixTexture:()=>S9,createIndexBuffer:()=>k9,createPackedMatrixTexture:()=>j9,createUnsignedBytesMatrixTexture:()=>_9,createVertexBuffer:()=>N9,createVertexShader:()=>w9,downloadByteEncodedFloatMatrixFromOutputTexture:()=>M9,downloadFloat32MatrixFromBuffer:()=>D9,downloadMatrixFromPackedOutputTexture:()=>F9,downloadPackedMatrixFromBuffer:()=>$9,getInternalFormatForFloat16MatrixTexture:()=>nR,getInternalFormatForFloat16PackedMatrixTexture:()=>sR,getInternalFormatForFloat32MatrixTexture:()=>tR,getInternalFormatForPackedMatrixTexture:()=>aR,getInternalFormatForUnsignedBytesMatrixTexture:()=>rR,uploadDenseMatrixToTexture:()=>E9,uploadPixelDataToTexture:()=>A9});function w9(e){let t=ss(),n=`${t.version}
    precision highp float;
    ${t.attribute} vec3 clipSpacePos;
    ${t.attribute} vec2 uv;
    ${t.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return qG(e,n)}function N9(e){let t=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return ZG(e,t)}function k9(e){let t=new Uint16Array([0,1,2,2,1,3]);return QG(e,t)}function bv(e,t,n,r,a,s){e9(t,n);let o=JG(e),l=e.TEXTURE_2D;return st(e,()=>e.bindTexture(l,o)),st(e,()=>e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)),st(e,()=>e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),st(e,()=>e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.NEAREST)),st(e,()=>e.texParameteri(l,e.TEXTURE_MAG_FILTER,e.NEAREST)),_e().getNumber("WEBGL_VERSION")===1?st(e,()=>e.texImage2D(l,0,r,t,n,0,a,s,null)):st(e,()=>e.texStorage2D(l,1,r,t,n)),st(e,()=>e.bindTexture(e.TEXTURE_2D,null)),{texture:o,texShape:[n,t]}}function tR(e){return e.internalFormatFloat}function S9(e,t,n,r){let[a,s]=yv(t,n);return bv(e,a,s,tR(r),r.textureFormatFloat,e.FLOAT)}function nR(e){return e.internalFormatHalfFloat}function C9(e,t,n,r){let[a,s]=yv(t,n);return bv(e,a,s,nR(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function rR(e){return e.downloadTextureFormat}function _9(e,t,n,r){let[a,s]=yv(t,n);return bv(e,a,s,rR(r),e.RGBA,e.UNSIGNED_BYTE)}function aR(e){return e.internalFormatPackedFloat}function j9(e,t,n,r){let[a,s]=Qg(t,n);return bv(e,a,s,aR(r),e.RGBA,e.FLOAT)}function sR(e){return e.internalFormatPackedHalfFloat}function I9(e,t,n,r){let[a,s]=Qg(t,n);return bv(e,a,s,sR(r),e.RGBA,r.textureTypeHalfFloat)}function T9(e,t,n){return st(e,()=>e.bindBuffer(e.ARRAY_BUFFER,n)),y_(e,t,"clipSpacePos",n,3,20,0)&&y_(e,t,"uv",n,2,20,12)}function E9(e,t,n,r,a,s){st(e,()=>e.bindTexture(e.TEXTURE_2D,t));let o,l,c;a instanceof Uint8Array?(o=new Uint8Array(n*r*4),l=e.UNSIGNED_BYTE,c=e.RGBA):(o=new Float32Array(n*r*4),l=e.FLOAT,c=s.internalFormatPackedFloat),o.set(a),_e().getNumber("WEBGL_VERSION")===2?st(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,l,o)):st(e,()=>e.texImage2D(e.TEXTURE_2D,0,c,n,r,0,e.RGBA,l,o)),st(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function A9(e,t,n){st(e,()=>e.bindTexture(e.TEXTURE_2D,t)),n.data instanceof Uint8Array?_e().getNumber("WEBGL_VERSION")===2?st(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)):st(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)):_e().getNumber("WEBGL_VERSION")===2?st(e,()=>e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)):st(e,()=>e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),st(e,()=>e.bindTexture(e.TEXTURE_2D,null))}function R9(e,t,n,r){let a=e.createBuffer();st(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,a));let s=4*4*t*n;return st(e,()=>e.bufferData(e.PIXEL_PACK_BUFFER,s,e.STREAM_READ)),st(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)),st(e,()=>e.bindBuffer(e.PIXEL_PACK_BUFFER,null)),a}function D9(e,t,n){let r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function M9(e,t,n,r){let[a,s]=yv(t,n),o=4,l=new Uint8Array(O$e(t*n,o));return st(e,()=>e.readPixels(0,0,a,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function $9(e,t,n,r,a,s,o,l){let c=e,d=new Float32Array(L$e(s,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,d),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),d}function F9(e,t,n){let r=new Float32Array(t*n*4);return st(e,()=>e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)),r}var Pw=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let t=_e().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,VG(t,e)):this.gl=Co(t),e=this.gl,_e().getNumber("WEBGL_VERSION")===2){let a=e;this.createVertexArray=()=>st(a,()=>a.createVertexArray()),this.bindVertexArray=s=>st(a,()=>a.bindVertexArray(s)),this.deleteVertexArray=s=>st(a,()=>a.deleteVertexArray(s)),this.getVertexArray=()=>st(a,()=>a.getParameter(a.VERTEX_ARRAY_BINDING))}else if(e!=null){let a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>st(e,()=>a.createVertexArrayOES()),this.bindVertexArray=s=>st(e,()=>a.bindVertexArrayOES(s)),this.deleteVertexArray=s=>st(e,()=>a.deleteVertexArrayOES(s)),this.getVertexArray=()=>st(e,()=>e.getParameter(a.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),_e().getNumber("WEBGL_VERSION")===1){let a="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=Yx(this.gl,a),li(this.gl,s))this.textureHalfFloatExtension=Yx(this.gl,s);else if(_e().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),li(this.gl,r))this.colorBufferHalfFloatExtension=Yx(this.gl,r);else if(_e().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",li(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(li(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=N9(this.gl),this.indexBuffer=k9(this.gl),this.framebuffer=t9(this.gl),this.textureConfig=XA(this.gl,this.textureHalfFloatExtension)}get debug(){return _e().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;st(e,()=>e.finish()),st(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),st(e,()=>e.deleteFramebuffer(this.framebuffer)),st(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),st(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),st(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),S9(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),C9(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),_9(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),A9(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,n,r){this.throwIfDisposed(),E9(this.gl,e,t,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),I9(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),j9(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(b_(this.gl,this.framebuffer),this.outputTexture=null),st(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,n){return this.downloadMatrixDriver(e,()=>M9(this.gl,t,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,n,r,a,s){return $9(this.gl,e,t,n,r,a,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return D9(this.gl,e,t)}createBufferFromTexture(e,t,n){this.bindTextureToFrameBuffer(e);let r=R9(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,n;if(_e().getBool("WEBGL_FENCE_API_ENABLED")){let r=e,a=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let s=r.clientWaitSync(a,0,0);return s===r.ALREADY_SIGNALED||s===r.CONDITION_SATISFIED},t=a}else _e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(t,_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:t,isFencePassed:n}}downloadMatrixFromPackedTexture(e,t,n){return this.downloadMatrixDriver(e,()=>F9(this.gl,t,n))}createProgram(e){this.throwIfDisposed();let t=this.gl;this.vertexShader==null&&(this.vertexShader=w9(t));let n=YG(t);st(t,()=>t.attachShader(n,this.vertexShader)),st(t,()=>t.attachShader(n,e)),XG(t,n);let r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&Dw(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);let t=this.gl;st(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),T9(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(st(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Dw(this.gl,this.program),st(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,n=!0){return this.throwIfDisposed(),n?r9(this.gl,e,t):a9(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),st(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),s9(this.gl,e,t,n)}setOutputMatrixTexture(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}setOutputPackedMatrixTexture(e,t,n){this.throwIfDisposed();let[r,a]=Qg(t,n);this.setOutputMatrixTextureDriver(e,r,a)}setOutputMatrixWriteRegion(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Dw(this.gl,this.program),Xx(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}st(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),st(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Yx(this.gl,_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.createQuery();return n.beginQuery(r.TIME_ELAPSED_EXT,a),a}let e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await E.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){let n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),r=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){let e=U3e(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){let{resolveFn:n}=this.itemsToPoll[t];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in _e().platform&&(n=_e().platform.setTimeoutCustom.bind(_e().platform)),E.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Mw(this.gl,e,this.framebuffer),this.debug&&Xx(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Mw(this.gl,this.outputTexture,this.framebuffer),this.debug&&Xx(this.gl)):b_(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);let n=t();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,t,n){this.throwIfDisposed();let r=this.gl;Mw(r,e,this.framebuffer),this.debug&&Xx(r),this.outputTexture=e,st(r,()=>r.viewport(0,0,t,n)),st(r,()=>r.scissor(0,0,t,n))}setOutputMatrixWriteRegionDriver(e,t,n,r){this.throwIfDisposed(),st(this.gl,()=>this.gl.scissor(e,t,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function U3e(e){let t=0;for(;t<e.length&&e[t]();++t);return t-1}var{addImpl:V3e,bincountImpl:P9,bincountReduceImpl:H3e,bitwiseAndImpl:G3e,castImpl:q3e,ceilImpl:K3e,concatImpl:Y3e,equalImpl:X3e,expImpl:Z3e,expm1Impl:Q3e,floorImpl:J3e,gatherNdImpl:eFe,gatherV2Impl:tFe,greaterImpl:nFe,greaterEqualImpl:rFe,lessImpl:aFe,lessEqualImpl:sFe,linSpaceImpl:iFe,logImpl:oFe,maxImpl:lFe,maximumImpl:cFe,minimumImpl:uFe,multiplyImpl:dFe,negImpl:hFe,notEqualImpl:pFe,prodImpl:mFe,raggedGatherImpl:fFe,raggedRangeImpl:gFe,raggedTensorToTensorImpl:xFe,rangeImpl:yFe,rsqrtImpl:bFe,scatterImpl:vFe,sigmoidImpl:wFe,simpleAbsImpl:O9,sliceImpl:NFe,sparseFillEmptyRowsImpl:kFe,sparseReshapeImpl:SFe,sparseSegmentReductionImpl:L9,sqrtImpl:CFe,staticRegexReplaceImpl:_Fe,stridedSliceImpl:jFe,stringNGramsImpl:IFe,stringSplitImpl:TFe,stringToHashBucketFastImpl:EFe,subImpl:AFe,tileImpl:RFe,topKImpl:DFe,transposeImpl:iR,uniqueImpl:MFe}=MA;function z9(e,t){return["x","y","z","w","u","v"].slice(0,t).map(n=>`${e}.${n}`)}function Ya(e,t){return t===1?[e]:z9(e,t)}function $Fe(e,t){if(e===1)return"rc";let n="";for(let r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}var FFe=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Ha(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let t=Ya("rc",this.rank),n=fr(this.rank),r=this.getOutOfBoundsCondition(t),a=this.getSetup(t),s=this.getOutput(t);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${a}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(e){let t=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let a=`${n===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)a=`${e[e.length-1-s]},`+a;t.push(a)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let n=this.rank-2;n<this.rank;n++)t+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";let t=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){let t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}},B9=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length);let n="";for(let r=0;r<4;r++){let a="thisRC = rc;";r%2===1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),n+=`
        ${a}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${PFe(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?JA():QA(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function PFe(e,t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${t?Z$e(["r","c","d"],"inputShape"):Xp(["r","c","d"],e)}
      return ivec3(r, c, d);
    }
  `}var OFe=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,n){let r=UF(t,n),a=VF(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);let s=WF(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[a].pop();return this.usedTextures[a].push(l),l}let o;return r===$a.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===$a.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===$a.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===$a.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===$a.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),o}releaseTexture(e,t,n,r){if(this.freeTextures==null)return;let a=UF(n,r),s=VF(t,a,r);s in this.freeTextures||(this.freeTextures[s]=[]);let o=WF(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=_e().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[s].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;let c=this.usedTextures[s],d=c&&c.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[d]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function LFe(e,t){let n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error(`Unknown internal format ${t}`)}function WF(e,t,n,r,a){let s=zFe(t,r),o;if(a){let[c,d]=Qg(e[0],e[1]);o=c*d}else{let[c,d]=yv(e[0],e[1]);o=c*d}let l=LFe(n,s);return o*l}function zFe(e,t){switch(e){case $a.PACKED_2X2_FLOAT32:return aR(t);case $a.PACKED_2X2_FLOAT16:return sR(t);case $a.UNPACKED_FLOAT32:return tR(t);case $a.UNPACKED_FLOAT16:return nR(t);case $a.PACKED_4X1_UNSIGNED_BYTE:return rR(t);default:throw new Error(`Unknown physical texture type ${e}`)}}function BFe(e){return _e().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?$a.PACKED_2X2_FLOAT32:$a.UNPACKED_FLOAT32:e?$a.PACKED_2X2_FLOAT16:$a.UNPACKED_FLOAT16}function UF(e,t){if(e===oi.UPLOAD)return $a.PACKED_2X2_FLOAT32;if(e===oi.RENDER||e==null)return BFe(t);if(e===oi.DOWNLOAD||e===oi.PIXELS)return $a.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${e}`)}function VF(e,t,n){return`${e[0]}_${e[1]}_${t}_${n}`}var Xo=class{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},qi="if (isnan(x)) return x;",WFe="return x;",HF="return abs(x);",UFe="return (x >= 0.0) ? x : (exp(x) - 1.0);",VFe=qi+`
  return (x < 0.0) ? 0.0 : x;
`,HFe=qi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,kc="return x;",GFe="return 1.0 / (1.0 + exp(-1.0 * x));",qFe="return x;",KFe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,YFe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XFe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZFe="return 1.0 / (1.0 + exp(-1.0 * x));",Wc=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}},QFe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length);let t=e.length,n=Ya("rc",t),r=fr(t),a=$Fe(t,n),s=n.slice(-2),o=t<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${a});

        setOutput(getChannel(packedInput, ${o}));
      }
    `}},JFe=gl.whereImpl,ePe=1e-7,tPe=1e-4,JS={};function nPe(e){return e in JS||(JS[e]={}),JS[e]}var rPe=_e().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),aPe=600;function sPe(){return _e().global.screen==null?1024:_e().global.screen.height*_e().global.screen.width*window.devicePixelRatio*aPe/1024/1024}var oR=class W9 extends vb{nextDataId(){return W9.nextDataId++}constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!_e().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(t!=null){if(t instanceof Pw)n=t;else{let r=Co(_e().getNumber("WEBGL_VERSION"),t);n=new Pw(r)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let r=Co(_e().getNumber("WEBGL_VERSION"));n=new Pw(r),this.binaryCache=nPe(_e().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new OFe(this.gpgpu),this.numMBBeforeWarning=sPe(),this.texData=new $1(this,Ti())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(t,n,r,a,s,o){let l=this.makeTensorInfo(n,r),c=this.texData.get(l.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[a,s]},c.texShape=[a,s];let d=Zx(n),u=new BF(d,!1,o),h=this.runWebGLProgram(u,[l],r,[[a,s]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(l),h.dataId}write(t,n,r){if((_e().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||_e().getBool("DEBUG"))&&this.checkNumericalProblems(t),r==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let a={id:this.nextDataId()};return this.texData.set(a,{shape:n,dtype:r,values:t,usage:oi.UPLOAD,refCount:1}),a}refCount(t){return this.texData.has(t)?this.texData.get(t).refCount:0}incRef(t){let n=this.texData.get(t);n.refCount++}decRef(t){if(this.texData.has(t)){let n=this.texData.get(t);n.refCount--}}move(t,n,r,a,s){if(_e().getBool("DEBUG")&&this.checkNumericalProblems(n),a==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:r,dtype:a,values:n,usage:oi.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(t){this.disposeData(t.dataId)}readSync(t){let n=this.texData.get(t),{values:r,dtype:a,complexTensorInfos:s,slice:o,shape:l,isPacked:c}=n;if(o!=null){let p;c?p=new Wc(l,kc):p=new Xo(l,kc);let m=this.runWebGLProgram(p,[{dataId:t,shape:l,dtype:a}],a),f=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),f}if(r!=null)return this.convertAndCacheOnCPU(t);if(a==="string")return r;let d=this.activeTimers!=null,u;d&&(u=E.now());let h;if(a==="complex64"){let p=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);h=z.mergeRealAndImagArrays(p,m)}else h=this.getValuesFromTexture(t);return d&&(this.downloadWaitMs+=E.now()-u),this.convertAndCacheOnCPU(t,h)}async read(t){if(this.pendingRead.has(t)){let f=this.pendingRead.get(t);return new Promise(g=>f.push(g))}let n=this.texData.get(t),{values:r,shape:a,slice:s,dtype:o,complexTensorInfos:l,isPacked:c}=n;if(s!=null){let f;c?f=new Wc(a,kc):f=new Xo(a,kc);let g=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:o}],o),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(r!=null)return this.convertAndCacheOnCPU(t);if(_e().getBool("DEBUG")&&!_e().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&_e().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let d=null,u;if(o!=="complex64"&&_e().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);let f=this.texData.get(u.dataId);d=this.gpgpu.createBufferFromTexture(f.texture.texture,...lw(a))}this.pendingRead.set(t,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){let f=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=f[0],x=f[1];h=z.mergeRealAndImagArrays(g,x)}else if(d==null)h=this.getValuesFromTexture(t);else{let f=E.sizeFromShape(a);h=this.gpgpu.downloadFloat32MatrixFromBuffer(d,f)}if(u!=null&&this.disposeIntermediateTensorInfo(u),d!=null){let f=this.gpgpu.gl;st(f,()=>f.deleteBuffer(d))}let p=this.convertAndCacheOnCPU(t,h),m=this.pendingRead.get(t);return this.pendingRead.delete(t),m.forEach(f=>f(p)),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Ti().removeDataId(t,this),this.pendingDeletes--),p}readToGPU(t,n={}){let r=this.texData.get(t),{values:a,shape:s,slice:o,dtype:l,isPacked:c,texture:d}=r;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let m;c?m=new Wc(s,kc):m=new Xo(s,kc);let f=this.runWebGLProgram(m,[{dataId:t,shape:s,dtype:l}],l),g=this.readToGPU(f,n);return this.disposeIntermediateTensorInfo(f),g}if(d==null)throw a!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let u=this.decode(t,n.customTexShape),h=Ti().makeTensorFromTensorInfo(u),p=this.texData.get(u.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(t){let n=this.readSync(t.dataId);if(t.dtype==="string")try{let r=n.map(a=>E.decodeString(a));return pn(t.shape,t.dtype,r)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return pn(t.shape,t.dtype,n)}checkNumericalProblems(t){if(t!=null)for(let n=0;n<t.length;n++){let r=t[n];if(!HG(r))throw _e().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${r} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${r} cannot be represented on this device.`)}}getValuesFromTexture(t){let{shape:n,dtype:r,isPacked:a}=this.texData.get(t),s=E.sizeFromShape(n);if(_e().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let p=this.decode(t),m=this.texData.get(p.dataId),f=this.gpgpu.downloadMatrixFromPackedTexture(m.texture.texture,...lw(n)).subarray(0,s);return this.disposeIntermediateTensorInfo(p),f}let o=_e().getBool("WEBGL_PACK")&&a===!0,l=o?Zx(n):n,c=o?new z3e(l):new L3e(l),d=this.runWebGLProgram(c,[{shape:l,dtype:r,dataId:t}],"float32"),u=this.texData.get(d.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(d),h}timerAvailable(){return _e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(t){let n=this.activeTimers,r=[],a=!1;this.programTimersStack==null?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t();let s=E.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=E.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=n,a&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=E.sum(c),l.getExtraProfileInfo=()=>c.map((d,u)=>({name:o[u],ms:d})).map(d=>`${d.name}: ${d.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return _e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:E.now(),endMs:null}}endTimer(t){return _e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=E.now(),t)}async getQueryTime(t){if(_e().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);let n=t;return n.endMs-n.startMs}disposeData(t,n=!1){if(this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);let{complexTensorInfos:r}=this.texData.get(t);return r!=null&&(this.disposeData(r.real.dataId,n),this.disposeData(r.imag.dataId,n)),this.texData.delete(t),!0}releaseGPUData(t){let{texture:n,dtype:r,texShape:a,usage:s,isPacked:o,slice:l}=this.texData.get(t),c=l&&l.origDataId||t,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),n!=null&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,s,o)));let u=this.texData.get(t);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture}getDataInfo(t){return this.texData.get(t)}shouldExecuteOnCPU(t,n=rPe){return _e().getBool("WEBGL_CPU_FORWARD")&&t.every(r=>this.texData.get(r.dataId).texture==null&&E.sizeFromShape(r.shape)<n)}getGPGPUContext(){return this.gpgpu}where(t){z.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let n=t.dataSync();return JFe(t.shape,n)}packedUnaryOp(t,n,r){let a=new Wc(t.shape,n),s=this.compileAndRun(a,[t],r);return Ti().makeTensorFromTensorInfo(s)}abs(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){let a=O9(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,a)}if(_e().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,HF,t.dtype);let n=new Xo(t.shape,HF),r=this.compileAndRun(n,[t]);return Ti().makeTensorFromTensorInfo(r)}makeTensorInfo(t,n,r){let a;if(n==="string"&&r!=null&&r.length>0&&E.isString(r[0])){let s=r.map(o=>E.encodeString(o));a=this.write(s,t,n)}else a=this.write(r,t,n);return this.texData.get(a).usage=null,{dataId:a,shape:t,dtype:n}}makeOutput(t,n,r){return Ti().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,r),this)}unpackTensor(t){let n=new QFe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)}packTensor(t){let n=new FFe(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)}packedReshape(t,n){let r=[gh(t.shape),...xh(t.shape)],a={dtype:t.dtype,shape:r,dataId:t.dataId},s=[gh(n),...xh(n)],o=new B9(s,r),l=!0,c=[r],d=this.runWebGLProgram(o,[a],t.dtype,c,l);return{dataId:d.dataId,shape:n,dtype:d.dtype}}decode(t,n){let r=this.texData.get(t),{isPacked:a,shape:s,dtype:o}=r;if(n!=null){let p=E.sizeFromShape(s),m=n[0]*n[1]*4;E.assert(p<=m,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let l=Zx(s),c;a?c=new O3e(l):c=new P3e(l);let d=!0,u=[n??lw(l)],h=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:t}],o,u,d,n);return{dtype:o,shape:s,dataId:h.dataId}}runWebGLProgram(t,n,r,a,s=!1,o){let l=this.makeTensorInfo(t.outputShape,r),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===Ky.DENSE){let y=o??lw(t.outputShape);c.texShape=y.map(b=>b*2)}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),E.sizeFromShape(l.shape)===0)return c.values=E.getTypedArrayFromDType(l.dtype,0),l;let d=[],u=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(y.dataId);if(b.texture==null){if(!t.packedInputs&&E.sizeFromShape(y.shape)<=_e().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!b.isPacked!=!!t.packedInputs)y=b.isPacked?this.unpackTensor(y):this.packTensor(y),d.push(y),b=this.texData.get(y.dataId);else if(b.isPacked&&!Yy(b.shape,y.shape)){let v=y,w=y.shape;y.shape=b.shape,y=this.packedReshape(y,w),d.push(y),b=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:b,isUniform:!1}});this.uploadToGPU(l.dataId);let h={shape:l.shape,texData:c,isUniform:!1},p=F3e(t,u,h),m=this.getAndSaveBinary(p,()=>M3e(this.gpgpu,t,u,h)),f=this.activeTimers!=null,g;f&&(g=this.startTimer()),_e().get("ENGINE_COMPILE_ONLY")||$3e(this.gpgpu,m,u,h,a),d.forEach(y=>this.disposeIntermediateTensorInfo(y)),f&&(g=this.endTimer(g),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(g)}));let x=_e().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){let y=E.now();y-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!_e().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&s===!1){let y=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),y}return l}compileAndRun(t,n,r,a,s=!1){return r=r||n[0].dtype,this.runWebGLProgram(t,n,r,a,s)}getAndSaveBinary(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(_e().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=fe(()=>{if(!_e().get("WEBGL_RENDER_FLOAT32_ENABLED")){let t=_e().getBool("DEBUG");_e().set("DEBUG",!1);let n=this.abs(Rt(1e-8)).dataSync()[0];if(_e().set("DEBUG",t),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?ePe:tPe}uploadToGPU(t){let n=this.texData.get(t),{shape:r,dtype:a,values:s,texture:o,usage:l,isPacked:c}=n;if(o!=null)return;let d=this.activeTimers!=null,u;d&&(u=E.now());let h=n.texShape;if(h==null&&(h=l9(r,c),n.texShape=h),s!=null){let p=Zx(r),m,f=h[1],g=h[0],x=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(c||!x)&&([f,g]=Qg(h[0],h[1])),c?m=new W3e(p,x):m=new BF(p,x);let y=x?[g,f]:h,b=this.makeTensorInfo(y,a),v=this.texData.get(b.dataId);x?v.usage=oi.PIXELS:v.usage=oi.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),f,g,s);let w=[[g,f]],k=this.runWebGLProgram(m,[b],a,w,!0),C=this.texData.get(k.dataId);n.texShape=C.texShape,n.isPacked=C.isPacked,n.usage=C.usage,_e().get("ENGINE_COMPILE_ONLY")?this.disposeData(k.dataId):(n.texture=C.texture,n.values=null,this.texData.delete(k.dataId)),this.disposeIntermediateTensorInfo(b),d&&(this.uploadWaitMs+=E.now()-u)}else{let p=this.acquireTexture(h,l,a,c);n.texture=p}}convertAndCacheOnCPU(t,n){let r=this.texData.get(t),{dtype:a}=r;return n!=null&&(r.values=iPe(n,a)),r.values}acquireTexture(t,n,r,a){if(this.numBytesInGPU+=this.computeBytes(t,r),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,n,a)}computeBytes(t,n){return t[0]*t[1]*E.bytesPerElement(n)}checkCompileCompletion(){for(let[,t]of Object.entries(this.binaryCache))this.checkCompletion_(t)}async checkCompileCompletionAsync(){let t=[];if(this.gpgpu.parallelCompilationExtension){for(let[,n]of Object.entries(this.binaryCache))t.push(this.checkCompletionAsync_(n));return Promise.all(t)}else{for(let[,n]of Object.entries(this.binaryCache)){let r=new Promise(a=>{try{this.checkCompletion_(n),a(!0)}catch(s){throw s}});t.push(r)}return Promise.all(t)}}async checkCompletionAsync_(t){return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(t):(await XT(),this.checkCompletionAsync_(t))}checkCompletion_(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(ZA(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let t of Object.values(this.binaryCache)){this.gpgpu.buildVao(t.webGLProgram);let{variablesLocations:n,customUniformLocations:r,infLoc:a,nanLoc:s,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:c}=b9(this.gpgpu,t.program,t.webGLProgram);t.variablesLocations=n,t.customUniformLocations=r,t.infLoc=a,t.nanLoc=s,t.outShapeLocation=o,t.outShapeStridesLocation=l,t.outTexShapeLocation=c}}createTensorFromGPUData(t,n,r){t.channels=t.channels||"RGBA";let{texture:a,height:s,width:o,channels:l}=t,c=Ti().backend;if(!c.gpgpu.gl.isTexture(a))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let d=c.writeTexture(a,n,r,s,o,l);return Ti().makeTensorFromDataId(d,n,r,c)}};oR.nextDataId=0;function iPe(e,t){if(t==="float32"||t==="complex64")return e;if(t==="int32"||t==="bool"){let n=t==="int32"?new Int32Array(e.length):new Uint8Array(e.length);for(let r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}else throw new Error(`Unknown dtype ${t}`)}var oPe="4.22.0";function U9(){_e().set("WEBGL_FORCE_F16_TEXTURES",!0)}Gb.isBrowser()&&J1("webgl",()=>new oR,2);var lPe={forceHalfFloat:U9},lR=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,yh=class{constructor(e,t,n){this.variableNames=["A","B"],this.outputShape=z.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Ha(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}},Qp=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,ax=class{constructor(e,t,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=z.assertAndGetBroadcastShape(t,n);let a=this.outputShape.length;this.enableShapeUniforms=Ha(a);let s="";if(r)if(a===0||E.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${fr(a)} coords = getOutputCoords();
        `,a===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let o=Ya("coords",a);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${o[a-2]} + 1) >= outShape[${a} - 2];
            bool nextColOutOfBounds =
              (${o[a-1]} + 1) >= outShape[${a} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${o[a-2]} + 1) >= ${this.outputShape[a-2]};
            bool nextColOutOfBounds =
              (${o[a-1]} + 1) >= ${this.outputShape[a-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function Xs(e){let{inputs:t,backend:n}=e,{x:r}=t;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var cPe={kernelName:ep,backendName:"webgl",kernelFunc:Xs};function Fu(e){let{inputs:t,backend:n}=e,{real:r,imag:a}=t,s=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(s.dataId),l=Xs({inputs:{x:r},backend:n}),c=Xs({inputs:{x:a},backend:n});return o.complexTensorInfos={real:l,imag:c},s}var uPe={kernelName:O1,backendName:"webgl",kernelFunc:Fu},V9="return (a < 0.) ? b * a : a;",H9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function dPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{alpha:s}=r,o=n.makeTensorInfo([],"float32",E.createScalarValue(s,"float32")),l=_e().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ax(H9,a.shape,o.shape):new yh(V9,a.shape,o.shape),c=n.runWebGLProgram(l,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),c}var hPe={kernelName:ap,backendName:"webgl",kernelFunc:dPe},G9="return (a < 0.) ? b * a : a;",q9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function pPe(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=_e().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ax(q9,r.shape,a.shape):new yh(G9,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],"float32")}var mPe={kernelName:vp,backendName:"webgl",kernelFunc:pPe},sx="if (isnan(x)) return x;";function Bn({opSnippet:e,packedOpSnippet:t,cpuKernelImpl:n,dtype:r}){return({inputs:a,backend:s})=>{let{x:o}=a,l=s,c=r||o.dtype;if(l.shouldExecuteOnCPU([o])&&n!=null){let h=l.texData.get(o.dataId),p=n(h.values,c);return l.makeTensorInfo(o.shape,c,p)}let d=_e().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,u;return d?u=new Wc(o.shape,t):u=new Xo(o.shape,e),l.runWebGLProgram(u,[o],c)}}function Oa({opSnippet:e,packedOpSnippet:t,checkOutOfBounds:n=!1,supportsComplex:r=!1,cpuKernelImpl:a,dtype:s}){return({inputs:o,backend:l})=>{let{a:c,b:d}=o,u=l;if(r&&c.dtype==="complex64"){let f=u.texData.get(c.dataId),g=u.texData.get(d.dataId),[x,y]=[[f.complexTensorInfos.real,g.complexTensorInfos.real],[f.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(v=>{let[w,k]=v,C={dataId:w.dataId,dtype:w.dtype,shape:c.shape},S={dataId:k.dataId,dtype:k.dtype,shape:d.shape},_=new yh(e,c.shape,d.shape);return u.runWebGLProgram(_,[C,S],mi(w.dtype,k.dtype))}),b=Fu({inputs:{real:x,imag:y},backend:u});return u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(y),b}let h=s||mi(c.dtype,d.dtype);if((c.dtype==="string"||d.dtype==="string"||u.shouldExecuteOnCPU([c,d]))&&a!=null){let f=u.texData.get(c.dataId).values,g=u.texData.get(d.dataId).values,x=c.dtype==="string"?z.fromUint8ToStringArray(f):f,y=c.dtype==="string"?z.fromUint8ToStringArray(g):g,[b,v]=a(c.shape,d.shape,x,y,h),w=u.makeTensorInfo(v,h),k=u.texData.get(w.dataId);return k.values=b,w}let p=_e().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,m;return p?m=new ax(t,c.shape,d.shape,n):m=new yh(e,c.shape,d.shape),u.runWebGLProgram(m,[c,d],h)}}function Xy(e,t=!1){if(e==="linear")return t?qFe:WFe;if(e==="relu")return t?YFe:VFe;if(e==="elu")return t?KFe:UFe;if(e==="relu6")return t?XFe:HFe;if(e==="prelu")return t?q9:G9;if(e==="leakyrelu")return t?H9:V9;if(e==="sigmoid")return t?ZFe:GFe;throw new Error(`Activation ${e} has not been implemented for the WebGL backend.`)}var K9=class{constructor(e,t,n,r=!1,a=!1,s=!1,o=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Ha(this.outputShape.length);let d=r?e[1]:e[2],u=Math.ceil(d/2),h=r?"i * 2, rc.y":"rc.y, i * 2",p=a?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=a?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";o&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${o}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${o}
        }`:g=`vec4 activation(vec4 x) {
          ${o}
        }`,x="result = activation(result);");let y=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<t[0]?b=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(v=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${u}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${v};
        for (int i = 0; i < ${u}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${p});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${f[0]});
          result += (${m[1]} * ${f[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${x}

        setOutput(result);
      }
    `}},GF={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},qF=class{constructor(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=z.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}},KF="return a * b;";function cR(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=z.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){let l=n.texData.get(r.dataId),c=n.texData.get(a.dataId),d=new qF(GF.REAL,r.shape,a.shape),u=new qF(GF.IMAG,r.shape,a.shape),h=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:a.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:a.shape}],p=n.runWebGLProgram(d,h,"float32"),m=n.runWebGLProgram(u,h,"float32"),f=Fu({inputs:{real:p,imag:m},backend:n});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}if(n.shouldExecuteOnCPU([r,a])){let l=n.texData.get(r.dataId),c=n.texData.get(a.dataId),[d,u]=dFe(r.shape,a.shape,l.values,c.values,s),h=n.makeTensorInfo(u,s),p=n.texData.get(h.dataId);return p.values=d,h}let o;return _e().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new ax(KF,r.shape,a.shape):o=new yh(KF,r.shape,a.shape),n.runWebGLProgram(o,[r,a],s)}var fPe={kernelName:gp,backendName:"webgl",kernelFunc:cR};function gPe(e,t,n){let r=[gh(e.shape),...xh(e.shape)],a={dtype:e.dtype,shape:r,dataId:e.dataId},s=[gh(t),...xh(t)],o=new B9(s,r),l=!0,c=[r],d=n.runWebGLProgram(o,[a],e.dtype,c,l);return{dataId:d.dataId,shape:t,dtype:d.dtype}}function nt(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{shape:s}=r,o=n,l=E.sizeFromShape(a.shape),c=E.inferFromImplicitShape(s,l),d=E.sizeFromShape(c);E.assert(l===d,()=>`The new shape (${c}) has ${d} elements and the old shape (${a.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);let u=o.texData.get(a.dataId);return u.isPacked&&!Yy(a.shape,c)&&!(u.texture!==null&&Yy(u.shape,c))?gPe(a,c,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype})}var xPe={kernelName:kg,backendName:"webgl",kernelFunc:nt},YF=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let o=Math.floor(n/4)*4,l=n%4,c="sumValue += dot(values, ones);";if(t!=null){let u=1/t;c=`sumValue += dot(values * ${E.isInt(u)?u.toPrecision(2):u}, ones);`}let d="";a%n>0&&(d=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${o}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${o};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}},yPe=class{constructor(e,t){this.variableNames=["x"];let{windowSize:n,batchSize:r,inSize:a,outSize:s}=e;this.outputShape=[r,s];let o="0.0",l="";t==="prod"?o="1.0":t==="min"?(o="1.0 / 1e-20",l="min"):t==="max"&&(o="-1.0 / 1e-20",l="max");let c=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");let d=Math.floor(n/4)*4,u=n%4,h=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(o="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(o="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");let m="";a%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${o};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${o});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${d};
        if (${u===1}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${u===2}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${u===3}) {
          ${p} values = ${p}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}};function bPe(e){let t=[];for(;t.length===0||t[t.length-1].outSize!==1;){let n=t.length?t[t.length-1].outSize:e[1],r=z.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}function Jp(e,t,n,r){let a=bPe(e.shape),s=e;for(let o=0;o<a.length;o++){let{inSize:l,windowSize:c,outSize:d}=a[o],u,h;n==="mean"?u=o===0?new YF({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:d},l):new YF({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:d}):u=new yPe({windowSize:c,inSize:l,batchSize:e.shape[0],outSize:d},n),h=s,s=r.runWebGLProgram(u,[s],t),h.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(h)}return s}var vPe=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[t[s]];this.outputShape=n,this.rank=n.length;let r=fr(this.rank),a=wPe(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${a}));
    }
    `}};function wPe(e){let t=e.length;if(t>6)throw Error(`Transpose for rank ${t} is not yet supported`);let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t);for(let a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}var NPe=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let d=0;d<n.length;d++)n[d]=e[t[d]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let r=fr(this.rank),a=z9("rc",this.rank),s=new Array(this.rank);for(let d=0;d<t.length;d++)s[t[d]]=a[d];let o=`vec2(${s.slice(-2).join()})`,l=`++${a[this.rank-1]} < ${n[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${o})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${a[this.rank-1]};
      if(++${a[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function ak(e,t,n){let r=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NPe(e.shape,t):new vPe(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function kPe(e,t,n,r){let a=t,s=e.shape.length,o=E.parseAxisParam(a,e.shape),l=o,c=z.getAxesPermutation(l,s),d=c!=null,u=e;d&&(u=ak(e,c,r),l=z.getInnerMostAxes(l.length,s)),z.assertAxesAreInnerMostDims("sum",l,s);let[h,p]=z.computeOutAndReduceShapes(u.shape,l),m=h;n&&(m=z.expandShapeToKeepDim(h,o));let f=E.sizeFromShape(p),g=E.sizeFromShape(e.shape)/f,x=nt({inputs:{x:u},attrs:{shape:[g,f]},backend:r}),y=Q1(e.dtype),b=Jp(x,y,"sum",r),v=nt({inputs:{x:b},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(b),d&&r.disposeIntermediateTensorInfo(u),v}function sk(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r;return kPe(a,s,o,n)}var SPe={kernelName:Pp,backendName:"webgl",kernelFunc:sk};function es(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{perm:s}=r,o=n,l=a.shape.length,c=new Array(l);for(let u=0;u<c.length;u++)c[u]=a.shape[s[u]];let d;if(o.shouldExecuteOnCPU([a])){let u=o.texData.get(a.dataId).values,h=iR(u,a.shape,a.dtype,s,c);d=o.makeTensorInfo(c,a.dtype);let p=o.texData.get(d.dataId);p.values=h}else d=ak(a,s,o);return d}var CPe={kernelName:Fl,backendName:"webgl",kernelFunc:es},Y9=1e3;function r1({a:e,b:t,transposeA:n,transposeB:r,backend:a,bias:s=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}){let d=e.shape.length,u=t.shape.length,h=n?e.shape[d-2]:e.shape[d-1],p=r?t.shape[u-1]:t.shape[u-2],m=n?e.shape[d-1]:e.shape[d-2],f=r?t.shape[u-2]:t.shape[u-1],g=e.shape.slice(0,-2),x=t.shape.slice(0,-2),y=E.sizeFromShape(g),b=E.sizeFromShape(x),v=Bg.assertAndGetBroadcastShape(e.shape.slice(0,-2),t.shape.slice(0,-2)).concat([m,f]);E.assert(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${e.shape} and ${t.shape} and transposeA=${n} and transposeB=${r} must match.`);let w=n?[y,h,m]:[y,m,h],k=r?[b,f,p]:[b,p,f],C=nt({inputs:{x:e},backend:a,attrs:{shape:w}}),S=nt({inputs:{x:t},backend:a,attrs:{shape:k}}),_=[C,S],I=Math.max(y,b),T=n?C.shape[1]:C.shape[2],A=s!=null,j=o!=null,D=c==="leakyrelu",F=c!=null?Xy(c,!0):null,B=A||j||D||F!=null,q;if((m===1||f===1)&&T>Y9&&B===!1){let L=C,M=S;n&&(L=es({inputs:{x:C},backend:a,attrs:{perm:[0,2,1]}}),_.push(L)),r&&(M=es({inputs:{x:S},backend:a,attrs:{perm:[0,2,1]}}),_.push(M));let X=f!==1,G=f===1,W=L;X&&(W=nt({inputs:{x:L},backend:a,attrs:{shape:[I,T,1]}}),_.push(W));let O=f===1?2:1,U=M;G&&(U=nt({inputs:{x:M},backend:a,attrs:{shape:[I,1,T]}}),_.push(U));let K=cR({inputs:{a:W,b:U},backend:a});q=sk({inputs:{x:K},backend:a,attrs:{axis:O,keepDims:!0}}),_.push(K)}else{let L=mi(e.dtype,t.dtype),M=new K9(w,k,[I,m,f],n,r,A,F,j,D),X=[C,S];if(s!=null&&X.push(s),j&&X.push(o),D){let G=a.makeTensorInfo([],"float32",E.createScalarValue(l,"float32"));X.push(G),_.push(G)}q=a.runWebGLProgram(M,X,L)}let $=nt({inputs:{x:q},backend:a,attrs:{shape:v}});_.push(q);for(let L of _)a.disposeIntermediateTensorInfo(L);return $}function _Pe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:o,preluActivationWeights:l}=t,{transposeA:c,transposeB:d,activation:u,leakyreluAlpha:h}=r;return r1({a,b:s,transposeA:c,transposeB:d,backend:n,bias:o,preluActivationWeights:l,leakyreluAlpha:h,activation:u})}var jPe={kernelName:th,backendName:"webgl",kernelFunc:_Pe},XF="return abs(x);";function IPe(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let s=n.texData.get(r.dataId),o=O9(s.values);return n.makeTensorInfo(r.shape,r.dtype,o)}let a;return _e().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Wc(r.shape,XF):a=new Xo(r.shape,XF),n.runWebGLProgram(a,[r],r.dtype)}var TPe={kernelName:Lf,backendName:"webgl",kernelFunc:IPe},EPe=qi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,APe=Bn({opSnippet:EPe}),RPe={kernelName:Ch,backendName:"webgl",kernelFunc:APe},DPe=qi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,MPe=Bn({opSnippet:DPe}),$Pe={kernelName:_h,backendName:"webgl",kernelFunc:MPe},ZF="return a + b;",FPe=Oa({opSnippet:ZF,packedOpSnippet:ZF,supportsComplex:!0,cpuKernelImpl:V3e}),PPe={kernelName:_u,backendName:"webgl",kernelFunc:FPe},OPe=class{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`float v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}},LPe=class{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((a,s)=>`T${s}`);let n=[];this.variableNames.forEach(a=>{n.push(`vec4 v${a} = get${a}AtOutCoords();`)});let r=this.variableNames.map(a=>`v${a}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}};function Ow(e){let{inputs:t,backend:n}=e,r=t;if(r.length===1)return Xs({inputs:{x:r[0]},backend:n});if(r.length>_e().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=Ow({inputs:r.slice(0,l),backend:n}),d=Ow({inputs:r.slice(l),backend:n});return Ow({inputs:[c,d],backend:n})}let a=r.map(l=>l.dtype).reduce((l,c)=>mi(l,c)),s=r.map(l=>l.shape),o=_e().getBool("WEBGL_PACK")?new LPe(r[0].shape,s):new OPe(r[0].shape,s);return n.runWebGLProgram(o,r,a)}var zPe={kernelName:jh,backendName:"webgl",kernelFunc:Ow};function BPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r,l=a.shape.length,c=E.parseAxisParam(s,a.shape),d=c,u=z.getAxesPermutation(d,l),h=a;u!=null&&(h=es({inputs:{x:a},backend:n,attrs:{perm:u}}),d=z.getInnerMostAxes(d.length,l)),z.assertAxesAreInnerMostDims("all",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=E.sizeFromShape(m),g=nt({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=Jp(g,g.dtype,"all",n),y;if(o){let b=z.expandShapeToKeepDim(p,c);y=nt({inputs:{x},backend:n,attrs:{shape:b}})}else y=nt({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(h),y}var WPe={kernelName:zf,backendName:"webgl",kernelFunc:BPe};function UPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r,l=a.shape.length,c=E.parseAxisParam(s,a.shape),d=c,u=z.getAxesPermutation(d,l),h=a;u!=null&&(h=es({inputs:{x:a},backend:n,attrs:{perm:u}}),d=z.getInnerMostAxes(d.length,l)),z.assertAxesAreInnerMostDims("any",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=E.sizeFromShape(m),g=nt({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=Jp(g,g.dtype,"any",n),y;if(o){let b=z.expandShapeToKeepDim(p,c);y=nt({inputs:{x},backend:n,attrs:{shape:b}})}else y=nt({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(h),y}var VPe={kernelName:Bf,backendName:"webgl",kernelFunc:UPe},HPe=class{constructor(e,t,n){this.variableNames=["A"];let{windowSize:r,batchSize:a,outSize:s}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[a,s];let o=t==="max"?">":"<",l=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${o} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}},GPe=class{constructor(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let a=e[e.length-1],s=Math.ceil(a/t);this.outputShape=e.slice(0,-1),s>1&&this.outputShape.push(s),r||this.variableNames.push("bestIndicesA");let o=this.outputShape,l=o.length,c=fr(l),d=Ya("coords",l),u,h;if(s===1){h=l+1;let S=fr(h);u=`
        ${S} sourceLocR = ${S}(${d.join()}, 0);
        ++${d[l-1]};
        ${S} sourceLocG = ${S}(${d.join()}, 0);
        ++${d[l-2]};
        ${S} sourceLocA = ${S}(${d.join()}, 0);
        --${d[l-1]};
        ${S} sourceLocB = ${S}(${d.join()}, 0);
        --${d[l-2]};`}else h=l,u=`
        ${c} sourceLocR = coords;
        ++${d[l-1]};
        ${c} sourceLocG = coords;
        ++${d[l-2]};
        ${c} sourceLocA = coords;
        --${d[l-1]};
        ${c} sourceLocB = coords;
        --${d[l-2]};`;let p=["x","y","z","w","u","v"].slice(0,h),m="."+p[h-1],f=p.map(S=>"int "+S),g=Ya("sourceLocR",h-1).concat("inIdx.r"),x=Ya("sourceLocG",h-1).concat("inIdx.g"),y=Ya("sourceLocB",h-1).concat("inIdx.b"),b=Ya("sourceLocA",h-1).concat("inIdx.a"),v=n==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()})));`,k=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${f.join()}) {
        return getChannel(getBestIndicesA(${p.join()}),
                                          vec2(${p.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${f.join()}) {
        return getChannel(getA(${p.join()}),
                               vec2(${p.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${o[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${o[l-2]-1};
        ${u}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${k};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${w}
          vec4 candidate = ${k};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function X9(e,t,n,r=null){let a=t.shape[0],s=t.shape[1];r!=null&&(a=r.shape[0],s=r.shape[1]);let o=z.computeOptimalWindowSize(s),l={windowSize:o,inSize:s,batchSize:a,outSize:Math.ceil(s/o)},c=new HPe(l,n,r==null),d=[t];r!=null&&d.push(r);let u=e.runWebGLProgram(c,d,"int32");if(u.shape[1]===1)return u;let h=X9(e,t,n,u);return e.disposeIntermediateTensorInfo(u),h}function Z9(e,t,n,r=null){let a=r!=null?r.shape:t.shape,s=a[a.length-1],o=z.computeOptimalWindowSize(s),l=new GPe(a,o,n,r==null),c=r==null?[t]:[t,r],d=e.runWebGLProgram(l,c,"int32");if(d.shape.length===t.shape.length){let u=Z9(e,t,n,d);return e.disposeIntermediateTensorInfo(d),u}return d}function Q9(e,t,n,r){let a=[n];if(z.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!_e().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){let s=[],o=e.texData.get(t.dataId),l=o!==null&&o.isPacked,c=t;l&&(c=e.unpackTensor(t),s.push(c));let[d,u]=z.computeOutAndReduceShapes(c.shape,a),h=E.sizeFromShape(u),p=nt({inputs:{x:c},backend:e,attrs:{shape:[-1,h]}});s.push(p);let m=X9(e,p,r);s.push(m);let f=nt({inputs:{x:m},backend:e,attrs:{shape:d}});return s.forEach(g=>e.disposeIntermediateTensorInfo(g)),f}return Z9(e,t,r)}function qPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,o=E.parseAxisParam(s,a.shape),l=z.getAxesPermutation(o,a.shape.length),c=a,d=[];l!=null&&(c=es({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(c),o=z.getInnerMostAxes(o.length,c.shape.length)),z.assertAxesAreInnerMostDims("argMax",[o[0]],c.shape.length);let u=Q9(n,c,o[0],"max");return d.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}var KPe={kernelName:Wf,backendName:"webgl",kernelFunc:qPe};function YPe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s}=r,o=E.parseAxisParam(s,a.shape),l=z.getAxesPermutation(o,a.shape.length),c=a,d=[];l!=null&&(c=es({inputs:{x:a},backend:n,attrs:{perm:l}}),d.push(c),o=z.getInnerMostAxes(o.length,c.shape.length)),z.assertAxesAreInnerMostDims("argMin",[o[0]],c.shape.length);let u=Q9(n,c,o[0],"min");return d.forEach(h=>n.disposeIntermediateTensorInfo(h)),u}var XPe={kernelName:Uf,backendName:"webgl",kernelFunc:YPe},ZPe=qi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,QPe=Bn({opSnippet:ZPe}),JPe={kernelName:Ih,backendName:"webgl",kernelFunc:QPe},eOe=qi+"return log(x + sqrt(x * x + 1.0));",tOe=Bn({opSnippet:eOe}),nOe={kernelName:Th,backendName:"webgl",kernelFunc:tOe},rOe=qi+`
  return atan(x);
`,aOe=Bn({opSnippet:rOe}),sOe={kernelName:Eh,backendName:"webgl",kernelFunc:aOe},iOe=lR+`
  return atan(a, b);
`,oOe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qp+`
  return result;
`,lOe=Oa({opSnippet:iOe,packedOpSnippet:oOe}),cOe={kernelName:Rh,backendName:"webgl",kernelFunc:lOe},uOe=qi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,dOe=Bn({opSnippet:uOe}),hOe={kernelName:Ah,backendName:"webgl",kernelFunc:dOe},Zy=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,o=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,d=e.dilationWidth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;let f=t==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(f||(y="-1.0 / 1e-20"),n){let S=">=";this.userCode=`
        const ivec2 strides = ivec2(${o}, ${l});
        const ivec2 pads = ivec2(${p}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${u};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${S} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?a?g:x:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",v=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(v="avgValue / max(count, 1.0)");let w=Math.floor(s/4)*4,k=s%4,C=`
      if (${f}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${l});
      const ivec2 pads = ivec2(${p}, ${m});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${u};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${w}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${w};
          if (${k===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${k===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${k===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${v});
      }
    `}},uR=class{constructor(e,t,n,r=!1,a=!1){if(this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let s=e.filterWidth,o=e.strideDepth,l=e.strideHeight,c=e.strideWidth,d=e.dilationDepth,u=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,m=e.effectiveFilterHeight,f=e.effectiveFilterWidth,g=e.padInfo.front,x=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b=t==="avg",v="0.0";if(b||(v="-1.0 / 1e-20"),n){let I=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${o}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${x}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${p};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${u}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${f};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${I} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?a?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${f} +
                      wR * ${f} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let w="max",k=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(k="avgValue / max(count, 1.0)");let C=Math.floor(s/4)*4,S=s%4,_=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${o}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${_}
            }

            int xC = xCCorner + ${C};
            if (${S===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${S===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${_}
            } else if (${S===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${_}
            }
          }
        }
        setOutput(${k});
      }
    `}};function pOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Jg(a,"avgPool");let{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r,d=1;E.assert(z.eitherStridesOrDilationsAreOne(o,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);let u=z.computePool2DInfo(a.shape,s,o,d,l,c);if(u.filterWidth===1&&u.filterHeight===1&&E.arraysEqual(u.inShape,u.outShape))return Xs({inputs:{x:a},backend:n});let h=new Zy(u,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}var mOe={kernelName:Dh,backendName:"webgl",kernelFunc:pOe};function fOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=r,u=[1,1,1],h=z.computePool3DInfo(a.shape,s,o,u,l,c,d),p=new uR(h,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}var gOe={kernelName:Vf,backendName:"webgl",kernelFunc:fOe},xOe=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,d=l-1-e.padInfo.top,u=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${u});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${o}) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},yOe=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,u=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,m=u-1-e.padInfo.front,f=h-1-e.padInfo.top,g=p-1-e.padInfo.left,x=1/(t*n*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${f}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${u};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${a}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function bOe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,o=s,{filterSize:l,strides:c,pad:d,dimRoundingMode:u}=r,h=[1,1,1],p=z.computePool3DInfo(o.shape,l,c,h,d,u),m=new yOe(p);return n.runWebGLProgram(m,[a],o.dtype)}var vOe={kernelName:kb,backendName:"webgl",kernelFunc:bOe};function wOe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,o=s;Jg([a,s],"avgPoolGrad");let{filterSize:l,strides:c,pad:d}=r,u=z.computePool2DInfo(o.shape,l,c,1,d),h=new xOe(u);return n.runWebGLProgram(h,[a],o.dtype)}var NOe={kernelName:Nb,backendName:"webgl",kernelFunc:wOe};function kOe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:o,transposeB:l}=r;return r1({a,b:s,transposeA:o,transposeB:l,backend:n})}var SOe={kernelName:Mh,backendName:"webgl",kernelFunc:kOe},COe=class{constructor(e,t,n,r,a,s){this.outputShape=[],this.variableNames=["x","mean","variance"],z.assertAndGetBroadcastShape(e,t),z.assertAndGetBroadcastShape(e,n);let o="0.0";r!=null&&(z.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let l="1.0";a!=null&&(z.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${o};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}},_Oe=class{constructor(e,t,n,r,a,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],z.assertAndGetBroadcastShape(e,t),z.assertAndGetBroadcastShape(e,n);let o="vec4(0.0)";r!=null&&(z.assertAndGetBroadcastShape(e,r),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let l="vec4(1.0)";a!=null&&(z.assertAndGetBroadcastShape(e,a),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${o};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}},jOe=({inputs:e,backend:t,attrs:n})=>{let{x:r,mean:a,variance:s,offset:o,scale:l}=e;E.assert(a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E.assert(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E.assert(l==null||a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=n;c==null&&(c=.001);let d=[r,a,s],u=null;o!=null&&(u=o.shape,d.push(o));let h=null;l!=null&&(h=l.shape,d.push(l));let p=_e().getBool("WEBGL_PACK_NORMALIZATION")?new _Oe(r.shape,a.shape,s.shape,u,h,c):new COe(r.shape,a.shape,s.shape,u,h,c);return t.runWebGLProgram(p,d,d[0].dtype)},IOe={kernelName:Qh,backendName:"webgl",kernelFunc:jOe},TOe=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let t=fr(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=EOe(this.rank),r,a=e.map((s,o)=>`sourceLoc.${N_[o]} = start[${o}] + coords.${N_[o]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${a.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${n}));
      }
    `}},N_=["x","y","z","w","u","v"];function EOe(e){if(e===1)return"sourceLoc";if(e<=6)return N_.slice(0,e).map(t=>"sourceLoc."+t).join(",");throw Error(`Slicing for rank ${e} is not yet supported`)}var AOe=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let t=fr(this.rank),n=Ya("coords",this.rank),r=Ya("sourceLoc",this.rank),a=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,s=`getChannel(getSource(${r.join()}), ${a})`,o=`
      result.x = ${s};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${s};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${s};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,u)=>`start[${u}]`).join()});`:e.map((d,u)=>`${r[u]} = ${n[u]} + start[${u}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${o}
        ${l}
        setOutput(result);
      }
    `}};function ROe(e,t,n,r){let a=r.texData.get(e.dataId),s=r.makeTensorInfo(n,e.dtype),o=r.texData.get(s.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;let l=da.computeFlatOffset(t,E.computeStrides(e.shape));a.slice&&(l+=a.slice.flatOffset),o.slice={flatOffset:l,origDataId:a.slice&&a.slice.origDataId||e.dataId};let c=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,c+1),s}function ix(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,size:o}=r,[l,c]=da.parseSliceParams(a,s,o);if(da.assertParamsValid(a,l,c),E.sizeFromShape(c)===0)return n.makeTensorInfo(c,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||a.dtype==="string"){let h=n.texData.get(a.dataId),p=NFe(h.values,l,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,p)}let{isPacked:d}=n.texData.get(a.dataId),u=da.isSliceContinous(a.shape,l,c);if(d||!u){let h=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AOe(c):new TOe(c),p=[l];return n.runWebGLProgram(h,[a],a.dtype,p)}return n.uploadToGPU(a.dataId),ROe(a,l,c,n)}var DOe={kernelName:Eg,backendName:"webgl",kernelFunc:ix},MOe=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:o}=r;E.assert(a.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let l=s.reduce((b,v)=>b*v),c=z.getReshaped(a.shape,s,l),d=z.getPermuted(c.length,s.length),u=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(o,s.length),p=z.getSliceSize(u,o,s.length),m=[],f=nt({inputs:{x:a},backend:n,attrs:{shape:c}}),g=es({inputs:{x:f},backend:n,attrs:{perm:d}}),x=nt({inputs:{x:g},backend:n,attrs:{shape:u}}),y=ix({inputs:{x},backend:n,attrs:{begin:h,size:p}});return m.push(f),m.push(g),m.push(x),m.forEach(b=>n.disposeIntermediateTensorInfo(b)),y},$Oe={kernelName:Hf,backendName:"webgl",kernelFunc:MOe};function FOe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:o}=r,l=n.readSync(a.dataId),c=n.readSync(s.dataId),d=P9(l,c,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,d)}var POe={kernelName:Gf,backendName:"webgl",kernelFunc:FOe},OOe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,LOe=`
  return float(int(a.r) & int(b.r));
`;function zOe(e){let{inputs:t,backend:n}=e,{a:r,b:a}=t,s=_e().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=_e().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([r,a])||o===1){let c=n.texData.get(r.dataId).values,d=n.texData.get(a.dataId).values,[u,h]=G3e(r.shape,a.shape,c,d,r.dtype),p=n.makeTensorInfo(h,r.dtype),m=n.texData.get(p.dataId);return m.values=u,p}let l;return s?l=new ax(OOe,r.shape,a.shape,!1):l=new yh(LOe,r.shape,a.shape),n.runWebGLProgram(l,[r,a],r.dtype)}var BOe={kernelName:qf,backendName:"webgl",kernelFunc:zOe};function WOe(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.readSync(r.dataId),o=n.readSync(a.dataId),l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(o));return n.makeTensorInfo([l.length],"int32",Int32Array.from(l))}var UOe={kernelName:Sb,backendName:"webgl",kernelFunc:WOe},VOe="return float(a != b);",J9=Oa({opSnippet:VOe,cpuKernelImpl:pFe,dtype:"bool"}),HOe={kernelName:xg,backendName:"webgl",kernelFunc:J9};function vv(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Xs({inputs:{x:a.complexTensorInfos.real},backend:n})}var GOe={kernelName:X1,backendName:"webgl",kernelFunc:vv},qOe="return float(int(x));";function KOe(e,t){let n=new Xo(e.shape,qOe),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function k_(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dtype:s}=r;if(s==="complex64"){if(a.dtype==="complex64")return Xs({inputs:{x:a},backend:n});let o=Fr(a.shape),l=k_({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),c=Fu({inputs:{real:l,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(l),c}if(a.dtype==="complex64"){let o=vv({inputs:{input:a},backend:n}),l=k_({inputs:{x:o},backend:n,attrs:{dtype:s}});return n.disposeIntermediateTensorInfo(o),l}if(!E.hasEncodingLoss(a.dtype,s)){let o=Xs({inputs:{x:a},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:s}}if(n.shouldExecuteOnCPU([a])){let o=n.texData.get(a.dataId).values,[l,c,d]=q3e(o,a.shape,a.dtype,s);return n.makeTensorInfo(l,c,d)}if(s==="int32")return KOe(a,n);if(s==="bool"){let o=n.makeTensorInfo([],"bool",E.getTypedArrayFromDType("bool",1)),l=J9({inputs:{a,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${a.dtype} to ${s}`)}var YOe={kernelName:$h,backendName:"webgl",kernelFunc:k_},QF="return ceil(x);",XOe=Bn({opSnippet:QF,packedOpSnippet:QF,cpuKernelImpl:K3e}),ZOe={kernelName:Fh,backendName:"webgl",kernelFunc:XOe},QOe=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}},JOe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function e4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:o}=r,l;_e().getBool("WEBGL_PACK_CLIP")?l=new JOe(a.shape):l=new QOe(a.shape);let c=[[s],[o]];return n.runWebGLProgram(l,[a],a.dtype,c)}var t4e={kernelName:ju,backendName:"webgl",kernelFunc:e4e},n4e=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function JF(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}function r4e(e){let{inputs:t,backend:n}=e,{x:r}=t,a=n.texData.get(r.dataId),s=new n4e(r.shape),o=[JF(r,a.complexTensorInfos.real),JF(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(s,o,o[0].dtype)}var a4e={kernelName:Cb,backendName:"webgl",kernelFunc:r4e},s4e=class{constructor(e){this.outputShape=[],this.outputShape=z.computeOutShape(e,1),this.variableNames=e.map((s,o)=>`T${o}`);let t=new Array(e.length-1);t[0]=e[0][1];for(let s=1;s<t.length;s++)t[s]=t[s-1]+e[s][1];let n=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<t.length;s++){let o=t[s-1];n.push(`else if (yC < ${t[s]}) setOutput(getT${s}(yR, yC-${o}));`)}let r=t.length,a=t[t.length-1];n.push(`else setOutput(getT${r}(yR, yC-${a}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}},i4e=class{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=z.computeOutShape(e,t);let n=this.outputShape,r=n.length,a=fr(r),s=Ya("coords",r),o=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((f,g)=>`T${g}`);let l=new Array(e.length-1);l[0]=e[0][t];for(let f=1;f<l.length;f++)l[f]=l[f-1]+e[f][t];let c=o[t],d=o.slice(-2),u=o.join(),h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${u}), vec2(${d.join()}));
        }`;for(let f=1;f<l.length;f++){let g=l[f-1];h+=`
        if (${c} < ${l[f]}  && ${c} >= ${l[f-1]}) {
          return getChannel(
            getT${f}(${uw(o,c,g)}),
            vec2(${uw(d,c,g)}));
        }`}let p=l.length,m=l[l.length-1];h+=`
        return getChannel(
          getT${p}(${uw(o,c,m)}),
          vec2(${uw(d,c,m)}));`,this.userCode=`
      float getValue(${o.map(f=>"int "+f)}) {
        ${h}
      }

      void main() {
        ${a} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[r-1]} = ${s[r-1]} + 1;
        if (${s[r-1]} < ${n[r-1]}) {
          result.g = getValue(${s});
        }

        ${s[r-2]} = ${s[r-2]} + 1;
        if (${s[r-2]} < ${n[r-2]}) {
          result.a = getValue(${s});
        }

        ${s[r-1]} = ${s[r-1]} - 1;
        if (${s[r-2]} < ${n[r-2]} &&
            ${s[r-1]} < ${n[r-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function uw(e,t,n){let r=e.indexOf(t);return e.map((a,s)=>s===r?`${a} - ${n}`:a).join()}function ik(e){let{inputs:t,backend:n}=e,{input:r}=t,a=n.texData.get(r.dataId);return Xs({inputs:{x:a.complexTensorInfos.imag},backend:n})}var o4e={kernelName:G1,backendName:"webgl",kernelFunc:ik};function Qx(e,t,n){let r=e[0].dtype;if(r==="complex64"){let m=e.map(b=>vv({inputs:{input:b},backend:n})),f=e.map(b=>ik({inputs:{input:b},backend:n})),g=Qx(m,t,n),x=Qx(f,t,n),y=Fu({inputs:{real:g,imag:x},backend:n});return m.forEach(b=>n.disposeIntermediateTensorInfo(b)),f.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),y}let a=n.shouldExecuteOnCPU(e);if(r==="string"&&(a=!0),a){let m=e.map(w=>{let k=[-1,E.sizeFromShape(w.shape.slice(t))];return nt({inputs:{x:w},backend:n,attrs:{shape:k}})}),f=m.map(w=>({vals:n.readSync(w.dataId),shape:w.shape})),g=z.computeOutShape(m.map(w=>w.shape),1),x=m[0].shape[0]===1,y=Y3e(f,g,r,x),b=z.computeOutShape(e.map(w=>w.shape),t),v=n.makeTensorInfo(b,r,y);return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}let s=e.filter(m=>E.sizeFromShape(m.shape)>0),o=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let m=o?new Xo(e[0].shape,kc):new Wc(e[0].shape,kc);return n.runWebGLProgram(m,e,r)}let l=_e().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>l){let m=[];for(let g=0;g<s.length;g+=l){let x=s.slice(g,g+l);m.push(Qx(x,t,n))}let f=Qx(m,t,n);for(let g of m)n.disposeIntermediateTensorInfo(g);return f}if(o){let m=new i4e(s.map(f=>f.shape),t);return n.runWebGLProgram(m,s,r)}let{tensors2D:c,outShape:d}=l4e(s,t,n),u=new s4e(c.map(m=>m.shape)),h=n.runWebGLProgram(u,c,r);c.forEach(m=>n.disposeIntermediateTensorInfo(m));let p=nt({inputs:{x:h},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(h),p}function l4e(e,t,n){let r=z.computeOutShape(e.map(a=>a.shape),t);return{tensors2D:e.map(a=>nt({inputs:{x:a},attrs:{shape:[-1,E.sizeFromShape(a.shape.slice(t))]},backend:n})),outShape:r}}function e7(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r,s=E.parseAxisParam(a,t[0].shape)[0],o=t.map(d=>d.shape);z.assertParamsConsistent(o,s);let l=z.computeOutShape(t.map(d=>d.shape),s);if(E.sizeFromShape(l)===0)return n.makeTensorInfo(l,t[0].dtype,[]);let c=t.filter(d=>E.sizeFromShape(d.shape)>0);return c.length===1?Xs({inputs:{x:c[0]},backend:n}):Qx(c,s,n)}var c4e={kernelName:Kf,backendName:"webgl",kernelFunc:e7},t7=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let s=e.padInfo.top,o=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,u=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,f=e.inChannels%4,g=e.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,b=g?3:1,v="",w="";n&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:v=`
          float activation(float x) {
            ${n}
          }
        `,w="result = activation(result);");let k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${p}; wC++) {
            int xC = xCCorner + wC * ${u};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${f===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${f===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${f===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${k}
        ${w}
        setOutput(result);
      }
    `}},u4e=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,d=e.dilationWidth,u=e.filterDepth,h=e.filterHeight,p=e.filterWidth,m=Math.floor(e.inChannels/4)*4,f=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${a}, ${s}, ${o});
      const ivec3 pads = ivec3(${t}, ${n}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${u}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${f===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${f===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${f===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},n7=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ha(this.outputShape.length);let s=e.padInfo.left,o=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,d=e.filterWidth,u=d,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<d;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<d;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(u+1)/2;g++){let x=g*2;if(h+=`
           xC = xCCorner + ${x*l};
           `,o===1){if(x<d&&(s%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,l===1&&x>0?h+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<d)){let y=s%2===0?E.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:h+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):y===1?h+=`
                     xC${x+1} = xTexelC${x};
                     `:h+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<d&&(s%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<d&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<d&&(h+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<d&&(h+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<d&&(h+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let p="",m="";n&&(r?p=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:a?p=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:p=`vec4 activation(vec4 x) {
           ${n}
         }`,m="result = activation(result);");let f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${p}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${f}
         ${m}
         setOutput(result);
       }
     `}},d4e=class{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Ha(this.outputShape.length);let{dataFormat:n}=t,r=ss(),a=n==="channelsLast",s=a?1:2,o=a?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,c="";for(let d=0;d<=1;d++)for(let u=0;u<=1;u++)c+=`
          blockIndex = rc.z + ${u};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${o}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${a}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+u}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+u}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}};function a1(e,t){let n=e.length;return n>=3?t?[...e.slice(0,-3),e[n-3]*e[n-2],e[n-1]]:[...e.slice(0,-3),e[n-3],e[n-2]*e[n-1]]:!t&&n===1&&e[0]>1?[e[0],1]:null}function r7({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}){let c=e.shape,d=r.texData.get(e.dataId),u=n.inChannels,h=c[0]*c[1]*c[2],p=n.outChannels,m=n.dataFormat==="channelsLast",f=!1,g=!1,x,y=[];if(s!=null){let b=a1(s.shape,m);b!=null&&(s=nt({inputs:{x:s},backend:r,attrs:{shape:b}}),y.push(s))}if(a!=null){let b=a1(a.shape,m);b!=null&&(a=nt({inputs:{x:a},backend:r,attrs:{shape:b}}),y.push(a))}if(!((h===1||p===1)&&u>Y9)&&d.isPacked&&m&&d.texture!=null&&c[2]%2!==0&&E.arraysEqual(d.shape.slice(-3),c.slice(-3))){let b=c[0]*c[1]*(c[2]+1),v={dataId:e.dataId,shape:[1,b,n.inChannels],dtype:e.dtype},w=d.shape;d.shape=d.shape.slice(),d.shape[d.shape.length-2]++,E.assert(Yy(d.shape,v.shape),()=>`packed reshape ${d.shape} to ${v.shape} isn't free`);let k=nt({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(k);let C=r1({a:v,b:k,backend:r,transposeA:f,transposeB:g,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:o}),S=r.texData.get(C.dataId);E.assert(S.isPacked,()=>"batchMatMul result is expected to be packed"),d.shape=w,S.shape=n.outShape,x=Xs({inputs:{x:C},backend:r}),x.shape=n.outShape,y.push(C)}else{let b=n.outHeight*n.outWidth,v=nt({inputs:{x:e},backend:r,attrs:{shape:m?[n.batchSize,b,n.inChannels]:[n.batchSize,n.inChannels,b]}}),w=nt({inputs:{x:t},backend:r,attrs:{shape:[1,n.inChannels,n.outChannels]}}),k=r1({a:m?v:w,b:m?w:v,transposeA:!m,transposeB:g,backend:r,bias:a,activation:l,preluActivationWeights:s,leakyreluAlpha:o});x=nt({inputs:{x:k},backend:r,attrs:{shape:n.outShape}}),y.push(v),y.push(w),y.push(k)}for(let b of y)r.disposeIntermediateTensorInfo(b);return x}function a7({x:e,filter:t,convInfo:n,backend:r,bias:a=null,preluActivationWeights:s=null,leakyreluAlpha:o=0,activation:l=null}){let{filterWidth:c,filterHeight:d,inChannels:u,outWidth:h,outHeight:p,dataFormat:m}=n,f=m==="channelsLast",g=c*d*u,x=p*h,y=[n.batchSize,g,x],b=!0,v=!1,w=[];if(s!=null){let L=a1(s.shape,f);L!=null&&(s=nt({inputs:{x:s},backend:r,attrs:{shape:L}}),w.push(s))}if(a!=null){let L=a1(a.shape,f);L!=null&&(a=nt({inputs:{x:a},backend:r,attrs:{shape:L}}),w.push(a))}let k=nt({inputs:{x:t},backend:r,attrs:{shape:[1,g,E.sizeFromShape(t.shape)/g]}});w.push(k);let C=new d4e(y,n),S=[e.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],_=r.runWebGLProgram(C,[e],"float32",S),I=nt({inputs:{x:_},backend:r,attrs:{shape:y}});w.push(_),w.push(I);let T=a!=null,A=s!=null,j=l==="leakyrelu",D=l?Xy(l,!0):null,F=new K9(f?I.shape:k.shape,f?k.shape:I.shape,f?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],b,v,T,D,A,j),B=f?[I,k]:[k,I];if(a&&B.push(a),A&&B.push(s),j){let L=r.makeTensorInfo([],"float32",E.createScalarValue(o,"float32"));B.push(L),w.push(L)}let q=r.runWebGLProgram(F,B,"float32"),$=nt({inputs:{x:q},backend:r,attrs:{shape:n.outShape}});w.push(q);for(let L of w)r.disposeIntermediateTensorInfo(L);return $}function h4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dataFormat:c,dilations:d,dimRoundingMode:u}=r,h=z.convertConv2DDataFormat(c),p=z.computeConv2DInfo(a.shape,s.shape,o,d,l,u,!1,h),m;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))m=r7({x:a,filter:s,convInfo:p,backend:n});else if(p.strideWidth<=2&&h==="channelsLast"&&_e().getBool("WEBGL_EXP_CONV")){let g=new n7(p),x=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];m=n.runWebGLProgram(g,[a,s],"float32",x)}else if(_e().getBool("WEBGL_CONV_IM2COL"))m=a7({x:a,filter:s,convInfo:p,backend:n});else{let g=new t7(p);m=n.runWebGLProgram(g,[a,s],"float32")}let f=nt({inputs:{x:m},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(m),f}var p4e={kernelName:Ph,backendName:"webgl",kernelFunc:h4e},m4e=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},f4e=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=e.dataFormat==="channelsLast",o=t-1-e.padInfo.top,l=n-1-e.padInfo.left,c=s?1:2,d=s?2:3,u=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${u}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},g4e=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.padInfo.front,s=e.padInfo.top,o=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${a};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${s};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${o};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},x4e=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterDepth,n=e.filterHeight,r=e.filterWidth,a=e.strideDepth,s=e.strideHeight,o=e.strideWidth,l=t-1-e.padInfo.front,c=n-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${a}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function y4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,pad:l,dataFormat:c,dimRoundingMode:d,filterShape:u}=r,h=z.convertConv2DDataFormat(c),p=z.computeConv2DInfo(a.shape,u,o,1,l,d,!1,h),m=new m4e(p);return n.runWebGLProgram(m,[a,s],"float32")}var b4e={kernelName:L1,backendName:"webgl",kernelFunc:y4e},v4e=class{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Ha(this.outputShape.length);let t=e.filterHeight,n=e.filterWidth,r=t-1-e.padInfo.top,a=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function w4e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{inputShape:o,strides:l,pad:c,dataFormat:d,dimRoundingMode:u}=r,h=z.convertConv2DDataFormat(d),p=z.computeConv2DInfo(o,s.shape,l,1,c,u,!1,h);if(_e().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){let m=[[p.strideHeight,p.strideWidth]],f=new v4e(p);return n.runWebGLProgram(f,[a,s],"float32",m)}else{let m=new f4e(p);return n.runWebGLProgram(m,[a,s],"float32")}}var N4e={kernelName:Oh,backendName:"webgl",kernelFunc:w4e};function k4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c}=r,d=z.computeConv3DInfo(a.shape,s.shape,o,c,l),u=new u4e(d);return n.runWebGLProgram(u,[a,s],"float32")}var S4e={kernelName:Lh,backendName:"webgl",kernelFunc:k4e};function C4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,pad:l,filterShape:c}=r,d=z.computeConv3DInfo(a.shape,c,o,1,l),u=new g4e(d);return n.runWebGLProgram(u,[a,s],"float32")}var _4e={kernelName:Yf,backendName:"webgl",kernelFunc:C4e};function j4e(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:o,strides:l,inputShape:c}=r,d=z.computeConv3DInfo(c,s.shape,l,1,o),u=new x4e(d);return n.runWebGLProgram(u,[a,s],"float32")}var I4e={kernelName:Xf,backendName:"webgl",kernelFunc:j4e},T4e=sx+`
  return cos(x);
`,E4e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Qp}
  return result;
`,A4e=Bn({opSnippet:T4e,packedOpSnippet:E4e}),R4e={kernelName:zh,backendName:"webgl",kernelFunc:A4e},D4e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,M4e=Bn({opSnippet:D4e}),$4e={kernelName:Bh,backendName:"webgl",kernelFunc:M4e},F4e=class{constructor(e,t,n,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,o,l,c]=e,[d]=t,[u,h]=n;this.outputShape=[d,u,h,c];let p=r==="bilinear"?1:0,[m,f]=[`${o-1}.0`,`${l-1}.0`],[g,x,y]=u>1?[`${(o-1)/(u-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[b,v,w]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${a}));
          return;
        }
        float in_x = ${w};
        if( in_x < 0.0 || in_x > ${f} ) {
          setOutput(float(${a}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${p} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}},P4e=e=>{let{inputs:t,backend:n,attrs:r}=e,{image:a,boxes:s,boxInd:o}=t,{cropSize:l,method:c,extrapolationValue:d}=r,u=new F4e(a.shape,s.shape,l,c,d);return n.runWebGLProgram(u,[a,s,o],"float32")},O4e={kernelName:Qf,backendName:"webgl",kernelFunc:P4e},Qy;(function(e){e.Prod="*",e.Sum="+"})(Qy||(Qy={}));var eP=class{constructor(e,t,n,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let a=this.outputShape.length,s=this.op===Qy.Prod?"1.0":"0.0",o=n?s:`getX(${tP(a,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],c="",d="";n?(c=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${fr(a)} coords = getOutputCoords();
        int end = ${nP(a,"coords",this.op)};
        float val = ${o};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${d};
          ${nP(a,"coords",this.op)} = idx;
          val ${this.op}= getX(${tP(a,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function tP(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.x, ${t}.y`;if(e===3)return`${t}.x, ${t}.y, ${t}.z`;if(e===4)return`${t}.x, ${t}.y, ${t}.z, ${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function nP(e,t,n){if(e===1)return`${t}`;if(e===2)return`${t}.y`;if(e===3)return`${t}.z`;if(e===4)return`${t}.w`;throw new Error(`Cumulative ${n} for rank ${e} is not yet supported`)}function s7(e,t,n,r,a,s){let o=t.shape.length,l=z.getAxesPermutation([r],o),c=t;l!=null&&(c=es({inputs:{x:t},backend:n,attrs:{perm:l}}));let d=z.getInnerMostAxes(1,o)[0];if(d!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${t.shape.length-1} but got axis=${r}`);let u=c.shape[d],h=Xs({inputs:{x:c},backend:n});for(let p=0;p<=Math.ceil(Math.log2(u))-1;p++){let m=new eP(e,c.shape,!1,s),f=[[p]],g=h;h=n.runWebGLProgram(m,[h],h.dtype,f),n.disposeIntermediateTensorInfo(g)}if(a){let p=new eP(e,c.shape,a,s),m=h;h=n.runWebGLProgram(p,[h],h.dtype),n.disposeIntermediateTensorInfo(m)}if(l!=null){let p=z.getUndoAxesPermutation(l),m=es({inputs:{x:h},backend:n,attrs:{perm:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(c),m}return h}function L4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r;return s7(Qy.Prod,a,n,s,o,l)}var z4e={kernelName:Zf,backendName:"webgl",kernelFunc:L4e};function B4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r;return s7(Qy.Sum,a,n,s,o,l)}var W4e={kernelName:Wh,backendName:"webgl",kernelFunc:B4e};function U4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,weights:s}=t,{size:o,binaryOutput:l}=r;if(a.shape.length===1){let c=n.readSync(a.dataId),d=n.readSync(s.dataId),u=P9(c,d,s.dtype,s.shape,o);return n.makeTensorInfo([o],s.dtype,u)}else if(a.shape.length===2){let c=n.bufferSync(a),d=n.bufferSync(s),u=H3e(c,d,o,l);return n.makeTensorInfo(u.shape,s.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${a.shape.length}.`)}var V4e={kernelName:_b,backendName:"webgl",kernelFunc:U4e},H4e=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function G4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockSize:s,dataFormat:o}=r,l=a.shape[0],c=o==="NHWC"?a.shape[1]:a.shape[2],d=o==="NHWC"?a.shape[2]:a.shape[3],u=o==="NHWC"?a.shape[3]:a.shape[1],h=c*s,p=d*s,m=u/(s*s),f=o==="NHWC"?[l,h,p,m]:[l,m,h,p],g=new H4e(f,s,o);return n.runWebGLProgram(g,[a],a.dtype)}var q4e={kernelName:Jf,backendName:"webgl",kernelFunc:G4e},i7=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ha(this.outputShape.length);let s=e.filterHeight,o=e.filterWidth,l=e.outChannels/e.inChannels,c="",d="";n&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:c=`
          float activation(float x) {
            ${n}
          }
        `,d="result = activation(result);");let u=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${o}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${u}
        ${d}
        setOutput(result);
      }
    `}},o7=class{constructor(e,t=!1,n=null,r=!1,a=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Ha(this.outputShape.length);let s=e.outChannels/e.inChannels,o=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,d=e.filterHeight,u=e.filterWidth,h=u,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<u;x++)p+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;p+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let x=0;x<u;x++)p+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(h+1)/2;x++){let y=x*2;if(p+=`
          xC = xCCorner + ${y*c};
          `,l===1){if(y<u&&(o%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,c===1&&y>0?p+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<u)){let b=o%2===0?E.nearestLargerEven(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:p+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):b===1?p+=`
                    xC${y+1} = xTexelC${y};
                    `:p+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<u&&(o%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<u&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<u&&(p+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<u&&(p+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<u&&(p+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;let m="",f="";n&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:a?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:m=`vec4 activation(vec4 x) {
          ${n}
        }`,f="result = activation(result);");let g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),a&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${p}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${f}
        setOutput(result);
      }
    `}};function K4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c,dimRoundingMode:d}=r,u=c;u==null&&(u=[1,1]),E.assert(z.eitherStridesOrDilationsAreOne(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);let h=z.computeConv2DInfo(a.shape,s.shape,o,u,l,d,!0),p;_e().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new o7(h):p=new i7(h);let m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return n.runWebGLProgram(p,[a,s],"float32",m)}var Y4e={kernelName:Uh,backendName:"webgl",kernelFunc:K4e},X4e=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let t=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,a=e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${a};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},Z4e=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let t=e.filterHeight,n=e.filterWidth,r=e.strideHeight,a=e.strideWidth,s=t-1-e.padInfo.top,o=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${a}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Q4e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,dilations:l,pad:c,dimRoundingMode:d,filterShape:u}=r,h=z.computeConv2DInfo(a.shape,u,o,l,c,d,!0),p=new X4e(h);return n.runWebGLProgram(p,[a,s],"float32")}var J4e={kernelName:z1,backendName:"webgl",kernelFunc:Q4e};function eLe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{strides:o,dilations:l,pad:c,dimRoundingMode:d,inputShape:u}=r,h=z.computeConv2DInfo(u,s.shape,o,l,c,d,!0),p=new Z4e(h);return n.runWebGLProgram(p,[a,s],"float32")}var tLe={kernelName:B1,backendName:"webgl",kernelFunc:eLe},nLe=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function rLe(e){let{inputs:t,backend:n}=e,{x:r}=t,a=[...r.shape,...r.shape],s=E.sizeFromShape(r.shape),o=nt({inputs:{x:r},backend:n,attrs:{shape:[s]}}),l=new nLe(s),c=n.runWebGLProgram(l,[o],o.dtype),d=nt({inputs:{x:c},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(c),d}var aLe={kernelName:jb,backendName:"webgl",kernelFunc:rLe},sLe=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:t,inWidth:n,padInfo:r,strideHeight:a,strideWidth:s,filterHeight:o,filterWidth:l,dilationHeight:c,dilationWidth:d}=e,{top:u,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${s});
      const ivec2 pads = ivec2(${u}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${o}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function iLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c}=r,d=z.computeDilation2DInfo(a.shape,s.shape,o,l,"NHWC",c),u,h=new sLe(d);u=n.runWebGLProgram(h,[a,s],"float32");let p=nt({inputs:{x:u},backend:n,attrs:{shape:d.outShape}});return n.disposeIntermediateTensorInfo(u),p}var oLe={kernelName:Vh,backendName:"webgl",kernelFunc:iLe};function lLe(e){let{inputs:t,backend:n,attrs:r}=e,{equation:a}=r,s=t,{allDims:o,summedDims:l,idDims:c}=z.decodeEinsumEquation(a,s.length);z.checkEinsumDimSizes(o.length,c,s);let{path:d,steps:u}=z.getEinsumComputePath(l,c),h=u.length,p=null,m=o.length,f=[];for(let g=0;g<h;++g){for(let x of u[g]){let{permutationIndices:y,expandDims:b}=z.getEinsumPermutation(m,c[x]),v;z.isIdentityPermutation(y)?v=s[x]:(v=es({inputs:{x:s[x]},backend:n,attrs:{perm:y}}),f.push(v));let w=v.shape.slice();for(let k=0;k<b.length;++k)w.splice(b[k],0,1);E.arraysEqual(v.shape,w)||(v=nt({inputs:{x:v},backend:n,attrs:{shape:w}}),f.push(v)),p===null?p=v:(p=cR({inputs:{a:v,b:p},backend:n}),f.push(p))}g<h-1&&(d[g]>=0&&(p=sk({inputs:{x:p},backend:n,attrs:{axis:d[g]-(o.length-m),keepDims:!1}}),f.push(p)),m--)}for(let g of f)g!==p&&n.disposeIntermediateTensorInfo(g);return p}var cLe={kernelName:U1,backendName:"webgl",kernelFunc:lLe},uLe="return (x >= 0.0) ? x : (exp(x) - 1.0);",dLe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,hLe=Bn({opSnippet:uLe,packedOpSnippet:dLe}),pLe={kernelName:Gh,backendName:"webgl",kernelFunc:hLe},mLe="return (b >= 0.0) ? a : a * (b + 1.0);",fLe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,gLe=e=>{let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=_e().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ax(fLe,r.shape,a.shape):new yh(mLe,r.shape,a.shape);return n.runWebGLProgram(s,[r,a],r.dtype)},xLe={kernelName:eg,backendName:"webgl",kernelFunc:gLe},yLe=`
  return vec4(equal(a, b));
`,bLe="return float(a == b);",vLe=Oa({opSnippet:bLe,packedOpSnippet:yLe,dtype:"bool",cpuKernelImpl:X3e}),wLe={kernelName:tg,backendName:"webgl",kernelFunc:vLe},NLe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${z.ERF_P};
  float a1 = ${z.ERF_A1};
  float a2 = ${z.ERF_A2};
  float a3 = ${z.ERF_A3};
  float a4 = ${z.ERF_A4};
  float a5 = ${z.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,kLe=Bn({opSnippet:NLe}),SLe={kernelName:qh,backendName:"webgl",kernelFunc:kLe},CLe=sx+`
  return exp(x);
`,_Le=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,l7=Bn({opSnippet:CLe,packedOpSnippet:_Le,cpuKernelImpl:Z3e,dtype:"float32"}),jLe={kernelName:Kh,backendName:"webgl",kernelFunc:l7};function S_(e){let{inputs:t,attrs:n,backend:r}=e,{dim:a}=n,{input:s}=t,o=s.shape.length,l=s.shape.slice(),c=a;return a<0&&(E.assert(-(o+1)<=a,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+a+1),l.splice(c,0,1),nt({inputs:{x:s},backend:r,attrs:{shape:l}})}var ILe={kernelName:ng,backendName:"webgl",kernelFunc:S_},rP="return exp(x) - 1.0;",TLe=Bn({opSnippet:rP,packedOpSnippet:rP,cpuKernelImpl:Q3e}),ELe={kernelName:Yh,backendName:"webgl",kernelFunc:TLe},aP=class{constructor(e,t,n){this.variableNames=["real","imag"];let r=t[1];this.outputShape=t;let a=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=n?`${r}.0`:"1.0",o;if(e==="real")o="return real * expR - imag * expI;";else if(e==="imag")o="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${a};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${o}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function c7(e,t,n){let r=n.texData.get(e.dataId),a=E.sizeFromShape(e.shape),s=e.shape[e.shape.length-1],o=a/s,l=nt({inputs:{x:e},backend:n,attrs:{shape:[o,s]}}),c=l.shape,d=new aP("real",c,t),u=new aP("imag",c,t),h=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:c},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:c}],p=n.runWebGLProgram(d,h,"float32"),m=n.runWebGLProgram(u,h,"float32"),f=Fu({inputs:{real:p,imag:m},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m);let g=nt({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(f),g}function ALe(e){let{inputs:t,backend:n}=e,{input:r}=t;return c7(r,!1,n)}var RLe={kernelName:V1,backendName:"webgl",kernelFunc:ALe},DLe=class{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function wv(e){let{backend:t,attrs:n}=e,{shape:r,value:a}=n,{dtype:s}=n;if(s=s||E.inferDtype(a),s==="string"){let o=E.getArrayFromDType(s,E.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,s,o)}else{let o=new DLe(r,a),l=[[a]];return t.runWebGLProgram(o,[],s,l)}}var MLe={kernelName:Ib,backendName:"webgl",kernelFunc:wv},$Le=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}},FLe={kernelName:rg,backendName:"webgl",kernelFunc:({inputs:e,backend:t})=>{let{image:n}=e,r=t,a=new $Le(n.shape);return r.runWebGLProgram(a,[n],n.dtype)}},sP="return floor(x);",PLe=Bn({opSnippet:sP,packedOpSnippet:sP,cpuKernelImpl:J3e}),OLe={kernelName:Xh,backendName:"webgl",kernelFunc:PLe},LLe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,zLe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,BLe=Oa({opSnippet:LLe,packedOpSnippet:zLe,dtype:"int32"}),WLe={kernelName:Zh,backendName:"webgl",kernelFunc:BLe},ULe=class{constructor(e){this.variableNames=["A"];let t=ss(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}},VLe=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let t=ss(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${n}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}},HLe={kernelName:F0,backendName:"webgl",kernelFunc:GLe},um,e2=_e().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function GLe(e){let{inputs:t,backend:n,attrs:r}=e,{pixels:a}=t,{numChannels:s}=r,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,[c,d]=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],u=[d,c],h=[d,c,s];if(l||o){let g=_e().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(um==null||g!==e2)&&(e2=g,um=document.createElement("canvas").getContext("2d",{willReadFrequently:e2})),um.canvas.width=c,um.canvas.height=d,um.drawImage(a,0,0,c,d),a=um.canvas}let p=n.makeTensorInfo(u,"int32");n.texData.get(p.dataId).usage=oi.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),a);let m=_e().getBool("WEBGL_PACK")?new VLe(h):new ULe(h),f=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),f}function qLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=r,g=z.convertConv2DDataFormat(u),x=z.computeConv2DInfo(a.shape,s.shape,c,h,d,p,!1,g),y,b=[],v=o!=null,w=l!=null,k=m==="leakyrelu",C=()=>{let _=[a,s],I=(T,A)=>{if(A==="NCHW"&&T.shape.length===1&&T.shape[0]!==1){let j=nt({inputs:{x:T},backend:n,attrs:{shape:[T.shape[0],1,1]}});return b.push(j),j}return T};if(v&&_.push(I(o,u)),w&&_.push(I(l,u)),k){let T=n.makeTensorInfo([],"float32",E.createScalarValue(f,"float32"));_.push(T),b.push(T)}return _};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))y=r7({x:a,filter:s,convInfo:x,backend:n,bias:o,activation:m,preluActivationWeights:l,leakyreluAlpha:f});else if(x.strideWidth<=2&&g==="channelsLast"&&_e().getBool("WEBGL_EXP_CONV")){let _=m?Xy(m,!0):null,I=new n7(x,v,_,w,k),T=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],A=C();y=n.runWebGLProgram(I,A,"float32",T)}else if(_e().getBool("WEBGL_CONV_IM2COL"))y=a7({x:a,filter:s,convInfo:x,backend:n,bias:o,activation:m,preluActivationWeights:l,leakyreluAlpha:f});else{let _=m?Xy(m,!1):null,I=new t7(x,v,_,w,k),T=C();y=n.runWebGLProgram(I,T,"float32")}let S=nt({inputs:{x:y},backend:n,attrs:{shape:x.outShape}});return b.push(y),b.forEach(_=>n.disposeIntermediateTensorInfo(_)),S}var KLe={kernelName:nh,backendName:"webgl",kernelFunc:qLe};function YLe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dilations:u,dimRoundingMode:h,activation:p,leakyreluAlpha:m}=r,f=[],g=u;g==null&&(g=[1,1]),E.assert(z.eitherStridesOrDilationsAreOne(c,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${g}'`);let x=z.computeConv2DInfo(a.shape,s.shape,c,g,d,h,!0),y=_e().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,b=p?Xy(p,y):null,v=[a,s],w=o!=null,k=l!=null,C=p==="leakyrelu";if(w&&v.push(o),k&&v.push(l),C){let T=n.makeTensorInfo([],"float32",E.createScalarValue(m,"float32"));v.push(T),f.push(T)}let S;y?S=new o7(x,w,b,k,C):S=new i7(x,w,b,k,C);let _=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],I=n.runWebGLProgram(S,v,"float32",_);return f.forEach(T=>n.disposeIntermediateTensorInfo(T)),I}var XLe={kernelName:rh,backendName:"webgl",kernelFunc:YLe},ZLe=class{constructor(e,t,n,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;let a=fr(n.length),s=`
    int index;`;for(let o=0;o<this.sliceDim;o++)s+=`
          index = round(getIndices(coords[0], ${o}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[o]};
          flattenIndex += index * ${this.strides[o]};`;this.userCode=`
         void main() {
          ${a} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function QLe(e){let{inputs:t,backend:n}=e,{params:r,indices:a}=t,s=a.shape,o=s[s.length-1],l=E.sizeFromShape(r.shape),[c,d,u,h]=z.prepareAndValidate(r,a),p=nt({inputs:{x:a},backend:n,attrs:{shape:[d,o]}}),m=nt({inputs:{x:r},backend:n,attrs:{shape:[E.sizeFromShape(r.shape)/u,u]}});if(n.shouldExecuteOnCPU([r,a])||r.dtype==="string"){let y=n.readSync(a.dataId),b=n.bufferSync(r),v=eFe(y,b,r.dtype,d,o,u,h,r.shape,l);return n.makeTensorInfo(c,r.dtype,v.values)}let f=new ZLe(o,h,[d,u],r.shape),g=n.runWebGLProgram(f,[m,p],m.dtype),x=nt({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),x}var JLe={kernelName:sg,backendName:"webgl",kernelFunc:QLe},e5e=class{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;let n=fr(this.rank),r=t5e(e);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}};function t5e(e,t){let n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let a=0;a<e.length;a++)a===2?r.push("index"):r.push(`${n[a]}`);return r.join()}function u7(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,indices:s}=t,{axis:o,batchDims:l}=r,c=E.parseAxisParam(o,a.shape)[0];if(_e().get("DEBUG")){let b=n.readSync(s.dataId),v=a.shape[c];for(let w=0;w<b.length;++w){let k=b[w];E.assert(k<=v-1&&k>=0,()=>`GatherV2: the index value ${k} is not in [0, ${v-1}]`)}}let d=z.segment_util.collectGatherOpShapeInfo(a,s,c,l),u=E.sizeFromShape(s.shape),h=[],p=nt({inputs:{x:a},backend:n,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=nt({inputs:{x:s},backend:n,attrs:{shape:[d.batchSize,u/d.batchSize]}});h.push(p),h.push(m);let f=[d.batchSize,d.outerSize,u/d.batchSize,d.sliceSize];if(n.shouldExecuteOnCPU([a,s])||a.dtype==="string"){let b=n.bufferSync(m),v=n.bufferSync(p),w=tFe(v,b,f);return h.forEach(k=>n.disposeIntermediateTensorInfo(k)),n.makeTensorInfo(d.outputShape,w.dtype,w.values)}let g=new e5e(p.shape,f),x=n.runWebGLProgram(g,[p,m],p.dtype);h.push(x);let y=nt({inputs:{x},backend:n,attrs:{shape:d.outputShape}});return h.forEach(b=>n.disposeIntermediateTensorInfo(b)),y}var n5e={kernelName:ag,backendName:"webgl",kernelFunc:u7},r5e="return float(a > b);",a5e=`
  return vec4(greaterThan(a, b));
`,s5e=Oa({opSnippet:r5e,packedOpSnippet:a5e,cpuKernelImpl:nFe,dtype:"bool"}),i5e={kernelName:ig,backendName:"webgl",kernelFunc:s5e},o5e="return float(a >= b);",l5e=`
  return vec4(greaterThanEqual(a, b));
`,c5e=Oa({opSnippet:o5e,packedOpSnippet:l5e,dtype:"bool",cpuKernelImpl:rFe}),u5e={kernelName:Jh,backendName:"webgl",kernelFunc:c5e};function d5e(e){let{inputs:t,backend:n}=e,{input:r}=t;return c7(r,!0,n)}var h5e={kernelName:H1,backendName:"webgl",kernelFunc:d5e},p5e="return float(!isnan(x) && !isinf(x));",m5e=Bn({opSnippet:p5e,dtype:"bool"}),f5e={kernelName:tp,backendName:"webgl",kernelFunc:m5e},g5e="return float(isinf(x));",x5e=Bn({opSnippet:g5e,dtype:"bool"}),y5e={kernelName:np,backendName:"webgl",kernelFunc:x5e},b5e="return float(isnan(x));",v5e=Bn({opSnippet:b5e,dtype:"bool"}),w5e={kernelName:rp,backendName:"webgl",kernelFunc:v5e},N5e="return float(a < b);",k5e=`
  return vec4(lessThan(a, b));
`,S5e=Oa({opSnippet:N5e,packedOpSnippet:k5e,cpuKernelImpl:aFe,dtype:"bool"}),C5e={kernelName:og,backendName:"webgl",kernelFunc:S5e},_5e="return float(a <= b);",j5e=`
  return vec4(lessThanEqual(a, b));
`,I5e=Oa({opSnippet:_5e,packedOpSnippet:j5e,cpuKernelImpl:sFe,dtype:"bool"}),T5e={kernelName:lg,backendName:"webgl",kernelFunc:I5e};function E5e(e){let{backend:t,attrs:n}=e,{start:r,stop:a,num:s}=n,o=iFe(r,a,s);return t.makeTensorInfo([o.length],"float32",o)}var A5e={kernelName:cg,backendName:"webgl",kernelFunc:E5e},R5e=sx+`
  return x < 0.0 ? 0./0. : log(x);
`,D5e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,M5e=Bn({opSnippet:R5e,packedOpSnippet:D5e,cpuKernelImpl:oFe}),$5e={kernelName:sp,backendName:"webgl",kernelFunc:M5e},F5e=sx+`
  return log(1.0 + x);
`,P5e=Bn({opSnippet:F5e}),O5e={kernelName:ip,backendName:"webgl",kernelFunc:P5e},L5e="return float(a >= 1.0 && b >= 1.0);",z5e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,B5e=Oa({opSnippet:L5e,packedOpSnippet:z5e,dtype:"bool"}),W5e={kernelName:ug,backendName:"webgl",kernelFunc:B5e},U5e="return float(!(x >= 1.0));",V5e=Bn({opSnippet:U5e}),H5e={kernelName:dg,backendName:"webgl",kernelFunc:V5e},G5e="return float(a >= 1.0 || b >= 1.0);",q5e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,K5e=Oa({opSnippet:G5e,packedOpSnippet:q5e,dtype:"bool"}),Y5e={kernelName:hg,backendName:"webgl",kernelFunc:K5e},X5e=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[];let s=t,o=e[3]-1;this.outputShape=e;let l,c=`float(${n}) + float(${r}) * sum`;a===.5?l=`inversesqrt(${c})`:a===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${o}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}},Z5e=class{constructor(e,t,n,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=t,o=e[3]-1;this.outputShape=e;let l,c=`float(${n}) + float(${r}) * sum`;a===.5?l=`inversesqrt(${c})`:a===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${a}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}},Q5e=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:o,alpha:l,beta:c}=r,d=_e().getBool("WEBGL_PACK_NORMALIZATION")?new Z5e(a.shape,s,o,l,c):new X5e(a.shape,s,o,l,c);return n.runWebGLProgram(d,[a],a.dtype)},J5e={kernelName:op,backendName:"webgl",kernelFunc:Q5e},eze=class{constructor(e,t,n,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${a})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${a});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}},tze=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:o}=t,{depthRadius:l,bias:c,alpha:d,beta:u}=r,h=new eze(a.shape,l,c,d,u);return n.runWebGLProgram(h,[a,s,o],a.dtype)},nze={kernelName:pg,backendName:"webgl",kernelFunc:tze};function rze(e,t,n,r){let a=E.sizeFromShape(t),s=E.sizeFromShape(e.shape)/a,o=nt({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),l=Jp(o,e.dtype,"max",r),c=nt({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(l),c}function d7(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reductionIndices:s,keepDims:o}=r,l=a.shape.length,c=E.parseAxisParam(s,a.shape),d=c,u=z.getAxesPermutation(d,l),h=u!=null,p=n.shouldExecuteOnCPU([a]),m=a;if(h){if(p){let b=n.texData.get(m.dataId).values,v=new Array(l);for(let C=0;C<v.length;C++)v[C]=a.shape[u[C]];let w=iR(b,a.shape,a.dtype,u,v);m=n.makeTensorInfo(v,a.dtype);let k=n.texData.get(m.dataId);k.values=w}else m=ak(a,u,n);d=z.getInnerMostAxes(d.length,l)}z.assertAxesAreInnerMostDims("max",d,l);let[f,g]=z.computeOutAndReduceShapes(m.shape,d),x=f;o&&(x=z.expandShapeToKeepDim(f,c));let y;if(p){let b=n.texData.get(m.dataId).values,v=lFe(b,E.sizeFromShape(g),x,a.dtype);y=n.makeTensorInfo(x,a.dtype);let w=n.texData.get(y.dataId);w.values=v}else y=rze(m,g,x,n);return h&&n.disposeIntermediateTensorInfo(m),y}var aze={kernelName:lp,backendName:"webgl",kernelFunc:d7},sze=lR+`
  return max(a, b);
`,ize=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qp+`
  return result;
`,oze=Oa({opSnippet:sze,packedOpSnippet:ize,cpuKernelImpl:cFe}),lze={kernelName:cp,backendName:"webgl",kernelFunc:oze};function cze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;Jg(a,"maxPool");let{filterSize:s,strides:o,pad:l,dimRoundingMode:c}=r,d=1;E.assert(z.eitherStridesOrDilationsAreOne(o,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);let u=z.computePool2DInfo(a.shape,s,o,d,l,c);if(u.filterWidth===1&&u.filterHeight===1&&E.arraysEqual(u.inShape,u.outShape))return Xs({inputs:{x:a},backend:n});let h=new Zy(u,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}var uze={kernelName:up,backendName:"webgl",kernelFunc:cze};function dze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dataFormat:c,dimRoundingMode:d}=r,u=[1,1,1],h=z.computePool3DInfo(a.shape,s,o,u,l,d,c),p=new uR(h,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}var hze={kernelName:mg,backendName:"webgl",kernelFunc:dze},pze=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,a=e.effectiveFilterHeight,s=e.effectiveFilterWidth,o=a-1-e.padInfo.top,l=s-1-e.padInfo.left,c=a*s-1;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${a};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},mze=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let t=e.strideDepth,n=e.strideHeight,r=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,o=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,u=l-1-e.padInfo.front,h=c-1-e.padInfo.top,p=d-1-e.padInfo.left,m=l*c*d-1;this.userCode=`
      const ivec3 pads = ivec3(${u}, ${h}, ${p});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${a}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${o}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function fze(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,o=s,{filterSize:l,strides:c,pad:d,dimRoundingMode:u}=r,h=[1,1,1],p=z.computePool3DInfo(o.shape,l,c,h,d,u),m=new uR(p,"max",!0),f=n.runWebGLProgram(m,[o],o.dtype),g=new mze(p),x=n.runWebGLProgram(g,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),x}var gze={kernelName:Eb,backendName:"webgl",kernelFunc:fze};function xze(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s,output:o}=t,l=s;Jg([s,o],"maxPoolGrad");let{filterSize:c,strides:d,pad:u,dimRoundingMode:h}=r,p=z.computePool2DInfo(l.shape,c,d,1,u,h),m=!0,f=new Zy(p,"max",m),g=n.runWebGLProgram(f,[l],l.dtype),x=new pze(p),y=n.runWebGLProgram(x,[a,g],l.dtype);return n.disposeIntermediateTensorInfo(g),y}var yze={kernelName:Tb,backendName:"webgl",kernelFunc:xze};function bze(e,t,n,r){let a=new Zy(n,"max",!1),s=r.runWebGLProgram(a,[e],"float32");a=new Zy(n,"max",!0,!0,t);let o=r.runWebGLProgram(a,[e],"float32");return[s,o]}var vze={kernelName:Ab,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{filterSize:a,strides:s,pad:o,includeBatchInIndex:l}=t,c=n;E.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let d=[1,1];E.assert(z.eitherStridesOrDilationsAreOne(s,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${d}'`);let u=z.computePool2DInfo(r.shape,a,s,d,o),[h,p]=bze(r,l,u,c);return[h,p]}};function wze(e,t,n,r){let a=E.sizeFromShape(t),s=E.sizeFromShape(e.shape)/a,o=nt({inputs:{x:e},attrs:{shape:[s,a]},backend:r}),l=Jp(o,"float32","mean",r),c=nt({inputs:{x:l},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(l),c}var Nze={kernelName:dp,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{x:r}=e,{keepDims:a,axis:s}=t,o=n,l=r.shape.length,c=E.parseAxisParam(s,r.shape),d=c,u=z.getAxesPermutation(d,l),h=u!=null,p=o.shouldExecuteOnCPU([r]),m=[],f=r;if(h){if(p){let v=o.texData.get(f.dataId).values,w=new Array(l);for(let S=0;S<w.length;S++)w[S]=r.shape[u[S]];let k=iR(v,r.shape,r.dtype,u,w);f=o.makeTensorInfo(w,r.dtype);let C=o.texData.get(f.dataId);C.values=k}else f=ak(r,u,o);m.push(f),d=z.getInnerMostAxes(d.length,l)}z.assertAxesAreInnerMostDims("sum",d,l);let[g,x]=z.computeOutAndReduceShapes(f.shape,d),y=g;a&&(y=z.expandShapeToKeepDim(g,c));let b=wze(f,x,y,o);for(let v of m)o.disposeIntermediateTensorInfo(v);return b}};function kze(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r,l=a.shape.length,c=E.parseAxisParam(s,a.shape),d=c,u=z.getAxesPermutation(d,l),h=a;u!=null&&(h=es({inputs:{x:a},backend:n,attrs:{perm:u}}),d=z.getInnerMostAxes(d.length,a.shape.length)),z.assertAxesAreInnerMostDims("min",d,l);let[p,m]=z.computeOutAndReduceShapes(h.shape,d),f=E.sizeFromShape(m),g=nt({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),x=Jp(g,g.dtype,"min",n),y;if(o){let b=z.expandShapeToKeepDim(p,c);y=nt({inputs:{x},backend:n,attrs:{shape:b}})}else y=nt({inputs:{x},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(h),y}var Sze={kernelName:hp,backendName:"webgl",kernelFunc:kze},Cze=lR+`
  return min(a, b);
`,_ze=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Qp+`
  return result;
`,jze=Oa({opSnippet:Cze,packedOpSnippet:_ze,cpuKernelImpl:uFe}),Ize={kernelName:pp,backendName:"webgl",kernelFunc:jze},Tze=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=t.map((d,u)=>d[0]+e[u]+d[1]);let r=e.length,a=fr(r),s=t.map(d=>d[0]).join(","),o=t.map((d,u)=>d[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=n==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${s};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${o});

      void main() {
        ${a} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${a} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}},Eze=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((m,f)=>m[0]+e[f]+m[1]);let r=e.length,a=fr(r),s=t.map(m=>m[0]).join(","),o=t.map((m,f)=>m[0]+e[f]).join(","),l=Ya("rc",r),c=Ya("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,u=r===1?"source":`vec2(${c.slice(-2).join()})`,h=n==="reflect"?0:1,p="";if(r===1){let m=`
        ${a} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${u});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${u});
        }
      `}else{let m=`
        ${a} source = rc;
        ${a} lt = ${a}(lessThan(source, start));
        ${a} gte = ${a}(greaterThanEqual(source, end));
        ${a} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;p=`
        ${a} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${u});
        ${l[r-1]} += 1;
        if(${d}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${u});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${u});
          ${l[r-1]} += 1;
          if(${d}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${u});
          }
        }
      `}this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${o});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}},Aze=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{paddings:a,mode:s}=n,o=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Eze(r.shape,a,s):new Tze(r.shape,a,s);return t.runWebGLProgram(o,[r],r.dtype)},Rze={kernelName:mp,backendName:"webgl",kernelFunc:Aze},Dze=`if (b == 0.0) return NAN;
  return mod(a, b);`,Mze=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Qp+`
  return result;
`,$ze=Oa({opSnippet:Dze,packedOpSnippet:Mze}),Fze={kernelName:fp,backendName:"webgl",kernelFunc:$ze},Pze=class{constructor(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}},Oze=`
if (a == b) {
  return 1.0;
};
return a / b;`,Lze=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,h7=Oa({opSnippet:Oze,packedOpSnippet:Lze,checkOutOfBounds:!0}),zze={kernelName:Hh,backendName:"webgl",kernelFunc:h7},iP="return a - b;",p7=Oa({opSnippet:iP,packedOpSnippet:iP,supportsComplex:!0,cpuKernelImpl:AFe}),Bze={kernelName:zp,backendName:"webgl",kernelFunc:p7};function m7(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{dim:s}=r,o=E.parseAxisParam([s],a.shape),l=d7({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),c=z.expandShapeToKeepDim(l.shape,o),d=nt({inputs:{x:l},backend:n,attrs:{shape:c}}),u=p7({inputs:{a,b:d},backend:n}),h=l7({inputs:{x:u},backend:n}),p=sk({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),m=nt({inputs:{x:p},backend:n,attrs:{shape:c}}),f=h7({inputs:{a:h,b:m},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),f}var Wze={kernelName:Op,backendName:"webgl",kernelFunc:m7};function Uze(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:o,normalized:l}=r,c=l?a:m7({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),d=c.shape[0],u=c.shape[1],h=new Pze(d,u,s),p=[[o]],m=n.runWebGLProgram(h,[c],"int32",p);return l||n.disposeIntermediateTensorInfo(c),m}var Vze={kernelName:fg,backendName:"webgl",kernelFunc:Uze},Hze=qi+`
  return -x;
`,Gze=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function qze(e){let{inputs:t,backend:n}=e,{x:r}=t;if(n.shouldExecuteOnCPU([r])){let s=n.texData.get(r.dataId),[o,l]=hFe(s.values,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,o)}let a;return _e().getBool("WEBGL_PACK_UNARY_OPERATIONS")?a=new Wc(r.shape,Gze):a=new Xo(r.shape,Hze),n.runWebGLProgram(a,[r],r.dtype)}var Kze={kernelName:gg,backendName:"webgl",kernelFunc:qze},Yze=gl.nonMaxSuppressionV3Impl;function Xze(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=r,d=n.readSync(a.dataId),u=n.readSync(s.dataId),{selectedIndices:h}=Yze(d,u,o,l,c);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}var Zze={kernelName:yg,backendName:"webgl",kernelFunc:Xze},Qze=gl.nonMaxSuppressionV4Impl;function Jze(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:d}=r,u=n.readSync(a.dataId),h=n.readSync(s.dataId),{selectedIndices:p,validOutputs:m}=Qze(u,h,o,l,c,d);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([m]))]}var eBe={kernelName:bg,backendName:"webgl",kernelFunc:Jze},tBe=gl.nonMaxSuppressionV5Impl;function nBe(e){z.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:t,backend:n,attrs:r}=e,{boxes:a,scores:s}=t,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:d}=r,u=n.readSync(a.dataId),h=n.readSync(s.dataId),p=o,m=l,f=c,g=d,{selectedIndices:x,selectedScores:y}=tBe(u,h,p,m,f,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var rBe={kernelName:vg,backendName:"webgl",kernelFunc:nBe},aBe=class{constructor(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${n}),
                      float(index == coords.y)));
      }
    `}},sBe=e=>{let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:o,onValue:l,offValue:c}=r,d=E.sizeFromShape(a.shape),u=new aBe(d,o,l,c),h=nt({inputs:{x:a},backend:n,attrs:{shape:[d]}}),p=n.runWebGLProgram(u,[h],s);n.disposeIntermediateTensorInfo(h);let m=[...a.shape,o],f=nt({inputs:{x:p},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(p),f},iBe={kernelName:xp,backendName:"webgl",kernelFunc:sBe};function s1(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="complex64"){let a=vv({inputs:{input:r},backend:n}),s=s1({inputs:{x:a},backend:n}),o=ik({inputs:{input:r},backend:n}),l=s1({inputs:{x:o},backend:n}),c=Fu({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}else return wv({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:n})}var oBe={kernelName:Lg,backendName:"webgl",kernelFunc:s1};function f7(e){let{inputs:t,backend:n}=e,{x:r}=t;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let a=vv({inputs:{input:r},backend:n}),s=f7({inputs:{x:a},backend:n}),o=ik({inputs:{input:r},backend:n}),l=s1({inputs:{x:o},backend:n}),c=Fu({inputs:{real:s,imag:l},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}else return wv({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:n})}var lBe={kernelName:wg,backendName:"webgl",kernelFunc:f7};function cBe(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return S_({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,o=t[0].dtype;t.forEach(u=>{E.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),E.assert(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],c=t.map(u=>{let h=S_({inputs:{input:u},backend:n,attrs:{dim:a}});return l.push(h),h}),d=e7({inputs:c,backend:n,attrs:{axis:a}});return l.forEach(u=>n.disposeIntermediateTensorInfo(u)),d}var uBe={kernelName:Ng,backendName:"webgl",kernelFunc:cBe},dBe=class{constructor(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((c,d)=>c[0]+e[d]+c[1]);let r=e.length,a=fr(r),s=t.map(c=>c[0]).join(","),o=t.map((c,d)=>c[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${s};
        int end = ${o};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${a} start = ${a}(${s});
      ${a} end = ${a}(${o});

      void main() {
        ${a} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${a} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}},hBe=class{constructor(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((f,g)=>f[0]+e[g]+f[1]);let r=e.length,a=fr(r),s=t.map(f=>f[0]).join(","),o=t.map((f,g)=>f[0]+e[g]).join(","),l=Ya("rc",r),c=Ya("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,u=r===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${a} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],p=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let f=0,g=r===1?2:4;f<g;f++)m+=`
        ${h[f]}
        if (${p}) {
          result[${f}] = float(value);
        } else {
          ${a} source = rc - start;
          result[${f}] = getChannel(getX(${c.join()}), ${u});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${a} start = ${a}(${s});
      const ${a} end = ${a}(${o});

      void main() {
        ${a} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}},g7=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{paddings:s,constantValue:o}=r;if(E.sizeFromShape(a.shape)===0){let d=s.map((u,h)=>u[0]+a.shape[h]+u[1]);return wv({backend:n,attrs:{shape:d,value:o,dtype:a.dtype}})}let l=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hBe(a.shape,s,o):new dBe(a.shape,s,o),c=[[o]];return n.runWebGLProgram(l,[a],a.dtype,c)},pBe={kernelName:yp,backendName:"webgl",kernelFunc:g7},mBe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,fBe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Qp+`
  return result;
`,gBe=Oa({opSnippet:mBe,packedOpSnippet:fBe}),xBe={kernelName:bp,backendName:"webgl",kernelFunc:gBe};function yBe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,keepDims:o}=r,l=a.shape.length,c=[],d=E.parseAxisParam(s,a.shape),u=d,h=z.getAxesPermutation(u,l),p=a;h!=null&&(p=es({inputs:{x:a},backend:n,attrs:{perm:h}}),u=z.getInnerMostAxes(u.length,l),c.push(p)),z.assertAxesAreInnerMostDims("prod",u,l);let m;if(n.shouldExecuteOnCPU([p])){let f=n.texData.get(p.dataId).values,{outVals:g,outShape:x,outDtype:y}=mFe(p.shape,p.dtype,f,u);m=n.makeTensorInfo(x,y,g)}else{let[f,g]=z.computeOutAndReduceShapes(p.shape,u),x=E.sizeFromShape(g),y=nt({inputs:{x:p},backend:n,attrs:{shape:[-1,x]}}),b=Q1(a.dtype),v=Jp(y,b,"prod",n);m=nt({inputs:{x:v},backend:n,attrs:{shape:f}}),c.push(y),c.push(v)}if(o){c.push(m);let f=z.expandShapeToKeepDim(m.shape,d);m=nt({inputs:{x:m},backend:n,attrs:{shape:f}})}return c.forEach(f=>n.disposeIntermediateTensorInfo(f)),m}var bBe={kernelName:wp,backendName:"webgl",kernelFunc:yBe};function vBe(e){let{inputs:t,backend:n,attrs:r}=e,{paramsNestedSplits:a,paramsDenseValues:s,indices:o}=t,{outputRaggedRank:l}=r,c=a.map(y=>n.readSync(y.dataId)),d=a.map(y=>y.shape),u=n.readSync(s.dataId),h=n.readSync(o.dataId),[p,m,f]=fFe(c,d,u,s.shape,s.dtype,h,o.shape,l),g=p.map(y=>n.makeTensorInfo([y.length],"int32",y)),x=n.makeTensorInfo(f,s.dtype,m);return g.concat([x])}var wBe={kernelName:q1,backendName:"webgl",kernelFunc:vBe};function NBe(e){let{inputs:t,backend:n}=e,{starts:r,limits:a,deltas:s}=t,o=n.readSync(r.dataId),l=n.readSync(a.dataId),c=n.readSync(s.dataId),[d,u]=gFe(o,r.shape,r.dtype,l,a.shape,c,s.shape),h=n.makeTensorInfo([d.length],"int32",d),p=n.makeTensorInfo([u.length],r.dtype,u);return[h,p]}var kBe={kernelName:K1,backendName:"webgl",kernelFunc:NBe};function SBe(e){let{inputs:t,backend:n,attrs:r}=e,{shape:a,values:s,defaultValue:o,rowPartitionTensors:l}=t,{rowPartitionTypes:c}=r,d=n.readSync(a.dataId),u=n.readSync(s.dataId),h=n.readSync(o.dataId),p=l.map(x=>n.readSync(x.dataId)),m=l.map(x=>x.shape),[f,g]=xFe(d,a.shape,u,s.shape,s.dtype,h,o.shape,p,m,c);return n.makeTensorInfo(f,s.dtype,g)}var CBe={kernelName:Y1,backendName:"webgl",kernelFunc:SBe},x7=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:o}=n,l=yFe(r,a,s,o);return t.makeTensorInfo([l.length],o,l)},_Be={kernelName:Rb,backendName:"webgl",kernelFunc:x7},jBe="return 1.0 / x;",IBe=Bn({opSnippet:jBe}),TBe={kernelName:Np,backendName:"webgl",kernelFunc:IBe},EBe=qi+`
  return (x < 0.0) ? 0.0 : x;
`,ABe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,RBe=Bn({opSnippet:EBe,packedOpSnippet:ABe}),DBe={kernelName:kp,backendName:"webgl",kernelFunc:RBe},MBe=qi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,$Be=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,FBe=Bn({opSnippet:MBe,packedOpSnippet:$Be}),PBe={kernelName:_p,backendName:"webgl",kernelFunc:FBe},OBe=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,o,l,c]=e;this.outputShape=[s,t,n,c];let d=[r&&t>1?o-1:o,r&&n>1?l-1:l],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h;a?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/u[0]},
          ${d[1]/u[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}},LBe=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,o,l,c]=e;this.outputShape=[s,t,n,c];let d=[r&&t>1?o-1:o,r&&n>1?l-1:l],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h;a?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/u[0]},
          ${d[1]/u[1]},
          ${d[1]/u[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function zBe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:l}=r,[c,d]=l,u=_e().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LBe(a.shape,c,d,s,o):new OBe(a.shape,c,d,s,o);return n.runWebGLProgram(u,[a],"float32")}var BBe={kernelName:Cp,backendName:"webgl",kernelFunc:zBe},WBe=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,o]=e,l=[n&&s>1?r-1:r,n&&o>1?a-1:a],c=[n&&s>1?s-1:s,n&&o>1?o-1:o],d=l[0]/c[0],u=l[1]/c[1],h=1/d,p=1/u,m=Math.ceil(h)*2+2,f=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${u});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${a-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function UBe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r,l=new WBe(s.shape,a.shape,o);return n.runWebGLProgram(l,[s],s.dtype)}var VBe={kernelName:Cg,backendName:"webgl",kernelFunc:UBe},HBe=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.outputShape=[];let[s,o,l,c]=e;this.outputShape=[s,t,n,c];let d=[r&&t>1?o-1:o,r&&n>1?l-1:l],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0",p;a?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/u[0]},
          ${d[1]/u[1]});
      const vec2 inputShapeRC = vec2(${o}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}},GBe=class{constructor(e,t,n,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,o,l,c]=e;this.outputShape=[s,t,n,c];let d=[r&&t>1?o-1:o,r&&n>1?l-1:l],u=[r&&t>1?t-1:t,r&&n>1?n-1:n],h=r?"0.5":"0.0",p;a?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/u[0]},
          ${d[1]/u[1]},
          ${d[1]/u[1]});
      const vec3 inputShapeRC = vec3(${o}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function qBe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a}=t,{alignCorners:s,halfPixelCenters:o,size:l}=r,[c,d]=l,u=_e().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new GBe(a.shape,c,d,s,o):new HBe(a.shape,c,d,s,o);return n.runWebGLProgram(u,[a],a.dtype)}var KBe={kernelName:Sp,backendName:"webgl",kernelFunc:qBe},YBe=class{constructor(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;let[,r,a]=t,[,s,o]=e,l=[n&&s>1?r-1:r,n&&o>1?a-1:a],c=[n&&s>1?s-1:s,n&&o>1?o-1:o],d=l[0]/c[0],u=l[1]/c[1],h=1/d,p=1/u,m=Math.ceil(h)*2+2,f=Math.ceil(p)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${u});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${p});

        const int winHeight = int(${m});
        const int winWidth = int(${f});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${o}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${a}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function XBe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r,l=new YBe(s.shape,a.shape,o);return n.runWebGLProgram(l,[s],s.dtype)}var ZBe={kernelName:Sg,backendName:"webgl",kernelFunc:XBe},QBe=class{constructor(e,t){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let r=o=>t.indexOf(o)!==-1&&e[o]!==1?`${e[o]} - coords[${o}] - 1`:`coords[${o}]`,a=e.map((o,l)=>r(l)).join(","),s=fr(n);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}},JBe=class{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let r=Ya("rc",n),a=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,s=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,o=fr(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${a}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${a}){
            result.g = ${c(r.slice())};
          }
          if(${s}) {
            result.b = ${d(r.slice())};
            if(${a}) {
              result.a = ${u(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return h(m)}function c(m){return m[n-1]="("+m[n-1]+" + 1)",h(m)}function d(m){return m[n-2]="("+m[n-2]+" + 1)",h(m)}function u(m){return m[n-1]="("+m[n-1]+" + 1)",m[n-2]="("+m[n-2]+" + 1)",h(m)}function h(m){let f=e.map((y,b)=>p(b,m)),g=f.join(","),x=f.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function p(m,f){return t.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${f[m]} - 1`:`${f[m]}`}}};function e6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,o=a.shape.length,l=E.parseAxisParam(s,a.shape);if(o===0)return Xs({inputs:{x:a},backend:n});let c=_e().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JBe(a.shape,l):new QBe(a.shape,l);return n.runWebGLProgram(c,[a],a.dtype)}var t6e={kernelName:jp,backendName:"webgl",kernelFunc:e6e},n6e=class{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],r=e[2];this.outputShape=e;let a="";typeof t=="number"?a=`float outputValue = ${t.toFixed(2)};`:a=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${a}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}},r6e={kernelName:zg,backendName:"webgl",kernelFunc:({inputs:e,attrs:t,backend:n})=>{let{image:r}=e,{radians:a,fillValue:s,center:o}=t,l=n,c=new n6e(r.shape,s),[d,u]=z.getImageCenter(o,r.shape[1],r.shape[2]),h=[[d,u,Math.sin(a),Math.cos(a)]];return l.runWebGLProgram(c,[r],r.dtype,h)}},a6e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,s6e=Bn({opSnippet:a6e}),i6e={kernelName:Ip,backendName:"webgl",kernelFunc:s6e},o6e="return inversesqrt(x);",l6e=Bn({opSnippet:o6e,cpuKernelImpl:bFe}),c6e={kernelName:Tp,backendName:"webgl",kernelFunc:l6e},dR=class{constructor(e,t,n,r,a,s,o=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let c=fr(a.length),d=fr(s.length),u="";n===1?u="i":n===2&&(u="i, j");let h=`getIndices(${u})`,p="";r===1?p="i":r===2&&(p="i, coords[1]");let m=`getUpdates(${p})`,f="";l&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,x=t>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}},u6e=class{constructor(e,t,n,r,a,s,o=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let c=fr(a.length),d=fr(s.length),u="";n===1?u="i":n===2&&(u="i, j");let h=`getIndices(${u})`,p="";r===1?p="i":r===2&&(p="i, coords[1]");let m=`getUpdates(${p})`,f="";l&&(f="coords[0], coords[1]");let g=`getDefaultValue(${f})`,x=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${a});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}};function d6e(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a,updates:s}=t,{shape:o}=r,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=z.calculateShapes(s,a,o),p=[h/d,d];if(h===0)return n.makeTensorInfo(o,a.dtype);let m=nt({inputs:{x:a},backend:n,attrs:{shape:[c,l]}}),f=nt({inputs:{x:s},backend:n,attrs:{shape:[c,d]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),x;_e().getBool("WEBGL_PACK")?x=new u6e(c,l,m.shape.length,f.shape.length,u,p):x=new dR(c,l,m.shape.length,f.shape.length,u,p);let y=n.runWebGLProgram(x,[f,m,g],f.dtype),b=nt({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}var h6e={kernelName:_g,backendName:"webgl",kernelFunc:d6e},p6e=class{constructor(e,t,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let a="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,o=_e().getNumber("WEBGL_VERSION")===2?a:s,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${o}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function m6e(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:o}=r,l=new p6e(a.shape[0],a.shape[1],s.shape[1],o),c=[[a.shape[1]]];return n.runWebGLProgram(l,[a,s],"int32",c)}var f6e={kernelName:Ig,backendName:"webgl",kernelFunc:m6e},g6e=class{constructor(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;let r,a;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)a="resRC",r="resRC";else{let o=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let d=0;d<t.length;d++)c.push(`${o[d]}`),d<e&&l.push(`${o[d]}`);r=l.join(),a=c.join()}let s=fr(n);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${a}));
        } else {
          setOutput(getB(${a}));
        }
      }
    `}};function x6e(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,o=new g6e(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,s],mi(a.dtype,s.dtype))}var y6e={kernelName:Tg,backendName:"webgl",kernelFunc:x6e},b6e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${z.SELU_SCALEALPHA};
  float scale = ${z.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,v6e=Bn({opSnippet:b6e}),w6e={kernelName:Ep,backendName:"webgl",kernelFunc:v6e},N6e=sx+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,k6e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,S6e=Bn({opSnippet:N6e,packedOpSnippet:k6e,cpuKernelImpl:wFe}),C6e={kernelName:Mp,backendName:"webgl",kernelFunc:S6e},_6e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,j6e=Bn({opSnippet:_6e}),I6e={kernelName:Dp,backendName:"webgl",kernelFunc:j6e},T6e=sx+`
  return sin(x);
`,E6e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Qp}
  return result;
`,A6e=Bn({opSnippet:T6e,packedOpSnippet:E6e}),R6e={kernelName:Ap,backendName:"webgl",kernelFunc:A6e},D6e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,M6e=Bn({opSnippet:D6e}),$6e={kernelName:Rp,backendName:"webgl",kernelFunc:M6e},F6e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,P6e=Bn({opSnippet:F6e}),O6e={kernelName:$p,backendName:"webgl",kernelFunc:P6e},L6e=e=>{let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:o}=r;E.assert(a.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let l=s.reduce((y,b)=>y*b),c=[[0,0]];c.push(...o);for(let y=1+s.length;y<a.shape.length;++y)c.push([0,0]);let d=[],u=g7({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),h=z.getReshaped(u.shape,s,l,!1),p=z.getPermuted(h.length,s.length,!1),m=z.getReshapedPermuted(u.shape,s,l,!1),f=nt({inputs:{x:u},backend:n,attrs:{shape:h}}),g=es({inputs:{x:f},backend:n,attrs:{perm:p}}),x=nt({inputs:{x:g},backend:n,attrs:{shape:m}});return d.push(u),d.push(f),d.push(g),d.forEach(y=>n.disposeIntermediateTensorInfo(y)),x},z6e={kernelName:Ag,backendName:"webgl",kernelFunc:L6e};function B6e(e){let{inputs:t,backend:n}=e,{indices:r,values:a,denseShape:s,defaultValue:o}=t;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${a.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);let l=n.readSync(r.dataId),c=n.readSync(a.dataId),d=n.readSync(s.dataId),u=n.readSync(o.dataId)[0],[h,p,m,f,g]=kFe(l,r.shape,r.dtype,c,a.dtype,d,u);return[n.makeTensorInfo(p,r.dtype,h),n.makeTensorInfo([p[0]],a.dtype,m),n.makeTensorInfo([f.length],"bool",new Uint8Array(f.map(x=>Number(x)))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}var W6e={kernelName:Db,backendName:"webgl",kernelFunc:B6e};function U6e(e){let{inputs:t,backend:n}=e,{inputIndices:r,inputShape:a,newShape:s}=t;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let o=Array.from(n.readSync(a.dataId)),l=n.readSync(r.dataId),c=Array.from(n.readSync(s.dataId)),[d,u,h]=SFe(l,r.shape,r.dtype,o,c);return[n.makeTensorInfo(u,r.dtype,d),n.makeTensorInfo([h.length],s.dtype,new Int32Array(h))]}var V6e={kernelName:Dg,backendName:"webgl",kernelFunc:U6e};function H6e(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let o=n.readSync(r.dataId),l=n.readSync(a.dataId),c=n.readSync(s.dataId),[d,u]=L9(o,r.shape,r.dtype,l,c,!0);return n.makeTensorInfo(u,r.dtype,d)}var G6e={kernelName:Mb,backendName:"webgl",kernelFunc:H6e};function q6e(e){let{inputs:t,backend:n}=e,{data:r,indices:a,segmentIds:s}=t;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${a.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let o=n.readSync(r.dataId),l=n.readSync(a.dataId),c=n.readSync(s.dataId),[d,u]=L9(o,r.shape,r.dtype,l,c);return n.makeTensorInfo(u,r.dtype,d)}var K6e={kernelName:$b,backendName:"webgl",kernelFunc:q6e};function Y6e(e){let{inputs:t,backend:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:o}=t,{outputShape:l}=r,{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=z.calculateShapes(s,a,l),m=!1;if(s.dtype==="string"){let y=n.bufferSync(a),b=n.bufferSync(s),v=E.decodeString(n.readSync(o.dataId)[0]),w=vFe(y,b,l,p,u,d,c,h,v,m);return n.makeTensorInfo(l,w.dtype,w.values)}let f=new dR(d,c,a.shape.length,s.shape.length,h,[p,1],m),g=n.runWebGLProgram(f,[s,a,o],s.dtype),x=nt({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(g),x}var X6e={kernelName:Mg,backendName:"webgl",kernelFunc:Y6e};function Z6e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:o}=r,l=E.parseAxisParam(o,a.shape)[0],c=z.prepareSplitSize(a,s,l),d=a.shape.length,u=new Array(d).fill(0),h=a.shape.slice();return c.map(p=>{let m=[...h];m[l]=p;let f=ix({inputs:{x:a},backend:n,attrs:{begin:u,size:m}});return u[l]+=p,f})}var Q6e={kernelName:Rg,backendName:"webgl",kernelFunc:Z6e},oP="return sqrt(x);",J6e=Bn({opSnippet:oP,packedOpSnippet:oP,cpuKernelImpl:CFe}),eWe={kernelName:Fp,backendName:"webgl",kernelFunc:J6e},tWe="return x * x;",nWe=Bn({opSnippet:tWe}),rWe={kernelName:Fb,backendName:"webgl",kernelFunc:nWe},lP="return (a - b) * (a - b);",aWe=Oa({opSnippet:lP,packedOpSnippet:lP}),sWe={kernelName:Lp,backendName:"webgl",kernelFunc:aWe};function iWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t;if(a.dtype!=="string")throw new Error("Input must be of datatype string");let s=n.readSync(a.dataId),o=z.fromUint8ToStringArray(s),l=_Fe(o,"string",r);return n.makeTensorInfo(a.shape,"string",l)}var oWe={kernelName:Pb,backendName:"webgl",kernelFunc:iWe};function lWe({inputs:e,attrs:t,backend:n}){let{x:r}=e,a=qi+`
    return x > 0.0 ? 1.0 : float(${t.alpha});
  `,s=new Xo(r.shape,a);return n.runWebGLProgram(s,[r],r.dtype)}var cWe={kernelName:Tu,backendName:"webgl",kernelFunc:lWe},uWe=class{constructor(e,t,n){this.variableNames=["x"],this.outputShape=n;let r=n.length,a=fr(n.length),s=fr(n.length),o="";if(r===1)o="coords * strides + begin";else{let l=0;o=n.map((c,d)=>(l++,n.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${a} begin = ${a}(${e});
      ${a} strides = ${a}(${t});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}};function dWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{begin:s,end:o,strides:l,beginMask:c,endMask:d,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=da.sliceInfo(a.shape,s,o,l,c,d,u,h,p),k;if(g)k=nt({inputs:{x:a},backend:n,attrs:{shape:f}});else if(x||y){E.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let S=da.computeOutShape(b,v,w),_=ix({inputs:{x:a},backend:n,attrs:{begin:b,size:S}});k=nt({inputs:{x:_},backend:n,attrs:{shape:f}}),n.disposeIntermediateTensorInfo(_)}else if(n.shouldExecuteOnCPU([a])){let S=n.readSync(a.dataId),_=pn(a.shape,a.dtype,S),I=jFe(m,_,w,b);k=n.makeTensorInfo(f,a.dtype,I.values)}else{let S=new uWe(b,w,m);k=n.runWebGLProgram(S,[a],a.dtype)}let C=nt({inputs:{x:k},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(k),C}var hWe={kernelName:$g,backendName:"webgl",kernelFunc:dWe};function pWe(e){let{inputs:t,backend:n,attrs:r}=e,{separator:a,nGramWidths:s,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:d}=r,{data:u,dataSplits:h}=t,p=n.readSync(u.dataId),m=n.readSync(h.dataId),[f,g]=IFe(p,m,a,s,o,l,c,d);return[n.makeTensorInfo([f.length],"string",f),n.makeTensorInfo(h.shape,"int32",g)]}var mWe={kernelName:Ob,backendName:"webgl",kernelFunc:pWe};function fWe(e){let{inputs:t,backend:n,attrs:r}=e,{skipEmpty:a}=r,{input:s,delimiter:o}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);let l=n.readSync(s.dataId),c=n.readSync(o.dataId)[0],[d,u,h]=TFe(l,c,a),p=u.length;return[n.makeTensorInfo([p,2],"int32",d),n.makeTensorInfo([p],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(h))]}var gWe={kernelName:Lb,backendName:"webgl",kernelFunc:fWe};function xWe(e){let{inputs:t,backend:n,attrs:r}=e,{numBuckets:a}=r,{input:s}=t;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");let o=n.readSync(s.dataId),l=EFe(o,a);return n.makeTensorInfo(s.shape,"int32",l)}var yWe={kernelName:zb,backendName:"webgl",kernelFunc:xWe},bWe="return tan(x);",vWe=Bn({opSnippet:bWe}),wWe={kernelName:Bp,backendName:"webgl",kernelFunc:vWe},NWe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,kWe=Bn({opSnippet:NWe}),SWe={kernelName:Wp,backendName:"webgl",kernelFunc:kWe};function CWe(e){let{inputs:t,backend:n,attrs:r}=e,{tensor:a,indices:s,updates:o}=t,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=z.calculateShapes(o,s,a.shape),p=[h/d,d];if(h===0)return n.makeTensorInfo(a.shape,s.dtype);let m=nt({inputs:{x:s},backend:n,attrs:{shape:[c,l]}}),f=nt({inputs:{x:o},backend:n,attrs:{shape:[c,d]}}),g=nt({inputs:{x:a},backend:n,attrs:{shape:p}}),x=new dR(c,l,m.shape.length,f.shape.length,u,p,!1,!0),y=n.runWebGLProgram(x,[f,m,g],g.dtype),b=nt({inputs:{x:y},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}var _We={kernelName:jg,backendName:"webgl",kernelFunc:CWe},jWe=class{constructor(e,t){this.variableNames=["A"];let n=new Array(e.length);for(let s=0;s<n.length;s++)n[s]=e[s]*t[s];this.outputShape=n,this.rank=n.length;let r=fr(this.rank),a=IWe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${a}));
      }
    `}};function IWe(e){let t=e.length;if(t>5)throw Error(`Tile for rank ${t} is not yet supported`);if(t===1)return`imod(resRC, ${e[0]})`;let n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let a=0;a<e.length;a++)r.push(`imod(${n[a]}, ${e[a]})`);return r.join()}function y7(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{reps:s}=r;if(a.dtype==="string"||a.shape.length>5){let l=n.readSync(a.dataId),c=a.dtype==="string"?l.map(h=>E.decodeString(h)):l,d=pn(a.shape,a.dtype,c),u=RFe(d,s);return n.makeTensorInfo(u.shape,u.dtype,u.values)}let o=new jWe(a.shape,s);return n.runWebGLProgram(o,[a],a.dtype)}var TWe={kernelName:Iu,backendName:"webgl",kernelFunc:y7},EWe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},AWe=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function td(e,t){t!==null&&e.disposeIntermediateTensorInfo(t)}function cP(e){let t=1;for(;t<e;)t*=2;return t}function RWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{k:s,sorted:o}=r,l=_e().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=_e().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),d=a.shape,u=d[d.length-1];if(n.shouldExecuteOnCPU([a])||u<l||s>c){let I=n.readSync(a.dataId),[T,A]=DFe(I,d,a.dtype,s,o);return[n.makeTensorInfo(T.shape,T.dtype,T.values),n.makeTensorInfo(A.shape,A.dtype,A.values)]}if(s===0)return d[d.length-1]=0,[n.makeTensorInfo(d,a.dtype,[]),n.makeTensorInfo(d,"int32",[])];if(u===1)return[a,wv({attrs:{shape:d,dtype:"int32",value:0},backend:n})];let h=n.texData.get(a.dataId),p=h!==null&&h.isPacked,m=p?n.unpackTensor(a):a,f=E.sizeFromShape(d)/u,g=nt({inputs:{x:m},attrs:{shape:[f,u]},backend:n});p&&td(n,m);let x=cP(s),y=cP(u),b=null,v=()=>b===null?[g,g]:[g,b],w=(I,T,A)=>{let j=v(),D=new EWe(A),F=[[u],[b===null?1:0],[Number.NEGATIVE_INFINITY],[I],[T]],B=b;b=n.runWebGLProgram(D,j,"int32",F),td(n,B)};for(let I=1;I<x;I*=2){let T=I*2;for(let A=I;A>=1;A/=2)w(T,A,[f,y])}for(let I=y;I>x;I/=2){let T=v(),A=new AWe([f,I/2]),j=[[u],[b===null?1:0],[x]],D=b;b=n.runWebGLProgram(A,T,"int32",j),td(n,D);let F=x/2,B=F*2;for(let q=F;q>=1;q/=2)w(B,q,b.shape)}let k=b;b=ix({inputs:{x:b},backend:n,attrs:{begin:0,size:[f,s]}}),td(n,k);let C=u7({inputs:{x:g,indices:b},backend:n,attrs:{axis:1,batchDims:1}});td(n,g);let S=d.slice(0,-1);S.push(s),k=b,b=nt({inputs:{x:b},attrs:{shape:S},backend:n}),td(n,k);let _=C;return C=nt({inputs:{x:C},attrs:{shape:S},backend:n}),td(n,_),[C,b]}var DWe={kernelName:Fg,backendName:"webgl",kernelFunc:RWe},MWe=class{constructor(e,t,n,r,a,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let o=n==="nearest"?1:2,l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${a});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${a});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${o} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function $We(e){let{inputs:t,backend:n,attrs:r}=e,{image:a,transforms:s}=t,{interpolation:o,fillMode:l,fillValue:c,outputShape:d}=r,[u,h,p,m]=a.shape,[f,g]=d??[h,p],x=[u,f,g,m],y=new MWe(h,p,o,l,c,x);return n.runWebGLProgram(y,[a,s],"float32")}var FWe={kernelName:Pg,backendName:"webgl",kernelFunc:$We};function PWe(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t;Jg(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let o=r.readSync(s.dataId),{outputValues:l,outputShape:c,indices:d}=MFe(o,a,s.shape,s.dtype);return[r.makeTensorInfo(c,s.dtype,l),r.makeTensorInfo([d.length],"int32",d)]}var OWe={kernelName:Bb,backendName:"webgl",kernelFunc:PWe};function LWe(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let o=a,l=o.shape.length,c=a.shape[s],d=new Array(l-1),u=0;for(let g=0;g<l;g++)g!==s&&(d[u++]=o.shape[g]);let h=[],p=new Array(l).fill(0),m=o.shape.slice();m[s]=1;let f=new Array(c);for(let g=0;g<f.length;g++){p[s]=g;let x=ix({inputs:{x:o},backend:n,attrs:{begin:p,size:m}}),y=nt({inputs:{x},backend:n,attrs:{shape:d}});f[g]=y,h.push(x)}return h.forEach(g=>n.disposeIntermediateTensorInfo(g)),f}var zWe={kernelName:Og,backendName:"webgl",kernelFunc:LWe},BWe=class{constructor(e,t){this.variableNames=["x","segmentIds"];let n=e.windowSize,r=e.batchSize,a=e.inSize,s=e.numSegments,o=s*Math.ceil(a/n);this.outputShape=[r,o];let l="0.0",c="sumValue",d=Math.floor(n/4)*4,u=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";a%n>0&&(p=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return initializationValue;
        }
      `);let m="";a%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${a}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${d};
        if (${u===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${u===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${u===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}};function WWe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,segmentIds:s}=t,{numSegments:o}=r,l=a.shape.length,c=[],d=0,u=z.getAxesPermutation([d],l),h=a;u!=null&&(h=es({inputs:{x:a},backend:n,attrs:{perm:u}}),c.push(h),d=z.getInnerMostAxes(1,l)[0]);let p=z.segment_util.computeOutShape(h.shape,d,o),m=E.sizeFromShape([h.shape[d]]),f=nt({inputs:{x:h},backend:n,attrs:{shape:[-1,m]}});c.push(f);let g=Q1(a.dtype),x=(w,k,C,S,_)=>{let I=w.shape[0],T=w.shape[1],A=z.segment_util.segOpComputeOptimalWindowSize(T,_),j={windowSize:A,inSize:T,batchSize:I,numSegments:_},D=new BWe(j,k),F=n.compileAndRun(D,[w,C],S);if(c.push(F),F.shape[1]===_)return F;let B=x7({backend:n,attrs:{start:0,stop:_,step:1,dtype:"float32"}}),q=y7({inputs:{x:B},backend:n,attrs:{reps:[T/A]}});return c.push(B),c.push(q),x(F,k,q,S,_)},y=x(f,"unsortedSegmentSum",s,g,o),b=nt({inputs:{x:y},backend:n,attrs:{shape:p}}),v=b;if(u!=null){c.push(b);let w=z.getUndoAxesPermutation(u);v=es({inputs:{x:v},backend:n,attrs:{perm:w}})}return c.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}var UWe={kernelName:Wb,backendName:"webgl",kernelFunc:WWe},VWe=[jPe,TPe,RPe,$Pe,PPe,zPe,WPe,VPe,KPe,XPe,JPe,nOe,sOe,cOe,hOe,mOe,gOe,vOe,NOe,SOe,IOe,$Oe,POe,BOe,UOe,YOe,ZOe,t4e,uPe,a4e,c4e,p4e,b4e,N4e,S4e,_4e,I4e,R4e,$4e,O4e,z4e,W4e,V4e,q4e,Y4e,J4e,tLe,aLe,oLe,cLe,pLe,xLe,wLe,SLe,jLe,ILe,ELe,RLe,MLe,FLe,OLe,WLe,HLe,KLe,XLe,JLe,n5e,i5e,u5e,cPe,h5e,o4e,f5e,y5e,w5e,hPe,C5e,T5e,A5e,$5e,O5e,W5e,H5e,Y5e,J5e,nze,aze,lze,uze,hze,gze,yze,vze,Nze,Sze,Ize,Rze,Fze,Vze,fPe,Kze,Zze,eBe,rBe,HOe,iBe,lBe,uBe,pBe,xBe,mPe,bBe,wBe,kBe,CBe,_Be,GOe,zze,TBe,DBe,PBe,xPe,BBe,VBe,KBe,ZBe,t6e,r6e,i6e,c6e,h6e,f6e,y6e,w6e,C6e,I6e,R6e,$6e,DOe,Wze,O6e,z6e,W6e,V6e,G6e,K6e,X6e,Q6e,eWe,rWe,sWe,oWe,cWe,hWe,mWe,gWe,yWe,Bze,SPe,wWe,SWe,_We,TWe,DWe,FWe,CPe,OWe,zWe,UWe,oBe];for(let e of VWe)Ub(e);var Hn;(function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"})(Hn||(Hn={}));var Jy;(function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"})(Jy||(Jy={}));var b7;function HWe(e){b7=e.wasm.cwrap(th,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])}function GWe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s,bias:o,preluActivationWeights:l}=t;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");let{transposeA:c,transposeB:d,activation:u,leakyreluAlpha:h}=r,p=n.dataIdMap.get(a.dataId).id,m=n.dataIdMap.get(s.dataId).id,f=0;if(o!=null){let _=n.dataIdMap.get(o.dataId);if(_.shape.length!==1)throw new Error(`_FusedMatMul only supports rank-1 bias but got rank ${_.shape.length}.`);f=_.id}let g=l==null?0:n.dataIdMap.get(l.dataId).id,x=Jy[u];if(x==null)throw new Error(`${u} activation not yet supported for FusedConv2D in the wasm backend.`);let y=c?a.shape[2]:a.shape[1],b=d?s.shape[1]:s.shape[2],v=Bg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)),w=n.makeOutput([...v,y,b],a.dtype),k=n.dataIdMap.get(w.dataId).id,C=new Uint8Array(new Int32Array(a.shape).buffer),S=new Uint8Array(new Int32Array(s.shape).buffer);return b7(p,C,a.shape.length,m,S,s.shape.length,c,d,x,f,g,h||0,k),w}var qWe={kernelName:th,backendName:"wasm",setupFunc:HWe,kernelFunc:GWe};function Ln(e,t){let n;function r(s){n=s.wasm.cwrap(e,null,["number","number","number"])}function a(s){let{backend:o,inputs:{x:l}}=s,c=o.dataIdMap.get(l.dataId).id,d=o.makeOutput(l.shape,t||l.dtype),u=o.dataIdMap.get(d.dataId).id;return E.sizeFromShape(d.shape)===0||n(c,Hn[l.dtype],u),d}return{kernelName:e,backendName:"wasm",setupFunc:r,kernelFunc:a}}var KWe=Ln(Lf),YWe=Ln(Ch),XWe=Ln(_h);function na(e,t,n){let r;function a(o){r=o.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])}function s(o){let{backend:l,inputs:c}=o,{a:d,b:u}=c,h=l.dataIdMap.get(d.dataId).id,p=l.dataIdMap.get(u.dataId).id,m=n??d.dtype,f=z.assertAndGetBroadcastShape(d.shape,u.shape),g=l.makeOutput(f,m);if(E.sizeFromShape(f)===0)return g;let x=new Uint8Array(new Int32Array(d.shape).buffer),y=new Uint8Array(new Int32Array(u.shape).buffer),b=l.dataIdMap.get(g.dataId).id;return r(h,x,d.shape.length,p,y,u.shape.length,Hn[d.dtype],b),g}return{kernelName:e,backendName:"wasm",setupFunc:a,kernelFunc:s}}var ZWe=na(_u),v7;function QWe(e){v7=e.wasm.cwrap(jh,null,["array","number","number","number"])}function JWe(e){let{inputs:t,backend:n}=e,r=n.makeOutput(t[0].shape,t[0].dtype);if(E.sizeFromShape(r.shape)===0)return r;let a=t.map(l=>n.dataIdMap.get(l.dataId).id),s=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return v7(s,a.length,Hn[r.dtype],o),r}var eUe={kernelName:jh,backendName:"wasm",setupFunc:QWe,kernelFunc:JWe};function ok(e){let{inputs:{x:t},backend:n}=e;if(t.dtype==="string")return Qa(n.readSync(t.dataId),t.shape,t.dtype);let r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var tUe={kernelName:ep,backendName:"wasm",kernelFunc:ok},w7;function nUe(e){w7=e.wasm.cwrap(Fl,null,["number","array","number","number","number","array","number"])}function bu(e){let{inputs:t,backend:n,attrs:r}=e,[a,s]=aUe(t.x.shape,r.perm),o=!0;for(let f=0;f<s.length;f++)s[f]!==f&&(o=!1);let l=rUe(t.x.shape,r.perm),c={dataId:t.x.dataId,shape:a,dtype:t.x.dtype};if(o){let f=ok({inputs:t,backend:n});return f.shape=l,f}let d=n.makeOutput(l,c.dtype),u=n.dataIdMap.get(c.dataId).id,h=n.dataIdMap.get(d.dataId).id,p=new Uint8Array(new Int32Array(s).buffer),m=new Uint8Array(new Int32Array(c.shape).buffer);return w7(u,m,c.shape.length,Hn[c.dtype],h,p,s.length),d}function rUe(e,t){let n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e[t[r]];return n}function aUe(e,t){let n=[],r=[];for(let a=0;a<e.length;++a)e[a]!==1&&n.push(e[a]),e[t[a]]!==1&&r.push(t[a]);for(let a=0;a<r.length;++a){let s=-1;for(let o=0;o<r.length;++o)r[o]>=a&&(s===-1||r[s]>r[o])&&(s=o);r[s]=a}return[n,r]}var sUe={kernelName:Fl,backendName:"wasm",kernelFunc:bu,setupFunc:nUe};function Pu(e,t,n){let r=e.shape,a=e.shape.length,s=E.parseAxisParam(t,r),o=s,l=z.getAxesPermutation(o,a),c=null,d=!1;if(l!=null){let u=new Array(a);for(let p=0;p<u.length;p++)u[p]=r[l[p]];o=z.getInnerMostAxes(o.length,a),c=bu({inputs:{x:e},attrs:{perm:l},backend:n});let h=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(c.dataId).id!==h&&(d=!0)}return{transposed:c,originalAxes:s,axes:o,inputWasTransposed:d}}var N7;function iUe(e){N7=e.wasm.cwrap(zf,null,["number, number, number"])}function oUe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=o,{transposed:d,axes:u,originalAxes:h,inputWasTransposed:p}=Pu(o,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;c=d,l=b}let m=c.shape.length;z.assertAxesAreInnerMostDims("all",u,m);let[f,g]=z.computeOutAndReduceShapes(c.shape,u),x=E.sizeFromShape(g),y=t.makeOutput(f,o.dtype);if(E.sizeFromShape(c.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;N7(l,x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var lUe={kernelName:zf,backendName:"wasm",setupFunc:iUe,kernelFunc:oUe},k7;function cUe(e){k7=e.wasm.cwrap(Bf,null,["number, number, number"])}function uUe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=o,{transposed:d,axes:u,originalAxes:h,inputWasTransposed:p}=Pu(o,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;c=d,l=b}let m=c.shape.length;z.assertAxesAreInnerMostDims("any",u,m);let[f,g]=z.computeOutAndReduceShapes(c.shape,u),x=E.sizeFromShape(g),y=t.makeOutput(f,o.dtype);if(E.sizeFromShape(c.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;k7(l,x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var dUe={kernelName:Bf,backendName:"wasm",setupFunc:cUe,kernelFunc:uUe};function S7(e){let t;function n(a){t=a.wasm.cwrap(e,null,["number","number","number","number","number"])}function r(a){let{backend:s,inputs:o,attrs:l}=a,{axis:c}=l,{x:d}=o,u=s.dataIdMap.get(d.dataId).id,h=u,p=d,{transposed:m,axes:f,inputWasTransposed:g}=Pu(d,c,s);if(g){let k=s.dataIdMap.get(m.dataId).id;k!==u&&(p=m,h=k)}let x=p.shape.slice(0,-1),y=s.makeOutput(x,"int32"),b=s.dataIdMap.get(y.dataId).id,v=E.sizeFromShape(y.shape),w=p.shape[f[0]];return t(h,Hn[p.dtype],v,w,b),g&&s.disposeData(m.dataId),y}return{kernelName:e,backendName:"wasm",setupFunc:n,kernelFunc:r}}var hUe=S7(Wf),pUe=S7(Uf),mUe=Ln(Ih),fUe=Ln(Th),gUe=Ln(Eh),xUe=na(Rh),yUe=Ln(Ah),C7;function bUe(e){C7=e.wasm.cwrap(Dh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function vUe(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=n,u=z.computePool2DInfo(a.shape,o,l,1,c,d),h=u.filterHeight,p=u.filterWidth,m=u.padInfo.top,f=u.padInfo.right,g=u.padInfo.bottom,x=u.padInfo.left,y=u.strideHeight,b=u.strideWidth,v=u.inChannels;if(u.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${u.dataFormat}'. Please use 'channelsLast'.`);if(u.dilationWidth!==1||u.dilationHeight!==1)throw new Error(`was backend only supports average pooling with dilation = [1, 1], got [${u.dilationHeight}, ${u.dilationWidth}].`);let w=r.makeOutput(u.outShape,"float32"),k=r.dataIdMap.get(w.dataId).id;return C7(s,a.shape[0],a.shape[1],a.shape[2],h,p,m,f,g,x,y,b,v,k),w}var wUe={kernelName:Dh,backendName:"wasm",setupFunc:bUe,kernelFunc:vUe},_7;function NUe(e){_7=e.wasm.cwrap("AvgPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function kUe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=r,u=z.computePool3DInfo(a.shape,s,o,1,l,c,d),h=n.makeOutput(u.outShape,a.dtype);return _7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,u.batchSize,u.inChannels,u.inDepth,u.inHeight,u.inWidth,u.outDepth,u.outHeight,u.outWidth,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.effectiveFilterDepth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),h}var SUe={kernelName:Vf,backendName:"wasm",setupFunc:NUe,kernelFunc:kUe},j7;function CUe(e){j7=e.wasm.cwrap("AvgPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function _Ue(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=r,u=z.computePool3DInfo(s.shape,o,l,1,c,d),h=n.makeOutput(s.shape,s.dtype);return j7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,u.batchSize,u.inChannels,u.inDepth,u.inHeight,u.inWidth,u.outDepth,u.outHeight,u.outWidth,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.effectiveFilterDepth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left,u.filterDepth,u.filterHeight,u.filterWidth),h}var jUe={kernelName:kb,backendName:"wasm",setupFunc:CUe,kernelFunc:_Ue},I7;function IUe(e){I7=e.wasm.cwrap("AvgPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function TUe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c}=r,d=z.computePool2DInfo(s.shape,o,l,1,c),u=n.makeOutput(s.shape,s.dtype);return I7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(u.dataId).id,d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.effectiveFilterHeight,d.effectiveFilterWidth,d.padInfo.top,d.padInfo.left,d.filterHeight,d.filterWidth),u}var EUe={kernelName:Nb,backendName:"wasm",setupFunc:IUe,kernelFunc:TUe};function vs(e){let{inputs:t,attrs:n}=e,{x:r}=t,{shape:a}=n,s=E.sizeFromShape(r.shape),o=E.inferFromImplicitShape(a,s);return E.assert(s===E.sizeFromShape(o),()=>`new shape: ${o}, old shape: ${r.shape}. New shape and old shape must have the same number of elements.`),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var AUe={kernelName:kg,backendName:"wasm",kernelFunc:vs},T7;function RUe(e){T7=e.wasm.cwrap(Mh,null,["number","array","number","number","array","number","number","number","number"])}function DUe(e){let{inputs:t,backend:n,attrs:r}=e,{a,b:s}=t,{transposeA:o,transposeB:l}=r;if(a.dtype!=="float32"||s.dtype!=="float32")throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");let c=a.shape.length,d=s.shape.length,u=o?a.shape[c-2]:a.shape[c-1],h=l?s.shape[d-1]:s.shape[d-2],p=o?a.shape[c-1]:a.shape[c-2],m=l?s.shape[d-2]:s.shape[d-1],f=a.shape.slice(0,-2),g=s.shape.slice(0,-2),x=E.sizeFromShape(f),y=E.sizeFromShape(g),b=Bg.assertAndGetBroadcastShape(a.shape.slice(0,-2),s.shape.slice(0,-2)).concat([p,m]);E.assert(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${a.shape} and ${s.shape} and transposeA=${o} and transposeB=${l} must match.`);let v=o?[x,u,p]:[x,p,u],w=l?[y,m,h]:[y,h,m],k=vs({inputs:{x:a},backend:n,attrs:{shape:v}}),C=vs({inputs:{x:s},backend:n,attrs:{shape:w}}),S=n.dataIdMap.get(k.dataId).id,_=n.dataIdMap.get(C.dataId).id,I=o?k.shape[2]:k.shape[1],T=l?C.shape[1]:C.shape[2],A=Math.max(x,y),j=n.makeOutput([A,I,T],k.dtype),D=n.dataIdMap.get(j.dataId).id,F=new Uint8Array(new Int32Array(k.shape).buffer),B=new Uint8Array(new Int32Array(C.shape).buffer);return T7(S,F,k.shape.length,_,B,C.shape.length,o,l,D),n.disposeData(k.dataId),n.disposeData(C.dataId),j.shape=b,j}var MUe={kernelName:Mh,backendName:"wasm",setupFunc:RUe,kernelFunc:DUe};function bh(e){let{inputs:{x:t},attrs:{begin:n,size:r},backend:a}=e,[s,o]=da.parseSliceParams(t,n,r),l=da.isSliceContinous(t.shape,s,o),c=a.readSync(t.dataId),d=a.makeOutput(o,t.dtype),u=E.computeStrides(t.shape),h=a.dataIdMap.get(d.dataId);if(l){let f=da.computeFlatOffset(s,u);return t.dtype==="string"?h.stringBytes=c.slice(f,f+E.sizeFromShape(o)):a.typedArrayFromHeap(d).set(c.subarray(f,f+E.sizeFromShape(o))),d}if(t.dtype==="string"){let f=J0(c,s,o,t.shape,t.dtype);return h.stringBytes=f,d}let p=a.typedArrayFromHeap(d),m=t.shape.length;if(m===2)$Ue(c,u[0],p,s,o);else if(m===3)FUe(c,u[0],u[1],p,s,o);else if(m===4)PUe(c,u[0],u[1],u[2],p,s,o);else{let f=J0(c,s,o,t.shape,t.dtype);p.set(f)}return d}function $Ue(e,t,n,r,a){let s=0,o=r[0],l=r[1],c=o+a[0];for(let d=o;d<c;d++){let u=d*t+l;n.set(e.subarray(u,u+a[1]),s),s+=a[1]}}function FUe(e,t,n,r,a,s){let o=0,l=a[0],c=a[1],d=a[2],u=l+s[0],h=c+s[1];for(let p=l;p<u;p++)for(let m=c;m<h;m++){let f=p*t+m*n+d;r.set(e.subarray(f,f+s[2]),o),o+=s[2]}}function PUe(e,t,n,r,a,s,o){let l=0,c=s[0],d=s[1],u=s[2],h=c+o[0],p=d+o[1],m=u+o[2],f=s[3];for(let g=c;g<h;g++)for(let x=d;x<p;x++)for(let y=u;y<m;y++){let b=g*t+x*n+y*r+f;a.set(e.subarray(b,b+o[3]),l),l+=o[3]}}var OUe={kernelName:Eg,backendName:"wasm",kernelFunc:bh};function LUe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,crops:o}=r,l=s.reduce((y,b)=>y*b),c=z.getReshaped(a.shape,s,l),d=z.getPermuted(c.length,s.length),u=z.getReshapedPermuted(a.shape,s,l),h=z.getSliceBeginCoords(o,s.length),p=z.getSliceSize(u,o,s.length),m=vs({inputs:{x:a},backend:n,attrs:{shape:c}}),f=bu({inputs:{x:m},backend:n,attrs:{perm:d}}),g=vs({inputs:{x:f},backend:n,attrs:{shape:u}}),x=bh({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return n.disposeData(m.dataId),n.disposeData(f.dataId),n.disposeData(g.dataId),x}var zUe={kernelName:Hf,backendName:"wasm",kernelFunc:LUe},E7;function BUe(e){E7=e.wasm.cwrap(Gf,null,["number","number","boolean","number","number","number"])}function WUe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:o}=r,l=s.shape.reduce((h,p)=>h*p,1)!==0,c=a.shape.length===1?[o]:[a.shape[0],o],d=t.makeOutput(c,s.dtype);function u(h){return t.dataIdMap.get(h.dataId).id}return E7(u(a),o,l,u(s),Hn[s.dtype],u(d)),d}var UUe={kernelName:Gf,backendName:"wasm",setupFunc:BUe,kernelFunc:WUe},VUe=na(qf);function HUe(e){let{inputs:t,backend:n}=e,{s0:r,s1:a}=t,s=n.typedArrayFromHeap(r),o=n.typedArrayFromHeap(a),l=z.assertAndGetBroadcastShape(Array.from(s),Array.from(o));return n.makeOutput([l.length],"int32",void 0,new Int32Array(l))}var GUe={kernelName:Sb,backendName:"wasm",kernelFunc:HUe};function Ou(e){let{inputs:{x:t},attrs:{dtype:n},backend:r}=e,a=r.makeOutput(t.shape,n),s=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(s),a}var qUe={kernelName:$h,backendName:"wasm",kernelFunc:Ou},KUe=Ln(Fh),A7;function YUe(e){A7=e.wasm.cwrap(ju,null,["number","number","number","number"])}function XUe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{clipValueMin:s,clipValueMax:o}=r,l=n.dataIdMap.get(a.dataId).id,c=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(c.dataId).id;return A7(l,s,o,d),c}var ZUe={kernelName:ju,backendName:"wasm",setupFunc:YUe,kernelFunc:XUe};function R7(e){let{inputs:t,backend:n}=e,r=E.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map(m=>m.shape);z.assertParamsConsistent(a,r);let s=z.computeOutShape(t.map(m=>m.shape),r),o=t.filter(m=>E.sizeFromShape(m.shape)>0);if(o.length===1)return ok({inputs:{x:o[0]},backend:n});let l=n.makeOutput(s,t[0].dtype);if(E.sizeFromShape(s)===0)return l;if(o[0].dtype==="string"){let m=o.map(v=>{let w=[-1,E.sizeFromShape(v.shape.slice(r))];return vs({inputs:{x:v},backend:n,attrs:{shape:w}})}),f=m.map(v=>({vals:n.readSync(v.dataId),shape:v.shape}));s=z.computeOutShape(m.map(v=>v.shape),1);let g=m[0].shape[0]===1,x=PA(f,s,t[0].dtype,g),y=z.computeOutShape(o.map(v=>v.shape),r);l.shape=y;let b=n.dataIdMap.get(l.dataId);return b.stringBytes=z.fromStringArrayToUint8(x),m.forEach(v=>n.disposeData(v.dataId)),l}let c=E.sizeFromShape(o[0].shape.slice(0,r)),d=0,u=o.map(m=>{let f=E.sizeFromShape(m.shape.slice(r));return d+=f,f}),h=o.map(m=>n.typedArrayFromHeap(m)),p=n.typedArrayFromHeap(l);for(let m=0;m<c;m++){let f=m*d;for(let g=0;g<h.length;g++){let x=u[g],y=m*x,b=h[g].subarray(y,y+x);p.set(b,f),f+=x}}return l}var QUe={kernelName:Kf,backendName:"wasm",kernelFunc:R7},D7;function JUe(e){D7=e.wasm.cwrap(Ph,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function eVe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,o=r.dataIdMap.get(a.dataId).id,l=r.dataIdMap.get(s.dataId).id,{strides:c,dilations:d,pad:u,dimRoundingMode:h,dataFormat:p}=n,m=z.convertConv2DDataFormat(p),f=z.computeConv2DInfo(a.shape,s.shape,c,d,u,h,!1,m),g=f.filterHeight,x=f.filterWidth,y=f.padInfo.top,b=f.padInfo.right,v=f.padInfo.bottom,w=f.padInfo.left,k=f.dilationHeight,C=f.dilationWidth,S=f.strideHeight,_=f.strideWidth,I=f.inChannels,T=f.outChannels,A=f.padInfo.type==="SAME"?1:0;if(f.dataFormat!=="channelsLast")throw new Error(`wasm backend Conv2D does not support dataFormat:'${f.dataFormat}'. Please use 'channelsLast'.`);let j=r.makeOutput(f.outShape,"float32"),D=r.dataIdMap.get(j.dataId).id;return D7(o,a.shape[0],a.shape[1],a.shape[2],l,g,x,y,b,v,w,A,k,C,S,_,I,T,D),j}var tVe={kernelName:Ph,backendName:"wasm",setupFunc:JUe,kernelFunc:eVe},M7;function nVe(e){M7=e.wasm.cwrap(Oh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function rVe(e){let{backend:t,inputs:n,attrs:r}=e,{dy:a,filter:s}=n,{strides:o,pad:l,dataFormat:c,dimRoundingMode:d,inputShape:u}=r,h=1,p=z.convertConv2DDataFormat(c),m=z.computeConv2DInfo(u,s.shape,o,h,l,d,!1,p),{batchSize:f,filterHeight:g,filterWidth:x,inChannels:y,inHeight:b,inWidth:v,outChannels:w,outHeight:k,outWidth:C,strideHeight:S,strideWidth:_}=m,I=g-1-m.padInfo.top,T=x-1-m.padInfo.left,A=m.dataFormat==="channelsLast",j=E.computeStrides(m.inShape),D=E.computeStrides(a.shape),[F,B,q]=E.computeStrides(s.shape),$=j[0],L=A?j[1]:j[2],M=A?j[2]:1,X=A?1:j[1],G=D[0],W=A?D[1]:D[2],O=A?D[2]:1,U=A?1:D[1],K=t.makeOutput(m.inShape,"float32"),ce=t.dataIdMap.get(K.dataId).id,ne=t.dataIdMap.get(a.dataId).id,te=t.dataIdMap.get(s.dataId).id;return M7(ne,te,f,g,x,b,v,y,k,C,w,S,_,I,T,F,B,q,$,L,M,X,G,W,O,U,ce),K}var aVe={kernelName:Oh,backendName:"wasm",setupFunc:nVe,kernelFunc:rVe},$7;function sVe(e){$7=e.wasm.cwrap(Lh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function iVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c}=r;if(a.dtype!=="float32")throw new Error(`Tensor x must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(a.shape,s.shape,o,c,l),u=n.makeOutput(d.outShape,a.dtype);return $7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(u.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),u}var oVe={kernelName:Lh,backendName:"wasm",setupFunc:sVe,kernelFunc:iVe},F7;function lVe(e){F7=e.wasm.cwrap(Yf,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function cVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,dy:s}=t,{strides:o,pad:l,filterShape:c}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(a.shape,c,o,1,l),u=n.makeOutput(d.filterShape,s.dtype);return F7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(u.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),u}var uVe={kernelName:Yf,backendName:"wasm",setupFunc:lVe,kernelFunc:cVe},P7;function dVe(e){P7=e.wasm.cwrap(Xf,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function hVe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,filter:s}=t,{pad:o,strides:l,inputShape:c}=r;if(a.dtype!=="float32")throw new Error(`Tensor dy must have dtype float32, got ${a.dtype}`);if(s.dtype!=="float32")throw new Error(`Tensor filter must have dtype float32, got ${s.dtype}`);let d=z.computeConv3DInfo(c,s.shape,l,1,o),u=n.makeOutput(d.inShape,a.dtype);return P7(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(u.dataId).id,d.batchSize,d.inDepth,d.inHeight,d.inWidth,d.inChannels,d.outDepth,d.outHeight,d.outWidth,d.outChannels,d.strideDepth,d.strideHeight,d.strideWidth,d.dilationDepth,d.dilationHeight,d.dilationWidth,d.filterDepth,d.filterHeight,d.filterWidth,d.padInfo.front,d.padInfo.top,d.padInfo.left),u}var pVe={kernelName:Xf,backendName:"wasm",setupFunc:dVe,kernelFunc:hVe},mVe=Ln(zh),fVe=Ln(Bh),C_;(function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"})(C_||(C_={}));var O7;function gVe(e){O7=e.wasm.cwrap(Qf,null,["number","number","number","number","array","number","number","number","number","number"])}function xVe(e){let{backend:t,inputs:n,attrs:r}=e,{method:a,extrapolationValue:s,cropSize:o}=r,{image:l,boxes:c,boxInd:d}=n,u=c.shape[0],[h,p]=o,m=[u,h,p,l.shape[3]],f=t.dataIdMap.get(l.dataId),g;l.dtype!=="float32"&&(g=Ou({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),f=t.dataIdMap.get(g.dataId));let x=f.id,y=t.dataIdMap.get(c.dataId).id,b=t.dataIdMap.get(d.dataId).id,v=t.makeOutput(m,"float32"),w=t.dataIdMap.get(v.dataId).id,k=new Uint8Array(new Int32Array(l.shape).buffer);return O7(x,y,b,u,k,h,p,C_[a],s,w),g!=null&&t.disposeData(g.dataId),v}var yVe={kernelName:Qf,backendName:"wasm",setupFunc:gVe,kernelFunc:xVe},L7;function bVe(e){L7=e.wasm.cwrap(Zf,null,["number","number","number","number","number","number"])}function vVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r,c=a.shape.length;E.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumprod does not support ${a.dtype} tensors in the WASM backend`);let d=z.getAxesPermutation([s],c),u=a;d!==null&&(u=bu({inputs:{x:a},attrs:{perm:d},backend:n}));let h=z.getInnerMostAxes(1,c)[0];z.assertAxesAreInnerMostDims("cumprod",[h],c);let p=n.makeOutput(u.shape,u.dtype),m=u.shape[h],f=n.dataIdMap.get(u.dataId).id,g=n.dataIdMap.get(p.dataId).id;L7(f,o?1:0,l?1:0,m,g,Hn[a.dtype]);let x=p;if(d!==null){let y=z.getUndoAxesPermutation(d);x=bu({inputs:{x:p},attrs:{perm:y},backend:n}),n.disposeData(u.dataId),n.disposeData(p.dataId)}return x}var wVe={kernelName:Zf,backendName:"wasm",setupFunc:bVe,kernelFunc:vVe},z7;function NVe(e){z7=e.wasm.cwrap(Wh,null,["number","number","number","number","number","number"])}function kVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{axis:s,exclusive:o,reverse:l}=r,c=a.shape.length;E.assert(a.dtype==="float32"||a.dtype==="int32",()=>`cumsum does not support ${a.dtype} tensors in the WASM backend`);let d=z.getAxesPermutation([s],c),u=a;d!==null&&(u=bu({inputs:{x:a},attrs:{perm:d},backend:n}));let h=z.getInnerMostAxes(1,c)[0];z.assertAxesAreInnerMostDims("cumsum",[h],c);let p=n.makeOutput(u.shape,u.dtype),m=u.shape[h],f=n.dataIdMap.get(u.dataId).id,g=n.dataIdMap.get(p.dataId).id;z7(f,o?1:0,l?1:0,m,g,Hn[a.dtype]);let x=p;if(d!==null){let y=z.getUndoAxesPermutation(d);x=bu({inputs:{x:p},attrs:{perm:y},backend:n}),n.disposeData(u.dataId),n.disposeData(p.dataId)}return x}var SVe={kernelName:Wh,backendName:"wasm",setupFunc:NVe,kernelFunc:kVe},B7;function CVe(e){B7=e.wasm.cwrap("DenseBincount",null,["number","array","number","number","boolean","number","number","boolean","number"])}function _Ve(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,weights:s}=n,{size:o,binaryOutput:l}=r,c=s.shape.reduce((p,m)=>p*m,1)!==0,d=a.shape.length===1?[o]:[a.shape[0],o],u=t.makeOutput(d,s.dtype);function h(p){return t.dataIdMap.get(p.dataId).id}return B7(h(a),new Uint8Array(new Int32Array(a.shape).buffer),a.shape.length,o,c,h(s),Hn[s.dtype],l,h(u)),u}var jVe={kernelName:_b,backendName:"wasm",setupFunc:CVe,kernelFunc:_Ve},W7;function IVe(e){W7=e.wasm.cwrap(Jf,null,["number","number","number","array","number","array","array","number","number"])}function TVe(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{blockSize:s,dataFormat:o}=r,l=a.shape[0],c=o==="NHWC"?a.shape[1]:a.shape[2],d=o==="NHWC"?a.shape[2]:a.shape[3],u=o==="NHWC"?a.shape[3]:a.shape[1],h=c*s,p=d*s,m=u/(s*s),f=o==="NHWC"?[l,h,p,m]:[l,m,h,p],g=t.makeOutput(f,"float32"),x=t.dataIdMap.get(a.dataId).id,y=new Uint8Array(new Int32Array(E.computeStrides(a.shape)).buffer),b=new Uint8Array(new Int32Array(f).buffer),v=new Uint8Array(new Int32Array(E.computeStrides(f)).buffer),w=t.dataIdMap.get(g.dataId).id;return W7(x,s,o==="NHWC"?1:0,y,a.shape.length-1,b,v,f.length,w),g}var EVe={kernelName:Jf,backendName:"wasm",setupFunc:IVe,kernelFunc:TVe},U7;function AVe(e){U7=e.wasm.cwrap(Uh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function RVe(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s}=t,o=r.dataIdMap.get(a.dataId).id,l=r.dataIdMap.get(s.dataId).id,{strides:c,dilations:d,pad:u,dimRoundingMode:h}=n,p=d??[1,1],m=z.computeConv2DInfo(a.shape,s.shape,c,p,u,h,!0),f=m.filterHeight,g=m.filterWidth,x=m.padInfo.top,y=m.padInfo.right,b=m.padInfo.bottom,v=m.padInfo.left,w=m.dilationHeight,k=m.dilationWidth,C=m.strideHeight,S=m.strideWidth,_=m.inChannels,I=m.outChannels,T=m.padInfo.type==="SAME"?1:0;if(m.dataFormat!=="channelsLast")throw new Error(`wasm backend DepthwiseConv2dNative does not support dataFormat:'${m.dataFormat}'. Please use 'channelsLast'.`);let A=r.makeOutput(m.outShape,"float32"),j=r.dataIdMap.get(A.dataId).id;return U7(o,a.shape[0],a.shape[1],a.shape[2],l,f,g,x,y,b,v,T,w,k,C,S,_,I,j),A}var DVe={kernelName:Uh,backendName:"wasm",setupFunc:AVe,kernelFunc:RVe},V7;function MVe(e){V7=e.wasm.cwrap("Diag",null,["number","number","number","number"])}function $Ve(e){let{inputs:t,backend:n}=e,{x:r}=t,a=E.sizeFromShape(r.shape),s=n.makeOutput([...r.shape,...r.shape],r.dtype);return V7(n.dataIdMap.get(r.dataId).id,Hn[r.dtype],a,n.dataIdMap.get(s.dataId).id),s}var FVe={kernelName:jb,backendName:"wasm",setupFunc:MVe,kernelFunc:$Ve},H7;function PVe(e){H7=e.wasm.cwrap(Vh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function OVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s}=t,{strides:o,pad:l,dilations:c}=r;if(a.dtype!==s.dtype)throw new Error(`Dilation2D error: x must have the same dtype as filter. Got ${a.dtype} and ${s.dtype}`);let d=z.computeDilation2DInfo(a.shape,s.shape,o,l,"NHWC",c),u=n.makeOutput(d.outShape,a.dtype);return H7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(u.dataId).id,Hn[a.dtype],d.batchSize,d.inChannels,d.inHeight,d.inWidth,d.outHeight,d.outWidth,d.strideHeight,d.strideWidth,d.dilationHeight,d.dilationWidth,d.filterHeight,d.filterWidth,d.padInfo.top,d.padInfo.left),u}var LVe={kernelName:Vh,backendName:"wasm",setupFunc:PVe,kernelFunc:OVe},G7;function zVe(e){G7=e.wasm.cwrap(hf,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function BVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:o}=t,{strides:l,pad:c,dilations:d}=r;if(a.dtype!==s.dtype||a.dtype!==o.dtype)throw new Error(`Dilation2DBackpropFilter error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${o.dtype}`);let u=z.computeDilation2DInfo(a.shape,s.shape,l,c,"NHWC",d),h=n.makeOutput(s.shape,s.dtype);return G7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(h.dataId).id,Hn[a.dtype],u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.filterHeight,u.filterWidth,u.padInfo.top,u.padInfo.left),h}var WVe={kernelName:hf,backendName:"wasm",setupFunc:zVe,kernelFunc:BVe},q7;function UVe(e){q7=e.wasm.cwrap(df,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function VVe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,filter:s,dy:o}=t,{strides:l,pad:c,dilations:d}=r;if(a.dtype!==s.dtype||a.dtype!==o.dtype)throw new Error(`Dilation2DBackpropInput error: x must have the same dtype as filter and dy. Got ${a.dtype}, ${s.dtype}, and ${o.dtype}`);let u=z.computeDilation2DInfo(a.shape,s.shape,l,c,"NHWC",d),h=n.makeOutput(a.shape,a.dtype);return q7(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(h.dataId).id,Hn[a.dtype],u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.filterHeight,u.filterWidth,u.padInfo.top,u.padInfo.left),h}var HVe={kernelName:df,backendName:"wasm",setupFunc:UVe,kernelFunc:VVe},GVe=Ln(Gh),K7;function qVe(e){K7=e.wasm.cwrap(eg,null,["number","number","number"])}function KVe(e){let{inputs:t,backend:n}=e,{dy:r,y:a}=t,s=n.makeOutput(a.shape,"float32"),o=l=>n.dataIdMap.get(l.dataId).id;return K7(o(a),o(r),o(s)),s}var YVe={kernelName:eg,backendName:"wasm",setupFunc:qVe,kernelFunc:KVe},XVe=!1,ZVe=na(tg,XVe,"bool"),QVe=Ln(qh),JVe=Ln(Kh,"float32");function __(e){let{inputs:t,attrs:n,backend:r}=e,{input:a}=t,{dim:s}=n,o=a.shape.length,l=a.shape.slice(),c=s;return s<0&&(E.assert(-(o+1)<=s,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+s+1),l.splice(c,0,1),vs({inputs:{x:a},backend:r,attrs:{shape:l}})}var e8e={kernelName:ng,backendName:"wasm",kernelFunc:__},t8e=Ln(Yh,"float32");function Y7(e){let{attrs:{shape:t,value:n},backend:r}=e,{attrs:{dtype:a}}=e;a=a||E.inferDtype(n);let s=r.makeOutput(t,a);return r.typedArrayFromHeap(s).fill(n),s}var n8e={kernelName:Ib,backendName:"wasm",kernelFunc:Y7},X7;function r8e(e){X7=e.wasm.cwrap(rg,null,["number","number","number","number","number","number"])}function a8e(e){let{inputs:t,backend:n}=e,{image:r}=t,a=n.makeOutput(r.shape,r.dtype),s=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,[l,c,d,u]=r.shape;return X7(s,l,c,d,u,o),a}var s8e={kernelName:rg,backendName:"wasm",kernelFunc:a8e,setupFunc:r8e},i8e=Ln(Xh),o8e=na(Zh),Z7;function l8e(e){Z7=e.wasm.cwrap(Qh,null,["number","number","number","number","number","number","number"])}function c8e(e){let{backend:t,inputs:n,attrs:r}=e,{varianceEpsilon:a}=r,{x:s,mean:o,variance:l,offset:c,scale:d}=n,u=t.dataIdMap.get(s.dataId).id,h=t.dataIdMap.get(o.dataId).id,p=t.dataIdMap.get(l.dataId).id,m=c!=null?t.dataIdMap.get(c.dataId).id:0,f=d!=null?t.dataIdMap.get(d.dataId).id:0,g=t.makeOutput(s.shape,s.dtype);if(E.sizeFromShape(s.shape)===0)return g;let x=t.dataIdMap.get(g.dataId).id;return Z7(u,h,p,m,f,a,x),g}var u8e={kernelName:Qh,backendName:"wasm",setupFunc:l8e,kernelFunc:c8e},Q7;function d8e(e){Q7=e.wasm.cwrap(nh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function h8e(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dilations:u,dataFormat:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=n,g=z.computeConv2DInfo(a.shape,s.shape,c,u,d,p),x=Jy[m];if(x==null)throw new Error(`${m} activation not yet supported for FusedConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(s.dataId).id,v=g.outChannels,w=0;if(o!=null){let O=r.dataIdMap.get(o.dataId);if(O.shape.length!==1)throw new Error(`FusedConv2D only supports rank-1 bias but got rank ${O.shape.length}.`);if(O.shape[0]!==v)throw new Error(`FusedConv2D bias shape (${O.shape}) does not match the number of output channels (${v})`);w=O.id}let k=g.filterHeight,C=g.filterWidth,S=g.padInfo.top,_=g.padInfo.right,I=g.padInfo.bottom,T=g.padInfo.left,A=g.dilationHeight,j=g.dilationWidth,D=g.strideHeight,F=g.strideWidth,B=g.inChannels,q=g.padInfo.type==="SAME"?1:0,$=g.batchSize,L=g.inHeight,M=g.inWidth;if(h!=="NHWC")throw new Error(`wasm backend FusedConv2D does not support dataFormat:'${h}'. Please use 'NHWC'.`);let X=r.makeOutput(g.outShape,"float32"),G=r.dataIdMap.get(X.dataId).id,W=l==null?0:r.dataIdMap.get(l.dataId).id;return Q7(y,$,L,M,b,k,C,w,S,_,I,T,q,A,j,D,F,B,v,x,W,f||0,G),X}var p8e={kernelName:nh,backendName:"wasm",setupFunc:d8e,kernelFunc:h8e},J7;function m8e(e){J7=e.wasm.cwrap(rh,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function f8e(e){let{inputs:t,attrs:n,backend:r}=e,{x:a,filter:s,bias:o,preluActivationWeights:l}=t,{strides:c,pad:d,dilations:u,dataFormat:h,dimRoundingMode:p,activation:m,leakyreluAlpha:f}=n,g=z.computeConv2DInfo(a.shape,s.shape,c,u,d,p,!0),x=Jy[m];if(x==null)throw new Error(`${m} activation not yet supported for FusedDepthwiseConv2D in the wasm backend.`);let y=r.dataIdMap.get(a.dataId).id,b=r.dataIdMap.get(s.dataId).id,v=g.outChannels,w=0;if(o!=null){let O=r.dataIdMap.get(o.dataId);if(O.shape.length!==1)throw new Error(`FusedDepthwiseConv2D only supports rank-1 bias but got rank ${O.shape.length}.`);if(O.shape[0]!==v)throw new Error(`FusedDepthwiseConv2D bias shape (${O.shape}) does not match the number of output channels (${v})`);w=O.id}let k=g.filterHeight,C=g.filterWidth,S=g.padInfo.top,_=g.padInfo.right,I=g.padInfo.bottom,T=g.padInfo.left,A=g.dilationHeight,j=g.dilationWidth,D=g.strideHeight,F=g.strideWidth,B=g.inChannels,q=g.padInfo.type==="SAME"?1:0,$=g.batchSize,L=g.inHeight,M=g.inWidth;if(h!=="NHWC")throw new Error(`wasm backend FusedDepthwiseConv2D does not support dataFormat:'${h}'. Please use 'NHWC'.`);let X=r.makeOutput(g.outShape,"float32"),G=r.dataIdMap.get(X.dataId).id,W=l==null?0:r.dataIdMap.get(l.dataId).id;return J7(y,$,L,M,b,k,C,w,S,_,I,T,q,A,j,D,F,B,v,x,W,f||0,G),X}var g8e={kernelName:rh,backendName:"wasm",setupFunc:m8e,kernelFunc:f8e},eq;function x8e(e){eq=e.wasm.cwrap(sg,null,["number","number","number","number","number","number","array","number"])}function y8e(e){let{backend:t,inputs:n}=e,{params:r,indices:a}=n,[s,o,l,c]=YT.prepareAndValidate(r,a),d=t.makeOutput(s,r.dtype);if(o===0)return d;let u=a.shape,h=u[u.length-1],p=t.dataIdMap.get(r.dataId).id,m=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(c).buffer),g=t.dataIdMap.get(d.dataId).id;return eq(p,Hn[r.dtype],m,o,h,l,f,g),d}var b8e={kernelName:sg,backendName:"wasm",setupFunc:x8e,kernelFunc:y8e},tq;function v8e(e){tq=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])}function w8e(e){let{backend:t,inputs:n,attrs:r}=e,{x:a,indices:s}=n,{axis:o,batchDims:l}=r,c=E.parseAxisParam(o,a.shape)[0],d=t.readSync(s.dataId),u=a.shape[c];for(let S=0;S<d.length;++S){let _=d[S];E.assert(_<=u-1&&_>=0,()=>`GatherV2: the index value ${_} is not in [0, ${u-1}]`)}let h=z.segment_util.collectGatherOpShapeInfo(a,s,c,l),p=vs({inputs:{x:a},attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]},backend:t}),m=E.sizeFromShape(s.shape),f=vs({inputs:{x:s},attrs:{shape:[h.batchSize,m/h.batchSize]},backend:t}),g=[h.batchSize,h.outerSize,m/h.batchSize,h.sliceSize],x=t.makeOutput(g,a.dtype);if(E.sizeFromShape(a.shape)===0)return x;let y=p.shape.length-1,b=t.dataIdMap.get(p.dataId).id,v=t.dataIdMap.get(f.dataId).id,w=t.dataIdMap.get(x.dataId).id,k=new Uint8Array(new Int32Array(E.computeStrides(p.shape)).buffer),C=new Uint8Array(new Int32Array(E.computeStrides(g)).buffer);return tq(b,Hn[a.dtype],k,y,v,h.batchSize,C,w),t.disposeData(p.dataId),t.disposeData(f.dataId),x.shape=h.outputShape,x}var N8e={kernelName:ag,backendName:"wasm",setupFunc:v8e,kernelFunc:w8e},k8e=!1,S8e=na(ig,k8e,"bool"),C8e=!1,_8e=na(Jh,C8e,"bool"),j8e=Ln(tp,"bool"),I8e=Ln(np,"bool"),T8e=Ln(rp,"bool"),nq;function E8e(e){nq=e.wasm.cwrap(ap,null,["number","number","number","number"])}function A8e(e){let{inputs:{x:t},attrs:{alpha:n},backend:r}=e,a=r.dataIdMap.get(t.dataId).id,s=r.makeOutput(t.shape,"float32");if(E.sizeFromShape(t.shape)!==0){let o=r.dataIdMap.get(s.dataId).id;nq(a,Hn[t.dtype],n,o)}return s}var R8e={kernelName:ap,backendName:"wasm",setupFunc:E8e,kernelFunc:A8e},D8e=!1,M8e=na(og,D8e,"bool"),$8e=!1,F8e=na(lg,$8e,"bool"),rq;function P8e(e){rq=e.wasm.cwrap(cg,null,["number","number","number","number"])}function O8e(e){let{attrs:t,backend:n}=e,{start:r,stop:a,num:s}=t,o=Math.floor(s),l=n.makeOutput([o],"float32");return rq(n.dataIdMap.get(l.dataId).id,r,a,o),l}var L8e={kernelName:cg,backendName:"wasm",setupFunc:P8e,kernelFunc:O8e},z8e=Ln(sp),B8e=Ln(ip),W8e=!1,U8e=na(ug,W8e,"bool"),V8e=Ln(dg),H8e=!1,G8e=na(hg,H8e,"bool"),q8e=!1,K8e=na(nW,q8e,"bool"),aq;function Y8e(e){aq=e.wasm.cwrap(op,null,["number","number","number","number","number","number","number"])}function X8e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{depthRadius:s,bias:o,alpha:l,beta:c}=r;if(a.dtype!=="float32")throw new Error("LRN error: x must have dtype float32");let d=n.makeOutput(a.shape,a.dtype);return aq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(d.dataId).id,a.shape[3],s,o,l,c),d}var Z8e={kernelName:op,backendName:"wasm",setupFunc:Y8e,kernelFunc:X8e},sq;function Q8e(e){sq=e.wasm.cwrap(pg,null,["number","number","number","number","number","number","number","number","number"])}function J8e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a,y:s,dy:o}=t,{depthRadius:l,bias:c,alpha:d,beta:u}=r;if(a.dtype!=="float32"||s.dtype!=="float32"||o.dtype!=="float32")throw new Error("LRNGrad error: x, y, and dy must have dtype float32");let h=n.makeOutput(a.shape,a.dtype);return sq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(o.dataId).id,n.dataIdMap.get(h.dataId).id,o.shape[3],l,c,d,u),h}var eHe={kernelName:pg,backendName:"wasm",setupFunc:Q8e,kernelFunc:J8e},iq;function tHe(e){iq=e.wasm.cwrap(lp,null,["number","number","number","number"])}function nHe(e){let{backend:t,inputs:n,attrs:r}=e,{reductionIndices:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=o,{transposed:d,axes:u,originalAxes:h,inputWasTransposed:p}=Pu(o,a,t);if(p){let b=t.dataIdMap.get(d.dataId).id;c=d,l=b}let m=c.shape.length;z.assertAxesAreInnerMostDims("max",u,m);let[f,g]=z.computeOutAndReduceShapes(c.shape,u),x=E.sizeFromShape(g),y=t.makeOutput(f,o.dtype);if(E.sizeFromShape(c.shape)!==0){let b=t.dataIdMap.get(y.dataId).id;iq(l,Hn[o.dtype],x,b)}if(p&&t.disposeData(d.dataId),s){let b=z.expandShapeToKeepDim(y.shape,h);y.shape=b}return y}var rHe={kernelName:lp,backendName:"wasm",setupFunc:tHe,kernelFunc:nHe},aHe=na(cp),oq;function sHe(e){oq=e.wasm.cwrap(up,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function iHe(e){let{inputs:t,attrs:n,backend:r}=e,a=t.x,s=r.dataIdMap.get(a.dataId).id;E.assert(a.dtype==="float32",()=>`Error in MaxPool: only float32 input is supported. Got ${a.dtype}.`);let{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=n,u=z.computePool2DInfo(a.shape,o,l,1,c,d),h=u.filterHeight,p=u.filterWidth,m=u.padInfo.top,f=u.padInfo.right,g=u.padInfo.bottom,x=u.padInfo.left,y=u.dilationHeight,b=u.dilationWidth,v=u.strideHeight,w=u.strideWidth,k=u.inChannels,C=u.outChannels;if(u.dataFormat!=="channelsLast")throw new Error(`wasm backend does not support dataFormat:'${u.dataFormat}'. Please use 'channelsLast'.`);let S=r.makeOutput(u.outShape,"float32"),_=r.dataIdMap.get(S.dataId).id;return oq(s,a.shape[0],a.shape[1],a.shape[2],h,p,m,f,g,x,y,b,v,w,k,C,_),S}var oHe={kernelName:up,backendName:"wasm",setupFunc:sHe,kernelFunc:iHe},lq;function lHe(e){lq=e.wasm.cwrap("MaxPool3D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function cHe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=r,u=z.computePool3DInfo(a.shape,s,o,1,l,c,d),h=n.makeOutput(u.outShape,a.dtype);return lq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,u.batchSize,u.inChannels,u.inDepth,u.inHeight,u.inWidth,u.outDepth,u.outHeight,u.outWidth,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.effectiveFilterDepth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),h}var uHe={kernelName:mg,backendName:"wasm",setupFunc:lHe,kernelFunc:cHe},cq;function dHe(e){cq=e.wasm.cwrap("MaxPool3DGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function hHe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=r,u=z.computePool3DInfo(s.shape,o,l,1,c,d),h=n.makeOutput(s.shape,s.dtype);return cq(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,u.batchSize,u.inChannels,u.inDepth,u.inHeight,u.inWidth,u.outDepth,u.outHeight,u.outWidth,u.strideDepth,u.strideHeight,u.strideWidth,u.dilationDepth,u.dilationHeight,u.dilationWidth,u.effectiveFilterDepth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.front,u.padInfo.top,u.padInfo.left),h}var pHe={kernelName:Eb,backendName:"wasm",setupFunc:dHe,kernelFunc:hHe},uq;function mHe(e){uq=e.wasm.cwrap("MaxPoolGrad",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function fHe(e){let{inputs:t,backend:n,attrs:r}=e,{dy:a,input:s}=t,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=r,u=z.computePool2DInfo(s.shape,o,l,1,c,d),h=n.makeOutput(s.shape,s.dtype);return uq(n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.top,u.padInfo.left),h}var gHe={kernelName:Tb,backendName:"wasm",setupFunc:mHe,kernelFunc:fHe},dq;function xHe(e){dq=e.wasm.cwrap("MaxPoolWithArgmax",null,["number","number","number","number","boolean","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])}function yHe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{filterSize:s,strides:o,pad:l,includeBatchInIndex:c}=r;E.assert(a.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.shape.length}.`);let d=[1,1];E.assert(z.eitherStridesOrDilationsAreOne(o,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);let u=z.computePool2DInfo(a.shape,s,o,[1,1],l),h=n.makeOutput(u.outShape,a.dtype),p=n.makeOutput(u.outShape,"int32");return dq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(h.dataId).id,n.dataIdMap.get(p.dataId).id,Hn[a.dtype],c,u.batchSize,u.inChannels,u.inHeight,u.inWidth,u.outHeight,u.outWidth,u.strideHeight,u.strideWidth,u.dilationHeight,u.dilationWidth,u.effectiveFilterHeight,u.effectiveFilterWidth,u.padInfo.top,u.padInfo.left),[h,p]}var bHe={kernelName:Ab,backendName:"wasm",setupFunc:xHe,kernelFunc:yHe},hq;function vHe(e){hq=e.wasm.cwrap(dp,null,["number, number, number"])}function wHe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=l,d=o,{transposed:u,axes:h,originalAxes:p,inputWasTransposed:m}=Pu(o,a,t),f=h;if(m){let w=t.dataIdMap.get(u.dataId).id;w!==l&&(d=u,c=w,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("mean",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=E.sizeFromShape(x),b=d;d.dtype!=="float32"&&(b=Ou({backend:t,inputs:{x:d},attrs:{dtype:"float32"}}),c=t.dataIdMap.get(b.dataId).id);let v=t.makeOutput(g,"float32");if(E.sizeFromShape(d.shape)!==0){let w=t.dataIdMap.get(v.dataId).id;hq(c,y,w)}if(m&&t.disposeData(u.dataId),s){let w=z.expandShapeToKeepDim(v.shape,p);v.shape=w}return d.dtype!=="float32"&&t.disposeData(b.dataId),v}var NHe={kernelName:dp,backendName:"wasm",setupFunc:vHe,kernelFunc:wHe},pq;function kHe(e){pq=e.wasm.cwrap(hp,null,["number","number","number","number"])}function SHe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=l,d=o,{transposed:u,axes:h,originalAxes:p,inputWasTransposed:m}=Pu(o,a,t);if(m){let v=t.dataIdMap.get(u.dataId).id;v!==l&&(d=u,c=v)}let f=d.shape.length;z.assertAxesAreInnerMostDims("min",h,f);let[g,x]=z.computeOutAndReduceShapes(d.shape,h),y=E.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(E.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;pq(c,Hn[o.dtype],y,v)}if(m&&t.disposeData(u.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var CHe={kernelName:hp,backendName:"wasm",setupFunc:kHe,kernelFunc:SHe},_He=na(pp),j_;(function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"})(j_||(j_={}));var mq;function jHe(e){mq=e.wasm.cwrap(mp,null,["number","array","number","number","array","array","number","number"])}function IHe(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,mode:a}}=e,s=r.map((f,g)=>f[0]+t.shape[g]+f[1]),o=n.dataIdMap.get(t.dataId).id,l=n.makeOutput(s,t.dtype),c=n.dataIdMap.get(l.dataId).id,d=new Uint8Array(new Int32Array(t.shape).buffer),u=r.map(f=>f[0]),h=r.map(f=>f[1]),p=new Uint8Array(new Int32Array(u).buffer),m=new Uint8Array(new Int32Array(h).buffer);return mq(o,d,t.shape.length,Hn[t.dtype],p,m,j_[a],c),l}var THe={kernelName:mp,backendName:"wasm",kernelFunc:IHe,setupFunc:jHe},fq;function EHe(e){fq=e.wasm.cwrap(Op,null,["number","number","number","number"])}function gq(e){let{backend:t,inputs:{logits:n},attrs:{dim:r}}=e,a=t.dataIdMap.get(n.dataId).id,s=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(s.dataId).id,l=n.shape[r],c=E.sizeFromShape(n.shape)/l;return E.sizeFromShape(s.shape)===0||fq(a,o,l,c),s}var AHe={kernelName:Op,backendName:"wasm",setupFunc:EHe,kernelFunc:gq},xq;function RHe(e){xq=e.wasm.cwrap(fg,null,["number","number","number","number","number","number"])}function DHe(e){let{inputs:t,backend:n,attrs:r}=e,{logits:a}=t,{numSamples:s,seed:o,normalized:l}=r;if(a.dtype!=="float32")throw new Error(`Tensor logits must have dtype float32, got ${a.dtype}`);let c=l?a:gq({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),[d,u]=c.shape,h=n.makeOutput([d,s],"int32");return xq(n.dataIdMap.get(c.dataId).id,d,u,s,o,n.dataIdMap.get(h.dataId).id),l||n.disposeData(c.dataId),h}var MHe={kernelName:fg,backendName:"wasm",setupFunc:RHe,kernelFunc:DHe},$He=na(fp),FHe=na(gp),PHe=Ln(gg);function hR(e,t){let n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],s=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:s,pValidOutputs:o}}var yq;function OHe(e){yq=e.wasm.cwrap(yg,"number",["number","number","number","number","number"])}function LHe(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:o}=r,{boxes:l,scores:c}=n,d=t.dataIdMap.get(l.dataId).id,u=t.dataIdMap.get(c.dataId).id,h=yq(d,u,s,a,o),{pSelectedIndices:p,selectedSize:m,pSelectedScores:f,pValidOutputs:g}=hR(t,h);return t.wasm._free(f),t.wasm._free(g),t.makeOutput([m],"int32",p)}var zHe={kernelName:yg,backendName:"wasm",setupFunc:OHe,kernelFunc:LHe},bq;function BHe(e){bq=e.wasm.cwrap(bg,"number",["number","number","number","number","number","bool"])}function WHe(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:o,padToMaxOutputSize:l}=r,{boxes:c,scores:d}=n,u=t.dataIdMap.get(c.dataId).id,h=t.dataIdMap.get(d.dataId).id,p=bq(u,h,s,a,o,l),{pSelectedIndices:m,selectedSize:f,pSelectedScores:g,pValidOutputs:x}=hR(t,p);t.wasm._free(g);let y=t.makeOutput([f],"int32",m),b=t.makeOutput([],"int32",x);return[y,b]}var UHe={kernelName:bg,backendName:"wasm",setupFunc:BHe,kernelFunc:WHe},vq;function VHe(e){vq=e.wasm.cwrap(vg,"number",["number","number","number","number","number","number"])}function HHe(e){let{backend:t,inputs:n,attrs:r}=e,{iouThreshold:a,maxOutputSize:s,scoreThreshold:o,softNmsSigma:l}=r,{boxes:c,scores:d}=n,u=t.dataIdMap.get(c.dataId).id,h=t.dataIdMap.get(d.dataId).id,p=vq(u,h,s,a,o,l),{pSelectedIndices:m,selectedSize:f,pSelectedScores:g,pValidOutputs:x}=hR(t,p);t.wasm._free(x);let y=t.makeOutput([f],"int32",m),b=t.makeOutput([f],"float32",g);return[y,b]}var GHe={kernelName:vg,backendName:"wasm",setupFunc:VHe,kernelFunc:HHe},qHe=!1,KHe=na(xg,qHe,"bool"),wq;function YHe(e){wq=e.wasm.cwrap(xp,null,["number","number","number","number","number"])}function XHe(e){let{inputs:t,backend:n,attrs:r}=e,{indices:a}=t,{dtype:s,depth:o,onValue:l,offValue:c}=r,d=n.makeOutput([...a.shape,o],s),u=n.dataIdMap.get(d.dataId).id,h=n.dataIdMap.get(a.dataId).id;return wq(h,o,l,c,u),d}var ZHe={kernelName:xp,backendName:"wasm",setupFunc:YHe,kernelFunc:XHe};function QHe(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}var JHe={kernelName:wg,backendName:"wasm",kernelFunc:QHe};function eGe(e){let{inputs:t,backend:n,attrs:r}=e,{axis:a}=r;if(t.length===1)return __({inputs:{input:t[0]},backend:n,attrs:{dim:a}});let s=t[0].shape,o=t[0].dtype;t.forEach(u=>{E.assertShapesMatch(s,u.shape,"All tensors passed to stack must have matching shapes"),E.assert(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let l=[],c=t.map(u=>{let h=__({inputs:{input:u},backend:n,attrs:{dim:a}});return l.push(h),h}),d=R7({inputs:c,backend:n,attrs:{axis:a}});return l.forEach(u=>n.disposeData(u.dataId)),d}var tGe={kernelName:Ng,backendName:"wasm",kernelFunc:eGe},Nq;function nGe(e){Nq=e.wasm.cwrap(yp,null,["number","array","number","number","array","array","number","number"])}function rGe(e){let{inputs:{x:t},backend:n,attrs:{paddings:r,constantValue:a}}=e,s=r.map((f,g)=>f[0]+t.shape[g]+f[1]);if(E.sizeFromShape(t.shape)===0)return Y7({backend:n,attrs:{shape:s,value:a,dtype:t.dtype}});let o=n.dataIdMap.get(t.dataId).id,l=n.makeOutput(s,t.dtype),c=n.dataIdMap.get(l.dataId).id,d=new Uint8Array(new Int32Array(t.shape).buffer),u=r.map(f=>f[0]),h=r.map(f=>f[1]),p=new Uint8Array(new Int32Array(u).buffer),m=new Uint8Array(new Int32Array(h).buffer);return Nq(o,d,t.shape.length,Hn[t.dtype],p,m,a,c),l}var kq={kernelName:yp,backendName:"wasm",kernelFunc:rGe,setupFunc:nGe},aGe=na(bp),Sq;function sGe(e){Sq=e.wasm.cwrap(vp,null,["number","number","number"])}function iGe(e){let{inputs:t,backend:n}=e,{x:r,alpha:a}=t,s=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,l=s,c=r,d=c;c.dtype!=="float32"&&(d=Ou({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),l=n.dataIdMap.get(d.dataId).id);let u=n.makeOutput(r.shape,"float32"),h=n.dataIdMap.get(u.dataId).id;return Sq(l,o,h),c.dtype!=="float32"&&n.disposeData(d.dataId),u}var oGe={kernelName:vp,backendName:"wasm",setupFunc:sGe,kernelFunc:iGe},Cq;function lGe(e){Cq=e.wasm.cwrap(wp,null,["number","number","number","number"])}function cGe(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=l,d=o,{transposed:u,axes:h,originalAxes:p,inputWasTransposed:m}=Pu(o,a,t),f=h;if(m){let v=t.dataIdMap.get(u.dataId).id;v!==l&&(d=u,c=v,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("prod",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=E.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(E.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;Cq(c,y,Hn[b.dtype],v)}if(m&&t.disposeData(u.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var uGe={kernelName:wp,backendName:"wasm",setupFunc:lGe,kernelFunc:cGe},dGe=e=>{let{backend:t,attrs:n}=e,{start:r,stop:a,step:s,dtype:o}=n,l=zA(r,a,s,o),c=t.makeOutput([l.length],o);return t.typedArrayFromHeap(c).set(l),c},hGe={kernelName:Rb,backendName:"wasm",kernelFunc:dGe},pGe=na(Hh),mGe=Ln(Np),fGe=Ln(kp),gGe=Ln(_p),_q;function xGe(e){_q=e.wasm.cwrap(Cp,null,["number","number","number","number","number","number","number","number","number","number"])}function yGe(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:o,size:l}=r,[c,d]=l,[u,h,p,m]=a.shape,f=[u,c,d,m],g=t.dataIdMap.get(a.dataId),x;g.dtype!=="float32"&&(x=Ou({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),g=t.dataIdMap.get(x.dataId));let y=g.id,b=t.makeOutput(f,"float32");if(E.sizeFromShape(a.shape)===0)return b;let v=t.dataIdMap.get(b.dataId).id;return _q(y,u,h,p,m,c,d,s?1:0,o?1:0,v),x!=null&&t.disposeData(x.dataId),b}var bGe={kernelName:Cp,backendName:"wasm",setupFunc:xGe,kernelFunc:yGe},jq;function vGe(e){jq=e.wasm.cwrap(Cg,null,["number","number","number","array","array","boolean"])}function wGe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r,l=n.makeOutput(a.shape,"float32"),c=n.dataIdMap.get(a.dataId),d;return c.dtype!=="float32"&&(d=Ou({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),c=n.dataIdMap.get(d.dataId)),jq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),o),d!=null&&n.disposeData(d.dataId),l}var NGe={kernelName:Cg,backendName:"wasm",setupFunc:vGe,kernelFunc:wGe},Iq;function kGe(e){Iq=e.wasm.cwrap(Sp,null,["number","number","number","number","number","number","number","number","number","number"])}function SGe(e){let{backend:t,inputs:n,attrs:r}=e,{images:a}=n,{alignCorners:s,halfPixelCenters:o,size:l}=r,[c,d]=l,[u,h,p,m]=a.shape,f=[u,c,d,m],g=t.makeOutput(f,"float32");if(E.sizeFromShape(a.shape)===0)return g;let x=t.dataIdMap.get(a.dataId),y;x.dtype!=="float32"&&(y=Ou({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(y.dataId));let b=x.id,v=t.dataIdMap.get(g.dataId).id;return Iq(b,u,h,p,m,c,d,s?1:0,o?1:0,v),y!=null&&t.disposeData(y.dataId),g}var CGe={kernelName:Sp,backendName:"wasm",setupFunc:kGe,kernelFunc:SGe},Tq;function _Ge(e){Tq=e.wasm.cwrap(Sg,null,["number","number","number","array","array","boolean"])}function jGe(e){let{inputs:t,backend:n,attrs:r}=e,{images:a,dy:s}=t,{alignCorners:o}=r,l=n.makeOutput(a.shape,"float32"),c=n.dataIdMap.get(a.dataId),d;return c.dtype!=="float32"&&(d=Ou({backend:n,inputs:{x:a},attrs:{dtype:"float32"}}),c=n.dataIdMap.get(d.dataId)),Tq(n.dataIdMap.get(a.dataId).id,n.dataIdMap.get(s.dataId).id,n.dataIdMap.get(l.dataId).id,new Uint8Array(new Int32Array(a.shape).buffer),new Uint8Array(new Int32Array(s.shape).buffer),o),d!=null&&n.disposeData(d.dataId),l}var IGe={kernelName:Sg,backendName:"wasm",setupFunc:_Ge,kernelFunc:jGe},Eq;function TGe(e){Eq=e.wasm.cwrap(jp,null,["number","array","number","array","number","number"])}function EGe(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{dims:s}=r,o=E.parseAxisParam(s,a.shape);if(a.shape.length===0)return ok({inputs:{x:a},backend:n});let l=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(l.dataId).id,u=new Uint8Array(new Int32Array(o).buffer),h=new Uint8Array(new Int32Array(a.shape).buffer);Eq(c,u,o.length,h,a.shape.length,d);let p=vs({inputs:{x:l},attrs:{shape:a.shape},backend:n});return n.disposeData(l.dataId),p}var AGe={kernelName:jp,backendName:"wasm",kernelFunc:EGe,setupFunc:TGe},Aq;function RGe(e){Aq=e.wasm.cwrap(zg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function DGe(e){let{inputs:t,backend:n,attrs:r}=e,{image:a}=t,{radians:s,fillValue:o,center:l}=r,c=n.makeOutput(a.shape,a.dtype),d=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(c.dataId).id,[h,p,m,f]=a.shape,[g,x]=z.getImageCenter(l,p,m),y=o===0,b=255,v=typeof o=="number"?[o,o,o,y?0:b]:[...o,b],w=new Uint8Array(new Int32Array(v).buffer);return Aq(d,h,p,m,f,s,g,x,w,v.length,u),c}var MGe={kernelName:zg,backendName:"wasm",kernelFunc:DGe,setupFunc:RGe},$Ge=Ln(Ip),FGe=Ln(Tp),Rq;function PGe(e){Rq=e.wasm.cwrap(_g,null,["number","number","number","number","number","number","array","number","number"])}function OGe(e){let{backend:t,inputs:n,attrs:r}=e,{indices:a,updates:s}=n,{shape:o}=r,l=t.makeOutput(o,s.dtype);if(E.sizeFromShape(o)===0)return l;let{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=kN.calculateShapes(s,a,o),m=t.dataIdMap.get(a.dataId).id,f=t.dataIdMap.get(s.dataId).id,g=new Uint8Array(new Int32Array(h).buffer),x=t.dataIdMap.get(l.dataId).id;return Rq(m,f,Hn[s.dtype],c,d,u,g,p,x),l}var LGe={kernelName:_g,backendName:"wasm",setupFunc:PGe,kernelFunc:OGe},Dq;function zGe(e){Dq=e.wasm.cwrap(Ig,null,["number","number","number","number","number","number","bool","number"])}function BGe(e){let{inputs:t,backend:n,attrs:r}=e,{sortedSequence:a,values:s}=t,{side:o}=r;if(a.dtype!==s.dtype)throw new Error(`SearchSorted error: sorted_sequence must have the same dtype as values. Got ${a.dtype} and ${s.dtype}`);let l=n.makeOutput(s.shape,"int32");function c(d){return n.dataIdMap.get(d.dataId).id}return Dq(c(a),c(s),a.shape[0],a.shape[1],s.shape[1],Hn[a.dtype],o==="left",c(l)),l}var WGe={kernelName:Ig,backendName:"wasm",setupFunc:zGe,kernelFunc:BGe},Mq;function UGe(e){Mq=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}function VGe(e){let{inputs:t,backend:n}=e,{condition:r,t:a,e:s}=t,o=n.dataIdMap.get(r.dataId).id,l=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,d=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(d.dataId).id,h=r.shape.length,p=a.shape.length,m=h===0||h>1||p===1?1:E.sizeFromShape(a.shape.slice(1));return Mq(o,l,c,m,u),d}var HGe={kernelName:Tg,backendName:"wasm",kernelFunc:VGe,setupFunc:UGe},GGe=Ln(Ep),$q;function qGe(e){$q=e.wasm.cwrap(Mp,null,["number","number"])}function KGe(e){let{backend:t,inputs:{x:n}}=e,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),s=t.dataIdMap.get(a.dataId).id;return E.sizeFromShape(a.shape)===0||$q(r,s),a}var YGe={kernelName:"Sigmoid",backendName:"wasm",setupFunc:qGe,kernelFunc:KGe},XGe=Ln(Dp),ZGe=Ln(Ap),QGe=Ln(Rp),JGe=Ln($p);function e9e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,{blockShape:s,paddings:o}=r,l=E.sizeFromShape(s),c=[[0,0]];c.push(...o);for(let x=1+s.length;x<a.shape.length;++x)c.push([0,0]);let d=kq.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),u=z.getReshaped(d.shape,s,l,!1),h=z.getPermuted(u.length,s.length,!1),p=z.getReshapedPermuted(d.shape,s,l,!1),m=vs({inputs:{x:d},backend:n,attrs:{shape:u}}),f=bu({inputs:{x:m},backend:n,attrs:{perm:h}}),g=vs({inputs:{x:f},backend:n,attrs:{shape:p}});return n.disposeData(d.dataId),n.disposeData(m.dataId),n.disposeData(f.dataId),g}var t9e={kernelName:Ag,backendName:"wasm",kernelFunc:e9e},Fq;function n9e(e){Fq=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])}function r9e(e){let{backend:t,inputs:n}=e,{indices:r,values:a,denseShape:s,defaultValue:o}=n,l=r.shape[0],c=r.shape[1],d=t.readSync(s.dataId)[0],u=[l+d,c],h=t.dataIdMap.get(r.dataId).id,p=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(o.dataId).id,f=t.makeOutput(u,r.dtype),g=t.dataIdMap.get(f.dataId).id,x=t.makeOutput(u.slice(0,1),a.dtype),y=t.dataIdMap.get(x.dataId).id,b=t.makeOutput([d],"bool"),v=t.dataIdMap.get(b.dataId).id,w=t.makeOutput([l],r.dtype),k=t.dataIdMap.get(w.dataId).id,C=t.makeOutput([4],"int32"),S=t.dataIdMap.get(C.dataId).id,_=Fq(h,p,Hn[a.dtype],l,d,c,m,g,y,v,k,S),I=t.readSync(C.dataId),T;switch(I[0]){case 1:{T=z.getSparseFillEmptyRowsIndicesDenseShapeMismatch(I[1]);break}case 2:{T=z.getSparseFillEmptyRowsNegativeIndexErrorMessage(I[1],I[2]);break}case 3:T=z.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(I[1],I[2],I[3]);break;default:T=""}if(t.disposeData(C.dataId),T)throw t.disposeData(f.dataId),t.disposeData(x.dataId),t.disposeData(b.dataId),t.disposeData(w.dataId),new Error(T);let A=f,j=x;return _!==u[0]&&(A=bh({inputs:{x:f},attrs:{begin:0,size:[_,c]},backend:t}),j=bh({inputs:{x},attrs:{begin:0,size:_},backend:t}),t.disposeData(f.dataId),t.disposeData(x.dataId)),[A,j,b,w]}var a9e={kernelName:Db,backendName:"wasm",setupFunc:n9e,kernelFunc:r9e},Pq;function s9e(e){Pq=e.wasm.cwrap(Dg,null,["number","number","number","number","number","number","number"])}function i9e(e){let{backend:t,inputs:n}=e,{inputIndices:r,inputShape:a,newShape:s}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${a.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let o=t.dataIdMap.get(r.dataId).id,l=t.dataIdMap.get(a.dataId).id,c=t.dataIdMap.get(s.dataId).id,d=r.shape[0],u=E.sizeFromShape(s.shape),h=t.makeOutput([d,u],r.dtype),p=t.dataIdMap.get(h.dataId).id,m=t.makeOutput([u],s.dtype),f=t.dataIdMap.get(m.dataId).id,g=t.makeOutput([3],"int32"),x=t.dataIdMap.get(g.dataId).id;Pq(o,l,c,d,p,f,x);let y=t.readSync(g.dataId),b;switch(y[0]){case 0:{b=z.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break}case 1:{b=z.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break}case 2:b=z.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:{let v=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(m.dataId));b=z.getSparseReshapeInputOutputMultipleErrorMessage(v,w);break}case 4:{let v=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(m.dataId));b=z.getSparseReshapeInputOutputMismatchErrorMessage(v,w);break}default:b=""}if(t.disposeData(g.dataId),b)throw t.disposeData(h.dataId),t.disposeData(m.dataId),new Error(b);return[h,m]}var o9e={kernelName:Dg,backendName:"wasm",setupFunc:s9e,kernelFunc:i9e},Oq;function Lq(e){Oq=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function zq(e,t){let{backend:n,inputs:r}=e,{data:a,indices:s,segmentIds:o}=r,l=s.shape[0],c=n.readSync(o.dataId,l-1,l)[0],d=l>0?c+1:0;if(d<0)throw new Error(z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let u=a.shape.slice();u[0]=d;let h=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(s.dataId).id,m=n.dataIdMap.get(o.dataId).id,f=n.makeOutput(u,a.dtype),g=n.dataIdMap.get(f.dataId).id,x=n.makeOutput([4],"int32"),y=n.dataIdMap.get(x.dataId).id;Oq(h,Hn[a.dtype],a.shape[0],p,m,g,y,t,0);let b=n.readSync(x.dataId),v;switch(b[0]){case 0:{v=z.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break}case 1:{v=z.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break}case 2:v=z.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:v=z.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:v=""}if(n.disposeData(x.dataId),v)throw n.disposeData(f.dataId),new Error(v);return f}function l9e(e){return zq(e,!0)}var c9e={kernelName:Mb,backendName:"wasm",setupFunc:Lq,kernelFunc:l9e};function u9e(e){return zq(e,!1)}var d9e={kernelName:$b,backendName:"wasm",setupFunc:Lq,kernelFunc:u9e},Bq;function h9e(e){Bq=e.wasm.cwrap(Mg,null,["number","number","number","number","number","number","number","number","array","number","number"])}function p9e(e){let{backend:t,inputs:n,attrs:r}=e,{sparseIndices:a,sparseValues:s,defaultValue:o}=n,{outputShape:l}=r,c=t.makeOutput(l,o.dtype);if(E.sizeFromShape(l)===0)return c;let{sliceRank:d,numUpdates:u,sliceSize:h,strides:p,outputSize:m}=z.calculateShapes(s,a,l),f=t.dataIdMap.get(a.dataId).id,g=t.dataIdMap.get(s.dataId).id,x=t.dataIdMap.get(o.dataId).id,y=new Uint8Array(new Int32Array(p).buffer),b=t.dataIdMap.get(c.dataId).id;return Bq(f,g,s.shape.length,x,Hn[o.dtype],d,u,h,y,m,b),c}var m9e={kernelName:Mg,backendName:"wasm",setupFunc:h9e,kernelFunc:p9e};function f9e(e){let{inputs:t,attrs:n,backend:r}=e,{x:a}=t,{numOrSizeSplits:s,axis:o}=n,l=E.parseAxisParam(o,a.shape)[0],c=z.prepareSplitSize(a,s,l),d=new Array(a.shape.length).fill(0),u=a.shape.slice();return c.map(h=>{let p=[...u];p[l]=h;let m=bh({inputs:{x:a},attrs:{begin:d,size:p},backend:r});return d[l]+=h,m})}var g9e={kernelName:Rg,backendName:"wasm",kernelFunc:f9e},x9e=Ln(Fp),y9e=Ln(Fb),b9e=na(Lp),Wq;function v9e(e){Wq=e.wasm.cwrap(Tu,null,["number","number","number","number"])}function w9e(e){let{backend:t,inputs:n,attrs:r}=e,{alpha:a}=r,{x:s}=n,o=t.dataIdMap.get(s.dataId).id,l=t.makeOutput(s.shape,s.dtype),c=t.dataIdMap.get(l.dataId).id;return Wq(o,a,Hn[s.dtype],c),l}var N9e={kernelName:Tu,backendName:"wasm",setupFunc:v9e,kernelFunc:w9e},Uq;function k9e(e){Uq=e.wasm.cwrap($g,null,["number","array","number","array","array","array","array","array","number","number"])}function S9e(e){let{backend:t,inputs:n,attrs:r}=e,{x:a}=n,{begin:s,end:o,strides:l,beginMask:c,endMask:d,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:p}=r,{finalShapeSparse:m,finalShape:f,isIdentity:g,sliceDim0:x,isSimpleSlice:y,begin:b,end:v,strides:w}=da.sliceInfo(a.shape,s,o,l,c,d,u,h,p),k;if(g)k=vs({inputs:{x:a},backend:t,attrs:{shape:f}});else if(x||y){E.assert(a.shape.length>=1,()=>`Input must have rank at least 1, got: ${a.shape.length}`);let C=da.computeOutShape(b,v,w),S=bh({inputs:{x:a},backend:t,attrs:{begin:b,size:C}});k=vs({inputs:{x:S},backend:t,attrs:{shape:f}}),t.disposeData(S.dataId)}else{let C=t.makeOutput(m,"float32"),S=t.dataIdMap.get(a.dataId).id,_=new Uint8Array(new Int32Array(E.computeStrides(a.shape)).buffer),I=new Uint8Array(new Int32Array(b).buffer),T=new Uint8Array(new Int32Array(v).buffer),A=new Uint8Array(new Int32Array(w).buffer),j=new Uint8Array(new Int32Array(m).buffer),D=new Uint8Array(new Int32Array(E.computeStrides(m)).buffer),F=t.dataIdMap.get(C.dataId).id;Uq(S,_,a.shape.length,I,T,A,j,D,m.length,F),k=vs({inputs:{x:C},backend:t,attrs:{shape:f}}),t.disposeData(C.dataId)}return k}var C9e={kernelName:$g,backendName:"wasm",setupFunc:k9e,kernelFunc:S9e};function _9e(e){let{backend:t,inputs:n,attrs:r}=e,{data:a,dataSplits:s}=n,{separator:o,nGramWidths:l,leftPad:c,rightPad:d,padWidth:u,preserveShortSequences:h}=r,p=t.readSync(a.dataId),m=t.readSync(s.dataId),[f,g]=WA(p,m,o,l,c,d,u,h),x=t.makeOutput([f.length],"string"),y=t.dataIdMap.get(x.dataId);y.stringBytes=f;let b=t.makeOutput(s.shape,"int32");return t.typedArrayFromHeap(b).set(g),[x,b]}var j9e={kernelName:Ob,backendName:"wasm",kernelFunc:_9e};function I9e(e){let{backend:t,inputs:n,attrs:r}=e,{input:a,delimiter:s}=n,{skipEmpty:o}=r,l=t.readSync(a.dataId),c=t.readSync(s.dataId),[d,u,h]=UA(l,c[0],o),p=u.length,m=t.makeOutput([p,2],"int32");t.typedArrayFromHeap(m).set(d);let f=t.makeOutput([p],"string"),g=t.dataIdMap.get(f.dataId);g.stringBytes=u;let x=t.makeOutput([2],"int32");return t.typedArrayFromHeap(x).set(h),[m,f,x]}var T9e={kernelName:Lb,backendName:"wasm",kernelFunc:I9e};function E9e(e){let{backend:t,inputs:n,attrs:r}=e,{input:a}=n,{numBuckets:s}=r,o=t.readSync(a.dataId),l=VA(o,s),c=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(c).set(l),c}var A9e={kernelName:zb,backendName:"wasm",kernelFunc:E9e},R9e=na(zp),Vq;function D9e(e){Vq=e.wasm.cwrap(Pp,null,["number","number","number","number"])}function M9e(e){let{backend:t,inputs:n,attrs:r}=e,{axis:a,keepDims:s}=r,{x:o}=n,l=t.dataIdMap.get(o.dataId).id,c=l,d=o,{transposed:u,axes:h,originalAxes:p,inputWasTransposed:m}=Pu(o,a,t),f=h;if(m){let v=t.dataIdMap.get(u.dataId).id;v!==l&&(d=u,c=v,f=z.getInnerMostAxes(f.length,d.shape.length))}z.assertAxesAreInnerMostDims("sum",f,d.shape.length);let[g,x]=z.computeOutAndReduceShapes(d.shape,f),y=E.sizeFromShape(x),b=t.makeOutput(g,d.dtype);if(E.sizeFromShape(d.shape)!==0){let v=t.dataIdMap.get(b.dataId).id;Vq(c,y,Hn[b.dtype],v)}if(m&&t.disposeData(u.dataId),s){let v=z.expandShapeToKeepDim(b.shape,p);b.shape=v}return b}var $9e={kernelName:Pp,backendName:"wasm",setupFunc:D9e,kernelFunc:M9e},F9e=Ln(Bp),P9e=Ln(Wp),Hq;function O9e(e){Hq=e.wasm.cwrap(jg,null,["number","number","number","number","number","number","array","number","number","number"])}function L9e(e){let{backend:t,inputs:n,attrs:r}=e,{tensor:a,indices:s,updates:o}=n,l=t.makeOutput(a.shape,a.dtype);if(E.sizeFromShape(a.shape)===0)return l;let{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=kN.calculateShapes(o,s,a.shape),m=t.dataIdMap.get(s.dataId).id,f=t.dataIdMap.get(o.dataId).id,g=t.dataIdMap.get(a.dataId).id,x=new Uint8Array(new Int32Array(h).buffer),y=t.dataIdMap.get(l.dataId).id;return Hq(m,f,Hn[o.dtype],c,d,u,x,p,y,g),l}var z9e={kernelName:jg,backendName:"wasm",setupFunc:O9e,kernelFunc:L9e},Gq;function B9e(e){Gq=e.wasm.cwrap(Iu,null,["number","array","number","array","number","number"])}function W9e(e){let{inputs:t,backend:n,attrs:r}=e,{x:a}=t,s=n.dataIdMap.get(a.dataId).id,{reps:o}=r,l=new Array(a.shape.length);for(let p=0;p<l.length;p++)l[p]=a.shape[p]*o[p];let c=new Uint8Array(new Int32Array(a.shape).buffer),d=new Uint8Array(new Int32Array(l).buffer),u=n.makeOutput(l,a.dtype),h=n.dataIdMap.get(u.dataId).id;return Gq(s,c,a.shape.length,d,l.length,Hn[u.dtype],h),u}var U9e={kernelName:Iu,backendName:"wasm",setupFunc:B9e,kernelFunc:W9e},qq;function V9e(e){qq=e.wasm.cwrap(Fg,null,["number","array","number","number","number","bool","number","number"])}var H9e=({inputs:e,backend:t,attrs:n})=>{let{x:r}=e,{k:a,sorted:s}=n,o=t.dataIdMap.get(r.dataId).id,l=new Uint8Array(new Int32Array(r.shape).buffer),c=r.shape.slice();c[c.length-1]=a;let d=t.makeOutput(c,r.dtype),u=t.dataIdMap.get(d.dataId).id,h=t.makeOutput(c,"int32"),p=t.dataIdMap.get(h.dataId).id;return qq(o,l,r.shape.length,Hn[r.dtype],a,s,u,p),[d,h]},G9e={kernelName:Fg,backendName:"wasm",setupFunc:V9e,kernelFunc:H9e},Kq;function q9e(e){Kq=e.wasm.cwrap(Pg,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])}function K9e(e){let{backend:t,inputs:n,attrs:r}=e,{image:a,transforms:s}=n,{interpolation:o,fillMode:l,fillValue:c,outputShape:d}=r,[u,h,p,m]=a.shape,[f,g]=d??[h,p],x=[u,f,g,m],y=new Uint8Array(new Int32Array(E.computeStrides(a.shape)).buffer),b=new Uint8Array(new Int32Array(E.computeStrides(x)).buffer),v=t.makeOutput(x,a.dtype),w=t.dataIdMap.get(v.dataId).id,k=t.dataIdMap.get(a.dataId).id,C=t.dataIdMap.get(s.dataId).id,S=o==="nearest"?1:2,_;switch(l){case"constant":_=1;break;case"reflect":_=2;break;case"wrap":_=3;break;case"nearest":_=4;break;default:_=1;break}return Kq(k,C,s.shape[0]>1,u,f,g,m,p,h,y,a.shape.length-1,b,x.length-1,S,_,c,w),v}var Y9e={kernelName:Pg,backendName:"wasm",setupFunc:q9e,kernelFunc:K9e};function X9e(e){let{inputs:t,attrs:n,backend:r}=e,{axis:a}=n,{x:s}=t,{outputValues:o,outputShape:l,indices:c}=GA(r.readSync(s.dataId),a,s.shape,s.dtype);return[r.makeOutput(l,s.dtype,void 0,o),r.makeOutput([c.length],"int32",void 0,c)]}var Z9e={kernelName:Bb,backendName:"wasm",kernelFunc:X9e};function Q9e(e){let{inputs:t,backend:n,attrs:r}=e,{value:a}=t,{axis:s}=r;s<0&&(s+=a.shape.length);let o=a.shape[s],l=a.shape.length,c=new Array(l-1),d=0;for(let m=0;m<l;m++)m!==s&&(c[d++]=a.shape[m]);let u=new Array(o),h=new Array(l).fill(0),p=a.shape.slice();p[s]=1;for(let m=0;m<u.length;m++)h[s]=m,u[m]=bh({inputs:{x:a},attrs:{begin:h,size:p},backend:n});return u.map(({dataId:m,dtype:f})=>({dataId:m,dtype:f,shape:c}))}var J9e={kernelName:Og,backendName:"wasm",kernelFunc:Q9e};function e7e(e){let{inputs:{x:t},backend:n}=e,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}var t7e={kernelName:Lg,backendName:"wasm",kernelFunc:e7e},n7e=[qWe,KWe,YWe,XWe,ZWe,eUe,lUe,dUe,hUe,pUe,mUe,fUe,gUe,xUe,yUe,wUe,EUe,SUe,jUe,MUe,zUe,UUe,VUe,GUe,qUe,KUe,ZUe,QUe,tVe,aVe,oVe,uVe,pVe,mVe,fVe,yVe,wVe,SVe,jVe,EVe,DVe,FVe,LVe,WVe,HVe,GVe,YVe,ZVe,QVe,JVe,e8e,t8e,n8e,s8e,i8e,o8e,u8e,p8e,g8e,b8e,N8e,S8e,_8e,tUe,j8e,I8e,T8e,R8e,M8e,F8e,L8e,B8e,z8e,U8e,V8e,G8e,K8e,Z8e,eHe,rHe,aHe,oHe,uHe,pHe,gHe,bHe,NHe,CHe,_He,THe,MHe,$He,FHe,PHe,zHe,UHe,GHe,KHe,ZHe,JHe,tGe,kq,aGe,oGe,uGe,hGe,pGe,mGe,fGe,gGe,AUe,bGe,NGe,CGe,IGe,AGe,MGe,$Ge,FGe,LGe,WGe,HGe,GGe,YGe,XGe,ZGe,QGe,OUe,AHe,JGe,t9e,a9e,o9e,c9e,d9e,m9e,g9e,x9e,y9e,b9e,N9e,C9e,j9e,T9e,A9e,R9e,$9e,F9e,P9e,z9e,U9e,G9e,Y9e,sUe,Z9e,J9e,t7e];for(let e of n7e)Ub(e);var I_=_e();I_.registerFlag("WASM_HAS_SIMD_SUPPORT",async()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]))}catch{return!1}});I_.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",async()=>{if(I_.get("IS_NODE"))return!1;try{return new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}});var uP=Cu(Pme()),r7e=Cu(Ome()),dP=Cu(Lme()),hP=uP.default||uP,a7e=dP.default||dP,Yq=class extends vb{constructor(e){super(),this.wasm=e,this.dataIdNextNumber=1,this.wasm.tfjs.initWithThreadsCount(Xq),T_=this.wasm.tfjs.getThreadsCount(),this.dataIdMap=new $1(this,Ti())}write(e,t,n){let r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}numDataIds(){return this.dataIdMap.numDataIds()}async time(e){let t=E.now();return e(),{kernelMs:E.now()-t}}move(e,t,n,r,a){let s=this.dataIdNextNumber++;if(r==="string"){let d=t;this.dataIdMap.set(e,{id:s,stringBytes:d,shape:n,dtype:r,memoryOffset:null,refCount:a});return}let o=E.sizeFromShape(n),l=o*E.bytesPerElement(r),c=this.wasm._malloc(l)>>>0;this.dataIdMap.set(e,{id:s,memoryOffset:c,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(s,o,c),t!=null&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,l),c)}async read(e){return this.readSync(e)}readSync(e,t,n){let{memoryOffset:r,dtype:a,shape:s,stringBytes:o}=this.dataIdMap.get(e);if(a==="string")return(t==null||t===0)&&(n==null||n>=o.length)?o:o.slice(t,n);t=t||0,n=n||E.sizeFromShape(s);let l=E.bytesPerElement(a),c=this.wasm.HEAPU8.slice(r+t*l,r+n*l);return o7e(c.buffer,a)}disposeData(e,t=!1){if(this.dataIdMap.has(e)){let n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}refCount(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}incRef(e){let t=this.dataIdMap.get(e);t!=null&&t.refCount++}floatPrecision(){return 32}getMemoryOffset(e){return this.dataIdMap.get(e).memoryOffset}dispose(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}memory(){return{unreliable:!1}}makeOutput(e,t,n,r){let a;if(n==null)a=this.write(r??null,e,t);else{let s=this.dataIdNextNumber++;a={id:s},this.dataIdMap.set(a,{id:s,memoryOffset:n,shape:e,dtype:t,refCount:1});let o=E.sizeFromShape(e);this.wasm.tfjs.registerTensor(s,o,n)}return{dataId:a,shape:e,dtype:t}}typedArrayFromHeap({shape:e,dtype:t,dataId:n}){let r=this.wasm.HEAPU8.buffer,{memoryOffset:a}=this.dataIdMap.get(n),s=E.sizeFromShape(e);switch(t){case"float32":return new Float32Array(r,a,s);case"int32":return new Int32Array(r,a,s);case"bool":return new Uint8Array(r,a,s);default:throw new Error(`Unknown dtype ${t}`)}}};function s7e(e){return(t,n)=>(E.fetch(e,{credentials:"same-origin"}).then(r=>{r.ok||t.env.a(`failed to load wasm binary file at '${e}'`),r.arrayBuffer().then(a=>{WebAssembly.instantiate(a,t).then(s=>{n(s.instance,s.module)})})}),{})}function pP(e,t,n){if(i1!=null)return i1;let r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),xy!=null&&xy[r]!=null?xy[r]:n+r}async function i7e(){let[e,t]=await Promise.all([_e().getAsync("WASM_HAS_SIMD_SUPPORT"),_e().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);return new Promise((n,r)=>{let a={};a.locateFile=(l,c)=>{if(l.endsWith(".worker.js")){let d=r7e.wasmWorkerContents.replace(/\n/g,"\\n"),u=new Blob([d],{type:"application/javascript"});return URL.createObjectURL(u)}return l.endsWith(".wasm")?pP(e,t,Jx??c):c+l},pR&&(a.instantiateWasm=s7e(pP(e,t,Jx??"")));let s=!1;a.onAbort=()=>{s||yy||(yy=!0,r({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))};let o;t&&e&&i1==null?(a.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+hP.toString()],{type:"text/javascript"}),o=hP(a)):o=a7e(a),o.then(l=>{s=!0,yy=!1;let c=null;l.tfjs={init:l.cwrap("init",null,[]),initWithThreadsCount:l.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:l.cwrap("get_threads_count","number",[]),registerTensor:l.cwrap("register_tensor",null,["number","number","number"]),disposeData:l.cwrap("dispose_data",c,["number"]),dispose:l.cwrap("dispose",c,[])},n({wasm:l})}).catch(r)})}function o7e(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error(`Unknown dtype ${t}`)}}var l7e=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],i1=null,Jx=null,xy={},yy=!1,pR=!1;function c7e(e,t=!1){if(xW("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),yy)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");i1=e,pR=t}function u7e(e,t=!1){if(yy)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if(typeof e=="string")Jx=e;else{xy=e;let n=l7e.filter(r=>xy[r]==null);if(n.length>0)throw new Error(`There were no entries found for the following binaries: ${n.join(",")}. Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found.`)}pR=t}var Xq=-1,T_=-1;function d7e(e){Xq=e}function h7e(){if(T_===-1)throw new Error("WASM backend not initialized.");return T_}var p7e="4.22.0",m7e=2;J1("wasm",async()=>{let{wasm:e}=await i7e();return new Yq(e)},m7e);var mP="4.22.0",f7e="4.22.0",g7e="4.22.0",x7e="4.22.0",y7e="4.22.0",b7e={tfjs:mP,"tfjs-core":mP,"tfjs-converter":f7e,"tfjs-backend-cpu":g7e,"tfjs-backend-webgl":x7e,"tfjs-backend-wasm":y7e},v7e={};wI(v7e,{AnchorPosition:()=>hK,DrawBox:()=>fK,DrawBoxOptions:()=>mK,DrawFaceLandmarks:()=>RK,DrawFaceLandmarksOptions:()=>AK,DrawTextField:()=>vR,DrawTextFieldOptions:()=>bR,drawContour:()=>bc,drawDetections:()=>D7e,drawFaceExpressions:()=>G7e,drawFaceLandmarks:()=>K7e});function bc(e,t,n=!1){if(e.beginPath(),t.slice(1).forEach(({x:r,y:a},s)=>{let o=t[s];e.moveTo(o.x,o.y),e.lineTo(r,a)}),n){let r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}var w7e={};wI(w7e,{computeReshapedDimensions:()=>eK,getCenterPoint:()=>fR,isDimensions:()=>A_,isEven:()=>E_,isFloat:()=>Jq,isTensor:()=>ox,isTensor1D:()=>N7e,isTensor2D:()=>Qq,isTensor3D:()=>Nv,isTensor4D:()=>Ol,isValidNumber:()=>Pd,isValidProbablitiy:()=>k7e,range:()=>jf,round:()=>mR});var Pm=class Zq{constructor(t,n){if(!Pd(t)||!Pd(n))throw new Error(`Dimensions.constructor - expected width and height to be valid numbers, instead have ${JSON.stringify({width:t,height:n})}`);this._width=t,this._height=n}get width(){return this._width}get height(){return this._height}reverse(){return new Zq(1/this.width,1/this.height)}};function ox(e,t){return e instanceof on&&e.shape.length===t}function N7e(e){return ox(e,1)}function Qq(e){return ox(e,2)}function Nv(e){return ox(e,3)}function Ol(e){return ox(e,4)}function Jq(e){return e%1!==0}function E_(e){return e%2===0}function mR(e,t=2){let n=10**t;return Math.floor(e*n)/n}function A_(e){return e&&e.width&&e.height}function eK({width:e,height:t},n){let r=n/Math.max(t,e);return new Pm(Math.round(e*r),Math.round(t*r))}function fR(e){return e.reduce((t,n)=>t.add(n),new dr(0,0)).div(new dr(e.length,e.length))}function jf(e,t,n){return Array(e).fill(0).map((r,a)=>t+a*n)}function Pd(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||e===0}function k7e(e){return Pd(e)&&e>=0&&e<=1}var dr=class id{constructor(t,n){this._x=t,this._y=n}get x(){return this._x}get y(){return this._y}add(t){return new id(this.x+t.x,this.y+t.y)}sub(t){return new id(this.x-t.x,this.y-t.y)}mul(t){return new id(this.x*t.x,this.y*t.y)}div(t){return new id(this.x/t.x,this.y/t.y)}abs(){return new id(Math.abs(this.x),Math.abs(this.y))}magnitude(){return Math.sqrt(this.x**2+this.y**2)}floor(){return new id(Math.floor(this.x),Math.floor(this.y))}},vh=class to{static isRect(t){return!!t&&[t.x,t.y,t.width,t.height].every(Pd)}static assertIsValidBox(t,n,r=!1){if(!to.isRect(t))throw new Error(`${n} - invalid box: ${JSON.stringify(t)}, expected object with properties x, y, width, height`);if(!r&&(t.width<0||t.height<0))throw new Error(`${n} - width (${t.width}) and height (${t.height}) must be positive numbers`)}constructor(t,n=!0){let r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Pd),s=[r.x,r.y,r.width,r.height].every(Pd);if(!s&&!a)throw new Error(`Box.constructor - expected box to be IBoundingBox | IRect, instead have ${JSON.stringify(r)}`);let[o,l,c,d]=s?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top];to.assertIsValidBox({x:o,y:l,width:c,height:d},"Box.constructor",n),this._x=o,this._y=l,this._width=c,this._height=d}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get area(){return this.width*this.height}get topLeft(){return new dr(this.left,this.top)}get topRight(){return new dr(this.right,this.top)}get bottomLeft(){return new dr(this.left,this.bottom)}get bottomRight(){return new dr(this.right,this.bottom)}round(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.round(s));return new to({x:t,y:n,width:r,height:a})}floor(){let[t,n,r,a]=[this.x,this.y,this.width,this.height].map(s=>Math.floor(s));return new to({x:t,y:n,width:r,height:a})}toSquare(){let{x:t,y:n,width:r,height:a}=this,s=Math.abs(r-a);return r<a&&(t-=s/2,r+=s),a<r&&(n-=s/2,a+=s),new to({x:t,y:n,width:r,height:a})}rescale(t){let n=A_(t)?t.width:t,r=A_(t)?t.height:t;return new to({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}pad(t,n){let[r,a,s,o]=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new to({x:r,y:a,width:s,height:o})}clipAtImageBorders(t,n){let{x:r,y:a,right:s,bottom:o}=this,l=Math.max(r,0),c=Math.max(a,0),d=s-l,u=o-c,h=Math.min(d,t-l),p=Math.min(u,n-c);return new to({x:l,y:c,width:h,height:p}).floor()}shift(t,n){let{width:r,height:a}=this,s=this.x+t,o=this.y+n;return new to({x:s,y:o,width:r,height:a})}padAtBorders(t,n){let r=this.width+1,a=this.height+1,s=1,o=1,l=r,c=a,d=this.left,u=this.top,h=this.right,p=this.bottom;return h>n&&(l=-h+n+r,h=n),p>t&&(c=-p+t+a,p=t),d<1&&(c=2-d,d=1),u<1&&(c=2-u,u=1),{dy:o,edy:c,dx:s,edx:l,y:u,ey:p,x:d,ex:h,w:r,h:a}}calibrate(t){return new to({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}},tK=class extends vh{constructor(e,t,n,r,a=!1){super({left:e,top:t,right:n,bottom:r},a)}},nK=class rK{constructor(t,n,r,a,s){this._imageDims=new Pm(s.width,s.height),this._score=t,this._classScore=n,this._className=r,this._box=new vh(a).rescale(this._imageDims)}get score(){return this._score}get classScore(){return this._classScore}get className(){return this._className}get box(){return this._box}get imageDims(){return this._imageDims}get imageWidth(){return this.imageDims.width}get imageHeight(){return this.imageDims.height}get relativeBox(){return new vh(this._box).rescale(this.imageDims.reverse())}forSize(t,n){return new rK(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}},_o=class aK extends nK{constructor(t,n,r){super(t,t,"",n,r)}forSize(t,n){let{score:r,relativeBox:a,imageDims:s}=super.forSize(t,n);return new aK(r,a,s)}};function S7e(e,t,n=!0){let r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top)),s=r*a;return n?s/(e.area+t.area-s):s/Math.min(e.area,t.area)}function C7e(e){let t=e.map(l=>l.x),n=e.map(l=>l.y),r=t.reduce((l,c)=>c<l?c:l,1/0),a=n.reduce((l,c)=>c<l?c:l,1/0),s=t.reduce((l,c)=>l<c?c:l,0),o=n.reduce((l,c)=>l<c?c:l,0);return new tK(r,a,s,o)}function _7e(e,t,n,r=!0){let a=t.map((o,l)=>({score:o,boxIndex:l})).sort((o,l)=>o.score-l.score).map(o=>o.boxIndex),s=[];for(;a.length>0;){let o=a.pop();s.push(o);let l=a,c=[];for(let d=0;d<l.length;d++){let u=l[d],h=e[o],p=e[u];c.push(S7e(h,p,r))}a=a.filter((d,u)=>c[u]<=n)}return s}function kv(e,t){return fe(()=>{let[n,r,a]=t,s=Gs([...e.shape.slice(0,3),1],n,"float32"),o=Gs([...e.shape.slice(0,3),1],r,"float32"),l=Gs([...e.shape.slice(0,3),1],a,"float32"),c=pr([s,o,l],3);return ot(e,c)})}function j7e(e,t=!1){return fe(()=>{let[n,r]=e.shape.slice(1);if(n===r)return e;let a=Math.abs(n-r),s=Math.round(a*(t?.5:1)),o=n>r?2:1,l=h=>{let p=e.shape.slice();return p[o]=h,Gs(p,0,"float32")},c=l(s),d=a-c.shape[o],u=[t&&d?l(d):null,e,c].filter(h=>!!h).map(h=>He(h,"float32"));return pr(u,o)})}function t2(e){return 1/(1+Math.exp(-e))}var sK=class extends vh{constructor(e,t,n,r,a=!1){super({x:e,y:t,width:n,height:r},a)}},I7e=.5,T7e=.43,E7e=.45,o1=class{constructor(e,t,n=new dr(0,0)){let{width:r,height:a}=t;this._imgDims=new Pm(r,a),this._shift=n,this._positions=e.map(s=>s.mul(new dr(r,a)).add(n))}get shift(){return new dr(this._shift.x,this._shift.y)}get imageWidth(){return this._imgDims.width}get imageHeight(){return this._imgDims.height}get positions(){return this._positions}get relativePositions(){return this._positions.map(e=>e.sub(this._shift).div(new dr(this.imageWidth,this.imageHeight)))}forSize(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}shiftBy(e,t){return new this.constructor(this.relativePositions,this._imgDims,new dr(e,t))}shiftByPoint(e){return this.shiftBy(e.x,e.y)}align(e,t={}){if(e){let a=e instanceof _o?e.box.floor():new vh(e);return this.shiftBy(a.x,a.y).align(null,t)}let{useDlibAlignment:n,minBoxPadding:r}={useDlibAlignment:!1,minBoxPadding:.2,...t};return n?this.alignDlib():this.alignMinBbox(r)}alignDlib(){let e=this.getRefPointsForAlignment(),[t,n,r]=e,a=u=>r.sub(u).magnitude(),s=(a(t)+a(n))/2,o=Math.floor(s/E7e),l=fR(e),c=Math.floor(Math.max(0,l.x-I7e*o)),d=Math.floor(Math.max(0,l.y-T7e*o));return new sK(c,d,Math.min(o,this.imageWidth+c),Math.min(o,this.imageHeight+d))}alignMinBbox(e){let t=C7e(this.positions);return t.pad(t.width*e,t.height*e)}getRefPointsForAlignment(){throw new Error("getRefPointsForAlignment not implemented by base class")}},iK=class extends o1{getJawOutline(){return this.positions.slice(0,17)}getLeftEyeBrow(){return this.positions.slice(17,22)}getRightEyeBrow(){return this.positions.slice(22,27)}getNose(){return this.positions.slice(27,36)}getLeftEye(){return this.positions.slice(36,42)}getRightEye(){return this.positions.slice(42,48)}getMouth(){return this.positions.slice(48,68)}getRefPointsForAlignment(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(fR)}};function l1(e){return e.detection instanceof _o}function oK(e,t){return{...e,detection:t}}function lK(){let e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:()=>document.createElement("canvas"),createImageElement:()=>document.createElement("img"),createVideoElement:()=>document.createElement("video"),fetch:e,readFile:()=>{throw new Error("readFile - filesystem not available for browser environment")}}}function gR(){return typeof global=="object"&&typeof process<"u"&&process.versions!=null&&process.versions.node!=null}function cK(e){let t="";if(!e&&gR())try{e=fme("fs")}catch(n){t=n.toString()}return{readFile:e?n=>new Promise((r,a)=>{e.readFile(n,(s,o)=>s?a(s):r(o))}):()=>{throw new Error(`readFile - failed to require fs in nodejs environment with error: ${t}`)}}}function uK(){let e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.Video||global.HTMLVideoElement,r=()=>{if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},a=()=>{if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},s=()=>{if(n)return new n;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},o=global.fetch,l=cK();return{Canvas:e||class{},CanvasRenderingContext2D:global.CanvasRenderingContext2D||class{},Image:t||class{},ImageData:global.ImageData||class{},Video:global.HTMLVideoElement||class{},createCanvasElement:r,createImageElement:a,createVideoElement:s,fetch:o,...l}}function dK(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}var xa;function A7e(){if(!xa)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return xa}function R_(e){xa=e}function xR(){return dK()?R_(lK()):gR()?R_(uK()):null}function R7e(e){if(xa||xR(),!xa)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");let{Canvas:t=xa.Canvas,Image:n=xa.Image}=e;xa.Canvas=t,xa.Image=n,xa.createCanvasElement=e.createCanvasElement||(()=>new t),xa.createImageElement=e.createImageElement||(()=>new n),xa.ImageData=e.ImageData||xa.ImageData,xa.Video=e.Video||xa.Video,xa.fetch=e.fetch||xa.fetch,xa.readFile=e.readFile||xa.readFile}var _s={getEnv:A7e,setEnv:R_,initialize:xR,createBrowserEnv:lK,createFileSystem:cK,createNodejsEnv:uK,monkeyPatch:R7e,isBrowser:dK,isNodejs:gR};xR();function yR(e){return!_s.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function vu(e){let{Canvas:t,CanvasRenderingContext2D:n}=_s.getEnv();if(e instanceof n)return e;let r=yR(e);if(!(r instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");let a=r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}var hK=(e=>(e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e))(hK||{}),bR=class{constructor(e={}){let{anchorPosition:t,backgroundColor:n,fontColor:r,fontSize:a,fontStyle:s,padding:o}=e;this.anchorPosition=t||"TOP_LEFT",this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=a||14,this.fontStyle=s||"Georgia",this.padding=o||4}},vR=class pK{constructor(t,n,r={}){this.text=typeof t=="string"?[t]:t instanceof pK?t.text:t,this.anchor=n,this.options=new bR(r)}measureWidth(t){let{padding:n}=this.options;return this.text.map(r=>t.measureText(r).width).reduce((r,a)=>r<a?a:r,0)+2*n}measureHeight(){let{fontSize:t,padding:n}=this.options;return this.text.length*t+2*n}getUpperLeft(t,n){let{anchorPosition:r}=this.options,a=r==="BOTTOM_RIGHT"||r==="TOP_RIGHT",s=r==="BOTTOM_LEFT"||r==="BOTTOM_RIGHT",o=this.measureWidth(t),l=this.measureHeight(),c=a?this.anchor.x-o:this.anchor.x,d=s?this.anchor.y-l:this.anchor.y;if(n){let{width:u,height:h}=n,p=Math.max(Math.min(c,u-o),0),m=Math.max(Math.min(d,h-l),0);return{x:p,y:m}}return{x:c,y:d}}draw(t){let n=yR(t),r=vu(n),{backgroundColor:a,fontColor:s,fontSize:o,fontStyle:l,padding:c}=this.options;r.font=`${o}px ${l}`;let d=this.measureWidth(r),u=this.measureHeight();r.fillStyle=a;let h=this.getUpperLeft(r,n);r.fillRect(h.x,h.y,d,u),r.fillStyle=s,this.text.forEach((p,m)=>{let f=c+h.x,g=c+h.y+(m+1)*o;r.fillText(p,f,g)})}},mK=class{constructor(e={}){let{boxColor:t,lineWidth:n,label:r,drawLabelOptions:a}=e;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;let s={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new bR({...s,...a})}},fK=class{constructor(e,t={}){this.box=new vh(e),this.options=new mK(t)}draw(e){let t=vu(e),{boxColor:n,lineWidth:r}=this.options,{x:a,y:s,width:o,height:l}=this.box;t.strokeStyle=n,t.lineWidth=r,t.strokeRect(a,s,o,l);let{label:c}=this.options;c&&new vR([c],{x:a-r/2,y:s},this.options.drawLabelOptions).draw(e)}};function D7e(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof _o?n.score:l1(n)?n.detection.score:void 0,a=n instanceof _o?n.box:l1(n)?n.detection.box:new vh(n),s=r?`${mR(r)}`:void 0;new fK(a,{label:s}).draw(e)})}function gK(e){let{Image:t,Video:n}=_s.getEnv();return e instanceof t&&e.complete||e instanceof n&&e.readyState>=3}function M7e(e){return new Promise((t,n)=>{if(e instanceof _s.getEnv().Canvas||gK(e)){t(null);return}function r(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),n(s))}function a(s){s.currentTarget&&(s.currentTarget.removeEventListener("load",a),s.currentTarget.removeEventListener("error",r),t(s))}e.addEventListener("load",a),e.addEventListener("error",r)})}function xK(e){let{Image:t,Video:n}=_s.getEnv();return e instanceof t?new Pm(e.naturalWidth,e.naturalHeight):e instanceof n?new Pm(e.videoWidth,e.videoHeight):new Pm(e.width,e.height)}function c1({width:e,height:t}){let{createCanvasElement:n}=_s.getEnv(),r=n();return r.width=e,r.height=t,r}function yK(e,t){let{ImageData:n}=_s.getEnv();if(!(e instanceof n)&&!gK(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");let{width:r,height:a}=xK(e),s=c1({width:r,height:a});return e instanceof n?vu(s).putImageData(e,0,0):vu(s).drawImage(e,0,0,r,a),s}async function $7e(e,t){let n=t||_s.getEnv().createCanvasElement(),[r,a,s]=e.shape.slice(Ol(e)?1:0),o=fe(()=>e.as3D(r,a,s).toInt());return await lv.toPixels(o,n),o.dispose(),n}function fP(e){let{Image:t,Canvas:n,Video:r}=_s.getEnv();return e instanceof t||e instanceof n||e instanceof r}function F7e(e,t,n=!1){let{Image:r,Canvas:a}=_s.getEnv();if(!(e instanceof r||e instanceof a))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return c1({width:1,height:1});let s=xK(e),o=t/Math.max(s.height,s.width),l=o*s.width,c=o*s.height,d=c1({width:t,height:t}),u=e instanceof a?e:yK(e),h=Math.abs(l-c)/2,p=n&&l<c?h:0,m=n&&c<l?h:0;return u.width>0&&u.height>0&&vu(d).drawImage(u,p,m,l,c),d}var u1=class{constructor(e,t=!1){if(this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(e))throw new Error(`NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ${e}`);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((n,r)=>{if(Nv(n)){this._imageTensors[r]=n,this._inputDimensions[r]=n.shape;return}if(Ol(n)){let s=n.shape[0];if(s!==1)throw new Error(`NetInput - tf.Tensor4D with batchSize ${s} passed, but not supported in input array`);this._imageTensors[r]=n,this._inputDimensions[r]=n.shape.slice(1);return}let a=n instanceof _s.getEnv().Canvas?n:yK(n);this._canvases[r]=a,this._inputDimensions[r]=[a.height,a.width,3]})}get imageTensors(){return this._imageTensors}get canvases(){return this._canvases}get isBatchInput(){return this.batchSize>1||this._treatAsBatchInput}get batchSize(){return this._batchSize}get inputDimensions(){return this._inputDimensions}get inputSize(){return this._inputSize}get reshapedInputDimensions(){return jf(this.batchSize,0,1).map((e,t)=>this.getReshapedInputDimensions(t))}getInput(e){return this.canvases[e]||this.imageTensors[e]}getInputDimensions(e){return this._inputDimensions[e]}getInputHeight(e){return this._inputDimensions[e][0]}getInputWidth(e){return this._inputDimensions[e][1]}getReshapedInputDimensions(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");let t=this.getInputWidth(e),n=this.getInputHeight(e);return eK({width:t,height:n},this.inputSize)}toBatchTensor(e,t=!0){return this._inputSize=e,fe(()=>{let n=jf(this.batchSize,0,1).map(r=>{let a=this.getInput(r);if(a instanceof on){let s=Ol(a)?a:_a(a);return s=j7e(s,t),(s.shape[1]!==e||s.shape[2]!==e)&&(s=ii.resizeBilinear(s,[e,e],!1,!1)),s.as3D(e,e,3)}if(a instanceof _s.getEnv().Canvas)return lv.fromPixels(F7e(a,e,t));throw new Error(`toBatchTensor - at batchIdx ${r}, expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ${a}`)});return Jr(n.map(r=>He(r,"float32"))).as4D(this.batchSize,e,e,3)})}};async function ts(e){if(e instanceof u1)return e;let t=Array.isArray(e)?e:[e];if(!t.length)throw new Error("toNetInput - empty array passed as input");let n=a=>Array.isArray(e)?` at input index ${a}:`:"",r=t.map(yR);return r.forEach((a,s)=>{if(!fP(a)&&!Nv(a)&&!Ol(a))throw typeof t[s]=="string"?new Error(`toNetInput -${n(s)} string passed, but could not resolve HTMLElement for element id ${t[s]}`):new Error(`toNetInput -${n(s)} expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id`);if(Ol(a)){let o=a.shape[0];if(o!==1)throw new Error(`toNetInput -${n(s)} tf.Tensor4D with batchSize ${o} passed, but not supported in input array`)}}),await Promise.all(r.map(a=>fP(a)&&M7e(a))),new u1(r,Array.isArray(e))}async function wR(e,t){let{Canvas:n}=_s.getEnv(),r=e;if(!(e instanceof n)){let s=await ts(e);if(s.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");let o=s.getInput(0);r=o instanceof n?o:await $7e(o)}let a=vu(r);return t.map(s=>s instanceof _o?s.forSize(r.width,r.height).box.floor():s).map(s=>s.clipAtImageBorders(r.width,r.height)).map(({x:s,y:o,width:l,height:c})=>{let d=c1({width:l,height:c});return l>0&&c>0&&vu(d).putImageData(a.getImageData(s,o,l,c),0,0),d})}async function NR(e,t){if(!Nv(e)&&!Ol(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ol(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return fe(()=>{let[n,r,a]=e.shape.slice(Ol(e)?1:0);return t.map(s=>s instanceof _o?s.forSize(r,n).box:s).map(s=>s.clipAtImageBorders(r,n)).filter(s=>s.width>0&&s.height>0).map(({x:s,y:o,width:l,height:c})=>qg(e.as3D(n,r,a),[o,s,0],[c,l,a]))})}async function P7e(e,t){let{fetch:n}=_s.getEnv(),r=await n(e,t);if(!(r.status<400))throw new Error(`failed to fetch: (${r.status}) ${r.statusText}, from url: ${r.url}`);return r}async function O7e(e){return(await P7e(e)).json()}function bK(e,t){let n=`${t}-weights_manifest.json`;if(!e)return{modelBaseUri:"",manifestUri:n};if(e==="/")return{modelBaseUri:"/",manifestUri:`/${n}`};let r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");let a=e.split("/").filter(l=>l),s=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return o=e.startsWith("/")?`/${o}`:o,{modelBaseUri:o,manifestUri:o==="/"?`/${s}`:`${o}/${s}`}}async function L7e(e,t){let{manifestUri:n,modelBaseUri:r}=bK(e,t),a=await O7e(n);return Fa.loadWeights(a,r)}var Lu=class{constructor(e){this._params=void 0,this._paramMappings=[],this._name=e}get params(){return this._params}get paramMappings(){return this._paramMappings}get isLoaded(){return!!this.params}getParamFromPath(e){let{obj:t,objProp:n}=this.traversePropertyPath(e);return t[n]}reassignParamFromPath(e,t){let{obj:n,objProp:r}=this.traversePropertyPath(e);n[r].dispose(),n[r]=t}getParamList(){return this._paramMappings.map(({paramPath:e})=>({path:e,tensor:this.getParamFromPath(e)}))}getTrainableParams(){return this.getParamList().filter(e=>e.tensor instanceof ah)}getFrozenParams(){return this.getParamList().filter(e=>!(e.tensor instanceof ah))}variable(){this.getFrozenParams().forEach(({path:e,tensor:t})=>{this.reassignParamFromPath(e,t.variable())})}freeze(){this.getTrainableParams().forEach(({path:e,tensor:t})=>{let n=Qa(t.dataSync());t.dispose(),this.reassignParamFromPath(e,n)})}dispose(e=!0){this.getParamList().forEach(t=>{if(e&&t.tensor.isDisposed)throw new Error(`param tensor has already been disposed for path ${t.path}`);t.tensor.dispose()}),this._params=void 0}serializeParams(){return new Float32Array(this.getParamList().map(({tensor:e})=>Array.from(e.dataSync())).reduce((e,t)=>e.concat(t)))}async load(e){if(e instanceof Float32Array){this.extractWeights(e);return}await this.loadFromUri(e)}async loadFromUri(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromUri - expected model uri`);let t=await L7e(e,this.getDefaultModelName());this.loadFromWeightMap(t)}async loadFromDisk(e){if(e&&typeof e!="string")throw new Error(`${this._name}.loadFromDisk - expected model file path`);let{readFile:t}=_s.getEnv(),{manifestUri:n,modelBaseUri:r}=bK(e,this.getDefaultModelName()),a=c=>Promise.all(c.map(d=>t(d).then(u=>typeof u=="string"?Buffer.from(u):u.buffer))),s=Fa.weightsLoaderFactory(a),o=JSON.parse((await t(n)).toString()),l=await s(o,r);this.loadFromWeightMap(l)}loadFromWeightMap(e){let{paramMappings:t,params:n}=this.extractParamsFromWeightMap(e);this._paramMappings=t,this._params=n}extractWeights(e){let{paramMappings:t,params:n}=this.extractParams(e);this._paramMappings=t,this._params=n}traversePropertyPath(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");let t=e.split("/").reduce((a,s)=>{if(!a.nextObj.hasOwnProperty(s))throw new Error(`traversePropertyPath - object does not have property ${s}, for path ${e}`);return{obj:a.nextObj,objProp:s,nextObj:a.nextObj[s]}},{nextObj:this.params}),{obj:n,objProp:r}=t;if(!n||!r||!(n[r]instanceof on))throw new Error(`traversePropertyPath - parameter is not a tensor, for path ${e}`);return{obj:n,objProp:r}}};function ci(e,t,n){return fe(()=>{let r=Gg(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Re(r,t.bias),r})}function n2(e,t,n=!1){return fe(()=>{let r=ar(n?Re(Ja(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):ci(e,t.conv0,[2,2])),a=ci(r,t.conv1,[1,1]),s=ar(Re(r,a)),o=ci(s,t.conv2,[1,1]);return ar(Re(r,Re(a,o)))})}function dw(e,t,n=!1,r=!0){return fe(()=>{let a=ar(n?Re(Ja(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):ci(e,t.conv0,r?[2,2]:[1,1])),s=ci(a,t.conv1,[1,1]),o=ar(Re(a,s)),l=ci(o,t.conv2,[1,1]),c=ar(Re(a,Re(s,l))),d=ci(c,t.conv3,[1,1]);return ar(Re(a,Re(s,Re(l,d))))})}function by(e,t,n="same",r=!1){return fe(()=>{let a=Re(Ja(e,t.filters,[1,1],n),t.bias);return r?ar(a):a})}function zu(e,t){Object.keys(e).forEach(n=>{t.some(r=>r.originalPath===n)||e[n].dispose()})}function kR(e,t){return(n,r,a,s)=>{let o=pu(e(n*r*a*a),[a,a,n,r]),l=er(e(r));return t.push({paramPath:`${s}/filters`},{paramPath:`${s}/bias`}),{filters:o,bias:l}}}function vK(e,t){return(n,r,a)=>{let s=el(e(n*r),[n,r]),o=er(e(r));return t.push({paramPath:`${a}/weights`},{paramPath:`${a}/bias`}),{weights:s,bias:o}}}var wK=class{constructor(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}};function SR(e,t){return(n,r,a)=>{let s=pu(e(9*n),[3,3,n,1]),o=pu(e(n*r),[1,1,n,r]),l=er(e(r));return t.push({paramPath:`${a}/depthwise_filter`},{paramPath:`${a}/pointwise_filter`},{paramPath:`${a}/bias`}),new wK(s,o,l)}}function CR(e){return t=>{let n=e(`${t}/depthwise_filter`,4),r=e(`${t}/pointwise_filter`,4),a=e(`${t}/bias`,1);return new wK(n,r,a)}}function em(e,t){return(n,r,a)=>{let s=e[n];if(!ox(s,r))throw new Error(`expected weightMap[${n}] to be a Tensor${r}D, instead have ${s}`);return t.push({originalPath:n,paramPath:a||n}),s}}function Bu(e){let t=e;function n(a){let s=t.slice(0,a);return t=t.slice(a),s}function r(){return t}return{extractWeights:n,getRemainingWeights:r}}function NK(e,t){let n=kR(e,t),r=SR(e,t);function a(o,l,c,d=!1){let u=d?n(o,l,3,`${c}/conv0`):r(o,l,`${c}/conv0`),h=r(l,l,`${c}/conv1`),p=r(l,l,`${c}/conv2`);return{conv0:u,conv1:h,conv2:p}}function s(o,l,c,d=!1){let{conv0:u,conv1:h,conv2:p}=a(o,l,c,d),m=r(l,l,`${c}/conv3`);return{conv0:u,conv1:h,conv2:p,conv3:m}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:s}}function z7e(e){let t=[],{extractWeights:n,getRemainingWeights:r}=Bu(e),{extractDenseBlock4Params:a}=NK(n,t),s=a(3,32,"dense0",!0),o=a(32,64,"dense1"),l=a(64,128,"dense2"),c=a(128,256,"dense3");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:o,dense2:l,dense3:c}}}function kK(e){return t=>{let n=e(`${t}/filters`,4),r=e(`${t}/bias`,1);return{filters:n,bias:r}}}function SK(e,t){let n=em(e,t),r=kK(n),a=CR(n);function s(l,c=!1){let d=c?r(`${l}/conv0`):a(`${l}/conv0`),u=a(`${l}/conv1`),h=a(`${l}/conv2`);return{conv0:d,conv1:u,conv2:h}}function o(l,c=!1){let d=c?r(`${l}/conv0`):a(`${l}/conv0`),u=a(`${l}/conv1`),h=a(`${l}/conv2`),p=a(`${l}/conv3`);return{conv0:d,conv1:u,conv2:h,conv3:p}}return{extractDenseBlock3Params:s,extractDenseBlock4Params:o}}function B7e(e){let t=[],{extractDenseBlock4Params:n}=SK(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return zu(e,t),{params:r,paramMappings:t}}var CK=class extends Lu{constructor(){super("FaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return fe(()=>{let n=He(e.toBatchTensor(112,!0),"float32"),r=kv(n,[122.782,117.001,104.298]).div(255),a=dw(r,t.dense0,!0);return a=dw(a,t.dense1),a=dw(a,t.dense2),a=dw(a,t.dense3),a=tc(a,[7,7],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await ts(e))}getDefaultModelName(){return"face_feature_extractor_model"}extractParamsFromWeightMap(e){return B7e(e)}extractParams(e){return z7e(e)}};function D_(e,t){return fe(()=>Re(un(e,t.weights),t.bias))}function W7e(e,t,n){let r=[],{extractWeights:a,getRemainingWeights:s}=Bu(e),o=vK(a,r)(t,n,"fc");if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{paramMappings:r,params:{fc:o}}}function U7e(e){let t=[],n=em(e,t);function r(s){let o=n(`${s}/weights`,2),l=n(`${s}/bias`,1);return{weights:o,bias:l}}let a={fc:r("fc")};return zu(e,t),{params:a,paramMappings:t}}function _K(e){let t={},n={};return Object.keys(e).forEach(r=>{let a=r.startsWith("fc")?n:t;a[r]=e[r]}),{featureExtractorMap:t,classifierMap:n}}var jK=class extends Lu{constructor(e,t){super(e),this._faceFeatureExtractor=t}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return fe(()=>{let n=e instanceof u1?this.faceFeatureExtractor.forwardInput(e):e;return D_(n.as2D(n.shape[0],-1),t.fc)})}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return W7e(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=_K(e);return this.faceFeatureExtractor.loadFromWeightMap(t),U7e(n)}extractParams(e){let t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),s=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)}},gP=["neutral","happy","sad","angry","fearful","disgusted","surprised"],_R=class{constructor(e){if(this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,e.length!==7)throw new Error(`FaceExpressions.constructor - expected probabilities.length to be 7, have: ${e.length}`);gP.forEach((t,n)=>{this[t]=e[n]})}asSortedArray(){return gP.map(e=>({expression:e,probability:this[e]})).sort((e,t)=>t.probability-e.probability)}},V7e=class extends jK{constructor(e=new CK){super("FaceExpressionNet",e)}forwardInput(e){return fe(()=>Du(this.runNet(e)))}async forward(e){return this.forwardInput(await ts(e))}async predictExpressions(e){let t=await ts(e),n=await this.forwardInput(t),r=await Promise.all(Ur(n).map(async s=>{let o=s.dataSync();return s.dispose(),o}));n.dispose();let a=r.map(s=>new _R(s));return t.isBatchInput?a:a[0]}getDefaultModelName(){return"face_expression_model"}getClassifierChannelsIn(){return 256}getClassifierChannelsOut(){return 7}};function H7e(e){return e.expressions instanceof _R}function IK(e,t){return{...e,expressions:t}}function G7e(e,t,n=.1,r){(Array.isArray(t)?t:[t]).forEach(a=>{let s=a instanceof _R?a:H7e(a)?a.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");let o=s.asSortedArray().filter(c=>c.probability>n),l=l1(a)?a.detection.box.bottomLeft:r||new dr(0,0);new vR(o.map(c=>`${c.expression} (${mR(c.probability)})`),l).draw(e)})}function TK(e){return l1(e)&&e.landmarks instanceof o1&&e.unshiftedLandmarks instanceof o1&&e.alignedRect instanceof _o}function q7e(e){let t=c=>c*180/Math.PI,n=(c,d)=>Math.sqrt((c.x-d.x)**2+(c.y-d.y)**2),r={roll:void 0,pitch:void 0,yaw:void 0},a=(c,d,u)=>{let h=Math.floor(c.x-d.x),p=Math.floor(d.x-u.x);return h-p},s=(c,d)=>{let u=Math.hypot(d.x-c.x,d.y-c.y),h=d.y-c.y,p=Math.asin(h/u),m=t(p),f=Math.floor(90-m),g=d.x-c.x<0?-1:1;return f*g},o=(c,d,u)=>{let h=n(c,u),p=new dr((c.x+u.x)/2,(c.y+u.y)/2),m=n(d,p),f=Math.atan(m/h),g=Math.floor(t(f)),x=p.y-d.y<0?-1:1;return g*x};if(!e||!e.positions||e.positions.length!==68)return r;let l=e.positions;return r.roll=s(l[27],l[66]),r.pitch=o(l[14],l[30],l[2]),r.yaw=a(l[14],l[33],l[2]),r}function EK(e,t){let{box:n}=e.detection,r=t.shiftBy(n.x,n.y),a=r.align(),{imageDims:s}=e.detection,o=new _o(e.detection.score,a.rescale(s.reverse()),s),l=q7e(t);return{...e,landmarks:r,unshiftedLandmarks:t,alignedRect:o,angle:l}}var AK=class{constructor(e={}){let{drawLines:t=!0,drawPoints:n=!0,lineWidth:r,lineColor:a,pointSize:s,pointColor:o}=e;this.drawLines=t,this.drawPoints=n,this.lineWidth=r||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=o||"rgba(255, 0, 255, 1)"}},RK=class{constructor(e,t={}){this.faceLandmarks=e,this.options=new AK(t)}draw(e){let t=vu(e),{drawLines:n,drawPoints:r,lineWidth:a,lineColor:s,pointSize:o,pointColor:l}=this.options;if(n&&this.faceLandmarks instanceof iK&&(t.strokeStyle=s,t.lineWidth=a,bc(t,this.faceLandmarks.getJawOutline()),bc(t,this.faceLandmarks.getLeftEyeBrow()),bc(t,this.faceLandmarks.getRightEyeBrow()),bc(t,this.faceLandmarks.getNose()),bc(t,this.faceLandmarks.getLeftEye(),!0),bc(t,this.faceLandmarks.getRightEye(),!0),bc(t,this.faceLandmarks.getMouth(),!0)),r){t.strokeStyle=l,t.fillStyle=l;let c=d=>{t.beginPath(),t.arc(d.x,d.y,o,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(c)}}};function K7e(e,t){(Array.isArray(t)?t:[t]).forEach(n=>{let r=n instanceof o1?n:TK(n)?n.landmarks:void 0;if(!r)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new RK(r).draw(e)})}function Y7e(e,t){let n=kR(e,t),r=SR(e,t);function a(o,l,c){let d=r(o,l,`${c}/separable_conv0`),u=r(l,l,`${c}/separable_conv1`),h=n(o,l,1,`${c}/expansion_conv`);return{separable_conv0:d,separable_conv1:u,expansion_conv:h}}function s(o,l){let c=r(o,o,`${l}/separable_conv0`),d=r(o,o,`${l}/separable_conv1`),u=r(o,o,`${l}/separable_conv2`);return{separable_conv0:c,separable_conv1:d,separable_conv2:u}}return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:s}}function X7e(e,t){let n=[],{extractWeights:r,getRemainingWeights:a}=Bu(e),{extractConvParams:s,extractSeparableConvParams:o,extractReductionBlockParams:l,extractMainBlockParams:c}=Y7e(r,n),d=s(3,32,3,"entry_flow/conv_in"),u=l(32,64,"entry_flow/reduction_block_0"),h=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:d,reduction_block_0:u,reduction_block_1:h},m={};jf(t,0,1).forEach(y=>{m[`main_block_${y}`]=c(128,`middle_flow/main_block_${y}`)});let f=l(128,256,"exit_flow/reduction_block"),g=o(256,512,"exit_flow/separable_conv"),x={reduction_block:f,separable_conv:g};if(a().length!==0)throw new Error(`weights remaing after extract: ${a().length}`);return{paramMappings:n,params:{entry_flow:p,middle_flow:m,exit_flow:x}}}function Z7e(e,t){let n=em(e,t),r=kK(n),a=CR(n);function s(l){let c=a(`${l}/separable_conv0`),d=a(`${l}/separable_conv1`),u=r(`${l}/expansion_conv`);return{separable_conv0:c,separable_conv1:d,expansion_conv:u}}function o(l){let c=a(`${l}/separable_conv0`),d=a(`${l}/separable_conv1`),u=a(`${l}/separable_conv2`);return{separable_conv0:c,separable_conv1:d,separable_conv2:u}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:o}}function Q7e(e,t){let n=[],{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:s,extractMainBlockParams:o}=Z7e(e,n),l=r("entry_flow/conv_in"),c=s("entry_flow/reduction_block_0"),d=s("entry_flow/reduction_block_1"),u={conv_in:l,reduction_block_0:c,reduction_block_1:d},h={};jf(t,0,1).forEach(g=>{h[`main_block_${g}`]=o(`middle_flow/main_block_${g}`)});let p=s("exit_flow/reduction_block"),m=a("exit_flow/separable_conv"),f={reduction_block:p,separable_conv:m};return zu(e,n),{params:{entry_flow:u,middle_flow:h,exit_flow:f},paramMappings:n}}function DK(e,t,n){return Re(Ja(e,t.filters,n,"same"),t.bias)}function r2(e,t,n=!0){let r=n?ar(e):e;return r=ci(r,t.separable_conv0,[1,1]),r=ci(ar(r),t.separable_conv1,[1,1]),r=va(r,[3,3],[2,2],"same"),r=Re(r,DK(e,t.expansion_conv,[2,2])),r}function J7e(e,t){let n=ci(ar(e),t.separable_conv0,[1,1]);return n=ci(ar(n),t.separable_conv1,[1,1]),n=ci(ar(n),t.separable_conv2,[1,1]),n=Re(n,e),n}var eqe=class extends Lu{constructor(e){super("TinyXception"),this._numMainBlocks=e}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyXception - load model before inference");return fe(()=>{let n=He(e.toBatchTensor(112,!0),"float32"),r=kv(n,[122.782,117.001,104.298]).div(255),a=ar(DK(r,t.entry_flow.conv_in,[2,2]));return a=r2(a,t.entry_flow.reduction_block_0,!1),a=r2(a,t.entry_flow.reduction_block_1),jf(this._numMainBlocks,0,1).forEach(s=>{a=J7e(a,t.middle_flow[`main_block_${s}`])}),a=r2(a,t.exit_flow.reduction_block),a=ar(ci(a,t.exit_flow.separable_conv,[1,1])),a})}async forward(e){return this.forwardInput(await ts(e))}getDefaultModelName(){return"tiny_xception_model"}extractParamsFromWeightMap(e){return Q7e(e,this._numMainBlocks)}extractParams(e){return X7e(e,this._numMainBlocks)}};function tqe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=Bu(e),a=vK(n,t),s=a(512,1,"fc/age"),o=a(512,2,"fc/gender");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{fc:{age:s,gender:o}}}}function nqe(e){let t=[],n=em(e,t);function r(s){let o=n(`${s}/weights`,2),l=n(`${s}/bias`,1);return{weights:o,bias:l}}let a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return zu(e,t),{params:a,paramMappings:t}}var rqe=(e=>(e.FEMALE="female",e.MALE="male",e))(rqe||{}),aqe=class extends Lu{constructor(e=new eqe(2)){super("AgeGenderNet"),this._faceFeatureExtractor=e}get faceFeatureExtractor(){return this._faceFeatureExtractor}runNet(e){let{params:t}=this;if(!t)throw new Error(`${this._name} - load model before inference`);return fe(()=>{let n=e instanceof u1?this.faceFeatureExtractor.forwardInput(e):e,r=tc(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1),a=D_(r,t.fc.age).as1D(),s=D_(r,t.fc.gender);return{age:a,gender:s}})}forwardInput(e){return fe(()=>{let{age:t,gender:n}=this.runNet(e);return{age:t,gender:Du(n)}})}async forward(e){return this.forwardInput(await ts(e))}async predictAgeAndGender(e){let t=await ts(e),n=await this.forwardInput(t),r=Ur(n.age),a=Ur(n.gender),s=r.map((l,c)=>({ageTensor:l,genderTensor:a[c]})),o=await Promise.all(s.map(async({ageTensor:l,genderTensor:c})=>{let d=l.dataSync()[0],u=c.dataSync()[0],h=u>.5,p=h?"male":"female",m=h?u:1-u;return l.dispose(),c.dispose(),{age:d,gender:p,genderProbability:m}}));return n.age.dispose(),n.gender.dispose(),t.isBatchInput?o:o[0]}getDefaultModelName(){return"age_gender_model"}dispose(e=!0){this.faceFeatureExtractor.dispose(e),super.dispose(e)}loadClassifierParams(e){let{params:t,paramMappings:n}=this.extractClassifierParams(e);this._params=t,this._paramMappings=n}extractClassifierParams(e){return tqe(e)}extractParamsFromWeightMap(e){let{featureExtractorMap:t,classifierMap:n}=_K(e);return this.faceFeatureExtractor.loadFromWeightMap(t),nqe(n)}extractParams(e){let t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}},MK=class extends jK{postProcess(e,t,n){let r=n.map(({width:s,height:o})=>{let l=t/Math.max(o,s);return{width:s*l,height:o*l}}),a=r.length;return fe(()=>{let s=(d,u)=>Jr([Gs([68],d,"float32"),Gs([68],u,"float32")],1).as2D(1,136).as1D(),o=(d,u)=>{let{width:h,height:p}=r[d];return u(h,p)?Math.abs(h-p)/2:0},l=d=>o(d,(u,h)=>u<h),c=d=>o(d,(u,h)=>h<u);return e.mul(Gs([a,136],t,"float32")).sub(Jr(Array.from(Array(a),(d,u)=>s(l(u),c(u))))).div(Jr(Array.from(Array(a),(d,u)=>s(r[u].width,r[u].height))))})}forwardInput(e){return fe(()=>{let t=this.runNet(e);return this.postProcess(t,e.inputSize,e.inputDimensions.map(([n,r])=>({height:n,width:r})))})}async forward(e){return this.forwardInput(await ts(e))}async detectLandmarks(e){let t=await ts(e),n=fe(()=>Ur(this.forwardInput(t))),r=await Promise.all(n.map(async(a,s)=>{let o=Array.from(a.dataSync()),l=o.filter((d,u)=>E_(u)),c=o.filter((d,u)=>!E_(u));return new iK(Array(68).fill(0).map((d,u)=>new dr(l[u],c[u])),{height:t.getInputHeight(s),width:t.getInputWidth(s)})}));return n.forEach(a=>a.dispose()),t.isBatchInput?r:r[0]}getClassifierChannelsOut(){return 136}},sqe=class extends MK{constructor(e=new CK){super("FaceLandmark68Net",e)}getDefaultModelName(){return"face_landmark_68_model"}getClassifierChannelsIn(){return 256}};function iqe(e){let t=[],{extractDenseBlock3Params:n}=SK(e,t),r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return zu(e,t),{params:r,paramMappings:t}}function oqe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=Bu(e),{extractDenseBlock3Params:a}=NK(n,t),s=a(3,32,"dense0",!0),o=a(32,64,"dense1"),l=a(64,128,"dense2");if(r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{paramMappings:t,params:{dense0:s,dense1:o,dense2:l}}}var lqe=class extends Lu{constructor(){super("TinyFaceFeatureExtractor")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return fe(()=>{let n=He(e.toBatchTensor(112,!0),"float32"),r=kv(n,[122.782,117.001,104.298]).div(255),a=n2(r,t.dense0,!0);return a=n2(a,t.dense1),a=n2(a,t.dense2),a=tc(a,[14,14],[2,2],"valid"),a})}async forward(e){return this.forwardInput(await ts(e))}getDefaultModelName(){return"face_feature_extractor_tiny_model"}extractParamsFromWeightMap(e){return iqe(e)}extractParams(e){return oqe(e)}},cqe=class extends MK{constructor(e=new lqe){super("FaceLandmark68TinyNet",e)}getDefaultModelName(){return"face_landmark_68_tiny_model"}getClassifierChannelsIn(){return 128}};function uqe(e,t){return Re(oe(e,t.weights),t.biases)}function jR(e,t,n,r,a="same"){let{filters:s,bias:o}=t.conv,l=Ja(e,s,n,a);return l=Re(l,o),l=uqe(l,t.scale),r?ar(l):l}function dqe(e,t){return jR(e,t,[1,1],!0)}function $K(e,t){return jR(e,t,[1,1],!1)}function FK(e,t){return jR(e,t,[2,2],!0,"valid")}function hqe(e,t){function n(l,c,d){let u=e(l),h=u.length/(c*d*d);if(Jq(h))throw new Error(`depth has to be an integer: ${h}, weights.length: ${u.length}, numFilters: ${c}, filterSize: ${d}`);return fe(()=>hn(pu(u,[c,h,d,d]),[2,3,1,0]))}function r(l,c,d,u){let h=n(l,c,d),p=er(e(c));return t.push({paramPath:`${u}/filters`},{paramPath:`${u}/bias`}),{filters:h,bias:p}}function a(l,c){let d=er(e(l)),u=er(e(l));return t.push({paramPath:`${c}/weights`},{paramPath:`${c}/biases`}),{weights:d,biases:u}}function s(l,c,d,u){let h=r(l,c,d,`${u}/conv`),p=a(c,`${u}/scale`);return{conv:h,scale:p}}function o(l,c,d,u,h=!1){let p=s((h?.5:1)*l,c,d,`${u}/conv1`),m=s(l,c,d,`${u}/conv2`);return{conv1:p,conv2:m}}return{extractConvLayerParams:s,extractResidualLayerParams:o}}function pqe(e){let{extractWeights:t,getRemainingWeights:n}=Bu(e),r=[],{extractConvLayerParams:a,extractResidualLayerParams:s}=hqe(t,r),o=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),d=s(9216,32,3,"conv32_3"),u=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),f=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),v=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),k=fe(()=>hn(el(t(256*128),[128,256]),[1,0]));if(r.push({paramPath:"fc"}),n().length!==0)throw new Error(`weights remaing after extract: ${n().length}`);return{params:{conv32_down:o,conv32_1:l,conv32_2:c,conv32_3:d,conv64_down:u,conv64_1:h,conv64_2:p,conv64_3:m,conv128_down:f,conv128_1:g,conv128_2:x,conv256_down:y,conv256_1:b,conv256_2:v,conv256_down_out:w,fc:k},paramMappings:r}}function mqe(e,t){let n=em(e,t);function r(o){let l=n(`${o}/scale/weights`,1),c=n(`${o}/scale/biases`,1);return{weights:l,biases:c}}function a(o){let l=n(`${o}/conv/filters`,4),c=n(`${o}/conv/bias`,1),d=r(o);return{conv:{filters:l,bias:c},scale:d}}function s(o){return{conv1:a(`${o}/conv1`),conv2:a(`${o}/conv2`)}}return{extractConvLayerParams:a,extractResidualLayerParams:s}}function fqe(e){let t=[],{extractConvLayerParams:n,extractResidualLayerParams:r}=mqe(e,t),a=n("conv32_down"),s=r("conv32_1"),o=r("conv32_2"),l=r("conv32_3"),c=r("conv64_down"),d=r("conv64_1"),u=r("conv64_2"),h=r("conv64_3"),p=r("conv128_down"),m=r("conv128_1"),f=r("conv128_2"),g=r("conv256_down"),x=r("conv256_1"),y=r("conv256_2"),b=r("conv256_down_out"),{fc:v}=e;if(t.push({originalPath:"fc",paramPath:"fc"}),!Qq(v))throw new Error(`expected weightMap[fc] to be a Tensor2D, instead have ${v}`);let w={conv32_down:a,conv32_1:s,conv32_2:o,conv32_3:l,conv64_down:c,conv64_1:d,conv64_2:u,conv64_3:h,conv128_down:p,conv128_1:m,conv128_2:f,conv256_down:g,conv256_1:x,conv256_2:y,conv256_down_out:b,fc:v};return zu(e,t),{params:w,paramMappings:t}}function Ro(e,t){let n=dqe(e,t.conv1);return n=$K(n,t.conv2),n=Re(n,e),n=ar(n),n}function hw(e,t){let n=FK(e,t.conv1);n=$K(n,t.conv2);let r=tc(e,2,2,"valid"),a=Fr(r.shape),s=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){let o=[...n.shape];o[1]=1;let l=Fr(o);n=pr([n,l],1);let c=[...n.shape];c[2]=1;let d=Fr(c);n=pr([n,d],2)}return r=s?pr([r,a],3):r,n=Re(r,n),n=ar(n),n}var gqe=class extends Lu{constructor(){super("FaceRecognitionNet")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return fe(()=>{let n=He(e.toBatchTensor(150,!0),"float32"),r=kv(n,[122.782,117.001,104.298]).div(255),a=FK(r,t.conv32_down);a=va(a,3,2,"valid"),a=Ro(a,t.conv32_1),a=Ro(a,t.conv32_2),a=Ro(a,t.conv32_3),a=hw(a,t.conv64_down),a=Ro(a,t.conv64_1),a=Ro(a,t.conv64_2),a=Ro(a,t.conv64_3),a=hw(a,t.conv128_down),a=Ro(a,t.conv128_1),a=Ro(a,t.conv128_2),a=hw(a,t.conv256_down),a=Ro(a,t.conv256_1),a=Ro(a,t.conv256_2),a=hw(a,t.conv256_down_out);let s=a.mean([1,2]);return un(s,t.fc)})}async forward(e){return this.forwardInput(await ts(e))}async computeFaceDescriptor(e){var t;if((t=e==null?void 0:e.shape)!=null&&t.some(s=>s<=0))return new Float32Array(128);let n=await ts(e),r=fe(()=>Ur(this.forwardInput(n))),a=await Promise.all(r.map(s=>s.data()));return r.forEach(s=>s.dispose()),n.isBatchInput?a:a[0]}getDefaultModelName(){return"face_recognition_model"}extractParamsFromWeightMap(e){return fqe(e)}extractParams(e){return pqe(e)}};function PK(e,t){return{...e,descriptor:t}}function OK(e,t){return{...e,age:t}}function LK(e,t,n){return{...e,gender:t,genderProbability:n}}function xqe(e,t){function n(c,d){let u=pu(e(9*c),[3,3,c,1]),h=er(e(c)),p=er(e(c)),m=er(e(c)),f=er(e(c));return t.push({paramPath:`${d}/filters`},{paramPath:`${d}/batch_norm_scale`},{paramPath:`${d}/batch_norm_offset`},{paramPath:`${d}/batch_norm_mean`},{paramPath:`${d}/batch_norm_variance`}),{filters:u,batch_norm_scale:h,batch_norm_offset:p,batch_norm_mean:m,batch_norm_variance:f}}function r(c,d,u,h,p){let m=pu(e(c*d*u*u),[u,u,c,d]),f=er(e(d));return t.push({paramPath:`${h}/filters`},{paramPath:`${h}/${p?"batch_norm_offset":"bias"}`}),{filters:m,bias:f}}function a(c,d,u,h){let{filters:p,bias:m}=r(c,d,u,h,!0);return{filters:p,batch_norm_offset:m}}function s(c,d,u){let h=n(c,`${u}/depthwise_conv`),p=a(c,d,1,`${u}/pointwise_conv`);return{depthwise_conv:h,pointwise_conv:p}}function o(){let c=a(3,32,3,"mobilenetv1/conv_0"),d=s(32,64,"mobilenetv1/conv_1"),u=s(64,128,"mobilenetv1/conv_2"),h=s(128,128,"mobilenetv1/conv_3"),p=s(128,256,"mobilenetv1/conv_4"),m=s(256,256,"mobilenetv1/conv_5"),f=s(256,512,"mobilenetv1/conv_6"),g=s(512,512,"mobilenetv1/conv_7"),x=s(512,512,"mobilenetv1/conv_8"),y=s(512,512,"mobilenetv1/conv_9"),b=s(512,512,"mobilenetv1/conv_10"),v=s(512,512,"mobilenetv1/conv_11"),w=s(512,1024,"mobilenetv1/conv_12"),k=s(1024,1024,"mobilenetv1/conv_13");return{conv_0:c,conv_1:d,conv_2:u,conv_3:h,conv_4:p,conv_5:m,conv_6:f,conv_7:g,conv_8:x,conv_9:y,conv_10:b,conv_11:v,conv_12:w,conv_13:k}}function l(){let c=a(1024,256,1,"prediction_layer/conv_0"),d=a(256,512,3,"prediction_layer/conv_1"),u=a(512,128,1,"prediction_layer/conv_2"),h=a(128,256,3,"prediction_layer/conv_3"),p=a(256,128,1,"prediction_layer/conv_4"),m=a(128,256,3,"prediction_layer/conv_5"),f=a(256,64,1,"prediction_layer/conv_6"),g=a(64,128,3,"prediction_layer/conv_7"),x=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),y=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),v=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),I=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),T=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),A=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor");return{conv_0:c,conv_1:d,conv_2:u,conv_3:h,conv_4:p,conv_5:m,conv_6:f,conv_7:g,box_predictor_0:{box_encoding_predictor:x,class_predictor:y},box_predictor_1:{box_encoding_predictor:b,class_predictor:v},box_predictor_2:{box_encoding_predictor:w,class_predictor:k},box_predictor_3:{box_encoding_predictor:C,class_predictor:S},box_predictor_4:{box_encoding_predictor:_,class_predictor:I},box_predictor_5:{box_encoding_predictor:T,class_predictor:A}}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:l}}function yqe(e){let t=[],{extractWeights:n,getRemainingWeights:r}=Bu(e),{extractMobilenetV1Params:a,extractPredictionLayerParams:s}=xqe(n,t),o=a(),l=s(),c={extra_dim:NN(n(5118*4),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),r().length!==0)throw new Error(`weights remaing after extract: ${r().length}`);return{params:{mobilenetv1:o,prediction_layer:l,output_layer:c},paramMappings:t}}function bqe(e,t){let n=em(e,t);function r(d,u,h){let p=n(`${d}/Conv2d_${u}_pointwise/weights`,4,`${h}/filters`),m=n(`${d}/Conv2d_${u}_pointwise/convolution_bn_offset`,1,`${h}/batch_norm_offset`);return{filters:p,batch_norm_offset:m}}function a(d){let u=`mobilenetv1/conv_${d}`,h=`MobilenetV1/Conv2d_${d}_depthwise`,p=`${u}/depthwise_conv`,m=`${u}/pointwise_conv`,f=n(`${h}/depthwise_weights`,4,`${p}/filters`),g=n(`${h}/BatchNorm/gamma`,1,`${p}/batch_norm_scale`),x=n(`${h}/BatchNorm/beta`,1,`${p}/batch_norm_offset`),y=n(`${h}/BatchNorm/moving_mean`,1,`${p}/batch_norm_mean`),b=n(`${h}/BatchNorm/moving_variance`,1,`${p}/batch_norm_variance`);return{depthwise_conv:{filters:f,batch_norm_scale:g,batch_norm_offset:x,batch_norm_mean:y,batch_norm_variance:b},pointwise_conv:r("MobilenetV1",d,m)}}function s(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function o(d,u){let h=n(`${d}/weights`,4,`${u}/filters`),p=n(`${d}/biases`,1,`${u}/bias`);return{filters:h,bias:p}}function l(d){let u=o(`Prediction/BoxPredictor_${d}/BoxEncodingPredictor`,`prediction_layer/box_predictor_${d}/box_encoding_predictor`),h=o(`Prediction/BoxPredictor_${d}/ClassPredictor`,`prediction_layer/box_predictor_${d}/class_predictor`);return{box_encoding_predictor:u,class_predictor:h}}function c(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:l(0),box_predictor_1:l(1),box_predictor_2:l(2),box_predictor_3:l(3),box_predictor_4:l(4),box_predictor_5:l(5)}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:c}}function vqe(e){let t=[],{extractMobilenetV1Params:n,extractPredictionLayerParams:r}=bqe(e,t),a=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Nv(a))throw new Error(`expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ${a}`);let s={mobilenetv1:n(),prediction_layer:r(),output_layer:{extra_dim:a}};return zu(e,t),{params:s,paramMappings:t}}function Po(e,t,n){return fe(()=>{let r=Ja(e,t.filters,n,"same");return r=Re(r,t.batch_norm_offset),Wa(r,0,6)})}var wqe=.0010000000474974513;function Nqe(e,t,n){return fe(()=>{let r=Vp(e,t.filters,n,"same");return r=Up(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,wqe),Wa(r,0,6)})}function kqe(e){return[2,4,6,12].some(t=>t===e)?[2,2]:[1,1]}function Sqe(e,t){return fe(()=>{let n,r=Po(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((a,s)=>{let o=s+1,l=kqe(o);r=Nqe(r,a.depthwise_conv,l),r=Po(r,a.pointwise_conv,[1,1]),o===11&&(n=r)}),n===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Cqe(e,t,n){let r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),s=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),l=Math.max(r[t][1],r[t][3]),c=Math.min(r[n][0],r[n][2]),d=Math.min(r[n][1],r[n][3]),u=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),p=(o-a)*(l-s),m=(u-c)*(h-d);if(p<=0||m<=0)return 0;let f=Math.max(a,c),g=Math.max(s,d),x=Math.min(o,u),y=Math.min(l,h),b=Math.max(x-f,0)*Math.max(y-g,0);return b/(p+m-b)}function _qe(e,t,n,r,a){let s=e.shape[0],o=Math.min(n,s),l=t.map((u,h)=>({score:u,boxIndex:h})).filter(u=>u.score>a).sort((u,h)=>h.score-u.score),c=u=>u<=r?1:0,d=[];return l.forEach(u=>{if(d.length>=o)return;let h=u.score;for(let p=d.length-1;p>=0;--p){let m=Cqe(e,u.boxIndex,d[p]);if(m!==0&&(u.score*=c(m),u.score<=a))break}h===u.score&&d.push(u.boxIndex)}),d}function jqe(e){let t=Ur(hn(e,[1,0])),n=[ot(t[2],t[0]),ot(t[3],t[1])],r=[Re(t[0],pt(n[0],2)),Re(t[1],pt(n[1],2))];return{sizes:n,centers:r}}function Iqe(e,t){let{sizes:n,centers:r}=jqe(e),a=Ur(hn(t,[1,0])),s=pt(oe(Ua(pt(a[2],5)),n[0]),2),o=Re(oe(pt(a[0],10),n[0]),r[0]),l=pt(oe(Ua(pt(a[3],5)),n[1]),2),c=Re(oe(pt(a[1],10),n[1]),r[1]);return hn(Jr([ot(o,s),ot(c,l),Re(o,s),Re(c,l)]),[1,0])}function Tqe(e,t,n){return fe(()=>{let r=e.shape[0],a=Iqe(me(Us(n.extra_dim,[r,1,1]),[-1,4]),me(e,[-1,4]));a=me(a,[r,a.shape[0]/r,4]);let s=Li(En(t,[0,0,1],[-1,-1,-1])),o=En(s,[0,0,0],[-1,-1,1]);o=me(o,[r,o.shape[1]]);let l=Ur(a),c=Ur(o);return{boxes:l,scores:c}})}function dm(e,t){return fe(()=>{let n=e.shape[0],r=me(by(e,t.box_encoding_predictor),[n,-1,1,4]),a=me(by(e,t.class_predictor),[n,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function Eqe(e,t,n){return fe(()=>{let r=Po(e,n.conv_0,[1,1]),a=Po(r,n.conv_1,[2,2]),s=Po(a,n.conv_2,[1,1]),o=Po(s,n.conv_3,[2,2]),l=Po(o,n.conv_4,[1,1]),c=Po(l,n.conv_5,[2,2]),d=Po(c,n.conv_6,[1,1]),u=Po(d,n.conv_7,[2,2]),h=dm(t,n.box_predictor_0),p=dm(e,n.box_predictor_1),m=dm(a,n.box_predictor_2),f=dm(o,n.box_predictor_3),g=dm(c,n.box_predictor_4),x=dm(u,n.box_predictor_5),y=pr([h.boxPredictionEncoding,p.boxPredictionEncoding,m.boxPredictionEncoding,f.boxPredictionEncoding,g.boxPredictionEncoding,x.boxPredictionEncoding],1),b=pr([h.classPrediction,p.classPrediction,m.classPrediction,f.classPrediction,g.classPrediction,x.classPrediction],1);return{boxPredictions:y,classPredictions:b}})}var lk=class{constructor({minConfidence:e,maxResults:t}={}){if(this._name="SsdMobilenetv1Options",this._minConfidence=e||.5,this._maxResults=t||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(`${this._name} - expected minConfidence to be a number between 0 and 1`);if(typeof this._maxResults!="number")throw new Error(`${this._name} - expected maxResults to be a number`)}get minConfidence(){return this._minConfidence}get maxResults(){return this._maxResults}},Aqe=class extends Lu{constructor(){super("SsdMobilenetv1")}forwardInput(e){let{params:t}=this;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return fe(()=>{let n=He(e.toBatchTensor(512,!1),"float32"),r=ot(pt(n,127.5),1),a=Sqe(r,t.mobilenetv1),{boxPredictions:s,classPredictions:o}=Eqe(a.out,a.conv11,t.prediction_layer);return Tqe(s,o,t.output_layer)})}async forward(e){return this.forwardInput(await ts(e))}async locateFaces(e,t={}){let{maxResults:n,minConfidence:r}=new lk(t),a=await ts(e),{boxes:s,scores:o}=this.forwardInput(a),l=s[0],c=o[0];for(let y=1;y<s.length;y++)s[y].dispose(),o[y].dispose();let d=Array.from(c.dataSync()),u=_qe(l,d,n,.5,r),h=a.getReshapedInputDimensions(0),p=a.inputSize,m=p/h.width,f=p/h.height,g=l.arraySync(),x=u.map(y=>{let[b,v]=[Math.max(0,g[y][0]),Math.min(1,g[y][2])].map(C=>C*f),[w,k]=[Math.max(0,g[y][1]),Math.min(1,g[y][3])].map(C=>C*m);return new _o(d[y],new sK(w,b,k-w,v-b),{height:a.getInputHeight(0),width:a.getInputWidth(0)})});return l.dispose(),c.dispose(),x}getDefaultModelName(){return"ssd_mobilenetv1_model"}extractParamsFromWeightMap(e){return vqe(e)}extractParams(e){return yqe(e)}},Rqe=.4,Dqe=[new dr(.738768,.874946),new dr(2.42204,2.65704),new dr(4.30971,7.04493),new dr(10.246,4.59428),new dr(12.6868,11.8741)],Mqe=[new dr(1.603231,2.094468),new dr(6.041143,7.080126),new dr(2.882459,3.518061),new dr(4.266906,5.178857),new dr(9.041765,10.66308)],$qe=[117.001,114.697,97.404],Fqe="tiny_yolov2_model",Pqe="tiny_yolov2_separable_conv_model",pw=e=>typeof e=="number";function Oqe(e){if(!e)throw new Error(`invalid config: ${e}`);if(typeof e.withSeparableConvs!="boolean")throw new Error(`config.withSeparableConvs has to be a boolean, have: ${e.withSeparableConvs}`);if(!pw(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error(`config.iouThreshold has to be a number between [0, 1], have: ${e.iouThreshold}`);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(t=>typeof t=="string"))throw new Error(`config.classes has to be an array class names: string[], have: ${JSON.stringify(e.classes)}`);if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(t=>t||{}).every(t=>pw(t.x)&&pw(t.y)))throw new Error(`config.anchors has to be an array of { x: number, y: number }, have: ${JSON.stringify(e.anchors)}`);if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(pw)))throw new Error(`config.meanRgb has to be an array of shape [number, number, number], have: ${JSON.stringify(e.meanRgb)}`)}function IR(e){return fe(()=>{let t=oe(e,Rt(.10000000149011612));return Re(ar(ot(e,t)),t)})}function hc(e,t){return fe(()=>{let n=jo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Ja(n,t.conv.filters,[1,1],"valid"),n=ot(n,t.bn.sub),n=oe(n,t.bn.truediv),n=Re(n,t.conv.bias),IR(n)})}function pc(e,t){return fe(()=>{let n=jo(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Gg(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),n=Re(n,t.bias),IR(n)})}function Lqe(e,t){let n=kR(e,t);function r(o,l){let c=er(e(o)),d=er(e(o));return t.push({paramPath:`${l}/sub`},{paramPath:`${l}/truediv`}),{sub:c,truediv:d}}function a(o,l,c){let d=n(o,l,3,`${c}/conv`),u=r(l,`${c}/bn`);return{conv:d,bn:u}}let s=SR(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}}function zqe(e,t,n,r){let{extractWeights:a,getRemainingWeights:s}=Bu(e),o=[],{extractConvParams:l,extractConvWithBatchNormParams:c,extractSeparableConvParams:d}=Lqe(a,o),u;if(t.withSeparableConvs){let[h,p,m,f,g,x,y,b,v]=r,w=t.isFirstLayerConv2d?l(h,p,3,"conv0"):d(h,p,"conv0"),k=d(p,m,"conv1"),C=d(m,f,"conv2"),S=d(f,g,"conv3"),_=d(g,x,"conv4"),I=d(x,y,"conv5"),T=b?d(y,b,"conv6"):void 0,A=v?d(b,v,"conv7"):void 0,j=l(v||b||y,5*n,1,"conv8");u={conv0:w,conv1:k,conv2:C,conv3:S,conv4:_,conv5:I,conv6:T,conv7:A,conv8:j}}else{let[h,p,m,f,g,x,y,b,v]=r,w=c(h,p,"conv0"),k=c(p,m,"conv1"),C=c(m,f,"conv2"),S=c(f,g,"conv3"),_=c(g,x,"conv4"),I=c(x,y,"conv5"),T=c(y,b,"conv6"),A=c(b,v,"conv7"),j=l(v,5*n,1,"conv8");u={conv0:w,conv1:k,conv2:C,conv3:S,conv4:_,conv5:I,conv6:T,conv7:A,conv8:j}}if(s().length!==0)throw new Error(`weights remaing after extract: ${s().length}`);return{params:u,paramMappings:o}}function Bqe(e,t){let n=em(e,t);function r(l){let c=n(`${l}/sub`,1),d=n(`${l}/truediv`,1);return{sub:c,truediv:d}}function a(l){let c=n(`${l}/filters`,4),d=n(`${l}/bias`,1);return{filters:c,bias:d}}function s(l){let c=a(`${l}/conv`),d=r(`${l}/bn`);return{conv:c,bn:d}}let o=CR(n);return{extractConvParams:a,extractConvWithBatchNormParams:s,extractSeparableConvParams:o}}function Wqe(e,t){let n=[],{extractConvParams:r,extractConvWithBatchNormParams:a,extractSeparableConvParams:s}=Bqe(e,n),o;if(t.withSeparableConvs){let l=t.filterSizes&&t.filterSizes.length||9;o={conv0:t.isFirstLayerConv2d?r("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:l>7?s("conv6"):void 0,conv7:l>8?s("conv7"):void 0,conv8:r("conv8")}}else o={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:r("conv8")};return zu(e,n),{params:o,paramMappings:n}}var TR=class{constructor({inputSize:e,scoreThreshold:t}={}){if(this._name="TinyYolov2Options",this._inputSize=e||416,this._scoreThreshold=t||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(`${this._name} - expected inputSize to be a number divisible by 32`);if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(`${this._name} - expected scoreThreshold to be a number between 0 and 1`)}get inputSize(){return this._inputSize}get scoreThreshold(){return this._scoreThreshold}},zK=class BK extends Lu{constructor(t){super("TinyYolov2"),Oqe(t),this._config=t}get config(){return this._config}get withClassScores(){return this.config.withClassScores||this.config.classes.length>1}get boxEncodingSize(){return 5+(this.withClassScores?this.config.classes.length:0)}runTinyYolov2(t,n){let r=hc(t,n.conv0);return r=va(r,[2,2],[2,2],"same"),r=hc(r,n.conv1),r=va(r,[2,2],[2,2],"same"),r=hc(r,n.conv2),r=va(r,[2,2],[2,2],"same"),r=hc(r,n.conv3),r=va(r,[2,2],[2,2],"same"),r=hc(r,n.conv4),r=va(r,[2,2],[2,2],"same"),r=hc(r,n.conv5),r=va(r,[2,2],[1,1],"same"),r=hc(r,n.conv6),r=hc(r,n.conv7),by(r,n.conv8,"valid",!1)}runMobilenet(t,n){let r=this.config.isFirstLayerConv2d?IR(by(t,n.conv0,"valid",!1)):pc(t,n.conv0);return r=va(r,[2,2],[2,2],"same"),r=pc(r,n.conv1),r=va(r,[2,2],[2,2],"same"),r=pc(r,n.conv2),r=va(r,[2,2],[2,2],"same"),r=pc(r,n.conv3),r=va(r,[2,2],[2,2],"same"),r=pc(r,n.conv4),r=va(r,[2,2],[2,2],"same"),r=pc(r,n.conv5),r=va(r,[2,2],[1,1],"same"),r=n.conv6?pc(r,n.conv6):r,r=n.conv7?pc(r,n.conv7):r,by(r,n.conv8,"valid",!1)}forwardInput(t,n){let{params:r}=this;if(!r)throw new Error("TinyYolov2 - load model before inference");return fe(()=>{let a=He(t.toBatchTensor(n,!1),"float32");return a=this.config.meanRgb?kv(a,this.config.meanRgb):a,a=a.div(255),this.config.withSeparableConvs?this.runMobilenet(a,r):this.runTinyYolov2(a,r)})}async forward(t,n){return this.forwardInput(await ts(t),n)}async detect(t,n={}){let{inputSize:r,scoreThreshold:a}=new TR(n),s=await ts(t),o=await this.forwardInput(s,r),l=fe(()=>Ur(o)[0].expandDims()),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},d=await this.extractBoxes(l,s.getReshapedInputDimensions(0),a);o.dispose(),l.dispose();let u=d.map(f=>f.box),h=d.map(f=>f.score),p=d.map(f=>f.classScore),m=d.map(f=>this.config.classes[f.label]);return _7e(u.map(f=>f.rescale(r)),h,this.config.iouThreshold,!0).map(f=>new nK(h[f],p[f],m[f],u[f],c))}getDefaultModelName(){return""}extractParamsFromWeightMap(t){return Wqe(t,this.config)}extractParams(t){let n=this.config.filterSizes||BK.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(r!==7&&r!==8&&r!==9)throw new Error(`TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ${r} filterSizes in config`);return zqe(t,this.config,this.boxEncodingSize,n)}async extractBoxes(t,n,r){let{width:a,height:s}=n,o=Math.max(a,s),l=o/a,c=o/s,d=t.shape[1],u=this.config.anchors.length,[h,p,m]=fe(()=>{let y=t.reshape([d,d,u,this.boxEncodingSize]),b=y.slice([0,0,0,0],[d,d,u,4]),v=y.slice([0,0,0,4],[d,d,u,1]),w=this.withClassScores?Du(y.slice([0,0,0,5],[d,d,u,this.config.classes.length]),3):Rt(0);return[b,v,w]}),f=[],g=await p.array(),x=await h.array();for(let y=0;y<d;y++)for(let b=0;b<d;b++)for(let v=0;v<u;v++){let w=t2(g[y][b][v][0]);if(!r||w>r){let k=(b+t2(x[y][b][v][0]))/d*l,C=(y+t2(x[y][b][v][1]))/d*c,S=Math.exp(x[y][b][v][2])*this.config.anchors[v].x/d*l,_=Math.exp(x[y][b][v][3])*this.config.anchors[v].y/d*c,I=k-S/2,T=C-_/2,A={row:y,col:b,anchor:v},{classScore:j,label:D}=this.withClassScores?await this.extractPredictedClass(m,A):{classScore:1,label:0};f.push({box:new tK(I,T,I+S,T+_),score:w,classScore:w*j,label:D,...A})}}return h.dispose(),p.dispose(),m.dispose(),f}async extractPredictedClass(t,n){let{row:r,col:a,anchor:s}=n,o=await t.array();return Array(this.config.classes.length).fill(0).map((l,c)=>o[r][a][s][c]).map((l,c)=>({classScore:l,label:c})).reduce((l,c)=>l.classScore>c.classScore?l:c)}};zK.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var WK=zK,Uqe=class extends WK{constructor(e=!0){let t={withSeparableConvs:e,iouThreshold:Rqe,classes:["face"],...e?{anchors:Mqe,meanRgb:$qe}:{anchors:Dqe,withClassScores:!0}};super(t)}get withSeparableConvs(){return this.config.withSeparableConvs}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new _o(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return this.withSeparableConvs?Pqe:Fqe}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},UK=class extends TR{constructor(){super(...arguments),this._name="TinyFaceDetectorOptions"}},Sv=class{async then(e){return e(await this.run())}async run(){throw new Error("ComposableTask - run is not implemented")}};async function ck(e,t,n,r,a=({alignedRect:s})=>s){let s=e.map(c=>TK(c)?a(c):c.detection),o=r||(t instanceof on?await NR(t,s):await wR(t,s)),l=await n(o);return o.forEach(c=>c instanceof on&&c.dispose()),l}async function ER(e,t,n,r,a){return ck([e],t,async s=>n(s[0]),r,a)}var Vqe=.4,Hqe=[new dr(1.603231,2.094468),new dr(6.041143,7.080126),new dr(2.882459,3.518061),new dr(4.266906,5.178857),new dr(9.041765,10.66308)],Gqe=[117.001,114.697,97.404],qqe=class extends WK{constructor(){let e={withSeparableConvs:!0,iouThreshold:Vqe,classes:["face"],anchors:Hqe,meanRgb:Gqe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};super(e)}get anchors(){return this.config.anchors}async locateFaces(e,t){return(await this.detect(e,t)).map(n=>new _o(n.score,n.relativeBox,{width:n.imageWidth,height:n.imageHeight}))}getDefaultModelName(){return"tiny_face_detector_model"}extractParamsFromWeightMap(e){return super.extractParamsFromWeightMap(e)}},zi={ssdMobilenetv1:new Aqe,tinyFaceDetector:new qqe,tinyYolov2:new Uqe,faceLandmark68Net:new sqe,faceLandmark68TinyNet:new cqe,faceRecognitionNet:new gqe,faceExpressionNet:new V7e,ageGenderNet:new aqe},VK=class extends Sv{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},AR=class extends VK{async run(){let e=await this.parentTask,t=await ck(e,this.input,async n=>Promise.all(n.map(r=>zi.faceExpressionNet.predictExpressions(r))),this.extractedFaces);return e.map((n,r)=>IK(n,t[r]))}withAgeAndGender(){return new $R(this,this.input)}},RR=class extends VK{async run(){let e=await this.parentTask;if(!e)return;let t=await ER(e,this.input,n=>zi.faceExpressionNet.predictExpressions(n),this.extractedFaces);return IK(e,t)}withAgeAndGender(){return new FR(this,this.input)}},DR=class extends AR{withAgeAndGender(){return new PR(this,this.input)}withFaceDescriptors(){return new LR(this,this.input)}},MR=class extends RR{withAgeAndGender(){return new OR(this,this.input)}withFaceDescriptor(){return new zR(this,this.input)}},HK=class extends Sv{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.extractedFaces=n}},$R=class extends HK{async run(){let e=await this.parentTask,t=await ck(e,this.input,async n=>Promise.all(n.map(r=>zi.ageGenderNet.predictAgeAndGender(r))),this.extractedFaces);return e.map((n,r)=>{let{age:a,gender:s,genderProbability:o}=t[r];return OK(LK(n,s,o),a)})}withFaceExpressions(){return new AR(this,this.input)}},FR=class extends HK{async run(){let e=await this.parentTask;if(!e)return;let{age:t,gender:n,genderProbability:r}=await ER(e,this.input,a=>zi.ageGenderNet.predictAgeAndGender(a),this.extractedFaces);return OK(LK(e,n,r),t)}withFaceExpressions(){return new RR(this,this.input)}},PR=class extends $R{withFaceExpressions(){return new DR(this,this.input)}withFaceDescriptors(){return new LR(this,this.input)}},OR=class extends FR{withFaceExpressions(){return new MR(this,this.input)}withFaceDescriptor(){return new zR(this,this.input)}},GK=class extends Sv{constructor(e,t){super(),this.parentTask=e,this.input=t}},LR=class extends GK{async run(){let e=await this.parentTask;return(await ck(e,this.input,t=>Promise.all(t.map(n=>zi.faceRecognitionNet.computeFaceDescriptor(n))),null,t=>t.landmarks.align(null,{useDlibAlignment:!0}))).map((t,n)=>PK(e[n],t))}withFaceExpressions(){return new DR(this,this.input)}withAgeAndGender(){return new PR(this,this.input)}},zR=class extends GK{async run(){let e=await this.parentTask;if(!e)return;let t=await ER(e,this.input,n=>zi.faceRecognitionNet.computeFaceDescriptor(n),null,n=>n.landmarks.align(null,{useDlibAlignment:!0}));return PK(e,t)}withFaceExpressions(){return new MR(this,this.input)}withAgeAndGender(){return new OR(this,this.input)}},qK=class extends Sv{constructor(e,t,n){super(),this.parentTask=e,this.input=t,this.useTinyLandmarkNet=n}get landmarkNet(){return this.useTinyLandmarkNet?zi.faceLandmark68TinyNet:zi.faceLandmark68Net}},Kqe=class extends qK{async run(){let e=await this.parentTask,t=e.map(a=>a.detection),n=this.input instanceof on?await NR(this.input,t):await wR(this.input,t),r=await Promise.all(n.map(a=>this.landmarkNet.detectLandmarks(a)));return n.forEach(a=>a instanceof on&&a.dispose()),e.filter((a,s)=>r[s]).map((a,s)=>EK(a,r[s]))}withFaceExpressions(){return new DR(this,this.input)}withAgeAndGender(){return new PR(this,this.input)}withFaceDescriptors(){return new LR(this,this.input)}},Yqe=class extends qK{async run(){let e=await this.parentTask;if(!e)return;let{detection:t}=e,n=this.input instanceof on?await NR(this.input,[t]):await wR(this.input,[t]),r=await this.landmarkNet.detectLandmarks(n[0]);return n.forEach(a=>a instanceof on&&a.dispose()),EK(e,r)}withFaceExpressions(){return new MR(this,this.input)}withAgeAndGender(){return new OR(this,this.input)}withFaceDescriptor(){return new zR(this,this.input)}},KK=class extends Sv{constructor(e,t=new lk){super(),this.input=e,this.options=t}},Xqe=class extends KK{async run(){let{input:e,options:t}=this,n;if(t instanceof UK)n=zi.tinyFaceDetector.locateFaces(e,t);else if(t instanceof lk)n=zi.ssdMobilenetv1.locateFaces(e,t);else if(t instanceof TR)n=zi.tinyYolov2.locateFaces(e,t);else throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");return n}runAndExtendWithFaceDetections(){return new Promise((e,t)=>{this.run().then(n=>e(n.map(r=>oK({},r)))).catch(n=>t(n))})}withFaceLandmarks(e=!1){return new Kqe(this.runAndExtendWithFaceDetections(),this.input,e)}withFaceExpressions(){return new AR(this.runAndExtendWithFaceDetections(),this.input)}withAgeAndGender(){return new $R(this.runAndExtendWithFaceDetections(),this.input)}},Zqe=class extends KK{async run(){let e=await new Xqe(this.input,this.options),t=e[0];return e.forEach(n=>{n.score>t.score&&(t=n)}),t}runAndExtendWithFaceDetection(){return new Promise(async e=>{let t=await this.run();e(t?oK({},t):void 0)})}withFaceLandmarks(e=!1){return new Yqe(this.runAndExtendWithFaceDetection(),this.input,e)}withFaceExpressions(){return new RR(this.runAndExtendWithFaceDetection(),this.input)}withAgeAndGender(){return new FR(this.runAndExtendWithFaceDetection(),this.input)}};function Qqe(e,t=new lk){return new Zqe(e,t)}let xP=!1;const Jqe="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model";async function eKe(){xP||(await zi.tinyFaceDetector.loadFromUri(Jqe),xP=!0)}async function tKe(e){return await eKe(),new Promise(t=>{const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{try{const r=await Qqe(n,new UK);if(!r)return t(null);const a=(r.box.x+r.box.width/2)/n.width,s=(r.box.y+r.box.height/2)/n.height;t({x:Math.round(a*100),y:Math.round(s*100)})}catch(r){console.warn("Face detection error:",r),t(null)}},n.onerror=()=>t(null)})}const mw=512,yP=3;function nKe({open:e,imageFile:t,onClose:n,onSave:r}){const[a,s]=N.useState(""),[o,l]=N.useState(!1),[c,d]=N.useState(!1),u=N.useRef(null),h=N.useRef(null),p=N.useRef(1),m=N.useRef(1),f=N.useRef({x:0,y:0}),g=N.useRef(null),x=N.useRef(null),y=N.useRef(null),b=N.useCallback(()=>{const M=u.current,X=h.current;if(!M||!X)return null;const W=M.getBoundingClientRect().width,O=X.naturalWidth||1,U=X.naturalHeight||1;return{containerSize:W,imgW:O,imgH:U}},[]),v=N.useCallback(()=>{const M=b();if(!M)return 1;const{containerSize:X,imgW:G,imgH:W}=M;return Math.max(X/G,X/W)},[b]),w=N.useCallback(()=>{const M=b();if(!M)return;const{containerSize:X,imgW:G,imgH:W}=M,O=p.current,U=G*O,K=W*O,ce=Math.max(0,(U-X)/2),ne=Math.max(0,(K-X)/2);f.current.x=Math.max(-ce,Math.min(ce,f.current.x)),f.current.y=Math.max(-ne,Math.min(ne,f.current.y))},[b]),k=N.useCallback(()=>{const M=h.current;if(!M)return;w();const{x:X,y:G}=f.current,W=p.current;M.style.transform=`
    translate(-50%, -50%)
    translate(${X}px, ${G}px)
    scale(${W})
  `},[w]),C=N.useCallback(()=>{y.current||(y.current=requestAnimationFrame(()=>{k(),y.current=null}))},[k]),S=N.useCallback(()=>{const M=b();if(!M||M.containerSize===0){requestAnimationFrame(S);return}m.current=v(),p.current=m.current,f.current={x:0,y:0},k(),d(!0)},[b,v,k]);N.useEffect(()=>{if(!t)return;d(!1);const M=URL.createObjectURL(t);return s(M),()=>URL.revokeObjectURL(M)},[t]);const _=N.useCallback(()=>{requestAnimationFrame(()=>{requestAnimationFrame(S)})},[S]),I=M=>{if(M.preventDefault(),M.touches.length===1)g.current={x:M.touches[0].clientX,y:M.touches[0].clientY};else if(M.touches.length===2){const X=M.touches[0].clientX-M.touches[1].clientX,G=M.touches[0].clientY-M.touches[1].clientY;x.current=Math.hypot(X,G),g.current={x:(M.touches[0].clientX+M.touches[1].clientX)/2,y:(M.touches[0].clientY+M.touches[1].clientY)/2}}},T=M=>{if(M.preventDefault(),M.touches.length===1&&g.current){const X=M.touches[0].clientX-g.current.x,G=M.touches[0].clientY-g.current.y;f.current.x+=X,f.current.y+=G,g.current={x:M.touches[0].clientX,y:M.touches[0].clientY},C()}else if(M.touches.length===2&&x.current!==null){const X=M.touches[0].clientX-M.touches[1].clientX,G=M.touches[0].clientY-M.touches[1].clientY,W=Math.hypot(X,G),O=W/x.current,U=Math.max(m.current,Math.min(yP,p.current*O));p.current=U,x.current=W,C()}},A=()=>{g.current=null,x.current=null},j=M=>{M.button===0&&(M.preventDefault(),g.current={x:M.clientX,y:M.clientY})},D=M=>{if(!g.current)return;M.preventDefault();const X=M.clientX-g.current.x,G=M.clientY-g.current.y;f.current.x+=X,f.current.y+=G,g.current={x:M.clientX,y:M.clientY},C()},F=()=>{g.current=null},B=M=>{M.preventDefault();const X=M.deltaY>0?.9:1.1,G=Math.max(m.current,Math.min(yP,p.current*X));p.current=G,C()},q=()=>{m.current=v(),p.current=m.current,f.current={x:0,y:0},k()},$=async()=>{if(a){l(!0);try{const M=await tKe(a);if(!M)return;const X=b();if(!X)return;const{containerSize:G,imgW:W,imgH:O}=X;m.current=v(),p.current=m.current*1.2;const U=M.x/100*W*p.current,K=M.y/100*O*p.current,ce=W*p.current/2,ne=O*p.current/2;f.current={x:ce-U,y:ne-K},k()}finally{l(!1)}}},L=()=>{const M=h.current,X=b();if(!M||!X)return;const{containerSize:G,imgW:W,imgH:O}=X,U=p.current,{x:K,y:ce}=f.current,ne=W*U,te=O*U,Te=(ne-G)/2-K,Ae=(te-G)/2-ce,Se=Te/U,we=Ae/U,Fe=G/U,Q=document.createElement("canvas");Q.width=mw,Q.height=mw,Q.getContext("2d").drawImage(M,Se,we,Fe,Fe,0,0,mw,mw),Q.toBlob(Le=>Le&&r(Le),"image/webp",.85)};return i.jsx(vn,{open:e,onOpenChange:n,children:i.jsxs(mn,{className:"max-w-md p-0",children:[i.jsx(wn,{className:"p-4",children:i.jsx(Nn,{children:"Adjust Profile Photo"})}),i.jsx("div",{className:"px-4",children:i.jsxs("div",{ref:u,className:"relative w-full aspect-square overflow-hidden rounded-xl bg-black cursor-grab active:cursor-grabbing",style:{touchAction:"none"},onTouchStart:I,onTouchMove:T,onTouchEnd:A,onMouseDown:j,onMouseMove:D,onMouseUp:F,onMouseLeave:F,onWheel:B,children:[a&&i.jsx("img",{ref:h,src:a,alt:"Crop preview",draggable:!1,onLoad:_,className:`absolute top-1/2 left-1/2 max-w-none select-none ${c?"opacity-100":"opacity-0"}`,style:{transformOrigin:"center center"}}),i.jsx("div",{className:"pointer-events-none absolute inset-0 grid grid-cols-3 grid-rows-3",children:[...Array(9)].map((M,X)=>i.jsx("div",{className:"border border-white/30"},X))})]})}),i.jsxs("div",{className:"px-4 py-3 flex gap-2",children:[i.jsxs(de,{variant:"outline",onClick:$,disabled:o,children:[o?i.jsx(Gt,{className:"h-4 w-4 animate-spin mr-1"}):i.jsx(EX,{className:"h-4 w-4 mr-1"}),"Face"]}),i.jsxs(de,{variant:"outline",onClick:q,children:[i.jsx(Ww,{className:"h-4 w-4 mr-1"})," Reset"]})]}),i.jsxs("div",{className:"flex gap-2 p-4 pt-0",children:[i.jsx(de,{variant:"outline",onClick:n,children:"Cancel"}),i.jsx(de,{onClick:L,children:"Save"})]})]})})}const YK=N.forwardRef(({name:e,designation:t,company:n,photoUrl:r,publicUrl:a,slug:s},o)=>{const[l,c]=N.useState(null),[d,u]=N.useState(!1);N.useEffect(()=>{if(!r){u(!0);return}(async()=>{try{const f=await(await fetch(r,{mode:"cors"})).blob(),g=new FileReader;g.onloadend=()=>{c(g.result),u(!0)},g.onerror=()=>{c(r),u(!0)},g.readAsDataURL(f)}catch(m){console.error("Failed to preload photo:",m),c(r),u(!0)}})()},[r]);const h=p=>p.split(" ").filter(Boolean).map(m=>m[0]).join("").toUpperCase().slice(0,2)||"U";return s.startsWith("/u/")&&`${s}`,i.jsx("div",{ref:o,style:{width:1080,height:1350,background:"linear-gradient(180deg, #f8f9fa 0%, #e9ecef 100%)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:"80px 60px",fontFamily:'-apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',position:"absolute",left:"-9999px",top:"-9999px",overflow:"hidden",pointerEvents:"none"},children:i.jsxs("div",{style:{width:"100%",maxWidth:900,background:"#ffffff",borderRadius:48,boxShadow:"0 20px 60px rgba(0, 0, 0, 0.07), 0 6px 18px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",alignItems:"center",padding:"56px 48px 48px",flex:1},children:[i.jsx("div",{style:{width:200,height:200,borderRadius:"50%",overflow:"hidden",border:"6px solid #f1f3f4",background:"linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 10px 32px rgba(0, 0, 0, 0.1)",marginBottom:32},children:l?i.jsx("img",{src:l,alt:e,style:{width:"100%",height:"100%",objectFit:"cover"}}):i.jsx("span",{style:{fontSize:72,fontWeight:600,color:"#9ca3af"},children:h(e)})}),i.jsx("h1",{style:{fontSize:72,fontWeight:700,color:"#1a1a1a",margin:0,textAlign:"center",letterSpacing:"-0.02em",lineHeight:1.1},children:e}),t&&i.jsx("p",{style:{fontSize:36,fontWeight:500,color:"#4b5563",margin:"18px 0 0",textAlign:"center"},children:t}),n&&i.jsx("p",{style:{fontSize:32,fontWeight:500,color:"#9ca3af",margin:"10px 0 0",textAlign:"center",letterSpacing:"0.02em"},children:n}),i.jsxs("div",{style:{marginTop:36,background:"#ffffff",borderRadius:32,padding:36,boxShadow:"0 6px 24px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0, 0, 0, 0.06)",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx(vI,{value:a,size:320,level:"H",includeMargin:!1,bgColor:"#ffffff",fgColor:"#1a1a1a"}),i.jsx("p",{style:{fontSize:30,fontWeight:600,color:"#111827",margin:"28px 0 10px",textAlign:"center",letterSpacing:"-0.01em"},children:"Scan to connect instantly"}),i.jsx("p",{style:{fontSize:26,fontWeight:500,color:"#6b7280",margin:0,textAlign:"center"},children:"SYNKA.in"})]})]})})});YK.displayName="ShareableCardImage";const uk=200,bP=.92,rKe=.6,dk=e=>new Promise((t,n)=>{const r=new Image;r.onload=()=>t(r),r.onerror=n,r.src=URL.createObjectURL(e)}),BR=async(e,t=uk)=>{const n="image/jpeg";let r=bP,a=null,s=rKe,o=bP;for(let l=0;l<6&&(r=(s+o)/2,a=await new Promise(d=>{e.toBlob(u=>d(u),n,r)}),!!a);l++){const c=a.size/1024;if(c>t)o=r;else if(c<t*.7)s=r;else break}return a||(a=await new Promise((l,c)=>{e.toBlob(d=>d?l(d):c(new Error("Failed to create blob")),n,.85)})),a};async function aKe(e,t,n){const r=await dk((e instanceof Blob,e)),a=document.createElement("canvas"),s=a.getContext("2d"),o=512;a.width=o,a.height=o;const l=Math.min(r.width,r.height);let c=0,d=0;if(t!==void 0&&n!==void 0){const h=t/100*r.width,p=n/100*r.height;c=Math.max(0,Math.min(h-l/2,r.width-l)),d=Math.max(0,Math.min(p-l/2,r.height-l))}else c=(r.width-l)/2,d=(r.height-l)/2;s.drawImage(r,c,d,l,l,0,0,o,o),URL.revokeObjectURL(r.src);const u=await BR(a,uk);return{blob:u,width:o,height:o,sizeKB:Math.round(u.size/1024)}}async function XK(e){const t=await dk(e),n=document.createElement("canvas"),r=n.getContext("2d");n.width=t.width,n.height=t.height,r.drawImage(t,0,0),URL.revokeObjectURL(t.src);const a=await BR(n,uk);return{blob:a,width:t.width,height:t.height,sizeKB:Math.round(a.size/1024)}}async function ZK(e){const t=await dk(e),n=600,r=300;let a=t.width,s=t.height;if(a>n||s>r){const u=Math.min(n/a,r/s);a=Math.round(a*u),s=Math.round(s*u)}const o=document.createElement("canvas"),l=o.getContext("2d");o.width=a,o.height=s,l.drawImage(t,0,0,a,s),URL.revokeObjectURL(t.src);const c=e.type==="image/png";let d;return c?d=await new Promise((u,h)=>{o.toBlob(p=>p?u(p):h(new Error("Failed to create blob")),"image/png")}):d=await BR(o,uk),{blob:d,width:a,height:s,sizeKB:Math.round(d.size/1024)}}async function sKe(e,t=1600){const n=await dk(e);let r=n.width,a=n.height;if(r>t||a>t){const l=Math.min(t/r,t/a);r=Math.round(r*l),a=Math.round(a*l)}const s=document.createElement("canvas"),o=s.getContext("2d");return s.width=r,s.height=a,o.drawImage(n,0,0,r,a),URL.revokeObjectURL(n.src),s.toDataURL("image/jpeg",.85)}async function M_(e,t,n="profiles"){if(!t)return!1;try{const a=new URL(t).pathname.split(`/storage/v1/object/public/${n}/`);if(a.length<2)return!1;const s=a[1],{error:o}=await e.storage.from(n).remove([s]);return o?(console.warn("Failed to delete old image:",o),!1):!0}catch(r){return console.warn("Error deleting storage image:",r),!1}}const iKe=Object.freeze(Object.defineProperty({__proto__:null,deleteStorageImage:M_,fileToOptimizedBase64:sKe,optimizeCroppedImage:XK,optimizeLogo:ZK,optimizeProfilePhoto:aKe},Symbol.toStringTag,{value:"Module"})),oKe="https://synka.in";async function lKe(e,t){const r=await(await fetch(e)).blob();return new File([r],t,{type:r.type||"image/png"})}async function cKe(e){const t=new Image;t.crossOrigin="anonymous",await new Promise((l,c)=>{t.onload=()=>l(),t.onerror=()=>c(new Error("Failed to load image")),t.src=e});const n=80,r=document.createElement("canvas"),a=r.getContext("2d");if(!a)return e;r.width=t.width,r.height=t.height+n,a.fillStyle="#f8f9fa",a.fillRect(0,0,r.width,r.height),a.drawImage(t,0,0);const s=r.width/2,o=t.height+26;return a.fillStyle="#111111",a.font='500 26px -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',a.textAlign="right",a.textBaseline="top",a.fillText("Powered by",s-6,o),a.fillStyle="#F97316",a.font='700 26px -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.fillText("SYNKA",s+6,o),r.toDataURL("image/png",1)}function uKe(){const[e,t]=N.useState(!1),n=N.useRef(null),r=N.useCallback(async o=>{if(!n.current)return console.error("Card ref not available"),null;const l=n.current;try{const c=l.querySelectorAll("img"),d=Array.from(c).map(h=>new Promise(p=>{if(h.complete&&h.naturalHeight!==0)p();else{const m=setTimeout(()=>p(),5e3);h.onload=()=>{clearTimeout(m),p()},h.onerror=()=>{clearTimeout(m),p()}}}));await Promise.all(d),await new Promise(h=>setTimeout(h,300));const u=await gC(l,{quality:1,pixelRatio:2,cacheBust:!0,skipFonts:!1,backgroundColor:"#f8f9fa",width:1080,height:1350,includeQueryParams:!0,style:{position:"static",left:"auto",top:"auto",transform:"none"}});return await cKe(u)}catch(c){return console.error("Error generating card image:",c),null}},[]),a=N.useCallback(async o=>{if(!n.current){console.error("Card ref not available"),ie({title:"Download failed",description:"Card element not ready. Please try again.",variant:"destructive"});return}t(!0);try{const l=await r(o);if(!l)throw new Error("Failed to generate image");const c=`${o.name.replace(/\s+/g,"-").toLowerCase()}-synka-card.png`;if(Xt.isNativePlatform()){try{const u=l.split(",")[1],h=await Rm.writeFile({path:c,data:u,directory:Yc.Cache}),p=o.publicUrl||`${oKe}/c/${o.slug}`;await qc.share({title:"My Digital Card",text:`Check out my digital business card: ${p}`,files:[h.uri],dialogTitle:"Share your card"}),await Zn.success(),ie({title:"Card ready to share!",description:"Choose where to save or share."})}catch(u){console.error("Native share error:",u),ie({title:"Share failed",description:"Could not share card image.",variant:"destructive"})}return}const d=document.createElement("a");d.download=c,d.href=l,document.body.appendChild(d),d.click(),document.body.removeChild(d),ie({title:"Card image downloaded",description:"Share it on WhatsApp, LinkedIn, or anywhere!"})}catch(l){console.error("Error generating card image:",l),ie({title:"Download failed",description:"Could not generate card image. Please try again.",variant:"destructive"})}finally{t(!1)}},[r]),s=N.useCallback(async o=>{const l=await r(o);if(!l)return null;const c=`${o.name.replace(/\s+/g,"-").toLowerCase()}-synka-card.png`;return await lKe(l,c)},[r]);return{cardRef:n,isGenerating:e,downloadCard:a,generateCardImage:r,generateCardFile:s}}function Rx({icon:e,value:t,href:n,iconClass:r}){return i.jsxs("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"group block",children:[i.jsxs("div",{className:"flex items-center gap-4 px-4 py-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/60 backdrop-blur-sm flex items-center justify-center shrink-0",children:i.jsx(e,{className:Ie("h-[18px] w-[18px] text-foreground/90",r)})}),i.jsx("p",{className:"text-[15px] font-medium text-foreground truncate flex-1",children:t})]}),i.jsx("div",{className:"ml-[72px] h-px bg-border/40 group-last:hidden"})]})}const dKe=e=>{const t=jz(e);return`https://wa.me/${t.length===10?`91${t}`:t}`};function hKe(){const e=Pa(),t=Xl(),{user:n,loading:r}=or(),{profile:a}=hl(),{activeCard:s,loading:o,updateCard:l,refetch:c}=Df(),{cardRef:d,isGenerating:u,generateCardFile:h}=uKe(),p=tI(),[m,f]=N.useState(!1),[g,x]=N.useState(!1),[y,b]=N.useState(!1),[v,w]=N.useState("photo-logo"),[k,C]=N.useState(null),[S,_]=N.useState({firstName:"",lastName:"",designation:"",company:"",phone:"",email:"",website:"",whatsapp:"",linkedin:"",about:"",photo_url:"",logo_url:"",instagram:"",youtube:"",twitter:"",facebook:"",calendly:""}),[I,T]=N.useState(!1),[A,j]=N.useState(!1),[D,F]=N.useState(null),[B,q]=N.useState(!1),$=N.useRef(null),L=N.useRef(null);N.useRef(!1);const M=r||o,[X,G]=N.useState(!1);N.useEffect(()=>{s&&(s.full_name||s.email||s.phone)&&G(!0)},[s]);const W=X,O=N.useRef(!1),U=N.useRef(null);N.useEffect(()=>{O.current=!0},[]),N.useEffect(()=>{},[r,n]),N.useEffect(()=>{if(m)b(!0),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden";else{const le=setTimeout(()=>b(!1),300);return document.body.style.overflow="",document.documentElement.style.overflow="",()=>clearTimeout(le)}},[m]);const K=N.useRef(null);N.useEffect(()=>{if(!s&&!a)return;const le=(s==null?void 0:s.id)||"no-card";if(K.current===le&&(s==null?void 0:s.is_default)===U.current)return;const V=(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"",{firstName:ee,lastName:ve}=Bx(V),ke={firstName:ee,lastName:ve,designation:(s==null?void 0:s.designation)||"",company:(s==null?void 0:s.company)||"",phone:(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"",email:(s==null?void 0:s.email)||(a==null?void 0:a.email)||(n==null?void 0:n.email)||"",website:(s==null?void 0:s.website)||"",whatsapp:(s==null?void 0:s.whatsapp)||"",linkedin:(s==null?void 0:s.linkedin)||"",about:(s==null?void 0:s.about)||"",photo_url:(s==null?void 0:s.photo_url)||"",logo_url:(s==null?void 0:s.logo_url)||"",instagram:(s==null?void 0:s.instagram)||"",youtube:(s==null?void 0:s.youtube)||"",twitter:(s==null?void 0:s.twitter)||"",facebook:(s==null?void 0:s.facebook)||"",calendly:(s==null?void 0:s.calendly)||""};_(be=>{const Ee=JSON.stringify(be),Ue=JSON.stringify(ke);return Ee===Ue?be:ke}),s!=null&&s.layout&&s.layout!==v&&w(s.layout);const Ce=(s==null?void 0:s.card_design)??null;Ce!==k&&C(Ce),K.current=le,U.current=(s==null?void 0:s.is_default)??null},[s]),N.useEffect(()=>{const le=new URLSearchParams(t.search);le.get("edit")==="true"&&!m&&(f(!0),le.delete("edit"),e({pathname:t.pathname,search:le.toString()},{replace:!0}))},[t.search,m,e]);const ce=a!=null&&a.public_slug?q5(a.public_slug):"";s!=null&&s.phone||a!=null&&a.phone||s!=null&&s.whatsapp,s!=null&&s.whatsapp||s!=null&&s.phone||a!=null&&a.phone;const ne=async()=>{var Ce;if((Ce=navigator.vibrate)==null||Ce.call(navigator,10),!s)return;const le=Cw({email:S.email,phone:S.phone,website:S.website,linkedin:S.linkedin});if(le){ie({title:le.message,variant:"destructive"});return}const V=_w({email:S.email,phone:S.phone,whatsapp:S.whatsapp,website:S.website,linkedin:S.linkedin});!V.phone&&V.whatsapp?V.phone=V.whatsapp:!V.whatsapp&&V.phone&&(V.whatsapp=V.phone);const ee={...S,...V},ve=hoe({instagram:ee.instagram,twitter:ee.twitter,facebook:ee.facebook,youtube:ee.youtube,calendly:ee.calendly});_({...ee,...ve});const{error:ke}=await l(s.id,{full_name:Hc(ee.firstName,ee.lastName),designation:ee.designation,company:ee.company,phone:ee.phone,email:ee.email,website:ee.website,whatsapp:ee.whatsapp,linkedin:ee.linkedin,about:ee.about,photo_url:ee.photo_url,logo_url:ee.logo_url,layout:v,card_design:k??null,instagram:ve.instagram||null,youtube:ve.youtube||null,twitter:ve.twitter||null,facebook:ve.facebook||null,calendly:ve.calendly||null});if(ke)ie({title:"Error",description:"Failed to save changes. Please try again.",variant:"destructive"});else{f(!1),ie({title:"Card updated!",description:"Your changes have been saved."});const be=new URLSearchParams(t.search);be.get("edit")==="true"&&(be.delete("edit"),e({pathname:t.pathname,search:be.toString()},{replace:!0}))}},te=le=>{var ee;const V=(ee=le.target.files)==null?void 0:ee[0];!V||!n||!s||(F(V),j(!0),le.target.value="")},Te=async le=>{if(!(!n||!s)){q(!0),j(!1);try{s.photo_url&&await M_(ue,s.photo_url,"profiles");const V=await XK(le),ee=`photos/${n.id}-${Date.now()}.jpg`,{error:ve}=await ue.storage.from("profiles").upload(ee,V.blob,{upsert:!0,contentType:V.blob.type});if(ve)throw console.error("Upload error:",ve.message),ve;const{data:ke}=ue.storage.from("profiles").getPublicUrl(ee),Ce=ke.publicUrl;_(be=>({...be,photo_url:Ce})),await l(s.id,{photo_url:Ce}),ie({title:"Photo updated",description:`Optimized to ${V.sizeKB}KB`})}catch(V){ie({title:"Upload failed",description:(V==null?void 0:V.message)||"Could not upload photo. Please try again.",variant:"destructive"})}finally{q(!1),F(null)}}},Ae=async le=>{var ee;const V=(ee=le.target.files)==null?void 0:ee[0];if(!(!V||!n||!s))try{s.logo_url&&await M_(ue,s.logo_url,"profiles");const ve=await ZK(V),ke=ve.blob.type==="image/png"?"png":"jpg",Ce=`logos/${n.id}-${Date.now()}.${ke}`,{error:be}=await ue.storage.from("profiles").upload(Ce,ve.blob,{upsert:!0,contentType:ve.blob.type});if(be)throw be;const{data:Ee}=ue.storage.from("profiles").getPublicUrl(Ce),Ue=Ee.publicUrl;_(Qe=>({...Qe,logo_url:Ue})),await l(s.id,{logo_url:Ue}),ie({title:"Logo updated",description:`Optimized to ${ve.sizeKB}KB`})}catch(ve){console.error("Logo upload error:",ve),ie({title:"Upload failed",description:"Could not upload logo. Please try again.",variant:"destructive"})}},Se=async()=>{T(!0);try{const{data:le,error:V}=await ue.functions.invoke("generate-about",{body:{name:Hc(S.firstName,S.lastName),company:S.company,designation:S.designation,email:S.email,linkedin:S.linkedin,website:S.website,use_web_search:!0}});if(V)throw V;le!=null&&le.about&&(_(ee=>({...ee,about:le.about})),ie({title:"About generated!",description:"Your professional summary has been created from live web info."}))}catch(le){console.error("Error generating about:",le),ie({title:"Error",description:"Failed to generate about. Please try again.",variant:"destructive"})}finally{T(!1)}},we=()=>{var le;(le=navigator.vibrate)==null||le.call(navigator,10),ce&&(navigator.clipboard.writeText(ce),ie({title:"Link copied!",description:"Share it with anyone."}))},Fe=async()=>{if(await Zn.light(),!ce){we();return}if(Xt.isNativePlatform()){try{await qc.share({url:ce}),await Zn.success()}catch(le){console.error("Native share error:",le),we()}return}if(navigator.share){try{await navigator.share({url:ce}),await Zn.success()}catch(le){le.name!=="AbortError"&&(console.error("Web share error:",le),we())}return}we()},Q=async(le,V)=>{w(le),C(V??null),s&&await l(s.id,{layout:le,card_design:V??null})},$e=async()=>{var ke;await Zn.light();const le=(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"";if(!le){ie({title:"Complete your card",description:"Add your name to share your card image.",variant:"destructive"});return}const V=await h({name:le,designation:(s==null?void 0:s.designation)||void 0,company:(s==null?void 0:s.company)||void 0,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,publicUrl:ce,slug:a!=null&&a.public_slug?`/u/${a.public_slug}`:"",isPremium:(a==null?void 0:a.plan)==="Orange"});if(!V){ie({title:"Failed",description:"Could not generate card image.",variant:"destructive"});return}if(Xt.isNativePlatform()){const Ce=await new Promise((Ee,Ue)=>{const Qe=new FileReader;Qe.onload=()=>Ee(Qe.result.split(",")[1]),Qe.onerror=Ue,Qe.readAsDataURL(V)}),be=await Rm.writeFile({path:`Synka-${Date.now()}.png`,data:Ce,directory:Yc.Documents,recursive:!0});await qc.share({title:"My Digital Card",text:"Check out my digital business card",files:[be.uri]}),await Zn.success();return}if((ke=navigator.canShare)!=null&&ke.call(navigator,{files:[V]}))try{await navigator.share({title:"My Digital Card",files:[V]}),await Zn.success();return}catch{}const ee=URL.createObjectURL(V),ve=document.createElement("a");ve.href=ee,ve.download=V.name,ve.click(),URL.revokeObjectURL(ee),await Zn.success()},Le=(s==null?void 0:s.full_name)||(a==null?void 0:a.full_name)||"",Xe=(s==null?void 0:s.email)||(a==null?void 0:a.email)||"",Ye=(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"",Je=(s==null?void 0:s.whatsapp)||(s==null?void 0:s.phone)||(a==null?void 0:a.phone)||"";return i.jsxs("div",{className:Ie("min-h-screen py-4 sm:py-6 px-3 sm:px-4 space-y-4 sm:space-y-6 mx-auto max-w-full sm:max-w-md lg:max-w-[460px]",!O.current&&"animate-fade-up"),children:[s&&!s.is_default&&i.jsx("div",{className:"flex items-center justify-center gap-2 py-2 px-4 bg-muted/50 border border-border/40 rounded-xl",children:i.jsx("span",{className:"text-sm text-muted-foreground",children:"This card is private. Set as default to make it public."})}),i.jsxs("div",{className:"bg-card/95 backdrop-blur-xl rounded-3xl border border-border/40 shadow-[0_20px_40px_rgba(0,0,0,0.06)] overflow-hidden",children:[i.jsxs("div",{className:Ie("relative pt-0 flex flex-col items-center",v!=="photo-only"&&"pb-4"),children:[W?i.jsx(Qj,{layout:v,photoUrl:s.photo_url,logoUrl:s.logo_url,name:Le,designation:s.designation||void 0,company:s.company||void 0,themeColor:k,faceX:s.face_x,faceY:s.face_y,logoX:s.logo_x,logoY:s.logo_y}):i.jsx("div",{className:"w-full h-72 rounded-3xl bg-muted/40 animate-pulse"}),W&&v!=="photo-only"?i.jsxs("div",{className:"text-center mt-4 space-y-1 text-foreground",children:[i.jsx("h2",{className:"text-[22px] font-semibold tracking-tight text-foreground",children:Le}),((s==null?void 0:s.designation)||(s==null?void 0:s.company))&&i.jsxs("p",{className:"text-[14px] text-muted-foreground leading-tight",children:[s==null?void 0:s.designation,(s==null?void 0:s.designation)&&(s==null?void 0:s.company)&&"  ",s==null?void 0:s.company]})]}):i.jsxs("div",{className:"text-center mt-4 space-y-2",children:[i.jsx("div",{className:"h-6 w-40 mx-auto bg-muted/40 rounded animate-pulse"}),i.jsx("div",{className:"h-4 w-28 mx-auto bg-muted/30 rounded animate-pulse"})]})]}),i.jsx("div",{className:"mx-6 h-px bg-gradient-to-r from-transparent via-border/40 to-transparent"}),i.jsxs("div",{className:"p-6 space-y-2",children:[Ye&&i.jsx(Rx,{icon:ky,value:k0(Ye),href:`tel:${Ye}`}),Xe&&i.jsx(Rx,{icon:Di,value:Xe,href:`mailto:${Xe}`}),(s==null?void 0:s.website)&&i.jsx(Rx,{icon:Ny,value:"Visit Website",href:s.website.startsWith("http")?s.website:`https://${s.website}`}),Je&&i.jsx(Rx,{icon:v0,value:"Connect on WhatsApp",href:dKe(Je),iconClass:"text-foreground/80 group-hover:text-[#25D366]"}),i.jsx(jw,{documentName:s==null?void 0:s.document_name,documentUrl:s==null?void 0:s.document_url}),(s==null?void 0:s.linkedin)&&i.jsx(Rx,{icon:Bw,value:"Connect on LinkedIn",href:`https://linkedin.com/in/${s.linkedin}`,iconClass:"text-foreground/80 group-hover:text-blue-600"}),(s==null?void 0:s.instagram)&&i.jsx(Go,{platform:"instagram",url:s.instagram}),(s==null?void 0:s.youtube)&&i.jsx(Go,{platform:"youtube",url:s.youtube}),(s==null?void 0:s.twitter)&&i.jsx(Go,{platform:"twitter",url:s.twitter}),(s==null?void 0:s.facebook)&&i.jsx(Go,{platform:"facebook",url:s.facebook}),(s==null?void 0:s.calendly)&&i.jsx(Go,{platform:"calendly",url:s.calendly})]})]}),(s==null?void 0:s.about)&&i.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40",children:[i.jsx("h3",{className:"font-semibold text-foreground mb-2",children:"About"}),i.jsx("p",{className:"text-muted-foreground text-sm whitespace-pre-line",children:s.about})]}),i.jsxs("div",{className:"p-5 rounded-2xl bg-muted/30 border border-border/40 flex flex-col items-center",children:[i.jsx("div",{className:"p-4 rounded-2xl bg-white shadow-sm",children:ce?i.jsx(vI,{value:ce,size:160,level:"H",includeMargin:!0}):i.jsx("div",{className:"w-[160px] h-[160px] flex items-center justify-center text-muted-foreground text-sm",children:"Loading QR..."})}),ce&&i.jsx("p",{className:"sr-only",children:ce.replace(Zse(),"")})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"flex gap-3",children:[i.jsxs(de,{variant:"outline",className:"flex-1 min-w-0 active:scale-[0.97] transition-transform",onClick:()=>{Zn.light(),$e()},disabled:M||!Le||u,children:[i.jsx(Od,{className:"h-4 w-4 mr-2 shrink-0"}),i.jsx("span",{className:"truncate",children:u?"Saving...":"Download"})]}),i.jsxs(de,{variant:"outline",className:"flex-1 min-w-0 active:scale-[0.97] transition-transform",onClick:()=>x(!0),disabled:M,children:[i.jsx(vO,{className:"h-4 w-4 mr-2 shrink-0"}),i.jsx("span",{className:"truncate",children:"Layout"})]})]}),i.jsxs(de,{variant:"gradient",className:"w-full font-medium tracking-tight",onClick:Fe,disabled:M,children:[i.jsx(CO,{className:"h-4 w-4 mr-2"}),"Share"]})]}),i.jsx(YK,{ref:d,name:Le,designation:(s==null?void 0:s.designation)||void 0,company:(s==null?void 0:s.company)||void 0,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,publicUrl:ce,slug:a!=null&&a.public_slug?`/u/${a.public_slug}`:"",isPremium:(a==null?void 0:a.plan)==="Orange"}),p&&y&&wh.createPortal(i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`fixed inset-0 z-[1000] transition-opacity duration-300 ${m?"bg-black/30 opacity-100":"opacity-0 pointer-events-none"}`,onClick:()=>f(!1),onTouchMove:le=>le.preventDefault(),style:{touchAction:"none"}}),i.jsx("div",{className:"fixed inset-x-0 bottom-0 z-[1001] flex justify-center pointer-events-none",children:i.jsx("div",{className:`w-full max-w-md bg-background rounded-t-3xl shadow-2xl pointer-events-auto overflow-hidden
          transition-all duration-300 ease-[cubic-bezier(0.22,1,0.36,1)]
          ${m?"opacity-100":"translate-y-full opacity-0"}
        `,style:{maxHeight:"95dvh"},children:i.jsx("div",{className:"overflow-y-auto",style:{WebkitOverflowScrolling:"touch",maxHeight:"95dvh",paddingBottom:"env(safe-area-inset-bottom)"},children:i.jsxs("div",{className:"space-y-6 px-6 pt-4 pb-6 relative",children:[i.jsx("button",{onClick:()=>f(!1),className:"absolute right-4 top-4 h-9 w-9 rounded-full bg-muted/60 backdrop-blur flex items-center justify-center active:scale-95",children:i.jsx(ui,{className:"h-5 w-5"})}),i.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx(We,{className:"font-semibold",children:"Photo"}),i.jsx("div",{className:"aspect-square rounded-2xl overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var le;return(le=$.current)==null?void 0:le.click()},children:S.photo_url?i.jsx("img",{src:S.photo_url,alt:"Photo",className:"w-full h-full object-cover",style:{objectPosition:`${(s==null?void 0:s.face_x)??50}% ${(s==null?void 0:s.face_y)??50}%`}}):i.jsx(Fo,{className:"h-8 w-8 text-muted-foreground"})}),i.jsx("input",{ref:$,type:"file",accept:"image/*",className:"hidden",onChange:te}),i.jsxs(de,{variant:"outline",className:"w-full",onClick:()=>{var le;return(le=$.current)==null?void 0:le.click()},disabled:M,children:[i.jsx(Fo,{className:"h-4 w-4 mr-2"}),S.photo_url?"Change Photo":"Upload Photo"]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(We,{className:"font-semibold",children:"Logo"}),i.jsx("div",{className:"aspect-square rounded-full overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var le;return(le=L.current)==null?void 0:le.click()},children:S.logo_url?i.jsx("img",{src:S.logo_url,alt:"Logo",className:"w-full h-full object-cover"}):i.jsx(Fo,{className:"h-8 w-8 text-muted-foreground"})}),i.jsx("input",{ref:L,type:"file",accept:"image/*",className:"hidden",onChange:Ae}),i.jsxs(de,{variant:"outline",className:"w-full",onClick:()=>{var le;return(le=L.current)==null?void 0:le.click()},disabled:M,children:[i.jsx(Fo,{className:"h-4 w-4 mr-2"}),S.logo_url?"Change Logo":"Upload Logo"]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:S.firstName,lastName:S.lastName,onFirstNameChange:le=>_(V=>({...V,firstName:le})),onLastNameChange:le=>_(V=>({...V,lastName:le})),disabled:M}),i.jsx(In,{label:"Role *",value:S.designation,onChange:le=>_(V=>({...V,designation:le.target.value})),disabled:M}),i.jsx(In,{label:"Company Name",value:S.company,onChange:le=>_(V=>({...V,company:le.target.value})),disabled:M}),i.jsx(In,{label:"Email",value:S.email,onChange:le=>_(V=>({...V,email:le.target.value})),inputMode:"email",disabled:M}),i.jsx(Fs,{label:"Phone",value:Ir(S.phone),onChange:le=>{const V=kr(S.phone);_(ee=>({...ee,phone:V+le.target.value}))},countryCode:kr(S.phone),onCountryCodeChange:le=>{const V=Ir(S.phone);_(ee=>({...ee,phone:le+V}))},disabled:M}),i.jsx(Fs,{label:"WhatsApp",value:Ir(S.whatsapp),onChange:le=>{const V=kr(S.whatsapp);_(ee=>({...ee,whatsapp:V+le.target.value}))},countryCode:kr(S.whatsapp),onCountryCodeChange:le=>{const V=Ir(S.whatsapp);_(ee=>({...ee,whatsapp:le+V}))},disabled:M}),i.jsx(In,{label:"Website",value:S.website,onChange:le=>_(V=>({...V,website:le.target.value})),inputMode:"url",disabled:M}),i.jsx(In,{label:"LinkedIn Username",value:S.linkedin,onChange:le=>_(V=>({...V,linkedin:le.target.value})),disabled:M}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Social Links"}),i.jsx(T3,{values:{instagram:S.instagram,youtube:S.youtube,twitter:S.twitter,facebook:S.facebook,calendly:S.calendly},onChange:(le,V)=>{_(ee=>({...ee,[le]:V}))},disabled:M})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{children:"About Me"}),i.jsxs(de,{variant:"ghost",size:"sm",onClick:Se,disabled:M||I,children:[i.jsx(Ls,{className:Ie("h-4 w-4 mr-1",I&&"animate-spin")}),I?"Generating...":"Generate with AI"]})]}),i.jsx(ka,{placeholder:"Tell people about yourself...",value:S.about,onChange:le=>_(V=>({...V,about:le.target.value})),rows:3,disabled:M})]})]}),i.jsx(jw,{documentName:(s==null?void 0:s.document_name)||null,documentUrl:(s==null?void 0:s.document_url)||null,isEditMode:!0,userId:n==null?void 0:n.id,cardId:s==null?void 0:s.id,isPremium:(a==null?void 0:a.plan)==="Orange",onUpdate:async le=>{s&&await l(s.id,le)}}),i.jsxs(de,{variant:"gradient",className:"w-full font-medium tracking-tight",onClick:ne,disabled:M,children:[i.jsx(dn,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})})})})]}),document.body),!p&&i.jsx(vn,{open:m,onOpenChange:f,children:i.jsxs(mn,{className:"max-w-lg max-h-[85dvh] rounded-3xl overflow-y-auto",children:[i.jsx(wn,{children:i.jsx(Nn,{className:"text-[22px] font-semibold tracking-tight",children:"Edit Your Card"})}),i.jsxs("div",{className:"space-y-6 py-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx(We,{className:"font-semibold",children:"Photo"}),i.jsx("div",{className:"aspect-square rounded-2xl overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var le;return(le=$.current)==null?void 0:le.click()},children:S.photo_url?i.jsx("img",{src:S.photo_url,alt:"Photo",className:"w-full h-full object-cover",style:{objectPosition:`${(s==null?void 0:s.face_x)??50}% ${(s==null?void 0:s.face_y)??50}%`}}):i.jsx(Fo,{className:"h-8 w-8 text-muted-foreground"})}),i.jsx("input",{ref:$,type:"file",accept:"image/*",className:"hidden",onChange:te}),i.jsxs(de,{variant:"outline",className:"w-full",onClick:()=>{var le;return(le=$.current)==null?void 0:le.click()},disabled:M,children:[i.jsx(Fo,{className:"h-4 w-4 mr-2"}),S.photo_url?"Change Photo":"Upload Photo"]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(We,{className:"font-semibold",children:"Logo"}),i.jsx("div",{className:"aspect-square rounded-full overflow-hidden bg-muted cursor-pointer hover:opacity-80 transition-opacity flex items-center justify-center",onClick:()=>{var le;return(le=L.current)==null?void 0:le.click()},children:S.logo_url?i.jsx("img",{src:S.logo_url,alt:"Logo",className:"w-full h-full object-cover"}):i.jsx(Fo,{className:"h-8 w-8 text-muted-foreground"})}),i.jsx("input",{ref:L,type:"file",accept:"image/*",className:"hidden",onChange:Ae}),i.jsxs(de,{variant:"outline",className:"w-full",onClick:()=>{var le;return(le=L.current)==null?void 0:le.click()},disabled:M,children:[i.jsx(Fo,{className:"h-4 w-4 mr-2"}),S.logo_url?"Change Logo":"Upload Logo"]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(_c,{firstName:S.firstName,lastName:S.lastName,onFirstNameChange:le=>_(V=>({...V,firstName:le})),onLastNameChange:le=>_(V=>({...V,lastName:le})),disabled:M}),i.jsx(In,{label:"Role *",value:S.designation,onChange:le=>_(V=>({...V,designation:le.target.value})),disabled:M}),i.jsx(In,{label:"Company Name",value:S.company,onChange:le=>_(V=>({...V,company:le.target.value})),disabled:M}),i.jsx(In,{label:"Email",value:S.email,onChange:le=>_(V=>({...V,email:le.target.value})),inputMode:"email",disabled:M}),i.jsx(Fs,{label:"Phone",value:Ir(S.phone),onChange:le=>{const V=kr(S.phone);_(ee=>({...ee,phone:V+le.target.value}))},countryCode:kr(S.phone),onCountryCodeChange:le=>{const V=Ir(S.phone);_(ee=>({...ee,phone:le+V}))},disabled:M}),i.jsx(Fs,{label:"WhatsApp",value:Ir(S.whatsapp),onChange:le=>{const V=kr(S.whatsapp);_(ee=>({...ee,whatsapp:V+le.target.value}))},countryCode:kr(S.whatsapp),onCountryCodeChange:le=>{const V=Ir(S.whatsapp);_(ee=>({...ee,whatsapp:le+V}))},disabled:M}),i.jsx(In,{label:"Website",value:S.website,onChange:le=>_(V=>({...V,website:le.target.value})),inputMode:"url",disabled:M}),i.jsx(In,{label:"LinkedIn Username",value:S.linkedin,onChange:le=>_(V=>({...V,linkedin:le.target.value})),disabled:M}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Social Links"}),i.jsx(T3,{values:{instagram:S.instagram,youtube:S.youtube,twitter:S.twitter,facebook:S.facebook,calendly:S.calendly},onChange:(le,V)=>{_(ee=>({...ee,[le]:V}))},disabled:M})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(We,{children:"About Me"}),i.jsxs(de,{variant:"ghost",size:"sm",onClick:Se,disabled:M||I,children:[i.jsx(Ls,{className:Ie("h-4 w-4 mr-1",I&&"animate-spin")}),I?"Generating...":"Generate with AI"]})]}),i.jsx(ka,{placeholder:"Tell people about yourself...",value:S.about,onChange:le=>_(V=>({...V,about:le.target.value})),rows:3,disabled:M})]})]}),i.jsx(jw,{documentName:(s==null?void 0:s.document_name)||null,documentUrl:(s==null?void 0:s.document_url)||null,isEditMode:!0,userId:n==null?void 0:n.id,cardId:s==null?void 0:s.id,isPremium:(a==null?void 0:a.plan)==="Orange",onUpdate:async le=>{s&&await l(s.id,le)}}),i.jsxs(de,{variant:"gradient",className:"w-full font-medium tracking-tight",onClick:ne,disabled:M,children:[i.jsx(dn,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]})}),i.jsx(ame,{open:g,onClose:()=>x(!1),currentLayout:v,currentColor:k,photoUrl:(s==null?void 0:s.photo_url)||void 0,logoUrl:(s==null?void 0:s.logo_url)||void 0,name:Le,designation:(s==null?void 0:s.designation)||"Professional",company:(s==null?void 0:s.company)||"Company",onSelect:Q}),D&&i.jsx(nKe,{open:A,onClose:()=>{j(!1),F(null)},imageFile:D,onSave:Te})]})}function WR(){if(Xt.isNativePlatform())return{isSupported:!1,isNative:!0,message:"NFC writing is not available in the app. Please use Chrome browser on Android to write NFC tags."};const t="NDEFReader"in window;return{isSupported:t,isNative:!1,message:t?void 0:"NFC is not supported on this browser. Please use Chrome on Android."}}async function pKe(e,t){const n=WR();if(!n.isSupported)return{success:!1,error:n.message||"NFC is not supported on this device"};try{const r=new NDEFReader,s=new TextEncoder().encode(t);return await r.write({records:[{recordType:"url",data:e},{recordType:"mime",mediaType:"text/vcard",data:s}]}),{success:!0}}catch(r){return console.error("NFC write error:",r),{success:!1,error:(r==null?void 0:r.message)||"Failed to write to NFC tag"}}}function mKe(e){const t=["BEGIN:VCARD","VERSION:3.0"];if(e.name){t.push(`FN:${e.name}`);const n=e.name.trim().split(" "),r=n.length>1?n.pop():"",a=n.join(" ");t.push(`N:${r};${a};;;`)}return e.company&&t.push(`ORG:${e.company}`),e.designation&&t.push(`TITLE:${e.designation}`),e.phone&&t.push(`TEL;TYPE=CELL:${e.phone}`),e.email&&t.push(`EMAIL:${e.email}`),e.url&&t.push(`URL:${e.url}`),t.push("END:VCARD"),t.join(`\r
`)}const fKe=[{id:"profile",icon:Ad,label:"Profile",description:"View and edit your account",action:"navigate"},{id:"order-nfc",icon:rl,label:"Get your NFC Card",description:"Order a physical smart card",action:"navigate"},{id:"upgrade",icon:rl,label:"Upgrade Plan",description:"Access premium features",action:"navigate"},{id:"demo",icon:kX,label:"Features Demo",description:"How to use & FAQ",action:"navigate"},{id:"support",icon:NX,label:"Support",description:"Get help when you need it",action:"navigate"}];function gKe(){var ne;const e=Pa(),{theme:t,toggleTheme:n}=QO(),{signOut:r}=or(),{profile:a,loading:s}=hl(),{activeCard:o,loading:l}=Df(),[c,d]=N.useState(!1),[u,h]=N.useState(!1),[p,m]=N.useState(!1),[f,g]=N.useState(!1),[x,y]=N.useState(py()),[b,v]=N.useState(null),[w,k]=N.useState(localStorage.getItem("synka_biometric_enabled")==="true"),C=N.useRef(!0),S=((ne=a==null?void 0:a.plan)==null?void 0:ne.toLowerCase())==="orange",[_,I]=N.useState(""),[T,A]=N.useState(""),[j,D]=N.useState(""),[F,B]=N.useState(""),[q,$]=N.useState("");N.useEffect(()=>{const te=WR();h(te.isSupported),Xt.isNativePlatform()&&Em().then(v)},[]),N.useEffect(()=>{c&&(I((o==null?void 0:o.full_name)||""),A((o==null?void 0:o.company)||""),D((o==null?void 0:o.designation)||""),B((o==null?void 0:o.phone)||(o==null?void 0:o.whatsapp)||""),$((o==null?void 0:o.email)||""))},[c,o]);const L=async()=>{await r(),ie({title:"Logged out",description:"See you next time!"}),e("/login",{replace:!0})},M=()=>{const te=!x;y(te),Gse(te),!te&&w&&(k(!1),localStorage.setItem("synka_biometric_enabled","false")),ie({title:te?"App Lock enabled":"App Lock disabled",description:te?"You will need to unlock the app when you open it.":"App will open directly without unlock."})},X=()=>{if(!x)return;const te=!w;k(te),localStorage.setItem("synka_biometric_enabled",String(te)),ie({title:te?"Biometric enabled":"Biometric disabled",description:te?"Use biometrics to unlock the app.":"PIN will be required to unlock."})},G=te=>{switch(te){case"profile":e("/settings/profile");break;case"order-nfc":e("/order-nfc-card");break;case"upgrade":e("/settings/upgrade");break;case"demo":e("/support");break;case"support":e("/contact");break}},W=async()=>{const te=a==null?void 0:a.slug;if(!te){ie({title:"Public view missing",description:"Please set your public view slug in your profile before writing NFC.",variant:"destructive"});return}const Ae=`${window.location.origin}/u/${te}`,Se=()=>{const we=["BEGIN:VCARD","VERSION:3.0"];if(_){we.push(`FN:${_}`);const Fe=_.trim().split(" "),Q=Fe.length>1?Fe.pop():"",$e=Fe.join(" ");we.push(`N:${Q};${$e};;;`)}return T&&we.push(`ORG:${T}`),j&&we.push(`TITLE:${j}`),F&&we.push(`TEL;TYPE=CELL:${F}`),q&&we.push(`EMAIL:${q}`),we.push(`URL:${Ae}`),we.push("END:VCARD"),we.join(`\r
`)};if(!("NDEFReader"in window)){ie({title:"NFC not supported",description:"Your device or browser does not support NFC writing.",variant:"destructive"});return}m(!0);try{const we=new NDEFReader,Fe=Se(),$e=new TextEncoder().encode(Fe);await we.write({records:[{recordType:"url",data:Ae},{recordType:"mime",mediaType:"text/vcard",data:$e}]}),ie({title:"NFC written successfully",description:"Profile URL and contact card saved to NFC tag."}),d(!1)}catch(we){console.error("NFC write error:",we),ie({title:"NFC write failed",description:(we==null?void 0:we.message)||"Make sure NFC is enabled and hold the tag close.",variant:"destructive"})}finally{m(!1)}},O=s||l,U=g0();Gj();const K=(a==null?void 0:a.full_name)||(o==null?void 0:o.full_name)||U||"";N.useEffect(()=>{a!=null&&a.full_name?Nm(a.full_name):o!=null&&o.full_name&&Nm(o.full_name),a!=null&&a.email?od(a.email):o!=null&&o.email&&od(o.email)},[a==null?void 0:a.full_name,a==null?void 0:a.email,o==null?void 0:o.full_name,o==null?void 0:o.email]);const ce=te=>te?te.split(" ").filter(Boolean).map(Te=>Te[0]).join("").toUpperCase():"";return i.jsxs("div",{className:Ie("w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-4 sm:space-y-6 max-w-2xl mx-auto",!C.current&&"animate-fade-up"),children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Settings"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage your account and preferences"})]}),i.jsx("button",{onClick:()=>e("/settings/profile"),className:"w-full p-6 rounded-2xl bg-card border border-border/50 card-hover text-left",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center overflow-hidden bg-muted",children:o!=null&&o.photo_url?i.jsx("img",{src:o.photo_url,alt:K,className:"w-full h-full object-cover",style:{objectPosition:`${(o==null?void 0:o.face_x)??50}% ${(o==null?void 0:o.face_y)??38}%`}}):i.jsx("span",{className:"text-2xl font-bold text-muted-foreground",children:ce(K)||"U"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[O&&!U?i.jsx("div",{className:"h-5 w-32 bg-muted rounded animate-pulse"}):i.jsxs("h2",{className:"text-lg font-semibold text-foreground truncate",children:["Hi ",K||"there"]}),(a==null?void 0:a.plan)==="Orange"&&i.jsx("span",{className:"inline-flex items-center px-2 py-0.5 mt-1 rounded-full text-xs font-semibold text-white",style:{backgroundColor:"#F26B4F"},children:"Orange"})]}),i.jsx(wy,{className:"h-5 w-5 text-muted-foreground"})]})}),i.jsx("div",{className:"p-4 rounded-2xl bg-card border border-border/50",children:i.jsxs("button",{onClick:n,className:"flex items-center justify-between w-full",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:t==="light"?i.jsx(_O,{className:"h-5 w-5 text-amber-500"}):i.jsx(bO,{className:"h-5 w-5 text-violet-500"})}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Appearance"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:t==="light"?"Light mode":"Dark mode"})]})]}),i.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",t==="dark"?"bg-primary":"bg-muted"),children:i.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",t==="dark"&&"translate-x-5")})})]})}),i.jsx("div",{className:"space-y-2",children:fKe.map((te,Te)=>i.jsxs("button",{onClick:()=>G(te.id),className:Ie("w-full p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4 card-hover text-left"),children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:i.jsx(te.icon,{className:"h-5 w-5 text-foreground"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-foreground",children:te.label}),i.jsx("p",{className:"text-sm text-muted-foreground",children:te.description})]}),i.jsx(wy,{className:"h-5 w-5 text-muted-foreground"})]},te.id))}),Xt.isNativePlatform()&&i.jsx("div",{className:"p-4 rounded-2xl bg-card border border-border/50",children:i.jsxs("button",{onClick:M,className:"flex items-center justify-between w-full",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:i.jsx(mo,{className:"h-5 w-5 text-foreground"})}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:"font-medium text-foreground",children:"App Lock"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:x?w?"Biometric or PIN on open":"PIN required on open":"Opens directly"})]})]}),i.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",x?"bg-primary":"bg-muted"),children:i.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",x&&"translate-x-5")})})]})}),Xt.isNativePlatform()&&(b==null?void 0:b.available)&&i.jsx("div",{className:Ie("p-4 rounded-2xl bg-card border border-border/50 -mt-2",!x&&"opacity-50"),children:i.jsxs("button",{onClick:X,disabled:!x,className:"flex items-center justify-between w-full disabled:cursor-not-allowed",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center",children:i.jsx(zw,{className:Ie("h-5 w-5",x?"text-foreground":"text-muted-foreground")})}),i.jsxs("div",{className:"text-left",children:[i.jsx("p",{className:Ie("font-medium",x?"text-foreground":"text-muted-foreground"),children:"Biometric Unlock"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:x?`Use ${f0(b.biometryType)} to unlock`:"Enable App Lock first"})]})]}),i.jsx("div",{className:Ie("w-12 h-7 rounded-full p-1 transition-colors",w&&x?"bg-primary":"bg-muted"),children:i.jsx("div",{className:Ie("w-5 h-5 rounded-full bg-background shadow-sm transition-transform",w&&x&&"translate-x-5")})})]})}),i.jsxs("div",{className:"p-4 rounded-2xl bg-card border border-border/50 flex items-center gap-4 card-hover",children:[i.jsxs("div",{className:"w-10 h-10 rounded-xl bg-muted flex items-center justify-center relative",children:[i.jsx(u2,{className:"h-5 w-5 text-foreground"}),!S&&i.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-orange-500 flex items-center justify-center",children:i.jsx(mo,{className:"h-2.5 w-2.5 text-white"})})]}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-foreground",children:"NFC Writer"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Write your public view slug & offline data to NFC tags"})]}),i.jsx("div",{children:i.jsx(de,{variant:"ghost",onClick:()=>{S?d(!0):g(!0)},children:S?"Open":i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(mo,{className:"h-3 w-3"}),"Open"]})})})]}),i.jsx(vn,{open:f,onOpenChange:g,children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-500/10 flex items-center justify-center",children:i.jsx(mo,{className:"h-5 w-5 text-orange-500"})}),i.jsx("span",{children:"Orange Feature"})]})}),i.jsxs("div",{className:"space-y-4 py-2",children:[i.jsx("p",{className:"text-muted-foreground",children:"NFC Writing is a premium feature available exclusively for Orange plan users. Upgrade now to unlock this and many other powerful features!"}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>g(!1),children:"Maybe Later"}),i.jsx(de,{className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>{g(!1),e("/settings/upgrade")},children:"Upgrade Now"})]})]})]})}),i.jsxs("button",{onClick:L,className:"w-full p-4 rounded-2xl bg-destructive/10 border border-destructive/20 flex items-center gap-4 hover:bg-destructive/20 transition-colors",children:[i.jsx("div",{className:"w-10 h-10 rounded-xl bg-destructive/10 flex items-center justify-center",children:i.jsx(yO,{className:"h-5 w-5 text-destructive"})}),i.jsxs("div",{className:"flex-1 text-left",children:[i.jsx("p",{className:"font-medium text-destructive",children:"Logout"}),i.jsx("p",{className:"text-sm text-destructive/70",children:"Sign out of your account"})]})]}),i.jsx("p",{className:"text-center text-sm text-muted-foreground pt-6",children:"Synka v1.0.0"}),i.jsx(vn,{open:c,onOpenChange:d,children:i.jsxs(mn,{className:"max-w-md",children:[i.jsx(wn,{children:i.jsx(Nn,{children:"NFC Writer - Confirm & Edit"})}),i.jsxs("div",{className:"space-y-4 py-4",children:[!u&&i.jsx("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20",children:i.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:Xt.isNativePlatform()?"NFC writing requires Chrome browser on Android. Please open synka.in in Chrome to write NFC tags.":"NFC is not supported on this device/browser. Please use Chrome on Android."})}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Name"}),i.jsx(At,{value:_,onChange:te=>I(te.target.value)})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Company"}),i.jsx(At,{value:T,onChange:te=>A(te.target.value)})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Designation"}),i.jsx(At,{value:j,onChange:te=>D(te.target.value)})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Phone"}),i.jsx(At,{value:F,onChange:te=>B(te.target.value)})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Email"}),i.jsx(At,{value:q,onChange:te=>$(te.target.value)})]})]}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>d(!1),disabled:p,children:"Cancel"}),i.jsx(de,{variant:"gradient",className:"flex-1",onClick:W,disabled:!u||p,children:p?"Waiting for tag...":"Write to NFC"})]})]})]})})]})}var UR="Radio",[xKe,QK]=dl(UR),[yKe,bKe]=xKe(UR),JK=N.forwardRef((e,t)=>{const{__scopeRadio:n,name:r,checked:a=!1,required:s,disabled:o,value:l="on",onCheck:c,form:d,...u}=e,[h,p]=N.useState(null),m=gr(t,x=>p(x)),f=N.useRef(!1),g=h?d||!!h.closest("form"):!0;return i.jsxs(yKe,{scope:n,checked:a,disabled:o,children:[i.jsx(Gn.button,{type:"button",role:"radio","aria-checked":a,"data-state":rY(a),"data-disabled":o?"":void 0,disabled:o,value:l,...u,ref:m,onClick:Mn(e.onClick,x=>{a||c==null||c(),g&&(f.current=x.isPropagationStopped(),f.current||x.stopPropagation())})}),g&&i.jsx(nY,{control:h,bubbles:!f.current,name:r,value:l,checked:a,required:s,disabled:o,form:d,style:{transform:"translateX(-100%)"}})]})});JK.displayName=UR;var eY="RadioIndicator",tY=N.forwardRef((e,t)=>{const{__scopeRadio:n,forceMount:r,...a}=e,s=bKe(eY,n);return i.jsx(Yl,{present:r||s.checked,children:i.jsx(Gn.span,{"data-state":rY(s.checked),"data-disabled":s.disabled?"":void 0,...a,ref:t})})});tY.displayName=eY;var vKe="RadioBubbleInput",nY=N.forwardRef(({__scopeRadio:e,control:t,checked:n,bubbles:r=!0,...a},s)=>{const o=N.useRef(null),l=gr(o,s),c=C1(n),d=B_(t);return N.useEffect(()=>{const u=o.current;if(!u)return;const h=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(h,"checked").set;if(c!==n&&m){const f=new Event("click",{bubbles:r});m.call(u,n),u.dispatchEvent(f)}},[c,n,r]),i.jsx(Gn.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:l,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});nY.displayName=vKe;function rY(e){return e?"checked":"unchecked"}var wKe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],hk="RadioGroup",[NKe]=dl(hk,[sO,QK]),aY=sO(),sY=QK(),[kKe,SKe]=NKe(hk),iY=N.forwardRef((e,t)=>{const{__scopeRadioGroup:n,name:r,defaultValue:a,value:s,required:o=!1,disabled:l=!1,orientation:c,dir:d,loop:u=!0,onValueChange:h,...p}=e,m=aY(n),f=g1(d),[g,x]=zl({prop:s,defaultProp:a??null,onChange:h,caller:hk});return i.jsx(kKe,{scope:n,name:r,required:o,disabled:l,value:g,onValueChange:x,children:i.jsx(nX,{asChild:!0,...m,orientation:c,dir:f,loop:u,children:i.jsx(Gn.div,{role:"radiogroup","aria-required":o,"aria-orientation":c,"data-disabled":l?"":void 0,dir:f,...p,ref:t})})})});iY.displayName=hk;var oY="RadioGroupItem",lY=N.forwardRef((e,t)=>{const{__scopeRadioGroup:n,disabled:r,...a}=e,s=SKe(oY,n),o=s.disabled||r,l=aY(n),c=sY(n),d=N.useRef(null),u=gr(t,d),h=s.value===a.value,p=N.useRef(!1);return N.useEffect(()=>{const m=g=>{wKe.includes(g.key)&&(p.current=!0)},f=()=>p.current=!1;return document.addEventListener("keydown",m),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",m),document.removeEventListener("keyup",f)}},[]),i.jsx(rX,{asChild:!0,...l,focusable:!o,active:h,children:i.jsx(JK,{disabled:o,required:s.required,checked:h,...c,...a,name:s.name,ref:u,onCheck:()=>s.onValueChange(a.value),onKeyDown:Mn(m=>{m.key==="Enter"&&m.preventDefault()}),onFocus:Mn(a.onFocus,()=>{var m;p.current&&((m=d.current)==null||m.click())})})})});lY.displayName=oY;var CKe="RadioGroupIndicator",cY=N.forwardRef((e,t)=>{const{__scopeRadioGroup:n,...r}=e,a=sY(n);return i.jsx(tY,{...a,...r,ref:t})});cY.displayName=CKe;var uY=iY,dY=lY,_Ke=cY;const hY=N.forwardRef(({className:e,...t},n)=>i.jsx(uY,{className:Ie("grid gap-2",e),...t,ref:n}));hY.displayName=uY.displayName;const pY=N.forwardRef(({className:e,...t},n)=>i.jsx(dY,{ref:n,className:Ie("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:i.jsx(_Ke,{className:"flex items-center justify-center",children:i.jsx(gO,{className:"h-2.5 w-2.5 fill-current text-current"})})}));pY.displayName=dY.displayName;const no=()=>Xt.isNativePlatform(),Dx=()=>no()?"synka://payment/callback":window.location.origin;function mY(){const[e,t]=N.useState(!1),n=N.useCallback(()=>new Promise(o=>{if(window.Razorpay){o(!0);return}const l=document.createElement("script");l.src="https://checkout.razorpay.com/v1/checkout.js",l.onload=()=>o(!0),l.onerror=()=>o(!1),document.body.appendChild(l)}),[]),r=N.useCallback(async o=>{var l;t(!0);try{if(!await n())throw new Error("Failed to load Razorpay SDK");const{data:{session:d}}=await ue.auth.getSession();if(!d)throw new Error("Please login to continue");const u=await ue.functions.invoke("create-order",{body:{product_type:o.product_type,amount:o.amount,quantity:o.quantity||1,card_variant:o.card_variant}});if(u.error)throw new Error(u.error.message||"Failed to create order");const{order:h,prefill:p,key_id:m}=u.data,f={key:m,amount:h.amount,currency:h.currency,name:"Synka",description:`Order: ${h.order_number}`,order_id:h.razorpay_order_id,prefill:{name:p.name,email:p.email,contact:p.contact},config:{display:{hide:[{method:"wallet"}],preferences:{show_default_blocks:!0}}},theme:{color:"#F97316"},...no()&&{callback_url:Dx(),redirect:!1},handler:async x=>{var y,b;try{const v=await ue.functions.invoke("verify-payment",{body:{razorpay_order_id:x.razorpay_order_id,razorpay_payment_id:x.razorpay_payment_id,razorpay_signature:x.razorpay_signature,type:"order"}});if(v.error)throw new Error("Payment verification failed");It.success("Payment successful!"),(y=o.onSuccess)==null||y.call(o,v.data)}catch(v){console.error("Payment verification error:",v),It.error("Payment verification failed. Please contact support."),(b=o.onFailure)==null||b.call(o,v)}},modal:{ondismiss:()=>{var x;t(!1),It.info("Payment cancelled"),(x=o.onFailure)==null||x.call(o,{message:"Payment cancelled by user"})},escape:!no(),backdropclose:!1}},g=new window.Razorpay(f);g.on("payment.failed",async x=>{var y,b,v;console.error("Payment failed:",x.error),It.error(x.error.description||"Payment failed");try{await ue.from("orders").update({status:"payment_failed",updated_at:new Date().toISOString()}).eq("razorpay_order_id",h.razorpay_order_id),await ue.from("payments").insert({user_id:d.user.id,order_id:h.id,razorpay_order_id:h.razorpay_order_id,amount:h.amount/100,status:"failed",error_code:(y=x.error)==null?void 0:y.code,error_description:(b=x.error)==null?void 0:b.description})}catch(w){console.error("Failed to update order status:",w)}(v=o.onFailure)==null||v.call(o,x.error),t(!1)}),g.open()}catch(c){console.error("Payment initiation error:",c),It.error(c.message||"Failed to initiate payment"),(l=o.onFailure)==null||l.call(o,c)}finally{t(!1)}},[n]),a=N.useCallback(async o=>{var l;t(!0);try{if(!await n())throw new Error("Failed to load Razorpay SDK");const{data:{session:d}}=await ue.auth.getSession();if(!d)throw new Error("Please login to continue");const u=await ue.functions.invoke("create-subscription",{body:{plan_type:o.plan_type}});if(u.error)throw new Error(u.error.message||"Failed to create subscription");const{subscription:h,prefill:p,key_id:m,use_subscription_api:f}=u.data;let g;f&&h.razorpay_subscription_id?g={key:m,subscription_id:h.razorpay_subscription_id,name:"Synka",description:`Orange Plan - ${o.plan_type==="annually"?"Annual":"Monthly"} (Auto-renewal)`,prefill:{name:p.name,email:p.email,contact:p.contact},theme:{color:"#F97316"},...no()&&{callback_url:Dx(),redirect:!1},handler:async y=>{var b,v,w;try{const k=await ue.functions.invoke("verify-payment",{body:{razorpay_subscription_id:y.razorpay_subscription_id,razorpay_payment_id:y.razorpay_payment_id,razorpay_signature:y.razorpay_signature,type:"subscription",subscription_id:h.id}});if(k.error){console.warn("Verification API returned error, but payment was captured:",k.error),It.success("Payment successful! Your subscription is being activated..."),(b=o.onSuccess)==null||b.call(o,{pending:!0,payment_id:y.razorpay_payment_id});return}It.success("Subscription activated with auto-renewal! Welcome to Orange!"),(v=o.onSuccess)==null||v.call(o,k.data)}catch(k){console.warn("Verification request failed, but payment was captured:",k),It.success("Payment successful! Your subscription is being activated..."),(w=o.onSuccess)==null||w.call(o,{pending:!0,payment_id:y.razorpay_payment_id})}},modal:{ondismiss:()=>{var y;t(!1),It.info("Payment cancelled"),(y=o.onFailure)==null||y.call(o,{message:"Payment cancelled by user"})},escape:!no(),backdropclose:!1}}:g={key:m,amount:h.amount,currency:h.currency,name:"Synka",description:`Orange Plan - ${o.plan_type==="annually"?"Annual":"Monthly"}`,order_id:h.razorpay_order_id,prefill:{name:p.name,email:p.email,contact:p.contact},config:{display:{hide:[{method:"wallet"}],preferences:{show_default_blocks:!0}}},theme:{color:"#F97316"},...no()&&{callback_url:Dx(),redirect:!1},handler:async y=>{var b,v,w;try{const k=await ue.functions.invoke("verify-payment",{body:{razorpay_order_id:y.razorpay_order_id,razorpay_payment_id:y.razorpay_payment_id,razorpay_signature:y.razorpay_signature,type:"subscription",subscription_id:h.id}});if(k.error){console.warn("Verification API returned error, but payment was captured:",k.error),It.success("Payment successful! Your subscription is being activated..."),(b=o.onSuccess)==null||b.call(o,{pending:!0,payment_id:y.razorpay_payment_id});return}It.success("Subscription activated! Welcome to Orange!"),(v=o.onSuccess)==null||v.call(o,k.data)}catch(k){console.warn("Verification request failed, but payment was captured:",k),It.success("Payment successful! Your subscription is being activated..."),(w=o.onSuccess)==null||w.call(o,{pending:!0,payment_id:y.razorpay_payment_id})}},modal:{ondismiss:()=>{var y;t(!1),It.info("Payment cancelled"),(y=o.onFailure)==null||y.call(o,{message:"Payment cancelled by user"})},escape:!no(),backdropclose:!1}};const x=new window.Razorpay(g);x.on("payment.failed",async y=>{var b,v,w;if(console.error("Payment failed:",y.error),It.error(y.error.description||"Payment failed"),h.id)try{await ue.from("subscriptions").update({payment_status:"failed",updated_at:new Date().toISOString()}).eq("id",h.id),await ue.from("payments").insert({user_id:d.user.id,subscription_id:h.id,razorpay_order_id:h.razorpay_order_id||null,razorpay_subscription_id:h.razorpay_subscription_id||null,amount:h.amount/100,status:"failed",error_code:(b=y.error)==null?void 0:b.code,error_description:(v=y.error)==null?void 0:v.description})}catch(k){console.error("Failed to update subscription status:",k)}(w=o.onFailure)==null||w.call(o,y.error),t(!1)}),x.open()}catch(c){console.error("Subscription initiation error:",c),It.error(c.message||"Failed to initiate subscription"),(l=o.onFailure)==null||l.call(o,c)}finally{t(!1)}},[n]),s=N.useCallback(async o=>{var l;t(!0);try{if(!await n())throw new Error("Failed to load Razorpay SDK");const{data:{session:d}}=await ue.auth.getSession();if(!d)throw new Error("Please login to continue");const u=await ue.functions.invoke("resume-subscription",{body:{}});if(u.error)throw new Error(u.error.message||"Failed to resume subscription");const{subscription:h,prefill:p,key_id:m,use_subscription_api:f}=u.data;let g;f&&h.razorpay_subscription_id?g={key:m,subscription_id:h.razorpay_subscription_id,name:"Synka",description:`Orange Plan - ${h.plan_type==="annually"?"Annual":"Monthly"} (Resume)`,prefill:{name:p.name,email:p.email,contact:p.contact},theme:{color:"#F97316"},...no()&&{callback_url:Dx(),redirect:!1},handler:async y=>{var b,v,w;try{const k=await ue.functions.invoke("verify-payment",{body:{razorpay_subscription_id:y.razorpay_subscription_id,razorpay_payment_id:y.razorpay_payment_id,razorpay_signature:y.razorpay_signature,type:"subscription",subscription_id:h.id}});if(k.error){console.warn("Resume verify API error, but payment was captured:",k.error),It.success("Payment successful! Your subscription is being activated..."),(b=o.onSuccess)==null||b.call(o,{pending:!0,payment_id:y.razorpay_payment_id});return}It.success("Subscription resumed! Auto-renewal is back on."),(v=o.onSuccess)==null||v.call(o,k.data)}catch(k){console.warn("Resume verify request failed, but payment was captured:",k),It.success("Payment successful! Your subscription is being activated..."),(w=o.onSuccess)==null||w.call(o,{pending:!0,payment_id:y.razorpay_payment_id})}},modal:{ondismiss:()=>{var y;t(!1),It.info("Payment cancelled"),(y=o.onFailure)==null||y.call(o,{message:"Payment cancelled by user"})},escape:!no(),backdropclose:!1}}:g={key:m,amount:h.amount,currency:h.currency,name:"Synka",description:`Orange Plan - ${h.plan_type==="annually"?"Annual":"Monthly"} (Resume)`,order_id:h.razorpay_order_id,prefill:{name:p.name,email:p.email,contact:p.contact},config:{display:{hide:[{method:"wallet"}],preferences:{show_default_blocks:!0}}},theme:{color:"#F97316"},...no()&&{callback_url:Dx(),redirect:!1},handler:async y=>{var b,v,w;try{const k=await ue.functions.invoke("verify-payment",{body:{razorpay_order_id:y.razorpay_order_id,razorpay_payment_id:y.razorpay_payment_id,razorpay_signature:y.razorpay_signature,type:"subscription",subscription_id:h.id}});if(k.error){console.warn("Resume verify API error, but payment was captured:",k.error),It.success("Payment successful! Your subscription is being activated..."),(b=o.onSuccess)==null||b.call(o,{pending:!0,payment_id:y.razorpay_payment_id});return}It.success("Subscription resumed! Welcome back to Orange."),(v=o.onSuccess)==null||v.call(o,k.data)}catch(k){console.warn("Resume verify request failed, but payment was captured:",k),It.success("Payment successful! Your subscription is being activated..."),(w=o.onSuccess)==null||w.call(o,{pending:!0,payment_id:y.razorpay_payment_id})}},modal:{ondismiss:()=>{var y;t(!1),It.info("Payment cancelled"),(y=o.onFailure)==null||y.call(o,{message:"Payment cancelled by user"})},escape:!no(),backdropclose:!1}};const x=new window.Razorpay(g);x.on("payment.failed",async y=>{var b,v,w;if(console.error("Resume payment failed:",y.error),It.error(y.error.description||"Payment failed"),h.id)try{await ue.from("subscriptions").update({payment_status:"failed",updated_at:new Date().toISOString()}).eq("id",h.id),await ue.from("payments").insert({user_id:d.user.id,subscription_id:h.id,razorpay_order_id:h.razorpay_order_id||null,razorpay_subscription_id:h.razorpay_subscription_id||null,amount:h.amount/100,status:"failed",error_code:(b=y.error)==null?void 0:b.code,error_description:(v=y.error)==null?void 0:v.description})}catch(k){console.error("Failed to record resume payment failure:",k)}(w=o.onFailure)==null||w.call(o,y.error),t(!1)}),x.open()}catch(c){console.error("Resume initiation error:",c),It.error(c.message||"Failed to resume subscription"),(l=o.onFailure)==null||l.call(o,c)}finally{t(!1)}},[n]);return{loading:e,initiatePayment:r,initiateSubscription:a,initiateResume:s}}const Mx=[{id:"pvc",name:"NFC Business Card",price:499,originalPrice:999,priceDisplay:"499",originalPriceDisplay:"999",discount:"50% OFF",description:"Smart. Simple. Everyday use.",features:["Tap to share (NFC + QR)","Lightweight PVC card","Matte or Glossy finish","Water resistant","Free replacement*"],popular:!1},{id:"metal",name:"Metal NFC Card",price:1499,originalPrice:2999,priceDisplay:"1,499",originalPriceDisplay:"2,999",discount:"50% OFF",description:"Designed to impress. Built to last.",features:["Tap to share (NFC + QR)","Solid metal body","Precision laser engraving","Priority delivery","Lifetime durability","Free replacement*"],popular:!0}],$x=[{id:"metal-gold",name:"Metal Gold",type:"metal",image:"/images/card/metal-nfc-card-gold.webp"},{id:"metal-rose-gold",name:"Metal Rose Gold",type:"metal",image:"/images/card/metal-nfc-card-rose-gold.webp"},{id:"metal-silver",name:"Metal Silver",type:"metal",image:"/images/card/metal-nfc-business-card-silver.webp"},{id:"metal-black",name:"Metal Black",type:"metal",image:"/images/card/metal-nfc-business-card-black.webp"},{id:"metal-unsure",name:"Not Sure - We'll Suggest Best",type:"metal",image:"/images/card/metal-nfc-business-cards.webp"},{id:"nfc-white-gloss",name:"NFC White Gloss",type:"pvc",image:"/images/card/Pvc-nfc-business-card.webp",hint:"Any color can be printed on white"},{id:"nfc-black-matt",name:"NFC Black Matt",type:"pvc",image:"/images/card/Pvc-nfc-business-card-black.webp"},{id:"nfc-orange",name:"NFC Orange",type:"pvc",image:"/images/card/Pvc-nfc-business-card-orange.webp"}],jKe=e=>e==="paid"?{label:"Paid - Processing",color:"default",icon:""}:e==="payment_failed"?{label:"Payment Failed",color:"destructive",icon:""}:e==="pending"||e==="created"?{label:"Pending Payment",color:"secondary",icon:""}:e==="Placed"?{label:"Order Placed",color:"default",icon:""}:e==="Approved"?{label:"Approved",color:"default",icon:""}:e==="Dispatched"?{label:"Dispatched",color:"default",icon:""}:e==="Done"?{label:"Delivered",color:"default",icon:""}:e==="NA"?{label:"Cancelled",color:"destructive",icon:""}:{label:e,color:"outline",icon:""};function IKe(){var $,L,M,X,G,W;const e=Pa(),{user:t,loading:n}=or(),{activeCard:r,cards:a,loading:s}=Df(),{profile:o}=hl(),{initiatePayment:l}=mY(),[c,d]=N.useState("pvc"),[u,h]=N.useState("nfc-white-gloss"),[p,m]=N.useState(1),[f,g]=N.useState([]),[x,y]=N.useState(!0),[b,v]=N.useState(!1),[w,k]=N.useState(!1),[C,S]=N.useState(!1),[_,I]=N.useState(null),[T,A]=N.useState({name:"",phone:"",address:"",pincode:""}),j=!s&&a.length===0,D=$x.filter(O=>O.type===c);N.useEffect(()=>{const O=$x.find(U=>U.type===c);O&&h(O.id)},[c]),N.useEffect(()=>{if(!t)return;const O=async()=>{y(!0);const{data:K,error:ce}=await ue.from("orders").select("id, order_number, product_type, quantity, amount, status, created_at").eq("user_id",t.id).not("status","in","(pending,created,failed,payment_failed)").order("created_at",{ascending:!1});!ce&&K&&g(K),y(!1)};O();const U=ue.channel("user-orders-changes").on("postgres_changes",{event:"*",schema:"public",table:"orders",filter:`user_id=eq.${t.id}`},()=>{O()}).subscribe();return()=>{ue.removeChannel(U)}},[t]),N.useEffect(()=>{(r||o)&&A(O=>({...O,name:(r==null?void 0:r.full_name)||(o==null?void 0:o.full_name)||O.name,phone:(r==null?void 0:r.phone)||(o==null?void 0:o.phone)||O.phone}))},[r,o]),N.useEffect(()=>{!n&&!t&&e("/login")},[t,n,e]);const F=async O=>{if(O.preventDefault(),!t)return;if(!T.name||!T.phone||!T.address||!T.pincode){ie({title:"Missing information",description:"Please fill in all shipping details.",variant:"destructive"});return}v(!0);const U=Mx.find(ne=>ne.id===c),K=((U==null?void 0:U.price)||0)*p;l({product_type:c==="pvc"?"pvc":"metal",amount:K,quantity:p,card_variant:u,onSuccess:ne=>{v(!1),k(!0),S(!1),I(null)},onFailure:ne=>{v(!1),S(!0),I((ne==null?void 0:ne.message)||"Could not process payment. Please try again.")}})},B=()=>{S(!1),I(null)},q=()=>{k(!1),m(1),d("pvc"),h("nfc-white-gloss")};return n||s?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):C?i.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-2xl mx-auto animate-fade-up",children:i.jsx(Tn,{className:"border-destructive/20 bg-gradient-to-b from-destructive/5 to-transparent",children:i.jsxs(Dn,{className:"pt-8 pb-8 text-center space-y-6",children:[i.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-destructive/10 flex items-center justify-center",children:i.jsx(Dl,{className:"h-10 w-10 text-destructive"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Payment Failed"}),i.jsx("p",{className:"text-muted-foreground",children:_||"Your payment could not be processed. Please try again."})]}),i.jsxs("div",{className:"bg-muted/50 rounded-xl p-6 text-left space-y-3",children:[i.jsx("h3",{className:"font-semibold text-foreground",children:"What you can do:"}),i.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-primary"}),"Check your payment details and try again"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-primary"}),"Ensure sufficient balance in your account"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-primary"}),"Try a different payment method"]})]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>e("/dashboard"),children:"Go to Dashboard"}),i.jsxs(de,{variant:"gradient",className:"flex-1",onClick:B,children:[i.jsx(Nh,{className:"h-4 w-4 mr-2"}),"Try Again"]})]})]})})}):w?i.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-2xl mx-auto animate-fade-up",children:i.jsx(Tn,{className:"border-primary/20 bg-gradient-to-b from-primary/5 to-transparent",children:i.jsxs(Dn,{className:"pt-8 pb-8 text-center space-y-6",children:[i.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(wO,{className:"h-10 w-10 text-primary"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:" Order Received!"}),i.jsx("p",{className:"text-muted-foreground",children:"Thank you for your order"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-xl p-6 text-left space-y-4",children:[i.jsx("h3",{className:"font-semibold text-foreground",children:"What happens next?"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:i.jsx(Pi,{className:"h-4 w-4 text-primary"})}),i.jsx("div",{children:i.jsx("p",{className:"font-medium text-foreground",children:"Our team will contact you within 24 hours"})})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:i.jsx(vO,{className:"h-4 w-4 text-primary"})}),i.jsx("div",{children:i.jsx("p",{className:"font-medium text-foreground",children:"You'll receive card design options created by AI"})})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:i.jsx(fO,{className:"h-4 w-4 text-primary"})}),i.jsx("div",{children:i.jsx("p",{className:"font-medium text-foreground",children:"Review & approve design"})})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:i.jsx(d2,{className:"h-4 w-4 text-primary"})}),i.jsx("div",{children:i.jsx("p",{className:"font-medium text-foreground",children:"We print & dispatch your card"})})]})]}),i.jsx("div",{className:"pt-2 border-t border-border",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:[" ",i.jsx("span",{className:"font-medium",children:"Estimated delivery:"})," 57 business days after approval"]})})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>e("/dashboard"),children:"Go to Dashboard"}),i.jsx(de,{variant:"gradient",className:"flex-1",onClick:q,children:"Place Another Order"})]})]})})}):i.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 max-w-4xl mx-auto animate-fade-up",children:[i.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>e(-1),children:i.jsx(Ed,{className:"h-5 w-5"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Order NFC Card"}),i.jsx("p",{className:"text-muted-foreground",children:"Get your physical smart business card"})]})]}),!x&&f.length>0&&i.jsxs(Tn,{className:"mb-8",children:[i.jsxs(Qn,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ry,{className:"h-5 w-5 text-primary"}),i.jsx(Jn,{className:"text-lg",children:"Your Orders"})]}),i.jsx(Ri,{children:"Track your NFC card orders"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"space-y-3",children:f.map(O=>{const U=jKe(O.status);return i.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border bg-muted/30",children:[i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-mono font-semibold text-sm",children:O.order_number}),i.jsx(rn,{variant:"outline",className:"uppercase text-xs",children:O.product_type==="pvc"?"PVC Card":"Metal Card"})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",O.quantity,"  ",Number(O.amount).toLocaleString()]})]}),i.jsxs(rn,{variant:U.color,children:[U.icon," ",U.label]})]},O.id)})})})]}),x&&i.jsx("div",{className:"flex items-center justify-center py-8 mb-8",children:i.jsx(Gt,{className:"h-6 w-6 animate-spin text-muted-foreground"})}),j&&i.jsxs("div",{className:"mb-6 p-4 rounded-xl bg-primary/10 border border-primary/20 flex items-start gap-3",children:[i.jsx(Ls,{className:"h-5 w-5 text-primary mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Welcome to Synka!"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Order your NFC card and your digital card will be created instantly. You can customize it anytime from the My Card section."})]})]}),i.jsxs("form",{onSubmit:F,className:"space-y-8",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h2",{className:"text-lg font-semibold",children:"Select Card Type"}),i.jsx(hY,{value:c,onValueChange:d,className:"grid md:grid-cols-2 gap-4",children:Mx.map(O=>i.jsxs(We,{htmlFor:O.id,className:Ie("relative flex flex-col p-6 rounded-2xl border-2 cursor-pointer transition-all",c===O.id?"border-primary bg-primary/5":"border-border hover:border-primary/50"),children:[i.jsx(pY,{value:O.id,id:O.id,className:"sr-only"}),O.popular&&i.jsx("span",{className:"absolute -top-3 left-4 px-3 py-1 bg-primary text-primary-foreground text-xs font-medium rounded-full",children:"Popular"}),i.jsxs("div",{className:"flex items-start justify-between mb-4",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-lg",children:O.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:O.description})]}),i.jsxs("div",{className:"text-right",children:[i.jsx("p",{className:"text-sm text-muted-foreground line-through",children:O.originalPriceDisplay}),i.jsx("p",{className:"text-2xl font-bold text-primary",children:O.priceDisplay}),i.jsxs(rn,{className:"text-[10px] mt-1 bg-green-600 hover:bg-green-600 text-white",children:[O.discount,"  Limited Time"]})]})]}),i.jsx("ul",{className:"space-y-2",children:O.features.map((U,K)=>i.jsxs("li",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsx(dn,{className:"h-4 w-4 text-primary"}),U]},K))}),c===O.id&&i.jsx("div",{className:"absolute -top-3 -right-3",children:i.jsx("div",{className:"w-6 h-6 rounded-full bg-primary flex items-center justify-center border-2 border-background",children:i.jsx(dn,{className:"h-4 w-4 text-primary-foreground"})})})]},O.id))})]}),c==="metal"&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"card-variant",children:"Select Card Finish"}),i.jsxs($i,{value:u,onValueChange:h,children:[i.jsx(ai,{className:"w-full",children:i.jsx(Fi,{placeholder:"Select a card variant",children:u&&i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:($=$x.find(O=>O.id===u))==null?void 0:$.image,alt:"",className:"w-10 h-6 object-cover rounded"}),i.jsx("span",{children:(L=$x.find(O=>O.id===u))==null?void 0:L.name})]})})}),i.jsx(si,{children:D.map(O=>i.jsx(Ut,{value:O.id,children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("img",{src:O.image,alt:O.name,className:"w-12 h-8 object-cover rounded"}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{children:O.name}),"hint"in O&&O.hint&&i.jsx("span",{className:"text-xs text-muted-foreground",children:O.hint})]})]})},O.id))})]})]}),i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"text-xs text-muted-foreground",children:"Our team will contact you to collect logo, design preferences & branding details."}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.jsx("span",{className:"font-medium",children:"AI Designs Your Card"}),"  Our team checks and recommends  You approve  Final approval  Print  Dispatch"]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"quantity",children:"Quantity"}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(de,{type:"button",variant:"outline",size:"icon",onClick:()=>m(Math.max(1,p-1)),children:"-"}),i.jsx(At,{id:"quantity",type:"number",min:"1",max:"10",value:p,onChange:O=>m(Math.max(1,parseInt(O.target.value)||1)),className:"w-20 text-center"}),i.jsx(de,{type:"button",variant:"outline",size:"icon",onClick:()=>m(Math.min(10,p+1)),children:"+"})]})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{children:[i.jsx(Jn,{className:"text-lg",children:"Shipping Address"}),i.jsx(Ri,{children:"Where should we deliver your card?"})]}),i.jsxs(Dn,{className:"space-y-4",children:[i.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"name",children:"Full Name"}),i.jsx(At,{id:"name",value:T.name,onChange:O=>A({...T,name:O.target.value}),required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"phone",children:"Phone Number"}),i.jsx(At,{id:"phone",type:"tel",value:T.phone,onChange:O=>A({...T,phone:O.target.value}),required:!0})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"address",children:"Address"}),i.jsx(At,{id:"address",value:T.address,onChange:O=>A({...T,address:O.target.value}),placeholder:"House/Flat No., Street, Locality, City, State",required:!0})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"pincode",children:"Pincode"}),i.jsx(At,{id:"pincode",value:T.pincode,onChange:O=>A({...T,pincode:O.target.value}),placeholder:"6-digit pincode",maxLength:6,required:!0})]})]})]}),i.jsxs(Tn,{children:[i.jsx(Qn,{children:i.jsx(Jn,{className:"text-lg",children:"Order Summary"})}),i.jsx(Dn,{children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsxs("span",{className:"text-muted-foreground",children:[(M=Mx.find(O=>O.id===c))==null?void 0:M.name,"  ",p]}),i.jsx("span",{className:"font-medium",children:(X=Mx.find(O=>O.id===c))==null?void 0:X.priceDisplay})]}),c==="metal"&&i.jsx("div",{className:"flex justify-between text-sm",children:i.jsxs("span",{className:"text-muted-foreground",children:["Variant: ",(G=$x.find(O=>O.id===u))==null?void 0:G.name]})}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-muted-foreground",children:"Shipping"}),i.jsx("span",{className:"font-medium text-primary",children:"Free"})]}),i.jsxs("div",{className:"border-t pt-2 mt-2 flex justify-between",children:[i.jsx("span",{className:"font-semibold",children:"Total"}),i.jsxs("span",{className:"font-bold text-lg",children:["",((((W=Mx.find(O=>O.id===c))==null?void 0:W.price)||0)*p).toLocaleString()]})]})]})})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs(de,{type:"submit",variant:"gradient",size:"xl",className:"w-full",disabled:b,children:[b?i.jsx(Gt,{className:"h-5 w-5 mr-2 animate-spin"}):i.jsx(rl,{className:"h-5 w-5 mr-2"}),b?"Placing Order...":"Place Order"]}),i.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(dn,{className:"h-3 w-3 text-primary"}),"Design approval before printing"]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(dn,{className:"h-3 w-3 text-primary"}),"Free replacement available*"]}),i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(FX,{className:"h-3 w-3 text-primary"}),"Secure payment"]})]})]})]})]})}const $_="synka_admin_status";function TKe(){try{const e=localStorage.getItem($_);if(!e)return null;const{isAdmin:t,expiry:n}=JSON.parse(e);return Date.now()>n?(localStorage.removeItem($_),null):t}catch{return null}}function EKe(e){try{localStorage.setItem($_,JSON.stringify({isAdmin:e,expiry:Date.now()+24*60*60*1e3}))}catch{}}function Wu(){const{user:e}=or(),t=TKe(),n=al({queryKey:["admin-status",e==null?void 0:e.id],queryFn:async()=>{if(!e)return!1;const{data:r,error:a}=await ue.from("user_roles").select("role").eq("user_id",e.id).eq("role","admin").maybeSingle(),s=!!r&&!a;return EKe(s),s},enabled:!!e,staleTime:5*60*1e3,gcTime:60*60*1e3,placeholderData:t??void 0});return{isAdmin:n.data??t??!1,loading:n.isLoading&&t===null}}function AKe(){const{isAdmin:e}=Wu();return al({queryKey:["admin-users"],queryFn:async()=>{const{data:t,error:n}=await ue.from("profiles").select("id, user_id, full_name, email, phone, plan, created_at").order("created_at",{ascending:!1});if(n)throw n;return await Promise.all((t||[]).map(async a=>{var l,c;const[s,o]=await Promise.all([ue.from("user_roles").select("role").eq("user_id",a.user_id).limit(1).maybeSingle(),a.full_name?Promise.resolve({data:null}):ue.from("cards").select("full_name").eq("user_id",a.user_id).eq("is_default",!0).limit(1).maybeSingle()]);return{...a,full_name:a.full_name||((l=o.data)==null?void 0:l.full_name)||null,role:((c=s.data)==null?void 0:c.role)||"free"}}))},enabled:e,staleTime:30*1e3,gcTime:10*60*1e3})}function RKe(){const{isAdmin:e}=Wu();return al({queryKey:["admin-payments"],queryFn:async()=>{const{data:t,error:n}=await ue.from("payments").select("*").order("created_at",{ascending:!1});if(n)throw n;const r=[...new Set((t==null?void 0:t.map(o=>o.user_id))||[])],{data:a}=await ue.from("profiles").select("user_id, full_name, email, phone").in("user_id",r),s=new Map(a==null?void 0:a.map(o=>[o.user_id,{name:o.full_name,email:o.email,phone:o.phone}]));return(t==null?void 0:t.map(o=>{var l,c,d;return{...o,user_name:((l=s.get(o.user_id))==null?void 0:l.name)||"Unknown",user_email:((c=s.get(o.user_id))==null?void 0:c.email)||"",user_phone:((d=s.get(o.user_id))==null?void 0:d.phone)||""}}))||[]},enabled:e,staleTime:30*1e3,gcTime:10*60*1e3})}function DKe(){const{isAdmin:e}=Wu();return al({queryKey:["admin-subscriptions"],queryFn:async()=>{const{data:t,error:n}=await ue.from("subscriptions").select("*").order("created_at",{ascending:!1});if(n)throw n;const r=[...new Set((t==null?void 0:t.map(o=>o.user_id))||[])],{data:a}=await ue.from("profiles").select("user_id, full_name, email, phone").in("user_id",r),s=new Map(a==null?void 0:a.map(o=>[o.user_id,{name:o.full_name,email:o.email,phone:o.phone}]));return(t==null?void 0:t.map(o=>{var l,c,d;return{...o,user_name:((l=s.get(o.user_id))==null?void 0:l.name)||"Unknown",user_email:((c=s.get(o.user_id))==null?void 0:c.email)||"",user_phone:((d=s.get(o.user_id))==null?void 0:d.phone)||""}}))||[]},enabled:e,staleTime:30*1e3,gcTime:10*60*1e3})}function MKe(){const{isAdmin:e}=Wu();return al({queryKey:["admin-orders"],queryFn:async()=>{var c,d;const{data:t,error:n}=await ue.from("orders").select("*").order("created_at",{ascending:!1});if(n)throw n;const r=[...new Set((t==null?void 0:t.map(u=>u.user_id))||[])],[a,s]=await Promise.all([ue.from("profiles").select("user_id, full_name, email, phone").in("user_id",r),ue.from("cards").select("user_id, full_name, phone").in("user_id",r).eq("is_default",!0)]),o=new Map((c=a.data)==null?void 0:c.map(u=>[u.user_id,{name:u.full_name,email:u.email,phone:u.phone}])),l=new Map((d=s.data)==null?void 0:d.map(u=>[u.user_id,{name:u.full_name,phone:u.phone}]));return(t==null?void 0:t.map(u=>{const h=o.get(u.user_id),p=l.get(u.user_id);return{...u,user_name:(h==null?void 0:h.name)||(p==null?void 0:p.name)||"Unknown",user_email:(h==null?void 0:h.email)||"Unknown",user_phone:(h==null?void 0:h.phone)||(p==null?void 0:p.phone)||null}}))||[]},enabled:e,staleTime:30*1e3,gcTime:10*60*1e3})}const fY=aX,VR=N.forwardRef(({className:e,...t},n)=>i.jsx(iO,{ref:n,className:Ie("inline-flex h-10 items-center justify-center rounded-xl bg-secondary p-1 text-muted-foreground",e),...t}));VR.displayName=iO.displayName;const _i=N.forwardRef(({className:e,...t},n)=>i.jsx(oO,{ref:n,className:Ie("inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-card data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));_i.displayName=oO.displayName;const ji=N.forwardRef(({className:e,...t},n)=>i.jsx(lO,{ref:n,className:Ie("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));ji.displayName=lO.displayName;const Gl=N.forwardRef(({className:e,...t},n)=>i.jsx("div",{className:"relative w-full overflow-auto",children:i.jsx("table",{ref:n,className:Ie("w-full caption-bottom text-sm",e),...t})}));Gl.displayName="Table";const ql=N.forwardRef(({className:e,...t},n)=>i.jsx("thead",{ref:n,className:Ie("[&_tr]:border-b",e),...t}));ql.displayName="TableHeader";const Kl=N.forwardRef(({className:e,...t},n)=>i.jsx("tbody",{ref:n,className:Ie("[&_tr:last-child]:border-0",e),...t}));Kl.displayName="TableBody";const $Ke=N.forwardRef(({className:e,...t},n)=>i.jsx("tfoot",{ref:n,className:Ie("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));$Ke.displayName="TableFooter";const Br=N.forwardRef(({className:e,...t},n)=>i.jsx("tr",{ref:n,className:Ie("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));Br.displayName="TableRow";const Ot=N.forwardRef(({className:e,...t},n)=>i.jsx("th",{ref:n,className:Ie("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));Ot.displayName="TableHead";const Et=N.forwardRef(({className:e,...t},n)=>i.jsx("td",{ref:n,className:Ie("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Et.displayName="TableCell";const FKe=N.forwardRef(({className:e,...t},n)=>i.jsx("caption",{ref:n,className:Ie("mt-4 text-sm text-muted-foreground",e),...t}));FKe.displayName="TableCaption";function PKe(){const{isAdmin:e}=Wu(),{data:t=[],isLoading:n,isFetching:r,refetch:a}=AKe(),s=Rf(),[o,l]=N.useState(""),[c,d]=N.useState(null),[u,h]=N.useState(null),p=N.useRef(null),m=N.useCallback(()=>{p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(()=>{a()},300)},[a]);N.useEffect(()=>{if(!e)return;const w=ue.channel("admin-profiles-changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},m).subscribe();return()=>{p.current&&window.clearTimeout(p.current),ue.removeChannel(w)}},[e,m]);const f=async(w,k)=>{const{error:C}=await ue.rpc("upgrade_user_plan",{_user_id:w,_new_plan:k});if(C)throw C;s.invalidateQueries({queryKey:["admin-users"]})},g=async w=>{const{error:k}=await ue.from("profiles").update({plan:"Free",updated_at:new Date().toISOString()}).eq("user_id",w);if(k)throw k;await ue.from("user_roles").update({role:"free"}).eq("user_id",w).eq("role","orange"),s.invalidateQueries({queryKey:["admin-users"]})},x=(w,k)=>{h({type:"upgrade",userId:w,userName:k})},y=(w,k)=>{h({type:"downgrade",userId:w,userName:k})},b=async()=>{if(u){d(u.userId);try{u.type==="upgrade"?(await f(u.userId,"Orange"),It.success(`${u.userName||"User"} upgraded to Orange plan`)):(await g(u.userId),It.success(`${u.userName||"User"} downgraded to Free plan`))}catch{It.error(`Failed to ${u.type} user`)}finally{d(null),h(null)}}},v=t.filter(w=>{var k,C,S;return((k=w.full_name)==null?void 0:k.toLowerCase().includes(o.toLowerCase()))||((C=w.email)==null?void 0:C.toLowerCase().includes(o.toLowerCase()))||((S=w.phone)==null?void 0:S.includes(o))});return n&&t.length===0?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"relative flex-1 max-w-sm",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),i.jsx(At,{placeholder:"Search users...",value:o,onChange:w=>l(w.target.value),className:"pl-10"})]}),i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[r&&i.jsx(Gt,{className:"h-3 w-3 animate-spin"}),t.length," users"]})]}),i.jsx("div",{className:"rounded-md border",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{children:"Name"}),i.jsx(Ot,{children:"Email"}),i.jsx(Ot,{children:"Mobile"}),i.jsx(Ot,{children:"Plan"}),i.jsx(Ot,{children:"Role"}),i.jsx(Ot,{children:"Signup Date"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsx(Kl,{children:v.length===0?i.jsx(Br,{children:i.jsx(Et,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No users found"})}):v.map(w=>i.jsxs(Br,{children:[i.jsx(Et,{className:"font-medium",children:w.full_name||"N/A"}),i.jsx(Et,{children:w.email||"N/A"}),i.jsx(Et,{children:w.phone||"N/A"}),i.jsx(Et,{children:i.jsx(rn,{variant:w.plan==="Orange"?"default":"secondary",children:w.plan})}),i.jsx(Et,{children:i.jsx(rn,{variant:w.role==="admin"?"destructive":"outline",children:w.role})}),i.jsx(Et,{children:Ht(new Date(w.created_at),"MMM d, yyyy")}),i.jsx(Et,{children:w.role!=="admin"&&i.jsx(i.Fragment,{children:w.plan==="Free"?i.jsx(de,{size:"sm",onClick:()=>x(w.user_id,w.full_name||"User"),disabled:c===w.user_id,children:c===w.user_id?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(wX,{className:"h-4 w-4 mr-1"}),"Upgrade"]})}):i.jsx(de,{size:"sm",variant:"outline",onClick:()=>y(w.user_id,w.full_name||"User"),disabled:c===w.user_id,children:c===w.user_id?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):i.jsxs(i.Fragment,{children:[i.jsx(vX,{className:"h-4 w-4 mr-1"}),"Downgrade"]})})})})]},w.id))})]})})]}),i.jsx(Jm,{open:!!u,onOpenChange:w=>!w&&h(null),children:i.jsxs(Wd,{children:[i.jsxs(Ud,{children:[i.jsx(Hd,{children:(u==null?void 0:u.type)==="upgrade"?"Upgrade User Plan":"Downgrade User Plan"}),i.jsx(Gd,{children:(u==null?void 0:u.type)==="upgrade"?i.jsxs(i.Fragment,{children:["Are you sure you want to upgrade ",i.jsx("strong",{children:u==null?void 0:u.userName})," to the ",i.jsx("strong",{children:"Orange"})," plan?"]}):i.jsxs(i.Fragment,{children:["Are you sure you want to downgrade ",i.jsx("strong",{children:u==null?void 0:u.userName})," to the ",i.jsx("strong",{children:"Free"})," plan?"]})})]}),i.jsxs(Vd,{children:[i.jsx(Kd,{children:"Cancel"}),i.jsx(qd,{onClick:b,children:(u==null?void 0:u.type)==="upgrade"?"Yes, Upgrade":"Yes, Downgrade"})]})]})})]})}var OKe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],LKe=OKe.reduce((e,t)=>{const n=sb(`Primitive.${t}`),r=N.forwardRef((a,s)=>{const{asChild:o,...l}=a,c=o?n:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:s})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{}),zKe="Separator",vP="horizontal",BKe=["horizontal","vertical"],gY=N.forwardRef((e,t)=>{const{decorative:n,orientation:r=vP,...a}=e,s=WKe(r)?r:vP,l=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return i.jsx(LKe.div,{"data-orientation":s,...l,...a,ref:t})});gY.displayName=zKe;function WKe(e){return BKe.includes(e)}var xY=gY;const vd=N.forwardRef(({className:e,orientation:t="horizontal",decorative:n=!0,...r},a)=>i.jsx(xY,{ref:a,decorative:n,orientation:t,className:Ie("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...r}));vd.displayName=xY.displayName;function UKe(){const{isAdmin:e}=Wu(),{data:t=[],isLoading:n,isFetching:r,refetch:a}=RKe(),{data:s=[],isLoading:o,isFetching:l,refetch:c}=DKe(),[d,u]=N.useState("payments"),[h,p]=N.useState(""),[m,f]=N.useState("all"),[g,x]=N.useState("all"),[y,b]=N.useState(null),[v,w]=N.useState(null),[k,C]=N.useState(!1),S=N.useRef(null),_=t,I=s,T=n||o,A=r||l,j=N.useCallback(()=>{a(),c()},[a,c]),D=N.useCallback(()=>{S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{j()},300)},[j]);N.useEffect(()=>{if(!e)return;const W=ue.channel("admin-payments").on("postgres_changes",{event:"*",schema:"public",table:"payments"},()=>D()).subscribe(),O=ue.channel("admin-subscriptions").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions"},()=>D()).subscribe();return()=>{S.current&&window.clearTimeout(S.current),ue.removeChannel(W),ue.removeChannel(O)}},[e,D]);const F=N.useMemo(()=>{const W=new Map;_.forEach(U=>{const K=W.get(U.user_id)||[];W.set(U.user_id,[...K,U])});const O=[];return W.forEach((U,K)=>{const ce=U.sort((te,Te)=>new Date(Te.created_at).getTime()-new Date(te.created_at).getTime()),ne=ce[0];O.push({user_id:K,user_name:ne.user_name||"Unknown",user_email:ne.user_email||"",user_phone:ne.user_phone||"",latest:ne,history:ce,totalAmount:U.reduce((te,Te)=>te+(Te.status==="captured"?Te.amount:0),0),paymentCount:U.length})}),O.sort((U,K)=>new Date(K.latest.created_at).getTime()-new Date(U.latest.created_at).getTime())},[_]),B=N.useMemo(()=>{const W=new Map;I.forEach(U=>{const K=W.get(U.user_id)||[];W.set(U.user_id,[...K,U])});const O=[];return W.forEach((U,K)=>{const ce=U.sort((te,Te)=>new Date(Te.created_at).getTime()-new Date(te.created_at).getTime()),ne=ce[0];O.push({user_id:K,user_name:ne.user_name||"Unknown",user_email:ne.user_email||"",user_phone:ne.user_phone||"",latest:ne,history:ce,totalAmount:U.reduce((te,Te)=>te+Te.amount,0),subscriptionCount:U.length})}),O.sort((U,K)=>new Date(K.latest.created_at).getTime()-new Date(U.latest.created_at).getTime())},[I]),q=W=>{const U={captured:{variant:"default",icon:Ho,label:"Captured"},failed:{variant:"destructive",icon:Dl,label:"Failed"},created:{variant:"secondary",icon:Pi,label:"Created"},active:{variant:"default",icon:Ho,label:"Active"},cancelled:{variant:"secondary",icon:Dl,label:"Cancelled"},expired:{variant:"outline",icon:Dl,label:"Expired"},pending:{variant:"secondary",icon:Pi,label:"Pending"},halted:{variant:"destructive",icon:Ld,label:"Halted"},completed:{variant:"outline",icon:Ho,label:"Completed"},admin:{variant:"secondary",icon:Ho,label:"Admin"}}[W==null?void 0:W.toLowerCase()]||{variant:"outline",icon:Pi,label:W||"Unknown"},K=U.icon;return i.jsxs(rn,{variant:U.variant,className:"gap-1",children:[i.jsx(K,{className:"w-3 h-3"}),U.label]})},$=W=>i.jsx(rn,{variant:W==="annually"?"default":"secondary",children:W==="annually"?"Annual":"Monthly"}),L=F.filter(W=>{var K,ce,ne,te,Te;const O=((K=W.user_name)==null?void 0:K.toLowerCase().includes(h.toLowerCase()))||((ce=W.user_email)==null?void 0:ce.toLowerCase().includes(h.toLowerCase()))||((ne=W.user_phone)==null?void 0:ne.includes(h))||((te=W.latest.razorpay_payment_id)==null?void 0:te.toLowerCase().includes(h.toLowerCase()))||((Te=W.latest.razorpay_order_id)==null?void 0:Te.toLowerCase().includes(h.toLowerCase())),U=m==="all"||W.latest.status===m;return O&&U}),M=B.filter(W=>{var ce,ne,te,Te;const O=((ce=W.user_name)==null?void 0:ce.toLowerCase().includes(h.toLowerCase()))||((ne=W.user_email)==null?void 0:ne.toLowerCase().includes(h.toLowerCase()))||((te=W.user_phone)==null?void 0:te.includes(h))||((Te=W.latest.razorpay_subscription_id)==null?void 0:Te.toLowerCase().includes(h.toLowerCase())),U=m==="all"||W.latest.status===m,K=g==="all"||W.latest.plan_type===g;return O&&U&&K}),X=W=>{b(W),w(null),C(!0)},G=W=>{w(W),b(null),C(!0)};return T&&_.length===0&&I.length===0?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[i.jsx(rl,{className:"w-5 h-5"}),"Transactions"]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>j(),disabled:A,children:[A?i.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(Nh,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),i.jsxs(fY,{value:d,onValueChange:u,className:"w-full",children:[i.jsxs(VR,{children:[i.jsxs(_i,{value:"payments",children:["Payments (",L.length," users)"]}),i.jsxs(_i,{value:"subscriptions",children:["Subscriptions (",M.length," users)"]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 my-4 flex-wrap",children:[i.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(At,{placeholder:"Search by user, email, phone, or transaction ID...",value:h,onChange:W=>p(W.target.value),className:"pl-9"})]}),i.jsxs($i,{value:m,onValueChange:f,children:[i.jsx(ai,{className:"w-full sm:w-40",children:i.jsx(Fi,{placeholder:"Status"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Status"}),i.jsx(Ut,{value:"captured",children:"Captured"}),i.jsx(Ut,{value:"failed",children:"Failed"}),i.jsx(Ut,{value:"created",children:"Created"}),i.jsx(Ut,{value:"active",children:"Active"}),i.jsx(Ut,{value:"cancelled",children:"Cancelled"}),i.jsx(Ut,{value:"expired",children:"Expired"}),i.jsx(Ut,{value:"pending",children:"Pending"}),i.jsx(Ut,{value:"halted",children:"Halted"})]})]}),d==="subscriptions"&&i.jsxs($i,{value:g,onValueChange:x,children:[i.jsx(ai,{className:"w-full sm:w-40",children:i.jsx(Fi,{placeholder:"Plan Type"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Plans"}),i.jsx(Ut,{value:"monthly",children:"Monthly"}),i.jsx(Ut,{value:"annually",children:"Annual"})]})]})]}),i.jsx(ji,{value:"payments",className:"mt-4",children:i.jsx("div",{className:"border rounded-lg overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{className:"min-w-[150px]",children:"User"}),i.jsx(Ot,{children:"Latest Payment"}),i.jsx(Ot,{children:"Amount"}),i.jsx(Ot,{children:"Status"}),i.jsx(Ot,{children:"Total Paid"}),i.jsx(Ot,{children:"History"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsxs(Kl,{children:[L.map(W=>i.jsxs(Br,{children:[i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"font-medium text-sm",children:W.user_name}),i.jsx("p",{className:"text-xs text-muted-foreground",children:W.user_email}),W.user_phone&&i.jsx("p",{className:"text-xs text-muted-foreground",children:W.user_phone})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"text-sm",children:Ht(new Date(W.latest.created_at),"dd MMM yyyy")}),i.jsx("p",{className:"text-xs text-muted-foreground",children:Ht(new Date(W.latest.created_at),"HH:mm:ss")}),W.latest.razorpay_payment_id&&i.jsxs("p",{className:"font-mono text-xs text-muted-foreground",children:[W.latest.razorpay_payment_id.slice(0,15),"..."]})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsxs("p",{className:"font-semibold",children:["",W.latest.amount.toFixed(2)]}),i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:W.latest.method||"N/A"})]})}),i.jsx(Et,{children:q(W.latest.status)}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsxs("p",{className:"font-semibold text-primary",children:["",W.totalAmount.toFixed(2)]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[W.paymentCount," payment(s)"]})]})}),i.jsx(Et,{children:i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[i.jsx(ny,{className:"w-3 h-3"}),W.paymentCount]})}),i.jsx(Et,{children:i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>X(W),children:[i.jsx(Xm,{className:"w-4 h-4 mr-1"}),"View All"]})})]},W.user_id)),L.length===0&&i.jsx(Br,{children:i.jsx(Et,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No payments found"})})]})]})})})}),i.jsx(ji,{value:"subscriptions",className:"mt-4",children:i.jsx("div",{className:"border rounded-lg overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{className:"min-w-[150px]",children:"User"}),i.jsx(Ot,{children:"Current Plan"}),i.jsx(Ot,{children:"Status"}),i.jsx(Ot,{children:"Dates"}),i.jsx(Ot,{children:"Auto-Renew"}),i.jsx(Ot,{children:"History"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsxs(Kl,{children:[M.map(W=>i.jsxs(Br,{children:[i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"font-medium text-sm",children:W.user_name}),i.jsx("p",{className:"text-xs text-muted-foreground",children:W.user_email}),W.user_phone&&i.jsx("p",{className:"text-xs text-muted-foreground",children:W.user_phone})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[$(W.latest.plan_type),i.jsxs("p",{className:"font-semibold",children:["",W.latest.amount.toFixed(2)]})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[q(W.latest.status),q(W.latest.payment_status||"pending")]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1 text-xs",children:[i.jsxs("div",{children:[i.jsx(Bl,{className:"w-3 h-3 inline mr-1"}),i.jsx("span",{className:"text-muted-foreground",children:"Start:"})," ",Ht(new Date(W.latest.start_date),"dd MMM yyyy")]}),i.jsxs("div",{children:[i.jsx(Bl,{className:"w-3 h-3 inline mr-1"}),i.jsx("span",{className:"text-muted-foreground",children:"End:"})," ",Ht(new Date(W.latest.end_date),"dd MMM yyyy")]}),W.latest.cancelled_at&&i.jsxs("div",{className:"text-destructive",children:[i.jsx(Dl,{className:"w-3 h-3 inline mr-1"}),"Cancelled: ",Ht(new Date(W.latest.cancelled_at),"dd MMM")]})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[W.latest.auto_renew?i.jsxs(rn,{variant:"default",className:"gap-1",children:[i.jsx(Ho,{className:"w-3 h-3"}),"Yes"]}):i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[i.jsx(Dl,{className:"w-3 h-3"}),"No"]}),W.latest.mandate_created&&i.jsx("p",{className:"text-xs text-muted-foreground",children:"E-mandate"})]})}),i.jsx(Et,{children:i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[i.jsx(ny,{className:"w-3 h-3"}),W.subscriptionCount]})}),i.jsx(Et,{children:i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>G(W),children:[i.jsx(Xm,{className:"w-4 h-4 mr-1"}),"View All"]})})]},W.user_id)),M.length===0&&i.jsx(Br,{children:i.jsx(Et,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No subscriptions found"})})]})]})})})})]}),i.jsx(vn,{open:k,onOpenChange:C,children:i.jsxs(mn,{className:"w-[calc(100%-2rem)] max-w-4xl max-h-[85dvh] sm:max-h-[85vh] overflow-hidden flex flex-col p-4 sm:p-6",children:[i.jsxs(wn,{className:"flex-shrink-0",children:[i.jsxs(Nn,{className:"flex items-center gap-2 text-base sm:text-lg",children:[i.jsx(ny,{className:"w-4 h-4 sm:w-5 sm:h-5"}),y?"Payment History":"Subscription History"]}),i.jsxs(Xd,{className:"text-xs sm:text-sm",children:[y&&i.jsxs("span",{className:"break-words",children:[y.user_name," (",y.user_email,") -",y.paymentCount," payments, Total: ",y.totalAmount.toFixed(2)]}),v&&i.jsxs("span",{className:"break-words",children:[v.user_name," (",v.user_email,") -",v.subscriptionCount," subscriptions"]})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 -mx-4 px-4 sm:-mx-6 sm:px-6",children:[y&&i.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-4",children:[(()=>{const W=y.history.find(K=>K.status==="captured"),O=y.latest,U=W||O;return U&&i.jsxs("div",{className:"border-2 border-primary rounded-lg p-3 sm:p-4 bg-primary/5",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx(rn,{variant:"default",className:"bg-primary text-xs",children:W?" Latest Successful":"Latest"}),q(U.status),i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:U.method||"N/A"})]}),i.jsxs("p",{className:"font-bold text-lg sm:text-xl text-primary",children:["",U.amount.toFixed(2)]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 text-xs sm:text-sm",children:[i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Date & Time"}),i.jsx("p",{className:"font-medium text-xs sm:text-sm",children:Ht(new Date(U.created_at),"dd MMM yyyy HH:mm")})]}),U.razorpay_payment_id&&i.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Payment ID"}),i.jsx("p",{className:"font-mono text-xs break-all",children:U.razorpay_payment_id})]}),U.razorpay_order_id&&i.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Order ID"}),i.jsx("p",{className:"font-mono text-xs break-all",children:U.razorpay_order_id})]}),U.error_code&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-destructive text-xs",children:"Error"}),i.jsxs("p",{className:"text-xs bg-destructive/10 p-2 rounded break-words",children:[U.error_code,": ",U.error_description]})]})]})]})})(),y.history.length>1&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(vd,{className:"flex-1"}),i.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium whitespace-nowrap",children:["All Transactions (",y.history.length,")"]}),i.jsx(vd,{className:"flex-1"})]}),i.jsx("div",{className:"space-y-2 sm:space-y-3",children:y.history.map((W,O)=>i.jsxs("div",{className:"border rounded-lg p-2.5 sm:p-3 bg-muted/30",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsxs(rn,{variant:"outline",className:"text-xs",children:["#",y.history.length-O]}),q(W.status),i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:W.method||"N/A"})]}),i.jsxs("p",{className:"font-semibold text-sm",children:["",W.amount.toFixed(2)]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1.5 sm:gap-2 text-xs",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(W.created_at),"dd MMM yyyy HH:mm")})]}),W.razorpay_payment_id&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Pay ID:"})," ",i.jsx("span",{className:"font-mono text-xs break-all",children:W.razorpay_payment_id})]}),W.razorpay_order_id&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Order:"})," ",i.jsx("span",{className:"font-mono text-xs break-all",children:W.razorpay_order_id})]}),W.error_code&&i.jsxs("div",{className:"col-span-full text-destructive break-words",children:[i.jsx("span",{className:"font-medium",children:"Error:"})," ",W.error_code," - ",W.error_description]})]})]},W.id))})]})]}),v&&i.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-4",children:[(()=>{const W=v.history.find(K=>K.status==="active"&&K.payment_status==="captured"),O=v.latest,U=W||O;return U&&i.jsxs("div",{className:"border-2 border-primary rounded-lg p-3 sm:p-4 bg-primary/5",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx(rn,{variant:"default",className:"bg-primary text-xs",children:W?" Active Subscription":"Current"}),$(U.plan_type),q(U.status)]}),i.jsxs("p",{className:"font-bold text-lg sm:text-xl text-primary",children:["",U.amount.toFixed(2)]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 text-xs sm:text-sm",children:[i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Start Date"}),i.jsx("p",{className:"font-medium text-xs sm:text-sm",children:Ht(new Date(U.start_date),"dd MMM yyyy")})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"End Date"}),i.jsx("p",{className:"font-medium text-xs sm:text-sm",children:Ht(new Date(U.end_date),"dd MMM yyyy")})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Payment Status"}),q(U.payment_status||"pending")]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Auto-Renew"}),i.jsx("p",{className:"font-medium",children:U.auto_renew?"Yes":"No"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"E-Mandate"}),i.jsx("p",{className:"font-medium",children:U.mandate_created?"Active":"Not Set"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Created"}),i.jsx("p",{className:"font-medium text-xs",children:Ht(new Date(U.created_at),"dd MMM yyyy HH:mm")})]}),U.razorpay_subscription_id&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Razorpay Sub ID"}),i.jsx("p",{className:"font-mono text-xs bg-muted p-2 rounded break-all",children:U.razorpay_subscription_id})]}),U.cancelled_at&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-destructive text-xs",children:"Cancelled"}),i.jsxs("p",{className:"text-xs bg-destructive/10 p-2 rounded break-words",children:[Ht(new Date(U.cancelled_at),"dd MMM yyyy HH:mm"),U.cancellation_reason&&` - ${U.cancellation_reason}`]})]})]})]})})(),v.history.length>1&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(vd,{className:"flex-1"}),i.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium whitespace-nowrap",children:["All Subscriptions (",v.history.length,")"]}),i.jsx(vd,{className:"flex-1"})]}),i.jsx("div",{className:"space-y-2 sm:space-y-3",children:v.history.map((W,O)=>i.jsxs("div",{className:"border rounded-lg p-2.5 sm:p-3 bg-muted/30",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsxs(rn,{variant:"outline",className:"text-xs",children:["#",v.history.length-O]}),$(W.plan_type),q(W.status)]}),i.jsxs("p",{className:"font-semibold text-sm",children:["",W.amount.toFixed(2)]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 text-xs",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Start:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(W.start_date),"dd MMM yyyy")})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"End:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(W.end_date),"dd MMM yyyy")})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",q(W.payment_status||"pending")]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Created:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(W.created_at),"dd MMM yyyy HH:mm")})]}),W.cancelled_at&&i.jsxs("div",{className:"col-span-2 text-destructive break-words",children:[i.jsx("span",{className:"font-medium",children:"Cancelled:"})," ",Ht(new Date(W.cancelled_at),"dd MMM yyyy"),W.cancellation_reason&&` - ${W.cancellation_reason}`]})]})]},W.id))})]})]})]}),i.jsx(su,{className:"flex-shrink-0 mt-4 pt-4 border-t",children:i.jsx(de,{variant:"outline",onClick:()=>C(!1),className:"w-full sm:w-auto",children:"Close"})})]})})]})}function VKe(){const{isAdmin:e}=Wu(),{data:t=[],isLoading:n,isFetching:r,refetch:a}=MKe(),[s,o]=N.useState(""),[l,c]=N.useState("all"),[d,u]=N.useState("all"),[h,p]=N.useState(null),[m,f]=N.useState(!1),[g,x]=N.useState(null),[y,b]=N.useState(!1),[v,w]=N.useState(""),[k,C]=N.useState(!1),S=N.useRef(null),_=N.useMemo(()=>t.filter(M=>M.product_type==="pvc"||M.product_type==="metal"),[t]),I=N.useCallback(()=>{S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{a()},300)},[a]);N.useEffect(()=>{if(!e)return;const M=ue.channel("admin-nfc-orders").on("postgres_changes",{event:"*",schema:"public",table:"orders"},()=>I()).subscribe();return()=>{S.current&&window.clearTimeout(S.current),ue.removeChannel(M)}},[e,I]);const T=["paid","processing","shipped","delivered","placed","dispatched"],A=N.useMemo(()=>_.filter(M=>T.includes(M.status.toLowerCase())),[_]),j=N.useMemo(()=>{const M=new Map;A.forEach(G=>{const W=M.get(G.user_id)||[];M.set(G.user_id,[...W,G])});const X=[];return M.forEach((G,W)=>{const O=G.sort((K,ce)=>new Date(ce.created_at).getTime()-new Date(K.created_at).getTime()),U=O[0];X.push({user_id:W,user_name:U.user_name||"Unknown",user_email:U.user_email||"",user_phone:U.user_phone||"",latest:U,history:O,totalAmount:G.reduce((K,ce)=>K+ce.amount,0),orderCount:G.length,totalQuantity:G.reduce((K,ce)=>K+ce.quantity,0)})}),X.sort((G,W)=>new Date(W.latest.created_at).getTime()-new Date(G.latest.created_at).getTime())},[A]),D=async()=>{if(g){C(!0);try{const{error:M}=await ue.from("orders").update({status:v,updated_at:new Date().toISOString()}).eq("id",g.id);if(M)throw M;It.success("Order status updated successfully"),b(!1),a()}catch(M){console.error("Error updating order:",M),It.error("Failed to update order status")}finally{C(!1)}}},F=M=>{const G={pending:{variant:"secondary",icon:Pi,label:"Pending"},paid:{variant:"default",icon:Ho,label:"Paid"},placed:{variant:"default",icon:Ho,label:"Placed"},processing:{variant:"secondary",icon:Gt,label:"Processing"},shipped:{variant:"default",icon:d2,label:"Shipped"},dispatched:{variant:"default",icon:d2,label:"Dispatched"},delivered:{variant:"default",icon:Ho,label:"Delivered"},cancelled:{variant:"destructive",icon:Dl,label:"Cancelled"},payment_failed:{variant:"destructive",icon:Ld,label:"Payment Failed"},failed:{variant:"destructive",icon:Dl,label:"Failed"}}[M==null?void 0:M.toLowerCase()]||{variant:"outline",icon:Pi,label:M||"Unknown"},W=G.icon;return i.jsxs(rn,{variant:G.variant,className:"gap-1",children:[i.jsx(W,{className:`w-3 h-3 ${M==="processing"?"animate-spin":""}`}),G.label]})},B=M=>i.jsx(rn,{variant:M==="metal"?"default":"secondary",children:M==="metal"?"Metal":"PVC"}),q=j.filter(M=>{var O,U,K,ce,ne;const X=((O=M.user_name)==null?void 0:O.toLowerCase().includes(s.toLowerCase()))||((U=M.user_email)==null?void 0:U.toLowerCase().includes(s.toLowerCase()))||((K=M.user_phone)==null?void 0:K.includes(s))||((ce=M.latest.order_number)==null?void 0:ce.toLowerCase().includes(s.toLowerCase()))||((ne=M.latest.razorpay_order_id)==null?void 0:ne.toLowerCase().includes(s.toLowerCase())),G=l==="all"||M.latest.status===l,W=d==="all"||M.latest.product_type===d;return X&&G&&W}),$=M=>{p(M),f(!0)},L=M=>{x(M),w(M.status),b(!0)};return n&&_.length===0?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[i.jsx(ry,{className:"w-5 h-5"}),"NFC Card Orders (",q.length," users)"]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>a(),disabled:r,children:[r?i.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(Nh,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-wrap",children:[i.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(At,{placeholder:"Search by user, order number, or phone...",value:s,onChange:M=>o(M.target.value),className:"pl-9"})]}),i.jsxs($i,{value:d,onValueChange:u,children:[i.jsx(ai,{className:"w-full sm:w-32",children:i.jsx(Fi,{placeholder:"Type"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Types"}),i.jsx(Ut,{value:"pvc",children:"PVC"}),i.jsx(Ut,{value:"metal",children:"Metal"})]})]}),i.jsxs($i,{value:l,onValueChange:c,children:[i.jsx(ai,{className:"w-full sm:w-40",children:i.jsx(Fi,{placeholder:"Status"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Status"}),i.jsx(Ut,{value:"paid",children:"Paid"}),i.jsx(Ut,{value:"placed",children:"Placed"}),i.jsx(Ut,{value:"processing",children:"Processing"}),i.jsx(Ut,{value:"shipped",children:"Shipped"}),i.jsx(Ut,{value:"dispatched",children:"Dispatched"}),i.jsx(Ut,{value:"delivered",children:"Delivered"})]})]})]}),i.jsx("div",{className:"border rounded-lg overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{className:"min-w-[150px]",children:"User"}),i.jsx(Ot,{children:"Latest Order"}),i.jsx(Ot,{children:"Type"}),i.jsx(Ot,{children:"Status"}),i.jsx(Ot,{children:"Total Orders"}),i.jsx(Ot,{children:"Total Spent"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsxs(Kl,{children:[q.map(M=>i.jsxs(Br,{children:[i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"font-medium text-sm",children:M.user_name}),i.jsx("p",{className:"text-xs text-muted-foreground",children:M.user_email}),M.user_phone&&i.jsx("p",{className:"text-xs text-muted-foreground",children:M.user_phone})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"font-mono text-sm font-medium",children:M.latest.order_number||"-"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:Ht(new Date(M.latest.created_at),"dd MMM yyyy HH:mm")}),M.latest.card_variant&&i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:M.latest.card_variant})]})}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[B(M.latest.product_type),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",M.latest.quantity]})]})}),i.jsx(Et,{children:F(M.latest.status)}),i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[i.jsx(ny,{className:"w-3 h-3"}),M.orderCount," order(s)"]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[M.totalQuantity," cards total"]})]})}),i.jsx(Et,{children:i.jsxs("p",{className:"font-semibold text-primary",children:["",M.totalAmount.toFixed(2)]})}),i.jsx(Et,{children:i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>$(M),children:[i.jsx(Xm,{className:"w-4 h-4 mr-1"}),"View All"]})})]},M.user_id)),q.length===0&&i.jsx(Br,{children:i.jsx(Et,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No orders found"})})]})]})})}),i.jsx(vn,{open:m,onOpenChange:f,children:i.jsxs(mn,{className:"w-[calc(100%-2rem)] max-w-4xl max-h-[85dvh] sm:max-h-[85vh] overflow-hidden flex flex-col p-4 sm:p-6",children:[i.jsxs(wn,{className:"flex-shrink-0",children:[i.jsxs(Nn,{className:"flex items-center gap-2 text-base sm:text-lg",children:[i.jsx(ny,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Order History"]}),i.jsx(Xd,{className:"text-xs sm:text-sm",children:h&&i.jsxs("span",{className:"break-words",children:[h.user_name," (",h.user_email,") -",h.orderCount," orders, ",h.totalQuantity," cards, Total: ",h.totalAmount.toFixed(2)]})})]}),i.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 -mx-4 px-4 sm:-mx-6 sm:px-6",children:h&&i.jsxs("div",{className:"space-y-4 sm:space-y-6 pb-4",children:[(()=>{const M=h.latest;return M&&i.jsxs("div",{className:"border-2 border-primary rounded-lg p-3 sm:p-4 bg-primary/5",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsx(rn,{variant:"default",className:"bg-primary text-xs",children:" Latest Order"}),B(M.product_type),F(M.status),M.card_variant&&i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:M.card_variant})]}),i.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2",children:[i.jsxs("p",{className:"font-bold text-lg sm:text-xl text-primary",children:["",M.amount.toFixed(2)]}),i.jsxs(de,{variant:"default",size:"sm",onClick:()=>L(M),className:"text-xs sm:text-sm",children:[i.jsx(ay,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1"}),"Update Status"]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:gap-3 text-xs sm:text-sm",children:[i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Order Number"}),i.jsx("p",{className:"font-mono font-medium text-xs sm:text-sm break-all",children:M.order_number||"N/A"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Date & Time"}),i.jsx("p",{className:"font-medium text-xs sm:text-sm",children:Ht(new Date(M.created_at),"dd MMM yyyy HH:mm")})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Quantity"}),i.jsx("p",{className:"font-semibold",children:M.quantity})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Updated"}),i.jsx("p",{className:"text-xs",children:Ht(new Date(M.updated_at),"dd MMM yyyy HH:mm")})]}),M.razorpay_order_id&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Razorpay Order ID"}),i.jsx("p",{className:"font-mono text-xs break-all",children:M.razorpay_order_id})]}),M.razorpay_payment_id&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Razorpay Payment ID"}),i.jsx("p",{className:"font-mono text-xs break-all",children:M.razorpay_payment_id})]}),M.notes&&Object.keys(M.notes).length>0&&i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-muted-foreground text-xs",children:"Notes"}),i.jsx("div",{className:"bg-muted p-2 rounded text-xs mt-1 overflow-x-auto",children:i.jsx("pre",{className:"whitespace-pre-wrap text-xs",children:JSON.stringify(M.notes,null,2)})})]})]})]})})(),h.history.length>1&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(vd,{className:"flex-1"}),i.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground font-medium whitespace-nowrap",children:["All Orders (",h.history.length,")"]}),i.jsx(vd,{className:"flex-1"})]}),i.jsx("div",{className:"space-y-2 sm:space-y-3",children:h.history.map((M,X)=>i.jsxs("div",{className:"border rounded-lg p-2.5 sm:p-3 bg-muted/30",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[i.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap",children:[i.jsxs(rn,{variant:"outline",className:"text-xs",children:["#",h.history.length-X]}),B(M.product_type),F(M.status),M.card_variant&&i.jsx(rn,{variant:"outline",className:"capitalize text-xs",children:M.card_variant})]}),i.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-2",children:[i.jsxs("p",{className:"font-semibold text-sm",children:["",M.amount.toFixed(2)]}),i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>L(M),className:"h-7 px-2",children:i.jsx(ay,{className:"w-3 h-3"})})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-1.5 sm:gap-2 text-xs",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Order:"})," ",i.jsx("span",{className:"font-mono font-medium break-all",children:M.order_number||"N/A"})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Date:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(M.created_at),"dd MMM yyyy HH:mm")})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Qty:"})," ",i.jsx("span",{className:"font-semibold",children:M.quantity})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Updated:"})," ",i.jsx("span",{className:"font-medium",children:Ht(new Date(M.updated_at),"dd MMM yyyy HH:mm")})]})]})]},M.id))})]})]})}),i.jsx(su,{className:"flex-shrink-0 mt-4 pt-4 border-t",children:i.jsx(de,{variant:"outline",onClick:()=>f(!1),className:"w-full sm:w-auto",children:"Close"})})]})}),i.jsx(vn,{open:y,onOpenChange:b,children:i.jsxs(mn,{className:"w-[calc(100%-2rem)] max-w-md p-4 sm:p-6",children:[i.jsxs(wn,{children:[i.jsx(Nn,{className:"text-base sm:text-lg",children:"Update Order Status"}),i.jsxs(Xd,{className:"text-xs sm:text-sm",children:["Change the status of order ",(g==null?void 0:g.order_number)||"N/A"]})]}),i.jsxs("div",{className:"space-y-4 py-2",children:[i.jsxs("div",{children:[i.jsx(We,{className:"text-sm",children:"Current Status"}),i.jsx("div",{className:"mt-2",children:g&&F(g.status)})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-sm",children:"New Status"}),i.jsxs($i,{value:v,onValueChange:w,children:[i.jsx(ai,{className:"mt-2",children:i.jsx(Fi,{placeholder:"Select status",children:v&&i.jsx("span",{className:"capitalize",children:v})})}),i.jsxs(si,{position:"popper",sideOffset:4,className:"z-[2100]",children:[i.jsx(Ut,{value:"paid",children:"Paid"}),i.jsx(Ut,{value:"placed",children:"Placed"}),i.jsx(Ut,{value:"processing",children:"Processing"}),i.jsx(Ut,{value:"dispatched",children:"Dispatched"}),i.jsx(Ut,{value:"shipped",children:"Shipped"}),i.jsx(Ut,{value:"delivered",children:"Delivered"}),i.jsx(Ut,{value:"cancelled",children:"Cancelled"})]})]})]})]}),i.jsxs(su,{className:"flex-col sm:flex-row gap-2 pt-4",children:[i.jsx(de,{variant:"outline",onClick:()=>b(!1),disabled:k,className:"w-full sm:w-auto order-2 sm:order-1",children:"Cancel"}),i.jsx(de,{onClick:D,disabled:k||!v||v===(g==null?void 0:g.status),className:"w-full sm:w-auto order-1 sm:order-2",children:k?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):"Update Status"})]})]})})]})}const HKe=(e,t="dd/MM/yyyy hh:mm a")=>(typeof e=="string"?new Date(e):e).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0});function GKe(){const{isAdmin:e,loading:t,stats:n,fetchStats:r,users:a,orders:s}=J_(),[o,l]=N.useState(!0),[c,d]=N.useState(),[u,h]=N.useState({monthlyActive:0,monthlyRevenue:0,annualActive:0,annualRevenue:0,totalSubscriptions:0});N.useEffect(()=>{if(t)return;if(!e){l(!1);return}(async()=>{l(!0),await r(c==null?void 0:c.from,c==null?void 0:c.to);let y=ue.from("subscriptions").select("*");c!=null&&c.from&&(y=y.gte("created_at",c.from.toISOString())),c!=null&&c.to&&(y=y.lte("created_at",c.to.toISOString()));const{data:b}=await y;if(b){const v=b.filter(C=>C.payment_status==="paid"),w=v.filter(C=>C.plan_type==="monthly"),k=v.filter(C=>C.plan_type==="annually");h({monthlyActive:w.filter(C=>C.status==="active").length,monthlyRevenue:w.reduce((C,S)=>C+Number(S.amount),0),annualActive:k.filter(C=>C.status==="active").length,annualRevenue:k.reduce((C,S)=>C+Number(S.amount),0),totalSubscriptions:v.length})}l(!1)})()},[t,e,r,c]);const p=()=>{const x=[["Name","Email","Mobile","Plan","Signup Date (IST)"],...a.map(w=>[w.full_name||"",w.email||"",w.phone||"",w.plan,HKe(w.created_at)])].map(w=>w.join(",")).join(`
`),y=new Blob([x],{type:"text/csv"}),b=URL.createObjectURL(y),v=document.createElement("a");v.href=b,v.download=`synka-users-${Ht(new Date,"yyyy-MM-dd")}.csv`,v.click(),URL.revokeObjectURL(b)},m=s.filter(x=>x.status==="payment_success"||x.status==="placed"||x.status==="dispatched"||x.status==="delivered"),f=m.filter(x=>x.product_type==="orange_monthly"||x.product_type==="orange_upgrade"&&x.billing_cycle==="monthly"),g=m.filter(x=>x.product_type==="orange_annually"||x.product_type==="orange_annual"||x.product_type==="orange_upgrade"&&x.billing_cycle!=="monthly");return o?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(dC,{children:[i.jsx(hC,{asChild:!0,children:i.jsxs(de,{variant:"outline",className:"w-[280px] justify-start text-left font-normal",children:[i.jsx(Bl,{className:"mr-2 h-4 w-4"}),c!=null&&c.from?c.to?i.jsxs(i.Fragment,{children:[Ht(c.from,"LLL dd, y")," - ",Ht(c.to,"LLL dd, y")]}):Ht(c.from,"LLL dd, y"):i.jsx("span",{children:"All time"})]})}),i.jsx(S0,{className:"w-auto p-0",align:"start",children:i.jsx(j0,{initialFocus:!0,mode:"range",defaultMonth:c==null?void 0:c.from,selected:c,onSelect:d,numberOfMonths:2})})]}),i.jsxs(de,{onClick:p,children:[i.jsx(Od,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"User Statistics"}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Total Users"}),i.jsx(eu,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold",children:n.totalUsers})})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Free Users"}),i.jsx(eu,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold",children:n.freeUsers})})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Orange Users"}),i.jsx(rl,{className:"h-4 w-4 text-orange-500"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold text-orange-500",children:n.orangeUsers})})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Total Revenue"}),i.jsx(kk,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsxs("div",{className:"text-2xl font-bold",children:["",n.totalRevenue.toLocaleString("en-IN")]})})]})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Orange Subscription Statistics"}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[i.jsxs(Tn,{className:"border-orange-200 dark:border-orange-800",children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Monthly Active"}),i.jsx(i2,{className:"h-4 w-4 text-orange-500"})]}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold text-orange-500",children:u.monthlyActive}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[f.length," paid orders"]})]})]}),i.jsxs(Tn,{className:"border-orange-200 dark:border-orange-800",children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Monthly Revenue"}),i.jsx(kk,{className:"h-4 w-4 text-orange-500"})]}),i.jsxs(Dn,{children:[i.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:["",u.monthlyRevenue.toLocaleString("en-IN")]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"recurring/month"})]})]}),i.jsxs(Tn,{className:"border-orange-200 dark:border-orange-800",children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Annual Active"}),i.jsx(Bl,{className:"h-4 w-4 text-orange-500"})]}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold text-orange-500",children:u.annualActive}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[g.length," paid orders"]})]})]}),i.jsxs(Tn,{className:"border-orange-200 dark:border-orange-800",children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Annual Revenue"}),i.jsx(kk,{className:"h-4 w-4 text-orange-500"})]}),i.jsxs(Dn,{children:[i.jsxs("div",{className:"text-2xl font-bold text-orange-500",children:["",u.annualRevenue.toLocaleString("en-IN")]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"recurring/year"})]})]})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Card Order Statistics (Paid Only)"}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Total Paid Card Orders"}),i.jsx(ry,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold",children:n.pvcOrders+n.metalOrders})})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"PVC Orders"}),i.jsx(ry,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold",children:n.pvcOrders})})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Jn,{className:"text-sm font-medium",children:"Metal Orders"}),i.jsx(ry,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsx(Dn,{children:i.jsx("div",{className:"text-2xl font-bold",children:n.metalOrders})})]})]})]})]})}function qKe(){const[e,t]=N.useState([]),[n,r]=N.useState(!0),[a,s]=N.useState(""),[o,l]=N.useState(null),[c,d]=N.useState(!1),[u,h]=N.useState(null),[p,m]=N.useState(!1),f=N.useRef(null);N.useEffect(()=>{x();const k=ue.channel("admin-deleted-users").on("postgres_changes",{event:"*",schema:"public",table:"deleted_users"},()=>g()).subscribe();return()=>{f.current&&window.clearTimeout(f.current),ue.removeChannel(k)}},[]);const g=()=>{f.current&&window.clearTimeout(f.current),f.current=window.setTimeout(()=>{x()},300)},x=async()=>{r(!0);try{const{data:k,error:C}=await ue.from("deleted_users").select("*").order("deleted_at",{ascending:!1});if(C)throw C;const S=await Promise.all((k||[]).map(async _=>{const[I,T,A,j]=await Promise.all([ue.from("cards").select("id",{count:"exact",head:!0}).eq("user_id",_.user_id),ue.from("contacts").select("id",{count:"exact",head:!0}).eq("owner_id",_.user_id),ue.from("orders").select("id",{count:"exact",head:!0}).eq("user_id",_.user_id),ue.from("subscriptions").select("id",{count:"exact",head:!0}).eq("user_id",_.user_id)]);return{..._,total_cards:I.count||0,total_contacts:T.count||0,total_orders:A.count||0,total_subscriptions:j.count||0}}));t(S)}catch(k){console.error("Error fetching deleted users:",k),It.error("Failed to fetch deleted users")}finally{r(!1)}},y=async k=>{m(!0);try{const[C,S,_,I,T]=await Promise.all([ue.from("cards").select("*").eq("user_id",k).order("created_at",{ascending:!1}),ue.from("contacts").select("*").eq("owner_id",k).order("created_at",{ascending:!1}).limit(10),ue.from("orders").select("*").eq("user_id",k).order("created_at",{ascending:!1}),ue.from("subscriptions").select("*").eq("user_id",k).order("created_at",{ascending:!1}),ue.from("payments").select("*").eq("user_id",k).order("created_at",{ascending:!1}).limit(10)]);h({cards:C.data||[],contacts:S.data||[],orders:_.data||[],subscriptions:I.data||[],payments:T.data||[]})}catch(C){console.error("Error fetching user details:",C),It.error("Failed to fetch user details")}finally{m(!1)}},b=async k=>{l(k),h(null),d(!0),await y(k.user_id)},v=e.filter(k=>{var S,_,I;return((S=k.name)==null?void 0:S.toLowerCase().includes(a.toLowerCase()))||((_=k.email)==null?void 0:_.toLowerCase().includes(a.toLowerCase()))||((I=k.user_id)==null?void 0:I.toLowerCase().includes(a.toLowerCase()))}),w=(k,C)=>k?`${Math.floor((new Date(C).getTime()-new Date(k).getTime())/(1e3*60*60*24))} days`:"Unknown";return n&&e.length===0?i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[i.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[i.jsx(h2,{className:"w-5 h-5"}),"Deleted Users (",v.length,")"]}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>x(),disabled:n,children:[n?i.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}):i.jsx(Nh,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),i.jsxs("div",{className:"relative",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),i.jsx(At,{placeholder:"Search by name, email, or user ID...",value:a,onChange:k=>s(k.target.value),className:"pl-9"})]}),i.jsx("div",{className:"border rounded-lg overflow-hidden",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{className:"min-w-[150px]",children:"User"}),i.jsx(Ot,{children:"Account Age"}),i.jsx(Ot,{children:"Data Summary"}),i.jsx(Ot,{children:"Signup Date"}),i.jsx(Ot,{children:"Deleted Date"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsxs(Kl,{children:[v.map(k=>i.jsxs(Br,{children:[i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsx("p",{className:"font-medium text-sm",children:k.name||"Unknown"}),k.email&&i.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[i.jsx(Di,{className:"w-3 h-3"}),k.email]})]})}),i.jsx(Et,{children:i.jsx("div",{className:"text-sm",children:i.jsx("p",{className:"font-medium",children:w(k.created_at,k.deleted_at)})})}),i.jsx(Et,{children:i.jsxs("div",{className:"text-xs space-y-1",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:k.total_cards})," ","cards"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:k.total_contacts})," ","contacts"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:k.total_orders})," ","orders"]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:k.total_subscriptions})," ","subscriptions"]})]})}),i.jsx(Et,{children:i.jsx("div",{className:"text-sm",children:i.jsxs("p",{className:"flex items-center gap-1 text-muted-foreground",children:[i.jsx(Bl,{className:"w-3 h-3"}),k.created_at?Ht(new Date(k.created_at),"dd MMM yyyy"):"N/A"]})})}),i.jsx(Et,{children:i.jsxs("div",{className:"text-sm",children:[i.jsx("p",{children:Ht(new Date(k.deleted_at),"dd MMM yyyy")}),i.jsx("p",{className:"text-xs text-muted-foreground",children:Ht(new Date(k.deleted_at),"HH:mm:ss")})]})}),i.jsx(Et,{children:i.jsx(de,{variant:"ghost",size:"sm",onClick:()=>b(k),children:i.jsx(Xm,{className:"w-4 h-4"})})})]},k.id)),v.length===0&&i.jsx(Br,{children:i.jsx(Et,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No deleted users found"})})]})]})})}),i.jsx(vn,{open:c,onOpenChange:d,children:i.jsxs(mn,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[i.jsxs(wn,{children:[i.jsx(Nn,{children:"Deleted User Details"}),i.jsxs(Xd,{children:["Complete information for ",(o==null?void 0:o.name)||"Unknown User"]})]}),o&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsxs("h3",{className:"font-semibold mb-3 text-sm flex items-center gap-2",children:[i.jsx(Ld,{className:"w-4 h-4 text-destructive"}),"Account Information"]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground",children:"Name"}),i.jsx("p",{className:"font-medium",children:o.name||"N/A"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground",children:"Email"}),i.jsx("p",{className:"font-medium",children:o.email||"N/A"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground",children:"Created"}),i.jsx("p",{className:"font-medium",children:o.created_at?Ht(new Date(o.created_at),"dd MMM yyyy HH:mm"):"N/A"})]}),i.jsxs("div",{children:[i.jsx(We,{className:"text-muted-foreground",children:"Deleted"}),i.jsx("p",{className:"font-medium text-destructive",children:Ht(new Date(o.deleted_at),"dd MMM yyyy HH:mm")})]}),i.jsxs("div",{className:"col-span-2",children:[i.jsx(We,{className:"text-muted-foreground",children:"User ID"}),i.jsx("p",{className:"font-mono text-xs bg-muted p-2 rounded mt-1",children:o.user_id})]})]})]}),p?i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsx(Gt,{className:"w-6 h-6 animate-spin text-primary"})}):u?i.jsxs(i.Fragment,{children:[u.cards.length>0&&i.jsxs("div",{children:[i.jsxs("h3",{className:"font-semibold mb-3 text-sm",children:["Cards (",u.cards.length,")"]}),i.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.cards.map(k=>i.jsxs("div",{className:"text-xs bg-muted p-2 rounded",children:[i.jsx("p",{className:"font-medium",children:k.full_name||k.name||"Unnamed"}),i.jsxs("p",{className:"text-muted-foreground",children:[k.designation||"No designation"," at"," ",k.company||"No company"]}),i.jsxs("p",{className:"text-muted-foreground",children:["Created: ",Ht(new Date(k.created_at),"dd MMM yyyy")]})]},k.id))})]}),u.orders.length>0&&i.jsxs("div",{children:[i.jsxs("h3",{className:"font-semibold mb-3 text-sm",children:["Orders (",u.orders.length,")"]}),i.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.orders.map(k=>i.jsxs("div",{className:"text-xs bg-muted p-2 rounded",children:[i.jsx("p",{className:"font-medium font-mono",children:k.order_number||k.id.slice(0,8)}),i.jsxs("p",{className:"text-muted-foreground",children:[k.product_type," - ",k.amount," - ",k.status]}),i.jsx("p",{className:"text-muted-foreground",children:Ht(new Date(k.created_at),"dd MMM yyyy")})]},k.id))})]}),u.subscriptions.length>0&&i.jsxs("div",{children:[i.jsxs("h3",{className:"font-semibold mb-3 text-sm",children:["Subscriptions (",u.subscriptions.length,")"]}),i.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.subscriptions.map(k=>i.jsxs("div",{className:"text-xs bg-muted p-2 rounded",children:[i.jsxs("p",{className:"font-medium capitalize",children:[k.plan_type," Plan - ",k.status]}),i.jsxs("p",{className:"text-muted-foreground",children:["",k.amount," - ",k.payment_status||"N/A"]}),i.jsxs("p",{className:"text-muted-foreground",children:[Ht(new Date(k.start_date),"dd MMM yyyy")," to"," ",Ht(new Date(k.end_date),"dd MMM yyyy")]})]},k.id))})]}),u.payments.length>0&&i.jsxs("div",{children:[i.jsxs("h3",{className:"font-semibold mb-3 text-sm",children:["Recent Payments (",u.payments.length,")"]}),i.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:u.payments.map(k=>i.jsxs("div",{className:"text-xs bg-muted p-2 rounded",children:[i.jsxs("p",{className:"font-medium",children:["",k.amount," - ",k.status]}),i.jsx("p",{className:"text-muted-foreground font-mono",children:k.razorpay_payment_id||"N/A"}),i.jsx("p",{className:"text-muted-foreground",children:Ht(new Date(k.created_at),"dd MMM yyyy")})]},k.id))})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold mb-3 text-sm",children:"Contacts Summary"}),i.jsx("div",{className:"text-sm",children:i.jsxs("p",{className:"text-muted-foreground",children:["Total contacts: ",i.jsx("span",{className:"font-medium",children:o.total_contacts})]})})]}),u.cards.length===0&&u.orders.length===0&&u.subscriptions.length===0&&u.payments.length===0&&i.jsx("div",{className:"text-center py-4 text-muted-foreground",children:i.jsx("p",{children:"No associated data found for this user."})})]}):null]}),i.jsx(su,{children:i.jsx(de,{variant:"outline",onClick:()=>d(!1),children:"Close"})})]})})]})}const KKe=e=>{if(!e||e.length===0)return"No messages";const t=e.find(r=>r.role==="user");if(!t)return"No user messages";const n=t.content.slice(0,60);return n.length<t.content.length?`${n}...`:n};function YKe(){const[e,t]=N.useState(""),[n,r]=N.useState("all"),[a,s]=N.useState("all"),[o,l]=N.useState(null),[c,d]=N.useState(!1),[u,h]=N.useState({}),p=Rf(),{data:m=[],isLoading:f,refetch:g}=al({queryKey:["admin-chat-sessions"],queryFn:async()=>{const{data:T,error:A}=await ue.from("chat_sessions").select("*").order("last_message_at",{ascending:!1});if(A)throw A;return(T||[]).map(j=>({...j,work_status:j.work_status||"open"}))},refetchInterval:1e4});N.useEffect(()=>{(async()=>{if(m.length===0)return;const A=m.map(D=>D.session_id),{data:j}=await ue.from("chat_messages").select("*").in("session_id",A).order("created_at",{ascending:!0});if(j){const D={};m.forEach(F=>{const B=j.filter(q=>q.session_id===F.session_id);D[F.session_id]=KKe(B)}),h(D)}})()},[m]),N.useEffect(()=>{const T=ue.channel("admin-chat-sessions-realtime").on("postgres_changes",{event:"*",schema:"public",table:"chat_sessions"},()=>{p.invalidateQueries({queryKey:["admin-chat-sessions"]})}).subscribe();return()=>{ue.removeChannel(T)}},[p]);const{data:x=[],isLoading:y}=al({queryKey:["admin-chat-messages",o==null?void 0:o.session_id],queryFn:async()=>{if(!o)return[];const{data:T,error:A}=await ue.from("chat_messages").select("*").eq("session_id",o.session_id).order("created_at",{ascending:!0});if(A)throw A;return T},enabled:!!o}),b=Rd({mutationFn:async({sessionId:T,workStatus:A})=>{const{error:j}=await ue.from("chat_sessions").update({work_status:A}).eq("session_id",T);if(j)throw j},onSuccess:()=>{p.invalidateQueries({queryKey:["admin-chat-sessions"]}),It.success("Work status updated")},onError:()=>{It.error("Failed to update status")}}),v=m.filter(T=>{var F,B,q,$;const A=((F=T.name)==null?void 0:F.toLowerCase().includes(e.toLowerCase()))||((B=T.email)==null?void 0:B.toLowerCase().includes(e.toLowerCase()))||((q=T.mobile)==null?void 0:q.includes(e))||(($=u[T.session_id])==null?void 0:$.toLowerCase().includes(e.toLowerCase())),j=n==="all"||T.status===n,D=a==="all"||T.work_status===a;return A&&j&&D}),w=m.filter(T=>T.status==="active"),k=m.filter(T=>T.status==="timeout"||T.status==="ended"),C=T=>{switch(T){case"active":return i.jsxs(rn,{className:"bg-green-500/20 text-green-500 gap-1",children:[i.jsx(Pi,{className:"h-3 w-3"}),"Live"]});case"timeout":return i.jsx(rn,{className:"bg-yellow-500/20 text-yellow-500",children:"Timeout"});case"ended":return i.jsx(rn,{className:"bg-gray-500/20 text-gray-500",children:"Ended"});default:return i.jsx(rn,{variant:"outline",children:T})}},S=T=>{switch(T){case"open":return i.jsx(Pi,{className:"h-3 w-3"});case"assigned":return i.jsx(mD,{className:"h-3 w-3"});case"done":return i.jsx(Ho,{className:"h-3 w-3"});default:return null}},_=T=>{l(T),d(!0)},I=(T,A)=>{b.mutate({sessionId:T,workStatus:A})};return f?i.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Loading sessions..."}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(Jc,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),i.jsx(At,{placeholder:"Search by name, email, mobile, or topic...",value:e,onChange:T=>t(T.target.value),className:"pl-9"})]}),i.jsxs($i,{value:n,onValueChange:r,children:[i.jsx(ai,{className:"w-[130px]",children:i.jsx(Fi,{placeholder:"Status"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Status"}),i.jsx(Ut,{value:"active",children:"Live"}),i.jsx(Ut,{value:"timeout",children:"Timeout"}),i.jsx(Ut,{value:"ended",children:"Ended"})]})]}),i.jsxs($i,{value:a,onValueChange:s,children:[i.jsx(ai,{className:"w-[130px]",children:i.jsx(Fi,{placeholder:"Work Status"})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"all",children:"All Work"}),i.jsx(Ut,{value:"open",children:"Open"}),i.jsx(Ut,{value:"assigned",children:"Assigned"}),i.jsx(Ut,{value:"done",children:"Done"})]})]}),i.jsx(de,{variant:"outline",size:"icon",onClick:()=>g(),children:i.jsx(Nh,{className:"h-4 w-4"})})]}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("div",{className:"text-2xl font-bold",children:m.length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Sessions"})]}),i.jsxs("div",{className:"bg-green-500/10 rounded-lg p-4",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:w.length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Live Now"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("div",{className:"text-2xl font-bold",children:k.length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Ended"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("div",{className:"text-2xl font-bold",children:m.filter(T=>T.work_status==="open").length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Open to Work"})]})]}),i.jsx("div",{className:"border rounded-lg overflow-hidden",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{children:"User Info"}),i.jsx(Ot,{children:"Summary"}),i.jsx(Ot,{children:"Type"}),i.jsx(Ot,{children:"Chat Status"}),i.jsx(Ot,{children:"Work Status"}),i.jsx(Ot,{children:"Messages"}),i.jsx(Ot,{children:"Last Activity"}),i.jsx(Ot,{children:"Actions"})]})}),i.jsx(Kl,{children:v.length===0?i.jsx(Br,{children:i.jsx(Et,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No chat sessions found"})}):v.map(T=>i.jsxs(Br,{children:[i.jsx(Et,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[T.is_user?i.jsx(Ad,{className:"h-4 w-4 text-primary"}):i.jsx(h2,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:T.name||"Anonymous"})]}),T.email&&i.jsx("div",{className:"text-xs text-muted-foreground",children:T.email}),T.mobile&&i.jsx("div",{className:"text-xs text-muted-foreground",children:T.mobile})]})}),i.jsx(Et,{children:i.jsx("div",{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:u[T.session_id]||"Loading..."})}),i.jsx(Et,{children:T.is_user?i.jsxs(rn,{variant:"default",className:"gap-1",children:[i.jsx(Ad,{className:"h-3 w-3"}),"User"]}):i.jsxs(rn,{variant:"secondary",className:"gap-1",children:[i.jsx(h2,{className:"h-3 w-3"}),"Guest"]})}),i.jsx(Et,{children:C(T.status)}),i.jsx(Et,{children:i.jsxs($i,{value:T.work_status,onValueChange:A=>I(T.session_id,A),children:[i.jsx(ai,{className:"w-[110px] h-8",children:i.jsxs("div",{className:"flex items-center gap-1",children:[S(T.work_status),i.jsx(Fi,{})]})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"open",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Pi,{className:"h-3 w-3"}),"Open"]})}),i.jsx(Ut,{value:"assigned",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(mD,{className:"h-3 w-3"}),"Assigned"]})}),i.jsx(Ut,{value:"done",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ho,{className:"h-3 w-3"}),"Done"]})})]})]})}),i.jsx(Et,{children:i.jsx(rn,{variant:"outline",children:T.message_count})}),i.jsx(Et,{className:"text-sm text-muted-foreground",children:Ht(new Date(T.last_message_at),"MMM d, HH:mm")}),i.jsx(Et,{children:i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>_(T),children:[i.jsx(Xm,{className:"h-4 w-4 mr-1"}),"View"]})})]},T.id))})]})}),i.jsx(vn,{open:c,onOpenChange:d,children:i.jsxs(mn,{className:"max-w-2xl max-h-[80vh]",children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(Zm,{className:"h-5 w-5"}),"Chat with ",(o==null?void 0:o.name)||"Anonymous",(o==null?void 0:o.is_user)&&i.jsxs(rn,{variant:"outline",className:"ml-2",children:[i.jsx(Ad,{className:"h-3 w-3 mr-1"}),"User"]}),o&&C(o.status)]})}),i.jsxs("div",{className:"text-sm text-muted-foreground mb-4 flex flex-wrap gap-4",children:[(o==null?void 0:o.email)&&i.jsxs("span",{children:[" ",o.email]}),(o==null?void 0:o.mobile)&&i.jsxs("span",{children:[" ",o.mobile]}),(o==null?void 0:o.started_at)&&i.jsxs("span",{children:[" Started: ",Ht(new Date(o.started_at),"MMM d, HH:mm")]})]}),o&&i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("span",{className:"text-sm font-medium",children:"Work Status:"}),i.jsxs($i,{value:o.work_status,onValueChange:T=>{I(o.session_id,T),l({...o,work_status:T})},children:[i.jsx(ai,{className:"w-[130px]",children:i.jsxs("div",{className:"flex items-center gap-1",children:[S(o.work_status),i.jsx(Fi,{})]})}),i.jsxs(si,{children:[i.jsx(Ut,{value:"open",children:"Open"}),i.jsx(Ut,{value:"assigned",children:"Assigned"}),i.jsx(Ut,{value:"done",children:"Done"})]})]})]}),i.jsx(Mj,{className:"h-[400px] pr-4",children:y?i.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Loading messages..."}):x.length===0?i.jsx("div",{className:"text-center text-muted-foreground py-8",children:"No messages found"}):i.jsx("div",{className:"space-y-4",children:x.map(T=>i.jsx("div",{className:`flex ${T.role==="user"?"justify-end":"justify-start"}`,children:i.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${T.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[i.jsx("p",{className:"text-sm whitespace-pre-wrap",children:T.content}),i.jsx("p",{className:"text-xs opacity-70 mt-1",children:Ht(new Date(T.created_at),"HH:mm:ss")})]})},T.id))})}),(o==null?void 0:o.timeout_reason)&&i.jsxs("div",{className:"mt-4 p-3 bg-yellow-500/10 rounded-lg text-sm",children:[i.jsx("strong",{children:"Session ended:"})," ",o.timeout_reason]})]})})]})}function XKe(){const e=Rf(),[t,n]=N.useState(!1),[r,a]=N.useState(null),[s,o]=N.useState(null),[l,c]=N.useState(!1),[d,u]=N.useState({title:"",content:"",category:""}),{data:h,isLoading:p}=al({queryKey:["knowledge-base"],queryFn:async()=>{const{data:w,error:k}=await ue.from("knowledge_base").select("*").order("title");if(k)throw k;return w}}),m=Rd({mutationFn:async w=>{const{error:k}=await ue.from("knowledge_base").insert({title:w.title,content:w.content,category:w.category||null,is_active:!0});if(k)throw k},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),It.success("Entry added - embedding will be generated"),c(!1),u({title:"",content:"",category:""})},onError:w=>It.error(`Failed to add: ${w.message}`)}),f=Rd({mutationFn:async w=>{const{error:k}=await ue.from("knowledge_base").update({title:w.title,content:w.content,category:w.category,is_active:w.is_active}).eq("id",w.id);if(k)throw k},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),It.success("Entry updated - embedding will be regenerated"),o(null)},onError:w=>It.error(`Failed to update: ${w.message}`)}),g=Rd({mutationFn:async w=>{const{error:k}=await ue.from("knowledge_base").delete().eq("id",w);if(k)throw k},onSuccess:()=>{e.invalidateQueries({queryKey:["knowledge-base"]}),It.success("Entry deleted")},onError:w=>It.error(`Failed to delete: ${w.message}`)}),x=async()=>{n(!0);try{const{data:w,error:k}=await ue.functions.invoke("generate-embeddings",{body:{regenerate_all:!0}});if(k)throw k;It.success(`Generated ${w.successCount} embeddings (${w.errorCount} errors)`),e.invalidateQueries({queryKey:["knowledge-base"]})}catch(w){const k=w instanceof Error?w.message:"Unknown error";It.error(`Failed to regenerate: ${k}`)}finally{n(!1)}},y=async w=>{a(w);try{const{data:k,error:C}=await ue.functions.invoke("generate-embeddings",{body:{record_id:w}});if(C)throw C;k.successCount>0?It.success("Embedding generated successfully"):It.error("Failed to generate embedding"),e.invalidateQueries({queryKey:["knowledge-base"]})}catch(k){const C=k instanceof Error?k.message:"Unknown error";It.error(`Failed to regenerate: ${C}`)}finally{a(null)}},b=(h==null?void 0:h.filter(w=>w.embedding!==null).length)||0,v=(h==null?void 0:h.length)||0;return i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[i.jsxs(Tn,{children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(SX,{className:"h-4 w-4"}),"Knowledge Entries"]})}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold",children:v}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Total active entries"})]})]}),i.jsxs(Tn,{children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(Ls,{className:"h-4 w-4"}),"Embeddings Status"]})}),i.jsxs(Dn,{children:[i.jsxs("div",{className:"text-2xl font-bold",children:[b,"/",v]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:b===v?"All up to date":"Some need regeneration"})]})]}),i.jsxs(Tn,{children:[i.jsx(Qn,{className:"pb-2",children:i.jsx(Jn,{className:"text-sm font-medium",children:"Actions"})}),i.jsxs(Dn,{className:"flex gap-2",children:[i.jsxs(de,{onClick:x,disabled:t,variant:"outline",size:"sm",children:[t?i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}):i.jsx(Nh,{className:"h-4 w-4 mr-2"}),"Regenerate All"]}),i.jsxs(de,{onClick:()=>c(!0),size:"sm",children:[i.jsx(fo,{className:"h-4 w-4 mr-2"}),"Add Entry"]})]})]})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{children:[i.jsx(Jn,{children:"Knowledge Base"}),i.jsx(Ri,{children:"Manage bot knowledge. Changes trigger automatic embedding regeneration."})]}),i.jsx(Dn,{children:p?i.jsx("div",{className:"flex justify-center py-8",children:i.jsx(Gt,{className:"h-6 w-6 animate-spin"})}):i.jsx("div",{className:"rounded-md border overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{children:"Title"}),i.jsx(Ot,{children:"Content"}),i.jsx(Ot,{children:"Category"}),i.jsx(Ot,{className:"text-center",children:"Embedding"}),i.jsx(Ot,{className:"text-center",children:"Active"}),i.jsx(Ot,{className:"text-right",children:"Actions"})]})}),i.jsx(Kl,{children:h==null?void 0:h.map(w=>i.jsxs(Br,{children:[i.jsx(Et,{className:"font-medium max-w-[150px] truncate",children:w.title}),i.jsx(Et,{className:"max-w-[300px] truncate text-muted-foreground",children:w.content}),i.jsx(Et,{children:w.category&&i.jsx(rn,{variant:"secondary",children:w.category})}),i.jsx(Et,{className:"text-center",children:w.embedding?i.jsx(dn,{className:"h-4 w-4 text-green-500 mx-auto"}):r===w.id?i.jsx(Gt,{className:"h-4 w-4 animate-spin mx-auto text-muted-foreground"}):i.jsx("button",{onClick:()=>y(w.id),className:"p-1 rounded hover:bg-muted transition-colors cursor-pointer",title:"Click to generate embedding",children:i.jsx(ui,{className:"h-4 w-4 text-red-500 mx-auto"})})}),i.jsx(Et,{className:"text-center",children:i.jsx(rn,{variant:w.is_active?"default":"secondary",children:w.is_active?"Yes":"No"})}),i.jsx(Et,{className:"text-right",children:i.jsxs("div",{className:"flex justify-end gap-1",children:[i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>o(w),children:i.jsx(ib,{className:"h-4 w-4"})}),i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>{confirm("Delete this entry?")&&g.mutate(w.id)},children:i.jsx(ti,{className:"h-4 w-4 text-destructive"})})]})})]},w.id))})]})})})]}),i.jsx(vn,{open:l,onOpenChange:c,children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Add Knowledge Entry"})}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Title"}),i.jsx(At,{value:d.title,onChange:w=>u({...d,title:w.target.value}),placeholder:"e.g., Pricing Orange Monthly"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Content"}),i.jsx(ka,{value:d.content,onChange:w=>u({...d,content:w.target.value}),placeholder:"The knowledge content...",rows:4})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Category (optional)"}),i.jsx(At,{value:d.category,onChange:w=>u({...d,category:w.target.value}),placeholder:"e.g., pricing, faq, feature"})]})]}),i.jsxs(su,{children:[i.jsx(de,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),i.jsxs(de,{onClick:()=>m.mutate(d),disabled:!d.title||!d.content||m.isPending,children:[m.isPending&&i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Entry"]})]})]})}),i.jsx(vn,{open:!!s,onOpenChange:()=>o(null),children:i.jsxs(mn,{children:[i.jsx(wn,{children:i.jsx(Nn,{children:"Edit Knowledge Entry"})}),s&&i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Title"}),i.jsx(At,{value:s.title,onChange:w=>o({...s,title:w.target.value})})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Content"}),i.jsx(ka,{value:s.content,onChange:w=>o({...s,content:w.target.value}),rows:4})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Category"}),i.jsx(At,{value:s.category||"",onChange:w=>o({...s,category:w.target.value})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:"is_active",checked:s.is_active,onChange:w=>o({...s,is_active:w.target.checked})}),i.jsx("label",{htmlFor:"is_active",className:"text-sm",children:"Active"})]})]}),i.jsxs(su,{children:[i.jsx(de,{variant:"outline",onClick:()=>o(null),children:"Cancel"}),i.jsxs(de,{onClick:()=>s&&f.mutate(s),disabled:f.isPending,children:[f.isPending&&i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),"Save Changes"]})]})]})})]})}function ZKe(){const e=Rf(),{user:t}=or(),[n,r]=N.useState(null),[a,s]=N.useState(!1),[o,l]=N.useState(""),[c,d]=N.useState(""),[u,h]=N.useState(""),[p,m]=N.useState(""),[f,g]=N.useState("new"),{data:x,isLoading:y}=al({queryKey:["learning-signals",f],queryFn:async()=>{const{data:D,error:F}=await ue.from("chat_learning_signals").select("*").eq("status",f).order("frequency_count",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1});if(F)throw F;return D}}),{data:b}=al({queryKey:["learning-signals-stats"],queryFn:async()=>{const[D,F,B,q]=await Promise.all([ue.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","new"),ue.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","reviewed"),ue.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","approved"),ue.from("chat_learning_signals").select("id",{count:"exact",head:!0}).eq("status","rejected")]);return{new:D.count||0,reviewed:F.count||0,approved:B.count||0,rejected:q.count||0}}}),v=Rd({mutationFn:async({id:D,status:F,notes:B})=>{const q={status:F};B&&(q.admin_notes=B);const{error:$}=await ue.from("chat_learning_signals").update(q).eq("id",D);if($)throw $},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]})}}),w=Rd({mutationFn:async({signal:D,title:F,content:B,category:q})=>{const{data:$,error:L}=await ue.from("knowledge_base").insert({title:F,content:B,category:q||null,is_active:!0}).select().single();if(L)throw L;const{error:M}=await ue.from("chat_learning_signals").update({status:"approved",suggested_answer:B,admin_notes:c||null,approved_at:new Date().toISOString(),approved_by:t==null?void 0:t.id,created_knowledge_id:$.id}).eq("id",D.id);if(M)throw M;return await ue.functions.invoke("generate-embeddings",{body:{record_id:$.id}}),$},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]}),e.invalidateQueries({queryKey:["knowledge-base"]}),It.success("Learning signal approved and added to knowledge base"),S()},onError:D=>{It.error(`Failed to approve: ${D.message}`)}}),k=Rd({mutationFn:async({id:D,notes:F})=>{const{error:B}=await ue.from("chat_learning_signals").update({status:"rejected",admin_notes:F||null}).eq("id",D);if(B)throw B},onSuccess:()=>{e.invalidateQueries({queryKey:["learning-signals"]}),e.invalidateQueries({queryKey:["learning-signals-stats"]}),It.success("Learning signal rejected"),S()},onError:D=>{It.error(`Failed to reject: ${D.message}`)}}),C=D=>{r(D),l(D.suggested_answer||D.response_text||""),d(D.admin_notes||""),m(D.query_text.slice(0,100)),h("faq"),s(!1)},S=()=>{r(null),l(""),d(""),m(""),h(""),s(!1)},_=()=>{if(!n||!p.trim()||!o.trim()){It.error("Title and answer are required");return}w.mutate({signal:n,title:p.trim(),content:o.trim(),category:u.trim()})},I=()=>{n&&k.mutate({id:n.id,notes:c})},T=()=>{n&&(v.mutate({id:n.id,status:"reviewed",notes:c}),S(),It.success("Marked as reviewed"))},A=D=>{switch(D){case"no_match":return i.jsx(rn,{variant:"destructive",children:"No Match"});case"low_confidence":return i.jsx(rn,{variant:"secondary",children:"Low Confidence"});case"repeated_query":return i.jsx(rn,{variant:"outline",children:"Repeated"});case"user_feedback":return i.jsx(rn,{variant:"default",children:"Feedback"});default:return i.jsx(rn,{variant:"secondary",children:D})}},j=D=>new Date(D).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return i.jsxs("div",{className:"space-y-6",children:[i.jsx(Tn,{className:"border-primary/20 bg-primary/5",children:i.jsxs(Qn,{className:"pb-3",children:[i.jsxs(Jn,{className:"flex items-center gap-2 text-lg",children:[i.jsx(Tf,{className:"h-5 w-5 text-primary"}),"Controlled Learning (Admin Approved)"]}),i.jsxs(Ri,{children:["Review user questions and optionally approve them as new knowledge entries.",i.jsx("strong",{className:"text-foreground",children:" Bot answers remain unchanged until you approve."})]})]})}),i.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[i.jsxs(Tn,{className:`cursor-pointer transition-colors ${f==="new"?"ring-2 ring-primary":""}`,onClick:()=>g("new"),children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(c2,{className:"h-4 w-4 text-yellow-500"}),"New Signals"]})}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.new)||0}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting review"})]})]}),i.jsxs(Tn,{className:`cursor-pointer transition-colors ${f==="reviewed"?"ring-2 ring-primary":""}`,onClick:()=>g("reviewed"),children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(Pi,{className:"h-4 w-4 text-blue-500"}),"Reviewed"]})}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.reviewed)||0}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Pending decision"})]})]}),i.jsxs(Tn,{className:`cursor-pointer transition-colors ${f==="approved"?"ring-2 ring-primary":""}`,onClick:()=>g("approved"),children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(dn,{className:"h-4 w-4 text-green-500"}),"Approved"]})}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.approved)||0}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Added to knowledge"})]})]}),i.jsxs(Tn,{className:`cursor-pointer transition-colors ${f==="rejected"?"ring-2 ring-primary":""}`,onClick:()=>g("rejected"),children:[i.jsx(Qn,{className:"pb-2",children:i.jsxs(Jn,{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(ui,{className:"h-4 w-4 text-red-500"}),"Rejected"]})}),i.jsxs(Dn,{children:[i.jsx("div",{className:"text-2xl font-bold",children:(b==null?void 0:b.rejected)||0}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Dismissed"})]})]})]}),i.jsxs(Tn,{children:[i.jsxs(Qn,{children:[i.jsxs(Jn,{className:"flex items-center gap-2",children:[i.jsx(hD,{className:"h-5 w-5"}),"Learning Signals - ",f.charAt(0).toUpperCase()+f.slice(1)]}),i.jsxs(Ri,{children:[f==="new"&&"Questions that need your review. Click to review and approve/reject.",f==="reviewed"&&"Signals you've reviewed but not yet decided on.",f==="approved"&&"Approved signals that have been added to knowledge base.",f==="rejected"&&"Rejected signals that won't be added."]})]}),i.jsx(Dn,{children:y?i.jsx("div",{className:"flex justify-center py-8",children:i.jsx(Gt,{className:"h-6 w-6 animate-spin"})}):(x==null?void 0:x.length)===0?i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No ",f," signals found"]}):i.jsx("div",{className:"rounded-md border overflow-x-auto",children:i.jsxs(Gl,{children:[i.jsx(ql,{children:i.jsxs(Br,{children:[i.jsx(Ot,{children:"User Question"}),i.jsx(Ot,{children:"Current Answer"}),i.jsx(Ot,{className:"text-center",children:"Type"}),i.jsxs(Ot,{className:"text-center",children:[i.jsx(jO,{className:"h-4 w-4 inline mr-1"}),"Freq"]}),i.jsx(Ot,{className:"text-center",children:"Confidence"}),i.jsx(Ot,{children:"Date"}),i.jsx(Ot,{className:"text-right",children:"Action"})]})}),i.jsx(Kl,{children:x==null?void 0:x.map(D=>i.jsxs(Br,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>C(D),children:[i.jsx(Et,{className:"font-medium max-w-[200px]",children:i.jsx("div",{className:"truncate",title:D.query_text,children:D.query_text})}),i.jsx(Et,{className:"max-w-[250px] text-muted-foreground",children:i.jsx("div",{className:"truncate",title:D.response_text||"",children:D.response_text||i.jsx("span",{className:"italic",children:"No response"})})}),i.jsx(Et,{className:"text-center",children:A(D.signal_type)}),i.jsx(Et,{className:"text-center",children:i.jsxs(rn,{variant:"outline",children:[D.frequency_count||1,""]})}),i.jsx(Et,{className:"text-center",children:D.similarity_score?i.jsxs("span",{className:D.similarity_score<.5?"text-destructive":"text-muted-foreground",children:[(D.similarity_score*100).toFixed(0),"%"]}):i.jsx("span",{className:"text-muted-foreground",children:""})}),i.jsx(Et,{className:"text-sm text-muted-foreground",children:j(D.created_at)}),i.jsx(Et,{className:"text-right",children:i.jsx(de,{variant:"ghost",size:"sm",onClick:F=>{F.stopPropagation(),C(D)},children:"Review"})})]},D.id))})]})})})]}),i.jsx(vn,{open:!!n,onOpenChange:()=>S(),children:i.jsxs(mn,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(wn,{children:[i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(c2,{className:"h-5 w-5"}),"Review Learning Signal"]}),i.jsx(Xd,{children:"Review this user question and decide whether to add it to the knowledge base."})]}),n&&i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[i.jsx(hD,{className:"h-4 w-4"}),"User Question"]}),i.jsx("div",{className:"p-3 bg-muted rounded-md text-sm",children:n.query_text})]}),i.jsxs("div",{className:"flex gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Type:"})," ",A(n.signal_type)]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Asked:"})," ",i.jsxs(rn,{variant:"outline",children:[n.frequency_count||1," times"]})]}),n.similarity_score&&i.jsxs("div",{children:[i.jsx("span",{className:"text-muted-foreground",children:"Match:"})," ",i.jsxs("span",{className:n.similarity_score<.5?"text-destructive":"",children:[(n.similarity_score*100).toFixed(0),"%"]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Current Bot Response"}),i.jsx("div",{className:"p-3 bg-muted/50 rounded-md text-sm text-muted-foreground max-h-32 overflow-y-auto",children:n.response_text||"No response recorded"})]}),(n.status==="new"||n.status==="reviewed")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"border-t pt-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("h4",{className:"font-medium",children:"Create Knowledge Entry"}),i.jsxs(de,{variant:"outline",size:"sm",onClick:()=>s(!a),children:[i.jsx(ib,{className:"h-4 w-4 mr-1"}),a?"Preview":"Edit"]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Knowledge Title"}),i.jsx(At,{value:p,onChange:D=>m(D.target.value),placeholder:"Brief title for this knowledge entry",disabled:!a})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Answer / Content"}),i.jsx(ka,{value:o,onChange:D=>l(D.target.value),placeholder:"The answer that will be added to knowledge base...",rows:4,disabled:!a})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Category"}),i.jsx(At,{value:u,onChange:D=>h(D.target.value),placeholder:"e.g., faq, pricing, feature",disabled:!a})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Admin Notes (internal)"}),i.jsx(ka,{value:c,onChange:D=>d(D.target.value),placeholder:"Optional notes about this decision...",rows:2})]})]})]}),i.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:[i.jsx(Ld,{className:"h-5 w-5 text-yellow-600 shrink-0 mt-0.5"}),i.jsxs("div",{className:"text-sm",children:[i.jsx("strong",{children:"Approval creates a new knowledge entry."})," The bot will use this answer for similar questions after embedding generation completes."]})]})]}),n.status==="approved"&&i.jsxs("div",{className:"p-3 bg-green-500/10 border border-green-500/20 rounded-md",children:[i.jsxs("div",{className:"flex items-center gap-2 text-green-700 dark:text-green-400",children:[i.jsx(dn,{className:"h-4 w-4"}),i.jsx("span",{className:"font-medium",children:"Approved"}),n.approved_at&&i.jsxs("span",{className:"text-sm text-muted-foreground",children:["on ",j(n.approved_at)]})]}),n.admin_notes&&i.jsx("p",{className:"text-sm mt-2 text-muted-foreground",children:n.admin_notes})]}),n.status==="rejected"&&i.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[i.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[i.jsx(ui,{className:"h-4 w-4"}),i.jsx("span",{className:"font-medium",children:"Rejected"})]}),n.admin_notes&&i.jsx("p",{className:"text-sm mt-2 text-muted-foreground",children:n.admin_notes})]})]}),i.jsxs(su,{className:"gap-2 sm:gap-0",children:[(n==null?void 0:n.status)==="new"&&i.jsx(de,{variant:"outline",onClick:T,disabled:v.isPending,children:"Mark as Reviewed"}),((n==null?void 0:n.status)==="new"||(n==null?void 0:n.status)==="reviewed")&&i.jsxs(i.Fragment,{children:[i.jsxs(de,{variant:"destructive",onClick:I,disabled:k.isPending,children:[k.isPending&&i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),i.jsx(ui,{className:"h-4 w-4 mr-1"}),"Reject"]}),i.jsxs(de,{onClick:_,disabled:w.isPending||!p.trim()||!o.trim(),children:[w.isPending&&i.jsx(Gt,{className:"h-4 w-4 mr-2 animate-spin"}),i.jsx(dn,{className:"h-4 w-4 mr-1"}),"Approve & Add to Knowledge"]})]}),((n==null?void 0:n.status)==="approved"||(n==null?void 0:n.status)==="rejected")&&i.jsx(de,{variant:"outline",onClick:S,children:"Close"})]})]})})]})}function QKe(){const[e,t]=N.useState(!1),[n,r]=N.useState(!1),[a,s]=N.useState(""),[o,l]=N.useState(!1),[c,d]=N.useState([]),[u,h]=N.useState(!1),[p,m]=N.useState(""),[f,g]=N.useState(""),[x,y]=N.useState(""),[b,v]=N.useState(""),[w,k]=N.useState(""),[C,S]=N.useState(""),_=WR(),I=()=>{m(""),g(""),y(""),v(""),k(""),S(""),s(""),d([]),h(!1)},T=()=>{I(),t(!0)},A=async()=>{const F=a.trim();if(!F||F.length<2){It.error("Please enter at least 2 characters to search");return}l(!0),h(!0);try{const{data:B,error:q}=await ue.from("profiles").select("user_id, full_name, email, phone, company, designation, slug").or(`full_name.ilike.%${F}%,email.ilike.%${F}%`).limit(10);if(q)throw q;d(B||[]),(!B||B.length===0)&&It.info("No users found matching your search")}catch(B){console.error("Search error:",B),It.error("Failed to search users"),d([])}finally{l(!1)}},j=F=>{m(F.slug||""),g(F.full_name||""),y(F.company||""),v(F.designation||""),k(F.phone||""),S(F.email||""),h(!1),s(""),It.success(`Selected: ${F.full_name||F.email}`)},D=async()=>{if(!p.trim()){It.error("Please enter a slug/link");return}r(!0);try{const B=`https://synka.in/u/${p.trim().replace(/^\/+/,"").replace(/^u\//,"")}`,q=mKe({name:f.trim()||void 0,company:x.trim()||void 0,designation:b.trim()||void 0,phone:w.trim()||void 0,email:C.trim()||void 0,url:B});It.info("Hold NFC tag near your device...");const $=await pKe(B,q);$.success?(It.success("NFC tag written successfully!"),t(!1),I()):It.error($.error||"Failed to write NFC tag")}catch(F){console.error("NFC write error:",F),It.error((F==null?void 0:F.message)||"Failed to write NFC tag")}finally{r(!1)}};return i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Tn,{children:[i.jsxs(Qn,{children:[i.jsxs(Jn,{className:"flex items-center gap-2",children:[i.jsx(u2,{className:"h-5 w-5"}),"Admin NFC Writer"]}),i.jsx(Ri,{children:"Write any custom slug and contact details to NFC cards. This allows you to program NFC cards for any user."})]}),i.jsxs(Dn,{className:"space-y-4",children:[!_.isSupported&&i.jsxs("div",{className:"p-4 rounded-lg bg-amber-500/10 border border-amber-500/20 flex items-start gap-3",children:[i.jsx(Ld,{className:"h-5 w-5 text-amber-500 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-amber-600 dark:text-amber-400",children:"NFC Not Available"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:Xt.isNativePlatform()?"NFC writing requires Chrome browser on Android. Please open synka.in in Chrome to write NFC tags.":"NFC is not supported on this device/browser. Please use Chrome on Android with NFC enabled."})]})]}),_.isSupported&&i.jsxs("div",{className:"p-4 rounded-lg bg-green-500/10 border border-green-500/20 flex items-start gap-3",children:[i.jsx(fO,{className:"h-5 w-5 text-green-500 mt-0.5"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-green-600 dark:text-green-400",children:"NFC Available"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Your device supports NFC writing. Click the button below to program an NFC card."})]})]}),i.jsxs(de,{onClick:T,className:"w-full sm:w-auto",disabled:!_.isSupported,children:[i.jsx(MX,{className:"h-4 w-4 mr-2"}),"Write NFC Card"]})]})]}),i.jsx(vn,{open:e,onOpenChange:t,children:i.jsxs(mn,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[i.jsx(wn,{children:i.jsxs(Nn,{className:"flex items-center gap-2",children:[i.jsx(u2,{className:"h-5 w-5"}),"Write Custom NFC Card"]})}),i.jsxs("div",{className:"space-y-4 py-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs(We,{className:"flex items-center gap-1",children:[i.jsx(Jc,{className:"h-4 w-4"}),"Search User"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(At,{value:a,onChange:F=>s(F.target.value),placeholder:"Search by name or email...",className:"flex-1",onKeyDown:F=>F.key==="Enter"&&A()}),i.jsx(de,{variant:"outline",size:"icon",onClick:A,disabled:o,children:o?i.jsx(Gt,{className:"h-4 w-4 animate-spin"}):i.jsx(Jc,{className:"h-4 w-4"})})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Find a user to auto-fill their details"}),u&&i.jsx("div",{className:"border rounded-lg divide-y max-h-48 overflow-y-auto",children:o?i.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[i.jsx(Gt,{className:"h-4 w-4 animate-spin mx-auto mb-2"}),"Searching..."]}):c.length>0?c.map(F=>i.jsxs("button",{onClick:()=>j(F),className:"w-full p-3 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[i.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:i.jsx(Ad,{className:"h-4 w-4 text-primary"})}),i.jsxs("div",{className:"min-w-0 flex-1",children:[i.jsx("p",{className:"font-medium text-sm truncate",children:F.full_name||"No name"}),i.jsx("p",{className:"text-xs text-muted-foreground truncate",children:F.email||"No email"}),F.slug&&i.jsxs("p",{className:"text-xs text-primary truncate",children:["/",F.slug]})]})]},F.user_id)):i.jsx("div",{className:"p-4 text-center text-muted-foreground text-sm",children:"No users found"})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("span",{className:"w-full border-t"})}),i.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:i.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"or enter manually"})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs(We,{className:"flex items-center gap-1",children:["Slug / Link ",i.jsx("span",{className:"text-destructive",children:"*"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"synka.in/u/"}),i.jsx(At,{value:p,onChange:F=>m(F.target.value),placeholder:"john-doe",className:"flex-1"})]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter the user's profile slug (e.g., john-doe)"})]}),i.jsxs("div",{className:"border-t pt-4 space-y-4",children:[i.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Optional Offline Details (vCard)"}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Name"}),i.jsx(At,{value:f,onChange:F=>g(F.target.value),placeholder:"John Doe"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Company"}),i.jsx(At,{value:x,onChange:F=>y(F.target.value),placeholder:"Acme Inc"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Designation"}),i.jsx(At,{value:b,onChange:F=>v(F.target.value),placeholder:"CEO"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Phone"}),i.jsx(At,{value:w,onChange:F=>k(F.target.value),placeholder:"+91 98765 43210"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Email"}),i.jsx(At,{value:C,onChange:F=>S(F.target.value),placeholder:"john@example.com"})]})]})]}),i.jsxs("div",{className:"flex gap-3 pt-2",children:[i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>t(!1),disabled:n,children:"Cancel"}),i.jsx(de,{variant:"default",className:"flex-1",onClick:D,disabled:n||!p.trim(),children:n?"Waiting for tag...":"Write to NFC"})]})]})]})})]})}function JKe(){const{user:e,loading:t}=or(),{isAdmin:n,loading:r}=Wu(),a=Pa(),[s,o]=N.useState("users");return!t&&!e?(a("/login"),null):!t&&!r&&!n?(a("/dashboard"),null):t||r&&!n?i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:i.jsx(Gt,{className:"h-8 w-8 animate-spin text-primary"})}):n?i.jsxs("div",{className:"w-full py-4 sm:py-8 px-3 sm:px-4 md:px-6 max-w-[1600px] mx-auto",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[i.jsx(Tf,{className:"h-8 w-8 text-primary"}),i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold",children:"Admin Panel"})]}),i.jsxs(fY,{value:s,onValueChange:o,className:"w-full",children:[i.jsx("div",{className:"overflow-x-auto mb-6 -mx-4 px-4",children:i.jsxs(VR,{className:"inline-flex w-auto min-w-full sm:w-auto gap-1",children:[i.jsx(_i,{value:"users",className:"whitespace-nowrap",children:"Users"}),i.jsx(_i,{value:"transactions",className:"whitespace-nowrap",children:"Transactions"}),i.jsx(_i,{value:"nfc-orders",className:"whitespace-nowrap",children:"NFC Orders"}),i.jsx(_i,{value:"reports",className:"whitespace-nowrap",children:"Reports"}),i.jsx(_i,{value:"chats",className:"whitespace-nowrap",children:"Chat Sessions"}),i.jsx(_i,{value:"learning",className:"whitespace-nowrap",children:"Controlled Learning"}),i.jsx(_i,{value:"bot",className:"whitespace-nowrap",children:"Bot Settings"}),i.jsx(_i,{value:"nfc-writer",className:"whitespace-nowrap",children:"NFC Writer"}),i.jsx(_i,{value:"deleted",className:"whitespace-nowrap",children:"Deleted Users"})]})}),i.jsx(ji,{value:"users",children:i.jsx(PKe,{})}),i.jsx(ji,{value:"transactions",children:i.jsx(UKe,{})}),i.jsx(ji,{value:"nfc-orders",children:i.jsx(VKe,{})}),i.jsx(ji,{value:"reports",children:i.jsx(GKe,{})}),i.jsx(ji,{value:"chats",children:i.jsx(YKe,{})}),i.jsx(ji,{value:"learning",children:i.jsx(ZKe,{})}),i.jsx(ji,{value:"bot",children:i.jsx(XKe,{})}),i.jsx(ji,{value:"nfc-writer",children:i.jsx(QKe,{})}),i.jsx(ji,{value:"deleted",children:i.jsx(qKe,{})})]})]}):null}const eYe=[{text:"1 Digital Business Card",included:!0},{text:"Standard QR Code",included:!0},{text:"Share Digital Card via link",included:!0},{text:"Save up to 100 Contacts",included:!0},{text:"Manual Follow-ups",included:!0},{text:"Basic Analytics (Views & Clicks)",included:!0},{text:"Basic Contact Save",included:!0},{text:"Multiple Digital Cards",included:!1},{text:"Custom Domain",included:!1},{text:"Email Signature",included:!1},{text:"WhatsApp / Email Templates",included:!1},{text:"Event Scheduling",included:!1},{text:"Import & Export",included:!1},{text:"NFC Writing",included:!1},{text:"Advanced Reports",included:!1}],hm={core:{title:"Core Features",items:[{text:"Multiple Digital Business Cards",included:!0},{text:'One-Click "Make Default" Card',included:!0},{text:"Unified Sharing & QR",included:!0,sub:"Same QR & link always point to default card"},{text:"Custom Domain",included:!0},{text:"Lifetime Free PVC NFC Card*",included:!0}]},communication:{title:"Communication & Growth",items:[{text:"Email Signature",included:!0,sub:"Create using AI  Unlimited generations"},{text:"Prefilled WhatsApp & Email Templates",included:!0,sub:"One-click touchbase"},{text:"Unlimited Contacts",included:!0},{text:"Unlimited Follow-ups",included:!0},{text:"Import & Export Contacts",included:!0}]},automation:{title:"Automation & Intelligence",items:[{text:"Event Scheduling & Auto Tagging",included:!0},{text:"Advanced Analytics & Reports",included:!0},{text:"Follow-up Automation",comingSoon:!0},{text:"AI Auto Meeting Scheduling",comingSoon:!0},{text:"Record Meetings & Get Instant MOM",comingSoon:!0,sub:"Email / WhatsApp delivery"},{text:"Auto Smart Location Tagging",comingSoon:!0}]}},tYe=()=>{var M;const{profile:e,loading:t,refetch:n}=hl(),{user:r}=or(),a=Pa(),{initiateSubscription:s,initiateResume:o}=mY(),[l,c]=N.useState("none"),[d,u]=N.useState(!0),[h,p]=N.useState(!1),[m,f]=N.useState(!0),[g,x]=N.useState(!1),[y,b]=N.useState(null),[v,w]=N.useState(!1),k=N.useRef(!1),[C,S]=N.useState(!1),[_,I]=N.useState("annually"),A=(((M=e==null?void 0:e.plan)==null?void 0:M.toLowerCase())||"free")==="orange",j={annually:{displayPrice:"166.58",totalPrice:1999,originalPrice:3999,period:"month",billingNote:"1,999/year"},monthly:{displayPrice:"299",totalPrice:299,originalPrice:599,period:"month",billingNote:null}},D=m?j.annually:j.monthly;N.useEffect(()=>{if(!r||k.current){r||u(!1);return}(async()=>{var U;k.current=!0;const{data:G,error:W}=await ue.from("orders").select("status").eq("user_id",r.id).eq("product_type","orange_upgrade").order("created_at",{ascending:!1}).limit(1).maybeSingle();if(W)console.error("Error fetching orange order:",W),c("none");else if(G){const K=(U=G.status)==null?void 0:U.toLowerCase();c(K==="requested"?"requested":K==="approved"?"approved":"none")}else c("none");const{data:O}=await ue.from("subscriptions").select("plan_type, end_date, cancelled_at, auto_renew, status").eq("user_id",r.id).eq("status","active").gte("end_date",new Date().toISOString()).order("created_at",{ascending:!1}).limit(1).maybeSingle();if(O){const K=O.cancelled_at!==null&&O.cancelled_at!==void 0,ce=O.auto_renew===!0;K&&!ce?(S(!0),I(O.plan_type)):S(!1)}u(!1)})()},[r]),N.useEffect(()=>{if(!r)return;const X=ue.channel("upgrade-order-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"orders",filter:`user_id=eq.${r.id}`},G=>{if(G.new&&G.new.product_type==="orange_upgrade"){const W=(G.new.status||"").toLowerCase();W==="approved"?(c("approved"),n()):W==="rejected"?c("none"):W==="requested"&&c("requested")}}).subscribe();return()=>{ue.removeChannel(X)}},[r,n]),N.useEffect(()=>{if(!r)return;const X=ue.channel("upgrade-subscription-changes").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`user_id=eq.${r.id}`},async G=>{const W=G.new;if(!W)return;console.log("[Realtime] Subscription update received:",{id:W.id,status:W.status,cancelled_at:W.cancelled_at,auto_renew:W.auto_renew,plan_type:W.plan_type});const O=W.status==="active",U=W.end_date?new Date(W.end_date):null,K=U&&U>=new Date;if(!O||!K){console.log("[Realtime] Subscription not active or expired, ignoring");return}const ce=W.cancelled_at!==null&&W.cancelled_at!==void 0,ne=W.auto_renew===!0;console.log("[Realtime] Subscription analysis:",{isCancelled:ce,hasAutoRenew:ne}),ne&&!ce?(console.log("[Realtime]  Subscription is FULLY ACTIVE - hiding Resume button"),S(!1),I(W.plan_type)):(ce||!ne)&&(console.log("[Realtime]  Subscription needs RESUME - showing Resume button"),S(!0),I(W.plan_type)),n()}).subscribe();return()=>{ue.removeChannel(X)}},[r,n]);const F=async()=>{if(!r){It.error("Please log in to upgrade");return}p(!0),x(!1),b(null),s({plan_type:m?"annually":"monthly",onSuccess:G=>{c("approved"),w(!0),n(),p(!1)},onFailure:G=>{console.error("Payment failed:",G),x(!0),b((G==null?void 0:G.message)||"Payment could not be processed. Please try again."),p(!1)}})},B=()=>{x(!1),b(null)},q=()=>{if(!r){It.error("Please log in to resume");return}p(!0),x(!1),b(null),o({plan_type:_,onSuccess:()=>{S(!1),w(!0),n(),p(!1)},onFailure:X=>{console.error("Resume payment failed:",X),x(!0),b((X==null?void 0:X.message)||"Payment could not be processed. Please try again."),p(!1)}})};if(t||d)return i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-orange-plan border-t-transparent rounded-full"})});if(g)return i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:i.jsx("div",{className:"max-w-md w-full",children:i.jsxs("div",{className:"bg-card rounded-2xl border border-destructive/20 p-8 text-center space-y-6 shadow-lg",children:[i.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-destructive/10 flex items-center justify-center",children:i.jsx(Dl,{className:"h-10 w-10 text-destructive"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Payment Failed"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:y||"Your payment could not be processed. Please try again."})]}),i.jsxs("div",{className:"bg-muted/50 rounded-xl p-4 text-left space-y-2",children:[i.jsx("h3",{className:"font-semibold text-foreground text-sm",children:"What you can do:"}),i.jsxs("ul",{className:"space-y-1.5 text-xs text-muted-foreground",children:[i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-500"}),"Check your payment details and try again"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-500"}),"Ensure sufficient balance"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-500"}),"Try a different payment method"]})]})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Need help? Contact us at"," ",i.jsx("a",{href:"mailto:orders@synka.in",className:"text-orange-plan underline",children:"orders@synka.in"})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs(de,{className:"w-full bg-orange-plan hover:bg-orange-plan/90",onClick:B,children:[i.jsx(Nh,{className:"h-4 w-4 mr-2"}),"Try Again"]}),i.jsx(de,{variant:"outline",className:"w-full",onClick:()=>a("/settings"),children:"Back to Settings"})]})]})})});if(v)return i.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:i.jsx("div",{className:"max-w-md w-full",children:i.jsxs("div",{className:"bg-card rounded-2xl border border-orange-plan/30 p-8 text-center space-y-6 shadow-lg",children:[i.jsx("div",{className:"w-20 h-20 mx-auto rounded-full bg-orange-plan/10 flex items-center justify-center",children:i.jsx(wO,{className:"h-10 w-10 text-orange-plan"})}),i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:" Welcome to Orange!"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Your subscription is now active. Enjoy all premium features!"})]}),i.jsxs("div",{className:"bg-orange-plan/10 rounded-xl p-4 text-left space-y-3",children:[i.jsxs("h3",{className:"font-semibold text-foreground text-sm flex items-center gap-2",children:[i.jsx(Lw,{className:"h-4 w-4 text-orange-plan"}),"What's included:"]}),i.jsxs("ul",{className:"space-y-1.5 text-xs text-muted-foreground",children:[i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-plan"}),"Multiple Digital Business Cards"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-plan"}),"Lifetime Free PVC NFC Card"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-plan"}),"Email Signatures & Templates"]}),i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx(dn,{className:"h-3 w-3 text-orange-plan"}),"Advanced Analytics & More"]})]})]}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:["Questions? Contact us at"," ",i.jsx("a",{href:"mailto:orders@synka.in",className:"text-orange-plan underline",children:"orders@synka.in"})]}),i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsx(de,{className:"w-full bg-orange-plan hover:bg-orange-plan/90",onClick:()=>a("/my-card"),children:"Go to My Card"}),i.jsx(de,{variant:"outline",className:"w-full",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})]})]})})});const L=A&&C?{text:"Resume Subscription",disabled:!1,variant:"default",isResume:!0}:A?{text:"Current Plan",disabled:!0,variant:"secondary",isResume:!1}:l==="requested"?{text:"Requested",disabled:!0,variant:"outline",isResume:!1}:{text:"Upgrade to Orange",disabled:!1,variant:"default",isResume:!1};return i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[i.jsxs("div",{className:"mb-8",children:[i.jsxs(de,{variant:"ghost",size:"sm",onClick:()=>a("/settings"),className:"mb-4 -ml-2",children:[i.jsx(Ed,{className:"w-4 h-4 mr-2"}),"Back to Settings"]}),i.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Choose Your Plan"}),i.jsx("p",{className:"text-muted-foreground mt-2",children:"Unlock powerful features to grow your network"})]}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:[i.jsxs("div",{className:"relative rounded-2xl border-2 border-orange-plan bg-card p-6 lg:p-8 shadow-lg shadow-orange-plan/10",children:[i.jsx("div",{className:"absolute -top-4 left-6 bg-orange-plan text-white px-4 py-1.5 rounded-full text-sm font-semibold shadow-md",children:"ORANGE"}),i.jsxs("div",{className:"mb-6 mt-2",children:[i.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"ORANGE"}),i.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 p-3 bg-muted/50 rounded-lg",children:[i.jsx("span",{className:`text-sm font-medium ${m?"text-muted-foreground":"text-foreground"}`,children:"Monthly"}),i.jsx(E0,{checked:m,onCheckedChange:f,className:"data-[state=checked]:bg-orange-plan"}),i.jsx("span",{className:`text-sm font-medium ${m?"text-foreground":"text-muted-foreground"}`,children:"Annually"}),m&&i.jsx("span",{className:"text-xs bg-green-500/20 text-green-600 px-2 py-0.5 rounded-full font-medium",children:"Save 50%"})]}),i.jsxs("div",{className:"mt-4 text-center",children:[i.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[i.jsxs("span",{className:"text-4xl font-bold text-orange-plan",children:["",D.displayPrice]}),i.jsxs("span",{className:"text-muted-foreground",children:["/",D.period]})]}),m?i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:D.billingNote}):null,i.jsxs("div",{className:"mt-3 flex items-center justify-center gap-2",children:[i.jsxs("span",{className:"text-muted-foreground line-through text-lg",children:["",D.originalPrice]}),i.jsx("span",{className:"text-xs bg-red-500/20 text-red-600 px-2 py-1 rounded-full font-semibold animate-pulse",children:"Limited Period Offer!"})]})]})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:hm.core.title}),i.jsx("div",{className:"space-y-2.5",children:hm.core.items.map((X,G)=>i.jsx(a2,{feature:X},G))})]}),i.jsxs("div",{className:"mb-5",children:[i.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:hm.communication.title}),i.jsx("div",{className:"space-y-2.5",children:hm.communication.items.map((X,G)=>i.jsx(a2,{feature:X},G))})]}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h3",{className:"text-sm font-semibold text-orange-plan mb-3",children:hm.automation.title}),i.jsx("div",{className:"space-y-2.5",children:hm.automation.items.map((X,G)=>i.jsx(a2,{feature:X},G))})]}),!A&&l!=="requested"&&i.jsx("div",{className:"mb-4 p-4 bg-orange-plan/10 rounded-lg border border-orange-plan/20",children:i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"text-sm text-muted-foreground",children:"Total to pay"}),i.jsxs("div",{className:"text-right",children:[i.jsxs("span",{className:"text-2xl font-bold text-orange-plan",children:["",D.totalPrice]}),i.jsx("span",{className:"text-xs text-muted-foreground ml-1",children:m?"/year":"/month"})]})]})}),i.jsxs("div",{className:"space-y-2",children:[C&&i.jsxs("div",{className:"p-3 rounded-lg bg-amber-500/10 border border-amber-500/20 flex items-start gap-2",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-amber-600 flex-shrink-0 mt-0.5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"})}),i.jsxs("div",{children:[i.jsx("p",{className:"text-sm font-semibold text-amber-700",children:"Auto-renewal cancelled"}),i.jsx("p",{className:"text-xs text-amber-600 mt-0.5",children:"Your Orange plan is still active until the end of the current period. Resume to re-enable auto-renewal and keep your plan going."})]})]}),i.jsx(de,{className:L.variant==="default"?"w-full bg-orange-plan hover:bg-orange-plan/90 text-white":"w-full",variant:L.variant,disabled:L.disabled||h,onClick:L.disabled?void 0:L.isResume?q:F,children:h?i.jsxs(i.Fragment,{children:[i.jsx(Gt,{className:"w-4 h-4 mr-2 animate-spin"}),L.isResume?"Resuming...":"Submitting..."]}):L.text}),l==="requested"&&i.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Request under review"})]})]}),i.jsxs("div",{className:"rounded-2xl border border-border bg-card p-6 lg:p-8",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"FREE"}),i.jsx("p",{className:"text-muted-foreground mt-1",children:"Get started with the basics"})]}),i.jsx("div",{className:"space-y-3 mb-8",children:eYe.map((X,G)=>i.jsxs("div",{className:"flex items-start gap-3",children:[X.included?i.jsx(dn,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}):i.jsx(ui,{className:"w-5 h-5 text-muted-foreground/50 mt-0.5 flex-shrink-0"}),i.jsx("span",{className:X.included?"text-foreground":"text-muted-foreground/50 line-through",children:X.text})]},G))}),i.jsx(de,{className:"w-full",variant:!A&&l!=="approved"?"secondary":"outline",disabled:!A&&l!=="approved",children:!A&&l!=="approved"?"Current Plan":"Free Plan"})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-8 text-center",children:"* Lifetime Free PVC NFC Card available with Orange plan activation. Terms apply."})]})})},a2=({feature:e})=>{const t=e.comingSoon;return i.jsxs("div",{className:"flex items-start gap-3",children:[t?i.jsx(Pi,{className:"w-4 h-4 text-muted-foreground/60 mt-0.5 flex-shrink-0"}):i.jsx(dn,{className:"w-4 h-4 text-orange-plan mt-0.5 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("span",{className:t?"text-muted-foreground/60 text-sm":"text-foreground text-sm",children:[e.text,t&&i.jsx("span",{className:"ml-2 text-xs bg-muted px-2 py-0.5 rounded-full",children:"Coming Soon"})]}),e.sub&&i.jsx("p",{className:`text-xs mt-0.5 ${t?"text-muted-foreground/40":"text-muted-foreground"}`,children:e.sub})]})]})};function nYe(){var ne;const e=Pa(),{profile:t,updateProfile:n,loading:r,refetch:a}=hl(),{user:s,verifyPin:o,setPin:l}=or(),[c,d]=N.useState(""),[u,h]=N.useState(!1),[p,m]=N.useState(!1),[f,g]=N.useState(""),[x,y]=N.useState(""),[b,v]=N.useState(""),[w,k]=N.useState(!1),[C,S]=N.useState("old"),[_,I]=N.useState(!1),[T,A]=N.useState(!1),[j,D]=N.useState(null),[F,B]=N.useState(!0);N.useEffect(()=>{t&&d(t.full_name||"")},[t]),N.useEffect(()=>{(async()=>{if(!(s!=null&&s.id))return;B(!0);const{data:Te,error:Ae}=await ue.from("subscriptions").select("id, plan_type, end_date, auto_renew, cancelled_at").eq("user_id",s.id).eq("status","active").order("created_at",{ascending:!1}).limit(1).maybeSingle();D(!Ae&&Te?Te:null),B(!1)})()},[s==null?void 0:s.id]),N.useEffect(()=>{if(!(s!=null&&s.id))return;const te=ue.channel("profile-subscription-changes").on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`user_id=eq.${s.id}`},Te=>{const Ae=Te.new;Ae&&(console.log("[Realtime] ProfileSettings subscription update:",Ae.status,Ae.cancelled_at),Ae.status==="active"?D({id:Ae.id,plan_type:Ae.plan_type,end_date:Ae.end_date,auto_renew:Ae.auto_renew,cancelled_at:Ae.cancelled_at}):(Ae.status==="completed"||Ae.status==="expired")&&D(null),a())}).subscribe();return()=>{ue.removeChannel(te)}},[s==null?void 0:s.id,a]);const q=async()=>{if(!c.trim()){ie({title:"Name required",description:"Please enter your full name.",variant:"destructive"});return}h(!0);const{error:te}=await n({full_name:c.trim()});h(!1),ie(te?{title:"Error",description:"Failed to update name.",variant:"destructive"}:{title:"Saved",description:"Your name has been updated."})},$=()=>{g(""),y(""),v(""),S("old"),m(!0)},L=async()=>{if(f.length!==4)return;k(!0);const te=(t==null?void 0:t.email)||(s==null?void 0:s.email);if(!te){k(!1),ie({title:"Error",description:"Could not find your email.",variant:"destructive"});return}const{error:Te,locked:Ae}=await o(te,f);if(k(!1),Te){Ae?(ie({title:"Account Locked",description:Te.message,variant:"destructive"}),m(!1)):(ie({title:"Invalid PIN",description:Te.message,variant:"destructive"}),g(""));return}S("new")},M=async()=>{if(x.length!==4){ie({title:"Invalid PIN",description:"PIN must be exactly 4 digits.",variant:"destructive"});return}if(b.length!==4){ie({title:"Confirm PIN",description:"Please confirm your new PIN.",variant:"destructive"});return}if(x!==b){ie({title:"PINs do not match",description:"Please make sure both PINs are the same.",variant:"destructive"}),v(""),S("confirm");return}k(!0);const te=s==null?void 0:s.id;if(!te){k(!1),ie({title:"Error",description:"Could not find your user ID.",variant:"destructive"});return}const{error:Te}=await l(te,x);if(k(!1),Te){ie({title:"Error",description:"Failed to change PIN. Please try again.",variant:"destructive"});return}ie({title:"PIN Changed",description:"Your PIN has been updated successfully."}),m(!1)},X=()=>{C==="old"?L():C==="new"?x.length===4&&S("confirm"):C==="confirm"&&M()},G=()=>{switch(C){case"old":return"Enter Current PIN";case"new":return"Enter New PIN";case"confirm":return"Confirm New PIN"}},W=()=>{switch(C){case"old":return f;case"new":return x;case"confirm":return b}},O=te=>{switch(C){case"old":g(te);break;case"new":y(te);break;case"confirm":v(te);break}},U=async()=>{if(j){A(!0);try{const{data:{session:te}}=await ue.auth.getSession();if(!te){ie({title:"Error",description:"Please log in again.",variant:"destructive"});return}const Te=await ue.functions.invoke("cancel-subscription",{headers:{Authorization:`Bearer ${te.access_token}`}});if(Te.error)throw new Error(Te.error.message||"Failed to cancel subscription");const Ae=Te.data;if(Ae.success)ie({title:"Subscription Cancelled",description:Ae.message}),D(Se=>Se?{...Se,auto_renew:!1,cancelled_at:new Date().toISOString()}:null),I(!1);else throw new Error(Ae.error||"Failed to cancel subscription")}catch(te){console.error("Cancel subscription error:",te),ie({title:"Error",description:te.message||"Failed to cancel subscription. Please try again.",variant:"destructive"})}finally{A(!1)}}},K=te=>new Date(te).toLocaleDateString("en-IN",{timeZone:"Asia/Kolkata",day:"numeric",month:"long",year:"numeric"}),ce=((ne=t==null?void 0:t.plan)==null?void 0:ne.toLowerCase())==="orange";return r?i.jsx("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 flex items-center justify-center min-h-[60vh] max-w-2xl mx-auto",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):i.jsxs("div",{className:"w-full py-4 sm:py-6 px-3 sm:px-4 md:px-6 space-y-4 sm:space-y-6 animate-fade-up max-w-2xl mx-auto",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(de,{variant:"ghost",size:"icon",onClick:()=>e("/settings"),className:"shrink-0",children:i.jsx(Ed,{className:"h-5 w-5"})}),i.jsx("div",{children:i.jsx(Xa,{size:"sm"})})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Profile"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage your account details"})]}),i.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Ad,{className:"h-5 w-5 text-primary"}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Full Name"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{htmlFor:"fullName",children:"Your display name"}),i.jsx(At,{id:"fullName",value:c,onChange:te=>d(te.target.value),placeholder:"Enter your full name",className:"h-12"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"This name is shown on the login screen and settings"})]}),i.jsxs(de,{onClick:q,disabled:u||c===(t==null?void 0:t.full_name),className:"w-full",children:[u?"Saving...":"Save Name",i.jsx(Uw,{className:"h-4 w-4 ml-2"})]})]}),i.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Di,{className:"h-5 w-5 text-primary"}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Email"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(We,{children:"Your login email"}),i.jsx(At,{value:(t==null?void 0:t.email)||(s==null?void 0:s.email)||"",disabled:!0,className:"h-12 bg-muted/50"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Email cannot be changed as it's used for login"})]})]}),i.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-border/50 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(l2,{className:"h-5 w-5 text-primary"}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Security"})]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Change your 4-digit PIN for secure login"}),i.jsxs(de,{variant:"outline",onClick:$,className:"w-full",children:["Change PIN",i.jsx(l2,{className:"h-4 w-4 ml-2"})]})]}),ce&&i.jsxs("div",{className:"p-6 rounded-2xl bg-card border border-destructive/30 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx(Lw,{className:"h-5 w-5 text-[#F26B4F]"}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Orange Plan"})]}),F?i.jsx("div",{className:"h-10 w-full bg-muted rounded animate-pulse"}):j?i.jsx(i.Fragment,{children:j.cancelled_at?i.jsxs("div",{className:"space-y-2",children:[i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your subscription has been cancelled. You will continue to have access to premium features until ",i.jsx("span",{className:"font-semibold text-foreground",children:K(j.end_date)}),"."]}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"After this date, your account will be downgraded to the Free plan."})]}):i.jsxs(i.Fragment,{children:[i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your ",j.plan_type," subscription ",j.auto_renew?"renews":"is active until"," on ",i.jsx("span",{className:"font-semibold text-foreground",children:K(j.end_date)}),"."]}),i.jsxs(de,{variant:"outline",onClick:()=>I(!0),className:"w-full border-destructive/50 text-destructive hover:bg-destructive/10",children:["Cancel Subscription",i.jsx(Ld,{className:"h-4 w-4 ml-2"})]})]})}):i.jsx("p",{className:"text-sm text-muted-foreground",children:"You're on the Orange plan. No active subscription found."})]}),i.jsx(vn,{open:p,onOpenChange:m,children:i.jsxs(mn,{className:"max-w-sm",children:[i.jsx(wn,{children:i.jsx(Nn,{children:G()})}),i.jsxs("div",{className:"space-y-6 py-4",children:[i.jsx("div",{className:"flex justify-center",children:i.jsx(ho,{maxLength:4,value:W(),onChange:O,children:i.jsxs(po,{children:[i.jsx(cn,{index:0}),i.jsx(cn,{index:1}),i.jsx(cn,{index:2}),i.jsx(cn,{index:3})]})})}),C==="new"&&i.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Choose a 4-digit PIN you'll remember"}),C==="confirm"&&i.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Re-enter your new PIN to confirm"}),i.jsxs("div",{className:"flex gap-3",children:[C!=="old"&&i.jsx(de,{variant:"outline",className:"flex-1",onClick:()=>{C==="new"?(S("old"),y("")):C==="confirm"&&(S("new"),v(""))},disabled:w,children:"Back"}),i.jsx(de,{variant:"gradient",className:"flex-1",onClick:X,disabled:w||W().length!==4,children:w?"Please wait...":C==="confirm"?"Change PIN":"Continue"})]})]})]})}),i.jsx(Jm,{open:_,onOpenChange:I,children:i.jsxs(Wd,{children:[i.jsxs(Ud,{children:[i.jsxs(Hd,{className:"flex items-center gap-2",children:[i.jsx(Ld,{className:"h-5 w-5 text-destructive"}),"Cancel Orange Plan?"]}),i.jsxs(Gd,{className:"space-y-3",children:[i.jsx("p",{children:"Are you sure you want to cancel your Orange subscription? You will lose access to premium features including:"}),i.jsxs("ul",{className:"list-disc list-inside text-sm space-y-1",children:[i.jsx("li",{children:"Unlimited digital cards"}),i.jsx("li",{children:"Premium card layouts"}),i.jsx("li",{children:"Advanced CRM features"}),i.jsx("li",{children:"Priority support"})]}),j&&i.jsxs("p",{className:"font-medium text-foreground pt-2",children:["Your plan will remain active until ",K(j.end_date),"."]})]})]}),i.jsxs(Vd,{children:[i.jsx(Kd,{disabled:T,children:"Keep Subscription"}),i.jsx(qd,{onClick:te=>{te.preventDefault(),U()},disabled:T,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:T?"Cancelling...":"Yes, Cancel"})]})]})})]})}const rYe=()=>{const e=Xl();return N.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),i.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),i.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),i.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})};function aYe(){return i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[i.jsx("div",{className:"flex items-center justify-center mb-12",children:i.jsx(Xa,{size:"lg",asLink:!0})}),i.jsxs("div",{className:"space-y-12",children:[i.jsxs("div",{className:"text-center space-y-3",children:[i.jsx("h1",{className:"text-4xl font-bold text-foreground tracking-tight",children:"Terms of Service"}),i.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Welcome to SYNKA. By using our services, you agree to these terms."})]}),i.jsx("div",{className:"border-t border-border/50"}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"1. Service Overview"}),i.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"SYNKA provides digital business cards, CRM tools, NFC card services, analytics, and sharing features to help you connect and grow your professional network."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"2. User Accounts"}),i.jsxs("ul",{className:"space-y-3 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"You are responsible for maintaining the confidentiality of your account credentials."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"All information provided during registration must be accurate and up to date."})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"3. Service Plans"}),i.jsxs("ul",{className:"space-y-3 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Free plan includes essential features for getting started."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Orange plan unlocks premium capabilities including multiple cards, advanced analytics, and exclusive benefits."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Pricing and features may be updated with advance notice to users."})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"4. NFC Cards"}),i.jsxs("ul",{className:"space-y-3 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Physical cards are custom-made and non-refundable once production begins."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"SYNKA is not responsible for NFC compatibility limitations on certain devices."})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"5. Acceptable Use"}),i.jsx("p",{className:"text-muted-foreground",children:"By using SYNKA, you agree not to:"}),i.jsxs("ul",{className:"space-y-3 text-muted-foreground mt-3",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Misuse the platform or violate any applicable laws."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Share illegal, harmful, defamatory, or misleading content."})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Attempt to compromise, hack, or disrupt the service."})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"6. Account Termination"}),i.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"SYNKA reserves the right to suspend or terminate accounts that violate these terms or engage in activities that compromise the platform's integrity."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"7. Updates to Terms"}),i.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"These terms may be updated periodically. Continued use of SYNKA after changes constitutes acceptance of the updated terms."})]}),i.jsx("div",{className:"border-t border-border/50"}),i.jsxs("section",{className:"space-y-6",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"8. Replacement Policy"}),i.jsxs("div",{className:"space-y-4 p-6 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Applicable to All NFC Cards"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Free replacement is provided for:"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-green-500 mt-1",children:""}),i.jsx("span",{children:"NFC chip malfunction due to manufacturing defect"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-green-500 mt-1",children:""}),i.jsx("span",{children:"Card damaged during delivery"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-green-500 mt-1",children:""}),i.jsx("span",{children:"Printing or engraving errors caused by SYNKA"})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground pt-2 border-t border-border/30",children:"Replacement requests must be initiated within 30 days of product delivery. Courier charges are not applicable for approved replacements."})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Not Covered"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-1",children:""}),i.jsx("span",{children:"Lost or misplaced cards"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-1",children:""}),i.jsx("span",{children:"Physical damage from bending, scratching, water exposure, or misuse"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-1",children:""}),i.jsx("span",{children:"Customer-requested design changes or reprints"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-1",children:""}),i.jsx("span",{children:"Normal cosmetic wear over time"})]})]})]}),i.jsxs("div",{className:"space-y-4 p-6 rounded-xl bg-gradient-to-br from-orange-500/5 to-orange-500/10 border border-orange-500/20",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-1.5 h-6 bg-orange-500 rounded-full"}),i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Orange Plan  Free NFC Card Benefit"})]}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Complimentary PVC NFC card upon Annual Orange Plan activation"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"One additional free card each year after successful renewal"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"No courier charges for this benefit"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Valid only while Orange Annual subscription remains active"})]})]}),i.jsx("div",{className:"pt-3 border-t border-orange-500/20",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:["To claim: Email from your registered account to ",i.jsx("span",{className:"font-medium text-foreground",children:"orders@synka.in"})]})})]}),i.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground p-4 rounded-lg bg-muted/20",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Important Notes"}),i.jsxs("ul",{className:"space-y-2",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Replacement requests must originate from the registered account email"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"SYNKA reserves the right to verify eligibility before processing"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Replacements use the same design unless requested otherwise (charges may apply)"})]})]})]})]}),i.jsx("div",{className:"border-t border-border/50"}),i.jsxs("section",{className:"space-y-6",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"9. Cancellation & Refund Policy"}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Order Cancellation"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"All NFC cards are custom-made. Cancellation eligibility depends on production stage:"}),i.jsxs("div",{className:"space-y-4 mt-4",children:[i.jsxs("div",{className:"p-5 rounded-xl bg-green-500/5 border border-green-500/20",children:[i.jsx("h4",{className:"font-medium text-foreground mb-3",children:"Before Design Approval"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Cancellable within 24 hours of order placement or before design approval (whichever is earlier)"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Full refund issued (excluding payment gateway charges if applicable)"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-red-500/5 border border-red-500/20",children:[i.jsx("h4",{className:"font-medium text-foreground mb-3",children:"After Design Approval"}),i.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:"Once design is approved and production begins:"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Order cannot be cancelled"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"No refunds provided"})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-3 pt-3 border-t border-red-500/20",children:"Applies to both PVC and Metal NFC cards"})]})]})]}),i.jsxs("div",{className:"space-y-3 p-5 rounded-xl bg-muted/20 border border-border/50",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Design Approval Responsibility"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Designs shared via WhatsApp, Email, or Dashboard for approval"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Customer assumes full responsibility for design accuracy post-approval"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Minor variations may occur due to material or production processes"})]})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Shipping & Delivery"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Shipped orders cannot be cancelled or refunded"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Delivery timelines are estimates and may vary due to logistics"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Shipping delays do not qualify for refunds"})]})]})]}),i.jsxs("div",{className:"space-y-3 p-4 rounded-lg bg-muted/20",children:[i.jsx("h3",{className:"text-base font-medium text-foreground",children:"Replacement vs Refund"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"For manufacturing defects or delivery damage, replacement is provided instead of refunds. Refer to Section 8 for full eligibility details."})]}),i.jsxs("div",{className:"space-y-4 p-6 rounded-xl bg-gradient-to-br from-orange-500/5 to-orange-500/10 border border-orange-500/20",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-1.5 h-6 bg-orange-500 rounded-full"}),i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Orange Plan  Subscription Policy"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-foreground mb-2 text-sm",children:"Subscription Cancellation"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Cancel anytime from account settings"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Cancellation stops future billing only"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Paid periods are non-refundable"})]})]})]}),i.jsxs("div",{className:"pt-3 border-t border-orange-500/20",children:[i.jsx("h4",{className:"font-medium text-foreground mb-2 text-sm",children:"Refund Policy"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-0.5",children:""}),i.jsx("span",{children:"No refunds for partially used subscription periods"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-muted-foreground/40 mt-0.5",children:""}),i.jsx("span",{children:"No refunds for benefits already claimed (free cards, premium features)"})]})]})]}),i.jsxs("div",{className:"pt-3 border-t border-orange-500/20",children:[i.jsx("h4",{className:"font-medium text-foreground mb-2 text-sm",children:"Post-Cancellation"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Free NFC card benefit discontinued for future renewals"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Previously issued cards remain active"})]})]})]})]})]}),i.jsxs("div",{className:"space-y-3 p-5 rounded-xl bg-red-500/5 border border-red-500/20",children:[i.jsx("h3",{className:"text-base font-medium text-foreground",children:"Non-Refundable Cases"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Refunds will not be issued for:"}),i.jsxs("div",{className:"grid sm:grid-cols-2 gap-2",children:[i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Change of mind"})]}),i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Incorrect customer details"})]}),i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Customer-approved designs"})]}),i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Material color variations"})]}),i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Device NFC compatibility"})]}),i.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[i.jsx("span",{className:"text-red-500 mt-0.5",children:""}),i.jsx("span",{children:"Lost or misplaced cards"})]})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Refund Processing"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Approved refunds processed within 57 business days"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsx("span",{children:"Credited to original payment method"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"text-base font-medium text-foreground mb-3",children:"Support & Escalation"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"For cancellation or refund requests:"}),i.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:["Email ",i.jsx("span",{className:"font-medium text-foreground",children:"support@synka.in"})]})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Raise a request from your dashboard"})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-3 pt-3 border-t border-border/30",children:"All requests are reviewed on a case-by-case basis"})]})]})]}),i.jsx("div",{className:"h-16"})]})})}function sYe(){return i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-12",children:[i.jsx("div",{className:"flex items-center justify-center mb-12",children:i.jsx(Xa,{size:"lg",asLink:!0})}),i.jsxs("div",{className:"space-y-12",children:[i.jsxs("div",{className:"text-center space-y-3",children:[i.jsx("h1",{className:"text-4xl font-bold text-foreground tracking-tight",children:"Privacy Policy"}),i.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Your privacy matters to us. This policy explains how we collect, use, and protect your information."}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated: ",new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]}),i.jsx("div",{className:"border-t border-border/50"}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"1. Information We Collect"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"Account Information"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Name, email address, phone number"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Password (encrypted and securely stored)"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Profile photo and business information"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"Digital Card Data"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Business card details (job title, company, social links, documents)"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Custom card designs and layouts"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"NFC card associations and configurations"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"CRM & Contact Data"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Contacts you save or exchange cards with"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Notes, tags, and follow-up reminders you create"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Imported contact lists and event data"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"Usage & Analytics"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Card views, clicks, and engagement metrics"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Device information (type, OS, browser)"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"IP address and general location data (city/country level)"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Feature usage patterns and session data"})]})]})]}),i.jsxs("div",{className:"p-5 rounded-xl bg-muted/30 border border-border/50",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"Payment Information"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Billing address and transaction history"})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Payment details are processed securely by Razorpay (we do not store card numbers)"})]})]})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"2. How We Use Your Information"}),i.jsx("p",{className:"text-muted-foreground",children:"We use your data to:"}),i.jsxs("div",{className:"space-y-3 mt-4",children:[i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Provide Core Services"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Create and manage your digital business cards"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Enable card sharing via QR codes, NFC, and links"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Facilitate contact management and CRM features"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Analytics & Insights"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Generate card performance analytics and reports"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Track engagement metrics (views, clicks, saves)"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Communication"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Send service updates, notifications, and support responses"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Deliver subscription confirmations and billing receipts"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Share product updates and feature announcements (you can opt out)"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Service Improvement"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Improve platform performance and user experience"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Develop new features based on usage patterns"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Fix bugs and optimize application performance"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Security & Compliance"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Prevent fraud, abuse, and unauthorized access"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-green-500 mt-0.5",children:""}),i.jsx("span",{children:"Comply with legal obligations and enforce our Terms of Service"})]})]})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"3. Data Sharing & Disclosure"}),i.jsxs("div",{className:"p-5 rounded-xl bg-green-500/5 border border-green-500/20 mb-4",children:[i.jsx("p",{className:"text-foreground font-medium mb-2",children:"We do not sell your personal data to third parties."}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Your information is only shared in the following limited circumstances:"})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"When You Choose to Share"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"When you share your digital card, recipients see the information you choose to include"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Public card links are accessible to anyone with the URL"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Service Providers"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Payment processing (Razorpay) for subscription and order transactions"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Cloud hosting providers (Supabase, Vercel) for secure data storage"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Communication services (email delivery, SMS notifications)"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"Analytics tools (aggregated, anonymized data only)"})]})]}),i.jsx("p",{className:"text-xs text-muted-foreground mt-3 pt-3 border-t border-border/30",children:"All service providers are contractually bound to protect your data and use it only for authorized purposes."})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Legal Requirements"}),i.jsxs("ul",{className:"space-y-1.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"To comply with valid legal requests (court orders, subpoenas)"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"To protect rights, safety, or property of SYNKA, users, or the public"})]}),i.jsxs("li",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsx("span",{children:"To enforce our Terms of Service or investigate violations"})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Business Transfers"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"In the event of a merger, acquisition, or sale of assets, your data may be transferred to the acquiring entity. You will be notified of any such change."})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"4. Data Security"}),i.jsx("p",{className:"text-muted-foreground",children:"We implement industry-standard security measures to protect your data:"}),i.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mt-4",children:[i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-500/5 to-blue-500/10 border border-blue-500/20",children:[i.jsxs("h3",{className:"font-medium text-foreground mb-2 flex items-center gap-2",children:[i.jsx("span",{className:"text-blue-500",children:""}),i.jsx("span",{className:"text-sm",children:"Encryption"})]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Data encrypted in transit (HTTPS/TLS) and at rest"})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-500/5 to-blue-500/10 border border-blue-500/20",children:[i.jsxs("h3",{className:"font-medium text-foreground mb-2 flex items-center gap-2",children:[i.jsx("span",{className:"text-blue-500",children:""}),i.jsx("span",{className:"text-sm",children:"Access Controls"})]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Restricted access to authorized personnel only"})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-500/5 to-blue-500/10 border border-blue-500/20",children:[i.jsxs("h3",{className:"font-medium text-foreground mb-2 flex items-center gap-2",children:[i.jsx("span",{className:"text-blue-500",children:""}),i.jsx("span",{className:"text-sm",children:"Secure Infrastructure"})]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Enterprise-grade cloud hosting with automatic backups"})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-gradient-to-br from-blue-500/5 to-blue-500/10 border border-blue-500/20",children:[i.jsxs("h3",{className:"font-medium text-foreground mb-2 flex items-center gap-2",children:[i.jsx("span",{className:"text-blue-500",children:""}),i.jsx("span",{className:"text-sm",children:"Monitoring"})]}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Continuous security monitoring and threat detection"})]})]}),i.jsx("div",{className:"p-4 rounded-xl bg-amber-500/5 border border-amber-500/20 mt-4",children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:[i.jsx("span",{className:"font-medium text-foreground",children:"Important:"})," While we use best-in-class security measures, no system is 100% secure. Please use strong passwords and enable two-factor authentication when available."]})})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"5. Your Privacy Rights & Control"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"p-5 rounded-xl bg-gradient-to-br from-orange-500/5 to-orange-500/10 border border-orange-500/20",children:[i.jsx("h3",{className:"font-medium text-foreground mb-3",children:"You have full control over your data:"}),i.jsxs("ul",{className:"space-y-2.5 text-muted-foreground text-sm",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Access:"})," View all personal data we have about you"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Edit:"})," Update or correct your information anytime from your account settings"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Delete:"})," Request permanent deletion of your account and associated data"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Export:"})," Download your data in portable formats (contacts, analytics)"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Control Visibility:"})," Choose which cards are public and what information to share"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Opt-Out:"})," Unsubscribe from marketing emails at any time"]})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Data Retention"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"We retain your data as long as your account is active or as needed to provide services. After account deletion, we may retain certain data for legal, tax, or security purposes as required by law, typically for up to 90 days before permanent deletion."})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"How to Exercise Your Rights"}),i.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:"To access, modify, or delete your data, contact us at:"}),i.jsx("ul",{className:"space-y-1 text-sm text-muted-foreground",children:i.jsxs("li",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-orange-500",children:""}),i.jsxs("span",{children:["Email: ",i.jsx("span",{className:"font-medium text-foreground",children:"support@synka.in"})]})]})})]})]})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"6. Cookies & Tracking Technologies"}),i.jsx("p",{className:"text-muted-foreground",children:"We use cookies and similar technologies to enhance your experience:"}),i.jsxs("div",{className:"space-y-3 mt-4",children:[i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Essential Cookies"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Required for authentication, security, and core functionality. These cannot be disabled."})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Performance Cookies"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Help us understand how you use SYNKA to improve performance and fix issues."})]}),i.jsxs("div",{className:"p-4 rounded-lg bg-muted/20 border border-border/30",children:[i.jsx("h3",{className:"font-medium text-foreground mb-2 text-sm",children:"Analytics Cookies"}),i.jsx("p",{className:"text-muted-foreground text-sm",children:"Track aggregated usage patterns to help us develop new features (anonymized data only)."})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"You can control cookie preferences through your browser settings. Note that disabling certain cookies may affect functionality."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"7. Third-Party Services"}),i.jsx("p",{className:"text-muted-foreground",children:"SYNKA integrates with trusted third-party services:"}),i.jsxs("ul",{className:"space-y-2 mt-4 text-muted-foreground",children:[i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Razorpay:"})," Payment processing (subject to their privacy policy)"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Supabase:"})," Database and authentication services"]})]}),i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-1",children:""}),i.jsxs("span",{children:[i.jsx("strong",{className:"text-foreground",children:"Vercel:"})," Hosting and CDN"]})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"These services have their own privacy policies. We recommend reviewing them if you have concerns about how they handle data."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"8. Children's Privacy"}),i.jsx("div",{className:"p-5 rounded-xl bg-red-500/5 border border-red-500/20",children:i.jsxs("p",{className:"text-muted-foreground",children:["SYNKA is not intended for users under 18 years of age. We do not knowingly collect personal information from children. If you believe we have inadvertently collected data from a minor, please contact us immediately at ",i.jsx("span",{className:"font-medium text-foreground",children:"support@synka.in"})," and we will promptly delete it."]})})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"9. International Data Transfers"}),i.jsx("p",{className:"text-muted-foreground",children:"Your data may be stored and processed in servers located in different countries. We ensure appropriate safeguards are in place to protect your data in accordance with this privacy policy, regardless of where it is processed."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"10. Changes to This Policy"}),i.jsx("p",{className:"text-muted-foreground",children:"We may update this privacy policy periodically to reflect changes in our practices or legal requirements. We will notify you of significant changes via email or prominent notice on the platform. Your continued use of SYNKA after changes constitutes acceptance of the updated policy."})]}),i.jsxs("section",{className:"space-y-4",children:[i.jsx("h2",{className:"text-2xl font-semibold text-foreground",children:"11. Contact Us"}),i.jsxs("div",{className:"p-6 rounded-xl bg-gradient-to-br from-orange-500/5 to-orange-500/10 border border-orange-500/20",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"For privacy-related questions, concerns, or requests:"}),i.jsx("ul",{className:"space-y-2 text-muted-foreground",children:i.jsxs("li",{className:"flex items-start gap-3",children:[i.jsx("span",{className:"text-orange-500 mt-0.5",children:""}),i.jsxs("span",{children:["Email: ",i.jsx("span",{className:"font-medium text-foreground",children:"support@synka.in"})]})]})}),i.jsx("p",{className:"text-xs text-muted-foreground mt-4 pt-4 border-t border-orange-500/20",children:"We aim to respond to all privacy requests within 7 business days."})]})]})]}),i.jsx("div",{className:"h-16"})]})})}function iYe(){return i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-8",children:[i.jsx("div",{className:"flex items-center justify-center mb-8",children:i.jsx(Xa,{size:"lg",asLink:!0})}),i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:" CONTACT US"}),i.jsx("p",{className:"text-xl text-muted-foreground",children:"We'd love to hear from you."})]}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(Di,{className:"w-5 h-5 text-primary"})}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Email"})]}),i.jsxs("div",{className:"space-y-2 text-muted-foreground",children:[i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Support:"})," ",i.jsx("a",{href:"mailto:support@synka.in",className:"text-primary hover:underline",children:"support@synka.in"})]}),i.jsxs("p",{children:[i.jsx("span",{className:"font-medium",children:"Sales & Orders:"})," ",i.jsx("a",{href:"mailto:orders@synka.in",className:"text-primary hover:underline",children:"orders@synka.in"})]})]})]}),i.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(yX,{className:"w-5 h-5 text-primary"})}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Business Name"})]}),i.jsxs("div",{className:"text-muted-foreground",children:[i.jsx("p",{children:"SYNKA Technologies Pvt Ltd,"}),i.jsx("p",{children:"India"})]})]}),i.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(Ny,{className:"w-5 h-5 text-primary"})}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Website"})]}),i.jsx("div",{className:"text-muted-foreground",children:i.jsx("a",{href:"https://synka.in",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"https://synka.in"})})]}),i.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:i.jsx(Pi,{className:"w-5 h-5 text-primary"})}),i.jsx("h2",{className:"text-lg font-semibold text-foreground",children:" Support Hours"})]}),i.jsxs("div",{className:"text-muted-foreground",children:[i.jsx("p",{children:"Monday  Saturday"}),i.jsx("p",{children:"09:00 AM  7:00 PM IST"})]})]})]})]})]})})}var pk="Collapsible",[oYe,yY]=dl(pk),[lYe,HR]=oYe(pk),bY=N.forwardRef((e,t)=>{const{__scopeCollapsible:n,open:r,defaultOpen:a,disabled:s,onOpenChange:o,...l}=e,[c,d]=zl({prop:r,defaultProp:a??!1,onChange:o,caller:pk});return i.jsx(lYe,{scope:n,disabled:s,contentId:If(),open:c,onOpenToggle:N.useCallback(()=>d(u=>!u),[d]),children:i.jsx(Gn.div,{"data-state":qR(c),"data-disabled":s?"":void 0,...l,ref:t})})});bY.displayName=pk;var vY="CollapsibleTrigger",wY=N.forwardRef((e,t)=>{const{__scopeCollapsible:n,...r}=e,a=HR(vY,n);return i.jsx(Gn.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":qR(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...r,ref:t,onClick:Mn(e.onClick,a.onOpenToggle)})});wY.displayName=vY;var GR="CollapsibleContent",NY=N.forwardRef((e,t)=>{const{forceMount:n,...r}=e,a=HR(GR,e.__scopeCollapsible);return i.jsx(Yl,{present:n||a.open,children:({present:s})=>i.jsx(cYe,{...r,ref:t,present:s})})});NY.displayName=GR;var cYe=N.forwardRef((e,t)=>{const{__scopeCollapsible:n,present:r,children:a,...s}=e,o=HR(GR,n),[l,c]=N.useState(r),d=N.useRef(null),u=gr(t,d),h=N.useRef(0),p=h.current,m=N.useRef(0),f=m.current,g=o.open||l,x=N.useRef(g),y=N.useRef(void 0);return N.useEffect(()=>{const b=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(b)},[]),nl(()=>{const b=d.current;if(b){y.current=y.current||{transitionDuration:b.style.transitionDuration,animationName:b.style.animationName},b.style.transitionDuration="0s",b.style.animationName="none";const v=b.getBoundingClientRect();h.current=v.height,m.current=v.width,x.current||(b.style.transitionDuration=y.current.transitionDuration,b.style.animationName=y.current.animationName),c(r)}},[o.open,r]),i.jsx(Gn.div,{"data-state":qR(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!g,...s,ref:u,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":f?`${f}px`:void 0,...e.style},children:g&&a})});function qR(e){return e?"open":"closed"}var uYe=bY,dYe=wY,hYe=NY,To="Accordion",pYe=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[KR,mYe,fYe]=aO(To),[mk]=dl(To,[fYe,yY]),YR=yY(),kY=Ne.forwardRef((e,t)=>{const{type:n,...r}=e,a=r,s=r;return i.jsx(KR.Provider,{scope:e.__scopeAccordion,children:n==="multiple"?i.jsx(bYe,{...s,ref:t}):i.jsx(yYe,{...a,ref:t})})});kY.displayName=To;var[SY,gYe]=mk(To),[CY,xYe]=mk(To,{collapsible:!1}),yYe=Ne.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},collapsible:s=!1,...o}=e,[l,c]=zl({prop:n,defaultProp:r??"",onChange:a,caller:To});return i.jsx(SY,{scope:e.__scopeAccordion,value:Ne.useMemo(()=>l?[l]:[],[l]),onItemOpen:c,onItemClose:Ne.useCallback(()=>s&&c(""),[s,c]),children:i.jsx(CY,{scope:e.__scopeAccordion,collapsible:s,children:i.jsx(_Y,{...o,ref:t})})})}),bYe=Ne.forwardRef((e,t)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...s}=e,[o,l]=zl({prop:n,defaultProp:r??[],onChange:a,caller:To}),c=Ne.useCallback(u=>l((h=[])=>[...h,u]),[l]),d=Ne.useCallback(u=>l((h=[])=>h.filter(p=>p!==u)),[l]);return i.jsx(SY,{scope:e.__scopeAccordion,value:o,onItemOpen:c,onItemClose:d,children:i.jsx(CY,{scope:e.__scopeAccordion,collapsible:!0,children:i.jsx(_Y,{...s,ref:t})})})}),[vYe,fk]=mk(To),_Y=Ne.forwardRef((e,t)=>{const{__scopeAccordion:n,disabled:r,dir:a,orientation:s="vertical",...o}=e,l=Ne.useRef(null),c=gr(l,t),d=mYe(n),h=g1(a)==="ltr",p=Mn(e.onKeyDown,m=>{var _;if(!pYe.includes(m.key))return;const f=m.target,g=d().filter(I=>{var T;return!((T=I.ref.current)!=null&&T.disabled)}),x=g.findIndex(I=>I.ref.current===f),y=g.length;if(x===-1)return;m.preventDefault();let b=x;const v=0,w=y-1,k=()=>{b=x+1,b>w&&(b=v)},C=()=>{b=x-1,b<v&&(b=w)};switch(m.key){case"Home":b=v;break;case"End":b=w;break;case"ArrowRight":s==="horizontal"&&(h?k():C());break;case"ArrowDown":s==="vertical"&&k();break;case"ArrowLeft":s==="horizontal"&&(h?C():k());break;case"ArrowUp":s==="vertical"&&C();break}const S=b%y;(_=g[S].ref.current)==null||_.focus()});return i.jsx(vYe,{scope:n,disabled:r,direction:a,orientation:s,children:i.jsx(KR.Slot,{scope:n,children:i.jsx(Gn.div,{...o,"data-orientation":s,ref:c,onKeyDown:r?void 0:p})})})}),d1="AccordionItem",[wYe,XR]=mk(d1),jY=Ne.forwardRef((e,t)=>{const{__scopeAccordion:n,value:r,...a}=e,s=fk(d1,n),o=gYe(d1,n),l=YR(n),c=If(),d=r&&o.value.includes(r)||!1,u=s.disabled||e.disabled;return i.jsx(wYe,{scope:n,open:d,disabled:u,triggerId:c,children:i.jsx(uYe,{"data-orientation":s.orientation,"data-state":DY(d),...l,...a,ref:t,disabled:u,open:d,onOpenChange:h=>{h?o.onItemOpen(r):o.onItemClose(r)}})})});jY.displayName=d1;var IY="AccordionHeader",TY=Ne.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=fk(To,n),s=XR(IY,n);return i.jsx(Gn.h3,{"data-orientation":a.orientation,"data-state":DY(s.open),"data-disabled":s.disabled?"":void 0,...r,ref:t})});TY.displayName=IY;var F_="AccordionTrigger",EY=Ne.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=fk(To,n),s=XR(F_,n),o=xYe(F_,n),l=YR(n);return i.jsx(KR.ItemSlot,{scope:n,children:i.jsx(dYe,{"aria-disabled":s.open&&!o.collapsible||void 0,"data-orientation":a.orientation,id:s.triggerId,...l,...r,ref:t})})});EY.displayName=F_;var AY="AccordionContent",RY=Ne.forwardRef((e,t)=>{const{__scopeAccordion:n,...r}=e,a=fk(To,n),s=XR(AY,n),o=YR(n);return i.jsx(hYe,{role:"region","aria-labelledby":s.triggerId,"data-orientation":a.orientation,...o,...r,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...e.style}})});RY.displayName=AY;function DY(e){return e?"open":"closed"}var NYe=kY,kYe=jY,SYe=TY,MY=EY,$Y=RY;const Cm=NYe,xn=N.forwardRef(({className:e,...t},n)=>i.jsx(kYe,{ref:n,className:Ie("border-b",e),...t}));xn.displayName="AccordionItem";const yn=N.forwardRef(({className:e,children:t,...n},r)=>i.jsx(SYe,{className:"flex",children:i.jsxs(MY,{ref:r,className:Ie("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",e),...n,children:[t,i.jsx(vy,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));yn.displayName=MY.displayName;const bn=N.forwardRef(({className:e,children:t,...n},r)=>i.jsx($Y,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:i.jsx("div",{className:Ie("pb-4 pt-0",e),children:t})}));bn.displayName=$Y.displayName;function CYe(){return i.jsx("div",{className:"min-h-screen bg-background",children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsx("div",{className:"flex items-center justify-center mb-8",children:i.jsx(Xa,{size:"lg",asLink:!0})}),i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("p",{className:"text-lg text-muted-foreground",children:"Smart Digital Business Cards  CRM  NFC  Analytics"}),i.jsx("p",{className:"text-primary font-medium mt-2",children:" One Card. Infinite Possibilities."})]}),i.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 mb-8",children:[i.jsx("p",{className:"text-muted-foreground",children:"With SYNKA, your QR, Link, and Physical NFC Card always remain the same, but what you share can change anytime."}),i.jsxs("ul",{className:"mt-4 space-y-2 text-muted-foreground",children:[i.jsx("li",{children:" One QR"}),i.jsx("li",{children:" One Link"}),i.jsx("li",{children:" One Physical Card"}),i.jsx("li",{children:" Multiple digital cards inside"})]}),i.jsx("p",{className:"mt-4 text-foreground font-medium",children:" Your default card is what opens when:"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-muted-foreground",children:[i.jsx("li",{children:" Someone scans your QR"}),i.jsx("li",{children:" Someone taps your NFC card"}),i.jsx("li",{children:" Someone opens your link"})]}),i.jsx("p",{className:"mt-4 text-primary",children:"You can change the default card anytime  without changing your QR or physical card."})]}),i.jsxs("div",{className:"space-y-8",children:[i.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Getting Started (Basics)"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"what-is-card",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"What is a Card?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{children:"A Card is your digital identity:"}),i.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[i.jsx("li",{children:"Name"}),i.jsx("li",{children:"Company"}),i.jsx("li",{children:"Role"}),i.jsx("li",{children:"Contact details"}),i.jsx("li",{children:"Social links"}),i.jsx("li",{children:"Files (Orange)"}),i.jsx("li",{children:"Analytics & CRM tracking"})]}),i.jsx("p",{className:"mt-3",children:"You can create:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"1 card (Free)"}),i.jsx("li",{children:"Multiple cards (Orange)"})]})]})]}),i.jsxs(xn,{value:"sharing",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"How Sharing Works (Very Important)"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full mt-2",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b border-border",children:[i.jsx("th",{className:"text-left py-2 font-medium",children:"Method"}),i.jsx("th",{className:"text-left py-2 font-medium",children:"What Opens"})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{className:"border-b border-border/50",children:[i.jsx("td",{className:"py-2",children:"QR Scan"}),i.jsx("td",{children:"Default Card"})]}),i.jsxs("tr",{className:"border-b border-border/50",children:[i.jsx("td",{className:"py-2",children:"Link Click"}),i.jsx("td",{children:"Default Card"})]}),i.jsxs("tr",{className:"border-b border-border/50",children:[i.jsx("td",{className:"py-2",children:"NFC Tap"}),i.jsx("td",{children:"Default Card"})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"py-2",children:"Physical Card"}),i.jsx("td",{children:"Same Default Card"})]})]})]})}),i.jsx("p",{className:"mt-4 text-primary font-medium",children:" Change the default card  everything updates automatically"})]})]}),i.jsxs(xn,{value:"orange",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:" Orange Upgrade (Pro Experience)"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{children:"Upgrade to Orange from Settings to unlock:"}),i.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[i.jsx("li",{children:"Multiple cards"}),i.jsx("li",{children:"File uploads (pitch, catalogue, docs)"}),i.jsx("li",{children:"Advanced analytics"}),i.jsx("li",{children:"One-click templates"}),i.jsx("li",{children:"NFC writer"}),i.jsx("li",{children:"CRM automation"}),i.jsx("li",{children:"Email signature"}),i.jsx("li",{children:"Premium share & download designs"}),i.jsx("li",{children:"Physical card ordering"})]})]})]}),i.jsxs(xn,{value:"my-card",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"MY CARD  How to Use"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Switching Cards"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Tap My Card in the header"}),i.jsx("li",{children:"Single tap on any card  view that card"}),i.jsx("li",{children:"Star   makes that card default"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Editing Card Name"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Double-tap card name  rename"}),i.jsx("li",{children:"Auto-saved"}),i.jsx("li",{children:"No popup if name is unchanged"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Upload Photo / Logo"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Tap Edit on My Card"}),i.jsx("li",{children:"Add: Profile photo, Company logo"})]})]})]})]}),i.jsxs(xn,{value:"files",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Files on Card (Orange Only)"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{children:"You can upload:"}),i.jsxs("ul",{className:"list-disc list-inside mt-2",children:[i.jsx("li",{children:"Pitch deck"}),i.jsx("li",{children:"Catalogue"}),i.jsx("li",{children:"PDF"}),i.jsx("li",{children:"Documents"})]}),i.jsx("p",{className:"mt-3",children:"When someone opens your card:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Files are instantly downloadable"}),i.jsx("li",{children:"Each download is tracked in analytics"})]})]})]}),i.jsxs(xn,{value:"share-download",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Share & Download Card"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Share Options"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"WhatsApp"}),i.jsx("li",{children:"LinkedIn"}),i.jsx("li",{children:"Copy link"}),i.jsx("li",{children:"Download Card Image"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Download Card Image"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Generates a beautiful image in real time"}),i.jsx("li",{children:"Includes: Name, QR, Clickable link"})]}),i.jsx("p",{className:"mt-2",children:"Perfect for:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"WhatsApp status"}),i.jsx("li",{children:"LinkedIn posts"}),i.jsx("li",{children:"Offline sharing"})]})]})]})]}),i.jsxs(xn,{value:"nfc-cards",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Physical NFC Cards"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Available Materials"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"PVC"}),i.jsx("li",{children:"Metal Gold"}),i.jsx("li",{children:"Metal Silver"}),i.jsx("li",{children:"Metal Rose Gold"}),i.jsx("li",{children:"Metal Black"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Customisation"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"PVC  any color or design (photo designs supported)"}),i.jsx("li",{children:"Metal cards: Name, Role, Company logo (Fully engraved)"})]}),i.jsx("p",{className:"mt-2",children:"Choose from:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"In-house designer templates"}),i.jsx("li",{children:"Or share your own idea"})]})]})]})]}),i.jsxs(xn,{value:"nfc-how",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"How NFC Works"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsxs("ul",{className:"space-y-2",children:[i.jsxs("li",{children:[i.jsx("span",{className:"font-medium",children:"Android:"})," Tap card on back of phone"]}),i.jsxs("li",{children:[i.jsx("span",{className:"font-medium",children:"iPhone:"})," Tap card on front / top"]})]}),i.jsx("p",{className:"mt-3 text-primary",children:"Screen must be ON"})]})]}),i.jsxs(xn,{value:"nfc-writer",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"NFC Writer (Orange)"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[i.jsx("li",{children:"Go to Settings  NFC Writer"}),i.jsx("li",{children:"Tap Write"}),i.jsx("li",{children:"Place card: Android  back, iPhone  front"}),i.jsx("li",{children:"Get confirmation  Card written"})]}),i.jsx("p",{className:"mt-3 text-primary",children:"Now your physical card opens your default digital card."})]})]}),i.jsxs(xn,{value:"crm",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"CRM  Contacts & Notes"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"How Contacts Are Captured"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Someone scans your card"}),i.jsx("li",{children:"Someone taps your NFC"}),i.jsx("li",{children:"Someone submits their details"}),i.jsx("li",{children:"You scan their physical card"}),i.jsx("li",{children:"Manual entry"})]}),i.jsx("p",{className:"mt-2",children:"All contacts go directly into CRM."})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Notes & History (Powerful Feature)"}),i.jsx("p",{className:"mt-1",children:"You can instantly log:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:" Calls"}),i.jsx("li",{children:" Emails"}),i.jsx("li",{children:" WhatsApp"}),i.jsx("li",{children:" Manual notes"})]}),i.jsx("p",{className:"mt-2",children:"One-tap capture  stored against contact."})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Auto Tags & Events"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Auto-tag contacts by: Event, Source, Card used"}),i.jsx("li",{children:"Schedule events"}),i.jsx("li",{children:"View performance per event"})]})]})]})]}),i.jsxs(xn,{value:"analytics",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Analytics & Reports"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Track:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Card views"}),i.jsx("li",{children:"QR scans"}),i.jsx("li",{children:"NFC taps"}),i.jsx("li",{children:"Calls"}),i.jsx("li",{children:"Emails"}),i.jsx("li",{children:"WhatsApp clicks"}),i.jsx("li",{children:"File downloads"})]}),i.jsx("p",{className:"font-medium text-foreground mt-4",children:"Advanced Reports"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Interaction-based analytics"}),i.jsx("li",{children:"Event-wise analytics"}),i.jsx("li",{children:"Touch-base reports"})]})]})]}),i.jsxs(xn,{value:"email-signature",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Email Signature"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Available Formats"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"HTML Signature"}),i.jsx("li",{children:"Image Signature"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Supported By"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Gmail"}),i.jsx("li",{children:"Outlook"}),i.jsx("li",{children:"Apple Mail"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Create Signature"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Choose from templates"}),i.jsx("li",{children:'Or ask AI: "Create a minimal blue email signature with logo on right"'})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground",children:"Custom Controls"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Photo on/off"}),i.jsx("li",{children:"Logo on/off"}),i.jsx("li",{children:"Text alignment"}),i.jsx("li",{children:"Colors"})]})]}),i.jsx("p",{className:"text-primary mt-2",children:" HTML signatures must be set on laptop/PC (Mobile email apps don't support HTML signatures)"})]})]}),i.jsxs(xn,{value:"templates",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"One-Click Templates & AI"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"font-medium text-foreground",children:"What You Can Do"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"One-click WhatsApp / Email templates"}),i.jsx("li",{children:"Auto-fill: Contact name, Company, Your name"}),i.jsx("li",{children:"Generate messages with AI"}),i.jsx("li",{children:"Edit or reuse templates anytime"})]})]})]}),i.jsxs(xn,{value:"crm-filters",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"CRM Filters"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{children:"Filter contacts by:"}),i.jsxs("ul",{className:"list-disc list-inside mt-1",children:[i.jsx("li",{children:"Name"}),i.jsx("li",{children:"Date added"}),i.jsx("li",{children:"Last interaction (call / note / WhatsApp / email)"})]})]})]}),i.jsxs(xn,{value:"ordering",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Ordering Physical Cards"}),i.jsx(bn,{className:"text-muted-foreground",children:i.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[i.jsx("li",{children:"Go to Settings"}),i.jsx("li",{children:"Choose card type"}),i.jsx("li",{children:"Select design or share your idea"}),i.jsx("li",{children:"Place order"})]})})]})]}),i.jsx("h2",{className:"text-2xl font-bold text-foreground mt-12",children:" FREQUENTLY ASKED QUESTIONS (FAQ)"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"faq-1",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Will my QR or physical card change if I change cards?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"text-primary font-medium",children:"No."}),i.jsx("p",{children:"Your QR, link, and physical card always stay the same."})]})]}),i.jsxs(xn,{value:"faq-2",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Can I choose what card opens when scanned?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"text-primary font-medium",children:"Yes."}),i.jsx("p",{children:"Just change the default card."})]})]}),i.jsxs(xn,{value:"faq-3",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Can I have multiple cards for different purposes?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"text-primary font-medium",children:"Yes (Orange)."}),i.jsx("p",{children:"Work, Personal, Event, Product, etc."})]})]}),i.jsxs(xn,{value:"faq-4",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Does SYNKA work without internet?"}),i.jsx(bn,{className:"text-muted-foreground",children:i.jsxs("ul",{className:"list-disc list-inside",children:[i.jsx("li",{children:"NFC tap opens link"}),i.jsx("li",{children:"Internet needed to load card"})]})})]}),i.jsxs(xn,{value:"faq-5",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Can others send me their details?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"text-primary font-medium",children:"Yes."}),i.jsx("p",{children:"Via your public card or physical card scan."})]})]}),i.jsxs(xn,{value:"faq-6",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-medium",children:"Q. Is my data secure?"}),i.jsxs(bn,{className:"text-muted-foreground",children:[i.jsx("p",{className:"text-primary font-medium",children:"Yes."}),i.jsx("p",{children:"Enterprise-grade security with full control."})]})]})]}),i.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 border border-primary/20 rounded-xl p-6 mt-12",children:[i.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:" Why SYNKA is Different"}),i.jsxs("ul",{className:"space-y-2 text-muted-foreground",children:[i.jsx("li",{children:" One card, infinite flexibility"}),i.jsx("li",{children:" India's first dynamic NFC ecosystem"}),i.jsx("li",{children:" CRM + Analytics + NFC + AI in one app"}),i.jsx("li",{children:" Built for founders, sales teams, professionals"})]})]})]})]})})}function _Ye(){const e=Pa(),[t,n]=N.useState("getting-started");return i.jsxs("div",{className:"min-h-screen bg-background",children:[i.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[i.jsx("div",{className:"flex items-center justify-center mb-6",children:i.jsx(Xa,{size:"lg",asLink:!0})}),i.jsxs("div",{className:"text-center mb-10 space-y-4",children:[i.jsx("div",{className:"inline-flex items-center px-4 py-1.5 rounded-full bg-primary/10 text-primary text-sm font-medium mb-2",children:"Welcome to SYNKA"}),i.jsx("h1",{className:"text-4xl md:text-5xl font-bold",children:"Meet Your Smart NFC Business Card"}),i.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Your complete guide to getting started with your Synka NFC card. Learn how to tap, scan, customize, and make the most of your digital business card."})]}),i.jsx(Tn,{className:"mb-8 border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10",children:i.jsx(Dn,{className:"pt-6",children:i.jsx("div",{children:i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Quick Start in 3 Steps"}),i.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mt-4",children:[i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"1"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"Tap or Scan"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Hold card near phone or scan QR"})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"2"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"View Profile"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"See contact info instantly"})]})]}),i.jsxs("div",{className:"flex items-start gap-3",children:[i.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold",children:"3"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"Save Contact"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"One-tap save to phone"})]})]})]})]})})})}),i.jsxs("div",{className:"flex flex-wrap gap-2 mb-8 p-1 bg-muted rounded-lg",children:[i.jsx(de,{variant:t==="getting-started"?"default":"ghost",onClick:()=>n("getting-started"),className:"flex-1 min-w-[140px]",children:"Getting Started"}),i.jsx(de,{variant:t==="setup"?"default":"ghost",onClick:()=>n("setup"),className:"flex-1 min-w-[140px]",children:"Setup Your Card"}),i.jsx(de,{variant:t==="features"?"default":"ghost",onClick:()=>n("features"),className:"flex-1 min-w-[140px]",children:"Features"}),i.jsx(de,{variant:t==="tips"?"default":"ghost",onClick:()=>n("tips"),className:"flex-1 min-w-[140px]",children:"Tips & Care"})]}),i.jsxs("div",{className:"space-y-6",children:[t==="getting-started"&&i.jsxs("div",{className:"space-y-6 animate-fade-in",children:[i.jsxs("section",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"How to Use Your Card"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"nfc-tap",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"NFC Tap (Recommended)"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"For Smartphones (NFC-enabled):"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Ensure NFC is ON:"})," Check your phone's settings  NFC/Wireless"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Unlock your phone"})," (screen must be on)"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Hold the card"})," near the back of the recipient's phone (usually top 1/3)"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Keep it steady"})," for 1-2 seconds"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Wait for vibration"})," or notification"]}),i.jsx("li",{children:"Your profile opens automatically in their browser"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"font-medium mb-2",children:"Where to tap on different phones:"}),i.jsxs("ul",{className:"space-y-1 text-sm ml-6",children:[i.jsxs("li",{children:[" ",i.jsx("strong",{children:"iPhone:"})," Top back (near camera)"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Samsung/Android:"})," Center back or near camera"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Google Pixel:"})," Center to top back"]})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-2",children:"Pro Tips:"}),i.jsxs("ul",{className:"text-sm space-y-1",children:[i.jsx("li",{children:" Remove thick phone cases for better connection"}),i.jsx("li",{children:" Don't tap too fast - hold steady for 1-2 seconds"}),i.jsx("li",{children:" Works through thin cases and wallets"}),i.jsx("li",{children:" No app needed - works with any NFC-enabled phone"})]})]})]})})]}),i.jsxs(xn,{value:"qr-scan",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"QR Code Scanning"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Three Ways to Scan:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border-l-4 border-primary pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Method 1: Camera App (Easiest)"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Open your phone's Camera app"}),i.jsx("li",{children:"Point at the QR code"}),i.jsx("li",{children:"Tap the notification that appears"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Method 2: Control Center (iPhone)"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Swipe down from top-right (Control Center)"}),i.jsx("li",{children:"Tap the QR scanner icon"}),i.jsx("li",{children:"Scan the code"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/40 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Method 3: Quick Settings (Android)"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Swipe down from top (Quick Settings)"}),i.jsx("li",{children:'Find "Scan QR code" tile'}),i.jsx("li",{children:"Tap and scan"})]})]})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"font-medium mb-2",children:"QR Code Locations on Your Card:"}),i.jsxs("ul",{className:"space-y-1 text-sm",children:[i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Front:"})," Main QR code (usually visible)"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Back:"})," Alternative QR code"]}),i.jsx("li",{children:" Both codes work the same way"})]})]})]})})]}),i.jsxs(xn,{value:"link-share",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Share Your Link"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsx("p",{children:"Your Synka card has a unique personal link that you can share anywhere:"}),i.jsx("div",{className:"bg-muted/50 rounded-lg p-4",children:i.jsx("p",{className:"font-mono text-sm text-primary",children:"synka.in/u/yourname"})}),i.jsx("p",{className:"font-medium text-foreground",children:"Where to Share:"}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-sm",children:"Email Signature"}),i.jsx("p",{className:"text-xs mt-1",children:"Add to your email footer"})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-sm",children:"WhatsApp/SMS"}),i.jsx("p",{className:"text-xs mt-1",children:"Send directly in messages"})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-sm",children:"LinkedIn Bio"}),i.jsx("p",{className:"text-xs mt-1",children:"Add to profile or posts"})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-sm",children:"Social Media"}),i.jsx("p",{className:"text-xs mt-1",children:"Instagram, Twitter, etc."})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-2",children:"Smart Tip:"}),i.jsx("p",{className:"text-sm",children:"Use the Share button in your card to send via WhatsApp, Email, SMS, or copy the link!"})]})]})})]})]})]}),i.jsxs("section",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"What Happens When Someone Taps/Scans?"}),i.jsx(Tn,{children:i.jsx(Dn,{className:"pt-6",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{children:i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"Instant Profile View"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Your digital card opens in their web browser"})]})}),i.jsx("div",{children:i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"All Contact Info Visible"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Name, company, role, phone, email, social links"})]})}),i.jsx("div",{children:i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"One-Tap Actions"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Call, email, WhatsApp, or save contact directly"})]})}),i.jsx("div",{children:i.jsxs("div",{children:[i.jsx("p",{className:"font-medium",children:"No App Required"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Works on any smartphone with NFC or camera"})]})})]})})})]})]}),t==="setup"&&i.jsx("div",{className:"space-y-6 animate-fade-in",children:i.jsxs("section",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Setup & Customize Your Card"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"create-account",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Step 1: Create Your Account"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("ol",{className:"list-decimal list-inside space-y-3 ml-2",children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Visit"})," ",i.jsx("span",{className:"font-mono text-primary",children:"synka.in"})," or download the Synka app"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Sign up"})," with your phone number or email"]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Verify"})," with the OTP sent to you"]}),i.jsx("li",{children:"You're in! Your digital card is automatically created"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"font-medium mb-2",children:"App Available On:"}),i.jsxs("div",{className:"flex gap-3",children:[i.jsx(de,{variant:"outline",size:"sm",asChild:!0,children:i.jsx("a",{href:"https://play.google.com/store/apps/details?id=com.synka.app",target:"_blank",rel:"noopener noreferrer",children:"Google Play"})}),i.jsx(de,{variant:"outline",size:"sm",asChild:!0,children:i.jsx("a",{href:"https://apps.apple.com/app/synka",target:"_blank",rel:"noopener noreferrer",children:"App Store"})})]})]})]})]}),i.jsxs(xn,{value:"edit-profile",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Step 2: Edit Your Profile"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsxs("p",{children:["Go to ",i.jsx("strong",{children:"My Card"})," section and fill in:"]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Basic Information"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:" Full Name"}),i.jsx("li",{children:" Company Name"}),i.jsx("li",{children:" Job Title / Role"}),i.jsx("li",{children:" Short Bio (optional)"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Contact Details"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:" Phone Number"}),i.jsx("li",{children:" Email Address"}),i.jsx("li",{children:" Website URL"}),i.jsx("li",{children:" WhatsApp Number"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Social Links"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:" LinkedIn Profile"}),i.jsx("li",{children:" Instagram, Twitter, Facebook"}),i.jsx("li",{children:" YouTube, TikTok"}),i.jsx("li",{children:" Any custom links"})]})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-2",children:"All changes save automatically!"}),i.jsx("p",{className:"text-sm",children:'No need to click "Save" - your card updates in real-time'})]})]})]}),i.jsxs(xn,{value:"upload-photos",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Step 3: Upload Photos"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Profile Photo:"}),i.jsxs("ul",{className:"space-y-2 text-sm ml-4",children:[i.jsx("li",{children:" Tap on the profile image placeholder"}),i.jsx("li",{children:" Choose from Gallery or Take New Photo"}),i.jsx("li",{children:" Crop and adjust as needed"}),i.jsx("li",{children:" Best: Professional headshot, clear background"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Company Logo:"}),i.jsxs("ul",{className:"space-y-2 text-sm ml-4",children:[i.jsx("li",{children:" Tap on logo section"}),i.jsx("li",{children:" Upload your company/brand logo"}),i.jsx("li",{children:" PNG or JPG format recommended"}),i.jsx("li",{children:" Transparent background works best"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Cover Image (Optional):"}),i.jsxs("ul",{className:"space-y-2 text-sm ml-4",children:[i.jsx("li",{children:" Add a header/banner image"}),i.jsx("li",{children:" Showcases your work or brand"}),i.jsx("li",{children:" Landscape format preferred"})]})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium mb-2 text-sm",children:"Photo Tips:"}),i.jsxs("ul",{className:"text-xs space-y-1",children:[i.jsx("li",{children:" Use high-quality images (not blurry)"}),i.jsx("li",{children:" Good lighting for profile photos"}),i.jsx("li",{children:" Face should be clearly visible"}),i.jsx("li",{children:" Images auto-optimize for fast loading"})]})]})]})})]}),i.jsxs(xn,{value:"design-layout",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Step 4: Choose Design Layout"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Synka offers multiple card layouts to match your style:"}),i.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[i.jsxs("div",{className:"border rounded-lg p-3 bg-muted/30",children:[i.jsx("p",{className:"font-medium text-foreground mb-1",children:"Classic Layout"}),i.jsx("p",{className:"text-xs",children:"Traditional business card style"})]}),i.jsxs("div",{className:"border rounded-lg p-3 bg-muted/30",children:[i.jsx("p",{className:"font-medium text-foreground mb-1",children:"Modern Layout"}),i.jsx("p",{className:"text-xs",children:"Clean, minimal design"})]}),i.jsxs("div",{className:"border rounded-lg p-3 bg-muted/30",children:[i.jsx("p",{className:"font-medium text-foreground mb-1",children:"Creative Layout"}),i.jsx("p",{className:"text-xs",children:"Bold and colorful"})]}),i.jsxs("div",{className:"border rounded-lg p-3 bg-muted/30",children:[i.jsx("p",{className:"font-medium text-foreground mb-1",children:"Professional Layout"}),i.jsx("p",{className:"text-xs",children:"Corporate and elegant"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"How to Change Layout:"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm ml-2",children:[i.jsx("li",{children:'Go to "My Card" section'}),i.jsx("li",{children:'Tap on "Change Layout" or layout icon'}),i.jsx("li",{children:"Preview different styles"}),i.jsx("li",{children:"Select your favorite"}),i.jsx("li",{children:"Updates instantly!"})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Orange (Pro) Feature:"}),i.jsx("p",{className:"text-sm",children:"Access premium layouts and custom color themes with Orange upgrade"})]})]})]}),i.jsxs(xn,{value:"multiple-cards",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Managing Multiple Cards (Orange)"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"With Orange (Pro) subscription, create multiple digital cards for different contexts:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Professional Card"}),i.jsx("p",{className:"text-sm",children:"For work contacts and business networking"})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Creative Card"}),i.jsx("p",{className:"text-sm",children:"For freelance projects and portfolio"})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Team Cards"}),i.jsx("p",{className:"text-sm",children:"Different cards for different roles or departments"})]})]}),i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Setting Your Default Card:"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm ml-2",children:[i.jsx("li",{children:"Go to Dashboard or My Card section"}),i.jsx("li",{children:"View all your cards"}),i.jsx("li",{children:"Tap the star icon on the card you want as default"}),i.jsx("li",{children:"This card will open when anyone taps your NFC or scans QR"})]})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium mb-2",children:"Switch Anytime:"}),i.jsx("p",{className:"text-sm",children:"Change your default card as many times as you want. Your physical card and QR always point to your default card - no reprinting needed!"})]})]})]}),i.jsxs(xn,{value:"upload-documents",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Upload Documents & Files (Orange)"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Orange users can attach files directly to their digital cards:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"What You Can Upload:"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:" Product Catalogues (PDF)"}),i.jsx("li",{children:" Business Presentations"}),i.jsx("li",{children:" Price Lists"}),i.jsx("li",{children:" Portfolios"}),i.jsx("li",{children:" Brochures"}),i.jsx("li",{children:" Company Profile"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"How to Upload:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Go to My Card  Documents section"}),i.jsx("li",{children:'Tap "Upload Document"'}),i.jsx("li",{children:"Choose file from device"}),i.jsx("li",{children:"Add a title/description"}),i.jsx("li",{children:"File appears on your card automatically"})]})]})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium mb-2 text-sm",children:"Supported Formats:"}),i.jsx("p",{className:"text-xs",children:"PDF, DOC, DOCX, PPT, PPTX, JPG, PNG"}),i.jsx("p",{className:"text-xs mt-2",children:"Max file size: 10MB per file"})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Use Case:"}),i.jsx("p",{className:"text-sm",children:"Perfect for sales meetings - share your product catalogue instantly when someone taps your card!"})]})]})]}),i.jsxs(xn,{value:"write-nfc",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Step 5: Write NFC Card"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Program your NFC card to link directly to your digital profile:"}),i.jsx("div",{className:"space-y-3",children:i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"How to Write Your NFC Card:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-2 text-sm",children:[i.jsxs("li",{children:["Go to ",i.jsx("strong",{children:"Settings"})," page in the app"]}),i.jsxs("li",{children:["Tap on ",i.jsx("strong",{children:"Write NFC Card"})," option"]}),i.jsx("li",{children:"Hold your NFC card near the back of your phone"}),i.jsx("li",{children:"Keep it steady until you see the success message"}),i.jsx("li",{children:"Your card is now programmed with your profile link!"})]})]})}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium mb-2 text-sm",children:"Requirements:"}),i.jsxs("ul",{className:"text-xs space-y-1",children:[i.jsx("li",{children:" NFC-enabled smartphone"}),i.jsx("li",{children:" NFC must be turned ON in phone settings"}),i.jsx("li",{children:" Blank or rewritable NFC card"})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Pro Tip:"}),i.jsx("p",{className:"text-sm",children:"You can rewrite your NFC card anytime if you change your default card or profile link!"})]})]})]})]})]})}),t==="features"&&i.jsx("div",{className:"space-y-6 animate-fade-in",children:i.jsxs("section",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Powerful Features at Your Fingertips"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"analytics",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Analytics & Insights"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Track how people interact with your card:"}),i.jsxs("div",{className:"grid gap-3",children:[i.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-3",children:[i.jsx("div",{className:"p-2 rounded bg-primary/10",children:i.jsx("div",{className:"h-4 w-4 text-primary"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Profile Views"}),i.jsx("p",{className:"text-sm",children:"See how many people viewed your card"})]})]}),i.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-3",children:[i.jsx("div",{className:"p-2 rounded bg-primary/10",children:i.jsx("div",{className:"h-4 w-4 text-primary"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Click Tracking"}),i.jsx("p",{className:"text-sm",children:"Monitor which links get the most clicks"})]})]}),i.jsxs("div",{className:"flex items-start gap-3 border rounded-lg p-3",children:[i.jsx("div",{className:"p-2 rounded bg-primary/10",children:i.jsx("div",{className:"h-4 w-4 text-primary"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Scan History"}),i.jsx("p",{className:"text-sm",children:"Know when and where your card was shared"})]})]})]}),i.jsx("p",{className:"text-sm",children:"Access analytics from your Dashboard"})]})]}),i.jsxs(xn,{value:"crm",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Built-in CRM"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Manage all your contacts in one place:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Automatic Contact Capture"}),i.jsx("p",{className:"text-sm mt-1",children:"When someone saves your contact, they're added to your CRM automatically"})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Add Notes"}),i.jsx("p",{className:"text-sm mt-1",children:"Keep track of conversations, meetings, and follow-ups"})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Tag Contacts"}),i.jsx("p",{className:"text-sm mt-1",children:"Organize by categories: Client, Lead, Partner, etc."})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Follow-up Reminders"}),i.jsx("p",{className:"text-sm mt-1",children:"Never miss an important follow-up"})]})]}),i.jsx("p",{className:"text-sm font-medium text-primary",children:"Access CRM from the navigation menu"})]})]}),i.jsxs(xn,{value:"mutual-exchange",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Mutual Contact Exchange"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Exchange contacts seamlessly with other Synka users:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"How It Works:"}),i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm",children:[i.jsx("li",{children:"Tap your card with another Synka user"}),i.jsx("li",{children:"Both of you see each other's profiles"}),i.jsx("li",{children:'Choose to "Exchange Contacts"'}),i.jsx("li",{children:"Both contacts are saved automatically to each other's CRM"})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-1",children:"Instant & Effortless"}),i.jsx("p",{className:"text-sm",children:"No manual typing, no phone number exchange, no app switching"})]})]})]})]}),i.jsxs(xn,{value:"email-signature",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Email Signature Generator"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Create a professional email signature with your Synka card link:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm ml-2",children:[i.jsx("li",{children:"Go to Settings  Email Signature"}),i.jsx("li",{children:"Customize your signature design"}),i.jsx("li",{children:"Add your Synka card link"}),i.jsx("li",{children:"Copy the HTML code"}),i.jsx("li",{children:"Paste into your email client settings"})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium mb-2 text-sm",children:"Works with:"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[i.jsx("span",{className:"text-xs bg-background px-2 py-1 rounded",children:"Gmail"}),i.jsx("span",{className:"text-xs bg-background px-2 py-1 rounded",children:"Outlook"}),i.jsx("span",{className:"text-xs bg-background px-2 py-1 rounded",children:"Apple Mail"}),i.jsx("span",{className:"text-xs bg-background px-2 py-1 rounded",children:"Thunderbird"})]})]})]}),i.jsx("p",{className:"text-sm",children:"Every email you send promotes your digital card!"})]})]}),i.jsxs(xn,{value:"widgets",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Mobile Widgets (iOS & Android)"}),i.jsxs(bn,{className:"text-muted-foreground space-y-4",children:[i.jsx("p",{children:"Add your QR code as a home screen widget for instant sharing:"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"iOS Widget:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Long press on home screen"}),i.jsx("li",{children:'Tap "+" to add widget'}),i.jsx("li",{children:'Search for "Synka"'}),i.jsx("li",{children:"Select QR widget size"}),i.jsx("li",{children:"Add to home screen"})]})]}),i.jsxs("div",{className:"border-l-4 border-primary/60 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Android Widget:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-sm",children:[i.jsx("li",{children:"Long press on home screen"}),i.jsx("li",{children:'Tap "Widgets"'}),i.jsx("li",{children:"Find Synka widgets"}),i.jsx("li",{children:"Drag QR widget to screen"})]})]})]}),i.jsx("p",{className:"text-sm text-primary font-medium",children:"Your QR code is always accessible - just show your phone!"})]})]})]})]})}),t==="tips"&&i.jsx("div",{className:"space-y-6 animate-fade-in",children:i.jsxs("section",{children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Tips & Card Care"}),i.jsxs(Cm,{type:"single",collapsible:!0,className:"space-y-4",children:[i.jsxs(xn,{value:"best-practices",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Best Practices for Using Your Card"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"border-l-4 border-green-500 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"DO's:"}),i.jsxs("ul",{className:"mt-2 space-y-2 text-sm",children:[i.jsx("li",{children:" Keep your profile information up-to-date"}),i.jsx("li",{children:" Use a clear, professional profile photo"}),i.jsx("li",{children:" Test your card after major updates"}),i.jsx("li",{children:" Add multiple contact methods (phone, email, WhatsApp)"}),i.jsx("li",{children:" Keep your physical card in your wallet or card holder"}),i.jsx("li",{children:" Share your card link in email signatures and social media"}),i.jsx("li",{children:" Regularly check analytics to see engagement"}),i.jsx("li",{children:" Follow up with contacts saved in your CRM"})]})]}),i.jsxs("div",{className:"border-l-4 border-red-500 pl-4",children:[i.jsx("p",{className:"font-medium text-foreground",children:"DON'Ts:"}),i.jsxs("ul",{className:"mt-2 space-y-2 text-sm",children:[i.jsx("li",{children:" Don't leave profile fields empty - complete your card"}),i.jsx("li",{children:" Don't use blurry or inappropriate photos"}),i.jsx("li",{children:" Don't forget to set a default card if you have multiple"}),i.jsx("li",{children:" Don't share incorrect contact information"}),i.jsx("li",{children:" Don't ignore contact exchange notifications"}),i.jsx("li",{children:" Don't keep outdated job titles or company names"})]})]})]})})]}),i.jsxs(xn,{value:"card-care",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Physical Card Care & Maintenance"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"bg-blue-500/5 border border-blue-500/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-3",children:"For PVC Cards:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Store in wallet, card holder, or protective sleeve"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Clean with soft cloth if dirty"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Avoid bending or twisting"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Keep away from water and heat"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Don't scratch the surface or QR code"})})]})]}),i.jsxs("div",{className:"bg-amber-500/5 border border-amber-500/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-3",children:"For Metal Cards:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"More durable than PVC but still needs care"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Polish with microfiber cloth to maintain shine"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Can withstand water but dry it properly"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Store separately from keys to avoid scratches"})}),i.jsx("li",{className:"flex items-start gap-2",children:i.jsx("span",{children:"Don't drop on hard surfaces"})})]})]}),i.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Important:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:" NFC chip is delicate - avoid sharp impacts"}),i.jsx("li",{children:" Keep away from strong magnets"}),i.jsx("li",{children:" Don't stack too many cards together (can interfere with NFC)"}),i.jsx("li",{children:" If card stops working, contact support for replacement"})]})]})]})})]}),i.jsxs(xn,{value:"troubleshooting",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Common Issues & Solutions"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Card Not Tapping/Reading"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm ml-4",children:[i.jsx("li",{children:" Check if NFC is enabled on the phone"}),i.jsx("li",{children:" Remove thick phone case"}),i.jsx("li",{children:" Hold card longer (2-3 seconds)"}),i.jsx("li",{children:" Try different position on back of phone"}),i.jsx("li",{children:" Ensure phone screen is unlocked"})]})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"QR Code Not Scanning"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm ml-4",children:[i.jsx("li",{children:" Clean the card surface"}),i.jsx("li",{children:" Ensure good lighting"}),i.jsx("li",{children:" Hold camera steady"}),i.jsx("li",{children:" Try different angle"}),i.jsx("li",{children:" Use native Camera app (not third-party)"})]})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Profile Not Loading"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm ml-4",children:[i.jsx("li",{children:" Check internet connection"}),i.jsx("li",{children:" Try refreshing the page"}),i.jsx("li",{children:" Clear browser cache"}),i.jsx("li",{children:" Verify your profile is complete in app"})]})]}),i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("p",{className:"font-medium text-foreground",children:"Can't Edit Card"}),i.jsxs("ul",{className:"mt-2 space-y-1 text-sm ml-4",children:[i.jsx("li",{children:" Ensure you're logged in"}),i.jsx("li",{children:" Check internet connection"}),i.jsx("li",{children:" Update app to latest version"}),i.jsx("li",{children:" Log out and log back in"})]})]}),i.jsxs("div",{className:"bg-primary/5 border border-primary/20 rounded-lg p-4 mt-4",children:[i.jsx("p",{className:"text-sm font-medium text-primary mb-2",children:"Still Need Help?"}),i.jsx("p",{className:"text-sm",children:"Contact our support team:"}),i.jsxs("div",{className:"flex flex-col gap-2 mt-3",children:[i.jsx(de,{variant:"outline",size:"sm",onClick:()=>e("/support"),children:"Visit Support Center"}),i.jsx(de,{variant:"outline",size:"sm",asChild:!0,children:i.jsx("a",{href:"https://wa.me/919876543210",target:"_blank",rel:"noopener noreferrer",children:"WhatsApp Support"})}),i.jsx(de,{variant:"outline",size:"sm",asChild:!0,children:i.jsx("a",{href:"mailto:support@synka.in",children:"Email: support@synka.in"})})]})]})]})})]}),i.jsxs(xn,{value:"precautions",className:"bg-card border border-border rounded-xl px-4",children:[i.jsx(yn,{className:"text-foreground font-semibold",children:"Important Precautions"}),i.jsx(bn,{className:"text-muted-foreground space-y-4",children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"bg-yellow-500/5 border border-yellow-500/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Privacy & Security:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:" Only share information you're comfortable making public"}),i.jsx("li",{children:" You can hide specific fields (e.g., personal phone, email)"}),i.jsx("li",{children:" Use business email/phone if you want to keep personal separate"}),i.jsx("li",{children:" Your card is viewable by anyone with the link - plan accordingly"})]})]}),i.jsxs("div",{className:"bg-red-500/5 border border-red-500/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"What NOT to Do:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:" Don't share your account password with anyone"}),i.jsx("li",{children:" Don't put your card in washing machine"}),i.jsx("li",{children:" Don't expose to extreme temperatures"}),i.jsx("li",{children:" Don't try to modify or open the card"}),i.jsx("li",{children:" Don't place near magnets or magnetic strips"}),i.jsx("li",{children:" Don't share sensitive personal info on public card"})]})]}),i.jsxs("div",{className:"bg-green-500/5 border border-green-500/20 rounded-lg p-4",children:[i.jsx("p",{className:"font-medium text-foreground mb-2",children:"Safety Tips:"}),i.jsxs("ul",{className:"space-y-2 text-sm",children:[i.jsx("li",{children:" Enable two-factor authentication in settings"}),i.jsx("li",{children:" Use strong password for your account"}),i.jsx("li",{children:" Regularly review who has accessed your card (analytics)"}),i.jsx("li",{children:" You can deactivate card anytime from settings if needed"}),i.jsx("li",{children:" Report suspicious activity to support immediately"})]})]})]})})]})]})]})})]}),i.jsxs("div",{className:"mt-12 text-center space-y-6",children:[i.jsxs("div",{className:"border-t pt-8",children:[i.jsx("h3",{className:"text-2xl font-bold mb-3",children:"Ready to Get Started?"}),i.jsx("p",{className:"text-muted-foreground mb-6",children:"Create your account and start networking smarter"}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[i.jsx(de,{size:"lg",onClick:()=>e("/signup"),className:"group",children:"Create Your Free Card"}),i.jsx(de,{size:"lg",variant:"outline",onClick:()=>e("/support"),children:"Browse FAQs"})]})]}),i.jsxs("div",{className:"pt-8 border-t",children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Need More Help?"}),i.jsxs("div",{className:"flex flex-wrap justify-center gap-4 text-sm",children:[i.jsx(de,{variant:"link",onClick:()=>e("/support"),children:"Support Center"}),i.jsx(de,{variant:"link",onClick:()=>e("/contact"),children:"Contact Us"}),i.jsx(de,{variant:"link",onClick:()=>e("/settings/upgrade"),children:"Upgrade to Orange"})]})]}),i.jsx("div",{className:"pt-6 pb-8",children:i.jsxs("div",{className:"flex flex-wrap justify-center gap-6 text-xs text-muted-foreground",children:[i.jsx("div",{children:"Secure & Private"}),i.jsx("div",{children:"Instant Updates"}),i.jsx("div",{children:"10,000+ Users"}),i.jsx("div",{children:"Made in India"})]})})]})]}),i.jsx("style",{children:`
        .animate-fade-in {
          animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `})]})}const jYe=new SQ({defaultOptions:{queries:{staleTime:10*60*1e3,gcTime:60*60*1e3,refetchOnWindowFocus:!1,retry:1,refetchOnMount:!1}}}),FY=N.createContext(null),PY=()=>N.useContext(FY);function IYe({children:e}){const t=nie();return i.jsx(FY.Provider,{value:t,children:e})}function TYe({children:e}){const t=PY(),n=Xl();return t!=null&&t.isLocked&&n.pathname!=="/login"?i.jsx(fw,{to:"/login",state:{appLockMode:!0,returnTo:n.pathname},replace:!0}):i.jsx(i.Fragment,{children:e})}function EYe(){const{loading:e}=or();return eie(),e?i.jsx("div",{className:"min-h-dvh w-full flex items-center justify-center bg-background",children:i.jsx("div",{className:"flex flex-col items-center gap-3",children:i.jsx("img",{src:"/logos/synka-logo.png",alt:"Synka",className:"w-12 h-12 animate-pulse"})})}):i.jsxs(oX,{children:[i.jsx(aa,{path:"/",element:i.jsx(rie,{})}),i.jsx(aa,{path:"/login",element:i.jsx(Vie,{})}),i.jsx(aa,{path:"/signup",element:i.jsx(Goe,{})}),i.jsx(aa,{path:"/u/:slug",element:i.jsx(Hoe,{})}),i.jsxs(aa,{element:i.jsx(Xse,{}),children:[i.jsx(aa,{path:"/index",element:i.jsx(Oie,{})}),i.jsx(aa,{path:"/dashboard",element:i.jsx(ape,{})}),i.jsx(aa,{path:"/crm",element:i.jsx(qpe,{})}),i.jsx(aa,{path:"/my-card",element:i.jsx(hKe,{})}),i.jsx(aa,{path:"/settings",element:i.jsx(gKe,{})}),i.jsx(aa,{path:"/settings/profile",element:i.jsx(nYe,{})}),i.jsx(aa,{path:"/settings/upgrade",element:i.jsx(tYe,{})}),i.jsx(aa,{path:"/order-nfc-card",element:i.jsx(IKe,{})}),i.jsx(aa,{path:"/admin",element:i.jsx(JKe,{})}),i.jsx(aa,{path:"/terms",element:i.jsx(aYe,{})}),i.jsx(aa,{path:"/privacy",element:i.jsx(sYe,{})}),i.jsx(aa,{path:"/contact",element:i.jsx(iYe,{})}),i.jsx(aa,{path:"/support",element:i.jsx(CYe,{})}),i.jsx(aa,{path:"/welcome",element:i.jsx(_Ye,{})}),i.jsx(aa,{path:"*",element:i.jsx(rYe,{})})]})]})}function AYe(){return i.jsx(CQ,{client:jYe,children:i.jsx(YQ,{children:i.jsx(nJ,{children:i.jsx(PQ,{children:i.jsxs(LO,{children:[i.jsx(NZ,{}),i.jsx(eQ,{}),i.jsx(iX,{children:i.jsx(Jse,{children:i.jsx(IYe,{children:i.jsx(TYe,{children:i.jsx(EYe,{})})})})})]})})})})})}ZQ();QQ(()=>{console.log("[App] Back online - syncing data"),eJ()},()=>{console.log("[App] Went offline")});uO(document.getElementById("root")).render(i.jsx(Ne.StrictMode,{children:i.jsx(AYe,{})}));export{_k as C,xC as E,Kw as I,Yw as N,JO as W,bo as _,Xt as a,qQ as b,BYe as c,kh as r};
