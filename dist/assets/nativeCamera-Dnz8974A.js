import{W as f,C as d,r as b,a as g}from"./index-Chq_Fyko.js";import"./ui-C6WdqKj_.js";import"./vendor-CuLCWM7P.js";import"./supabase-DLPZu9zH.js";var m;(function(s){s.Prompt="PROMPT",s.Camera="CAMERA",s.Photos="PHOTOS"})(m||(m={}));var p;(function(s){s.Rear="REAR",s.Front="FRONT"})(p||(p={}));var u;(function(s){s.Uri="uri",s.Base64="base64",s.DataUrl="dataUrl"})(u||(u={}));class y extends f{async getPhoto(t){return new Promise(async(a,r)=>{if(t.webUseInput||t.source===m.Photos)this.fileInputExperience(t,a,r);else if(t.source===m.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=t.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",async i=>{i.detail===0?this.fileInputExperience(t,a,r):this.cameraExperience(t,a,r)})}else this.cameraExperience(t,a,r)})}async pickImages(t){return new Promise(async(a,r)=>{this.multipleFileInputExperience(a,r)})}async cameraExperience(t,a,r){if(customElements.get("pwa-camera-modal")){const e=document.createElement("pwa-camera-modal");e.facingMode=t.direction===p.Front?"user":"environment",document.body.appendChild(e);try{await e.componentOnReady(),e.addEventListener("onPhoto",async i=>{const n=i.detail;n===null?r(new d("User cancelled photos app")):n instanceof Error?r(n):a(await this._getCameraPhoto(n,t)),e.dismiss(),document.body.removeChild(e)}),e.present()}catch{this.fileInputExperience(t,a,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,a,r)}fileInputExperience(t,a,r){let e=document.querySelector("#_capacitor-camera-input");const i=()=>{var n;(n=e.parentNode)===null||n===void 0||n.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",n=>{const c=e.files[0];let l="jpeg";if(c.type==="image/png"?l="png":c.type==="image/gif"&&(l="gif"),t.resultType==="dataUrl"||t.resultType==="base64"){const o=new FileReader;o.addEventListener("load",()=>{if(t.resultType==="dataUrl")a({dataUrl:o.result,format:l});else if(t.resultType==="base64"){const h=o.result.split(",")[1];a({base64String:h,format:l})}i()}),o.readAsDataURL(c)}else a({webPath:URL.createObjectURL(c),format:l}),i()}),e.addEventListener("cancel",n=>{r(new d("User cancelled photos app")),i()})),e.accept="image/*",e.capture=!0,t.source===m.Photos||t.source===m.Prompt?e.removeAttribute("capture"):t.direction===p.Front?e.capture="user":t.direction===p.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(t,a){let r=document.querySelector("#_capacitor-camera-input-multiple");const e=()=>{var i;(i=r.parentNode)===null||i===void 0||i.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",i=>{const n=[];for(let c=0;c<r.files.length;c++){const l=r.files[c];let o="jpeg";l.type==="image/png"?o="png":l.type==="image/gif"&&(o="gif"),n.push({webPath:URL.createObjectURL(l),format:o})}t({photos:n}),e()}),r.addEventListener("cancel",i=>{a(new d("User cancelled photos app")),e()})),r.accept="image/*",r.click()}_getCameraPhoto(t,a){return new Promise((r,e)=>{const i=new FileReader,n=t.type.split("/")[1];a.resultType==="uri"?r({webPath:URL.createObjectURL(t),format:n,saved:!1}):(i.readAsDataURL(t),i.onloadend=()=>{const c=i.result;a.resultType==="dataUrl"?r({dataUrl:c,format:n,saved:!1}):r({base64String:c.split(",")[1],format:n,saved:!1})},i.onerror=c=>{e(c)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const P=b("Camera",{web:()=>new y});async function U(){var s,t;try{const a=await P.getPhoto({quality:90,allowEditing:!1,resultType:u.Base64,source:m.Prompt,correctOrientation:!0,width:1920,height:1920,promptLabelHeader:"Scan Business Card",promptLabelCancel:"Cancel",promptLabelPhoto:"Take Photo",promptLabelPicture:"Choose from Gallery"});return a.base64String?{success:!0,base64:a.base64String,webPath:a.webPath}:{success:!1,error:"No image captured"}}catch(a){return console.error("Image capture failed:",a),(s=a==null?void 0:a.message)!=null&&s.includes("cancelled")||(t=a==null?void 0:a.message)!=null&&t.includes("cancel")?{success:!1,error:"cancelled"}:{success:!1,error:(a==null?void 0:a.message)||"Failed to capture image. Please try again."}}}function C(){return g.isNativePlatform()}export{U as captureOrPickImage,C as shouldUseNativeCamera};
